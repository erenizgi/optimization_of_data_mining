{
    "author": "alxhub",
    "message": "feat(compiler-cli): support producing Closure-specific PURE annotations (#41021)\n\nFor certain generated function calls, the compiler emits a 'PURE' annotation\nwhich informs Terser (the optimizer) about the purity of a specific function\ncall. This commit expands that system to produce a new Closure-specific\n'pureOrBreakMyCode' annotation when targeting the Closure optimizer instead\nof Terser.\n\nPR Close #41021",
    "sha": "fbc9df181ea50527cb755382b54b8b45d0f9ef39",
    "files": [
        {
            "sha": "2893e807229d8bf24cf594a670bcd348f30f89f8",
            "filename": "packages/compiler-cli/linker/test/ast/ast_value_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Flinker%2Ftest%2Fast%2Fast_value_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Flinker%2Ftest%2Fast%2Fast_value_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Ftest%2Fast%2Fast_value_spec.ts?ref=fbc9df181ea50527cb755382b54b8b45d0f9ef39",
            "patch": "@@ -23,7 +23,7 @@ interface TestObject {\n }\n \n const host: AstHost<ts.Expression> = new TypeScriptAstHost();\n-const factory = new TypeScriptAstFactory();\n+const factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ false);\n const nestedObj = factory.createObjectLiteral([\n   {propertyName: 'x', quoted: false, value: factory.createLiteral(42)},\n   {propertyName: 'y', quoted: false, value: factory.createLiteral('X')},"
        },
        {
            "sha": "3e0568a740abbea9b8caeba24466bc25a1081ee6",
            "filename": "packages/compiler-cli/linker/test/file_linker/emit_scopes/emit_scope_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Femit_scopes%2Femit_scope_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Femit_scopes%2Femit_scope_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Femit_scopes%2Femit_scope_spec.ts?ref=fbc9df181ea50527cb755382b54b8b45d0f9ef39",
            "patch": "@@ -16,7 +16,7 @@ import {generate} from '../helpers';\n describe('EmitScope', () => {\n   describe('translateDefinition()', () => {\n     it('should translate the given output AST into a TExpression', () => {\n-      const factory = new TypeScriptAstFactory();\n+      const factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ false);\n       const translator = new Translator<ts.Statement, ts.Expression>(factory);\n       const ngImport = factory.createIdentifier('core');\n       const emitScope = new EmitScope<ts.Statement, ts.Expression>(ngImport, translator);\n@@ -26,7 +26,7 @@ describe('EmitScope', () => {\n     });\n \n     it('should use the `ngImport` idenfifier for imports when translating', () => {\n-      const factory = new TypeScriptAstFactory();\n+      const factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ false);\n       const translator = new Translator<ts.Statement, ts.Expression>(factory);\n       const ngImport = factory.createIdentifier('core');\n       const emitScope = new EmitScope<ts.Statement, ts.Expression>(ngImport, translator);\n@@ -37,7 +37,7 @@ describe('EmitScope', () => {\n     });\n \n     it('should not emit any shared constants in the replacement expression', () => {\n-      const factory = new TypeScriptAstFactory();\n+      const factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ false);\n       const translator = new Translator<ts.Statement, ts.Expression>(factory);\n       const ngImport = factory.createIdentifier('core');\n       const emitScope = new EmitScope<ts.Statement, ts.Expression>(ngImport, translator);\n@@ -54,7 +54,7 @@ describe('EmitScope', () => {\n \n   describe('getConstantStatements()', () => {\n     it('should return any constant statements that were added to the `constantPool`', () => {\n-      const factory = new TypeScriptAstFactory();\n+      const factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ false);\n       const translator = new Translator<ts.Statement, ts.Expression>(factory);\n       const ngImport = factory.createIdentifier('core');\n       const emitScope = new EmitScope<ts.Statement, ts.Expression>(ngImport, translator);"
        },
        {
            "sha": "408d396deaa7939e43268ac80e44f342a061bb78",
            "filename": "packages/compiler-cli/linker/test/file_linker/emit_scopes/iief_emit_scope_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Femit_scopes%2Fiief_emit_scope_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Femit_scopes%2Fiief_emit_scope_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Femit_scopes%2Fiief_emit_scope_spec.ts?ref=fbc9df181ea50527cb755382b54b8b45d0f9ef39",
            "patch": "@@ -16,7 +16,7 @@ import {generate} from '../helpers';\n describe('IifeEmitScope', () => {\n   describe('translateDefinition()', () => {\n     it('should translate the given output AST into a TExpression, wrapped in an IIFE', () => {\n-      const factory = new TypeScriptAstFactory();\n+      const factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ false);\n       const translator = new Translator<ts.Statement, ts.Expression>(factory);\n       const ngImport = factory.createIdentifier('core');\n       const emitScope =\n@@ -27,7 +27,7 @@ describe('IifeEmitScope', () => {\n     });\n \n     it('should use the `ngImport` idenfifier for imports when translating', () => {\n-      const factory = new TypeScriptAstFactory();\n+      const factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ false);\n       const translator = new Translator<ts.Statement, ts.Expression>(factory);\n       const ngImport = factory.createIdentifier('core');\n       const emitScope =\n@@ -39,7 +39,7 @@ describe('IifeEmitScope', () => {\n     });\n \n     it('should emit any shared constants in the replacement expression IIFE', () => {\n-      const factory = new TypeScriptAstFactory();\n+      const factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ false);\n       const translator = new Translator<ts.Statement, ts.Expression>(factory);\n       const ngImport = factory.createIdentifier('core');\n       const emitScope =\n@@ -58,7 +58,7 @@ describe('IifeEmitScope', () => {\n \n   describe('getConstantStatements()', () => {\n     it('should throw an error', () => {\n-      const factory = new TypeScriptAstFactory();\n+      const factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ false);\n       const translator = new Translator<ts.Statement, ts.Expression>(factory);\n       const ngImport = factory.createIdentifier('core');\n       const emitScope ="
        },
        {
            "sha": "cb684a8edc86881c94900a79ce308b87ead385f8",
            "filename": "packages/compiler-cli/linker/test/file_linker/file_linker_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Ffile_linker_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Ffile_linker_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Ffile_linker_spec.ts?ref=fbc9df181ea50527cb755382b54b8b45d0f9ef39",
            "patch": "@@ -23,7 +23,7 @@ import {generate} from './helpers';\n \n describe('FileLinker', () => {\n   let factory: TypeScriptAstFactory;\n-  beforeEach(() => factory = new TypeScriptAstFactory());\n+  beforeEach(() => factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ false));\n \n   describe('isPartialDeclaration()', () => {\n     it('should return true if the callee is recognized', () => {\n@@ -154,7 +154,8 @@ describe('FileLinker', () => {\n     const fs = new MockFileSystemNative();\n     const logger = new MockLogger();\n     const linkerEnvironment = LinkerEnvironment.create<ts.Statement, ts.Expression>(\n-        fs, logger, new TypeScriptAstHost(), new TypeScriptAstFactory(), DEFAULT_LINKER_OPTIONS);\n+        fs, logger, new TypeScriptAstHost(),\n+        new TypeScriptAstFactory(/* annotateForClosureCompiler */ false), DEFAULT_LINKER_OPTIONS);\n     const fileLinker = new FileLinker<MockConstantScopeRef, ts.Statement, ts.Expression>(\n         linkerEnvironment, fs.resolve('/test.js'), '// test code');\n     return {host: linkerEnvironment.host, fileLinker};"
        },
        {
            "sha": "31561d4d50297f0cf9d36c5add56ba98a02998b8",
            "filename": "packages/compiler-cli/linker/test/file_linker/partial_linkers/partial_linker_selector_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Fpartial_linkers%2Fpartial_linker_selector_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Fpartial_linkers%2Fpartial_linker_selector_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Fpartial_linkers%2Fpartial_linker_selector_spec.ts?ref=fbc9df181ea50527cb755382b54b8b45d0f9ef39",
            "patch": "@@ -33,7 +33,8 @@ describe('PartialLinkerSelector', () => {\n     fs = new MockFileSystemNative();\n     const logger = new MockLogger();\n     environment = LinkerEnvironment.create<ts.Statement, ts.Expression>(\n-        fs, logger, new TypeScriptAstHost(), new TypeScriptAstFactory(), options);\n+        fs, logger, new TypeScriptAstHost(),\n+        new TypeScriptAstFactory(/* annotateForClosureCompiler */ false), options);\n   });\n \n   describe('supportsDeclaration()', () => {"
        },
        {
            "sha": "233cd38e9a269e6dfb3a1e9f5a8b857a1c361384",
            "filename": "packages/compiler-cli/linker/test/file_linker/translator_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Ftranslator_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Ftranslator_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Ftranslator_spec.ts?ref=fbc9df181ea50527cb755382b54b8b45d0f9ef39",
            "patch": "@@ -14,7 +14,7 @@ import {generate} from './helpers';\n \n describe('Translator', () => {\n   let factory: TypeScriptAstFactory;\n-  beforeEach(() => factory = new TypeScriptAstFactory());\n+  beforeEach(() => factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ false));\n \n   describe('translateExpression()', () => {\n     it('should generate expression specific output', () => {"
        },
        {
            "sha": "9dbeb1279fa2caefc00b76a804c6263f9987bc86",
            "filename": "packages/compiler-cli/src/ngtsc/transform/src/transform.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Ftransform.ts",
            "raw_url": "https://github.com/angular/angular/raw/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Ftransform.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Ftransform.ts?ref=fbc9df181ea50527cb755382b54b8b45d0f9ef39",
            "patch": "@@ -11,7 +11,7 @@ import * as ts from 'typescript';\n \n import {DefaultImportRecorder, ImportRewriter} from '../../imports';\n import {Decorator, ReflectionHost} from '../../reflection';\n-import {ImportManager, RecordWrappedNodeExprFn, translateExpression, translateStatement} from '../../translator';\n+import {ImportManager, RecordWrappedNodeExprFn, translateExpression, translateStatement, TranslatorOptions} from '../../translator';\n import {visit, VisitListEntryResult, Visitor} from '../../util/src/visitor';\n \n import {CompileResult} from './api';\n@@ -91,15 +91,18 @@ class IvyTransformationVisitor extends Visitor {\n       return {node};\n     }\n \n+    const translateOptions: TranslatorOptions<ts.Expression> = {\n+      recordWrappedNodeExpr: this.recordWrappedNodeExpr,\n+      annotateForClosureCompiler: this.isClosureCompilerEnabled,\n+    };\n+\n     // There is at least one field to add.\n     const statements: ts.Statement[] = [];\n     const members = [...node.members];\n \n     for (const field of this.classCompilationMap.get(node)!) {\n       // Translate the initializer for the field into TS nodes.\n-      const exprNode = translateExpression(\n-          field.initializer, this.importManager,\n-          {recordWrappedNodeExpr: this.recordWrappedNodeExpr});\n+      const exprNode = translateExpression(field.initializer, this.importManager, translateOptions);\n \n       // Create a static property declaration for the new field.\n       const property = ts.createProperty(\n@@ -116,10 +119,7 @@ class IvyTransformationVisitor extends Visitor {\n             /* hasTrailingNewLine */ false);\n       }\n \n-      field.statements\n-          .map(\n-              stmt => translateStatement(\n-                  stmt, this.importManager, {recordWrappedNodeExpr: this.recordWrappedNodeExpr}))\n+      field.statements.map(stmt => translateStatement(stmt, this.importManager, translateOptions))\n           .forEach(stmt => statements.push(stmt));\n \n       members.push(property);\n@@ -282,6 +282,7 @@ function transformIvySourceFile(\n                                     recordWrappedNodeExpr,\n                                     downlevelTaggedTemplates: downlevelTranslatedCode,\n                                     downlevelVariableDeclarations: downlevelTranslatedCode,\n+                                    annotateForClosureCompiler: isClosureCompilerEnabled,\n                                   }));\n \n   // Preserve @fileoverview comments required by Closure, since the location might change as a"
        },
        {
            "sha": "f2d71023a62456c9a80303106732118b8fb5da3c",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/translator.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "raw_url": "https://github.com/angular/angular/raw/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts?ref=fbc9df181ea50527cb755382b54b8b45d0f9ef39",
            "patch": "@@ -42,6 +42,7 @@ export interface TranslatorOptions<TExpression> {\n   downlevelTaggedTemplates?: boolean;\n   downlevelVariableDeclarations?: boolean;\n   recordWrappedNodeExpr?: RecordWrappedNodeExprFn<TExpression>;\n+  annotateForClosureCompiler?: boolean;\n }\n \n export class ExpressionTranslatorVisitor<TStatement, TExpression> implements o.ExpressionVisitor,"
        },
        {
            "sha": "6de1302c3107b37f348fecfa1a602d3e0f8dfdc4",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/typescript_ast_factory.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 1,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftypescript_ast_factory.ts",
            "raw_url": "https://github.com/angular/angular/raw/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftypescript_ast_factory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftypescript_ast_factory.ts?ref=fbc9df181ea50527cb755382b54b8b45d0f9ef39",
            "patch": "@@ -9,6 +9,21 @@ import * as ts from 'typescript';\n \n import {AstFactory, BinaryOperator, LeadingComment, ObjectLiteralProperty, SourceMapRange, TemplateLiteral, UnaryOperator, VariableDeclarationType} from './api/ast_factory';\n \n+/**\n+ * Different optimizers use different annotations on a function or method call to indicate its pure\n+ * status.\n+ */\n+enum PureAnnotation {\n+  /**\n+   * Closure's annotation for purity is `@pureOrBreakMyCode`, but this needs to be in a semantic\n+   * (jsdoc) enabled comment. Thus, the actual comment text for Closure must include the `*` that\n+   * turns a `/*` comment into a `/**` comment, as well as surrounding whitespace.\n+   */\n+  CLOSURE = '* @pureOrBreakMyCode ',\n+\n+  TERSER = '@__PURE__',\n+}\n+\n const UNARY_OPERATORS: Record<UnaryOperator, ts.PrefixUnaryOperator> = {\n   '+': ts.SyntaxKind.PlusToken,\n   '-': ts.SyntaxKind.MinusToken,\n@@ -46,6 +61,8 @@ const VAR_TYPES: Record<VariableDeclarationType, ts.NodeFlags> = {\n export class TypeScriptAstFactory implements AstFactory<ts.Statement, ts.Expression> {\n   private externalSourceFiles = new Map<string, ts.SourceMapSource>();\n \n+  constructor(private annotateForClosureCompiler: boolean) {}\n+\n   attachComments = attachComments;\n \n   createArrayLiteral = ts.createArrayLiteral;\n@@ -68,7 +85,9 @@ export class TypeScriptAstFactory implements AstFactory<ts.Statement, ts.Express\n     const call = ts.createCall(callee, undefined, args);\n     if (pure) {\n       ts.addSyntheticLeadingComment(\n-          call, ts.SyntaxKind.MultiLineCommentTrivia, '@__PURE__', /* trailing newline */ false);\n+          call, ts.SyntaxKind.MultiLineCommentTrivia,\n+          this.annotateForClosureCompiler ? PureAnnotation.CLOSURE : PureAnnotation.TERSER,\n+          /* trailing newline */ false);\n     }\n     return call;\n   }"
        },
        {
            "sha": "9fd0a1b5f526cd2f38248b7cee48a5bc0251f6ba",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/typescript_translator.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftypescript_translator.ts",
            "raw_url": "https://github.com/angular/angular/raw/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftypescript_translator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftypescript_translator.ts?ref=fbc9df181ea50527cb755382b54b8b45d0f9ef39",
            "patch": "@@ -19,7 +19,7 @@ export function translateExpression(\n     options: TranslatorOptions<ts.Expression> = {}): ts.Expression {\n   return expression.visitExpression(\n       new ExpressionTranslatorVisitor<ts.Statement, ts.Expression>(\n-          new TypeScriptAstFactory(), imports, options),\n+          new TypeScriptAstFactory(options.annotateForClosureCompiler === true), imports, options),\n       new Context(false));\n }\n \n@@ -28,6 +28,6 @@ export function translateStatement(\n     options: TranslatorOptions<ts.Expression> = {}): ts.Statement {\n   return statement.visitStatement(\n       new ExpressionTranslatorVisitor<ts.Statement, ts.Expression>(\n-          new TypeScriptAstFactory(), imports, options),\n+          new TypeScriptAstFactory(options.annotateForClosureCompiler === true), imports, options),\n       new Context(true));\n }"
        },
        {
            "sha": "f213c2abc2133265eec442f42aa29f8bd37169b2",
            "filename": "packages/compiler-cli/src/ngtsc/translator/test/typescript_ast_factory_spec.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Ftest%2Ftypescript_ast_factory_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Ftest%2Ftypescript_ast_factory_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Ftest%2Ftypescript_ast_factory_spec.ts?ref=fbc9df181ea50527cb755382b54b8b45d0f9ef39",
            "patch": "@@ -12,7 +12,7 @@ import {TypeScriptAstFactory} from '../src/typescript_ast_factory';\n \n describe('TypeScriptAstFactory', () => {\n   let factory: TypeScriptAstFactory;\n-  beforeEach(() => factory = new TypeScriptAstFactory());\n+  beforeEach(() => factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ false));\n \n   describe('attachComments()', () => {\n     it('should add the comments to the given statement', () => {\n@@ -77,6 +77,14 @@ describe('TypeScriptAstFactory', () => {\n       const call = factory.createCallExpression(callee, [arg1, arg2], true);\n       expect(generate(call)).toEqual('/*@__PURE__*/ foo(42, \"moo\")');\n     });\n+\n+    it('should create a call marked with a closure-style pure comment if `pure` is true', () => {\n+      factory = new TypeScriptAstFactory(/* annotateForClosureCompiler */ true);\n+\n+      const {items: [callee, arg1, arg2], generate} = setupExpressions(`foo`, `42`, `\"moo\"`);\n+      const call = factory.createCallExpression(callee, [arg1, arg2], true);\n+      expect(generate(call)).toEqual('/** @pureOrBreakMyCode */ foo(42, \"moo\")');\n+    });\n   });\n \n   describe('createConditional()', () => {"
        },
        {
            "sha": "12077c768bbcaec2a43fa101a4b7d4dab252a9aa",
            "filename": "packages/compiler-cli/test/ngtsc/ngtsc_spec.ts",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fbc9df181ea50527cb755382b54b8b45d0f9ef39/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts?ref=fbc9df181ea50527cb755382b54b8b45d0f9ef39",
            "patch": "@@ -393,6 +393,31 @@ runInEachFileSystem(os => {\n     // that start with `C:`.\n     if (os !== 'Windows' || platform() === 'win32') {\n       describe('when closure annotations are requested', () => {\n+        it('should add @pureOrBreakMyCode to getInheritedFactory calls', () => {\n+          env.tsconfig({\n+            'annotateForClosureCompiler': true,\n+          });\n+          env.write(`test.ts`, `\n+            import {Directive} from '@angular/core';\n+    \n+            @Directive({\n+              selector: '[base]',\n+            })\n+            class Base {}\n+    \n+            @Directive({\n+              selector: '[test]',\n+            })\n+            class Dir extends Base {\n+            }\n+        `);\n+\n+          env.driveMain();\n+\n+          const jsContents = env.getContents('test.js');\n+          expect(jsContents).toContain('/** @pureOrBreakMyCode */ i0.ɵɵgetInheritedFactory(Dir)');\n+        });\n+\n         it('should add @nocollapse to static fields', () => {\n           env.tsconfig({\n             'annotateForClosureCompiler': true,"
        }
    ],
    "stats": {
        "total": 106,
        "additions": 81,
        "deletions": 25
    }
}