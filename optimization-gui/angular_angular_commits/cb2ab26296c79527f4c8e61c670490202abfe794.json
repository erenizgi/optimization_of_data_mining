{
    "author": "devversion",
    "message": "feat(dev-infra): merge script should link to original commit when cherry-picking with API strategy (#37889)\n\nThe merge script uses `git cherry-pick` for both the API merge strategy\nand the autosquash strategy. It uses cherry-pick to push commits to\ndifferent target branches (e.g. into the `10.0.x` branch).\n\nThose commits never point to the commits that landed in the primary\nGithub branch though. For the autosquash strategy the pull request number\nis always included, so there is a way to go back to the source. On the other\nhand though, for commits cherry-picked in the API merge strategy, the\npull request number might not always be included (due to Github's\nimplementation of the rebase merge method).\n\ne.g.\nhttps://github.com/angular/components/commit/27f52711c0618a9ae4eab4c888c8ab3245638e77\n\nFor those cases we'd want to link the cherry-picked commits to the\noriginal commits so that the corresponding PR is easier to track\ndown. This is not needed for the autosquash strategy (as outlined\nbefore), but it would have been good for consistency. Unfortunately\nthough this would rather complicate the strategy as the autosquash\nstrategy cherry-picks directly from the PR head, so the SHAs that\nare used in the primary branch are not known.\n\nPR Close #37889",
    "sha": "cb2ab26296c79527f4c8e61c670490202abfe794",
    "files": [
        {
            "sha": "f52b768e00b4e4a79c0923279154f2459496a16f",
            "filename": "dev-infra/pr/merge/strategies/api-merge.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/cb2ab26296c79527f4c8e61c670490202abfe794/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fapi-merge.ts",
            "raw_url": "https://github.com/angular/angular/raw/cb2ab26296c79527f4c8e61c670490202abfe794/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fapi-merge.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fapi-merge.ts?ref=cb2ab26296c79527f4c8e61c670490202abfe794",
            "patch": "@@ -135,7 +135,13 @@ export class GithubApiMergeStrategy extends MergeStrategy {\n \n     // Cherry pick the merged commits into the remaining target branches.\n     const failedBranches = await this.cherryPickIntoTargetBranches(\n-        `${targetSha}~${targetCommitsCount}..${targetSha}`, cherryPickTargetBranches);\n+        `${targetSha}~${targetCommitsCount}..${targetSha}`, cherryPickTargetBranches, {\n+          // Commits that have been created by the Github API do not necessarily contain\n+          // a reference to the source pull request (unless the squash strategy is used).\n+          // To ensure that original commits can be found when a commit is viewed in a\n+          // target branch, we add a link to the original commits when cherry-picking.\n+          linkToOriginalCommits: true,\n+        });\n \n     // We already checked whether the PR can be cherry-picked into the target branches,\n     // but in case the cherry-pick somehow fails, we still handle the conflicts here. The"
        },
        {
            "sha": "2e1ff24d260e92c0346ae7ac15961700bd16c460",
            "filename": "dev-infra/pr/merge/strategies/strategy.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/cb2ab26296c79527f4c8e61c670490202abfe794/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fstrategy.ts",
            "raw_url": "https://github.com/angular/angular/raw/cb2ab26296c79527f4c8e61c670490202abfe794/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fstrategy.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fstrategies%2Fstrategy.ts?ref=cb2ab26296c79527f4c8e61c670490202abfe794",
            "patch": "@@ -69,7 +69,8 @@ export abstract class MergeStrategy {\n    * @returns A list of branches for which the revisions could not be cherry-picked into.\n    */\n   protected cherryPickIntoTargetBranches(revisionRange: string, targetBranches: string[], options: {\n-    dryRun?: boolean\n+    dryRun?: boolean,\n+    linkToOriginalCommits?: boolean,\n   } = {}) {\n     const cherryPickArgs = [revisionRange];\n     const failedBranches: string[] = [];\n@@ -82,6 +83,14 @@ export abstract class MergeStrategy {\n       cherryPickArgs.push('--no-commit');\n     }\n \n+    if (options.linkToOriginalCommits) {\n+      // We add `-x` when cherry-picking as that will allow us to easily jump to original\n+      // commits for cherry-picked commits. With that flag set, Git will automatically append\n+      // the original SHA/revision to the commit message. e.g. `(cherry picked from commit <..>)`.\n+      // https://git-scm.com/docs/git-cherry-pick#Documentation/git-cherry-pick.txt--x.\n+      cherryPickArgs.push('-x');\n+    }\n+\n     // Cherry-pick the refspec into all determined target branches.\n     for (const branchName of targetBranches) {\n       const localTargetBranch = this.getLocalTargetBranchName(branchName);"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 17,
        "deletions": 2
    }
}