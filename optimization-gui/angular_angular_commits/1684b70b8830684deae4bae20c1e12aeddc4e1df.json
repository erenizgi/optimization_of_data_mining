{
    "author": "devversion",
    "message": "test(dev-infra): always use same virtual git client instance in publish tests (#42468)\n\nWith the recent refactorings to `GitClient`, where singletons\nare created and can be retrieved through a static method, the\ntest has been updated to also install spies for the static methods\nof `GitClient`. This commit updates the spy installation so that\nthe same mock git client is used that is also passed manually to\nthe release actions. Having two separate instances of the mock\ngit client could result in false-positive test results.\n\nPR Close #42468",
    "sha": "1684b70b8830684deae4bae20c1e12aeddc4e1df",
    "files": [
        {
            "sha": "ddbc36e84772659bdf8fb2753ebff9b882032468",
            "filename": "dev-infra/release/publish/test/test-utils.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/1684b70b8830684deae4bae20c1e12aeddc4e1df/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftest-utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/1684b70b8830684deae4bae20c1e12aeddc4e1df/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftest-utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftest-utils.ts?ref=1684b70b8830684deae4bae20c1e12aeddc4e1df",
            "patch": "@@ -68,16 +68,16 @@ export function getTestingMocksForReleaseAction() {\n export function setupReleaseActionForTesting<T extends ReleaseAction>(\n     actionCtor: ReleaseActionConstructor<T>, active: ActiveReleaseTrains,\n     isNextPublishedToNpm = true): TestReleaseAction<T> {\n-  installVirtualGitClientSpies();\n-  installMockReleaseNotes();\n-\n   // Reset existing HTTP interceptors.\n   nock.cleanAll();\n \n   const {gitClient, githubConfig, releaseConfig} = getTestingMocksForReleaseAction();\n   const repo = new GithubTestingRepo(githubConfig.owner, githubConfig.name);\n   const fork = new GithubTestingRepo('some-user', 'fork');\n \n+  installVirtualGitClientSpies(gitClient);\n+  installMockReleaseNotes();\n+\n   // The version for the release-train in the next phase does not necessarily need to be\n   // published to NPM. We mock the NPM package request and fake the state of the next\n   // version based on the `isNextPublishedToNpm` testing parameter. More details on the"
        },
        {
            "sha": "b67fba69c37bb2f9ed41d9c0433eb63e73e4c5cf",
            "filename": "dev-infra/utils/testing/virtual-git-client.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/1684b70b8830684deae4bae20c1e12aeddc4e1df/dev-infra%2Futils%2Ftesting%2Fvirtual-git-client.ts",
            "raw_url": "https://github.com/angular/angular/raw/1684b70b8830684deae4bae20c1e12aeddc4e1df/dev-infra%2Futils%2Ftesting%2Fvirtual-git-client.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Ftesting%2Fvirtual-git-client.ts?ref=1684b70b8830684deae4bae20c1e12aeddc4e1df",
            "patch": "@@ -203,8 +203,7 @@ export class VirtualGitClient extends AuthenticatedGitClient {\n   }\n }\n \n-export function installVirtualGitClientSpies() {\n-  const mockInstance = VirtualGitClient.createInstance();\n+export function installVirtualGitClientSpies(mockInstance = VirtualGitClient.createInstance()) {\n   spyOn(GitClient, 'get').and.returnValue(mockInstance);\n   spyOn(AuthenticatedGitClient, 'get').and.returnValue(mockInstance);\n }"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 4,
        "deletions": 5
    }
}