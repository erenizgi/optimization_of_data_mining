{
    "author": "crisbeto",
    "message": "feat(common): add injection token for default date pipe timezone (#43611)\n\nAdds a new injection token called `DATE_PIPE_DEFAULT_TIMEZONE` that allows for the default timezone for all `DatePipe` instances to be specified.\n\nFixes #43031.\n\nPR Close #43611",
    "sha": "adf4481211ac0a2eabf560f42ef5193ca550ec98",
    "files": [
        {
            "sha": "878431650b5fb16e833dabc98aa97ee592029be9",
            "filename": "goldens/public-api/common/common.md",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/adf4481211ac0a2eabf560f42ef5193ca550ec98/goldens%2Fpublic-api%2Fcommon%2Fcommon.md",
            "raw_url": "https://github.com/angular/angular/raw/adf4481211ac0a2eabf560f42ef5193ca550ec98/goldens%2Fpublic-api%2Fcommon%2Fcommon.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fcommon%2Fcommon.md?ref=adf4481211ac0a2eabf560f42ef5193ca550ec98",
            "patch": "@@ -73,17 +73,20 @@ export class CurrencyPipe implements PipeTransform {\n     static ɵpipe: i0.ɵɵPipeDeclaration<CurrencyPipe, \"currency\">;\n }\n \n+// @public\n+export const DATE_PIPE_DEFAULT_TIMEZONE: InjectionToken<string>;\n+\n // @public\n export class DatePipe implements PipeTransform {\n-    constructor(locale: string);\n+    constructor(locale: string, defaultTimezone?: string | null | undefined);\n     // (undocumented)\n     transform(value: Date | string | number, format?: string, timezone?: string, locale?: string): string | null;\n     // (undocumented)\n     transform(value: null | undefined, format?: string, timezone?: string, locale?: string): null;\n     // (undocumented)\n     transform(value: Date | string | number | null | undefined, format?: string, timezone?: string, locale?: string): string | null;\n     // (undocumented)\n-    static ɵfac: i0.ɵɵFactoryDeclaration<DatePipe, never>;\n+    static ɵfac: i0.ɵɵFactoryDeclaration<DatePipe, [null, { optional: true; }]>;\n     // (undocumented)\n     static ɵpipe: i0.ɵɵPipeDeclaration<DatePipe, \"date\">;\n }"
        },
        {
            "sha": "c8579fb932ae4897839dd26bfc0fd3245f9f39b4",
            "filename": "packages/common/src/common.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/adf4481211ac0a2eabf560f42ef5193ca550ec98/packages%2Fcommon%2Fsrc%2Fcommon.ts",
            "raw_url": "https://github.com/angular/angular/raw/adf4481211ac0a2eabf560f42ef5193ca550ec98/packages%2Fcommon%2Fsrc%2Fcommon.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Fcommon.ts?ref=adf4481211ac0a2eabf560f42ef5193ca550ec98",
            "patch": "@@ -22,7 +22,7 @@ export {parseCookieValue as ɵparseCookieValue} from './cookie';\n export {CommonModule} from './common_module';\n export {NgClass, NgForOf, NgForOfContext, NgIf, NgIfContext, NgPlural, NgPluralCase, NgStyle, NgSwitch, NgSwitchCase, NgSwitchDefault, NgTemplateOutlet, NgComponentOutlet} from './directives/index';\n export {DOCUMENT} from './dom_tokens';\n-export {AsyncPipe, DatePipe, I18nPluralPipe, I18nSelectPipe, JsonPipe, LowerCasePipe, CurrencyPipe, DecimalPipe, PercentPipe, SlicePipe, UpperCasePipe, TitleCasePipe, KeyValuePipe, KeyValue} from './pipes/index';\n+export {AsyncPipe, DatePipe, DATE_PIPE_DEFAULT_TIMEZONE, I18nPluralPipe, I18nSelectPipe, JsonPipe, LowerCasePipe, CurrencyPipe, DecimalPipe, PercentPipe, SlicePipe, UpperCasePipe, TitleCasePipe, KeyValuePipe, KeyValue} from './pipes/index';\n export {PLATFORM_BROWSER_ID as ɵPLATFORM_BROWSER_ID, PLATFORM_SERVER_ID as ɵPLATFORM_SERVER_ID, PLATFORM_WORKER_APP_ID as ɵPLATFORM_WORKER_APP_ID, PLATFORM_WORKER_UI_ID as ɵPLATFORM_WORKER_UI_ID, isPlatformBrowser, isPlatformServer, isPlatformWorkerApp, isPlatformWorkerUi} from './platform_id';\n export {VERSION} from './version';\n export {ViewportScroller, NullViewportScroller as ɵNullViewportScroller} from './viewport_scroller';"
        },
        {
            "sha": "5c8b958239c07a5d0a934d2e2932dfc309e73a3f",
            "filename": "packages/common/src/pipes/date_pipe.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 7,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/adf4481211ac0a2eabf560f42ef5193ca550ec98/packages%2Fcommon%2Fsrc%2Fpipes%2Fdate_pipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/adf4481211ac0a2eabf560f42ef5193ca550ec98/packages%2Fcommon%2Fsrc%2Fpipes%2Fdate_pipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Fpipes%2Fdate_pipe.ts?ref=adf4481211ac0a2eabf560f42ef5193ca550ec98",
            "patch": "@@ -6,17 +6,23 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Inject, LOCALE_ID, Pipe, PipeTransform} from '@angular/core';\n+import {Inject, InjectionToken, LOCALE_ID, Optional, Pipe, PipeTransform} from '@angular/core';\n import {formatDate} from '../i18n/format_date';\n import {invalidPipeArgumentError} from './invalid_pipe_argument_error';\n \n+/**\n+ * Optionally-provided default timezone to use for all instances of `DatePipe` (such as `'+0430'`).\n+ * If the value isn't provided, the `DatePipe` will use the end-user's local system timezone.\n+ */\n+export const DATE_PIPE_DEFAULT_TIMEZONE = new InjectionToken<string>('DATE_PIPE_DEFAULT_TIMEZONE');\n+\n // clang-format off\n /**\n  * @ngModule CommonModule\n  * @description\n  *\n  * Formats a date value according to locale rules.\n- * \n+ *\n  * `DatePipe` is executed only when it detects a pure change to the input value.\n  * A pure change is either a change to a primitive input value\n  * (such as `String`, `Number`, `Boolean`, or `Symbol`),\n@@ -29,6 +35,11 @@ import {invalidPipeArgumentError} from './invalid_pipe_argument_error';\n  * in another language, you must import the corresponding locale data.\n  * See the [I18n guide](guide/i18n-common-format-data-locale) for more information.\n  *\n+ * The time zone of the formatted value can be specified either by passing it in as the second\n+ * parameter of the pipe, or by setting the default through the `DATE_PIPE_DEFAULT_TIMEZONE`\n+ * injection token. The value that is passed in as the second parameter takes precedence over\n+ * the one defined using the injection token.\n+ *\n  * @see `formatDate()`\n  *\n  *\n@@ -166,16 +177,18 @@ import {invalidPipeArgumentError} from './invalid_pipe_argument_error';\n // clang-format on\n @Pipe({name: 'date', pure: true})\n export class DatePipe implements PipeTransform {\n-  constructor(@Inject(LOCALE_ID) private locale: string) {}\n+  constructor(\n+      @Inject(LOCALE_ID) private locale: string,\n+      @Inject(DATE_PIPE_DEFAULT_TIMEZONE) @Optional() private defaultTimezone?: string|null) {}\n \n   /**\n    * @param value The date expression: a `Date` object,  a number\n    * (milliseconds since UTC epoch), or an ISO string (https://www.w3.org/TR/NOTE-datetime).\n    * @param format The date/time components to include, using predefined options or a\n    * custom format string.\n-   * @param timezone A timezone offset (such as `'+0430'`), or a standard\n-   * UTC/GMT or continental US timezone abbreviation.\n-   * When not supplied, uses the end-user's local system timezone.\n+   * @param timezone A timezone offset (such as `'+0430'`), or a standard UTC/GMT, or continental US\n+   * timezone abbreviation. When not supplied, either the value of the `DATE_PIPE_DEFAULT_TIMEZONE`\n+   * injection token is used or the end-user's local system timezone.\n    * @param locale A locale code for the locale format rules to use.\n    * When not supplied, uses the value of `LOCALE_ID`, which is `en-US` by default.\n    * See [Setting your app locale](guide/i18n-common-locale-id).\n@@ -193,7 +206,8 @@ export class DatePipe implements PipeTransform {\n     if (value == null || value === '' || value !== value) return null;\n \n     try {\n-      return formatDate(value, format, locale || this.locale, timezone);\n+      return formatDate(\n+          value, format, locale || this.locale, timezone ?? this.defaultTimezone ?? undefined);\n     } catch (error) {\n       throw invalidPipeArgumentError(DatePipe, error.message);\n     }"
        },
        {
            "sha": "54e6dedd6ccbfdf83f01f340c4f738f8ea6103f8",
            "filename": "packages/common/src/pipes/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/adf4481211ac0a2eabf560f42ef5193ca550ec98/packages%2Fcommon%2Fsrc%2Fpipes%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/adf4481211ac0a2eabf560f42ef5193ca550ec98/packages%2Fcommon%2Fsrc%2Fpipes%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Fpipes%2Findex.ts?ref=adf4481211ac0a2eabf560f42ef5193ca550ec98",
            "patch": "@@ -13,7 +13,7 @@\n  */\n import {AsyncPipe} from './async_pipe';\n import {LowerCasePipe, TitleCasePipe, UpperCasePipe} from './case_conversion_pipes';\n-import {DatePipe} from './date_pipe';\n+import {DATE_PIPE_DEFAULT_TIMEZONE, DatePipe} from './date_pipe';\n import {I18nPluralPipe} from './i18n_plural_pipe';\n import {I18nSelectPipe} from './i18n_select_pipe';\n import {JsonPipe} from './json_pipe';\n@@ -24,6 +24,7 @@ import {SlicePipe} from './slice_pipe';\n export {\n   AsyncPipe,\n   CurrencyPipe,\n+  DATE_PIPE_DEFAULT_TIMEZONE,\n   DatePipe,\n   DecimalPipe,\n   I18nPluralPipe,"
        },
        {
            "sha": "abeff0303ef2f67140cde3d331b2f4c96653871e",
            "filename": "packages/common/test/pipes/date_pipe_spec.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 2,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/adf4481211ac0a2eabf560f42ef5193ca550ec98/packages%2Fcommon%2Ftest%2Fpipes%2Fdate_pipe_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/adf4481211ac0a2eabf560f42ef5193ca550ec98/packages%2Fcommon%2Ftest%2Fpipes%2Fdate_pipe_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Ftest%2Fpipes%2Fdate_pipe_spec.ts?ref=adf4481211ac0a2eabf560f42ef5193ca550ec98",
            "patch": "@@ -14,17 +14,17 @@ import {ɵregisterLocaleData, ɵunregisterLocaleData} from '@angular/core';\n import {JitReflector} from '@angular/platform-browser-dynamic/src/compiler_reflector';\n \n {\n-  let date: Date;\n   describe('DatePipe', () => {\n     const isoStringWithoutTime = '2015-01-01';\n     let pipe: DatePipe;\n+    let date: Date;\n \n     beforeAll(() => ɵregisterLocaleData(localeEn, localeEnExtra));\n     afterAll(() => ɵunregisterLocaleData());\n \n     beforeEach(() => {\n       date = new Date(2015, 5, 15, 9, 3, 1, 550);\n-      pipe = new DatePipe('en-US');\n+      pipe = new DatePipe('en-US', null);\n     });\n \n     it('should be marked as pure', () => {\n@@ -100,6 +100,22 @@ import {JitReflector} from '@angular/platform-browser-dynamic/src/compiler_refle\n         expect(pipe.transform('2020-08-01T23:59:59.9999', 'yyyy-MM-dd, h:mm:ss SSS'))\n             .toEqual('2020-08-01, 11:59:59 999');\n       });\n+\n+      it('should take timezone into account', () => {\n+        expect(pipe.transform('2017-01-11T00:00:00', 'mediumDate', '-1200'))\n+            .toEqual('Jan 10, 2017');\n+      });\n+\n+      it('should take the default timezone into account when no timezone is passed in', () => {\n+        pipe = new DatePipe('en-US', '-1200');\n+        expect(pipe.transform('2017-01-11T00:00:00', 'mediumDate')).toEqual('Jan 10, 2017');\n+      });\n+\n+      it('should give precedence to the passed in timezone over the default one', () => {\n+        pipe = new DatePipe('en-US', '-1200');\n+        expect(pipe.transform('2017-01-11T00:00:00', 'mediumDate', '+0100'))\n+            .toEqual('Jan 11, 2017');\n+      });\n     });\n   });\n }"
        }
    ],
    "stats": {
        "total": 60,
        "additions": 47,
        "deletions": 13
    }
}