{
    "author": "AndrewKushnir",
    "message": "feat(dev-infra): add a command to verify NgBot YAML config syntax (#39071)\n\nThis commit adds a new command to the `ng-dev` suite, which verifies that the NgBot YAML config is\ncorrect. It also adds this command to the `lint` CircleCI job so that we execute this check while\nrunning CI.\n\nThis should help prevent syntax errors similar to the one introduced in:\nhttps://github.com/angular/angular/commit/393ce5574b76ad1344554a6aa9e2e8a6c3591ac9\n\nPR Close #39071",
    "sha": "4bce21358da8584db93314f83d041e6caaf8e4f1",
    "files": [
        {
            "sha": "f83c13c57586d9b09b159fbf6cb423de517e148f",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/4bce21358da8584db93314f83d041e6caaf8e4f1/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/angular/angular/raw/4bce21358da8584db93314f83d041e6caaf8e4f1/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.circleci%2Fconfig.yml?ref=4bce21358da8584db93314f83d041e6caaf8e4f1",
            "patch": "@@ -273,6 +273,7 @@ jobs:\n       - run: yarn -s ng-dev format changed $CI_GIT_BASE_REVISION --check\n       - run: yarn -s ts-circular-deps:check\n       - run: yarn -s ng-dev pullapprove verify\n+      - run: yarn -s ng-dev ngbot verify\n       - run: yarn -s ng-dev commit-message validate-range --range $CI_COMMIT_RANGE\n \n   test:"
        },
        {
            "sha": "4a421226ecec502937b5fc9b74d2e0234c1736e7",
            "filename": "dev-infra/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/4bce21358da8584db93314f83d041e6caaf8e4f1/dev-infra%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/4bce21358da8584db93314f83d041e6caaf8e4f1/dev-infra%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2FBUILD.bazel?ref=4bce21358da8584db93314f83d041e6caaf8e4f1",
            "patch": "@@ -11,6 +11,7 @@ ts_library(\n         \"//dev-infra/caretaker\",\n         \"//dev-infra/commit-message\",\n         \"//dev-infra/format\",\n+        \"//dev-infra/ngbot\",\n         \"//dev-infra/pr\",\n         \"//dev-infra/pullapprove\",\n         \"//dev-infra/release\","
        },
        {
            "sha": "c83db4117c54638be5c49ee3c61b21e0a3ce9660",
            "filename": "dev-infra/cli.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/4bce21358da8584db93314f83d041e6caaf8e4f1/dev-infra%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/4bce21358da8584db93314f83d041e6caaf8e4f1/dev-infra%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcli.ts?ref=4bce21358da8584db93314f83d041e6caaf8e4f1",
            "patch": "@@ -15,6 +15,7 @@ import {buildReleaseParser} from './release/cli';\n import {buildPrParser} from './pr/cli';\n import {captureLogOutputForCommand} from './utils/console';\n import {buildCaretakerParser} from './caretaker/cli';\n+import {buildNgbotParser} from './ngbot/cli';\n \n yargs.scriptName('ng-dev')\n     .middleware(captureLogOutputForCommand)\n@@ -27,6 +28,7 @@ yargs.scriptName('ng-dev')\n     .command('release <command>', '', buildReleaseParser)\n     .command('ts-circular-deps <command>', '', tsCircularDependenciesBuilder)\n     .command('caretaker <command>', '', buildCaretakerParser)\n+    .command('ngbot <command>', false, buildNgbotParser)\n     .wrap(120)\n     .strict()\n     .parse();"
        },
        {
            "sha": "2f472476ae2e2860f64ff0c66dbfeb262e44b2bc",
            "filename": "dev-infra/ngbot/BUILD.bazel",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/4bce21358da8584db93314f83d041e6caaf8e4f1/dev-infra%2Fngbot%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/4bce21358da8584db93314f83d041e6caaf8e4f1/dev-infra%2Fngbot%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fngbot%2FBUILD.bazel?ref=4bce21358da8584db93314f83d041e6caaf8e4f1",
            "patch": "@@ -0,0 +1,19 @@\n+load(\"@npm_bazel_typescript//:index.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"ngbot\",\n+    srcs = [\n+        \"cli.ts\",\n+        \"verify.ts\",\n+    ],\n+    module_name = \"@angular/dev-infra-private/ngbot\",\n+    visibility = [\"//dev-infra:__subpackages__\"],\n+    deps = [\n+        \"//dev-infra/utils\",\n+        \"@npm//@types/node\",\n+        \"@npm//@types/yaml\",\n+        \"@npm//@types/yargs\",\n+        \"@npm//yaml\",\n+        \"@npm//yargs\",\n+    ],\n+)"
        },
        {
            "sha": "9a881ee92eb738c3200db9b8abef754b8e9cfe93",
            "filename": "dev-infra/ngbot/cli.ts",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/4bce21358da8584db93314f83d041e6caaf8e4f1/dev-infra%2Fngbot%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/4bce21358da8584db93314f83d041e6caaf8e4f1/dev-infra%2Fngbot%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fngbot%2Fcli.ts?ref=4bce21358da8584db93314f83d041e6caaf8e4f1",
            "patch": "@@ -0,0 +1,19 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import * as yargs from 'yargs';\n+import {verify} from './verify';\n+\n+/** Build the parser for the NgBot commands. */\n+export function buildNgbotParser(localYargs: yargs.Argv) {\n+  return localYargs.help().strict().demandCommand().command(\n+      'verify', 'Verify the NgBot config', {}, () => verify());\n+}\n+\n+if (require.main === module) {\n+  buildNgbotParser(yargs).parse();\n+}"
        },
        {
            "sha": "a5c244937611efc67811862e557128d10006f6fa",
            "filename": "dev-infra/ngbot/verify.ts",
            "status": "added",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/angular/angular/blob/4bce21358da8584db93314f83d041e6caaf8e4f1/dev-infra%2Fngbot%2Fverify.ts",
            "raw_url": "https://github.com/angular/angular/raw/4bce21358da8584db93314f83d041e6caaf8e4f1/dev-infra%2Fngbot%2Fverify.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fngbot%2Fverify.ts?ref=4bce21358da8584db93314f83d041e6caaf8e4f1",
            "patch": "@@ -0,0 +1,31 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {readFileSync} from 'fs';\n+import {resolve} from 'path';\n+import {parse as parseYaml} from 'yaml';\n+\n+import {getRepoBaseDir} from '../utils/config';\n+import {error, green, info, red} from '../utils/console';\n+\n+export function verify() {\n+  /** Full path to NgBot config file */\n+  const NGBOT_CONFIG_YAML_PATH = resolve(getRepoBaseDir(), '.github/angular-robot.yml');\n+\n+  /** The NgBot config file */\n+  const ngBotYaml = readFileSync(NGBOT_CONFIG_YAML_PATH, 'utf8');\n+\n+  try {\n+    // Try parsing the config file to verify that the syntax is correct.\n+    parseYaml(ngBotYaml);\n+    info(`${green('âˆš')}  Valid NgBot YAML config`);\n+  } catch (e) {\n+    error(`${red('!')} Invalid NgBot YAML config`);\n+    error(e);\n+    process.exitCode = 1;\n+  }\n+}"
        }
    ],
    "stats": {
        "total": 73,
        "additions": 73,
        "deletions": 0
    }
}