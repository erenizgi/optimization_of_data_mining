{
    "author": "petebacondarwin",
    "message": "test(compiler-cli):  create \"full compile\" compliance test rules (#39617)\n\nThis commit contains the basic runner logic and a couple of sample test cases\nfor the \"full compile\" compliance tests, where source files are compiled\nto full definitions and checked against expectations.\n\nPR Close #39617",
    "sha": "793d66afa5ede1a91eb72bfd44848f94aec9ad35",
    "files": [
        {
            "sha": "e6328eca9c7be0c2170cbcab0e14ed259d98bd3d",
            "filename": ".ng-dev/format.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/.ng-dev%2Fformat.ts",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/.ng-dev%2Fformat.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.ng-dev%2Fformat.ts?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -18,6 +18,8 @@ export const format: FormatConfig = {\n       '!**/*.d.ts',\n       // Do not format generated ng-dev script\n       '!dev-infra/ng-dev.js',\n+      // Do not format compliance test-cases since they must match generated code\n+      '!packages/compiler-cli/test/compliance/test_cases/**/*.js',\n     ]\n   },\n   'buildifier': true"
        },
        {
            "sha": "5315510084681af90b4b61617e3d37197e1793a8",
            "filename": "packages/compiler-cli/test/compliance/README.md",
            "status": "added",
            "additions": 157,
            "deletions": 0,
            "changes": 157,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2FREADME.md?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,157 @@\n+# Compliance test-cases\n+\n+This directory contains rules, helpers and test-cases for the Angular compiler compliance tests.\n+\n+There are three different types of tests that are run based on file-based \"test-cases\".\n+\n+* **Full compile** - in this test the source files defined by the test-case are fully compiled by Angular.\n+  The generated files are compared to \"expected files\" via a matching algorithm that is tolerant to\n+  whitespace and variable name changes.\n+* **Partial compile** - in this test the source files defined by the test-case are \"partially\" compiled by\n+  Angular to produce files that can be published. These partially compiled files are compared directly\n+  against \"golden files\" to ensure that we do not inadvertently break the public API of partial\n+  declarations.\n+* **Linked** - in this test the golden files mentioned in the previous bullet point, are passed to the\n+  Angular linker, which generates files that are comparable to the fully compiled files. These linked\n+  files are compared against the \"expected files\" in the same way as in the \"full compile\" tests.\n+\n+This way the compliance tests are able to check each mode and stage of compilation is accurate and does\n+not change unexpectedly.\n+\n+\n+## Defining a test-case\n+\n+To define a test-case, create a new directory below `test_cases`. In this directory\n+\n+* add a new file called `TEST_CASES.json`. The format of this file is described below.\n+* add an empty `GOLDEN_PARTIAL.js` file. This file will be updated by the tooling later.\n+* add any `inputFiles` that will be compiled as part of the test-case.\n+* add any `expected` files that will be compared to the files generated by compiling the source files.\n+\n+\n+### TEST_CASES.json format\n+\n+The `TEST_CASES.json` defines an object with one or more test-case definitions in the `cases` property.\n+\n+Each test-case can specify:\n+\n+* A `description` of the test.\n+* The `inputFiles` that will be compiled.\n+* Additional `compilerOptions` and `angularCompilerOptions` that are passed to the compiler.\n+* A collection of `expectations` definitions that will be checked against the generated files.\n+\n+Note that there is a JSON schema for the `TEST_CASES.json` file stored at `test_cases/test_case_schema.json`.\n+You should add a link to this schema at the top of your `TEST_CASES.json` file to provide\n+validation and intellisense for this file in your IDE.\n+\n+For example:\n+\n+```json\n+{\n+  \"$schema\": \"../test_case_schema.json\",\n+  \"cases\": [\n+    {\n+      \"description\": \"description of the test - equivalent to an `it` clause message.\",\n+      \"inputFiles\": [\"abc.ts\"],\n+      \"expectations\": [\n+        {\n+          \"failureMessage\": \"message to display if this expectation fails\",\n+          \"files\": [\n+            { \"expected\": \"xyz.js\", \"generated\": \"abc.js\" }, ...\n+          ]\n+        }, ...\n+      ],\n+      \"compilerOptions\": { ... },\n+      \"angularCompilerOptions\": { ... }\n+    }\n+  ]\n+}\n+```\n+\n+### Input files\n+\n+The input files are the source file that will be compiled as part of this test-case.\n+Input files should be stored in the directory next to the `TEST_CASES.json`.\n+The paths to the input files should be listed in the `inputFiles` property of `TEST_CASES.json`.\n+The paths are relative to the `TEST_CASES.json` file.\n+\n+If no `inputFiles` property is provided, the default is `[\"test.ts\"]`.\n+\n+\n+### Expectations\n+\n+An expectation consists of a collection of expected `files` pairs, and a `failureMessage`, which\n+is displayed if the expectation check fails.\n+\n+Each file-pair consists of a path to a `generated` file (relative to the build output folder),\n+and a path to an `expected` file (relative to the test case).\n+\n+The `generated` file is checked to see if it \"matches\" the `expected` file. The matching is\n+resilient to whitespace and variable name changes.\n+\n+If no `failureMessage` property is provided, the default is `\"Incorrect generated output.\"`.\n+\n+If no `files` property is provided, the default is a a collection of objects `{expected, generated}`,\n+where `expected` and `generated` are computed by taking each path in the `inputFiles` collection\n+and replacing the `.ts` extension with `.js`.\n+\n+\n+## Running tests\n+\n+The simplest way to run all the compliance tests is:\n+\n+```sh\n+yarn test-ivy-aot //packages/compiler-cli/test/compliance/...\n+```\n+\n+If you only want to run one of the three types of test you can be more specific:\n+\n+```sh\n+yarn test-ivy-aot //packages/compiler-cli/test/compliance/full\n+yarn test-ivy-aot //packages/compiler-cli/test/compliance/linked\n+yarn test-ivy-aot //packages/compiler-cli/test/compliance/test_cases/...\n+```\n+\n+(The last command runs the partial compilation tests.)\n+\n+\n+## Updating a golden partial file\n+\n+There is one golden partial file per `TEST_CASES.json` file. So even if this file defines multiple\n+test-cases, which each contain multiple input files, there will only be one golden file.\n+\n+The golden file is generated by the tooling and should not be modified manually.\n+\n+When you first create a test-case, with an empty `PARTIAL_GOLDEN.js` file, or a change is made to\n+the generated partial output, we must update the `PARTIAL_GOLDEN.js` file.\n+\n+This is done by running a specific bazel rule of the form:\n+\n+```sh\n+bazel run //packages/compiler-cli/test/compliance/test_cases:<path/to/test_case>.golden.update\n+```\n+\n+where to replace `<path/to/test_case>` with the path (relative to `test_cases`) of the directory\n+that contains the `PARTIAL_GOLDEN.js` to update.\n+\n+\n+## Debugging test-cases\n+\n+Compliance tests are basically `jasmine_node_test` rules. As such, they can be debugged\n+just like any other `jasmine_node_test`.  The standard approach is to add `--config=debug`\n+to the Bazel test command.\n+\n+It is useful when debugging to focus on a single test-case.\n+\n+\n+### Focusing test-cases\n+\n+You can focus a test case by setting `\"focusTest\": true` in the `TEST_CASES.json` file.\n+This is equivalent to using jasmine `fit()`.\n+\n+\n+### Excluding test-cases\n+\n+You can exclude a test case by setting `\"excludeTest\": true` in the `TEST_CASES.json` file.\n+This is equivalent to using jasmine `xit()`.\n+"
        },
        {
            "sha": "a8e2fd4e5a843a615af13817260603ce9a28d7ec",
            "filename": "packages/compiler-cli/test/compliance/full/BUILD.bazel",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ffull%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ffull%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ffull%2FBUILD.bazel?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,27 @@\n+load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n+\n+ts_library(\n+    name = \"test_lib\",\n+    testonly = True,\n+    srcs = [\"full_compile_spec.ts\"],\n+    deps = [\n+        \"//packages/compiler-cli/src/ngtsc/file_system\",\n+        \"//packages/compiler-cli/test/compliance/test_helpers\",\n+    ],\n+)\n+\n+jasmine_node_test(\n+    name = \"full\",\n+    bootstrap = [\"//tools/testing:node_no_angular_es5\"],\n+    data = [\n+        \"//packages/compiler-cli/test/compliance/test_cases\",\n+        \"//packages/compiler-cli/test/ngtsc/fake_core:npm_package\",\n+    ],\n+    shard_count = 2,\n+    tags = [\n+        \"ivy-only\",\n+    ],\n+    deps = [\n+        \":test_lib\",\n+    ],\n+)"
        },
        {
            "sha": "4e50602e673422814ae02ce39b1da2dd51e833bb",
            "filename": "packages/compiler-cli/test/compliance/full/full_compile_spec.ts",
            "status": "added",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ffull%2Ffull_compile_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ffull%2Ffull_compile_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ffull%2Ffull_compile_spec.ts?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,23 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {FileSystem} from '../../../src/ngtsc/file_system';\n+import {compileTest} from '../test_helpers/compile_test';\n+import {ComplianceTest} from '../test_helpers/get_compliance_tests';\n+import {runTests} from '../test_helpers/test_runner';\n+\n+runTests('full compile', compileTests);\n+\n+/**\n+ * Fully compile all the input files in the given `test`.\n+ *\n+ * @param fs The mock file-system where the input files can be found.\n+ * @param test The compliance test whose input files should be compiled.\n+ */\n+function compileTests(fs: FileSystem, test: ComplianceTest): void {\n+  compileTest(fs, test.inputFiles, test.compilerOptions, test.angularCompilerOptions);\n+}"
        },
        {
            "sha": "c69d46110a097b2ce48b5909eb4d673fba27ab35",
            "filename": "packages/compiler-cli/test/compliance/test_cases/BUILD.bazel",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2FBUILD.bazel?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,11 @@\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\")\n+\n+package(default_visibility = [\"//packages/compiler-cli/test/compliance:__subpackages__\"])\n+\n+# Normally we would use `file_group` here but this doesn't work on Windows because there\n+# appears to be a bug with making the `runfiles` folder available.\n+# See https://github.com/bazelbuild/rules_nodejs/issues/1689\n+copy_to_bin(\n+    name = \"test_cases\",\n+    srcs = glob([\"*/**\"]),\n+)"
        },
        {
            "sha": "2f592047b23476f3c67df9fcbcb640f9612dd4e4",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/interpolations/GOLDEN_PARTIAL.js",
            "status": "added",
            "additions": 47,
            "deletions": 0,
            "changes": 47,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2FGOLDEN_PARTIAL.js?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,47 @@\n+/****************************************************************************************************\n+ * PARTIAL FILE: test.js\n+ ****************************************************************************************************/\n+import { Component, NgModule } from '@angular/core';\n+import * as i0 from \"@angular/core\";\n+export class MyApp {\n+    constructor() {\n+        this.list = [];\n+    }\n+}\n+MyApp.ɵfac = function MyApp_Factory(t) { return new (t || MyApp)(); };\n+MyApp.ɵcmp = i0.ɵɵdefineComponent({ type: MyApp, selectors: [[\"my-app\"]], decls: 1, vars: 9, template: function MyApp_Template(rf, ctx) { if (rf & 1) {\n+        i0.ɵɵtext(0);\n+    } if (rf & 2) {\n+        i0.ɵɵtextInterpolateV([\" \", ctx.list[0], \" \", ctx.list[1], \" \", ctx.list[2], \" \", ctx.list[3], \" \", ctx.list[4], \" \", ctx.list[5], \" \", ctx.list[6], \" \", ctx.list[7], \" \", ctx.list[8], \" \"]);\n+    } }, encapsulation: 2 });\n+/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyApp, [{\n+        type: Component,\n+        args: [{\n+                selector: 'my-app',\n+                template: ' {{list[0]}} {{list[1]}} {{list[2]}} {{list[3]}} {{list[4]}} {{list[5]}} {{list[6]}} {{list[7]}} {{list[8]}} '\n+            }]\n+    }], null, null); })();\n+export class MyModule {\n+}\n+MyModule.ɵmod = i0.ɵɵdefineNgModule({ type: MyModule });\n+MyModule.ɵinj = i0.ɵɵdefineInjector({ factory: function MyModule_Factory(t) { return new (t || MyModule)(); } });\n+(function () { (typeof ngJitMode === \"undefined\" || ngJitMode) && i0.ɵɵsetNgModuleScope(MyModule, { declarations: [MyApp] }); })();\n+/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyModule, [{\n+        type: NgModule,\n+        args: [{ declarations: [MyApp] }]\n+    }], null, null); })();\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: test.d.ts\n+ ****************************************************************************************************/\n+import * as i0 from \"@angular/core\";\n+export declare class MyApp {\n+    list: any[];\n+    static ɵfac: i0.ɵɵFactoryDef<MyApp, never>;\n+    static ɵcmp: i0.ɵɵComponentDefWithMeta<MyApp, \"my-app\", never, {}, {}, never, never>;\n+}\n+export declare class MyModule {\n+    static ɵmod: i0.ɵɵNgModuleDefWithMeta<MyModule, [typeof MyApp], never, never>;\n+    static ɵinj: i0.ɵɵInjectorDef<MyModule>;\n+}\n+"
        },
        {
            "sha": "a238c8f9735934af518da10bc29130cf639681d3",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/interpolations/TEST_CASES.json",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2FTEST_CASES.json",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2FTEST_CASES.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2FTEST_CASES.json?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,13 @@\n+{\n+  \"$schema\": \"../test_case_schema.json\",\n+  \"cases\": [\n+    {\n+      \"description\": \"should generate a correct call to `ɵɵtextInterpolateV()` with more than 8 interpolations\",\n+      \"expectations\": [\n+        {\n+          \"failureMessage\": \"Incorrect `ɵɵtextInterpolateV()` call\"\n+        }\n+      ]\n+    }\n+  ]\n+}"
        },
        {
            "sha": "4701aba609145967373f567d6937bfc27a65157f",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/interpolations/test.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2Ftest.js",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2Ftest.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2Ftest.js?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,11 @@\n+function MyApp_Template(rf, ctx) {\n+  if (rf & 1) {\n+    $i0$.ɵɵtext(0);\n+  }\n+  if (rf & 2) {\n+    $i0$.ɵɵtextInterpolateV([\n+      \" \", ctx.list[0], \" \", ctx.list[1], \" \", ctx.list[2], \" \", ctx.list[3], \" \", ctx.list[4], \" \",\n+      ctx.list[5], \" \", ctx.list[6], \" \", ctx.list[7], \" \", ctx.list[8], \" \"\n+    ]);\n+  }\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "8d66fbda08ea3bbefa4718f07f7ae5102e610824",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/interpolations/test.ts",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2Ftest.ts",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2Ftest.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2Ftest.ts?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,14 @@\n+import {Component, NgModule} from '@angular/core';\n+\n+@Component({\n+  selector: 'my-app',\n+  template:\n+      ' {{list[0]}} {{list[1]}} {{list[2]}} {{list[3]}} {{list[4]}} {{list[5]}} {{list[6]}} {{list[7]}} {{list[8]}} '\n+})\n+export class MyApp {\n+  list: any[] = [];\n+}\n+\n+@NgModule({declarations: [MyApp]})\n+export class MyModule {\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "e3ce74273155f30627555414a516fc5e785af99e",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_directives/directives/matching/GOLDEN_PARTIAL.js",
            "status": "added",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2FGOLDEN_PARTIAL.js?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,50 @@\n+/****************************************************************************************************\n+ * PARTIAL FILE: test.js\n+ ****************************************************************************************************/\n+import { Component, Directive, NgModule } from '@angular/core';\n+import * as i0 from \"@angular/core\";\n+export class I18nDirective {\n+}\n+I18nDirective.ɵfac = function I18nDirective_Factory(t) { return new (t || I18nDirective)(); };\n+I18nDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: 1, type: I18nDirective, selector: \"[i18n]\", ngImport: i0 });\n+/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(I18nDirective, [{\n+        type: Directive,\n+        args: [{ selector: '[i18n]' }]\n+    }], null, null); })();\n+export class MyComponent {\n+}\n+MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n+MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], decls: 1, vars: 0, template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n+        i0.ɵɵelement(0, \"div\");\n+    } }, encapsulation: 2 });\n+/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n+        type: Component,\n+        args: [{ selector: 'my-component', template: '<div i18n></div>' }]\n+    }], null, null); })();\n+export class MyModule {\n+}\n+MyModule.ɵmod = i0.ɵɵdefineNgModule({ type: MyModule });\n+MyModule.ɵinj = i0.ɵɵdefineInjector({ factory: function MyModule_Factory(t) { return new (t || MyModule)(); } });\n+(function () { (typeof ngJitMode === \"undefined\" || ngJitMode) && i0.ɵɵsetNgModuleScope(MyModule, { declarations: [I18nDirective, MyComponent] }); })();\n+/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyModule, [{\n+        type: NgModule,\n+        args: [{ declarations: [I18nDirective, MyComponent] }]\n+    }], null, null); })();\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: test.d.ts\n+ ****************************************************************************************************/\n+import * as i0 from \"@angular/core\";\n+export declare class I18nDirective {\n+    static ɵfac: i0.ɵɵFactoryDef<I18nDirective, never>;\n+    static ɵdir: i0.ɵɵDirectiveDefWithMeta<I18nDirective, \"[i18n]\", never, {}, {}, never>;\n+}\n+export declare class MyComponent {\n+    static ɵfac: i0.ɵɵFactoryDef<MyComponent, never>;\n+    static ɵcmp: i0.ɵɵComponentDefWithMeta<MyComponent, \"my-component\", never, {}, {}, never, never>;\n+}\n+export declare class MyModule {\n+    static ɵmod: i0.ɵɵNgModuleDefWithMeta<MyModule, [typeof I18nDirective, typeof MyComponent], never, never>;\n+    static ɵinj: i0.ɵɵInjectorDef<MyModule>;\n+}\n+"
        },
        {
            "sha": "a693113109799f2a3bca3eae068c888db9369880",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_directives/directives/matching/TEST_CASES.json",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2FTEST_CASES.json",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2FTEST_CASES.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2FTEST_CASES.json?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,28 @@\n+{\n+  \"$schema\": \"../../test_case_schema.json\",\n+  \"cases\": [\n+    {\n+      \"description\": \"should not match directives on i18n attribute\",\n+      \"expectations\": [\n+        {\n+          \"failureMessage\": \"Incorrect ChildComponent.ɵcmp\",\n+          \"files\": [\n+            {\n+              \"expected\": \"component.js\",\n+              \"generated\": \"test.js\"\n+            }\n+          ]\n+        },\n+        {\n+          \"failureMessage\": \"Incorrect ChildComponent.ɵfac\",\n+          \"files\": [\n+            {\n+              \"expected\": \"factory.js\",\n+              \"generated\": \"test.js\"\n+            }\n+          ]\n+        }\n+      ]\n+    }\n+  ]\n+}"
        },
        {
            "sha": "42bf7ae2fa12dcb0f26fc58495631d9dc15f30f8",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_directives/directives/matching/component.js",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2Fcomponent.js",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2Fcomponent.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2Fcomponent.js?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,12 @@\n+MyComponent.ɵcmp = $r3$.ɵɵdefineComponent({\n+  type: MyComponent,\n+  selectors: [[\"my-component\"]],\n+  decls: 1,\n+  vars: 0,\n+  template: function MyComponent_Template(rf, ctx) {\n+    if (rf & 1) {\n+      $r3$.ɵɵelement(0, \"div\");\n+    }\n+  },\n+  encapsulation: 2\n+});\n\\ No newline at end of file"
        },
        {
            "sha": "4348030bd51855dc9b51ff61865709b93e6c4aa8",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_directives/directives/matching/factory.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2Ffactory.js",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2Ffactory.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2Ffactory.js?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,3 @@\n+MyComponent.ɵfac = function MyComponent_Factory(t) {\n+  return new (t || MyComponent)();\n+};\n\\ No newline at end of file"
        },
        {
            "sha": "875b9e7c48cb8c8faa18a5bfc4baca5071600db8",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_directives/directives/matching/test.ts",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2Ftest.ts",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2Ftest.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2Ftest.ts?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,13 @@\n+import {Component, Directive, NgModule} from '@angular/core';\n+\n+@Directive({selector: '[i18n]'})\n+export class I18nDirective {\n+}\n+\n+@Component({selector: 'my-component', template: '<div i18n></div>'})\n+export class MyComponent {\n+}\n+\n+@NgModule({declarations: [I18nDirective, MyComponent]})\n+export class MyModule {\n+}"
        },
        {
            "sha": "22cfe7e17997a3092adf1ffe8fa9f2545b5eb3b5",
            "filename": "packages/compiler-cli/test/compliance/test_cases/test_case_schema.json",
            "status": "added",
            "additions": 89,
            "deletions": 0,
            "changes": 89,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Ftest_case_schema.json",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Ftest_case_schema.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Ftest_case_schema.json?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,89 @@\n+{\n+  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n+  \"$id\": \"http://angular.io/internal/compliance-test-cases.json\",\n+  \"title\": \"Compliance test cases\",\n+  \"description\": \"Describes configuration for an Angular compliance test\",\n+  \"type\": \"object\",\n+  \"properties\": {\n+    \"cases\": {\n+      \"title\": \"A collection of test cases\",\n+      \"type\": \"array\",\n+      \"items\": {\n+        \"title\": \"A test case definition\",\n+        \"type\": \"object\",\n+        \"required\": [\n+          \"description\"\n+        ],\n+        \"properties\": {\n+          \"description\": {\n+            \"title\": \"A description of the test case\",\n+            \"description\": \"This will be used as the message in an `it()` clause.\",\n+            \"type\": \"string\"\n+          },\n+          \"inputFiles\": {\n+            \"title\": \"A collection of source files to compile\",\n+            \"type\": \"array\",\n+            \"items\": {\n+              \"title\": \"Path (relative to the test case) of a source file to compile\",\n+              \"type\": \"string\"\n+            }\n+          },\n+          \"expectations\": {\n+            \"title\": \"A collection of expectations for this test case\",\n+            \"type\": \"array\",\n+            \"items\": {\n+              \"title\": \"An expectation to check for this test case\",\n+              \"type\": \"object\",\n+              \"properties\": {\n+                \"failureMessage\": {\n+                  \"title\": \"The message to display if this expectation fails\",\n+                  \"type\": \"string\",\n+                  \"default\": \"Incorrect generated output.\"\n+                },\n+                \"files\": {\n+                  \"title\": \"A collection of expected-generated file path pairs\",\n+                  \"type\": \"array\",\n+                  \"items\": {\n+                    \"title\": \"A pair of expected-generated file paths to be compared\",\n+                    \"type\": \"object\",\n+                    \"required\": [\n+                      \"expected\",\n+                      \"generated\"\n+                    ],\n+                    \"properties\": {\n+                      \"expected\": {\n+                        \"title\": \"A path (relative to the test case) where an file containing expected output can be found\",\n+                        \"type\": \"string\"\n+                      },\n+                      \"generated\": {\n+                        \"title\": \"A path (relative to the build output directory) where the compiled file can be found.\",\n+                        \"type\": \"string\"\n+                      }\n+                    }\n+                  }\n+                }\n+              }\n+            }\n+          },\n+          \"compilerOptions\": {\n+            \"title\": \"Additional options to pass to the TypeScript compiler\",\n+            \"type\": \"object\"\n+          },\n+          \"angularCompilerOptions\": {\n+            \"title\": \"Additional options to pass to the Angular compiler\",\n+            \"type\": \"object\"\n+          },\n+          \"focusTest\": {\n+            \"title\": \"Set to true to focus on this test - equivalent to jasmine's `fit()` function\",\n+            \"type\": \"boolean\"\n+          },\n+          \"excludeTest\": {\n+            \"title\": \"Set to true to exclude this test - equivalent to jasmine's `xit()` function\",\n+            \"type\": \"boolean\"\n+          }\n+        }\n+      },\n+      \"minItems\": 1\n+    }\n+  }\n+}"
        },
        {
            "sha": "bf4e4af039b48040286d6f77c51c1ea0d5d9dffc",
            "filename": "packages/compiler-cli/test/compliance/test_helpers/BUILD.bazel",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2FBUILD.bazel?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,21 @@\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"test_helpers\",\n+    testonly = True,\n+    srcs = glob(\n+        [\"**/*.ts\"],\n+    ),\n+    visibility = [\n+        \"//packages/compiler-cli/test/compliance:__subpackages__\",\n+    ],\n+    deps = [\n+        \"//packages:types\",\n+        \"//packages/compiler\",\n+        \"//packages/compiler-cli\",\n+        \"//packages/compiler-cli/src/ngtsc/file_system\",\n+        \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n+        \"//packages/compiler-cli/test/helpers\",\n+        \"@npm//typescript\",\n+    ],\n+)"
        },
        {
            "sha": "c80d194702cc47c7929dbef65b6da9c16dd3aa5d",
            "filename": "packages/compiler-cli/test/compliance/test_helpers/check_expectations.ts",
            "status": "added",
            "additions": 45,
            "deletions": 0,
            "changes": 45,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fcheck_expectations.ts",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fcheck_expectations.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fcheck_expectations.ts?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,45 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {FileSystem} from '../../../src/ngtsc/file_system';\n+import {getBuildOutputDirectory} from './compile_test';\n+import {expectEmit} from './expect_emit';\n+import {ExpectedFile} from './get_compliance_tests';\n+\n+/**\n+ * Check that each of the generated files matches the expected files.\n+ *\n+ * @param fs The mock file-system that holds the expected and generated files to compare.\n+ * @param testPath Path to the current test case (relative to the basePath).\n+ * @param failureMessage The message to display if the expectation fails.\n+ * @param expectedFiles The list of expected-generated pairs to compare.\n+ */\n+export function checkExpectations(\n+    fs: FileSystem, testPath: string, failureMessage: string, expectedFiles: ExpectedFile[]): void {\n+  const builtDirectory = getBuildOutputDirectory(fs);\n+  for (const expectedFile of expectedFiles) {\n+    const expectedPath = fs.resolve(expectedFile.expected);\n+    if (!fs.exists(expectedPath)) {\n+      throw new Error(`The expected file at ${\n+          expectedPath} does not exist. Please check the TEST_CASES.json file for this test case.`);\n+    }\n+\n+    const generatedPath = fs.resolve(builtDirectory, expectedFile.generated);\n+    if (!fs.exists(generatedPath)) {\n+      throw new Error(`The generated file at ${\n+          generatedPath} does not exist. Perhaps there is no matching input source file in the TEST_CASES.json file for this test case.`);\n+    }\n+\n+    const expected = fs.readFile(expectedPath);\n+    const generated = fs.readFile(generatedPath);\n+\n+    expectEmit(\n+        generated, expected,\n+        `When checking against expected file \"${testPath}/${expectedFile.expected}\"\\n` +\n+            failureMessage);\n+  }\n+}"
        },
        {
            "sha": "3b96d635ff517ef429ca04b13d05e94b9d28c302",
            "filename": "packages/compiler-cli/test/compliance/test_helpers/compile_test.ts",
            "status": "added",
            "additions": 112,
            "deletions": 0,
            "changes": 112,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fcompile_test.ts",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fcompile_test.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fcompile_test.ts?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,112 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import * as ts from 'typescript';\n+\n+import {AbsoluteFsPath, FileSystem, NgtscCompilerHost} from '../../../src/ngtsc/file_system';\n+import {initMockFileSystem} from '../../../src/ngtsc/file_system/testing';\n+import {performCompilation} from '../../../src/perform_compile';\n+import {CompilerOptions} from '../../../src/transformers/api';\n+import {loadStandardTestFiles, loadTestDirectory} from '../../helpers';\n+\n+import {ConfigOptions} from './get_compliance_tests';\n+\n+/**\n+ * Setup a mock file-system that is used to generate the partial files.\n+ *\n+ * @param realTestPath Absolute path (on the real file-system) to the test case being processed.\n+ * @returns a mock file-system containing the test case files.\n+ */\n+export function initMockTestFileSystem(realTestPath: AbsoluteFsPath): FileSystem {\n+  const fs = initMockFileSystem('Native');\n+  const testFiles = loadStandardTestFiles();\n+  fs.init(testFiles);\n+  loadTestDirectory(fs, realTestPath, getRootDirectory(fs));\n+  return fs;\n+}\n+\n+/**\n+ * Compile the input source `files` stored in `fs`, writing the generated files to `fs`.\n+ *\n+ * @param fs The mock file-system where the input and generated files live.\n+ * @param files An array of paths (relative to the testPath) of input files to be compiled.\n+ * @param compilerOptions Any extra options to pass to the TypeScript compiler.\n+ * @param angularCompilerOptions Any extra options to pass to the Angular compiler.\n+ * @returns A collection of paths of the generated files (absolute within the mock file-system).\n+ */\n+export function compileTest(\n+    fs: FileSystem, files: string[], compilerOptions: ConfigOptions|undefined,\n+    angularCompilerOptions: ConfigOptions|undefined): AbsoluteFsPath[] {\n+  const rootDir = getRootDirectory(fs);\n+  const outDir = getBuildOutputDirectory(fs);\n+  const options = getOptions(rootDir, outDir, compilerOptions, angularCompilerOptions);\n+  const rootNames = files.map(f => fs.resolve(f));\n+  const host = new NgtscCompilerHost(fs, options);\n+  const {diagnostics, emitResult} = performCompilation({rootNames, host, options});\n+  if (diagnostics.length > 0) {\n+    console.warn(diagnostics.map(d => d.messageText).join('\\n'));\n+  }\n+  return emitResult!.emittedFiles!.map(p => fs.resolve(rootDir, p));\n+}\n+\n+/**\n+ * Gets an absolute path (in the mock file-system) of the root directory where the compilation is to\n+ * be done.\n+ *\n+ * @param fs the mock file-system where the compilation is happening.\n+ */\n+export function getRootDirectory(fs: FileSystem): AbsoluteFsPath {\n+  return fs.resolve('/');\n+}\n+\n+/**\n+ * Gets an absolute path (in the mock file-system) of the directory where the compiled files are\n+ * stored.\n+ *\n+ * @param fs the mock file-system where the compilation is happening.\n+ */\n+export function getBuildOutputDirectory(fs: FileSystem): AbsoluteFsPath {\n+  return fs.resolve('/built');\n+}\n+\n+/**\n+ * Get the options object to pass to the compiler.\n+ *\n+ * @param rootDir The absolute path (within the mock file-system) that is the root of the\n+ *     compilation.\n+ * @param outDir The absolute path (within the mock file-system) where compiled files will be\n+ *     written.\n+ * @param compilerOptions Additional options for the TypeScript compiler.\n+ * @param angularCompilerOptions Additional options for the Angular compiler.\n+ */\n+function getOptions(\n+    rootDir: AbsoluteFsPath, outDir: AbsoluteFsPath, compilerOptions: ConfigOptions|undefined,\n+    angularCompilerOptions: ConfigOptions|undefined): CompilerOptions {\n+  return {\n+    emitDecoratorMetadata: true,\n+    experimentalDecorators: true,\n+    skipLibCheck: true,\n+    noImplicitAny: true,\n+    noEmitOnError: true,\n+    listEmittedFiles: true,\n+    strictNullChecks: true,\n+    outDir,\n+    rootDir,\n+    baseUrl: '.',\n+    allowJs: true,\n+    declaration: true,\n+    target: ts.ScriptTarget.ES2015,\n+    newLine: ts.NewLineKind.LineFeed,\n+    module: ts.ModuleKind.ES2015,\n+    moduleResolution: ts.ModuleResolutionKind.NodeJs,\n+    typeRoots: ['node_modules/@types'],\n+    ...ts.convertCompilerOptionsFromJson({compilerOptions}, rootDir).options,\n+    enableIvy: true,\n+    ivyTemplateTypeCheck: false,\n+    ...angularCompilerOptions,\n+  };\n+}"
        },
        {
            "sha": "1c41c4ecda7c842a66ad46a47b97b71a2e62e4c8",
            "filename": "packages/compiler-cli/test/compliance/test_helpers/expect_emit.ts",
            "status": "added",
            "additions": 197,
            "deletions": 0,
            "changes": 197,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fexpect_emit.ts",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fexpect_emit.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fexpect_emit.ts?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,197 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {escapeRegExp} from '@angular/compiler/src/util';\n+\n+const IDENTIFIER = /[A-Za-z_$ɵ][A-Za-z0-9_$]*/;\n+const OPERATOR =\n+    /!|\\?|%|\\*|\\/|\\^|&&?|\\|\\|?|\\(|\\)|\\{|\\}|\\[|\\]|:|;|<=?|>=?|={1,3}|!==?|=>|\\+\\+?|--?|@|,|\\.|\\.\\.\\.|`|\\\\'/;\n+const STRING = /'(\\\\'|[^'])*'|\"(\\\\\"|[^\"])*\"/;\n+const BACKTICK_STRING = /\\\\`(([\\s\\S]*?)(\\$\\{[^}]*?\\})?)*?[^\\\\]\\\\`/;\n+const BACKTICK_INTERPOLATION = /(\\$\\{[^}]*\\})/;\n+const NUMBER = /\\d+/;\n+\n+const ELLIPSIS = '…';\n+const TOKEN = new RegExp(\n+    `\\\\s*((${IDENTIFIER.source})|(${BACKTICK_STRING.source})|(${OPERATOR.source})|(${\n+        STRING.source})|${NUMBER.source}|${ELLIPSIS})\\\\s*`,\n+    'y');\n+\n+type Piece = string|RegExp;\n+\n+const SKIP = /(?:.|\\n|\\r)*/;\n+\n+const ERROR_CONTEXT_WIDTH = 30;\n+// Transform the expected output to set of tokens\n+function tokenize(text: string): Piece[] {\n+  // TOKEN.lastIndex is stateful so we cache the `lastIndex` and restore it at the end of the call.\n+  const lastIndex = TOKEN.lastIndex;\n+  TOKEN.lastIndex = 0;\n+\n+  let match: RegExpMatchArray|null;\n+  let tokenizedTextEnd = 0;\n+  const pieces: Piece[] = [];\n+\n+  while ((match = TOKEN.exec(text)) !== null) {\n+    const [fullMatch, token] = match;\n+    if (token === 'IDENT') {\n+      pieces.push(IDENTIFIER);\n+    } else if (token === ELLIPSIS) {\n+      pieces.push(SKIP);\n+    } else if (match = BACKTICK_STRING.exec(token)) {\n+      pieces.push(...tokenizeBackTickString(token));\n+    } else {\n+      pieces.push(token);\n+    }\n+    tokenizedTextEnd += fullMatch.length;\n+  }\n+\n+  if (pieces.length === 0 || tokenizedTextEnd < text.length) {\n+    // The new token that could not be found is located after the\n+    // last tokenized character.\n+    const from = tokenizedTextEnd;\n+    const to = from + ERROR_CONTEXT_WIDTH;\n+    throw Error(\n+        `Invalid test, no token found for \"${text[tokenizedTextEnd]}\" ` +\n+        `(context = '${text.substr(from, to)}...'`);\n+  }\n+  // Reset the lastIndex in case we are in a recursive `tokenize()` call.\n+  TOKEN.lastIndex = lastIndex;\n+\n+  return pieces;\n+}\n+\n+/**\n+ * Back-ticks are escaped as \"\\`\" so we must strip the backslashes.\n+ * Also the string will likely contain interpolations and if an interpolation holds an\n+ * identifier we will need to match that later. So tokenize the interpolation too!\n+ */\n+function tokenizeBackTickString(str: string): Piece[] {\n+  const pieces: Piece[] = ['`'];\n+  // Unescape backticks that are inside the backtick string\n+  // (we had to double escape them in the test string so they didn't look like string markers)\n+  str = str.replace(/\\\\\\\\\\\\`/g, '\\\\`');\n+  const backTickPieces = str.slice(2, -2).split(BACKTICK_INTERPOLATION);\n+  backTickPieces.forEach((backTickPiece) => {\n+    if (BACKTICK_INTERPOLATION.test(backTickPiece)) {\n+      // An interpolation so tokenize this expression\n+      pieces.push(...tokenize(backTickPiece));\n+    } else {\n+      // Not an interpolation so just add it as a piece\n+      pieces.push(backTickPiece);\n+    }\n+  });\n+  pieces.push('`');\n+  return pieces;\n+}\n+\n+export function expectEmit(\n+    source: string, expected: string, description: string,\n+    assertIdentifiers?: {[name: string]: RegExp}) {\n+  expected = expected\n+                 // turns `// ...` into `…`\n+                 .replace(/\\/\\/\\s*\\.\\.\\./g, ELLIPSIS)\n+                 // remove `// TODO` comment lines\n+                 .replace(/\\/\\/\\s*TODO.*?\\n/g, '')\n+                 // remove `// NOTE` comment lines\n+                 .replace(/\\/\\/\\s*NOTE.*?\\n/g, '');\n+\n+  const pieces = tokenize(expected);\n+  const {regexp, groups} = buildMatcher(pieces);\n+  const matches = source.match(regexp);\n+  if (matches === null) {\n+    let last: number = 0;\n+    for (let i = 1; i < pieces.length; i++) {\n+      const {regexp} = buildMatcher(pieces.slice(0, i));\n+      const m = source.match(regexp);\n+      const expectedPiece = pieces[i - 1] == IDENTIFIER ? '<IDENT>' : pieces[i - 1];\n+      if (!m) {\n+        // display at most `contextLength` characters of the line preceding the error location\n+        const contextLength = 50;\n+        const fullContext = source.substring(source.lastIndexOf('\\n', last) + 1, last);\n+        const context = fullContext.length > contextLength ?\n+            `...${fullContext.substr(-contextLength)}` :\n+            fullContext;\n+        throw new Error(\n+            `${description}:\\nFailed to find \"${expectedPiece}\" after \"${context}\" in:\\n'${\n+                source.substr(\n+                    0, last)}[<---HERE expected \"${expectedPiece}\"]${source.substr(last)}'`);\n+        return;\n+      } else {\n+        last = (m.index || 0) + m[0].length;\n+      }\n+    }\n+    throw new Error(\n+        `Test helper failure: Expected expression failed but the reporting logic could not find where it failed in: ${\n+            source}`);\n+  } else {\n+    if (assertIdentifiers) {\n+      // It might be possible to add the constraints in the original regexp (see `buildMatcher`)\n+      // by transforming the assertion regexps when using anchoring, grouping, back references,\n+      // flags, ...\n+      //\n+      // Checking identifiers after they have matched allows for a simple and flexible\n+      // implementation.\n+      // The overall performance are not impacted when `assertIdentifiers` is empty.\n+      const ids = Object.keys(assertIdentifiers);\n+      for (let i = 0; i < ids.length; i++) {\n+        const id = ids[i];\n+        if (groups.has(id)) {\n+          const name = matches[groups.get(id) as number];\n+          const regexp = assertIdentifiers[id];\n+          if (!regexp.test(name)) {\n+            throw Error(`${description}: The matching identifier \"${id}\" is \"${\n+                name}\" which doesn't match ${regexp}`);\n+          }\n+        }\n+      }\n+    }\n+  }\n+}\n+\n+const IDENT_LIKE = /^[a-z][A-Z]/;\n+const MATCHING_IDENT = /^\\$.*\\$$/;\n+\n+/*\n+ * Builds a regexp that matches the given `pieces`\n+ *\n+ * It returns:\n+ * - the `regexp` to be used to match the generated code,\n+ * - the `groups` which maps `$...$` identifier to their position in the regexp matches.\n+ */\n+function buildMatcher(pieces: (string|RegExp)[]): {regexp: RegExp, groups: Map<string, number>} {\n+  const results: string[] = [];\n+  let first = true;\n+  let group = 0;\n+\n+  const groups = new Map<string, number>();\n+  for (const piece of pieces) {\n+    if (!first)\n+      results.push(`\\\\s${typeof piece === 'string' && IDENT_LIKE.test(piece) ? '+' : '*'}`);\n+    first = false;\n+    if (typeof piece === 'string') {\n+      if (MATCHING_IDENT.test(piece)) {\n+        const matchGroup = groups.get(piece);\n+        if (!matchGroup) {\n+          results.push('(' + IDENTIFIER.source + ')');\n+          const newGroup = ++group;\n+          groups.set(piece, newGroup);\n+        } else {\n+          results.push(`\\\\${matchGroup}`);\n+        }\n+      } else {\n+        results.push(escapeRegExp(piece));\n+      }\n+    } else {\n+      results.push('(?:' + piece.source + ')');\n+    }\n+  }\n+  return {\n+    regexp: new RegExp(results.join('')),\n+    groups,\n+  };\n+}"
        },
        {
            "sha": "4e4710727edf9a241c09c025aa05b128510965e1",
            "filename": "packages/compiler-cli/test/compliance/test_helpers/get_compliance_tests.ts",
            "status": "added",
            "additions": 207,
            "deletions": 0,
            "changes": 207,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fget_compliance_tests.ts",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fget_compliance_tests.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fget_compliance_tests.ts?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,207 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {AbsoluteFsPath, NodeJSFileSystem, PathSegment} from '../../../src/ngtsc/file_system';\n+\n+const fs = new NodeJSFileSystem();\n+const basePath = fs.resolve(__dirname, '../test_cases');\n+\n+/**\n+ * Search the `test_cases` directory, in the real file-system, for all the compliance tests.\n+ *\n+ * Test are indicated by a `TEST_CASES.json` file which contains one or more test cases.\n+ */\n+export function* getAllComplianceTests(): Generator<ComplianceTest> {\n+  const testConfigPaths = collectPaths(basePath, segment => segment === 'TEST_CASES.json');\n+  for (const testConfigPath of testConfigPaths) {\n+    yield* getComplianceTests(testConfigPath);\n+  }\n+}\n+\n+/**\n+ * Extract all the compliance tests from the TEST_CASES.json file at the `testConfigPath`.\n+ *\n+ * @param testConfigPath The path, relative to the `test_cases` basePath, of the `TEST_CASES.json`\n+ *     config file.\n+ */\n+export function* getComplianceTests(testConfigPath: string): Generator<ComplianceTest> {\n+  const absTestConfigPath = fs.resolve(basePath, testConfigPath);\n+  const realTestPath = fs.dirname(absTestConfigPath);\n+  const testConfigJSON = JSON.parse(fs.readFile(absTestConfigPath)).cases;\n+  const testConfig = Array.isArray(testConfigJSON) ? testConfigJSON : [testConfigJSON];\n+  for (const test of testConfig) {\n+    const inputFiles = getStringArrayOrDefault(test, 'inputFiles', realTestPath, ['test.ts']);\n+    yield {\n+      relativePath: fs.relative(basePath, realTestPath),\n+      realTestPath,\n+      description: getStringOrFail(test, 'description', realTestPath),\n+      inputFiles,\n+      expectations: parseExpectations(test.expectations, realTestPath, inputFiles),\n+      compilerOptions: getConfigOptions(test, 'compilerOptions', realTestPath),\n+      angularCompilerOptions: getConfigOptions(test, 'angularCompilerOptions', realTestPath),\n+      focusTest: test.focusTest,\n+      excludeTest: test.excludeTest,\n+    };\n+  }\n+}\n+\n+/**\n+ * Search the file-system from the `current` path to find all paths that satisfy the `predicate`.\n+ */\n+function*\n+    collectPaths(current: AbsoluteFsPath, predicate: (segment: PathSegment) => boolean):\n+        Generator<AbsoluteFsPath> {\n+  if (!fs.exists(current)) {\n+    return;\n+  }\n+  for (const segment of fs.readdir(current)) {\n+    const absPath = fs.resolve(current, segment);\n+    if (predicate(segment)) {\n+      yield absPath;\n+    } else {\n+      if (fs.lstat(absPath).isDirectory()) {\n+        yield* collectPaths(absPath, predicate);\n+      }\n+    }\n+  }\n+}\n+\n+function getStringOrFail(container: any, property: string, testPath: AbsoluteFsPath): string {\n+  const value = container[property];\n+  if (typeof value !== 'string') {\n+    throw new Error(`Test is missing \"${property}\" property in TEST_CASES.json: ` + testPath);\n+  }\n+  return value;\n+}\n+\n+function getStringArrayOrDefault(\n+    container: any, property: string, testPath: AbsoluteFsPath, defaultValue: string[]): string[] {\n+  const value = container[property];\n+  if (typeof value === 'undefined') {\n+    return defaultValue;\n+  }\n+  if (!Array.isArray(value) || !value.every(item => typeof item === 'string')) {\n+    throw new Error(\n+        `Test has invalid \"${property}\" property in TEST_CASES.json - expected array of strings: ` +\n+        testPath);\n+  }\n+  return value;\n+}\n+\n+function parseExpectations(\n+    value: any, testPath: AbsoluteFsPath, inputFiles: string[]): Expectation[] {\n+  const defaultFailureMessage = 'Incorrect generated output.';\n+  const tsFiles = inputFiles.filter(f => /[^.][^d]\\.ts$/.test(f));\n+  const defaultFiles = tsFiles.map(inputFile => {\n+    const outputFile = inputFile.replace(/\\.ts$/, '.js');\n+    return {expected: outputFile, generated: outputFile};\n+  });\n+\n+  if (typeof value === 'undefined') {\n+    return [{failureMessage: defaultFailureMessage, files: defaultFiles}];\n+  }\n+\n+  if (!Array.isArray(value)) {\n+    return parseExpectations([value], testPath, inputFiles);\n+  }\n+\n+  return value.map((expectation, i) => {\n+    if (typeof expectation !== 'object') {\n+      throw new Error(\n+          `Test has invalid \"expectations\" property in TEST_CASES.json - expected array of \"expectation\" objects: ${\n+              testPath}`);\n+    }\n+\n+    const failureMessage = expectation.failureMessage ?? defaultFailureMessage;\n+\n+    if (typeof expectation.files === 'undefined') {\n+      return {failureMessage, files: defaultFiles};\n+    }\n+\n+    if (!Array.isArray(expectation.files)) {\n+      throw new Error(`Test has invalid \"expectations[${\n+          i}].files\" property in TEST_CASES.json - expected array of \"expected files\": ${\n+          testPath}`);\n+    }\n+    const files = expectation.files.map((file: any) => {\n+      if (typeof file === 'string') {\n+        return {expected: file, generated: file};\n+      }\n+      if (typeof file === 'object' && typeof file.expected === 'string' &&\n+          typeof file.generated === 'string') {\n+        return file;\n+      }\n+      throw new Error(`Test has invalid \"expectations[${\n+          i}].files\" property in TEST_CASES.json - expected each item to be a string or an \"expected file\" object: ${\n+          testPath}`);\n+    });\n+\n+    return {failureMessage, files};\n+  });\n+}\n+\n+function getConfigOptions(\n+    container: any, property: string, testPath: AbsoluteFsPath): ConfigOptions|undefined {\n+  const options = container[property];\n+  if (options !== undefined && typeof options !== 'object') {\n+    throw new Error(\n+        `Test have invalid \"${\n+            property}\" property in TEST_CASES.json - expected config option object: ` +\n+        testPath);\n+  }\n+  return options;\n+}\n+\n+/**\n+ * Describes a compliance test, as defined in a `TEST_CASES.json` file.\n+ */\n+export interface ComplianceTest {\n+  /** The path, relative to the test_cases directory, of the directory containing this test. */\n+  relativePath: string;\n+  /** The absolute path (on the real file-system) to the test case containing this test. */\n+  realTestPath: AbsoluteFsPath;\n+  /** A description of this particular test. */\n+  description: string;\n+  /**\n+   * Any additional options to pass to the TypeScript compiler when compiling this test's source\n+   * files. These are equivalent to what you would put in `tsconfig.json`.\n+   */\n+  compilerOptions?: ConfigOptions;\n+  /**\n+   * Any additional options to pass to the Angular compiler when compiling this test's source\n+   * files. These are equivalent to what you would put in `tsconfig.json`.\n+   */\n+  angularCompilerOptions?: ConfigOptions;\n+  /** A list of paths to source files that should be compiled for this test case. */\n+  inputFiles: string[];\n+  /** A list of expectations to check for this test case. */\n+  expectations: Expectation[];\n+  /** If set to `true`, then focus on this test (equivalent to jasmine's 'fit()`). */\n+  focusTest?: boolean;\n+  /** If set to `true`, then exclude this test (equivalent to jasmine's 'xit()`). */\n+  excludeTest?: boolean;\n+}\n+\n+export interface Expectation {\n+  /** The message to display if this expectation fails. */\n+  failureMessage: string;\n+  /** A list of pairs of paths to expected and generated files to compare. */\n+  files: ExpectedFile[];\n+}\n+\n+/**\n+ * A pair of paths to expected and generated files that should be compared in an `Expectation`.\n+ */\n+export interface ExpectedFile {\n+  expected: string;\n+  generated: string;\n+}\n+\n+/**\n+ * Options to pass to configure the compiler.\n+ */\n+export type ConfigOptions = Record<string, string|boolean|null>;"
        },
        {
            "sha": "b02abe37975b5eb5136bb8aa5a82101da43e3dc6",
            "filename": "packages/compiler-cli/test/compliance/test_helpers/test_runner.ts",
            "status": "added",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Ftest_runner.ts",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Ftest_runner.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Ftest_runner.ts?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -0,0 +1,34 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {FileSystem} from '../../../src/ngtsc/file_system';\n+import {checkExpectations} from '../test_helpers/check_expectations';\n+import {initMockTestFileSystem} from '../test_helpers/compile_test';\n+import {ComplianceTest, getAllComplianceTests} from '../test_helpers/get_compliance_tests';\n+\n+/**\n+ * Set up jasmine specs for each of the compliance tests.\n+ *\n+ * @param type A description of the type of tests being run.\n+ * @param compileFn The function that will do the compilation of the source files\n+ */\n+export function runTests(type: string, compileFn: (fs: FileSystem, test: ComplianceTest) => void) {\n+  describe(`compliance tests (${type})`, () => {\n+    for (const test of getAllComplianceTests()) {\n+      describe(`[${test.relativePath}]`, () => {\n+        const itFn = test.focusTest ? fit : test.excludeTest ? xit : it;\n+        itFn(test.description, () => {\n+          const fs = initMockTestFileSystem(test.realTestPath);\n+          compileFn(fs, test);\n+          for (const expectation of test.expectations) {\n+            checkExpectations(fs, test.relativePath, expectation.failureMessage, expectation.files);\n+          }\n+        });\n+      });\n+    }\n+  });\n+}"
        },
        {
            "sha": "d7a30f3370591167fd8a8ecbcaf4508efd18890b",
            "filename": "tslint.json",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/793d66afa5ede1a91eb72bfd44848f94aec9ad35/tslint.json",
            "raw_url": "https://github.com/angular/angular/raw/793d66afa5ede1a91eb72bfd44848f94aec9ad35/tslint.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tslint.json?ref=793d66afa5ede1a91eb72bfd44848f94aec9ad35",
            "patch": "@@ -92,6 +92,7 @@\n       // Ignore special files\n       \"**/*.externs.js\",\n       // Ignore test files\n+      \"./packages/compiler-cli/test/compliance/test_cases/**/*\",\n       \"./packages/localize/**/test_files/**/*\",\n       \"./tools/ts-api-guardian/test/fixtures/**/*\",\n       \"./tools/public_api_guard/**/*.d.ts\","
        }
    ],
    "stats": {
        "total": 1117,
        "additions": 1117,
        "deletions": 0
    }
}