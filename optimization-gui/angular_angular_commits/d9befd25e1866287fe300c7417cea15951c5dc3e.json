{
    "author": "JoostK",
    "message": "refactor(compiler): make `keySpan` required in binding parser (#44411)\n\nNow that ViewEngine has been removed the `keySpan` property can be\nmade required, as it is always provided in the Ivy compiler\n\nPR Close #44411",
    "sha": "d9befd25e1866287fe300c7417cea15951c5dc3e",
    "files": [
        {
            "sha": "4e04eb5ef3d3e3517815898d0d5ed1b5d4503d68",
            "filename": "packages/compiler/src/expression_parser/ast.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/d9befd25e1866287fe300c7417cea15951c5dc3e/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fast.ts",
            "raw_url": "https://github.com/angular/angular/raw/d9befd25e1866287fe300c7417cea15951c5dc3e/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fast.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fast.ts?ref=d9befd25e1866287fe300c7417cea15951c5dc3e",
            "patch": "@@ -838,9 +838,7 @@ export class ParsedProperty {\n \n   constructor(\n       public name: string, public expression: ASTWithSource, public type: ParsedPropertyType,\n-      // TODO(FW-2095): `keySpan` should really be required but allows `undefined` so VE does\n-      // not need to be updated. Make `keySpan` required when VE is removed.\n-      public sourceSpan: ParseSourceSpan, readonly keySpan: ParseSourceSpan|undefined,\n+      public sourceSpan: ParseSourceSpan, readonly keySpan: ParseSourceSpan,\n       public valueSpan: ParseSourceSpan|undefined) {\n     this.isLiteral = this.type === ParsedPropertyType.LITERAL_ATTR;\n     this.isAnimation = this.type === ParsedPropertyType.ANIMATION;\n@@ -866,8 +864,7 @@ export class ParsedEvent {\n   constructor(\n       public name: string, public targetOrPhase: string, public type: ParsedEventType,\n       public handler: ASTWithSource, public sourceSpan: ParseSourceSpan,\n-      // TODO(FW-2095): keySpan should be required but was made optional to avoid changing VE\n-      public handlerSpan: ParseSourceSpan, readonly keySpan: ParseSourceSpan|undefined) {}\n+      public handlerSpan: ParseSourceSpan, readonly keySpan: ParseSourceSpan) {}\n }\n \n /**"
        },
        {
            "sha": "956e08e5a8a56b322b4a10514d9cac7f33ac1f36",
            "filename": "packages/compiler/src/template_parser/binding_parser.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 16,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/d9befd25e1866287fe300c7417cea15951c5dc3e/packages%2Fcompiler%2Fsrc%2Ftemplate_parser%2Fbinding_parser.ts",
            "raw_url": "https://github.com/angular/angular/raw/d9befd25e1866287fe300c7417cea15951c5dc3e/packages%2Fcompiler%2Fsrc%2Ftemplate_parser%2Fbinding_parser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Ftemplate_parser%2Fbinding_parser.ts?ref=d9befd25e1866287fe300c7417cea15951c5dc3e",
            "patch": "@@ -217,9 +217,7 @@ export class BindingParser {\n   parseLiteralAttr(\n       name: string, value: string|null, sourceSpan: ParseSourceSpan, absoluteOffset: number,\n       valueSpan: ParseSourceSpan|undefined, targetMatchableAttrs: string[][],\n-      // TODO(atscott): keySpan is only optional here so VE template parser implementation does not\n-      // have to change This should be required when VE is removed.\n-      targetProps: ParsedProperty[], keySpan?: ParseSourceSpan) {\n+      targetProps: ParsedProperty[], keySpan: ParseSourceSpan) {\n     if (isAnimationLabel(name)) {\n       name = name.substring(1);\n       if (keySpan !== undefined) {\n@@ -245,9 +243,7 @@ export class BindingParser {\n   parsePropertyBinding(\n       name: string, expression: string, isHost: boolean, sourceSpan: ParseSourceSpan,\n       absoluteOffset: number, valueSpan: ParseSourceSpan|undefined,\n-      // TODO(atscott): keySpan is only optional here so VE template parser implementation does not\n-      // have to change This should be required when VE is removed.\n-      targetMatchableAttrs: string[][], targetProps: ParsedProperty[], keySpan?: ParseSourceSpan) {\n+      targetMatchableAttrs: string[][], targetProps: ParsedProperty[], keySpan: ParseSourceSpan) {\n     if (name.length === 0) {\n       this._reportError(`Property name is missing in binding`, sourceSpan);\n     }\n@@ -285,9 +281,7 @@ export class BindingParser {\n   parsePropertyInterpolation(\n       name: string, value: string, sourceSpan: ParseSourceSpan,\n       valueSpan: ParseSourceSpan|undefined, targetMatchableAttrs: string[][],\n-      // TODO(atscott): keySpan is only optional here so VE template parser implementation does not\n-      // have to change This should be required when VE is removed.\n-      targetProps: ParsedProperty[], keySpan?: ParseSourceSpan): boolean {\n+      targetProps: ParsedProperty[], keySpan: ParseSourceSpan): boolean {\n     const expr = this.parseInterpolation(value, valueSpan || sourceSpan);\n     if (expr) {\n       this._parsePropertyAst(\n@@ -298,17 +292,17 @@ export class BindingParser {\n   }\n \n   private _parsePropertyAst(\n-      name: string, ast: ASTWithSource, sourceSpan: ParseSourceSpan,\n-      keySpan: ParseSourceSpan|undefined, valueSpan: ParseSourceSpan|undefined,\n-      targetMatchableAttrs: string[][], targetProps: ParsedProperty[]) {\n+      name: string, ast: ASTWithSource, sourceSpan: ParseSourceSpan, keySpan: ParseSourceSpan,\n+      valueSpan: ParseSourceSpan|undefined, targetMatchableAttrs: string[][],\n+      targetProps: ParsedProperty[]) {\n     targetMatchableAttrs.push([name, ast.source!]);\n     targetProps.push(\n         new ParsedProperty(name, ast, ParsedPropertyType.DEFAULT, sourceSpan, keySpan, valueSpan));\n   }\n \n   private _parseAnimation(\n       name: string, expression: string|null, sourceSpan: ParseSourceSpan, absoluteOffset: number,\n-      keySpan: ParseSourceSpan|undefined, valueSpan: ParseSourceSpan|undefined,\n+      keySpan: ParseSourceSpan, valueSpan: ParseSourceSpan|undefined,\n       targetMatchableAttrs: string[][], targetProps: ParsedProperty[]) {\n     if (name.length === 0) {\n       this._reportError('Animation trigger is missing', sourceSpan);\n@@ -408,7 +402,7 @@ export class BindingParser {\n   // TODO: keySpan should be required but was made optional to avoid changing VE parser.\n   parseEvent(\n       name: string, expression: string, sourceSpan: ParseSourceSpan, handlerSpan: ParseSourceSpan,\n-      targetMatchableAttrs: string[][], targetEvents: ParsedEvent[], keySpan?: ParseSourceSpan) {\n+      targetMatchableAttrs: string[][], targetEvents: ParsedEvent[], keySpan: ParseSourceSpan) {\n     if (name.length === 0) {\n       this._reportError(`Event name is missing in binding`, sourceSpan);\n     }\n@@ -434,7 +428,7 @@ export class BindingParser {\n \n   private _parseAnimationEvent(\n       name: string, expression: string, sourceSpan: ParseSourceSpan, handlerSpan: ParseSourceSpan,\n-      targetEvents: ParsedEvent[], keySpan?: ParseSourceSpan) {\n+      targetEvents: ParsedEvent[], keySpan: ParseSourceSpan) {\n     const matches = splitAtPeriod(name, [name, '']);\n     const eventName = matches[0];\n     const phase = matches[1].toLowerCase();\n@@ -462,7 +456,7 @@ export class BindingParser {\n \n   private _parseRegularEvent(\n       name: string, expression: string, sourceSpan: ParseSourceSpan, handlerSpan: ParseSourceSpan,\n-      targetMatchableAttrs: string[][], targetEvents: ParsedEvent[], keySpan?: ParseSourceSpan) {\n+      targetMatchableAttrs: string[][], targetEvents: ParsedEvent[], keySpan: ParseSourceSpan) {\n     // long format: 'target: eventName'\n     const [target, eventName] = splitAtColon(name, [null!, name]);\n     const ast = this._parseAction(expression, handlerSpan);"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 12,
        "deletions": 21
    }
}