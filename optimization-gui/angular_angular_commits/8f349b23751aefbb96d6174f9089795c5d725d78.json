{
    "author": "unknown",
    "message": "fix(compiler): source span for microsyntax text att should be key span (#38766)\n\nIn a microsyntax expressions, some attributes are not bound after\ndesugaring. For example,\n```html\n<div *ngFor=\"let item of items\">\n</div>\n```\ngets desugared to\n```html\n<ng-template ngFor let-items [ngForOf]=\"items\">\n</ngtemplate>\n```\nIn this case, `ngFor` should be a literal attribute with no RHS value.\nTherefore, its source span should be just the `keySpan` and not the\nsource span of the original template node.\nThis allows language service to precisely pinpoint different spans in a\nmicrosyntax to provide accurate information.\n\nPR Close #38766",
    "sha": "8f349b23751aefbb96d6174f9089795c5d725d78",
    "files": [
        {
            "sha": "ca0001f44ec87076742aa50180c66c999368c1c0",
            "filename": "packages/compiler/src/template_parser/binding_parser.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/8f349b23751aefbb96d6174f9089795c5d725d78/packages%2Fcompiler%2Fsrc%2Ftemplate_parser%2Fbinding_parser.ts",
            "raw_url": "https://github.com/angular/angular/raw/8f349b23751aefbb96d6174f9089795c5d725d78/packages%2Fcompiler%2Fsrc%2Ftemplate_parser%2Fbinding_parser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Ftemplate_parser%2Fbinding_parser.ts?ref=8f349b23751aefbb96d6174f9089795c5d725d78",
            "patch": "@@ -157,10 +157,12 @@ export class BindingParser {\n         this._parsePropertyAst(\n             key, binding.value, sourceSpan, valueSpan, targetMatchableAttrs, targetProps);\n       } else {\n-        targetMatchableAttrs.push([key, '']);\n+        targetMatchableAttrs.push([key, '' /* value */]);\n+        // Since this is a literal attribute with no RHS, source span should be\n+        // just the key span.\n         this.parseLiteralAttr(\n-            key, null, sourceSpan, absoluteValueOffset, undefined, targetMatchableAttrs,\n-            targetProps);\n+            key, null /* value */, keySpan, absoluteValueOffset, undefined /* valueSpan */,\n+            targetMatchableAttrs, targetProps);\n       }\n     }\n   }"
        },
        {
            "sha": "791b36021fd5fce07b71a9f081500864bd236727",
            "filename": "packages/compiler/test/render3/r3_ast_spans_spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/8f349b23751aefbb96d6174f9089795c5d725d78/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_ast_spans_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8f349b23751aefbb96d6174f9089795c5d725d78/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_ast_spans_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_ast_spans_spec.ts?ref=8f349b23751aefbb96d6174f9089795c5d725d78",
            "patch": "@@ -174,7 +174,7 @@ describe('R3 AST source spans', () => {\n     it('is correct for * directives', () => {\n       expectFromHtml('<div *ngIf></div>').toEqual([\n         ['Template', '0:17', '0:11', '11:17'],\n-        ['TextAttribute', '5:10', '<empty>'],\n+        ['TextAttribute', '6:10', '<empty>'],  // ngIf\n         ['Element', '0:17', '0:11', '11:17'],\n       ]);\n     });\n@@ -237,9 +237,9 @@ describe('R3 AST source spans', () => {\n       // </ng-template>\n       expectFromHtml('<div *ngFor=\"let item of items\"></div>').toEqual([\n         ['Template', '0:38', '0:32', '32:38'],\n-        ['TextAttribute', '5:31', '<empty>'],\n-        ['BoundAttribute', '5:31', '25:30'],  // *ngFor=\"let item of items\" -> items\n-        ['Variable', '13:22', '<empty>'],     // let item\n+        ['TextAttribute', '6:11', '<empty>'],  // ngFor\n+        ['BoundAttribute', '5:31', '25:30'],   // *ngFor=\"let item of items\" -> items\n+        ['Variable', '13:22', '<empty>'],      // let item\n         ['Element', '0:38', '0:32', '32:38'],\n       ]);\n \n@@ -260,8 +260,8 @@ describe('R3 AST source spans', () => {\n     it('is correct for variables via let ...', () => {\n       expectFromHtml('<div *ngIf=\"let a=b\"></div>').toEqual([\n         ['Template', '0:27', '0:21', '21:27'],\n-        ['TextAttribute', '5:20', '<empty>'],\n-        ['Variable', '12:19', '18:19'],  // let a=b -> b\n+        ['TextAttribute', '6:10', '<empty>'],  // ngIf\n+        ['Variable', '12:19', '18:19'],        // let a=b -> b\n         ['Element', '0:27', '0:21', '21:27'],\n       ]);\n     });"
        },
        {
            "sha": "8a9d06fc6efcc6b386bf46a62d5f3b11cdf56291",
            "filename": "packages/language-service/ivy/test/hybrid_visitor_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/8f349b23751aefbb96d6174f9089795c5d725d78/packages%2Flanguage-service%2Fivy%2Ftest%2Fhybrid_visitor_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8f349b23751aefbb96d6174f9089795c5d725d78/packages%2Flanguage-service%2Fivy%2Ftest%2Fhybrid_visitor_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fhybrid_visitor_spec.ts?ref=8f349b23751aefbb96d6174f9089795c5d725d78",
            "patch": "@@ -487,8 +487,9 @@ describe('findNodeAtPosition for microsyntax expression', () => {\n     // <ng-template ngFor let-item [ngForOf]=\"items\">\n     expect(errors).toBe(null);\n     const node = findNodeAtPosition(nodes, position);\n-    // TODO: this is currently wrong because it should point to ngFor text\n-    // attribute instead of ngForOf bound attribute\n+    expect(isTemplateNode(node!)).toBeTrue();\n+    expect(node).toBeInstanceOf(t.TextAttribute);\n+    expect((node as t.TextAttribute).name).toBe('ngFor');\n   });\n \n   it('should locate not let keyword', () => {"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 14,
        "deletions": 11
    }
}