{
    "author": "petebacondarwin",
    "message": "refactor(compiler-cli): make ngcc configuration hash algorithm configurable! (#42582)\n\nThe ngcc configuration gets hashed to be used when caching\nbut it was hardcoded to use the `md5` algorithm, which is\nnot FIPS compliant.\n\nNow the hash algorithm can be configured in the ngcc.config.js\nfile at the project level.\n\nPR Close #42582",
    "sha": "a3b6d65580b90c2ef68281f54fec0934869c1e4b",
    "files": [
        {
            "sha": "1c1ef82b5e245f55a3ecf1caafdeccbf5c284cd4",
            "filename": "packages/compiler-cli/ngcc/src/packages/configuration.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 2,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/a3b6d65580b90c2ef68281f54fec0934869c1e4b/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fconfiguration.ts",
            "raw_url": "https://github.com/angular/angular/raw/a3b6d65580b90c2ef68281f54fec0934869c1e4b/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fconfiguration.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fconfiguration.ts?ref=a3b6d65580b90c2ef68281f54fec0934869c1e4b",
            "patch": "@@ -25,6 +25,12 @@ export interface NgccProjectConfig<T = RawNgccPackageConfig> {\n    * Options that control how locking the process is handled.\n    */\n   locking?: ProcessLockingConfiguration;\n+  /**\n+   * Name of hash algorithm used to generate hashes of the configuration.\n+   *\n+   * Defaults to `md5`.\n+   */\n+  hashAlgorithm?: string;\n }\n \n /**\n@@ -299,7 +305,8 @@ export class NgccConfiguration {\n   }\n \n   private processProjectConfig(projectConfig: NgccProjectConfig): PartiallyProcessedConfig {\n-    const processedConfig: PartiallyProcessedConfig = {packages: {}, locking: {}};\n+    const processedConfig:\n+        PartiallyProcessedConfig = {packages: {}, locking: {}, hashAlgorithm: 'md5'};\n \n     // locking configuration\n     if (projectConfig.locking !== undefined) {\n@@ -317,6 +324,11 @@ export class NgccConfiguration {\n       }\n     }\n \n+    // hash algorithm config\n+    if (projectConfig.hashAlgorithm !== undefined) {\n+      processedConfig.hashAlgorithm = projectConfig.hashAlgorithm;\n+    }\n+\n     return processedConfig;\n   }\n \n@@ -378,7 +390,9 @@ export class NgccConfiguration {\n   }\n \n   private computeHash(): string {\n-    return createHash('md5').update(JSON.stringify(this.projectConfig)).digest('hex');\n+    return createHash(this.projectConfig.hashAlgorithm)\n+        .update(JSON.stringify(this.projectConfig))\n+        .digest('hex');\n   }\n }\n "
        },
        {
            "sha": "93e57cec3ffd62c1128b20746e5d1cbf45976fb6",
            "filename": "packages/compiler-cli/ngcc/test/packages/configuration_spec.ts",
            "status": "modified",
            "additions": 25,
            "deletions": 3,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/a3b6d65580b90c2ef68281f54fec0934869c1e4b/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fconfiguration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/a3b6d65580b90c2ef68281f54fec0934869c1e4b/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fconfiguration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fconfiguration_spec.ts?ref=a3b6d65580b90c2ef68281f54fec0934869c1e4b",
            "patch": "@@ -48,7 +48,7 @@ runInEachFileSystem(() => {\n         }]);\n         const project1Conf = new NgccConfiguration(fs, project1);\n         const expectedProject1Config =\n-            `{\"packages\":{\"package-1\":[{\"entryPoints\":{\"./entry-point-1\":{}},\"versionRange\":\"*\"}]},\"locking\":{}}`;\n+            `{\"packages\":{\"package-1\":[{\"entryPoints\":{\"./entry-point-1\":{}},\"versionRange\":\"*\"}]},\"locking\":{},\"hashAlgorithm\":\"md5\"}`;\n         expect(project1Conf.hash)\n             .toEqual(createHash('md5').update(expectedProject1Config).digest('hex'));\n \n@@ -66,7 +66,7 @@ runInEachFileSystem(() => {\n         }]);\n         const project2Conf = new NgccConfiguration(fs, project2);\n         const expectedProject2Config =\n-            `{\"packages\":{\"package-1\":[{\"entryPoints\":{\"./entry-point-1\":{\"ignore\":true}},\"versionRange\":\"*\"}]},\"locking\":{}}`;\n+            `{\"packages\":{\"package-1\":[{\"entryPoints\":{\"./entry-point-1\":{\"ignore\":true}},\"versionRange\":\"*\"}]},\"locking\":{},\"hashAlgorithm\":\"md5\"}`;\n         expect(project2Conf.hash)\n             .toEqual(createHash('md5').update(expectedProject2Config).digest('hex'));\n       });\n@@ -76,9 +76,31 @@ runInEachFileSystem(() => {\n         const configuration = new NgccConfiguration(fs, _Abs('/project-1'));\n         expect(configuration.hash)\n             .toEqual(createHash('md5')\n-                         .update(JSON.stringify({packages: {}, locking: {}}))\n+                         .update(JSON.stringify({packages: {}, locking: {}, hashAlgorithm: 'md5'}))\n                          .digest('hex'));\n       });\n+\n+      it('should use a custom hash algorithm if specified in the config', () => {\n+        const project1 = _Abs('/project-1');\n+        const project1Config = fs.resolve(project1, 'ngcc.config.js');\n+\n+        loadTestFiles([{\n+          name: project1Config,\n+          contents: `\n+            module.exports = {\n+              packages: {\n+                'package-1': {entryPoints: {'./entry-point-1': {}}},\n+              },\n+              hashAlgorithm: 'sha256',\n+            };`\n+        }]);\n+        const project1Conf = new NgccConfiguration(fs, project1);\n+        const expectedProject1Config =\n+            `{\"packages\":{\"package-1\":[{\"entryPoints\":{\"./entry-point-1\":{}},\"versionRange\":\"*\"}]},\"locking\":{},\"hashAlgorithm\":\"sha256\"}`;\n+        expect(JSON.stringify((project1Conf as any).projectConfig)).toEqual(expectedProject1Config);\n+        expect(project1Conf.hash)\n+            .toEqual(createHash('sha256').update(expectedProject1Config).digest('hex'));\n+      });\n     });\n \n     describe('getPackageConfig()', () => {"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 41,
        "deletions": 5
    }
}