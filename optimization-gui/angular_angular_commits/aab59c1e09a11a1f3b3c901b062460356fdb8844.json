{
    "author": "AleksanderBodurri",
    "message": "refactor(devtools): dedupe some bazel tooling brought in from angular/components\n\nSome tooling was brought in from angular/components to help with bundling spec files for Karma. This tooling has since been ported over to the dev-infra repo. This commit dedupes the tooling and instead depends on the angular/dev-infra-private repo.",
    "sha": "aab59c1e09a11a1f3b3c901b062460356fdb8844",
    "files": [
        {
            "sha": "09a40ac53ea2d8ca7ac94260412950a35afb0b5a",
            "filename": "devtools/.bazelrc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2F.bazelrc",
            "raw_url": "https://github.com/angular/angular/raw/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2F.bazelrc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2F.bazelrc?ref=aab59c1e09a11a1f3b3c901b062460356fdb8844",
            "patch": "@@ -22,4 +22,6 @@ build:remote --google_default_credentials\n \n build --config=remote\n \n-import ../.bazelrc\n\\ No newline at end of file\n+import ../.bazelrc\n+\n+build --flag_alias=partial_compilation=@npm//@angular/bazel/src:partial_compilation"
        },
        {
            "sha": "1ded1830dd46594bc48bd150eb6357181cd7cc76",
            "filename": "devtools/package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Fpackage.json?ref=aab59c1e09a11a1f3b3c901b062460356fdb8844",
            "patch": "@@ -61,7 +61,7 @@\n     \"@angular/bazel\": \"13.0.1\",\n     \"@angular/cli\": \"github:angular/cli-builds#858ee211470523d39a9ff16b57b676be740f77cc\",\n     \"@angular/compiler-cli\": \"github:angular/compiler-cli-builds#89c6b3464f3f46a9f46334825bbff3d784af4136\",\n-    \"@angular/dev-infra-private\": \"https://github.com/angular/dev-infra-private-builds.git#2cfe4b98a157927b319a3a00b467ff6233dc3337\",\n+    \"@angular/dev-infra-private\": \"https://github.com/angular/dev-infra-private-builds.git#c55a3937d45945489714273bfbbe9b803ceff89e\",\n     \"@angular/elements\": \"github:angular/elements-builds#55c36f9d5381ffc06649a03bff3c2934b18ddd02\",\n     \"@angular/language-service\": \"github:angular/language-service-builds#e16ca91c029934dde01557efcf860e2465629655\",\n     \"@angular/localize\": \"13.0.1\","
        },
        {
            "sha": "2252032a08d3383f8d39953c3a97a3065777547d",
            "filename": "devtools/tools/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 27,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Ftools%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Ftools%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2FBUILD.bazel?ref=aab59c1e09a11a1f3b3c901b062460356fdb8844",
            "patch": "@@ -1,30 +1,3 @@\n-load(\"@bazel_skylib//rules:common_settings.bzl\", \"bool_flag\")\n-\n exports_files([\n     \"karma.conf.js\",\n ])\n-\n-# Dupe from angular/components\n-#\n-# todo(aleksanderbodurri): Remove this when when spec-bundling bazel logic is moved to\n-# dev-infra repo\n-\n-config_setting(\n-    name = \"partial_compilation_enabled\",\n-    flag_values = {\n-        \"@npm//@angular/bazel/src:partial_compilation\": \"True\",\n-    },\n-)\n-\n-bool_flag(\n-    name = \"force_partial_jit_compilation\",\n-    build_setting_default = False,\n-)\n-\n-config_setting(\n-    name = \"force_partial_jit_compilation_enabled\",\n-    flag_values = {\n-        \"@npm//@angular/bazel/src:partial_compilation\": \"True\",\n-        \":force_partial_jit_compilation\": \"True\",\n-    },\n-)"
        },
        {
            "sha": "51511e256eb2869e7ef395fd8444aafeb4bc4869",
            "filename": "devtools/tools/angular/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 12,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Ftools%2Fangular%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Ftools%2Fangular%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fangular%2FBUILD.bazel?ref=aab59c1e09a11a1f3b3c901b062460356fdb8844",
            "patch": "@@ -1,23 +1,13 @@\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n-load(\"//tools/esbuild:index.bzl\", \"esbuild_config\")\n+load(\"@npm//@angular/dev-infra-private/bazel/esbuild:index.bzl\", \"esbuild_config\")\n load(\":index.bzl\", \"create_angular_bundle_targets\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n-js_library(\n-    name = \"create_linker_esbuild_plugin\",\n-    srcs = [\"create_linker_esbuild_plugin.mjs\"],\n-    deps = [\n-        \"@npm//@angular/compiler-cli\",\n-        \"@npm//@babel/core\",\n-    ],\n-)\n-\n esbuild_config(\n     name = \"esbuild_config\",\n     config_file = \"esbuild.config.mjs\",\n     deps = [\n-        \":create_linker_esbuild_plugin\",\n+        \"@npm//@angular/dev-infra-private/shared-scripts/angular-linker:js_lib\",\n     ],\n )\n "
        },
        {
            "sha": "6b0a315d90f288cf311963cf35f8834b84c706e1",
            "filename": "devtools/tools/angular/create_linker_esbuild_plugin.mjs",
            "status": "removed",
            "additions": 0,
            "deletions": 85,
            "changes": 85,
            "blob_url": "https://github.com/angular/angular/blob/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fangular%2Fcreate_linker_esbuild_plugin.mjs",
            "raw_url": "https://github.com/angular/angular/raw/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fangular%2Fcreate_linker_esbuild_plugin.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fangular%2Fcreate_linker_esbuild_plugin.mjs?ref=6a659a592e071f8bab49f4c4d45ecd40681f66de",
            "patch": "@@ -1,85 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import fs from 'fs';\n-\n-/** Naively checks whether this node path resolves to an Angular declare invocation. */\n-function isNgDeclareCallExpression(nodePath) {\n-  if (!nodePath.node.name.startsWith('ɵɵngDeclare')) {\n-    return false;\n-  }\n-\n-  // Expect the `ngDeclare` identifier to be used as part of a property access that\n-  // is invoked within a call expression. e.g. `i0.ɵɵngDeclare<>`.\n-  return (\n-    nodePath.parentPath?.type === 'MemberExpression' &&\n-    nodePath.parentPath.parentPath?.type === 'CallExpression'\n-  );\n-}\n-\n-/** Asserts that the given AST does not contain any Angular partial declaration. */\n-async function assertNoPartialDeclaration(filePath, ast, traverseFn) {\n-  // Naively check if there are any Angular declarations left that haven't been linked.\n-  traverseFn(ast, {\n-    Identifier: astPath => {\n-      if (isNgDeclareCallExpression(astPath)) {\n-        throw astPath.buildCodeFrameError(\n-          `Found Angular declaration that has not been linked. ${filePath}`,\n-          Error,\n-        );\n-      }\n-    },\n-  });\n-}\n-\n-/**\n- * Creates an ESBuild plugin for running the Angular linker resolved sources.\n- *\n- * @param filter Mandatory file path filter for the ESBuild plugin to apply to. Read\n- *   more here: https://esbuild.github.io/plugins/#filters.\n- * @param ensureNoPartialDeclaration Whether an additional check ensuring there are\n- *   no partial declarations should run.\n- */\n-export async function createLinkerEsbuildPlugin(filter, ensureNoPartialDeclaration) {\n-  // Note: We load all dependencies asynchronously so that these large dependencies\n-  // do not slow-down bundling when the linker plugin is not actually created.\n-  const {NodeJSFileSystem, ConsoleLogger, LogLevel} = await import('@angular/compiler-cli');\n-  const {createEs2015LinkerPlugin} = await import('@angular/compiler-cli/linker/babel');\n-  const {default: babel} = await import('@babel/core');\n-\n-  const linkerBabelPlugin = createEs2015LinkerPlugin({\n-    fileSystem: new NodeJSFileSystem(),\n-    logger: new ConsoleLogger(LogLevel.warn),\n-    // We enable JIT mode as unit tests also will rely on the linked ESM files.\n-    linkerJitMode: true,\n-  });\n-\n-  return {\n-    name: 'ng-linker-esbuild',\n-    setup: build => {\n-      build.onLoad({filter}, async args => {\n-        const filePath = args.path;\n-        const content = await fs.promises.readFile(filePath, 'utf8');\n-        const {ast, code} = await babel.transformAsync(content, {\n-          filename: filePath,\n-          filenameRelative: filePath,\n-          plugins: [linkerBabelPlugin],\n-          sourceMaps: 'inline',\n-          ast: true,\n-          compact: false,\n-        });\n-\n-        if (ensureNoPartialDeclaration) {\n-          await assertNoPartialDeclaration(filePath, ast, babel.traverse);\n-        }\n-\n-        return {contents: code};\n-      });\n-    },\n-  };\n-}"
        },
        {
            "sha": "1385f81abc3102dfc36e2da03f5f3943be58e707",
            "filename": "devtools/tools/angular/esbuild.config.mjs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Ftools%2Fangular%2Fesbuild.config.mjs",
            "raw_url": "https://github.com/angular/angular/raw/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Ftools%2Fangular%2Fesbuild.config.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fangular%2Fesbuild.config.mjs?ref=aab59c1e09a11a1f3b3c901b062460356fdb8844",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {createLinkerEsbuildPlugin} from './create_linker_esbuild_plugin.mjs';\n+import { createLinkerEsbuildPlugin } from '@angular/dev-infra-private/shared-scripts/angular-linker/esbuild-plugin.mjs';\n \n export default {\n   // Note: We support `.mjs` here as this is the extension used by Angular APF packages."
        },
        {
            "sha": "5481dd5f3e75c040aeb9af0625d9ba04283657d4",
            "filename": "devtools/tools/angular/index.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Ftools%2Fangular%2Findex.bzl",
            "raw_url": "https://github.com/angular/angular/raw/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Ftools%2Fangular%2Findex.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fangular%2Findex.bzl?ref=aab59c1e09a11a1f3b3c901b062460356fdb8844",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//:packages.bzl\", \"ANGULAR_PACKAGES\")\n-load(\"//tools/esbuild:index.bzl\", \"esbuild\")\n+load(\"@npm//@angular/dev-infra-private/bazel/esbuild:index.bzl\", \"esbuild\")\n load(\"@build_bazel_rules_nodejs//internal/linker:link_node_modules.bzl\", \"LinkerPackageMappingInfo\")\n load(\"@build_bazel_rules_nodejs//:providers.bzl\", \"ExternalNpmPackageInfo\", \"JSModuleInfo\")\n "
        },
        {
            "sha": "b17a4d7427c12e325595a4d236c6f5695426013c",
            "filename": "devtools/tools/defaults.bzl",
            "status": "modified",
            "additions": 31,
            "deletions": 1,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Ftools%2Fdefaults.bzl",
            "raw_url": "https://github.com/angular/angular/raw/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Ftools%2Fdefaults.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fdefaults.bzl?ref=aab59c1e09a11a1f3b3c901b062460356fdb8844",
            "patch": "@@ -1,7 +1,13 @@\n # Re-export of Bazel rules with repository-wide defaults\n \n load(\"@npm//@bazel/concatjs:index.bzl\", _karma_web_test = \"karma_web_test\", _karma_web_test_suite = \"karma_web_test_suite\")\n-load(\"//tools/spec-bundling:index.bzl\", \"spec_bundle\")\n+load(\"@npm//@angular/dev-infra-private/bazel/esbuild:index.bzl\", _esbuild = \"esbuild\", _esbuild_config = \"esbuild_config\")\n+load(\"@npm//@angular/dev-infra-private/bazel/spec-bundling:index.bzl\", _spec_bundle = \"spec_bundle\")\n+load(\"@npm//@angular/dev-infra-private/bazel:extract_js_module_output.bzl\", \"extract_js_module_output\")\n+load(\"//tools/angular:index.bzl\", \"LINKER_PROCESSED_FW_PACKAGES\")\n+\n+esbuild = _esbuild\n+esbuild_config = _esbuild_config\n \n def karma_web_test_suite(name, **kwargs):\n     web_test_args = {}\n@@ -23,6 +29,8 @@ def karma_web_test_suite(name, **kwargs):\n             # Note: when changing the browser names here, also update the \"yarn test\"\n             # script to reflect the new browser names.\n             \"@npm//@angular/dev-infra-private/bazel/browsers/chromium:chromium\",\n+\n+            # todo(aleksanderbodurri): enable when firefox support is done\n             # \"@npm//@angular/dev-infra-private/bazel/browsers/firefox:firefox\",\n         ]\n \n@@ -54,3 +62,25 @@ def karma_web_test_suite(name, **kwargs):\n         name = name,\n         **kwargs\n     )\n+\n+def spec_bundle(name, deps, **kwargs):\n+    extract_js_module_output(\n+        name = \"%s_devmode_deps\" % name,\n+        deps = deps,\n+        provider = \"JSModuleInfo\",\n+        forward_linker_mappings = True,\n+        include_external_npm_packages = True,\n+        include_default_files = False,\n+        include_declarations = False,\n+        testonly = True,\n+    )\n+\n+    _spec_bundle(\n+        name = name,\n+        # For specs, we always add the pre-processed linker FW packages so that these\n+        # are resolved instead of the unprocessed FW entry-points through the `node_modules`.\n+        deps = [\"%s_devmode_deps\" % name] + LINKER_PROCESSED_FW_PACKAGES,\n+        workspace_name = \"angular_devtools\",\n+        run_angular_linker = True,\n+        **kwargs\n+    )"
        },
        {
            "sha": "7fcefca5ef55a0b5b2bc74221cc9f68890c5273c",
            "filename": "devtools/tools/esbuild/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fesbuild%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fesbuild%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fesbuild%2FBUILD.bazel?ref=6a659a592e071f8bab49f4c4d45ecd40681f66de",
            "patch": "@@ -1 +0,0 @@\n-exports_files([\"esbuild-amd-config.mjs\"])"
        },
        {
            "sha": "17b5deaf51cc7aee8e2591fd825d8c934e21954a",
            "filename": "devtools/tools/esbuild/devmode-output.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/angular/angular/blob/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fesbuild%2Fdevmode-output.bzl",
            "raw_url": "https://github.com/angular/angular/raw/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fesbuild%2Fdevmode-output.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fesbuild%2Fdevmode-output.bzl?ref=6a659a592e071f8bab49f4c4d45ecd40681f66de",
            "patch": "@@ -1,43 +0,0 @@\n-load(\"@build_bazel_rules_nodejs//internal/linker:link_node_modules.bzl\", \"LinkerPackageMappingInfo\", \"module_mappings_aspect\")\n-load(\"@build_bazel_rules_nodejs//:providers.bzl\", \"ExternalNpmPackageInfo\", \"JSModuleInfo\", \"node_modules_aspect\")\n-\n-def _extract_devmode_sources_impl(ctx):\n-    \"\"\"Private rule that extracts devmode sources for all direct dependencies and re-exposes\n-      them as part of a single target. External node modules are passed-through as well.\"\"\"\n-\n-    mappings = {}\n-    js_sources = []\n-\n-    for dep in ctx.attr.deps:\n-        if JSModuleInfo in dep:\n-            js_sources.append(dep[JSModuleInfo].sources)\n-        if ExternalNpmPackageInfo in dep:\n-            js_sources.append(dep[ExternalNpmPackageInfo].sources)\n-        if LinkerPackageMappingInfo in dep:\n-            mappings.update(dep[LinkerPackageMappingInfo].mappings)\n-\n-    return [\n-        LinkerPackageMappingInfo(mappings = mappings),\n-        JSModuleInfo(\n-            direct_sources = depset(transitive = js_sources),\n-            sources = depset(transitive = js_sources),\n-        ),\n-    ]\n-\n-extract_devmode_sources = rule(\n-    implementation = _extract_devmode_sources_impl,\n-    attrs = {\n-        \"deps\": attr.label_list(mandatory = True, aspects = [module_mappings_aspect, node_modules_aspect]),\n-    },\n-)\n-\n-def extract_devmode_output_with_mappings(name, deps, testonly):\n-    \"\"\"Macro that extracts devmode ESM2020 sources from the given dependencies.\"\"\"\n-\n-    extract_devmode_sources(\n-        name = \"%s_sources\" % name,\n-        testonly = testonly,\n-        deps = deps,\n-    )\n-\n-    return [\"%s_sources\" % name]"
        },
        {
            "sha": "2650b211e33835a938ebbe5e3b818a2be4afce62",
            "filename": "devtools/tools/esbuild/esbuild-amd-config.mjs",
            "status": "removed",
            "additions": 0,
            "deletions": 24,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fesbuild%2Fesbuild-amd-config.mjs",
            "raw_url": "https://github.com/angular/angular/raw/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fesbuild%2Fesbuild-amd-config.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fesbuild%2Fesbuild-amd-config.mjs?ref=6a659a592e071f8bab49f4c4d45ecd40681f66de",
            "patch": "@@ -1,24 +0,0 @@\n-import url from 'url';\n-import path from 'path';\n-\n-/** Path to the ESBuild configuration maintained by the user. */\n-const userConfigExecPath = 'TMPL_CONFIG_PATH';\n-\n-/** User ESBuild config. Empty if none is loaded. */\n-let userConfig = {};\n-\n-if (userConfigExecPath !== '') {\n-  const userConfigPath = path.join(process.cwd(), userConfigExecPath);\n-  const userConfigUrl = url.pathToFileURL(userConfigPath);\n-\n-  // Load the user config, assuming it is set as `default` export.\n-  userConfig = (await import(userConfigUrl)).default;\n-}\n-\n-export default {\n-  ...userConfig,\n-  globalName: '__exports',\n-  format: 'iife',\n-  banner: {js: 'define(\"TMPL_MODULE_NAME\", [], function() {'},\n-  footer: {js: 'return __exports;})'},\n-};"
        },
        {
            "sha": "2f96bd02cbb08072359a49e82d9e629633989811",
            "filename": "devtools/tools/esbuild/index.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 52,
            "changes": 52,
            "blob_url": "https://github.com/angular/angular/blob/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fesbuild%2Findex.bzl",
            "raw_url": "https://github.com/angular/angular/raw/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fesbuild%2Findex.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fesbuild%2Findex.bzl?ref=6a659a592e071f8bab49f4c4d45ecd40681f66de",
            "patch": "@@ -1,52 +0,0 @@\n-load(\"@npm//@bazel/esbuild:index.bzl\", _esbuild = \"esbuild\", _esbuild_config = \"esbuild_config\")\n-load(\"@npm//@angular/dev-infra-private/bazel:expand_template.bzl\", \"expand_template\")\n-load(\"//tools/esbuild:devmode-output.bzl\", \"extract_devmode_output_with_mappings\")\n-\n-# Re-export of the actual esbuild definitions.\n-esbuild_config = _esbuild_config\n-\n-def esbuild(name, deps = [], mapping_targets = [], testonly = False, **kwargs):\n-    # Extract all JS module sources before passing to ESBuild. The ESBuild rule requests\n-    # both the devmode and prodmode unfortunately and this would slow-down the development\n-    # turnaround significantly. We only request the devmode sources which are ESM as well.\n-    devmode_targets = extract_devmode_output_with_mappings(name, deps, testonly)\n-\n-    _esbuild(\n-        name = name,\n-        deps = devmode_targets,\n-        testonly = testonly,\n-        **kwargs\n-    )\n-\n-\"\"\"Generates an AMD bundle for the specified entry-point with the given AMD module name.\"\"\"\n-\n-def esbuild_amd(name, entry_point, module_name, testonly = False, config = None, deps = [], **kwargs):\n-    expand_template(\n-        name = \"%s_config\" % name,\n-        testonly = testonly,\n-        template = \"//tools/esbuild:esbuild-amd-config.mjs\",\n-        output_name = \"%s_config.mjs\" % name,\n-        substitutions = {\n-            \"TMPL_MODULE_NAME\": module_name,\n-            \"TMPL_CONFIG_PATH\": \"$(execpath %s)\" % config if config else \"\",\n-        },\n-        data = [config] if config else None,\n-    )\n-\n-    _esbuild_config(\n-        name = \"%s_config_lib\" % name,\n-        testonly = testonly,\n-        config_file = \"%s_config\" % name,\n-        # Adds the user configuration and its deps as dependency of the AMD ESBuild config.\n-        # https://github.com/bazelbuild/rules_nodejs/blob/a892caf5a040bae5eeec174a3cf6250f02caf364/packages/esbuild/esbuild_config.bzl#L23.\n-        deps = [config, \"%s_deps\" % config] if config else None,\n-    )\n-\n-    esbuild(\n-        name = name,\n-        testonly = testonly,\n-        deps = deps,\n-        entry_point = entry_point,\n-        config = \"%s_config_lib\" % name,\n-        **kwargs\n-    )"
        },
        {
            "sha": "4fcc740c224a5a1a8c94c9e8a9d61c237f841807",
            "filename": "devtools/tools/karma.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 163,
            "changes": 163,
            "blob_url": "https://github.com/angular/angular/blob/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fkarma.bzl",
            "raw_url": "https://github.com/angular/angular/raw/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fkarma.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fkarma.bzl?ref=6a659a592e071f8bab49f4c4d45ecd40681f66de",
            "patch": "@@ -1,163 +0,0 @@\n-\"\"\"Helper macros for running jasmine specs via karma\"\"\"\n-\n-# Inspired by:\n-#   rules_nodejs concatjs: https://github.com/bazelbuild/rules_nodejs/blob/3.3.0/packages/concatjs/web_test/karma.conf.js\n-#   esbuild: https://gist.github.com/mattem/f6e85437b0dbcca661013a19247889a9\n-\n-load(\"@io_bazel_rules_webtesting//web:web.bzl\", _web_test_suite = \"web_test_suite\")\n-load(\"@npm//@bazel/esbuild:index.bzl\", _esbuild = \"esbuild\")\n-load(\"@npm//karma:index.bzl\", _karma = \"karma\")\n-\n-KARMA_PEER_DEPS = [\n-    \"@npm//karma-chrome-launcher\",\n-    \"@npm//karma-firefox-launcher\",\n-    \"@npm//karma-jasmine\",\n-    \"@npm//karma-sourcemap-loader\",\n-    \"@npm//karma-junit-reporter\",\n-]\n-\n-# https://github.com/bazelbuild/rules_nodejs/blob/3.3.0/packages/concatjs/web_test/karma_web_test.bzl#L94-L99\n-# Avoid using non-normalized paths (workspace/../other_workspace/path)\n-def _to_manifest_path(ctx, file):\n-    if file.short_path.startswith(\"../\"):\n-        return file.short_path[3:]\n-    else:\n-        return ctx.workspace_name + \"/\" + file.short_path.replace(\".ts\", \".js\")\n-\n-# Generate a karma.config.js file to:\n-# - run the given bundle containing specs\n-# - serve the given assets via http\n-# - bootstrap a set of js files before the bundle\n-def _generate_karma_config_impl(ctx):\n-    configuration = ctx.outputs.configuration\n-\n-    # root-relative (runfiles) path to the directory containing karma.conf\n-    config_segments = len(configuration.short_path.split(\"/\"))\n-\n-    # Extract the bundle directory out of the bundle target files\n-    bundle_dir = [f for f in ctx.attr.bundle[DefaultInfo].files.to_list() if f.is_directory][0]\n-\n-    ctx.actions.expand_template(\n-        template = ctx.file._conf_tmpl,\n-        output = configuration,\n-        substitutions = {\n-            \"TMPL_bootstrap_files\": \"\\n  \".join([\"'%s',\" % _to_manifest_path(ctx, e) for e in ctx.files.bootstrap]),\n-            \"TMPL_runfiles_path\": \"/\".join([\"..\"] * config_segments),\n-            \"TMPL_static_files\": \"\\n  \".join([\"'%s',\" % _to_manifest_path(ctx, e) for e in ctx.files.static_files]),\n-            \"TMPL_test_bundle_dir\": _to_manifest_path(ctx, bundle_dir),\n-        },\n-    )\n-\n-_generate_karma_config = rule(\n-    implementation = _generate_karma_config_impl,\n-    attrs = {\n-        # https://github.com/bazelbuild/rules_nodejs/blob/3.3.0/packages/concatjs/web_test/karma_web_test.bzl#L34-L39\n-        \"bootstrap\": attr.label_list(\n-            doc = \"\"\"JavaScript files to load via <script> *before* the specs\"\"\",\n-            allow_files = [\".js\", \".mjs\"],\n-        ),\n-        \"bundle\": attr.label(\n-            doc = \"\"\"The label producing the bundle directory containing the specs\"\"\",\n-            mandatory = True,\n-        ),\n-\n-        # https://github.com/bazelbuild/rules_nodejs/blob/3.3.0/packages/concatjs/web_test/karma_web_test.bzl#L81-L87\n-        \"static_files\": attr.label_list(\n-            doc = \"\"\"Arbitrary files which are available to be served on request\"\"\",\n-            allow_files = True,\n-        ),\n-\n-        # https://github.com/bazelbuild/rules_nodejs/blob/3.3.0/packages/concatjs/web_test/karma_web_test.bzl#L88-L91\n-        \"_conf_tmpl\": attr.label(\n-            doc = \"\"\"the karma config template\"\"\",\n-            cfg = \"host\",\n-            allow_single_file = True,\n-            default = Label(\"//tools:karma.conf.js\"),\n-        ),\n-    },\n-    outputs = {\n-        \"configuration\": \"%{name}.js\",\n-    },\n-)\n-\n-# Macro to convert a set of files into a web_test_suite\n-def karma_web_test_suite(name, browsers, specs, deps = [], bootstrap = [], static_files = []):\n-    \"\"\"Run the given specs.\n-\n-    Args:\n-        name: primary karma target rule name\n-        browsers: browsers to test\n-        specs: spec files containing tests\n-        deps: dependencies of the specs\n-        bootstrap: files loaded in <script> tags up front\n-        static_files: files available to download\n-    \"\"\"\n-    bundle_name = \"%s.bundle\" % name\n-    suite_name = \"%s.suite\" % name\n-    karma_config_name = \"%s.conf\" % name\n-    karma_name = name\n-\n-    # Bundle the spec files\n-    _esbuild(\n-        name = bundle_name,\n-        entry_points = [spec.replace(\".ts\", \".js\") for spec in specs],\n-        output_dir = True,\n-        splitting = True,\n-        deps = deps,\n-        testonly = 1,\n-    )\n-\n-    _generate_karma_config(\n-        name = karma_config_name,\n-        bundle = \":%s\" % bundle_name,\n-        bootstrap = bootstrap,\n-        static_files = static_files,\n-        testonly = 1,\n-    )\n-\n-    _karma(\n-        name = karma_name,\n-        testonly = 1,\n-        data = KARMA_PEER_DEPS + bootstrap + static_files + [\n-            # generated config + specs-bundle\n-            \":%s\" % karma_config_name,\n-            \":%s\" % bundle_name,\n-        ],\n-        templated_args = [\n-            \"start\",\n-            \"$(rootpath %s)\" % karma_config_name,\n-        ],\n-    )\n-\n-    # Create a rules_webtesting web_test_suite wrapping the karma runner\n-    _web_test_suite(\n-        name = suite_name,\n-        test = \":\" + karma_name,\n-        launcher = \":\" + karma_name,\n-        testonly = 1,\n-        tags = [\"native\"],\n-        browsers = browsers,\n-    )\n-\n-def ng_karma_web_test_suite(name, browsers, specs, deps = [], bootstrap = [], static_files = []):\n-    default_bootstrap = [\n-        \"@npm//:node_modules/zone.js/dist/zone-testing-bundle.js\",\n-        \"@npm//:node_modules/reflect-metadata/Reflect.js\",\n-    ]\n-    default_specs = [\n-        \"//:initialize_testbed.js\",\n-    ]\n-    default_deps = [\n-        \"@npm//@angular/compiler\",\n-        \"@npm//@angular/platform-browser-dynamic\",\n-        \"//:initialize_testbed\",\n-    ]\n-\n-    karma_web_test_suite(\n-        name,\n-        browsers,\n-        specs = specs + default_specs,\n-        deps = deps + default_deps,\n-        bootstrap = bootstrap + default_bootstrap,\n-        static_files = static_files,\n-    )"
        },
        {
            "sha": "5ba31b9d1b28b9e6a85989195cc467fc3d70f029",
            "filename": "devtools/tools/karma.conf.js",
            "status": "removed",
            "additions": 0,
            "deletions": 414,
            "changes": 414,
            "blob_url": "https://github.com/angular/angular/blob/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fkarma.conf.js",
            "raw_url": "https://github.com/angular/angular/raw/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fkarma.conf.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fkarma.conf.js?ref=6a659a592e071f8bab49f4c4d45ecd40681f66de",
            "patch": "@@ -1,414 +0,0 @@\n-// Karma configuration GENERATED BY Bazel\n-\n-const path = require('path');\n-const fs = require('fs');\n-const child_process = require('child_process');\n-const runfiles = require(process.env['BAZEL_NODE_RUNFILES_HELPER']);\n-\n-// Static files are added to the files array but configured to not be included,\n-// so karma does not included them. Note that we need.\n-const STATIC_FILES = [\n-  // BEGIN STATIC FILES\n-  TMPL_static_files\n-  // END STATIC FILES\n-];\n-\n-const BOOTSTRAP_FILES = [\n-  // BEGIN BOOTSTRAP FILES\n-  TMPL_bootstrap_files\n-  // END BOOTSTRAP FILES\n-];\n-\n-// Test + runtime entry point files\n-const BUNDLE_FILES = findAllFiles('TMPL_test_bundle_dir');\n-\n-// process.env.BUILD_WORKSPACE_DIRECTORY is set to the the absolute path of\n-// the bazel workspace when doing `bazel run ...`\n-// See https://docs.bazel.build/versions/master/user-manual.html#run\n-const isBazelRun = !!process.env.BUILD_WORKSPACE_DIRECTORY;\n-\n-// Setup ibazel livereload when run with ibazel\n-const ibazelNotifyChanges = isBazelRun && !!process.env.IBAZEL_NOTIFY_CHANGES;\n-\n-const VERBOSE_LOGS = !!process.env['VERBOSE_LOGS'];\n-\n-function log_verbose(...m) {\n-  // This is a template file so we use __filename to output the actual filename\n-  if (VERBOSE_LOGS) console.error(`[${path.basename(__filename)}]`, ...m);\n-}\n-\n-function findAllFiles(dir, subdir, found) {\n-  subdir = subdir || '.';\n-  found = found || [];\n-\n-  const fullPath = runfiles.resolve(dir);\n-\n-  for (const file of fs.readdirSync(fullPath)) {\n-    const filePath = dir + '/' + file;\n-\n-    if (fs.statSync(runfiles.resolve(filePath)).isDirectory()) {\n-      findAllFiles(filePath, subdir, found);\n-    } else {\n-      found.push(filePath);\n-    }\n-  }\n-\n-  return found;\n-}\n-\n-/**\n- * Helper function to merge base karma config values that are arrays.\n- */\n-function mergeConfigArray(conf, name, values) {\n-  if (!conf[name]) {\n-    conf[name] = [];\n-  }\n-  values.forEach(v => {\n-    if (!conf[name].includes(v)) {\n-      conf[name].push(v);\n-    }\n-  })\n-}\n-\n-/**\n- * Helper function to find a particular namedFile\n- * within the webTestMetadata webTestFiles\n- */\n-function findNamedFile(webTestMetadata, key) {\n-  let result;\n-  webTestMetadata['webTestFiles'].forEach(entry => {\n-    const webTestNamedFiles = entry['namedFiles'];\n-    if (webTestNamedFiles && webTestNamedFiles[key]) {\n-      result = webTestNamedFiles[key];\n-    }\n-  });\n-  return result;\n-}\n-\n-/**\n- * Helper function to extract a browser archive\n- * and return the path to extract executable\n- */\n-function extractWebArchive(extractExe, archiveFile, executablePath) {\n-  try {\n-    // Paths are relative to the root runfiles folder\n-    extractExe = extractExe ? path.join('..', extractExe) : extractExe;\n-    archiveFile = path.join('..', archiveFile);\n-    const extractedExecutablePath = path.join(process.cwd(), executablePath);\n-    if (!extractExe) {\n-      throw new Error('No EXTRACT_EXE found');\n-    }\n-    child_process.execFileSync(\n-        extractExe, [archiveFile, '.'], {stdio: [process.stdin, process.stdout, process.stderr]});\n-    log_verbose(\n-        `Extracting web archive ${archiveFile} with ${extractExe} to ${extractedExecutablePath}`);\n-    return extractedExecutablePath;\n-  } catch (e) {\n-    console.error(`Failed to extract ${archiveFile}`);\n-    throw e;\n-  }\n-}\n-\n-/**\n- * Check if Chrome sandboxing is supported on the current platform.\n- */\n-function supportChromeSandboxing() {\n-  if (process.platform === 'darwin') {\n-    // Chrome 73+ fails to initialize the sandbox on OSX when running under Bazel.\n-    // ```\n-    // ERROR [launcher]: Cannot start ChromeHeadless\n-    // ERROR:crash_report_database_mac.mm(96)] mkdir\n-    // /private/var/tmp/_bazel_greg/62ef096b0da251c6d093468a1efbfbd3/execroot/angular/bazel-out/darwin-fastbuild/bin/external/io_bazel_rules_webtesting/third_party/chromium/chromium.out/chrome-mac/Chromium.app/Contents/Versions/73.0.3683.0/Chromium\n-    // Framework.framework/Versions/A/new: Permission denied (13) ERROR:file_io.cc(89)]\n-    // ReadExactly: expected 8, observed 0 ERROR:crash_report_database_mac.mm(96)] mkdir\n-    // /private/var/tmp/_bazel_greg/62ef096b0da251c6d093468a1efbfbd3/execroot/angular/bazel-out/darwin-fastbuild/bin/external/io_bazel_rules_webtesting/third_party/chromium/chromium.out/chrome-mac/Chromium.app/Contents/Versions/73.0.3683.0/Chromium\n-    // Framework.framework/Versions/A/new: Permission denied (13) Chromium Helper[94642] <Error>:\n-    // SeatbeltExecServer: Failed to initialize sandbox: -1 Operation not permitted Failed to\n-    // initialize sandbox. [0213/201206.137114:FATAL:content_main_delegate.cc(54)] Check failed:\n-    // false. 0   Chromium Framework                  0x000000010c078bc9 ChromeMain + 43788137 1\n-    // Chromium Framework                  0x000000010bfc0f43 ChromeMain + 43035363\n-    // ...\n-    // ```\n-    return false;\n-  }\n-\n-  if (process.platform === 'linux') {\n-    // Chrome on Linux uses sandboxing, which needs user namespaces to be enabled.\n-    // This is not available on all kernels and it might be turned off even if it is available.\n-    // Notable examples where user namespaces are not available include:\n-    // - In Debian it is compiled-in but disabled by default.\n-    // - The Docker daemon for Windows or OSX does not support user namespaces.\n-    // We can detect if user namespaces are supported via\n-    // /proc/sys/kernel/unprivileged_userns_clone. For more information see:\n-    // https://github.com/Googlechrome/puppeteer/issues/290\n-    // https://superuser.com/questions/1094597/enable-user-namespaces-in-debian-kernel#1122977\n-    // https://github.com/karma-runner/karma-chrome-launcher/issues/158\n-    // https://github.com/angular/angular/pull/24906\n-    try {\n-      const res = child_process.execSync('cat /proc/sys/kernel/unprivileged_userns_clone')\n-                      .toString()\n-                      .trim();\n-      return res === '1';\n-    } catch (error) {\n-    }\n-    return false;\n-  }\n-\n-  return true;\n-}\n-\n-/**\n- * Helper function to override nested karma config values.\n- */\n-function overrideNestedConfigValue(conf, name, value) {\n-  const nameParts = name.split('.');\n-  const finalName = nameParts.pop();\n-  for (const property of nameParts) {\n-    if (!(property in conf)) {\n-      conf[property] = {};\n-    }\n-    conf = conf[property];\n-  }\n-  if (conf.hasOwnProperty(name)) {\n-    console.warn(`Your karma configuration specifies '${name}' which will be overwritten by Bazel`);\n-  }\n-  conf[finalName] = value;\n-}\n-\n-/**\n- * Configuration settings for karma under Bazel common to karma_web_test\n- * and karma_web_test_suite.\n- */\n-function configureTestReporters(conf) {\n-  // Configure the junit reporter if the XML_OUTPUT_FILE environment is defined.\n-  const testOutputFile = process.env.XML_OUTPUT_FILE;\n-  if (testOutputFile) {\n-    mergeConfigArray(conf, 'plugins', []);\n-\n-    mergeConfigArray(conf, 'reporters', ['junit']);\n-\n-\n-    overrideNestedConfigValue(conf, 'junitReporter.outputDir', path.dirname(testOutputFile));\n-    overrideNestedConfigValue(conf, 'junitReporter.outputFile', path.basename(testOutputFile));\n-    overrideNestedConfigValue(conf, 'junitReporter.useBrowserName', false);\n-  }\n-}\n-\n-/**\n- * Configure the 'files' and 'proxies' configuration attributes based on the\n- * injected STATIC_FILES, BOOTSTRAP_FILES and BUNDLE_FILES.\n- */\n-function configureFiles(conf) {\n-  // Static files available but not included\n-  STATIC_FILES.forEach(f => conf.files.push({pattern: f, included: false}));\n-\n-  // Bootstrap files included before spec files\n-  BOOTSTRAP_FILES.forEach(f => conf.files.push(f));\n-\n-  // Bundle files available to downloaded, included if non-chunk js files\n-  BUNDLE_FILES.forEach(f => {\n-    const isJs = f.endsWith('.js') || f.endsWith('.mjs');\n-    const isChunk = isJs && f.includes('chunk-');\n-\n-    conf.files.push({\n-      pattern: f,\n-      type: isJs ? 'module' : undefined,\n-      included: isJs && !isChunk,\n-    });\n-  });\n-\n-  // Proxy simple URLs to the bazel resolved files\n-  [...STATIC_FILES, ...BOOTSTRAP_FILES, ...BUNDLE_FILES].forEach(f => {\n-    // In Windows, the runfile will probably not be symlinked. Se we need to\n-    // serve the real file through karma, and proxy calls to the expected file\n-    // location in the runfiles to the real file.\n-    const resolvedFile = runfiles.resolve(f);\n-\n-    // Prefixing the proxy path with '/absolute' allows karma to load local\n-    // files. This doesn't see to be an official API.\n-    // https://github.com/karma-runner/karma/issues/2703\n-    conf.proxies['/base/' + f] = '/absolute' + resolvedFile;\n-  })\n-}\n-\n-/**\n- * Configure karma when run under web_test_suite to use the test suite provided\n- * browsers.\n- */\n-function configureWebTestSuiteBrowsers(conf) {\n-  // If this is NOT invoked via a web_test_suite rule exist and assume configured elsewhere\n-  if (!process.env['WEB_TEST_METADATA']) {\n-    return;\n-  }\n-\n-  const webTestMetadata = require(runfiles.resolve(process.env['WEB_TEST_METADATA']));\n-\n-  log_verbose(`WEB_TEST_METADATA: ${JSON.stringify(webTestMetadata, null, 2)}`);\n-\n-  if (webTestMetadata['environment'] === 'local') {\n-    // When a local chrome or firefox browser is chosen such as\n-    // \"@io_bazel_rules_webtesting//browsers:chromium-local\" or\n-    // \"@io_bazel_rules_webtesting//browsers:firefox-local\"\n-    // then the 'environment' will equal 'local' and\n-    // 'webTestFiles' will contain the path to the binary to use\n-    const extractExe = findNamedFile(webTestMetadata, 'EXTRACT_EXE');\n-    webTestMetadata['webTestFiles'].forEach(webTestFiles => {\n-      const webTestNamedFiles = webTestFiles['namedFiles'];\n-      const archiveFile = webTestFiles['archiveFile'];\n-\n-      if (webTestNamedFiles['CHROMIUM']) {\n-        // When karma is configured to use Chrome it will look for a CHROME_BIN\n-        // environment variable.\n-        if (archiveFile) {\n-          process.env.CHROME_BIN =\n-              extractWebArchive(extractExe, archiveFile, webTestNamedFiles['CHROMIUM']);\n-        } else {\n-          try {\n-            process.env.CHROME_BIN = runfiles.resolve(webTestNamedFiles['CHROMIUM']);\n-          } catch {\n-            // Fail as this file is expected to be in runfiles\n-            throw new Error(`Failed to resolve rules_webtesting Chromium binary '${\n-                webTestNamedFiles['CHROMIUM']}' in runfiles`);\n-          }\n-        }\n-        // Read any additional chrome options (as specified by the\n-        // rules_webtesting manifest).\n-        const chromeOptions = (webTestMetadata['capabilities'] || {})['goog:chromeOptions'];\n-        const additionalArgs = (chromeOptions ? chromeOptions['args'] : []).filter(arg => {\n-          // We never want to 'run' Chrome in headless mode.\n-          return arg != '--headless';\n-        });\n-        const browser = process.env['DISPLAY'] ? 'Chrome' : 'ChromeHeadless';\n-        if (!supportChromeSandboxing()) {\n-          const launcher = 'CustomChromeWithoutSandbox';\n-          conf.customLaunchers =\n-              {[launcher]: {base: browser, flags: ['--no-sandbox', ...additionalArgs]}};\n-          conf.browsers.push(launcher);\n-        } else {\n-          const launcher = 'CustomChrome';\n-          conf.customLaunchers = {[launcher]: {base: browser, flags: additionalArgs}};\n-          conf.browsers.push(launcher);\n-        }\n-      }\n-      if (webTestNamedFiles['FIREFOX']) {\n-        // When karma is configured to use Firefox it will look for a\n-        // FIREFOX_BIN environment variable.\n-        if (archiveFile) {\n-          process.env.FIREFOX_BIN =\n-              extractWebArchive(extractExe, archiveFile, webTestNamedFiles['FIREFOX']);\n-        } else {\n-          try {\n-            process.env.FIREFOX_BIN = runfiles.resolve(webTestNamedFiles['FIREFOX']);\n-          } catch {\n-            // Fail as this file is expected to be in runfiles\n-            throw new Error(`Failed to resolve rules_webtesting Firefox binary '${\n-                webTestNamedFiles['FIREFOX']}' in runfiles`);\n-          }\n-        }\n-        conf.browsers.push(process.env['DISPLAY'] ? 'Firefox' : 'FirefoxHeadless');\n-      }\n-    });\n-  } else {\n-    throw new Error(`Unknown WEB_TEST_METADATA environment '${webTestMetadata['environment']}'`);\n-  }\n-\n-  if (!conf.browsers.length) {\n-    throw new Error('No browsers configured in web test suite');\n-  }\n-}\n-\n-function configureBazelTestBrowsers(conf) {\n-  // If this is invoked via a web_test_suite rule exist and assume configured elsewhere\n-  if (process.env['WEB_TEST_METADATA']) {\n-    return;\n-  }\n-\n-  // Fallback to using the system local chrome if no valid browsers have been\n-  // configured above\n-  if (!conf.browsers || !conf.browsers.length) {\n-    console.warn('No browsers configured. Configuring Karma to use system Chrome.');\n-    conf.browsers = [process.env['DISPLAY'] ? 'Chrome' : 'ChromeHeadless'];\n-  }\n-}\n-\n-function configureFormatError(conf) {\n-  conf.formatError = (msg) => {\n-    // This is a bazel specific formatError that removes the workspace\n-    // name from stack traces.\n-    // Look for filenames of the format \"(<filename>:<row>:<column>\"\n-    const FILENAME_REGEX = /\\(([^:\\n\\r]+)(:\\d+:\\d+)/gm;\n-    msg = msg.replace(FILENAME_REGEX, (_, p1, p2) => {\n-      if (p1.startsWith('../')) {\n-        // Remove all leading \"../\"\n-        while (p1.startsWith('../')) {\n-          p1 = p1.substr(3);\n-        }\n-      } else {\n-        // Remove workspace name(angular, ngdeps etc.) from the beginning.\n-        const index = p1.indexOf('/');\n-        if (index >= 0) {\n-          p1 = p1.substr(index + 1);\n-        }\n-      }\n-      return '(' + p1 + p2;\n-    });\n-    return msg + '\\n\\n';\n-  };\n-}\n-\n-module.exports = function(config) {\n-  const conf = {\n-    basePath: 'TMPL_runfiles_path',\n-\n-    colors: true,\n-    logLevel: VERBOSE_LOGS ? config.LOG_DEBUG : config.LOG_INFO,\n-\n-    frameworks: ['jasmine'],\n-    reporters: isBazelRun ? [] : ['progress'],\n-    plugins: [\n-      require('karma-chrome-launcher'), require('karma-firefox-launcher'), require('karma-jasmine'),\n-      require('karma-sourcemap-loader'), require('karma-junit-reporter')\n-    ],\n-\n-    preprocessors: {\n-      '**/*.js': ['sourcemap'],\n-    },\n-\n-    concurrency: Infinity,\n-\n-    // When doing `bazel run ...` we want karma to continue running, where when\n-    // doing `bazel test ...` it can run once and close right away.\n-    singleRun: !isBazelRun,\n-\n-    // watch the files when using ibazel\n-    autoWatch: ibazelNotifyChanges,\n-\n-    // Disable 'strict-origin-when-cross-origin' to allow external scripts for livereload\n-    crossOriginAttribute: !ibazelNotifyChanges,\n-\n-    // Configured based on bazel web/testing setup\n-    browsers: [],\n-\n-    // Configured based on bazel file inputs\n-    // Include the ibazel livereload script at the start when available\n-    files: process.env.IBAZEL_LIVERELOAD_URL ? [process.env.IBAZEL_LIVERELOAD_URL] : [],\n-\n-    // configured based on bazel file inputs\n-    proxies: [],\n-  };\n-\n-  configureTestReporters(conf);\n-  configureFiles(conf);\n-  configureFormatError(conf);\n-\n-  // Do not configure browsers for a `bazel run` and allow manually opening the browser\n-  // for debugging.\n-  if (!isBazelRun) {\n-    configureWebTestSuiteBrowsers(conf);\n-    configureBazelTestBrowsers(conf);\n-  }\n-\n-  log_verbose(`karma configuration: ${JSON.stringify(conf, null, 2)}`);\n-\n-  config.set(conf);\n-}"
        },
        {
            "sha": "3db5a9f20ed0dafae014515a7b375a4f3ac99914",
            "filename": "devtools/tools/spec-bundling/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fspec-bundling%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fspec-bundling%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fspec-bundling%2FBUILD.bazel?ref=6a659a592e071f8bab49f4c4d45ecd40681f66de",
            "patch": "@@ -1,3 +0,0 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n-exports_files([\"esbuild.config-tmpl.mjs\"])"
        },
        {
            "sha": "e0ded3d7efe9cc55760fa36ac6916fab76474b43",
            "filename": "devtools/tools/spec-bundling/esbuild.config-tmpl.mjs",
            "status": "removed",
            "additions": 0,
            "deletions": 27,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fspec-bundling%2Fesbuild.config-tmpl.mjs",
            "raw_url": "https://github.com/angular/angular/raw/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fspec-bundling%2Fesbuild.config-tmpl.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fspec-bundling%2Fesbuild.config-tmpl.mjs?ref=6a659a592e071f8bab49f4c4d45ecd40681f66de",
            "patch": "@@ -1,27 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-// Note: This needs to be a workspace manifest path as this ESBuild config\n-// is generated and can end up in arbitrary Bazel packages.\n-import {createLinkerEsbuildPlugin} from 'angular_devtools/tools/angular/create_linker_esbuild_plugin.mjs';\n-\n-// Based on the Bazel action and its substitutions, we run the linker for all inputs.\n-const plugins = TMPL_RUN_LINKER\n-  ? [await createLinkerEsbuildPlugin(/.*/, /* ensureNoPartialDeclaration */ true)]\n-  : [];\n-\n-export default {\n-  // `tslib` sets the `module` condition to resolve to ESM.\n-  conditions: ['es2020', 'es2015', 'module'],\n-  // This ensures that we prioritize ES2020. RxJS would otherwise use the ESM5 output.\n-  mainFields: ['es2020', 'es2015', 'module', 'main'],\n-  // Use the `iife` format for the test entry-point as tests should run immediately.\n-  // For browser tests which are wrapped in an AMD header and footer, this works as well.\n-  format: 'iife',\n-  plugins,\n-};"
        },
        {
            "sha": "79bd30cfa21942901e14591bb3be6e3027c0435f",
            "filename": "devtools/tools/spec-bundling/index.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 151,
            "changes": 151,
            "blob_url": "https://github.com/angular/angular/blob/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fspec-bundling%2Findex.bzl",
            "raw_url": "https://github.com/angular/angular/raw/6a659a592e071f8bab49f4c4d45ecd40681f66de/devtools%2Ftools%2Fspec-bundling%2Findex.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Ftools%2Fspec-bundling%2Findex.bzl?ref=6a659a592e071f8bab49f4c4d45ecd40681f66de",
            "patch": "@@ -1,151 +0,0 @@\n-load(\"@npm//@angular/dev-infra-private/bazel:expand_template.bzl\", \"expand_template\")\n-load(\"//tools/esbuild:index.bzl\", \"esbuild\", \"esbuild_amd\", \"esbuild_config\")\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n-load(\"@build_bazel_rules_nodejs//:providers.bzl\", \"JSModuleInfo\")\n-load(\"//tools/angular:index.bzl\", \"LINKER_PROCESSED_FW_PACKAGES\")\n-\n-\"\"\"\n-  Starlark file exposing a macro for bundling Bazel targets with spec files into\n-  a single spec ESM/AMD file. Bundling is helpful as it avoids unnecessary complexity\n-  with module resolution at runtime with loaders such as SystemJS or RequireJS.\n-\n-  Additionally, given that Angular framework packages do no longer ship UMD bundles,\n-  bundling simplifies the integration of those FW packages significantly. It also helps\n-  with incorporating the Angular linker-processed output of FW ESM bundles.\n-\"\"\"\n-\n-def _is_spec_file(file):\n-    \"\"\"Gets whether the given file is a spec file.\"\"\"\n-    basename = file.basename\n-\n-    # External files (from other workspaces) should never run as specs.\n-    if (file.short_path.startswith(\"../\")):\n-        return False\n-\n-    # `spec.js` or `spec.mjs` files will be imported in the entry-point.\n-    return basename.endswith(\"spec.js\") or basename.endswith(\"spec.mjs\")\n-\n-def _filter_spec_files(files):\n-    \"\"\"Filters the given list of files to only contain spec files.\"\"\"\n-    result = []\n-    for file in files:\n-        if _is_spec_file(file):\n-            result.append(file)\n-    return result\n-\n-def _create_entrypoint_file(base_package, spec_files):\n-    \"\"\"Creates the contents of the spec entry-point ESM file which imports\n-    all individual spec files so that these are bundled and loaded by Node/Karma.\"\"\"\n-    output = \"\"\n-    for file in spec_files:\n-        base_dir_segments = \"/\".join([\"..\"] * len(base_package.split(\"/\")))\n-        output += \"\"\"import \"%s/%s\";\\n\"\"\" % (base_dir_segments, file.short_path)\n-    return output\n-\n-def _spec_entrypoint_impl(ctx):\n-    output = ctx.actions.declare_file(\"%s.mjs\" % ctx.attr.name)\n-    spec_depsets = []\n-\n-    for dep in ctx.attr.deps:\n-        if JSModuleInfo in dep:\n-            spec_depsets.append(dep[JSModuleInfo].sources)\n-        else:\n-            spec_depsets.append(dep[DefaultInfo].files)\n-\n-    spec_files = []\n-\n-    for spec_depset in spec_depsets:\n-        # Note: `to_list()` is an expensive operation but we need to do this for every\n-        # dependency here in order to be able to filter out spec files from depsets.\n-        spec_files.extend(_filter_spec_files(spec_depset.to_list()))\n-\n-    ctx.actions.write(\n-        output = output,\n-        content = _create_entrypoint_file(ctx.label.package, spec_files),\n-    )\n-\n-    out_depset = depset([output])\n-\n-    return [\n-        DefaultInfo(files = out_depset),\n-        JSModuleInfo(\n-            direct_sources = out_depset,\n-            sources = depset(transitive = [out_depset] + spec_depsets),\n-        ),\n-    ]\n-\n-_spec_entrypoint = rule(\n-    implementation = _spec_entrypoint_impl,\n-    attrs = {\n-        \"deps\": attr.label_list(allow_files = False, mandatory = True),\n-    },\n-)\n-\n-def spec_bundle(name, platform, deps, **kwargs):\n-    \"\"\"\n-      Macro that will bundle all test files, with their respective transitive dependencies,\n-      into a single bundle file that can be loaded within Karma or NodeJS directly. Test files\n-      are bundled as Angular framework packages do not ship UMD files and to avoid overall\n-      complexity with maintaining a runtime loader such as RequireJS or SystemJS.\n-    \"\"\"\n-\n-    is_browser_test = platform == \"browser\"\n-    package_name = native.package_name()\n-    workspace = \"angular_devtools\"\n-\n-    _spec_entrypoint(\n-        name = \"%s_spec_entrypoint\" % name,\n-        deps = deps,\n-        testonly = True,\n-    )\n-\n-    expand_template(\n-        name = \"%s_config_file\" % name,\n-        testonly = True,\n-        template = \"//tools/spec-bundling:esbuild.config-tmpl.mjs\",\n-        output_name = \"%s_config.mjs\" % name,\n-        substitutions = select({\n-            # Depending on whether partial compilation is enabled, we may want to run the linker\n-            # to test the Angular compiler linker AOT processing. Additionally, a config setting\n-            # can forcibly disable the linker to ensure tests rely on JIT linking at runtime.\n-            \"//tools:force_partial_jit_compilation_enabled\": {\"TMPL_RUN_LINKER\": \"false\"},\n-            \"//tools:partial_compilation_enabled\": {\"TMPL_RUN_LINKER\": \"true\"},\n-            \"//conditions:default\": {\"TMPL_RUN_LINKER\": \"true\"},\n-        }),\n-    )\n-\n-    esbuild_config(\n-        name = \"%s_config\" % name,\n-        config_file = \":%s_config_file\" % name,\n-        testonly = True,\n-        deps = [\"//tools/angular:create_linker_esbuild_plugin\"],\n-    )\n-\n-    # Browser tests (Karma) need named AMD modules to load.\n-    # TODO(devversion): consider updating `@bazel/concatjs` to support loading JS files directly.\n-    esbuild_rule = esbuild_amd if is_browser_test else esbuild\n-    amd_name = \"%s/%s/%s\" % (workspace, package_name, name + \"_spec\") if is_browser_test else None\n-\n-    esbuild_rule(\n-        name = \"%s_bundle\" % name,\n-        testonly = True,\n-        config = \":%s_config\" % name,\n-        entry_point = \":%s_spec_entrypoint\" % name,\n-        module_name = amd_name,\n-        output = \"%s_spec.js\" % name,\n-        # We cannot use `ES2017` or higher as that would result in `async/await` not being downleveled.\n-        # ZoneJS needs to be able to intercept these as otherwise change detection would not work properly.\n-        target = \"es2016\",\n-        platform = platform,\n-        # Note: We add all linker-processed FW packages as dependencies here so that ESBuild will\n-        # map all framework packages to their linker-processed bundles from `tools/angular`.\n-        deps = deps + LINKER_PROCESSED_FW_PACKAGES + [\":%s_spec_entrypoint\" % name],\n-        link_workspace_root = True,\n-        **kwargs\n-    )\n-\n-    js_library(\n-        name = name,\n-        testonly = True,\n-        named_module_srcs = [\":%s_bundle\" % name],\n-    )"
        },
        {
            "sha": "a72ac156e512bf52dce8a651c9f95fb313b72038",
            "filename": "devtools/yarn.lock",
            "status": "modified",
            "additions": 57,
            "deletions": 27,
            "changes": 84,
            "blob_url": "https://github.com/angular/angular/blob/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Fyarn.lock",
            "raw_url": "https://github.com/angular/angular/raw/aab59c1e09a11a1f3b3c901b062460356fdb8844/devtools%2Fyarn.lock",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Fyarn.lock?ref=aab59c1e09a11a1f3b3c901b062460356fdb8844",
            "patch": "@@ -321,21 +321,22 @@\n   dependencies:\n     tslib \"^2.3.0\"\n \n-\"@angular/dev-infra-private@https://github.com/angular/dev-infra-private-builds.git#2cfe4b98a157927b319a3a00b467ff6233dc3337\":\n-  version \"0.0.0-0474a28f6c7dbc47b8075e78223b2eeb8cd37c2e\"\n-  resolved \"https://github.com/angular/dev-infra-private-builds.git#2cfe4b98a157927b319a3a00b467ff6233dc3337\"\n+\"@angular/dev-infra-private@https://github.com/angular/dev-infra-private-builds.git#c55a3937d45945489714273bfbbe9b803ceff89e\":\n+  version \"0.0.0-f0f363cb4ce5b5faf14e3d3bb7eeb7c7aee72da7\"\n+  resolved \"https://github.com/angular/dev-infra-private-builds.git#c55a3937d45945489714273bfbbe9b803ceff89e\"\n   dependencies:\n     \"@actions/core\" \"^1.4.0\"\n     \"@actions/github\" \"^5.0.0\"\n     \"@angular-devkit/build-optimizer\" \"^0.1300.0\"\n     \"@angular/benchpress\" \"0.2.1\"\n+    \"@babel/core\" \"^7.16.0\"\n     \"@bazel/bazelisk\" \"^1.10.1\"\n     \"@bazel/buildifier\" \"^4.0.1\"\n-    \"@bazel/esbuild\" \"4.4.2\"\n-    \"@bazel/jasmine\" \"4.4.2\"\n-    \"@bazel/protractor\" \"4.4.2\"\n-    \"@bazel/runfiles\" \"4.4.2\"\n-    \"@bazel/typescript\" \"4.4.2\"\n+    \"@bazel/esbuild\" \"4.4.5\"\n+    \"@bazel/jasmine\" \"4.4.5\"\n+    \"@bazel/protractor\" \"4.4.5\"\n+    \"@bazel/runfiles\" \"4.4.5\"\n+    \"@bazel/typescript\" \"4.4.5\"\n     \"@microsoft/api-extractor\" \"7.18.19\"\n     \"@octokit/auth-app\" \"^3.6.0\"\n     \"@octokit/core\" \"^3.5.1\"\n@@ -365,11 +366,12 @@\n     node-fetch \"^2.6.1\"\n     prettier \"^2.3.2\"\n     protractor \"^7.0.0\"\n-    rollup \"2.59.0\"\n+    rollup \"2.60.0\"\n     rollup-plugin-sourcemaps \"^0.6.3\"\n     selenium-webdriver \"3.5.0\"\n     semver \"^7.3.5\"\n     tmp \"^0.2.1\"\n+    \"true-case-path\" \"^2.2.1\"\n     ts-node \"^10.2.1\"\n     tslib \"^2.3.0\"\n     tslint \"^6.1.3\"\n@@ -1756,7 +1758,12 @@\n   resolved \"https://registry.yarnpkg.com/@bazel/cypress/-/cypress-4.4.5.tgz#a96dee8b303507065d09aaa733386ae55245a708\"\n   integrity sha512-4rku+NZhmiOhLImVoeB9IS7jxDzHFI3hAam3ZgYU8Pv0SfJHW8Obay7shAwVXI6uTgwIBlEkcWdfJ719Ooeo9A==\n \n-\"@bazel/esbuild@4.4.2\", \"@bazel/esbuild@^4.4.2\":\n+\"@bazel/esbuild@4.4.5\":\n+  version \"4.4.5\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/esbuild/-/esbuild-4.4.5.tgz#17331868ac42f2d2c03afc776847dea2d0e650d4\"\n+  integrity sha512-CImfEr+1ecouGFVGgfCV6Zvx0I3Lw0abxkI8R3BmMleyQcLj8FejCGSFhxIJLKLuxGh/OJXjxoE+PAMTON4O9Q==\n+\n+\"@bazel/esbuild@^4.4.2\":\n   version \"4.4.2\"\n   resolved \"https://registry.yarnpkg.com/@bazel/esbuild/-/esbuild-4.4.2.tgz#e1f35922cc9b63e96cc8c263a77b8e1b2938a445\"\n   integrity sha512-P3cXIje01zsg3TMhTwwbA0sKldYa1J2EGVwahmOPfXlxewd+6cwjhQBQV8SSoxZeFLmCuoMu8eA++mnXgHzm2g==\n@@ -1771,18 +1778,18 @@\n   resolved \"https://registry.yarnpkg.com/@bazel/ibazel/-/ibazel-0.15.10.tgz#cf0cff1aec6d8e7bb23e1fc618d09fbd39b7a13f\"\n   integrity sha512-0v+OwCQ6fsGFa50r6MXWbUkSGuWOoZ22K4pMSdtWiL5LKFIE4kfmMmtQS+M7/ICNwk2EIYob+NRreyi/DGUz5A==\n \n-\"@bazel/jasmine@4.4.2\":\n-  version \"4.4.2\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/jasmine/-/jasmine-4.4.2.tgz#04fc413856984456525d3e2e3ebf7f308e915c54\"\n-  integrity sha512-r0ZUB//pRZnpXiy5keSt2vDQfV/3a9x/kar865CgMJRV+mVQsHMF4l72rQD8LPhGzx4QgX+yOWI2gpAq5E5/zQ==\n+\"@bazel/jasmine@4.4.5\":\n+  version \"4.4.5\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/jasmine/-/jasmine-4.4.5.tgz#e9540f0bffe286f23ce47ab59e6e015cc14c21af\"\n+  integrity sha512-BDWKtDmfux89TtWOhSMSuA01cdaNmdU9/8zrMNQopkTGDBmaDyPYvaxyhBAvQQLMiloOUBcS2eMO/fcSKRyg/A==\n   dependencies:\n     c8 \"~7.5.0\"\n     jasmine-reporters \"~2.4.0\"\n \n-\"@bazel/protractor@4.4.2\":\n-  version \"4.4.2\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/protractor/-/protractor-4.4.2.tgz#0d2b7ba2a003b30d54c1383b3de2e9f7d80642a5\"\n-  integrity sha512-mryiNMyQEEeMubjAM9yZpMIex388kvLxmfhhZpbePxLRG7Nm9Lr4C/+fn7iho3GDAPS04HggQLCYsYj+nQ9Rug==\n+\"@bazel/protractor@4.4.5\":\n+  version \"4.4.5\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/protractor/-/protractor-4.4.5.tgz#b406e85c3d59015e0895c00700396ddd0d58d755\"\n+  integrity sha512-pW4hwkpLpBYHGFp7CO+vHfUXkOoFJBh11+2zFUjEXPaCYAol78Zt2SUzWRYD14CVEDWhxJlI6kCRg7IxW7/S2w==\n \n \"@bazel/rollup@^4.4.2\":\n   version \"4.4.2\"\n@@ -1791,17 +1798,28 @@\n   dependencies:\n     \"@bazel/worker\" \"4.4.2\"\n \n-\"@bazel/runfiles@4.4.2\":\n-  version \"4.4.2\"\n-  resolved \"https://registry.yarnpkg.com/@bazel/runfiles/-/runfiles-4.4.2.tgz#9d424f0f9ad7505d2ff2f854a450b986e132ac8e\"\n-  integrity sha512-Om8T+Chx//6DoxghILc6tUXtXkotvO3I5loNpU76OTf9tgiIZ9wlDtgHkaXxthoe0cYLZFai6GCaKFPyAL+ztw==\n+\"@bazel/runfiles@4.4.5\":\n+  version \"4.4.5\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/runfiles/-/runfiles-4.4.5.tgz#bbf112e882ea37d88f02009bb7cb661ac8908742\"\n+  integrity sha512-tFua24Ra/AI/K2di3sD03gzqG1uf9ziL+gSyc9dwjx9De1z4Fgafnqul9zXf1gqjEdWdJhZYXbntYmyj76BZNw==\n \n \"@bazel/terser@^4.4.2\":\n   version \"4.4.2\"\n   resolved \"https://registry.yarnpkg.com/@bazel/terser/-/terser-4.4.2.tgz#8513730f81388a2434deaf466eeb10cdb9027b6f\"\n   integrity sha512-+eQV6S5qMSy4D5Sm4k/7WrZ9mUP2MiKgWomD4aJfYgv0ME2kkGuOk1QBK055NjBF+Fop5GUKZe0OJM3VFRg01g==\n \n-\"@bazel/typescript@4.4.2\", \"@bazel/typescript@~4.4.2\":\n+\"@bazel/typescript@4.4.5\":\n+  version \"4.4.5\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/typescript/-/typescript-4.4.5.tgz#0b323a292910dbfdc5f90312377e9282c73035f0\"\n+  integrity sha512-Cgq7ZXGkFPAAOn2t9C9JWIDkSjDKB7AkwNgXEwrPwpchKgdoCcD1uMieiErfwBB0FWgJF1xvwwLGOnWA6E/G0A==\n+  dependencies:\n+    \"@bazel/worker\" \"4.4.5\"\n+    protobufjs \"6.8.8\"\n+    semver \"5.6.0\"\n+    source-map-support \"0.5.9\"\n+    tsutils \"3.21.0\"\n+\n+\"@bazel/typescript@~4.4.2\":\n   version \"4.4.2\"\n   resolved \"https://registry.yarnpkg.com/@bazel/typescript/-/typescript-4.4.2.tgz#987000806043d9df1388debcd576420ce5b8c860\"\n   integrity sha512-dTt/AvlnwWiUXF7T25FpAozmLKN9Z+me07iSOcjDv7+6aVcxV5vJTbhpktZO1Ij0oSaYew4I8e/NlRf/mS2k7g==\n@@ -1819,6 +1837,13 @@\n   dependencies:\n     google-protobuf \"^3.6.1\"\n \n+\"@bazel/worker@4.4.5\":\n+  version \"4.4.5\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/worker/-/worker-4.4.5.tgz#1f9292c31615dff8a7297960f7f520bf9febf428\"\n+  integrity sha512-PoBMiN0SGSb1Qn/SabiM9HWC5nqwyWn0yTJgz6Vq2GMHo1UG7olVHuIfDb2ScFx9jY+mJ3wSyxQ4htlTGldedA==\n+  dependencies:\n+    google-protobuf \"^3.6.1\"\n+\n \"@bcoe/v8-coverage@^0.2.3\":\n   version \"0.2.3\"\n   resolved \"https://registry.yarnpkg.com/@bcoe/v8-coverage/-/v8-coverage-0.2.3.tgz#75a2e8b51cb758a7553d6804a5932d7aace75c39\"\n@@ -10623,10 +10648,10 @@ rollup@2.44.0:\n   optionalDependencies:\n     fsevents \"~2.3.1\"\n \n-rollup@2.59.0:\n-  version \"2.59.0\"\n-  resolved \"https://registry.yarnpkg.com/rollup/-/rollup-2.59.0.tgz#108c61b0fa0a37ebc8d1f164f281622056f0db59\"\n-  integrity sha512-l7s90JQhCQ6JyZjKgo7Lq1dKh2RxatOM+Jr6a9F7WbS9WgKbocyUSeLmZl8evAse7y96Ae98L2k1cBOwWD8nHw==\n+rollup@2.60.0:\n+  version \"2.60.0\"\n+  resolved \"https://registry.yarnpkg.com/rollup/-/rollup-2.60.0.tgz#4ee60ab7bdd0356763f87d7099f413e5460fc193\"\n+  integrity sha512-cHdv9GWd58v58rdseC8e8XIaPUo8a9cgZpnCMMDGZFDZKEODOiPPEQFXLriWr/TjXzhPPmG5bkAztPsOARIcGQ==\n   optionalDependencies:\n     fsevents \"~2.3.2\"\n \n@@ -11828,6 +11853,11 @@ trim-newlines@^3.0.0:\n   resolved \"https://registry.yarnpkg.com/trim-newlines/-/trim-newlines-3.0.1.tgz#260a5d962d8b752425b32f3a7db0dcacd176c144\"\n   integrity sha512-c1PTsA3tYrIsLGkJkzHF+w9F2EyxfXGo4UyJc4pFL++FMjnq0HJS69T3M7d//gKrFKwy429bouPescbjecU+Zw==\n \n+\"true-case-path@^2.2.1\":\n+  version \"2.2.1\"\n+  resolved \"https://registry.yarnpkg.com/true-case-path/-/true-case-path-2.2.1.tgz#c5bf04a5bbec3fd118be4084461b3a27c4d796bf\"\n+  integrity sha512-0z3j8R7MCjy10kc/g+qg7Ln3alJTodw9aDuVWZa3uiWqfuBMKeAeP2ocWcxoyM3D73yz3Jt/Pu4qPr4wHSdB/Q==\n+\n ts-node@^10.2.1:\n   version \"10.4.0\"\n   resolved \"https://registry.yarnpkg.com/ts-node/-/ts-node-10.4.0.tgz#680f88945885f4e6cf450e7f0d6223dd404895f7\""
        }
    ],
    "stats": {
        "total": 1130,
        "additions": 96,
        "deletions": 1034
    }
}