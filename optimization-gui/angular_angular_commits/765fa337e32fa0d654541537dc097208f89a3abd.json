{
    "author": "bjarkler",
    "message": "fix(compiler): use Trusted Types policy in JIT compiler (#39210)\n\nThe JIT compiler uses the Function constructor to compile arbitrary\nstrings into executable code at runtime, which causes Trusted Types\nviolations. To address this, JitEvaluator is instead made to use the\nTrusted Types compatible Function constructor introduced by Angular's\nTrusted Types policy for JIT.\n\nPR Close #39210",
    "sha": "765fa337e32fa0d654541537dc097208f89a3abd",
    "files": [
        {
            "sha": "d672098bcaa8f6337b7173d04a279cd03803d20c",
            "filename": "packages/compiler/src/output/output_jit.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/765fa337e32fa0d654541537dc097208f89a3abd/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_jit.ts",
            "raw_url": "https://github.com/angular/angular/raw/765fa337e32fa0d654541537dc097208f89a3abd/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_jit.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_jit.ts?ref=765fa337e32fa0d654541537dc097208f89a3abd",
            "patch": "@@ -12,6 +12,7 @@ import {CompileReflector} from '../compile_reflector';\n import {EmitterVisitorContext} from './abstract_emitter';\n import {AbstractJsEmitterVisitor} from './abstract_js_emitter';\n import * as o from './output_ast';\n+import {newTrustedFunctionForJIT} from './output_jit_trusted_types';\n \n /**\n  * A helper class to manage the evaluation of JIT generated code.\n@@ -69,11 +70,11 @@ export class JitEvaluator {\n       // function anonymous(a,b,c\n       // /**/) { ... }```\n       // We don't want to hard code this fact, so we auto detect it via an empty function first.\n-      const emptyFn = new Function(...fnArgNames.concat('return null;')).toString();\n+      const emptyFn = newTrustedFunctionForJIT(...fnArgNames.concat('return null;')).toString();\n       const headerLines = emptyFn.slice(0, emptyFn.indexOf('return null;')).split('\\n').length - 1;\n       fnBody += `\\n${ctx.toSourceMapGenerator(sourceUrl, headerLines).toJsComment()}`;\n     }\n-    const fn = new Function(...fnArgNames.concat(fnBody));\n+    const fn = newTrustedFunctionForJIT(...fnArgNames.concat(fnBody));\n     return this.executeFunction(fn, fnArgValues);\n   }\n "
        }
    ],
    "stats": {
        "total": 5,
        "additions": 3,
        "deletions": 2
    }
}