{
    "author": "AleksanderBodurri",
    "message": "ci: add labels to angular devtools ci tasks\n\nThis commit also cleans up the .bazelrc file in the devtools directory",
    "sha": "e5cdd3397da57030f26de185cd5cd124063d092a",
    "files": [
        {
            "sha": "862fb7aa4aebad0b145ee7ebb10991938d5d1a8e",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 18,
            "deletions": 6,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/e5cdd3397da57030f26de185cd5cd124063d092a/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/angular/angular/raw/e5cdd3397da57030f26de185cd5cd124063d092a/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.circleci%2Fconfig.yml?ref=e5cdd3397da57030f26de185cd5cd124063d092a",
            "patch": "@@ -739,12 +739,24 @@ jobs:\n     steps:\n       - custom_attach_workspace\n       - init_environment\n-      - run: sudo apt-get update\n-      - run: sudo apt-get -y install libgtk-3-0 libasound2 libnss3 libxss1 libdrm2 libgbm-dev libxshmfence-dev libgtk2.0-0 libnotify-dev libgconf-2-4 libxtst6 xauth xvfb\n-      - run: yarn --cwd devtools install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n-      - run: yarn --cwd devtools test:ci\n-      - run: yarn --cwd devtools build:chrome\n-      - run: yarn --cwd devtools cy:ci\n+      - run:\n+          name: Sync package index files\n+          command: sudo apt-get update\n+      - run:\n+          name: Install Karma and Cypress dependencies\n+          command: sudo apt-get -y install libgtk-3-0 libasound2 libnss3 libxss1 libdrm2 libgbm-dev libxshmfence-dev libgtk2.0-0 libnotify-dev libgconf-2-4 libxtst6 xauth xvfb\n+      - run:\n+          name: Install DevTools dependencies\n+          command: yarn --cwd devtools install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n+      - run:\n+          name: Run unit tests\n+          command: yarn --cwd devtools test:ci\n+      - run:\n+          name: Test production build\n+          command: yarn --cwd devtools build:chrome:ci\n+      - run:\n+          name: Run e2e tests\n+          command: yarn --cwd devtools cy:ci\n \n workflows:\n   version: 2"
        },
        {
            "sha": "fee53071f79ecee86e57fb57abc7644b06b18e4c",
            "filename": "devtools/.bazelrc",
            "status": "modified",
            "additions": 0,
            "deletions": 24,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/e5cdd3397da57030f26de185cd5cd124063d092a/devtools%2F.bazelrc",
            "raw_url": "https://github.com/angular/angular/raw/e5cdd3397da57030f26de185cd5cd124063d092a/devtools%2F.bazelrc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2F.bazelrc?ref=e5cdd3397da57030f26de185cd5cd124063d092a",
            "patch": "@@ -1,27 +1,3 @@\n-# These options are enabled when running on CI\n-# We do this by copying this file to /etc/bazel.bazelrc at the start of the build.\n-# See documentation in /docs/BAZEL.md\n-\n-# Import config items common to both Linux and Windows setups.\n-# https://docs.bazel.build/versions/master/guide.html#bazelrc-syntax-and-semantics\n-try-import %workspace%/.circleci/bazel.common.rc\n-\n-# Save downloaded repositories in a location that can be cached by CircleCI. This helps us\n-# speeding up the analysis time significantly with Bazel managed node dependencies on the CI.\n-build --repository_cache=/home/circleci/bazel_repository_cache\n-\n-# Workaround https://github.com/bazelbuild/bazel/issues/3645\n-# Bazel doesn't calculate the memory ceiling correctly when running under Docker.\n-# Limit Bazel to consuming resources that fit in CircleCI \"xlarge\" class\n-# https://circleci.com/docs/2.0/configuration-reference/#resource_class\n-build --local_cpu_resources=20\n-build --local_ram_resources=32768\n-\n-# All build executed remotely should be done using our RBE configuration.\n-build:remote --google_default_credentials\n-\n-build --config=remote\n-\n import ../.bazelrc\n \n build --flag_alias=partial_compilation=@npm//@angular/bazel/src:partial_compilation"
        },
        {
            "sha": "b27ec16a2fe9e4835569a8f55c519e1881a5cd91",
            "filename": "devtools/package.json",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/e5cdd3397da57030f26de185cd5cd124063d092a/devtools%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/e5cdd3397da57030f26de185cd5cd124063d092a/devtools%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/devtools%2Fpackage.json?ref=e5cdd3397da57030f26de185cd5cd124063d092a",
            "patch": "@@ -6,21 +6,22 @@\n     \"ng\": \"ng\",\n     \"cypress:verify\": \"cypress verify\",\n     \"start\": \"ibazel run src:devserver\",\n-    \"start-no-animations\": \"bazel run src:devserver-e2e\",\n-    \"build:chrome\": \"bazel build projects/shell-chrome/src:prodapp\",\n+    \"start-no-animations\": \"bazelisk run src:devserver-e2e\",\n+    \"build:chrome\": \"bazelisk build projects/shell-chrome/src:prodapp\",\n     \"build:chrome:watch\": \"ibazel build projects/shell-chrome/src:prodapp\",\n     \"release\": \"node projects/shell-chrome/set-version.js && build:chrome\",\n-    \"test\": \"bazelisk test ...\",\n+    \"test\": \"bazelisk test //...\",\n     \"lint\": \"tslint -p tsconfig.json -c tslint.json\",\n     \"lint:fix\": \"tslint -p tsconfig.json -c tslint.json --fix\",\n     \"e2e\": \"yarn cy:run\",\n     \"cy:verify\": \"$(yarn bin)/cypress verify\",\n     \"cy:version\": \"$(yarn bin)/cypress version\",\n     \"cy:run\": \"yarn cypress run\",\n     \"cy:open\": \"yarn cypress open\",\n-    \"cy:ci\": \"start-server-and-test start http-get://localhost:4200 cy:run\",\n     \"cy:watch\": \"start-server-and-test start http-get://localhost:4200 cy:open\",\n-    \"test:ci\": \"bazelisk test //...\",\n+    \"cy:ci\": \"start-server-and-test start http-get://localhost:4200 cy:run\",\n+    \"test:ci\": \"bazelisk --bazelrc=../.circleci/bazel.linux.rc test //...\",\n+    \"build:chrome:ci\": \"bazelisk build projects/shell-chrome/src:prodapp\",\n     \"prettier\": \"prettier --write \\\"{,!(node_modules|dist|build|coverage)/**/}*.{js,jsx,ts,tsx,json}\\\"\",\n     \"prettier:fix\": \"pretty-quick --staged\"\n   },"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 24,
        "deletions": 35
    }
}