{
    "author": "atscott",
    "message": "docs(router): Add documentation for the router reset rawUrlTree (#43420)\n\nAdd documentation to the router and an additional test based on more\ncomplete understanding of how things work.\n\nPR Close #43420",
    "sha": "79eee5509fdc5e6c4c699fc01491491a9e752e5c",
    "files": [
        {
            "sha": "832d81e6126cec325134648ef0c9cd7dad77468f",
            "filename": "packages/router/src/router.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/79eee5509fdc5e6c4c699fc01491491a9e752e5c/packages%2Frouter%2Fsrc%2Frouter.ts",
            "raw_url": "https://github.com/angular/angular/raw/79eee5509fdc5e6c4c699fc01491491a9e752e5c/packages%2Frouter%2Fsrc%2Frouter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Frouter.ts?ref=79eee5509fdc5e6c4c699fc01491491a9e752e5c",
            "patch": "@@ -565,6 +565,10 @@ export class Router {\n    * button is clicked and the navigation is cancelled, the Router will trigger a forward navigation\n    * and vice versa.\n    *\n+   * Note: the 'computed' option is incompatible with any `UrlHandlingStrategy` which only\n+   * handles a portion of the URL because the history restoration navigates to the previous place in\n+   * the browser history rather than simply resetting a portion of the URL.\n+   *\n    * The default value is `replace`.\n    *\n    */\n@@ -1538,6 +1542,11 @@ export class Router {\n   private resetState(t: NavigationTransition): void {\n     (this as {routerState: RouterState}).routerState = t.currentRouterState;\n     this.currentUrlTree = t.currentUrlTree;\n+    // Note here that we use the urlHandlingStrategy to get the reset `rawUrlTree` because it may be\n+    // configured to handle only part of the navigation URL. This means we would only want to reset\n+    // the part of the navigation handled by the Angular router rather than the whole URL. In\n+    // addition, the URLHandlingStrategy may be configured to specifically preserve parts of the URL\n+    // when merging, such as the query params so they are not lost on a refresh.\n     this.rawUrlTree = this.urlHandlingStrategy.merge(this.currentUrlTree, t.rawUrl);\n   }\n "
        },
        {
            "sha": "713c8e58d7eca414bf04f62bebb27377147df4a8",
            "filename": "packages/router/test/integration.spec.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/79eee5509fdc5e6c4c699fc01491491a9e752e5c/packages%2Frouter%2Ftest%2Fintegration.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/79eee5509fdc5e6c4c699fc01491491a9e752e5c/packages%2Frouter%2Ftest%2Fintegration.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fintegration.spec.ts?ref=79eee5509fdc5e6c4c699fc01491491a9e752e5c",
            "patch": "@@ -5548,6 +5548,30 @@ describe('Integration', () => {\n              [NavigationEnd, '/include/simple']\n            ]);\n          })));\n+\n+      it('should not reset parts of the URL not handled by the router', fakeAsync(() => {\n+           const location = TestBed.inject(Location) as SpyLocation;\n+           const router = TestBed.inject(Router);\n+           const fixture = createRoot(router, RootCmp);\n+\n+           router.resetConfig([{\n+             path: 'include',\n+             component: TeamCmp,\n+             children:\n+                 [{path: 'user/:name', component: UserCmp}, {path: 'simple', component: SimpleCmp}]\n+           }]);\n+\n+           try {\n+             location.simulateHashChange('/include/butThisPartNotFound(aux:excluded)');\n+             advance(fixture);\n+           } catch (e) {\n+           }\n+           // The router only handled the primary URL. So it processes the navigation and then\n+           // cannot match the `butThisPartNotFound` part to a URL, throws an error, and then\n+           // resets the state in the `catchError` block. The excluded part of the URL _should not_\n+           // be reset because it might be handled by another application.\n+           expect(location.path()).toEqual('/(aux:excluded)');\n+         }));\n     });\n \n     it('can use `relativeTo` `route.parent` in `routerLink` to close secondary outlet',"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 33,
        "deletions": 0
    }
}