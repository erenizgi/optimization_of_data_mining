{
    "author": "naveedahmed1",
    "message": "fix(service-worker): clear service worker cache in safety worker (#43324)\n\nclear angular service worker cache in safety worker to ensure stale\nor broken contents are not served in future requests\n\nFixes #43163\n\nPR Close #43324",
    "sha": "59353c6305076e1ac1b38aa0a1653a7404beb963",
    "files": [
        {
            "sha": "3eabc28fae4c95bb5b614802b3a9801920b1a349",
            "filename": "aio/content/guide/service-worker-devops.md",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/59353c6305076e1ac1b38aa0a1653a7404beb963/aio%2Fcontent%2Fguide%2Fservice-worker-devops.md",
            "raw_url": "https://github.com/angular/angular/raw/59353c6305076e1ac1b38aa0a1653a7404beb963/aio%2Fcontent%2Fguide%2Fservice-worker-devops.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fguide%2Fservice-worker-devops.md?ref=59353c6305076e1ac1b38aa0a1653a7404beb963",
            "patch": "@@ -326,8 +326,9 @@ essentially self-destructing.\n \n Also included in the `@angular/service-worker` NPM package is a small\n script `safety-worker.js`, which when loaded will unregister itself\n-from the browser. This script can be used as a last resort to get rid\n-of unwanted service workers already installed on client pages.\n+from the browser and remove the service worker caches. This script can\n+be used as a last resort to get rid of unwanted service workers already \n+installed on client pages.\n \n It's important to note that you cannot register this worker directly,\n as old clients with cached state may not see a new `index.html` which\n@@ -339,8 +340,8 @@ most sites, this means that you should serve the safety worker at the\n old Service Worker URL forever.\n \n This script can be used both to deactivate `@angular/service-worker`\n-as well as any other Service Workers which might have been served in\n-the past on your site.\n+(and remove the corresponding caches) as well as any other Service\n+Workers which might have been served in the past on your site.\n \n ### Changing your app's location\n "
        },
        {
            "sha": "d98014b5f69c7e699fa35f94b478ada4f1746f5d",
            "filename": "packages/service-worker/safety-worker.js",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/59353c6305076e1ac1b38aa0a1653a7404beb963/packages%2Fservice-worker%2Fsafety-worker.js",
            "raw_url": "https://github.com/angular/angular/raw/59353c6305076e1ac1b38aa0a1653a7404beb963/packages%2Fservice-worker%2Fsafety-worker.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fsafety-worker.js?ref=59353c6305076e1ac1b38aa0a1653a7404beb963",
            "patch": "@@ -14,7 +14,13 @@ self.addEventListener('install', event => {\n \n self.addEventListener('activate', event => {\n   event.waitUntil(self.clients.claim());\n-  self.registration.unregister().then(() => {\n+\n+  event.waitUntil(self.registration.unregister().then(() => {\n     console.log('NGSW Safety Worker - unregistered old service worker');\n-  });\n+  }));\n+\n+  event.waitUntil(caches.keys().then(cacheNames => {\n+    const ngswCacheNames = cacheNames.filter(name => /^ngsw:/.test(name));\n+    return Promise.all(ngswCacheNames.map(name => caches.delete(name)));\n+  }));\n });"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 13,
        "deletions": 6
    }
}