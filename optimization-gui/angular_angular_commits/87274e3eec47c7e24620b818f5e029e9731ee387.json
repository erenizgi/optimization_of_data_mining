{
    "author": "petebacondarwin",
    "message": "refactor(ngcc): rename `ExportStatement` to `ExportsStatement` (#38959)\n\nThis clarifies that this is specifically about statements of the form\n`exports.<name> = <declaration>`, rather than a general export\nstatement such as `export class <ClassName> { ... }`.\n\nPR Close #38959",
    "sha": "87274e3eec47c7e24620b818f5e029e9731ee387",
    "files": [
        {
            "sha": "a2f8012b0a57948f00cffdcc64ce0460f1a1842c",
            "filename": "packages/compiler-cli/ngcc/src/host/commonjs_host.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/87274e3eec47c7e24620b818f5e029e9731ee387/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fcommonjs_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/87274e3eec47c7e24620b818f5e029e9731ee387/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fcommonjs_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fcommonjs_host.ts?ref=87274e3eec47c7e24620b818f5e029e9731ee387",
            "patch": "@@ -14,7 +14,7 @@ import {Declaration, Import} from '../../../src/ngtsc/reflection';\n import {BundleProgram} from '../packages/bundle_program';\n import {FactoryMap, isDefined} from '../utils';\n \n-import {DefinePropertyReexportStatement, ExportDeclaration, ExportStatement, extractGetterFnExpression, findNamespaceOfIdentifier, findRequireCallReference, isDefinePropertyReexportStatement, isExportStatement, isExternalImport, isRequireCall, isWildcardReexportStatement, RequireCall, WildcardReexportStatement} from './commonjs_umd_utils';\n+import {DefinePropertyReexportStatement, ExportDeclaration, ExportsStatement, extractGetterFnExpression, findNamespaceOfIdentifier, findRequireCallReference, isDefinePropertyReexportStatement, isExportsStatement, isExternalImport, isRequireCall, isWildcardReexportStatement, RequireCall, WildcardReexportStatement} from './commonjs_umd_utils';\n import {Esm5ReflectionHost} from './esm5_host';\n import {NgccClassSymbol} from './ngcc_host';\n \n@@ -98,7 +98,7 @@ export class CommonJsReflectionHost extends Esm5ReflectionHost {\n   private computeExportsOfCommonJsModule(sourceFile: ts.SourceFile): Map<string, Declaration> {\n     const moduleMap = new Map<string, Declaration>();\n     for (const statement of this.getModuleStatements(sourceFile)) {\n-      if (isExportStatement(statement)) {\n+      if (isExportsStatement(statement)) {\n         const exportDeclaration = this.extractBasicCommonJsExportDeclaration(statement);\n         moduleMap.set(exportDeclaration.name, exportDeclaration.declaration);\n       } else if (isWildcardReexportStatement(statement)) {\n@@ -116,7 +116,7 @@ export class CommonJsReflectionHost extends Esm5ReflectionHost {\n     return moduleMap;\n   }\n \n-  private extractBasicCommonJsExportDeclaration(statement: ExportStatement): ExportDeclaration {\n+  private extractBasicCommonJsExportDeclaration(statement: ExportsStatement): ExportDeclaration {\n     const exportExpression = statement.expression.right;\n     const name = statement.expression.left.name.text;\n     return this.extractCommonJsExportDeclaration(name, exportExpression);"
        },
        {
            "sha": "1a1652832be78518dfe5aecf1ddb91ad09970761",
            "filename": "packages/compiler-cli/ngcc/src/host/commonjs_umd_utils.ts",
            "status": "modified",
            "additions": 63,
            "deletions": 22,
            "changes": 85,
            "blob_url": "https://github.com/angular/angular/blob/87274e3eec47c7e24620b818f5e029e9731ee387/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fcommonjs_umd_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/87274e3eec47c7e24620b818f5e029e9731ee387/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fcommonjs_umd_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fcommonjs_umd_utils.ts?ref=87274e3eec47c7e24620b818f5e029e9731ee387",
            "patch": "@@ -8,22 +8,13 @@\n \n import * as ts from 'typescript';\n import {Declaration} from '../../../src/ngtsc/reflection';\n-\n+import {isAssignment} from '../../../src/ngtsc/util/src/typescript';\n \n export interface ExportDeclaration {\n   name: string;\n   declaration: Declaration;\n }\n \n-export interface ExportStatement extends ts.ExpressionStatement {\n-  expression: ts.BinaryExpression&{\n-    left: ts.PropertyAccessExpression &\n-        {\n-          expression: ts.Identifier\n-        }\n-  };\n-}\n-\n /**\n  * A CommonJS or UMD wildcard re-export statement.\n  *\n@@ -59,6 +50,9 @@ export interface DefinePropertyReexportStatement extends ts.ExpressionStatement\n       {arguments: [ts.Identifier, ts.StringLiteral, ts.ObjectLiteralExpression]};\n }\n \n+/**\n+ * A call expression that has a string literal for its first argument.\n+ */\n export interface RequireCall extends ts.CallExpression {\n   arguments: ts.CallExpression['arguments']&[ts.StringLiteral];\n }\n@@ -90,18 +84,6 @@ export function findRequireCallReference(id: ts.Identifier, checker: ts.TypeChec\n   return initializer && isRequireCall(initializer) ? initializer : null;\n }\n \n-/**\n- * Check whether the specified `ts.Statement` is an export statement, i.e. an expression statement\n- * of the form: `exports.<foo> = <bar>`\n- */\n-export function isExportStatement(stmt: ts.Statement): stmt is ExportStatement {\n-  return ts.isExpressionStatement(stmt) && ts.isBinaryExpression(stmt.expression) &&\n-      (stmt.expression.operatorToken.kind === ts.SyntaxKind.EqualsToken) &&\n-      ts.isPropertyAccessExpression(stmt.expression.left) &&\n-      ts.isIdentifier(stmt.expression.left.expression) &&\n-      stmt.expression.left.expression.text === 'exports';\n-}\n-\n /**\n  * Check whether the specified `ts.Statement` is a wildcard re-export statement.\n  * I.E. an expression statement of one of the following forms:\n@@ -194,6 +176,12 @@ export function isDefinePropertyReexportStatement(stmt: ts.Statement):\n       prop => prop.name !== undefined && ts.isIdentifier(prop.name) && prop.name.text === 'get'));\n }\n \n+/**\n+ * Extract the \"value\" of the getter in a `defineProperty` statement.\n+ *\n+ * This will return the `ts.Expression` value of a single `return` statement in the `get` method\n+ * of the property definition object, or `null` if that is not possible.\n+ */\n export function extractGetterFnExpression(statement: DefinePropertyReexportStatement):\n     ts.Expression|null {\n   const args = statement.expression.arguments;\n@@ -220,6 +208,59 @@ export function isRequireCall(node: ts.Node): node is RequireCall {\n       ts.isStringLiteral(node.arguments[0]);\n }\n \n+/**\n+ * Check whether the specified `path` is an \"external\" import.\n+ * In other words, that it comes from a entry-point outside the current one.\n+ */\n export function isExternalImport(path: string): boolean {\n   return !/^\\.\\.?(\\/|$)/.test(path);\n }\n+\n+/**\n+ * A UMD/CommonJS style export declaration of the form `exports.<name>`.\n+ */\n+export interface ExportsDeclaration extends ts.PropertyAccessExpression {\n+  name: ts.Identifier;\n+  expression: ts.Identifier;\n+  parent: ExportsAssignment;\n+}\n+\n+/**\n+ * Check whether the specified `node` is a property access expression of the form\n+ * `exports.<foo>`.\n+ */\n+export function isExportsDeclaration(expr: ts.Node): expr is ExportsDeclaration {\n+  return expr.parent && isExportsAssignment(expr.parent);\n+}\n+\n+/**\n+ * A UMD/CommonJS style export assignment of the form `exports.<foo> = <bar>`.\n+ */\n+export interface ExportsAssignment extends ts.BinaryExpression {\n+  left: ExportsDeclaration;\n+}\n+\n+/**\n+ * Check whether the specified `node` is an assignment expression of the form\n+ * `exports.<foo> = <bar>`.\n+ */\n+export function isExportsAssignment(expr: ts.Node): expr is ExportsAssignment {\n+  return isAssignment(expr) && ts.isPropertyAccessExpression(expr.left) &&\n+      ts.isIdentifier(expr.left.expression) && expr.left.expression.text === 'exports' &&\n+      ts.isIdentifier(expr.left.name);\n+}\n+\n+/**\n+ * An expression statement of the form `exports.<foo> = <bar>;`.\n+ */\n+export interface ExportsStatement extends ts.ExpressionStatement {\n+  expression: ExportsAssignment;\n+}\n+\n+/**\n+ * Check whether the specified `stmt` is an expression statement of the form\n+ * `exports.<foo> = <bar>;`.\n+ */\n+export function isExportsStatement(stmt: ts.Node): stmt is ExportsStatement {\n+  return ts.isExpressionStatement(stmt) && isExportsAssignment(stmt.expression);\n+}"
        },
        {
            "sha": "d91805e0cba19afcb3b2060adaed1ed716e426fe",
            "filename": "packages/compiler-cli/ngcc/src/host/umd_host.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/87274e3eec47c7e24620b818f5e029e9731ee387/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fumd_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/87274e3eec47c7e24620b818f5e029e9731ee387/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fumd_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fumd_host.ts?ref=87274e3eec47c7e24620b818f5e029e9731ee387",
            "patch": "@@ -14,7 +14,7 @@ import {Declaration, Import} from '../../../src/ngtsc/reflection';\n import {BundleProgram} from '../packages/bundle_program';\n import {FactoryMap, getTsHelperFnFromIdentifier, stripExtension} from '../utils';\n \n-import {DefinePropertyReexportStatement, ExportDeclaration, ExportStatement, extractGetterFnExpression, findNamespaceOfIdentifier, findRequireCallReference, isDefinePropertyReexportStatement, isExportStatement, isExternalImport, isRequireCall, isWildcardReexportStatement, WildcardReexportStatement} from './commonjs_umd_utils';\n+import {DefinePropertyReexportStatement, ExportDeclaration, ExportsStatement, extractGetterFnExpression, findNamespaceOfIdentifier, findRequireCallReference, isDefinePropertyReexportStatement, isExportsStatement, isExternalImport, isRequireCall, isWildcardReexportStatement, WildcardReexportStatement} from './commonjs_umd_utils';\n import {Esm5ReflectionHost} from './esm5_host';\n import {stripParentheses} from './utils';\n \n@@ -90,7 +90,7 @@ export class UmdReflectionHost extends Esm5ReflectionHost {\n   private computeExportsOfUmdModule(sourceFile: ts.SourceFile): Map<string, Declaration>|null {\n     const moduleMap = new Map<string, Declaration>();\n     for (const statement of this.getModuleStatements(sourceFile)) {\n-      if (isExportStatement(statement)) {\n+      if (isExportsStatement(statement)) {\n         const exportDeclaration = this.extractBasicUmdExportDeclaration(statement);\n         moduleMap.set(exportDeclaration.name, exportDeclaration.declaration);\n       } else if (isWildcardReexportStatement(statement)) {\n@@ -132,7 +132,7 @@ export class UmdReflectionHost extends Esm5ReflectionHost {\n     return importPath;\n   }\n \n-  private extractBasicUmdExportDeclaration(statement: ExportStatement): ExportDeclaration {\n+  private extractBasicUmdExportDeclaration(statement: ExportsStatement): ExportDeclaration {\n     const name = statement.expression.left.name.text;\n     const exportExpression = statement.expression.right;\n     return this.extractUmdExportDeclaration(name, exportExpression);"
        }
    ],
    "stats": {
        "total": 97,
        "additions": 69,
        "deletions": 28
    }
}