{
    "author": "gkalpak",
    "message": "ci: log commands output when deploying angular.io to Firebase (#39596)\n\nIn #39470, the `deploy-to-firebase.sh` script (used to deploy AIO to\nFirebase when building an upstream branch), was replaced by an\nequivalent JS script. In this new `deploy-to-firebase.js` script, we\nwere overly aggressive with suppressing command output, which made it\nhard to investigate failures ([example failing CI job][1]).\n\nThis commit updates the `deploy-to-firebase.js` script to capture\ncommand output as usual in the CI job logs. This makes the output\nsimilar to the one generated by the old [deploy-to-firebase.sh][2]\nscript ([example CI logs][3]).\n\nOne concern with capturing command output is having the value of a\nsecret environment variables leaked in the logs. This is not the case\nhere, since:\n1. The secret env vars are not printed from the commands that use them.\n2. CircleCI will [mask the values of secret env vars][4] in the output.\n\nAs an extra precaution (although not strictly necessary), we run `yarn`\nwith the `--silent` option, which avoid echoing the executed yarn\ncommands.\n\n[1]: https://circleci.com/gh/angular/angular/849310\n[2]: https://github.com/angular/angular/blob/3b0b7d22109c79b4dceb/aio/scripts/deploy-to-firebase.sh\n[3]: https://circleci.com/gh/angular/angular/848109\n[4]: https://circleci.com/docs/2.0/env-vars/#secrets-masking\n\nPR Close #39596",
    "sha": "0edf6fc7f6024cc94c17f60bbb55977b631a73d2",
    "files": [
        {
            "sha": "b2975f9a33576973304c398da9385c6cbf92ab2e",
            "filename": "aio/scripts/deploy-to-firebase.js",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/0edf6fc7f6024cc94c17f60bbb55977b631a73d2/aio%2Fscripts%2Fdeploy-to-firebase.js",
            "raw_url": "https://github.com/angular/angular/raw/0edf6fc7f6024cc94c17f60bbb55977b631a73d2/aio%2Fscripts%2Fdeploy-to-firebase.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Fdeploy-to-firebase.js?ref=0edf6fc7f6024cc94c17f60bbb55977b631a73d2",
            "patch": "@@ -4,7 +4,7 @@\n //\n 'use strict';\n \n-const {cd, cp, exec: _exec, set} = require('shelljs');\n+const {cd, cp, exec, set} = require('shelljs');\n \n set('-e');\n \n@@ -187,13 +187,8 @@ function deploy(\n   yarn(`test-pwa-score \"${deployedUrl}\" \"${minPwaScore}\"`);\n }\n \n-function exec(cmd, opts) {\n-  // Using `silent: true` to ensure no secret env variables are printed.\n-  return _exec(cmd, {silent: true, ...opts}).trim();\n-}\n-\n function getRemoteRefs(refOrPattern, remote = NG_REMOTE_URL) {\n-  return exec(`git ls-remote ${remote} ${refOrPattern}`).split('\\n');\n+  return exec(`git ls-remote ${remote} ${refOrPattern}`, {silent: true}).trim().split('\\n');\n }\n \n function getLatestCommit(branchName, remote = undefined) {\n@@ -206,5 +201,10 @@ function skipDeployment(reason) {\n \n function yarn(cmd) {\n   // Using `--silent` to ensure no secret env variables are printed.\n+  //\n+  // NOTE:\n+  // This is not strictly necessary, since CircleCI will mask secret environment variables in the\n+  // output (see https://circleci.com/docs/2.0/env-vars/#secrets-masking), but is an extra\n+  // precaution.\n   return exec(`yarn --silent ${cmd}`);\n }"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 7,
        "deletions": 7
    }
}