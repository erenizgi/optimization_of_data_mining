{
    "author": "ranma42",
    "message": "fix(common): correct and simplify typing of `KeyValuePipe` (#37447)\n\nAs shown in the tests, `KeyValuePipe.transform` can accept\n`undefined`, in which case it always returns `null`.\n\nAdditionally, the typing for `string` keys can be made generic, so the\ncomparison function is only required to accept the relevant cases.\n\nFinally, the typing for `number` records now shows that the comparison\nfunction and the result entries will actually receive the string version\nof the numeric keys, just as shown in the tests.\n\nBREAKING CHANGE:\nThe typing of the `keyvalue` pipe has been fixed to report that for\ninput objects that have `number` keys, the result will contain the\nstring representation of the keys. This was already the case and the\ncode has simply been updated to reflect this. Please update the\nconsumers of the pipe output if they were relying on the incorrect\ntypes. Note that this does not affect use cases where the input values\nare `Map`s, so if you need to preserve `number`s, this is an effective\nway.\n\nPR Close #37447",
    "sha": "4dfe0fa068007c28ca3b4a1476ed4ba1d2d86064",
    "files": [
        {
            "sha": "89ac6ad48e511605f73c3826f5f138d3a306ce97",
            "filename": "goldens/public-api/common/common.d.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 14,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/4dfe0fa068007c28ca3b4a1476ed4ba1d2d86064/goldens%2Fpublic-api%2Fcommon%2Fcommon.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/4dfe0fa068007c28ca3b4a1476ed4ba1d2d86064/goldens%2Fpublic-api%2Fcommon%2Fcommon.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fcommon%2Fcommon.d.ts?ref=4dfe0fa068007c28ca3b4a1476ed4ba1d2d86064",
            "patch": "@@ -140,21 +140,13 @@ export declare interface KeyValue<K, V> {\n \n export declare class KeyValuePipe implements PipeTransform {\n     constructor(differs: KeyValueDiffers);\n-    transform<K, V>(input: null, compareFn?: (a: KeyValue<K, V>, b: KeyValue<K, V>) => number): null;\n-    transform<V>(input: {\n-        [key: string]: V;\n-    } | ReadonlyMap<string, V>, compareFn?: (a: KeyValue<string, V>, b: KeyValue<string, V>) => number): Array<KeyValue<string, V>>;\n-    transform<V>(input: {\n-        [key: string]: V;\n-    } | ReadonlyMap<string, V> | null, compareFn?: (a: KeyValue<string, V>, b: KeyValue<string, V>) => number): Array<KeyValue<string, V>> | null;\n-    transform<V>(input: {\n-        [key: number]: V;\n-    } | ReadonlyMap<number, V>, compareFn?: (a: KeyValue<number, V>, b: KeyValue<number, V>) => number): Array<KeyValue<number, V>>;\n-    transform<V>(input: {\n-        [key: number]: V;\n-    } | ReadonlyMap<number, V> | null, compareFn?: (a: KeyValue<number, V>, b: KeyValue<number, V>) => number): Array<KeyValue<number, V>> | null;\n     transform<K, V>(input: ReadonlyMap<K, V>, compareFn?: (a: KeyValue<K, V>, b: KeyValue<K, V>) => number): Array<KeyValue<K, V>>;\n-    transform<K, V>(input: ReadonlyMap<K, V> | null, compareFn?: (a: KeyValue<K, V>, b: KeyValue<K, V>) => number): Array<KeyValue<K, V>> | null;\n+    transform<K extends number, V>(input: Record<K, V>, compareFn?: (a: KeyValue<string, V>, b: KeyValue<string, V>) => number): Array<KeyValue<string, V>>;\n+    transform<K extends string, V>(input: Record<K, V> | ReadonlyMap<K, V>, compareFn?: (a: KeyValue<K, V>, b: KeyValue<K, V>) => number): Array<KeyValue<K, V>>;\n+    transform(input: null | undefined, compareFn?: (a: KeyValue<unknown, unknown>, b: KeyValue<unknown, unknown>) => number): null;\n+    transform<K, V>(input: ReadonlyMap<K, V> | null | undefined, compareFn?: (a: KeyValue<K, V>, b: KeyValue<K, V>) => number): Array<KeyValue<K, V>> | null;\n+    transform<K extends number, V>(input: Record<K, V> | null | undefined, compareFn?: (a: KeyValue<string, V>, b: KeyValue<string, V>) => number): Array<KeyValue<string, V>> | null;\n+    transform<K extends string, V>(input: Record<K, V> | ReadonlyMap<K, V> | null | undefined, compareFn?: (a: KeyValue<K, V>, b: KeyValue<K, V>) => number): Array<KeyValue<K, V>> | null;\n }\n \n export declare class Location {"
        },
        {
            "sha": "163b83f3e6acd867361eb54fc86ff9376f5c2987",
            "filename": "packages/common/src/pipes/keyvalue_pipe.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 19,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/4dfe0fa068007c28ca3b4a1476ed4ba1d2d86064/packages%2Fcommon%2Fsrc%2Fpipes%2Fkeyvalue_pipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/4dfe0fa068007c28ca3b4a1476ed4ba1d2d86064/packages%2Fcommon%2Fsrc%2Fpipes%2Fkeyvalue_pipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Fpipes%2Fkeyvalue_pipe.ts?ref=4dfe0fa068007c28ca3b4a1476ed4ba1d2d86064",
            "patch": "@@ -50,31 +50,35 @@ export class KeyValuePipe implements PipeTransform {\n   private differ!: KeyValueDiffer<any, any>;\n   private keyValues: Array<KeyValue<any, any>> = [];\n \n-  transform<K, V>(input: null, compareFn?: (a: KeyValue<K, V>, b: KeyValue<K, V>) => number): null;\n-  transform<V>(\n-      input: {[key: string]: V}|ReadonlyMap<string, V>,\n-      compareFn?: (a: KeyValue<string, V>, b: KeyValue<string, V>) => number):\n-      Array<KeyValue<string, V>>;\n-  transform<V>(\n-      input: {[key: string]: V}|ReadonlyMap<string, V>|null,\n-      compareFn?: (a: KeyValue<string, V>, b: KeyValue<string, V>) => number):\n-      Array<KeyValue<string, V>>|null;\n-  transform<V>(\n-      input: {[key: number]: V}|ReadonlyMap<number, V>,\n-      compareFn?: (a: KeyValue<number, V>, b: KeyValue<number, V>) => number):\n-      Array<KeyValue<number, V>>;\n-  transform<V>(\n-      input: {[key: number]: V}|ReadonlyMap<number, V>|null,\n-      compareFn?: (a: KeyValue<number, V>, b: KeyValue<number, V>) => number):\n-      Array<KeyValue<number, V>>|null;\n+  /*\n+   * NOTE: when the `input` value is a simple Record<K, V> object, the keys are extracted with\n+   * Object.keys(). This means that even if the `input` type is Record<number, V> the keys are\n+   * compared/returned as `string`s.\n+   */\n   transform<K, V>(\n       input: ReadonlyMap<K, V>,\n       compareFn?: (a: KeyValue<K, V>, b: KeyValue<K, V>) => number): Array<KeyValue<K, V>>;\n+  transform<K extends number, V>(\n+      input: Record<K, V>, compareFn?: (a: KeyValue<string, V>, b: KeyValue<string, V>) => number):\n+      Array<KeyValue<string, V>>;\n+  transform<K extends string, V>(\n+      input: Record<K, V>|ReadonlyMap<K, V>,\n+      compareFn?: (a: KeyValue<K, V>, b: KeyValue<K, V>) => number): Array<KeyValue<K, V>>;\n+  transform(\n+      input: null|undefined,\n+      compareFn?: (a: KeyValue<unknown, unknown>, b: KeyValue<unknown, unknown>) => number): null;\n   transform<K, V>(\n-      input: ReadonlyMap<K, V>|null,\n+      input: ReadonlyMap<K, V>|null|undefined,\n+      compareFn?: (a: KeyValue<K, V>, b: KeyValue<K, V>) => number): Array<KeyValue<K, V>>|null;\n+  transform<K extends number, V>(\n+      input: Record<K, V>|null|undefined,\n+      compareFn?: (a: KeyValue<string, V>, b: KeyValue<string, V>) => number):\n+      Array<KeyValue<string, V>>|null;\n+  transform<K extends string, V>(\n+      input: Record<K, V>|ReadonlyMap<K, V>|null|undefined,\n       compareFn?: (a: KeyValue<K, V>, b: KeyValue<K, V>) => number): Array<KeyValue<K, V>>|null;\n   transform<K, V>(\n-      input: null|{[key: string]: V, [key: number]: V}|ReadonlyMap<K, V>,\n+      input: undefined|null|{[key: string]: V, [key: number]: V}|ReadonlyMap<K, V>,\n       compareFn: (a: KeyValue<K, V>, b: KeyValue<K, V>) => number = defaultComparator):\n       Array<KeyValue<K, V>>|null {\n     if (!input || (!(input instanceof Map) && typeof input !== 'object')) {"
        },
        {
            "sha": "2b9fb4953319064c64994aba77f76dbb24bb3e8b",
            "filename": "packages/common/test/pipes/keyvalue_pipe_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/4dfe0fa068007c28ca3b4a1476ed4ba1d2d86064/packages%2Fcommon%2Ftest%2Fpipes%2Fkeyvalue_pipe_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/4dfe0fa068007c28ca3b4a1476ed4ba1d2d86064/packages%2Fcommon%2Ftest%2Fpipes%2Fkeyvalue_pipe_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Ftest%2Fpipes%2Fkeyvalue_pipe_spec.ts?ref=4dfe0fa068007c28ca3b4a1476ed4ba1d2d86064",
            "patch": "@@ -17,12 +17,12 @@ describe('KeyValuePipe', () => {\n   });\n   it('should return null when given undefined', () => {\n     const pipe = new KeyValuePipe(defaultKeyValueDiffers);\n-    expect(pipe.transform(undefined as any)).toEqual(null);\n+    expect(pipe.transform(undefined)).toEqual(null);\n   });\n   it('should return null for an unsupported type', () => {\n     const pipe = new KeyValuePipe(defaultKeyValueDiffers);\n     const fn = () => {};\n-    expect(pipe.transform(fn as any)).toEqual(null);\n+    expect(pipe.transform(fn as any as null)).toEqual(null);\n   });\n   describe('object dictionary', () => {\n     it('should return empty array of an empty dictionary', () => {\n@@ -98,8 +98,9 @@ describe('KeyValuePipe', () => {\n     });\n     it('should order by numerical and alpha', () => {\n       const pipe = new KeyValuePipe(defaultKeyValueDiffers);\n-      const input = [[2, 1], [1, 1], ['b', 1], [0, 1], [3, 1], ['a', 1]];\n-      expect(pipe.transform(new Map(input as any))).toEqual([\n+      const input =\n+          [[2, 1], [1, 1], ['b', 1], [0, 1], [3, 1], ['a', 1]] as Array<[number | string, number]>;\n+      expect(pipe.transform(new Map(input))).toEqual([\n         {key: 0, value: 1}, {key: 1, value: 1}, {key: 2, value: 1}, {key: 3, value: 1},\n         {key: 'a', value: 1}, {key: 'b', value: 1}\n       ]);"
        }
    ],
    "stats": {
        "total": 71,
        "additions": 34,
        "deletions": 37
    }
}