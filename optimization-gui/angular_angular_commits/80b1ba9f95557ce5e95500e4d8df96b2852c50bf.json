{
    "author": "petebacondarwin",
    "message": "refactor(compiler-cli): split the `FileSystem` interface up (#40281)\n\nThis interface now extends `ReadonlyFileSystem` which in turn\nextends `PathManipulation`. This means consumers of these\ninterfaces can be more specific about what is needed, and so\nproviders do not need to implement unnecessary methods.\n\nPR Close #40281",
    "sha": "80b1ba9f95557ce5e95500e4d8df96b2852c50bf",
    "files": [
        {
            "sha": "bce731dd07aab313d599b37a0cfb4a2280867709",
            "filename": "packages/compiler-cli/src/ngtsc/file_system/README.md",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/80b1ba9f95557ce5e95500e4d8df96b2852c50bf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ffile_system%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/80b1ba9f95557ce5e95500e4d8df96b2852c50bf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ffile_system%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ffile_system%2FREADME.md?ref=80b1ba9f95557ce5e95500e4d8df96b2852c50bf",
            "patch": "@@ -3,7 +3,15 @@\n To improve cross platform support, all file access (and path manipulation)\n is now done through a well known interface (`FileSystem`).\n \n-For testing a number of `MockFileSystem` implementations are supplied.\n+Note that `FileSystem` extends `ReadonlyFileSystem`, which itself extends\n+`PathManipulation`.\n+If you are using a file-system object you should only ask for the type that supports\n+all the methods that you require.\n+For example, if you have a function (`foo()`) that only needs to resolve paths then\n+it should only require `PathManipulation`: `foo(fs: PathManipulation)`.\n+This allows the caller to avoid implementing unneeded functionality.\n+\n+For testing, a number of `MockFileSystem` implementations are supplied.\n These provide an in-memory file-system which emulates operating systems\n like OS/X, Unix and Windows.\n \n@@ -16,6 +24,11 @@ To prevent this happening accidentally the current file system always starts out\n as an instance of `InvalidFileSystem`, which will throw an error if any of its\n methods are called.\n \n+Generally it is safer to explicitly pass file-system objects to constructors or\n+free-standing functions if possible. This avoids confusing bugs where the\n+global file-system has not been set-up correctly before calling functions that\n+expect there to be a file-system configured globally.\n+\n You can set the current file-system by calling `setFileSystem()`.\n During testing you can call the helper function `initMockFileSystem(os)`\n which takes a string name of the OS to emulate, and will also monkey-patch"
        },
        {
            "sha": "7b25db8e8e0d0a9f026b475141fc9a16d6c94c4f",
            "filename": "packages/compiler-cli/src/ngtsc/file_system/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/80b1ba9f95557ce5e95500e4d8df96b2852c50bf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ffile_system%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/80b1ba9f95557ce5e95500e4d8df96b2852c50bf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ffile_system%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ffile_system%2Findex.ts?ref=80b1ba9f95557ce5e95500e4d8df96b2852c50bf",
            "patch": "@@ -9,5 +9,5 @@ export {NgtscCompilerHost} from './src/compiler_host';\n export {absoluteFrom, absoluteFromSourceFile, basename, dirname, getFileSystem, isLocalRelativePath, isRoot, isRooted, join, relative, relativeFrom, resolve, setFileSystem, toRelativeImport} from './src/helpers';\n export {LogicalFileSystem, LogicalProjectPath} from './src/logical';\n export {NodeJSFileSystem} from './src/node_js_file_system';\n-export {AbsoluteFsPath, FileStats, FileSystem, PathSegment, PathString} from './src/types';\n+export {AbsoluteFsPath, FileStats, FileSystem, PathManipulation, PathSegment, PathString, ReadonlyFileSystem} from './src/types';\n export {getSourceFileOrError} from './src/util';"
        },
        {
            "sha": "6720de0b45701698d003297b06a032224bc34f8c",
            "filename": "packages/compiler-cli/src/ngtsc/file_system/src/types.ts",
            "status": "modified",
            "additions": 36,
            "deletions": 23,
            "changes": 59,
            "blob_url": "https://github.com/angular/angular/blob/80b1ba9f95557ce5e95500e4d8df96b2852c50bf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ffile_system%2Fsrc%2Ftypes.ts",
            "raw_url": "https://github.com/angular/angular/raw/80b1ba9f95557ce5e95500e4d8df96b2852c50bf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ffile_system%2Fsrc%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ffile_system%2Fsrc%2Ftypes.ts?ref=80b1ba9f95557ce5e95500e4d8df96b2852c50bf",
            "patch": "@@ -29,33 +29,14 @@ export type AbsoluteFsPath = BrandedPath<'AbsoluteFsPath'>;\n export type PathSegment = BrandedPath<'PathSegment'>;\n \n /**\n- * A basic interface to abstract the underlying file-system.\n- *\n- * This makes it easier to provide mock file-systems in unit tests,\n- * but also to create clever file-systems that have features such as caching.\n+ * An abstraction over the path manipulation aspects of a file-system.\n  */\n-export interface FileSystem {\n-  exists(path: AbsoluteFsPath): boolean;\n-  readFile(path: AbsoluteFsPath): string;\n-  readFileBuffer(path: AbsoluteFsPath): Uint8Array;\n-  writeFile(path: AbsoluteFsPath, data: string|Uint8Array, exclusive?: boolean): void;\n-  removeFile(path: AbsoluteFsPath): void;\n-  symlink(target: AbsoluteFsPath, path: AbsoluteFsPath): void;\n-  readdir(path: AbsoluteFsPath): PathSegment[];\n-  lstat(path: AbsoluteFsPath): FileStats;\n-  stat(path: AbsoluteFsPath): FileStats;\n-  pwd(): AbsoluteFsPath;\n-  chdir(path: AbsoluteFsPath): void;\n+export interface PathManipulation {\n   extname(path: AbsoluteFsPath|PathSegment): string;\n-  copyFile(from: AbsoluteFsPath, to: AbsoluteFsPath): void;\n-  moveFile(from: AbsoluteFsPath, to: AbsoluteFsPath): void;\n-  ensureDir(path: AbsoluteFsPath): void;\n-  removeDeep(path: AbsoluteFsPath): void;\n-  isCaseSensitive(): boolean;\n   isRoot(path: AbsoluteFsPath): boolean;\n   isRooted(path: string): boolean;\n-  resolve(...paths: string[]): AbsoluteFsPath;\n   dirname<T extends PathString>(file: T): T;\n+  extname(path: AbsoluteFsPath|PathSegment): string;\n   join<T extends PathString>(basePath: T, ...paths: string[]): T;\n   /**\n    * Compute the relative path between `from` and `to`.\n@@ -66,9 +47,41 @@ export interface FileSystem {\n    */\n   relative<T extends PathString>(from: T, to: T): PathSegment|AbsoluteFsPath;\n   basename(filePath: string, extension?: string): PathSegment;\n+  normalize<T extends PathString>(path: T): T;\n+  resolve(...paths: string[]): AbsoluteFsPath;\n+  pwd(): AbsoluteFsPath;\n+  chdir(path: AbsoluteFsPath): void;\n+}\n+\n+/**\n+ * An abstraction over the read-only aspects of a file-system.\n+ */\n+export interface ReadonlyFileSystem extends PathManipulation {\n+  isCaseSensitive(): boolean;\n+  exists(path: AbsoluteFsPath): boolean;\n+  readFile(path: AbsoluteFsPath): string;\n+  readFileBuffer(path: AbsoluteFsPath): Uint8Array;\n+  readdir(path: AbsoluteFsPath): PathSegment[];\n+  lstat(path: AbsoluteFsPath): FileStats;\n+  stat(path: AbsoluteFsPath): FileStats;\n   realpath(filePath: AbsoluteFsPath): AbsoluteFsPath;\n   getDefaultLibLocation(): AbsoluteFsPath;\n-  normalize<T extends PathString>(path: T): T;\n+}\n+\n+/**\n+ * A basic interface to abstract the underlying file-system.\n+ *\n+ * This makes it easier to provide mock file-systems in unit tests,\n+ * but also to create clever file-systems that have features such as caching.\n+ */\n+export interface FileSystem extends ReadonlyFileSystem {\n+  writeFile(path: AbsoluteFsPath, data: string|Uint8Array, exclusive?: boolean): void;\n+  removeFile(path: AbsoluteFsPath): void;\n+  symlink(target: AbsoluteFsPath, path: AbsoluteFsPath): void;\n+  copyFile(from: AbsoluteFsPath, to: AbsoluteFsPath): void;\n+  moveFile(from: AbsoluteFsPath, to: AbsoluteFsPath): void;\n+  ensureDir(path: AbsoluteFsPath): void;\n+  removeDeep(path: AbsoluteFsPath): void;\n }\n \n export type PathString = string|AbsoluteFsPath|PathSegment;"
        }
    ],
    "stats": {
        "total": 76,
        "additions": 51,
        "deletions": 25
    }
}