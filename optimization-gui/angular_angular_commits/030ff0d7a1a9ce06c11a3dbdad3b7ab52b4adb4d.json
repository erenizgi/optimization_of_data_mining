{
    "author": "JoostK",
    "message": "test(ngcc): use @angular npm packages in integration test (#43234)\n\nIn anticipation of the removal of the View Engine npm package output,\nthe integration tests of ngcc are switched to use @angular packages for\nfrom npm. The version 12 packages are guaranteed to always be View\nEngine format which makes them suitable to be processed in the ngcc\nintegration tests.\n\nPR Close #43234",
    "sha": "030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d",
    "files": [
        {
            "sha": "6230695cf008a0db52a8c4803b3129677ad751fd",
            "filename": "package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d/package.json",
            "raw_url": "https://github.com/angular/angular/raw/030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d/package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/package.json?ref=030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d",
            "patch": "@@ -43,6 +43,8 @@\n     \"@angular-devkit/build-optimizer\": \"0.1200.4\",\n     \"@angular-devkit/core\": \"12.0.4\",\n     \"@angular-devkit/schematics\": \"12.0.4\",\n+    \"@angular/common-12\": \"npm:@angular/common@12.2.2\",\n+    \"@angular/core-12\": \"npm:@angular/core@12.2.2\",\n     \"@angular/cli\": \"12.0.4\",\n     \"@babel/cli\": \"7.14.8\",\n     \"@babel/core\": \"7.8.6\","
        },
        {
            "sha": "4ec40ebb96cde83ab71c41991994e9686c1e2bf9",
            "filename": "packages/compiler-cli/ngcc/test/BUILD.bazel",
            "status": "modified",
            "additions": 5,
            "deletions": 8,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d/packages%2Fcompiler-cli%2Fngcc%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d/packages%2Fcompiler-cli%2Fngcc%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2FBUILD.bazel?ref=030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d",
            "patch": "@@ -78,12 +78,12 @@ babel(\n     name = \"fesm5_angular_core\",\n     outs = [\"fesm5_angular_core.js\"],\n     args = [\n-        \"$(execpath //packages/core:npm_package)/fesm2015/core.js\",\n+        \"$(execpath @npm//:node_modules/@angular/core-12/fesm2015/core.js)\",\n         \"--presets @babel/preset-env\",\n         \"--out-file $(execpath fesm5_angular_core.js)\",\n     ],\n     data = [\n-        \"//packages/core:npm_package\",\n+        \"@npm//:node_modules/@angular/core-12/fesm2015/core.js\",\n         \"@npm//@babel/preset-env\",\n     ],\n )\n@@ -94,15 +94,12 @@ jasmine_node_test(\n     bootstrap = [\"//tools/testing:node_no_angular_es5\"],\n     data = [\n         \":fesm5_angular_core\",\n-        \"//packages/common:npm_package\",\n-        \"//packages/core:npm_package\",\n+        \"@npm//@angular/common-12\",\n+        \"@npm//@angular/core-12\",\n         \"@npm//rxjs\",\n     ],\n     shard_count = 4,\n-    tags = [\n-        # Disabled in AOT mode because we want ngcc to compile non-AOT Angular packages.\n-        \"no-ivy-aot\",\n-    ],\n+    tags = [\"ivy-only\"],\n     templated_args = [\n         # TODO(josephperrott): update dependency usages to no longer need bazel patch module resolver\n         # See: https://github.com/bazelbuild/rules_nodejs/wiki#--bazel_patch_module_resolver-now-defaults-to-false-2324"
        },
        {
            "sha": "ebc29bd5f5839f95ac355aa3f7a61a98bfa5ab64",
            "filename": "packages/compiler-cli/ngcc/test/integration/ngcc_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts?ref=030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d",
            "patch": "@@ -13,7 +13,7 @@ import * as os from 'os';\n import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem} from '../../../src/ngtsc/file_system';\n import {Folder, MockFileSystem, runInEachFileSystem, TestFile} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n-import {loadStandardTestFiles, loadTestFiles} from '../../../src/ngtsc/testing';\n+import {loadTestFiles} from '../../../src/ngtsc/testing';\n import {getLockFilePath} from '../../src/locking/lock_file';\n import {mainNgcc} from '../../src/main';\n import {clearTsConfigCache} from '../../src/ngcc_options';\n@@ -23,10 +23,10 @@ import {EntryPointManifestFile} from '../../src/packages/entry_point_manifest';\n import {Transformer} from '../../src/packages/transformer';\n import {DirectPackageJsonUpdater, PackageJsonUpdater} from '../../src/writing/package_json_updater';\n \n-import {compileIntoApf, compileIntoFlatEs2015Package, compileIntoFlatEs5Package} from './util';\n+import {compileIntoApf, compileIntoFlatEs2015Package, compileIntoFlatEs5Package, loadNgccIntegrationTestFiles} from './util';\n \n const ANGULAR_CORE_IMPORT_REGEX = /import \\* as Éµngcc\\d+ from '@angular\\/core';/;\n-const testFiles = loadStandardTestFiles({fakeCore: false, rxjs: true});\n+const testFiles = loadNgccIntegrationTestFiles();\n \n runInEachFileSystem(() => {\n   describe('ngcc main()', () => {"
        },
        {
            "sha": "8e708ad6d08cc528e5ba22da36e95b697f452574",
            "filename": "packages/compiler-cli/ngcc/test/integration/util.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 4,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Futil.ts?ref=030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d",
            "patch": "@@ -8,10 +8,10 @@\n \n import * as ts from 'typescript';\n \n-import {FileSystem, getFileSystem} from '../../../src/ngtsc/file_system';\n-import {MockFileSystemPosix} from '../../../src/ngtsc/file_system/testing';\n+import {AbsoluteFsPath, FileSystem, getFileSystem} from '../../../src/ngtsc/file_system';\n+import {Folder, MockFileSystemPosix} from '../../../src/ngtsc/file_system/testing';\n \n-import {loadStandardTestFiles} from '../../../src/ngtsc/testing';\n+import {loadTestDirectory, loadTsLib, resolveNpmTreeArtifact} from '../../../src/ngtsc/testing';\n \n export type PackageSources = {\n   [path: string]: string;\n@@ -224,7 +224,24 @@ export function compileIntoApf(\n       fs.resolve(`/node_modules/${pkgName}/package.json`), JSON.stringify(pkgJson, null, 2));\n }\n \n-const stdFiles = loadStandardTestFiles({fakeCore: false});\n+export function loadNgccIntegrationTestFiles(): Folder {\n+  const tmpFs = new MockFileSystemPosix(true);\n+  const basePath = '/' as AbsoluteFsPath;\n+\n+  loadTsLib(tmpFs, basePath);\n+  loadTestDirectory(\n+      tmpFs, resolveNpmTreeArtifact('@angular/core-12'),\n+      tmpFs.resolve('/node_modules/@angular/core'));\n+  loadTestDirectory(\n+      tmpFs, resolveNpmTreeArtifact('@angular/common-12'),\n+      tmpFs.resolve('/node_modules/@angular/common'));\n+  loadTestDirectory(\n+      tmpFs, resolveNpmTreeArtifact('typescript'), tmpFs.resolve('/node_modules/typescript'));\n+  loadTestDirectory(tmpFs, resolveNpmTreeArtifact('rxjs'), tmpFs.resolve('/node_modules/rxjs'));\n+  return tmpFs.dump();\n+}\n+\n+const stdFiles = loadNgccIntegrationTestFiles();\n \n /**\n  * Prepares a mock filesystem that contains all provided source files, which can be used to emit"
        },
        {
            "sha": "3bda450bb879f7afd81428cd001b4536431158c2",
            "filename": "yarn.lock",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d/yarn.lock",
            "raw_url": "https://github.com/angular/angular/raw/030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d/yarn.lock",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/yarn.lock?ref=030ff0d7a1a9ce06c11a3dbdad3b7ab52b4adb4d",
            "patch": "@@ -196,6 +196,20 @@\n     symbol-observable \"4.0.0\"\n     uuid \"8.3.2\"\n \n+\"@angular/common-12@npm:@angular/common@12.2.2\":\n+  version \"12.2.2\"\n+  resolved \"https://registry.yarnpkg.com/@angular/common/-/common-12.2.2.tgz#ae4736432387018ea29d81a3c73b09106e823276\"\n+  integrity sha512-cAfPHis8ynpR+qV9ViztCuNBjJ8YRDivvpUXtXecJYYBUPQt9uIiMLeqvBuWmFr+zKD+yAhWywbHEo/4m1JVtQ==\n+  dependencies:\n+    tslib \"^2.2.0\"\n+\n+\"@angular/core-12@npm:@angular/core@12.2.2\":\n+  version \"12.2.2\"\n+  resolved \"https://registry.yarnpkg.com/@angular/core/-/core-12.2.2.tgz#bf10931a059ee9e95ecbc3171303f2304958a601\"\n+  integrity sha512-zNgH1iFB1vCVNk9PZ+GCo0sZXD19Zt3BobgmHkWJ+PVXRPuKpuLBXWsq7d9IXdbFopQQWWfVHo0eDagIicrSFQ==\n+  dependencies:\n+    tslib \"^2.2.0\"\n+\n \"@angular/core@^10.0.0-0 || ^11.0.0\":\n   version \"11.2.14\"\n   resolved \"https://registry.yarnpkg.com/@angular/core/-/core-11.2.14.tgz#3ebe298c79d5413dc670d56b7f503bd4d788d4a8\""
        }
    ],
    "stats": {
        "total": 60,
        "additions": 45,
        "deletions": 15
    }
}