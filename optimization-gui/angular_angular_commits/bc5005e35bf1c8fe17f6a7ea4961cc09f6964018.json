{
    "author": "mhevery",
    "message": "refactor(core): cleanup i18n/icu data structures (#39233)\n\n- Made `*OpCodes` array branded for safer type checking.\n- Simplify `I18NRemoveOpCodes` encoding.\n- Broke out  `IcuCreateOpCodes` from `I18nMutableOpCodes`.\n\nPR Close #39233",
    "sha": "bc5005e35bf1c8fe17f6a7ea4961cc09f6964018",
    "files": [
        {
            "sha": "7b7148b9983bd3d22ef87c31b286d22d5c4a04c0",
            "filename": "packages/core/src/render3/i18n/i18n_apply.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 19,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_apply.ts",
            "raw_url": "https://github.com/angular/angular/raw/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_apply.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_apply.ts?ref=bc5005e35bf1c8fe17f6a7ea4961cc09f6964018",
            "patch": "@@ -11,7 +11,7 @@ import {assertDefined, assertDomNode, assertEqual, assertGreaterThan, assertInde\n import {assertIndexInExpandoRange, assertTIcu} from '../assert';\n import {attachPatchData} from '../context_discovery';\n import {elementPropertyInternal, setElementAttribute} from '../instructions/shared';\n-import {ELEMENT_MARKER, getCurrentICUCaseIndex, getParentFromI18nMutateOpCode, getRefFromI18nMutateOpCode, I18nCreateOpCode, I18nCreateOpCodes, I18nMutateOpCode, I18nMutateOpCodes, I18nUpdateOpCode, I18nUpdateOpCodes, ICU_MARKER, IcuType, TI18n, TIcu} from '../interfaces/i18n';\n+import {ELEMENT_MARKER, getCurrentICUCaseIndex, getParentFromIcuCreateOpCode, getRefFromIcuCreateOpCode, I18nCreateOpCode, I18nCreateOpCodes, I18nUpdateOpCode, I18nUpdateOpCodes, ICU_MARKER, IcuCreateOpCode, IcuCreateOpCodes, IcuType, TI18n, TIcu} from '../interfaces/i18n';\n import {TNode} from '../interfaces/node';\n import {RElement, RNode, RText} from '../interfaces/renderer';\n import {SanitizerFn} from '../interfaces/sanitization';\n@@ -122,7 +122,7 @@ export function applyCreateOpCodes(\n  * @param anchorRNode place where the i18n node should be inserted.\n  */\n export function applyMutableOpCodes(\n-    tView: TView, mutableOpCodes: I18nMutateOpCodes, lView: LView, anchorRNode: RNode): void {\n+    tView: TView, mutableOpCodes: IcuCreateOpCodes, lView: LView, anchorRNode: RNode): void {\n   ngDevMode && assertDomNode(anchorRNode);\n   const renderer = lView[RENDERER];\n   // `rootIdx` represents the node into which all inserts happen.\n@@ -143,9 +143,9 @@ export function applyMutableOpCodes(\n         lView[textNodeIndex] = createTextNode(renderer, opCode);\n       }\n     } else if (typeof opCode == 'number') {\n-      switch (opCode & I18nMutateOpCode.MASK_INSTRUCTION) {\n-        case I18nMutateOpCode.AppendChild:\n-          const parentIdx = getParentFromI18nMutateOpCode(opCode);\n+      switch (opCode & IcuCreateOpCode.MASK_INSTRUCTION) {\n+        case IcuCreateOpCode.AppendChild:\n+          const parentIdx = getParentFromIcuCreateOpCode(opCode);\n           if (rootIdx === null) {\n             // The first operation should save the `rootIdx` because the first operation\n             // must insert into the root. (Only subsequent operations can insert into a dynamic\n@@ -169,7 +169,7 @@ export function applyMutableOpCodes(\n             // create the elements. When the `LView` gets later added to a parent these \"root\" nodes\n             // get picked up and added.\n             ngDevMode && assertDomNode(parentRNode);\n-            const refIdx = getRefFromI18nMutateOpCode(opCode);\n+            const refIdx = getRefFromIcuCreateOpCode(opCode);\n             ngDevMode && assertGreaterThan(refIdx, HEADER_OFFSET, 'Missing ref');\n             // `unwrapRNode` is not needed here as all of these point to RNodes as part of the i18n\n             // which can't have components.\n@@ -188,8 +188,8 @@ export function applyMutableOpCodes(\n             }\n           }\n           break;\n-        case I18nMutateOpCode.Attr:\n-          const elementNodeIndex = opCode >>> I18nMutateOpCode.SHIFT_REF;\n+        case IcuCreateOpCode.Attr:\n+          const elementNodeIndex = opCode >>> IcuCreateOpCode.SHIFT_REF;\n           const attrName = mutableOpCodes[++i] as string;\n           const attrValue = mutableOpCodes[++i] as string;\n           // This code is used for ICU expressions only, since we don't support\n@@ -393,17 +393,15 @@ function applyIcuSwitchCaseRemove(tView: TView, tIcu: TIcu, lView: LView) {\n   let activeCaseIndex = getCurrentICUCaseIndex(tIcu, lView);\n   if (activeCaseIndex !== null) {\n     const removeCodes = tIcu.remove[activeCaseIndex];\n-    for (let k = 0; k < removeCodes.length; k++) {\n-      const removeOpCode = removeCodes[k] as number;\n-      const nodeOrIcuIndex = removeOpCode >>> I18nMutateOpCode.SHIFT_REF;\n-      switch (removeOpCode & I18nMutateOpCode.MASK_INSTRUCTION) {\n-        case I18nMutateOpCode.Remove:\n-          nativeRemoveNode(\n-              lView[RENDERER], getNativeByIndex(nodeOrIcuIndex - HEADER_OFFSET, lView));\n-          break;\n-        case I18nMutateOpCode.RemoveNestedIcu:\n-          applyIcuSwitchCaseRemove(tView, getTIcu(tView, nodeOrIcuIndex)!, lView);\n-          break;\n+    for (let i = 0; i < removeCodes.length; i++) {\n+      const nodeOrIcuIndex = removeCodes[i] as number;\n+      if (nodeOrIcuIndex > 0) {\n+        // Positive numbers are `RNode`s.\n+        const rNode = getNativeByIndex(nodeOrIcuIndex, lView);\n+        rNode !== null && nativeRemoveNode(lView[RENDERER], rNode);\n+      } else {\n+        // Negative numbers are ICUs\n+        applyIcuSwitchCaseRemove(tView, getTIcu(tView, ~nodeOrIcuIndex)!, lView);\n       }\n     }\n   }"
        },
        {
            "sha": "edac425025028df69a6aecfde34990b441ab240a",
            "filename": "packages/core/src/render3/i18n/i18n_debug.ts",
            "status": "modified",
            "additions": 44,
            "deletions": 19,
            "changes": 63,
            "blob_url": "https://github.com/angular/angular/blob/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_debug.ts",
            "raw_url": "https://github.com/angular/angular/raw/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_debug.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_debug.ts?ref=bc5005e35bf1c8fe17f6a7ea4961cc09f6964018",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import {assertNumber, assertString} from '../../util/assert';\n-import {ELEMENT_MARKER, getInstructionFromI18nMutateOpCode, getParentFromI18nMutateOpCode, getRefFromI18nMutateOpCode, I18nCreateOpCode, I18nMutateOpCode, I18nMutateOpCodes, I18nUpdateOpCode, I18nUpdateOpCodes, ICU_MARKER} from '../interfaces/i18n';\n+import {ELEMENT_MARKER, getInstructionFromIcuCreateOpCode, getParentFromIcuCreateOpCode, getRefFromIcuCreateOpCode, I18nCreateOpCode, I18nCreateOpCodes, I18nRemoveOpCodes, I18nUpdateOpCode, I18nUpdateOpCodes, ICU_MARKER, IcuCreateOpCode, IcuCreateOpCodes} from '../interfaces/i18n';\n \n \n /**\n@@ -21,8 +21,8 @@ import {ELEMENT_MARKER, getInstructionFromI18nMutateOpCode, getParentFromI18nMut\n  * @param opcodes `I18nCreateOpCodes` if invoked as a function.\n  */\n export function i18nCreateOpCodesToString(\n-    this: I18nUpdateOpCodes|void, opcodes?: I18nUpdateOpCodes): string[] {\n-  const createOpCodes: I18nUpdateOpCodes = opcodes || (Array.isArray(this) ? this : []);\n+    this: I18nCreateOpCodes|void, opcodes?: I18nCreateOpCodes): string[] {\n+  const createOpCodes: I18nCreateOpCodes = opcodes || (Array.isArray(this) ? this : [] as any);\n   let lines: string[] = [];\n   for (let i = 0; i < createOpCodes.length; i++) {\n     const opCode = createOpCodes[i++] as any;\n@@ -103,35 +103,31 @@ export function i18nUpdateOpCodesToString(\n }\n \n /**\n- * Converts `I18nMutableOpCodes` array into a human readable format.\n+ * Converts `I18nCreateOpCodes` array into a human readable format.\n  *\n- * This function is attached to the `I18nMutableOpCodes.debug` if `ngDevMode` is enabled. This\n+ * This function is attached to the `I18nCreateOpCodes.debug` if `ngDevMode` is enabled. This\n  * function provides a human readable view of the opcodes. This is useful when debugging the\n  * application as well as writing more readable tests.\n  *\n- * @param this `I18nMutableOpCodes` if attached as a method.\n- * @param opcodes `I18nMutableOpCodes` if invoked as a function.\n+ * @param this `I18nCreateOpCodes` if attached as a method.\n+ * @param opcodes `I18nCreateOpCodes` if invoked as a function.\n  */\n-export function i18nMutateOpCodesToString(\n-    this: I18nMutateOpCodes|void, opcodes?: I18nMutateOpCodes): string[] {\n+export function icuCreateOpCodesToString(\n+    this: IcuCreateOpCodes|void, opcodes?: IcuCreateOpCodes): string[] {\n   const parser = new OpCodeParser(opcodes || (Array.isArray(this) ? this : []));\n   let lines: string[] = [];\n \n   function consumeOpCode(opCode: number): string {\n-    const parent = getParentFromI18nMutateOpCode(opCode);\n-    const ref = getRefFromI18nMutateOpCode(opCode);\n-    switch (getInstructionFromI18nMutateOpCode(opCode)) {\n-      case I18nMutateOpCode.AppendChild:\n+    const parent = getParentFromIcuCreateOpCode(opCode);\n+    const ref = getRefFromIcuCreateOpCode(opCode);\n+    switch (getInstructionFromIcuCreateOpCode(opCode)) {\n+      case IcuCreateOpCode.AppendChild:\n         return `(lView[${parent}] as Element).appendChild(lView[${lastRef}])`;\n-      case I18nMutateOpCode.Remove:\n-        return `(lView[${parent}] as Element).remove(lView[${ref}])`;\n-      case I18nMutateOpCode.Attr:\n+      case IcuCreateOpCode.Attr:\n         return `(lView[${ref}] as Element).setAttribute(\"${parser.consumeString()}\", \"${\n             parser.consumeString()}\")`;\n-      case I18nMutateOpCode.RemoveNestedIcu:\n-        return `removeNestedICU(${ref})`;\n     }\n-    throw new Error('Unexpected OpCode');\n+    throw new Error('Unexpected OpCode: ' + getInstructionFromIcuCreateOpCode(opCode));\n   }\n \n   let lastRef = -1;\n@@ -159,6 +155,35 @@ export function i18nMutateOpCodesToString(\n   return lines;\n }\n \n+/**\n+ * Converts `I18nRemoveOpCodes` array into a human readable format.\n+ *\n+ * This function is attached to the `I18nRemoveOpCodes.debug` if `ngDevMode` is enabled. This\n+ * function provides a human readable view of the opcodes. This is useful when debugging the\n+ * application as well as writing more readable tests.\n+ *\n+ * @param this `I18nRemoveOpCodes` if attached as a method.\n+ * @param opcodes `I18nRemoveOpCodes` if invoked as a function.\n+ */\n+export function i18nRemoveOpCodesToString(\n+    this: I18nRemoveOpCodes|void, opcodes?: I18nRemoveOpCodes): string[] {\n+  const removeCodes = opcodes || (Array.isArray(this) ? this : []);\n+  let lines: string[] = [];\n+\n+  for (let i = 0; i < removeCodes.length; i++) {\n+    const nodeOrIcuIndex = removeCodes[i] as number;\n+    if (nodeOrIcuIndex > 0) {\n+      // Positive numbers are `RNode`s.\n+      lines.push(`remove(lView[${nodeOrIcuIndex}])`);\n+    } else {\n+      // Negative numbers are ICUs\n+      lines.push(`removeNestedICU(${~nodeOrIcuIndex})`);\n+    }\n+  }\n+\n+  return lines;\n+}\n+\n \n class OpCodeParser {\n   i: number = 0;"
        },
        {
            "sha": "ec39a9ecab420a5aef117286375e51a9f29e2826",
            "filename": "packages/core/src/render3/i18n/i18n_parse.ts",
            "status": "modified",
            "additions": 25,
            "deletions": 22,
            "changes": 47,
            "blob_url": "https://github.com/angular/angular/blob/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_parse.ts",
            "raw_url": "https://github.com/angular/angular/raw/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_parse.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fi18n%2Fi18n_parse.ts?ref=bc5005e35bf1c8fe17f6a7ea4961cc09f6964018",
            "patch": "@@ -16,7 +16,7 @@ import {CharCode} from '../../util/char_code';\n import {loadIcuContainerVisitor} from '../instructions/i18n_icu_container_visitor';\n import {allocExpando, createTNodeAtIndex, elementAttributeInternal, setInputsForProperty, setNgReflectProperties} from '../instructions/shared';\n import {getDocument} from '../interfaces/document';\n-import {ELEMENT_MARKER, ensureIcuContainerVisitorLoaded, I18nCreateOpCode, I18nCreateOpCodes, I18nMutateOpCode, i18nMutateOpCode, I18nMutateOpCodes, I18nUpdateOpCode, I18nUpdateOpCodes, ICU_MARKER, IcuExpression, IcuType, TI18n, TIcu} from '../interfaces/i18n';\n+import {ELEMENT_MARKER, ensureIcuContainerVisitorLoaded, I18nCreateOpCode, I18nCreateOpCodes, I18nRemoveOpCodes, I18nUpdateOpCode, I18nUpdateOpCodes, ICU_MARKER, icuCreateOpCode, IcuCreateOpCode, IcuCreateOpCodes, IcuExpression, IcuType, TI18n, TIcu} from '../interfaces/i18n';\n import {TNode, TNodeType} from '../interfaces/node';\n import {RComment, RElement} from '../interfaces/renderer';\n import {SanitizerFn} from '../interfaces/sanitization';\n@@ -25,7 +25,7 @@ import {getCurrentParentTNode, getCurrentTNode, setCurrentTNode} from '../state'\n import {attachDebugGetter} from '../util/debug_utils';\n import {getNativeByIndex, getTNode} from '../util/view_utils';\n \n-import {i18nCreateOpCodesToString, i18nMutateOpCodesToString, i18nUpdateOpCodesToString} from './i18n_debug';\n+import {i18nCreateOpCodesToString, i18nRemoveOpCodesToString, i18nUpdateOpCodesToString, icuCreateOpCodesToString} from './i18n_debug';\n import {addTNodeAndUpdateInsertBeforeIndex} from './i18n_insert_before_index';\n import {createTNodePlaceholder, setTIcu, setTNodeInsertBeforeIndex} from './i18n_util';\n \n@@ -70,8 +70,8 @@ export function i18nStartFirstCreatePass(\n     tView: TView, parentTNodeIndex: number, lView: LView, index: number, message: string,\n     subTemplateIndex: number) {\n   const rootTNode = getCurrentParentTNode();\n-  const createOpCodes: I18nCreateOpCodes = [];\n-  const updateOpCodes: I18nUpdateOpCodes = [];\n+  const createOpCodes: I18nCreateOpCodes = [] as any;\n+  const updateOpCodes: I18nUpdateOpCodes = [] as any;\n   const existingTNodeStack: TNode[][] = [[]];\n   if (ngDevMode) {\n     attachDebugGetter(createOpCodes, i18nCreateOpCodesToString);\n@@ -158,7 +158,7 @@ function createTNodeAndAddOpCode(\n   let parentTNode = getCurrentParentTNode();\n \n   if (rootTNode === parentTNode) {\n-    // FIXME(misko): A null `parentTNode` should represent when we fall of the `LView` boundry.\n+    // FIXME(misko): A null `parentTNode` should represent when we fall of the `LView` boundary.\n     // (there is no parent), but in some circumstances (because we are inconsistent about how we set\n     // `previousOrParentTNode`) it could point to `rootTNode` So this is a work around.\n     parentTNode = null;\n@@ -228,7 +228,7 @@ export function i18nAttributesFirstPass(\n     lView: LView, tView: TView, index: number, values: string[]) {\n   const previousElement = getCurrentTNode()!;\n   const previousElementIndex = previousElement.index;\n-  const updateOpCodes: I18nUpdateOpCodes = [];\n+  const updateOpCodes: I18nUpdateOpCodes = [] as any;\n   if (ngDevMode) {\n     attachDebugGetter(updateOpCodes, i18nUpdateOpCodesToString);\n   }\n@@ -583,12 +583,12 @@ export function i18nParseTextIntoPartsAndICU(pattern: string): (string|IcuExpres\n export function parseIcuCase(\n     tView: TView, tIcu: TIcu, lView: LView, updateOpCodes: I18nUpdateOpCodes, parentIdx: number,\n     caseName: string, unsafeCaseHtml: string, nestedIcus: IcuExpression[]): number {\n-  const create: I18nMutateOpCodes = [];\n-  const remove: I18nMutateOpCodes = [];\n-  const update: I18nUpdateOpCodes = [];\n+  const create: IcuCreateOpCodes = [] as any;\n+  const remove: I18nRemoveOpCodes = [] as any;\n+  const update: I18nUpdateOpCodes = [] as any;\n   if (ngDevMode) {\n-    attachDebugGetter(create, i18nMutateOpCodesToString);\n-    attachDebugGetter(remove, i18nMutateOpCodesToString);\n+    attachDebugGetter(create, icuCreateOpCodesToString);\n+    attachDebugGetter(remove, i18nRemoveOpCodesToString);\n     attachDebugGetter(update, i18nUpdateOpCodesToString);\n   }\n   tIcu.cases.push(caseName);\n@@ -611,7 +611,7 @@ export function parseIcuCase(\n \n function walkIcuTree(\n     tView: TView, tIcu: TIcu, lView: LView, sharedUpdateOpCodes: I18nUpdateOpCodes,\n-    create: I18nMutateOpCodes, remove: I18nMutateOpCodes, update: I18nUpdateOpCodes,\n+    create: IcuCreateOpCodes, remove: I18nRemoveOpCodes, update: I18nUpdateOpCodes,\n     parentNode: Element, parentIdx: number, nestedIcus: IcuExpression[], depth: number): number {\n   let bindingMask = 0;\n   let currentNode = parentNode.firstChild;\n@@ -648,9 +648,7 @@ function walkIcuTree(\n   } (see http://g.co/ng/security#xss)`);\n               }\n             } else {\n-              create.push(\n-                  newIndex << I18nMutateOpCode.SHIFT_REF | I18nMutateOpCode.Attr, attr.name,\n-                  attr.value);\n+              addCreateAttribute(create, newIndex, attr);\n             }\n           }\n           // Parse the children of this node (if any)\n@@ -689,16 +687,17 @@ function walkIcuTree(\n   }\n   return bindingMask;\n }\n-function addRemoveNode(remove: I18nMutateOpCodes, index: number, depth: number) {\n+\n+function addRemoveNode(remove: I18nRemoveOpCodes, index: number, depth: number) {\n   if (depth === 0) {\n-    remove.push(index << I18nMutateOpCode.SHIFT_REF | I18nMutateOpCode.Remove);\n+    remove.push(index);\n   }\n }\n \n-function addRemoveNestedIcu(remove: I18nMutateOpCodes, index: number, depth: number) {\n+function addRemoveNestedIcu(remove: I18nRemoveOpCodes, index: number, depth: number) {\n   if (depth === 0) {\n-    remove.push(index << I18nMutateOpCode.SHIFT_REF | I18nMutateOpCode.RemoveNestedIcu);\n-    remove.push(index << I18nMutateOpCode.SHIFT_REF | I18nMutateOpCode.Remove);\n+    remove.push(~index);  // remove ICU at `index`\n+    remove.push(index);   // remove ICU comment at `index`\n   }\n }\n \n@@ -714,12 +713,16 @@ function addUpdateIcuUpdate(update: I18nUpdateOpCodes, bindingMask: number, inde\n }\n \n function addCreateNodeAndAppend(\n-    create: I18nMutateOpCodes, marker: null|ICU_MARKER|ELEMENT_MARKER, text: string,\n+    create: IcuCreateOpCodes, marker: null|ICU_MARKER|ELEMENT_MARKER, text: string,\n     appendToParentIdx: number, createAtIdx: number) {\n   if (marker !== null) {\n     create.push(marker);\n   }\n   create.push(\n       text, createAtIdx,\n-      i18nMutateOpCode(I18nMutateOpCode.AppendChild, appendToParentIdx, createAtIdx));\n+      icuCreateOpCode(IcuCreateOpCode.AppendChild, appendToParentIdx, createAtIdx));\n }\n+\n+function addCreateAttribute(create: IcuCreateOpCodes, newIndex: number, attr: Attr) {\n+  create.push(newIndex << IcuCreateOpCode.SHIFT_REF | IcuCreateOpCode.Attr, attr.name, attr.value);\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "d91bed33b030fb4e1fb58f15d968c1e72efac8f7",
            "filename": "packages/core/src/render3/instructions/i18n_icu_container_visitor.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 10,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fi18n_icu_container_visitor.ts",
            "raw_url": "https://github.com/angular/angular/raw/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fi18n_icu_container_visitor.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fi18n_icu_container_visitor.ts?ref=bc5005e35bf1c8fe17f6a7ea4961cc09f6964018",
            "patch": "@@ -6,10 +6,10 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {assertDomNode, assertEqual, assertNumber, assertNumberInRange} from '../../util/assert';\n+import {assertDomNode, assertNumber, assertNumberInRange} from '../../util/assert';\n import {assertTIcu, assertTNodeForLView} from '../assert';\n import {EMPTY_ARRAY} from '../empty';\n-import {getCurrentICUCaseIndex, I18nMutateOpCode, I18nMutateOpCodes, TIcu} from '../interfaces/i18n';\n+import {getCurrentICUCaseIndex, I18nRemoveOpCodes, TIcu} from '../interfaces/i18n';\n import {TIcuContainerNode} from '../interfaces/node';\n import {RNode} from '../interfaces/renderer';\n import {LView, TVIEW} from '../interfaces/view';\n@@ -18,7 +18,7 @@ export function loadIcuContainerVisitor() {\n   const _stack: any[] = [];\n   let _index: number = -1;\n   let _lView: LView;\n-  let _removes: I18nMutateOpCodes;\n+  let _removes: I18nRemoveOpCodes;\n \n   /**\n    * Retrieves a set of root nodes from `TIcu.remove`. Used by `TNodeType.ICUContainer`\n@@ -52,7 +52,7 @@ export function loadIcuContainerVisitor() {\n       ngDevMode && assertNumberInRange(currentCase, 0, tIcu.cases.length - 1);\n       _removes = tIcu.remove[currentCase];\n     } else {\n-      _removes = EMPTY_ARRAY;\n+      _removes = EMPTY_ARRAY as any;\n     }\n   }\n \n@@ -61,16 +61,15 @@ export function loadIcuContainerVisitor() {\n     if (_index < _removes.length) {\n       const removeOpCode = _removes[_index++] as number;\n       ngDevMode && assertNumber(removeOpCode, 'Expecting OpCode number');\n-      const opCode = removeOpCode & I18nMutateOpCode.MASK_INSTRUCTION;\n-      if (opCode === I18nMutateOpCode.Remove) {\n-        const rNode = _lView[removeOpCode >>> I18nMutateOpCode.SHIFT_REF];\n+      if (removeOpCode > 0) {\n+        const rNode = _lView[removeOpCode];\n         ngDevMode && assertDomNode(rNode);\n         return rNode;\n       } else {\n-        ngDevMode &&\n-            assertEqual(opCode, I18nMutateOpCode.RemoveNestedIcu, 'Expecting RemoveNestedIcu');\n         _stack.push(_index, _removes);\n-        const tIcu = _lView[TVIEW].data[removeOpCode >>> I18nMutateOpCode.SHIFT_REF] as TIcu;\n+        // ICUs are represented by negative indices\n+        const tIcuIndex = ~removeOpCode;\n+        const tIcu = _lView[TVIEW].data[tIcuIndex] as TIcu;\n         ngDevMode && assertTIcu(tIcu);\n         enterIcu(tIcu, _lView);\n         return icuContainerIteratorNext();"
        },
        {
            "sha": "9a75505d31528297e339010c2253835cd3e72942",
            "filename": "packages/core/src/render3/interfaces/i18n.ts",
            "status": "modified",
            "additions": 108,
            "deletions": 109,
            "changes": 217,
            "blob_url": "https://github.com/angular/angular/blob/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fi18n.ts",
            "raw_url": "https://github.com/angular/angular/raw/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fi18n.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fi18n.ts?ref=bc5005e35bf1c8fe17f6a7ea4961cc09f6964018",
            "patch": "@@ -12,6 +12,18 @@ import {RNode} from './renderer';\n import {SanitizerFn} from './sanitization';\n import {LView} from './view';\n \n+\n+/**\n+ * Stores a list of nodes which need to be removed.\n+ *\n+ * Numbers are indexes into the `LView`\n+ * - index > 0: `removeRNode(lView[0])`\n+ * - index < 0: `removeICU(~lView[0])`\n+ */\n+export interface I18nRemoveOpCodes extends Array<number> {\n+  __brand__: 'I18nRemoveOpCodes';\n+}\n+\n /**\n  * `I18nMutateOpCode` defines OpCodes for `I18nMutateOpCodes` array.\n  *\n@@ -35,73 +47,136 @@ import {LView} from './view';\n  *\n  * See: `I18nCreateOpCodes` for example of usage.\n  */\n-export const enum I18nMutateOpCode {\n+export const enum IcuCreateOpCode {\n   /**\n    * Stores shift amount for bits 17-3 that contain reference index.\n    */\n-  SHIFT_REF = 3,\n+  SHIFT_REF = 1,\n   /**\n    * Stores shift amount for bits 31-17 that contain parent index.\n    */\n   SHIFT_PARENT = 17,\n   /**\n    * Mask for OpCode\n    */\n-  // FIXME(misko): Shrink mask to 2 bits as 4 choices can fit into two bits.\n-  MASK_INSTRUCTION = 0b111,\n+  MASK_INSTRUCTION = 0b1,\n \n   /**\n    * Mask for the Reference node (bits 16-3)\n    */\n-  // FIXME(misko): Why is this not used?\n-  MASK_REF = 0b11111111111111000,\n+  MASK_REF = 0b11111111111111110,\n   //           11111110000000000\n   //           65432109876543210\n \n   /**\n    * Instruction to append the current node to `PARENT`.\n    */\n-  AppendChild = 0b001,\n+  AppendChild = 0b0,\n \n   /**\n-   * Instruction to remove the `REF` node from `PARENT`.\n+   * Instruction to set the attribute of a node.\n    */\n-  Remove = 0b011,\n+  Attr = 0b1,\n+}\n+\n+\n+/**\n+ * Array storing OpCode for dynamically creating `i18n` blocks.\n+ *\n+ * Example:\n+ * ```ts\n+ * <I18nCreateOpCode>[\n+ *   // For adding text nodes\n+ *   // ---------------------\n+ *   // Equivalent to:\n+ *   //   lView[1].appendChild(lView[0] = document.createTextNode('xyz'));\n+ *   'xyz', 0, 1 << SHIFT_PARENT | 0 << SHIFT_REF | AppendChild,\n+ *\n+ *   // For adding element nodes\n+ *   // ---------------------\n+ *   // Equivalent to:\n+ *   //   lView[1].appendChild(lView[0] = document.createElement('div'));\n+ *   ELEMENT_MARKER, 'div', 0, 1 << SHIFT_PARENT | 0 << SHIFT_REF | AppendChild,\n+ *\n+ *   // For adding comment nodes\n+ *   // ---------------------\n+ *   // Equivalent to:\n+ *   //   lView[1].appendChild(lView[0] = document.createComment(''));\n+ *   ICU_MARKER, '', 0, 1 << SHIFT_PARENT | 0 << SHIFT_REF | AppendChild,\n+ *\n+ *   // For moving existing nodes to a different location\n+ *   // --------------------------------------------------\n+ *   // Equivalent to:\n+ *   //   const node = lView[1];\n+ *   //   lView[2].appendChild(node);\n+ *   1 << SHIFT_REF | Select, 2 << SHIFT_PARENT | 0 << SHIFT_REF | AppendChild,\n+ *\n+ *   // For removing existing nodes\n+ *   // --------------------------------------------------\n+ *   //   const node = lView[1];\n+ *   //   removeChild(tView.data(1), node, lView);\n+ *   1 << SHIFT_REF | Remove,\n+ *\n+ *   // For writing attributes\n+ *   // --------------------------------------------------\n+ *   //   const node = lView[1];\n+ *   //   node.setAttribute('attr', 'value');\n+ *   1 << SHIFT_REF | Attr, 'attr', 'value'\n+ * ];\n+ * ```\n+ */\n+export interface IcuCreateOpCodes extends Array<number|string|ELEMENT_MARKER|ICU_MARKER|null>,\n+                                          I18nDebug {\n+  __brand__: 'I18nCreateOpCodes';\n+}\n \n+export const enum I18nUpdateOpCode {\n   /**\n-   * Instruction to set the attribute of a node.\n+   * Stores shift amount for bits 17-2 that contain reference index.\n    */\n-  Attr = 0b100,\n+  SHIFT_REF = 2,\n+  /**\n+   * Mask for OpCode\n+   */\n+  MASK_OPCODE = 0b11,\n \n   /**\n-   * Instruction to removed the nested ICU.\n+   * Instruction to update a text node.\n+   */\n+  Text = 0b00,\n+  /**\n+   * Instruction to update a attribute of a node.\n    */\n-  RemoveNestedIcu = 0b110,\n+  Attr = 0b01,\n+  /**\n+   * Instruction to switch the current ICU case.\n+   */\n+  IcuSwitch = 0b10,\n+  /**\n+   * Instruction to update the current ICU case.\n+   */\n+  IcuUpdate = 0b11,\n }\n \n // FIXME(misko): These function are technically not interfaces, and so we may consider moving them\n // elsewhere.\n \n-// FIXME(misko): rename to `getParentFromI18nCreateOpCode`\n-export function getParentFromI18nMutateOpCode(mergedCode: number): number {\n-  return mergedCode >>> I18nMutateOpCode.SHIFT_PARENT;\n+export function getParentFromIcuCreateOpCode(mergedCode: number): number {\n+  return mergedCode >>> IcuCreateOpCode.SHIFT_PARENT;\n }\n \n-// FIXME(misko): rename to `getRefFromI18nCreateOpCode`\n-export function getRefFromI18nMutateOpCode(mergedCode: number): number {\n-  return (mergedCode & I18nMutateOpCode.MASK_REF) >>> I18nMutateOpCode.SHIFT_REF;\n+export function getRefFromIcuCreateOpCode(mergedCode: number): number {\n+  return (mergedCode & IcuCreateOpCode.MASK_REF) >>> IcuCreateOpCode.SHIFT_REF;\n }\n \n-// FIXME(misko): rename to `getInstructionFromI18nCreateOpCode`\n-export function getInstructionFromI18nMutateOpCode(mergedCode: number): number {\n-  return mergedCode & I18nMutateOpCode.MASK_INSTRUCTION;\n+export function getInstructionFromIcuCreateOpCode(mergedCode: number): number {\n+  return mergedCode & IcuCreateOpCode.MASK_INSTRUCTION;\n }\n \n-// FIXME(misko): rename to `i18nCreateOpCode`\n-export function i18nMutateOpCode(opCode: I18nMutateOpCode, parentIdx: number, refIdx: number) {\n+export function icuCreateOpCode(opCode: IcuCreateOpCode, parentIdx: number, refIdx: number) {\n   ngDevMode && assertGreaterThanOrEqual(parentIdx, 0, 'Missing parent index');\n   ngDevMode && assertGreaterThan(refIdx, 0, 'Missing ref index');\n-  return opCode | parentIdx << I18nMutateOpCode.SHIFT_PARENT | refIdx << I18nMutateOpCode.SHIFT_REF;\n+  return opCode | parentIdx << IcuCreateOpCode.SHIFT_PARENT | refIdx << IcuCreateOpCode.SHIFT_REF;\n }\n \n /**\n@@ -173,7 +248,9 @@ export interface I18nDebug {\n  * }\n  * ```\n  */\n-export interface I18nCreateOpCodes extends Array<number|string>, I18nDebug {}\n+export interface I18nCreateOpCodes extends Array<number|string>, I18nDebug {\n+  __brand__: 'I18nCreateOpCodes';\n+}\n \n /**\n  * See `I18nCreateOpCodes`\n@@ -197,84 +274,6 @@ export enum I18nCreateOpCode {\n }\n \n \n-/**\n- * Array storing OpCode for dynamically creating `i18n` blocks.\n- *\n- * Example:\n- * ```ts\n- * <I18nCreateOpCode>[\n- *   // For adding text nodes\n- *   // ---------------------\n- *   // Equivalent to:\n- *   //   lView[1].appendChild(lView[0] = document.createTextNode('xyz'));\n- *   'xyz', 0, 1 << SHIFT_PARENT | 0 << SHIFT_REF | AppendChild,\n- *\n- *   // For adding element nodes\n- *   // ---------------------\n- *   // Equivalent to:\n- *   //   lView[1].appendChild(lView[0] = document.createElement('div'));\n- *   ELEMENT_MARKER, 'div', 0, 1 << SHIFT_PARENT | 0 << SHIFT_REF | AppendChild,\n- *\n- *   // For adding comment nodes\n- *   // ---------------------\n- *   // Equivalent to:\n- *   //   lView[1].appendChild(lView[0] = document.createComment(''));\n- *   ICU_MARKER, '', 0, 1 << SHIFT_PARENT | 0 << SHIFT_REF | AppendChild,\n- *\n- *   // For moving existing nodes to a different location\n- *   // --------------------------------------------------\n- *   // Equivalent to:\n- *   //   const node = lView[1];\n- *   //   lView[2].appendChild(node);\n- *   1 << SHIFT_REF | Select, 2 << SHIFT_PARENT | 0 << SHIFT_REF | AppendChild,\n- *\n- *   // For removing existing nodes\n- *   // --------------------------------------------------\n- *   //   const node = lView[1];\n- *   //   removeChild(tView.data(1), node, lView);\n- *   1 << SHIFT_REF | Remove,\n- *\n- *   // For writing attributes\n- *   // --------------------------------------------------\n- *   //   const node = lView[1];\n- *   //   node.setAttribute('attr', 'value');\n- *   1 << SHIFT_REF | Attr, 'attr', 'value'\n- * ];\n- * ```\n- *\n- * See: `applyI18nCreateOpCodes`;\n- */\n-export interface I18nMutateOpCodes extends Array<number|string|ELEMENT_MARKER|ICU_MARKER|null>,\n-                                           I18nDebug {}\n-\n-export const enum I18nUpdateOpCode {\n-  /**\n-   * Stores shift amount for bits 17-2 that contain reference index.\n-   */\n-  SHIFT_REF = 2,\n-  /**\n-   * Mask for OpCode\n-   */\n-  MASK_OPCODE = 0b11,\n-\n-  /**\n-   * Instruction to update a text node.\n-   */\n-  Text = 0b00,\n-  /**\n-   * Instruction to update a attribute of a node.\n-   */\n-  Attr = 0b01,\n-  /**\n-   * Instruction to switch the current ICU case.\n-   */\n-  IcuSwitch = 0b10,\n-  /**\n-   * Instruction to update the current ICU case.\n-   */\n-  IcuUpdate = 0b11,\n-}\n-\n /**\n  * Stores DOM operations which need to be applied to update DOM render tree due to changes in\n  * expressions.\n@@ -347,7 +346,9 @@ export const enum I18nUpdateOpCode {\n  * ```\n  *\n  */\n-export interface I18nUpdateOpCodes extends Array<string|number|SanitizerFn|null>, I18nDebug {}\n+export interface I18nUpdateOpCodes extends Array<string|number|SanitizerFn|null>, I18nDebug {\n+  __brand__: 'I18nUpdateOpCodes';\n+}\n \n /**\n  * Store information for the i18n translation block.\n@@ -410,14 +411,12 @@ export interface TIcu {\n   /**\n    * A set of OpCodes to apply in order to build up the DOM render tree for the ICU\n    */\n-  // FIXME(misko): Rename `I18nMutateOpCodes` to `I18nCreateOpCodes`.\n-  create: I18nMutateOpCodes[];\n+  create: IcuCreateOpCodes[];\n \n   /**\n    * A set of OpCodes to apply in order to destroy the DOM render tree for the ICU.\n    */\n-  // FIXME(misko): Rename `I18nMutateOpCodes` to `I18nRemoveOpCodes`.\n-  remove: I18nMutateOpCodes[];\n+  remove: I18nRemoveOpCodes[];\n \n   /**\n    * A set of OpCodes to apply in order to update the DOM render tree for the ICU bindings."
        },
        {
            "sha": "018b10916758cf7811ba076ca6f9bfefb7a7b12f",
            "filename": "packages/core/src/render3/util/debug_utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdebug_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdebug_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdebug_utils.ts?ref=bc5005e35bf1c8fe17f6a7ea4961cc09f6964018",
            "patch": "@@ -31,7 +31,7 @@ export function attachDebugObject(obj: any, debug: any): void {\n  * @param obj Object to patch\n  * @param debugGetter Getter returning a value to patch\n  */\n-export function attachDebugGetter(obj: any, debugGetter: () => any): void {\n+export function attachDebugGetter<T>(obj: T, debugGetter: (this: T) => any): void {\n   if (ngDevMode) {\n     Object.defineProperty(obj, 'debug', {get: debugGetter, enumerable: false});\n   } else {"
        },
        {
            "sha": "a8bdfca3052e7e113bc6e2b75f9b175918ee5b5d",
            "filename": "packages/core/test/render3/i18n/i18n_parse_spec.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_parse_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_parse_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_parse_spec.ts?ref=bc5005e35bf1c8fe17f6a7ea4961cc09f6964018",
            "patch": "@@ -10,7 +10,7 @@ import {ɵɵi18nApply, ɵɵi18nExp} from '@angular/core';\n import {applyCreateOpCodes} from '@angular/core/src/render3/i18n/i18n_apply';\n import {i18nStartFirstCreatePass} from '@angular/core/src/render3/i18n/i18n_parse';\n import {getTIcu} from '@angular/core/src/render3/i18n/i18n_util';\n-import {IcuType, TI18n} from '@angular/core/src/render3/interfaces/i18n';\n+import {I18nUpdateOpCodes, IcuType, TI18n} from '@angular/core/src/render3/interfaces/i18n';\n import {HEADER_OFFSET} from '@angular/core/src/render3/interfaces/view';\n import {expect} from '@angular/core/testing/src/testing_internal';\n import {matchTI18n, matchTIcu} from '../matchers';\n@@ -29,7 +29,7 @@ describe('i18n_parse', () => {\n           'lView[22] = document.createText(\"some text\");',\n           'parent.appendChild(lView[22]);',\n         ]),\n-        update: [],\n+        update: [] as unknown as I18nUpdateOpCodes,\n       }));\n \n       fixture.apply(() => applyCreateOpCodes(fixture.lView, tI18n.create, fixture.host, null));\n@@ -88,8 +88,8 @@ describe('i18n_parse', () => {\n           matchDebug([]),\n         ],\n         remove: [\n-          matchDebug(['(lView[0] as Element).remove(lView[25])']),\n-          matchDebug(['(lView[0] as Element).remove(lView[26])'])\n+          matchDebug(['remove(lView[25])']),\n+          matchDebug(['remove(lView[26])']),\n         ],\n       }));\n \n@@ -204,13 +204,13 @@ describe('i18n_parse', () => {\n         ],\n         remove: [\n           matchDebug([\n-            '(lView[0] as Element).remove(lView[26])',\n+            'remove(lView[26])',\n             'removeNestedICU(27)',\n-            '(lView[0] as Element).remove(lView[27])',\n-            '(lView[0] as Element).remove(lView[31])',\n+            'remove(lView[27])',\n+            'remove(lView[31])',\n           ]),\n           matchDebug([\n-            '(lView[0] as Element).remove(lView[32])',\n+            'remove(lView[32])',\n           ])\n         ],\n       }));\n@@ -237,8 +237,8 @@ describe('i18n_parse', () => {\n           ]),\n         ],\n         remove: [\n-          matchDebug(['(lView[0] as Element).remove(lView[29])']),\n-          matchDebug(['(lView[0] as Element).remove(lView[30])'])\n+          matchDebug(['remove(lView[29])']),\n+          matchDebug(['remove(lView[30])']),\n         ],\n       }));\n "
        },
        {
            "sha": "fa4debd43bb118336a034255a2e0d27897708588",
            "filename": "packages/core/test/render3/i18n/i18n_spec.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 18,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_spec.ts?ref=bc5005e35bf1c8fe17f6a7ea4961cc09f6964018",
            "patch": "@@ -86,7 +86,7 @@ describe('Runtime i18n', () => {\n           `lView[${HEADER_OFFSET + 1}] = document.createText(\"simple text\");`,\n           `parent.appendChild(lView[${HEADER_OFFSET + 1}]);`,\n         ]),\n-        update: [],\n+        update: [] as unknown as I18nUpdateOpCodes,\n       });\n     });\n \n@@ -113,7 +113,7 @@ describe('Runtime i18n', () => {\n           `lView[${HEADER_OFFSET + 8}] = document.createText(\"!\");`,\n           `parent.appendChild(lView[${HEADER_OFFSET + 8}]);`,\n         ]),\n-        update: [],\n+        update: [] as unknown as I18nUpdateOpCodes,\n       });\n     });\n \n@@ -212,7 +212,7 @@ describe('Runtime i18n', () => {\n           `lView[${HEADER_OFFSET + 3}] = document.createText(\"before\");`,\n           `lView[${HEADER_OFFSET + 4}] = document.createText(\"after\");`,\n         ]),\n-        update: [],\n+        update: [] as unknown as I18nUpdateOpCodes,\n       });\n \n \n@@ -229,7 +229,7 @@ describe('Runtime i18n', () => {\n         create: matchDebug([\n           `lView[${HEADER_OFFSET + 2}] = document.createText(\"middle\");`,\n         ]),\n-        update: [],\n+        update: [] as unknown as I18nUpdateOpCodes,\n       });\n     });\n \n@@ -293,17 +293,17 @@ describe('Runtime i18n', () => {\n         ],\n         remove: [\n           matchDebug([\n-            '(lView[0] as Element).remove(lView[24])',\n-            '(lView[0] as Element).remove(lView[25])',\n-            '(lView[0] as Element).remove(lView[27])',\n+            'remove(lView[24])',\n+            'remove(lView[25])',\n+            'remove(lView[27])',\n           ]),\n           matchDebug([\n-            '(lView[0] as Element).remove(lView[28])',\n-            '(lView[0] as Element).remove(lView[29])',\n+            'remove(lView[28])',\n+            'remove(lView[29])',\n           ]),\n           matchDebug([\n-            '(lView[0] as Element).remove(lView[31])',\n-            '(lView[0] as Element).remove(lView[32])',\n+            'remove(lView[31])',\n+            'remove(lView[32])',\n           ]),\n         ],\n         update: [\n@@ -372,13 +372,13 @@ describe('Runtime i18n', () => {\n         ],\n         remove: [\n           matchDebug([\n-            '(lView[0] as Element).remove(lView[24])',\n+            'remove(lView[24])',\n           ]),\n           matchDebug([\n-            '(lView[0] as Element).remove(lView[25])',\n+            'remove(lView[25])',\n             'removeNestedICU(26)',\n-            '(lView[0] as Element).remove(lView[26])',\n-            '(lView[0] as Element).remove(lView[31])',\n+            'remove(lView[26])',\n+            'remove(lView[31])',\n           ]),\n         ],\n       });\n@@ -407,9 +407,9 @@ describe('Runtime i18n', () => {\n           matchDebug([]),\n         ],\n         remove: [\n-          matchDebug(['(lView[0] as Element).remove(lView[28])']),\n-          matchDebug(['(lView[0] as Element).remove(lView[29])']),\n-          matchDebug(['(lView[0] as Element).remove(lView[30])'])\n+          matchDebug(['remove(lView[28])']),\n+          matchDebug(['remove(lView[29])']),\n+          matchDebug(['remove(lView[30])']),\n         ],\n       });\n     });"
        },
        {
            "sha": "5d1f2d7766d6a821f9bfa95ea857962fda7ccf6a",
            "filename": "packages/core/test/render3/i18n_debug_spec.ts",
            "status": "modified",
            "additions": 39,
            "deletions": 37,
            "changes": 76,
            "blob_url": "https://github.com/angular/angular/blob/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Ftest%2Frender3%2Fi18n_debug_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Ftest%2Frender3%2Fi18n_debug_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fi18n_debug_spec.ts?ref=bc5005e35bf1c8fe17f6a7ea4961cc09f6964018",
            "patch": "@@ -6,13 +6,13 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {i18nCreateOpCodesToString, i18nMutateOpCodesToString, i18nUpdateOpCodesToString} from '@angular/core/src/render3/i18n/i18n_debug';\n-import {ELEMENT_MARKER, I18nCreateOpCode, I18nMutateOpCode, I18nUpdateOpCode, ICU_MARKER} from '@angular/core/src/render3/interfaces/i18n';\n+import {i18nCreateOpCodesToString, i18nRemoveOpCodesToString, i18nUpdateOpCodesToString, icuCreateOpCodesToString} from '@angular/core/src/render3/i18n/i18n_debug';\n+import {ELEMENT_MARKER, I18nCreateOpCode, I18nCreateOpCodes, I18nRemoveOpCodes, I18nUpdateOpCode, I18nUpdateOpCodes, ICU_MARKER, IcuCreateOpCode} from '@angular/core/src/render3/interfaces/i18n';\n \n describe('i18n debug', () => {\n   describe('i18nUpdateOpCodesToString', () => {\n     it('should print nothing', () => {\n-      expect(i18nUpdateOpCodesToString([])).toEqual([]);\n+      expect(i18nUpdateOpCodesToString([] as unknown as I18nUpdateOpCodes)).toEqual([]);\n     });\n \n     it('should print text opCode', () => {\n@@ -23,7 +23,7 @@ describe('i18n debug', () => {\n         -4,\n         ' post',\n         1 << I18nUpdateOpCode.SHIFT_REF | I18nUpdateOpCode.Text,\n-      ]))\n+      ] as unknown as I18nUpdateOpCodes))\n           .toEqual(\n               ['if (mask & 0b11) { (lView[1] as Text).textContent = `pre ${lView[i-4]} post`; }']);\n     });\n@@ -39,38 +39,40 @@ describe('i18n debug', () => {\n         'pre ',  -4,\n         ' in ',  -3,\n         ' post', 1 << I18nUpdateOpCode.SHIFT_REF | I18nUpdateOpCode.Attr,\n-        'title', (v) => v,\n-      ]))\n+        'title', (v: any) => v,\n+      ] as unknown as I18nUpdateOpCodes))\n           .toEqual([\n             'if (mask & 0b1) { (lView[1] as Element).setAttribute(\\'title\\', `pre ${lView[i-4]} in ${lView[i-3]} post`); }',\n             'if (mask & 0b10) { (lView[1] as Element).setAttribute(\\'title\\', (function (v) { return v; })(`pre ${lView[i-4]} in ${lView[i-3]} post`)); }'\n           ]);\n     });\n \n     it('should print icuSwitch opCode', () => {\n-      expect(i18nUpdateOpCodesToString([\n-        0b100, 2, -5, 12 << I18nUpdateOpCode.SHIFT_REF | I18nUpdateOpCode.IcuSwitch\n-      ])).toEqual(['if (mask & 0b100) { icuSwitchCase(12, `${lView[i-5]}`); }']);\n+      expect(i18nUpdateOpCodesToString(\n+                 [0b100, 2, -5, 12 << I18nUpdateOpCode.SHIFT_REF | I18nUpdateOpCode.IcuSwitch] as\n+                 unknown as I18nUpdateOpCodes))\n+          .toEqual(['if (mask & 0b100) { icuSwitchCase(12, `${lView[i-5]}`); }']);\n     });\n \n     it('should print icuUpdate opCode', () => {\n-      expect(i18nUpdateOpCodesToString([\n-        0b1000, 1, 13 << I18nUpdateOpCode.SHIFT_REF | I18nUpdateOpCode.IcuUpdate\n-      ])).toEqual(['if (mask & 0b1000) { icuUpdateCase(13); }']);\n+      expect(i18nUpdateOpCodesToString(\n+                 [0b1000, 1, 13 << I18nUpdateOpCode.SHIFT_REF | I18nUpdateOpCode.IcuUpdate] as\n+                 unknown as I18nUpdateOpCodes))\n+          .toEqual(['if (mask & 0b1000) { icuUpdateCase(13); }']);\n     });\n   });\n \n   describe('i18nMutateOpCodesToString', () => {\n     it('should print nothing', () => {\n-      expect(i18nMutateOpCodesToString([])).toEqual([]);\n+      expect(icuCreateOpCodesToString([] as unknown as I18nCreateOpCodes)).toEqual([]);\n     });\n \n     it('should print text AppendChild', () => {\n-      expect(i18nMutateOpCodesToString([\n+      expect(icuCreateOpCodesToString([\n         'xyz', 0,\n-        1 << I18nMutateOpCode.SHIFT_PARENT | 0 << I18nMutateOpCode.SHIFT_REF |\n-            I18nMutateOpCode.AppendChild\n-      ]))\n+        1 << IcuCreateOpCode.SHIFT_PARENT | 0 << IcuCreateOpCode.SHIFT_REF |\n+            IcuCreateOpCode.AppendChild\n+      ] as unknown as I18nCreateOpCodes))\n           .toEqual([\n             'lView[0] = document.createTextNode(\"xyz\")',\n             '(lView[1] as Element).appendChild(lView[0])'\n@@ -79,52 +81,52 @@ describe('i18n debug', () => {\n \n \n     it('should print element AppendChild', () => {\n-      expect(i18nMutateOpCodesToString([\n+      expect(icuCreateOpCodesToString([\n         ELEMENT_MARKER, 'xyz', 0,\n-        1 << I18nMutateOpCode.SHIFT_PARENT | 0 << I18nMutateOpCode.SHIFT_REF |\n-            I18nMutateOpCode.AppendChild\n-      ]))\n+        1 << IcuCreateOpCode.SHIFT_PARENT | 0 << IcuCreateOpCode.SHIFT_REF |\n+            IcuCreateOpCode.AppendChild\n+      ] as unknown as I18nCreateOpCodes))\n           .toEqual([\n             'lView[0] = document.createElement(\"xyz\")',\n             '(lView[1] as Element).appendChild(lView[0])'\n           ]);\n     });\n \n     it('should print comment AppendChild', () => {\n-      expect(i18nMutateOpCodesToString([\n+      expect(icuCreateOpCodesToString([\n         ICU_MARKER, 'xyz', 0,\n-        1 << I18nMutateOpCode.SHIFT_PARENT | 0 << I18nMutateOpCode.SHIFT_REF |\n-            I18nMutateOpCode.AppendChild\n-      ]))\n+        1 << IcuCreateOpCode.SHIFT_PARENT | 0 << IcuCreateOpCode.SHIFT_REF |\n+            IcuCreateOpCode.AppendChild\n+      ] as unknown as I18nCreateOpCodes))\n           .toEqual([\n             'lView[0] = document.createComment(\"xyz\")',\n             '(lView[1] as Element).appendChild(lView[0])'\n           ]);\n     });\n \n     it('should print Remove', () => {\n-      expect(i18nMutateOpCodesToString([\n-        2 << I18nMutateOpCode.SHIFT_PARENT | 0 << I18nMutateOpCode.SHIFT_REF |\n-        I18nMutateOpCode.Remove\n-      ])).toEqual(['(lView[2] as Element).remove(lView[0])']);\n+      expect(i18nRemoveOpCodesToString([123] as unknown as I18nRemoveOpCodes)).toEqual([\n+        'remove(lView[123])'\n+      ]);\n     });\n \n     it('should print Attr', () => {\n-      expect(i18nMutateOpCodesToString([\n-        1 << I18nMutateOpCode.SHIFT_REF | I18nMutateOpCode.Attr, 'attr', 'value'\n-      ])).toEqual(['(lView[1] as Element).setAttribute(\"attr\", \"value\")']);\n+      expect(icuCreateOpCodesToString(\n+                 [1 << IcuCreateOpCode.SHIFT_REF | IcuCreateOpCode.Attr, 'attr', 'value'] as\n+                 unknown as I18nCreateOpCodes))\n+          .toEqual(['(lView[1] as Element).setAttribute(\"attr\", \"value\")']);\n     });\n \n     it('should print RemoveNestedIcu', () => {\n-      expect(i18nMutateOpCodesToString([\n-        1 << I18nMutateOpCode.SHIFT_REF | I18nMutateOpCode.RemoveNestedIcu,\n-      ])).toEqual(['removeNestedICU(1)']);\n+      expect(i18nRemoveOpCodesToString([~123] as unknown as I18nRemoveOpCodes)).toEqual([\n+        'removeNestedICU(123)'\n+      ]);\n     });\n   });\n \n   describe('i18nCreateOpCodesToString', () => {\n     it('should print nothing', () => {\n-      expect(i18nCreateOpCodesToString([])).toEqual([]);\n+      expect(i18nCreateOpCodesToString([] as unknown as I18nCreateOpCodes)).toEqual([]);\n     });\n \n     it('should print text/comment creation', () => {\n@@ -134,7 +136,7 @@ describe('i18n debug', () => {\n         12 << I18nCreateOpCode.SHIFT | I18nCreateOpCode.COMMENT, 'comment at 12',              //\n         13 << I18nCreateOpCode.SHIFT | I18nCreateOpCode.COMMENT | I18nCreateOpCode.APPEND_EAGERLY,\n         'comment at 13, append',  //\n-      ]))\n+      ] as unknown as I18nCreateOpCodes))\n           .toEqual([\n             'lView[10] = document.createText(\"text at 10\");',\n             'lView[11] = document.createText(\"text at 11, append\");',"
        },
        {
            "sha": "8fefab751560548d2e600283ec3682261ebb418f",
            "filename": "packages/core/test/render3/matchers.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Ftest%2Frender3%2Fmatchers.ts",
            "raw_url": "https://github.com/angular/angular/raw/bc5005e35bf1c8fe17f6a7ea4961cc09f6964018/packages%2Fcore%2Ftest%2Frender3%2Fmatchers.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fmatchers.ts?ref=bc5005e35bf1c8fe17f6a7ea4961cc09f6964018",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {I18nDebug, I18nMutateOpCodes, TI18n, TIcu} from '@angular/core/src/render3/interfaces/i18n';\n+import {I18nDebug, IcuCreateOpCodes, TI18n, TIcu} from '@angular/core/src/render3/interfaces/i18n';\n import {TNode} from '@angular/core/src/render3/interfaces/node';\n import {TView} from '@angular/core/src/render3/interfaces/view';\n \n@@ -233,7 +233,7 @@ export function matchDomText(expectedText: string|undefined = undefined):\n }\n \n export function matchI18nMutableOpCodes(expectedMutableOpCodes: string[]):\n-    jasmine.AsymmetricMatcher<I18nMutateOpCodes> {\n+    jasmine.AsymmetricMatcher<IcuCreateOpCodes> {\n   const matcher = function() {};\n   let _actual: any = null;\n "
        }
    ],
    "stats": {
        "total": 520,
        "additions": 273,
        "deletions": 247
    }
}