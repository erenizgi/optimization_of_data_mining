{
    "author": "alan-agius4",
    "message": "build(docs-infra): support building the local `angular-in-memory-web-api` package in `NgPackagesInstaller` (#41313)\n\nIn some cases, we want to test the AIO app or docs examples against the locally built `angular-in-memory-web-api` for example to ensure that the changes in a commit do not introduce a breaking changes.\n\nPR Close #41313",
    "sha": "300d6d1e38cd66a65bb722bbea786f218cf16cf2",
    "files": [
        {
            "sha": "33551acfcfb92298fda6e26fb9580ac1e0bf583c",
            "filename": "aio/tools/ng-packages-installer/index.js",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/300d6d1e38cd66a65bb722bbea786f218cf16cf2/aio%2Ftools%2Fng-packages-installer%2Findex.js",
            "raw_url": "https://github.com/angular/angular/raw/300d6d1e38cd66a65bb722bbea786f218cf16cf2/aio%2Ftools%2Fng-packages-installer%2Findex.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fng-packages-installer%2Findex.js?ref=300d6d1e38cd66a65bb722bbea786f218cf16cf2",
            "patch": "@@ -15,6 +15,7 @@ const LOCAL_MARKER_PATH = 'node_modules/_local_.json';\n const ANGULAR_ROOT_DIR = path.resolve(__dirname, '../../..');\n const ANGULAR_DIST_PACKAGES_DIR = path.join(ANGULAR_ROOT_DIR, 'dist/packages-dist');\n const ZONEJS_DIST_PACKAGES_DIR = path.join(ANGULAR_ROOT_DIR, 'dist/zone.js-dist');\n+const ANGULAR_MISC_DIST_PACKAGES = path.join(ANGULAR_ROOT_DIR, 'dist/packages-dist/misc');\n const DIST_PACKAGES_BUILD_SCRIPT = path.join(ANGULAR_ROOT_DIR, 'scripts/build/build-packages-dist.js');\n const DIST_PACKAGES_BUILD_CMD = `\"${process.execPath}\" \"${DIST_PACKAGES_BUILD_SCRIPT}\"`;\n \n@@ -183,7 +184,7 @@ class NgPackagesInstaller {\n     } else {\n       this._warn([\n         'Automatically building the local Angular/Zone.js packages is currently not supported on Windows.',\n-        `Please, ensure '${ANGULAR_DIST_PACKAGES_DIR}' and '${ZONEJS_DIST_PACKAGES_DIR}' exist and are up-to-date ` +\n+        `Please, ensure '${ANGULAR_DIST_PACKAGES_DIR}', ${ZONEJS_DIST_PACKAGES_DIR} and '${ANGULAR_MISC_DIST_PACKAGES}' exist and are up-to-date ` +\n           `(e.g. by running '${DIST_PACKAGES_BUILD_SCRIPT}' in Git Bash for Windows, Windows Subsystem for Linux or ` +\n           'a Linux docker container or VM).',\n         '',\n@@ -222,6 +223,7 @@ class NgPackagesInstaller {\n   _getDistPackages() {\n     this._log(`Angular distributable directory: ${ANGULAR_DIST_PACKAGES_DIR}.`);\n     this._log(`Zone.js distributable directory: ${ZONEJS_DIST_PACKAGES_DIR}.`);\n+    this._log(`angular-in-memory-web-api distributable directory: ${ANGULAR_MISC_DIST_PACKAGES}.`);\n \n     if (this.buildPackages) {\n       this._buildDistPackages();\n@@ -260,6 +262,7 @@ class NgPackagesInstaller {\n     const packageConfigs = {\n       ...collectPackages(ANGULAR_DIST_PACKAGES_DIR),\n       ...collectPackages(ZONEJS_DIST_PACKAGES_DIR),\n+      ...collectPackages(ANGULAR_MISC_DIST_PACKAGES),\n     };\n \n     this._log('Found the following Angular distributables:', Object.keys(packageConfigs).map(key => `\\n - ${key}`));"
        },
        {
            "sha": "ed1d5afc1d64fa439182aa16260e55a1cd065a8b",
            "filename": "packages/misc/angular-in-memory-web-api/package.json",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/300d6d1e38cd66a65bb722bbea786f218cf16cf2/packages%2Fmisc%2Fangular-in-memory-web-api%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/300d6d1e38cd66a65bb722bbea786f218cf16cf2/packages%2Fmisc%2Fangular-in-memory-web-api%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fmisc%2Fangular-in-memory-web-api%2Fpackage.json?ref=300d6d1e38cd66a65bb722bbea786f218cf16cf2",
            "patch": "@@ -5,10 +5,12 @@\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n   \"peerDependencies\": {\n-    \"@angular/core\": \"^8.0.0\",\n-    \"@angular/common\": \"^8.0.0\",\n-    \"rxjs\": \"^6.5.3\",\n-    \"tslib\": \"^1.10.0\"\n+    \"@angular/core\": \"^12.0.0-next.6\",\n+    \"@angular/common\": \"^12.0.0-next.6\",\n+    \"rxjs\": \"^6.5.3\"\n+  },\n+  \"dependencies\": {\n+    \"tslib\": \"^2.1.0\"\n   },\n   \"repository\": {\n     \"type\": \"git\","
        },
        {
            "sha": "db0b247217a485a3e356d6bdcd56f4e67b378c57",
            "filename": "scripts/build/angular-in-memory-web-api.js",
            "status": "added",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/300d6d1e38cd66a65bb722bbea786f218cf16cf2/scripts%2Fbuild%2Fangular-in-memory-web-api.js",
            "raw_url": "https://github.com/angular/angular/raw/300d6d1e38cd66a65bb722bbea786f218cf16cf2/scripts%2Fbuild%2Fangular-in-memory-web-api.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/scripts%2Fbuild%2Fangular-in-memory-web-api.js?ref=300d6d1e38cd66a65bb722bbea786f218cf16cf2",
            "patch": "@@ -0,0 +1,36 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+'use strict';\n+\n+const {chmod, cp, mkdir, rm} = require('shelljs');\n+const {baseDir, bazelBin, bazelCmd, exec, scriptPath} = require('./package-builder');\n+\n+/**\n+ * Build the `angular-in-memory-web-api` npm package and copy it to `dist/packages-dist/misc`.\n+ */\n+function buildAngularInMemoryWebAPIPackage() {\n+  console.info('##############################');\n+  console.info(`${scriptPath}:`);\n+  console.info('  Building angular-in-memory-web-api npm package');\n+  console.info('##############################');\n+  exec(`${bazelCmd} build //packages/misc/angular-in-memory-web-api:npm_package`);\n+\n+  const buildOutputDir = `${bazelBin}/packages/misc/angular-in-memory-web-api/npm_package`;\n+  const distTargetDir = `${baseDir}/dist/packages-dist/misc/angular-in-memory-web-api`;\n+\n+  console.info(`# Copy artifacts to ${distTargetDir}`);\n+  mkdir('-p', distTargetDir);\n+  rm('-rf', distTargetDir);\n+  cp('-R', buildOutputDir, distTargetDir);\n+  chmod('-R', 'u+w', distTargetDir);\n+\n+  console.info('');\n+}\n+\n+module.exports = {buildAngularInMemoryWebAPIPackage};"
        },
        {
            "sha": "8ecda36989edf51ba747bcd65609ca2d48270285",
            "filename": "scripts/build/build-packages-dist.js",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/300d6d1e38cd66a65bb722bbea786f218cf16cf2/scripts%2Fbuild%2Fbuild-packages-dist.js",
            "raw_url": "https://github.com/angular/angular/raw/300d6d1e38cd66a65bb722bbea786f218cf16cf2/scripts%2Fbuild%2Fbuild-packages-dist.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/scripts%2Fbuild%2Fbuild-packages-dist.js?ref=300d6d1e38cd66a65bb722bbea786f218cf16cf2",
            "patch": "@@ -12,6 +12,7 @@\n const {buildZoneJsPackage} = require('./zone-js-builder');\n const {buildDevInfraPackage} = require('./dev-infra-builder');\n const {buildTargetPackages} = require('./package-builder');\n+const {buildAngularInMemoryWebAPIPackage} = require('./angular-in-memory-web-api');\n \n \n // Build the legacy (view engine) npm packages into `dist/packages-dist/`.\n@@ -23,3 +24,7 @@ buildZoneJsPackage('dist/zone.js-dist');\n \n // Build the `angular-dev-infra` npm package into `dist/packages-dist/@angular/dev-infra-private`\n buildDevInfraPackage();\n+\n+// Build the `angular-in-memory-web-api` npm package into\n+// `dist/packages-dist/misc/angular-in-memory-web-api`\n+buildAngularInMemoryWebAPIPackage();"
        }
    ],
    "stats": {
        "total": 56,
        "additions": 51,
        "deletions": 5
    }
}