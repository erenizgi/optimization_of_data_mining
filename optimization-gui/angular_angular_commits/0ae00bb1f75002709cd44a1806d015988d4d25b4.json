{
    "author": "sonukapoor",
    "message": "fix(upgrade): add try/catch when downgrading injectables (#38671)\n\nThis commit improves the error thrown by the downgrade module with a more\ndescriptive message on why the downgrade is failing.\n\nCloses #37579\n\nPR Close #38671",
    "sha": "0ae00bb1f75002709cd44a1806d015988d4d25b4",
    "files": [
        {
            "sha": "af2c7a20bd623e96275dbb403113e789ed470553",
            "filename": "packages/upgrade/src/common/src/downgrade_injectable.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/0ae00bb1f75002709cd44a1806d015988d4d25b4/packages%2Fupgrade%2Fsrc%2Fcommon%2Fsrc%2Fdowngrade_injectable.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ae00bb1f75002709cd44a1806d015988d4d25b4/packages%2Fupgrade%2Fsrc%2Fcommon%2Fsrc%2Fdowngrade_injectable.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fupgrade%2Fsrc%2Fcommon%2Fsrc%2Fdowngrade_injectable.ts?ref=0ae00bb1f75002709cd44a1806d015988d4d25b4",
            "patch": "@@ -79,8 +79,12 @@ export function downgradeInjectable(token: any, downgradedModule: string = ''):\n \n     validateInjectionKey($injector, downgradedModule, injectorKey, attemptedAction);\n \n-    const injector: Injector = $injector.get(injectorKey);\n-    return injector.get(token);\n+    try {\n+      const injector: Injector = $injector.get(injectorKey);\n+      return injector.get(token);\n+    } catch (err) {\n+      throw new Error(`Error while ${attemptedAction}: ${err.message || err}`);\n+    }\n   };\n   (factory as any)['$inject'] = [$INJECTOR];\n "
        },
        {
            "sha": "b2ea6a602e0899793fcb6f5ba9566ba0cc96e070",
            "filename": "packages/upgrade/src/common/test/downgrade_injectable_spec.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/0ae00bb1f75002709cd44a1806d015988d4d25b4/packages%2Fupgrade%2Fsrc%2Fcommon%2Ftest%2Fdowngrade_injectable_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ae00bb1f75002709cd44a1806d015988d4d25b4/packages%2Fupgrade%2Fsrc%2Fcommon%2Ftest%2Fdowngrade_injectable_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fupgrade%2Fsrc%2Fcommon%2Ftest%2Fdowngrade_injectable_spec.ts?ref=0ae00bb1f75002709cd44a1806d015988d4d25b4",
            "patch": "@@ -48,4 +48,16 @@ describe('downgradeInjectable', () => {\n     expect(factory(mockNg1Injector)).toEqual('service value');\n     expect(mockNg2Injector.get).toHaveBeenCalledWith('someToken');\n   });\n+\n+  it('should mention the injectable\\'s name in the error thrown when failing to retrieve injectable',\n+     () => {\n+       const factory = downgradeInjectable('someToken');\n+       expect(factory).toEqual(jasmine.any(Function));\n+       expect((factory as any).$inject).toEqual([$INJECTOR]);\n+\n+       const {mockNg1Injector, mockNg2Injector} = setupMockInjectors();\n+       mockNg2Injector.get.and.throwError('Mock failure');\n+       expect(() => factory(mockNg1Injector))\n+           .toThrowError(/^Error while instantiating injectable 'someToken': Mock failure/);\n+     });\n });"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 18,
        "deletions": 2
    }
}