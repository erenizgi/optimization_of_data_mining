{
    "author": "gkalpak",
    "message": "refactor(docs-infra): support multiple deployments per run (#39853)\n\nPreviously, the `deploy-to-firebase.js` script would only perform one\ndeployment operation on each run.\n\nThis commit adds support for performing multiple deployment operations.\n\nNOTE:\nIn a subsequent commit, this will be leveraged fix an issue with\n`rc.angular.io` redirects in the presence of a ServiceWorker by\ndeploying the same artifacts to multiple Firebase projects/sites.\nSee #39760 for more details.\n\nPR Close #39853",
    "sha": "53bd832c778b420063cd8ebcf00521e6c38a8df9",
    "files": [
        {
            "sha": "0869a70ccac76025265495c33ec8f21638781b56",
            "filename": "aio/scripts/deploy-to-firebase.js",
            "status": "modified",
            "additions": 45,
            "deletions": 31,
            "changes": 76,
            "blob_url": "https://github.com/angular/angular/blob/53bd832c778b420063cd8ebcf00521e6c38a8df9/aio%2Fscripts%2Fdeploy-to-firebase.js",
            "raw_url": "https://github.com/angular/angular/raw/53bd832c778b420063cd8ebcf00521e6c38a8df9/aio%2Fscripts%2Fdeploy-to-firebase.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Fdeploy-to-firebase.js?ref=53bd832c778b420063cd8ebcf00521e6c38a8df9",
            "patch": "@@ -15,7 +15,7 @@ const NG_REMOTE_URL = `https://github.com/${REPO_SLUG}.git`;\n \n // Exports\n module.exports = {\n-  computeDeploymentInfo,\n+  computeDeploymentsInfo,\n   computeInputVars,\n   getLatestCommit,\n };\n@@ -24,26 +24,36 @@ module.exports = {\n if (require.main === module) {\n   const isDryRun = process.argv[2] === '--dry-run';\n   const inputVars = computeInputVars(process.env);\n-  const deploymentInfo = computeDeploymentInfo(inputVars);\n+  const deploymentsInfo = computeDeploymentsInfo(inputVars);\n+  const totalDeployments = deploymentsInfo.length;\n \n-  if (deploymentInfo.skipped) {\n-    console.log(deploymentInfo.reason);\n-  } else {\n+  console.log(`Total deployments: ${totalDeployments}`);\n+\n+  deploymentsInfo.forEach((deploymentInfo, idx) => {\n     console.log(\n-        `Git branch          : ${inputVars.currentBranch}\\n` +\n-        `Git commit          : ${inputVars.currentCommit}\\n` +\n-        `Build/deploy mode   : ${deploymentInfo.deployEnv}\\n` +\n-        `Firebase project    : ${deploymentInfo.projectId}\\n` +\n-        `Firebase site       : ${deploymentInfo.siteId}\\n` +\n-        `Pre-deploy actions  : ${serializeActions(deploymentInfo.preDeployActions)}\\n` +\n-        `Post-deploy actions : ${serializeActions(deploymentInfo.postDeployActions)}\\n` +\n-        `Deployment URLs     : ${deploymentInfo.deployedUrl}\\n` +\n-        `                      https://${deploymentInfo.siteId}.web.app/`);\n-\n-    if (!isDryRun) {\n-      deploy({...inputVars, ...deploymentInfo});\n+        `\\n\\n\\nDeployment ${idx + 1} of ${totalDeployments}\\n` +\n+        '-----------------');\n+\n+    if (deploymentInfo.skipped) {\n+      console.log(deploymentInfo.reason);\n+    } else {\n+      console.log(\n+          `Git branch          : ${inputVars.currentBranch}\\n` +\n+          `Git commit          : ${inputVars.currentCommit}\\n` +\n+          `Build/deploy mode   : ${deploymentInfo.deployEnv}\\n` +\n+          `Firebase project    : ${deploymentInfo.projectId}\\n` +\n+          `Firebase site       : ${deploymentInfo.siteId}\\n` +\n+          `Pre-deploy actions  : ${serializeActions(deploymentInfo.preDeployActions)}\\n` +\n+          `Post-deploy actions : ${serializeActions(deploymentInfo.postDeployActions)}\\n` +\n+          `Deployment URLs     : ${deploymentInfo.deployedUrl}\\n` +\n+          `                      https://${deploymentInfo.siteId}.web.app/`);\n+\n+      if (!isDryRun) {\n+        deploy({...inputVars, ...deploymentInfo});\n+      }\n     }\n-  }\n+  });\n+\n }\n \n // Helpers\n@@ -63,23 +73,25 @@ function checkPayloadSize() {\n   yarn('payload-size');\n }\n \n-function computeDeploymentInfo(\n+function computeDeploymentsInfo(\n     {currentBranch, currentCommit, isPullRequest, repoName, repoOwner, stableBranch}) {\n   // Do not deploy if we are running in a fork.\n   if (`${repoOwner}/${repoName}` !== REPO_SLUG) {\n-    return skipDeployment(`Skipping deploy because this is not ${REPO_SLUG}.`);\n+    return [skipDeployment(`Skipping deploy because this is not ${REPO_SLUG}.`)];\n   }\n \n   // Do not deploy if this is a PR. PRs are deployed in the `aio_preview` CircleCI job.\n   if (isPullRequest) {\n-    return skipDeployment('Skipping deploy because this is a PR build.');\n+    return [skipDeployment('Skipping deploy because this is a PR build.')];\n   }\n \n   // Do not deploy if the current commit is not the latest on its branch.\n   const latestCommit = getLatestCommit(currentBranch);\n   if (currentCommit !== latestCommit) {\n-    return skipDeployment(\n-        `Skipping deploy because ${currentCommit} is not the latest commit (${latestCommit}).`);\n+    return [\n+      skipDeployment(\n+          `Skipping deploy because ${currentCommit} is not the latest commit (${latestCommit}).`),\n+    ];\n   }\n \n   // The deployment mode is computed based on the branch we are building.\n@@ -120,9 +132,9 @@ function computeDeploymentInfo(\n   };\n \n   if (currentBranch === 'master') {\n-    return deploymentInfoPerTarget.next;\n+    return [deploymentInfoPerTarget.next];\n   } else if (currentBranch === stableBranch) {\n-    return deploymentInfoPerTarget.stable;\n+    return [deploymentInfoPerTarget.stable];\n   } else {\n     const stableBranchMajorVersion = computeMajorVersion(stableBranch);\n \n@@ -140,20 +152,22 @@ function computeDeploymentInfo(\n     // Do not deploy if it is not the latest branch for the given major version.\n     // NOTE: At this point, we know the current branch is not the stable branch.\n     if (currentBranch !== mostRecentMinorVersionBranch) {\n-      return skipDeployment(\n-          `Skipping deploy of branch \"${currentBranch}\" to Firebase.\\n` +\n-          'There is a more recent branch with the same major version: ' +\n-          `\"${mostRecentMinorVersionBranch}\"`);\n+      return [\n+        skipDeployment(\n+            `Skipping deploy of branch \"${currentBranch}\" to Firebase.\\n` +\n+            'There is a more recent branch with the same major version: ' +\n+            `\"${mostRecentMinorVersionBranch}\"`),\n+      ];\n     }\n \n     return (currentBranchMajorVersion < stableBranchMajorVersion) ?\n         // This is the latest minor version for a major that is less than the stable major version:\n         // Deploy as `archive`.\n-        deploymentInfoPerTarget.archive :\n+        [deploymentInfoPerTarget.archive] :\n         // This is the latest minor version for a major that is equal or greater than the stable\n         // major version, but not the stable version itself:\n         // Deploy as `rc`.\n-        deploymentInfoPerTarget.rc;\n+        [deploymentInfoPerTarget.rc];\n   }\n \n   // We should never get here."
        },
        {
            "sha": "250ba7eca1c74cc95730534fe19670dfdc33933a",
            "filename": "aio/scripts/deploy-to-firebase.spec.js",
            "status": "modified",
            "additions": 169,
            "deletions": 129,
            "changes": 298,
            "blob_url": "https://github.com/angular/angular/blob/53bd832c778b420063cd8ebcf00521e6c38a8df9/aio%2Fscripts%2Fdeploy-to-firebase.spec.js",
            "raw_url": "https://github.com/angular/angular/raw/53bd832c778b420063cd8ebcf00521e6c38a8df9/aio%2Fscripts%2Fdeploy-to-firebase.spec.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Fdeploy-to-firebase.spec.js?ref=53bd832c778b420063cd8ebcf00521e6c38a8df9",
            "patch": "@@ -2,283 +2,317 @@\n 'use strict';\n \n const {execSync} = require('child_process');\n-const {computeDeploymentInfo, computeInputVars, getLatestCommit} = require('./deploy-to-firebase');\n+const {computeDeploymentsInfo, computeInputVars, getLatestCommit} = require('./deploy-to-firebase');\n \n \n describe('deploy-to-firebase:', () => {\n   // Helpers\n   const jsonFunctionReplacer = (_key, val) =>\n     (typeof val === 'function') ? `function:${val.name}` : val;\n-  const getDeploymentInfoFor = env => {\n-    const deploymentInfo = computeDeploymentInfo(computeInputVars(env));\n-    return JSON.parse(JSON.stringify(deploymentInfo, jsonFunctionReplacer));\n+  const getDeploymentsInfoFor = env => {\n+    const deploymentsInfo = computeDeploymentsInfo(computeInputVars(env));\n+    return JSON.parse(JSON.stringify(deploymentsInfo, jsonFunctionReplacer));\n   };\n \n   it('master - skip deploy - not angular', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'notangular',\n-    })).toEqual({\n-      skipped: true,\n-      reason: 'Skipping deploy because this is not angular/angular.',\n-    });\n+    })).toEqual([\n+      {\n+        skipped: true,\n+        reason: 'Skipping deploy because this is not angular/angular.',\n+      },\n+    ]);\n   });\n \n   it('master - skip deploy - angular fork', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'notangular',\n       CI_REPO_NAME: 'angular',\n-    })).toEqual({\n-      skipped: true,\n-      reason: 'Skipping deploy because this is not angular/angular.',\n-    });\n+    })).toEqual([\n+      {\n+        skipped: true,\n+        reason: 'Skipping deploy because this is not angular/angular.',\n+      },\n+    ]);\n   });\n \n   it('master - skip deploy - pull request', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'true',\n-    })).toEqual({\n-      skipped: true,\n-      reason: 'Skipping deploy because this is a PR build.',\n-    });\n+    })).toEqual([\n+      {\n+        skipped: true,\n+        reason: 'Skipping deploy because this is a PR build.',\n+      },\n+    ]);\n   });\n \n   it('master - deploy success', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: 'master',\n       CI_COMMIT: getLatestCommit('master'),\n-    })).toEqual({\n-      deployEnv: 'next',\n-      projectId: 'angular-io',\n-      siteId: 'next-angular-io-site',\n-      deployedUrl: 'https://next.angular.io/',\n-      preDeployActions: ['function:build', 'function:checkPayloadSize'],\n-      postDeployActions: ['function:testPwaScore'],\n-    });\n+    })).toEqual([\n+      {\n+        deployEnv: 'next',\n+        projectId: 'angular-io',\n+        siteId: 'next-angular-io-site',\n+        deployedUrl: 'https://next.angular.io/',\n+        preDeployActions: ['function:build', 'function:checkPayloadSize'],\n+        postDeployActions: ['function:testPwaScore'],\n+      },\n+    ]);\n   });\n \n   it('master - skip deploy - commit not HEAD', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: 'master',\n       CI_COMMIT: 'DUMMY_TEST_COMMIT',\n-    })).toEqual({\n-      skipped: true,\n-      reason:\n-          'Skipping deploy because DUMMY_TEST_COMMIT is not the latest commit ' +\n-          `(${getLatestCommit('master')}).`,\n-    });\n+    })).toEqual([\n+      {\n+        skipped: true,\n+        reason:\n+            'Skipping deploy because DUMMY_TEST_COMMIT is not the latest commit ' +\n+            `(${getLatestCommit('master')}).`,\n+      },\n+    ]);\n   });\n \n   it('stable - deploy success', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: '4.3.x',\n       CI_STABLE_BRANCH: '4.3.x',\n       CI_COMMIT: getLatestCommit('4.3.x'),\n-    })).toEqual({\n-      deployEnv: 'stable',\n-      projectId: 'angular-io',\n-      siteId: 'v4-angular-io-site',\n-      deployedUrl: 'https://angular.io/',\n-      preDeployActions: ['function:build', 'function:checkPayloadSize'],\n-      postDeployActions: ['function:testPwaScore'],\n-    });\n+    })).toEqual([\n+      {\n+        deployEnv: 'stable',\n+        projectId: 'angular-io',\n+        siteId: 'v4-angular-io-site',\n+        deployedUrl: 'https://angular.io/',\n+        preDeployActions: ['function:build', 'function:checkPayloadSize'],\n+        postDeployActions: ['function:testPwaScore'],\n+      },\n+    ]);\n   });\n \n   it('stable - skip deploy - commit not HEAD', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: '4.3.x',\n       CI_STABLE_BRANCH: '4.3.x',\n       CI_COMMIT: 'DUMMY_TEST_COMMIT',\n-    })).toEqual({\n-      skipped: true,\n-      reason:\n-          'Skipping deploy because DUMMY_TEST_COMMIT is not the latest commit ' +\n-          `(${getLatestCommit('4.3.x')}).`,\n-    });\n+    })).toEqual([\n+      {\n+        skipped: true,\n+        reason:\n+            'Skipping deploy because DUMMY_TEST_COMMIT is not the latest commit ' +\n+            `(${getLatestCommit('4.3.x')}).`,\n+      },\n+    ]);\n   });\n \n   it('archive - deploy success', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: '2.4.x',\n       CI_STABLE_BRANCH: '4.3.x',\n       CI_COMMIT: getLatestCommit('2.4.x'),\n-    })).toEqual({\n-      deployEnv: 'archive',\n-      projectId: 'angular-io',\n-      siteId: 'v2-angular-io-site',\n-      deployedUrl: 'https://v2.angular.io/',\n-      preDeployActions: ['function:build', 'function:checkPayloadSize'],\n-      postDeployActions: ['function:testPwaScore'],\n-    });\n+    })).toEqual([\n+      {\n+        deployEnv: 'archive',\n+        projectId: 'angular-io',\n+        siteId: 'v2-angular-io-site',\n+        deployedUrl: 'https://v2.angular.io/',\n+        preDeployActions: ['function:build', 'function:checkPayloadSize'],\n+        postDeployActions: ['function:testPwaScore'],\n+      },\n+    ]);\n   });\n \n   // v9 used to be special-cased, because it was piloting the Firebase hosting \"multisites\" setup.\n   // See https://angular-team.atlassian.net/browse/DEV-125 for more info.\n   it('archive - deploy success (no special case for v9)', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: '9.1.x',\n       CI_STABLE_BRANCH: '10.0.x',\n       CI_COMMIT: getLatestCommit('9.1.x'),\n-    })).toEqual({\n-      deployEnv: 'archive',\n-      projectId: 'angular-io',\n-      siteId: 'v9-angular-io-site',\n-      deployedUrl: 'https://v9.angular.io/',\n-      preDeployActions: ['function:build', 'function:checkPayloadSize'],\n-      postDeployActions: ['function:testPwaScore'],\n-    });\n+    })).toEqual([\n+      {\n+        deployEnv: 'archive',\n+        projectId: 'angular-io',\n+        siteId: 'v9-angular-io-site',\n+        deployedUrl: 'https://v9.angular.io/',\n+        preDeployActions: ['function:build', 'function:checkPayloadSize'],\n+        postDeployActions: ['function:testPwaScore'],\n+      },\n+    ]);\n   });\n \n   it('archive - skip deploy - commit not HEAD', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: '2.4.x',\n       CI_STABLE_BRANCH: '4.3.x',\n       CI_COMMIT: 'DUMMY_TEST_COMMIT',\n-    })).toEqual({\n-      skipped: true,\n-      reason:\n-          'Skipping deploy because DUMMY_TEST_COMMIT is not the latest commit ' +\n-          `(${getLatestCommit('2.4.x')}).`,\n-    });\n+    })).toEqual([\n+      {\n+        skipped: true,\n+        reason:\n+            'Skipping deploy because DUMMY_TEST_COMMIT is not the latest commit ' +\n+            `(${getLatestCommit('2.4.x')}).`,\n+      },\n+    ]);\n   });\n \n   it('archive - skip deploy - major same as stable, minor less than stable', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: '2.1.x',\n       CI_STABLE_BRANCH: '2.2.x',\n       CI_COMMIT: getLatestCommit('2.1.x'),\n-    })).toEqual({\n-      skipped: true,\n-      reason:\n-          'Skipping deploy of branch \"2.1.x\" to Firebase.\\n' +\n-          'There is a more recent branch with the same major version: \"2.4.x\"',\n-    });\n+    })).toEqual([\n+      {\n+        skipped: true,\n+        reason:\n+            'Skipping deploy of branch \"2.1.x\" to Firebase.\\n' +\n+            'There is a more recent branch with the same major version: \"2.4.x\"',\n+      },\n+    ]);\n   });\n \n   it('archive - skip deploy - major lower than stable, minor not latest', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: '2.1.x',\n       CI_STABLE_BRANCH: '4.3.x',\n       CI_COMMIT: getLatestCommit('2.1.x'),\n-    })).toEqual({\n-      skipped: true,\n-      reason:\n-          'Skipping deploy of branch \"2.1.x\" to Firebase.\\n' +\n-          'There is a more recent branch with the same major version: \"2.4.x\"',\n-    });\n+    })).toEqual([\n+      {\n+        skipped: true,\n+        reason:\n+            'Skipping deploy of branch \"2.1.x\" to Firebase.\\n' +\n+            'There is a more recent branch with the same major version: \"2.4.x\"',\n+      },\n+    ]);\n   });\n \n   it('rc - deploy success - major higher than stable', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: '4.4.x',\n       CI_STABLE_BRANCH: '2.2.x',\n       CI_COMMIT: getLatestCommit('4.4.x'),\n-    })).toEqual({\n-      deployEnv: 'rc',\n-      projectId: 'angular-io',\n-      siteId: 'rc-angular-io-site',\n-      deployedUrl: 'https://rc.angular.io/',\n-      preDeployActions: ['function:build', 'function:checkPayloadSize'],\n-      postDeployActions: ['function:testPwaScore'],\n-    });\n+    })).toEqual([\n+      {\n+        deployEnv: 'rc',\n+        projectId: 'angular-io',\n+        siteId: 'rc-angular-io-site',\n+        deployedUrl: 'https://rc.angular.io/',\n+        preDeployActions: ['function:build', 'function:checkPayloadSize'],\n+        postDeployActions: ['function:testPwaScore'],\n+      },\n+    ]);\n   });\n \n   it('rc - deploy success - major same as stable, minor higher', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: '2.4.x',\n       CI_STABLE_BRANCH: '2.2.x',\n       CI_COMMIT: getLatestCommit('2.4.x'),\n-    })).toEqual({\n-      deployEnv: 'rc',\n-      projectId: 'angular-io',\n-      siteId: 'rc-angular-io-site',\n-      deployedUrl: 'https://rc.angular.io/',\n-      preDeployActions: ['function:build', 'function:checkPayloadSize'],\n-      postDeployActions: ['function:testPwaScore'],\n-    });\n+    })).toEqual([\n+      {\n+        deployEnv: 'rc',\n+        projectId: 'angular-io',\n+        siteId: 'rc-angular-io-site',\n+        deployedUrl: 'https://rc.angular.io/',\n+        preDeployActions: ['function:build', 'function:checkPayloadSize'],\n+        postDeployActions: ['function:testPwaScore'],\n+      },\n+    ]);\n   });\n \n   it('rc - skip deploy - commit not HEAD', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: '2.4.x',\n       CI_STABLE_BRANCH: '2.2.x',\n       CI_COMMIT: 'DUMMY_TEST_COMMIT',\n-    })).toEqual({\n-      skipped: true,\n-      reason:\n-          'Skipping deploy because DUMMY_TEST_COMMIT is not the latest commit ' +\n-          `(${getLatestCommit('2.4.x')}).`,\n-    });\n+    })).toEqual([\n+      {\n+        skipped: true,\n+        reason:\n+            'Skipping deploy because DUMMY_TEST_COMMIT is not the latest commit ' +\n+            `(${getLatestCommit('2.4.x')}).`,\n+      },\n+    ]);\n   });\n \n   it('rc - skip deploy - major same as stable, minor not latest', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: '2.1.x',\n       CI_STABLE_BRANCH: '2.0.x',\n       CI_COMMIT: getLatestCommit('2.1.x'),\n-    })).toEqual({\n-      skipped: true,\n-      reason:\n-          'Skipping deploy of branch \"2.1.x\" to Firebase.\\n' +\n-          'There is a more recent branch with the same major version: \"2.4.x\"',\n-    });\n+    })).toEqual([\n+      {\n+        skipped: true,\n+        reason:\n+            'Skipping deploy of branch \"2.1.x\" to Firebase.\\n' +\n+            'There is a more recent branch with the same major version: \"2.4.x\"',\n+      },\n+    ]);\n   });\n \n   it('rc - skip deploy - major higher than stable, minor not latest', () => {\n-    expect(getDeploymentInfoFor({\n+    expect(getDeploymentsInfoFor({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n       CI_PULL_REQUEST: 'false',\n       CI_BRANCH: '4.3.x',\n       CI_STABLE_BRANCH: '2.4.x',\n       CI_COMMIT: getLatestCommit('4.3.x'),\n-    })).toEqual({\n-      skipped: true,\n-      reason:\n-          'Skipping deploy of branch \"4.3.x\" to Firebase.\\n' +\n-          'There is a more recent branch with the same major version: \"4.4.x\"',\n-    });\n+    })).toEqual([\n+      {\n+        skipped: true,\n+        reason:\n+            'Skipping deploy of branch \"4.3.x\" to Firebase.\\n' +\n+            'There is a more recent branch with the same major version: \"4.4.x\"',\n+      },\n+    ]);\n   });\n \n   it('integration - should run the main script without error', () => {\n@@ -293,6 +327,12 @@ describe('deploy-to-firebase:', () => {\n     };\n     const result = execSync(cmd, {encoding: 'utf8', env}).trim();\n     expect(result).toBe(\n+        'Total deployments: 1\\n' +\n+        '\\n' +\n+        '\\n' +\n+        '\\n' +\n+        'Deployment 1 of 1\\n' +\n+        '-----------------\\n' +\n         'Git branch          : master\\n' +\n         `Git commit          : ${commit}\\n` +\n         'Build/deploy mode   : next\\n' +"
        }
    ],
    "stats": {
        "total": 374,
        "additions": 214,
        "deletions": 160
    }
}