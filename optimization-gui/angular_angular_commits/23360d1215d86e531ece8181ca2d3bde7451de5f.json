{
    "author": "alxhub",
    "message": "test(language-service): update compiler_spec to use the new testing env (#40966)\n\nThis commit updates compiler_spec.ts in the Ivy LS suite to utilize the new\ntesting environment which was introduced in the previous commit. Eventually\nall specs should be converted, but converting one right now helps ensure\nthat the new testing env is working properly and able to support real tests.\n\nPR Close #40966",
    "sha": "23360d1215d86e531ece8181ca2d3bde7451de5f",
    "files": [
        {
            "sha": "027c32ff3a8c9dc369d82a080810559a694335bd",
            "filename": "packages/language-service/ivy/test/compiler_spec.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 25,
            "changes": 38,
            "blob_url": "https://github.com/angular/angular/blob/23360d1215d86e531ece8181ca2d3bde7451de5f/packages%2Flanguage-service%2Fivy%2Ftest%2Fcompiler_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/23360d1215d86e531ece8181ca2d3bde7451de5f/packages%2Flanguage-service%2Fivy%2Ftest%2Fcompiler_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fcompiler_spec.ts?ref=23360d1215d86e531ece8181ca2d3bde7451de5f",
            "patch": "@@ -6,47 +6,35 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {absoluteFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {initMockFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n \n import {isNgSpecificDiagnostic, LanguageServiceTestEnv} from '../testing';\n-import {LanguageServiceTestEnvironment} from './env';\n \n describe('language-service/compiler integration', () => {\n   beforeEach(() => {\n     initMockFileSystem('Native');\n   });\n \n   it('should react to a change in an external template', () => {\n-    const cmpFile = absoluteFrom('/test.ts');\n-    const tmplFile = absoluteFrom('/test.html');\n-\n-    const env = LanguageServiceTestEnvironment.setup([\n-      {\n-        name: cmpFile,\n-        contents: `\n-          import {Component} from '@angular/core';\n+    const env = LanguageServiceTestEnv.setup();\n+    const project = env.addProject('test', {\n+      'test.ts': `\n+        import {Component} from '@angular/core';\n \n           @Component({\n             selector: 'test-cmp',\n             templateUrl: './test.html',\n           })\n           export class TestCmp {}\n-        `,\n-        isRoot: true,\n-      },\n-      {\n-        name: tmplFile,\n-        contents: '<other-cmp>Test</other-cmp>',\n-      },\n-    ]);\n-\n-    const diags = env.ngLS.getSemanticDiagnostics(cmpFile);\n-    expect(diags.length).toBeGreaterThan(0);\n-\n-    env.updateFile(tmplFile, '<div>Test</div>');\n-    const afterDiags = env.ngLS.getSemanticDiagnostics(cmpFile);\n-    expect(afterDiags.length).toBe(0);\n+      `,\n+      'test.html': `<other-cmp>Test</other-cmp>`\n+    });\n+\n+    expect(project.getDiagnosticsForFile('test.ts').length).toBeGreaterThan(0);\n+\n+    const tmplFile = project.openFile('test.html');\n+    tmplFile.contents = '<div>Test</div>';\n+    expect(project.getDiagnosticsForFile('test.ts').length).toEqual(0);\n   });\n \n   it('should not produce errors from inline test declarations mixing with those of the app', () => {"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 13,
        "deletions": 25
    }
}