{
    "author": "devversion",
    "message": "feat(dev-infra): add bazel firefox browser with RBE compatibility (#38029)\n\nAdds Firefox as browser to `dev-infra/browsers` with RBE\ncompatibility. The default Firefox browser is not compatible similar to\nthe default Chromium version exposed by `rules_webtesting`.\n\nThe Angular Components repository will use this browser target as\nit enables RBE support. Also it gives us more flexibility about\nthe Firefox version we test against. The version provided by\n`rules_webtesting` is very old and most likely not frequently\nupdated (based on past experience).\n\nPR Close #38029",
    "sha": "545f1dbac9112393f545a3ba392e545bc923c21b",
    "files": [
        {
            "sha": "8cbfc98a712aa3649a8e5f28679d0643758c00ec",
            "filename": "dev-infra/benchmark/component_benchmark/benchmark_test.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fbenchmark_test.bzl",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fbenchmark_test.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fcomponent_benchmark%2Fbenchmark_test.bzl?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "patch": "@@ -10,7 +10,7 @@ load(\"@npm_bazel_protractor//:index.bzl\", \"protractor_web_test_suite\")\n def benchmark_test(name, server, tags = [], **kwargs):\n     protractor_web_test_suite(\n         name = name,\n-        browsers = [\"//dev-infra/browsers:chromium\"],\n+        browsers = [\"//dev-infra/browsers/chromium:chromium\"],\n         configuration = \"//dev-infra/benchmark/component_benchmark:protractor-perf.conf.js\",\n         on_prepare = \"//dev-infra/benchmark/component_benchmark:start-server.js\",\n         server = server,"
        },
        {
            "sha": "76f0ce6ecc861a45676d4a7bff14e10cad839d28",
            "filename": "dev-infra/browsers/BUILD.bazel",
            "status": "modified",
            "additions": 4,
            "deletions": 72,
            "changes": 76,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbrowsers%2FBUILD.bazel?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "patch": "@@ -1,78 +1,10 @@\n-# Copyright Google LLC\n-#\n-# Licensed under the Apache License, Version 2.0 (the \"License\");\n-# you may not use this file except in compliance with the License.\n-# You may obtain a copy of the License at\n-#\n-#      http://www.apache.org/licenses/LICENSE-2.0\n-#\n-# Unless required by applicable law or agreed to in writing, software\n-# distributed under the License is distributed on an \"AS IS\" BASIS,\n-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-# See the License for the specific language governing permissions and\n-# limitations under the License.\n-#\n-################################################################################\n-#\n package(default_visibility = [\"//visibility:public\"])\n \n-load(\"@io_bazel_rules_webtesting//web:web.bzl\", \"browser\", \"web_test_archive\")\n-\n-# Override of chromium web_test_archive so that the archive is selected based on platform\n-web_test_archive(\n-    name = \"chromium_archive\",\n-    testonly = True,\n-    archive = select({\n-        \"@io_bazel_rules_webtesting//common/conditions:linux\": \"@org_chromium_chromium_amd64//file\",\n-        \"@io_bazel_rules_webtesting//common/conditions:mac\": \"@org_chromium_chromium_macos//file\",\n-        \"@io_bazel_rules_webtesting//common/conditions:windows\": \"@org_chromium_chromium_windows//file\",\n-    }),\n-    extract = \"build\",\n-    named_files = select({\n-        \"@io_bazel_rules_webtesting//common/conditions:linux\": {\"CHROMIUM\": \"chrome-linux/chrome\"},\n-        \"@io_bazel_rules_webtesting//common/conditions:mac\": {\"CHROMIUM\": \"chrome-mac/Chromium.app/Contents/MacOS/chromium\"},\n-        \"@io_bazel_rules_webtesting//common/conditions:windows\": {\"CHROMIUM\": \"chrome-win/chrome.exe\"},\n-    }),\n-    visibility = [\"//dev-infra/browsers:__subpackages__\"],\n-)\n-\n-# Override of chromedriver web_test_archive so that the archive is selected based on platform\n-web_test_archive(\n-    name = \"chromedriver_archive\",\n-    testonly = True,\n-    archive = select({\n-        \"@io_bazel_rules_webtesting//common/conditions:linux\": \"@org_chromium_chromedriver_amd64//file\",\n-        \"@io_bazel_rules_webtesting//common/conditions:mac\": \"@org_chromium_chromedriver_macos//file\",\n-        \"@io_bazel_rules_webtesting//common/conditions:windows\": \"@org_chromium_chromedriver_windows//file\",\n-    }),\n-    extract = \"build\",\n-    named_files = select({\n-        \"@io_bazel_rules_webtesting//common/conditions:linux\": {\n-            \"CHROMEDRIVER\": \"chromedriver_linux64/chromedriver\",\n-        },\n-        \"@io_bazel_rules_webtesting//common/conditions:mac\": {\n-            \"CHROMEDRIVER\": \"chromedriver_mac64/chromedriver\",\n-        },\n-        \"@io_bazel_rules_webtesting//common/conditions:windows\": {\n-            \"CHROMEDRIVER\": \"chromedriver_win32/chromedriver.exe\",\n-        },\n-    }),\n-    visibility = [\"//dev-infra/browsers:__subpackages__\"],\n-)\n-\n-browser(\n-    name = \"chromium\",\n-    metadata = \"chromium.json\",\n-    visibility = [\"//visibility:public\"],\n-    deps = [\n-        \":chromedriver_archive\",\n-        \":chromium_archive\",\n-        \"@io_bazel_rules_webtesting//go/wsl\",\n-    ],\n-)\n-\n # Make source files available for distribution via pkg_npm\n filegroup(\n     name = \"files\",\n-    srcs = glob([\"*\"]),\n+    srcs = glob([\"*\"]) + [\n+        \"//dev-infra/browsers/chromium:files\",\n+        \"//dev-infra/browsers/firefox:files\",\n+    ],\n )"
        },
        {
            "sha": "e48e2dcaaa54d25ce16dc1e965e38ab6a0f19422",
            "filename": "dev-infra/browsers/README.md",
            "status": "modified",
            "additions": 62,
            "deletions": 25,
            "changes": 87,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbrowsers%2FREADME.md?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "patch": "@@ -1,50 +1,87 @@\n # Browser configuration and versioning for testing of Angular\n \n-Within the Angular monorepo, we use Chrome to perform most of the local testing, and rely on Sauce Labs and BrowserStack to do cross-browser testing on our CI.\n+Within the Angular organization, we use Chrome and Firefox to perform most of the local testing,\n+and rely on Sauce Labs and BrowserStack to do cross-browser testing on our CI.\n \n-The version of Chrome used in tests within this monorepo is configured and controlled via `rules_webtesting` and `puppeteer`. We manually keep the configuration of these two tools in sync to create a consistent testing environment across unit, e2e, and integration tests.\n+The version of Chrome used in tests within this monorepo is configured and controlled via\n+Bazel and `puppeteer`. We manually keep the configuration of these two tools in sync to\n+create a consistent testing environment across unit, e2e, and integration tests.\n \n-## rules_webtesting\n+## Bazel\n \n-Bazel `karma_web_test_suite` and `protractor_web_test_suite` targets will use Chromium provisioned by rules_webtesting. The version of chrome used is specified in the `dev-infra/browsers/browser_repositories.bzl` file. The process of updating the Chrome version in that file consists of several steps:\n+Bazel `karma_web_test_suite` and `protractor_web_test_suite` targets will use Chromium\n+or Firefox provisioned by `//dev-infra/browsers`. The version of Chrome and Firefox are\n+specified in the `chromium.bzl` and `firefox.bzl` files in `/dev-infra/browsers`.\n \n-1) Visit https://chromium.woolyss.com/ and note the version (commit position) of the latest stable version.\n+The process of updating the Chrome or Firefox version is not straightforward, but below\n+are dedicated sections for each browser.\n \n-    For example, \"Google Chrome 83.0.4103.97 (756066) • Wednesday, 3 Jun 2020\". Alternately, you can look in https://omahaproxy.appspot.com/.\n+## Updating Chromium\n \n-1) Find the closest commit position number available for each platform in chromium-browser-snapshots:\n- https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html\n+1) Visit https://chromium.woolyss.com/ and note the version (commit position) of the latest\n+stable version.\n+\n+For example, \"Google Chrome 83.0.4103.97 (756066) • Wednesday, 3 Jun 2020\". Alternatively, you\n+can look in https://omahaproxy.appspot.com/.\n \n-   For example,\n+1) Find the closest commit position number available for each platform in chromium-browser-snapshots:\n+   https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html\n \n+   For example:\n    * https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Linux_x64/756066/\n    * https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/756053/\n    * https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/756065/\n \n-   You can download the Chromium for your local platform and double check that the --version matches up with\n-   what you expect.\n-\n-   For example,\n+   You can download Chromium for your local platform and double check that the `--version` matches\n+   up with what you expect.\n \n-``` bash\n-$ ~/Downloads/chrome-mac/Chromium.app/Contents/MacOS/Chromium --version\n-Chromium 83.0.4103.0\n-```\n-\n-1) Update the chrome & chrome driver build numbers in `dev-infra/browsers/browser_repositories.bzl` and run either run `bazel query @org_chromium_chromium_amd64//...` to prompt Bazel to calculate the new sha256 for each platform binary or determine the new sha256 values manually.\n+   For example:\n+    ``` bash\n+    $ ~/Downloads/chrome-mac/Chromium.app/Contents/MacOS/Chromium --version\n+    Chromium 83.0.4103.0\n+    ```\n \n-    For example, with curl & shasum\n+2) Update the chrome & chrome driver build numbers in `dev-infra/browsers/chromium/chromium.bzl`\n+and run either run `bazel query @org_chromium_chromium_amd64//...` to prompt Bazel to calculate\n+the new `sha256` for each platform binary or determine the new `sha256` values manually.\n \n-``` bash\n-curl https://commondatastorage.googleapis.com/chromium-browser-snapshots/Linux_x64/756066/chrome-linux.zip | shasum -a 256\n-```\n+    Here is an example with `curl` & `shasum`:\n+    ``` bash\n+    curl https://commondatastorage.googleapis.com/chromium-browser-snapshots/Linux_x64/756066/chrome-linux.zip | shasum -a 256\n+    ```\n \n-## puppeteer\n+## Puppeteer\n \n-Visit https://github.com/puppeteer/puppeteer/blob/master/docs/api.md to determine which version of puppeteer corresponds to the version of Chrome desired. Then update `scripts/puppeteer-chrome-versions.js` and all of the puppeteer versions throughout the repo,\n+Visit https://github.com/puppeteer/puppeteer/blob/master/docs/api.md to determine which version\n+of puppeteer corresponds to the version of Chrome desired. Then update\n+`scripts/puppeteer-chrome-versions.js` and all of the puppeteer versions throughout the repo,\n \n * `package.json`\n * `aio/package.json`\n * `aio/tools/examples/shared/package.json`\n \n and their corresponding `yarn.lock` files.\n+\n+## Firefox\n+\n+In order to update Firefox, open the `dev-infra/browsers/firefox/firefox.bzl` file and update\n+the repository URLs to the desired version. e.g.\n+\n+```bzl\n+platform_http_file(\n+    name = \"org_mozilla_firefox_amd64\",\n+    licenses = [\"reciprocal\"],  # MPL 2.0\n+    sha256 = \"bde6e020556a21561e4b8d7aaecf8db7077951f179b98ca5d0305435bc6802c9\",\n+    # Firefox v78.0\n+    urls = [\"https://ftp.mozilla.org/pub/firefox/releases/78.0/linux-x86_64/en-US/firefox-78.0.tar.bz2\"],\n+)\n+```\n+\n+Go to the `urls` property and update the URL by replacing all `78.0` occurrences with the\n+version you intend to use. Once done, do the same change for other platforms (such as `macos`).\n+\n+Finally, update the `sha256`checksum of the browser archives. You can do this by downloading the\n+artifacts from the URLs you just updated, and then running on those files: `sha256 <path>`. \n+\n+\n+"
        },
        {
            "sha": "97df460e7564e5031d30e05d6ac30a286ac68522",
            "filename": "dev-infra/browsers/browser_repositories.bzl",
            "status": "modified",
            "additions": 4,
            "deletions": 71,
            "changes": 75,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Fbrowser_repositories.bzl",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Fbrowser_repositories.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbrowsers%2Fbrowser_repositories.bzl?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "patch": "@@ -19,78 +19,11 @@ Unlike the rules_webtesting browser_repositories, this function defines\n separate repositories for each platform\n \"\"\"\n \n-load(\"@io_bazel_rules_webtesting//web/internal:platform_http_file.bzl\", _platform_http_file = \"platform_http_file\")\n-\n-def platform_http_file(name, licenses, sha256, urls):\n-    \"\"\"Platform spepcific browser repository.\n-\n-    This works around a dificiency in io_bazel_rules_webtesting platform_http_file in that\n-    it selects the platform when the repository rule is executed. This limits browsers\n-    tests to run on the local user platform only. For cross-platform RBE we want a repository\n-    to be defined per platform so the correct one can be selected.\n-    \"\"\"\n-\n-    _platform_http_file(\n-        name = name,\n-        amd64_sha256 = sha256,\n-        amd64_urls = urls,\n-        licenses = licenses,\n-        macos_sha256 = sha256,\n-        macos_urls = urls,\n-        windows_sha256 = sha256,\n-        windows_urls = urls,\n-    )\n+load(\"//dev-infra/browsers/chromium:chromium.bzl\", \"define_chromium_repositories\")\n+load(\"//dev-infra/browsers/firefox:firefox.bzl\", \"define_firefox_repositories\")\n \n def browser_repositories():\n     \"\"\"Load pinned rules_webtesting browser versions.\"\"\"\n \n-    # To update to a newer version of Chromium see instructions in\n-    # https://github.com/angular/angular/blob/master/dev-infra/browsers/README.md.\n-\n-    platform_http_file(\n-        name = \"org_chromium_chromium_amd64\",\n-        licenses = [\"notice\"],  # BSD 3-clause (maybe more?)\n-        sha256 = \"2cfd74ee58c79d8b7aada05c899a930967e2fd8bb0186582cde02c7340863f64\",\n-        # 83.0.4103\n-        urls = [\"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Linux_x64/756066/chrome-linux.zip\"],\n-    )\n-\n-    platform_http_file(\n-        name = \"org_chromium_chromium_macos\",\n-        licenses = [\"notice\"],  # BSD 3-clause (maybe more?)\n-        sha256 = \"b841ec5ad03b08422d97593fc719f1c5b038703388ad65e6cd8cc8272d58958c\",\n-        # 83.0.4103\n-        urls = [\"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Mac/756053/chrome-mac.zip\"],\n-    )\n-\n-    platform_http_file(\n-        name = \"org_chromium_chromium_windows\",\n-        licenses = [\"notice\"],  # BSD 3-clause (maybe more?)\n-        sha256 = \"4683d7ac88dfec4b98d1da3012ecc8e42cc8c1a560a7b95589ad4cc96bf90fcb\",\n-        # 83.0.4103\n-        urls = [\"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Win/756065/chrome-win.zip\"],\n-    )\n-\n-    platform_http_file(\n-        name = \"org_chromium_chromedriver_amd64\",\n-        licenses = [\"reciprocal\"],  # BSD 3-clause, ICU, MPL 1.1, libpng (BSD/MIT-like), Academic Free License v. 2.0, BSD 2-clause, MIT\n-        sha256 = \"95dded16000b82e31445361da7d251ed707e027a4b61e9a3ec5fbd1cc2f62bb1\",\n-        # 83.0.4103\n-        urls = [\"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Linux_x64/756066/chromedriver_linux64.zip\"],\n-    )\n-\n-    platform_http_file(\n-        name = \"org_chromium_chromedriver_macos\",\n-        licenses = [\"reciprocal\"],  # BSD 3-clause, ICU, MPL 1.1, libpng (BSD/MIT-like), Academic Free License v. 2.0, BSD 2-clause, MIT\n-        sha256 = \"17260e9b2222b0c905a1861285210192baef830f4281778903e7cebb8db683cc\",\n-        # 83.0.4103\n-        urls = [\"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Mac/756053/chromedriver_mac64.zip\"],\n-    )\n-\n-    platform_http_file(\n-        name = \"org_chromium_chromedriver_windows\",\n-        licenses = [\"reciprocal\"],  # BSD 3-clause, ICU, MPL 1.1, libpng (BSD/MIT-like), Academic Free License v. 2.0, BSD 2-clause, MIT\n-        sha256 = \"de1423b2d69f96e451e902d686e8d471610d786c345a8de59dd1a5a436e45fc2\",\n-        # 83.0.4103\n-        urls = [\"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Win/756065/chromedriver_win32.zip\"],\n-    )\n+    define_chromium_repositories()\n+    define_firefox_repositories()"
        },
        {
            "sha": "7ad08fb96ba43c5d2cdd7dbae09a593b988d072b",
            "filename": "dev-infra/browsers/chromium/BUILD.bazel",
            "status": "added",
            "additions": 78,
            "deletions": 0,
            "changes": 78,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Fchromium%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Fchromium%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbrowsers%2Fchromium%2FBUILD.bazel?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "patch": "@@ -0,0 +1,78 @@\n+# Copyright Google LLC\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+################################################################################\n+#\n+package(default_visibility = [\"//visibility:public\"])\n+\n+load(\"@io_bazel_rules_webtesting//web:web.bzl\", \"browser\", \"web_test_archive\")\n+\n+# Override of chromium web_test_archive so that the archive is selected based on platform\n+web_test_archive(\n+    name = \"chromium_archive\",\n+    testonly = True,\n+    archive = select({\n+        \"@io_bazel_rules_webtesting//common/conditions:linux\": \"@org_chromium_chromium_amd64//file\",\n+        \"@io_bazel_rules_webtesting//common/conditions:mac\": \"@org_chromium_chromium_macos//file\",\n+        \"@io_bazel_rules_webtesting//common/conditions:windows\": \"@org_chromium_chromium_windows//file\",\n+    }),\n+    extract = \"build\",\n+    named_files = select({\n+        \"@io_bazel_rules_webtesting//common/conditions:linux\": {\"CHROMIUM\": \"chrome-linux/chrome\"},\n+        \"@io_bazel_rules_webtesting//common/conditions:mac\": {\"CHROMIUM\": \"chrome-mac/Chromium.app/Contents/MacOS/chromium\"},\n+        \"@io_bazel_rules_webtesting//common/conditions:windows\": {\"CHROMIUM\": \"chrome-win/chrome.exe\"},\n+    }),\n+    visibility = [\"//dev-infra/browsers:__subpackages__\"],\n+)\n+\n+# Override of chromedriver web_test_archive so that the archive is selected based on platform\n+web_test_archive(\n+    name = \"chromedriver_archive\",\n+    testonly = True,\n+    archive = select({\n+        \"@io_bazel_rules_webtesting//common/conditions:linux\": \"@org_chromium_chromedriver_amd64//file\",\n+        \"@io_bazel_rules_webtesting//common/conditions:mac\": \"@org_chromium_chromedriver_macos//file\",\n+        \"@io_bazel_rules_webtesting//common/conditions:windows\": \"@org_chromium_chromedriver_windows//file\",\n+    }),\n+    extract = \"build\",\n+    named_files = select({\n+        \"@io_bazel_rules_webtesting//common/conditions:linux\": {\n+            \"CHROMEDRIVER\": \"chromedriver_linux64/chromedriver\",\n+        },\n+        \"@io_bazel_rules_webtesting//common/conditions:mac\": {\n+            \"CHROMEDRIVER\": \"chromedriver_mac64/chromedriver\",\n+        },\n+        \"@io_bazel_rules_webtesting//common/conditions:windows\": {\n+            \"CHROMEDRIVER\": \"chromedriver_win32/chromedriver.exe\",\n+        },\n+    }),\n+    visibility = [\"//dev-infra/browsers:__subpackages__\"],\n+)\n+\n+browser(\n+    name = \"chromium\",\n+    metadata = \"chromium.json\",\n+    visibility = [\"//visibility:public\"],\n+    deps = [\n+        \":chromedriver_archive\",\n+        \":chromium_archive\",\n+        \"@io_bazel_rules_webtesting//go/wsl\",\n+    ],\n+)\n+\n+# Make source files available for distribution via pkg_npm\n+filegroup(\n+    name = \"files\",\n+    srcs = glob([\"*\"]),\n+)"
        },
        {
            "sha": "1048b85d88da2669309f1006da2bc2675a0de226",
            "filename": "dev-infra/browsers/chromium/chromium.bzl",
            "status": "added",
            "additions": 58,
            "deletions": 0,
            "changes": 58,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Fchromium%2Fchromium.bzl",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Fchromium%2Fchromium.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbrowsers%2Fchromium%2Fchromium.bzl?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "patch": "@@ -0,0 +1,58 @@\n+load(\"//dev-infra/browsers:platform_http_file.bzl\", \"platform_http_file\")\n+\n+\"\"\"\n+  Defines repositories for Chromium that can be used inside Karma unit tests\n+  and Protractor e2e tests with Bazel.\n+\"\"\"\n+\n+def define_chromium_repositories():\n+    # To update to a newer version of Chromium see instructions in\n+    # https://github.com/angular/angular/blob/master/dev-infra/browsers/README.md.\n+\n+    platform_http_file(\n+        name = \"org_chromium_chromium_amd64\",\n+        licenses = [\"notice\"],  # BSD 3-clause (maybe more?)\n+        sha256 = \"2cfd74ee58c79d8b7aada05c899a930967e2fd8bb0186582cde02c7340863f64\",\n+        # 83.0.4103\n+        urls = [\"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Linux_x64/756066/chrome-linux.zip\"],\n+    )\n+\n+    platform_http_file(\n+        name = \"org_chromium_chromium_macos\",\n+        licenses = [\"notice\"],  # BSD 3-clause (maybe more?)\n+        sha256 = \"b841ec5ad03b08422d97593fc719f1c5b038703388ad65e6cd8cc8272d58958c\",\n+        # 83.0.4103\n+        urls = [\"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Mac/756053/chrome-mac.zip\"],\n+    )\n+\n+    platform_http_file(\n+        name = \"org_chromium_chromium_windows\",\n+        licenses = [\"notice\"],  # BSD 3-clause (maybe more?)\n+        sha256 = \"4683d7ac88dfec4b98d1da3012ecc8e42cc8c1a560a7b95589ad4cc96bf90fcb\",\n+        # 83.0.4103\n+        urls = [\"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Win/756065/chrome-win.zip\"],\n+    )\n+\n+    platform_http_file(\n+        name = \"org_chromium_chromedriver_amd64\",\n+        licenses = [\"reciprocal\"],  # BSD 3-clause, ICU, MPL 1.1, libpng (BSD/MIT-like), Academic Free License v. 2.0, BSD 2-clause, MIT\n+        sha256 = \"95dded16000b82e31445361da7d251ed707e027a4b61e9a3ec5fbd1cc2f62bb1\",\n+        # 83.0.4103\n+        urls = [\"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Linux_x64/756066/chromedriver_linux64.zip\"],\n+    )\n+\n+    platform_http_file(\n+        name = \"org_chromium_chromedriver_macos\",\n+        licenses = [\"reciprocal\"],  # BSD 3-clause, ICU, MPL 1.1, libpng (BSD/MIT-like), Academic Free License v. 2.0, BSD 2-clause, MIT\n+        sha256 = \"17260e9b2222b0c905a1861285210192baef830f4281778903e7cebb8db683cc\",\n+        # 83.0.4103\n+        urls = [\"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Mac/756053/chromedriver_mac64.zip\"],\n+    )\n+\n+    platform_http_file(\n+        name = \"org_chromium_chromedriver_windows\",\n+        licenses = [\"reciprocal\"],  # BSD 3-clause, ICU, MPL 1.1, libpng (BSD/MIT-like), Academic Free License v. 2.0, BSD 2-clause, MIT\n+        sha256 = \"de1423b2d69f96e451e902d686e8d471610d786c345a8de59dd1a5a436e45fc2\",\n+        # 83.0.4103\n+        urls = [\"https://commondatastorage.googleapis.com/chromium-browser-snapshots/Win/756065/chromedriver_win32.zip\"],\n+    )"
        },
        {
            "sha": "7fb23d3486695cf2d3e3be67a71184b023c0fc08",
            "filename": "dev-infra/browsers/chromium/chromium.json",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Fchromium%2Fchromium.json",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Fchromium%2Fchromium.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbrowsers%2Fchromium%2Fchromium.json?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "previous_filename": "dev-infra/browsers/chromium.json"
        },
        {
            "sha": "9349495e3c6b403b6dff7756d49f0dddab1b4aca",
            "filename": "dev-infra/browsers/firefox/BUILD.bazel",
            "status": "added",
            "additions": 74,
            "deletions": 0,
            "changes": 74,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Ffirefox%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Ffirefox%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbrowsers%2Ffirefox%2FBUILD.bazel?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "patch": "@@ -0,0 +1,74 @@\n+# Copyright Google LLC\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+################################################################################\n+#\n+package(default_visibility = [\"//visibility:public\"])\n+\n+load(\"@io_bazel_rules_webtesting//web:web.bzl\", \"browser\", \"web_test_archive\")\n+\n+# Override of firefox web_test_archive so that the archive is selected based on platform.\n+web_test_archive(\n+    name = \"firefox_archive\",\n+    testonly = True,\n+    archive = select({\n+        \"@io_bazel_rules_webtesting//common/conditions:linux\": \"@org_mozilla_firefox_amd64//file\",\n+        \"@io_bazel_rules_webtesting//common/conditions:mac\": \"@org_mozilla_firefox_macos//file\",\n+    }),\n+    extract = \"build\",\n+    named_files = select({\n+        \"@io_bazel_rules_webtesting//common/conditions:linux\": {\"FIREFOX\": \"firefox/firefox\"},\n+        \"@io_bazel_rules_webtesting//common/conditions:mac\": {\"FIREFOX\": \"Firefox.app/Contents/MacOS/firefox\"},\n+    }),\n+    visibility = [\"//dev-infra/browsers:__subpackages__\"],\n+)\n+\n+# Override of geckodriver web_test_archive so that the archive is selected based on platform.\n+web_test_archive(\n+    name = \"geckodriver_archive\",\n+    testonly = True,\n+    archive = select({\n+        \"@io_bazel_rules_webtesting//common/conditions:linux\": \"@org_mozilla_geckodriver_amd64//file\",\n+        \"@io_bazel_rules_webtesting//common/conditions:mac\": \"@org_mozilla_geckodriver_macos//file\",\n+    }),\n+    extract = \"build\",\n+    named_files = {\"GECKODRIVER\": \"geckodriver\"},\n+    visibility = [\"//dev-infra/browsers:__subpackages__\"],\n+)\n+\n+browser(\n+    name = \"firefox\",\n+    disabled = select({\n+        # TODO: Consider adding support for Windows. Requires a portable version of\n+        # Firefox. Official distribution only ships with installers.\n+        \"@io_bazel_rules_webtesting//common/conditions:windows\": \"Firefox is not supported on Windows\",\n+        \"//conditions:default\": None,\n+    }),\n+    metadata = \"firefox.json\",\n+    visibility = [\"//visibility:public\"],\n+    deps = select({\n+        \"@io_bazel_rules_webtesting//common/conditions:windows\": [],\n+        \"//conditions:default\": [\n+            \"@io_bazel_rules_webtesting//go/wsl\",\n+            \":firefox_archive\",\n+            \":geckodriver_archive\",\n+        ],\n+    }),\n+)\n+\n+# Make source files available for distribution via pkg_npm\n+filegroup(\n+    name = \"files\",\n+    srcs = glob([\"*\"]),\n+)"
        },
        {
            "sha": "cb0153f2feb33fe826f00457b5e509213b076729",
            "filename": "dev-infra/browsers/firefox/firefox.bzl",
            "status": "added",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Ffirefox%2Ffirefox.bzl",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Ffirefox%2Ffirefox.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbrowsers%2Ffirefox%2Ffirefox.bzl?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "patch": "@@ -0,0 +1,42 @@\n+load(\"//dev-infra/browsers:platform_http_file.bzl\", \"platform_http_file\")\n+\n+\"\"\"\n+  Defines repositories for Firefox that can be used inside Karma unit tests\n+  and Protractor e2e tests with Bazel.\n+\"\"\"\n+\n+def define_firefox_repositories():\n+    # Instructions on updating the Firefox version can be found in the `README.md` file\n+    # next to this file.\n+\n+    platform_http_file(\n+        name = \"org_mozilla_firefox_amd64\",\n+        licenses = [\"reciprocal\"],  # MPL 2.0\n+        sha256 = \"bde6e020556a21561e4b8d7aaecf8db7077951f179b98ca5d0305435bc6802c9\",\n+        # Firefox v78.0\n+        urls = [\"https://ftp.mozilla.org/pub/firefox/releases/78.0/linux-x86_64/en-US/firefox-78.0.tar.bz2\"],\n+    )\n+\n+    platform_http_file(\n+        name = \"org_mozilla_firefox_macos\",\n+        licenses = [\"reciprocal\"],  # MPL 2.0\n+        sha256 = \"69a0ae139814cc314d0c5e3fd3859e0ac9de8517550d7d32b06c57022a14f49e\",\n+        # Firefox v78.0\n+        urls = [\"https://ftp.mozilla.org/pub/firefox/releases/78.0/mac/en-US/Firefox%2078.0.dmg\"],\n+    )\n+\n+    platform_http_file(\n+        name = \"org_mozilla_geckodriver_amd64\",\n+        licenses = [\"reciprocal\"],  # MPL 2.0\n+        sha256 = \"d59ca434d8e41ec1e30dd7707b0c95171dd6d16056fb6db9c978449ad8b93cc0\",\n+        # Geckodriver v0.26.0\n+        urls = [\"https://github.com/mozilla/geckodriver/releases/download/v0.26.0/geckodriver-v0.26.0-linux64.tar.gz\"],\n+    )\n+\n+    platform_http_file(\n+        name = \"org_mozilla_geckodriver_macos\",\n+        licenses = [\"reciprocal\"],  # MPL 2.0\n+        sha256 = \"4739ef8f8af5d89bd4a8015788b4dc45c2f5f16b2fdc001254c9a92fe7261947\",\n+        # Geckodriver v0.26.0\n+        urls = [\"https://github.com/mozilla/geckodriver/releases/download/v0.26.0/geckodriver-v0.26.0-macos.tar.gz\"],\n+    )"
        },
        {
            "sha": "0cbc7af4a3aca67c04328c12dfcfdc6dc4dffe7a",
            "filename": "dev-infra/browsers/firefox/firefox.json",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Ffirefox%2Ffirefox.json",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Ffirefox%2Ffirefox.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbrowsers%2Ffirefox%2Ffirefox.json?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "patch": "@@ -0,0 +1,21 @@\n+{\n+  \"environment\": \"local\",\n+  \"capabilities\": {\n+    \"browserName\": \"firefox\",\n+    \"moz:firefoxOptions\": {\n+      \"binary\": \"%FILE:FIREFOX%\",\n+      \"args\": [\"--headless\"]\n+    },\n+    \"google:wslConfig\": {\n+      \"binary\": \"%FILE:GECKODRIVER%\",\n+      \"port\":\"%WSLPORT:WSL%\",\n+      \"args\": [\n+        \"--port=%WSLPORT:WSL%\",\n+        \"--host=%WSL:HOST_IP%\",\n+        \"--marionette-port=%WSLPORT:MARIONETTE%\"\n+      ],\n+      \"status\": true,\n+      \"shutdown\": false\n+    }\n+  }\n+}"
        },
        {
            "sha": "c5db8d4ac4dc4e93541013142ef3679f7a8ba8e5",
            "filename": "dev-infra/browsers/platform_http_file.bzl",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Fplatform_http_file.bzl",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/dev-infra%2Fbrowsers%2Fplatform_http_file.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbrowsers%2Fplatform_http_file.bzl?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "patch": "@@ -0,0 +1,24 @@\n+load(\n+    \"@io_bazel_rules_webtesting//web/internal:platform_http_file.bzl\",\n+    _platform_http_file = \"platform_http_file\",\n+)\n+\n+def platform_http_file(name, licenses, sha256, urls):\n+    \"\"\"Platform specific browser repository.\n+\n+    This works around a deficiency in io_bazel_rules_webtesting platform_http_file in that\n+    it selects the platform when the repository rule is executed. This limits browsers\n+    tests to run on the local user platform only. For cross-platform RBE we want a repository\n+    to be defined per platform so the correct one can be selected.\n+    \"\"\"\n+\n+    _platform_http_file(\n+        name = name,\n+        amd64_sha256 = sha256,\n+        amd64_urls = urls,\n+        licenses = licenses,\n+        macos_sha256 = sha256,\n+        macos_urls = urls,\n+        windows_sha256 = sha256,\n+        windows_urls = urls,\n+    )"
        },
        {
            "sha": "64e331d73893ea688e9427d7225d8fea0f308547",
            "filename": "packages/zone.js/test/karma_test.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/packages%2Fzone.js%2Ftest%2Fkarma_test.bzl",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/packages%2Fzone.js%2Ftest%2Fkarma_test.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Ftest%2Fkarma_test.bzl?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "patch": "@@ -70,7 +70,7 @@ def karma_test(name, env_srcs, env_deps, env_entry_point, test_srcs, test_deps,\n                             \":\" + name + \"_env_rollup.umd\",\n                         ] + bootstrap +\n                         _karma_test_required_dist_files,\n-            browsers = [\"//dev-infra/browsers:chromium\"],\n+            browsers = [\"//dev-infra/browsers/chromium:chromium\"],\n             static_files = [\n                 \":assets/sample.json\",\n                 \":assets/worker.js\",\n@@ -93,7 +93,7 @@ def karma_test(name, env_srcs, env_deps, env_entry_point, test_srcs, test_deps,\n                     \":\" + name + \"_env_rollup.umd\",\n                     \"//packages/zone.js/bundles:zone-testing-bundle.umd.min.js\",\n                 ] + _karma_test_required_dist_files,\n-                browsers = [\"//dev-infra/browsers:chromium\"],\n+                browsers = [\"//dev-infra/browsers/chromium:chromium\"],\n                 config_file = \"//:karma-js.conf.js\",\n                 configuration_env_vars = [\"KARMA_WEB_TEST_MODE\"],\n                 data = ["
        },
        {
            "sha": "0fbfb1296c191ea9b9d85ae817a49c90e0b6554e",
            "filename": "tools/defaults.bzl",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/545f1dbac9112393f545a3ba392e545bc923c21b/tools%2Fdefaults.bzl",
            "raw_url": "https://github.com/angular/angular/raw/545f1dbac9112393f545a3ba392e545bc923c21b/tools%2Fdefaults.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fdefaults.bzl?ref=545f1dbac9112393f545a3ba392e545bc923c21b",
            "patch": "@@ -245,7 +245,7 @@ def karma_web_test_suite(name, **kwargs):\n         runtime_deps = runtime_deps,\n         bootstrap = bootstrap,\n         deps = deps,\n-        browsers = [\"//dev-infra/browsers:chromium\"],\n+        browsers = [\"//dev-infra/browsers/firefox:firefox\"],\n         data = data,\n         tags = tags,\n         **kwargs\n@@ -282,7 +282,7 @@ def protractor_web_test_suite(**kwargs):\n     \"\"\"Default values for protractor_web_test_suite\"\"\"\n \n     _protractor_web_test_suite(\n-        browsers = [\"//dev-infra/browsers:chromium\"],\n+        browsers = [\"//dev-infra/browsers/chromium:chromium\"],\n         **kwargs\n     )\n "
        }
    ],
    "stats": {
        "total": 545,
        "additions": 372,
        "deletions": 173
    }
}