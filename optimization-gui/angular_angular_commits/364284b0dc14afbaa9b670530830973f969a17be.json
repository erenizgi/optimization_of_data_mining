{
    "author": "gkalpak",
    "message": "fix(dev-infra): ignore comments when validating commit messages (#38438)\n\nWhen creating a commit with the git cli, git pre-populates the editor\nused to enter the commit message with some comments (i.e. lines starting\nwith `#`). These comments contain helpful instructions or information\nregarding the changes that are part of the commit. As happens with all\ncommit message comments, they are removed by git and do not end up in\nthe final commit message.\n\nHowever, the file that is passed to the `commit-msg` to be validated\nstill contains these comments. This may affect the outcome of the commit\nmessage validation. In such cases, the author will not realize that the\ncommit message is not in the desired format until the linting checks\nfail on CI (which validates the final commit messages and is not\naffected by this issue), usually several minutes later.\n\nPossible ways in which the commit message validation outcome can be\naffected:\n- The minimum body length check may pass incorrectly, even if there is\n  no actual body, because the comments are counted as part of the body.\n- The maximum line length check may fail incorrectly due to a very long\n  line in the comments.\n\nThis commit fixes the problem by removing comment lines before\nvalidating a commit message.\n\nFixes #37865\n\nPR Close #38438",
    "sha": "364284b0dc14afbaa9b670530830973f969a17be",
    "files": [
        {
            "sha": "22a79934a923eca48285ded8d3e59e58749fc21e",
            "filename": "dev-infra/commit-message/parse.spec.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/364284b0dc14afbaa9b670530830973f969a17be/dev-infra%2Fcommit-message%2Fparse.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/364284b0dc14afbaa9b670530830973f969a17be/dev-infra%2Fcommit-message%2Fparse.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fparse.spec.ts?ref=364284b0dc14afbaa9b670530830973f969a17be",
            "patch": "@@ -82,4 +82,24 @@ describe('commit message parsing:', () => {\n     const message2 = buildCommitMessage({prefix: 'squash! '});\n     expect(parseCommitMessage(message2).isSquash).toBe(true);\n   });\n+\n+  it('ignores comment lines', () => {\n+    const message = buildCommitMessage({\n+      prefix: '# This is a comment line before the header.\\n' +\n+          '## This is another comment line before the headers.\\n',\n+      body: '# This is a comment line befor the body.\\n' +\n+          'This is line 1 of the actual body.\\n' +\n+          '## This is another comment line inside the body.\\n' +\n+          'This is line 2 of the actual body (and it also contains a # but it not a comment).\\n' +\n+          '### This is yet another comment line after the body.\\n',\n+    });\n+    const parsedMessage = parseCommitMessage(message);\n+\n+    expect(parsedMessage.header)\n+        .toBe(`${commitValues.type}(${commitValues.scope}): ${commitValues.summary}`);\n+    expect(parsedMessage.body)\n+        .toBe(\n+            'This is line 1 of the actual body.\\n' +\n+            'This is line 2 of the actual body (and it also contains a # but it not a comment).\\n');\n+  });\n });"
        },
        {
            "sha": "3ccd870620de76daf25c6a6358b8f2717a4eedb7",
            "filename": "dev-infra/commit-message/parse.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/364284b0dc14afbaa9b670530830973f969a17be/dev-infra%2Fcommit-message%2Fparse.ts",
            "raw_url": "https://github.com/angular/angular/raw/364284b0dc14afbaa9b670530830973f969a17be/dev-infra%2Fcommit-message%2Fparse.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fparse.ts?ref=364284b0dc14afbaa9b670530830973f969a17be",
            "patch": "@@ -36,6 +36,10 @@ const COMMIT_BODY_RE = /^.*\\n\\n([\\s\\S]*)$/;\n \n /** Parse a full commit message into its composite parts. */\n export function parseCommitMessage(commitMsg: string): ParsedCommitMessage {\n+  // Ignore comments (i.e. lines starting with `#`). Comments are automatically removed by git and\n+  // should not be considered part of the final commit message.\n+  commitMsg = commitMsg.split('\\n').filter(line => !line.startsWith('#')).join('\\n');\n+\n   let header = '';\n   let body = '';\n   let bodyWithoutLinking = '';"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 24,
        "deletions": 0
    }
}