{
    "author": "alxhub",
    "message": "refactor(compiler-cli): API for getting components from a template file (#39002)\n\nThis commit adds an API to `NgCompiler`, a method called\n`getComponentsWithTemplateFile`. Given a filesystem path to an external\ntemplate file, it retrieves a `Set` (actually a `ReadonlySet`) of component\ndeclarations which are using this template. In most cases, this will only be\na single component.\n\nThis information is easily determined by the compiler during analysis, but\nis hard for a lot of Angular tooling (e.g. the language service) to infer\nindependently. Therefore, it makes sense to expose this as a compiler API.\n\nPR Close #39002",
    "sha": "8f11b516f88e578ac854d40fdb8abf8e10510ef4",
    "files": [
        {
            "sha": "e557fa4fe5b730c6cc05ef1ea604186794898386",
            "filename": "packages/compiler-cli/ngcc/src/analysis/decoration_analyzer.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fdecoration_analyzer.ts",
            "raw_url": "https://github.com/angular/angular/raw/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fdecoration_analyzer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fdecoration_analyzer.ts?ref=8f11b516f88e578ac854d40fdb8abf8e10510ef4",
            "patch": "@@ -14,7 +14,7 @@ import {CycleAnalyzer, ImportGraph} from '../../../src/ngtsc/cycles';\n import {isFatalDiagnosticError} from '../../../src/ngtsc/diagnostics';\n import {absoluteFrom, absoluteFromSourceFile, dirname, FileSystem, LogicalFileSystem, resolve} from '../../../src/ngtsc/file_system';\n import {AbsoluteModuleStrategy, LocalIdentifierStrategy, LogicalProjectStrategy, ModuleResolver, NOOP_DEFAULT_IMPORT_RECORDER, PrivateExportAliasingHost, Reexport, ReferenceEmitter} from '../../../src/ngtsc/imports';\n-import {CompoundMetadataReader, CompoundMetadataRegistry, DtsMetadataReader, InjectableClassRegistry, LocalMetadataRegistry} from '../../../src/ngtsc/metadata';\n+import {CompoundMetadataReader, CompoundMetadataRegistry, DtsMetadataReader, InjectableClassRegistry, LocalMetadataRegistry, TemplateMapping} from '../../../src/ngtsc/metadata';\n import {PartialEvaluator} from '../../../src/ngtsc/partial_evaluator';\n import {LocalModuleScopeRegistry, MetadataDtsModuleScopeResolver} from '../../../src/ngtsc/scope';\n import {DecoratorHandler} from '../../../src/ngtsc/transform';\n@@ -94,8 +94,8 @@ export class DecorationAnalyzer {\n   handlers: DecoratorHandler<unknown, unknown, unknown>[] = [\n     new ComponentDecoratorHandler(\n         this.reflectionHost, this.evaluator, this.fullRegistry, this.fullMetaReader,\n-        this.scopeRegistry, this.scopeRegistry, this.isCore, this.resourceManager, this.rootDirs,\n-        !!this.compilerOptions.preserveWhitespaces,\n+        this.scopeRegistry, this.scopeRegistry, new TemplateMapping(), this.isCore,\n+        this.resourceManager, this.rootDirs, !!this.compilerOptions.preserveWhitespaces,\n         /* i18nUseExternalIds */ true, this.bundle.enableI18nLegacyMessageIdFormat,\n         /* i18nNormalizeLineEndingsInICUs */ false, this.moduleResolver, this.cycleAnalyzer,\n         this.refEmitter, NOOP_DEFAULT_IMPORT_RECORDER, NOOP_DEPENDENCY_TRACKER,"
        },
        {
            "sha": "1ae175cbcec41624c97a475ff59617e506a5af55",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/component.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 5,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts?ref=8f11b516f88e578ac854d40fdb8abf8e10510ef4",
            "patch": "@@ -11,11 +11,11 @@ import * as ts from 'typescript';\n \n import {CycleAnalyzer} from '../../cycles';\n import {ErrorCode, FatalDiagnosticError, ngErrorCode} from '../../diagnostics';\n-import {absoluteFrom, relative} from '../../file_system';\n+import {absoluteFrom, relative, resolve} from '../../file_system';\n import {DefaultImportRecorder, ModuleResolver, Reference, ReferenceEmitter} from '../../imports';\n import {DependencyTracker} from '../../incremental/api';\n import {IndexingContext} from '../../indexer';\n-import {ClassPropertyMapping, DirectiveMeta, DirectiveTypeCheckMeta, extractDirectiveTypeCheckMeta, InjectableClassRegistry, MetadataReader, MetadataRegistry} from '../../metadata';\n+import {ClassPropertyMapping, DirectiveMeta, DirectiveTypeCheckMeta, extractDirectiveTypeCheckMeta, InjectableClassRegistry, MetadataReader, MetadataRegistry, TemplateMapping} from '../../metadata';\n import {EnumValue, PartialEvaluator} from '../../partial_evaluator';\n import {ClassDeclaration, Decorator, ReflectionHost, reflectObjectLiteral} from '../../reflection';\n import {ComponentScopeReader, LocalModuleScopeRegistry} from '../../scope';\n@@ -83,9 +83,10 @@ export class ComponentDecoratorHandler implements\n       private reflector: ReflectionHost, private evaluator: PartialEvaluator,\n       private metaRegistry: MetadataRegistry, private metaReader: MetadataReader,\n       private scopeReader: ComponentScopeReader, private scopeRegistry: LocalModuleScopeRegistry,\n-      private isCore: boolean, private resourceLoader: ResourceLoader,\n-      private rootDirs: ReadonlyArray<string>, private defaultPreserveWhitespaces: boolean,\n-      private i18nUseExternalIds: boolean, private enableI18nLegacyMessageIdFormat: boolean,\n+      private templateMapping: TemplateMapping, private isCore: boolean,\n+      private resourceLoader: ResourceLoader, private rootDirs: ReadonlyArray<string>,\n+      private defaultPreserveWhitespaces: boolean, private i18nUseExternalIds: boolean,\n+      private enableI18nLegacyMessageIdFormat: boolean,\n       private i18nNormalizeLineEndingsInICUs: boolean|undefined,\n       private moduleResolver: ModuleResolver, private cycleAnalyzer: CycleAnalyzer,\n       private refEmitter: ReferenceEmitter, private defaultImportRecorder: DefaultImportRecorder,\n@@ -384,6 +385,10 @@ export class ComponentDecoratorHandler implements\n       ...analysis.typeCheckMeta,\n     });\n \n+    if (!analysis.template.isInline) {\n+      this.templateMapping.register(resolve(analysis.template.templateUrl), node);\n+    }\n+\n     this.injectableRegistry.registerInjectable(node);\n   }\n "
        },
        {
            "sha": "14ceb191c7de21bc334c899ded373660f8c5bf20",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/test/component_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fcomponent_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fcomponent_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fcomponent_spec.ts?ref=8f11b516f88e578ac854d40fdb8abf8e10510ef4",
            "patch": "@@ -10,7 +10,7 @@ import {ErrorCode, FatalDiagnosticError} from '../../diagnostics';\n import {absoluteFrom} from '../../file_system';\n import {runInEachFileSystem} from '../../file_system/testing';\n import {ModuleResolver, NOOP_DEFAULT_IMPORT_RECORDER, ReferenceEmitter} from '../../imports';\n-import {CompoundMetadataReader, DtsMetadataReader, InjectableClassRegistry, LocalMetadataRegistry} from '../../metadata';\n+import {CompoundMetadataReader, DtsMetadataReader, InjectableClassRegistry, LocalMetadataRegistry, TemplateMapping} from '../../metadata';\n import {PartialEvaluator} from '../../partial_evaluator';\n import {isNamedClassDeclaration, TypeScriptReflectionHost} from '../../reflection';\n import {LocalModuleScopeRegistry, MetadataDtsModuleScopeResolver} from '../../scope';\n@@ -69,6 +69,7 @@ runInEachFileSystem(() => {\n \n       const handler = new ComponentDecoratorHandler(\n           reflectionHost, evaluator, metaRegistry, metaReader, scopeRegistry, scopeRegistry,\n+          new TemplateMapping(),\n           /* isCore */ false, new NoopResourceLoader(), /* rootDirs */[''],\n           /* defaultPreserveWhitespaces */ false, /* i18nUseExternalIds */ true,\n           /* enableI18nLegacyMessageIdFormat */ false,"
        },
        {
            "sha": "fc91e6a281b1001e3e5247f48ebf48309f51494e",
            "filename": "packages/compiler-cli/src/ngtsc/core/src/compiler.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 5,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts?ref=8f11b516f88e578ac854d40fdb8abf8e10510ef4",
            "patch": "@@ -13,11 +13,11 @@ import {ComponentDecoratorHandler, DirectiveDecoratorHandler, InjectableDecorato\n import {CycleAnalyzer, ImportGraph} from '../../cycles';\n import {ErrorCode, ngErrorCode} from '../../diagnostics';\n import {checkForPrivateExports, ReferenceGraph} from '../../entry_point';\n-import {LogicalFileSystem} from '../../file_system';\n+import {LogicalFileSystem, resolve} from '../../file_system';\n import {AbsoluteModuleStrategy, AliasingHost, AliasStrategy, DefaultImportTracker, ImportRewriter, LocalIdentifierStrategy, LogicalProjectStrategy, ModuleResolver, NoopImportRewriter, PrivateExportAliasingHost, R3SymbolsImportRewriter, Reference, ReferenceEmitStrategy, ReferenceEmitter, RelativePathStrategy, UnifiedModulesAliasingHost, UnifiedModulesStrategy} from '../../imports';\n import {IncrementalBuildStrategy, IncrementalDriver} from '../../incremental';\n import {generateAnalysis, IndexedComponent, IndexingContext} from '../../indexer';\n-import {CompoundMetadataReader, CompoundMetadataRegistry, DtsMetadataReader, InjectableClassRegistry, LocalMetadataRegistry, MetadataReader} from '../../metadata';\n+import {CompoundMetadataReader, CompoundMetadataRegistry, DtsMetadataReader, InjectableClassRegistry, LocalMetadataRegistry, MetadataReader, TemplateMapping} from '../../metadata';\n import {ModuleWithProvidersScanner} from '../../modulewithproviders';\n import {PartialEvaluator} from '../../partial_evaluator';\n import {NOOP_PERF_RECORDER, PerfRecorder} from '../../perf';\n@@ -52,6 +52,7 @@ interface LazyCompilationState {\n   aliasingHost: AliasingHost|null;\n   refEmitter: ReferenceEmitter;\n   templateTypeChecker: TemplateTypeChecker;\n+  templateMapping: TemplateMapping;\n }\n \n /**\n@@ -223,6 +224,14 @@ export class NgCompiler {\n     return this.ensureAnalyzed().templateTypeChecker;\n   }\n \n+  /**\n+   * Retrieves the `ts.Declaration`s for any component(s) which use the given template file.\n+   */\n+  getComponentsWithTemplateFile(templateFilePath: string): ReadonlySet<ts.Declaration> {\n+    const {templateMapping} = this.ensureAnalyzed();\n+    return templateMapping.getComponentsWithTemplate(resolve(templateFilePath));\n+  }\n+\n   /**\n    * Perform Angular's analysis step (as a precursor to `getDiagnostics` or `prepareEmit`)\n    * asynchronously.\n@@ -714,13 +723,14 @@ export class NgCompiler {\n     const isCore = isAngularCorePackage(this.tsProgram);\n \n     const defaultImportTracker = new DefaultImportTracker();\n+    const templateMapping = new TemplateMapping();\n \n     // Set up the IvyCompilation, which manages state for the Ivy transformer.\n     const handlers: DecoratorHandler<unknown, unknown, unknown>[] = [\n       new ComponentDecoratorHandler(\n-          reflector, evaluator, metaRegistry, metaReader, scopeReader, scopeRegistry, isCore,\n-          this.resourceManager, this.adapter.rootDirs, this.options.preserveWhitespaces || false,\n-          this.options.i18nUseExternalIds !== false,\n+          reflector, evaluator, metaRegistry, metaReader, scopeReader, scopeRegistry,\n+          templateMapping, isCore, this.resourceManager, this.adapter.rootDirs,\n+          this.options.preserveWhitespaces || false, this.options.i18nUseExternalIds !== false,\n           this.options.enableI18nLegacyMessageIdFormat !== false,\n           this.options.i18nNormalizeLineEndingsInICUs, this.moduleResolver, this.cycleAnalyzer,\n           refEmitter, defaultImportTracker, this.incrementalDriver.depGraph, injectableRegistry,\n@@ -773,6 +783,7 @@ export class NgCompiler {\n       aliasingHost,\n       refEmitter,\n       templateTypeChecker,\n+      templateMapping,\n     };\n   }\n }"
        },
        {
            "sha": "54dcaad509c814a7b02dca491018e6ac6404b5a7",
            "filename": "packages/compiler-cli/src/ngtsc/core/test/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Ftest%2FBUILD.bazel?ref=8f11b516f88e578ac854d40fdb8abf8e10510ef4",
            "patch": "@@ -15,6 +15,7 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n         \"//packages/compiler-cli/src/ngtsc/incremental\",\n+        \"//packages/compiler-cli/src/ngtsc/reflection\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck\",\n         \"@npm//typescript\",\n     ],"
        },
        {
            "sha": "0a6b3ac1186e9cbc39774a85e8c8895323cb5610",
            "filename": "packages/compiler-cli/src/ngtsc/core/test/compiler_test.ts",
            "status": "modified",
            "additions": 61,
            "deletions": 1,
            "changes": 62,
            "blob_url": "https://github.com/angular/angular/blob/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Ftest%2Fcompiler_test.ts",
            "raw_url": "https://github.com/angular/angular/raw/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Ftest%2Fcompiler_test.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Ftest%2Fcompiler_test.ts?ref=8f11b516f88e578ac854d40fdb8abf8e10510ef4",
            "patch": "@@ -11,12 +11,14 @@ import * as ts from 'typescript';\n import {absoluteFrom as _, FileSystem, getFileSystem, getSourceFileOrError, NgtscCompilerHost, setFileSystem} from '../../file_system';\n import {runInEachFileSystem} from '../../file_system/testing';\n import {NoopIncrementalBuildStrategy} from '../../incremental';\n+import {ClassDeclaration, isNamedClassDeclaration} from '../../reflection';\n import {ReusedProgramStrategy} from '../../typecheck';\n+\n import {NgCompilerOptions} from '../api';\n+\n import {NgCompiler} from '../src/compiler';\n import {NgCompilerHost} from '../src/host';\n \n-\n runInEachFileSystem(() => {\n   describe('NgCompiler', () => {\n     let fs: FileSystem;\n@@ -55,5 +57,63 @@ runInEachFileSystem(() => {\n       expect(diags.length).toBe(1);\n       expect(diags[0].messageText).toContain('does_not_exist');\n     });\n+\n+    describe('getComponentsWithTemplateFile', () => {\n+      it('should return the component(s) using a template file', () => {\n+        const templateFile = _('/template.html');\n+        fs.writeFile(templateFile, `This is the template, used by components CmpA and CmpC`);\n+        const cmpAFile = _('/cmp-a.ts');\n+        fs.writeFile(cmpAFile, `\n+            import {Component} from '@angular/core';\n+            @Component({\n+              selector: 'cmp-a',\n+              templateUrl: './template.html',\n+            })\n+            export class CmpA {}\n+          `);\n+        const cmpBFile = _('/cmp-b.ts');\n+        fs.writeFile(cmpBFile, `\n+            import {Component} from '@angular/core';\n+            @Component({\n+              selector: 'cmp-b',\n+              template: 'CmpB does not use an external template',\n+            })\n+            export class CmpB {}\n+          `);\n+        const cmpCFile = _('/cmp-c.ts');\n+        fs.writeFile(cmpCFile, `\n+            import {Component} from '@angular/core';\n+            @Component({\n+              selector: 'cmp-c',\n+              templateUrl: './template.html',\n+            })\n+            export class CmpC {}\n+          `);\n+\n+        const options: NgCompilerOptions = {};\n+\n+        const baseHost = new NgtscCompilerHost(getFileSystem(), options);\n+        const host = NgCompilerHost.wrap(\n+            baseHost, [cmpAFile, cmpBFile, cmpCFile], options, /* oldProgram */ null);\n+        const program = ts.createProgram({host, options, rootNames: host.inputFiles});\n+        const CmpA = getClass(getSourceFileOrError(program, cmpAFile), 'CmpA');\n+        const CmpC = getClass(getSourceFileOrError(program, cmpCFile), 'CmpC');\n+        const compiler = new NgCompiler(\n+            host, options, program, new ReusedProgramStrategy(program, host, options, []),\n+            new NoopIncrementalBuildStrategy(), /** enableTemplateTypeChecker */ false);\n+        const components = compiler.getComponentsWithTemplateFile(templateFile);\n+        expect(components).toEqual(new Set([CmpA, CmpC]));\n+      });\n+    });\n   });\n });\n+\n+\n+function getClass(sf: ts.SourceFile, name: string): ClassDeclaration<ts.ClassDeclaration> {\n+  for (const stmt of sf.statements) {\n+    if (isNamedClassDeclaration(stmt) && stmt.name.text === name) {\n+      return stmt;\n+    }\n+  }\n+  throw new Error(`Class ${name} not found in file: ${sf.fileName}: ${sf.text}`);\n+}"
        },
        {
            "sha": "2cf7890186262ef6514561fb72a650d4f07420b4",
            "filename": "packages/compiler-cli/src/ngtsc/metadata/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2FBUILD.bazel?ref=8f11b516f88e578ac854d40fdb8abf8e10510ef4",
            "patch": "@@ -9,6 +9,7 @@ ts_library(\n     ]),\n     deps = [\n         \"//packages/compiler\",\n+        \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/imports\",\n         \"//packages/compiler-cli/src/ngtsc/reflection\",\n         \"//packages/compiler-cli/src/ngtsc/util\","
        },
        {
            "sha": "b45207187527d3417c15622400f64f1d311d3245",
            "filename": "packages/compiler-cli/src/ngtsc/metadata/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Findex.ts?ref=8f11b516f88e578ac854d40fdb8abf8e10510ef4",
            "patch": "@@ -10,5 +10,6 @@ export * from './src/api';\n export {DtsMetadataReader} from './src/dts';\n export {flattenInheritedDirectiveMetadata} from './src/inheritance';\n export {CompoundMetadataRegistry, LocalMetadataRegistry, InjectableClassRegistry} from './src/registry';\n+export {TemplateRegistry as TemplateMapping} from './src/template_mapping';\n export {extractDirectiveTypeCheckMeta, CompoundMetadataReader} from './src/util';\n-export {BindingPropertyName, ClassPropertyMapping, ClassPropertyName, InputOrOutput} from './src/property_mapping';\n+export {BindingPropertyName, ClassPropertyMapping, ClassPropertyName, InputOrOutput} from './src/property_mapping';\n\\ No newline at end of file"
        },
        {
            "sha": "2a5d49613ef6cdfd8d5b5e8fea6bed2b3a3e1989",
            "filename": "packages/compiler-cli/src/ngtsc/metadata/src/template_mapping.ts",
            "status": "added",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Fsrc%2Ftemplate_mapping.ts",
            "raw_url": "https://github.com/angular/angular/raw/8f11b516f88e578ac854d40fdb8abf8e10510ef4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Fsrc%2Ftemplate_mapping.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fmetadata%2Fsrc%2Ftemplate_mapping.ts?ref=8f11b516f88e578ac854d40fdb8abf8e10510ef4",
            "patch": "@@ -0,0 +1,36 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {AbsoluteFsPath} from '../../file_system';\n+import {ClassDeclaration} from '../../reflection';\n+\n+/**\n+ * Tracks the mapping between external template files and the component(s) which use them.\n+ *\n+ * This information is produced during analysis of the program and is used mainly to support\n+ * external tooling, for which such a mapping is challenging to determine without compiler\n+ * assistance.\n+ */\n+export class TemplateRegistry {\n+  private map = new Map<AbsoluteFsPath, Set<ClassDeclaration>>();\n+\n+  getComponentsWithTemplate(template: AbsoluteFsPath): ReadonlySet<ClassDeclaration> {\n+    if (!this.map.has(template)) {\n+      return new Set();\n+    }\n+\n+    return this.map.get(template)!;\n+  }\n+\n+  register(template: AbsoluteFsPath, component: ClassDeclaration): void {\n+    if (!this.map.has(template)) {\n+      this.map.set(template, new Set());\n+    }\n+    this.map.get(template)!.add(component);\n+  }\n+}"
        }
    ],
    "stats": {
        "total": 148,
        "additions": 132,
        "deletions": 16
    }
}