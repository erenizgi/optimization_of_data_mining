{
    "author": "devversion",
    "message": "fix(core): destroy hooks not set up for `useClass` provider using `forwardRef` (#44281)\n\nFixes an issue where destroy hooks are not set up for `useClass` providers\nthat rely on `forwardRef` for passing the actual class reference.\n\nCurrently the destroy hooks are not captured because forward refs are\nnot resolved for class providers. In ES2015+ this issue becomes even\nmore critical if arrow-functions are used for\n\ne.g. `useClass: () => forwardRef(..)`.\n\nThis is because arrow functions do not have a prototype, unlike in ES5\nwhere the function assigned to `useClass` would always have a prototype.\nIn ES2015+ a runtime exception as followed is returned (and doesn't give\nany useful indication of the forwardRef issue):\n\n```\nTypeError: Cannot read properties of undefined (reading 'ngOnDestroy')\n  at registerDestroyHooksIfSupported (dist/packages/core/src/render3/di_setup.ts:196:35 <- dist/legacy-test-bundle.spec.js:41508:37)\n  at resolveProvider (dist/packages/core/src/render3/di_setup.ts:153:9 <- dist/legacy-test-bundle.spec.js:41485:11)\n  at resolveProvider (dist/packages/core/src/render3/di_setup.ts:70:7 <- dist/legacy-test-bundle.spec.js:41445:9)\n  at providersResolver (dist/packages/core/src/render3/di_setup.ts:54:5 <- dist/legacy-test-bundle.spec.js:41438:7)\n  at Object.definition.providersResolver (dist/packages/core/src/render3/features/providers_feature.ts:48:18 <- dist/legacy-test-bundle.spec.js:41600:16)\n  at resolveDirectives (dist/packages/core/src/render3/instructions/shared.ts:1179:40 <- dist/legacy-test-bundle.spec.js:35611:17)\n  at elementStartFirstCreatePass (dist/packages/core/src/render3/instructions/element.ts:40:7 <- dist/legacy-test-bundle.spec.js:38432:27)\n  at ɵɵelementStart (dist/packages/core/src/render3/instructions/element.ts:87:7 <- dist/legacy-test-bundle.spec.js:38453:43)\n  at ɵɵelement (dist/packages/core/src/render3/instructions/element.ts:180:3 <- dist/legacy-test-bundle.spec.js:38510:5)\n  at MultipleFormControls_Template (ng:///MultipleFormControls.js:9:9)\n```\n\nPR Close #44281",
    "sha": "43dfab447d48a4978e52d7c7d67d4527a79f4240",
    "files": [
        {
            "sha": "23793bb1c04ce8ce5719363cecea9fa6772967a2",
            "filename": "packages/core/src/render3/di_setup.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/43dfab447d48a4978e52d7c7d67d4527a79f4240/packages%2Fcore%2Fsrc%2Frender3%2Fdi_setup.ts",
            "raw_url": "https://github.com/angular/angular/raw/43dfab447d48a4978e52d7c7d67d4527a79f4240/packages%2Fcore%2Fsrc%2Frender3%2Fdi_setup.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fdi_setup.ts?ref=43dfab447d48a4978e52d7c7d67d4527a79f4240",
            "patch": "@@ -191,9 +191,14 @@ function registerDestroyHooksIfSupported(\n     tView: TView, provider: Exclude<Provider, any[]>, contextIndex: number,\n     indexInFactory?: number) {\n   const providerIsTypeProvider = isTypeProvider(provider);\n-  if (providerIsTypeProvider || isClassProvider(provider)) {\n-    const prototype = ((provider as ClassProvider).useClass || provider as TypeProvider).prototype;\n+  const providerIsClassProvider = isClassProvider(provider);\n+\n+  if (providerIsTypeProvider || providerIsClassProvider) {\n+    // Resolve forward references as `useClass` can hold a forward reference.\n+    const classToken = providerIsClassProvider ? resolveForwardRef(provider.useClass) : provider;\n+    const prototype = classToken.prototype;\n     const ngOnDestroy = prototype.ngOnDestroy;\n+\n     if (ngOnDestroy) {\n       const hooks = tView.destroyHooks || (tView.destroyHooks = []);\n "
        },
        {
            "sha": "6e28a0f37418bd8c0199110b911615e241009d3a",
            "filename": "packages/core/test/render3/BUILD.bazel",
            "status": "modified",
            "additions": 21,
            "deletions": 1,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/43dfab447d48a4978e52d7c7d67d4527a79f4240/packages%2Fcore%2Ftest%2Frender3%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/43dfab447d48a4978e52d7c7d67d4527a79f4240/packages%2Fcore%2Ftest%2Frender3%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2FBUILD.bazel?ref=43dfab447d48a4978e52d7c7d67d4527a79f4240",
            "patch": "@@ -2,6 +2,10 @@ load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"karma_web_test_suite\", \"ts_li\n \n package(default_visibility = [\"//visibility:public\"])\n \n+ES2015_SPECS = [\n+    \"providers_es2015_spec.ts\",\n+]\n+\n ts_library(\n     name = \"render3_lib\",\n     testonly = True,\n@@ -14,7 +18,7 @@ ts_library(\n             \"is_shape_of.ts\",\n             \"jit_spec.ts\",\n             \"matchers.ts\",\n-        ],\n+        ] + ES2015_SPECS,\n     ),\n     deps = [\n         \":matchers\",\n@@ -37,6 +41,20 @@ ts_library(\n     ],\n )\n \n+ts_library(\n+    name = \"render3_es2015_test_lib\",\n+    testonly = True,\n+    srcs = ES2015_SPECS,\n+    devmode_target = \"es2015\",\n+    tsconfig = \"es2015-tsconfig.json\",\n+    deps = [\n+        \":matchers\",\n+        \":render3_lib\",\n+        \"//packages:types\",\n+        \"//packages/core\",\n+    ],\n+)\n+\n ts_library(\n     name = \"matchers\",\n     testonly = True,\n@@ -80,6 +98,7 @@ jasmine_node_test(\n         \"//tools/testing:node_es5\",\n     ],\n     deps = [\n+        \":render3_es2015_test_lib\",\n         \":render3_node_lib\",\n         \"//packages/zone.js/lib\",\n     ],\n@@ -88,6 +107,7 @@ jasmine_node_test(\n karma_web_test_suite(\n     name = \"render3_web\",\n     deps = [\n+        \":render3_es2015_test_lib\",\n         \":render3_lib\",\n     ],\n )"
        },
        {
            "sha": "798a4ed7eca824ce4f6fc2ec8d80db2187cb924c",
            "filename": "packages/core/test/render3/es2015-tsconfig.json",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/43dfab447d48a4978e52d7c7d67d4527a79f4240/packages%2Fcore%2Ftest%2Frender3%2Fes2015-tsconfig.json",
            "raw_url": "https://github.com/angular/angular/raw/43dfab447d48a4978e52d7c7d67d4527a79f4240/packages%2Fcore%2Ftest%2Frender3%2Fes2015-tsconfig.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fes2015-tsconfig.json?ref=43dfab447d48a4978e52d7c7d67d4527a79f4240",
            "patch": "@@ -0,0 +1,5 @@\n+{\n+  \"compilerOptions\": {\n+    \"target\": \"es2015\"\n+  }\n+}"
        },
        {
            "sha": "35098c38db5dea6efe4a68adb4aaa02d0d9862c0",
            "filename": "packages/core/test/render3/providers_es2015_spec.ts",
            "status": "added",
            "additions": 45,
            "deletions": 0,
            "changes": 45,
            "blob_url": "https://github.com/angular/angular/blob/43dfab447d48a4978e52d7c7d67d4527a79f4240/packages%2Fcore%2Ftest%2Frender3%2Fproviders_es2015_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/43dfab447d48a4978e52d7c7d67d4527a79f4240/packages%2Fcore%2Ftest%2Frender3%2Fproviders_es2015_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fproviders_es2015_spec.ts?ref=43dfab447d48a4978e52d7c7d67d4527a79f4240",
            "patch": "@@ -0,0 +1,45 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {forwardRef, InjectionToken, ɵɵdirectiveInject} from '@angular/core';\n+\n+import {expectProvidersScenario} from './providers_helper';\n+\n+describe('es2015 providers', () => {\n+  abstract class Greeter {\n+    abstract greet: string;\n+  }\n+\n+  const GREETER = new InjectionToken<Greeter>('greeter');\n+\n+  class GreeterClass implements Greeter {\n+    greet = 'Class';\n+    hasBeenCleanedUp = false;\n+\n+    ngOnDestroy() {\n+      this.hasBeenCleanedUp = true;\n+    }\n+  }\n+\n+  it('ClassProvider wrapped in forwardRef', () => {\n+    let greeterInstance: GreeterClass|null = null;\n+\n+    expectProvidersScenario({\n+      parent: {\n+        providers: [{provide: GREETER, useClass: forwardRef(() => GreeterClass)}],\n+        componentAssertion: () => {\n+          greeterInstance = ɵɵdirectiveInject(GREETER) as GreeterClass;\n+          expect(greeterInstance.greet).toEqual('Class');\n+        }\n+      }\n+    });\n+\n+    expect(greeterInstance).not.toBeNull();\n+    expect(greeterInstance!.hasBeenCleanedUp).toBe(true);\n+  });\n+});"
        },
        {
            "sha": "662cbdb11a045433b6b625a3cd24ae859a800064",
            "filename": "packages/core/test/render3/providers_helper.ts",
            "status": "added",
            "additions": 178,
            "deletions": 0,
            "changes": 178,
            "blob_url": "https://github.com/angular/angular/blob/43dfab447d48a4978e52d7c7d67d4527a79f4240/packages%2Fcore%2Ftest%2Frender3%2Fproviders_helper.ts",
            "raw_url": "https://github.com/angular/angular/raw/43dfab447d48a4978e52d7c7d67d4527a79f4240/packages%2Fcore%2Ftest%2Frender3%2Fproviders_helper.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fproviders_helper.ts?ref=43dfab447d48a4978e52d7c7d67d4527a79f4240",
            "patch": "@@ -0,0 +1,178 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {InjectorType, Provider, ɵɵdefineComponent, ɵɵdefineDirective, ɵɵelement, ɵɵelementEnd, ɵɵelementStart, ɵɵProvidersFeature, ɵɵtext} from '@angular/core';\n+import {createInjector} from '@angular/core/src/di/r3_injector';\n+import {RenderFlags} from '@angular/core/src/render3';\n+import {ComponentFixture} from '@angular/core/test/render3/render_util';\n+\n+export interface ComponentTest {\n+  providers?: Provider[];\n+  viewProviders?: Provider[];\n+  directiveProviders?: Provider[];\n+  directive2Providers?: Provider[];\n+  directiveAssertion?: () => void;\n+  componentAssertion?: () => void;\n+}\n+\n+export function expectProvidersScenario(defs: {\n+  app?: ComponentTest,\n+  parent?: ComponentTest,\n+  viewChild?: ComponentTest,\n+  contentChild?: ComponentTest,\n+  ngModule?: InjectorType<any>,\n+}): void {\n+  function testComponentInjection<T>(def: ComponentTest|undefined, instance: T): T {\n+    if (def) {\n+      def.componentAssertion && def.componentAssertion();\n+    }\n+    return instance;\n+  }\n+\n+  function testDirectiveInjection<T>(def: ComponentTest|undefined, instance: T): T {\n+    if (def) {\n+      def.directiveAssertion && def.directiveAssertion();\n+    }\n+    return instance;\n+  }\n+\n+  class ViewChildComponent {\n+    static ɵfac = () => testComponentInjection(defs.viewChild, new ViewChildComponent());\n+    static ɵcmp = ɵɵdefineComponent({\n+      type: ViewChildComponent,\n+      selectors: [['view-child']],\n+      decls: 1,\n+      vars: 0,\n+      template:\n+          function(fs: RenderFlags, ctx: ViewChildComponent) {\n+            if (fs & RenderFlags.Create) {\n+              ɵɵtext(0, 'view-child');\n+            }\n+          },\n+      features: defs.viewChild &&\n+          [ɵɵProvidersFeature(defs.viewChild.providers || [], defs.viewChild.viewProviders || [])]\n+    });\n+  }\n+\n+  class ViewChildDirective {\n+    static ɵfac = () => testDirectiveInjection(defs.viewChild, new ViewChildDirective());\n+    static ɵdir = ɵɵdefineDirective({\n+      type: ViewChildDirective,\n+      selectors: [['view-child']],\n+      features: defs.viewChild && [ɵɵProvidersFeature(defs.viewChild.directiveProviders || [])],\n+    });\n+  }\n+\n+  class ContentChildComponent {\n+    static ɵfac =\n+        () => {\n+          return testComponentInjection(defs.contentChild, new ContentChildComponent());\n+        }\n+\n+    static ɵcmp = ɵɵdefineComponent({\n+      type: ContentChildComponent,\n+      selectors: [['content-child']],\n+      decls: 1,\n+      vars: 0,\n+      template:\n+          function(fs: RenderFlags, ctx: ParentComponent) {\n+            if (fs & RenderFlags.Create) {\n+              ɵɵtext(0, 'content-child');\n+            }\n+          },\n+      features: defs.contentChild &&\n+          [ɵɵProvidersFeature(\n+              defs.contentChild.providers || [], defs.contentChild.viewProviders || [])],\n+    });\n+  }\n+\n+  class ContentChildDirective {\n+    static ɵfac =\n+        () => {\n+          return testDirectiveInjection(defs.contentChild, new ContentChildDirective());\n+        }\n+\n+    static ɵdir = ɵɵdefineDirective({\n+      type: ContentChildDirective,\n+      selectors: [['content-child']],\n+      features: defs.contentChild &&\n+          [ɵɵProvidersFeature(defs.contentChild.directiveProviders || [])],\n+    });\n+  }\n+\n+\n+  class ParentComponent {\n+    static ɵfac = () => testComponentInjection(defs.parent, new ParentComponent());\n+    static ɵcmp = ɵɵdefineComponent({\n+      type: ParentComponent,\n+      selectors: [['parent']],\n+      decls: 1,\n+      vars: 0,\n+      template:\n+          function(fs: RenderFlags, ctx: ParentComponent) {\n+            if (fs & RenderFlags.Create) {\n+              ɵɵelement(0, 'view-child');\n+            }\n+          },\n+      features: defs.parent &&\n+          [ɵɵProvidersFeature(defs.parent.providers || [], defs.parent.viewProviders || [])],\n+      directives: [ViewChildComponent, ViewChildDirective]\n+    });\n+  }\n+\n+  class ParentDirective {\n+    static ɵfac = () => testDirectiveInjection(defs.parent, new ParentDirective());\n+    static ɵdir = ɵɵdefineDirective({\n+      type: ParentDirective,\n+      selectors: [['parent']],\n+      features: defs.parent && [ɵɵProvidersFeature(defs.parent.directiveProviders || [])],\n+    });\n+  }\n+\n+  class ParentDirective2 {\n+    static ɵfac = () => testDirectiveInjection(defs.parent, new ParentDirective2());\n+    static ɵdir = ɵɵdefineDirective({\n+      type: ParentDirective2,\n+      selectors: [['parent']],\n+      features: defs.parent && [ɵɵProvidersFeature(defs.parent.directive2Providers || [])],\n+    });\n+  }\n+\n+\n+  class App {\n+    static ɵfac = () => testComponentInjection(defs.app, new App());\n+    static ɵcmp = ɵɵdefineComponent({\n+      type: App,\n+      selectors: [['app']],\n+      decls: 2,\n+      vars: 0,\n+      template:\n+          function(fs: RenderFlags, ctx: App) {\n+            if (fs & RenderFlags.Create) {\n+              ɵɵelementStart(0, 'parent');\n+              ɵɵelement(1, 'content-child');\n+              ɵɵelementEnd();\n+            }\n+          },\n+      features: defs.app &&\n+          [ɵɵProvidersFeature(defs.app.providers || [], defs.app.viewProviders || [])],\n+      directives:\n+          [\n+            ParentComponent, ParentDirective2, ParentDirective, ContentChildComponent,\n+            ContentChildDirective\n+          ]\n+    });\n+  }\n+\n+\n+  const fixture = new ComponentFixture(\n+      App, {injector: defs.ngModule ? createInjector(defs.ngModule) : undefined});\n+  expect(fixture.html).toEqual('<parent><view-child>view-child</view-child></parent>');\n+\n+  fixture.destroy();\n+}"
        },
        {
            "sha": "122f7a44f8ce9f395529aefd0a9852cb4fca60c6",
            "filename": "packages/core/test/render3/providers_spec.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 165,
            "changes": 178,
            "blob_url": "https://github.com/angular/angular/blob/43dfab447d48a4978e52d7c7d67d4527a79f4240/packages%2Fcore%2Ftest%2Frender3%2Fproviders_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/43dfab447d48a4978e52d7c7d67d4527a79f4240/packages%2Fcore%2Ftest%2Frender3%2Fproviders_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fproviders_spec.ts?ref=43dfab447d48a4978e52d7c7d67d4527a79f4240",
            "patch": "@@ -15,6 +15,7 @@ import {NgModuleFactory} from '../../src/render3/ng_module_ref';\n import {getInjector} from '../../src/render3/util/discovery_utils';\n \n import {getRendererFactory2} from './imported_renderer2';\n+import {expectProvidersScenario} from './providers_helper';\n import {ComponentFixture} from './render_util';\n \n const Component: typeof _Component = function(...args: any[]): any {\n@@ -37,6 +38,11 @@ describe('providers', () => {\n \n     class GreeterClass implements Greeter {\n       greet = 'Class';\n+      hasBeenCleanedUp = false;\n+\n+      ngOnDestroy() {\n+        this.hasBeenCleanedUp = true;\n+      }\n     }\n \n     class GreeterDeps implements Greeter {\n@@ -232,14 +238,20 @@ describe('providers', () => {\n       });\n \n       it('ClassProvider wrapped in forwardRef', () => {\n+        let greeterInstance: GreeterClass|null = null;\n+\n         expectProvidersScenario({\n           parent: {\n             providers: [{provide: GREETER, useClass: forwardRef(() => GreeterClass)}],\n             componentAssertion: () => {\n-              expect(ɵɵdirectiveInject(GREETER).greet).toEqual('Class');\n+              greeterInstance = ɵɵdirectiveInject(GREETER) as GreeterClass;\n+              expect(greeterInstance.greet).toEqual('Class');\n             }\n           }\n         });\n+\n+        expect(greeterInstance).not.toBeNull();\n+        expect(greeterInstance!.hasBeenCleanedUp).toBe(true);\n       });\n \n       it('ExistingProvider wrapped in forwardRef', () => {\n@@ -1386,167 +1398,3 @@ describe('providers', () => {\n        });\n   });\n });\n-\n-interface ComponentTest {\n-  providers?: Provider[];\n-  viewProviders?: Provider[];\n-  directiveProviders?: Provider[];\n-  directive2Providers?: Provider[];\n-  directiveAssertion?: () => void;\n-  componentAssertion?: () => void;\n-}\n-\n-function expectProvidersScenario(defs: {\n-  app?: ComponentTest,\n-  parent?: ComponentTest,\n-  viewChild?: ComponentTest,\n-  contentChild?: ComponentTest,\n-  ngModule?: InjectorType<any>,\n-}): void {\n-  function testComponentInjection<T>(def: ComponentTest|undefined, instance: T): T {\n-    if (def) {\n-      def.componentAssertion && def.componentAssertion();\n-    }\n-    return instance;\n-  }\n-\n-  function testDirectiveInjection<T>(def: ComponentTest|undefined, instance: T): T {\n-    if (def) {\n-      def.directiveAssertion && def.directiveAssertion();\n-    }\n-    return instance;\n-  }\n-\n-  class ViewChildComponent {\n-    static ɵfac = () => testComponentInjection(defs.viewChild, new ViewChildComponent());\n-    static ɵcmp = ɵɵdefineComponent({\n-      type: ViewChildComponent,\n-      selectors: [['view-child']],\n-      decls: 1,\n-      vars: 0,\n-      template:\n-          function(fs: RenderFlags, ctx: ViewChildComponent) {\n-            if (fs & RenderFlags.Create) {\n-              ɵɵtext(0, 'view-child');\n-            }\n-          },\n-      features: defs.viewChild &&\n-          [ɵɵProvidersFeature(defs.viewChild.providers || [], defs.viewChild.viewProviders || [])]\n-    });\n-  }\n-\n-  class ViewChildDirective {\n-    static ɵfac = () => testDirectiveInjection(defs.viewChild, new ViewChildDirective());\n-    static ɵdir = ɵɵdefineDirective({\n-      type: ViewChildDirective,\n-      selectors: [['view-child']],\n-      features: defs.viewChild && [ɵɵProvidersFeature(defs.viewChild.directiveProviders || [])],\n-    });\n-  }\n-\n-  class ContentChildComponent {\n-    static ɵfac =\n-        () => {\n-          return testComponentInjection(defs.contentChild, new ContentChildComponent());\n-        }\n-\n-    static ɵcmp = ɵɵdefineComponent({\n-      type: ContentChildComponent,\n-      selectors: [['content-child']],\n-      decls: 1,\n-      vars: 0,\n-      template:\n-          function(fs: RenderFlags, ctx: ParentComponent) {\n-            if (fs & RenderFlags.Create) {\n-              ɵɵtext(0, 'content-child');\n-            }\n-          },\n-      features: defs.contentChild &&\n-          [ɵɵProvidersFeature(\n-              defs.contentChild.providers || [], defs.contentChild.viewProviders || [])],\n-    });\n-  }\n-\n-  class ContentChildDirective {\n-    static ɵfac =\n-        () => {\n-          return testDirectiveInjection(defs.contentChild, new ContentChildDirective());\n-        }\n-\n-    static ɵdir = ɵɵdefineDirective({\n-      type: ContentChildDirective,\n-      selectors: [['content-child']],\n-      features: defs.contentChild &&\n-          [ɵɵProvidersFeature(defs.contentChild.directiveProviders || [])],\n-    });\n-  }\n-\n-\n-  class ParentComponent {\n-    static ɵfac = () => testComponentInjection(defs.parent, new ParentComponent());\n-    static ɵcmp = ɵɵdefineComponent({\n-      type: ParentComponent,\n-      selectors: [['parent']],\n-      decls: 1,\n-      vars: 0,\n-      template:\n-          function(fs: RenderFlags, ctx: ParentComponent) {\n-            if (fs & RenderFlags.Create) {\n-              ɵɵelement(0, 'view-child');\n-            }\n-          },\n-      features: defs.parent &&\n-          [ɵɵProvidersFeature(defs.parent.providers || [], defs.parent.viewProviders || [])],\n-      directives: [ViewChildComponent, ViewChildDirective]\n-    });\n-  }\n-\n-  class ParentDirective {\n-    static ɵfac = () => testDirectiveInjection(defs.parent, new ParentDirective());\n-    static ɵdir = ɵɵdefineDirective({\n-      type: ParentDirective,\n-      selectors: [['parent']],\n-      features: defs.parent && [ɵɵProvidersFeature(defs.parent.directiveProviders || [])],\n-    });\n-  }\n-\n-  class ParentDirective2 {\n-    static ɵfac = () => testDirectiveInjection(defs.parent, new ParentDirective2());\n-    static ɵdir = ɵɵdefineDirective({\n-      type: ParentDirective2,\n-      selectors: [['parent']],\n-      features: defs.parent && [ɵɵProvidersFeature(defs.parent.directive2Providers || [])],\n-    });\n-  }\n-\n-\n-  class App {\n-    static ɵfac = () => testComponentInjection(defs.app, new App());\n-    static ɵcmp = ɵɵdefineComponent({\n-      type: App,\n-      selectors: [['app']],\n-      decls: 2,\n-      vars: 0,\n-      template:\n-          function(fs: RenderFlags, ctx: App) {\n-            if (fs & RenderFlags.Create) {\n-              ɵɵelementStart(0, 'parent');\n-              ɵɵelement(1, 'content-child');\n-              ɵɵelementEnd();\n-            }\n-          },\n-      features: defs.app &&\n-          [ɵɵProvidersFeature(defs.app.providers || [], defs.app.viewProviders || [])],\n-      directives:\n-          [\n-            ParentComponent, ParentDirective2, ParentDirective, ContentChildComponent,\n-            ContentChildDirective\n-          ]\n-    });\n-  }\n-\n-\n-  const fixture = new ComponentFixture(\n-      App, {injector: defs.ngModule ? createInjector(defs.ngModule) : undefined});\n-  expect(fixture.html).toEqual('<parent><view-child>view-child</view-child></parent>');\n-}"
        }
    ],
    "stats": {
        "total": 437,
        "additions": 269,
        "deletions": 168
    }
}