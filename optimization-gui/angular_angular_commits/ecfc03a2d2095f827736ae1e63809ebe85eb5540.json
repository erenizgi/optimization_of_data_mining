{
    "author": "mgechev",
    "message": "feat(devtools): don't show comment nodes by default",
    "sha": "ecfc03a2d2095f827736ae1e63809ebe85eb5540",
    "files": [
        {
            "sha": "c379b0333df953875e1e2b569e14988e29020dc8",
            "filename": "cypress/integration/comment-nodes.e2e.js",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/ecfc03a2d2095f827736ae1e63809ebe85eb5540/cypress%2Fintegration%2Fcomment-nodes.e2e.js",
            "raw_url": "https://github.com/angular/angular/raw/ecfc03a2d2095f827736ae1e63809ebe85eb5540/cypress%2Fintegration%2Fcomment-nodes.e2e.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/cypress%2Fintegration%2Fcomment-nodes.e2e.js?ref=ecfc03a2d2095f827736ae1e63809ebe85eb5540",
            "patch": "@@ -0,0 +1,22 @@\n+function showComments() {\n+  cy.get(\n+    '#nav-buttons > button.mat-focus-indicator.mat-menu-trigger.mat-icon-button.mat-button-base.mat-primary'\n+  ).click();\n+  cy.get('#mat-slide-toggle-3 > label > div').click();\n+}\n+\n+describe('Comment nodes', () => {\n+  beforeEach(() => {\n+    cy.visit('/');\n+  });\n+\n+  it('should not find any comment nodes by default', () => {\n+    const nodes = cy.$$('.tree-node:contains(\"#comment\")');\n+    expect(nodes.length).to.eql(0);\n+  });\n+\n+  it('should find comment nodes when the setting is enabled', () => {\n+    showComments();\n+    cy.get('.tree-wrapper').find('.tree-node:contains(\"#comment\")').its('length').should('not.eq', 0);\n+  });\n+});"
        },
        {
            "sha": "d705b943c721cad30b53557b157ed9895694bd1b",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/devtools-tabs.component.html",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdevtools-tabs.component.html",
            "raw_url": "https://github.com/angular/angular/raw/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdevtools-tabs.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdevtools-tabs.component.html?ref=ecfc03a2d2095f827736ae1e63809ebe85eb5540",
            "patch": "@@ -25,6 +25,7 @@\n \n <div class=\"tab-content\">\n   <ng-directive-explorer\n+    [showCommentNodes]=\"showCommentNodes\"\n     [ngClass]=\"{ hidden: activeTab !== 'Components' }\"\n     (toggleInspector)=\"toggleInspector()\"\n   ></ng-directive-explorer>\n@@ -46,4 +47,13 @@\n   >\n     Dark Mode\n   </mat-slide-toggle>\n+  <br />\n+  <br />\n+  <mat-slide-toggle\n+    (change)=\"showCommentNodes = $event.checked\"\n+    class=\"menu-toggle-button\"\n+    (click)=\"$event.stopPropagation()\"\n+  >\n+    Show comment nodes\n+  </mat-slide-toggle>\n </mat-menu>"
        },
        {
            "sha": "8d89e678de0c89d349e38f402cf8d4ba3ff8bd97",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/devtools-tabs.component.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdevtools-tabs.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdevtools-tabs.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdevtools-tabs.component.ts?ref=ecfc03a2d2095f827736ae1e63809ebe85eb5540",
            "patch": "@@ -23,6 +23,7 @@ export class DevToolsTabsComponent implements OnInit, OnDestroy, AfterViewInit {\n \n   inspectorRunning = false;\n   routerTreeEnabled = false;\n+  showCommentNodes = false;\n \n   private _currentThemeSubscription: Subscription;\n   currentTheme: Theme;"
        },
        {
            "sha": "9c8ffdba6f8ac3c47955f945952364f8e810ae67",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-explorer.component.html",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.component.html",
            "raw_url": "https://github.com/angular/angular/raw/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.component.html?ref=ecfc03a2d2095f827736ae1e63809ebe85eb5540",
            "patch": "@@ -11,6 +11,7 @@\n           (toggleInspector)=\"toggleInspector.emit()\"\n           [forest]=\"forest\"\n           [currentSelectedElement]=\"currentSelectedElement\"\n+          [showCommentNodes]=\"showCommentNodes\"\n         ></ng-directive-forest>\n       </as-split-area>\n       <as-split-area size=\"22\">"
        },
        {
            "sha": "d8da234c12557c47c1f580471a5acdba15ee7ec6",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-explorer.component.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.component.ts?ref=ecfc03a2d2095f827736ae1e63809ebe85eb5540",
            "patch": "@@ -3,6 +3,7 @@ import {\n   Component,\n   ElementRef,\n   EventEmitter,\n+  Input,\n   NgZone,\n   OnDestroy,\n   OnInit,\n@@ -58,14 +59,18 @@ const sameDirectives = (a: IndexedNode, b: IndexedNode) => {\n   ],\n })\n export class DirectiveExplorerComponent implements OnInit, OnDestroy {\n+  @Input() showCommentNodes = false;\n   @Output() toggleInspector = new EventEmitter<void>();\n \n+  @ViewChild(DirectiveForestComponent) directiveForest: DirectiveForestComponent;\n+  @ViewChild(BreadcrumbsComponent) breadcrumbs: BreadcrumbsComponent;\n+  @ViewChild(SplitComponent, { static: true, read: ElementRef }) splitElementRef: ElementRef;\n+  @ViewChild('directiveForestSplitArea', { static: true, read: ElementRef }) directiveForestSplitArea: ElementRef;\n+\n   currentSelectedElement: IndexedNode | null = null;\n   forest: DevToolsNode[];\n   splitDirection: 'horizontal' | 'vertical' = 'horizontal';\n-\n-  @ViewChild(SplitComponent, { static: true, read: ElementRef }) splitElementRef: ElementRef;\n-  @ViewChild('directiveForestSplitArea', { static: true, read: ElementRef }) directiveForestSplitArea: ElementRef;\n+  parents: FlatNode[] | null = null;\n \n   private _resizeObserver = new ResizeObserver((entries) =>\n     this._ngZone.run(() => {\n@@ -86,11 +91,6 @@ export class DirectiveExplorerComponent implements OnInit, OnDestroy {\n   private _clickedElement: IndexedNode | null = null;\n   private _refreshRetryTimeout: any = null;\n \n-  parents: FlatNode[] | null = null;\n-\n-  @ViewChild(DirectiveForestComponent) directiveForest: DirectiveForestComponent;\n-  @ViewChild(BreadcrumbsComponent) breadcrumbs: BreadcrumbsComponent;\n-\n   constructor(\n     private _appOperations: ApplicationOperations,\n     private _messageBus: MessageBus<Events>,"
        },
        {
            "sha": "ad3ee213b2b79030482ffb5c878c5f5fdd513bb7",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/component-data-source.spec.ts",
            "status": "added",
            "additions": 129,
            "deletions": 0,
            "changes": 129,
            "blob_url": "https://github.com/angular/angular/blob/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fcomponent-data-source.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fcomponent-data-source.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fcomponent-data-source.spec.ts?ref=ecfc03a2d2095f827736ae1e63809ebe85eb5540",
            "patch": "@@ -0,0 +1,129 @@\n+import { FlatTreeControl } from '@angular/cdk/tree';\n+import { ComponentDataSource, FlatNode } from './component-data-source';\n+import { DevToolsNode } from 'protocol';\n+\n+const tree1: DevToolsNode = {\n+  element: 'app',\n+  directives: [\n+    {\n+      id: 1,\n+      name: 'foo',\n+    },\n+  ],\n+  component: null,\n+  children: [\n+    {\n+      children: [],\n+      component: {\n+        id: 2,\n+        isElement: false,\n+        name: 'bar',\n+      },\n+      directives: [],\n+      element: 'bar',\n+      nativeElement: document.createElement('bar'),\n+    },\n+  ],\n+  nativeElement: document.createElement('foo'),\n+};\n+\n+const tree2: DevToolsNode = {\n+  element: 'app',\n+  directives: [\n+    {\n+      id: 1,\n+      name: 'foo',\n+    },\n+  ],\n+  component: null,\n+  children: [\n+    {\n+      children: [],\n+      component: {\n+        id: 2,\n+        isElement: false,\n+        name: 'bar',\n+      },\n+      directives: [],\n+      element: 'bar',\n+      nativeElement: document.createElement('bar'),\n+    },\n+    {\n+      children: [],\n+      component: {\n+        id: 3,\n+        isElement: false,\n+        name: 'qux',\n+      },\n+      directives: [],\n+      element: 'qux',\n+      nativeElement: document.createElement('qux'),\n+    },\n+  ],\n+  nativeElement: document.createElement('foo'),\n+};\n+\n+const tree3: DevToolsNode = {\n+  element: 'app',\n+  directives: [\n+    {\n+      id: 1,\n+      name: 'foo',\n+    },\n+  ],\n+  component: null,\n+  children: [\n+    {\n+      children: [],\n+      component: {\n+        id: 2,\n+        isElement: false,\n+        name: 'bar',\n+      },\n+      directives: [],\n+      element: '#comment',\n+      nativeElement: document.createComment('bar'),\n+    },\n+    {\n+      children: [],\n+      component: {\n+        id: 3,\n+        isElement: false,\n+        name: 'qux',\n+      },\n+      directives: [],\n+      element: '#comment',\n+      nativeElement: document.createComment('bar'),\n+    },\n+  ],\n+  nativeElement: document.createElement('foo'),\n+};\n+\n+describe('ComponentDataSource', () => {\n+  let dataSource: ComponentDataSource;\n+  const treeControl = new FlatTreeControl<FlatNode>(\n+    (node) => node.level,\n+    (node) => node.expandable\n+  );\n+\n+  beforeEach(() => (dataSource = new ComponentDataSource(treeControl)));\n+\n+  it('should return new and old items', () => {\n+    const result = dataSource.update([tree1], true);\n+    expect(result.movedItems.length).toBe(0);\n+    expect(result.newItems.length).toBe(2);\n+\n+    const updatedResult = dataSource.update([tree2], true);\n+    expect(updatedResult.movedItems.length).toBe(0);\n+    expect(updatedResult.removedItems.length).toBe(0);\n+    expect(updatedResult.newItems.length).toBe(1);\n+    expect(updatedResult.newItems[0].name).toBe('qux');\n+  });\n+\n+  it('should not return comment nodes when not requested', () => {\n+    const result = dataSource.update([tree3], false);\n+    expect(result.movedItems.length).toBe(0);\n+    expect(result.newItems.length).toBe(1);\n+    expect(result.newItems[0].name).toBe('app');\n+  });\n+});"
        },
        {
            "sha": "886ebae6b4ded798eceadeff52a74c4c73e67a90",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/component-data-source.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fcomponent-data-source.ts",
            "raw_url": "https://github.com/angular/angular/raw/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fcomponent-data-source.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fcomponent-data-source.ts?ref=ecfc03a2d2095f827736ae1e63809ebe85eb5540",
            "patch": "@@ -84,13 +84,20 @@ export class ComponentDataSource extends DataSource<FlatNode> {\n     return this._nodeToFlat.get(indexedNode);\n   }\n \n-  update(forest: DevToolsNode[]): { newItems: FlatNode[]; movedItems: FlatNode[]; removedItems: FlatNode[] } {\n+  update(\n+    forest: DevToolsNode[],\n+    showCommentNodes: boolean\n+  ): { newItems: FlatNode[]; movedItems: FlatNode[]; removedItems: FlatNode[] } {\n     if (!forest) {\n       return { newItems: [], movedItems: [], removedItems: [] };\n     }\n \n     const indexedForest = indexForest(forest);\n-    const flattenedCollection = this._treeFlattener.flattenNodes(indexedForest) as FlatNode[];\n+    let flattenedCollection = this._treeFlattener.flattenNodes(indexedForest) as FlatNode[];\n+\n+    if (!showCommentNodes) {\n+      flattenedCollection = flattenedCollection.filter((node) => node.original.element !== '#comment');\n+    }\n \n     this.data.forEach((i) => (i.newItem = false));\n "
        },
        {
            "sha": "5990b2819dd96a3361369df985d6b4a407704406",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-forest/directive-forest.component.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fdirective-forest.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/ecfc03a2d2095f827736ae1e63809ebe85eb5540/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fdirective-forest.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-forest%2Fdirective-forest.component.ts?ref=ecfc03a2d2095f827736ae1e63809ebe85eb5540",
            "patch": "@@ -27,13 +27,18 @@ import { Subscription } from 'rxjs';\n })\n export class DirectiveForestComponent implements OnInit, OnDestroy {\n   @Input() set forest(forest: DevToolsNode[]) {\n+    this._latestForest = forest;\n     const result = this._updateForest(forest);\n     const changed = result.movedItems.length || result.newItems.length || result.removedItems.length;\n     if (this.currentSelectedElement && changed) {\n       this._reselectNodeOnUpdate();\n     }\n   }\n   @Input() currentSelectedElement: IndexedNode;\n+  @Input() set showCommentNodes(show: boolean) {\n+    this._showCommentNodes = show;\n+    this.forest = this._latestForest;\n+  }\n \n   @Output() selectNode = new EventEmitter<IndexedNode | null>();\n   @Output() selectDomElement = new EventEmitter<IndexedNode>();\n@@ -52,6 +57,8 @@ export class DirectiveForestComponent implements OnInit, OnDestroy {\n \n   private _highlightIDinTreeFromElement: number | null = null;\n   private _tabUpdateSubscription: Subscription;\n+  private _showCommentNodes = false;\n+  private _latestForest: DevToolsNode[];\n \n   set highlightIDinTreeFromElement(id: number | null) {\n     this._highlightIDinTreeFromElement = id;\n@@ -169,7 +176,7 @@ export class DirectiveForestComponent implements OnInit, OnDestroy {\n   private _updateForest(\n     forest: DevToolsNode[]\n   ): { newItems: FlatNode[]; movedItems: FlatNode[]; removedItems: FlatNode[] } {\n-    const result = this.dataSource.update(forest);\n+    const result = this.dataSource.update(forest, this._showCommentNodes);\n     if (!this._initialized && forest && forest.length) {\n       this.treeControl.expandAll();\n       this._initialized = true;"
        }
    ],
    "stats": {
        "total": 199,
        "additions": 188,
        "deletions": 11
    }
}