{
    "author": "atscott",
    "message": "fix(router): Ensure all outlets are used when commands have a prefix (#39456)\n\nWhen there is a primary outlet present in the outlets map and the object is also prefixed\nwith some other commands, the current logic only uses the primary outlet and ignores\nthe others. This change ensures that all outlets are respected at the\nsegment level when prefixed with other commands.\n\nPR Close #39456",
    "sha": "3af585c004a7785015d5a4af4640fc56365220ad",
    "files": [
        {
            "sha": "2a70e23e2c8d060096022c5482b39f53160aa989",
            "filename": "packages/router/src/create_url_tree.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/3af585c004a7785015d5a4af4640fc56365220ad/packages%2Frouter%2Fsrc%2Fcreate_url_tree.ts",
            "raw_url": "https://github.com/angular/angular/raw/3af585c004a7785015d5a4af4640fc56365220ad/packages%2Frouter%2Fsrc%2Fcreate_url_tree.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Fcreate_url_tree.ts?ref=3af585c004a7785015d5a4af4640fc56365220ad",
            "patch": "@@ -186,13 +186,6 @@ function createPositionApplyingDoubleDots(\n   return new Position(g, false, ci - dd);\n }\n \n-function getPath(command: any): any {\n-  if (isCommandWithOutlets(command)) {\n-    return command.outlets[PRIMARY_OUTLET];\n-  }\n-  return `${command}`;\n-}\n-\n function getOutlets(commands: any[]): {[k: string]: any[]} {\n   if (isCommandWithOutlets(commands[0])) {\n     return commands[0].outlets;\n@@ -259,7 +252,14 @@ function prefixedWith(segmentGroup: UrlSegmentGroup, startIndex: number, command\n   while (currentPathIndex < segmentGroup.segments.length) {\n     if (currentCommandIndex >= commands.length) return noMatch;\n     const path = segmentGroup.segments[currentPathIndex];\n-    const curr = getPath(commands[currentCommandIndex]);\n+    const command = commands[currentCommandIndex];\n+    // Do not try to consume command as part of the prefixing if it has outlets because it can\n+    // contain outlets other than the one being processed. Consuming the outlets command would\n+    // result in other outlets being ignored.\n+    if (isCommandWithOutlets(command)) {\n+      break;\n+    }\n+    const curr = `${command}`;\n     const next =\n         currentCommandIndex < commands.length - 1 ? commands[currentCommandIndex + 1] : null;\n \n@@ -298,7 +298,7 @@ function createNewSegmentGroup(\n       continue;\n     }\n \n-    const curr = getPath(command);\n+    const curr = isCommandWithOutlets(command) ? command.outlets[PRIMARY_OUTLET] : `${command}`;\n     const next = (i < commands.length - 1) ? commands[i + 1] : null;\n     if (curr && next && isMatrixParams(next)) {\n       paths.push(new UrlSegment(curr, stringify(next)));"
        },
        {
            "sha": "d51fa48d9570f8e597165f5dc3ca227a6ef9b84c",
            "filename": "packages/router/test/create_url_tree.spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/3af585c004a7785015d5a4af4640fc56365220ad/packages%2Frouter%2Ftest%2Fcreate_url_tree.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/3af585c004a7785015d5a4af4640fc56365220ad/packages%2Frouter%2Ftest%2Fcreate_url_tree.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fcreate_url_tree.spec.ts?ref=3af585c004a7785015d5a4af4640fc56365220ad",
            "patch": "@@ -150,13 +150,13 @@ describe('createUrlTree', () => {\n       expect(serializer.serialize(t)).toEqual('/parent/child');\n     });\n \n-    xit('should support updating secondary and primary outlets with prefix', () => {\n+    it('should support updating secondary and primary outlets with prefix', () => {\n       const p = serializer.parse('/parent/child');\n       const t = createRoot(p, ['parent', {outlets: {primary: 'child', secondary: 'popup'}}]);\n       expect(serializer.serialize(t)).toEqual('/parent/(child//secondary:popup)');\n     });\n \n-    xit('should support updating two outlets at the same time relative to non-root segment', () => {\n+    it('should support updating two outlets at the same time relative to non-root segment', () => {\n       const p = serializer.parse('/parent/child');\n       const t = create(\n           p.root.children[PRIMARY_OUTLET], 0 /* relativeTo: 'parent' */, p,"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 11,
        "deletions": 11
    }
}