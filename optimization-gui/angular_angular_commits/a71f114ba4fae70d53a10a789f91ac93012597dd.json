{
    "author": "JiaLiPassion",
    "message": "fix(zone.js): clearTimeout/clearInterval should call on object global (#37858)\n\nClose #37333\n\n`clearTimeout` is patched by `zone.js`, and it finally calls the native delegate of `clearTimeout`,\nthe current implemention only call `clearNative(id)`, but it should call on object `global` like\n`clearNative.call(global, id)`. Otherwise in some env, it will throw error\n`clearTimeout called on an object that does not implement interface Window`\n\nPR Close #37858",
    "sha": "a71f114ba4fae70d53a10a789f91ac93012597dd",
    "files": [
        {
            "sha": "e1d68b5a6d571761100d79e3d458e78bdaa4c6ee",
            "filename": "packages/zone.js/lib/common/timers.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/a71f114ba4fae70d53a10a789f91ac93012597dd/packages%2Fzone.js%2Flib%2Fcommon%2Ftimers.ts",
            "raw_url": "https://github.com/angular/angular/raw/a71f114ba4fae70d53a10a789f91ac93012597dd/packages%2Fzone.js%2Flib%2Fcommon%2Ftimers.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Flib%2Fcommon%2Ftimers.ts?ref=a71f114ba4fae70d53a10a789f91ac93012597dd",
            "patch": "@@ -55,7 +55,7 @@ export function patchTimer(window: any, setName: string, cancelName: string, nam\n   }\n \n   function clearTask(task: Task) {\n-    return clearNative!((<TimerOptions>task.data).handleId);\n+    return clearNative!.call(window, (<TimerOptions>task.data).handleId);\n   }\n \n   setNative ="
        },
        {
            "sha": "7d4f31eb6a916f8f17032b9b7c1af1c8aed682b9",
            "filename": "packages/zone.js/test/common/setTimeout.spec.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/a71f114ba4fae70d53a10a789f91ac93012597dd/packages%2Fzone.js%2Ftest%2Fcommon%2FsetTimeout.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/a71f114ba4fae70d53a10a789f91ac93012597dd/packages%2Fzone.js%2Ftest%2Fcommon%2FsetTimeout.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Ftest%2Fcommon%2FsetTimeout.spec.ts?ref=a71f114ba4fae70d53a10a789f91ac93012597dd",
            "patch": "@@ -6,7 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {patchTimer} from '../../lib/common/timers';\n import {isNode, zoneSymbol} from '../../lib/common/utils';\n+\n declare const global: any;\n const wtfMock = global.wtfMock;\n \n@@ -56,6 +58,25 @@ describe('setTimeout', function() {\n     });\n   });\n \n+  it('should call native clearTimeout with the correct context', function() {\n+    // since clearTimeout has been patched already, we can not test `clearTimeout` directly\n+    // we will fake another API patch to test\n+    let context: any = null;\n+    const fakeGlobal = {\n+      setTimeout: function() {\n+        return 1;\n+      },\n+      clearTimeout: function(id: number) {\n+        context = this;\n+      }\n+    };\n+    patchTimer(fakeGlobal, 'set', 'clear', 'Timeout')\n+    const cancelId = fakeGlobal.setTimeout();\n+    const m = fakeGlobal.clearTimeout;\n+    m.call({}, cancelId);\n+    expect(context).toBe(fakeGlobal);\n+  });\n+\n   it('should allow cancelation of fns registered with setTimeout after invocation', function(done) {\n     const testZone = Zone.current.fork((Zone as any)['wtfZoneSpec']).fork({name: 'TestZone'});\n     testZone.run(() => {"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 22,
        "deletions": 1
    }
}