{
    "author": "devversion",
    "message": "refactor(dev-infra): do not validate config file multiple times (#38808)\n\nCurrently we validate the configuration file on each `getConfig`\ninvocation. We can only validate once since the configuration\nis cached.\n\nAlso while being at it, renames the cache variables to lower-case as those\ndo not represent constants (which are convention-wise upper case).\n\nPR Close #38808",
    "sha": "e162da07538a4b1379ec1092ba30e891c804a93c",
    "files": [
        {
            "sha": "358c02d7665aa2b7d89b5b6984705a998cf10f20",
            "filename": "dev-infra/utils/config.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/e162da07538a4b1379ec1092ba30e891c804a93c/dev-infra%2Futils%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/e162da07538a4b1379ec1092ba30e891c804a93c/dev-infra%2Futils%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fconfig.ts?ref=e162da07538a4b1379ec1092ba30e891c804a93c",
            "patch": "@@ -49,7 +49,7 @@ export type NgDevConfig<T = {}> = CommonConfig&T;\n const CONFIG_FILE_PATH = '.ng-dev/config';\n \n /** The configuration for ng-dev. */\n-let CONFIG: {}|null = null;\n+let cachedConfig: NgDevConfig|null = null;\n \n /**\n  * The filename expected for local user config, without the file extension to allow a typescript,\n@@ -58,23 +58,23 @@ let CONFIG: {}|null = null;\n const USER_CONFIG_FILE_PATH = '.ng-dev.user';\n \n /** The local user configuration for ng-dev. */\n-let USER_CONFIG: {[key: string]: any};\n+let userConfig: {[key: string]: any}|null = null;\n \n /**\n  * Get the configuration from the file system, returning the already loaded\n  * copy if it is defined.\n  */\n export function getConfig(): NgDevConfig {\n   // If the global config is not defined, load it from the file system.\n-  if (CONFIG === null) {\n+  if (cachedConfig === null) {\n     // The full path to the configuration file.\n     const configPath = join(getRepoBaseDir(), CONFIG_FILE_PATH);\n-    // Set the global config object.\n-    CONFIG = readConfigFile(configPath);\n+    // Read the configuration and validate it before caching it for the future.\n+    cachedConfig = validateCommonConfig(readConfigFile(configPath));\n   }\n-  // Return a clone of the global config to ensure that a new instance of the config is returned\n-  // each time, preventing unexpected effects of modifications to the config object.\n-  return validateCommonConfig({...CONFIG});\n+  // Return a clone of the cached global config to ensure that a new instance of the config\n+  // is returned each time, preventing unexpected effects of modifications to the config object.\n+  return {...cachedConfig};\n }\n \n /** Validate the common configuration has been met for the ng-dev command. */\n@@ -162,13 +162,13 @@ export function getRepoBaseDir() {\n  */\n export function getUserConfig() {\n   // If the global config is not defined, load it from the file system.\n-  if (USER_CONFIG === undefined) {\n+  if (userConfig === null) {\n     // The full path to the configuration file.\n     const configPath = join(getRepoBaseDir(), USER_CONFIG_FILE_PATH);\n     // Set the global config object.\n-    USER_CONFIG = readConfigFile(configPath, true);\n+    userConfig = readConfigFile(configPath, true);\n   }\n-  // Return a clone of the global config to ensure that a new instance of the config is returned\n+  // Return a clone of the user config to ensure that a new instance of the config is returned\n   // each time, preventing unexpected effects of modifications to the config object.\n-  return {...USER_CONFIG};\n+  return {...userConfig};\n }"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 12,
        "deletions": 12
    }
}