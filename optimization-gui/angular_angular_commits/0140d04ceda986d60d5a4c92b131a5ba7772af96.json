{
    "author": "josephperrott",
    "message": "feat(dev-infra): create the prettier formatter for ng-dev format tooling (#41824)\n\nAdd support to use prettier for formatting using `ng-dev format`.\n\nPR Close #41824",
    "sha": "0140d04ceda986d60d5a4c92b131a5ba7772af96",
    "files": [
        {
            "sha": "7b6381a54bcf1c323d8831fcb279a0ceb11ddeab",
            "filename": "dev-infra/format/formatters/base-formatter.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0140d04ceda986d60d5a4c92b131a5ba7772af96/dev-infra%2Fformat%2Fformatters%2Fbase-formatter.ts",
            "raw_url": "https://github.com/angular/angular/raw/0140d04ceda986d60d5a4c92b131a5ba7772af96/dev-infra%2Fformat%2Fformatters%2Fbase-formatter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fbase-formatter.ts?ref=0140d04ceda986d60d5a4c92b131a5ba7772af96",
            "patch": "@@ -46,7 +46,7 @@ export abstract class Formatter {\n   /** The default matchers for the formatter for filtering files to be formatted. */\n   abstract defaultFileMatcher: string[];\n \n-  constructor(private config: FormatConfig) {}\n+  constructor(protected config: FormatConfig) {}\n \n   /**\n    * Retrieve the command to execute the provided action, including both the binary"
        },
        {
            "sha": "3279c3c279aa667f49b7042ff3cc6edb8944a08b",
            "filename": "dev-infra/format/formatters/index.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/0140d04ceda986d60d5a4c92b131a5ba7772af96/dev-infra%2Fformat%2Fformatters%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/0140d04ceda986d60d5a4c92b131a5ba7772af96/dev-infra%2Fformat%2Fformatters%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Findex.ts?ref=0140d04ceda986d60d5a4c92b131a5ba7772af96",
            "patch": "@@ -10,14 +10,18 @@ import {getFormatConfig} from '../config';\n \n import {Buildifier} from './buildifier';\n import {ClangFormat} from './clang-format';\n+import {Prettier} from './prettier';\n \n /**\n  * Get all defined formatters which are active based on the current loaded config.\n  */\n export function getActiveFormatters() {\n   const config = getFormatConfig().format;\n-  return [new Buildifier(config), new ClangFormat(config)].filter(\n-      formatter => formatter.isEnabled());\n+  return [\n+    new Prettier(config),\n+    new Buildifier(config),\n+    new ClangFormat(config),\n+  ].filter((formatter) => formatter.isEnabled());\n }\n \n // Rexport symbols used for types elsewhere."
        },
        {
            "sha": "b7ab1b53f83dcf9c8ca9fba03e0987f8e28b451c",
            "filename": "dev-infra/format/formatters/prettier.ts",
            "status": "added",
            "additions": 55,
            "deletions": 0,
            "changes": 55,
            "blob_url": "https://github.com/angular/angular/blob/0140d04ceda986d60d5a4c92b131a5ba7772af96/dev-infra%2Fformat%2Fformatters%2Fprettier.ts",
            "raw_url": "https://github.com/angular/angular/raw/0140d04ceda986d60d5a4c92b131a5ba7772af96/dev-infra%2Fformat%2Fformatters%2Fprettier.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fformatters%2Fprettier.ts?ref=0140d04ceda986d60d5a4c92b131a5ba7772af96",
            "patch": "@@ -0,0 +1,55 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {join} from 'path';\n+import {exec} from 'shelljs';\n+\n+import {error} from '../../utils/console';\n+\n+import {Formatter} from './base-formatter';\n+\n+/**\n+ * Formatter for running prettier against Typescript and Javascript files.\n+ */\n+export class Prettier extends Formatter {\n+  name = 'prettier';\n+\n+  binaryFilePath = join(this.git.baseDir, 'node_modules/.bin/prettier');\n+\n+  defaultFileMatcher = ['**/*.{t,j}s'];\n+\n+  /**\n+   * The configuration path of the pretter config, obtained during construction to prevent needing\n+   * to discover it repeatedly for each execution.\n+   */\n+  private configPath =\n+      this.config['pretter'] ? exec(`${this.binaryFilePath} --find-config-path .`).trim() : '';\n+\n+  actions = {\n+    check: {\n+      commandFlags: `--config ${this.configPath} --check`,\n+      callback:\n+          (_: string, code: number, stdout: string) => {\n+            return code !== 0;\n+          },\n+    },\n+    format: {\n+      commandFlags: `--config ${this.configPath} --write`,\n+      callback:\n+          (file: string, code: number, _: string, stderr: string) => {\n+            if (code !== 0) {\n+              error(`Error running prettier on: ${file}`);\n+              error(stderr);\n+              error();\n+              return true;\n+            }\n+            return false;\n+          },\n+    },\n+  };\n+}"
        },
        {
            "sha": "b0976b3f80845a45ad06311090aadbab721eb679",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 49,
            "deletions": 1,
            "changes": 50,
            "blob_url": "https://github.com/angular/angular/blob/0140d04ceda986d60d5a4c92b131a5ba7772af96/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/0140d04ceda986d60d5a4c92b131a5ba7772af96/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=0140d04ceda986d60d5a4c92b131a5ba7772af96",
            "patch": "@@ -2463,6 +2463,50 @@ class ClangFormat extends Formatter {\n     }\n }\n \n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/**\n+ * Formatter for running prettier against Typescript and Javascript files.\n+ */\n+class Prettier extends Formatter {\n+    constructor() {\n+        super(...arguments);\n+        this.name = 'prettier';\n+        this.binaryFilePath = path.join(this.git.baseDir, 'node_modules/.bin/prettier');\n+        this.defaultFileMatcher = ['**/*.{t,j}s'];\n+        /**\n+         * The configuration path of the pretter config, obtained during construction to prevent needing\n+         * to discover it repeatedly for each execution.\n+         */\n+        this.configPath = this.config['pretter'] ? shelljs.exec(`${this.binaryFilePath} --find-config-path .`).trim() : '';\n+        this.actions = {\n+            check: {\n+                commandFlags: `--config ${this.configPath} --check`,\n+                callback: (_, code, stdout) => {\n+                    return code !== 0;\n+                },\n+            },\n+            format: {\n+                commandFlags: `--config ${this.configPath} --write`,\n+                callback: (file, code, _, stderr) => {\n+                    if (code !== 0) {\n+                        error(`Error running prettier on: ${file}`);\n+                        error(stderr);\n+                        error();\n+                        return true;\n+                    }\n+                    return false;\n+                },\n+            },\n+        };\n+    }\n+}\n+\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -2475,7 +2519,11 @@ class ClangFormat extends Formatter {\n  */\n function getActiveFormatters() {\n     const config = getFormatConfig().format;\n-    return [new Buildifier(config), new ClangFormat(config)].filter(formatter => formatter.isEnabled());\n+    return [\n+        new Prettier(config),\n+        new Buildifier(config),\n+        new ClangFormat(config),\n+    ].filter((formatter) => formatter.isEnabled());\n }\n \n /**"
        },
        {
            "sha": "bef95947e036f13283905c3095478fe8fb00db81",
            "filename": "dev-infra/tmpl-package.json",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/0140d04ceda986d60d5a4c92b131a5ba7772af96/dev-infra%2Ftmpl-package.json",
            "raw_url": "https://github.com/angular/angular/raw/0140d04ceda986d60d5a4c92b131a5ba7772af96/dev-infra%2Ftmpl-package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Ftmpl-package.json?ref=0140d04ceda986d60d5a4c92b131a5ba7772af96",
            "patch": "@@ -46,6 +46,9 @@\n     \"clang-format\": {\n       \"optional\": true\n     },\n+    \"prettier\": {\n+      \"optional\": true\n+    },\n     \"protractor\": {\n       \"optional\": true\n     },"
        }
    ],
    "stats": {
        "total": 118,
        "additions": 114,
        "deletions": 4
    }
}