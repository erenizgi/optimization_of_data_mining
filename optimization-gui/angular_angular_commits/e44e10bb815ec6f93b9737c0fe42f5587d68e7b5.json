{
    "author": "ayazhafiz",
    "message": "feat(compiler): support recovery of malformed property writes (#39103)\n\nThis feature is trivial to support since\n89c5255b8ca59eed27ede9e1fad69857ab0c6f4f has landed.\n\nPR Close #39103",
    "sha": "e44e10bb815ec6f93b9737c0fe42f5587d68e7b5",
    "files": [
        {
            "sha": "751e8533abcb5a74cc52c5655211091baea70472",
            "filename": "packages/compiler/src/expression_parser/parser.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/e44e10bb815ec6f93b9737c0fe42f5587d68e7b5/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts",
            "raw_url": "https://github.com/angular/angular/raw/e44e10bb815ec6f93b9737c0fe42f5587d68e7b5/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts?ref=e44e10bb815ec6f93b9737c0fe42f5587d68e7b5",
            "patch": "@@ -848,7 +848,13 @@ export class _ParseAST {\n   parseAccessMemberOrMethodCall(receiver: AST, isSafe: boolean = false): AST {\n     const start = receiver.span.start;\n     const nameStart = this.inputIndex;\n-    const id = this.expectIdentifierOrKeyword();\n+    const id = this.withContext(ParseContextFlags.Writable, () => {\n+      const id = this.expectIdentifierOrKeyword();\n+      if (id.length === 0) {\n+        this.error(`Expected identifier for property access`, receiver.span.end);\n+      }\n+      return id;\n+    });\n     const nameSpan = this.sourceSpan(nameStart);\n \n     if (this.consumeOptionalCharacter(chars.$LPAREN)) {"
        },
        {
            "sha": "f6786bc267b9e62f2b525634000d6b4962a85b62",
            "filename": "packages/compiler/test/expression_parser/parser_spec.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/e44e10bb815ec6f93b9737c0fe42f5587d68e7b5/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e44e10bb815ec6f93b9737c0fe42f5587d68e7b5/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts?ref=e44e10bb815ec6f93b9737c0fe42f5587d68e7b5",
            "patch": "@@ -146,6 +146,38 @@ describe('parser', () => {\n       });\n     });\n \n+    describe('property write', () => {\n+      it('should parse property writes', () => {\n+        checkAction('a.a = 1 + 2');\n+        checkAction('this.a.a = 1 + 2', 'a.a = 1 + 2');\n+        checkAction('a.a.a = 1 + 2');\n+      });\n+\n+      describe('malformed property writes', () => {\n+        it('should recover on empty rvalues', () => {\n+          checkActionWithError('a.a = ', 'a.a = ', 'Unexpected end of expression');\n+        });\n+\n+        it('should recover on incomplete rvalues', () => {\n+          checkActionWithError('a.a = 1 + ', 'a.a = 1 + ', 'Unexpected end of expression');\n+        });\n+\n+        it('should recover on missing properties', () => {\n+          checkActionWithError(\n+              'a. = 1', 'a. = 1', 'Expected identifier for property access at column 2');\n+        });\n+\n+        it('should error on writes after a property write', () => {\n+          const ast = parseAction('a.a = 1 = 2');\n+          expect(unparse(ast)).toEqual('a.a = 1');\n+          validate(ast);\n+\n+          expect(ast.errors.length).toBe(1);\n+          expect(ast.errors[0].message).toContain('Unexpected token \\'=\\'');\n+        });\n+      });\n+    });\n+\n     describe('method calls', () => {\n       it('should parse method calls', () => {\n         checkAction('fn()');"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 39,
        "deletions": 1
    }
}