{
    "author": "crisbeto",
    "message": "refactor(core): remove deprecated rxjs signature usage in event emitter and make more minifier-friendly (#41450)\n\n* We had a usage of `Observable.subscribe` that uses the deprecated signature with 3 arguments. These changes switch to the non-deprecated version that passes in an `Observer`.\n* Avoids always creating a `complete` callback since it isn't required.\n* We were repeating all of the internal callbacks twice: once for sync and once for async. These changes move them out into variables so that they're more minifier-friendly. The savings aren't huge (~100 bytes minified), but it doesn't add any maintenance effort on our end so I decided to add it.\n\nPR Close #41450",
    "sha": "d6415425875b0ac9800e119d767a02c30cf13f04",
    "files": [
        {
            "sha": "3136af5f9e3d493ff0a3eafe1aaeb58b3a2bda05",
            "filename": "packages/core/src/event_emitter.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 44,
            "changes": 67,
            "blob_url": "https://github.com/angular/angular/blob/d6415425875b0ac9800e119d767a02c30cf13f04/packages%2Fcore%2Fsrc%2Fevent_emitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/d6415425875b0ac9800e119d767a02c30cf13f04/packages%2Fcore%2Fsrc%2Fevent_emitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fevent_emitter.ts?ref=d6415425875b0ac9800e119d767a02c30cf13f04",
            "patch": "@@ -8,7 +8,7 @@\n \n /// <reference types=\"rxjs\" />\n \n-import {Subject, Subscription} from 'rxjs';\n+import {PartialObserver, Subject, Subscription} from 'rxjs';\n \n /**\n  * Use in components with the `@Output` directive to emit custom events\n@@ -115,57 +115,30 @@ class EventEmitter_ extends Subject<any> {\n   }\n \n   subscribe(observerOrNext?: any, error?: any, complete?: any): Subscription {\n-    let schedulerFn: (t: any) => any;\n-    let errorFn = (err: any): any => null;\n-    let completeFn = (): any => null;\n+    let nextFn = observerOrNext;\n+    let errorFn = error || (() => null);\n+    let completeFn = complete;\n \n     if (observerOrNext && typeof observerOrNext === 'object') {\n-      schedulerFn = this.__isAsync ? (value: any) => {\n-        setTimeout(() => observerOrNext.next(value));\n-      } : (value: any) => {\n-        observerOrNext.next(value);\n-      };\n-\n-      if (observerOrNext.error) {\n-        errorFn = this.__isAsync ? (err) => {\n-          setTimeout(() => observerOrNext.error(err));\n-        } : (err) => {\n-          observerOrNext.error(err);\n-        };\n-      }\n+      const observer = observerOrNext as PartialObserver<unknown>;\n+      nextFn = observer.next?.bind(observer);\n+      errorFn = observer.error?.bind(observer);\n+      completeFn = observer.complete?.bind(observer);\n+    }\n \n-      if (observerOrNext.complete) {\n-        completeFn = this.__isAsync ? () => {\n-          setTimeout(() => observerOrNext.complete());\n-        } : () => {\n-          observerOrNext.complete();\n-        };\n-      }\n-    } else {\n-      schedulerFn = this.__isAsync ? (value: any) => {\n-        setTimeout(() => observerOrNext(value));\n-      } : (value: any) => {\n-        observerOrNext(value);\n-      };\n-\n-      if (error) {\n-        errorFn = this.__isAsync ? (err) => {\n-          setTimeout(() => error(err));\n-        } : (err) => {\n-          error(err);\n-        };\n+    if (this.__isAsync) {\n+      errorFn = _wrapInTimeout(errorFn);\n+\n+      if (nextFn) {\n+        nextFn = _wrapInTimeout(nextFn);\n       }\n \n-      if (complete) {\n-        completeFn = this.__isAsync ? () => {\n-          setTimeout(() => complete());\n-        } : () => {\n-          complete();\n-        };\n+      if (completeFn) {\n+        completeFn = _wrapInTimeout(completeFn);\n       }\n     }\n \n-    const sink = super.subscribe(schedulerFn, errorFn, completeFn);\n+    const sink = super.subscribe({next: nextFn, error: errorFn, complete: completeFn});\n \n     if (observerOrNext instanceof Subscription) {\n       observerOrNext.add(sink);\n@@ -175,6 +148,12 @@ class EventEmitter_ extends Subject<any> {\n   }\n }\n \n+function _wrapInTimeout(fn: (value: unknown) => any) {\n+  return (value: unknown) => {\n+    setTimeout(fn, undefined, value);\n+  };\n+}\n+\n /**\n  * @publicApi\n  */"
        },
        {
            "sha": "07bd65c2d5e05eb28a45de5e1fe591a2b8062d2d",
            "filename": "packages/core/test/bundling/forms_reactive/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/d6415425875b0ac9800e119d767a02c30cf13f04/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/d6415425875b0ac9800e119d767a02c30cf13f04/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fbundle.golden_symbols.json?ref=d6415425875b0ac9800e119d767a02c30cf13f04",
            "patch": "@@ -650,6 +650,9 @@\n   {\n     \"name\": \"_testabilityGetter\"\n   },\n+  {\n+    \"name\": \"_wrapInTimeout\"\n+  },\n   {\n     \"name\": \"addComponentLogic\"\n   },"
        },
        {
            "sha": "a5bc8195ca13db61c7b46deafdc2a087e7013b1f",
            "filename": "packages/core/test/bundling/forms_template_driven/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/d6415425875b0ac9800e119d767a02c30cf13f04/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/d6415425875b0ac9800e119d767a02c30cf13f04/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fbundle.golden_symbols.json?ref=d6415425875b0ac9800e119d767a02c30cf13f04",
            "patch": "@@ -638,6 +638,9 @@\n   {\n     \"name\": \"_testabilityGetter\"\n   },\n+  {\n+    \"name\": \"_wrapInTimeout\"\n+  },\n   {\n     \"name\": \"addComponentLogic\"\n   },"
        },
        {
            "sha": "94c93decc9a87c2bb270a34533d4d7240775f581",
            "filename": "packages/core/test/bundling/router/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/d6415425875b0ac9800e119d767a02c30cf13f04/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/d6415425875b0ac9800e119d767a02c30cf13f04/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json?ref=d6415425875b0ac9800e119d767a02c30cf13f04",
            "patch": "@@ -926,6 +926,9 @@\n   {\n     \"name\": \"_testabilityGetter\"\n   },\n+  {\n+    \"name\": \"_wrapInTimeout\"\n+  },\n   {\n     \"name\": \"absoluteRedirect\"\n   },"
        }
    ],
    "stats": {
        "total": 76,
        "additions": 32,
        "deletions": 44
    }
}