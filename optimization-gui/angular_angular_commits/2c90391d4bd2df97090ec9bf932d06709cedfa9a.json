{
    "author": "josephperrott",
    "message": "fix(bazel): update type castings for JSON.parse usage (#40710)\n\nUpdate usages of JSON.parse to be cast as specific types.\n\nPR Close #40710",
    "sha": "2c90391d4bd2df97090ec9bf932d06709cedfa9a",
    "files": [
        {
            "sha": "246a264a870b1a915d32c82b4f45e5b99ffb54f1",
            "filename": "packages/bazel/src/ng_package/packager.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/2c90391d4bd2df97090ec9bf932d06709cedfa9a/packages%2Fbazel%2Fsrc%2Fng_package%2Fpackager.ts",
            "raw_url": "https://github.com/angular/angular/raw/2c90391d4bd2df97090ec9bf932d06709cedfa9a/packages%2Fbazel%2Fsrc%2Fng_package%2Fpackager.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fsrc%2Fng_package%2Fpackager.ts?ref=2c90391d4bd2df97090ec9bf932d06709cedfa9a",
            "patch": "@@ -91,7 +91,7 @@ function main(args: string[]): number {\n   const typeDefinitions = typeDefinitionsArg.split(',').filter(s => !!s);\n   const srcs = srcsArg.split(',').filter(s => !!s);\n   const dataFiles: string[] = dataArg.split(',').filter(s => !!s);\n-  const modulesManifest = JSON.parse(modulesManifestArg);\n+  const modulesManifest = JSON.parse(modulesManifestArg) as Record<string, any>;\n   const dtsBundles: string[] = dtsBundleArg.split(',').filter(s => !!s);\n \n   /**\n@@ -226,7 +226,7 @@ function main(args: string[]): number {\n     let content = fs.readFileSync(src, 'utf-8');\n     // Modify package.json files as necessary for publishing\n     if (path.basename(src) === 'package.json') {\n-      const packageJson = JSON.parse(content);\n+      const packageJson = JSON.parse(content) as {[key: string]: string};\n       content = amendPackageJson(src, packageJson, false);\n \n       const packageName = packageJson['name'];\n@@ -439,7 +439,7 @@ export * from '${srcDirRelative(inputPath, typingsFile.replace(/\\.d\\.tsx?$/, '')\n    * @param typingsPath the typings bundle entrypoint\n    */\n   function rewireMetadata(metadataPath: string, typingsPath: string): string {\n-    const metadata = JSON.parse(fs.readFileSync(metadataPath, 'utf-8'));\n+    const metadata = JSON.parse(fs.readFileSync(metadataPath, 'utf-8')) as {[key: string]: any};\n \n     let typingsRelativePath =\n         normalizeSeparators(path.relative(path.dirname(metadataPath), typingsPath));"
        },
        {
            "sha": "842a00a94d2b238b1ebb9bd0c5bca0d736b82e74",
            "filename": "packages/bazel/src/ngc-wrapped/index.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/2c90391d4bd2df97090ec9bf932d06709cedfa9a/packages%2Fbazel%2Fsrc%2Fngc-wrapped%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2c90391d4bd2df97090ec9bf932d06709cedfa9a/packages%2Fbazel%2Fsrc%2Fngc-wrapped%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fsrc%2Fngc-wrapped%2Findex.ts?ref=2c90391d4bd2df97090ec9bf932d06709cedfa9a",
            "patch": "@@ -377,8 +377,9 @@ export function compile({\n     if (importedFilePath.indexOf('node_modules') >= 0) {\n       const maybeMetadataFile = importedFilePath.replace(EXT, '') + '.metadata.json';\n       if (fs.existsSync(maybeMetadataFile)) {\n-        const moduleName =\n-            JSON.parse(fs.readFileSync(maybeMetadataFile, {encoding: 'utf-8'})).importAs;\n+        const moduleName = (JSON.parse(fs.readFileSync(maybeMetadataFile, {encoding: 'utf-8'})) as {\n+                             importAs: string\n+                           }).importAs;\n         if (moduleName) {\n           return moduleName;\n         }"
        },
        {
            "sha": "5035f4c392252eb2f986c580e8d4f82837837f30",
            "filename": "packages/bazel/test/ng_package/common_package.spec.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 5,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/2c90391d4bd2df97090ec9bf932d06709cedfa9a/packages%2Fbazel%2Ftest%2Fng_package%2Fcommon_package.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2c90391d4bd2df97090ec9bf932d06709cedfa9a/packages%2Fbazel%2Ftest%2Fng_package%2Fcommon_package.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fng_package%2Fcommon_package.spec.ts?ref=2c90391d4bd2df97090ec9bf932d06709cedfa9a",
            "patch": "@@ -104,35 +104,44 @@ describe('@angular/common ng_package', () => {\n \n \n   describe('should have module resolution properties in the package.json file for', () => {\n+    interface PackageJson {\n+      main: string;\n+      es2015: string;\n+      module: string;\n+      typings: string;\n+    }\n     // https://github.com/angular/common-builds/blob/master/package.json\n     it('/', () => {\n-      const actual = JSON.parse(fs.readFileSync('package.json', {encoding: 'utf-8'}));\n+      const actual = JSON.parse(fs.readFileSync('package.json', {encoding: 'utf-8'})) as PackageJson;\n       expect(actual['main']).toEqual('./bundles/common.umd.js');\n     });\n     // https://github.com/angular/common-builds/blob/master/http/package.json\n     it('/http', () => {\n-      const actual = JSON.parse(fs.readFileSync('http/package.json', {encoding: 'utf-8'}));\n+      const actual = JSON.parse(fs.readFileSync('http/package.json', {encoding: 'utf-8'})) as PackageJson;\n       expect(actual['main']).toEqual('../bundles/common-http.umd.js');\n       expect(actual['es2015']).toEqual('../fesm2015/http.js');\n       expect(actual['module']).toEqual('../fesm2015/http.js');\n       expect(actual['typings']).toEqual('./http.d.ts');\n     });\n     // https://github.com/angular/common-builds/blob/master/testing/package.json\n     it('/testing', () => {\n-      const actual = JSON.parse(fs.readFileSync('testing/package.json', {encoding: 'utf-8'}));\n+      const actual =\n+          JSON.parse(fs.readFileSync('testing/package.json', {encoding: 'utf-8'})) as PackageJson;\n       expect(actual['main']).toEqual('../bundles/common-testing.umd.js');\n     });\n     // https://github.com/angular/common-builds/blob/master/http/testing/package.json\n     it('/http/testing', () => {\n-      const actual = JSON.parse(fs.readFileSync('http/testing/package.json', {encoding: 'utf-8'}));\n+      const actual =\n+          JSON.parse(fs.readFileSync('http/testing/package.json', {encoding: 'utf-8'})) as PackageJson;\n       expect(actual['main']).toEqual('../../bundles/common-http-testing.umd.js');\n       expect(actual['es2015']).toEqual('../../fesm2015/http/testing.js');\n       expect(actual['module']).toEqual('../../fesm2015/http/testing.js');\n       expect(actual['typings']).toEqual('./testing.d.ts');\n     });\n     // https://github.com/angular/common-builds/blob/master/upgrade/package.json\n     it('/upgrade', () => {\n-      const actual = JSON.parse(fs.readFileSync('upgrade/package.json', {encoding: 'utf-8'}));\n+      const actual =\n+          JSON.parse(fs.readFileSync('upgrade/package.json', {encoding: 'utf-8'})) as PackageJson;\n       expect(actual['main']).toEqual('../bundles/common-upgrade.umd.js');\n       expect(actual['es2015']).toEqual('../fesm2015/upgrade.js');\n       expect(actual['module']).toEqual('../fesm2015/upgrade.js');"
        },
        {
            "sha": "d86b92c44b496103c5c1fc492917fa3439c138be",
            "filename": "packages/bazel/test/ng_package/core_package.spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/2c90391d4bd2df97090ec9bf932d06709cedfa9a/packages%2Fbazel%2Ftest%2Fng_package%2Fcore_package.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2c90391d4bd2df97090ec9bf932d06709cedfa9a/packages%2Fbazel%2Ftest%2Fng_package%2Fcore_package.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fng_package%2Fcore_package.spec.ts?ref=2c90391d4bd2df97090ec9bf932d06709cedfa9a",
            "patch": "@@ -58,8 +58,11 @@ describe('@angular/core ng_package', () => {\n       });\n \n       it('should contain metadata for ng update', () => {\n+        interface PackageJson {\n+          'ng-update': {packageGroup: string[];};\n+        }\n         expect(shx.cat(packageJson)).not.toContain('NG_UPDATE_PACKAGE_GROUP');\n-        expect(JSON.parse(shx.cat(packageJson))['ng-update']['packageGroup'])\n+        expect((JSON.parse(shx.cat(packageJson)) as PackageJson)['ng-update'].packageGroup)\n             .toContain('@angular/core');\n       });\n     });"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 24,
        "deletions": 11
    }
}