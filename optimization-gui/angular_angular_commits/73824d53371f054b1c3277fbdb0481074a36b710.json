{
    "author": "crisbeto",
    "message": "fix(compiler): not generating update instructions for ng-template inside alternate namespaces (#41669)\n\nWe have a check that determines whether to generate property binding instructions for an `ng-template`. The check looks at whether the tag name is exactly `ng-template`, but the problem is that if the tag is placed in a non-HTML namespace (e.g. `svg`), the tag name will actually be `:namespace:ng-template` and the check will fail.\n\nThese changes resolve the issue by looking at the tag name without the namespace.\n\nFixes #41308.\n\nPR Close #41669",
    "sha": "73824d53371f054b1c3277fbdb0481074a36b710",
    "files": [
        {
            "sha": "cbf1c0874305b62bd233360e304f72d35e40b4d7",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/elements/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 56,
            "deletions": 0,
            "changes": 56,
            "blob_url": "https://github.com/angular/angular/blob/73824d53371f054b1c3277fbdb0481074a36b710/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/73824d53371f054b1c3277fbdb0481074a36b710/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2FGOLDEN_PARTIAL.js?ref=73824d53371f054b1c3277fbdb0481074a36b710",
            "patch": "@@ -38,6 +38,62 @@ export declare class MyModule {\n     static ɵinj: i0.ɵɵInjectorDeclaration<MyModule>;\n }\n \n+/****************************************************************************************************\n+ * PARTIAL FILE: svg_embedded_view.js\n+ ****************************************************************************************************/\n+import { Component, NgModule } from '@angular/core';\n+import * as i0 from \"@angular/core\";\n+export class MyComponent {\n+    constructor() {\n+        this.condition = true;\n+    }\n+}\n+MyComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", ngImport: i0, template: `\n+    <svg>\n+      <ng-template [ngIf]=\"condition\">\n+        <text>Hello</text>\n+      </ng-template>\n+    </svg>\n+  `, isInline: true });\n+i0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyComponent, decorators: [{\n+            type: Component,\n+            args: [{\n+                    selector: 'my-component',\n+                    template: `\n+    <svg>\n+      <ng-template [ngIf]=\"condition\">\n+        <text>Hello</text>\n+      </ng-template>\n+    </svg>\n+  `\n+                }]\n+        }] });\n+export class MyModule {\n+}\n+MyModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\n+MyModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule, declarations: [MyComponent] });\n+MyModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule });\n+i0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule, decorators: [{\n+            type: NgModule,\n+            args: [{ declarations: [MyComponent] }]\n+        }] });\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: svg_embedded_view.d.ts\n+ ****************************************************************************************************/\n+import * as i0 from \"@angular/core\";\n+export declare class MyComponent {\n+    condition: boolean;\n+    static ɵfac: i0.ɵɵFactoryDeclaration<MyComponent, never>;\n+    static ɵcmp: i0.ɵɵComponentDeclaration<MyComponent, \"my-component\", never, {}, {}, never, never>;\n+}\n+export declare class MyModule {\n+    static ɵfac: i0.ɵɵFactoryDeclaration<MyModule, never>;\n+    static ɵmod: i0.ɵɵNgModuleDeclaration<MyModule, [typeof MyComponent], never, never>;\n+    static ɵinj: i0.ɵɵInjectorDeclaration<MyModule>;\n+}\n+\n /****************************************************************************************************\n  * PARTIAL FILE: mathml.js\n  ****************************************************************************************************/"
        },
        {
            "sha": "8c57978716e208aa60865a673cca52499ae1d018",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/elements/TEST_CASES.json",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/73824d53371f054b1c3277fbdb0481074a36b710/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2FTEST_CASES.json",
            "raw_url": "https://github.com/angular/angular/raw/73824d53371f054b1c3277fbdb0481074a36b710/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2FTEST_CASES.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2FTEST_CASES.json?ref=73824d53371f054b1c3277fbdb0481074a36b710",
            "patch": "@@ -27,6 +27,23 @@\n         }\n       ]\n     },\n+    {\n+      \"description\": \"should handle SVG with an embedded ng-template\",\n+      \"inputFiles\": [\n+        \"svg_embedded_view.ts\"\n+      ],\n+      \"expectations\": [\n+        {\n+          \"files\": [\n+            {\n+              \"expected\": \"svg_embedded_view_template.js\",\n+              \"generated\": \"svg_embedded_view.js\"\n+            }\n+          ],\n+          \"failureMessage\": \"Incorrect template.\"\n+        }\n+      ]\n+    },\n     {\n       \"description\": \"should handle MathML\",\n       \"inputFiles\": ["
        },
        {
            "sha": "535fd1cc29744c530f699c32431a56b425b9c065",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/elements/svg_embedded_view.ts",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/73824d53371f054b1c3277fbdb0481074a36b710/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2Fsvg_embedded_view.ts",
            "raw_url": "https://github.com/angular/angular/raw/73824d53371f054b1c3277fbdb0481074a36b710/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2Fsvg_embedded_view.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2Fsvg_embedded_view.ts?ref=73824d53371f054b1c3277fbdb0481074a36b710",
            "patch": "@@ -0,0 +1,19 @@\n+import {Component, NgModule} from '@angular/core';\n+\n+@Component({\n+  selector: 'my-component',\n+  template: `\n+    <svg>\n+      <ng-template [ngIf]=\"condition\">\n+        <text>Hello</text>\n+      </ng-template>\n+    </svg>\n+  `\n+})\n+export class MyComponent {\n+  condition = true;\n+}\n+\n+@NgModule({declarations: [MyComponent]})\n+export class MyModule {\n+}"
        },
        {
            "sha": "faa4c684a1a3880a62ddf25ff152cede6bb139d2",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/elements/svg_embedded_view_template.js",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/73824d53371f054b1c3277fbdb0481074a36b710/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2Fsvg_embedded_view_template.js",
            "raw_url": "https://github.com/angular/angular/raw/73824d53371f054b1c3277fbdb0481074a36b710/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2Fsvg_embedded_view_template.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2Fsvg_embedded_view_template.js?ref=73824d53371f054b1c3277fbdb0481074a36b710",
            "patch": "@@ -0,0 +1,24 @@\n+function MyComponent__svg_ng_template_1_Template(rf, ctx) {\n+  if (rf & 1) {\n+    i0.ɵɵnamespaceSVG();\n+    i0.ɵɵelementStart(0, \"text\");\n+    i0.ɵɵtext(1, \"Hello\");\n+    i0.ɵɵelementEnd();\n+  }\n+}\n+…\n+\n+// NOTE: AttributeMarker.Bindings = 3\n+consts: [[3, \"ngIf\"]],\n+template: function MyComponent_Template(rf, ctx) {\n+  if (rf & 1) {\n+    i0.ɵɵnamespaceSVG();\n+    i0.ɵɵelementStart(0, \"svg\");\n+    i0.ɵɵtemplate(1, MyComponent__svg_ng_template_1_Template, 2, 0, \"ng-template\", 0);\n+    i0.ɵɵelementEnd();\n+  }\n+  if (rf & 2) {\n+    i0.ɵɵadvance(1);\n+    i0.ɵɵproperty(\"ngIf\", ctx.condition);\n+  }\n+}"
        },
        {
            "sha": "686b93ceeb9626b96872ea27ef47c2c6ffbe1bf8",
            "filename": "packages/compiler/src/render3/view/template.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/73824d53371f054b1c3277fbdb0481074a36b710/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts",
            "raw_url": "https://github.com/angular/angular/raw/73824d53371f054b1c3277fbdb0481074a36b710/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts?ref=73824d53371f054b1c3277fbdb0481074a36b710",
            "patch": "@@ -875,17 +875,17 @@ export class TemplateDefinitionBuilder implements t.Visitor<void>, LocalResolver\n       this.i18n.appendTemplate(template.i18n!, templateIndex);\n     }\n \n-    const tagName = sanitizeIdentifier(template.tagName || '');\n-    const contextName = `${this.contextName}${tagName ? '_' + tagName : ''}_${templateIndex}`;\n+    const tagNameWithoutNamespace =\n+        template.tagName ? splitNsName(template.tagName)[1] : template.tagName;\n+    const contextName = `${this.contextName}${\n+        template.tagName ? '_' + sanitizeIdentifier(template.tagName) : ''}_${templateIndex}`;\n     const templateName = `${contextName}_Template`;\n-\n     const parameters: o.Expression[] = [\n       o.literal(templateIndex),\n       o.variable(templateName),\n-\n       // We don't care about the tag's namespace here, because we infer\n       // it based on the parent nodes inside the template instruction.\n-      o.literal(template.tagName ? splitNsName(template.tagName)[1] : template.tagName),\n+      o.literal(tagNameWithoutNamespace),\n     ];\n \n     // find directives matching on a given <ng-template> node\n@@ -937,7 +937,7 @@ export class TemplateDefinitionBuilder implements t.Visitor<void>, LocalResolver\n     this.templatePropertyBindings(templateIndex, template.templateAttrs);\n \n     // Only add normal input/output binding instructions on explicit <ng-template> elements.\n-    if (template.tagName === NG_TEMPLATE_TAG_NAME) {\n+    if (tagNameWithoutNamespace === NG_TEMPLATE_TAG_NAME) {\n       const [i18nInputs, inputs] =\n           partitionArray<t.BoundAttribute, t.BoundAttribute>(template.inputs, hasI18nMeta);\n "
        },
        {
            "sha": "e01aa0ab3685925f7ca702211214ae5dffe0bc44",
            "filename": "packages/core/test/acceptance/integration_spec.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/73824d53371f054b1c3277fbdb0481074a36b710/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/73824d53371f054b1c3277fbdb0481074a36b710/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts?ref=73824d53371f054b1c3277fbdb0481074a36b710",
            "patch": "@@ -1990,6 +1990,27 @@ describe('acceptance integration tests', () => {\n     expect(logs).toEqual(['Baggins']);\n   });\n \n+  it('should render SVG nodes placed inside ng-template', () => {\n+    @Component({\n+      template: `\n+        <svg>\n+          <ng-template [ngIf]=\"condition\">\n+            <text>Hello</text>\n+          </ng-template>\n+        </svg>\n+      `,\n+    })\n+    class MyComp {\n+      condition = true;\n+    }\n+\n+    TestBed.configureTestingModule({declarations: [MyComp], imports: [CommonModule]});\n+    const fixture = TestBed.createComponent(MyComp);\n+    fixture.detectChanges();\n+\n+    expect(fixture.nativeElement.innerHTML).toContain('<text>Hello</text>');\n+  });\n+\n   describe('tView.firstUpdatePass', () => {\n     function isFirstUpdatePass() {\n       const lView = getLView();"
        }
    ],
    "stats": {
        "total": 149,
        "additions": 143,
        "deletions": 6
    }
}