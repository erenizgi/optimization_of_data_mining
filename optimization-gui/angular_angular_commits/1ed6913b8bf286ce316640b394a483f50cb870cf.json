{
    "author": "josephperrott",
    "message": "feat(dev-infra): Add support for local user ng-dev configuration (#38701)\n\nCreate a utility for loading a local user configuration object to describe\nlocal configuration values, such as skipping the commit message wizard.\n\nPR Close #38701",
    "sha": "1ed6913b8bf286ce316640b394a483f50cb870cf",
    "files": [
        {
            "sha": "0926825d24770b8e0718f629aac8e8ae0d4848b5",
            "filename": ".gitignore",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/1ed6913b8bf286ce316640b394a483f50cb870cf/.gitignore",
            "raw_url": "https://github.com/angular/angular/raw/1ed6913b8bf286ce316640b394a483f50cb870cf/.gitignore",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.gitignore?ref=1ed6913b8bf286ce316640b394a483f50cb870cf",
            "patch": "@@ -40,6 +40,9 @@ yarn-error.log\n # User specific bazel settings\n .bazelrc.user\n \n+# User specific ng-dev settings\n+.ng-dev.user*\n+\n .notes.md\n baseline.json\n "
        },
        {
            "sha": "8b8dff92ba727e4f501a5d1e8633f675fc16afc5",
            "filename": "dev-infra/utils/config.ts",
            "status": "modified",
            "additions": 41,
            "deletions": 4,
            "changes": 45,
            "blob_url": "https://github.com/angular/angular/blob/1ed6913b8bf286ce316640b394a483f50cb870cf/dev-infra%2Futils%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/1ed6913b8bf286ce316640b394a483f50cb870cf/dev-infra%2Futils%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fconfig.ts?ref=1ed6913b8bf286ce316640b394a483f50cb870cf",
            "patch": "@@ -9,7 +9,7 @@\n import {existsSync} from 'fs';\n import {dirname, join} from 'path';\n \n-import {error} from './console';\n+import {debug, error} from './console';\n import {exec} from './shelljs';\n import {isTsNodeAvailable} from './ts-node';\n \n@@ -51,6 +51,15 @@ const CONFIG_FILE_PATH = '.ng-dev/config';\n /** The configuration for ng-dev. */\n let CONFIG: {}|null = null;\n \n+/**\n+ * The filename expected for local user config, without the file extension to allow a typescript,\n+ * javascript or json file to be used.\n+ */\n+const USER_CONFIG_FILE_PATH = '.ng-dev.user';\n+\n+/** The local user configuration for ng-dev. */\n+let USER_CONFIG: {[key: string]: any};\n+\n /**\n  * Get the configuration from the file system, returning the already loaded\n  * copy if it is defined.\n@@ -86,8 +95,11 @@ function validateCommonConfig(config: Partial<NgDevConfig>) {\n   return config as NgDevConfig;\n }\n \n-/** Resolves and reads the specified configuration file. */\n-function readConfigFile(configPath: string): object {\n+/**\n+ * Resolves and reads the specified configuration file, optionally returning an empty object if the\n+ * configuration file cannot be read.\n+ */\n+function readConfigFile(configPath: string, returnEmptyObjectOnError = false): object {\n   // If the the `.ts` extension has not been set up already, and a TypeScript based\n   // version of the given configuration seems to exist, set up `ts-node` if available.\n   if (require.extensions['.ts'] === undefined && existsSync(`${configPath}.ts`) &&\n@@ -103,7 +115,12 @@ function readConfigFile(configPath: string): object {\n   try {\n     return require(configPath);\n   } catch (e) {\n-    error('Could not read configuration file.');\n+    if (returnEmptyObjectOnError) {\n+      debug(`Could not read configuration file at ${configPath}, returning empty object instead.`);\n+      debug(e);\n+      return {};\n+    }\n+    error(`Could not read configuration file at ${configPath}.'`);\n     error(e);\n     process.exit(1);\n   }\n@@ -135,3 +152,23 @@ export function getRepoBaseDir() {\n   }\n   return baseRepoDir.trim();\n }\n+\n+/**\n+ * Get the local user configuration from the file system, returning the already loaded copy if it is\n+ * defined.\n+ *\n+ * @returns The user configuration object, or an empty object if no user configuration file is\n+ * present.  The object is a untyped object as there are no required user configurations.\n+ */\n+export function getUserConfig() {\n+  // If the global config is not defined, load it from the file system.\n+  if (USER_CONFIG === undefined) {\n+    // The full path to the configuration file.\n+    const configPath = join(getRepoBaseDir(), USER_CONFIG_FILE_PATH);\n+    // Set the global config object.\n+    USER_CONFIG = readConfigFile(configPath, true);\n+  }\n+  // Return a clone of the global config to ensure that a new instance of the config is returned\n+  // each time, preventing unexpected effects of modifications to the config object.\n+  return {...USER_CONFIG};\n+}"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 44,
        "deletions": 4
    }
}