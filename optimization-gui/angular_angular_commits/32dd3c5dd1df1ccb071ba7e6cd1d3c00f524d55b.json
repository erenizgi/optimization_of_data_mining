{
    "author": "AndrewKushnir",
    "message": "refactor(core): co-locate read/write patched data functions (#41097)\n\nThis commit refactors Ivy runtime code to move `readPatchedData` and `attachPatchedData` functions to a single\nlocation for better maintainability and to make it easier to do further changes if needed.  The `readPatchedLView`\nfunction was also moved to the same location (since it's a layer on top of the `readPatchedData` function).\n\nPR Close #41097",
    "sha": "32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b",
    "files": [
        {
            "sha": "f2ba3baee497dd8e9843f2812e99ca00d6de2a24",
            "filename": "packages/core/src/render3/component.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fcomponent.ts?ref=32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b",
            "patch": "@@ -12,7 +12,9 @@ import {Injector} from '../di/injector';\n import {Type} from '../interface/type';\n import {Sanitizer} from '../sanitization/sanitizer';\n import {assertDefined, assertIndexInRange} from '../util/assert';\n+\n import {assertComponentType} from './assert';\n+import {readPatchedLView} from './context_discovery';\n import {getComponentDef} from './definition';\n import {diPublicInInjector, getOrCreateNodeInjectorForNode} from './di';\n import {throwProviderNotFoundError} from './errors_di';\n@@ -31,7 +33,6 @@ import {setUpAttributes} from './util/attrs_utils';\n import {publishDefaultGlobalUtils} from './util/global_utils';\n import {defaultScheduler} from './util/misc_utils';\n import {getRootContext} from './util/view_traversal_utils';\n-import {readPatchedLView} from './util/view_utils';\n \n \n "
        },
        {
            "sha": "43f4207eb7ad22107db7bfecdbc983eceb014435",
            "filename": "packages/core/src/render3/context_discovery.ts",
            "status": "modified",
            "additions": 26,
            "deletions": 3,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts",
            "raw_url": "https://github.com/angular/angular/raw/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts?ref=32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b",
            "patch": "@@ -7,14 +7,14 @@\n  */\n import '../util/ng_dev_mode';\n \n-import {assertDomNode} from '../util/assert';\n+import {assertDefined, assertDomNode} from '../util/assert';\n \n import {EMPTY_ARRAY} from '../util/empty';\n-import {LContext, MONKEY_PATCH_KEY_NAME} from './interfaces/context';\n+import {LContext} from './interfaces/context';\n import {TNode, TNodeFlags} from './interfaces/node';\n import {RElement, RNode} from './interfaces/renderer_dom';\n import {CONTEXT, HEADER_OFFSET, HOST, LView, TVIEW} from './interfaces/view';\n-import {getComponentLViewByIndex, readPatchedData, unwrapRNode} from './util/view_utils';\n+import {getComponentLViewByIndex, unwrapRNode} from './util/view_utils';\n \n \n \n@@ -170,14 +170,37 @@ export function getComponentViewByInstance(componentInstance: {}): LView {\n   return view;\n }\n \n+/**\n+ * This property will be monkey-patched on elements, components and directives.\n+ */\n+const MONKEY_PATCH_KEY_NAME = '__ngContext__';\n+\n /**\n  * Assigns the given data to the given target (which could be a component,\n  * directive or DOM node instance) using monkey-patching.\n  */\n export function attachPatchData(target: any, data: LView|LContext) {\n+  ngDevMode && assertDefined(target, 'Target expected');\n   target[MONKEY_PATCH_KEY_NAME] = data;\n }\n \n+/**\n+ * Returns the monkey-patch value data present on the target (which could be\n+ * a component, directive or a DOM node).\n+ */\n+export function readPatchedData(target: any): LView|LContext|null {\n+  ngDevMode && assertDefined(target, 'Target expected');\n+  return target[MONKEY_PATCH_KEY_NAME] || null;\n+}\n+\n+export function readPatchedLView(target: any): LView|null {\n+  const value = readPatchedData(target);\n+  if (value) {\n+    return Array.isArray(value) ? value : (value as LContext).lView;\n+  }\n+  return null;\n+}\n+\n export function isComponentInstance(instance: any): boolean {\n   return instance && instance.constructor && instance.constructor.ɵcmp;\n }"
        },
        {
            "sha": "6bf02d590ac38916627f781d946bf27c07724f39",
            "filename": "packages/core/src/render3/instructions/shared.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "raw_url": "https://github.com/angular/angular/raw/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts?ref=32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b",
            "patch": "@@ -19,7 +19,7 @@ import {initNgDevMode} from '../../util/ng_dev_mode';\n import {normalizeDebugBindingName, normalizeDebugBindingValue} from '../../util/ng_reflect';\n import {stringify} from '../../util/stringify';\n import {assertFirstCreatePass, assertFirstUpdatePass, assertLContainer, assertLView, assertTNodeForLView, assertTNodeForTView} from '../assert';\n-import {attachPatchData} from '../context_discovery';\n+import {attachPatchData, readPatchedLView} from '../context_discovery';\n import {getFactoryDef} from '../definition_factory';\n import {diPublicInInjector, getNodeInjectable, getOrCreateNodeInjectorForNode} from '../di';\n import {formatRuntimeError, RuntimeError, RuntimeErrorCode} from '../error_code';\n@@ -43,7 +43,7 @@ import {isAnimationProp, mergeHostAttrs} from '../util/attrs_utils';\n import {INTERPOLATION_DELIMITER} from '../util/misc_utils';\n import {renderStringify, stringifyForError} from '../util/stringify_utils';\n import {getFirstLContainer, getLViewParent, getNextLContainer} from '../util/view_traversal_utils';\n-import {getComponentLViewByIndex, getNativeByIndex, getNativeByTNode, isCreationMode, readPatchedLView, resetPreOrderHookFlags, unwrapLView, updateTransplantedViewCount, viewAttachedToChangeDetector} from '../util/view_utils';\n+import {getComponentLViewByIndex, getNativeByIndex, getNativeByTNode, isCreationMode, resetPreOrderHookFlags, unwrapLView, updateTransplantedViewCount, viewAttachedToChangeDetector} from '../util/view_utils';\n \n import {selectIndexInternal} from './advance';\n import {attachLContainerDebug, attachLViewDebug, cloneToLViewFromTViewBlueprint, cloneToTViewData, LCleanup, LViewBlueprint, MatchesArray, TCleanup, TNodeDebug, TNodeInitialInputs, TNodeLocalNames, TViewComponents, TViewConstructor} from './lview_debug';"
        },
        {
            "sha": "6f78e268918d53ab81a25be3eaaa5639f7006b9d",
            "filename": "packages/core/src/render3/interfaces/context.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fcontext.ts",
            "raw_url": "https://github.com/angular/angular/raw/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fcontext.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fcontext.ts?ref=32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b",
            "patch": "@@ -10,10 +10,6 @@\n import {RNode} from './renderer_dom';\n import {LView} from './view';\n \n-/**\n- * This property will be monkey-patched on elements, components and directives\n- */\n-export const MONKEY_PATCH_KEY_NAME = '__ngContext__';\n \n /**\n  * The internal view context which is specific to a given DOM element, directive or"
        },
        {
            "sha": "64bf2ba85d2d769ff6d644505848010187a8aa46",
            "filename": "packages/core/src/render3/util/view_traversal_utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fview_traversal_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fview_traversal_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fview_traversal_utils.ts?ref=32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b",
            "patch": "@@ -8,12 +8,11 @@\n \n import {assertDefined} from '../../util/assert';\n import {assertLView} from '../assert';\n+import {readPatchedLView} from '../context_discovery';\n import {LContainer} from '../interfaces/container';\n import {isLContainer, isLView} from '../interfaces/type_checks';\n import {CHILD_HEAD, CONTEXT, FLAGS, LView, LViewFlags, NEXT, PARENT, RootContext} from '../interfaces/view';\n \n-import {readPatchedLView} from './view_utils';\n-\n \n /**\n  * Gets the parent LView of the passed LView, if the PARENT is an LContainer, will get the parent of"
        },
        {
            "sha": "0487d4d2565a3b0711a2b279c4ebab8dc80ab5fe",
            "filename": "packages/core/src/render3/util/view_utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 20,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fview_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fview_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fview_utils.ts?ref=32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b",
            "patch": "@@ -6,10 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {assertDefined, assertDomNode, assertGreaterThan, assertGreaterThanOrEqual, assertIndexInRange, assertLessThan} from '../../util/assert';\n+import {assertDomNode, assertGreaterThan, assertGreaterThanOrEqual, assertIndexInRange, assertLessThan} from '../../util/assert';\n import {assertTNode, assertTNodeForLView} from '../assert';\n import {LContainer, TYPE} from '../interfaces/container';\n-import {LContext, MONKEY_PATCH_KEY_NAME} from '../interfaces/context';\n import {TConstants, TNode} from '../interfaces/node';\n import {isProceduralRenderer} from '../interfaces/renderer';\n import {RNode} from '../interfaces/renderer_dom';\n@@ -143,24 +142,6 @@ export function getComponentLViewByIndex(nodeIndex: number, hostView: LView): LV\n   return lView;\n }\n \n-\n-/**\n- * Returns the monkey-patch value data present on the target (which could be\n- * a component, directive or a DOM node).\n- */\n-export function readPatchedData(target: any): LView|LContext|null {\n-  ngDevMode && assertDefined(target, 'Target expected');\n-  return target[MONKEY_PATCH_KEY_NAME] || null;\n-}\n-\n-export function readPatchedLView(target: any): LView|null {\n-  const value = readPatchedData(target);\n-  if (value) {\n-    return Array.isArray(value) ? value : (value as LContext).lView;\n-  }\n-  return null;\n-}\n-\n /** Checks whether a given view is in creation mode */\n export function isCreationMode(view: LView): boolean {\n   return (view[FLAGS] & LViewFlags.CreationMode) === LViewFlags.CreationMode;"
        },
        {
            "sha": "56219550e37d8ae2ba67cc91bf629f1883374bce",
            "filename": "packages/core/test/render3/instructions/lview_debug_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Flview_debug_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Flview_debug_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Flview_debug_spec.ts?ref=32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b",
            "patch": "@@ -8,10 +8,10 @@\n \n import {Component, Injectable, ɵɵdefineComponent, ɵɵdefineDirective, ɵɵdirectiveInject, ɵɵProvidersFeature} from '@angular/core/src/core';\n import {ComponentDef, DirectiveDef} from '@angular/core/src/render3';\n+import {readPatchedData} from '@angular/core/src/render3/context_discovery';\n import {ɵɵelement, ɵɵelementEnd, ɵɵelementStart} from '@angular/core/src/render3/instructions/element';\n import {TNodeDebug} from '@angular/core/src/render3/instructions/lview_debug';\n import {createTNode, createTView} from '@angular/core/src/render3/instructions/shared';\n-import {MONKEY_PATCH_KEY_NAME} from '@angular/core/src/render3/interfaces/context';\n import {TNodeType} from '@angular/core/src/render3/interfaces/node';\n import {LView, LViewDebug, TView, TViewType} from '@angular/core/src/render3/interfaces/view';\n import {enterView, leaveView} from '@angular/core/src/render3/state';\n@@ -278,7 +278,7 @@ describe('lView_debug', () => {\n       const parentFixture = TestBed.createComponent(ParentComponent);\n       const parentHostElement = parentFixture.nativeElement as HTMLElement;\n       const childElement = parentHostElement.querySelector('child')! as HTMLElement;\n-      if (!(childElement as any)[MONKEY_PATCH_KEY_NAME]) {\n+      if (!readPatchedData(childElement)) {\n         // In these browsers:\n         //  - Chrome Mobile 72.0.3626 (Android 0.0.0)\n         //  - IE 11.0.0 (Windows 8.1.0.0)"
        },
        {
            "sha": "fdd830d44b84266e2eff0f30f24aab87118232a2",
            "filename": "packages/core/test/render3/integration_spec.ts",
            "status": "modified",
            "additions": 43,
            "deletions": 44,
            "changes": 87,
            "blob_url": "https://github.com/angular/angular/blob/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Ftest%2Frender3%2Fintegration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b/packages%2Fcore%2Ftest%2Frender3%2Fintegration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fintegration_spec.ts?ref=32dd3c5dd1df1ccb071ba7e6cd1d3c00f524d55b",
            "patch": "@@ -8,10 +8,9 @@\n \n import {RElement} from '@angular/core/src/render3/interfaces/renderer_dom';\n import {RendererType2} from '../../src/render/api_flags';\n-import {getLContext} from '../../src/render3/context_discovery';\n+import {getLContext, readPatchedData} from '../../src/render3/context_discovery';\n import {AttributeMarker, ɵɵadvance, ɵɵattribute, ɵɵdefineComponent, ɵɵdefineDirective, ɵɵhostProperty, ɵɵproperty} from '../../src/render3/index';\n import {ɵɵelement, ɵɵelementEnd, ɵɵelementStart, ɵɵprojection, ɵɵprojectionDef, ɵɵtemplate, ɵɵtext} from '../../src/render3/instructions/all';\n-import {MONKEY_PATCH_KEY_NAME} from '../../src/render3/interfaces/context';\n import {RenderFlags} from '../../src/render3/interfaces/definition';\n import {domRendererFactory3, Renderer3, RendererFactory3} from '../../src/render3/interfaces/renderer';\n import {CONTEXT, HEADER_OFFSET} from '../../src/render3/interfaces/view';\n@@ -269,8 +268,8 @@ describe('element discovery', () => {\n     const parent = host.querySelector('div') as any;\n     const child = host.querySelector('p') as any;\n \n-    expect(parent[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n-    expect(child[MONKEY_PATCH_KEY_NAME]).toBeFalsy();\n+    expect(readPatchedData(parent)).toBeTruthy();\n+    expect(readPatchedData(child)).toBeFalsy();\n   });\n \n   it('should only monkey-patch immediate child nodes in a sub component', () => {\n@@ -317,12 +316,12 @@ describe('element discovery', () => {\n \n     const host = fixture.hostElement;\n     const child = host.querySelector('child-comp') as any;\n-    expect(child[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n+    expect(readPatchedData(child)).toBeTruthy();\n \n     const [kid1, kid2, kid3] = Array.from(host.querySelectorAll('child-comp > *'));\n-    expect(kid1[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n-    expect(kid2[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n-    expect(kid3[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n+    expect(readPatchedData(kid1)).toBeTruthy();\n+    expect(readPatchedData(kid2)).toBeTruthy();\n+    expect(readPatchedData(kid3)).toBeTruthy();\n   });\n \n   it('should only monkey-patch immediate child nodes in an embedded template container', () => {\n@@ -364,16 +363,16 @@ describe('element discovery', () => {\n     const [section, div1, p, div2] = Array.from(host.querySelectorAll('section, div, p'));\n \n     expect(section.nodeName.toLowerCase()).toBe('section');\n-    expect(section[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n+    expect(readPatchedData(section)).toBeTruthy();\n \n     expect(div1.nodeName.toLowerCase()).toBe('div');\n-    expect(div1[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n+    expect(readPatchedData(div1)).toBeTruthy();\n \n     expect(p.nodeName.toLowerCase()).toBe('p');\n-    expect(p[MONKEY_PATCH_KEY_NAME]).toBeFalsy();\n+    expect(readPatchedData(p)).toBeFalsy();\n \n     expect(div2.nodeName.toLowerCase()).toBe('div');\n-    expect(div2[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n+    expect(readPatchedData(div2)).toBeTruthy();\n   });\n \n   it('should return a context object from a given dom node', () => {\n@@ -436,11 +435,11 @@ describe('element discovery', () => {\n     fixture.update();\n \n     const section = fixture.hostElement.querySelector('section')! as any;\n-    const result1 = section[MONKEY_PATCH_KEY_NAME];\n+    const result1 = readPatchedData(section);\n     expect(Array.isArray(result1)).toBeTruthy();\n \n     const context = getLContext(section)!;\n-    const result2 = section[MONKEY_PATCH_KEY_NAME];\n+    const result2 = readPatchedData(section) as any;\n     expect(Array.isArray(result2)).toBeFalsy();\n \n     expect(result2).toBe(context);\n@@ -471,14 +470,14 @@ describe('element discovery', () => {\n        fixture.update();\n \n        const section = fixture.hostElement.querySelector('section')! as any;\n-       expect(section[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n+       expect(readPatchedData(section)).toBeTruthy();\n \n        const p = fixture.hostElement.querySelector('p')! as any;\n-       expect(p[MONKEY_PATCH_KEY_NAME]).toBeFalsy();\n+       expect(readPatchedData(p)).toBeFalsy();\n \n        const pContext = getLContext(p)!;\n        expect(pContext.native).toBe(p);\n-       expect(p[MONKEY_PATCH_KEY_NAME]).toBe(pContext);\n+       expect(readPatchedData(p)).toBe(pContext);\n      });\n \n   it('should be able to pull in element context data even if the element is decorated using styling',\n@@ -503,14 +502,14 @@ describe('element discovery', () => {\n        fixture.update();\n \n        const section = fixture.hostElement.querySelector('section')! as any;\n-       const result1 = section[MONKEY_PATCH_KEY_NAME];\n+       const result1 = readPatchedData(section) as any;\n        expect(Array.isArray(result1)).toBeTruthy();\n \n        const elementResult = result1[HEADER_OFFSET];  // first element\n        expect(elementResult).toBe(section);\n \n        const context = getLContext(section)!;\n-       const result2 = section[MONKEY_PATCH_KEY_NAME];\n+       const result2 = readPatchedData(section);\n        expect(Array.isArray(result2)).toBeFalsy();\n \n        expect(context.native).toBe(section);\n@@ -596,14 +595,14 @@ describe('element discovery', () => {\n        expect(projectorComp.children).toContain(header);\n        expect(h1.children).toContain(p);\n \n-       expect(textNode[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n-       expect(section[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n-       expect(projectorComp[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n-       expect(header[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n-       expect(h1[MONKEY_PATCH_KEY_NAME]).toBeFalsy();\n-       expect(p[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n-       expect(pText[MONKEY_PATCH_KEY_NAME]).toBeFalsy();\n-       expect(projectedTextNode[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n+       expect(readPatchedData(textNode)).toBeTruthy();\n+       expect(readPatchedData(section)).toBeTruthy();\n+       expect(readPatchedData(projectorComp)).toBeTruthy();\n+       expect(readPatchedData(header)).toBeTruthy();\n+       expect(readPatchedData(h1)).toBeFalsy();\n+       expect(readPatchedData(p)).toBeTruthy();\n+       expect(readPatchedData(pText)).toBeFalsy();\n+       expect(readPatchedData(projectedTextNode)).toBeTruthy();\n \n        const parentContext = getLContext(section)!;\n        const shadowContext = getLContext(header)!;\n@@ -676,10 +675,10 @@ describe('element discovery', () => {\n     const hostElm = fixture.hostElement;\n     const component = fixture.component;\n \n-    const componentLView = (component as any)[MONKEY_PATCH_KEY_NAME];\n+    const componentLView = readPatchedData(component);\n     expect(Array.isArray(componentLView)).toBeTruthy();\n \n-    const hostLView = (hostElm as any)[MONKEY_PATCH_KEY_NAME];\n+    const hostLView = readPatchedData(hostElm) as any;\n     expect(hostLView).toBe(componentLView);\n \n     const context1 = getLContext(hostElm)!;\n@@ -745,9 +744,9 @@ describe('element discovery', () => {\n        expect(componentView).toContain(myDir2Instance);\n        expect(componentView).toContain(myDir3Instance);\n \n-       expect(Array.isArray((myDir1Instance as any)[MONKEY_PATCH_KEY_NAME])).toBeTruthy();\n-       expect(Array.isArray((myDir2Instance as any)[MONKEY_PATCH_KEY_NAME])).toBeTruthy();\n-       expect(Array.isArray((myDir3Instance as any)[MONKEY_PATCH_KEY_NAME])).toBeTruthy();\n+       expect(Array.isArray(readPatchedData(myDir1Instance))).toBeTruthy();\n+       expect(Array.isArray(readPatchedData(myDir2Instance))).toBeTruthy();\n+       expect(Array.isArray(readPatchedData(myDir3Instance))).toBeTruthy();\n \n        const d1Context = getLContext(myDir1Instance)!;\n        const d2Context = getLContext(myDir2Instance)!;\n@@ -757,9 +756,9 @@ describe('element discovery', () => {\n        expect(d2Context.lView).toEqual(componentView);\n        expect(d3Context.lView).toEqual(componentView);\n \n-       expect((myDir1Instance as any)[MONKEY_PATCH_KEY_NAME]).toBe(d1Context);\n-       expect((myDir2Instance as any)[MONKEY_PATCH_KEY_NAME]).toBe(d2Context);\n-       expect((myDir3Instance as any)[MONKEY_PATCH_KEY_NAME]).toBe(d3Context);\n+       expect(readPatchedData(myDir1Instance)).toBe(d1Context);\n+       expect(readPatchedData(myDir2Instance)).toBe(d2Context);\n+       expect(readPatchedData(myDir3Instance)).toBe(d3Context);\n \n        expect(d1Context.nodeIndex).toEqual(HEADER_OFFSET);\n        expect(d1Context.native).toBe(div1);\n@@ -829,11 +828,11 @@ describe('element discovery', () => {\n \n        const childCompHostElm = fixture.hostElement.querySelector('child-comp')! as any;\n \n-       const lView = childCompHostElm[MONKEY_PATCH_KEY_NAME];\n+       const lView = readPatchedData(childCompHostElm);\n        expect(Array.isArray(lView)).toBeTruthy();\n-       expect((myDir1Instance as any)[MONKEY_PATCH_KEY_NAME]).toBe(lView);\n-       expect((myDir2Instance as any)[MONKEY_PATCH_KEY_NAME]).toBe(lView);\n-       expect((childComponentInstance as any)[MONKEY_PATCH_KEY_NAME]).toBe(lView);\n+       expect(readPatchedData(myDir1Instance)).toBe(lView);\n+       expect(readPatchedData(myDir2Instance)).toBe(lView);\n+       expect(readPatchedData(childComponentInstance)).toBe(lView);\n \n        const childNodeContext = getLContext(childCompHostElm)!;\n        expect(childNodeContext.component).toBeFalsy();\n@@ -864,7 +863,7 @@ describe('element discovery', () => {\n        assertMonkeyPatchValueIsLView(childComponentInstance, false);\n \n        function assertMonkeyPatchValueIsLView(value: any, yesOrNo = true) {\n-         expect(Array.isArray((value as any)[MONKEY_PATCH_KEY_NAME])).toBe(yesOrNo);\n+         expect(Array.isArray(readPatchedData(value))).toBe(yesOrNo);\n        }\n      });\n \n@@ -913,18 +912,18 @@ describe('element discovery', () => {\n \n        const host = fixture.hostElement;\n        const child = host.querySelector('child-comp') as any;\n-       expect(child[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n+       expect(readPatchedData(child)).toBeTruthy();\n \n        const context = getLContext(child)!;\n-       expect(child[MONKEY_PATCH_KEY_NAME]).toBeTruthy();\n+       expect(readPatchedData(child)).toBeTruthy();\n \n        const componentData = context.lView[context.nodeIndex];\n        const component = componentData[CONTEXT];\n        expect(component instanceof ChildComp).toBeTruthy();\n-       expect(component[MONKEY_PATCH_KEY_NAME]).toBe(context.lView);\n+       expect(readPatchedData(component)).toBe(context.lView);\n \n        const componentContext = getLContext(component)!;\n-       expect(component[MONKEY_PATCH_KEY_NAME]).toBe(componentContext);\n+       expect(readPatchedData(component)).toBe(componentContext);\n        expect(componentContext.nodeIndex).toEqual(context.nodeIndex);\n        expect(componentContext.native).toEqual(context.native);\n        expect(componentContext.lView).toEqual(context.lView);"
        }
    ],
    "stats": {
        "total": 155,
        "additions": 77,
        "deletions": 78
    }
}