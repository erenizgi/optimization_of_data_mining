{
    "author": "mgechev",
    "message": "feat(devtools): sort directive properties by name",
    "sha": "7dc1a35a62f0beb90593e70d5faf6b307fd94d2b",
    "files": [
        {
            "sha": "8d0657e4e21cfcfba26d51eee5ec45b189c59e5b",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-resolver/directive-property-resolver.spec.ts",
            "status": "added",
            "additions": 111,
            "deletions": 0,
            "changes": 111,
            "blob_url": "https://github.com/angular/angular/blob/7dc1a35a62f0beb90593e70d5faf6b307fd94d2b/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-resolver%2Fdirective-property-resolver.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7dc1a35a62f0beb90593e70d5faf6b307fd94d2b/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-resolver%2Fdirective-property-resolver.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-resolver%2Fdirective-property-resolver.spec.ts?ref=7dc1a35a62f0beb90593e70d5faf6b307fd94d2b",
            "patch": "@@ -0,0 +1,111 @@\n+import { Properties, PropType } from 'protocol';\n+import { DirectivePropertyResolver } from './directive-property-resolver';\n+\n+const properties: Properties = {\n+  props: {\n+    o: {\n+      editable: false,\n+      expandable: true,\n+      preview: '',\n+      type: PropType.Object,\n+      value: {\n+        a1: {\n+          editable: false,\n+          expandable: false,\n+          preview: '',\n+          type: 1,\n+          value: {},\n+        },\n+        b1: {\n+          editable: false,\n+          expandable: false,\n+          preview: '',\n+          type: 1,\n+          value: {},\n+        },\n+      },\n+    },\n+    i: {\n+      editable: false,\n+      expandable: true,\n+      preview: '',\n+      type: PropType.Object,\n+      value: {\n+        b1: {\n+          editable: false,\n+          expandable: false,\n+          preview: '',\n+          type: 1,\n+          value: {},\n+        },\n+        a1: {\n+          editable: false,\n+          expandable: false,\n+          preview: '',\n+          type: 1,\n+          value: {},\n+        },\n+      },\n+    },\n+    p: {\n+      editable: false,\n+      expandable: true,\n+      preview: '',\n+      type: PropType.Object,\n+      value: {\n+        b1: {\n+          editable: false,\n+          expandable: false,\n+          preview: '',\n+          type: 1,\n+          value: {},\n+        },\n+        a1: {\n+          editable: false,\n+          expandable: false,\n+          preview: '',\n+          type: 1,\n+          value: {},\n+        },\n+      },\n+    },\n+  },\n+  metadata: {\n+    inputs: {\n+      i: 'i',\n+    },\n+    outputs: {\n+      o: 'o',\n+    },\n+    encapsulation: 1,\n+    onPush: false,\n+  },\n+};\n+\n+describe('DirectivePropertyResolver', () => {\n+  let messageBusMock: any;\n+  beforeEach(() => {\n+    messageBusMock = jasmine.createSpyObj('messageBus', ['on', 'once', 'emit', 'destroy']);\n+  });\n+\n+  it('should register directive inputs, outputs, and state', () => {\n+    const resolver = new DirectivePropertyResolver(messageBusMock, properties, {\n+      element: [0],\n+      directive: 0,\n+    });\n+    expect(resolver.directiveInputControls.dataSource.data[0].prop.name).toBe('i');\n+    expect(resolver.directiveOutputControls.dataSource.data[0].prop.name).toBe('o');\n+    expect(resolver.directiveStateControls.dataSource.data[0].prop.name).toBe('p');\n+  });\n+\n+  it('should sort properties', () => {\n+    const resolver = new DirectivePropertyResolver(messageBusMock, properties, {\n+      element: [0],\n+      directive: 0,\n+    });\n+    const props = resolver.getExpandedProperties();\n+    const propNames = props.map((o) => o.name);\n+    // First level properties should be now sorted\n+    expect(propNames.join('')).toEqual('iop');\n+  });\n+});"
        },
        {
            "sha": "49616d1b8717313493999b5250f992b8ab1e83c8",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-resolver/directive-property-resolver.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 12,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/7dc1a35a62f0beb90593e70d5faf6b307fd94d2b/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-resolver%2Fdirective-property-resolver.ts",
            "raw_url": "https://github.com/angular/angular/raw/7dc1a35a62f0beb90593e70d5faf6b307fd94d2b/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-resolver%2Fdirective-property-resolver.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-resolver%2Fdirective-property-resolver.ts?ref=7dc1a35a62f0beb90593e70d5faf6b307fd94d2b",
            "patch": "@@ -41,8 +41,20 @@ export const constructPathOfKeysToPropertyValue = (nodePropToGetKeysFor: Propert\n   return keys;\n };\n \n+export const arrayify = (props: { [prop: string]: Descriptor }, parent: Property | null = null): Property[] =>\n+  Object.keys(props)\n+    .map((name) => ({ name, descriptor: props[name], parent }))\n+    .sort((a, b) => {\n+      if (a.name > b.name) {\n+        return 1;\n+      } else if (a.name < b.name) {\n+        return -1;\n+      }\n+      return 0;\n+    });\n+\n export class DirectivePropertyResolver {\n-  _treeFlattener = new MatTreeFlattener(\n+  private _treeFlattener = new MatTreeFlattener(\n     (node: Property, level: number): FlatNode => {\n       return {\n         expandable: expandable(node.descriptor),\n@@ -55,7 +67,7 @@ export class DirectivePropertyResolver {\n     (node) => this._getChildren(node)\n   );\n \n-  _treeControl = new FlatTreeControl<FlatNode>(\n+  private _treeControl = new FlatTreeControl<FlatNode>(\n     (node) => node.level,\n     (node) => node.expandable\n   );\n@@ -110,7 +122,7 @@ export class DirectivePropertyResolver {\n \n   updateProperties(newProps: Properties): void {\n     this._props = newProps;\n-    const { inputProps, outputProps, stateProps } = this._sortPropsIntoCategories();\n+    const { inputProps, outputProps, stateProps } = this._classifyProperties();\n \n     this._inputsDataSource.update(inputProps);\n     this._outputsDataSource.update(outputProps);\n@@ -130,20 +142,14 @@ export class DirectivePropertyResolver {\n       (descriptor.type === PropType.Object || descriptor.type === PropType.Array) &&\n       !(descriptor.value instanceof Observable)\n     ) {\n-      return Object.keys(descriptor.value || {}).map((name) => {\n-        return {\n-          name,\n-          descriptor: descriptor.value ? descriptor.value[name] : null,\n-          parent: prop,\n-        };\n-      });\n+      return arrayify(descriptor.value || {}, prop);\n     } else {\n       console.error('Unexpected data type', descriptor, 'in property', prop);\n     }\n   }\n \n   private _initDataSources(): void {\n-    const { inputProps, outputProps, stateProps } = this._sortPropsIntoCategories();\n+    const { inputProps, outputProps, stateProps } = this._classifyProperties();\n \n     this._inputsDataSource = this._createDataSourceFromProps(inputProps);\n     this._outputsDataSource = this._createDataSourceFromProps(outputProps);\n@@ -160,7 +166,7 @@ export class DirectivePropertyResolver {\n     );\n   }\n \n-  private _sortPropsIntoCategories(): {\n+  private _classifyProperties(): {\n     inputProps: { [name: string]: Descriptor };\n     outputProps: { [name: string]: Descriptor };\n     stateProps: { [name: string]: Descriptor };"
        },
        {
            "sha": "5be32e4efd709c5660f1f10c8745561dfad20292",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/property-resolver/property-data-source.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/7dc1a35a62f0beb90593e70d5faf6b307fd94d2b/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-resolver%2Fproperty-data-source.ts",
            "raw_url": "https://github.com/angular/angular/raw/7dc1a35a62f0beb90593e70d5faf6b307fd94d2b/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-resolver%2Fproperty-data-source.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fproperty-resolver%2Fproperty-data-source.ts?ref=7dc1a35a62f0beb90593e70d5faf6b307fd94d2b",
            "patch": "@@ -7,6 +7,7 @@ import { map } from 'rxjs/operators';\n import { DefaultIterableDiffer } from '@angular/core';\n import { diff } from '../../diffing';\n import { FlatNode, Property } from './element-property-resolver';\n+import { arrayify } from './directive-property-resolver';\n \n const trackBy = (_: number, item: FlatNode) => {\n   return `#${item.prop.name}#${item.level}`;\n@@ -26,7 +27,7 @@ export class PropertyDataSource extends DataSource<FlatNode> {\n     private _messageBus: MessageBus<Events>\n   ) {\n     super();\n-    this._data.next(this._treeFlattener.flattenNodes(this._arrayify(props)));\n+    this._data.next(this._treeFlattener.flattenNodes(arrayify(props)));\n   }\n \n   get data(): FlatNode[] {\n@@ -38,7 +39,7 @@ export class PropertyDataSource extends DataSource<FlatNode> {\n   }\n \n   update(props: { [prop: string]: Descriptor }): void {\n-    const newData = this._treeFlattener.flattenNodes(this._arrayify(props));\n+    const newData = this._treeFlattener.flattenNodes(arrayify(props));\n     diff(this._differ, this.data, newData);\n     this._data.next(this.data);\n   }\n@@ -73,10 +74,6 @@ export class PropertyDataSource extends DataSource<FlatNode> {\n     this._subscriptions = [];\n   }\n \n-  private _arrayify(props: { [prop: string]: Descriptor }, parent: Property | null = null): Property[] {\n-    return Object.keys(props).map((name) => ({ name, descriptor: props[name], parent }));\n-  }\n-\n   private _toggleNode(node: FlatNode, expand: boolean): void {\n     const index = this.data.indexOf(node);\n     // If we cannot find the current node, or the current node is not expandable\n@@ -102,7 +99,7 @@ export class PropertyDataSource extends DataSource<FlatNode> {\n     this._messageBus.once('nestedProperties', (position: DirectivePosition, data: Properties, _path: string[]) => {\n       node.prop.descriptor.value = data.props;\n       this._treeControl.expand(node);\n-      const props = this._arrayify(data.props, node.prop);\n+      const props = arrayify(data.props, node.prop);\n       const flatNodes = this._treeFlattener.flattenNodes(props);\n       flatNodes.forEach((f) => (f.level += node.level + 1));\n       this.data.splice(index + 1, 0, ...flatNodes);"
        }
    ],
    "stats": {
        "total": 152,
        "additions": 133,
        "deletions": 19
    }
}