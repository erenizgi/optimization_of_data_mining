{
    "author": "crisbeto",
    "message": "fix(compiler): incorrectly interpreting some HostBinding names (#40233)\n\nCurrently when analyzing the metadata of a directive, we bundle together the bindings from `host`\nand the `HostBinding` and `HostListener` together. This can become a problem later on in the\ncompilation pipeline, because we try to evaluate the value of the binding, causing something like\n`@HostBinding('class.foo') public true = 1;` to be treated the same as\n`host: {'[class.foo]': 'true'}`.\n\nWhile looking into the issue, I noticed another one that is closely related: we weren't treating\nquoted property names correctly. E.g. `@HostBinding('class.foo') public \"foo-bar\" = 1;` was being\ninterpreted as `classProp('foo', ctx.foo - ctx.bar)` due to the same issue where property names\nwere being evaluated.\n\nThese changes resolve both of the issues by treating all `HostBinding` instance as if they're\nreading the property from `this`. E.g. the `@HostBinding('class.foo') public true = 1;` from above\nis now being treated as `host: {'[class.foo]': 'this.true'}` which further down the pipeline becomes\n`classProp('foo', ctx.true)`. This doesn't have any payload size implications for existing code,\nbecause we've always been prefixing implicit property reads with `ctx.`. If the property doesn't\nhave an identifier that can be read using dotted access, we convert it to a quoted one (e.g.\n`classProp('foo', ctx['is-foo']))`.\n\nFixes #40220.\nFixes #40230.\nFixes #18698.\n\nPR Close #40233",
    "sha": "104546569ed195570042553d37bfc0d5f668fe4d",
    "files": [
        {
            "sha": "5159305c4296e4dafae3c449cc8229a75dfa04bd",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/directive.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {compileDeclareDirectiveFromMetadata, compileDirectiveFromMetadata, ConstantPool, Expression, ExternalExpr, Identifiers, makeBindingParser, ParsedHostBindings, ParseError, parseHostBindings, R3DependencyMetadata, R3DirectiveDef, R3DirectiveMetadata, R3FactoryTarget, R3QueryMetadata, R3ResolvedDependencyType, Statement, verifyHostBindings, WrappedNodeExpr} from '@angular/compiler';\n+import {compileDeclareDirectiveFromMetadata, compileDirectiveFromMetadata, ConstantPool, Expression, ExternalExpr, getSafePropertyAccessString, Identifiers, makeBindingParser, ParsedHostBindings, ParseError, parseHostBindings, R3DependencyMetadata, R3DirectiveDef, R3DirectiveMetadata, R3FactoryTarget, R3QueryMetadata, R3ResolvedDependencyType, Statement, verifyHostBindings, WrappedNodeExpr} from '@angular/compiler';\n import * as ts from 'typescript';\n \n import {ErrorCode, FatalDiagnosticError} from '../../diagnostics';\n@@ -738,7 +738,11 @@ export function extractHostBindings(\n             hostPropertyName = resolved;\n           }\n \n-          bindings.properties[hostPropertyName] = member.name;\n+          // Since this is a decorator, we know that the value is a class member. Always access it\n+          // through `this` so that further down the line it can't be confused for a literal value\n+          // (e.g. if there's a property called `true`). There is no size penalty, because all\n+          // values (except literals) are converted to `ctx.propName` eventually.\n+          bindings.properties[hostPropertyName] = getSafePropertyAccessString('this', member.name);\n         });\n       });\n "
        },
        {
            "sha": "46243c0a860ab265353e8f359fbb9d6ad596a876",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_bindings/host_bindings/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 105,
            "deletions": 3,
            "changes": 108,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2FGOLDEN_PARTIAL.js?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -9,7 +9,7 @@ export class HostBindingDir {\n     }\n }\n HostBindingDir.ɵfac = function HostBindingDir_Factory(t) { return new (t || HostBindingDir)(); };\n-HostBindingDir.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: HostBindingDir, selector: \"[hostBindingDir]\", host: { properties: { \"id\": \"dirId\" } }, ngImport: i0 });\n+HostBindingDir.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: HostBindingDir, selector: \"[hostBindingDir]\", host: { properties: { \"id\": \"this.dirId\" } }, ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(HostBindingDir, [{\n         type: Directive,\n         args: [{ selector: '[hostBindingDir]' }]\n@@ -298,7 +298,7 @@ export class MyDirective {\n     }\n }\n MyDirective.ɵfac = function MyDirective_Factory(t) { return new (t || MyDirective)(); };\n-MyDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: MyDirective, selector: \"[my-dir]\", host: { properties: { \"tabindex\": \"1\", \"title\": \"myTitle\", \"id\": \"myId\" } }, ngImport: i0 });\n+MyDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: MyDirective, selector: \"[my-dir]\", host: { properties: { \"tabindex\": \"1\", \"title\": \"this.myTitle\", \"id\": \"this.myId\" } }, ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyDirective, [{\n         type: Directive,\n         args: [{ selector: '[my-dir]', host: { '[tabindex]': '1' } }]\n@@ -423,7 +423,7 @@ export class MyDirective {\n     }\n }\n MyDirective.ɵfac = function MyDirective_Factory(t) { return new (t || MyDirective)(); };\n-MyDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: MyDirective, selector: \"[my-dir]\", host: { properties: { \"attr.tabindex\": \"1\", \"attr.title\": \"myTitle\", \"attr.id\": \"myId\" } }, ngImport: i0 });\n+MyDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: MyDirective, selector: \"[my-dir]\", host: { properties: { \"attr.tabindex\": \"1\", \"attr.title\": \"this.myTitle\", \"attr.id\": \"this.myId\" } }, ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyDirective, [{\n         type: Directive,\n         args: [{ selector: '[my-dir]', host: { '[attr.tabindex]': '1' } }]\n@@ -589,3 +589,105 @@ export declare class MyComponent {\n     static ɵcmp: i0.ɵɵComponentDefWithMeta<MyComponent, \"my-comp\", never, {}, {}, never, never>;\n }\n \n+/****************************************************************************************************\n+ * PARTIAL FILE: host_bindings_primitive_names.js\n+ ****************************************************************************************************/\n+import { Directive, HostBinding, NgModule } from '@angular/core';\n+import * as i0 from \"@angular/core\";\n+export class HostBindingDir {\n+}\n+HostBindingDir.ɵfac = function HostBindingDir_Factory(t) { return new (t || HostBindingDir)(); };\n+HostBindingDir.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: HostBindingDir, selector: \"[hostBindingDir]\", host: { properties: { \"class.a\": \"true\", \"class.b\": \"false\", \"class.c\": \"this.true\", \"class.d\": \"this.false\", \"class.e\": \"this.other\" } }, ngImport: i0 });\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(HostBindingDir, [{\n+        type: Directive,\n+        args: [{\n+                selector: '[hostBindingDir]',\n+                host: {\n+                    '[class.a]': 'true',\n+                    '[class.b]': 'false',\n+                }\n+            }]\n+    }], null, { true: [{\n+            type: HostBinding,\n+            args: ['class.c']\n+        }], false: [{\n+            type: HostBinding,\n+            args: ['class.d']\n+        }], other: [{\n+            type: HostBinding,\n+            args: ['class.e']\n+        }] }); })();\n+export class MyModule {\n+}\n+MyModule.ɵmod = i0.ɵɵdefineNgModule({ type: MyModule });\n+MyModule.ɵinj = i0.ɵɵdefineInjector({ factory: function MyModule_Factory(t) { return new (t || MyModule)(); } });\n+(function () { (typeof ngJitMode === \"undefined\" || ngJitMode) && i0.ɵɵsetNgModuleScope(MyModule, { declarations: [HostBindingDir] }); })();\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyModule, [{\n+        type: NgModule,\n+        args: [{ declarations: [HostBindingDir] }]\n+    }], null, null); })();\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: host_bindings_primitive_names.d.ts\n+ ****************************************************************************************************/\n+import * as i0 from \"@angular/core\";\n+export declare class HostBindingDir {\n+    true: any;\n+    false: any;\n+    other: any;\n+    static ɵfac: i0.ɵɵFactoryDef<HostBindingDir, never>;\n+    static ɵdir: i0.ɵɵDirectiveDefWithMeta<HostBindingDir, \"[hostBindingDir]\", never, {}, {}, never>;\n+}\n+export declare class MyModule {\n+    static ɵmod: i0.ɵɵNgModuleDefWithMeta<MyModule, [typeof HostBindingDir], never, never>;\n+    static ɵinj: i0.ɵɵInjectorDef<MyModule>;\n+}\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: host_bindings_quoted_names.js\n+ ****************************************************************************************************/\n+import { Directive, HostBinding, NgModule } from '@angular/core';\n+import * as i0 from \"@angular/core\";\n+export class HostBindingDir {\n+}\n+HostBindingDir.ɵfac = function HostBindingDir_Factory(t) { return new (t || HostBindingDir)(); };\n+HostBindingDir.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: HostBindingDir, selector: \"[hostBindingDir]\", host: { properties: { \"class.a\": \"this['is-a']\", \"class.b\": \"this['is-\\\"b\\\"']\", \"class.c\": \"this['\\\"is-c\\\"']\" } }, ngImport: i0 });\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(HostBindingDir, [{\n+        type: Directive,\n+        args: [{ selector: '[hostBindingDir]' }]\n+    }], null, { 'is-a': [{\n+            type: HostBinding,\n+            args: ['class.a']\n+        }], 'is-\"b\"': [{\n+            type: HostBinding,\n+            args: ['class.b']\n+        }], '\"is-c\"': [{\n+            type: HostBinding,\n+            args: ['class.c']\n+        }] }); })();\n+export class MyModule {\n+}\n+MyModule.ɵmod = i0.ɵɵdefineNgModule({ type: MyModule });\n+MyModule.ɵinj = i0.ɵɵdefineInjector({ factory: function MyModule_Factory(t) { return new (t || MyModule)(); } });\n+(function () { (typeof ngJitMode === \"undefined\" || ngJitMode) && i0.ɵɵsetNgModuleScope(MyModule, { declarations: [HostBindingDir] }); })();\n+(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyModule, [{\n+        type: NgModule,\n+        args: [{ declarations: [HostBindingDir] }]\n+    }], null, null); })();\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: host_bindings_quoted_names.d.ts\n+ ****************************************************************************************************/\n+import * as i0 from \"@angular/core\";\n+export declare class HostBindingDir {\n+    'is-a': any;\n+    'is-\"b\"': any;\n+    '\"is-c\"': any;\n+    static ɵfac: i0.ɵɵFactoryDef<HostBindingDir, never>;\n+    static ɵdir: i0.ɵɵDirectiveDefWithMeta<HostBindingDir, \"[hostBindingDir]\", never, {}, {}, never>;\n+}\n+export declare class MyModule {\n+    static ɵmod: i0.ɵɵNgModuleDefWithMeta<MyModule, [typeof HostBindingDir], never, never>;\n+    static ɵinj: i0.ɵɵInjectorDef<MyModule>;\n+}\n+"
        },
        {
            "sha": "c986e0867f2f766df1a1eabaf040e136c6546fa8",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_bindings/host_bindings/TEST_CASES.json",
            "status": "modified",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2FTEST_CASES.json",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2FTEST_CASES.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2FTEST_CASES.json?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -224,6 +224,34 @@\n           ]\n         }\n       ]\n+    },\n+    {\n+      \"description\": \"should handle host bindings with the same name as a primitive value\",\n+      \"inputFiles\": [\n+        \"host_bindings_primitive_names.ts\"\n+      ],\n+      \"expectations\": [\n+        {\n+          \"failureMessage\": \"Invalid host binding code\",\n+          \"files\": [\n+            \"host_bindings_primitive_names.js\"\n+          ]\n+        }\n+      ]\n+    },\n+    {\n+      \"description\": \"should handle host bindings with quoted names\",\n+      \"inputFiles\": [\n+        \"host_bindings_quoted_names.ts\"\n+      ],\n+      \"expectations\": [\n+        {\n+          \"failureMessage\": \"Invalid host binding code\",\n+          \"files\": [\n+            \"host_bindings_quoted_names.js\"\n+          ]\n+        }\n+      ]\n     }\n   ]\n }"
        },
        {
            "sha": "0a6f5e4a72e09d8d6506c37ed6255086441a91bf",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_bindings/host_bindings/host_bindings_primitive_names.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2Fhost_bindings_primitive_names.js",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2Fhost_bindings_primitive_names.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2Fhost_bindings_primitive_names.js?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -0,0 +1,11 @@\n+\n+HostBindingDir.ɵdir = $r3$.ɵɵdefineDirective({\n+  type: HostBindingDir,\n+  selectors: [[\"\", \"hostBindingDir\", \"\"]],\n+    hostVars: 10,\n+    hostBindings: function HostBindingDir_HostBindings(rf, ctx) {\n+      if (rf & 2) {\n+        $r3$.ɵɵclassProp(\"a\", true)(\"b\", false)(\"c\", ctx.true)(\"d\", ctx.false)(\"e\", ctx.other);\n+      }\n+    }\n+  });"
        },
        {
            "sha": "d5a19f26b9f285da144044d3d10f2cf7745c7492",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_bindings/host_bindings/host_bindings_primitive_names.ts",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2Fhost_bindings_primitive_names.ts",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2Fhost_bindings_primitive_names.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2Fhost_bindings_primitive_names.ts?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -0,0 +1,18 @@\n+import {Directive, HostBinding, NgModule} from '@angular/core';\n+\n+@Directive({\n+  selector: '[hostBindingDir]',\n+  host: {\n+    '[class.a]': 'true',\n+    '[class.b]': 'false',\n+  }\n+})\n+export class HostBindingDir {\n+  @HostBinding('class.c') true: any;\n+  @HostBinding('class.d') false: any;\n+  @HostBinding('class.e') other: any;\n+}\n+\n+@NgModule({declarations: [HostBindingDir]})\n+export class MyModule {\n+}"
        },
        {
            "sha": "bffac31d5caf9b1f8191cdb84bf7d6f6a1098510",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_bindings/host_bindings/host_bindings_quoted_names.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2Fhost_bindings_quoted_names.js",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2Fhost_bindings_quoted_names.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2Fhost_bindings_quoted_names.js?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -0,0 +1,11 @@\n+\n+HostBindingDir.ɵdir = $r3$.ɵɵdefineDirective({\n+  type: HostBindingDir,\n+  selectors: [[\"\", \"hostBindingDir\", \"\"]],\n+    hostVars: 6,\n+    hostBindings: function HostBindingDir_HostBindings(rf, ctx) {\n+      if (rf & 2) {\n+        $r3$.ɵɵclassProp(\"a\", ctx[\"is-a\"])(\"b\", ctx[\"is-\\\"b\\\"\"])(\"c\", ctx[\"\\\"is-c\\\"\"]);\n+      }\n+    }\n+  });"
        },
        {
            "sha": "f911a13b97470a1cbe05288253ad9b738acf8b75",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_bindings/host_bindings/host_bindings_quoted_names.ts",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2Fhost_bindings_quoted_names.ts",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2Fhost_bindings_quoted_names.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_bindings%2Fhost_bindings%2Fhost_bindings_quoted_names.ts?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -0,0 +1,12 @@\n+import {Directive, HostBinding, NgModule} from '@angular/core';\n+\n+@Directive({selector: '[hostBindingDir]'})\n+export class HostBindingDir {\n+  @HostBinding('class.a') 'is-a': any;\n+  @HostBinding('class.b') 'is-\"b\"': any;\n+  @HostBinding('class.c') '\"is-c\"': any;\n+}\n+\n+@NgModule({declarations: [HostBindingDir]})\n+export class MyModule {\n+}"
        },
        {
            "sha": "f7366001debacf62a18780b047613d29a4adb25b",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_styling/binding_slots/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_styling%2Fbinding_slots%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_styling%2Fbinding_slots%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_styling%2Fbinding_slots%2FGOLDEN_PARTIAL.js?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -13,7 +13,7 @@ export class MyComponent {\n     }\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", inputs: { name: \"name\" }, host: { attributes: { \"title\": \"foo title\" }, properties: { \"style\": \"myStyle\", \"class\": \"myClass\", \"id\": \"id\", \"title\": \"title\" }, styleAttribute: \"width:200px; height:500px\", classAttribute: \"foo baz\" }, ngImport: i0, template: { source: '', isInline: true } });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", inputs: { name: \"name\" }, host: { attributes: { \"title\": \"foo title\" }, properties: { \"style\": \"this.myStyle\", \"class\": \"this.myClass\", \"id\": \"this.id\", \"title\": \"this.title\" }, styleAttribute: \"width:200px; height:500px\", classAttribute: \"foo baz\" }, ngImport: i0, template: { source: '', isInline: true } });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{\n@@ -83,7 +83,7 @@ export class WidthDirective {\n     }\n }\n WidthDirective.ɵfac = function WidthDirective_Factory(t) { return new (t || WidthDirective)(); };\n-WidthDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: WidthDirective, selector: \"[myWidthDir]\", host: { properties: { \"style.width\": \"myWidth\", \"class.foo\": \"myFooClass\", \"id\": \"id\", \"title\": \"title\" } }, ngImport: i0 });\n+WidthDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: WidthDirective, selector: \"[myWidthDir]\", host: { properties: { \"style.width\": \"this.myWidth\", \"class.foo\": \"this.myFooClass\", \"id\": \"this.id\", \"title\": \"this.title\" } }, ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(WidthDirective, [{\n         type: Directive,\n         args: [{ selector: '[myWidthDir]' }]"
        },
        {
            "sha": "400683ea638654e18ead53aeecec1b2ca71ad9d2",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_styling/chaining/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_styling%2Fchaining%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_styling%2Fchaining%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_styling%2Fchaining%2FGOLDEN_PARTIAL.js?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -325,7 +325,7 @@ export class MyComponent {\n     }\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"ng-component\", host: { properties: { \"class.apple\": \"yesToApple\", \"style.color\": \"color\", \"class.tomato\": \"yesToTomato\", \"style.transition\": \"transition\", \"style.border\": \"border\", \"class.orange\": \"yesToOrange\" } }, ngImport: i0, template: { source: '', isInline: true } });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"ng-component\", host: { properties: { \"class.apple\": \"yesToApple\", \"style.color\": \"color\", \"class.tomato\": \"yesToTomato\", \"style.transition\": \"transition\", \"style.border\": \"this.border\", \"class.orange\": \"this.yesToOrange\" } }, ngImport: i0, template: { source: '', isInline: true } });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{"
        },
        {
            "sha": "f749cb54c7b512989f18e7bdbb7c834ab56052db",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_styling/host_bindings/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_styling%2Fhost_bindings%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_styling%2Fhost_bindings%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_styling%2Fhost_bindings%2FGOLDEN_PARTIAL.js?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -12,7 +12,7 @@ export class MyComponent {\n     }\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", host: { properties: { \"style\": \"myStyle\", \"class\": \"myClass\", \"style.color\": \"myColorProp\", \"class.foo\": \"myFooClass\" }, styleAttribute: \"width:200px; height:500px\", classAttribute: \"foo baz\" }, ngImport: i0, template: { source: '', isInline: true } });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", host: { properties: { \"style\": \"this.myStyle\", \"class\": \"this.myClass\", \"style.color\": \"this.myColorProp\", \"class.foo\": \"this.myFooClass\" }, styleAttribute: \"width:200px; height:500px\", classAttribute: \"foo baz\" }, ngImport: i0, template: { source: '', isInline: true } });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{\n@@ -80,7 +80,7 @@ export class MyComponent {\n     }\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", host: { properties: { \"style.height.pt\": \"myHeightProp\", \"class.bar\": \"myBarClass\", \"style\": \"myStyle\", \"style.width\": \"myWidthProp\", \"class.foo\": \"myFooClass\", \"class\": \"myClasses\" } }, ngImport: i0, template: { source: '', isInline: true } });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", host: { properties: { \"style.height.pt\": \"myHeightProp\", \"class.bar\": \"myBarClass\", \"style\": \"this.myStyle\", \"style.width\": \"this.myWidthProp\", \"class.foo\": \"this.myFooClass\", \"class\": \"this.myClasses\" } }, ngImport: i0, template: { source: '', isInline: true } });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{\n@@ -149,7 +149,7 @@ export class MyComponent {\n     }\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", host: { properties: { \"style!important\": \"myStyleExp\", \"class!important\": \"myClassExp\", \"class.foo!important\": \"myFooClassExp\", \"style.width!important\": \"myWidthExp\" } }, ngImport: i0, template: { source: `\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", host: { properties: { \"style!important\": \"myStyleExp\", \"class!important\": \"myClassExp\", \"class.foo!important\": \"this.myFooClassExp\", \"style.width!important\": \"this.myWidthExp\" } }, ngImport: i0, template: { source: `\n     <div [style.height!important]=\"myHeightExp\"\n          [class.bar!important]=\"myBarClassExp\"></div>\n   `, isInline: true } });\n@@ -368,7 +368,7 @@ export class ClassDirective {\n     }\n }\n ClassDirective.ɵfac = function ClassDirective_Factory(t) { return new (t || ClassDirective)(); };\n-ClassDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: ClassDirective, selector: \"[myClassDir]\", host: { properties: { \"class\": \"myClassMap\" } }, ngImport: i0 });\n+ClassDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: ClassDirective, selector: \"[myClassDir]\", host: { properties: { \"class\": \"this.myClassMap\" } }, ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(ClassDirective, [{\n         type: Directive,\n         args: [{ selector: '[myClassDir]' }]\n@@ -383,7 +383,7 @@ export class WidthDirective {\n     }\n }\n WidthDirective.ɵfac = function WidthDirective_Factory(t) { return new (t || WidthDirective)(); };\n-WidthDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: WidthDirective, selector: \"[myWidthDir]\", host: { properties: { \"style.width\": \"myWidth\", \"class.foo\": \"myFooClass\" } }, ngImport: i0 });\n+WidthDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: WidthDirective, selector: \"[myWidthDir]\", host: { properties: { \"style.width\": \"this.myWidth\", \"class.foo\": \"this.myFooClass\" } }, ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(WidthDirective, [{\n         type: Directive,\n         args: [{ selector: '[myWidthDir]' }]\n@@ -401,7 +401,7 @@ export class HeightDirective {\n     }\n }\n HeightDirective.ɵfac = function HeightDirective_Factory(t) { return new (t || HeightDirective)(); };\n-HeightDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: HeightDirective, selector: \"[myHeightDir]\", host: { properties: { \"style.height\": \"myHeight\", \"class.bar\": \"myBarClass\" } }, ngImport: i0 });\n+HeightDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: HeightDirective, selector: \"[myHeightDir]\", host: { properties: { \"style.height\": \"this.myHeight\", \"class.bar\": \"this.myBarClass\" } }, ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(HeightDirective, [{\n         type: Directive,\n         args: [{ selector: '[myHeightDir]' }]"
        },
        {
            "sha": "95b0b4a9b2dbac6f7b47fff1b58557b477c02d0b",
            "filename": "packages/compiler/src/compiler.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler.ts?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -101,7 +101,7 @@ export {R3DependencyMetadata, R3ResolvedDependencyType, compileFactoryFunction,\n export {compileInjector, compileNgModule, R3InjectorMetadata, R3NgModuleMetadata} from './render3/r3_module_compiler';\n export {compilePipeFromMetadata, R3PipeMetadata} from './render3/r3_pipe_compiler';\n export {makeBindingParser, ParsedTemplate, parseTemplate, ParseTemplateOptions} from './render3/view/template';\n-export {R3Reference, devOnlyGuardedExpression} from './render3/util';\n+export {R3Reference, devOnlyGuardedExpression, getSafePropertyAccessString} from './render3/util';\n export {compileComponentFromMetadata, compileDirectiveFromMetadata, parseHostBindings, ParsedHostBindings, verifyHostBindings} from './render3/view/compiler';\n export {compileDeclareComponentFromMetadata} from './render3/partial/component';\n export {compileDeclareDirectiveFromMetadata} from './render3/partial/directive';"
        },
        {
            "sha": "f90c55d981e0e92b46ab11cf953a3f1704b88343",
            "filename": "packages/compiler/src/jit_compiler_facade.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -20,7 +20,7 @@ import {compileFactoryFunction, R3DependencyMetadata, R3FactoryTarget, R3Resolve\n import {R3JitReflector} from './render3/r3_jit';\n import {compileInjector, compileNgModule, R3InjectorMetadata, R3NgModuleMetadata} from './render3/r3_module_compiler';\n import {compilePipeFromMetadata, R3PipeMetadata} from './render3/r3_pipe_compiler';\n-import {R3Reference} from './render3/util';\n+import {getSafePropertyAccessString, R3Reference} from './render3/util';\n import {DeclarationListEmitMode, R3ComponentMetadata, R3DirectiveMetadata, R3HostMetadata, R3QueryMetadata, R3UsedDirectiveMetadata} from './render3/view/api';\n import {compileComponentFromMetadata, compileDirectiveFromMetadata, ParsedHostBindings, parseHostBindings, verifyHostBindings} from './render3/view/compiler';\n import {makeBindingParser, parseTemplate} from './render3/view/template';\n@@ -471,7 +471,11 @@ function extractHostBindings(\n     if (propMetadata.hasOwnProperty(field)) {\n       propMetadata[field].forEach(ann => {\n         if (isHostBinding(ann)) {\n-          bindings.properties[ann.hostPropertyName || field] = field;\n+          // Since this is a decorator, we know that the value is a class member. Always access it\n+          // through `this` so that further down the line it can't be confused for a literal value\n+          // (e.g. if there's a property called `true`).\n+          bindings.properties[ann.hostPropertyName || field] =\n+              getSafePropertyAccessString('this', field);\n         } else if (isHostListener(ann)) {\n           bindings.listeners[ann.eventName || field] = `${field}(${(ann.args || []).join(',')})`;\n         }"
        },
        {
            "sha": "04083d07c557d5b173d4f22d257dc19cf83b199c",
            "filename": "packages/compiler/src/render3/util.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler%2Fsrc%2Frender3%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcompiler%2Fsrc%2Frender3%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Futil.ts?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import {StaticSymbol} from '../aot/static_symbol';\n+import {escapeIdentifier} from '../output/abstract_emitter';\n import * as o from '../output/output_ast';\n import {OutputContext} from '../util';\n \n@@ -84,6 +85,11 @@ export function getSyntheticPropertyName(name: string) {\n   return name;\n }\n \n+export function getSafePropertyAccessString(accessor: string, name: string): string {\n+  const escapedName = escapeIdentifier(name, false, false);\n+  return escapedName !== name ? `${accessor}[${escapedName}]` : `${accessor}.${name}`;\n+}\n+\n export function prepareSyntheticListenerFunctionName(name: string, phase: string) {\n   return `animation_${name}_${phase}`;\n }"
        },
        {
            "sha": "df4e19ce1d35b0eb0b2e677561b59db221661ac0",
            "filename": "packages/core/test/acceptance/host_binding_spec.ts",
            "status": "modified",
            "additions": 59,
            "deletions": 0,
            "changes": 59,
            "blob_url": "https://github.com/angular/angular/blob/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcore%2Ftest%2Facceptance%2Fhost_binding_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/104546569ed195570042553d37bfc0d5f668fe4d/packages%2Fcore%2Ftest%2Facceptance%2Fhost_binding_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fhost_binding_spec.ts?ref=104546569ed195570042553d37bfc0d5f668fe4d",
            "patch": "@@ -1473,4 +1473,63 @@ describe('host bindings', () => {\n               /Attempted to set attribute `dynamic` on a container node. Host bindings are not valid on ng-container or ng-template./);\n     });\n   });\n+\n+  onlyInIvy('VE does not support this').describe('host bindings on edge case properties', () => {\n+    it('should handle host bindings with the same name as a primitive value', () => {\n+      @Directive({\n+        selector: '[dir]',\n+        host: {\n+          '[class.a]': 'true',\n+          '[class.b]': 'false',\n+        }\n+      })\n+      class MyDirective {\n+        @HostBinding('class.c') true: any;\n+        @HostBinding('class.d') false: any;\n+      }\n+\n+      @Component({template: '<span dir></span>'})\n+      class MyApp {\n+        @ViewChild(MyDirective) dir!: MyDirective;\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [MyApp, MyDirective]});\n+      const fixture = TestBed.createComponent(MyApp);\n+      fixture.detectChanges();\n+      const span = fixture.nativeElement.querySelector('span');\n+      expect(span.className).toBe('a');\n+\n+      fixture.componentInstance.dir.true = 1;\n+      fixture.componentInstance.dir.false = 2;\n+      fixture.detectChanges();\n+\n+      expect(span.className).toBe('a c d');\n+    });\n+\n+    it('should handle host bindings with quoted names', () => {\n+      @Directive({selector: '[dir]'})\n+      class MyDirective {\n+        @HostBinding('class.a') 'is-a': any;\n+        @HostBinding('class.b') 'is-\"b\"': any = true;\n+        @HostBinding('class.c') '\"is-c\"': any;\n+      }\n+\n+      @Component({template: '<span dir></span>'})\n+      class MyApp {\n+        @ViewChild(MyDirective) dir!: MyDirective;\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [MyApp, MyDirective]});\n+      const fixture = TestBed.createComponent(MyApp);\n+      fixture.detectChanges();\n+      const span = fixture.nativeElement.querySelector('span');\n+      expect(span.className).toBe('b');\n+\n+      fixture.componentInstance.dir['is-a'] = 1;\n+      fixture.componentInstance.dir['\"is-c\"'] = 2;\n+      fixture.detectChanges();\n+\n+      expect(span.className).toBe('b a c');\n+    });\n+  });\n });"
        }
    ],
    "stats": {
        "total": 289,
        "additions": 272,
        "deletions": 17
    }
}