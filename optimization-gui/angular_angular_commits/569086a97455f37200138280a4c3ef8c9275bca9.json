{
    "author": "bjarkler",
    "message": "test(core): add e2e tests to ivy-trusted-types integration test (#39614)\n\nMake sure that all Trusted Types-relevant sinks that can appear in an\nAngular template (e.g. not <script>, since it's forbidden) continue to\nwork as expected with correct sanitization semantics, without\nintroducing Trusted Types violations.\n\nPR Close #39614",
    "sha": "569086a97455f37200138280a4c3ef8c9275bca9",
    "files": [
        {
            "sha": "e3fe4bf72272dce0e4764317895c610c9efd4445",
            "filename": "integration/ivy-trusted-types/e2e/src/app.e2e-spec.ts",
            "status": "modified",
            "additions": 44,
            "deletions": 2,
            "changes": 46,
            "blob_url": "https://github.com/angular/angular/blob/569086a97455f37200138280a4c3ef8c9275bca9/integration%2Fivy-trusted-types%2Fe2e%2Fsrc%2Fapp.e2e-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/569086a97455f37200138280a4c3ef8c9275bca9/integration%2Fivy-trusted-types%2Fe2e%2Fsrc%2Fapp.e2e-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fivy-trusted-types%2Fe2e%2Fsrc%2Fapp.e2e-spec.ts?ref=569086a97455f37200138280a4c3ef8c9275bca9",
            "patch": "@@ -1,5 +1,5 @@\n-import { AppPage } from './app.po';\n-import { browser, logging } from 'protractor';\n+import {browser, logging} from 'protractor';\n+import {AppPage} from './app.po';\n \n describe('workspace-project App', () => {\n   let page: AppPage;\n@@ -13,7 +13,49 @@ describe('workspace-project App', () => {\n     expect(await page.getTitleText()).toEqual('ivy-trusted-types app is running!');\n   });\n \n+  it('should sanitize and inject bound innerHTML', async () => {\n+    await page.navigateTo();\n+    expect(await page.getBoundHtmlText()).toEqual('Hello from bound HTML');\n+    expect(await page.boundHtmlIframeIsPresent()).toBe(false);\n+  });\n+\n+  it('should directly inject SafeHtml bound to innerHTML', async () => {\n+    await page.navigateTo();\n+    expect(await page.getBoundSafeHtmlText()).toEqual('Hello from bound SafeHtml');\n+    expect(await page.boundSafeHtmlIframeIsPresent()).toBe(true);\n+  });\n+\n+  it('should replace element with outerHTML contents', async () => {\n+    await page.navigateTo();\n+    expect(await page.getOuterHTMLText()).toBe('Hello from second outerHTML');\n+  });\n+\n+  it('should load iframe', async () => {\n+    await page.navigateTo();\n+    await browser.waitForAngularEnabled(false);\n+    await page.switchToIframe();\n+    expect(await page.getHeaderText()).toEqual('Hello from iframe');\n+  });\n+\n+  it('should load embed', async () => {\n+    await page.navigateTo();\n+    await browser.waitForAngularEnabled(false);\n+    await page.switchToEmbed();\n+    expect(await page.getHeaderText()).toEqual('Hello from embed');\n+  });\n+\n+  it('should load object', async () => {\n+    await page.navigateTo();\n+    await browser.waitForAngularEnabled(false);\n+    await page.switchToObject();\n+    expect(await page.getHeaderText()).toEqual('Hello from object');\n+  });\n+\n   afterEach(async () => {\n+    // Re-enable waiting for Angular in case we disabled it to navigate to a\n+    // non-Angular page\n+    await browser.waitForAngularEnabled(true);\n+\n     // Assert that there are no errors emitted from the browser\n     const logs = await browser.manage().logs().get(logging.Type.BROWSER);\n     expect(logs).not.toContain(jasmine.objectContaining({"
        },
        {
            "sha": "d85d7f246b0fa8f5d74fade452630e8dad912316",
            "filename": "integration/ivy-trusted-types/e2e/src/app.po.ts",
            "status": "modified",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/569086a97455f37200138280a4c3ef8c9275bca9/integration%2Fivy-trusted-types%2Fe2e%2Fsrc%2Fapp.po.ts",
            "raw_url": "https://github.com/angular/angular/raw/569086a97455f37200138280a4c3ef8c9275bca9/integration%2Fivy-trusted-types%2Fe2e%2Fsrc%2Fapp.po.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fivy-trusted-types%2Fe2e%2Fsrc%2Fapp.po.ts?ref=569086a97455f37200138280a4c3ef8c9275bca9",
            "patch": "@@ -5,7 +5,43 @@ export class AppPage {\n     return browser.get(browser.baseUrl);\n   }\n \n+  async switchToIframe(): Promise<unknown> {\n+    return browser.switchTo().frame(await element(by.id('trusted-types-iframe')).getWebElement());\n+  }\n+\n+  async switchToObject(): Promise<unknown> {\n+    return browser.switchTo().frame(await element(by.id('trusted-types-object')).getWebElement());\n+  }\n+\n+  async switchToEmbed(): Promise<unknown> {\n+    return browser.switchTo().frame(await element(by.id('trusted-types-embed')).getWebElement());\n+  }\n+\n   async getTitleText(): Promise<string> {\n     return element(by.css('app-root .content span')).getText();\n   }\n+\n+  async getBoundHtmlText(): Promise<string> {\n+    return element(by.css('#bound-html span')).getText();\n+  }\n+\n+  async getBoundSafeHtmlText(): Promise<string> {\n+    return element(by.css('#bound-safehtml span')).getText();\n+  }\n+\n+  async getOuterHTMLText(): Promise<string> {\n+    return element(by.id('outerhtml')).getText();\n+  }\n+\n+  async boundHtmlIframeIsPresent(): Promise<boolean> {\n+    return element(by.id('bound-html-iframe')).isPresent();\n+  }\n+\n+  async boundSafeHtmlIframeIsPresent(): Promise<boolean> {\n+    return element(by.id('bound-safehtml-iframe')).isPresent();\n+  }\n+\n+  async getHeaderText(): Promise<string> {\n+    return element(by.css('h1')).getText();\n+  }\n }"
        },
        {
            "sha": "55cf73d056a62918a279cf72e19dbd665b76b134",
            "filename": "integration/ivy-trusted-types/src/app/app.component.html",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/569086a97455f37200138280a4c3ef8c9275bca9/integration%2Fivy-trusted-types%2Fsrc%2Fapp%2Fapp.component.html",
            "raw_url": "https://github.com/angular/angular/raw/569086a97455f37200138280a4c3ef8c9275bca9/integration%2Fivy-trusted-types%2Fsrc%2Fapp%2Fapp.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fivy-trusted-types%2Fsrc%2Fapp%2Fapp.component.html?ref=569086a97455f37200138280a4c3ef8c9275bca9",
            "patch": "@@ -530,5 +530,18 @@ <h2>Next Steps</h2>\n <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * -->\n \n \n+<div id=\"trusted-types\">\n+  <h1>Trusted Types tests</h1>\n \n-<router-outlet></router-outlet>\n\\ No newline at end of file\n+  <div id=\"bound-html\" [innerHTML]=\"html\"></div>\n+  <div id=\"bound-safehtml\" [innerHTML]=\"safeHtml\"></div>\n+  <div id=\"outerhtml\">\n+    <span [outerHTML]=\"replace\">Hello from first outerHTML</span>\n+  </div>\n+\n+  <embed id=\"trusted-types-embed\" src=\"data:text/html,&lt;body&gt;&lt;h1&gt;Hello from embed&lt;/h1&gt;&lt;/body&gt;\" />\n+  <iframe id=\"trusted-types-iframe\" [srcdoc]=\"iframeHtml\"></iframe>\n+  <object id=\"trusted-types-object\" [data]=\"safeResourceUrl\" codebase=\"/\"></object>\n+</div>\n+\n+<router-outlet></router-outlet>"
        },
        {
            "sha": "f4dd761a03bbc4aa8c73e210fd5f8d3d2b59a7a9",
            "filename": "integration/ivy-trusted-types/src/app/app.component.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/569086a97455f37200138280a4c3ef8c9275bca9/integration%2Fivy-trusted-types%2Fsrc%2Fapp%2Fapp.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/569086a97455f37200138280a4c3ef8c9275bca9/integration%2Fivy-trusted-types%2Fsrc%2Fapp%2Fapp.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fivy-trusted-types%2Fsrc%2Fapp%2Fapp.component.ts?ref=569086a97455f37200138280a4c3ef8c9275bca9",
            "patch": "@@ -1,4 +1,5 @@\n-import { Component } from '@angular/core';\n+import {Component} from '@angular/core';\n+import {DomSanitizer, SafeHtml, SafeResourceUrl} from '@angular/platform-browser';\n \n @Component({\n   selector: 'app-root',\n@@ -7,4 +8,16 @@ import { Component } from '@angular/core';\n })\n export class AppComponent {\n   title = 'ivy-trusted-types';\n+  html = `<span>Hello from bound HTML</span><iframe id=\"bound-html-iframe\"></iframe>`;\n+  iframeHtml = `<h1>Hello from iframe</h1>`;\n+  replace = `<span>Hello from second outerHTML</span>`;\n+  safeHtml: SafeHtml;\n+  safeResourceUrl: SafeResourceUrl;\n+\n+  constructor(sanitizer: DomSanitizer) {\n+    this.safeHtml = sanitizer.bypassSecurityTrustHtml(\n+        `<span>Hello from bound SafeHtml</span><iframe id=\"bound-safehtml-iframe\"></iframe>`);\n+    this.safeResourceUrl = sanitizer.bypassSecurityTrustResourceUrl(\n+        `data:text/html,<body><h1>Hello from object</h1></body>`);\n+  }\n }"
        }
    ],
    "stats": {
        "total": 112,
        "additions": 108,
        "deletions": 4
    }
}