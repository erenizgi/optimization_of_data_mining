{
    "author": "edodusi",
    "message": "refactor(common): change encoding function in httpparams for better performances and coding standards (#42998)\n\nHttpParams uses custom encoding function \"standardEncoding\" to encode query string preserving specific charachters. This refactoring aims to improve performances and code quality of that function by using a RegExp and a Map object instead of a chain of replace functions.\n\nPR Close #42998",
    "sha": "85c345b011fdde38c9cb9cefaa0dd81ab2963c30",
    "files": [
        {
            "sha": "a16aec364d7df4f8e4d1df5589dc22a83a2dcfe8",
            "filename": "packages/common/http/src/params.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 10,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/85c345b011fdde38c9cb9cefaa0dd81ab2963c30/packages%2Fcommon%2Fhttp%2Fsrc%2Fparams.ts",
            "raw_url": "https://github.com/angular/angular/raw/85c345b011fdde38c9cb9cefaa0dd81ab2963c30/packages%2Fcommon%2Fhttp%2Fsrc%2Fparams.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fhttp%2Fsrc%2Fparams.ts?ref=85c345b011fdde38c9cb9cefaa0dd81ab2963c30",
            "patch": "@@ -89,18 +89,28 @@ function paramParser(rawParams: string, codec: HttpParameterCodec): Map<string,\n   }\n   return map;\n }\n+\n+/**\n+ * Encode input string with standard encodeURIComponent and then un-encode specific characters.\n+ */\n+const STANDARD_ENCODING_REGEX = /%(\\d[a-f0-9])/gi;\n+const STANDARD_ENCODING_REPLACEMENTS: {[x: string]: string} = {\n+  '40': '@',\n+  '3A': ':',\n+  '24': '$',\n+  '2C': ',',\n+  '3B': ';',\n+  '2B': '+',\n+  '3D': '=',\n+  '3F': '?',\n+  '2F': '/',\n+};\n+\n function standardEncoding(v: string): string {\n-  return encodeURIComponent(v)\n-      .replace(/%40/gi, '@')\n-      .replace(/%3A/gi, ':')\n-      .replace(/%24/gi, '$')\n-      .replace(/%2C/gi, ',')\n-      .replace(/%3B/gi, ';')\n-      .replace(/%2B/gi, '+')\n-      .replace(/%3D/gi, '=')\n-      .replace(/%3F/gi, '?')\n-      .replace(/%2F/gi, '/');\n+  return encodeURIComponent(v).replace(\n+      STANDARD_ENCODING_REGEX, (s, t) => STANDARD_ENCODING_REPLACEMENTS[t] ?? s);\n }\n+\n function valueToString(value: string|number|boolean): string {\n   return `${value}`;\n }"
        },
        {
            "sha": "2e3a1e97d89f8bb4daa8a784bc61852ffc9ea64e",
            "filename": "packages/common/http/test/params_spec.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/85c345b011fdde38c9cb9cefaa0dd81ab2963c30/packages%2Fcommon%2Fhttp%2Ftest%2Fparams_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/85c345b011fdde38c9cb9cefaa0dd81ab2963c30/packages%2Fcommon%2Fhttp%2Ftest%2Fparams_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fhttp%2Ftest%2Fparams_spec.ts?ref=85c345b011fdde38c9cb9cefaa0dd81ab2963c30",
            "patch": "@@ -174,6 +174,15 @@ import {HttpParams} from '@angular/common/http/src/params';\n       });\n     });\n \n+    describe('encoding', () => {\n+      it('should encode parameters', () => {\n+        const body = new HttpParams({fromString: 'a=standard_chars'});\n+        expect(body.toString()).toEqual('a=standard_chars');\n+        const body2 = new HttpParams({fromString: 'a=1 2 3&b=mail@test&c=3_^[]$&d=eq=1'});\n+        expect(body2.toString()).toEqual('a=1%202%203&b=mail@test&c=3_%5E%5B%5D$&d=eq=1');\n+      });\n+    });\n+\n     describe('toString', () => {\n       it('should stringify string params', () => {\n         const body = new HttpParams({fromObject: {a: '', b: '2', c: '3'}});"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 29,
        "deletions": 10
    }
}