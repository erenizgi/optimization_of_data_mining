{
    "author": "josephperrott",
    "message": "feat(dev-infra): support command line arguments for restore-commit-message (#39739)\n\nAllowing command line arguments to provide the file and source values to\nthe restore-commit-message command will assist in the the process of\nupgrading to husky@5.\n\nPR Close #39739",
    "sha": "d1dca8ba92f0850078f7885945067c39090f8931",
    "files": [
        {
            "sha": "6f4a2dacdcd31308d0a52e1f532a7308da3ca3ce",
            "filename": "dev-infra/commit-message/restore-commit-message/cli.ts",
            "status": "modified",
            "additions": 33,
            "deletions": 19,
            "changes": 52,
            "blob_url": "https://github.com/angular/angular/blob/d1dca8ba92f0850078f7885945067c39090f8931/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/d1dca8ba92f0850078f7885945067c39090f8931/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcli.ts?ref=d1dca8ba92f0850078f7885945067c39090f8931",
            "patch": "@@ -13,38 +13,52 @@ import {CommitMsgSource} from '../commit-message-source';\n import {restoreCommitMessage} from './restore-commit-message';\n \n export interface RestoreCommitMessageOptions {\n-  fileEnvVariable: string[];\n+  file?: string;\n+  source?: string;\n+  fileEnvVariable?: string;\n }\n \n /** Builds the command. */\n function builder(yargs: Argv) {\n-  return yargs.option('file-env-variable' as 'fileEnvVariable', {\n-    type: 'string',\n-    array: true,\n-    demandOption: true,\n-    description: 'The key for the environment variable which holds the arguments for the\\n' +\n-        'prepare-commit-msg hook as described here:\\n' +\n-        'https://git-scm.com/docs/githooks#_prepare_commit_msg',\n-    coerce: arg => {\n-      const [file, source] = (process.env[arg] || '').split(' ');\n-      if (!file) {\n-        throw new Error(`Provided environment variable \"${arg}\" was not found.`);\n-      }\n-      return [file, source];\n-    },\n-  });\n+  return yargs\n+      .option('file-env-variable' as 'fileEnvVariable', {\n+        type: 'string',\n+        description: 'The key for the environment variable which holds the arguments for the\\n' +\n+            'prepare-commit-msg hook as described here:\\n' +\n+            'https://git-scm.com/docs/githooks#_prepare_commit_msg'\n+      })\n+      .positional('file', {type: 'string'})\n+      .positional('source', {type: 'string'});\n }\n \n /** Handles the command. */\n-async function handler({fileEnvVariable}: Arguments<RestoreCommitMessageOptions>) {\n-  restoreCommitMessage(fileEnvVariable[0], fileEnvVariable[1] as CommitMsgSource);\n+async function handler({fileEnvVariable, file, source}: Arguments<RestoreCommitMessageOptions>) {\n+  // File and source are provided as command line parameters\n+  if (file !== undefined) {\n+    restoreCommitMessage(file, source as CommitMsgSource);\n+    return;\n+  }\n+\n+  // File and source are provided as values held in an environment variable.\n+  if (fileEnvVariable !== undefined) {\n+    const [fileFromEnv, sourceFromEnv] = (process.env[fileEnvVariable!] || '').split(' ');\n+    if (!fileFromEnv) {\n+      throw new Error(`Provided environment variable \"${fileEnvVariable}\" was not found.`);\n+    }\n+    restoreCommitMessage(fileFromEnv, sourceFromEnv as CommitMsgSource);\n+    return;\n+  }\n+\n+  throw new Error(\n+      'No file path and commit message source provide.  Provide values via positional command ' +\n+      'arguments, or via the --file-env-variable flag');\n }\n \n /** yargs command module describing the command.  */\n export const RestoreCommitMessageModule: CommandModule<{}, RestoreCommitMessageOptions> = {\n   handler,\n   builder,\n-  command: 'restore-commit-message-draft',\n+  command: 'restore-commit-message-draft [file] [source]',\n   // Description: Restore a commit message draft if one has been saved from a failed commit attempt.\n   // No describe is defiend to hide the command from the --help.\n   describe: false,"
        },
        {
            "sha": "9f450c3dc808611f3ee07717f09de65cc61d96f6",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 24,
            "deletions": 15,
            "changes": 39,
            "blob_url": "https://github.com/angular/angular/blob/d1dca8ba92f0850078f7885945067c39090f8931/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/d1dca8ba92f0850078f7885945067c39090f8931/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=d1dca8ba92f0850078f7885945067c39090f8931",
            "patch": "@@ -1604,33 +1604,42 @@ function restoreCommitMessage(filePath, source) {\n  */\n /** Builds the command. */\n function builder$1(yargs) {\n-    return yargs.option('file-env-variable', {\n+    return yargs\n+        .option('file-env-variable', {\n         type: 'string',\n-        array: true,\n-        demandOption: true,\n         description: 'The key for the environment variable which holds the arguments for the\\n' +\n             'prepare-commit-msg hook as described here:\\n' +\n-            'https://git-scm.com/docs/githooks#_prepare_commit_msg',\n-        coerce: arg => {\n-            const [file, source] = (process.env[arg] || '').split(' ');\n-            if (!file) {\n-                throw new Error(`Provided environment variable \"${arg}\" was not found.`);\n-            }\n-            return [file, source];\n-        },\n-    });\n+            'https://git-scm.com/docs/githooks#_prepare_commit_msg'\n+    })\n+        .positional('file', { type: 'string' })\n+        .positional('source', { type: 'string' });\n }\n /** Handles the command. */\n-function handler$1({ fileEnvVariable }) {\n+function handler$1({ fileEnvVariable, file, source }) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n-        restoreCommitMessage(fileEnvVariable[0], fileEnvVariable[1]);\n+        // File and source are provided as command line parameters\n+        if (file !== undefined) {\n+            restoreCommitMessage(file, source);\n+            return;\n+        }\n+        // File and source are provided as values held in an environment variable.\n+        if (fileEnvVariable !== undefined) {\n+            const [fileFromEnv, sourceFromEnv] = (process.env[fileEnvVariable] || '').split(' ');\n+            if (!fileFromEnv) {\n+                throw new Error(`Provided environment variable \"${fileEnvVariable}\" was not found.`);\n+            }\n+            restoreCommitMessage(fileFromEnv, sourceFromEnv);\n+            return;\n+        }\n+        throw new Error('No file path and commit message source provide.  Provide values via positional command ' +\n+            'arguments, or via the --file-env-variable flag');\n     });\n }\n /** yargs command module describing the command.  */\n const RestoreCommitMessageModule = {\n     handler: handler$1,\n     builder: builder$1,\n-    command: 'restore-commit-message-draft',\n+    command: 'restore-commit-message-draft [file] [source]',\n     // Description: Restore a commit message draft if one has been saved from a failed commit attempt.\n     // No describe is defiend to hide the command from the --help.\n     describe: false,"
        }
    ],
    "stats": {
        "total": 91,
        "additions": 57,
        "deletions": 34
    }
}