{
    "author": "crisbeto",
    "message": "perf(core): minor improvements to listener instructions (#41807)\n\nMakes the following improvements to the listener instructions to make them slightly smaller and more memory-efficient.\n\n1. Removes the default value from the `useCapture` parameter since it generates more code than just castint to `false`.\n2. Removes the `useCapture` and `eventTargetResolver` parameters from `ɵɵsyntheticHostListener` since they won't be generated by the compiler, as far as I can tell.\n3. Makes it so that we don't have to return a target name from a `GlobalTargetResolver`. This allows us to save on some memory, because we can return a reference to the target without having to wrap it in an object literal.\n\nDEPRECATIONS:\n`EventManagerPlugin.getGlobalEventTarget` is now deprecated and won't be called from Ivy code anymore. Global events will go through `addEventListener`.\n\nPR Close #41807",
    "sha": "6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1",
    "files": [
        {
            "sha": "8f1bdeb7fc1b4ae6acd9da1c5efcfbba86fdd36a",
            "filename": "goldens/public-api/platform-browser/platform-browser.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/goldens%2Fpublic-api%2Fplatform-browser%2Fplatform-browser.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/goldens%2Fpublic-api%2Fplatform-browser%2Fplatform-browser.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fplatform-browser%2Fplatform-browser.d.ts?ref=6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1",
            "patch": "@@ -32,7 +32,7 @@ export declare const EVENT_MANAGER_PLUGINS: InjectionToken<ɵangular_packages_pl\n export declare class EventManager {\n     constructor(plugins: ɵangular_packages_platform_browser_platform_browser_g[], _zone: NgZone);\n     addEventListener(element: HTMLElement, eventName: string, handler: Function): Function;\n-    addGlobalEventListener(target: string, eventName: string, handler: Function): Function;\n+    /** @deprecated */ addGlobalEventListener(target: string, eventName: string, handler: Function): Function;\n     getZone(): NgZone;\n }\n "
        },
        {
            "sha": "fb32c2b45516620ee93fddea22b6907166e7cc57",
            "filename": "packages/core/src/render3/instructions/listener.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 15,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flistener.ts",
            "raw_url": "https://github.com/angular/angular/raw/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flistener.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flistener.ts?ref=6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1",
            "patch": "@@ -8,7 +8,6 @@\n \n \n import {assertIndexInRange} from '../../util/assert';\n-import {EMPTY_OBJ} from '../../util/empty';\n import {isObservable} from '../../util/lang';\n import {PropertyAliasValue, TNode, TNodeFlags, TNodeType} from '../interfaces/node';\n import {GlobalTargetResolver, isProceduralRenderer, Renderer3} from '../interfaces/renderer';\n@@ -39,13 +38,14 @@ import {getOrCreateLViewCleanup, getOrCreateTViewCleanup, handleError, loadCompo\n  * @codeGenApi\n  */\n export function ɵɵlistener(\n-    eventName: string, listenerFn: (e?: any) => any, useCapture = false,\n+    eventName: string, listenerFn: (e?: any) => any, useCapture?: boolean,\n     eventTargetResolver?: GlobalTargetResolver): typeof ɵɵlistener {\n   const lView = getLView();\n   const tView = getTView();\n   const tNode = getCurrentTNode()!;\n   listenerInternal(\n-      tView, lView, lView[RENDERER], tNode, eventName, listenerFn, useCapture, eventTargetResolver);\n+      tView, lView, lView[RENDERER], tNode, eventName, listenerFn, !!useCapture,\n+      eventTargetResolver);\n   return ɵɵlistener;\n }\n \n@@ -71,15 +71,13 @@ export function ɵɵlistener(\n  * @codeGenApi\n  */\n export function ɵɵsyntheticHostListener(\n-    eventName: string, listenerFn: (e?: any) => any, useCapture = false,\n-    eventTargetResolver?: GlobalTargetResolver): typeof ɵɵsyntheticHostListener {\n+    eventName: string, listenerFn: (e?: any) => any): typeof ɵɵsyntheticHostListener {\n   const tNode = getCurrentTNode()!;\n   const lView = getLView();\n   const tView = getTView();\n   const currentDef = getCurrentDirectiveDef(tView.data);\n   const renderer = loadComponentRenderer(currentDef, tNode, lView);\n-  listenerInternal(\n-      tView, lView, renderer, tNode, eventName, listenerFn, useCapture, eventTargetResolver);\n+  listenerInternal(tView, lView, renderer, tNode, eventName, listenerFn, false);\n   return ɵɵsyntheticHostListener;\n }\n \n@@ -117,7 +115,7 @@ function findExistingListener(\n \n function listenerInternal(\n     tView: TView, lView: LView, renderer: Renderer3, tNode: TNode, eventName: string,\n-    listenerFn: (e?: any) => any, useCapture = false,\n+    listenerFn: (e?: any) => any, useCapture: boolean,\n     eventTargetResolver?: GlobalTargetResolver): void {\n   const isTNodeDirectiveHost = isDirectiveHost(tNode);\n   const firstCreatePass = tView.firstCreatePass;\n@@ -136,11 +134,10 @@ function listenerInternal(\n   // add native event listener - applicable to elements only\n   if (tNode.type & TNodeType.AnyRNode) {\n     const native = getNativeByTNode(tNode, lView) as RElement;\n-    const resolved = eventTargetResolver ? eventTargetResolver(native) : EMPTY_OBJ as any;\n-    const target = resolved.target || native;\n+    const target = eventTargetResolver ? eventTargetResolver(native) : native;\n     const lCleanupIndex = lCleanup.length;\n     const idxOrTargetGetter = eventTargetResolver ?\n-        (_lView: LView) => eventTargetResolver(unwrapRNode(_lView[tNode.index])).target :\n+        (_lView: LView) => eventTargetResolver(unwrapRNode(_lView[tNode.index])) :\n         tNode.index;\n \n     // In order to match current behavior, native DOM event listeners must be added for all\n@@ -176,11 +173,8 @@ function listenerInternal(\n         (<any>existingListener).__ngLastListenerFn__ = listenerFn;\n         processOutputs = false;\n       } else {\n-        // The first argument of `listen` function in Procedural Renderer is:\n-        // - either a target name (as a string) in case of global target (window, document, body)\n-        // - or element reference (in all other cases)\n         listenerFn = wrapListener(tNode, lView, context, listenerFn, false /** preventDefault */);\n-        const cleanupFn = renderer.listen(resolved.name || target, eventName, listenerFn);\n+        const cleanupFn = renderer.listen(target as RElement, eventName, listenerFn);\n         ngDevMode && ngDevMode.rendererAddEventListener++;\n \n         lCleanup.push(listenerFn, cleanupFn);"
        },
        {
            "sha": "6c91db9cece6f0bb9685a341e2443cd63103c982",
            "filename": "packages/core/src/render3/interfaces/renderer.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Frenderer.ts",
            "raw_url": "https://github.com/angular/angular/raw/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Frenderer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Frenderer.ts?ref=6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1",
            "patch": "@@ -30,9 +30,7 @@ export type Renderer3 = ObjectOrientedRenderer3|ProceduralRenderer3;\n \n export type GlobalTargetName = 'document'|'window'|'body';\n \n-export type GlobalTargetResolver = (element: any) => {\n-  name: GlobalTargetName, target: EventTarget\n-};\n+export type GlobalTargetResolver = (element: any) => EventTarget;\n \n /**\n  * Object Oriented style of API needed to create elements and text nodes."
        },
        {
            "sha": "1ffad1839c2885752aa91da3028804b5dea43cf9",
            "filename": "packages/core/src/render3/util/misc_utils.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fmisc_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fmisc_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fmisc_utils.ts?ref=6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1",
            "patch": "@@ -23,23 +23,23 @@ export const defaultScheduler =\n  * @codeGenApi\n  */\n export function ɵɵresolveWindow(element: RElement&{ownerDocument: Document}) {\n-  return {name: 'window', target: element.ownerDocument.defaultView};\n+  return element.ownerDocument.defaultView;\n }\n \n /**\n  *\n  * @codeGenApi\n  */\n export function ɵɵresolveDocument(element: RElement&{ownerDocument: Document}) {\n-  return {name: 'document', target: element.ownerDocument};\n+  return element.ownerDocument;\n }\n \n /**\n  *\n  * @codeGenApi\n  */\n export function ɵɵresolveBody(element: RElement&{ownerDocument: Document}) {\n-  return {name: 'body', target: element.ownerDocument.body};\n+  return element.ownerDocument.body;\n }\n \n /**"
        },
        {
            "sha": "37a11494bff2dd0a5211a5316550f15771b09de1",
            "filename": "packages/platform-browser/src/browser/browser_adapter.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fplatform-browser%2Fsrc%2Fbrowser%2Fbrowser_adapter.ts",
            "raw_url": "https://github.com/angular/angular/raw/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fplatform-browser%2Fsrc%2Fbrowser%2Fbrowser_adapter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Fsrc%2Fbrowser%2Fbrowser_adapter.ts?ref=6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1",
            "patch": "@@ -57,6 +57,7 @@ export class BrowserDomAdapter extends GenericBrowserDomAdapter {\n     return node instanceof DocumentFragment;\n   }\n \n+  /** @deprecated No longer being used in Ivy code. To be removed in version 14. */\n   getGlobalEventTarget(doc: Document, target: string): EventTarget|null {\n     if (target === 'window') {\n       return window;"
        },
        {
            "sha": "c8cfa17fc332395ee32c6f9d02999123952e39c0",
            "filename": "packages/platform-browser/src/dom/events/event_manager.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fplatform-browser%2Fsrc%2Fdom%2Fevents%2Fevent_manager.ts",
            "raw_url": "https://github.com/angular/angular/raw/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fplatform-browser%2Fsrc%2Fdom%2Fevents%2Fevent_manager.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Fsrc%2Fdom%2Fevents%2Fevent_manager.ts?ref=6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1",
            "patch": "@@ -58,6 +58,7 @@ export class EventManager {\n    * @param handler A function to call when the notification occurs. Receives the\n    * event object as an argument.\n    * @returns A callback function that can be used to remove the handler.\n+   * @deprecated No longer being used in Ivy code. To be removed in version 14.\n    */\n   addGlobalEventListener(target: string, eventName: string, handler: Function): Function {\n     const plugin = this._findPluginFor(eventName);"
        },
        {
            "sha": "b844231f277b1691fbc581619925c7ef5e55909b",
            "filename": "packages/platform-server/src/domino_adapter.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fplatform-server%2Fsrc%2Fdomino_adapter.ts",
            "raw_url": "https://github.com/angular/angular/raw/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fplatform-server%2Fsrc%2Fdomino_adapter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Fsrc%2Fdomino_adapter.ts?ref=6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1",
            "patch": "@@ -62,6 +62,7 @@ export class DominoAdapter extends BrowserDomAdapter {\n     return node.shadowRoot == node;\n   }\n \n+  /** @deprecated No longer being used in Ivy code. To be removed in version 14. */\n   getGlobalEventTarget(doc: Document, target: string): EventTarget|null {\n     if (target === 'window') {\n       return doc.defaultView;"
        },
        {
            "sha": "225f436e99f73c8b70076bdabaf338d0ec35165a",
            "filename": "packages/platform-server/src/server_events.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fplatform-server%2Fsrc%2Fserver_events.ts",
            "raw_url": "https://github.com/angular/angular/raw/6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1/packages%2Fplatform-server%2Fsrc%2Fserver_events.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Fsrc%2Fserver_events.ts?ref=6581a1b48dc6a3ddb6d371d26d765aaa0f0b04c1",
            "patch": "@@ -22,6 +22,7 @@ export class ServerEventManagerPlugin /* extends EventManagerPlugin which is pri\n     return getDOM().onAndCancel(element, eventName, handler);\n   }\n \n+  /** @deprecated No longer being used in Ivy code. To be removed in version 14. */\n   addGlobalEventListener(element: string, eventName: string, handler: Function): Function {\n     const target: HTMLElement = getDOM().getGlobalEventTarget(this.doc, element);\n     if (!target) {"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 18,
        "deletions": 22
    }
}