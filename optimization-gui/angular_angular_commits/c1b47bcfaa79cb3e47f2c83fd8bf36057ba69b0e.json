{
    "author": "devversion",
    "message": "refactor(dev-infra): expose logic for dealing with LTS branches (#38656)\n\nExposes logic for dealing with LTS branches, so that the release\ntool can re-use it for cutting LTS patch releases.\n\nEventually, we can move all of this logic to a more dedicated\nfolder instead of having it inside the merge folder.\n\nPR Close #38656",
    "sha": "c1b47bcfaa79cb3e47f2c83fd8bf36057ba69b0e",
    "files": [
        {
            "sha": "29bbc3b2e51a726bfb71e5ceb444f01e46a7bd10",
            "filename": "dev-infra/pr/merge/defaults/lts-branch.ts",
            "status": "modified",
            "additions": 27,
            "deletions": 9,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/c1b47bcfaa79cb3e47f2c83fd8bf36057ba69b0e/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flts-branch.ts",
            "raw_url": "https://github.com/angular/angular/raw/c1b47bcfaa79cb3e47f2c83fd8bf36057ba69b0e/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flts-branch.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flts-branch.ts?ref=c1b47bcfaa79cb3e47f2c83fd8bf36057ba69b0e",
            "patch": "@@ -18,13 +18,16 @@ import {getVersionOfBranch, GithubRepoWithApi} from './branches';\n  * Number of months a major version in Angular is actively supported. See:\n  * https://angular.io/guide/releases#support-policy-and-schedule.\n  */\n-const majorActiveSupportDuration = 6;\n+export const majorActiveSupportDuration = 6;\n \n /**\n  * Number of months a major version has active long-term support. See:\n  * https://angular.io/guide/releases#support-policy-and-schedule.\n  */\n-const majorActiveTermSupportDuration = 12;\n+export const majorActiveTermSupportDuration = 12;\n+\n+/** Regular expression that matches LTS NPM dist tags. */\n+export const ltsNpmDistTagRegex = /^v(\\d+)-lts$/;\n \n /**\n  * Asserts that the given branch corresponds to an active LTS version-branch that can receive\n@@ -45,7 +48,8 @@ export async function assertActiveLtsBranch(\n       await (await fetch(`https://registry.npmjs.org/${representativeNpmPackage}`)).json();\n \n   // LTS versions should be tagged in NPM in the following format: `v{major}-lts`.\n-  const ltsVersion = semver.parse(distTags[`v${version.major}-lts`]);\n+  const ltsNpmTag = getLtsNpmDistTagOfMajor(version.major);\n+  const ltsVersion = semver.parse(distTags[ltsNpmTag]);\n \n   // Ensure that there is a LTS version tagged for the given version-branch major. e.g.\n   // if the version branch is `9.2.x` then we want to make sure that there is a LTS\n@@ -63,12 +67,8 @@ export async function assertActiveLtsBranch(\n   }\n \n   const today = new Date();\n-  const releaseDate = new Date(time[`${version.major}.0.0`]);\n-  const ltsEndDate = new Date(\n-      releaseDate.getFullYear(),\n-      releaseDate.getMonth() + majorActiveSupportDuration + majorActiveTermSupportDuration,\n-      releaseDate.getDate(), releaseDate.getHours(), releaseDate.getMinutes(),\n-      releaseDate.getSeconds(), releaseDate.getMilliseconds());\n+  const majorReleaseDate = new Date(time[`${version.major}.0.0`]);\n+  const ltsEndDate = computeLtsEndDateOfMajor(majorReleaseDate);\n \n   // Check if LTS has already expired for the targeted major version. If so, we do not\n   // allow the merge as per our LTS guarantees. Can be forcibly overridden if desired.\n@@ -87,3 +87,21 @@ export async function assertActiveLtsBranch(\n         `Pull request cannot be merged into the ${branchName} branch.`);\n   }\n }\n+\n+/**\n+ * Computes the date when long-term support ends for a major released at the\n+ * specified date.\n+ */\n+export function computeLtsEndDateOfMajor(majorReleaseDate: Date): Date {\n+  return new Date(\n+      majorReleaseDate.getFullYear(),\n+      majorReleaseDate.getMonth() + majorActiveSupportDuration + majorActiveTermSupportDuration,\n+      majorReleaseDate.getDate(), majorReleaseDate.getHours(), majorReleaseDate.getMinutes(),\n+      majorReleaseDate.getSeconds(), majorReleaseDate.getMilliseconds());\n+}\n+\n+/** Gets the long-term support NPM dist tag for a given major version. */\n+export function getLtsNpmDistTagOfMajor(major: number): string {\n+  // LTS versions should be tagged in NPM in the following format: `v{major}-lts`.\n+  return `v${major}-lts`;\n+}"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 27,
        "deletions": 9
    }
}