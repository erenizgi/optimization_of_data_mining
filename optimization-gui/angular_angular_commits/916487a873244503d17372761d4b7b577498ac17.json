{
    "author": "uraj",
    "message": "build: Auto-gen tsec tsconfig files (#43440)\n\nPreviously, tsec-related tsconfig.json files are manually managed.\nSwitch to automatically generated ones.\n\nPR Close #43440",
    "sha": "916487a873244503d17372761d4b7b577498ac17",
    "files": [
        {
            "sha": "4597d3c1346813d0efb5dc1dccf7c8ba3eae6ce4",
            "filename": ".pullapprove.yml",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/.pullapprove.yml",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/.pullapprove.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.pullapprove.yml?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -732,7 +732,6 @@ groups:\n           'packages/compiler/src/schema/**',\n           'packages/platform-browser/src/security/**',\n           'packages/tsconfig-tsec-base.json',\n-          'packages/**/tsconfig-tsec.json',\n           'packages/tsec-exemption.json',\n           'tools/tsec.bzl',\n           'aio/content/guide/security.md',"
        },
        {
            "sha": "ed08605ebe72d4d065bfe9d04b00b8e94cd764d4",
            "filename": "packages/BUILD.bazel",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2FBUILD.bazel?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,5 +1,4 @@\n load(\"//tools:defaults.bzl\", \"ts_config\", \"ts_library\")\n-load(\"//tools:tsec.bzl\", \"tsec_config\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -23,11 +22,13 @@ ts_config(\n     deps = [\":tsconfig-build.json\"],\n )\n \n-tsec_config(\n+ts_config(\n     name = \"tsec_config\",\n     src = \"tsconfig-tsec-base.json\",\n-    exemption = \":tsec-exemption.json\",\n-    deps = [\":tsconfig-build.json\"],\n+    deps = [\n+        \":tsconfig-build.json\",\n+        \":tsec-exemption.json\",\n+    ],\n )\n \n exports_files(["
        },
        {
            "sha": "3111881a308385f3645817a6c4767046e325b8d2",
            "filename": "packages/compiler/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2Fcompiler%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2Fcompiler%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2FBUILD.bazel?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ng_package\", \"ts_library\")\n-load(\"//tools:tsec.bzl\", \"tsec_config\", \"tsec_test\")\n+load(\"//tools:tsec.bzl\", \"tsec_test\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -13,16 +13,10 @@ ts_library(\n     ),\n )\n \n-tsec_config(\n-    name = \"tsec_config\",\n-    src = \":tsconfig-tsec.json\",\n-    deps = [\"//packages:tsec_config\"],\n-)\n-\n tsec_test(\n     name = \"tsec_test\",\n     target = \"compiler\",\n-    tsconfig = \"tsec_config\",\n+    tsconfig = \"//packages:tsec_config\",\n )\n \n ng_package("
        },
        {
            "sha": "6f67a1b9bd8e6b4f81b5e192ddf056907ff8a13b",
            "filename": "packages/compiler/tsconfig-tsec.json",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcompiler%2Ftsconfig-tsec.json",
            "raw_url": "https://github.com/angular/angular/raw/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcompiler%2Ftsconfig-tsec.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftsconfig-tsec.json?ref=312e421ff37139760fa4b31c239b8f97003a38e5",
            "patch": "@@ -1,11 +0,0 @@\n-/** For building //packages/compiler. */\n-{\n-  \"extends\": \"../tsconfig-tsec-base.json\",\n-  \"compilerOptions\": {\n-    \"outDir\": \".tsec\"\n-  },\n-  \"include\": [\n-    \"*.ts\",\n-    \"src/**/*.ts\"\n-  ]\n-}"
        },
        {
            "sha": "5464051f63ad1f892551247b423066ab830cfd0f",
            "filename": "packages/core/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2Fcore%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2Fcore%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2FBUILD.bazel?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,6 +1,6 @@\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"generated_file_test\")\n load(\"//tools:defaults.bzl\", \"api_golden_test\", \"api_golden_test_npm_package\", \"ng_module\", \"ng_package\")\n-load(\"//tools:tsec.bzl\", \"tsec_config\", \"tsec_test\")\n+load(\"//tools:tsec.bzl\", \"tsec_test\")\n load(\"//packages/common/locales:index.bzl\", \"generate_base_locale_file\")\n \n package(default_visibility = [\"//visibility:public\"])\n@@ -40,16 +40,10 @@ ng_module(\n     ],\n )\n \n-tsec_config(\n-    name = \"tsconfig-tsec\",\n-    src = \":tsconfig-tsec.json\",\n-    deps = [\"//packages:tsec_config\"],\n-)\n-\n tsec_test(\n     name = \"tsec_test\",\n     target = \"core\",\n-    tsconfig = \"tsconfig-tsec\",\n+    tsconfig = \"//packages:tsec_config\",\n )\n \n ng_package("
        },
        {
            "sha": "ff5c506c80e662f40a38c396d001e3ffec6542d3",
            "filename": "packages/core/src/compiler/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2Fcore%2Fsrc%2Fcompiler%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2Fcore%2Fsrc%2Fcompiler%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcompiler%2FBUILD.bazel?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_library\")\n-load(\"//tools:tsec.bzl\", \"tsec_config\", \"tsec_test\")\n+load(\"//tools:tsec.bzl\", \"tsec_test\")\n \n package(default_visibility = [\n     \"//packages/compiler/test:__pkg__\",\n@@ -19,14 +19,8 @@ ts_library(\n     ],\n )\n \n-tsec_config(\n-    name = \"tsec_config\",\n-    src = \":tsconfig-tsec.json\",\n-    deps = [\"//packages:tsec_config\"],\n-)\n-\n tsec_test(\n     name = \"tsec_test\",\n     target = \"compiler\",\n-    tsconfig = \"tsec_config\",\n+    tsconfig = \"//packages:tsec_config\",\n )"
        },
        {
            "sha": "e98abf20f236bfb29ce0b40aaefe8b9b97db971c",
            "filename": "packages/core/src/compiler/tsconfig-tsec.json",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcore%2Fsrc%2Fcompiler%2Ftsconfig-tsec.json",
            "raw_url": "https://github.com/angular/angular/raw/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcore%2Fsrc%2Fcompiler%2Ftsconfig-tsec.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcompiler%2Ftsconfig-tsec.json?ref=312e421ff37139760fa4b31c239b8f97003a38e5",
            "patch": "@@ -1,8 +0,0 @@\n-/** For building //packages/core/src/compiler. */\n-{\n-  \"extends\": \"../../../tsconfig-tsec-base.json\",\n-  \"include\": [\n-    \"**/*.ts\",\n-    \"../util/ng_dev_mode.d.ts\"\n-  ]\n-}"
        },
        {
            "sha": "aa6040af2f5ea25ed288a04dc85708a585f23c2f",
            "filename": "packages/core/src/di/interface/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2Fcore%2Fsrc%2Fdi%2Finterface%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2Fcore%2Fsrc%2Fdi%2Finterface%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdi%2Finterface%2FBUILD.bazel?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_library\")\n-load(\"//tools:tsec.bzl\", \"tsec_config\", \"tsec_test\")\n+load(\"//tools:tsec.bzl\", \"tsec_test\")\n \n package(default_visibility = [\n     \"//packages/core:__subpackages__\",\n@@ -20,14 +20,8 @@ ts_library(\n     ],\n )\n \n-tsec_config(\n-    name = \"tsec_config\",\n-    src = \":tsconfig-tsec.json\",\n-    deps = [\"//packages:tsec_config\"],\n-)\n-\n tsec_test(\n     name = \"tsec_test\",\n     target = \"interface\",\n-    tsconfig = \"tsec_config\",\n+    tsconfig = \"//packages:tsec_config\",\n )"
        },
        {
            "sha": "990ba43b485e0b36fad06cc05cb853e0088fbf41",
            "filename": "packages/core/src/di/interface/tsconfig-tsec.json",
            "status": "removed",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcore%2Fsrc%2Fdi%2Finterface%2Ftsconfig-tsec.json",
            "raw_url": "https://github.com/angular/angular/raw/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcore%2Fsrc%2Fdi%2Finterface%2Ftsconfig-tsec.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdi%2Finterface%2Ftsconfig-tsec.json?ref=312e421ff37139760fa4b31c239b8f97003a38e5",
            "patch": "@@ -1,7 +0,0 @@\n-/** For building //packages/core/src/di/interface. */\n-{\n-  \"extends\": \"../../../../tsconfig-tsec-base.json\",\n-  \"include\": [\n-    \"**/*.ts\"\n-  ]\n-}"
        },
        {
            "sha": "4e07cff0e99afb4fe0781c974454c2939c91e0a7",
            "filename": "packages/core/src/interface/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2Fcore%2Fsrc%2Finterface%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2Fcore%2Fsrc%2Finterface%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Finterface%2FBUILD.bazel?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_library\")\n-load(\"//tools:tsec.bzl\", \"tsec_config\", \"tsec_test\")\n+load(\"//tools:tsec.bzl\", \"tsec_test\")\n \n package(default_visibility = [\n     \"//packages/core:__subpackages__\",\n@@ -15,14 +15,8 @@ ts_library(\n     ),\n )\n \n-tsec_config(\n-    name = \"tsec_config\",\n-    src = \":tsconfig-tsec.json\",\n-    deps = [\"//packages:tsec_config\"],\n-)\n-\n tsec_test(\n     name = \"tsec_test\",\n     target = \"interface\",\n-    tsconfig = \"tsec_config\",\n+    tsconfig = \"//packages:tsec_config\",\n )"
        },
        {
            "sha": "617b0901a83bfc78bf425d593e04ae0d542096e5",
            "filename": "packages/core/src/interface/tsconfig-tsec.json",
            "status": "removed",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcore%2Fsrc%2Finterface%2Ftsconfig-tsec.json",
            "raw_url": "https://github.com/angular/angular/raw/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcore%2Fsrc%2Finterface%2Ftsconfig-tsec.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Finterface%2Ftsconfig-tsec.json?ref=312e421ff37139760fa4b31c239b8f97003a38e5",
            "patch": "@@ -1,7 +0,0 @@\n-/** For building //packages/core/src/inteface. */\n-{\n-  \"extends\": \"../../../tsconfig-tsec-base.json\",\n-  \"include\": [\n-    \"*.ts\"\n-  ]\n-}"
        },
        {
            "sha": "fb4b6bfa12dabaea85c54f6092c3827154de99e9",
            "filename": "packages/core/src/reflection/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2Fcore%2Fsrc%2Freflection%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2Fcore%2Fsrc%2Freflection%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Freflection%2FBUILD.bazel?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_library\")\n-load(\"//tools:tsec.bzl\", \"tsec_config\", \"tsec_test\")\n+load(\"//tools:tsec.bzl\", \"tsec_test\")\n \n package(default_visibility = [\n     \"//packages/core:__subpackages__\",\n@@ -19,14 +19,8 @@ ts_library(\n     ],\n )\n \n-tsec_config(\n-    name = \"tsec_config\",\n-    src = \":tsconfig-tsec.json\",\n-    deps = [\"//packages:tsec_config\"],\n-)\n-\n tsec_test(\n     name = \"tsec_test\",\n     target = \"reflection\",\n-    tsconfig = \"tsec_config\",\n+    tsconfig = \"//packages:tsec_config\",\n )"
        },
        {
            "sha": "5d340f1929b02d482f5503d426f91dd62d112375",
            "filename": "packages/core/src/reflection/tsconfig-tsec.json",
            "status": "removed",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcore%2Fsrc%2Freflection%2Ftsconfig-tsec.json",
            "raw_url": "https://github.com/angular/angular/raw/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcore%2Fsrc%2Freflection%2Ftsconfig-tsec.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Freflection%2Ftsconfig-tsec.json?ref=312e421ff37139760fa4b31c239b8f97003a38e5",
            "patch": "@@ -1,7 +0,0 @@\n-/** For building //packages/core/src/reflection. */\n-{\n-  \"extends\": \"../../../tsconfig-tsec-base.json\",\n-  \"include\": [\n-    \"**/*.ts\"\n-  ]\n-}"
        },
        {
            "sha": "ba72ddd0a681b2f0a4225cd5a55bd733f3764fa5",
            "filename": "packages/core/src/util/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2Fcore%2Fsrc%2Futil%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2Fcore%2Fsrc%2Futil%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Futil%2FBUILD.bazel?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ts_library\")\n-load(\"//tools:tsec.bzl\", \"tsec_config\", \"tsec_test\")\n+load(\"//tools:tsec.bzl\", \"tsec_test\")\n \n package(default_visibility = [\n     \"//packages/core:__subpackages__\",\n@@ -21,14 +21,8 @@ ts_library(\n     ],\n )\n \n-tsec_config(\n-    name = \"tsec_config\",\n-    src = \":tsconfig-tsec.json\",\n-    deps = [\"//packages:tsec_config\"],\n-)\n-\n tsec_test(\n     name = \"tsec_test\",\n     target = \"util\",\n-    tsconfig = \"tsec_config\",\n+    tsconfig = \"//packages:tsec_config\",\n )"
        },
        {
            "sha": "501d2d37978cc16d428612dccb1382d6fd6197e7",
            "filename": "packages/core/src/util/tsconfig-tsec.json",
            "status": "removed",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcore%2Fsrc%2Futil%2Ftsconfig-tsec.json",
            "raw_url": "https://github.com/angular/angular/raw/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcore%2Fsrc%2Futil%2Ftsconfig-tsec.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Futil%2Ftsconfig-tsec.json?ref=312e421ff37139760fa4b31c239b8f97003a38e5",
            "patch": "@@ -1,9 +0,0 @@\n-/** For building //packages/core/src/util. */\n-{\n-  \"extends\": \"../../../tsconfig-tsec-base.json\",\n-  \"include\": [\n-    \"**/*.ts\",\n-    \"../../../*.d.ts\",\n-    \"../../../zone.js/lib/zone.d.ts\"\n-  ]\n-}"
        },
        {
            "sha": "e08e6c8433dc1f5ba45aed9b57b386442ebb05d1",
            "filename": "packages/core/tsconfig-tsec.json",
            "status": "removed",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcore%2Ftsconfig-tsec.json",
            "raw_url": "https://github.com/angular/angular/raw/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fcore%2Ftsconfig-tsec.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftsconfig-tsec.json?ref=312e421ff37139760fa4b31c239b8f97003a38e5",
            "patch": "@@ -1,10 +0,0 @@\n-/** For building //packages/core. */\n-{\n-  \"extends\": \"../tsconfig-tsec-base.json\",\n-  \"include\": [\n-    \"*.ts\",\n-    \"src/**/*.ts\",\n-    \"../*.d.ts\",\n-    \"../zone.js/lib/zone.d.ts\"\n-  ]\n-}"
        },
        {
            "sha": "6c5355306b21c884aa588f96895fc2f3d7c7c31d",
            "filename": "packages/platform-browser/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2Fplatform-browser%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2Fplatform-browser%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2FBUILD.bazel?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"api_golden_test_npm_package\", \"ng_module\", \"ng_package\")\n-load(\"//tools:tsec.bzl\", \"tsec_config\", \"tsec_test\")\n+load(\"//tools:tsec.bzl\", \"tsec_test\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -20,16 +20,10 @@ ng_module(\n     ],\n )\n \n-tsec_config(\n-    name = \"tsec_config\",\n-    src = \":tsconfig-tsec.json\",\n-    deps = [\"//packages:tsec_config\"],\n-)\n-\n tsec_test(\n     name = \"tsec_test\",\n     target = \"platform-browser\",\n-    tsconfig = \"tsec_config\",\n+    tsconfig = \"//packages:tsec_config\",\n )\n \n ng_package("
        },
        {
            "sha": "789beb0729642e0d7174a0ca737678593a0f67d4",
            "filename": "packages/platform-browser/animations/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2Fplatform-browser%2Fanimations%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2Fplatform-browser%2Fanimations%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Fanimations%2FBUILD.bazel?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ng_module\")\n-load(\"//tools:tsec.bzl\", \"tsec_config\", \"tsec_test\")\n+load(\"//tools:tsec.bzl\", \"tsec_test\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -22,14 +22,8 @@ ng_module(\n     ],\n )\n \n-tsec_config(\n-    name = \"tsec_config\",\n-    src = \":tsconfig-tsec.json\",\n-    deps = [\"//packages:tsec_config\"],\n-)\n-\n tsec_test(\n     name = \"tsec_test\",\n     target = \"animations\",\n-    tsconfig = \"tsec_config\",\n+    tsconfig = \"//packages:tsec_config\",\n )"
        },
        {
            "sha": "646cf09491d00edb5a1d95100c9b3578273746d2",
            "filename": "packages/platform-browser/animations/tsconfig-tsec.json",
            "status": "removed",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fplatform-browser%2Fanimations%2Ftsconfig-tsec.json",
            "raw_url": "https://github.com/angular/angular/raw/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fplatform-browser%2Fanimations%2Ftsconfig-tsec.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Fanimations%2Ftsconfig-tsec.json?ref=312e421ff37139760fa4b31c239b8f97003a38e5",
            "patch": "@@ -1,18 +0,0 @@\n-/** For building //packages/platform-browser/animations. */\n-{\n-  \"extends\": \"../../tsconfig-tsec-base.json\",\n-  \"compilerOptions\": {\n-    \"baseUrl\": \".\",\n-    \"paths\": {\n-      \"@angular/core\": [\"../../core\"],\n-      \"@angular/common\": [\"../../common\"],\n-      \"@angular/platform-browser\": [\"../\"],\n-      \"@angular/animations\": [\"../../animations\"],\n-      \"@angular/animations/browser\": [\"../../animations/browser\"]\n-    }\n-  },\n-  \"include\": [\n-    \"*.ts\",\n-    \"src/**/*.ts\"\n-  ]\n-}"
        },
        {
            "sha": "aaf6c6e02a6dea4015e02b8d59db59906e7ad6d9",
            "filename": "packages/platform-browser/tsconfig-tsec.json",
            "status": "removed",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fplatform-browser%2Ftsconfig-tsec.json",
            "raw_url": "https://github.com/angular/angular/raw/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fplatform-browser%2Ftsconfig-tsec.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Ftsconfig-tsec.json?ref=312e421ff37139760fa4b31c239b8f97003a38e5",
            "patch": "@@ -1,16 +0,0 @@\n-/** For building //packages/platform-browser. */\n-{\n-  \"extends\": \"../tsconfig-tsec-base.json\",\n-  \"compilerOptions\": {\n-    \"baseUrl\": \".\",\n-    \"paths\": {\n-      \"@angular/core\": [\"../core\"],\n-      \"@angular/common\": [\"../common\"]\n-    }\n-  },\n-  \"include\": [\n-    \"*.ts\",\n-    \"src/**/*.ts\",\n-    \"../*.d.ts\"\n-  ]\n-}"
        },
        {
            "sha": "d43f728e86431d40e28e1ee52a098f78de30084f",
            "filename": "packages/platform-server/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2Fplatform-server%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2Fplatform-server%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2FBUILD.bazel?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"api_golden_test_npm_package\", \"ng_module\", \"ng_package\")\n-load(\"//tools:tsec.bzl\", \"tsec_config\", \"tsec_test\")\n+load(\"//tools:tsec.bzl\", \"tsec_test\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -27,16 +27,10 @@ ng_module(\n     ],\n )\n \n-tsec_config(\n-    name = \"tsec_config\",\n-    src = \":tsconfig-tsec.json\",\n-    deps = [\"//packages:tsec_config\"],\n-)\n-\n tsec_test(\n     name = \"tsec_test\",\n     target = \"platform-server\",\n-    tsconfig = \"tsec_config\",\n+    tsconfig = \"//packages:tsec_config\",\n )\n \n ng_package("
        },
        {
            "sha": "73d3443159c255bee75c530dfa0d6a3114e7c7b0",
            "filename": "packages/platform-server/init/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2Fplatform-server%2Finit%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2Fplatform-server%2Finit%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Finit%2FBUILD.bazel?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,5 +1,5 @@\n load(\"//tools:defaults.bzl\", \"ng_module\")\n-load(\"//tools:tsec.bzl\", \"tsec_config\", \"tsec_test\")\n+load(\"//tools:tsec.bzl\", \"tsec_test\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -18,14 +18,8 @@ ng_module(\n     ],\n )\n \n-tsec_config(\n-    name = \"tsec_config\",\n-    src = \":tsconfig-tsec.json\",\n-    deps = [\"//packages:tsec_config\"],\n-)\n-\n tsec_test(\n     name = \"tsec_test\",\n     target = \"init\",\n-    tsconfig = \"tsec_config\",\n+    tsconfig = \"//packages:tsec_config\",\n )"
        },
        {
            "sha": "1143acd103e3127d8db970cca93ca1bcaabe8c4e",
            "filename": "packages/platform-server/init/tsconfig-tsec.json",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fplatform-server%2Finit%2Ftsconfig-tsec.json",
            "raw_url": "https://github.com/angular/angular/raw/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fplatform-server%2Finit%2Ftsconfig-tsec.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Finit%2Ftsconfig-tsec.json?ref=312e421ff37139760fa4b31c239b8f97003a38e5",
            "patch": "@@ -1,8 +0,0 @@\n-/** For building //packages/platform-server/init. */\n-{\n-  \"extends\": \"../../tsconfig-tsec-base.json\",\n-  \"include\": [\n-    \"*.ts\",\n-    \"src/**/*.ts\"\n-  ]\n-}"
        },
        {
            "sha": "e375f46b910bb7347e661f27c7a9ddf7bf7d5f5a",
            "filename": "packages/platform-server/tsconfig-tsec.json",
            "status": "removed",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fplatform-server%2Ftsconfig-tsec.json",
            "raw_url": "https://github.com/angular/angular/raw/312e421ff37139760fa4b31c239b8f97003a38e5/packages%2Fplatform-server%2Ftsconfig-tsec.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Ftsconfig-tsec.json?ref=312e421ff37139760fa4b31c239b8f97003a38e5",
            "patch": "@@ -1,22 +0,0 @@\n-/** For building //packages/platform-server. */\n-{\n-  \"extends\": \"../tsconfig-tsec-base.json\",\n-  \"compilerOptions\": {\n-    \"baseUrl\": \".\",\n-    \"paths\": {\n-      \"@angular/core\": [\"../core\"],\n-      \"@angular/common\": [\"../common\"],\n-      \"@angular/common/http\": [\"../common/http\"],\n-      \"@angular/compiler\": [\"../compiler\"],\n-      \"@angular/platform-browser\": [\"../platform-browser\"],\n-      \"@angular/platform-browser/animations\": [\"../platform-browser/animations\"],\n-      \"@angular/platform-browser-dynamic\": [\"../platform-browser-dynamic\"],\n-      \"@angular/animations/browser\": [\"../animations/browser\"]\n-    }\n-  },\n-  \"include\": [\n-    \"*.ts\",\n-    \"src/**/*.ts\",\n-    \"../zone.js/lib/*.d.ts\"\n-  ]\n-}"
        },
        {
            "sha": "88ca9d46372ef8b138883c618f4cc96226852a54",
            "filename": "packages/tsconfig-tsec-base.json",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/packages%2Ftsconfig-tsec-base.json",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/packages%2Ftsconfig-tsec-base.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Ftsconfig-tsec-base.json?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -2,7 +2,6 @@\n {\n   \"extends\": \"./tsconfig-build.json\",\n   \"compilerOptions\": {\n-    \"composite\": true,\n     \"noEmit\": true,\n     \"lib\": [\"es2017\", \"dom\"],\n     \"plugins\": [{\"name\": \"tsec\", \"exemptionConfig\": \"./tsec-exemption.json\"}]"
        },
        {
            "sha": "08adaac6267bdcdbfb15498ec60c5124468847af",
            "filename": "tools/tsec.bzl",
            "status": "modified",
            "additions": 124,
            "deletions": 78,
            "changes": 202,
            "blob_url": "https://github.com/angular/angular/blob/916487a873244503d17372761d4b7b577498ac17/tools%2Ftsec.bzl",
            "raw_url": "https://github.com/angular/angular/raw/916487a873244503d17372761d4b7b577498ac17/tools%2Ftsec.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Ftsec.bzl?ref=916487a873244503d17372761d4b7b577498ac17",
            "patch": "@@ -1,107 +1,143 @@\n \"\"\"Bazel rules and macros for running tsec over a ng_module or ts_library.\"\"\"\n \n+load(\"@bazel_skylib//lib:new_sets.bzl\", \"sets\")\n load(\"@npm//@bazel/typescript/internal:ts_config.bzl\", \"TsConfigInfo\")\n load(\"@build_bazel_rules_nodejs//:providers.bzl\", \"DeclarationInfo\")\n load(\"@npm//tsec:index.bzl\", _tsec_test = \"tsec_test\")\n \n-TsecTsconfigInfo = provider(fields = [\"src\", \"exemption\", \"deps\"])\n+TsecTargetInfo = provider(fields = [\"srcs\", \"deps\", \"module_name\", \"paths\"])\n \n-def _tsec_config_impl(ctx):\n-    deps = []\n+def _capture_tsec_attrs_aspect_impl(target, ctx):\n+    \"\"\"Capture certain attributes of `ts_library` into a TsecTargetInfo provider.\"\"\"\n+    module_name = getattr(target, \"module_name\", None)\n \n-    # Gather all extended tsconfig files.\n-    if ctx.files.deps:\n-        deps.extend(ctx.files.deps)\n-\n-    for d in ctx.attr.deps:\n-        # Gather all files from extended ts_config targets.\n-        if TsConfigInfo in d:\n-            deps.extend(d[TsConfigInfo].deps)\n-\n-        # Gather all files from extended tsec_config targets.\n-        if TsecTsconfigInfo in d:\n-            deps.append(d[TsecTsconfigInfo].src)\n-            if d[TsecTsconfigInfo].exemption:\n-                deps.append(d[TsecTsconfigInfo].exemption)\n-            deps.extend(d[TsecTsconfigInfo].deps)\n-    src = ctx.file.src\n+    paths = {}\n+    deps = []\n+    if module_name:\n+        paths[module_name] = [target.label.package]\n+    for d in ctx.rule.attr.deps:\n+        if TsecTargetInfo in d:\n+            paths.update(d[TsecTargetInfo].paths)\n+        if DeclarationInfo in d:\n+            deps.append(d[DeclarationInfo].transitive_declarations)\n     return [\n-        # We need $(rootpath tsec_config_target) to get the path\n-        # of the top-level config file as the argument for tsec\n-        # binary. Only `src` should be stored in the DefaultInfo\n-        # provider.\n-        DefaultInfo(files = depset([src])),\n-        TsecTsconfigInfo(\n-            src = src,\n-            exemption = ctx.file.exemption,\n-            deps = deps,\n+        TsecTargetInfo(\n+            srcs = ctx.rule.attr.srcs,\n+            deps = depset(transitive = deps),\n+            module_name = module_name,\n+            paths = paths,\n         ),\n     ]\n \n-tsec_config = rule(\n+_capture_tsec_attrs_aspect = aspect(\n+    implementation = _capture_tsec_attrs_aspect_impl,\n+    attr_aspects = [\"deps\"],\n+)\n+\n+def _generate_tsconfig(target, base_tsconfig):\n+    tsconfig = {}\n+    base_url = \"/\".join([\"..\"] * len(target.label.package.split(\"/\")))\n+\n+    if base_tsconfig:\n+        tsconfig[\"extends\"] = base_url + \"/\" + base_tsconfig.path\n+\n+    compiler_options = {\"noEmit\": True}\n+    compiler_options[\"baseUrl\"] = base_url\n+\n+    tslib_info = target[TsecTargetInfo]\n+    compiler_options[\"paths\"] = tslib_info.paths\n+\n+    tsconfig[\"compilerOptions\"] = compiler_options\n+\n+    files = sets.make()\n+    for s in tslib_info.srcs:\n+        if hasattr(s, \"files\"):\n+            for f in s.files.to_list():\n+                sets.insert(files, base_url + \"/\" + f.path)\n+\n+    for f in tslib_info.deps.to_list():\n+        # Do not include non-TS files\n+        if f.extension not in [\"ts\", \"tsx\"]:\n+            continue\n+\n+        # Do not include declarations in node_modules\n+        if f.owner.workspace_name == \"npm\":\n+            continue\n+\n+        path = f.short_path\n+\n+        # Do not include ngc produced files\n+        if path.endswith(\".ngfactory.d.ts\") or path.endswith(\".ngsummary.d.ts\"):\n+            continue\n+\n+        sets.insert(files, base_url + \"/\" + path)\n+\n+    tsconfig[\"files\"] = sets.to_list(files)\n+\n+    return json.encode(tsconfig)\n+\n+TsecTsconfigInfo = provider(fields = [\"files\"])\n+\n+def _tsec_config_impl(ctx):\n+    deps = []\n+\n+    base_tsconfig_src = None\n+    base = ctx.attr.base\n+\n+    # Gather all base tsconfig files and the exemption list.\n+    if base:\n+        if TsConfigInfo not in base:\n+            fail(\"`base` must be a ts_config target\")\n+        deps.extend(base[TsConfigInfo].deps)\n+        base_tsconfig_src = ctx.attr.base.files.to_list()[0]\n+\n+    ts_target = ctx.attr.target\n+    generated_tsconfig_content = _generate_tsconfig(ts_target, base_tsconfig_src)\n+\n+    ctx.actions.write(\n+        output = ctx.outputs.out,\n+        content = generated_tsconfig_content,\n+    )\n+\n+    deps.append(ctx.outputs.out)\n+\n+    return [DefaultInfo(files = depset(deps))]\n+\n+_tsec_config = rule(\n     implementation = _tsec_config_impl,\n     attrs = {\n-        \"src\": attr.label(\n+        \"target\": attr.label(\n             mandatory = True,\n-            allow_single_file = [\".json\"],\n-            doc = \"\"\"The single tsconfig used for running tsec.\"\"\",\n+            aspects = [_capture_tsec_attrs_aspect],\n+            doc = \"\"\"The ts_library target for which the tsconfig is generated.\"\"\",\n         ),\n-        \"deps\": attr.label_list(\n-            allow_files = [\".json\"],\n-            doc = \"\"\"Any configs extended by `src`.\"\"\",\n-        ),\n-        \"exemption\": attr.label(\n+        \"base\": attr.label(\n             allow_single_file = [\".json\"],\n-            doc = \"\"\"The exemption list used by `src`.\"\"\",\n+            doc = \"\"\"Base tsconfig to extend from.\"\"\",\n         ),\n+        \"out\": attr.output(mandatory = True),\n     },\n-    doc = \"\"\"Compute all transitive dependencies of a tsec_test config. \"\"\",\n-)\n-\n-TsLibInfo = provider(fields = [\"srcs\", \"deps\"])\n-\n-def _capture_tsec_deps_aspect_impl(target, ctx):\n-    \"\"\"Forward `srcs` and `deps` of `ts_library` and `ng_module` macros to `_tsec_test`.\"\"\"\n-    return [TsLibInfo(srcs = ctx.rule.attr.srcs, deps = ctx.rule.attr.deps)]\n-\n-_capture_tsec_deps_aspect = aspect(\n-    implementation = _capture_tsec_deps_aspect_impl,\n+    doc = \"\"\"Generate the tsconfig.json for a tsec_test. \"\"\",\n )\n \n def _all_transitive_deps_impl(ctx):\n-    files = []\n+    if TsecTargetInfo not in ctx.attr.target:\n+        fail(\"`target` must be a ts_library target\")\n \n-    if TsecTsconfigInfo not in ctx.attr.tsconfig:\n-        fail(\"`tsconfig` must be a tsec_config target\")\n+    tslib_info = ctx.attr.target[TsecTargetInfo]\n \n-    tsec_tsconfig_info = ctx.attr.tsconfig[TsecTsconfigInfo]\n-    files.append(tsec_tsconfig_info.src)\n-    if tsec_tsconfig_info.exemption:\n-        files.append(tsec_tsconfig_info.exemption)\n-    files.extend(tsec_tsconfig_info.deps)\n-\n-    if TsLibInfo not in ctx.attr.ts_target:\n-        fail(\"`target` must be a ts_library or ng_module target\")\n-\n-    ts_target_info = ctx.attr.ts_target[TsLibInfo]\n-    for s in ts_target_info.srcs:\n+    files = []\n+    for s in tslib_info.srcs:\n         if hasattr(s, \"files\"):\n             files.extend(s.files.to_list())\n \n-    for d in ts_target_info.deps:\n-        if DeclarationInfo in d:\n-            files.extend(d[DeclarationInfo].transitive_declarations.to_list())\n-        if hasattr(d, \"files\"):\n-            files.extend(d.files.to_list())\n+    files.extend(tslib_info.deps.to_list())\n \n     return [DefaultInfo(files = depset(files))]\n \n _all_transitive_deps = rule(\n     implementation = _all_transitive_deps_impl,\n-    attrs = {\n-        \"tsconfig\": attr.label(),\n-        \"ts_target\": attr.label(aspects = [_capture_tsec_deps_aspect]),\n-    },\n+    attrs = {\"target\": attr.label(aspects = [_capture_tsec_attrs_aspect])},\n     doc = \"\"\"Expand all transitive dependencies needed to run `_tsec_test`.\"\"\",\n )\n \n@@ -113,21 +149,31 @@ def tsec_test(name, target, tsconfig):\n     Args:\n         name: name of the tsec test\n         target: the ts_library or ng_module target to be checked\n-        tsconfig: the tsec_config target used for configuring tsec\n+        tsconfig: the ts_config target used for configuring tsec\n     \"\"\"\n-    all_transitive_deps_name = \"%s_all_transitive_deps\" % name\n+    tsec_tsconfig_name = \"%s_tsec_tsconfig\" % name\n+    generated_tsconfig = \"%s_tsconfig.json\" % name\n+\n+    _tsec_config(\n+        name = tsec_tsconfig_name,\n+        testonly = True,\n+        tags = [\"tsec\"],\n+        target = target,\n+        base = tsconfig,\n+        out = generated_tsconfig,\n+    )\n \n+    all_transitive_deps_name = \"%s_all_transitive_deps\" % name\n     _all_transitive_deps(\n         name = all_transitive_deps_name,\n         testonly = True,\n-        tsconfig = tsconfig,\n-        ts_target = target,\n         tags = [\"tsec\"],\n+        target = target,\n     )\n \n     _tsec_test(\n         name = name,\n-        data = [tsconfig, all_transitive_deps_name],\n+        data = [tsec_tsconfig_name, all_transitive_deps_name, generated_tsconfig],\n         tags = [\"tsec\"],\n-        templated_args = [\"-p\", \"$(rootpath %s)\" % tsconfig],\n+        templated_args = [\"-p\", \"$(rootpath %s)\" % generated_tsconfig],\n     )"
        }
    ],
    "stats": {
        "total": 446,
        "additions": 151,
        "deletions": 295
    }
}