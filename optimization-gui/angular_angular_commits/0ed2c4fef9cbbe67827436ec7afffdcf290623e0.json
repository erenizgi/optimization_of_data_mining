{
    "author": "petebacondarwin",
    "message": "fix(localize): render placeholder types in extracted XLIFF files (#39398)\n\nThe previous ViewEngine extraction tooling added `ctype` and `type`\nattributes to XLIFF 1.2 and 2.0 translation files, respectively.\n\nThis commit adds this to the new $localize based extraction tooling.\nSince the new extraction tooling works from the compiled output rather\nthan having direct access to the template content, the placeholder types\nmust be inferred from the name of the placeholder.  This is considered\nreasonable, since it already does this to compute opening and closing\ntag placeholders.\n\nFixes #38791\n\nPR Close #39398",
    "sha": "0ed2c4fef9cbbe67827436ec7afffdcf290623e0",
    "files": [
        {
            "sha": "f6e799c41b32aa9a2e5abcbef03229c35fe7f4ff",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff1_translation_serializer.ts",
            "status": "modified",
            "additions": 69,
            "deletions": 0,
            "changes": 69,
            "blob_url": "https://github.com/angular/angular/blob/0ed2c4fef9cbbe67827436ec7afffdcf290623e0/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ed2c4fef9cbbe67827436ec7afffdcf290623e0/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts?ref=0ed2c4fef9cbbe67827436ec7afffdcf290623e0",
            "patch": "@@ -100,6 +100,10 @@ export class Xliff1TranslationSerializer implements TranslationSerializer {\n \n   private serializePlaceholder(xml: XmlFile, id: string, text: string|undefined): void {\n     const attrs: Record<string, string> = {id};\n+    const ctype = getCtypeForPlaceholder(id);\n+    if (ctype !== null) {\n+      attrs.ctype = ctype;\n+    }\n     if (text !== undefined) {\n       attrs['equiv-text'] = text;\n     }\n@@ -148,3 +152,68 @@ export class Xliff1TranslationSerializer implements TranslationSerializer {\n         message.id;\n   }\n }\n+\n+/**\n+ * Compute the value of the `ctype` attribute from the `placeholder` name.\n+ *\n+ * The placeholder can take the following forms:\n+ *\n+ * - `START_BOLD_TEXT`/`END_BOLD_TEXT`\n+ * - `TAG_<ELEMENT_NAME>`\n+ * - `START_TAG_<ELEMENT_NAME>`\n+ * - `CLOSE_TAG_<ELEMENT_NAME>`\n+ *\n+ * In these cases the element name of the tag is extracted from the placeholder name and returned as\n+ * `x-<element_name>`.\n+ *\n+ * Line breaks and images are special cases.\n+ */\n+function getCtypeForPlaceholder(placeholder: string): string|null {\n+  const tag = placeholder.replace(/^(START_|CLOSE_)/, '');\n+  switch (tag) {\n+    case 'LINE_BREAK':\n+      return 'lb';\n+    case 'TAG_IMG':\n+      return 'image';\n+    default:\n+      const element = tag.startsWith('TAG_') ?\n+          tag.replace(/^TAG_(.+)/, (_, tagName: string) => tagName.toLowerCase()) :\n+          TAG_MAP[tag];\n+      if (element === undefined) {\n+        return null;\n+      }\n+      return `x-${element}`;\n+  }\n+}\n+\n+const TAG_MAP: Record<string, string> = {\n+  'LINK': 'a',\n+  'BOLD_TEXT': 'b',\n+  'EMPHASISED_TEXT': 'em',\n+  'HEADING_LEVEL1': 'h1',\n+  'HEADING_LEVEL2': 'h2',\n+  'HEADING_LEVEL3': 'h3',\n+  'HEADING_LEVEL4': 'h4',\n+  'HEADING_LEVEL5': 'h5',\n+  'HEADING_LEVEL6': 'h6',\n+  'HORIZONTAL_RULE': 'hr',\n+  'ITALIC_TEXT': 'i',\n+  'LIST_ITEM': 'li',\n+  'MEDIA_LINK': 'link',\n+  'ORDERED_LIST': 'ol',\n+  'PARAGRAPH': 'p',\n+  'QUOTATION': 'q',\n+  'STRIKETHROUGH_TEXT': 's',\n+  'SMALL_TEXT': 'small',\n+  'SUBSTRIPT': 'sub',\n+  'SUPERSCRIPT': 'sup',\n+  'TABLE_BODY': 'tbody',\n+  'TABLE_CELL': 'td',\n+  'TABLE_FOOTER': 'tfoot',\n+  'TABLE_HEADER_CELL': 'th',\n+  'TABLE_HEADER': 'thead',\n+  'TABLE_ROW': 'tr',\n+  'MONOSPACED_TEXT': 'tt',\n+  'UNDERLINED_TEXT': 'u',\n+  'UNORDERED_LIST': 'ul',\n+};"
        },
        {
            "sha": "4fee339e592d0029e5ec550b0d49aa805228dd46",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff2_translation_serializer.ts",
            "status": "modified",
            "additions": 38,
            "deletions": 2,
            "changes": 40,
            "blob_url": "https://github.com/angular/angular/blob/0ed2c4fef9cbbe67827436ec7afffdcf290623e0/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ed2c4fef9cbbe67827436ec7afffdcf290623e0/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts?ref=0ed2c4fef9cbbe67827436ec7afffdcf290623e0",
            "patch": "@@ -119,6 +119,10 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n         equivStart: placeholderName,\n         equivEnd: closingPlaceholderName,\n       };\n+      const type = getTypeForPlaceholder(placeholderName);\n+      if (type !== null) {\n+        attrs.type = type;\n+      }\n       if (text !== undefined) {\n         attrs.dispStart = text;\n       }\n@@ -129,8 +133,14 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n     } else if (placeholderName.startsWith('CLOSE_')) {\n       xml.endTag('pc');\n     } else {\n-      const attrs:\n-          Record<string, string> = {id: `${this.currentPlaceholderId++}`, equiv: placeholderName};\n+      const attrs: Record<string, string> = {\n+        id: `${this.currentPlaceholderId++}`,\n+        equiv: placeholderName,\n+      };\n+      const type = getTypeForPlaceholder(placeholderName);\n+      if (type !== null) {\n+        attrs.type = type;\n+      }\n       if (text !== undefined) {\n         attrs.disp = text;\n       }\n@@ -166,3 +176,29 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n         message.id;\n   }\n }\n+\n+/**\n+ * Compute the value of the `type` attribute from the `placeholder` name.\n+ *\n+ * If the tag is not known but starts with `TAG_`, `START_TAG_` or `CLOSE_TAG_` then the type is\n+ * `other`. Certain formatting tags (e.g. bold, italic, etc) have type `fmt`. Line-breaks, images\n+ * and links are special cases.\n+ */\n+function getTypeForPlaceholder(placeholder: string): string|null {\n+  const tag = placeholder.replace(/^(START_|CLOSE_)/, '');\n+  switch (tag) {\n+    case 'BOLD_TEXT':\n+    case 'EMPHASISED_TEXT':\n+    case 'ITALIC_TEXT':\n+    case 'LINE_BREAK':\n+    case 'STRIKETHROUGH_TEXT':\n+    case 'UNDERLINED_TEXT':\n+      return 'fmt';\n+    case 'TAG_IMG':\n+      return 'image';\n+    case 'LINK':\n+      return 'link';\n+    default:\n+      return /^(START_|CLOSE_)/.test(placeholder) ? 'other' : null;\n+  }\n+}"
        },
        {
            "sha": "650c91e95395254de7b0a67eff71593288435359",
            "filename": "packages/localize/src/tools/test/extract/integration/main_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/0ed2c4fef9cbbe67827436ec7afffdcf290623e0/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ed2c4fef9cbbe67827436ec7afffdcf290623e0/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts?ref=0ed2c4fef9cbbe67827436ec7afffdcf290623e0",
            "patch": "@@ -202,9 +202,9 @@ runInEachFileSystem(() => {\n                  `        </context-group>`,\n                  `      </trans-unit>`,\n                  `      <trans-unit id=\"2932901491976224757\" datatype=\"html\">`,\n-                 `        <source>pre<x id=\"START_TAG_SPAN\" equiv-text=\"&apos;&lt;span&gt;&apos;\"/>` +\n-                     `inner-pre<x id=\"START_BOLD_TEXT\" equiv-text=\"&apos;&lt;b&gt;&apos;\"/>bold<x id=\"CLOSE_BOLD_TEXT\" equiv-text=\"&apos;&lt;/b&gt;&apos;\"/>` +\n-                     `inner-post<x id=\"CLOSE_TAG_SPAN\" equiv-text=\"&apos;&lt;/span&gt;&apos;\"/>post</source>`,\n+                 `        <source>pre<x id=\"START_TAG_SPAN\" ctype=\"x-span\" equiv-text=\"&apos;&lt;span&gt;&apos;\"/>` +\n+                     `inner-pre<x id=\"START_BOLD_TEXT\" ctype=\"x-b\" equiv-text=\"&apos;&lt;b&gt;&apos;\"/>bold<x id=\"CLOSE_BOLD_TEXT\" ctype=\"x-b\" equiv-text=\"&apos;&lt;/b&gt;&apos;\"/>` +\n+                     `inner-post<x id=\"CLOSE_TAG_SPAN\" ctype=\"x-span\" equiv-text=\"&apos;&lt;/span&gt;&apos;\"/>post</source>`,\n                  `        <context-group purpose=\"location\">`,\n                  `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n                  `          <context context-type=\"linenumber\">9,10</context>`,\n@@ -279,8 +279,8 @@ runInEachFileSystem(() => {\n               `        <note category=\"location\">test_files/test.js:9,10</note>`,\n               `      </notes>`,\n               `      <segment>`,\n-              `        <source>pre<pc id=\"0\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\" dispStart=\"&apos;&lt;span&gt;&apos;\" dispEnd=\"&apos;&lt;/span&gt;&apos;\">` +\n-                  `inner-pre<pc id=\"1\" equivStart=\"START_BOLD_TEXT\" equivEnd=\"CLOSE_BOLD_TEXT\" dispStart=\"&apos;&lt;b&gt;&apos;\" dispEnd=\"&apos;&lt;/b&gt;&apos;\">bold</pc>` +\n+              `        <source>pre<pc id=\"0\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\" type=\"other\" dispStart=\"&apos;&lt;span&gt;&apos;\" dispEnd=\"&apos;&lt;/span&gt;&apos;\">` +\n+                  `inner-pre<pc id=\"1\" equivStart=\"START_BOLD_TEXT\" equivEnd=\"CLOSE_BOLD_TEXT\" type=\"fmt\" dispStart=\"&apos;&lt;b&gt;&apos;\" dispEnd=\"&apos;&lt;/b&gt;&apos;\">bold</pc>` +\n                   `inner-post</pc>post</source>`,\n               `      </segment>`,\n               `    </unit>`,"
        },
        {
            "sha": "5ca658aa6fa5a5d6b78e40c919afc349f20e1f52",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xliff1_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 62,
            "deletions": 4,
            "changes": 66,
            "blob_url": "https://github.com/angular/angular/blob/0ed2c4fef9cbbe67827436ec7afffdcf290623e0/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ed2c4fef9cbbe67827436ec7afffdcf290623e0/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts?ref=0ed2c4fef9cbbe67827436ec7afffdcf290623e0",
            "patch": "@@ -99,18 +99,18 @@ runInEachFileSystem(() => {\n               `        <source>a<x id=\"PH\" equiv-text=\"placeholder + 1\"/>b<x id=\"PH_1\"/>c</source>`,\n               `      </trans-unit>`,\n               `      <trans-unit id=\"67890\" datatype=\"html\">`,\n-              `        <source>a<x id=\"START_TAG_SPAN\"/><x id=\"CLOSE_TAG_SPAN\"/>c</source>`,\n+              `        <source>a<x id=\"START_TAG_SPAN\" ctype=\"x-span\"/><x id=\"CLOSE_TAG_SPAN\" ctype=\"x-span\"/>c</source>`,\n               `        <note priority=\"1\" from=\"description\">some description</note>`,\n               `      </trans-unit>`,\n               `      <trans-unit id=\"38705\" datatype=\"html\">`,\n-              `        <source>a<x id=\"START_TAG_SPAN\"/><x id=\"CLOSE_TAG_SPAN\"/>c</source>`,\n+              `        <source>a<x id=\"START_TAG_SPAN\" ctype=\"x-span\"/><x id=\"CLOSE_TAG_SPAN\" ctype=\"x-span\"/>c</source>`,\n               `        <context-group purpose=\"location\">`,\n               `          <context context-type=\"sourcefile\">file.ts</context>`,\n               `          <context context-type=\"linenumber\">3,4</context>`,\n               `        </context-group>`,\n               `      </trans-unit>`,\n               `      <trans-unit id=\"13579\" datatype=\"html\">`,\n-              `        <source><x id=\"START_BOLD_TEXT\"/>b<x id=\"CLOSE_BOLD_TEXT\"/></source>`,\n+              `        <source><x id=\"START_BOLD_TEXT\" ctype=\"x-b\"/>b<x id=\"CLOSE_BOLD_TEXT\" ctype=\"x-b\"/></source>`,\n               `      </trans-unit>`,\n               `      <trans-unit id=\"24680\" datatype=\"html\">`,\n               `        <source>a</source>`,\n@@ -128,7 +128,7 @@ runInEachFileSystem(() => {\n               `        <source>pre-ICU {VAR_SELECT, select, a {a} b {<x id=\"INTERPOLATION\"/>} c {pre <x id=\"INTERPOLATION_1\"/> post}} post-ICU</source>`,\n               `      </trans-unit>`,\n               `      <trans-unit id=\"100001\" datatype=\"html\">`,\n-              `        <source>{VAR_PLURAL, plural, one {<x id=\"START_BOLD_TEXT\"/>something bold<x id=\"CLOSE_BOLD_TEXT\"/>} other {pre <x id=\"START_TAG_SPAN\"/>middle<x id=\"CLOSE_TAG_SPAN\"/> post}}</source>`,\n+              `        <source>{VAR_PLURAL, plural, one {<x id=\"START_BOLD_TEXT\" ctype=\"x-b\"/>something bold<x id=\"CLOSE_BOLD_TEXT\" ctype=\"x-b\"/>} other {pre <x id=\"START_TAG_SPAN\" ctype=\"x-span\"/>middle<x id=\"CLOSE_TAG_SPAN\" ctype=\"x-span\"/> post}}</source>`,\n               `      </trans-unit>`,\n               `    </body>`,\n               `  </file>`,\n@@ -230,6 +230,64 @@ runInEachFileSystem(() => {\n               `</xliff>\\n`,\n             ].join('\\n'));\n           });\n+\n+          it('should render the \"ctype\" for line breaks', () => {\n+            const serializer = new Xliff1TranslationSerializer(\n+                'xx', absoluteFrom('/project'), useLegacyIds, options);\n+            const output = serializer.serialize([mockMessage('1', ['a', 'b'], ['LINE_BREAK'], {})]);\n+            expect(output).toContain(\n+                '<source>a<x id=\"LINE_BREAK\" ctype=\"lb\"/>b</source>',\n+            );\n+          });\n+\n+          it('should render the \"ctype\" for images', () => {\n+            const serializer = new Xliff1TranslationSerializer(\n+                'xx', absoluteFrom('/project'), useLegacyIds, options);\n+            const output = serializer.serialize([mockMessage('2', ['a', 'b'], ['TAG_IMG'], {})]);\n+            expect(output).toContain(\n+                '<source>a<x id=\"TAG_IMG\" ctype=\"image\"/>b</source>',\n+            );\n+          });\n+\n+          it('should render the \"ctype\" for bold elements', () => {\n+            const serializer = new Xliff1TranslationSerializer(\n+                'xx', absoluteFrom('/project'), useLegacyIds, options);\n+            const output = serializer.serialize(\n+                [mockMessage('3', ['a', 'b', 'c'], ['START_BOLD_TEXT', 'CLOSE_BOLD_TEXT'], {})]);\n+            expect(output).toContain(\n+                '<source>a<x id=\"START_BOLD_TEXT\" ctype=\"x-b\"/>b<x id=\"CLOSE_BOLD_TEXT\" ctype=\"x-b\"/>c</source>',\n+            );\n+          });\n+\n+          it('should render the \"ctype\" for headings', () => {\n+            const serializer = new Xliff1TranslationSerializer(\n+                'xx', absoluteFrom('/project'), useLegacyIds, options);\n+            const output = serializer.serialize([mockMessage(\n+                '4', ['a', 'b', 'c'], ['START_HEADING_LEVEL1', 'CLOSE_HEADING_LEVEL1'], {})]);\n+            expect(output).toContain(\n+                '<source>a<x id=\"START_HEADING_LEVEL1\" ctype=\"x-h1\"/>b<x id=\"CLOSE_HEADING_LEVEL1\" ctype=\"x-h1\"/>c</source>',\n+            );\n+          });\n+\n+          it('should render the \"ctype\" for span elements', () => {\n+            const serializer = new Xliff1TranslationSerializer(\n+                'xx', absoluteFrom('/project'), useLegacyIds, options);\n+            const output = serializer.serialize(\n+                [mockMessage('5', ['a', 'b', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'], {})]);\n+            expect(output).toContain(\n+                '<source>a<x id=\"START_TAG_SPAN\" ctype=\"x-span\"/>b<x id=\"CLOSE_TAG_SPAN\" ctype=\"x-span\"/>c</source>',\n+            );\n+          });\n+\n+          it('should render the \"ctype\" for div elements', () => {\n+            const serializer = new Xliff1TranslationSerializer(\n+                'xx', absoluteFrom('/project'), useLegacyIds, options);\n+            const output = serializer.serialize(\n+                [mockMessage('6', ['a', 'b', 'c'], ['START_TAG_DIV', 'CLOSE_TAG_DIV'], {})]);\n+            expect(output).toContain(\n+                '<source>a<x id=\"START_TAG_DIV\" ctype=\"x-div\"/>b<x id=\"CLOSE_TAG_DIV\" ctype=\"x-div\"/>c</source>',\n+            );\n+          });\n         });\n       });\n     });"
        },
        {
            "sha": "b8f812d40d4e46dce207e3e6fc82ecefabbe5174",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xliff2_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 62,
            "deletions": 4,
            "changes": 66,
            "blob_url": "https://github.com/angular/angular/blob/0ed2c4fef9cbbe67827436ec7afffdcf290623e0/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ed2c4fef9cbbe67827436ec7afffdcf290623e0/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts?ref=0ed2c4fef9cbbe67827436ec7afffdcf290623e0",
            "patch": "@@ -108,20 +108,20 @@ runInEachFileSystem(() => {\n               `        <note category=\"description\">some description</note>`,\n               `      </notes>`,\n               `      <segment>`,\n-              `        <source>a<pc id=\"0\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\"></pc>c</source>`,\n+              `        <source>a<pc id=\"0\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\" type=\"other\"></pc>c</source>`,\n               `      </segment>`,\n               `    </unit>`,\n               `    <unit id=\"location-only\">`,\n               `      <notes>`,\n               `        <note category=\"location\">file.ts:3,4</note>`,\n               `      </notes>`,\n               `      <segment>`,\n-              `        <source>a<pc id=\"0\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\"></pc>c</source>`,\n+              `        <source>a<pc id=\"0\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\" type=\"other\"></pc>c</source>`,\n               `      </segment>`,\n               `    </unit>`,\n               `    <unit id=\"13579\">`,\n               `      <segment>`,\n-              `        <source><pc id=\"0\" equivStart=\"START_BOLD_TEXT\" equivEnd=\"CLOSE_BOLD_TEXT\">b</pc></source>`,\n+              `        <source><pc id=\"0\" equivStart=\"START_BOLD_TEXT\" equivEnd=\"CLOSE_BOLD_TEXT\" type=\"fmt\">b</pc></source>`,\n               `      </segment>`,\n               `    </unit>`,\n               `    <unit id=\"24680\">`,\n@@ -151,7 +151,7 @@ runInEachFileSystem(() => {\n               `    </unit>`,\n               `    <unit id=\"100001\">`,\n               `      <segment>`,\n-              `        <source>{VAR_PLURAL, plural, one {<pc id=\"0\" equivStart=\"START_BOLD_TEXT\" equivEnd=\"CLOSE_BOLD_TEXT\">something bold</pc>} other {pre <pc id=\"1\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\">middle</pc> post}}</source>`,\n+              `        <source>{VAR_PLURAL, plural, one {<pc id=\"0\" equivStart=\"START_BOLD_TEXT\" equivEnd=\"CLOSE_BOLD_TEXT\" type=\"fmt\">something bold</pc>} other {pre <pc id=\"1\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\" type=\"other\">middle</pc> post}}</source>`,\n               `      </segment>`,\n               `    </unit>`,\n               `  </file>`,\n@@ -243,6 +243,64 @@ runInEachFileSystem(() => {\n               `</xliff>\\n`,\n             ].join('\\n'));\n           });\n+\n+          it('should render the \"type\" for line breaks', () => {\n+            const serializer = new Xliff2TranslationSerializer(\n+                'xx', absoluteFrom('/project'), useLegacyIds, options);\n+            const output = serializer.serialize([mockMessage('1', ['a', 'b'], ['LINE_BREAK'], {})]);\n+            expect(output).toContain(\n+                '<source>a<ph id=\"0\" equiv=\"LINE_BREAK\" type=\"fmt\"/>b</source>',\n+            );\n+          });\n+\n+          it('should render the \"type\" for images', () => {\n+            const serializer = new Xliff2TranslationSerializer(\n+                'xx', absoluteFrom('/project'), useLegacyIds, options);\n+            const output = serializer.serialize([mockMessage('2', ['a', 'b'], ['TAG_IMG'], {})]);\n+            expect(output).toContain(\n+                '<source>a<ph id=\"0\" equiv=\"TAG_IMG\" type=\"image\"/>b</source>',\n+            );\n+          });\n+\n+          it('should render the \"type\" for bold elements', () => {\n+            const serializer = new Xliff2TranslationSerializer(\n+                'xx', absoluteFrom('/project'), useLegacyIds, options);\n+            const output = serializer.serialize(\n+                [mockMessage('3', ['a', 'b', 'c'], ['START_BOLD_TEXT', 'CLOSE_BOLD_TEXT'], {})]);\n+            expect(output).toContain(\n+                '<source>a<pc id=\"0\" equivStart=\"START_BOLD_TEXT\" equivEnd=\"CLOSE_BOLD_TEXT\" type=\"fmt\">b</pc>c</source>',\n+            );\n+          });\n+\n+          it('should render the \"type\" for heading elements', () => {\n+            const serializer = new Xliff2TranslationSerializer(\n+                'xx', absoluteFrom('/project'), useLegacyIds, options);\n+            const output = serializer.serialize([mockMessage(\n+                '4', ['a', 'b', 'c'], ['START_HEADING_LEVEL1', 'CLOSE_HEADING_LEVEL1'], {})]);\n+            expect(output).toContain(\n+                '<source>a<pc id=\"0\" equivStart=\"START_HEADING_LEVEL1\" equivEnd=\"CLOSE_HEADING_LEVEL1\" type=\"other\">b</pc>c</source>',\n+            );\n+          });\n+\n+          it('should render the \"type\" for span elements', () => {\n+            const serializer = new Xliff2TranslationSerializer(\n+                'xx', absoluteFrom('/project'), useLegacyIds, options);\n+            const output = serializer.serialize(\n+                [mockMessage('5', ['a', 'b', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'], {})]);\n+            expect(output).toContain(\n+                '<source>a<pc id=\"0\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\" type=\"other\">b</pc>c</source>',\n+            );\n+          });\n+\n+          it('should render the \"type\" for div elements', () => {\n+            const serializer = new Xliff2TranslationSerializer(\n+                'xx', absoluteFrom('/project'), useLegacyIds, options);\n+            const output = serializer.serialize(\n+                [mockMessage('6', ['a', 'b', 'c'], ['START_TAG_DIV', 'CLOSE_TAG_DIV'], {})]);\n+            expect(output).toContain(\n+                '<source>a<pc id=\"0\" equivStart=\"START_TAG_DIV\" equivEnd=\"CLOSE_TAG_DIV\" type=\"other\">b</pc>c</source>',\n+            );\n+          });\n         });\n       });\n     });"
        }
    ],
    "stats": {
        "total": 251,
        "additions": 236,
        "deletions": 15
    }
}