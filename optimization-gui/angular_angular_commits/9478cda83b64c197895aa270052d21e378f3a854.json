{
    "author": "crisbeto",
    "message": "fix(compiler): throw error for duplicate template references (#40538)\n\nAdds an error if a reference is used more than once on the same element (e.g. `<div #a #a>`).\nWe used to have this error in ViewEngine, but it wasn't ported over to Ivy.\n\nFixes #40536.\n\nPR Close #40538",
    "sha": "9478cda83b64c197895aa270052d21e378f3a854",
    "files": [
        {
            "sha": "716e5254e7b10743374a4cf05567236061c9deb9",
            "filename": "packages/compiler/src/render3/r3_template_transform.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/9478cda83b64c197895aa270052d21e378f3a854/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_template_transform.ts",
            "raw_url": "https://github.com/angular/angular/raw/9478cda83b64c197895aa270052d21e378f3a854/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_template_transform.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_template_transform.ts?ref=9478cda83b64c197895aa270052d21e378f3a854",
            "patch": "@@ -458,6 +458,8 @@ class HtmlAstToIvyAst implements html.Visitor {\n       this.reportError(`\"-\" is not allowed in reference names`, sourceSpan);\n     } else if (identifier.length === 0) {\n       this.reportError(`Reference does not have a name`, sourceSpan);\n+    } else if (references.some(reference => reference.name === identifier)) {\n+      this.reportError(`Reference \"#${identifier}\" is defined more than once`, sourceSpan);\n     }\n \n     references.push(new t.Reference(identifier, value, sourceSpan, keySpan, valueSpan));"
        },
        {
            "sha": "cf1cfb40bf443ba3ecc4b4de2f4ca6176c9ebdf6",
            "filename": "packages/compiler/test/render3/r3_template_transform_spec.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/9478cda83b64c197895aa270052d21e378f3a854/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_template_transform_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/9478cda83b64c197895aa270052d21e378f3a854/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_template_transform_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_template_transform_spec.ts?ref=9478cda83b64c197895aa270052d21e378f3a854",
            "patch": "@@ -273,6 +273,11 @@ describe('R3 template transform', () => {\n       ]);\n     });\n \n+    it('should report an error if a reference is used multiple times on the same template', () => {\n+      expect(() => parse('<ng-template #a #a></ng-template>'))\n+          .toThrowError(/Reference \"#a\" is defined more than once/);\n+    });\n+\n     it('should parse variables via let-...', () => {\n       expectFromHtml('<ng-template let-a=\"b\"></ng-template>').toEqual([\n         ['Template'],\n@@ -463,6 +468,11 @@ describe('R3 template transform', () => {\n     it('should report missing reference names', () => {\n       expect(() => parse('<div #></div>')).toThrowError(/Reference does not have a name/);\n     });\n+\n+    it('should report an error if a reference is used multiple times on the same element', () => {\n+      expect(() => parse('<div #a #a></div>'))\n+          .toThrowError(/Reference \"#a\" is defined more than once/);\n+    });\n   });\n \n   describe('literal attribute', () => {"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 12,
        "deletions": 0
    }
}