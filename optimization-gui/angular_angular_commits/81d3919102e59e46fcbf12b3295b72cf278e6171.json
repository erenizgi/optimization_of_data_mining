{
    "author": "gkalpak",
    "message": "refactor(docs-infra): prefix error messages with Angular version info (#43686)\n\nPrefix error messages with the Angular version currently used in the\nangular.io app. This applies to both errors logged to the console and\nreported to Google Analytics and makes debugging certain errors easier.\n\nPR Close #43686",
    "sha": "81d3919102e59e46fcbf12b3295b72cf278e6171",
    "files": [
        {
            "sha": "e4f10196951fccb1839d4afa1bae587d06ce73e2",
            "filename": "aio/src/app/shared/reporting-error-handler.spec.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 4,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/81d3919102e59e46fcbf12b3295b72cf278e6171/aio%2Fsrc%2Fapp%2Fshared%2Freporting-error-handler.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81d3919102e59e46fcbf12b3295b72cf278e6171/aio%2Fsrc%2Fapp%2Fshared%2Freporting-error-handler.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fshared%2Freporting-error-handler.spec.ts?ref=81d3919102e59e46fcbf12b3295b72cf278e6171",
            "patch": "@@ -1,4 +1,4 @@\n-import { ErrorHandler, Injector } from '@angular/core';\n+import { ErrorHandler, Injector, VERSION } from '@angular/core';\n import { TestBed } from '@angular/core/testing';\n import { WindowToken } from 'app/shared/window';\n import { AppModule } from 'app/app.module';\n@@ -46,10 +46,27 @@ describe('ReportingErrorHandler service', () => {\n       expect(onerrorSpy.calls.argsFor(0)[4]).toEqual(jasmine.any(Error));\n \n       // Then error from initial exception\n-      expect(onerrorSpy.calls.argsFor(1)[0]).toEqual('initial error');\n+      expect(onerrorSpy.calls.argsFor(1)[0]).toEqual(`[v${VERSION.full}] initial error`);\n       expect(onerrorSpy.calls.argsFor(1)[4]).toEqual(error);\n     });\n \n+    it('should augment an error object with version info', () => {\n+      const originalMessage = 'this is an error message';\n+      const error = new Error(originalMessage);\n+\n+      expect(error.message).toBe(originalMessage);\n+      if (error.stack) {\n+        expect(error.stack).toContain(originalMessage);\n+      }\n+\n+      handler.handleError(error);\n+\n+      expect(error.message).toBe(`[v${VERSION.full}] ${originalMessage}`);\n+      if (error.stack) {\n+        expect(error.stack).toContain(`[v${VERSION.full}] ${originalMessage}`);\n+      }\n+    });\n+\n     it('should send an error object to window.onerror', () => {\n       const error = new Error('this is an error message');\n       handler.handleError(error);\n@@ -72,10 +89,10 @@ describe('ReportingErrorHandler service', () => {\n       expect(onerrorSpy).toHaveBeenCalledWith('{reason: this is an error message}');\n     });\n \n-    it('should send an error string to window.onerror', () => {\n+    it('should send an error string to window.onerror (prefixed with version info)', () => {\n       const error = 'this is an error message';\n       handler.handleError(error);\n-      expect(onerrorSpy).toHaveBeenCalledWith(error);\n+      expect(onerrorSpy).toHaveBeenCalledWith(`[v${VERSION.full}] ${error}`);\n     });\n \n     it('should send a non-object, non-string error stringified to window.onerror', () => {"
        },
        {
            "sha": "a13eba3410c77e2100b84fc10e6cbdbf3ad1cb37",
            "filename": "aio/src/app/shared/reporting-error-handler.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 3,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/81d3919102e59e46fcbf12b3295b72cf278e6171/aio%2Fsrc%2Fapp%2Fshared%2Freporting-error-handler.ts",
            "raw_url": "https://github.com/angular/angular/raw/81d3919102e59e46fcbf12b3295b72cf278e6171/aio%2Fsrc%2Fapp%2Fshared%2Freporting-error-handler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fshared%2Freporting-error-handler.ts?ref=81d3919102e59e46fcbf12b3295b72cf278e6171",
            "patch": "@@ -1,4 +1,4 @@\n-import { ErrorHandler, Inject, Injectable } from '@angular/core';\n+import { ErrorHandler, Inject, Injectable, VERSION } from '@angular/core';\n import { WindowToken } from './window';\n \n /**\n@@ -19,12 +19,29 @@ export class ReportingErrorHandler extends ErrorHandler {\n    * @param error Information about the error.\n    */\n   handleError(error: any) {\n+    const versionedError = this.prefixErrorWithVersion(error);\n+\n     try {\n-      super.handleError(error);\n+      super.handleError(versionedError);\n     } catch (e) {\n       this.reportError(e);\n     }\n-    this.reportError(error);\n+    this.reportError(versionedError);\n+  }\n+\n+  private prefixErrorWithVersion<T>(error: T): T {\n+    const prefix = `[v${VERSION.full}] `;\n+\n+    if (error instanceof Error) {\n+      const oldMessage = error.message;\n+      error.message = prefix + oldMessage;\n+      error.stack = error.stack?.replace(oldMessage, error.message);\n+    } else if (typeof error === 'string') {\n+      error = prefix + error as unknown as T;\n+    }\n+    // If it is a different type, omit the version to avoid altering the original `error` object.\n+\n+    return error;\n   }\n \n   private reportError(error: unknown) {"
        },
        {
            "sha": "d7013865167d159108f1f465f93d355c2a210ead",
            "filename": "goldens/size-tracking/aio-payloads.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/81d3919102e59e46fcbf12b3295b72cf278e6171/goldens%2Fsize-tracking%2Faio-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/81d3919102e59e46fcbf12b3295b72cf278e6171/goldens%2Fsize-tracking%2Faio-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Faio-payloads.json?ref=81d3919102e59e46fcbf12b3295b72cf278e6171",
            "patch": "@@ -3,7 +3,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime\": 4454,\n-        \"main\": 461446,\n+        \"main\": 461726,\n         \"polyfills\": 55658,\n         \"styles\": 69935,\n         \"light-theme\": 77426,\n@@ -15,7 +15,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime\": 4454,\n-        \"main\": 460460,\n+        \"main\": 460478,\n         \"polyfills\": 55807,\n         \"styles\": 69935,\n         \"light-theme\": 77426,"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 43,
        "deletions": 9
    }
}