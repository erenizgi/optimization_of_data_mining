{
    "author": "dylhunn",
    "message": "refactor(forms): Move FormControl to an overridden exported constructor. (#44316)\n\nThis implementation change was originally proposed as part of Typed Forms, and will have major consequences for that project as described in the design doc. Submitting it separately will greatly simplify the risk of landing Typed Forms. This change should have no visible impact on normal users of FormControl.\n\nSee the Typed Forms design doc here: https://docs.google.com/document/d/1cWuBE-oo5WLtwkLFxbNTiaVQGNk8ipgbekZcKBeyxxo.\n\nPR Close #44316",
    "sha": "cdf50ff9318ff5cdb4cbb1272d9113de8160065c",
    "files": [
        {
            "sha": "f1f99d9f3d3d5e8189ce52894241e6d449b9945d",
            "filename": "goldens/public-api/forms/forms.md",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/cdf50ff9318ff5cdb4cbb1272d9113de8160065c/goldens%2Fpublic-api%2Fforms%2Fforms.md",
            "raw_url": "https://github.com/angular/angular/raw/cdf50ff9318ff5cdb4cbb1272d9113de8160065c/goldens%2Fpublic-api%2Fforms%2Fforms.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fforms%2Fforms.md?ref=cdf50ff9318ff5cdb4cbb1272d9113de8160065c",
            "patch": "@@ -293,8 +293,7 @@ export class FormBuilder {\n }\n \n // @public\n-export class FormControl extends AbstractControl {\n-    constructor(formState?: any, validatorOrOpts?: ValidatorFn | ValidatorFn[] | AbstractControlOptions | null, asyncValidator?: AsyncValidatorFn | AsyncValidatorFn[] | null);\n+export interface FormControl extends AbstractControl {\n     patchValue(value: any, options?: {\n         onlySelf?: boolean;\n         emitEvent?: boolean;\n@@ -315,6 +314,15 @@ export class FormControl extends AbstractControl {\n     }): void;\n }\n \n+// @public (undocumented)\n+export const FormControl: FormControlCtor;\n+\n+// @public\n+export interface FormControlCtor {\n+    new (): FormControl;\n+    new (value: any, validatorOrOpts?: ValidatorFn | ValidatorFn[] | AbstractControlOptions | null, asyncValidator?: AsyncValidatorFn | AsyncValidatorFn[] | null): FormControl;\n+}\n+\n // @public\n export class FormControlDirective extends NgControl implements OnChanges, OnDestroy {\n     constructor(validators: (Validator | ValidatorFn)[], asyncValidators: (AsyncValidator | AsyncValidatorFn)[], valueAccessors: ControlValueAccessor[], _ngModelWarningConfig: string | null);"
        },
        {
            "sha": "3258697e57495b89c6f559b5379e83cbf8894a60",
            "filename": "packages/forms/src/forms.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/cdf50ff9318ff5cdb4cbb1272d9113de8160065c/packages%2Fforms%2Fsrc%2Fforms.ts",
            "raw_url": "https://github.com/angular/angular/raw/cdf50ff9318ff5cdb4cbb1272d9113de8160065c/packages%2Fforms%2Fsrc%2Fforms.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Fsrc%2Fforms.ts?ref=cdf50ff9318ff5cdb4cbb1272d9113de8160065c",
            "patch": "@@ -43,7 +43,7 @@ export {NgSelectOption, SelectControlValueAccessor} from './directives/select_co\n export {SelectMultipleControlValueAccessor, ÉµNgSelectMultipleOption} from './directives/select_multiple_control_value_accessor';\n export {AsyncValidator, AsyncValidatorFn, CheckboxRequiredValidator, EmailValidator, MaxLengthValidator, MaxValidator, MinLengthValidator, MinValidator, PatternValidator, RequiredValidator, ValidationErrors, Validator, ValidatorFn} from './directives/validators';\n export {FormBuilder} from './form_builder';\n-export {AbstractControl, AbstractControlOptions, FormArray, FormControl, FormControlStatus, FormGroup} from './model';\n+export {AbstractControl, AbstractControlOptions, FormArray, FormControl, FormControlCtor, FormControlStatus, FormGroup} from './model';\n export {NG_ASYNC_VALIDATORS, NG_VALIDATORS, Validators} from './validators';\n export {VERSION} from './version';\n "
        },
        {
            "sha": "4bcf7847812e1d9ac041acc71b83a31b281d2334",
            "filename": "packages/forms/src/model.ts",
            "status": "modified",
            "additions": 151,
            "deletions": 61,
            "changes": 212,
            "blob_url": "https://github.com/angular/angular/blob/cdf50ff9318ff5cdb4cbb1272d9113de8160065c/packages%2Fforms%2Fsrc%2Fmodel.ts",
            "raw_url": "https://github.com/angular/angular/raw/cdf50ff9318ff5cdb4cbb1272d9113de8160065c/packages%2Fforms%2Fsrc%2Fmodel.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Fsrc%2Fmodel.ts?ref=cdf50ff9318ff5cdb4cbb1272d9113de8160065c",
            "patch": "@@ -1118,7 +1118,6 @@ export abstract class AbstractControl {\n       this._updateOn = opts.updateOn!;\n     }\n   }\n-\n   /**\n    * Check to see if parent has been marked artificially dirty.\n    *\n@@ -1131,13 +1130,15 @@ export abstract class AbstractControl {\n }\n \n /**\n- * Tracks the value and validation status of an individual form control.\n+ * Tracks the value and validation status of an individual form control. Constructed by {@link\n+ * FormControlCtor}.\n  *\n  * This is one of the three fundamental building blocks of Angular forms, along with\n  * `FormGroup` and `FormArray`. It extends the `AbstractControl` class that\n  * implements most of the base functionality for accessing the value, validation status,\n  * user interactions and events. See [usage examples below](#usage-notes).\n  *\n+ * @see FormControlCtor\n  * @see `AbstractControl`\n  * @see [Reactive Forms Guide](guide/reactive-forms)\n  * @see [Usage Notes](#usage-notes)\n@@ -1151,7 +1152,7 @@ export abstract class AbstractControl {\n  * ```ts\n  * const control = new FormControl('some value');\n  * console.log(control.value);     // 'some value'\n- *```\n+ * ```\n  *\n  * The following example initializes the control with a form state object. The `value`\n  * and `disabled` keys are required in this case.\n@@ -1227,46 +1228,15 @@ export abstract class AbstractControl {\n  *\n  * @publicApi\n  */\n-export class FormControl extends AbstractControl {\n+export declare interface FormControl extends AbstractControl {\n   /** @internal */\n-  _onChange: Function[] = [];\n+  _onChange: Function[];\n \n   /** @internal */\n-  _pendingValue: any;\n+  _pendingValue: boolean;\n \n   /** @internal */\n-  _pendingChange: any;\n-\n-  /**\n-   * Creates a new `FormControl` instance.\n-   *\n-   * @param formState Initializes the control with an initial value,\n-   * or an object that defines the initial value and disabled state.\n-   *\n-   * @param validatorOrOpts A synchronous validator function, or an array of\n-   * such functions, or an `AbstractControlOptions` object that contains validation functions\n-   * and a validation trigger.\n-   *\n-   * @param asyncValidator A single async validator or array of async validator functions\n-   *\n-   */\n-  constructor(\n-      formState: any = null,\n-      validatorOrOpts?: ValidatorFn|ValidatorFn[]|AbstractControlOptions|null,\n-      asyncValidator?: AsyncValidatorFn|AsyncValidatorFn[]|null) {\n-    super(pickValidators(validatorOrOpts), pickAsyncValidators(asyncValidator, validatorOrOpts));\n-    this._applyFormState(formState);\n-    this._setUpdateStrategy(validatorOrOpts);\n-    this._initObservables();\n-    this.updateValueAndValidity({\n-      onlySelf: true,\n-      // If `asyncValidator` is present, it will trigger control status change from `PENDING` to\n-      // `VALID` or `INVALID`.\n-      // The status should be broadcasted via the `statusChanges` observable, so we set `emitEvent`\n-      // to `true` to allow that during the control creation process.\n-      emitEvent: !!this.asyncValidator\n-    });\n-  }\n+  _pendingChange: boolean;\n \n   /**\n    * Sets a new value for the form control.\n@@ -1291,19 +1261,12 @@ export class FormControl extends AbstractControl {\n    * event to update the model.\n    *\n    */\n-  override setValue(value: any, options: {\n+  setValue(value: any, options?: {\n     onlySelf?: boolean,\n     emitEvent?: boolean,\n     emitModelToViewChange?: boolean,\n     emitViewToModelChange?: boolean\n-  } = {}): void {\n-    (this as {value: any}).value = this._pendingValue = value;\n-    if (this._onChange.length && options.emitModelToViewChange !== false) {\n-      this._onChange.forEach(\n-          (changeFn) => changeFn(this.value, options.emitViewToModelChange !== false));\n-    }\n-    this.updateValueAndValidity(options);\n-  }\n+  }): void;\n \n   /**\n    * Patches the value of a control.\n@@ -1314,14 +1277,12 @@ export class FormControl extends AbstractControl {\n    *\n    * @see `setValue` for options\n    */\n-  override patchValue(value: any, options: {\n+  patchValue(value: any, options?: {\n     onlySelf?: boolean,\n     emitEvent?: boolean,\n     emitModelToViewChange?: boolean,\n     emitViewToModelChange?: boolean\n-  } = {}): void {\n-    this.setValue(value, options);\n-  }\n+  }): void;\n \n   /**\n    * Resets the form control, marking it `pristine` and `untouched`, and setting\n@@ -1341,6 +1302,141 @@ export class FormControl extends AbstractControl {\n    * When false, no events are emitted.\n    *\n    */\n+  reset(formState?: any, options?: {onlySelf?: boolean, emitEvent?: boolean}): void;\n+\n+  /**\n+   * @internal\n+   */\n+  _updateValue(): void;\n+\n+  /**\n+   * @internal\n+   */\n+  _anyControls(condition: Function): boolean;\n+\n+  /**\n+   * @internal\n+   */\n+  _allControlsDisabled(): boolean;\n+\n+  /**\n+   * Register a listener for change events.\n+   *\n+   * @param fn The method that is called when the value changes\n+   */\n+  registerOnChange(fn: Function): void;\n+\n+  /**\n+   * Internal function to unregister a change events listener.\n+   * @internal\n+   */\n+  _unregisterOnChange(fn: Function): void;\n+\n+  /**\n+   * Register a listener for disabled events.\n+   *\n+   * @param fn The method that is called when the disabled status changes.\n+   */\n+  registerOnDisabledChange(fn: (isDisabled: boolean) => void): void;\n+\n+  /**\n+   * Internal function to unregister a disabled event listener.\n+   * @internal\n+   */\n+  _unregisterOnDisabledChange(fn: (isDisabled: boolean) => void): void;\n+\n+  /**\n+   * @internal\n+   */\n+  _forEachChild(cb: Function): void;\n+\n+  /** @internal */\n+  _syncPendingControls(): boolean;\n+}\n+\n+/**\n+ * Various available constructors for `FormControl`.\n+ *\n+ * ```\n+ * let fc = new FormControl('foo');\n+ * ```\n+ *\n+ * {@link FormControl}\n+ * @publicApi\n+ */\n+export declare interface FormControlCtor {\n+  /**\n+   * Construct a FormControl with no initial value or validators.\n+   */\n+  new(): FormControl;\n+\n+  /**\n+   * Creates a new `FormControl` instance.\n+   *\n+   * @param formState Initializes the control with an initial value,\n+   * or an object that defines the initial value and disabled state.\n+   *\n+   * @param validatorOrOpts A synchronous validator function, or an array of\n+   * such functions, or an `AbstractControlOptions` object that contains validation functions\n+   * and a validation trigger.\n+   *\n+   * @param asyncValidator A single async validator or array of async validator functions\n+   */\n+  new(value: any, validatorOrOpts?: ValidatorFn|ValidatorFn[]|AbstractControlOptions|null,\n+      asyncValidator?: AsyncValidatorFn|AsyncValidatorFn[]|null): FormControl;\n+}\n+\n+export class FormControlImpl extends AbstractControl {\n+  /** @internal */\n+  _onChange: Function[] = [];\n+\n+  /** @internal */\n+  _pendingValue: boolean = false;\n+\n+  /** @internal */\n+  _pendingChange: boolean = false;\n+\n+  constructor(\n+      formState: any = null,\n+      validatorOrOpts?: ValidatorFn|ValidatorFn[]|AbstractControlOptions|null,\n+      asyncValidator?: AsyncValidatorFn|AsyncValidatorFn[]|null) {\n+    super(pickValidators(validatorOrOpts), pickAsyncValidators(asyncValidator, validatorOrOpts));\n+    this._applyFormState(formState);\n+    this._setUpdateStrategy(validatorOrOpts);\n+    this._initObservables();\n+    this.updateValueAndValidity({\n+      onlySelf: true,\n+      // If `asyncValidator` is present, it will trigger control status change from `PENDING` to\n+      // `VALID` or `INVALID`.\n+      // The status should be broadcasted via the `statusChanges` observable, so we set `emitEvent`\n+      // to `true` to allow that during the control creation process.\n+      emitEvent: !!this.asyncValidator\n+    });\n+  }\n+\n+  override setValue(value: any, options: {\n+    onlySelf?: boolean,\n+    emitEvent?: boolean,\n+    emitModelToViewChange?: boolean,\n+    emitViewToModelChange?: boolean\n+  } = {}): void {\n+    (this as {value: any}).value = this._pendingValue = value;\n+    if (this._onChange.length && options.emitModelToViewChange !== false) {\n+      this._onChange.forEach(\n+          (changeFn) => changeFn(this.value, options.emitViewToModelChange !== false));\n+    }\n+    this.updateValueAndValidity(options);\n+  }\n+\n+  override patchValue(value: any, options: {\n+    onlySelf?: boolean,\n+    emitEvent?: boolean,\n+    emitModelToViewChange?: boolean,\n+    emitViewToModelChange?: boolean\n+  } = {}): void {\n+    this.setValue(value, options);\n+  }\n+\n   override reset(formState: any = null, options: {onlySelf?: boolean, emitEvent?: boolean} = {}):\n       void {\n     this._applyFormState(formState);\n@@ -1369,11 +1465,6 @@ export class FormControl extends AbstractControl {\n     return this.disabled;\n   }\n \n-  /**\n-   * Register a listener for change events.\n-   *\n-   * @param fn The method that is called when the value changes\n-   */\n   registerOnChange(fn: Function): void {\n     this._onChange.push(fn);\n   }\n@@ -1386,11 +1477,6 @@ export class FormControl extends AbstractControl {\n     removeListItem(this._onChange, fn);\n   }\n \n-  /**\n-   * Register a listener for disabled events.\n-   *\n-   * @param fn The method that is called when the disabled status changes.\n-   */\n   registerOnDisabledChange(fn: (isDisabled: boolean) => void): void {\n     this._onDisabledChange.push(fn);\n   }\n@@ -1432,6 +1518,10 @@ export class FormControl extends AbstractControl {\n   }\n }\n \n+// The constructor for FormControl is decoupled from its implementation.\n+// This allows us to provide multiple constructor signatures.\n+export const FormControl: FormControlCtor = FormControlImpl as FormControlCtor;\n+\n /**\n  * Tracks the value and validity state of a group of `FormControl` instances.\n  *"
        },
        {
            "sha": "f0e664b0aa4bfc28f2fdfbcd17f4b89f40802681",
            "filename": "packages/forms/test/form_control_spec.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 1,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/cdf50ff9318ff5cdb4cbb1272d9113de8160065c/packages%2Fforms%2Ftest%2Fform_control_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cdf50ff9318ff5cdb4cbb1272d9113de8160065c/packages%2Fforms%2Ftest%2Fform_control_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Ftest%2Fform_control_spec.ts?ref=cdf50ff9318ff5cdb4cbb1272d9113de8160065c",
            "patch": "@@ -8,8 +8,8 @@\n \n import {fakeAsync, tick} from '@angular/core/testing';\n import {FormControl, FormGroup, Validators} from '@angular/forms';\n-\n import {FormArray} from '@angular/forms/src/model';\n+\n import {asyncValidator, asyncValidatorReturningObservable} from './util';\n \n (function() {\n@@ -1469,5 +1469,24 @@ describe('FormControl', () => {\n       });\n     });\n   });\n+\n+  describe('can be extended', () => {\n+    // We don't technically support extending Forms classes, but people do it anyway.\n+    // We need to make sure that there is some way to extend them to avoid causing breakage.\n+\n+    class FCExt extends FormControl {\n+      constructor(formState?: any|{\n+        value?: any;\n+        disabled?: boolean;\n+      }, ...args: any) {\n+        super(formState, ...args);\n+      }\n+    }\n+\n+    it('should perform basic FormControl operations', () => {\n+      const nc = new FCExt({value: 'foo'});\n+      nc.setValue('bar');\n+    });\n+  });\n });\n })();"
        }
    ],
    "stats": {
        "total": 247,
        "additions": 182,
        "deletions": 65
    }
}