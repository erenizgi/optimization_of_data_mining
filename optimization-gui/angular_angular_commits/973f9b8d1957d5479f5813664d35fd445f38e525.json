{
    "author": "petebacondarwin",
    "message": "test(compiler): check `fullStart` source-span (#42062)\n\nThe tests were checking that the source-span of parsed HTML nodes were\naccurate, but they were not checking the span when it includes the\n\"leading trivia\", which are given by the `fullStart` rather than `start`\nlocation.\n\nPR Close #42062",
    "sha": "973f9b8d1957d5479f5813664d35fd445f38e525",
    "files": [
        {
            "sha": "ce8b6750fd746971acd6284ecfaff0be86c7f5b5",
            "filename": "packages/compiler/test/ml_parser/ast_spec_utils.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/973f9b8d1957d5479f5813664d35fd445f38e525/packages%2Fcompiler%2Ftest%2Fml_parser%2Fast_spec_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/973f9b8d1957d5479f5813664d35fd445f38e525/packages%2Fcompiler%2Ftest%2Fml_parser%2Fast_spec_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fml_parser%2Fast_spec_utils.ts?ref=973f9b8d1957d5479f5813664d35fd445f38e525",
            "patch": "@@ -87,6 +87,10 @@ class _Humanizer implements html.Visitor {\n   private _appendContext(ast: html.Node, input: any[]): any[] {\n     if (!this.includeSourceSpan) return input;\n     input.push(ast.sourceSpan.toString());\n+    if (ast.sourceSpan.fullStart.offset !== ast.sourceSpan.start.offset) {\n+      input.push(ast.sourceSpan.fullStart.file.content.substring(\n+          ast.sourceSpan.fullStart.offset, ast.sourceSpan.end.offset));\n+    }\n     return input;\n   }\n }"
        },
        {
            "sha": "01562f53cf24581f70b03075b56a27e23491d7d8",
            "filename": "packages/compiler/test/ml_parser/html_parser_spec.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 16,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/973f9b8d1957d5479f5813664d35fd445f38e525/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_parser_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/973f9b8d1957d5479f5813664d35fd445f38e525/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_parser_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_parser_spec.ts?ref=973f9b8d1957d5479f5813664d35fd445f38e525",
            "patch": "@@ -798,22 +798,23 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn, humanizeNodes}\n           ]);\n         });\n \n-        it('should set the end source span excluding trailing whitespace whitespace', () => {\n-          expect(humanizeDomSourceSpans(\n-                     parser.parse('<input type=\"text\" />\\n\\n\\n  <span>\\n</span>', 'TestComp', {\n-                       leadingTriviaChars: [' ', '\\n', '\\r', '\\t'],\n-                     })))\n-              .toEqual([\n-                [\n-                  html.Element, 'input', 0, '<input type=\"text\" />', '<input type=\"text\" />',\n-                  '<input type=\"text\" />'\n-                ],\n-                [html.Attribute, 'type', 'text', ['text'], 'type=\"text\"'],\n-                [html.Text, '\\n\\n\\n  ', 0, ['\\n\\n\\n  '], ''],\n-                [html.Element, 'span', 0, '<span>\\n</span>', '<span>', '</span>'],\n-                [html.Text, '\\n', 1, ['\\n'], ''],\n-              ]);\n-        });\n+        it('should not include leading trivia from the following node of an element in the end source',\n+           () => {\n+             expect(humanizeDomSourceSpans(\n+                        parser.parse('<input type=\"text\" />\\n\\n\\n  <span>\\n</span>', 'TestComp', {\n+                          leadingTriviaChars: [' ', '\\n', '\\r', '\\t'],\n+                        })))\n+                 .toEqual([\n+                   [\n+                     html.Element, 'input', 0, '<input type=\"text\" />', '<input type=\"text\" />',\n+                     '<input type=\"text\" />'\n+                   ],\n+                   [html.Attribute, 'type', 'text', ['text'], 'type=\"text\"'],\n+                   [html.Text, '\\n\\n\\n  ', 0, ['\\n\\n\\n  '], '', '\\n\\n\\n  '],\n+                   [html.Element, 'span', 0, '<span>\\n</span>', '<span>', '</span>'],\n+                   [html.Text, '\\n', 1, ['\\n'], '', '\\n'],\n+                 ]);\n+           });\n \n         it('should not set the end source span for elements that are implicitly closed', () => {\n           expect(humanizeDomSourceSpans(parser.parse('<div><p></div>', 'TestComp'))).toEqual(["
        }
    ],
    "stats": {
        "total": 37,
        "additions": 21,
        "deletions": 16
    }
}