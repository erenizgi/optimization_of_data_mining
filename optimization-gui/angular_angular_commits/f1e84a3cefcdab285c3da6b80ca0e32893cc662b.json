{
    "author": "atscott",
    "message": "fix(compiler-cli): properly index <svg> elements when on a template (#44785)\n\nThe original fix for svg elements in\nhttps://github.com/angular/angular/commit/92b23f48519a1adb460a431c356bcd9917fb059d\ndid not account for svg elements when they also had a structural\ndirective on them, making the node a template. This resulted in the\nlogic added in fix above not being applied.\n\nPR Close #44785",
    "sha": "f1e84a3cefcdab285c3da6b80ca0e32893cc662b",
    "files": [
        {
            "sha": "a49fe6f2be0c0c01ddd4bed1b24177405f041226",
            "filename": "packages/compiler-cli/src/ngtsc/indexer/src/template.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 9,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/f1e84a3cefcdab285c3da6b80ca0e32893cc662b/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Ftemplate.ts",
            "raw_url": "https://github.com/angular/angular/raw/f1e84a3cefcdab285c3da6b80ca0e32893cc662b/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Ftemplate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Ftemplate.ts?ref=f1e84a3cefcdab285c3da6b80ca0e32893cc662b",
            "patch": "@@ -232,17 +232,16 @@ class TemplateVisitor extends TmplAstRecursiveVisitor {\n       name = node.tagName;\n       kind = IdentifierKind.Template;\n     } else {\n-      // Namespaced elements have a particular format for `node.name` that needs to be handled.\n-      // For example, an `<svg>` element has a `node.name` of `':svg:svg'`.\n-\n-      // TODO(alxhub): properly handle namespaced elements\n-      if (node.name.startsWith(':')) {\n-        name = node.name.split(':').pop()!;\n-      } else {\n-        name = node.name;\n-      }\n+      name = node.name;\n       kind = IdentifierKind.Element;\n     }\n+    // Namespaced elements have a particular format for `node.name` that needs to be handled.\n+    // For example, an `<svg>` element has a `node.name` of `':svg:svg'`.\n+    // TODO(alxhub): properly handle namespaced elements\n+    if (name.startsWith(':')) {\n+      name = name.split(':').pop()!;\n+    }\n+\n     const sourceSpan = node.startSourceSpan;\n     // An element's or template's source span can be of the form `<element>`, `<element />`, or\n     // `<element></element>`. Only the selector is interesting to the indexer, so the source is"
        },
        {
            "sha": "eb05a494e9bc7cd02b798aebd9cfddaa46aa62f8",
            "filename": "packages/compiler-cli/src/ngtsc/indexer/test/template_spec.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/f1e84a3cefcdab285c3da6b80ca0e32893cc662b/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Ftest%2Ftemplate_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/f1e84a3cefcdab285c3da6b80ca0e32893cc662b/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Ftest%2Ftemplate_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Ftest%2Ftemplate_spec.ts?ref=f1e84a3cefcdab285c3da6b80ca0e32893cc662b",
            "patch": "@@ -35,6 +35,20 @@ runInEachFileSystem(() => {\n       });\n     });\n \n+    it('should handle svg elements on templates', () => {\n+      const template = '<svg *ngIf=\"true\"></svg>';\n+      const refs = getTemplateIdentifiers(bind(template));\n+\n+      const [ref] = Array.from(refs);\n+      expect(ref).toEqual({\n+        kind: IdentifierKind.Template,\n+        name: 'svg',\n+        span: new AbsoluteSourceSpan(1, 4),\n+        usedDirectives: new Set(),\n+        attributes: new Set(),\n+      });\n+    });\n+\n     it('should handle comments in interpolations', () => {\n       const template = '{{foo // comment}}';\n       const refs = getTemplateIdentifiers(bind(template));"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 22,
        "deletions": 9
    }
}