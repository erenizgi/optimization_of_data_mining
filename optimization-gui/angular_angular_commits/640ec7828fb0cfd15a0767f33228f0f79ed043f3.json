{
    "author": "va-stefanek",
    "message": "refactor(common): change missing NgSwitch provider error message (#41704)\n\nchange error message of invalid NgSwitch use and add corner cases tests\n\nPR Close #41704",
    "sha": "640ec7828fb0cfd15a0767f33228f0f79ed043f3",
    "files": [
        {
            "sha": "cb67f7583efd93f9bd02e3a0c561a0996f1757f3",
            "filename": "packages/common/src/directives/ng_switch.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 3,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/640ec7828fb0cfd15a0767f33228f0f79ed043f3/packages%2Fcommon%2Fsrc%2Fdirectives%2Fng_switch.ts",
            "raw_url": "https://github.com/angular/angular/raw/640ec7828fb0cfd15a0767f33228f0f79ed043f3/packages%2Fcommon%2Fsrc%2Fdirectives%2Fng_switch.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Fdirectives%2Fng_switch.ts?ref=640ec7828fb0cfd15a0767f33228f0f79ed043f3",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Directive, DoCheck, Host, Input, TemplateRef, ViewContainerRef} from '@angular/core';\n+import {Directive, DoCheck, Host, Input, Optional, TemplateRef, ViewContainerRef, ɵRuntimeError as RuntimeError, ɵRuntimeErrorCode as RuntimeErrorCode} from '@angular/core';\n \n export class SwitchView {\n   private _created = false;\n@@ -197,7 +197,11 @@ export class NgSwitchCase implements DoCheck {\n \n   constructor(\n       viewContainer: ViewContainerRef, templateRef: TemplateRef<Object>,\n-      @Host() private ngSwitch: NgSwitch) {\n+      @Optional() @Host() private ngSwitch: NgSwitch) {\n+    if ((typeof ngDevMode === 'undefined' || ngDevMode) && !ngSwitch) {\n+      throwNgSwitchProviderNotFoundError('ngSwitchCase', 'NgSwitchCase');\n+    }\n+\n     ngSwitch._addCase();\n     this._view = new SwitchView(viewContainer, templateRef);\n   }\n@@ -228,7 +232,20 @@ export class NgSwitchCase implements DoCheck {\n export class NgSwitchDefault {\n   constructor(\n       viewContainer: ViewContainerRef, templateRef: TemplateRef<Object>,\n-      @Host() ngSwitch: NgSwitch) {\n+      @Optional() @Host() ngSwitch: NgSwitch) {\n+    if ((typeof ngDevMode === 'undefined' || ngDevMode) && !ngSwitch) {\n+      throwNgSwitchProviderNotFoundError('ngSwitchDefault', 'NgSwitchDefault');\n+    }\n+\n     ngSwitch._addDefault(new SwitchView(viewContainer, templateRef));\n   }\n }\n+\n+function throwNgSwitchProviderNotFoundError(attrName: string, directiveName: string): never {\n+  throw new RuntimeError(\n+      RuntimeErrorCode.TEMPLATE_STRUCTURE_ERROR,\n+      `An element with the \"${attrName}\" attribute ` +\n+          `(matching the \"${\n+              directiveName}\" directive) must be located inside an element with the \"ngSwitch\" attribute ` +\n+          `(matching \"NgSwitch\" directive)`);\n+}"
        },
        {
            "sha": "e7c8bd5983e51d2a24603beb781a250e3204d54f",
            "filename": "packages/common/test/directives/ng_switch_spec.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 2,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/640ec7828fb0cfd15a0767f33228f0f79ed043f3/packages%2Fcommon%2Ftest%2Fdirectives%2Fng_switch_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/640ec7828fb0cfd15a0767f33228f0f79ed043f3/packages%2Fcommon%2Ftest%2Fdirectives%2Fng_switch_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Ftest%2Fdirectives%2Fng_switch_spec.ts?ref=640ec7828fb0cfd15a0767f33228f0f79ed043f3",
            "patch": "@@ -7,8 +7,8 @@\n  */\n \n import {CommonModule} from '@angular/common';\n-import {Attribute, Component, Directive, TemplateRef, ViewChild} from '@angular/core';\n-import {ComponentFixture, TestBed} from '@angular/core/testing';\n+import {Attribute, Component, Directive, TemplateRef, ViewChild,} from '@angular/core';\n+import {ComponentFixture, TestBed, waitForAsync} from '@angular/core/testing';\n import {expect} from '@angular/platform-browser/testing/src/matchers';\n \n {\n@@ -176,6 +176,24 @@ import {expect} from '@angular/platform-browser/testing/src/matchers';\n         detectChangesAndExpectText('when b1;when b2;');\n       });\n \n+      it('should throw error when ngSwitchCase is used outside of ngSwitch', waitForAsync(() => {\n+           const template = '<div [ngSwitch]=\"switchValue\"></div>' +\n+               '<div *ngSwitchCase=\"\\'a\\'\"></div>';\n+\n+           expect(() => createTestComponent(template))\n+               .toThrowError(\n+                   'NG0305: An element with the \"ngSwitchCase\" attribute (matching the \"NgSwitchCase\" directive) must be located inside an element with the \"ngSwitch\" attribute (matching \"NgSwitch\" directive)');\n+         }));\n+\n+      it('should throw error when ngSwitchDefault is used outside of ngSwitch', waitForAsync(() => {\n+           const template = '<div [ngSwitch]=\"switchValue\"></div>' +\n+               '<div *ngSwitchDefault></div>';\n+\n+           expect(() => createTestComponent(template))\n+               .toThrowError(\n+                   'NG0305: An element with the \"ngSwitchDefault\" attribute (matching the \"NgSwitchDefault\" directive) must be located inside an element with the \"ngSwitch\" attribute (matching \"NgSwitch\" directive)');\n+         }));\n+\n       it('should support nested NgSwitch on ng-container with ngTemplateOutlet', () => {\n         fixture = TestBed.createComponent(ComplexComponent);\n         detectChangesAndExpectText('Foo');"
        },
        {
            "sha": "f7ae0203add62ff77dea074e4d1f68cbc0318f46",
            "filename": "packages/core/src/core_private_export.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/640ec7828fb0cfd15a0767f33228f0f79ed043f3/packages%2Fcore%2Fsrc%2Fcore_private_export.ts",
            "raw_url": "https://github.com/angular/angular/raw/640ec7828fb0cfd15a0767f33228f0f79ed043f3/packages%2Fcore%2Fsrc%2Fcore_private_export.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcore_private_export.ts?ref=640ec7828fb0cfd15a0767f33228f0f79ed043f3",
            "patch": "@@ -24,6 +24,7 @@ export {CodegenComponentFactoryResolver as ɵCodegenComponentFactoryResolver} fr\n export {clearResolutionOfComponentResourcesQueue as ɵclearResolutionOfComponentResourcesQueue, resolveComponentResources as ɵresolveComponentResources} from './metadata/resource_loading';\n export {ReflectionCapabilities as ɵReflectionCapabilities} from './reflection/reflection_capabilities';\n export {GetterFn as ɵGetterFn, MethodFn as ɵMethodFn, SetterFn as ɵSetterFn} from './reflection/types';\n+export {RuntimeError as ɵRuntimeError, RuntimeErrorCode as ɵRuntimeErrorCode} from './render3/error_code';\n export {allowSanitizationBypassAndThrow as ɵallowSanitizationBypassAndThrow, BypassType as ɵBypassType, getSanitizationBypassType as ɵgetSanitizationBypassType, SafeHtml as ɵSafeHtml, SafeResourceUrl as ɵSafeResourceUrl, SafeScript as ɵSafeScript, SafeStyle as ɵSafeStyle, SafeUrl as ɵSafeUrl, SafeValue as ɵSafeValue, unwrapSafeValue as ɵunwrapSafeValue} from './sanitization/bypass';\n export {_sanitizeHtml as ɵ_sanitizeHtml} from './sanitization/html_sanitizer';\n export {_sanitizeUrl as ɵ_sanitizeUrl} from './sanitization/url_sanitizer';"
        },
        {
            "sha": "84be7f56be14d62c8fdcd868d67b043b926ea8bf",
            "filename": "packages/core/src/render3/error_code.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/640ec7828fb0cfd15a0767f33228f0f79ed043f3/packages%2Fcore%2Fsrc%2Frender3%2Ferror_code.ts",
            "raw_url": "https://github.com/angular/angular/raw/640ec7828fb0cfd15a0767f33228f0f79ed043f3/packages%2Fcore%2Fsrc%2Frender3%2Ferror_code.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Ferror_code.ts?ref=640ec7828fb0cfd15a0767f33228f0f79ed043f3",
            "patch": "@@ -27,6 +27,7 @@ export const enum RuntimeErrorCode {\n   PIPE_NOT_FOUND = '302',\n   UNKNOWN_BINDING = '303',\n   UNKNOWN_ELEMENT = '304',\n+  TEMPLATE_STRUCTURE_ERROR = '305'\n \n   // Styling Errors\n "
        }
    ],
    "stats": {
        "total": 47,
        "additions": 42,
        "deletions": 5
    }
}