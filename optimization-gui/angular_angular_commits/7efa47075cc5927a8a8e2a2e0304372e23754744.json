{
    "author": "petebacondarwin",
    "message": "docs: remove http example dependency on 3rd party service (#43475)\n\nPreviously the `http` example did accessed the npmsearch.com website to demonstrate response caching.\nBut if this service became unavailable then the example (and its e2e tests) would fail.\n\nThis commit changes the example to use the in-memory-web-api for this lookup, which will not be affected by 3rd party outages.\n\nThe guide that references this example has been updated to avoid references to the original npm search service.\n\nPR Close #43475",
    "sha": "7efa47075cc5927a8a8e2a2e0304372e23754744",
    "files": [
        {
            "sha": "26a7da5bd1d8c8652f157e2b088a6cbf8cf05de1",
            "filename": "aio/content/examples/http/e2e/src/app.e2e-spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/7efa47075cc5927a8a8e2a2e0304372e23754744/aio%2Fcontent%2Fexamples%2Fhttp%2Fe2e%2Fsrc%2Fapp.e2e-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7efa47075cc5927a8a8e2a2e0304372e23754744/aio%2Fcontent%2Fexamples%2Fhttp%2Fe2e%2Fsrc%2Fapp.e2e-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fhttp%2Fe2e%2Fsrc%2Fapp.e2e-spec.ts?ref=7efa47075cc5927a8a8e2a2e0304372e23754744",
            "patch": "@@ -138,11 +138,11 @@ describe('Http Tests', () => {\n   });\n \n   describe('PackageSearch', () => {\n-    it('can search for npm package and find in cache', async () => {\n+    it('can search for package and find in cache', async () => {\n       const packageName = 'angular';\n       await page.searchInput.sendKeys(packageName);\n       await checkLogForMessage(\n-        'Caching response from \"https://npmsearch.com/query?q=angular\"');\n+        'Caching response from \"/packages/query?name=angular\".');\n       expect(await page.searchListItems.count()).toBeGreaterThan(1, 'angular items');\n \n       await page.searchInput.clear();\n@@ -152,7 +152,7 @@ describe('Http Tests', () => {\n       await page.searchInput.clear();\n       await page.searchInput.sendKeys(packageName);\n       await checkLogForMessage(\n-        'Found cached response for \"https://npmsearch.com/query?q=angular\"');\n+        'Found cached response for \"/packages/query?name=angular\"');\n     });\n   });\n });"
        },
        {
            "sha": "e9646833855f3f75dc9bd2c1dfee412d77d87908",
            "filename": "aio/content/examples/http/src/app/http-interceptors/caching-interceptor.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/7efa47075cc5927a8a8e2a2e0304372e23754744/aio%2Fcontent%2Fexamples%2Fhttp%2Fsrc%2Fapp%2Fhttp-interceptors%2Fcaching-interceptor.ts",
            "raw_url": "https://github.com/angular/angular/raw/7efa47075cc5927a8a8e2a2e0304372e23754744/aio%2Fcontent%2Fexamples%2Fhttp%2Fsrc%2Fapp%2Fhttp-interceptors%2Fcaching-interceptor.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fhttp%2Fsrc%2Fapp%2Fhttp-interceptors%2Fcaching-interceptor.ts?ref=7efa47075cc5927a8a8e2a2e0304372e23754744",
            "patch": "@@ -68,11 +68,7 @@ function sendRequest(\n   req: HttpRequest<any>,\n   next: HttpHandler,\n   cache: RequestCache): Observable<HttpEvent<any>> {\n-\n-  // No headers allowed in npm search request\n-  const noHeaderReq = req.clone({ headers: new HttpHeaders() });\n-\n-  return next.handle(noHeaderReq).pipe(\n+  return next.handle(req).pipe(\n     tap(event => {\n       // There may be other events besides the response.\n       if (event instanceof HttpResponse) {"
        },
        {
            "sha": "2658280d6cecb8ee4f47cc43d66db361c7b1771c",
            "filename": "aio/content/examples/http/src/app/in-memory-data.service.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/7efa47075cc5927a8a8e2a2e0304372e23754744/aio%2Fcontent%2Fexamples%2Fhttp%2Fsrc%2Fapp%2Fin-memory-data.service.ts",
            "raw_url": "https://github.com/angular/angular/raw/7efa47075cc5927a8a8e2a2e0304372e23754744/aio%2Fcontent%2Fexamples%2Fhttp%2Fsrc%2Fapp%2Fin-memory-data.service.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fhttp%2Fsrc%2Fapp%2Fin-memory-data.service.ts?ref=7efa47075cc5927a8a8e2a2e0304372e23754744",
            "patch": "@@ -8,6 +8,11 @@ export class InMemoryDataService implements InMemoryDbService {\n       { id: 13, name: 'Bombasto' },\n       { id: 14, name: 'Celeritas' },\n     ];\n-    return {heroes};\n+    const query = [\n+      { name: '@angular/core', version: '20.1.0', description: 'angular core package' },\n+      { name: '@angular/common', version: '20.1.0', description: 'angular common package' },\n+      { name: '@angular/material', version: '20.1.5', description: 'angular material package' },\n+    ];\n+    return {heroes, query};\n   }\n }"
        },
        {
            "sha": "df1b24e606eb4bc77da3b81ac29269d6f780c77b",
            "filename": "aio/content/examples/http/src/app/package-search/package-search.service.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 15,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/7efa47075cc5927a8a8e2a2e0304372e23754744/aio%2Fcontent%2Fexamples%2Fhttp%2Fsrc%2Fapp%2Fpackage-search%2Fpackage-search.service.ts",
            "raw_url": "https://github.com/angular/angular/raw/7efa47075cc5927a8a8e2a2e0304372e23754744/aio%2Fcontent%2Fexamples%2Fhttp%2Fsrc%2Fapp%2Fpackage-search%2Fpackage-search.service.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fhttp%2Fsrc%2Fapp%2Fpackage-search%2Fpackage-search.service.ts?ref=7efa47075cc5927a8a8e2a2e0304372e23754744",
            "patch": "@@ -2,7 +2,7 @@ import { Injectable } from '@angular/core';\n import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';\n \n import { Observable, of } from 'rxjs';\n-import { catchError, map } from 'rxjs/operators';\n+import { catchError } from 'rxjs/operators';\n \n import { HttpErrorHandler, HandleError } from '../http-error-handler.service';\n \n@@ -12,12 +12,12 @@ export interface NpmPackageInfo {\n   description: string;\n }\n \n-export const searchUrl = 'https://npmsearch.com/query';\n+export const searchUrl = '/packages/query';\n \n function createHttpOptions(packageName: string, refresh = false) {\n-    // npm package name search api\n-    // e.g., http://npmsearch.com/query?q=dom'\n-    const params = new HttpParams({ fromObject: { q: packageName } });\n+    // package name search api\n+    // e.g., /packages/query?name=dom'\n+    const params = new HttpParams({ fromObject: { name: packageName } });\n     const headerMap: Record<string, string> = refresh ? {'x-refresh': 'true'} : {};\n     const headers = new HttpHeaders(headerMap) ;\n     return { headers, params };\n@@ -39,16 +39,7 @@ export class PackageSearchService {\n \n     const options = createHttpOptions(packageName, refresh);\n \n-    // TODO: Add error handling\n-    return this.http.get(searchUrl, options).pipe(\n-      map((data: any) => {\n-        return data.results.map((entry: any) => ({\n-            name: entry.name[0],\n-            version: entry.version[0],\n-            description: entry.description[0]\n-          } as NpmPackageInfo )\n-        );\n-      }),\n+    return this.http.get<NpmPackageInfo[]>(searchUrl, options).pipe(\n       catchError(this.handleError('search', []))\n     );\n   }"
        },
        {
            "sha": "65df6ead1054e3d2248544ab2072f04f45504efd",
            "filename": "aio/content/guide/http.md",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/7efa47075cc5927a8a8e2a2e0304372e23754744/aio%2Fcontent%2Fguide%2Fhttp.md",
            "raw_url": "https://github.com/angular/angular/raw/7efa47075cc5927a8a8e2a2e0304372e23754744/aio%2Fcontent%2Fguide%2Fhttp.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fguide%2Fhttp.md?ref=7efa47075cc5927a8a8e2a2e0304372e23754744",
            "patch": "@@ -856,7 +856,7 @@ The `CachingInterceptor` in the following example demonstrates this approach.\n </code-example>\n \n * The `isCacheable()` function determines if the request is cacheable.\n-In this sample, only GET requests to the npm package search API are cacheable.\n+In this sample, only GET requests to the package search API are cacheable.\n \n * If the request is not cacheable, the interceptor forwards the request\n to the next handler in the chain.\n@@ -865,8 +865,7 @@ to the next handler in the chain.\n the cached response, by-passing the `next` handler (and all other interceptors downstream).\n \n * If a cacheable request is not in cache, the code calls `sendRequest()`.\n-This function creates a [request clone](#immutability) without headers, because the npm API forbids them.\n-The function then forwards the clone of the request to `next.handle()` which ultimately calls the server and returns the server's response.\n+This function forwards the request to `next.handle()` which ultimately calls the server and returns the server's response.\n \n {@a send-request}\n <code-example\n@@ -890,7 +889,7 @@ The `HttpClient.get()` method normally returns an observable that emits a single\n An interceptor can change this to an observable that emits [multiple values](guide/observables).\n \n The following revised version of the `CachingInterceptor` optionally returns an observable that\n-immediately emits the cached response, sends the request on to the npm web API,\n+immediately emits the cached response, sends the request on to the package search API,\n and emits again later with the updated search results.\n \n <code-example\n@@ -980,9 +979,9 @@ If you need to make an HTTP request in response to user input, it's not efficien\n It's better to wait until the user stops typing and then send a request.\n This technique is known as debouncing.\n \n-Consider the following template, which lets a user enter a search term to find an npm package by name.\n+Consider the following template, which lets a user enter a search term to find a package by name.\n When the user enters a name in a search-box, the `PackageSearchComponent` sends\n-a search request for a package with that name to the npm web API.\n+a search request for a package with that name to the package search API.\n \n <code-example\n   path=\"http/src/app/package-search/package-search.component.html\""
        }
    ],
    "stats": {
        "total": 51,
        "additions": 21,
        "deletions": 30
    }
}