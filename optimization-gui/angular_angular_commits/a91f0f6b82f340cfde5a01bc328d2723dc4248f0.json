{
    "author": "atscott",
    "message": "refactor(compiler): refactor ast spans test to be more human readable (#38902)\n\nThe current tests print out the span numbers, which are really difficult to verify\nsince it requires manually going to the template string and looking at what\ncharacters appear within those indexes. The better humanization would be\nto use the toString method of the spans, which prints the span text itself\n\nPR Close #38902",
    "sha": "a91f0f6b82f340cfde5a01bc328d2723dc4248f0",
    "files": [
        {
            "sha": "fac18efac94b1aeea43a0b880cb1f919939cac96",
            "filename": "packages/compiler/test/render3/r3_ast_spans_spec.ts",
            "status": "modified",
            "additions": 83,
            "deletions": 64,
            "changes": 147,
            "blob_url": "https://github.com/angular/angular/blob/a91f0f6b82f340cfde5a01bc328d2723dc4248f0/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_ast_spans_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/a91f0f6b82f340cfde5a01bc328d2723dc4248f0/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_ast_spans_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_ast_spans_spec.ts?ref=a91f0f6b82f340cfde5a01bc328d2723dc4248f0",
            "patch": "@@ -95,7 +95,7 @@ function humanizeSpan(span: ParseSourceSpan|null|undefined): string {\n   if (span === null || span === undefined) {\n     return `<empty>`;\n   }\n-  return `${span.start.offset}:${span.end.offset}`;\n+  return span.toString();\n }\n \n function expectFromHtml(html: string) {\n@@ -113,117 +113,128 @@ describe('R3 AST source spans', () => {\n   describe('nodes without binding', () => {\n     it('is correct for text nodes', () => {\n       expectFromHtml('a').toEqual([\n-        ['Text', '0:1'],\n+        ['Text', 'a'],\n       ]);\n     });\n \n     it('is correct for elements with attributes', () => {\n       expectFromHtml('<div a=\"b\"></div>').toEqual([\n-        ['Element', '0:17', '0:11', '11:17'],\n-        ['TextAttribute', '5:10', '8:9'],\n+        ['Element', '<div a=\"b\"></div>', '<div a=\"b\">', '</div>'],\n+        ['TextAttribute', 'a=\"b\"', 'b'],\n       ]);\n     });\n \n     it('is correct for elements with attributes without value', () => {\n       expectFromHtml('<div a></div>').toEqual([\n-        ['Element', '0:13', '0:7', '7:13'],\n-        ['TextAttribute', '5:6', '<empty>'],\n+        ['Element', '<div a></div>', '<div a>', '</div>'],\n+        ['TextAttribute', 'a', '<empty>'],\n       ]);\n     });\n   });\n \n   describe('bound text nodes', () => {\n     it('is correct for bound text nodes', () => {\n       expectFromHtml('{{a}}').toEqual([\n-        ['BoundText', '0:5'],\n+        ['BoundText', '{{a}}'],\n       ]);\n     });\n   });\n \n   describe('bound attributes', () => {\n     it('is correct for bound properties', () => {\n       expectFromHtml('<div [someProp]=\"v\"></div>').toEqual([\n-        ['Element', '0:26', '0:20', '20:26'],\n-        ['BoundAttribute', '5:19', '17:18'],\n+        ['Element', '<div [someProp]=\"v\"></div>', '<div [someProp]=\"v\">', '</div>'],\n+        ['BoundAttribute', '[someProp]=\"v\"', 'v'],\n       ]);\n     });\n \n     it('is correct for bound properties without value', () => {\n       expectFromHtml('<div [someProp]></div>').toEqual([\n-        ['Element', '0:22', '0:16', '16:22'],\n-        ['BoundAttribute', '5:15', '<empty>'],\n+        ['Element', '<div [someProp]></div>', '<div [someProp]>', '</div>'],\n+        ['BoundAttribute', '[someProp]', '<empty>'],\n       ]);\n     });\n \n     it('is correct for bound properties via bind- ', () => {\n       expectFromHtml('<div bind-prop=\"v\"></div>').toEqual([\n-        ['Element', '0:25', '0:19', '19:25'],\n-        ['BoundAttribute', '5:18', '16:17'],\n+        ['Element', '<div bind-prop=\"v\"></div>', '<div bind-prop=\"v\">', '</div>'],\n+        ['BoundAttribute', 'bind-prop=\"v\"', 'v'],\n       ]);\n     });\n \n     it('is correct for bound properties via {{...}}', () => {\n       expectFromHtml('<div prop=\"{{v}}\"></div>').toEqual([\n-        ['Element', '0:24', '0:18', '18:24'],\n-        ['BoundAttribute', '5:17', '11:16'],\n+        ['Element', '<div prop=\"{{v}}\"></div>', '<div prop=\"{{v}}\">', '</div>'],\n+        ['BoundAttribute', 'prop=\"{{v}}\"', '{{v}}'],\n       ]);\n     });\n   });\n \n   describe('templates', () => {\n     it('is correct for * directives', () => {\n       expectFromHtml('<div *ngIf></div>').toEqual([\n-        ['Template', '0:17', '0:11', '11:17'],\n-        ['TextAttribute', '6:10', '<empty>'],  // ngIf\n-        ['Element', '0:17', '0:11', '11:17'],\n+        ['Template', '<div *ngIf></div>', '<div *ngIf>', '</div>'],\n+        ['TextAttribute', 'ngIf', '<empty>'],\n+        ['Element', '<div *ngIf></div>', '<div *ngIf>', '</div>'],\n       ]);\n     });\n \n     it('is correct for <ng-template>', () => {\n       expectFromHtml('<ng-template></ng-template>').toEqual([\n-        ['Template', '0:27', '0:13', '13:27'],\n+        ['Template', '<ng-template></ng-template>', '<ng-template>', '</ng-template>'],\n       ]);\n     });\n \n     it('is correct for reference via #...', () => {\n       expectFromHtml('<ng-template #a></ng-template>').toEqual([\n-        ['Template', '0:30', '0:16', '16:30'],\n-        ['Reference', '13:15', '<empty>'],\n+        ['Template', '<ng-template #a></ng-template>', '<ng-template #a>', '</ng-template>'],\n+        ['Reference', '#a', '<empty>'],\n       ]);\n     });\n \n     it('is correct for reference with name', () => {\n       expectFromHtml('<ng-template #a=\"b\"></ng-template>').toEqual([\n-        ['Template', '0:34', '0:20', '20:34'],\n-        ['Reference', '13:19', '17:18'],\n+        [\n+          'Template', '<ng-template #a=\"b\"></ng-template>', '<ng-template #a=\"b\">', '</ng-template>'\n+        ],\n+        ['Reference', '#a=\"b\"', 'b'],\n       ]);\n     });\n \n     it('is correct for reference via ref-...', () => {\n       expectFromHtml('<ng-template ref-a></ng-template>').toEqual([\n-        ['Template', '0:33', '0:19', '19:33'],\n-        ['Reference', '13:18', '<empty>'],\n+        ['Template', '<ng-template ref-a></ng-template>', '<ng-template ref-a>', '</ng-template>'],\n+        ['Reference', 'ref-a', '<empty>'],\n       ]);\n     });\n \n     it('is correct for variables via let-...', () => {\n       expectFromHtml('<ng-template let-a=\"b\"></ng-template>').toEqual([\n-        ['Template', '0:37', '0:23', '23:37'],\n-        ['Variable', '13:22', '20:21'],\n+        [\n+          'Template', '<ng-template let-a=\"b\"></ng-template>', '<ng-template let-a=\"b\">',\n+          '</ng-template>'\n+        ],\n+        ['Variable', 'let-a=\"b\"', 'b'],\n       ]);\n     });\n \n     it('is correct for attributes', () => {\n       expectFromHtml('<ng-template k1=\"v1\"></ng-template>').toEqual([\n-        ['Template', '0:35', '0:21', '21:35'],\n-        ['TextAttribute', '13:20', '17:19'],\n+        [\n+          'Template', '<ng-template k1=\"v1\"></ng-template>', '<ng-template k1=\"v1\">',\n+          '</ng-template>'\n+        ],\n+        ['TextAttribute', 'k1=\"v1\"', 'v1'],\n       ]);\n     });\n \n     it('is correct for bound attributes', () => {\n       expectFromHtml('<ng-template [k1]=\"v1\"></ng-template>').toEqual([\n-        ['Template', '0:37', '0:23', '23:37'],\n-        ['BoundAttribute', '13:22', '19:21'],\n+        [\n+          'Template', '<ng-template [k1]=\"v1\"></ng-template>', '<ng-template [k1]=\"v1\">',\n+          '</ng-template>'\n+        ],\n+        ['BoundAttribute', '[k1]=\"v1\"', 'v1'],\n       ]);\n     });\n   });\n@@ -236,11 +247,17 @@ describe('R3 AST source spans', () => {\n       //   <div></div>\n       // </ng-template>\n       expectFromHtml('<div *ngFor=\"let item of items\"></div>').toEqual([\n-        ['Template', '0:38', '0:32', '32:38'],\n-        ['TextAttribute', '6:11', '<empty>'],  // ngFor\n-        ['BoundAttribute', '5:31', '25:30'],   // *ngFor=\"let item of items\" -> items\n-        ['Variable', '13:22', '<empty>'],      // let item\n-        ['Element', '0:38', '0:32', '32:38'],\n+        [\n+          'Template', '<div *ngFor=\"let item of items\"></div>', '<div *ngFor=\"let item of items\">',\n+          '</div>'\n+        ],\n+        ['TextAttribute', 'ngFor', '<empty>'],\n+        ['BoundAttribute', '*ngFor=\"let item of items\"', 'items'],\n+        ['Variable', 'let item ', '<empty>'],\n+        [\n+          'Element', '<div *ngFor=\"let item of items\"></div>', '<div *ngFor=\"let item of items\">',\n+          '</div>'\n+        ],\n       ]);\n \n       // Note that this test exercises an *incorrect* usage of the ngFor\n@@ -250,83 +267,85 @@ describe('R3 AST source spans', () => {\n       //   <div></div>\n       // </ng-template>\n       expectFromHtml('<div *ngFor=\"item of items\"></div>').toEqual([\n-        ['Template', '0:34', '0:28', '28:34'],\n-        ['BoundAttribute', '5:27', '13:17'],  // ngFor=\"item of items\" -> item\n-        ['BoundAttribute', '5:27', '21:26'],  // ngFor=\"item of items\" -> items\n-        ['Element', '0:34', '0:28', '28:34'],\n+        [\n+          'Template', '<div *ngFor=\"item of items\"></div>', '<div *ngFor=\"item of items\">', '</div>'\n+        ],\n+        ['BoundAttribute', '*ngFor=\"item of items\"', 'item'],\n+        ['BoundAttribute', '*ngFor=\"item of items\"', 'items'],\n+        ['Element', '<div *ngFor=\"item of items\"></div>', '<div *ngFor=\"item of items\">', '</div>'],\n       ]);\n     });\n \n     it('is correct for variables via let ...', () => {\n       expectFromHtml('<div *ngIf=\"let a=b\"></div>').toEqual([\n-        ['Template', '0:27', '0:21', '21:27'],\n-        ['TextAttribute', '6:10', '<empty>'],  // ngIf\n-        ['Variable', '12:19', '18:19'],        // let a=b -> b\n-        ['Element', '0:27', '0:21', '21:27'],\n+        ['Template', '<div *ngIf=\"let a=b\"></div>', '<div *ngIf=\"let a=b\">', '</div>'],\n+        ['TextAttribute', 'ngIf', '<empty>'],\n+        ['Variable', 'let a=b', 'b'],\n+        ['Element', '<div *ngIf=\"let a=b\"></div>', '<div *ngIf=\"let a=b\">', '</div>'],\n       ]);\n     });\n \n     it('is correct for variables via as ...', () => {\n       expectFromHtml('<div *ngIf=\"expr as local\"></div>').toEqual([\n-        ['Template', '0:33', '0:27', '27:33'],\n-        ['BoundAttribute', '5:26', '12:16'],  // ngIf=\"expr as local\" -> expr\n-        ['Variable', '6:25', '6:10'],         // ngIf=\"expr as local -> ngIf\n-        ['Element', '0:33', '0:27', '27:33'],\n+        ['Template', '<div *ngIf=\"expr as local\"></div>', '<div *ngIf=\"expr as local\">', '</div>'],\n+        ['BoundAttribute', '*ngIf=\"expr as local\"', 'expr'],\n+        ['Variable', 'ngIf=\"expr as local', 'ngIf'],\n+        ['Element', '<div *ngIf=\"expr as local\"></div>', '<div *ngIf=\"expr as local\">', '</div>'],\n       ]);\n     });\n   });\n \n   describe('events', () => {\n     it('is correct for event names case sensitive', () => {\n       expectFromHtml('<div (someEvent)=\"v\"></div>').toEqual([\n-        ['Element', '0:27', '0:21', '21:27'],\n-        ['BoundEvent', '5:20', '18:19'],\n+        ['Element', '<div (someEvent)=\"v\"></div>', '<div (someEvent)=\"v\">', '</div>'],\n+        ['BoundEvent', '(someEvent)=\"v\"', 'v'],\n       ]);\n     });\n \n     it('is correct for bound events via on-', () => {\n       expectFromHtml('<div on-event=\"v\"></div>').toEqual([\n-        ['Element', '0:24', '0:18', '18:24'],\n-        ['BoundEvent', '5:17', '15:16'],\n+        ['Element', '<div on-event=\"v\"></div>', '<div on-event=\"v\">', '</div>'],\n+        ['BoundEvent', 'on-event=\"v\"', 'v'],\n       ]);\n     });\n \n     it('is correct for bound events and properties via [(...)]', () => {\n       expectFromHtml('<div [(prop)]=\"v\"></div>').toEqual([\n-        ['Element', '0:24', '0:18', '18:24'],\n-        ['BoundAttribute', '5:17', '15:16'],\n-        ['BoundEvent', '5:17', '15:16'],\n+        ['Element', '<div [(prop)]=\"v\"></div>', '<div [(prop)]=\"v\">', '</div>'],\n+        ['BoundAttribute', '[(prop)]=\"v\"', 'v'],\n+        ['BoundEvent', '[(prop)]=\"v\"', 'v'],\n       ]);\n     });\n \n     it('is correct for bound events and properties via bindon-', () => {\n       expectFromHtml('<div bindon-prop=\"v\"></div>').toEqual([\n-        ['Element', '0:27', '0:21', '21:27'],\n-        ['BoundAttribute', '5:20', '18:19'],\n-        ['BoundEvent', '5:20', '18:19'],\n+        ['Element', '<div bindon-prop=\"v\"></div>', '<div bindon-prop=\"v\">', '</div>'],\n+        ['BoundAttribute', 'bindon-prop=\"v\"', 'v'],\n+        ['BoundEvent', 'bindon-prop=\"v\"', 'v'],\n       ]);\n     });\n   });\n \n   describe('references', () => {\n     it('is correct for references via #...', () => {\n       expectFromHtml('<div #a></div>').toEqual([\n-        ['Element', '0:14', '0:8', '8:14'],\n-        ['Reference', '5:7', '<empty>'],\n+        ['Element', '<div #a></div>', '<div #a>', '</div>'],\n+        ['Reference', '#a', '<empty>'],\n       ]);\n     });\n \n     it('is correct for references with name', () => {\n       expectFromHtml('<div #a=\"b\"></div>').toEqual([\n-        ['Element', '0:18', '0:12', '12:18'],\n-        ['Reference', '5:11', '9:10'],\n+        ['Element', '<div #a=\"b\"></div>', '<div #a=\"b\">', '</div>'],\n+        ['Reference', '#a=\"b\"', 'b'],\n       ]);\n     });\n \n     it('is correct for references via ref-', () => {\n       expectFromHtml('<div ref-a></div>').toEqual([\n-        ['Element', '0:17', '0:11', '11:17'],\n-        ['Reference', '5:10', '<empty>'],\n+        ['Element', '<div ref-a></div>', '<div ref-a>', '</div>'],\n+        ['Reference', 'ref-a', '<empty>'],\n       ]);\n     });\n   });"
        }
    ],
    "stats": {
        "total": 147,
        "additions": 83,
        "deletions": 64
    }
}