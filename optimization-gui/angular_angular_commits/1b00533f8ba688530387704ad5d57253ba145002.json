{
    "author": "devversion",
    "message": "test(dev-infra): publish test should not rely on external http request (#41767)\n\nA test for the dev-infra publish tool currently relies on an external\nhttp request by accident. This will break if we disallow internet\naccess within RBE containers.\n\nPR Close #41767",
    "sha": "1b00533f8ba688530387704ad5d57253ba145002",
    "files": [
        {
            "sha": "b5fc18563ab9d45307c253557e3d3bb1ec1a4126",
            "filename": "dev-infra/release/publish/test/common.spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 8,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/1b00533f8ba688530387704ad5d57253ba145002/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcommon.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1b00533f8ba688530387704ad5d57253ba145002/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcommon.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcommon.spec.ts?ref=1b00533f8ba688530387704ad5d57253ba145002",
            "patch": "@@ -19,7 +19,7 @@ import {ReleaseAction} from '../actions';\n import {actions} from '../actions/index';\n import {changelogPath} from '../constants';\n \n-import {getChangelogForVersion, getTestingMocksForReleaseAction, parse, setupReleaseActionForTesting, testTmpDir} from './test-utils';\n+import {fakeNpmPackageQueryRequest, getChangelogForVersion, getTestingMocksForReleaseAction, parse, setupReleaseActionForTesting, testTmpDir} from './test-utils';\n \n describe('common release action logic', () => {\n   const baseReleaseTrains: ActiveReleaseTrains = {\n@@ -36,16 +36,12 @@ describe('common release action logic', () => {\n     };\n \n     it('should not modify release train versions and cause invalid other actions', async () => {\n-      // The cached npm package information needs to be deleted as depending on the test order\n-      // their may or may not be packages in the cache, causing the number of active LTS branches\n-      // in this test to be 2 instead of 0.\n-      for (const packageName in _npmPackageInfoCache) {\n-        delete _npmPackageInfoCache[packageName];\n-      }\n-\n       const {releaseConfig, gitClient} = getTestingMocksForReleaseAction();\n       const descriptions: string[] = [];\n \n+      // Fake the NPM package request as otherwise the test would rely on `npmjs.org`.\n+      fakeNpmPackageQueryRequest(releaseConfig.npmPackages[0], {'dist-tags': {}});\n+\n       for (const actionCtor of actions) {\n         if (await actionCtor.isActive(testReleaseTrain)) {\n           const action = new actionCtor(testReleaseTrain, gitClient, releaseConfig, testTmpDir);"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 4,
        "deletions": 8
    }
}