{
    "author": "crisbeto",
    "message": "refactor(docs-infra): use CDK clipboard service (#40840)\n\nThe CDK has had a service for copying strings to the clipboard. These changes switch\nAIO to it, rather than having to maintain a custom solution.\n\nPR Close #40840",
    "sha": "f2ee9d56790e1dc6d6aba183263ff927d0b15ca3",
    "files": [
        {
            "sha": "8f46167055aa0a799ad85f7039daebfc298476ab",
            "filename": "aio/src/app/custom-elements/code/code.component.spec.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 12,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/f2ee9d56790e1dc6d6aba183263ff927d0b15ca3/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.component.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/f2ee9d56790e1dc6d6aba183263ff927d0b15ca3/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.component.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.component.spec.ts?ref=f2ee9d56790e1dc6d6aba183263ff927d0b15ca3",
            "patch": "@@ -3,10 +3,10 @@ import { ComponentFixture, TestBed } from '@angular/core/testing';\n import { MatSnackBar } from '@angular/material/snack-bar';\n import { By } from '@angular/platform-browser';\n import { NoopAnimationsModule } from '@angular/platform-browser/animations';\n+import { Clipboard } from '@angular/cdk/clipboard';\n \n import { CodeComponent } from './code.component';\n import { CodeModule } from './code.module';\n-import { CopierService } from 'app/shared//copier.service';\n import { Logger } from 'app/shared/logger.service';\n import { MockPrettyPrinter } from 'testing/pretty-printer.service';\n import { PrettyPrinter } from './pretty-printer.service';\n@@ -32,7 +32,6 @@ describe('CodeComponent', () => {\n       imports: [ NoopAnimationsModule, CodeModule ],\n       declarations: [ HostComponent ],\n       providers: [\n-        CopierService,\n         { provide: Logger, useClass: TestLogger },\n         { provide: PrettyPrinter, useClass: MockPrettyPrinter },\n      ]\n@@ -222,23 +221,23 @@ describe('CodeComponent', () => {\n     });\n \n     it('should call copier service when clicked', () => {\n-      const copierService: CopierService = TestBed.inject(CopierService);\n-      const spy = spyOn(copierService, 'copyText');\n+      const clipboard = TestBed.inject(Clipboard);\n+      const spy = spyOn(clipboard, 'copy');\n       expect(spy.calls.count()).toBe(0, 'before click');\n       getButton().click();\n       expect(spy.calls.count()).toBe(1, 'after click');\n     });\n \n     it('should copy code text when clicked', () => {\n-      const copierService: CopierService = TestBed.inject(CopierService);\n-      const spy = spyOn(copierService, 'copyText');\n+      const clipboard = TestBed.inject(Clipboard);\n+      const spy = spyOn(clipboard, 'copy');\n       getButton().click();\n       expect(spy.calls.argsFor(0)[0]).toBe(oneLineCode, 'after click');\n     });\n \n     it('should preserve newlines in the copied code', () => {\n-      const copierService: CopierService = TestBed.inject(CopierService);\n-      const spy = spyOn(copierService, 'copyText');\n+      const clipboard = TestBed.inject(Clipboard);\n+      const spy = spyOn(clipboard, 'copy');\n       const expectedCode = smallMultiLineCode.trim().replace(/&lt;/g, '<').replace(/&gt;/g, '>');\n       let actualCode;\n \n@@ -259,19 +258,19 @@ describe('CodeComponent', () => {\n \n     it('should display a message when copy succeeds', () => {\n       const snackBar: MatSnackBar = TestBed.inject(MatSnackBar);\n-      const copierService: CopierService = TestBed.inject(CopierService);\n+      const clipboard = TestBed.inject(Clipboard);\n       spyOn(snackBar, 'open');\n-      spyOn(copierService, 'copyText').and.returnValue(true);\n+      spyOn(clipboard, 'copy').and.returnValue(true);\n       getButton().click();\n       expect(snackBar.open).toHaveBeenCalledWith('Code Copied', '', { duration: 800 });\n     });\n \n     it('should display an error when copy fails', () => {\n       const snackBar: MatSnackBar = TestBed.inject(MatSnackBar);\n-      const copierService: CopierService = TestBed.inject(CopierService);\n+      const clipboard = TestBed.inject(Clipboard);\n       const logger = TestBed.inject(Logger) as unknown as TestLogger;\n       spyOn(snackBar, 'open');\n-      spyOn(copierService, 'copyText').and.returnValue(false);\n+      spyOn(clipboard, 'copy').and.returnValue(false);\n       getButton().click();\n       expect(snackBar.open).toHaveBeenCalledWith('Copy failed. Please try again!', '', { duration: 800 });\n       expect(logger.error).toHaveBeenCalledTimes(1);"
        },
        {
            "sha": "ed16f9946bee63902244afed9e6c507060124883",
            "filename": "aio/src/app/custom-elements/code/code.component.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/f2ee9d56790e1dc6d6aba183263ff927d0b15ca3/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/f2ee9d56790e1dc6d6aba183263ff927d0b15ca3/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.component.ts?ref=f2ee9d56790e1dc6d6aba183263ff927d0b15ca3",
            "patch": "@@ -1,7 +1,7 @@\n import { Component, ElementRef, EventEmitter, Input, OnChanges, Output, ViewChild } from '@angular/core';\n+import { Clipboard } from '@angular/cdk/clipboard';\n import { Logger } from 'app/shared/logger.service';\n import { PrettyPrinter } from './pretty-printer.service';\n-import { CopierService } from 'app/shared/copier.service';\n import { MatSnackBar } from '@angular/material/snack-bar';\n import { tap } from 'rxjs/operators';\n \n@@ -96,7 +96,7 @@ export class CodeComponent implements OnChanges {\n   constructor(\n     private snackbar: MatSnackBar,\n     private pretty: PrettyPrinter,\n-    private copier: CopierService,\n+    private clipboard: Clipboard,\n     private logger: Logger) {}\n \n   ngOnChanges() {\n@@ -144,7 +144,7 @@ export class CodeComponent implements OnChanges {\n   /** Copies the code snippet to the user's clipboard. */\n   doCopy() {\n     const code = this.codeText;\n-    const successfullyCopied = this.copier.copyText(code);\n+    const successfullyCopied = this.clipboard.copy(code);\n \n     if (successfullyCopied) {\n       this.logger.log('Copied code to clipboard:', code);"
        },
        {
            "sha": "0f43b5b431111ffe4908539a7814c18a6aa489aa",
            "filename": "aio/src/app/custom-elements/code/code.module.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/f2ee9d56790e1dc6d6aba183263ff927d0b15ca3/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.module.ts",
            "raw_url": "https://github.com/angular/angular/raw/f2ee9d56790e1dc6d6aba183263ff927d0b15ca3/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.module.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fcustom-elements%2Fcode%2Fcode.module.ts?ref=f2ee9d56790e1dc6d6aba183263ff927d0b15ca3",
            "patch": "@@ -3,13 +3,12 @@ import { CommonModule } from '@angular/common';\n import { CodeComponent } from './code.component';\n import { MatSnackBarModule } from '@angular/material/snack-bar';\n import { PrettyPrinter } from './pretty-printer.service';\n-import { CopierService } from 'app/shared/copier.service';\n \n @NgModule({\n   imports: [ CommonModule, MatSnackBarModule ],\n   declarations: [ CodeComponent ],\n   entryComponents: [ CodeComponent ],\n   exports: [ CodeComponent ],\n-  providers: [ PrettyPrinter, CopierService ]\n+  providers: [ PrettyPrinter ]\n })\n export class CodeModule { }"
        },
        {
            "sha": "1a5c97ccac78335dade47a589ad1de28d55c9a04",
            "filename": "aio/src/app/shared/copier.service.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 99,
            "changes": 99,
            "blob_url": "https://github.com/angular/angular/blob/5f0c219883a972f754020dcfec4155362b295163/aio%2Fsrc%2Fapp%2Fshared%2Fcopier.service.ts",
            "raw_url": "https://github.com/angular/angular/raw/5f0c219883a972f754020dcfec4155362b295163/aio%2Fsrc%2Fapp%2Fshared%2Fcopier.service.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fshared%2Fcopier.service.ts?ref=5f0c219883a972f754020dcfec4155362b295163",
            "patch": "@@ -1,99 +0,0 @@\n-/**\n- * This class is based on the code in the following projects:\n- *\n- * - https://github.com/zenorocha/select\n- * - https://github.com/zenorocha/clipboard.js/\n- *\n- * Both released under MIT license - Â© Zeno Rocha\n- *\n- * It is also influenced by the Angular CDK `PendingCopy` class:\n- * https://github.com/angular/components/blob/master/src/cdk/clipboard/pending-copy.ts\n- */\n-\n-\n-export class CopierService {\n-  /**\n-   * Copy the contents of a `<textarea>` element to the clipboard.\n-   *\n-   * NOTE: For this method to work, the elements must be already inserted into the DOM.\n-   *\n-   * @param textArea The area containing the text to be copied to the clipboard.\n-   * @return Whether the copy operation was successful.\n-   */\n-  private copyTextArea(textArea: HTMLTextAreaElement): boolean {\n-    const currentFocus = document.activeElement as HTMLOrSVGElement | null;\n-\n-    try {\n-      textArea.select();\n-      textArea.setSelectionRange(0, textArea.value.length);\n-\n-      return document.execCommand('copy');\n-    } catch {\n-      return false;\n-    } finally {\n-      // Calling `.select()` on the `<textarea>` element may have also focused it.\n-      // Change the focus back to the previously focused element.\n-      currentFocus?.focus();\n-    }\n-  }\n-\n-  /**\n-   * Create a temporary, hidden `<textarea>` element and set its value to the specified text.\n-   *\n-   * @param text The text to be inserted into the textarea.\n-   * @return The temporary `<textarea>` element containing the specified text.\n-   */\n-  private createTextArea(text: string): HTMLTextAreaElement {\n-    const docElem = document.documentElement;\n-    const isRTL = docElem.getAttribute('dir') === 'rtl';\n-\n-    // Create a temporary element to hold the contents to copy.\n-    const textArea = document.createElement('textarea');\n-    const style = textArea.style;\n-\n-    // Prevent zooming on iOS.\n-    style.fontSize = '12pt';\n-\n-    // Reset box model.\n-    style.border = '0';\n-    style.padding = '0';\n-    style.margin = '0';\n-\n-    // Make the element invisible and move it out of screen horizontally.\n-    style.opacity = '0';\n-    style.position = 'fixed';\n-    style.top = '0';\n-    style[isRTL ? 'right' : 'left'] = '-999em';\n-\n-    textArea.setAttribute('aria-hidden', 'true');\n-    textArea.setAttribute('readonly', '');\n-    textArea.value = text;\n-\n-    return textArea;\n-  }\n-\n-  /**\n-   * Copy the specified text to the clipboard.\n-   *\n-   * @param text The text to be copied to the clipboard.\n-   * @return Whether the copy operation was successful.\n-   */\n-  copyText(text: string): boolean {\n-    // Create a `<textarea>` element with the specified text.\n-    const textArea = this.createTextArea(text);\n-\n-    // Insert it into the DOM.\n-    document.body.appendChild(textArea);\n-\n-    // Copy its contents to the clipboard.\n-    const success = this.copyTextArea(textArea);\n-\n-    // Remove it from the DOM, so it can be garbage-collected.\n-    if (textArea.parentNode) {\n-      // We cannot use ChildNode.remove() because of IE11.\n-      textArea.parentNode.removeChild(textArea);\n-    }\n-\n-    return success;\n-  }\n-}"
        }
    ],
    "stats": {
        "total": 131,
        "additions": 15,
        "deletions": 116
    }
}