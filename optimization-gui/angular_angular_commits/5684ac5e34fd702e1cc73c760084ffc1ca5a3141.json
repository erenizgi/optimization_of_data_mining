{
    "author": "petebacondarwin",
    "message": "feat(localize): support Application Resource Bundle (ARB) translation file format (#36795)\n\nThe ARB format is a JSON file containing an object where the keys are the\nmessage ids and the values are the translations.\n\nIt is extensible because it can also contain metadata about each message.\n\nFor example:\n\n```\n{\n  \"@@locale\": \"...\",\n  \"message-id\": \"Translated message string\",\n  \"@message-id\": {\n    \"type\": \"text\",\n    \"description\": \"Some description text\",\n    \"x-locations\": [{ \"start\": {\"line\": 23, \"column\": 145}, \"file\": \"some/file.ts\" }]\n  },\n}\n```\n\nFor more information, see:\nhttps://github.com/google/app-resource-bundle/wiki/ApplicationResourceBundleSpecification\n\nPR Close #36795",
    "sha": "5684ac5e34fd702e1cc73c760084ffc1ca5a3141",
    "files": [
        {
            "sha": "e68335b4edef00a8c6d7125d9d35a4ea064f8c65",
            "filename": "packages/localize/src/tools/src/extract/main.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fmain.ts",
            "raw_url": "https://github.com/angular/angular/raw/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fmain.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fmain.ts?ref=5684ac5e34fd702e1cc73c760084ffc1ca5a3141",
            "patch": "@@ -17,6 +17,7 @@ import {DiagnosticHandlingStrategy} from '../diagnostics';\n import {checkDuplicateMessages} from './duplicates';\n import {MessageExtractor} from './extraction';\n import {TranslationSerializer} from './translation_files/translation_serializer';\n+import {ArbTranslationSerializer} from './translation_files/arb_translation_serializer';\n import {SimpleJsonTranslationSerializer} from './translation_files/json_translation_serializer';\n import {Xliff1TranslationSerializer} from './translation_files/xliff1_translation_serializer';\n import {Xliff2TranslationSerializer} from './translation_files/xliff2_translation_serializer';\n@@ -229,6 +230,8 @@ export function getSerializer(\n       return new XmbTranslationSerializer(rootPath, useLegacyIds, fs);\n     case 'json':\n       return new SimpleJsonTranslationSerializer(sourceLocale);\n+    case 'arb':\n+      return new ArbTranslationSerializer(sourceLocale, rootPath, fs);\n   }\n   throw new Error(`No translation serializer can handle the provided format: ${format}`);\n }"
        },
        {
            "sha": "8d303048e0fce1ca9e78e32da8e3bcbd2a13c92b",
            "filename": "packages/localize/src/tools/src/extract/translation_files/arb_translation_serializer.ts",
            "status": "added",
            "additions": 100,
            "deletions": 0,
            "changes": 100,
            "blob_url": "https://github.com/angular/angular/blob/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Farb_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Farb_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Farb_translation_serializer.ts?ref=5684ac5e34fd702e1cc73c760084ffc1ca5a3141",
            "patch": "@@ -0,0 +1,100 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {AbsoluteFsPath, FileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n+import {ArbJsonObject, ArbLocation, ArbMetadata} from '../../translate/translation_files/translation_parsers/arb_translation_parser';\n+import {TranslationSerializer} from './translation_serializer';\n+import {consolidateMessages, hasLocation} from './utils';\n+\n+/**\n+ * A translation serializer that can render JSON formatted as an Application Resource Bundle (ARB).\n+ *\n+ * See https://github.com/google/app-resource-bundle/wiki/ApplicationResourceBundleSpecification\n+ *\n+ * ```\n+ * {\n+ *   \"@@locale\": \"en-US\",\n+ *   \"message-id\": \"Target message string\",\n+ *   \"@message-id\": {\n+ *     \"type\": \"text\",\n+ *     \"description\": \"Some description text\",\n+ *     \"x-locations\": [\n+ *       {\n+ *         \"start\": {\"line\": 23, \"column\": 145},\n+ *         \"end\": {\"line\": 24, \"column\": 53},\n+ *         \"file\": \"some/file.ts\"\n+ *       },\n+ *       ...\n+ *     ]\n+ *   },\n+ *   ...\n+ * }\n+ * ```\n+ */\n+\n+/**\n+ * This is a semi-public bespoke serialization format that is used for testing and sometimes as a\n+ * format for storing translations that will be inlined at runtime.\n+ *\n+ * @see ArbTranslationParser\n+ */\n+export class ArbTranslationSerializer implements TranslationSerializer {\n+  constructor(\n+      private sourceLocale: string, private basePath: AbsoluteFsPath, private fs: FileSystem) {}\n+\n+  serialize(messages: ɵParsedMessage[]): string {\n+    const messageMap = consolidateMessages(messages, message => message.customId || message.id);\n+\n+    let output = `{\\n  \"@@locale\": ${JSON.stringify(this.sourceLocale)}`;\n+\n+    for (const [id, duplicateMessages] of messageMap.entries()) {\n+      const message = duplicateMessages[0];\n+      output += this.serializeMessage(id, message);\n+      output += this.serializeMeta(\n+          id, message.description, duplicateMessages.filter(hasLocation).map(m => m.location));\n+    }\n+\n+    output += '\\n}';\n+\n+    return output;\n+  }\n+\n+  private serializeMessage(id: string, message: ɵParsedMessage): string {\n+    return `,\\n  ${JSON.stringify(id)}: ${JSON.stringify(message.text)}`;\n+  }\n+\n+  private serializeMeta(id: string, description: string|undefined, locations: ɵSourceLocation[]):\n+      string {\n+    const meta: string[] = [];\n+\n+    if (description) {\n+      meta.push(`\\n    \"description\": ${JSON.stringify(description)}`);\n+    }\n+\n+    if (locations.length > 0) {\n+      let locationStr = `\\n    \"x-locations\": [`;\n+      for (let i = 0; i < locations.length; i++) {\n+        locationStr += (i > 0 ? ',\\n' : '\\n') + this.serializeLocation(locations[i]);\n+      }\n+      locationStr += '\\n    ]';\n+      meta.push(locationStr);\n+    }\n+\n+    return meta.length > 0 ? `,\\n  ${JSON.stringify('@' + id)}: {${meta.join(',')}\\n  }` : '';\n+  }\n+\n+  private serializeLocation({file, start, end}: ɵSourceLocation): string {\n+    return [\n+      `      {`,\n+      `        \"file\": ${JSON.stringify(this.fs.relative(this.basePath, file))},`,\n+      `        \"start\": { \"line\": \"${start.line}\", \"column\": \"${start.column}\" },`,\n+      `        \"end\": { \"line\": \"${end.line}\", \"column\": \"${end.column}\" }`,\n+      `      }`,\n+    ].join('\\n');\n+  }\n+}"
        },
        {
            "sha": "8782d0f5344154c0ce0b7c1b373daea1ce1455da",
            "filename": "packages/localize/src/tools/src/translate/main.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fmain.ts",
            "raw_url": "https://github.com/angular/angular/raw/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fmain.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fmain.ts?ref=5684ac5e34fd702e1cc73c760084ffc1ca5a3141",
            "patch": "@@ -15,6 +15,7 @@ import {AssetTranslationHandler} from './asset_files/asset_translation_handler';\n import {getOutputPathFn, OutputPathFn} from './output_path';\n import {SourceFileTranslationHandler} from './source_files/source_file_translation_handler';\n import {TranslationLoader} from './translation_files/translation_loader';\n+import {ArbTranslationParser} from './translation_files/translation_parsers/arb_translation_parser';\n import {SimpleJsonTranslationParser} from './translation_files/translation_parsers/simple_json_translation_parser';\n import {Xliff1TranslationParser} from './translation_files/translation_parsers/xliff1_translation_parser';\n import {Xliff2TranslationParser} from './translation_files/translation_parsers/xliff2_translation_parser';\n@@ -209,6 +210,7 @@ export function translateFiles({\n         new Xliff1TranslationParser(),\n         new XtbTranslationParser(),\n         new SimpleJsonTranslationParser(),\n+        new ArbTranslationParser(),\n       ],\n       duplicateTranslation, diagnostics);\n "
        },
        {
            "sha": "990b16a74b51f658fbc1d42b02f7a83a2ad8d8a9",
            "filename": "packages/localize/src/tools/src/translate/translation_files/translation_parsers/arb_translation_parser.ts",
            "status": "added",
            "additions": 102,
            "deletions": 0,
            "changes": 102,
            "blob_url": "https://github.com/angular/angular/blob/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Farb_translation_parser.ts",
            "raw_url": "https://github.com/angular/angular/raw/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Farb_translation_parser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Farb_translation_parser.ts?ref=5684ac5e34fd702e1cc73c760084ffc1ca5a3141",
            "patch": "@@ -0,0 +1,102 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {ɵMessageId, ɵparseTranslation, ɵSourceLocation, ɵSourceMessage} from '@angular/localize';\n+import {Diagnostics} from '../../../diagnostics';\n+import {ParseAnalysis, ParsedTranslationBundle, TranslationParser} from './translation_parser';\n+\n+export interface ArbJsonObject extends Record<ɵMessageId, ɵSourceMessage|ArbMetadata> {\n+  '@@locale': string;\n+}\n+\n+export interface ArbMetadata {\n+  type?: 'text'|'image'|'css';\n+  description?: string;\n+  ['x-locations']?: ArbLocation[];\n+}\n+\n+export interface ArbLocation {\n+  start: {line: number, column: number};\n+  end: {line: number, column: number};\n+  file: string;\n+}\n+\n+/**\n+ * A translation parser that can parse JSON formatted as an Application Resource Bundle (ARB).\n+ *\n+ * See https://github.com/google/app-resource-bundle/wiki/ApplicationResourceBundleSpecification\n+ *\n+ * ```\n+ * {\n+ *   \"@@locale\": \"en-US\",\n+ *   \"message-id\": \"Target message string\",\n+ *   \"@message-id\": {\n+ *     \"type\": \"text\",\n+ *     \"description\": \"Some description text\",\n+ *     \"x-locations\": [\n+ *       {\n+ *         \"start\": {\"line\": 23, \"column\": 145},\n+ *         \"end\": {\"line\": 24, \"column\": 53},\n+ *         \"file\": \"some/file.ts\"\n+ *       },\n+ *       ...\n+ *     ]\n+ *   },\n+ *   ...\n+ * }\n+ * ```\n+ */\n+export class ArbTranslationParser implements TranslationParser<ArbJsonObject> {\n+  /**\n+   * @deprecated\n+   */\n+  canParse(filePath: string, contents: string): ArbJsonObject|false {\n+    const result = this.analyze(filePath, contents);\n+    return result.canParse && result.hint;\n+  }\n+\n+  analyze(_filePath: string, contents: string): ParseAnalysis<ArbJsonObject> {\n+    const diagnostics = new Diagnostics();\n+    if (!contents.includes('\"@@locale\"')) {\n+      return {canParse: false, diagnostics};\n+    }\n+    try {\n+      // We can parse this file if it is valid JSON and contains the `\"@@locale\"` property.\n+      return {canParse: true, diagnostics, hint: this.tryParseArbFormat(contents)};\n+    } catch {\n+      diagnostics.warn('File is not valid JSON.');\n+      return {canParse: false, diagnostics};\n+    }\n+  }\n+\n+  parse(_filePath: string, contents: string, arb: ArbJsonObject = this.tryParseArbFormat(contents)):\n+      ParsedTranslationBundle {\n+    const bundle: ParsedTranslationBundle = {\n+      locale: arb['@@locale'],\n+      translations: {},\n+      diagnostics: new Diagnostics()\n+    };\n+\n+    for (const messageId of Object.keys(arb)) {\n+      if (messageId.startsWith('@')) {\n+        // Skip metadata keys\n+        continue;\n+      }\n+      const targetMessage = arb[messageId] as string;\n+      bundle.translations[messageId] = ɵparseTranslation(targetMessage);\n+    }\n+    return bundle;\n+  }\n+\n+  private tryParseArbFormat(contents: string): ArbJsonObject {\n+    const json = JSON.parse(contents);\n+    if (typeof json['@@locale'] !== 'string') {\n+      throw new Error('Missing @@locale property.');\n+    }\n+    return json;\n+  }\n+}"
        },
        {
            "sha": "6f695c4c9d89ee9421a47ab3324d56b3c8a55e7a",
            "filename": "packages/localize/src/tools/src/translate/translation_files/translation_parsers/simple_json_translation_parser.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fsimple_json_translation_parser.ts",
            "raw_url": "https://github.com/angular/angular/raw/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fsimple_json_translation_parser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fsimple_json_translation_parser.ts?ref=5684ac5e34fd702e1cc73c760084ffc1ca5a3141",
            "patch": "@@ -38,7 +38,10 @@ export class SimpleJsonTranslationParser implements TranslationParser<Object> {\n \n   analyze(filePath: string, contents: string): ParseAnalysis<Object> {\n     const diagnostics = new Diagnostics();\n-    if (extname(filePath) !== '.json') {\n+    // For this to be parsable, the extension must be `.json` and the contents must include \"locale\"\n+    // and \"translations\" keys.\n+    if (extname(filePath) !== '.json' ||\n+        !(contents.includes('\"locale\"') && contents.includes('\"translations\"'))) {\n       diagnostics.warn('File does not have .json extension.');\n       return {canParse: false, diagnostics};\n     }"
        },
        {
            "sha": "6663b785ce604a956fd67815ae34bdab2ade2346",
            "filename": "packages/localize/src/tools/test/extract/integration/main_spec.ts",
            "status": "modified",
            "additions": 81,
            "deletions": 1,
            "changes": 82,
            "blob_url": "https://github.com/angular/angular/blob/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts?ref=5684ac5e34fd702e1cc73c760084ffc1ca5a3141",
            "patch": "@@ -62,7 +62,7 @@ runInEachFileSystem(() => {\n \n     for (const useLegacyIds of [true, false]) {\n       describe(useLegacyIds ? '[using legacy ids]' : '', () => {\n-        it('should extract translations from source code, and write as JSON format', () => {\n+        it('should extract translations from source code, and write as simple JSON format', () => {\n           extractTranslations({\n             rootPath,\n             sourceLocale: 'en-GB',\n@@ -90,6 +90,86 @@ runInEachFileSystem(() => {\n           ].join('\\n'));\n         });\n \n+        it('should extract translations from source code, and write as ARB format', () => {\n+          extractTranslations({\n+            rootPath,\n+            sourceLocale: 'en-GB',\n+            sourceFilePaths: [sourceFilePath],\n+            format: 'arb',\n+            outputPath,\n+            logger,\n+            useSourceMaps: false,\n+            useLegacyIds,\n+            duplicateMessageHandling: 'ignore',\n+            fileSystem: fs,\n+          });\n+          expect(fs.readFile(outputPath)).toEqual([\n+            '{',\n+            '  \"@@locale\": \"en-GB\",',\n+            '  \"3291030485717846467\": \"Hello, {$PH}!\",',\n+            '  \"@3291030485717846467\": {',\n+            '    \"x-locations\": [',\n+            '      {',\n+            '        \"file\": \"test_files/test.js\",',\n+            '        \"start\": { \"line\": \"1\", \"column\": \"23\" },',\n+            '        \"end\": { \"line\": \"1\", \"column\": \"40\" }',\n+            '      }',\n+            '    ]',\n+            '  },',\n+            '  \"8669027859022295761\": \"try{$PH}me\",',\n+            '  \"@8669027859022295761\": {',\n+            '    \"x-locations\": [',\n+            '      {',\n+            '        \"file\": \"test_files/test.js\",',\n+            '        \"start\": { \"line\": \"2\", \"column\": \"22\" },',\n+            '        \"end\": { \"line\": \"2\", \"column\": \"80\" }',\n+            '      }',\n+            '    ]',\n+            '  },',\n+            '  \"custom-id\": \"Custom id message\",',\n+            '  \"@custom-id\": {',\n+            '    \"x-locations\": [',\n+            '      {',\n+            '        \"file\": \"test_files/test.js\",',\n+            '        \"start\": { \"line\": \"3\", \"column\": \"29\" },',\n+            '        \"end\": { \"line\": \"3\", \"column\": \"61\" }',\n+            '      }',\n+            '    ]',\n+            '  },',\n+            '  \"273296103957933077\": \"Legacy id message\",',\n+            '  \"@273296103957933077\": {',\n+            '    \"x-locations\": [',\n+            '      {',\n+            '        \"file\": \"test_files/test.js\",',\n+            '        \"start\": { \"line\": \"5\", \"column\": \"13\" },',\n+            '        \"end\": { \"line\": \"5\", \"column\": \"96\" }',\n+            '      }',\n+            '    ]',\n+            '  },',\n+            '  \"custom-id-2\": \"Custom and legacy message\",',\n+            '  \"@custom-id-2\": {',\n+            '    \"x-locations\": [',\n+            '      {',\n+            '        \"file\": \"test_files/test.js\",',\n+            '        \"start\": { \"line\": \"7\", \"column\": \"13\" },',\n+            '        \"end\": { \"line\": \"7\", \"column\": \"117\" }',\n+            '      }',\n+            '    ]',\n+            '  },',\n+            '  \"2932901491976224757\": \"pre{$START_TAG_SPAN}inner-pre{$START_BOLD_TEXT}bold{$CLOSE_BOLD_TEXT}inner-post{$CLOSE_TAG_SPAN}post\",',\n+            '  \"@2932901491976224757\": {',\n+            '    \"x-locations\": [',\n+            '      {',\n+            '        \"file\": \"test_files/test.js\",',\n+            '        \"start\": { \"line\": \"8\", \"column\": \"26\" },',\n+            '        \"end\": { \"line\": \"9\", \"column\": \"93\" }',\n+            '      }',\n+            '    ]',\n+            '  }',\n+            '}',\n+          ].join('\\n'));\n+        });\n+\n         it('should extract translations from source code, and write as xmb format', () => {\n           extractTranslations({\n             rootPath,"
        },
        {
            "sha": "5017151a1e0176dd58eeb5776e6aa9a01ab110a8",
            "filename": "packages/localize/src/tools/test/extract/translation_files/arb_translation_serializer_spec.ts",
            "status": "added",
            "additions": 116,
            "deletions": 0,
            "changes": 116,
            "blob_url": "https://github.com/angular/angular/blob/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Farb_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Farb_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Farb_translation_serializer_spec.ts?ref=5684ac5e34fd702e1cc73c760084ffc1ca5a3141",
            "patch": "@@ -0,0 +1,116 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {absoluteFrom, FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n+import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n+\n+import {ArbTranslationSerializer} from '../../../src/extract/translation_files/arb_translation_serializer';\n+\n+import {mockMessage} from './mock_message';\n+\n+runInEachFileSystem(() => {\n+  let fs: FileSystem;\n+  describe('ArbTranslationSerializer', () => {\n+    beforeEach(() => {\n+      fs = getFileSystem();\n+    });\n+\n+    describe('renderFile()', () => {\n+      it('should convert a set of parsed messages into a JSON string', () => {\n+        const messages: ɵParsedMessage[] = [\n+          mockMessage('12345', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n+            meaning: 'some meaning',\n+            location: {\n+              file: absoluteFrom('/project/file.ts'),\n+              start: {line: 5, column: 10},\n+              end: {line: 5, column: 12}\n+            },\n+          }),\n+          mockMessage('54321', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n+            customId: 'someId',\n+          }),\n+          mockMessage('67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'], {\n+            description: 'some description',\n+            location: {\n+              file: absoluteFrom('/project/file.ts'),\n+              start: {line: 5, column: 10},\n+              end: {line: 5, column: 12}\n+            },\n+          }),\n+          mockMessage('67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'], {\n+            description: 'some description',\n+            location: {\n+              file: absoluteFrom('/project/other.ts'),\n+              start: {line: 2, column: 10},\n+              end: {line: 3, column: 12}\n+            },\n+          }),\n+          mockMessage('13579', ['', 'b', ''], ['START_BOLD_TEXT', 'CLOSE_BOLD_TEXT'], {}),\n+          mockMessage('24680', ['a'], [], {meaning: 'meaning', description: 'and description'}),\n+          mockMessage('80808', ['multi\\nlines'], [], {}),\n+          mockMessage('90000', ['<escape', 'me>'], ['double-quotes-\"'], {}),\n+          mockMessage(\n+              '100000',\n+              [\n+                'pre-ICU {VAR_SELECT, select, a {a} b {{INTERPOLATION}} c {pre {INTERPOLATION_1} post}} post-ICU'\n+              ],\n+              [], {}),\n+          mockMessage(\n+              '100001',\n+              [\n+                '{VAR_PLURAL, plural, one {{START_BOLD_TEXT}something bold{CLOSE_BOLD_TEXT}} other {pre {START_TAG_SPAN}middle{CLOSE_TAG_SPAN} post}}'\n+              ],\n+              [], {}),\n+        ];\n+        const serializer = new ArbTranslationSerializer('xx', fs.resolve('/project'), fs);\n+        const output = serializer.serialize(messages);\n+        expect(output.split('\\n')).toEqual([\n+          '{',\n+          '  \"@@locale\": \"xx\",',\n+          '  \"12345\": \"a{$PH}b{$PH_1}c\",',\n+          '  \"@12345\": {',\n+          '    \"x-locations\": [',\n+          '      {',\n+          '        \"file\": \"file.ts\",',\n+          '        \"start\": { \"line\": \"5\", \"column\": \"10\" },',\n+          '        \"end\": { \"line\": \"5\", \"column\": \"12\" }',\n+          '      }',\n+          '    ]',\n+          '  },',\n+          '  \"someId\": \"a{$PH}b{$PH_1}c\",',\n+          '  \"67890\": \"a{$START_TAG_SPAN}{$CLOSE_TAG_SPAN}c\",',\n+          '  \"@67890\": {',\n+          '    \"description\": \"some description\",',\n+          '    \"x-locations\": [',\n+          '      {',\n+          '        \"file\": \"file.ts\",',\n+          '        \"start\": { \"line\": \"5\", \"column\": \"10\" },',\n+          '        \"end\": { \"line\": \"5\", \"column\": \"12\" }',\n+          '      },',\n+          '      {',\n+          '        \"file\": \"other.ts\",',\n+          '        \"start\": { \"line\": \"2\", \"column\": \"10\" },',\n+          '        \"end\": { \"line\": \"3\", \"column\": \"12\" }',\n+          '      }',\n+          '    ]',\n+          '  },',\n+          '  \"13579\": \"{$START_BOLD_TEXT}b{$CLOSE_BOLD_TEXT}\",',\n+          '  \"24680\": \"a\",',\n+          '  \"@24680\": {',\n+          '    \"description\": \"and description\"',\n+          '  },',\n+          '  \"80808\": \"multi\\\\nlines\",',\n+          '  \"90000\": \"<escape{$double-quotes-\\\\\"}me>\",',\n+          '  \"100000\": \"pre-ICU {VAR_SELECT, select, a {a} b {{INTERPOLATION}} c {pre {INTERPOLATION_1} post}} post-ICU\",',\n+          '  \"100001\": \"{VAR_PLURAL, plural, one {{START_BOLD_TEXT}something bold{CLOSE_BOLD_TEXT}} other {pre {START_TAG_SPAN}middle{CLOSE_TAG_SPAN} post}}\"',\n+          '}',\n+        ]);\n+      });\n+    });\n+  });\n+});"
        },
        {
            "sha": "54778105a95f1c1c6c3c236acc214f3e8c704c61",
            "filename": "packages/localize/src/tools/test/translate/translation_files/translation_parsers/arb_translation_parser_spec.ts",
            "status": "added",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/angular/angular/blob/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Farb_translation_parser_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/5684ac5e34fd702e1cc73c760084ffc1ca5a3141/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Farb_translation_parser_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Farb_translation_parser_spec.ts?ref=5684ac5e34fd702e1cc73c760084ffc1ca5a3141",
            "patch": "@@ -0,0 +1,50 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {ɵmakeTemplateObject} from '@angular/localize';\n+import {ArbTranslationParser} from '../../../../src/translate/translation_files/translation_parsers/arb_translation_parser';\n+\n+describe('SimpleArbTranslationParser', () => {\n+  describe('canParse()', () => {\n+    it('should return true if the file extension  is `.json` and contains `@@locale` property',\n+       () => {\n+         const parser = new ArbTranslationParser();\n+         expect(parser.canParse('/some/file.xlf', '')).toBe(false);\n+         expect(parser.canParse('/some/file.json', 'xxx')).toBe(false);\n+         expect(parser.canParse('/some/file.json', '{ \"someKey\": \"someValue\" }')).toBe(false);\n+         expect(parser.canParse('/some/file.json', '{ \"@@locale\": \"en\", \"someKey\": \"someValue\" }'))\n+             .toBeTruthy();\n+       });\n+  });\n+\n+  describe('parse()', () => {\n+    it('should extract the locale from the JSON contents', () => {\n+      const parser = new ArbTranslationParser();\n+      const result = parser.parse('/some/file.json', '{\"@@locale\": \"en\"}');\n+      expect(result.locale).toEqual('en');\n+    });\n+\n+    it('should extract and process the translations from the JSON contents', () => {\n+      const parser = new ArbTranslationParser();\n+      const result = parser.parse('/some/file.json', `{\n+        \"@@locale\": \"fr\",\n+        \"customId\": \"Bonjour, {$ph_1}!\",\n+        \"@customId\": {\n+          \"type\": \"text\",\n+          \"description\": \"Some description\"\n+        }\n+      }`);\n+      expect(result.translations).toEqual({\n+        'customId': {\n+          text: 'Bonjour, {$ph_1}!',\n+          messageParts: ɵmakeTemplateObject(['Bonjour, ', '!'], ['Bonjour, ', '!']),\n+          placeholderNames: ['ph_1'],\n+        },\n+      });\n+    });\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 460,
        "additions": 458,
        "deletions": 2
    }
}