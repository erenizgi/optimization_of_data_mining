{
    "author": "atscott",
    "message": "refactor(dev-infra): Add support for groups in the conditions evaluator (#38164)\n\nConditions can refer to the groups array that is a list of the preceding groups.\nThis commit adds support to the verification for those conditions.\n\nThis commit also adds some tests to the parsing and condition matching\nto ensure everything works as expected.\n\nPR Close #38164",
    "sha": "d0060dcfdc11a589337485ce32c2e81c45128ca3",
    "files": [
        {
            "sha": "4cd28756f03bef8550f39a7d8d515d10642c4d29",
            "filename": "dev-infra/pullapprove/BUILD.bazel",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2FBUILD.bazel?ref=d0060dcfdc11a589337485ce32c2e81c45128ca3",
            "patch": "@@ -1,4 +1,5 @@\n load(\"@npm_bazel_typescript//:index.bzl\", \"ts_library\")\n+load(\"//tools:defaults.bzl\", \"jasmine_node_test\")\n \n ts_library(\n     name = \"pullapprove\",\n@@ -8,6 +9,8 @@ ts_library(\n         \"group.ts\",\n         \"logging.ts\",\n         \"parse-yaml.ts\",\n+        \"pullapprove_arrays.ts\",\n+        \"utils.ts\",\n         \"verify.ts\",\n     ],\n     module_name = \"@angular/dev-infra-private/pullapprove\",\n@@ -25,3 +28,24 @@ ts_library(\n         \"@npm//yargs\",\n     ],\n )\n+\n+ts_library(\n+    name = \"pullapprove_test_lib\",\n+    testonly = True,\n+    srcs = glob(\n+        [\"*.spec.ts\"],\n+    ),\n+    visibility = [\"//visibility:private\"],\n+    deps = [\n+        \":pullapprove\",\n+        \"@npm//@types/jasmine\",\n+        \"@npm//@types/node\",\n+        \"@npm//typescript\",\n+    ],\n+)\n+\n+jasmine_node_test(\n+    name = \"pullapprove_test\",\n+    srcs = [\":pullapprove_test_lib\"],\n+    visibility = [\"//visibility:private\"],\n+)"
        },
        {
            "sha": "b64eb7a5a8f03621b1b25d4cc35e042f8b1a2344",
            "filename": "dev-infra/pullapprove/condition_evaluator.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 52,
            "changes": 69,
            "blob_url": "https://github.com/angular/angular/blob/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Fcondition_evaluator.ts",
            "raw_url": "https://github.com/angular/angular/raw/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Fcondition_evaluator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fcondition_evaluator.ts?ref=d0060dcfdc11a589337485ce32c2e81c45128ca3",
            "patch": "@@ -6,10 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {IMinimatch, Minimatch} from 'minimatch';\n-\n-/** Map that holds patterns and their corresponding Minimatch globs. */\n-const patternCache = new Map<string, IMinimatch>();\n+import {PullApproveGroup} from './group';\n+import {PullApproveGroupArray, PullApproveStringArray} from './pullapprove_arrays';\n+import {getOrCreateGlob} from './utils';\n \n /**\n  * Context that is provided to conditions. Conditions can use various helpers\n@@ -18,30 +17,34 @@ const patternCache = new Map<string, IMinimatch>();\n  */\n const conditionContext = {\n   'len': (value: any[]) => value.length,\n-  'contains_any_globs': (files: PullApproveArray, patterns: string[]) => {\n+  'contains_any_globs': (files: PullApproveStringArray, patterns: string[]) => {\n     // Note: Do not always create globs for the same pattern again. This method\n     // could be called for each source file. Creating glob's is expensive.\n     return files.some(f => patterns.some(pattern => getOrCreateGlob(pattern).match(f)));\n-  }\n+  },\n };\n \n /**\n  * Converts a given condition to a function that accepts a set of files. The returned\n  * function can be called to check if the set of files matches the condition.\n  */\n-export function convertConditionToFunction(expr: string): (files: string[]) => boolean {\n-  // Creates a dynamic function with the specified expression. The first parameter will\n-  // be `files` as that corresponds to the supported `files` variable that can be accessed\n-  // in PullApprove condition expressions. The followed parameters correspond to other\n-  // context variables provided by PullApprove for conditions.\n-  const evaluateFn = new Function('files', ...Object.keys(conditionContext), `\n+export function convertConditionToFunction(expr: string): (\n+    files: string[], groups: PullApproveGroup[]) => boolean {\n+  // Creates a dynamic function with the specified expression.\n+  // The first parameter will be `files` as that corresponds to the supported `files` variable that\n+  // can be accessed in PullApprove condition expressions. The second parameter is the list of\n+  // PullApproveGroups that are accessible in the condition expressions. The followed parameters\n+  // correspond to other context variables provided by PullApprove for conditions.\n+  const evaluateFn = new Function('files', 'groups', ...Object.keys(conditionContext), `\n     return (${transformExpressionToJs(expr)});\n   `);\n \n   // Create a function that calls the dynamically constructed function which mimics\n   // the condition expression that is usually evaluated with Python in PullApprove.\n-  return files => {\n-    const result = evaluateFn(new PullApproveArray(...files), ...Object.values(conditionContext));\n+  return (files, groups) => {\n+    const result = evaluateFn(\n+        new PullApproveStringArray(...files), new PullApproveGroupArray(...groups),\n+        ...Object.values(conditionContext));\n     // If an array is returned, we consider the condition as active if the array is not\n     // empty. This matches PullApprove's condition evaluation that is based on Python.\n     if (Array.isArray(result)) {\n@@ -59,41 +62,3 @@ export function convertConditionToFunction(expr: string): (files: string[]) => b\n function transformExpressionToJs(expression: string): string {\n   return expression.replace(/not\\s+/g, '!');\n }\n-\n-/**\n- * Superset of a native array. The superset provides methods which mimic the\n- * list data structure used in PullApprove for files in conditions.\n- */\n-class PullApproveArray extends Array<string> {\n-  constructor(...elements: string[]) {\n-    super(...elements);\n-\n-    // Set the prototype explicitly because in ES5, the prototype is accidentally\n-    // lost due to a limitation in down-leveling.\n-    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n-    Object.setPrototypeOf(this, PullApproveArray.prototype);\n-  }\n-\n-  /** Returns a new array which only includes files that match the given pattern. */\n-  include(pattern: string): PullApproveArray {\n-    return new PullApproveArray(...this.filter(s => getOrCreateGlob(pattern).match(s)));\n-  }\n-\n-  /** Returns a new array which only includes files that did not match the given pattern. */\n-  exclude(pattern: string): PullApproveArray {\n-    return new PullApproveArray(...this.filter(s => !getOrCreateGlob(pattern).match(s)));\n-  }\n-}\n-\n-/**\n- * Gets a glob for the given pattern. The cached glob will be returned\n- * if available. Otherwise a new glob will be created and cached.\n- */\n-function getOrCreateGlob(pattern: string) {\n-  if (patternCache.has(pattern)) {\n-    return patternCache.get(pattern)!;\n-  }\n-  const glob = new Minimatch(pattern, {dot: true});\n-  patternCache.set(pattern, glob);\n-  return glob;\n-}"
        },
        {
            "sha": "45de9eac236c8607e5291918f0fc441b6771504c",
            "filename": "dev-infra/pullapprove/group.ts",
            "status": "modified",
            "additions": 25,
            "deletions": 10,
            "changes": 35,
            "blob_url": "https://github.com/angular/angular/blob/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Fgroup.ts",
            "raw_url": "https://github.com/angular/angular/raw/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Fgroup.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fgroup.ts?ref=d0060dcfdc11a589337485ce32c2e81c45128ca3",
            "patch": "@@ -6,14 +6,15 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {error} from '../utils/console';\n+import {error, warn} from '../utils/console';\n import {convertConditionToFunction} from './condition_evaluator';\n import {PullApproveGroupConfig} from './parse-yaml';\n+import {PullApproveGroupStateDependencyError} from './pullapprove_arrays';\n \n /** A condition for a group. */\n interface GroupCondition {\n   expression: string;\n-  checkFn: (files: string[]) => boolean;\n+  checkFn: (files: string[], groups: PullApproveGroup[]) => boolean;\n   matchedFiles: Set<string>;\n }\n \n@@ -39,7 +40,9 @@ export class PullApproveGroup {\n   /** List of conditions for the group. */\n   conditions: GroupCondition[] = [];\n \n-  constructor(public groupName: string, config: PullApproveGroupConfig) {\n+  constructor(\n+      public groupName: string, config: PullApproveGroupConfig,\n+      readonly precedingGroups: PullApproveGroup[] = []) {\n     this._captureConditions(config);\n   }\n \n@@ -78,18 +81,30 @@ export class PullApproveGroup {\n   testFile(filePath: string): boolean {\n     return this.conditions.every(({matchedFiles, checkFn, expression}) => {\n       try {\n-        const matchesFile = checkFn([filePath]);\n+        const matchesFile = checkFn([filePath], this.precedingGroups);\n         if (matchesFile) {\n           matchedFiles.add(filePath);\n         }\n         return matchesFile;\n       } catch (e) {\n-        const errMessage = `Condition could not be evaluated: \\n\\n` +\n-            `From the [${this.groupName}] group:\\n` +\n-            ` - ${expression}` +\n-            `\\n\\n${e.message} ${e.stack}\\n\\n`;\n-        error(errMessage);\n-        process.exit(1);\n+        // In the case of a condition that depends on the state of groups we want to just\n+        // warn that the verification can't accurately evaluate the condition and then\n+        // continue processing. Other types of errors fail the verification, as conditions\n+        // should otherwise be able to execute without throwing.\n+        if (e instanceof PullApproveGroupStateDependencyError) {\n+          const errMessage = `Condition could not be evaluated: \\n` +\n+              `${e.message}\\n` +\n+              `From the [${this.groupName}] group:\\n` +\n+              ` - ${expression}`;\n+          warn(errMessage);\n+        } else {\n+          const errMessage = `Condition could not be evaluated: \\n\\n` +\n+              `From the [${this.groupName}] group:\\n` +\n+              ` - ${expression}` +\n+              `\\n\\n${e.message} ${e.stack}\\n\\n`;\n+          error(errMessage);\n+          process.exit(1);\n+        }\n       }\n     });\n   }"
        },
        {
            "sha": "fc0289ecce7efdbdcc23c6f8fac4373018fc7c03",
            "filename": "dev-infra/pullapprove/parse-yaml.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Fparse-yaml.ts",
            "raw_url": "https://github.com/angular/angular/raw/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Fparse-yaml.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fparse-yaml.ts?ref=d0060dcfdc11a589337485ce32c2e81c45128ca3",
            "patch": "@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import {parse as parseYaml} from 'yaml';\n+import {PullApproveGroup} from './group';\n \n export interface PullApproveGroupConfig {\n   conditions?: string[];\n@@ -33,3 +34,12 @@ export interface PullApproveConfig {\n export function parsePullApproveYaml(rawYaml: string): PullApproveConfig {\n   return parseYaml(rawYaml, {merge: true}) as PullApproveConfig;\n }\n+\n+/** Parses all of the groups defined in the pullapprove yaml. */\n+export function getGroupsFromYaml(pullApproveYamlRaw: string): PullApproveGroup[] {\n+  /** JSON representation of the pullapprove yaml file. */\n+  const pullApprove = parsePullApproveYaml(pullApproveYamlRaw);\n+  return Object.entries(pullApprove.groups).reduce((groups, [groupName, group]) => {\n+    return groups.concat(new PullApproveGroup(groupName, group, groups));\n+  }, [] as PullApproveGroup[]);\n+}"
        },
        {
            "sha": "46cec6d5227baef2ab36d15f73f46c623b74f7ef",
            "filename": "dev-infra/pullapprove/pullapprove_arrays.ts",
            "status": "added",
            "additions": 89,
            "deletions": 0,
            "changes": 89,
            "blob_url": "https://github.com/angular/angular/blob/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Fpullapprove_arrays.ts",
            "raw_url": "https://github.com/angular/angular/raw/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Fpullapprove_arrays.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fpullapprove_arrays.ts?ref=d0060dcfdc11a589337485ce32c2e81c45128ca3",
            "patch": "@@ -0,0 +1,89 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {PullApproveGroup} from './group';\n+import {getOrCreateGlob} from './utils';\n+\n+export class PullApproveGroupStateDependencyError extends Error {\n+  constructor(message?: string) {\n+    super(message);\n+    // Set the prototype explicitly because in ES5, the prototype is accidentally\n+    // lost due to a limitation in down-leveling.\n+    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n+    Object.setPrototypeOf(this, PullApproveGroupStateDependencyError.prototype);\n+    // Error names are displayed in their stack but can't be set in the constructor.\n+    this.name = PullApproveGroupStateDependencyError.name;\n+  }\n+}\n+\n+/**\n+ * Superset of a native array. The superset provides methods which mimic the\n+ * list data structure used in PullApprove for files in conditions.\n+ */\n+export class PullApproveStringArray extends Array<string> {\n+  constructor(...elements: string[]) {\n+    super(...elements);\n+\n+    // Set the prototype explicitly because in ES5, the prototype is accidentally\n+    // lost due to a limitation in down-leveling.\n+    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n+    Object.setPrototypeOf(this, PullApproveStringArray.prototype);\n+  }\n+  /** Returns a new array which only includes files that match the given pattern. */\n+  include(pattern: string): PullApproveStringArray {\n+    return new PullApproveStringArray(...this.filter(s => getOrCreateGlob(pattern).match(s)));\n+  }\n+\n+  /** Returns a new array which only includes files that did not match the given pattern. */\n+  exclude(pattern: string): PullApproveStringArray {\n+    return new PullApproveStringArray(...this.filter(s => !getOrCreateGlob(pattern).match(s)));\n+  }\n+}\n+\n+/**\n+ * Superset of a native array. The superset provides methods which mimic the\n+ * list data structure used in PullApprove for groups in conditions.\n+ */\n+export class PullApproveGroupArray extends Array<PullApproveGroup> {\n+  constructor(...elements: PullApproveGroup[]) {\n+    super(...elements);\n+\n+    // Set the prototype explicitly because in ES5, the prototype is accidentally\n+    // lost due to a limitation in down-leveling.\n+    // https://github.com/Microsoft/TypeScript/wiki/FAQ#why-doesnt-extending-built-ins-like-error-array-and-map-work.\n+    Object.setPrototypeOf(this, PullApproveGroupArray.prototype);\n+  }\n+\n+  include(pattern: string): PullApproveGroupArray {\n+    return new PullApproveGroupArray(...this.filter(s => s.groupName.match(pattern)));\n+  }\n+\n+  /** Returns a new array which only includes files that did not match the given pattern. */\n+  exclude(pattern: string): PullApproveGroupArray {\n+    return new PullApproveGroupArray(...this.filter(s => s.groupName.match(pattern)));\n+  }\n+\n+  get pending() {\n+    throw new PullApproveGroupStateDependencyError();\n+  }\n+\n+  get active() {\n+    throw new PullApproveGroupStateDependencyError();\n+  }\n+\n+  get inactive() {\n+    throw new PullApproveGroupStateDependencyError();\n+  }\n+\n+  get rejected() {\n+    throw new PullApproveGroupStateDependencyError();\n+  }\n+\n+  get names() {\n+    return this.map(g => g.groupName);\n+  }\n+}"
        },
        {
            "sha": "8e93f07a9f7f1be3b2029ba636baf35693ba073e",
            "filename": "dev-infra/pullapprove/utils.ts",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Futils.ts?ref=d0060dcfdc11a589337485ce32c2e81c45128ca3",
            "patch": "@@ -0,0 +1,24 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {IMinimatch, Minimatch} from 'minimatch';\n+\n+/** Map that holds patterns and their corresponding Minimatch globs. */\n+const patternCache = new Map<string, IMinimatch>();\n+\n+/**\n+ * Gets a glob for the given pattern. The cached glob will be returned\n+ * if available. Otherwise a new glob will be created and cached.\n+ */\n+export function getOrCreateGlob(pattern: string) {\n+  if (patternCache.has(pattern)) {\n+    return patternCache.get(pattern)!;\n+  }\n+  const glob = new Minimatch(pattern, {dot: true});\n+  patternCache.set(pattern, glob);\n+  return glob;\n+}"
        },
        {
            "sha": "f3ddb620887e7849a3b18e84c3791c30cd13f2e7",
            "filename": "dev-infra/pullapprove/verify.spec.ts",
            "status": "added",
            "additions": 88,
            "deletions": 0,
            "changes": 88,
            "blob_url": "https://github.com/angular/angular/blob/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Fverify.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Fverify.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fverify.spec.ts?ref=d0060dcfdc11a589337485ce32c2e81c45128ca3",
            "patch": "@@ -0,0 +1,88 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {PullApproveGroup} from './group';\n+import {getGroupsFromYaml} from './parse-yaml';\n+\n+describe('group parsing', () => {\n+  it('gets group name', () => {\n+    const groupName = 'fw-migrations';\n+    const groups = getGroupsFromYaml(`\n+      groups:\n+        ${groupName}:\n+          type: optional\n+      `);\n+    expect(groups[0].groupName).toBe(groupName);\n+  });\n+\n+  it('gets correct number of groups', () => {\n+    const groups = getGroupsFromYaml(`\n+      groups:\n+        fw-migrations:\n+          type: optional\n+        fw-core:\n+          type: optional\n+      `);\n+    expect(groups.length).toBe(2);\n+  });\n+\n+  it('gets preceding groups', () => {\n+    const groups = getGroupsFromYaml(`\n+      groups:\n+        fw-migrations:\n+          type: optional\n+        fw-core:\n+          type: optional\n+        dev-infra:\n+          type: optional\n+      `);\n+    const fwMigrations = getGroupByName(groups, 'fw-migrations')!;\n+    const fwCore = getGroupByName(groups, 'fw-core')!;\n+    const devInfra = getGroupByName(groups, 'dev-infra')!;\n+    expect(getGroupNames(fwMigrations.precedingGroups)).toEqual([]);\n+    expect(getGroupNames(fwCore.precedingGroups)).toEqual([fwMigrations.groupName]);\n+    expect(getGroupNames(devInfra.precedingGroups)).toEqual([\n+      fwMigrations.groupName, fwCore.groupName\n+    ]);\n+  });\n+\n+  it('matches file conditions', () => {\n+    const groups = getGroupsFromYaml(`\n+      groups:\n+        fw-core:\n+          conditions:\n+            - contains_any_globs(files, ['packages/core/**'])\n+      `);\n+    const fwCore = getGroupByName(groups, 'fw-core')!;\n+    expect(fwCore.testFile('packages/core/test.ts')).toBe(true);\n+    expect(fwCore.testFile('some/other/location/test.ts')).toBe(false);\n+  });\n+\n+  it('allows conditions based on groups', () => {\n+    const groups = getGroupsFromYaml(`\n+      groups:\n+        fw-migrations:\n+          conditions:\n+            - len(groups) > 0\n+        fw-core:\n+          conditions:\n+            - len(groups.active) > 0\n+      `);\n+    const fwMigrations = getGroupByName(groups, 'fw-migrations')!;\n+    expect(() => fwMigrations.testFile('any')).not.toThrow();\n+    const fwCore = getGroupByName(groups, 'fw-core')!;\n+    expect(() => fwCore.testFile('any')).not.toThrow();\n+  });\n+});\n+\n+function getGroupByName(groups: PullApproveGroup[], name: string): PullApproveGroup|undefined {\n+  return groups.find(g => g.groupName === name);\n+}\n+\n+function getGroupNames(groups: PullApproveGroup[]) {\n+  return groups.map(g => g.groupName);\n+}"
        },
        {
            "sha": "d8302c2caa0099c2a3e4e01d76f8aaca77ef8c99",
            "filename": "dev-infra/pullapprove/verify.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Fverify.ts",
            "raw_url": "https://github.com/angular/angular/raw/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Fpullapprove%2Fverify.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fverify.ts?ref=d0060dcfdc11a589337485ce32c2e81c45128ca3",
            "patch": "@@ -11,10 +11,8 @@ import {resolve} from 'path';\n import {getRepoBaseDir} from '../utils/config';\n import {debug, info} from '../utils/console';\n import {allFiles} from '../utils/repo-files';\n-\n-import {PullApproveGroup} from './group';\n import {logGroup, logHeader} from './logging';\n-import {parsePullApproveYaml} from './parse-yaml';\n+import {getGroupsFromYaml} from './parse-yaml';\n \n export function verify() {\n   /** Full path to PullApprove config file */\n@@ -23,12 +21,8 @@ export function verify() {\n   const REPO_FILES = allFiles();\n   /** The pull approve config file. */\n   const pullApproveYamlRaw = readFileSync(PULL_APPROVE_YAML_PATH, 'utf8');\n-  /** JSON representation of the pullapprove yaml file. */\n-  const pullApprove = parsePullApproveYaml(pullApproveYamlRaw);\n   /** All of the groups defined in the pullapprove yaml. */\n-  const groups = Object.entries(pullApprove.groups).map(([groupName, group]) => {\n-    return new PullApproveGroup(groupName, group);\n-  });\n+  const groups = getGroupsFromYaml(pullApproveYamlRaw);\n   /**\n    * PullApprove groups without conditions. These are skipped in the verification\n    * as those would always be active and cause zero unmatched files."
        },
        {
            "sha": "248aaddacfcaa6e499cd2adab8e9c1eac81dfad1",
            "filename": "dev-infra/utils/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Futils%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/d0060dcfdc11a589337485ce32c2e81c45128ca3/dev-infra%2Futils%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2FBUILD.bazel?ref=d0060dcfdc11a589337485ce32c2e81c45128ca3",
            "patch": "@@ -16,6 +16,7 @@ ts_library(\n         \"@npm//@types/node\",\n         \"@npm//@types/shelljs\",\n         \"@npm//chalk\",\n+        \"@npm//inquirer\",\n         \"@npm//shelljs\",\n         \"@npm//tslib\",\n         \"@npm//typed-graphqlify\","
        }
    ],
    "stats": {
        "total": 350,
        "additions": 280,
        "deletions": 70
    }
}