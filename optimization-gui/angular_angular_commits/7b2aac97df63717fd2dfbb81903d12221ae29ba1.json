{
    "author": "ranma42",
    "message": "feat(common): stricter types for number pipes (#37447)\n\nMake typing of number pipes stricter to catch some misuses (such as\npassing an Observable or an array) at compile time.\n\nBREAKING CHANGE:\nThe signatures of the number pipes now explicitly state which types are\naccepted. This should only cause issues in corner cases, as any other\nvalues would result in runtime exceptions.\n\nPR Close #37447",
    "sha": "7b2aac97df63717fd2dfbb81903d12221ae29ba1",
    "files": [
        {
            "sha": "12574a69976806438e16ed5459af8ee7b93a5492",
            "filename": "goldens/public-api/common/common.d.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/7b2aac97df63717fd2dfbb81903d12221ae29ba1/goldens%2Fpublic-api%2Fcommon%2Fcommon.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/7b2aac97df63717fd2dfbb81903d12221ae29ba1/goldens%2Fpublic-api%2Fcommon%2Fcommon.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fcommon%2Fcommon.d.ts?ref=7b2aac97df63717fd2dfbb81903d12221ae29ba1",
            "patch": "@@ -13,7 +13,9 @@ export declare class CommonModule {\n \n export declare class CurrencyPipe implements PipeTransform {\n     constructor(_locale: string, _defaultCurrencyCode?: string);\n-    transform(value: any, currencyCode?: string, display?: 'code' | 'symbol' | 'symbol-narrow' | string | boolean, digitsInfo?: string, locale?: string): string | null;\n+    transform(value: number | string, currencyCode?: string, display?: 'code' | 'symbol' | 'symbol-narrow' | string | boolean, digitsInfo?: string, locale?: string): string | null;\n+    transform(value: null | undefined, currencyCode?: string, display?: 'code' | 'symbol' | 'symbol-narrow' | string | boolean, digitsInfo?: string, locale?: string): null;\n+    transform(value: number | string | null | undefined, currencyCode?: string, display?: 'code' | 'symbol' | 'symbol-narrow' | string | boolean, digitsInfo?: string, locale?: string): string | null;\n }\n \n export declare class DatePipe implements PipeTransform {\n@@ -25,7 +27,9 @@ export declare class DatePipe implements PipeTransform {\n \n export declare class DecimalPipe implements PipeTransform {\n     constructor(_locale: string);\n-    transform(value: any, digitsInfo?: string, locale?: string): string | null;\n+    transform(value: number | string, digitsInfo?: string, locale?: string): string | null;\n+    transform(value: null | undefined, digitsInfo?: string, locale?: string): null;\n+    transform(value: number | string | null | undefined, digitsInfo?: string, locale?: string): string | null;\n }\n \n export declare const DOCUMENT: InjectionToken<Document>;\n@@ -342,7 +346,9 @@ export declare class PathLocationStrategy extends LocationStrategy {\n \n export declare class PercentPipe implements PipeTransform {\n     constructor(_locale: string);\n-    transform(value: any, digitsInfo?: string, locale?: string): string | null;\n+    transform(value: number | string, digitsInfo?: string, locale?: string): string | null;\n+    transform(value: null | undefined, digitsInfo?: string, locale?: string): null;\n+    transform(value: number | string | null | undefined, digitsInfo?: string, locale?: string): string | null;\n }\n \n export declare abstract class PlatformLocation {"
        },
        {
            "sha": "edc6d080949e4ae81a287d8e7240bcd3cec1daa5",
            "filename": "packages/common/src/pipes/number_pipe.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 8,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/7b2aac97df63717fd2dfbb81903d12221ae29ba1/packages%2Fcommon%2Fsrc%2Fpipes%2Fnumber_pipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/7b2aac97df63717fd2dfbb81903d12221ae29ba1/packages%2Fcommon%2Fsrc%2Fpipes%2Fnumber_pipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Fpipes%2Fnumber_pipe.ts?ref=7b2aac97df63717fd2dfbb81903d12221ae29ba1",
            "patch": "@@ -67,8 +67,12 @@ export class DecimalPipe implements PipeTransform {\n    * When not supplied, uses the value of `LOCALE_ID`, which is `en-US` by default.\n    * See [Setting your app locale](guide/i18n#setting-up-the-locale-of-your-app).\n    */\n-  transform(value: any, digitsInfo?: string, locale?: string): string|null {\n-    if (isEmpty(value)) return null;\n+  transform(value: number|string, digitsInfo?: string, locale?: string): string|null;\n+  transform(value: null|undefined, digitsInfo?: string, locale?: string): null;\n+  transform(value: number|string|null|undefined, digitsInfo?: string, locale?: string): string|null;\n+  transform(value: number|string|null|undefined, digitsInfo?: string, locale?: string): string\n+      |null {\n+    if (!isValue(value)) return null;\n \n     locale = locale || this._locale;\n \n@@ -121,8 +125,12 @@ export class PercentPipe implements PipeTransform {\n    * When not supplied, uses the value of `LOCALE_ID`, which is `en-US` by default.\n    * See [Setting your app locale](guide/i18n#setting-up-the-locale-of-your-app).\n    */\n-  transform(value: any, digitsInfo?: string, locale?: string): string|null {\n-    if (isEmpty(value)) return null;\n+  transform(value: number|string, digitsInfo?: string, locale?: string): string|null;\n+  transform(value: null|undefined, digitsInfo?: string, locale?: string): null;\n+  transform(value: number|string|null|undefined, digitsInfo?: string, locale?: string): string|null;\n+  transform(value: number|string|null|undefined, digitsInfo?: string, locale?: string): string\n+      |null {\n+    if (!isValue(value)) return null;\n     locale = locale || this._locale;\n     try {\n       const num = strToNumber(value);\n@@ -213,10 +221,22 @@ export class CurrencyPipe implements PipeTransform {\n    * See [Setting your app locale](guide/i18n#setting-up-the-locale-of-your-app).\n    */\n   transform(\n-      value: any, currencyCode?: string,\n+      value: number|string, currencyCode?: string,\n+      display?: 'code'|'symbol'|'symbol-narrow'|string|boolean, digitsInfo?: string,\n+      locale?: string): string|null;\n+  transform(\n+      value: null|undefined, currencyCode?: string,\n+      display?: 'code'|'symbol'|'symbol-narrow'|string|boolean, digitsInfo?: string,\n+      locale?: string): null;\n+  transform(\n+      value: number|string|null|undefined, currencyCode?: string,\n+      display?: 'code'|'symbol'|'symbol-narrow'|string|boolean, digitsInfo?: string,\n+      locale?: string): string|null;\n+  transform(\n+      value: number|string|null|undefined, currencyCode?: string,\n       display: 'code'|'symbol'|'symbol-narrow'|string|boolean = 'symbol', digitsInfo?: string,\n       locale?: string): string|null {\n-    if (isEmpty(value)) return null;\n+    if (!isValue(value)) return null;\n \n     locale = locale || this._locale;\n \n@@ -246,8 +266,8 @@ export class CurrencyPipe implements PipeTransform {\n   }\n }\n \n-function isEmpty(value: any): boolean {\n-  return value == null || value === '' || value !== value;\n+function isValue(value: number|string|null|undefined): value is number|string {\n+  return !(value == null || value === '' || value !== value);\n }\n \n /**"
        },
        {
            "sha": "249cc57eeedb5422c13a87fe7fd6cee1312d5e3f",
            "filename": "packages/common/test/pipes/number_pipe_spec.ts",
            "status": "modified",
            "additions": 39,
            "deletions": 3,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/7b2aac97df63717fd2dfbb81903d12221ae29ba1/packages%2Fcommon%2Ftest%2Fpipes%2Fnumber_pipe_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7b2aac97df63717fd2dfbb81903d12221ae29ba1/packages%2Fcommon%2Ftest%2Fpipes%2Fnumber_pipe_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Ftest%2Fpipes%2Fnumber_pipe_spec.ts?ref=7b2aac97df63717fd2dfbb81903d12221ae29ba1",
            "patch": "@@ -50,8 +50,20 @@ import {beforeEach, describe, expect, it} from '@angular/core/testing/src/testin\n           expect(pipe.transform('1.1234')).toEqual('1.123');\n         });\n \n+        it('should return null for NaN', () => {\n+          expect(pipe.transform(Number.NaN)).toEqual(null);\n+        });\n+\n+        it('should return null for null', () => {\n+          expect(pipe.transform(null)).toEqual(null);\n+        });\n+\n+        it('should return null for undefined', () => {\n+          expect(pipe.transform(undefined)).toEqual(null);\n+        });\n+\n         it('should not support other objects', () => {\n-          expect(() => pipe.transform({}))\n+          expect(() => pipe.transform({} as any))\n               .toThrowError(\n                   `InvalidPipeArgument: '[object Object] is not a number' for pipe 'DecimalPipe'`);\n           expect(() => pipe.transform('123abc'))\n@@ -82,8 +94,20 @@ import {beforeEach, describe, expect, it} from '@angular/core/testing/src/testin\n           expect(pipe.transform(12.3456, '0.0-10')).toEqual('1,234.56%');\n         });\n \n+        it('should return null for NaN', () => {\n+          expect(pipe.transform(Number.NaN)).toEqual(null);\n+        });\n+\n+        it('should return null for null', () => {\n+          expect(pipe.transform(null)).toEqual(null);\n+        });\n+\n+        it('should return null for undefined', () => {\n+          expect(pipe.transform(undefined)).toEqual(null);\n+        });\n+\n         it('should not support other objects', () => {\n-          expect(() => pipe.transform({}))\n+          expect(() => pipe.transform({} as any))\n               .toThrowError(\n                   `InvalidPipeArgument: '[object Object] is not a number' for pipe 'PercentPipe'`);\n         });\n@@ -125,8 +149,20 @@ import {beforeEach, describe, expect, it} from '@angular/core/testing/src/testin\n           expect(pipe.transform(5.1234, 'USD', 'Custom name')).toEqual('Custom name5.12');\n         });\n \n+        it('should return null for NaN', () => {\n+          expect(pipe.transform(Number.NaN)).toEqual(null);\n+        });\n+\n+        it('should return null for null', () => {\n+          expect(pipe.transform(null)).toEqual(null);\n+        });\n+\n+        it('should return null for undefined', () => {\n+          expect(pipe.transform(undefined)).toEqual(null);\n+        });\n+\n         it('should not support other objects', () => {\n-          expect(() => pipe.transform({}))\n+          expect(() => pipe.transform({} as any))\n               .toThrowError(\n                   `InvalidPipeArgument: '[object Object] is not a number' for pipe 'CurrencyPipe'`);\n         });"
        }
    ],
    "stats": {
        "total": 90,
        "additions": 76,
        "deletions": 14
    }
}