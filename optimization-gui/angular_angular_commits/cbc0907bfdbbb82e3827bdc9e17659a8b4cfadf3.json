{
    "author": "crisbeto",
    "message": "fix(compiler): preserve this.$event and this.$any accesses in expressions (#39323)\n\nCurrently expressions `$event.foo()` and `this.$event.foo()`, as well as `$any(foo)` and\n`this.$any(foo)`, are treated as the same expression by the compiler, because `this` is considered\nthe same implicit receiver as when the receiver is omitted. This introduces the following issues:\n\n1. Any time something called `$any` is used, it'll be stripped away, leaving only the first parameter.\n2. If something called `$event` is used anywhere in a template, it'll be preserved as `$event`,\nrather than being rewritten to `ctx.$event`, causing the value to undefined at runtime. This\napplies to listener, property and text bindings.\n\nThese changes resolve the first issue and part of the second one by preserving anything that\nis accessed through `this`, even if it's one of the \"special\" ones like `$any` or `$event`.\nFurthermore, these changes only expose the `$event` global variable inside event listeners,\nwhereas previously it was available everywhere.\n\nFixes #30278.\n\nPR Close #39323",
    "sha": "cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
    "files": [
        {
            "sha": "f4360a183cf4ce33962438a88dba88324da74f04",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/expression.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fexpression.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fexpression.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fexpression.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AST, AstVisitor, ASTWithSource, Binary, BindingPipe, Chain, Conditional, EmptyExpr, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, NonNullAssert, PrefixNot, PropertyRead, PropertyWrite, Quote, SafeMethodCall, SafePropertyRead, Unary} from '@angular/compiler';\n+import {AST, AstVisitor, ASTWithSource, Binary, BindingPipe, Chain, Conditional, EmptyExpr, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, NonNullAssert, PrefixNot, PropertyRead, PropertyWrite, Quote, SafeMethodCall, SafePropertyRead, ThisReceiver, Unary} from '@angular/compiler';\n import * as ts from 'typescript';\n import {TypeCheckingConfig} from '../api';\n \n@@ -137,6 +137,10 @@ class AstTranslator implements AstVisitor {\n     throw new Error('Method not implemented.');\n   }\n \n+  visitThisReceiver(ast: ThisReceiver): never {\n+    throw new Error('Method not implemented.');\n+  }\n+\n   visitInterpolation(ast: Interpolation): ts.Expression {\n     // Build up a chain of binary + operations to simulate the string concatenation of the\n     // interpolation's expressions. The chain is started using an actual string literal to ensure\n@@ -363,6 +367,9 @@ class VeSafeLhsInferenceBugDetector implements AstVisitor {\n   visitImplicitReceiver(ast: ImplicitReceiver): boolean {\n     return false;\n   }\n+  visitThisReceiver(ast: ThisReceiver): boolean {\n+    return false;\n+  }\n   visitInterpolation(ast: Interpolation): boolean {\n     return ast.expressions.some(exp => exp.visit(this));\n   }"
        },
        {
            "sha": "73608a6d4e0692a7ded1a25a8a5ee91121b97990",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/type_check_block.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AST, BindingPipe, BindingType, BoundTarget, DYNAMIC_TYPE, ImplicitReceiver, MethodCall, ParsedEventType, ParseSourceSpan, PropertyRead, PropertyWrite, SchemaMetadata, TmplAstBoundAttribute, TmplAstBoundEvent, TmplAstBoundText, TmplAstElement, TmplAstIcu, TmplAstNode, TmplAstReference, TmplAstTemplate, TmplAstTextAttribute, TmplAstVariable} from '@angular/compiler';\n+import {AST, BindingPipe, BindingType, BoundTarget, DYNAMIC_TYPE, ImplicitReceiver, MethodCall, ParsedEventType, ParseSourceSpan, PropertyRead, PropertyWrite, SchemaMetadata, ThisReceiver, TmplAstBoundAttribute, TmplAstBoundEvent, TmplAstBoundText, TmplAstElement, TmplAstIcu, TmplAstNode, TmplAstReference, TmplAstTemplate, TmplAstTextAttribute, TmplAstVariable} from '@angular/compiler';\n import * as ts from 'typescript';\n \n import {Reference} from '../../imports';\n@@ -1586,7 +1586,9 @@ class TcbExpressionTranslator {\n       const result = tsCallMethod(pipe, 'transform', [expr, ...args]);\n       addParseSpanInfo(result, ast.sourceSpan);\n       return result;\n-    } else if (ast instanceof MethodCall && ast.receiver instanceof ImplicitReceiver) {\n+    } else if (\n+        ast instanceof MethodCall && ast.receiver instanceof ImplicitReceiver &&\n+        !(ast.receiver instanceof ThisReceiver)) {\n       // Resolve the special `$any(expr)` syntax to insert a cast of the argument to type `any`.\n       // `$any(expr)` -> `expr as any`\n       if (ast.name === '$any' && ast.args.length === 1) {\n@@ -1843,7 +1845,7 @@ class TcbEventHandlerTranslator extends TcbExpressionTranslator {\n     // function that the converted expression becomes a child of, just create a reference to the\n     // parameter by its name.\n     if (ast instanceof PropertyRead && ast.receiver instanceof ImplicitReceiver &&\n-        ast.name === EVENT_PARAMETER) {\n+        !(ast.receiver instanceof ThisReceiver) && ast.name === EVENT_PARAMETER) {\n       const event = ts.createIdentifier(EVENT_PARAMETER);\n       addParseSpanInfo(event, ast.nameSpan);\n       return event;"
        },
        {
            "sha": "ed60b9d31f1bb3eec1198077587e867de7c27d20",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/type_check_block_spec.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -584,6 +584,12 @@ describe('type check blocks', () => {\n     expect(block).toContain('(((ctx).a) as any)');\n   });\n \n+  it('should handle $any accessed through `this`', () => {\n+    const TEMPLATE = `{{this.$any(a)}}`;\n+    const block = tcb(TEMPLATE);\n+    expect(block).toContain('((ctx).$any(((ctx).a)))');\n+  });\n+\n   describe('experimental DOM checking via lib.dom.d.ts', () => {\n     it('should translate unclaimed bindings to their property equivalent', () => {\n       const TEMPLATE = `<label [for]=\"'test'\"></label>`;\n@@ -684,6 +690,14 @@ describe('type check blocks', () => {\n       expect(block).toContain(\n           '_t3.addEventListener(\"event\", function ($event): any { (_t2 = 3); });');\n     });\n+\n+    it('should ignore accesses to $event through `this`', () => {\n+      const TEMPLATE = `<div (event)=\"foo(this.$event)\"></div>`;\n+      const block = tcb(TEMPLATE);\n+\n+      expect(block).toContain(\n+          '_t1.addEventListener(\"event\", function ($event): any { (ctx).foo(((ctx).$event)); });');\n+    });\n   });\n \n   describe('config', () => {"
        },
        {
            "sha": "0173f6f0cdb83982c68ec43594940d628409af95",
            "filename": "packages/compiler-cli/test/compliance/r3_view_compiler_listener_spec.ts",
            "status": "modified",
            "additions": 133,
            "deletions": 0,
            "changes": 133,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fr3_view_compiler_listener_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fr3_view_compiler_listener_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fr3_view_compiler_listener_spec.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -447,4 +447,137 @@ describe('compiler compliance: listen()', () => {\n     const result = compile(files, angularFiles);\n     expectEmit(result.source, template, 'Incorrect host bindings');\n   });\n+\n+  it('should assume $event is referring to the event variable in a listener by default', () => {\n+    const files = {\n+      app: {\n+        'spec.ts': `\n+          import {Component} from '@angular/core';\n+\n+          @Component({\n+            template: '<div (click)=\"c($event)\"></div>'\n+          })\n+          class Comp {\n+            c(event: MouseEvent) {}\n+          }\n+        `\n+      }\n+    };\n+\n+    const template = `\n+      …\n+      i0.ɵɵlistener(\"click\", function Comp_Template_div_click_0_listener($event) { return ctx.c($event); });\n+    `;\n+\n+    const result = compile(files, angularFiles);\n+    expectEmit(result.source, template, 'Incorrect event listener');\n+  });\n+\n+  it('should preserve accesses to $event if it is done through `this` in a listener', () => {\n+    const files = {\n+      app: {\n+        'spec.ts': `\n+          import {Component} from '@angular/core';\n+\n+          @Component({\n+            template: '<div (click)=\"c(this.$event)\"></div>'\n+          })\n+          class Comp {\n+            $event = {};\n+            c(value: {}) {}\n+          }\n+        `\n+      }\n+    };\n+\n+    const template = `\n+      …\n+      i0.ɵɵlistener(\"click\", function Comp_Template_div_click_0_listener() { return ctx.c(ctx.$event); });\n+    `;\n+\n+    const result = compile(files, angularFiles);\n+    expectEmit(result.source, template, 'Incorrect event listener');\n+  });\n+\n+  it('should not assume that $event is referring to an event object inside a property', () => {\n+    const files = {\n+      app: {\n+        'spec.ts': `\n+          import {Component} from '@angular/core';\n+\n+          @Component({\n+            template: '<div [event]=\"$event\"></div>'\n+          })\n+          class Comp {\n+            $event = 1;\n+          }\n+        `\n+      }\n+    };\n+\n+    const template = `\n+      …\n+      i0.ɵɵproperty(\"event\", ctx.$event);\n+    `;\n+\n+    const result = compile(files, angularFiles);\n+    expectEmit(result.source, template, 'Incorrect property binding');\n+  });\n+\n+  it('should assume $event is referring to the event variable in a listener by default inside a host binding',\n+     () => {\n+       const files = {\n+         app: {\n+           'spec.ts': `\n+              import {Directive} from '@angular/core';\n+\n+              @Directive({\n+                host: {\n+                  '(click)': 'c($event)'\n+                }\n+              })\n+              class Dir {\n+                c(event: MouseEvent) {}\n+              }\n+            `\n+         }\n+       };\n+\n+       const template = `\n+      …\n+      i0.ɵɵlistener(\"click\", function Dir_click_HostBindingHandler($event) { return ctx.c($event); });\n+    `;\n+\n+       const result = compile(files, angularFiles);\n+       expectEmit(result.source, template, 'Incorrect event listener');\n+     });\n+\n+  it('should preserve accesses to $event if it is done through `this` in a listener inside a host binding',\n+     () => {\n+       const files = {\n+         app: {\n+           'spec.ts': `\n+              import {Directive} from '@angular/core';\n+\n+              @Directive({\n+                host: {\n+                  '(click)': 'c(this.$event)'\n+                }\n+              })\n+              class Dir {\n+                $event = {};\n+                c(value: {}) {}\n+              }\n+            `\n+         }\n+       };\n+\n+       const template = `\n+      …\n+      i0.ɵɵlistener(\"click\", function Dir_click_HostBindingHandler() { return ctx.c(ctx.$event); });\n+    `;\n+\n+       const result = compile(files, angularFiles);\n+       expectEmit(result.source, template, 'Incorrect event listener');\n+     });\n });"
        },
        {
            "sha": "bdfbd1762d920594f0b62b0a29670423026ecdd8",
            "filename": "packages/compiler-cli/test/compliance/r3_view_compiler_spec.ts",
            "status": "modified",
            "additions": 53,
            "deletions": 0,
            "changes": 53,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fr3_view_compiler_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fr3_view_compiler_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fr3_view_compiler_spec.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -191,4 +191,57 @@ describe('r3_view_compiler', () => {\n       expectEmit(result.source, template, 'Incorrect initialization attributes');\n     });\n   });\n+\n+  describe('$any', () => {\n+    it('should strip out $any wrappers', () => {\n+      const files = {\n+        app: {\n+          'spec.ts': `\n+            import {Component} from '@angular/core';\n+\n+            @Component({\n+              template: '<div [tabIndex]=\"$any(10)\"></div>'\n+            })\n+            class Comp {\n+            }\n+          `\n+        }\n+      };\n+\n+      const template = `\n+        …\n+        i0.ɵɵproperty(\"tabIndex\", 10);\n+      `;\n+\n+      const result = compile(files, angularFiles);\n+      expectEmit(result.source, template, 'Incorrect template');\n+    });\n+\n+    it('should preserve $any if it is accessed through `this`', () => {\n+      const files = {\n+        app: {\n+          'spec.ts': `\n+            import {Component} from '@angular/core';\n+\n+            @Component({\n+              template: '<div [tabIndex]=\"this.$any(null)\"></div>'\n+            })\n+            class Comp {\n+              $any(value: null): any {\n+                return value as any;\n+              }\n+            }\n+          `\n+        }\n+      };\n+\n+      const template = `\n+        …\n+        i0.ɵɵproperty(\"tabIndex\", ctx.$any(null));\n+      `;\n+\n+      const result = compile(files, angularFiles);\n+      expectEmit(result.source, template, 'Incorrect template');\n+    });\n+  });\n });"
        },
        {
            "sha": "58017f5c73545c5a2eda7e39e3cd35864722d037",
            "filename": "packages/compiler/src/compiler_util/expression_converter.ts",
            "status": "modified",
            "additions": 27,
            "deletions": 10,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler%2Fsrc%2Fcompiler_util%2Fexpression_converter.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler%2Fsrc%2Fcompiler_util%2Fexpression_converter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler_util%2Fexpression_converter.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -18,6 +18,7 @@ export class EventHandlerVars {\n export interface LocalResolver {\n   getLocal(name: string): o.Expression|null;\n   notifyImplicitReceiverUse(): void;\n+  globals?: Set<string>;\n }\n \n export class ConvertActionBindingResult {\n@@ -72,10 +73,10 @@ export type InterpolationFunction = (args: o.Expression[]) => o.Expression;\n export function convertActionBinding(\n     localResolver: LocalResolver|null, implicitReceiver: o.Expression, action: cdAst.AST,\n     bindingId: string, interpolationFunction?: InterpolationFunction,\n-    baseSourceSpan?: ParseSourceSpan,\n-    implicitReceiverAccesses?: Set<string>): ConvertActionBindingResult {\n+    baseSourceSpan?: ParseSourceSpan, implicitReceiverAccesses?: Set<string>,\n+    globals?: Set<string>): ConvertActionBindingResult {\n   if (!localResolver) {\n-    localResolver = new DefaultLocalResolver();\n+    localResolver = new DefaultLocalResolver(globals);\n   }\n   const actionWithoutBuiltins = convertPropertyBindingBuiltins(\n       {\n@@ -446,6 +447,10 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n     return this._implicitReceiver;\n   }\n \n+  visitThisReceiver(ast: cdAst.ThisReceiver, mode: _Mode): any {\n+    return this.visitImplicitReceiver(ast, mode);\n+  }\n+\n   visitInterpolation(ast: cdAst.Interpolation, mode: _Mode): any {\n     ensureExpressionMode(mode, ast);\n     const args = [o.literal(ast.expressions.length)];\n@@ -501,12 +506,17 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n         mode, o.literal(ast.value, type, this.convertSourceSpan(ast.span)));\n   }\n \n-  private _getLocal(name: string): o.Expression|null {\n+  private _getLocal(name: string, receiver: cdAst.AST): o.Expression|null {\n+    if (this._localResolver.globals?.has(name) && receiver instanceof cdAst.ThisReceiver) {\n+      return null;\n+    }\n+\n     return this._localResolver.getLocal(name);\n   }\n \n   visitMethodCall(ast: cdAst.MethodCall, mode: _Mode): any {\n-    if (ast.receiver instanceof cdAst.ImplicitReceiver && ast.name == '$any') {\n+    if (ast.receiver instanceof cdAst.ImplicitReceiver &&\n+        !(ast.receiver instanceof cdAst.ThisReceiver) && ast.name === '$any') {\n       const args = this.visitAll(ast.args, _Mode.Expression) as any[];\n       if (args.length != 1) {\n         throw new Error(\n@@ -524,14 +534,14 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n       let result: any = null;\n       const receiver = this._visit(ast.receiver, _Mode.Expression);\n       if (receiver === this._implicitReceiver) {\n-        const varExpr = this._getLocal(ast.name);\n+        const varExpr = this._getLocal(ast.name, ast.receiver);\n         if (varExpr) {\n           // Restore the previous \"usesImplicitReceiver\" state since the implicit\n           // receiver has been replaced with a resolved local expression.\n           this.usesImplicitReceiver = prevUsesImplicitReceiver;\n           result = varExpr.callFn(args);\n+          this.addImplicitReceiverAccess(ast.name);\n         }\n-        this.addImplicitReceiverAccess(ast.name);\n       }\n       if (result == null) {\n         result = receiver.callMethod(ast.name, args, this.convertSourceSpan(ast.span));\n@@ -558,13 +568,13 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n       const prevUsesImplicitReceiver = this.usesImplicitReceiver;\n       const receiver = this._visit(ast.receiver, _Mode.Expression);\n       if (receiver === this._implicitReceiver) {\n-        result = this._getLocal(ast.name);\n+        result = this._getLocal(ast.name, ast.receiver);\n         if (result) {\n           // Restore the previous \"usesImplicitReceiver\" state since the implicit\n           // receiver has been replaced with a resolved local expression.\n           this.usesImplicitReceiver = prevUsesImplicitReceiver;\n+          this.addImplicitReceiverAccess(ast.name);\n         }\n-        this.addImplicitReceiverAccess(ast.name);\n       }\n       if (result == null) {\n         result = receiver.prop(ast.name);\n@@ -579,7 +589,7 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n \n     let varExpr: o.ReadPropExpr|null = null;\n     if (receiver === this._implicitReceiver) {\n-      const localExpr = this._getLocal(ast.name);\n+      const localExpr = this._getLocal(ast.name, ast.receiver);\n       if (localExpr) {\n         if (localExpr instanceof o.ReadPropExpr) {\n           // If the local variable is a property read expression, it's a reference\n@@ -748,6 +758,9 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n       visitImplicitReceiver(ast: cdAst.ImplicitReceiver) {\n         return null;\n       },\n+      visitThisReceiver(ast: cdAst.ThisReceiver) {\n+        return null;\n+      },\n       visitInterpolation(ast: cdAst.Interpolation) {\n         return null;\n       },\n@@ -825,6 +838,9 @@ class _AstToIrVisitor implements cdAst.AstVisitor {\n       visitImplicitReceiver(ast: cdAst.ImplicitReceiver) {\n         return false;\n       },\n+      visitThisReceiver(ast: cdAst.ThisReceiver) {\n+        return false;\n+      },\n       visitInterpolation(ast: cdAst.Interpolation) {\n         return visitSome(this, ast.expressions);\n       },\n@@ -924,6 +940,7 @@ function flattenStatements(arg: any, output: o.Statement[]) {\n }\n \n class DefaultLocalResolver implements LocalResolver {\n+  constructor(public globals?: Set<string>) {}\n   notifyImplicitReceiverUse(): void {}\n   getLocal(name: string): o.Expression|null {\n     if (name === EventHandlerVars.event.name) {"
        },
        {
            "sha": "08589c143cef96de1221e41d428d660b78396d19",
            "filename": "packages/compiler/src/expression_parser/ast.ts",
            "status": "modified",
            "additions": 29,
            "deletions": 1,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fast.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fast.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fast.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -85,6 +85,20 @@ export class ImplicitReceiver extends AST {\n   }\n }\n \n+/**\n+ * Receiver when something is accessed through `this` (e.g. `this.foo`). Note that this class\n+ * inherits from `ImplicitReceiver`, because accessing something through `this` is treated the\n+ * same as accessing it implicitly inside of an Angular template (e.g. `[attr.title]=\"this.title\"`\n+ * is the same as `[attr.title]=\"title\"`.). Inheriting allows for the `this` accesses to be treated\n+ * the same as implicit ones, except for a couple of exceptions like `$event` and `$any`.\n+ * TODO: we should find a way for this class not to extend from `ImplicitReceiver` in the future.\n+ */\n+export class ThisReceiver extends ImplicitReceiver {\n+  visit(visitor: AstVisitor, context: any = null): any {\n+    return visitor.visitThisReceiver?.(this, context);\n+  }\n+}\n+\n /**\n  * Multiple expressions separated by a semicolon.\n  */\n@@ -416,6 +430,11 @@ export interface AstVisitor {\n   visitChain(ast: Chain, context: any): any;\n   visitConditional(ast: Conditional, context: any): any;\n   visitFunctionCall(ast: FunctionCall, context: any): any;\n+  /**\n+   * The `visitThisReceiver` method is declared as optional for backwards compatibility.\n+   * In an upcoming major release, this method will be made required.\n+   */\n+  visitThisReceiver?(ast: ThisReceiver, context: any): any;\n   visitImplicitReceiver(ast: ImplicitReceiver, context: any): any;\n   visitInterpolation(ast: Interpolation, context: any): any;\n   visitKeyedRead(ast: KeyedRead, context: any): any;\n@@ -474,7 +493,8 @@ export class RecursiveAstVisitor implements AstVisitor {\n     }\n     this.visitAll(ast.args, context);\n   }\n-  visitImplicitReceiver(ast: ImplicitReceiver, context: any): any {}\n+  visitImplicitReceiver(ast: ThisReceiver, context: any): any {}\n+  visitThisReceiver(ast: ThisReceiver, context: any): any {}\n   visitInterpolation(ast: Interpolation, context: any): any {\n     this.visitAll(ast.expressions, context);\n   }\n@@ -532,6 +552,10 @@ export class AstTransformer implements AstVisitor {\n     return ast;\n   }\n \n+  visitThisReceiver(ast: ThisReceiver, context: any): AST {\n+    return ast;\n+  }\n+\n   visitInterpolation(ast: Interpolation, context: any): AST {\n     return new Interpolation(ast.span, ast.sourceSpan, ast.strings, this.visitAll(ast.expressions));\n   }\n@@ -651,6 +675,10 @@ export class AstMemoryEfficientTransformer implements AstVisitor {\n     return ast;\n   }\n \n+  visitThisReceiver(ast: ThisReceiver, context: any): AST {\n+    return ast;\n+  }\n+\n   visitInterpolation(ast: Interpolation, context: any): Interpolation {\n     const expressions = this.visitAll(ast.expressions);\n     if (expressions !== ast.expressions)"
        },
        {
            "sha": "2f488d2931f431fd07d886cf208ce5d7958cd599",
            "filename": "packages/compiler/src/expression_parser/parser.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -10,7 +10,7 @@ import * as chars from '../chars';\n import {DEFAULT_INTERPOLATION_CONFIG, InterpolationConfig} from '../ml_parser/interpolation_config';\n import {escapeRegExp} from '../util';\n \n-import {AbsoluteSourceSpan, AST, AstVisitor, ASTWithSource, Binary, BindingPipe, Chain, Conditional, EmptyExpr, ExpressionBinding, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralMapKey, LiteralPrimitive, MethodCall, NonNullAssert, ParserError, ParseSpan, PrefixNot, PropertyRead, PropertyWrite, Quote, RecursiveAstVisitor, SafeMethodCall, SafePropertyRead, TemplateBinding, TemplateBindingIdentifier, Unary, VariableBinding} from './ast';\n+import {AbsoluteSourceSpan, AST, AstVisitor, ASTWithSource, Binary, BindingPipe, Chain, Conditional, EmptyExpr, ExpressionBinding, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralMapKey, LiteralPrimitive, MethodCall, NonNullAssert, ParserError, ParseSpan, PrefixNot, PropertyRead, PropertyWrite, Quote, RecursiveAstVisitor, SafeMethodCall, SafePropertyRead, TemplateBinding, TemplateBindingIdentifier, ThisReceiver, Unary, VariableBinding} from './ast';\n import {EOF, isIdentifier, isQuote, Lexer, Token, TokenType} from './lexer';\n \n export class SplitInterpolation {\n@@ -784,8 +784,7 @@ export class _ParseAST {\n \n     } else if (this.next.isKeywordThis()) {\n       this.advance();\n-      return new ImplicitReceiver(this.span(start), this.sourceSpan(start));\n-\n+      return new ThisReceiver(this.span(start), this.sourceSpan(start));\n     } else if (this.consumeOptionalCharacter(chars.$LBRACKET)) {\n       this.rbracketsExpected++;\n       const elements = this.parseExpressionList(chars.$RBRACKET);\n@@ -1158,6 +1157,8 @@ class SimpleExpressionChecker implements AstVisitor {\n \n   visitImplicitReceiver(ast: ImplicitReceiver, context: any) {}\n \n+  visitThisReceiver(ast: ThisReceiver, context: any) {}\n+\n   visitInterpolation(ast: Interpolation, context: any) {}\n \n   visitLiteralPrimitive(ast: LiteralPrimitive, context: any) {}"
        },
        {
            "sha": "f6e8707313f94d6a2843a01e011ca87160228d7c",
            "filename": "packages/compiler/src/render3/view/template.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 7,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -10,7 +10,7 @@ import {flatten, sanitizeIdentifier} from '../../compile_metadata';\n import {BindingForm, BuiltinFunctionCall, convertActionBinding, convertPropertyBinding, convertUpdateArguments, LocalResolver} from '../../compiler_util/expression_converter';\n import {ConstantPool} from '../../constant_pool';\n import * as core from '../../core';\n-import {AST, AstMemoryEfficientTransformer, BindingPipe, BindingType, FunctionCall, ImplicitReceiver, Interpolation, LiteralArray, LiteralMap, LiteralPrimitive, ParsedEventType, PropertyRead} from '../../expression_parser/ast';\n+import {AST, AstMemoryEfficientTransformer, BindingPipe, BindingType, FunctionCall, ImplicitReceiver, Interpolation, LiteralArray, LiteralMap, LiteralPrimitive, ParsedEventType, PropertyRead, ThisReceiver} from '../../expression_parser/ast';\n import {Lexer} from '../../expression_parser/lexer';\n import {IvyParser} from '../../expression_parser/parser';\n import * as i18n from '../../i18n/i18n_ast';\n@@ -48,6 +48,9 @@ const NG_CONTENT_SELECT_ATTR = 'select';\n // Attribute name of `ngProjectAs`.\n const NG_PROJECT_AS_ATTR_NAME = 'ngProjectAs';\n \n+// Global symbols available only inside event bindings.\n+const EVENT_BINDING_SCOPE_GLOBALS = new Set<string>(['$event']);\n+\n // List of supported global targets for event listeners\n const GLOBAL_TARGET_RESOLVERS = new Map<string, o.ExternalReference>(\n     [['window', R3.resolveWindow], ['document', R3.resolveDocument], ['body', R3.resolveBody]]);\n@@ -76,7 +79,7 @@ export function prepareEventListenerParameters(\n       scope.getOrCreateSharedContextVar(0);\n   const bindingExpr = convertActionBinding(\n       scope, implicitReceiverExpr, handler, 'b', () => error('Unexpected interpolation'),\n-      eventAst.handlerSpan, implicitReceiverAccesses);\n+      eventAst.handlerSpan, implicitReceiverAccesses, EVENT_BINDING_SCOPE_GLOBALS);\n   const statements = [];\n   if (scope) {\n     statements.push(...scope.restoreViewStatement());\n@@ -1427,7 +1430,8 @@ export class TemplateDefinitionBuilder implements t.Visitor<void>, LocalResolver\n           prepareSyntheticListenerFunctionName(eventName, outputAst.phase!) :\n           sanitizeIdentifier(eventName);\n       const handlerName = `${this.templateName}_${tagName}_${bindingFnName}_${index}_listener`;\n-      const scope = this._bindingScope.nestedScope(this._bindingScope.bindingLevel);\n+      const scope = this._bindingScope.nestedScope(\n+          this._bindingScope.bindingLevel, EVENT_BINDING_SCOPE_GLOBALS);\n       return prepareEventListenerParameters(outputAst, handlerName, scope);\n     };\n   }\n@@ -1625,10 +1629,18 @@ export class BindingScope implements LocalResolver {\n   private referenceNameIndex = 0;\n   private restoreViewVariable: o.ReadVarExpr|null = null;\n   static createRootScope(): BindingScope {\n-    return new BindingScope().set(0, '$event', o.variable('$event'));\n+    return new BindingScope();\n   }\n \n-  private constructor(public bindingLevel: number = 0, private parent: BindingScope|null = null) {}\n+  private constructor(\n+      public bindingLevel: number = 0, private parent: BindingScope|null = null,\n+      public globals?: Set<string>) {\n+    if (globals !== undefined) {\n+      for (const name of globals) {\n+        this.set(0, name, o.variable(name));\n+      }\n+    }\n+  }\n \n   get(name: string): o.Expression|null {\n     let current: BindingScope|null = this;\n@@ -1715,8 +1727,8 @@ export class BindingScope implements LocalResolver {\n     }\n   }\n \n-  nestedScope(level: number): BindingScope {\n-    const newScope = new BindingScope(level, this);\n+  nestedScope(level: number, globals?: Set<string>): BindingScope {\n+    const newScope = new BindingScope(level, this, globals);\n     if (level > 0) newScope.generateSharedContextVar(0);\n     return newScope;\n   }"
        },
        {
            "sha": "cb165b246b643dae81618667df13f5082f58ba06",
            "filename": "packages/compiler/test/expression_parser/utils/unparser.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Futils%2Funparser.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Futils%2Funparser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Futils%2Funparser.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AST, AstVisitor, ASTWithSource, Binary, BindingPipe, Chain, Conditional, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, NonNullAssert, ParseSpan, PrefixNot, PropertyRead, PropertyWrite, Quote, RecursiveAstVisitor, SafeMethodCall, SafePropertyRead, Unary} from '../../../src/expression_parser/ast';\n+import {AST, AstVisitor, ASTWithSource, Binary, BindingPipe, Chain, Conditional, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, NonNullAssert, ParseSpan, PrefixNot, PropertyRead, PropertyWrite, Quote, RecursiveAstVisitor, SafeMethodCall, SafePropertyRead, ThisReceiver, Unary} from '../../../src/expression_parser/ast';\n import {DEFAULT_INTERPOLATION_CONFIG, InterpolationConfig} from '../../../src/ml_parser/interpolation_config';\n \n class Unparser implements AstVisitor {\n@@ -87,6 +87,8 @@ class Unparser implements AstVisitor {\n \n   visitImplicitReceiver(ast: ImplicitReceiver, context: any) {}\n \n+  visitThisReceiver(ast: ThisReceiver, context: any) {}\n+\n   visitInterpolation(ast: Interpolation, context: any) {\n     for (let i = 0; i < ast.strings.length; i++) {\n       this._expression += ast.strings[i];"
        },
        {
            "sha": "21e0c0000a2e439126d49b8390c6a6668fde7b6c",
            "filename": "packages/core/test/acceptance/integration_spec.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -384,6 +384,20 @@ describe('acceptance integration tests', () => {\n \n       expect(fixture.nativeElement.innerHTML).toEqual('');\n     });\n+\n+    it('should be able to render the result of a function called $any by using this', () => {\n+      @Component({template: '{{this.$any(1, 2)}}'})\n+      class App {\n+        $any(value: number, multiplier: number) {\n+          return value * multiplier;\n+        }\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [App]});\n+      const fixture = TestBed.createComponent(App);\n+      fixture.detectChanges();\n+      expect(fixture.nativeElement.textContent).toBe('2');\n+    });\n   });\n \n   describe('ngNonBindable handling', () => {"
        },
        {
            "sha": "671a8baf9b0d330366f435884350b0c86c19fccb",
            "filename": "packages/core/test/acceptance/listener_spec.ts",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcore%2Ftest%2Facceptance%2Flistener_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Fcore%2Ftest%2Facceptance%2Flistener_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Flistener_spec.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -396,4 +396,33 @@ describe('event listeners', () => {\n     button.click();\n     expect(comp.counter).toBe(1);\n   });\n+\n+  onlyInIvy('issue has only been resolved for Ivy')\n+      .it('should be able to access a property called $event using `this`', () => {\n+        let eventVariable: number|undefined;\n+        let eventObject: MouseEvent|undefined;\n+\n+        @Component({\n+          template: `\n+        <button (click)=\"clicked(this.$event, $event)\">Click me!</button>\n+      `,\n+        })\n+        class MyComp {\n+          $event = 10;\n+\n+          clicked(value: number, event: MouseEvent) {\n+            eventVariable = value;\n+            eventObject = event;\n+          }\n+        }\n+\n+        TestBed.configureTestingModule({declarations: [MyComp]});\n+        const fixture = TestBed.createComponent(MyComp);\n+        fixture.detectChanges();\n+        fixture.nativeElement.querySelector('button').click();\n+        fixture.detectChanges();\n+\n+        expect(eventVariable).toBe(10);\n+        expect(eventObject?.type).toBe('click');\n+      });\n });"
        },
        {
            "sha": "d1e9123e5a26064dc143f8e8d9d07ff0141d948d",
            "filename": "packages/language-service/ivy/quick_info.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Flanguage-service%2Fivy%2Fquick_info.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Flanguage-service%2Fivy%2Fquick_info.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Fquick_info.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AST, BindingPipe, ImplicitReceiver, MethodCall, TmplAstBoundAttribute, TmplAstNode, TmplAstTextAttribute} from '@angular/compiler';\n+import {AST, BindingPipe, ImplicitReceiver, MethodCall, ThisReceiver, TmplAstBoundAttribute, TmplAstNode, TmplAstTextAttribute} from '@angular/compiler';\n import {NgCompiler} from '@angular/compiler-cli/src/ngtsc/core';\n import {DirectiveSymbol, DomBindingSymbol, ElementSymbol, ExpressionSymbol, InputBindingSymbol, OutputBindingSymbol, ReferenceSymbol, ShimLocation, Symbol, SymbolKind, VariableSymbol} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import * as ts from 'typescript';\n@@ -208,7 +208,7 @@ function displayPartsEqual(a: {text: string, kind: string}, b: {text: string, ki\n \n function isDollarAny(node: TmplAstNode|AST): node is MethodCall {\n   return node instanceof MethodCall && node.receiver instanceof ImplicitReceiver &&\n-      node.name === '$any' && node.args.length === 1;\n+      !(node.receiver instanceof ThisReceiver) && node.name === '$any' && node.args.length === 1;\n }\n \n function createDollarAnyQuickInfo(node: MethodCall): ts.QuickInfo {"
        },
        {
            "sha": "e2481dde4225ded51bbe9b38e85be743d8248941",
            "filename": "packages/language-service/ivy/utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Flanguage-service%2Fivy%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Flanguage-service%2Fivy%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Futils.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -279,7 +279,7 @@ export function filterAliasImports(displayParts: ts.SymbolDisplayPart[]): ts.Sym\n \n export function isDollarEvent(n: t.Node|e.AST): n is e.PropertyRead {\n   return n instanceof e.PropertyRead && n.name === '$event' &&\n-      n.receiver instanceof e.ImplicitReceiver;\n+      n.receiver instanceof e.ImplicitReceiver && !(n.receiver instanceof e.ThisReceiver);\n }\n \n /**"
        },
        {
            "sha": "064a2caffd39cd2fd9539a74ad6f6a0874500120",
            "filename": "packages/language-service/src/expression_type.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Flanguage-service%2Fsrc%2Fexpression_type.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Flanguage-service%2Fsrc%2Fexpression_type.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Fexpression_type.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AST, AstVisitor, ASTWithName, Binary, BindingPipe, Chain, Conditional, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, NonNullAssert, PrefixNot, PropertyRead, PropertyWrite, Quote, SafeMethodCall, SafePropertyRead, Unary} from '@angular/compiler';\n+import {AST, AstVisitor, ASTWithName, Binary, BindingPipe, Chain, Conditional, FunctionCall, ImplicitReceiver, Interpolation, KeyedRead, KeyedWrite, LiteralArray, LiteralMap, LiteralPrimitive, MethodCall, NonNullAssert, PrefixNot, PropertyRead, PropertyWrite, Quote, SafeMethodCall, SafePropertyRead, ThisReceiver, Unary} from '@angular/compiler';\n \n import {createDiagnostic, Diagnostic} from './diagnostic_messages';\n import {BuiltinType, Signature, Symbol, SymbolQuery, SymbolTable} from './symbols';\n@@ -258,6 +258,10 @@ export class AstType implements AstVisitor {\n     };\n   }\n \n+  visitThisReceiver(_ast: ThisReceiver): Symbol {\n+    return this.visitImplicitReceiver(_ast);\n+  }\n+\n   visitInterpolation(ast: Interpolation): Symbol {\n     // If we are producing diagnostics, visit the children.\n     for (const expr of ast.expressions) {"
        },
        {
            "sha": "5af34f8ba3ba29138915a03024ed77b20406b0fc",
            "filename": "packages/language-service/src/expressions.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Flanguage-service%2Fsrc%2Fexpressions.ts",
            "raw_url": "https://github.com/angular/angular/raw/cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3/packages%2Flanguage-service%2Fsrc%2Fexpressions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Fexpressions.ts?ref=cbc0907bfdbbb82e3827bdc9e17659a8b4cfadf3",
            "patch": "@@ -69,6 +69,7 @@ export function getExpressionCompletions(\n     visitConditional(_ast) {},\n     visitFunctionCall(_ast) {},\n     visitImplicitReceiver(_ast) {},\n+    visitThisReceiver(_ast) {},\n     visitInterpolation(_ast) {\n       result = undefined;\n     },\n@@ -164,6 +165,7 @@ export function getExpressionSymbol(\n     visitConditional(_ast) {},\n     visitFunctionCall(_ast) {},\n     visitImplicitReceiver(_ast) {},\n+    visitThisReceiver(_ast) {},\n     visitInterpolation(_ast) {},\n     visitKeyedRead(_ast) {},\n     visitKeyedWrite(_ast) {},"
        }
    ],
    "stats": {
        "total": 378,
        "additions": 348,
        "deletions": 30
    }
}