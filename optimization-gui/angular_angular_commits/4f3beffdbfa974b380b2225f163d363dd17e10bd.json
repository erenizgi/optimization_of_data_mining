{
    "author": "dimakuba",
    "message": "feat(router): emit activate/deactivate events when an outlet gets attached/detached (#43333)\n\nPreviously the events of `RouterOutlet` (activate/deactivate) were not fired\nwhen an outlet got attached/detached with `RouteReuseStrategy`. The changes configure\n`RouterOutlet` to emit events when an outlet gets attached/detached.\n\nFixes #25521, #20501\n\nPR Close #43333",
    "sha": "4f3beffdbfa974b380b2225f163d363dd17e10bd",
    "files": [
        {
            "sha": "36954bd2cc7e81c735c19682f58814df17a143f1",
            "filename": "goldens/public-api/router/router.md",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/4f3beffdbfa974b380b2225f163d363dd17e10bd/goldens%2Fpublic-api%2Frouter%2Frouter.md",
            "raw_url": "https://github.com/angular/angular/raw/4f3beffdbfa974b380b2225f163d363dd17e10bd/goldens%2Fpublic-api%2Frouter%2Frouter.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Frouter%2Frouter.md?ref=4f3beffdbfa974b380b2225f163d363dd17e10bd",
            "patch": "@@ -615,13 +615,15 @@ export class RouterOutlet implements OnDestroy, OnInit, RouterOutletContract {\n     // (undocumented)\n     activateWith(activatedRoute: ActivatedRoute, resolver: ComponentFactoryResolver | null): void;\n     attach(ref: ComponentRef<any>, activatedRoute: ActivatedRoute): void;\n+    attachEvents: EventEmitter<unknown>;\n     // (undocumented)\n     get component(): Object;\n     // (undocumented)\n     deactivate(): void;\n     // (undocumented)\n     deactivateEvents: EventEmitter<any>;\n     detach(): ComponentRef<any>;\n+    detachEvents: EventEmitter<unknown>;\n     // (undocumented)\n     get isActivated(): boolean;\n     // (undocumented)\n@@ -637,10 +639,12 @@ export interface RouterOutletContract {\n     activateEvents?: EventEmitter<unknown>;\n     activateWith(activatedRoute: ActivatedRoute, resolver: ComponentFactoryResolver | null): void;\n     attach(ref: ComponentRef<unknown>, activatedRoute: ActivatedRoute): void;\n+    attachEvents?: EventEmitter<unknown>;\n     component: Object | null;\n     deactivate(): void;\n     deactivateEvents?: EventEmitter<unknown>;\n     detach(): ComponentRef<unknown>;\n+    detachEvents?: EventEmitter<unknown>;\n     isActivated: boolean;\n }\n "
        },
        {
            "sha": "b2f1a7c04355d20fa55f2c5fc693cdcb03ed71ca",
            "filename": "packages/router/src/directives/router_outlet.ts",
            "status": "modified",
            "additions": 31,
            "deletions": 2,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/4f3beffdbfa974b380b2225f163d363dd17e10bd/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_outlet.ts",
            "raw_url": "https://github.com/angular/angular/raw/4f3beffdbfa974b380b2225f163d363dd17e10bd/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_outlet.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_outlet.ts?ref=4f3beffdbfa974b380b2225f163d363dd17e10bd",
            "patch": "@@ -81,6 +81,18 @@ export interface RouterOutletContract {\n    * Emits a deactivate event when a component is destroyed.\n    */\n   deactivateEvents?: EventEmitter<unknown>;\n+\n+  /**\n+   * Emits an attached component instance when the `RouteReuseStrategy` instructs to re-attach a\n+   * previously detached subtree.\n+   **/\n+  attachEvents?: EventEmitter<unknown>;\n+\n+  /**\n+   * Emits a detached component instance when the `RouteReuseStrategy` instructs to detach the\n+   * subtree.\n+   */\n+  detachEvents?: EventEmitter<unknown>;\n }\n \n /**\n@@ -113,12 +125,17 @@ export interface RouterOutletContract {\n  * `http://base-path/primary-route-path(outlet-name:route-path)`\n  *\n  * A router outlet emits an activate event when a new component is instantiated,\n- * and a deactivate event when a component is destroyed.\n+ * deactivate event when a component is destroyed.\n+ * An attached event emits when the `RouteReuseStrategy` instructs the outlet to reattach the\n+ * subtree, and the detached event emits when the `RouteReuseStrategy` instructs the outlet to\n+ * detach the subtree.\n  *\n  * ```\n  * <router-outlet\n  *   (activate)='onActivate($event)'\n- *   (deactivate)='onDeactivate($event)'></router-outlet>\n+ *   (deactivate)='onDeactivate($event)'\n+ *   (attach)='onAttach($event)'\n+ *   (detach)='onDetach($event)'></router-outlet>\n  * ```\n  *\n  * @see [Routing tutorial](guide/router-tutorial-toh#named-outlets \"Example of a named\n@@ -137,6 +154,16 @@ export class RouterOutlet implements OnDestroy, OnInit, RouterOutletContract {\n \n   @Output('activate') activateEvents = new EventEmitter<any>();\n   @Output('deactivate') deactivateEvents = new EventEmitter<any>();\n+  /**\n+   * Emits an attached component instance when the `RouteReuseStrategy` instructs to re-attach a\n+   * previously detached subtree.\n+   **/\n+  @Output('attach') attachEvents = new EventEmitter<unknown>();\n+  /**\n+   * Emits a detached component instance when the `RouteReuseStrategy` instructs to detach the\n+   * subtree.\n+   */\n+  @Output('detach') detachEvents = new EventEmitter<unknown>();\n \n   constructor(\n       private parentContexts: ChildrenOutletContexts, private location: ViewContainerRef,\n@@ -203,6 +230,7 @@ export class RouterOutlet implements OnDestroy, OnInit, RouterOutletContract {\n     const cmp = this.activated;\n     this.activated = null;\n     this._activatedRoute = null;\n+    this.detachEvents.emit(cmp.instance);\n     return cmp;\n   }\n \n@@ -213,6 +241,7 @@ export class RouterOutlet implements OnDestroy, OnInit, RouterOutletContract {\n     this.activated = ref;\n     this._activatedRoute = activatedRoute;\n     this.location.insert(ref.hostView);\n+    this.attachEvents.emit(ref.instance);\n   }\n \n   deactivate(): void {"
        },
        {
            "sha": "aea3536ffcebe7437f9101d951c815b7572488a5",
            "filename": "packages/router/test/integration.spec.ts",
            "status": "modified",
            "additions": 54,
            "deletions": 0,
            "changes": 54,
            "blob_url": "https://github.com/angular/angular/blob/4f3beffdbfa974b380b2225f163d363dd17e10bd/packages%2Frouter%2Ftest%2Fintegration.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/4f3beffdbfa974b380b2225f163d363dd17e10bd/packages%2Frouter%2Ftest%2Fintegration.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fintegration.spec.ts?ref=4f3beffdbfa974b380b2225f163d363dd17e10bd",
            "patch": "@@ -5831,6 +5831,60 @@ describe('Integration', () => {\n       expect(router.routeReuseStrategy).toBeInstanceOf(AttachDetachReuseStrategy);\n     });\n \n+    it('should emit an event when an outlet gets attached/detached', fakeAsync(() => {\n+         @Component({\n+           selector: 'container',\n+           template:\n+               `<router-outlet (attach)=\"recordAttached($event)\" (detach)=\"recordDetached($event)\"></router-outlet>`\n+         })\n+         class Container {\n+           attachedComponents: any[] = [];\n+           detachedComponents: any[] = [];\n+\n+           recordAttached(component: any): void {\n+             this.attachedComponents.push(component);\n+           }\n+\n+           recordDetached(component: any): void {\n+             this.detachedComponents.push(component);\n+           }\n+         }\n+\n+         TestBed.configureTestingModule({\n+           declarations: [Container],\n+           imports: [RouterTestingModule],\n+           providers: [{provide: RouteReuseStrategy, useClass: AttachDetachReuseStrategy}]\n+         });\n+\n+         const router = TestBed.inject(Router);\n+         const fixture = createRoot(router, Container);\n+         const cmp = fixture.componentInstance;\n+\n+         router.resetConfig([{path: 'a', component: BlankCmp}, {path: 'b', component: SimpleCmp}]);\n+\n+         cmp.attachedComponents = [];\n+         cmp.detachedComponents = [];\n+\n+         router.navigateByUrl('/a');\n+         advance(fixture);\n+         expect(cmp.attachedComponents.length).toEqual(0);\n+         expect(cmp.detachedComponents.length).toEqual(0);\n+\n+         router.navigateByUrl('/b');\n+         advance(fixture);\n+         expect(cmp.attachedComponents.length).toEqual(0);\n+         expect(cmp.detachedComponents.length).toEqual(1);\n+         expect(cmp.detachedComponents[0] instanceof BlankCmp).toBe(true);\n+\n+         // the route will be reused by the `RouteReuseStrategy`\n+         router.navigateByUrl('/a');\n+         advance(fixture);\n+         expect(cmp.attachedComponents.length).toEqual(1);\n+         expect(cmp.attachedComponents[0] instanceof BlankCmp).toBe(true);\n+         expect(cmp.detachedComponents.length).toEqual(1);\n+         expect(cmp.detachedComponents[0] instanceof BlankCmp).toBe(true);\n+       }));\n+\n     it('should support attaching & detaching fragments',\n        fakeAsync(inject([Router, Location], (router: Router, location: Location) => {\n          const fixture = createRoot(router, RootCmp);"
        }
    ],
    "stats": {
        "total": 91,
        "additions": 89,
        "deletions": 2
    }
}