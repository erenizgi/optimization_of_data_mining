{
    "author": "devversion",
    "message": "ci: no longer use deprecated `pullapprove_conditions` option (#42895)\n\nPullApprove deprecated the `pullapprove_conditions` config\noption and introduced the `overrides` option. This commit\nmigrates to the new option, while also eliminating the\n`fallback` group with a simple override (as per recommendation\nfrom the pull approve docs).\n\nPR Close #42895",
    "sha": "4d86ea64710f5d71c829e2435b8cd429eef81e27",
    "files": [
        {
            "sha": "870eb067a8293b77d58c3b923f35531d2cf6d9e0",
            "filename": ".pullapprove.yml",
            "status": "modified",
            "additions": 16,
            "deletions": 58,
            "changes": 74,
            "blob_url": "https://github.com/angular/angular/blob/4d86ea64710f5d71c829e2435b8cd429eef81e27/.pullapprove.yml",
            "raw_url": "https://github.com/angular/angular/raw/4d86ea64710f5d71c829e2435b8cd429eef81e27/.pullapprove.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.pullapprove.yml?ref=4d86ea64710f5d71c829e2435b8cd429eef81e27",
            "patch": "@@ -79,7 +79,10 @@ meta:\n   # one are those that appear above it.\n   no-groups-above-this-pending: &no-groups-above-this-pending len(groups.active.pending.exclude(\"required-minimum-review\").exclude(\"global-approvers\").exclude(\"global-docs-approvers\")) == 0\n   no-groups-above-this-rejected: &no-groups-above-this-rejected len(groups.active.rejected.exclude(\"required-minimum-review\").exclude(\"global-approvers\").exclude(\"global-docs-approvers\")) == 0\n-  no-groups-above-this-active: &no-groups-above-this-active len(groups.active.exclude(\"required-minimum-review\").exclude(\"global-approvers\").exclude(\"global-docs-approvers\")) == 0\n+\n+  # Yaml anchor that represents a PullApprove expression that evaluates to `true` whenever\n+  # there are no actual review groups active. Groups which are always active are excluded.\n+  no-review-groups-active: &no-review-groups-active len(groups.active.exclude(\"required-minimum-review\").exclude(\"global-approvers\").exclude(\"global-docs-approvers\")) == 0\n \n   can-be-global-approved: &can-be-global-approved '\"global-approvers\" not in groups.approved'\n   can-be-global-docs-approved: &can-be-global-docs-approved '\"global-docs-approvers\" not in groups.approved'\n@@ -97,22 +100,23 @@ meta:\n # https://developer.github.com/v3/previews/#draft-pull-requests\n github_api_version: 'shadow-cat-preview'\n \n-pullapprove_conditions:\n+# https://docs.pullapprove.com/config/overrides/\n+# Note that overrides are processed in order.\n+overrides:\n   # For PRs which are still being worked on, either still in draft mode or indicated through WIP in\n   # title or label, PullApprove stays in a pending state until its ready for review.\n-  - condition: \"'WIP' not in title\"\n-    unmet_status: pending\n-    explanation: 'Waiting to send reviews as PR is WIP'\n-  - condition: \"'PR state: WIP' not in labels\"\n-    unmet_status: pending\n+  - if: \"draft or 'WIP' in title or 'PR state: WIP' in labels\"\n+    status: pending\n     explanation: 'Waiting to send reviews as PR is WIP'\n-  - condition: 'not draft'\n-    unmet_status: pending\n-    explanation: 'Waiting to send reviews as PR is in draft'\n   # Disable PullApprove on specific PRs by adding the `PullApprove: disable` label\n-  - condition: \"'PullApprove: disable' not in labels\"\n-    unmet_status: success\n+  - if: \"'PullApprove: disable' in labels\"\n+    status: success\n     explanation: \"PullApprove skipped because of 'PullApprove: disable' label\"\n+  # If no groups are active, report this pull request as failing. Most likely, the\n+  # PR author would need to update the PullApprove config, or create new group.\n+  - if: *no-review-groups-active\n+    status: failure\n+    explanation: 'At least one group must match this PR. Please update an existing review group, or create a new group.'\n \n groups:\n   # =========================================================\n@@ -1305,49 +1309,3 @@ groups:\n         - atscott\n         - jelbourn\n         - josephperrott\n-\n-  # ====================================================\n-  #  Catch all for if no groups match the code change\n-  # ====================================================\n-  fallback:\n-    <<: *defaults\n-    # A group is considered to be `active` for a PR if at least one of group's\n-    # conditions matches the PR.\n-    #\n-    # The PullApprove CI check should fail if a PR has no `active` groups, as\n-    # this indicates the PR is modifying a file that has no owner.\n-    #\n-    # This is enforced through the pullapprove verification check done\n-    # as part of the CircleCI lint job.  Failures in this lint job should be\n-    # fixed as part of the PR.  This can be done by updating the\n-    # `.pullapprove.yml` file cover the unmatched path.\n-    # The pullapprove verification script is part of the ng-dev tool and can be\n-    # run locally with the command: `yarn -s ng-dev pullapprove verify`\n-    #\n-    # For cases in which the verification check fails to ensure coverage, this\n-    # group will be active.  The expectation is that this should be remedied\n-    # before merging the PR as described above.  In an emergency situation\n-    # `global-approvers` can still approve PRs that match this `fallback` rule,\n-    # but that should be an exception and not an expectation.\n-    conditions:\n-      - *no-groups-above-this-active\n-      # When any of the `global-*` groups is approved, they cause other groups to deactivate.\n-      # In those cases, the condition above would evaluate to `true` while in reality, only a global\n-      # approval has been provided. To ensure we don't activate the fallback group in such cases,\n-      # ensure that no explicit global approval has been provided.\n-      - *can-be-global-approved\n-      - *can-be-global-docs-approved\n-    # PullApprove uses a combination of users defined in the pullapprove configuration and the\n-    # number of users who have performed reviews on Github in the recent past if the configuration\n-    # does not specify it. Because, as an open source project, anyone on Github can perform a\n-    # review we need to ensure that all groups, including the fallback group, have at least one user\n-    # or group defined as reviewers.\n-    reviewers:\n-      users:\n-        - josephperrott\n-    reviews:\n-      request: 0\n-      required: 1\n-      # Reviewed-for is required on fallback as it should not ever actually be reviewed, requiring\n-      # Reviewed-for helps insure an accidental approval doesn't occur on the fallback group.\n-      reviewed_for: required"
        },
        {
            "sha": "cc6db24e76cb5cf63d687abd423bd41886e6fe28",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/4d86ea64710f5d71c829e2435b8cd429eef81e27/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/4d86ea64710f5d71c829e2435b8cd429eef81e27/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=4d86ea64710f5d71c829e2435b8cd429eef81e27",
            "patch": "@@ -5180,10 +5180,6 @@ function transformExpressionToJs(expression) {\n  */\n // Regular expression that matches conditions for the global approval.\n const GLOBAL_APPROVAL_CONDITION_REGEX = /^\"global-(docs-)?approvers\" not in groups.approved$/;\n-// Name of the PullApprove group that serves as fallback. This group should never capture\n-// any conditions as it would always match specified files. This is not desired as we want\n-// to figure out as part of this tool, whether there actually are unmatched files.\n-const FALLBACK_GROUP_NAME = 'fallback';\n /** A PullApprove group to be able to test files against. */\n class PullApproveGroup {\n     constructor(groupName, config, precedingGroups = []) {\n@@ -5196,7 +5192,7 @@ class PullApproveGroup {\n         this.reviewers = (_a = config.reviewers) !== null && _a !== void 0 ? _a : { users: [], teams: [] };\n     }\n     _captureConditions(config) {\n-        if (config.conditions && this.groupName !== FALLBACK_GROUP_NAME) {\n+        if (config.conditions) {\n             return config.conditions.forEach(condition => {\n                 const expression = condition.trim();\n                 if (expression.match(GLOBAL_APPROVAL_CONDITION_REGEX)) {"
        },
        {
            "sha": "2c1b2669065a07f47809743df3d86d6bea169fec",
            "filename": "dev-infra/pullapprove/group.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/4d86ea64710f5d71c829e2435b8cd429eef81e27/dev-infra%2Fpullapprove%2Fgroup.ts",
            "raw_url": "https://github.com/angular/angular/raw/4d86ea64710f5d71c829e2435b8cd429eef81e27/dev-infra%2Fpullapprove%2Fgroup.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpullapprove%2Fgroup.ts?ref=4d86ea64710f5d71c829e2435b8cd429eef81e27",
            "patch": "@@ -37,11 +37,6 @@ export interface PullApproveGroupResult {\n // Regular expression that matches conditions for the global approval.\n const GLOBAL_APPROVAL_CONDITION_REGEX = /^\"global-(docs-)?approvers\" not in groups.approved$/;\n \n-// Name of the PullApprove group that serves as fallback. This group should never capture\n-// any conditions as it would always match specified files. This is not desired as we want\n-// to figure out as part of this tool, whether there actually are unmatched files.\n-const FALLBACK_GROUP_NAME = 'fallback';\n-\n /** A PullApprove group to be able to test files against. */\n export class PullApproveGroup {\n   /** List of conditions for the group. */\n@@ -57,7 +52,7 @@ export class PullApproveGroup {\n   }\n \n   private _captureConditions(config: PullApproveGroupConfig) {\n-    if (config.conditions && this.groupName !== FALLBACK_GROUP_NAME) {\n+    if (config.conditions) {\n       return config.conditions.forEach(condition => {\n         const expression = condition.trim();\n "
        }
    ],
    "stats": {
        "total": 87,
        "additions": 18,
        "deletions": 69
    }
}