{
    "author": "alxhub",
    "message": "fix(compiler-cli): set TS original node on imported namespace identifiers (#40711)\n\nThis commit causes imports added by ngtsc's `ImportManager` to have their\nTypeScript \"original node\" set to the generated `ts.ImportDeclaration`\nstatement.\n\nIn g3, the tsickle transformer runs after the Angular transformer and post-\nprocesses Angular's compilation output. One of its post-processing tasks is\nto transform generated imports and references to imported symbols from the\ncommonjs module system to the g3 module system. Part of this transformation\ninvolves recognizing modules with specific metadata and altering references\nto symbols from those modules accordingly.\n\nNormally, tsickle can rely on TypeScript's binding for an imported symbol to\nfind its origin module and thus the correct metadata for the symbol. However\nthe Angular transform generates new synthetic imports which don't have such\nbinding information. Angular's imports are always namespace imports of the\nform:\n\n```\nimport * as qualifier 'module/specifier';\n```\n\nReferences to such an import are then of the form `qualifier.SymbolName`.\n\nTo process such imports properly, tsickle needs to be able to associate the\nreference to `qualifier` in the expression `qualifer.SymbolName` with the\n`ts.ImportDeclaration` statement that defines it. It expects to do this by\nlooking at the `ts.getOriginalNode()` for the `qualifier` reference, which\nshould be the `ts.ImportDeclaration`. This commit changes ngtsc's import\ngeneration mechanism to set the original node on `qualifier` identifiers\naccording to this expectation.\n\nThis commit is not tested in the direct compiler tests, since:\n\n1) there is no observable behavior externally from setting the original node\n2) we don't have tests that intercept transformer operations (which could be\n   used to directly assert against the AST nodes)\n3) tsickle's published version does not (yet) contain the g3-specific\n   transformations which rely on the original node and would thus allow the\n   behavior to be observed.\n\nInstead, we rely on the g3 testing suite to validate the correctness of this\nfix. Breaking this functionality would cause g3 compilation errors for\ntargets, since tsickle would be unable to transform imports correctly.\n\nPR Close #40711",
    "sha": "80f4ff33381d37e72764d2ea3b7060e5952232e9",
    "files": [
        {
            "sha": "f18a0181dc9d28527dc00519457f71f570b72406",
            "filename": "packages/compiler-cli/ngcc/src/rendering/commonjs_rendering_formatter.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fcommonjs_rendering_formatter.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fcommonjs_rendering_formatter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fcommonjs_rendering_formatter.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -39,7 +39,7 @@ export class CommonJsRenderingFormatter extends Esm5RenderingFormatter {\n \n     const insertionPoint = this.findEndOfImports(file);\n     const renderedImports =\n-        imports.map(i => `var ${i.qualifier} = require('${i.specifier}');\\n`).join('');\n+        imports.map(i => `var ${i.qualifier.text} = require('${i.specifier}');\\n`).join('');\n     output.appendLeft(insertionPoint, renderedImports);\n   }\n "
        },
        {
            "sha": "7edf77e072d6ae1d44d514131345bec190971582",
            "filename": "packages/compiler-cli/ngcc/src/rendering/esm_rendering_formatter.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fesm_rendering_formatter.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fesm_rendering_formatter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fesm_rendering_formatter.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -42,7 +42,7 @@ export class EsmRenderingFormatter implements RenderingFormatter {\n \n     const insertionPoint = this.findEndOfImports(sf);\n     const renderedImports =\n-        imports.map(i => `import * as ${i.qualifier} from '${i.specifier}';\\n`).join('');\n+        imports.map(i => `import * as ${i.qualifier.text} from '${i.specifier}';\\n`).join('');\n     output.appendLeft(insertionPoint, renderedImports);\n   }\n "
        },
        {
            "sha": "662c046d07a6e3ec333edc1333653f613b0def07",
            "filename": "packages/compiler-cli/ngcc/src/rendering/umd_rendering_formatter.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fumd_rendering_formatter.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fumd_rendering_formatter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fumd_rendering_formatter.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -225,7 +225,7 @@ function renderFactoryParameters(\n   }\n \n   const parameters = factoryFunction.parameters;\n-  const parameterString = imports.map(i => i.qualifier).join(',');\n+  const parameterString = imports.map(i => i.qualifier.text).join(',');\n   if (parameters.length > 0) {\n     const injectionPoint = parameters[0].getFullStart();\n     output.appendLeft(injectionPoint, parameterString + ',');"
        },
        {
            "sha": "6d3cf14b6814477d7a87e73d32d9ed70884c1246",
            "filename": "packages/compiler-cli/ngcc/test/rendering/commonjs_rendering_formatter_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fcommonjs_rendering_formatter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fcommonjs_rendering_formatter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fcommonjs_rendering_formatter_spec.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -177,8 +177,8 @@ exports.D = D;\n         renderer.addImports(\n             output,\n             [\n-              {specifier: '@angular/core', qualifier: 'i0'},\n-              {specifier: '@angular/common', qualifier: 'i1'}\n+              {specifier: '@angular/core', qualifier: ts.createIdentifier('i0')},\n+              {specifier: '@angular/common', qualifier: ts.createIdentifier('i1')}\n             ],\n             sourceFile);\n         expect(output.toString()).toContain(`/* A copyright notice */\n@@ -257,7 +257,8 @@ var A = (function() {`);\n         const file = getSourceFileOrError(program, _('/node_modules/test-package/some/file.js'));\n         const output = new MagicString(PROGRAM.contents);\n         renderer.addConstants(output, 'var x = 3;', file);\n-        renderer.addImports(output, [{specifier: '@angular/core', qualifier: 'i0'}], file);\n+        renderer.addImports(\n+            output, [{specifier: '@angular/core', qualifier: ts.createIdentifier('i0')}], file);\n         expect(output.toString()).toContain(`\n var core = require('@angular/core');\n var i0 = require('@angular/core');"
        },
        {
            "sha": "8da3f9323bb04fbb5c762e24a2ac4b0ef98e46d0",
            "filename": "packages/compiler-cli/ngcc/test/rendering/esm5_rendering_formatter_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fesm5_rendering_formatter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fesm5_rendering_formatter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fesm5_rendering_formatter_spec.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -188,8 +188,8 @@ export { F };\n         renderer.addImports(\n             output,\n             [\n-              {specifier: '@angular/core', qualifier: 'i0'},\n-              {specifier: '@angular/common', qualifier: 'i1'}\n+              {specifier: '@angular/core', qualifier: ts.createIdentifier('i0')},\n+              {specifier: '@angular/common', qualifier: ts.createIdentifier('i1')}\n             ],\n             sourceFile);\n         expect(output.toString()).toContain(`/* A copyright notice */\n@@ -263,7 +263,8 @@ var A = (function() {`);\n         const file = getSourceFileOrError(program, _('/node_modules/test-package/some/file.js'));\n         const output = new MagicString(PROGRAM.contents);\n         renderer.addConstants(output, 'var x = 3;', file);\n-        renderer.addImports(output, [{specifier: '@angular/core', qualifier: 'i0'}], file);\n+        renderer.addImports(\n+            output, [{specifier: '@angular/core', qualifier: ts.createIdentifier('i0')}], file);\n         expect(output.toString()).toContain(`\n import {Directive} from '@angular/core';\n import * as i0 from '@angular/core';"
        },
        {
            "sha": "0f7749108ea1db153985eb892d81d2500e723470",
            "filename": "packages/compiler-cli/ngcc/test/rendering/esm_rendering_formatter_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fesm_rendering_formatter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fesm_rendering_formatter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fesm_rendering_formatter_spec.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -156,8 +156,8 @@ runInEachFileSystem(() => {\n           renderer.addImports(\n               output,\n               [\n-                {specifier: '@angular/core', qualifier: 'i0'},\n-                {specifier: '@angular/common', qualifier: 'i1'}\n+                {specifier: '@angular/core', qualifier: ts.createIdentifier('i0')},\n+                {specifier: '@angular/common', qualifier: ts.createIdentifier('i1')}\n               ],\n               sourceFile);\n           expect(output.toString()).toContain(`/* A copyright notice */\n@@ -231,7 +231,8 @@ const x = 3;\n           const file = getSourceFileOrError(program, _('/node_modules/test-package/some/file.js'));\n           const output = new MagicString(PROGRAM.contents);\n           renderer.addConstants(output, 'const x = 3;', file);\n-          renderer.addImports(output, [{specifier: '@angular/core', qualifier: 'i0'}], file);\n+          renderer.addImports(\n+              output, [{specifier: '@angular/core', qualifier: ts.createIdentifier('i0')}], file);\n           expect(output.toString()).toContain(`\n import {Directive} from '@angular/core';\n import * as i0 from '@angular/core';"
        },
        {
            "sha": "e66474f3b6737d78027faa2c30ce6b9035e1e9de",
            "filename": "packages/compiler-cli/ngcc/test/rendering/renderer_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Frenderer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Frenderer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Frenderer_spec.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -276,7 +276,7 @@ A.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: A, selectors: [[\"a\"]], decls: 1, v\n              const addImportsSpy = testFormatter.addImports as jasmine.Spy;\n              expect(addImportsSpy.calls.first().args[0].toString()).toEqual(RENDERED_CONTENTS);\n              expect(addImportsSpy.calls.first().args[1]).toEqual([\n-               {specifier: '@angular/core', qualifier: 'ɵngcc0'}\n+               {specifier: '@angular/core', qualifier: jasmine.objectContaining({text: 'ɵngcc0'})}\n              ]);\n            });\n \n@@ -693,7 +693,7 @@ UndecoratedBase.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: UndecoratedBase, vie\n                   `function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && ɵngcc0.setClassMetadata(`);\n           const addImportsSpy = testFormatter.addImports as jasmine.Spy;\n           expect(addImportsSpy.calls.first().args[1]).toEqual([\n-            {specifier: './r3_symbols', qualifier: 'ɵngcc0'}\n+            {specifier: './r3_symbols', qualifier: jasmine.objectContaining({text: 'ɵngcc0'})}\n           ]);\n         });\n "
        },
        {
            "sha": "9872271c3721b735f3366a02924c5e19a0da6606",
            "filename": "packages/compiler-cli/ngcc/test/rendering/umd_rendering_formatter_spec.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 18,
            "changes": 38,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fumd_rendering_formatter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fumd_rendering_formatter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fumd_rendering_formatter_spec.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -200,8 +200,8 @@ typeof define === 'function' && define.amd ? define('file', ['exports','/tslib',\n         renderer.addImports(\n             output,\n             [\n-              {specifier: '@angular/core', qualifier: 'i0'},\n-              {specifier: '@angular/common', qualifier: 'i1'}\n+              {specifier: '@angular/core', qualifier: ts.createIdentifier('i0')},\n+              {specifier: '@angular/common', qualifier: ts.createIdentifier('i1')}\n             ],\n             file);\n         expect(output.toString())\n@@ -217,8 +217,8 @@ typeof define === 'function' && define.amd ? define('file', ['exports','/tslib',\n         renderer.addImports(\n             output,\n             [\n-              {specifier: '@angular/core', qualifier: 'i0'},\n-              {specifier: '@angular/common', qualifier: 'i1'}\n+              {specifier: '@angular/core', qualifier: ts.createIdentifier('i0')},\n+              {specifier: '@angular/common', qualifier: ts.createIdentifier('i1')}\n             ],\n             file);\n         expect(output.toString())\n@@ -233,8 +233,8 @@ typeof define === 'function' && define.amd ? define('file', ['exports','/tslib',\n         renderer.addImports(\n             output,\n             [\n-              {specifier: '@angular/core', qualifier: 'i0'},\n-              {specifier: '@angular/common', qualifier: 'i1'}\n+              {specifier: '@angular/core', qualifier: ts.createIdentifier('i0')},\n+              {specifier: '@angular/common', qualifier: ts.createIdentifier('i1')}\n             ],\n             file);\n         expect(output.toString())\n@@ -249,10 +249,12 @@ typeof define === 'function' && define.amd ? define('file', ['exports','/tslib',\n         renderer.addImports(\n             output,\n             [\n-              {specifier: '@ngrx/store', qualifier: 'i0'},\n-              {specifier: '@angular/platform-browser-dynamic', qualifier: 'i1'},\n-              {specifier: '@angular/common/testing', qualifier: 'i2'},\n-              {specifier: '@angular-foo/package', qualifier: 'i3'}\n+              {specifier: '@ngrx/store', qualifier: ts.createIdentifier('i0')}, {\n+                specifier: '@angular/platform-browser-dynamic',\n+                qualifier: ts.createIdentifier('i1')\n+              },\n+              {specifier: '@angular/common/testing', qualifier: ts.createIdentifier('i2')},\n+              {specifier: '@angular-foo/package', qualifier: ts.createIdentifier('i3')}\n             ],\n             file);\n         expect(output.toString())\n@@ -270,8 +272,8 @@ typeof define === 'function' && define.amd ? define('file', ['exports','/tslib',\n            renderer.addImports(\n                output,\n                [\n-                 {specifier: '@angular/core', qualifier: 'i0'},\n-                 {specifier: '@angular/common', qualifier: 'i1'}\n+                 {specifier: '@angular/core', qualifier: ts.createIdentifier('i0')},\n+                 {specifier: '@angular/common', qualifier: ts.createIdentifier('i1')}\n                ],\n                file);\n            expect(output.toString())\n@@ -287,8 +289,8 @@ typeof define === 'function' && define.amd ? define('file', ['exports','/tslib',\n            renderer.addImports(\n                output,\n                [\n-                 {specifier: '@angular/core', qualifier: 'i0'},\n-                 {specifier: '@angular/common', qualifier: 'i1'}\n+                 {specifier: '@angular/core', qualifier: ts.createIdentifier('i0')},\n+                 {specifier: '@angular/common', qualifier: ts.createIdentifier('i1')}\n                ],\n                file);\n            expect(output.toString())\n@@ -315,8 +317,8 @@ typeof define === 'function' && define.amd ? define('file', ['exports','/tslib',\n         renderer.addImports(\n             output,\n             [\n-              {specifier: '@angular/core', qualifier: 'i0'},\n-              {specifier: '@angular/common', qualifier: 'i1'}\n+              {specifier: '@angular/core', qualifier: ts.createIdentifier('i0')},\n+              {specifier: '@angular/common', qualifier: ts.createIdentifier('i1')}\n             ],\n             file);\n         const outputSrc = output.toString();\n@@ -361,8 +363,8 @@ typeof define === 'function' && define.amd ? define('file', ['exports','/tslib',\n         renderer.addImports(\n             output,\n             [\n-              {specifier: '@angular/core', qualifier: 'i0'},\n-              {specifier: '@angular/common', qualifier: 'i1'}\n+              {specifier: '@angular/core', qualifier: ts.createIdentifier('i0')},\n+              {specifier: '@angular/common', qualifier: ts.createIdentifier('i1')}\n             ],\n             file);\n         const outputSrc = output.toString();"
        },
        {
            "sha": "57f08b9fa6a09df8d72ea87445bcb864dafe6a26",
            "filename": "packages/compiler-cli/src/ngtsc/transform/src/utils.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Futils.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -19,15 +19,27 @@ export function addImports(\n     extraStatements: ts.Statement[] = []): ts.SourceFile {\n   // Generate the import statements to prepend.\n   const addedImports = importManager.getAllImports(sf.fileName).map(i => {\n-    const qualifier = ts.createIdentifier(i.qualifier);\n+    const qualifier = ts.createIdentifier(i.qualifier.text);\n     const importClause = ts.createImportClause(\n         /* name */ undefined,\n         /* namedBindings */ ts.createNamespaceImport(qualifier));\n-    return ts.createImportDeclaration(\n+    const decl = ts.createImportDeclaration(\n         /* decorators */ undefined,\n         /* modifiers */ undefined,\n         /* importClause */ importClause,\n         /* moduleSpecifier */ ts.createLiteral(i.specifier));\n+\n+    // Set the qualifier's original TS node to the `ts.ImportDeclaration`. This allows downstream\n+    // transforms such as tsickle to properly process references to this import.\n+    //\n+    // This operation is load-bearing in g3 as some imported modules contain special metadata\n+    // generated by clutz, which tsickle uses to transform imports and references to those imports.\n+    //\n+    // TODO(alxhub): add a test for this when tsickle is updated externally to depend on this\n+    // behavior.\n+    ts.setOriginalNode(i.qualifier, decl);\n+\n+    return decl;\n   });\n \n   // Filter out the existing imports and the source file body. All new statements"
        },
        {
            "sha": "b6300ba02a1b12238a879cacacaf0751d21e7ebd",
            "filename": "packages/compiler-cli/src/ngtsc/translator/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Findex.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -7,9 +7,9 @@\n  */\n \n export {AstFactory, BinaryOperator, LeadingComment, ObjectLiteralProperty, SourceMapLocation, SourceMapRange, TemplateElement, TemplateLiteral, UnaryOperator, VariableDeclarationType} from './src/api/ast_factory';\n-export {Import, ImportGenerator, NamedImport} from './src/api/import_generator';\n+export {ImportGenerator, NamedImport} from './src/api/import_generator';\n export {Context} from './src/context';\n-export {ImportManager} from './src/import_manager';\n+export {Import, ImportManager} from './src/import_manager';\n export {ExpressionTranslatorVisitor, RecordWrappedNodeExprFn, TranslatorOptions} from './src/translator';\n export {translateType} from './src/type_translator';\n export {attachComments, createTemplateMiddle, createTemplateTail, TypeScriptAstFactory} from './src/typescript_ast_factory';"
        },
        {
            "sha": "07a1bd22f5ffd215cb1f2f429bc453d233f7da78",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/api/import_generator.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Fapi%2Fimport_generator.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Fapi%2Fimport_generator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Fapi%2Fimport_generator.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -6,16 +6,6 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-/**\n- * Information about an import that has been added to a module.\n- */\n-export interface Import {\n-  /** The name of the module that has been imported. */\n-  specifier: string;\n-  /** The alias of the imported module. */\n-  qualifier: string;\n-}\n-\n /**\n  * The symbol name and import namespace of an imported symbol,\n  * which has been registered through the ImportGenerator."
        },
        {
            "sha": "65a083308e1a91005d5d57d9c2b4990c5ac30a39",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/import_manager.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 6,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Fimport_manager.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Fimport_manager.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Fimport_manager.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -7,7 +7,17 @@\n  */\n import * as ts from 'typescript';\n import {ImportRewriter, NoopImportRewriter} from '../../imports';\n-import {Import, ImportGenerator, NamedImport} from './api/import_generator';\n+import {ImportGenerator, NamedImport} from './api/import_generator';\n+\n+/**\n+ * Information about an import that has been added to a module.\n+ */\n+export interface Import {\n+  /** The name of the module that has been imported. */\n+  specifier: string;\n+  /** The `ts.Identifer` by which the imported module is known. */\n+  qualifier: ts.Identifier;\n+}\n \n export class ImportManager implements ImportGenerator<ts.Identifier> {\n   private specifierToIdentifier = new Map<string, ts.Identifier>();\n@@ -42,11 +52,14 @@ export class ImportManager implements ImportGenerator<ts.Identifier> {\n   }\n \n   getAllImports(contextPath: string): Import[] {\n-    const imports: {specifier: string, qualifier: string}[] = [];\n-    this.specifierToIdentifier.forEach((qualifier, specifier) => {\n-      specifier = this.rewriter.rewriteSpecifier(specifier, contextPath);\n-      imports.push({specifier, qualifier: qualifier.text});\n-    });\n+    const imports: Import[] = [];\n+    for (const [originalSpecifier, qualifier] of this.specifierToIdentifier) {\n+      const specifier = this.rewriter.rewriteSpecifier(originalSpecifier, contextPath);\n+      imports.push({\n+        specifier,\n+        qualifier,\n+      });\n+    }\n     return imports;\n   }\n }"
        },
        {
            "sha": "6754c93cc2672796f1461be86398bdb4f9c51c2d",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/context.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fcontext.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fcontext.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fcontext.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -355,7 +355,7 @@ export class TypeCheckContextImpl implements TypeCheckContext {\n \n     // Write out the imports that need to be added to the beginning of the file.\n     let imports = importManager.getAllImports(sf.fileName)\n-                      .map(i => `import * as ${i.qualifier} from '${i.specifier}';`)\n+                      .map(i => `import * as ${i.qualifier.text} from '${i.specifier}';`)\n                       .join('\\n');\n     code = imports + '\\n' + code;\n "
        },
        {
            "sha": "88efdeb6b02ee932695a61625085835a87912b15",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/type_check_file.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_file.ts",
            "raw_url": "https://github.com/angular/angular/raw/80f4ff33381d37e72764d2ea3b7060e5952232e9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_file.ts?ref=80f4ff33381d37e72764d2ea3b7060e5952232e9",
            "patch": "@@ -51,7 +51,7 @@ export class TypeCheckFile extends Environment {\n \n   render(): string {\n     let source: string = this.importManager.getAllImports(this.contextFile.fileName)\n-                             .map(i => `import * as ${i.qualifier} from '${i.specifier}';`)\n+                             .map(i => `import * as ${i.qualifier.text} from '${i.specifier}';`)\n                              .join('\\n') +\n         '\\n\\n';\n     const printer = ts.createPrinter();"
        }
    ],
    "stats": {
        "total": 128,
        "additions": 74,
        "deletions": 54
    }
}