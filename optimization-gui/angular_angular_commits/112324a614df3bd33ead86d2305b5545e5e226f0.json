{
    "author": "atscott",
    "message": "feat(router): add `relativeTo` as an input to `routerLink` (#39720)\n\nAllow configuration of `relativeTo` in the `routerLink` directive. This\nis related to the clearing of auxiliary routes, where you need to use\n`relativeTo: route.parent` in order to clear it from the activated\nauxiliary component itself. This is because `relativeTo: route` will\nconsume the segment that we're trying to clear, so there is really no\nway to do this with routerLink at the moment.\n\nRelated issue: #13523\nRelated (internal link): https://yaqs.corp.google.com/eng/q/5999443644645376\n\nPR Close #39720",
    "sha": "112324a614df3bd33ead86d2305b5545e5e226f0",
    "files": [
        {
            "sha": "bb9bc0a39f34cf70cec237c1288e67ef6a31998e",
            "filename": "goldens/public-api/router/router.d.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/112324a614df3bd33ead86d2305b5545e5e226f0/goldens%2Fpublic-api%2Frouter%2Frouter.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/112324a614df3bd33ead86d2305b5545e5e226f0/goldens%2Fpublic-api%2Frouter%2Frouter.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Frouter%2Frouter.d.ts?ref=112324a614df3bd33ead86d2305b5545e5e226f0",
            "patch": "@@ -380,6 +380,7 @@ export declare class RouterLink implements OnChanges {\n     preserveFragment: boolean;\n     queryParams?: Params | null;\n     queryParamsHandling?: QueryParamsHandling | null;\n+    relativeTo?: ActivatedRoute | null;\n     replaceUrl: boolean;\n     set routerLink(commands: any[] | string | null | undefined);\n     skipLocationChange: boolean;\n@@ -412,6 +413,7 @@ export declare class RouterLinkWithHref implements OnChanges, OnDestroy {\n     preserveFragment: boolean;\n     queryParams?: Params | null;\n     queryParamsHandling?: QueryParamsHandling | null;\n+    relativeTo?: ActivatedRoute | null;\n     replaceUrl: boolean;\n     set routerLink(commands: any[] | string | null | undefined);\n     skipLocationChange: boolean;"
        },
        {
            "sha": "64acd67024ed2dbae7cac3a4004441cb0189c54f",
            "filename": "packages/router/src/directives/router_link.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 2,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/112324a614df3bd33ead86d2305b5545e5e226f0/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_link.ts",
            "raw_url": "https://github.com/angular/angular/raw/112324a614df3bd33ead86d2305b5545e5e226f0/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_link.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Fdirectives%2Frouter_link.ts?ref=112324a614df3bd33ead86d2305b5545e5e226f0",
            "patch": "@@ -169,6 +169,17 @@ export class RouterLink implements OnChanges {\n    * @see {@link Router#navigateByUrl Router#navigateByUrl}\n    */\n   @Input() state?: {[k: string]: any};\n+  /**\n+   * Passed to {@link Router#createUrlTree Router#createUrlTree} as part of the\n+   * `UrlCreationOptions`.\n+   * Specify a value here when you do not want to use the default value\n+   * for `routerLink`, which is the current activated route.\n+   * Note that a value of `undefined` here will use the `routerLink` default.\n+   * @see {@link UrlCreationOptions#relativeTo UrlCreationOptions#relativeTo}\n+   * @see {@link Router#createUrlTree Router#createUrlTree}\n+   */\n+  @Input() relativeTo?: ActivatedRoute|null;\n+\n   private commands: any[] = [];\n   private preserve!: boolean;\n \n@@ -220,7 +231,9 @@ export class RouterLink implements OnChanges {\n \n   get urlTree(): UrlTree {\n     return this.router.createUrlTree(this.commands, {\n-      relativeTo: this.route,\n+      // If the `relativeTo` input is not defined, we want to use `this.route` by default.\n+      // Otherwise, we should use the value provided by the user in the input.\n+      relativeTo: this.relativeTo !== undefined ? this.relativeTo : this.route,\n       queryParams: this.queryParams,\n       fragment: this.fragment,\n       queryParamsHandling: this.queryParamsHandling,\n@@ -296,6 +309,17 @@ export class RouterLinkWithHref implements OnChanges, OnDestroy {\n    * @see {@link Router#navigateByUrl Router#navigateByUrl}\n    */\n   @Input() state?: {[k: string]: any};\n+  /**\n+   * Passed to {@link Router#createUrlTree Router#createUrlTree} as part of the\n+   * `UrlCreationOptions`.\n+   * Specify a value here when you do not want to use the default value\n+   * for `routerLink`, which is the current activated route.\n+   * Note that a value of `undefined` here will use the `routerLink` default.\n+   * @see {@link UrlCreationOptions#relativeTo UrlCreationOptions#relativeTo}\n+   * @see {@link Router#createUrlTree Router#createUrlTree}\n+   */\n+  @Input() relativeTo?: ActivatedRoute|null;\n+\n   private commands: any[] = [];\n   private subscription: Subscription;\n   // TODO(issue/24571): remove '!'.\n@@ -373,7 +397,9 @@ export class RouterLinkWithHref implements OnChanges, OnDestroy {\n \n   get urlTree(): UrlTree {\n     return this.router.createUrlTree(this.commands, {\n-      relativeTo: this.route,\n+      // If the `relativeTo` input is not defined, we want to use `this.route` by default.\n+      // Otherwise, we should use the value provided by the user in the input.\n+      relativeTo: this.relativeTo !== undefined ? this.relativeTo : this.route,\n       queryParams: this.queryParams,\n       fragment: this.fragment,\n       queryParamsHandling: this.queryParamsHandling,"
        },
        {
            "sha": "0e5b4b76790cbc7df0140cc8cc9156612c8e0c0e",
            "filename": "packages/router/src/router.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/112324a614df3bd33ead86d2305b5545e5e226f0/packages%2Frouter%2Fsrc%2Frouter.ts",
            "raw_url": "https://github.com/angular/angular/raw/112324a614df3bd33ead86d2305b5545e5e226f0/packages%2Frouter%2Fsrc%2Frouter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Frouter.ts?ref=112324a614df3bd33ead86d2305b5545e5e226f0",
            "patch": "@@ -81,6 +81,9 @@ export interface UrlCreationOptions {\n    *    }\n    *  }\n    * ```\n+   *\n+   * A value of `null` or `undefined` indicates that the navigation commands should be applied\n+   * relative to the root.\n    */\n   relativeTo?: ActivatedRoute|null;\n \n@@ -1094,6 +1097,9 @@ export class Router {\n    *\n    * // navigate to /team/44/user/22\n    * router.createUrlTree(['../../team/44/user/22'], {relativeTo: route});\n+   *\n+   * Note that a value of `null` or `undefined` for `relativeTo` indicates that the\n+   * tree should be created relative to the root.\n    * ```\n    */\n   createUrlTree(commands: any[], navigationExtras: UrlCreationOptions = {}): UrlTree {"
        },
        {
            "sha": "cae9479ef0a2ac717e8b3971605e41dbdaff80bd",
            "filename": "packages/router/test/integration.spec.ts",
            "status": "modified",
            "additions": 50,
            "deletions": 2,
            "changes": 52,
            "blob_url": "https://github.com/angular/angular/blob/112324a614df3bd33ead86d2305b5545e5e226f0/packages%2Frouter%2Ftest%2Fintegration.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/112324a614df3bd33ead86d2305b5545e5e226f0/packages%2Frouter%2Ftest%2Fintegration.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fintegration.spec.ts?ref=112324a614df3bd33ead86d2305b5545e5e226f0",
            "patch": "@@ -8,11 +8,12 @@\n \n import {CommonModule, Location} from '@angular/common';\n import {SpyLocation} from '@angular/common/testing';\n-import {ChangeDetectionStrategy, Component, Injectable, NgModule, NgModuleFactoryLoader, NgModuleRef, NgZone, OnDestroy, ɵConsole as Console, ɵNoopNgZone as NoopNgZone} from '@angular/core';\n+import {ChangeDetectionStrategy, Component, Injectable, NgModule, NgModuleFactoryLoader, NgModuleRef, NgZone, OnDestroy, ViewChild, ɵConsole as Console, ɵNoopNgZone as NoopNgZone} from '@angular/core';\n import {ComponentFixture, fakeAsync, inject, TestBed, tick} from '@angular/core/testing';\n+import {describe} from '@angular/core/testing/src/testing_internal';\n import {By} from '@angular/platform-browser/src/dom/debug/by';\n import {expect} from '@angular/platform-browser/testing/src/matchers';\n-import {ActivatedRoute, ActivatedRouteSnapshot, ActivationEnd, ActivationStart, CanActivate, CanDeactivate, ChildActivationEnd, ChildActivationStart, DefaultUrlSerializer, DetachedRouteHandle, Event, GuardsCheckEnd, GuardsCheckStart, Navigation, NavigationCancel, NavigationEnd, NavigationError, NavigationStart, ParamMap, Params, PreloadAllModules, PreloadingStrategy, PRIMARY_OUTLET, Resolve, ResolveEnd, ResolveStart, RouteConfigLoadEnd, RouteConfigLoadStart, Router, RouteReuseStrategy, RouterEvent, RouterModule, RouterPreloader, RouterStateSnapshot, RoutesRecognized, RunGuardsAndResolvers, UrlHandlingStrategy, UrlSegmentGroup, UrlSerializer, UrlTree} from '@angular/router';\n+import {ActivatedRoute, ActivatedRouteSnapshot, ActivationEnd, ActivationStart, CanActivate, CanDeactivate, ChildActivationEnd, ChildActivationStart, DefaultUrlSerializer, DetachedRouteHandle, Event, GuardsCheckEnd, GuardsCheckStart, Navigation, NavigationCancel, NavigationEnd, NavigationError, NavigationStart, ParamMap, Params, PreloadAllModules, PreloadingStrategy, PRIMARY_OUTLET, Resolve, ResolveEnd, ResolveStart, RouteConfigLoadEnd, RouteConfigLoadStart, Router, RouteReuseStrategy, RouterEvent, RouterLink, RouterLinkWithHref, RouterModule, RouterPreloader, RouterStateSnapshot, RoutesRecognized, RunGuardsAndResolvers, UrlHandlingStrategy, UrlSegmentGroup, UrlSerializer, UrlTree} from '@angular/router';\n import {EMPTY, Observable, Observer, of, Subscription} from 'rxjs';\n import {delay, filter, first, map, mapTo, tap} from 'rxjs/operators';\n \n@@ -5382,6 +5383,53 @@ describe('Integration', () => {\n          })));\n     });\n \n+    it('can use `relativeTo` `route.parent` in `routerLink` to close secondary outlet',\n+       fakeAsync(() => {\n+         // Given\n+         @Component({template: '<router-outlet name=\"secondary\"></router-outlet>'})\n+         class ChildRootCmp {\n+         }\n+\n+         @Component({\n+           selector: 'link-cmp',\n+           template:\n+               `<a [relativeTo]=\"route.parent\" [routerLink]=\"[{outlets: {'secondary': null}}]\">link</a>\n+           <button [relativeTo]=\"route.parent\" [routerLink]=\"[{outlets: {'secondary': null}}]\">link</button>\n+           `\n+         })\n+         class RelativeLinkCmp {\n+           @ViewChild(RouterLink) buttonLink!: RouterLink;\n+           @ViewChild(RouterLinkWithHref) aLink!: RouterLink;\n+\n+           constructor(readonly route: ActivatedRoute) {}\n+         }\n+         @NgModule({\n+           declarations: [RelativeLinkCmp, ChildRootCmp],\n+           imports: [RouterModule.forChild([{\n+             path: 'childRoot',\n+             component: ChildRootCmp,\n+             children: [\n+               {path: 'popup', outlet: 'secondary', component: RelativeLinkCmp},\n+             ]\n+           }])]\n+         })\n+         class LazyLoadedModule {\n+         }\n+         const router = TestBed.inject(Router);\n+         router.resetConfig([{path: 'root', loadChildren: () => LazyLoadedModule}]);\n+\n+         // When\n+         router.navigateByUrl('/root/childRoot/(secondary:popup)');\n+         const fixture = createRoot(router, RootCmp);\n+         advance(fixture);\n+\n+         // Then\n+         const relativeLinkCmp =\n+             fixture.debugElement.query(By.directive(RelativeLinkCmp)).componentInstance;\n+         expect(relativeLinkCmp.aLink.urlTree.toString()).toEqual('/root/childRoot');\n+         expect(relativeLinkCmp.buttonLink.urlTree.toString()).toEqual('/root/childRoot');\n+       }));\n+\n     describe('relativeLinkResolution', () => {\n       @Component({selector: 'link-cmp', template: `<a [routerLink]=\"['../simple']\">link</a>`})\n       class RelativeLinkCmp {"
        }
    ],
    "stats": {
        "total": 90,
        "additions": 86,
        "deletions": 4
    }
}