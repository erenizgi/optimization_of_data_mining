{
    "author": "josephperrott",
    "message": "refactor(dev-infra): refactor commit-message files (#38845)\n\nRefactor the commit-message files to be consistent with how other ng-dev tooling\nis structured.\n\nPR Close #38845",
    "sha": "d192c87f6aba0c564ed4882712129733e29f1a41",
    "files": [
        {
            "sha": "29e384d6c166d7005d58ff670dfd35f83026e352",
            "filename": "dev-infra/commit-message/BUILD.bazel",
            "status": "modified",
            "additions": 5,
            "deletions": 17,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2FBUILD.bazel?ref=d192c87f6aba0c564ed4882712129733e29f1a41",
            "patch": "@@ -3,18 +3,10 @@ load(\"@npm_bazel_typescript//:index.bzl\", \"ts_library\")\n \n ts_library(\n     name = \"commit-message\",\n-    srcs = [\n-        \"builder.ts\",\n-        \"cli.ts\",\n-        \"commit-message-draft.ts\",\n-        \"config.ts\",\n-        \"parse.ts\",\n-        \"restore-commit-message.ts\",\n-        \"validate.ts\",\n-        \"validate-file.ts\",\n-        \"validate-range.ts\",\n-        \"wizard.ts\",\n-    ],\n+    srcs = glob(\n+        [\"**/*.ts\"],\n+        exclude = [\"**/*.spec.ts\"],\n+    ),\n     module_name = \"@angular/dev-infra-private/commit-message\",\n     visibility = [\"//dev-infra:__subpackages__\"],\n     deps = [\n@@ -32,11 +24,7 @@ ts_library(\n ts_library(\n     name = \"test_lib\",\n     testonly = True,\n-    srcs = [\n-        \"builder.spec.ts\",\n-        \"parse.spec.ts\",\n-        \"validate.spec.ts\",\n-    ],\n+    srcs = glob([\"**/*.spec.ts\"]),\n     deps = [\n         \":commit-message\",\n         \"//dev-infra/utils\","
        },
        {
            "sha": "9230b03d0ce235aa90dee6adbe477ef34e15c33a",
            "filename": "dev-infra/commit-message/cli.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 100,
            "changes": 108,
            "blob_url": "https://github.com/angular/angular/blob/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fcli.ts?ref=d192c87f6aba0c564ed4882712129733e29f1a41",
            "patch": "@@ -6,112 +6,20 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import * as yargs from 'yargs';\n-import {getUserConfig} from '../utils/config';\n \n-import {info} from '../utils/console';\n-\n-import {restoreCommitMessage} from './restore-commit-message';\n-import {validateFile} from './validate-file';\n-import {validateCommitRange} from './validate-range';\n-import {runWizard} from './wizard';\n+import {RestoreCommitMessageModule} from './restore-commit-message/cli';\n+import {ValidateFileModule} from './validate-file/cli';\n+import {ValidateRangeModule} from './validate-range/cli';\n+import {WizardModule} from './wizard/cli';\n \n /** Build the parser for the commit-message commands. */\n export function buildCommitMessageParser(localYargs: yargs.Argv) {\n   return localYargs.help()\n       .strict()\n-      .command(\n-          'restore-commit-message-draft', false,\n-          args => {\n-            return args.option('file-env-variable', {\n-              type: 'string',\n-              array: true,\n-              conflicts: ['file'],\n-              required: true,\n-              description:\n-                  'The key for the environment variable which holds the arguments for the\\n' +\n-                  'prepare-commit-msg hook as described here:\\n' +\n-                  'https://git-scm.com/docs/githooks#_prepare_commit_msg',\n-              coerce: arg => {\n-                const [file, source] = (process.env[arg] || '').split(' ');\n-                if (!file) {\n-                  throw new Error(`Provided environment variable \"${arg}\" was not found.`);\n-                }\n-                return [file, source];\n-              },\n-            });\n-          },\n-          args => {\n-            restoreCommitMessage(args['file-env-variable'][0], args['file-env-variable'][1] as any);\n-          })\n-      .command(\n-          'wizard <filePath> [source] [commitSha]', '', ((args: any) => {\n-            return args\n-                .positional(\n-                    'filePath',\n-                    {description: 'The file path to write the generated commit message into'})\n-                .positional('source', {\n-                  choices: ['message', 'template', 'merge', 'squash', 'commit'],\n-                  description: 'The source of the commit message as described here: ' +\n-                      'https://git-scm.com/docs/githooks#_prepare_commit_msg'\n-                })\n-                .positional(\n-                    'commitSha', {description: 'The commit sha if source is set to `commit`'});\n-          }),\n-          async (args: any) => {\n-            await runWizard(args);\n-          })\n-      .command(\n-          'pre-commit-validate', 'Validate the most recent commit message', {\n-            'file': {\n-              type: 'string',\n-              conflicts: ['file-env-variable'],\n-              description: 'The path of the commit message file.',\n-            },\n-            'file-env-variable': {\n-              type: 'string',\n-              conflicts: ['file'],\n-              description:\n-                  'The key of the environment variable for the path of the commit message file.',\n-              coerce: arg => {\n-                const file = process.env[arg];\n-                if (!file) {\n-                  throw new Error(`Provided environment variable \"${arg}\" was not found.`);\n-                }\n-                return file;\n-              },\n-            },\n-            'error': {\n-              type: 'boolean',\n-              description:\n-                  'Whether invalid commit messages should be treated as failures rather than a warning',\n-              default: !!getUserConfig().commitMessage?.errorOnInvalidMessage || !!process.env['CI']\n-            }\n-          },\n-          args => {\n-            const file = args.file || args['file-env-variable'] || '.git/COMMIT_EDITMSG';\n-            validateFile(file, args.error);\n-          })\n-      .command(\n-          'validate-range', 'Validate a range of commit messages', {\n-            'range': {\n-              description: 'The range of commits to check, e.g. --range abc123..xyz456',\n-              demandOption: '  A range must be provided, e.g. --range abc123..xyz456',\n-              type: 'string',\n-              requiresArg: true,\n-            },\n-          },\n-          argv => {\n-            // If on CI, and not pull request number is provided, assume the branch\n-            // being run on is an upstream branch.\n-            if (process.env['CI'] && process.env['CI_PULL_REQUEST'] === 'false') {\n-              info(`Since valid commit messages are enforced by PR linting on CI, we do not`);\n-              info(`need to validate commit messages on CI runs on upstream branches.`);\n-              info();\n-              info(`Skipping check of provided commit range`);\n-              return;\n-            }\n-            validateCommitRange(argv.range);\n-          });\n+      .command(RestoreCommitMessageModule)\n+      .command(WizardModule)\n+      .command(ValidateFileModule)\n+      .command(ValidateRangeModule);\n }\n \n if (require.main == module) {"
        },
        {
            "sha": "c8a9640e839edca7313635ece7955762b75da3bd",
            "filename": "dev-infra/commit-message/commit-message-source.ts",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fcommit-message-source.ts",
            "raw_url": "https://github.com/angular/angular/raw/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fcommit-message-source.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fcommit-message-source.ts?ref=d192c87f6aba0c564ed4882712129733e29f1a41",
            "patch": "@@ -0,0 +1,13 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+/**\n+ * The source triggering the git commit message creation.\n+ * As described in: https://git-scm.com/docs/githooks#_prepare_commit_msg\n+ */\n+export type CommitMsgSource = 'message'|'template'|'merge'|'squash'|'commit';"
        },
        {
            "sha": "613c59decbd853bd2f12d44cadb3bf1d9475d1df",
            "filename": "dev-infra/commit-message/config.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fconfig.ts?ref=d192c87f6aba0c564ed4882712129733e29f1a41",
            "patch": "@@ -8,6 +8,7 @@\n \n import {assertNoErrors, getConfig, NgDevConfig} from '../utils/config';\n \n+/** Configuration for commit-message comands. */\n export interface CommitMessageConfig {\n   maxLineLength: number;\n   minBodyLength: number;"
        },
        {
            "sha": "828ca1adf90b5eaed9bbb9230f06108943768d35",
            "filename": "dev-infra/commit-message/restore-commit-message/cli.ts",
            "status": "added",
            "additions": 51,
            "deletions": 0,
            "changes": 51,
            "blob_url": "https://github.com/angular/angular/blob/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Frestore-commit-message%2Fcli.ts?ref=d192c87f6aba0c564ed4882712129733e29f1a41",
            "patch": "@@ -0,0 +1,51 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Arguments, Argv, CommandModule} from 'yargs';\n+\n+import {CommitMsgSource} from '../commit-message-source';\n+\n+import {restoreCommitMessage} from './restore-commit-message';\n+\n+export interface RestoreCommitMessageOptions {\n+  fileEnvVariable: string[];\n+}\n+\n+/** Builds the command. */\n+function builder(yargs: Argv) {\n+  return yargs.option('file-env-variable' as 'fileEnvVariable', {\n+    type: 'string',\n+    array: true,\n+    demandOption: true,\n+    description: 'The key for the environment variable which holds the arguments for the\\n' +\n+        'prepare-commit-msg hook as described here:\\n' +\n+        'https://git-scm.com/docs/githooks#_prepare_commit_msg',\n+    coerce: arg => {\n+      const [file, source] = (process.env[arg] || '').split(' ');\n+      if (!file) {\n+        throw new Error(`Provided environment variable \"${arg}\" was not found.`);\n+      }\n+      return [file, source];\n+    },\n+  });\n+}\n+\n+/** Handles the command. */\n+async function handler({fileEnvVariable}: Arguments<RestoreCommitMessageOptions>) {\n+  restoreCommitMessage(fileEnvVariable[0], fileEnvVariable[1] as CommitMsgSource);\n+}\n+\n+/** yargs command module describing the command.  */\n+export const RestoreCommitMessageModule: CommandModule<{}, RestoreCommitMessageOptions> = {\n+  handler,\n+  builder,\n+  command: 'restore-commit-message-draft',\n+  // Description: Restore a commit message draft if one has been saved from a failed commit attempt.\n+  // No describe is defiend to hide the command from the --help.\n+  describe: false,\n+};"
        },
        {
            "sha": "8008728d0bca2bf0537135cbd7a5873ae130caae",
            "filename": "dev-infra/commit-message/restore-commit-message/restore-commit-message.ts",
            "status": "renamed",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Frestore-commit-message%2Frestore-commit-message.ts",
            "raw_url": "https://github.com/angular/angular/raw/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Frestore-commit-message%2Frestore-commit-message.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Frestore-commit-message%2Frestore-commit-message.ts?ref=d192c87f6aba0c564ed4882712129733e29f1a41",
            "patch": "@@ -8,18 +8,18 @@\n \n import {writeFileSync} from 'fs';\n \n-import {debug, log} from '../utils/console';\n+import {debug, log} from '../../utils/console';\n \n-import {loadCommitMessageDraft} from './commit-message-draft';\n+import {loadCommitMessageDraft} from '../commit-message-draft';\n+import {CommitMsgSource} from '../commit-message-source';\n \n /**\n  * Restore the commit message draft to the git to be used as the default commit message.\n  *\n  * The source provided may be one of the sources described in\n  *   https://git-scm.com/docs/githooks#_prepare_commit_msg\n  */\n-export function restoreCommitMessage(\n-    filePath: string, source?: 'message'|'template'|'squash'|'commit') {\n+export function restoreCommitMessage(filePath: string, source?: CommitMsgSource) {\n   if (!!source) {\n     log('Skipping commit message restoration attempt');\n     if (source === 'message') {",
            "previous_filename": "dev-infra/commit-message/restore-commit-message.ts"
        },
        {
            "sha": "602b3145cd5a58f1ac002422ad94d3a950439d01",
            "filename": "dev-infra/commit-message/validate-file/cli.ts",
            "status": "added",
            "additions": 62,
            "deletions": 0,
            "changes": 62,
            "blob_url": "https://github.com/angular/angular/blob/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fvalidate-file%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fvalidate-file%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate-file%2Fcli.ts?ref=d192c87f6aba0c564ed4882712129733e29f1a41",
            "patch": "@@ -0,0 +1,62 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Arguments, Argv, CommandModule} from 'yargs';\n+\n+import {getUserConfig} from '../../utils/config';\n+\n+import {validateFile} from './validate-file';\n+\n+\n+export interface ValidateFileOptions {\n+  file?: string;\n+  fileEnvVariable?: string;\n+  error: boolean;\n+}\n+\n+/** Builds the command. */\n+function builder(yargs: Argv) {\n+  return yargs\n+      .option('file', {\n+        type: 'string',\n+        conflicts: ['file-env-variable'],\n+        description: 'The path of the commit message file.',\n+      })\n+      .option('file-env-variable' as 'fileEnvVariable', {\n+        type: 'string',\n+        conflicts: ['file'],\n+        description: 'The key of the environment variable for the path of the commit message file.',\n+        coerce: (arg: string) => {\n+          const file = process.env[arg];\n+          if (!file) {\n+            throw new Error(`Provided environment variable \"${arg}\" was not found.`);\n+          }\n+          return file;\n+        },\n+      })\n+      .option('error', {\n+        type: 'boolean',\n+        description:\n+            'Whether invalid commit messages should be treated as failures rather than a warning',\n+        default: !!getUserConfig().commitMessage?.errorOnInvalidMessage || !!process.env['CI']\n+      });\n+}\n+\n+/** Handles the command. */\n+async function handler({error, file, fileEnvVariable}: Arguments<ValidateFileOptions>) {\n+  const filePath = file || fileEnvVariable || '.git/COMMIT_EDITMSG';\n+  validateFile(filePath, error);\n+}\n+\n+/** yargs command module describing the command.  */\n+export const ValidateFileModule: CommandModule<{}, ValidateFileOptions> = {\n+  handler,\n+  builder,\n+  command: 'pre-commit-validate',\n+  describe: 'Validate the most recent commit message',\n+};"
        },
        {
            "sha": "459fa52fa95f0c4e492677f77616163dcb1487ad",
            "filename": "dev-infra/commit-message/validate-file/validate-file.ts",
            "status": "renamed",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fvalidate-file%2Fvalidate-file.ts",
            "raw_url": "https://github.com/angular/angular/raw/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fvalidate-file%2Fvalidate-file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate-file%2Fvalidate-file.ts?ref=d192c87f6aba0c564ed4882712129733e29f1a41",
            "patch": "@@ -8,11 +8,11 @@\n import {readFileSync} from 'fs';\n import {resolve} from 'path';\n \n-import {getRepoBaseDir, getUserConfig} from '../utils/config';\n-import {error, green, info, log, red, yellow} from '../utils/console';\n+import {getRepoBaseDir} from '../../utils/config';\n+import {error, green, info, log, red, yellow} from '../../utils/console';\n \n-import {deleteCommitMessageDraft, saveCommitMessageDraft} from './commit-message-draft';\n-import {printValidationErrors, validateCommitMessage} from './validate';\n+import {deleteCommitMessageDraft, saveCommitMessageDraft} from '../commit-message-draft';\n+import {printValidationErrors, validateCommitMessage} from '../validate';\n \n /** Validate commit message at the provided file path. */\n export function validateFile(filePath: string, isErrorMode: boolean) {",
            "previous_filename": "dev-infra/commit-message/validate-file.ts"
        },
        {
            "sha": "6eea3ff95ea02f69eb2e5e8ce11ffdd42712447f",
            "filename": "dev-infra/commit-message/validate-range/cli.ts",
            "status": "added",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/angular/angular/blob/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fvalidate-range%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fvalidate-range%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate-range%2Fcli.ts?ref=d192c87f6aba0c564ed4882712129733e29f1a41",
            "patch": "@@ -0,0 +1,50 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Arguments, Argv, CommandModule} from 'yargs';\n+\n+import {info} from '../../utils/console';\n+\n+import {validateCommitRange} from './validate-range';\n+\n+\n+export interface ValidateRangeOptions {\n+  range: string;\n+}\n+\n+/** Builds the command. */\n+function builder(yargs: Argv) {\n+  return yargs.option('range', {\n+    description: 'The range of commits to check, e.g. --range abc123..xyz456',\n+    demandOption: '  A range must be provided, e.g. --range abc123..xyz456',\n+    type: 'string',\n+    requiresArg: true,\n+  });\n+}\n+\n+/** Handles the command. */\n+async function handler({range}: Arguments<ValidateRangeOptions>) {\n+  // If on CI, and no pull request number is provided, assume the branch\n+  // being run on is an upstream branch.\n+  if (process.env['CI'] && process.env['CI_PULL_REQUEST'] === 'false') {\n+    info(`Since valid commit messages are enforced by PR linting on CI, we do not`);\n+    info(`need to validate commit messages on CI runs on upstream branches.`);\n+    info();\n+    info(`Skipping check of provided commit range`);\n+    return;\n+  }\n+  validateCommitRange(range);\n+}\n+\n+/** yargs command module describing the command.  */\n+export const ValidateRangeModule: CommandModule<{}, ValidateRangeOptions> = {\n+  handler,\n+  builder,\n+  command: 'validate-range',\n+  describe: 'Validate a range of commit messages',\n+};"
        },
        {
            "sha": "3c3825775f0294a383bd57d214881306dd7825f8",
            "filename": "dev-infra/commit-message/validate-range/validate-range.ts",
            "status": "renamed",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fvalidate-range%2Fvalidate-range.ts",
            "raw_url": "https://github.com/angular/angular/raw/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fvalidate-range%2Fvalidate-range.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate-range%2Fvalidate-range.ts?ref=d192c87f6aba0c564ed4882712129733e29f1a41",
            "patch": "@@ -5,11 +5,11 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {error, info} from '../utils/console';\n-import {exec} from '../utils/shelljs';\n+import {error, info} from '../../utils/console';\n+import {exec} from '../../utils/shelljs';\n \n-import {parseCommitMessage} from './parse';\n-import {printValidationErrors, validateCommitMessage, ValidateCommitMessageOptions} from './validate';\n+import {parseCommitMessage} from '../parse';\n+import {printValidationErrors, validateCommitMessage, ValidateCommitMessageOptions} from '../validate';\n \n // Whether the provided commit is a fixup commit.\n const isNonFixup = (m: string) => !parseCommitMessage(m).isFixup;",
            "previous_filename": "dev-infra/commit-message/validate-range.ts"
        },
        {
            "sha": "b4cc94cfa69f48e37964b13582d70dfceeccb822",
            "filename": "dev-infra/commit-message/wizard/cli.ts",
            "status": "added",
            "additions": 54,
            "deletions": 0,
            "changes": 54,
            "blob_url": "https://github.com/angular/angular/blob/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fwizard%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fwizard%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fwizard%2Fcli.ts?ref=d192c87f6aba0c564ed4882712129733e29f1a41",
            "patch": "@@ -0,0 +1,54 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Arguments, Argv, CommandModule} from 'yargs';\n+\n+import {CommitMsgSource} from '../commit-message-source';\n+\n+import {runWizard} from './wizard';\n+\n+\n+export interface WizardOptions {\n+  filePath: string;\n+  commitSha: string|undefined;\n+  source: CommitMsgSource|undefined;\n+}\n+\n+/** Builds the command. */\n+function builder(yargs: Argv) {\n+  return yargs\n+      .positional('filePath', {\n+        description: 'The file path to write the generated commit message into',\n+        type: 'string',\n+        demandOption: true,\n+      })\n+      .positional('source', {\n+        choices: ['message', 'template', 'merge', 'squash', 'commit'] as const,\n+        description: 'The source of the commit message as described here: ' +\n+            'https://git-scm.com/docs/githooks#_prepare_commit_msg'\n+      })\n+      .positional('commitSha', {\n+        description: 'The commit sha if source is set to `commit`',\n+        type: 'string',\n+      });\n+}\n+\n+/** Handles the command. */\n+async function handler(args: Arguments<WizardOptions>) {\n+  await runWizard(args);\n+}\n+\n+/** yargs command module describing the command.  */\n+export const WizardModule: CommandModule<{}, WizardOptions> = {\n+  handler,\n+  builder,\n+  command: 'wizard <filePath> [source] [commitSha]',\n+  // Description: Run the wizard to build a base commit message before opening to complete.\n+  // No describe is defiend to hide the command from the --help.\n+  describe: false,\n+};"
        },
        {
            "sha": "40623fed10250ace4033aa67c1a7cdde549b3a3a",
            "filename": "dev-infra/commit-message/wizard/wizard.ts",
            "status": "renamed",
            "additions": 5,
            "deletions": 9,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fwizard%2Fwizard.ts",
            "raw_url": "https://github.com/angular/angular/raw/d192c87f6aba0c564ed4882712129733e29f1a41/dev-infra%2Fcommit-message%2Fwizard%2Fwizard.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fwizard%2Fwizard.ts?ref=d192c87f6aba0c564ed4882712129733e29f1a41",
            "patch": "@@ -7,16 +7,12 @@\n  */\n import {writeFileSync} from 'fs';\n \n-import {getUserConfig} from '../utils/config';\n-import {debug, info} from '../utils/console';\n+import {getUserConfig} from '../../utils/config';\n+import {debug, info} from '../../utils/console';\n \n-import {buildCommitMessage} from './builder';\n+import {buildCommitMessage} from '../builder';\n+import {CommitMsgSource} from '../commit-message-source';\n \n-/**\n- * The source triggering the git commit message creation.\n- * As described in: https://git-scm.com/docs/githooks#_prepare_commit_msg\n- */\n-export type PrepareCommitMsgHookSource = 'message'|'template'|'merge'|'squash'|'commit';\n \n /** The default commit message used if the wizard does not procude a commit message. */\n const defaultCommitMessage = `<type>(<scope>): <summary>\n@@ -25,7 +21,7 @@ const defaultCommitMessage = `<type>(<scope>): <summary>\n #  lines at 100 characters.>\\n\\n`;\n \n export async function runWizard(\n-    args: {filePath: string, source?: PrepareCommitMsgHookSource, commitSha?: string}) {\n+    args: {filePath: string, source?: CommitMsgSource, commitSha?: string}) {\n   if (getUserConfig().commitMessage?.disableWizard) {\n     debug('Skipping commit message wizard due to enabled `commitMessage.disableWizard` option in');\n     debug('user config.');",
            "previous_filename": "dev-infra/commit-message/wizard.ts"
        }
    ],
    "stats": {
        "total": 399,
        "additions": 261,
        "deletions": 138
    }
}