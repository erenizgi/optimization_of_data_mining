{
    "author": "gkalpak",
    "message": "fix(docs-infra): avoid prepending version info to error messages twice (#43767)\n\nPreviously, we used to prepend version info to error messages by\nupdating their `message` property and their `stack` property. However,\ndue to the fact that on some browsers `error.stack` is lazily computed\nbased on `error.message` the first time the `stack` property is\naccessed, this resulted in prepending the version info twice.\n\nThis commit ensures that the version info is only prepended to\n`error.stack` once to avoid unnecessary repetition in error messages.\n\nPR Close #43767",
    "sha": "300230c25505e097dc6a8bbfebcea787fbaaca1c",
    "files": [
        {
            "sha": "b4142525a13ce2f301704f4f3348f051ddc62f88",
            "filename": "aio/src/app/shared/reporting-error-handler.spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/300230c25505e097dc6a8bbfebcea787fbaaca1c/aio%2Fsrc%2Fapp%2Fshared%2Freporting-error-handler.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/300230c25505e097dc6a8bbfebcea787fbaaca1c/aio%2Fsrc%2Fapp%2Fshared%2Freporting-error-handler.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fshared%2Freporting-error-handler.spec.ts?ref=300230c25505e097dc6a8bbfebcea787fbaaca1c",
            "patch": "@@ -55,15 +55,19 @@ describe('ReportingErrorHandler service', () => {\n       const error = new Error(originalMessage);\n \n       expect(error.message).toBe(originalMessage);\n-      if (error.stack) {\n-        expect(error.stack).toContain(originalMessage);\n-      }\n+      // NOTE:\n+      // Intentionally not checking `error.stack` here, because accessing it causes the property to\n+      // be computed and may affect the observed behavior of `handleError()`.\n \n       handler.handleError(error);\n \n       expect(error.message).toBe(`[v${VERSION.full}] ${originalMessage}`);\n       if (error.stack) {\n-        expect(error.stack).toContain(`[v${VERSION.full}] ${originalMessage}`);\n+        const expected = `Error: [v${VERSION.full}] ${originalMessage}`;\n+        const actual = error.stack.split('\\n', 1)[0];\n+        expect(actual.startsWith(expected))\n+            .withContext(`Expected '${actual}' to start with '${expected}'.`)\n+            .toBeTrue();\n       }\n     });\n "
        },
        {
            "sha": "e3566534db7e661794cc289c8064ea9521e802c5",
            "filename": "aio/src/app/shared/reporting-error-handler.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/300230c25505e097dc6a8bbfebcea787fbaaca1c/aio%2Fsrc%2Fapp%2Fshared%2Freporting-error-handler.ts",
            "raw_url": "https://github.com/angular/angular/raw/300230c25505e097dc6a8bbfebcea787fbaaca1c/aio%2Fsrc%2Fapp%2Fshared%2Freporting-error-handler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fshared%2Freporting-error-handler.ts?ref=300230c25505e097dc6a8bbfebcea787fbaaca1c",
            "patch": "@@ -34,8 +34,10 @@ export class ReportingErrorHandler extends ErrorHandler {\n \n     if (error instanceof Error) {\n       const oldMessage = error.message;\n+      const oldStack = error.stack;\n+\n       error.message = prefix + oldMessage;\n-      error.stack = error.stack?.replace(oldMessage, error.message);\n+      error.stack = oldStack?.replace(oldMessage, error.message);\n     } else if (typeof error === 'string') {\n       error = prefix + error as unknown as T;\n     }"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 11,
        "deletions": 5
    }
}