{
    "author": "mhevery",
    "message": "refactor(core): Use `~x` instead of `-x` which can result in `-0` (#39233)\n\n`expandoInstructions` uses negative numbers by `-x`. This has lead to\nissues in the paste as `-0` is processed as float rather than integer\nleading to de-optimization.\n\nPR Close #39233",
    "sha": "2c31533f0a62348d4922d2a9517d2969e7d52b90",
    "files": [
        {
            "sha": "9a3d22a6804bbf8ce5fbfb839a527f214e023de7",
            "filename": "packages/core/src/render3/instructions/shared.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 10,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/2c31533f0a62348d4922d2a9517d2969e7d52b90/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "raw_url": "https://github.com/angular/angular/raw/2c31533f0a62348d4922d2a9517d2969e7d52b90/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts?ref=2c31533f0a62348d4922d2a9517d2969e7d52b90",
            "patch": "@@ -79,12 +79,7 @@ export function setHostBindingsByExecutingExpandoInstructions(tView: TView, lVie\n           if (instruction <= 0) {\n             // Negative numbers mean that we are starting new EXPANDO block and need to update\n             // the current element and directive index.\n-            // Important: In JS `-x` and `0-x` is not the same! If `x===0` then `-x` will produce\n-            // `-0` which requires non standard math arithmetic and it can prevent VM optimizations.\n-            // `0-0` will always produce `0` and will not cause a potential deoptimization in VM.\n-            // TODO(misko): PERF This should be refactored to use `~instruction` as that does not\n-            // suffer from `-0` and it is faster/more compact.\n-            currentElementIndex = 0 - instruction;\n+            currentElementIndex = ~instruction;\n             setSelectedIndex(currentElementIndex);\n \n             // Injector block and providers are taken into account.\n@@ -1373,10 +1368,7 @@ export function generateExpandoInstructionBlock(\n           tView.firstCreatePass, true,\n           'Expando block should only be generated on first create pass.');\n \n-  // Important: In JS `-x` and `0-x` is not the same! If `x===0` then `-x` will produce `-0` which\n-  // requires non standard math arithmetic and it can prevent VM optimizations.\n-  // `0-0` will always produce `0` and will not cause a potential deoptimization in VM.\n-  const elementIndex = 0 - tNode.index;\n+  const elementIndex = ~tNode.index;\n   const providerStartIndex = tNode.providerIndexes & TNodeProviderIndexes.ProvidersStartIndexMask;\n   const providerCount = tView.data.length - providerStartIndex;\n   (tView.expandoInstructions || (tView.expandoInstructions = []))"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 2,
        "deletions": 10
    }
}