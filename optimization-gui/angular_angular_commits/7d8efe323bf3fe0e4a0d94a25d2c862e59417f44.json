{
    "author": "petebacondarwin",
    "message": "test(ngcc): provide correct source-mappings for renderer tests (#41434)\n\nThe recent update to MagicString, results in a different basic set of\nmappings in the renderer. This change updates our tests to match.\n\nPR Close #41434",
    "sha": "7d8efe323bf3fe0e4a0d94a25d2c862e59417f44",
    "files": [
        {
            "sha": "b369880b554f46e386251cf4391762ae1f361121",
            "filename": "packages/compiler-cli/ngcc/test/rendering/renderer_spec.ts",
            "status": "modified",
            "additions": 77,
            "deletions": 10,
            "changes": 87,
            "blob_url": "https://github.com/angular/angular/blob/7d8efe323bf3fe0e4a0d94a25d2c862e59417f44/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Frenderer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7d8efe323bf3fe0e4a0d94a25d2c862e59417f44/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Frenderer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Frenderer_spec.ts?ref=7d8efe323bf3fe0e4a0d94a25d2c862e59417f44",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import {Statement} from '@angular/compiler';\n-import {fromObject, generateMapFileComment, SourceMapConverter} from 'convert-source-map';\n+import {fromObject, fromSource, generateMapFileComment, SourceMapConverter} from 'convert-source-map';\n import MagicString from 'magic-string';\n import {encode, SourceMapMappings} from 'sourcemap-codec';\n import * as ts from 'typescript';\n@@ -201,19 +201,84 @@ runInEachFileSystem(() => {\n         'file': 'file.js',\n         'sources': ['file.js'],\n         'names': [],\n-        'mappings': encode([[], [], [], [], [], [], [], [], [], [], [], [], [[0, 0, 0, 0]]]),\n+        'mappings': encode([\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [[0, 0, 0, 0]],\n+          [[0, 0, 1, 0]],\n+          [[0, 0, 2, 0]],\n+          [[0, 0, 3, 0]],\n+          [[0, 0, 4, 0]],\n+          [[0, 0, 5, 0]],\n+          [[0, 0, 6, 0]],\n+          [[0, 0, 7, 0]],\n+          [[0, 0, 8, 0]]\n+        ]),\n         'sourcesContent': [JS_CONTENT.contents],\n       });\n \n-      const MERGED_OUTPUT_PROGRAM_MAPPINGS: SourceMapMappings =\n-          [[], [], [], [], [], [], [], [], [], [], [], [], ...JS_CONTENT_MAPPINGS];\n-\n       MERGED_OUTPUT_PROGRAM_MAP = fromObject({\n         'version': 3,\n         'file': 'file.js',\n         'sources': ['file.ts'],\n         'names': [],\n-        'mappings': encode(MERGED_OUTPUT_PROGRAM_MAPPINGS),\n+        'mappings': encode([\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [],\n+          [\n+            [0, 0, 0, 0], [7, 0, 0, 7], [9, 0, 0, 8], [18, 0, 0, 17], [20, 0, 0, 18],\n+            [26, 0, 0, 24], [41, 0, 0, 39], [42, 0, 0, 40]\n+          ],\n+          [\n+            [0, 0, 2, 0], [4, 0, 2, 13], [5, 0, 2, 14], [8, 0, 2, 0], [14, 0, 2, 13], [15, 0, 2, 14]\n+          ],\n+          [[0, 0, 2, 16], [4, 0, 3, 2], [7, 0, 3, 5], [8, 0, 3, 6], [9, 0, 3, 15]],\n+          [\n+            [0, 0, 3, 27], [7, 0, 3, 34], [8, 0, 3, 35], [9, 0, 3, 36], [10, 0, 3, 37],\n+            [11, 0, 3, 38], [1, 0, 4, 1], [2, 0, 4, 1]\n+          ],\n+          [[0, 0, 2, 13], [1, 0, 2, 14]],\n+          [[0, 0, 3, 3]],\n+          [\n+            [0, 0, 3, 5], [2, 0, 1, 1], [11, 0, 1, 10], [12, 0, 1, 11], [14, 0, 1, 12],\n+            [3, 0, 2, 13], [4, 0, 2, 14], [5, 0, 4, 1]\n+          ],\n+          [\n+            [0, 0, 4, 13], [5, 0, 1, 20], [7, 0, 1, 22], [12, 0, 1, 27], [14, 0, 1, 28],\n+            [15, 0, 1, 29], [9, 0, 2, 13], [10, 0, 2, 14]\n+          ],\n+          [[0, 0, 4, 2]],\n+          [],\n+          [\n+            [0, 0, 0, 2], [0, 0, 0, 2], [0, 0, 0, 2], [0, 0, 0, 2], [0, 0, 0, 2], [0, 0, 0, 2],\n+            [0, 0, 0, 2], [0, 0, 0, 2], [0, 0, 2, 2], [0, 0, 2, 2], [0, 0, 2, 2], [0, 0, 2, 2],\n+            [0, 0, 2, 2], [0, 0, 2, 2], [0, 0, 3, 2], [0, 0, 3, 2], [0, 0, 3, 2], [0, 0, 3, 2],\n+            [0, 0, 3, 2], [0, 0, 3, 2], [0, 0, 3, 2], [0, 0, 3, 2], [0, 0, 3, 2], [0, 0, 3, 2],\n+            [0, 0, 4, 2], [0, 0, 4, 2], [0, 0, 2, 2], [0, 0, 2, 2], [0, 0, 1, 2], [0, 0, 1, 2],\n+            [0, 0, 1, 2], [0, 0, 1, 2], [0, 0, 2, 2], [0, 0, 2, 2], [0, 0, 4, 2], [0, 0, 1, 2],\n+            [0, 0, 1, 2], [0, 0, 1, 2], [0, 0, 1, 2], [0, 0, 1, 2], [0, 0, 2, 2], [0, 0, 2, 2]\n+          ],\n+        ]),\n         'sourcesContent': [TS_CONTENT.contents],\n       });\n     });\n@@ -226,8 +291,9 @@ runInEachFileSystem(() => {\n            const [sourceFile, mapFile] = renderer.renderProgram(\n                decorationAnalyses, switchMarkerAnalyses, privateDeclarationsAnalyses);\n            expect(sourceFile.path).toEqual(_('/node_modules/test-package/src/file.js'));\n-           expect(sourceFile.contents)\n-               .toEqual(RENDERED_CONTENTS + '\\n' + OUTPUT_PROGRAM_MAP.toComment());\n+           expect(sourceFile.contents).toContain(RENDERED_CONTENTS);\n+           expect(fromSource(sourceFile.contents)!.toObject())\n+               .toEqual(OUTPUT_PROGRAM_MAP.toObject());\n            expect(mapFile).toBeUndefined();\n          });\n \n@@ -616,8 +682,9 @@ UndecoratedBase.ɵdir = /*@__PURE__*/ ɵngcc0.ɵɵdefineDirective({ type: Undeco\n              const [sourceFile, mapFile] = renderer.renderProgram(\n                  decorationAnalyses, switchMarkerAnalyses, privateDeclarationsAnalyses);\n              expect(sourceFile.path).toEqual(_('/node_modules/test-package/src/file.js'));\n-             expect(sourceFile.contents)\n-                 .toEqual(RENDERED_CONTENTS + '\\n' + MERGED_OUTPUT_PROGRAM_MAP.toComment());\n+             expect(sourceFile.contents).toContain(RENDERED_CONTENTS);\n+             expect(fromSource(sourceFile.contents)!.toObject())\n+                 .toEqual(MERGED_OUTPUT_PROGRAM_MAP.toObject());\n              expect(mapFile).toBeUndefined();\n            });\n "
        }
    ],
    "stats": {
        "total": 87,
        "additions": 77,
        "deletions": 10
    }
}