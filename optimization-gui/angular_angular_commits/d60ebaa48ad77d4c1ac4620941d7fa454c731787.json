{
    "author": "devversion",
    "message": "test: update example di tests to work with es2015 (#44505)\n\n* `forwardRef` does not work with ES2015 and TypeScript's decorator\n  downlevel emit. This is a known limitation we work around in Angular\n  applications by either compiling tests with the Angular compiler, or\n  by running a custom decorator downlevel transform (like in the CLI).\n\nPR Close #44505",
    "sha": "d60ebaa48ad77d4c1ac4620941d7fa454c731787",
    "files": [
        {
            "sha": "6cf6617bd6468f1b7e66d4e38eea2357f9b1f5b3",
            "filename": "packages/examples/core/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/d60ebaa48ad77d4c1ac4620941d7fa454c731787/packages%2Fexamples%2Fcore%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/d60ebaa48ad77d4c1ac4620941d7fa454c731787/packages%2Fexamples%2Fcore%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fexamples%2Fcore%2FBUILD.bazel?ref=d60ebaa48ad77d4c1ac4620941d7fa454c731787",
            "patch": "@@ -81,5 +81,6 @@ jasmine_node_test(\n     bootstrap = [\"//tools/testing:node_es2015\"],\n     deps = [\n         \":core_tests_lib\",\n+        \"//packages/examples/core/di/ts/forward_ref:forward_ref_tests_lib\",\n     ],\n )"
        },
        {
            "sha": "3ea1c0f6d66cc394e281eb16b546b72ee8912bd2",
            "filename": "packages/examples/core/di/ts/forward_ref/BUILD.bazel",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/d60ebaa48ad77d4c1ac4620941d7fa454c731787/packages%2Fexamples%2Fcore%2Fdi%2Fts%2Fforward_ref%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/d60ebaa48ad77d4c1ac4620941d7fa454c731787/packages%2Fexamples%2Fcore%2Fdi%2Fts%2Fforward_ref%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fexamples%2Fcore%2Fdi%2Fts%2Fforward_ref%2FBUILD.bazel?ref=d60ebaa48ad77d4c1ac4620941d7fa454c731787",
            "patch": "@@ -0,0 +1,15 @@\n+load(\"//tools:defaults.bzl\", \"ng_module\")\n+\n+# Note: The `forward_ref` example tests are built through this `ng_module` sub-target.\n+# This is done so that DI decorator/type metadata is processed manually by the compiler\n+# ahead of time. We cannot rely on the official TypeScript decorator downlevel emit (for JIT),\n+# as the output is not compatible with `forwardRef` and ES2015+. More details here:\n+# https://github.com/angular/angular/commit/323651bd38909b0f4226bcb6c8f5abafa91cf9d9.\n+# https://github.com/microsoft/TypeScript/issues/27519.\n+ng_module(\n+    name = \"forward_ref_tests_lib\",\n+    testonly = True,\n+    srcs = [\"forward_ref_spec.ts\"],\n+    visibility = [\"//packages/examples/core:__pkg__\"],\n+    deps = [\"//packages/core\"],\n+)"
        },
        {
            "sha": "3d887a3a28f18c04680207dbaebd6290da17e911",
            "filename": "packages/examples/core/di/ts/forward_ref/forward_ref_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/d60ebaa48ad77d4c1ac4620941d7fa454c731787/packages%2Fexamples%2Fcore%2Fdi%2Fts%2Fforward_ref%2Fforward_ref_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d60ebaa48ad77d4c1ac4620941d7fa454c731787/packages%2Fexamples%2Fcore%2Fdi%2Fts%2Fforward_ref%2Fforward_ref_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fexamples%2Fcore%2Fdi%2Fts%2Fforward_ref%2Fforward_ref_spec.ts?ref=d60ebaa48ad77d4c1ac4620941d7fa454c731787",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {forwardRef, Inject, Injector, resolveForwardRef} from '@angular/core';\n+import {forwardRef, Inject, Injectable, Injector, resolveForwardRef} from '@angular/core';\n \n {\n   describe('forwardRef examples', () => {\n@@ -21,6 +21,7 @@ import {forwardRef, Inject, Injector, resolveForwardRef} from '@angular/core';\n \n     it('can be used to inject a class defined later', () => {\n       // #docregion forward_ref\n+      @Injectable()\n       class Door {\n         lock: Lock;\n "
        },
        {
            "sha": "0db25a8b8437bc02d4c6af217abefa5e602a9f19",
            "filename": "packages/examples/core/ts/metadata/lifecycle_hooks_spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d60ebaa48ad77d4c1ac4620941d7fa454c731787/packages%2Fexamples%2Fcore%2Fts%2Fmetadata%2Flifecycle_hooks_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d60ebaa48ad77d4c1ac4620941d7fa454c731787/packages%2Fexamples%2Fcore%2Fts%2Fmetadata%2Flifecycle_hooks_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fexamples%2Fcore%2Fts%2Fmetadata%2Flifecycle_hooks_spec.ts?ref=d60ebaa48ad77d4c1ac4620941d7fa454c731787",
            "patch": "@@ -132,7 +132,6 @@ function createAndLogComponent(clazz: Type<any>, inputs: string[] = []): any[] {\n   class ParentComponent {\n   }\n \n-\n   const fixture = TestBed.configureTestingModule({declarations: [ParentComponent, clazz]})\n                       .createComponent(ParentComponent);\n   fixture.detectChanges();\n@@ -142,7 +141,12 @@ function createAndLogComponent(clazz: Type<any>, inputs: string[] = []): any[] {\n \n function createLoggingSpiesFromProto(clazz: Type<any>, log: any[]) {\n   const proto = clazz.prototype;\n-  Object.keys(proto).forEach((method) => {\n+  // For ES2015+ classes, members are not enumerable in the prototype.\n+  Object.getOwnPropertyNames(proto).forEach((method) => {\n+    if (method === 'constructor') {\n+      return;\n+    }\n+\n     proto[method] = (...args: any[]) => {\n       log.push([method, args]);\n     };"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 24,
        "deletions": 3
    }
}