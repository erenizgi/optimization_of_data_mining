{
    "author": "gkalpak",
    "message": "feat(platform-server): allow shimming the global env sooner (#40559)\n\n`@angular/platform-server` provides the foundation for rendering an\nAngular app on the server. In order to achieve that, it uses a\nserver-side DOM implementation (currently [domino][1]).\n\nFor rendering on the server to work as closely as possible to running\nthe app on the browser, we need to make DOM globals (such as `Element`,\n`HTMLElement`, etc.), which are normally provided by the browser,\navailable as globals on the server as well.\n\nCurrently, `@angular/platform-server` achieves this by extending the\n`global` object with the DOM implementation provided by `domino`. This\nassignment happens in the [setDomTypes()][2] function, which is\n[called in a `PLATFORM_INITIALIZER`][3]. While this works in most cases,\nthere are some scenarios where the DOM globals are needed sooner (i.e.\nbefore initializing the platform). See, for example, #24551 and #39950\nfor more details on such issues.\n\nThis commit provides a way to solve this problem by exposing a\nside-effect-ful entry-point (`@angular/platform-server/init`), that\nshims the `global` object with DOM globals. People will be able to\nimport this entry-point in their server-rendered apps before\nbootstrapping the app (for example, in their `main.server.ts` file).\n(See also [#39950 (comment)][4].)\n\nIn a future update, the [`universal` schematics][5] will include such an\nimport by default in newly generated projects.\n\n[1]: https://www.npmjs.com/package/domino\n[2]: https://github.com/angular/angular/blob/0fc8466f1be392917e0c/packages/platform-server/src/domino_adapter.ts#L17-L21\n[3]: https://github.com/angular/angular/blob/0fc8466f1be392917e0c/packages/platform-server/src/server.ts#L33\n[4]: https://github.com/angular/angular/issues/39950#issuecomment-747598403\n[5]: https://github.com/angular/angular-cli/blob/cc51432661eb4ab4b6a3/packages/schematics/angular/universal\n\nPR Close #40559",
    "sha": "43ecf8a77bc7e92d3c635b450de904732e938e64",
    "files": [
        {
            "sha": "555ecd0645ca4bf74eb856f27b499204756a7510",
            "filename": "aio/tools/transforms/angular-api-package/index.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/aio%2Ftools%2Ftransforms%2Fangular-api-package%2Findex.js",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/aio%2Ftools%2Ftransforms%2Fangular-api-package%2Findex.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fangular-api-package%2Findex.js?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -107,6 +107,7 @@ module.exports =\n             'platform-browser-dynamic/index.ts',\n             'platform-browser-dynamic/testing/index.ts',\n             'platform-server/index.ts',\n+            'platform-server/init/index.ts',\n             'platform-server/testing/index.ts',\n             'platform-webworker/index.ts',\n             'platform-webworker-dynamic/index.ts',"
        },
        {
            "sha": "a7d42bd10331db877b3927648b4d2eb75e998b23",
            "filename": "aio/tools/transforms/authors-package/api-package.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/aio%2Ftools%2Ftransforms%2Fauthors-package%2Fapi-package.js",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/aio%2Ftools%2Ftransforms%2Fauthors-package%2Fapi-package.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fauthors-package%2Fapi-package.js?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -18,7 +18,7 @@ const packageMap = {\n   forms: ['forms/index.ts'],\n   'platform-browser': ['platform-browser/index.ts', 'platform-browser/animations/index.ts', 'platform-browser/testing/index.ts'],\n   'platform-browser-dynamic': ['platform-browser-dynamic/index.ts', 'platform-browser-dynamic/testing/index.ts'],\n-  'platform-server': ['platform-server/index.ts', 'platform-server/testing/index.ts'],\n+  'platform-server': ['platform-server/index.ts', 'platform-server/init/index.ts', 'platform-server/testing/index.ts'],\n   router: ['router/index.ts', 'router/testing/index.ts', 'router/upgrade/index.ts'],\n   'service-worker': ['service-worker/index.ts'],\n   upgrade: ['upgrade/index.ts', 'upgrade/static/index.ts', 'upgrade/static/testing/index.ts']"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "goldens/public-api/platform-server/init/init.d.ts",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/goldens%2Fpublic-api%2Fplatform-server%2Finit%2Finit.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/goldens%2Fpublic-api%2Fplatform-server%2Finit%2Finit.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fplatform-server%2Finit%2Finit.d.ts?ref=43ecf8a77bc7e92d3c635b450de904732e938e64"
        },
        {
            "sha": "cb15695aa9c99060b1ddd21142efb05fc8269148",
            "filename": "integration/cli-elements-universal/src/main.server.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/integration%2Fcli-elements-universal%2Fsrc%2Fmain.server.ts",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/integration%2Fcli-elements-universal%2Fsrc%2Fmain.server.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fcli-elements-universal%2Fsrc%2Fmain.server.ts?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -1,3 +1,4 @@\n+import '@angular/platform-server/init';\n import { enableProdMode } from '@angular/core';\n \n import { environment } from './environments/environment';"
        },
        {
            "sha": "86b57f2789d8ddb54e8f6dd666bc1b823a799bad",
            "filename": "integration/typings_test_ts40/include-all.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/integration%2Ftypings_test_ts40%2Finclude-all.ts",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/integration%2Ftypings_test_ts40%2Finclude-all.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Ftypings_test_ts40%2Finclude-all.ts?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -27,6 +27,7 @@ import * as platformBrowserDynamicTesting from '@angular/platform-browser-dynami\n import * as platformBrowserAnimations from '@angular/platform-browser/animations';\n import * as platformBrowserTesting from '@angular/platform-browser/testing';\n import * as platformServer from '@angular/platform-server';\n+import * as platformServerInit from '@angular/platform-server/init';\n import * as platformServerTesting from '@angular/platform-server/testing';\n import * as router from '@angular/router';\n import * as routerTesting from '@angular/router/testing';\n@@ -56,6 +57,7 @@ export default {\n   platformBrowserDynamicTesting,\n   platformBrowserAnimations,\n   platformServer,\n+  platformServerInit,\n   platformServerTesting,\n   router,\n   routerTesting,"
        },
        {
            "sha": "86b57f2789d8ddb54e8f6dd666bc1b823a799bad",
            "filename": "integration/typings_test_ts41/include-all.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/integration%2Ftypings_test_ts41%2Finclude-all.ts",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/integration%2Ftypings_test_ts41%2Finclude-all.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Ftypings_test_ts41%2Finclude-all.ts?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -27,6 +27,7 @@ import * as platformBrowserDynamicTesting from '@angular/platform-browser-dynami\n import * as platformBrowserAnimations from '@angular/platform-browser/animations';\n import * as platformBrowserTesting from '@angular/platform-browser/testing';\n import * as platformServer from '@angular/platform-server';\n+import * as platformServerInit from '@angular/platform-server/init';\n import * as platformServerTesting from '@angular/platform-server/testing';\n import * as router from '@angular/router';\n import * as routerTesting from '@angular/router/testing';\n@@ -56,6 +57,7 @@ export default {\n   platformBrowserDynamicTesting,\n   platformBrowserAnimations,\n   platformServer,\n+  platformServerInit,\n   platformServerTesting,\n   router,\n   routerTesting,"
        },
        {
            "sha": "a73c0666409b555241301648d0c60edc0628ac41",
            "filename": "packages/bazel/src/ng_package/ng_package.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fbazel%2Fsrc%2Fng_package%2Fng_package.bzl",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fbazel%2Fsrc%2Fng_package%2Fng_package.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fsrc%2Fng_package%2Fng_package.bzl?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -105,6 +105,7 @@ WELL_KNOWN_GLOBALS = {p: _global_name(p) for p in [\n     \"@angular/forms\",\n     \"@angular/core/testing\",\n     \"@angular/core\",\n+    \"@angular/platform-server/init\",\n     \"@angular/platform-server/testing\",\n     \"@angular/platform-server\",\n     \"@angular/common/testing\","
        },
        {
            "sha": "eade038378ed7a0ede0863fb108abf89aa40e0fc",
            "filename": "packages/platform-server/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2FBUILD.bazel?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -30,6 +30,7 @@ ng_package(\n     name = \"npm_package\",\n     srcs = [\n         \"package.json\",\n+        \"//packages/platform-server/init:package.json\",\n         \"//packages/platform-server/testing:package.json\",\n     ],\n     entry_point = \":index.ts\",\n@@ -44,6 +45,7 @@ ng_package(\n     ],\n     deps = [\n         \":platform-server\",\n+        \"//packages/platform-server/init\",\n         \"//packages/platform-server/testing\",\n     ],\n )"
        },
        {
            "sha": "a3dcc6c6670c2f8fe9f50cba2274effbfbab1760",
            "filename": "packages/platform-server/init/BUILD.bazel",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Finit%2FBUILD.bazel?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -0,0 +1,18 @@\n+load(\"//tools:defaults.bzl\", \"ng_module\")\n+\n+package(default_visibility = [\"//visibility:public\"])\n+\n+exports_files([\"package.json\"])\n+\n+ng_module(\n+    name = \"init\",\n+    srcs = glob(\n+        [\n+            \"*.ts\",\n+            \"src/**/*.ts\",\n+        ],\n+    ),\n+    deps = [\n+        \"//packages/platform-server\",\n+    ],\n+)"
        },
        {
            "sha": "e503f53f091d0d633dc49b9adba79e79fbd8921a",
            "filename": "packages/platform-server/init/PACKAGE.md",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2FPACKAGE.md",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2FPACKAGE.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Finit%2FPACKAGE.md?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -0,0 +1,15 @@\n+Initializes the server environment for rendering an Angular application.\n+\n+For example, it provides shims (such as DOM globals) for the server environment.\n+\n+The initialization happens as a [side effect of importing](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import#import_a_module_for_its_side_effects_only) the entry point (i.e. there are no specific exports):\n+\n+```ts\n+import '@angular/platform-server/init';\n+```\n+\n+<div class=\"alert is-important\">\n+\n+  The import must come before any imports (direct or transitive) that rely on DOM built-ins being available.\n+\n+</div>"
        },
        {
            "sha": "1f364dbd8818935e5e9d5901077323ce33a3bbb7",
            "filename": "packages/platform-server/init/index.ts",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Finit%2Findex.ts?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -0,0 +1,14 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+// This file is not used to build this module. It is only used during editing\n+// by the TypeScript language service and during build for verifcation. `ngc`\n+// replaces this file with production index.ts when it rewrites private symbol\n+// names.\n+\n+export * from './public_api';"
        },
        {
            "sha": "55674a97d9388b1c27742568b38f923aef5661ce",
            "filename": "packages/platform-server/init/package.json",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Finit%2Fpackage.json?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -0,0 +1,4 @@\n+{\n+  \"name\": \"@angular/platform-server/init\",\n+  \"sideEffects\": true\n+}"
        },
        {
            "sha": "51cfd93d5a2d17fddd5f7a415dd72d47455f4095",
            "filename": "packages/platform-server/init/public_api.ts",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Fpublic_api.ts",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Fpublic_api.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Finit%2Fpublic_api.ts?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -0,0 +1,14 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+/**\n+ * @module\n+ * @description\n+ * Entry point for all public APIs of this package.\n+ */\n+export * from './src/init';"
        },
        {
            "sha": "9005b790738d3c895faf9e1838a3d26efd188b38",
            "filename": "packages/platform-server/init/src/init.ts",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Fsrc%2Finit.ts",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Fsrc%2Finit.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Finit%2Fsrc%2Finit.ts?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -0,0 +1,17 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+/**\n+ * @module\n+ * @description\n+ * Entry point for all initialization APIs of the platform-server package.\n+ */\n+\n+import {applyShims} from './shims';\n+\n+applyShims();"
        },
        {
            "sha": "3440e360ace5a7e6a5f37e57290aae8c950981d9",
            "filename": "packages/platform-server/init/src/shims.ts",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Fsrc%2Fshims.ts",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Fsrc%2Fshims.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Finit%2Fsrc%2Fshims.ts?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -0,0 +1,16 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {setDomTypes} from '../../src/domino_adapter';\n+\n+/**\n+ * Apply the necessary shims to make DOM globals (such as `Element`, `HTMLElement`, etc.) available\n+ * on the environment.\n+ */\n+export function applyShims(): void {\n+  setDomTypes();\n+}"
        },
        {
            "sha": "aeee41bd844d7fb5571b14906d84a0fc8a339e4c",
            "filename": "packages/platform-server/init/test/BUILD.bazel",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Finit%2Ftest%2FBUILD.bazel?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -0,0 +1,25 @@\n+load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n+load(\"//tools/circular_dependency_test:index.bzl\", \"circular_dependency_test\")\n+\n+circular_dependency_test(\n+    name = \"circular_deps_test\",\n+    entry_point = \"angular/packages/platform-server/init/index.js\",\n+    deps = [\"//packages/platform-server/init\"],\n+)\n+\n+ts_library(\n+    name = \"test_lib\",\n+    testonly = True,\n+    srcs = glob([\"**/*.ts\"]),\n+    deps = [\n+        \"//packages/platform-server/init\",\n+    ],\n+)\n+\n+jasmine_node_test(\n+    name = \"test\",\n+    bootstrap = [\"//tools/testing:node_no_angular_es5\"],\n+    deps = [\n+        \":test_lib\",\n+    ],\n+)"
        },
        {
            "sha": "3bc8b90d22e02aa086cabd12327a0fec5aee5603",
            "filename": "packages/platform-server/init/test/shims_spec.ts",
            "status": "added",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Ftest%2Fshims_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Finit%2Ftest%2Fshims_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Finit%2Ftest%2Fshims_spec.ts?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -0,0 +1,41 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {applyShims} from '../src/shims';\n+\n+describe('applyShims()', () => {\n+  if (isBrowser) return;  // NODE only\n+\n+  const domino = require('domino');\n+  const globalClone = {...global};\n+\n+  afterEach(() => {\n+    // Un-patch `global`.\n+    const currentProps = Object.keys(global) as (keyof NodeJS.Global)[];\n+    for (const prop of currentProps) {\n+      if (globalClone.hasOwnProperty(prop)) {\n+        (global as any)[prop] = globalClone[prop];\n+      } else {\n+        delete (global as any)[prop];\n+      }\n+    }\n+  });\n+\n+  it('should load `domino.impl` onto `global`', () => {\n+    expect(global).not.toEqual(jasmine.objectContaining(domino.impl));\n+\n+    applyShims();\n+    expect(global).toEqual(jasmine.objectContaining(domino.impl));\n+  });\n+\n+  it('should define `KeyboardEvent` on `global`', () => {\n+    expect((global as any).KeyboardEvent).not.toBe((domino.impl as any).Event);\n+\n+    applyShims();\n+    expect((global as any).KeyboardEvent).toBe((domino.impl as any).Event);\n+  });\n+});"
        },
        {
            "sha": "e6e0eda4b006f048482f728c7e4ed408c5767166",
            "filename": "packages/platform-server/package.json",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Fpackage.json?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -25,7 +25,15 @@\n   \"ng-update\": {\n     \"packageGroup\": \"NG_UPDATE_PACKAGE_GROUP\"\n   },\n-  \"sideEffects\": false,\n+  \"sideEffects\": [\n+    \"./bundles/platform-server-init.umd.js\",\n+    \"./bundles/platform-server-init.umd.min.js\",\n+    \"./esm2015/init/src/init.js\",\n+    \"./fesm2015/init.js\",\n+    \"./__ivy_ngcc__/bundles/platform-server-init.umd.js\",\n+    \"./__ivy_ngcc__/esm2015/init/src/init.js\",\n+    \"./__ivy_ngcc__/fesm2015/init.js\"\n+  ],\n   \"engines\": {\n     \"node\": \">=8.0\"\n   },"
        },
        {
            "sha": "54256a2c195b021646eb367e71d6185ede55fcfe",
            "filename": "packages/platform-server/src/domino_adapter.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Fsrc%2Fdomino_adapter.ts",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/packages%2Fplatform-server%2Fsrc%2Fdomino_adapter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Fsrc%2Fdomino_adapter.ts?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -14,8 +14,8 @@ function _notImplemented(methodName: string) {\n   return new Error('This method is not implemented in DominoAdapter: ' + methodName);\n }\n \n-function setDomTypes() {\n-  // Make all Domino types available as types in the global env.\n+export function setDomTypes() {\n+  // Make all Domino types available in the global env.\n   Object.assign(global, domino.impl);\n   (global as any)['KeyboardEvent'] = domino.impl.Event;\n }"
        },
        {
            "sha": "b935f6bf39db243e2a28a2b1568331befbd8b22a",
            "filename": "test-main.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/43ecf8a77bc7e92d3c635b450de904732e938e64/test-main.js",
            "raw_url": "https://github.com/angular/angular/raw/43ecf8a77bc7e92d3c635b450de904732e938e64/test-main.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/test-main.js?ref=43ecf8a77bc7e92d3c635b450de904732e938e64",
            "patch": "@@ -27,7 +27,7 @@ System.config({\n     'domino': 'dist/all/@angular/empty.js',\n     'url': 'dist/all/@angular/empty.js',\n     'xhr2': 'dist/all/@angular/empty.js',\n-    '@angular/platform-server/src/domino_adapter': 'dist/all/empty.js',\n+    '@angular/platform-server/src/domino_adapter': 'dist/all/@angular/empty.js',\n     'angular-in-memory-web-api': 'dist/all/@angular/misc/angular-in-memory-web-api',\n     'rxjs': 'node_modules/rxjs',\n   },\n@@ -64,6 +64,7 @@ System.config({\n     '@angular/platform-browser': {main: 'index.js', defaultExtension: 'js'},\n     '@angular/platform-browser-dynamic/testing': {main: 'index.js', defaultExtension: 'js'},\n     '@angular/platform-browser-dynamic': {main: 'index.js', defaultExtension: 'js'},\n+    '@angular/platform-server/init': {main: 'index.js', defaultExtension: 'js'},\n     '@angular/platform-server/testing': {main: 'index.js', defaultExtension: 'js'},\n     '@angular/platform-server': {main: 'index.js', defaultExtension: 'js'},\n     '@angular/private/testing': {main: 'index.js', defaultExtension: 'js'},"
        }
    ],
    "stats": {
        "total": 192,
        "additions": 187,
        "deletions": 5
    }
}