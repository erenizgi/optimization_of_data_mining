{
    "author": "josephperrott",
    "message": "fix(dev-infra): wait for changelog to cherry pick to next branch (#40605)\n\nWait for the cherry-picked changelog to be merged into the next\nbranch before completing the task.\n\nPR Close #40605",
    "sha": "dceede4f809b45e52bc348ca9e00b66f04f10431",
    "files": [
        {
            "sha": "3f2e24082c03dadbf384e9a86c9db1c261c42097",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/dceede4f809b45e52bc348ca9e00b66f04f10431/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/dceede4f809b45e52bc348ca9e00b66f04f10431/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=dceede4f809b45e52bc348ca9e00b66f04f10431",
            "patch": "@@ -5885,11 +5885,13 @@ class ReleaseAction {\n                 return false;\n             }\n             // Create a cherry-pick pull request that should be merged by the caretaker.\n-            const { url } = yield this.pushChangesToForkAndCreatePullRequest(nextBranch, `changelog-cherry-pick-${newVersion}`, commitMessage, `Cherry-picks the changelog from the \"${stagingBranch}\" branch to the next ` +\n+            const { url, id } = yield this.pushChangesToForkAndCreatePullRequest(nextBranch, `changelog-cherry-pick-${newVersion}`, commitMessage, `Cherry-picks the changelog from the \"${stagingBranch}\" branch to the next ` +\n                 `branch (${nextBranch}).`);\n             info(green(`  ✓   Pull request for cherry-picking the changelog into \"${nextBranch}\" ` +\n                 'has been created.'));\n             info(yellow(`      Please ask team members to review: ${url}.`));\n+            // Wait for the Pull Request to be merged.\n+            yield this.waitForPullRequestToBeMerged(id);\n             return true;\n         });\n     }"
        },
        {
            "sha": "72d907026f549743cac02bc27614fedd187304b9",
            "filename": "dev-infra/release/publish/actions.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/dceede4f809b45e52bc348ca9e00b66f04f10431/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "raw_url": "https://github.com/angular/angular/raw/dceede4f809b45e52bc348ca9e00b66f04f10431/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions.ts?ref=dceede4f809b45e52bc348ca9e00b66f04f10431",
            "patch": "@@ -450,7 +450,7 @@ export abstract class ReleaseAction {\n     }\n \n     // Create a cherry-pick pull request that should be merged by the caretaker.\n-    const {url} = await this.pushChangesToForkAndCreatePullRequest(\n+    const {url, id} = await this.pushChangesToForkAndCreatePullRequest(\n         nextBranch, `changelog-cherry-pick-${newVersion}`, commitMessage,\n         `Cherry-picks the changelog from the \"${stagingBranch}\" branch to the next ` +\n             `branch (${nextBranch}).`);\n@@ -459,6 +459,10 @@ export abstract class ReleaseAction {\n         `  ✓   Pull request for cherry-picking the changelog into \"${nextBranch}\" ` +\n         'has been created.'));\n     info(yellow(`      Please ask team members to review: ${url}.`));\n+\n+    // Wait for the Pull Request to be merged.\n+    await this.waitForPullRequestToBeMerged(id);\n+\n     return true;\n   }\n "
        },
        {
            "sha": "998238109aa11f40c650df259a0ed1abf0597dab",
            "filename": "dev-infra/release/publish/test/common.spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/dceede4f809b45e52bc348ca9e00b66f04f10431/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcommon.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/dceede4f809b45e52bc348ca9e00b66f04f10431/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcommon.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Fcommon.spec.ts?ref=dceede4f809b45e52bc348ca9e00b66f04f10431",
            "patch": "@@ -93,7 +93,8 @@ describe('common release action logic', () => {\n       // it is properly appended. Also expect a pull request to be created in the fork.\n       repo.expectChangelogFetch(branchName, fakeReleaseNotes)\n           .expectFindForkRequest(fork)\n-          .expectPullRequestToBeCreated('master', fork, forkBranchName, 200);\n+          .expectPullRequestToBeCreated('master', fork, forkBranchName, 200)\n+          .expectPullRequestWait(200);\n \n       // Simulate that the fork branch name is available.\n       fork.expectBranchRequest(forkBranchName, null);\n@@ -119,7 +120,8 @@ describe('common release action logic', () => {\n       // it is properly appended. Also expect a pull request to be created in the fork.\n       repo.expectChangelogFetch(branchName, customReleaseNotes)\n           .expectFindForkRequest(fork)\n-          .expectPullRequestToBeCreated('master', fork, forkBranchName, 200);\n+          .expectPullRequestToBeCreated('master', fork, forkBranchName, 200)\n+          .expectPullRequestWait(200);\n \n       // Simulate that the fork branch name is available.\n       fork.expectBranchRequest(forkBranchName, null);\n@@ -138,7 +140,8 @@ describe('common release action logic', () => {\n       // it is properly appended. Also expect a pull request to be created in the fork.\n       repo.expectChangelogFetch(branchName, `non analyzable changelog`)\n           .expectFindForkRequest(fork)\n-          .expectPullRequestToBeCreated('master', fork, forkBranchName, 200);\n+          .expectPullRequestToBeCreated('master', fork, forkBranchName, 200)\n+          .expectPullRequestWait(200);\n \n       // Simulate that the fork branch name is available.\n       fork.expectBranchRequest(forkBranchName, null);\n@@ -166,7 +169,8 @@ describe('common release action logic', () => {\n       // it is properly appended. Also expect a pull request to be created in the fork.\n       repo.expectChangelogFetch(branchName, fakeReleaseNotes)\n           .expectFindForkRequest(fork)\n-          .expectPullRequestToBeCreated('master', fork, forkBranchName, 200);\n+          .expectPullRequestToBeCreated('master', fork, forkBranchName, 200)\n+          .expectPullRequestWait(200);\n \n       // Simulate that the fork branch name is available.\n       fork.expectBranchRequest(forkBranchName, null);"
        },
        {
            "sha": "0fb32a970d28f4f96c5ea2d41c7ff79e8e337645",
            "filename": "dev-infra/release/publish/test/test-utils.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/dceede4f809b45e52bc348ca9e00b66f04f10431/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftest-utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/dceede4f809b45e52bc348ca9e00b66f04f10431/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftest-utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Ftest%2Ftest-utils.ts?ref=dceede4f809b45e52bc348ca9e00b66f04f10431",
            "patch": "@@ -194,7 +194,8 @@ export async function expectStagingAndPublishWithCherryPick(\n       .expectTagToBeCreated(expectedTagName, 'STAGING_COMMIT_SHA')\n       .expectReleaseToBeCreated(`v${expectedVersion}`, expectedTagName)\n       .expectChangelogFetch(expectedBranch, getChangelogForVersion(expectedVersion))\n-      .expectPullRequestToBeCreated('master', fork, expectedCherryPickForkBranch, 300);\n+      .expectPullRequestToBeCreated('master', fork, expectedCherryPickForkBranch, 300)\n+      .expectPullRequestWait(300);\n \n   // In the fork, we make the staging and cherry-pick branches appear as\n   // non-existent, so that the PRs can be created properly without collisions."
        }
    ],
    "stats": {
        "total": 25,
        "additions": 18,
        "deletions": 7
    }
}