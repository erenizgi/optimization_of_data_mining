{
    "author": "mgechev",
    "message": "feat(devtools): merge frames in the range",
    "sha": "3d9ac47d127946dce478b7bb11b5586fcef3ece3",
    "files": [
        {
            "sha": "f0c294e8dcef2fcc0a294ccf714d6dd2715bdc04",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/record-formatter/record-formatter.ts",
            "status": "modified",
            "additions": 55,
            "deletions": 1,
            "changes": 56,
            "blob_url": "https://github.com/angular/angular/blob/3d9ac47d127946dce478b7bb11b5586fcef3ece3/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Frecord-formatter%2Frecord-formatter.ts",
            "raw_url": "https://github.com/angular/angular/raw/3d9ac47d127946dce478b7bb11b5586fcef3ece3/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Frecord-formatter%2Frecord-formatter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Frecord-formatter%2Frecord-formatter.ts?ref=3d9ac47d127946dce478b7bb11b5586fcef3ece3",
            "patch": "@@ -1,4 +1,4 @@\n-import { ElementProfile, DirectiveProfile, ProfilerFrame } from 'protocol';\n+import { ElementProfile, DirectiveProfile, ProfilerFrame, ElementPosition } from 'protocol';\n \n export interface TimelineView<T> {\n   timeline: AppEntry<T>[];\n@@ -52,3 +52,57 @@ export abstract class RecordFormatter<T> {\n     return result;\n   }\n }\n+\n+const mergeProperty = (mergeInProp: number | undefined, value: number | undefined) => {\n+  if (mergeInProp === undefined) {\n+    return value;\n+  }\n+  if (value === undefined) {\n+    return mergeInProp;\n+  }\n+  return mergeInProp + value;\n+};\n+\n+const mergeDirective = (mergeIn: DirectiveProfile, second: DirectiveProfile) => {\n+  mergeIn.changeDetection = mergeProperty(mergeIn.changeDetection, second.changeDetection);\n+  Object.keys(mergeIn.lifecycle).forEach((hook) => {\n+    mergeIn.lifecycle[hook] = mergeProperty(mergeIn.lifecycle[hook], second.lifecycle[hook]);\n+  });\n+};\n+\n+const mergeDirectives = (mergeIn: ElementProfile[], second: ElementProfile[]) => {\n+  for (let i = 0; i < second.length; i++) {\n+    if (!mergeIn[i]) {\n+      mergeIn[i] = {\n+        children: [],\n+        directives: [],\n+      };\n+    }\n+    second[i].directives.forEach((d, idx) => {\n+      const mergeInDirective = mergeIn[i].directives[idx];\n+      if (mergeInDirective && mergeInDirective.name === d.name) {\n+        mergeDirective(mergeInDirective, d);\n+      } else {\n+        mergeIn[i].directives.push(d);\n+      }\n+    });\n+    mergeDirectives(mergeIn[i].children, second[i].children);\n+  }\n+};\n+\n+const mergeFrame = (mergeIn: ProfilerFrame, second: ProfilerFrame) => {\n+  mergeIn.duration += second.duration;\n+  mergeIn.source = '';\n+  mergeDirectives(mergeIn.directives, second.directives);\n+};\n+\n+export const mergeFrames = (frames: ProfilerFrame[]): ProfilerFrame | null => {\n+  if (!frames || !frames.length) {\n+    return null;\n+  }\n+  const first = JSON.parse(JSON.stringify(frames[0]));\n+  for (let i = 1; i < frames.length; i++) {\n+    mergeFrame(first, frames[i]);\n+  }\n+  return first;\n+};"
        },
        {
            "sha": "d60cfb0fe424b7123ebe6b99e085bb9b06ddada2",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/timeline.component.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/3d9ac47d127946dce478b7bb11b5586fcef3ece3/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.html",
            "raw_url": "https://github.com/angular/angular/raw/3d9ac47d127946dce478b7bb11b5586fcef3ece3/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.html?ref=3d9ac47d127946dce478b7bb11b5586fcef3ece3",
            "patch": "@@ -20,7 +20,7 @@\n   <ng-frame-selector\n     [class.hidden]=\"!hasFrames\"\n     (move)=\"move($event)\"\n-    (selectFrame)=\"selectFrame($event)\"\n+    (selectFrames)=\"selectFrames($event)\"\n     [graphData$]=\"graphData$\"\n     [startFrame]=\"startFrame\"\n     [endFrame]=\"endFrame\""
        },
        {
            "sha": "998f17506685a0f67c9cd67d1558b234948a3285",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/timeline.component.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/3d9ac47d127946dce478b7bb11b5586fcef3ece3/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/3d9ac47d127946dce478b7bb11b5586fcef3ece3/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.ts?ref=3d9ac47d127946dce478b7bb11b5586fcef3ece3",
            "patch": "@@ -1,6 +1,6 @@\n import { Component, EventEmitter, Input, Output, OnDestroy } from '@angular/core';\n import { ProfilerFrame } from 'protocol';\n-import { GraphNode } from './record-formatter/record-formatter';\n+import { GraphNode, mergeFrames } from './record-formatter/record-formatter';\n import { Observable, Subscription, BehaviorSubject } from 'rxjs';\n import { share } from 'rxjs/operators';\n \n@@ -39,6 +39,7 @@ export class TimelineComponent implements OnDestroy {\n   startFrame = -1;\n   endFrame = -1;\n   changeDetection = false;\n+  frame: ProfilerFrame | null = null;\n \n   private _maxDuration = -Infinity;\n   private _subscription: Subscription;\n@@ -51,10 +52,6 @@ export class TimelineComponent implements OnDestroy {\n     return this._allRecords.length > 0;\n   }\n \n-  get frame(): ProfilerFrame {\n-    return this._allRecords[this.startFrame];\n-  }\n-\n   estimateFrameRate(timeSpent: number): number {\n     const multiplier = Math.max(Math.ceil(timeSpent / 16) - 1, 0);\n     return Math.floor(60 / 2 ** multiplier);\n@@ -63,12 +60,14 @@ export class TimelineComponent implements OnDestroy {\n   move(value: number): void {\n     const newVal = this.startFrame + value;\n     if (newVal > -1 && newVal < this._allRecords.length) {\n-      this.selectFrame(newVal);\n+      this.selectFrames({ start: newVal, end: newVal });\n     }\n   }\n \n-  selectFrame(index: number): void {\n-    this.startFrame = this.endFrame = index;\n+  selectFrames(range: { start: number; end: number }): void {\n+    this.startFrame = range.start;\n+    this.endFrame = range.end;\n+    this.frame = mergeFrames(this._allRecords.slice(range.start, range.end + 1));\n   }\n \n   getColorByFrameRate(framerate: number): string {"
        }
    ],
    "stats": {
        "total": 73,
        "additions": 63,
        "deletions": 10
    }
}