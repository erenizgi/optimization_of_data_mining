{
    "author": "devversion",
    "message": "fix(dev-infra): breaking change and deprecation notes incorrectly picked up (#42436)\n\nIf a commit message currently mentions the breaking change or\ndeprecation note keywords, the commit message parse logic\naccidentally picks up the note. This could then accidentally\nprevent the commit from being merged (e.g. if the commit targets\nthe patch branch but mentioned the `BREAKING CHANGE: ` marker).\n\nThis commit switches the commit message notes pattern to only\ncapture notes at the beginning of a line (also allowing accidental\nwhitespace). This matches with the format we describe in our\ncontribution guide, as well as with our commit message validation\nlogic that also assumes notes at the beginning of a line.\n\nPR Close #42436",
    "sha": "d3531a7d415f2e90278edfceadafae6a819d08a2",
    "files": [
        {
            "sha": "e7f6924fa6d77fdcb9e7f1279922ab91af13736c",
            "filename": "dev-infra/commit-message/parse.spec.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/d3531a7d415f2e90278edfceadafae6a819d08a2/dev-infra%2Fcommit-message%2Fparse.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d3531a7d415f2e90278edfceadafae6a819d08a2/dev-infra%2Fcommit-message%2Fparse.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fparse.spec.ts?ref=d3531a7d415f2e90278edfceadafae6a819d08a2",
            "patch": "@@ -135,6 +135,15 @@ describe('commit message parsing:', () => {\n       expect(parsedMessage.breakingChanges[0].text).toBe(`${summary}\\n\\n${description}`);\n       expect(parsedMessage.breakingChanges.length).toBe(1);\n     });\n+\n+    it('only when keyword is at the beginning of a line', () => {\n+      const message = buildCommitMessage({\n+        body: 'This changes how the `BREAKING CHANGE: ` commit message note\\n' +\n+            'keyword is detected for the changelog.',\n+      });\n+      const parsedMessage = parseCommitMessage(message);\n+      expect(parsedMessage.breakingChanges.length).toBe(0);\n+    });\n   });\n \n   describe('parses deprecation notes', () => {\n@@ -168,5 +177,14 @@ describe('commit message parsing:', () => {\n       expect(parsedMessage.deprecations[0].text).toBe(`${summary}\\n\\n${description}`);\n       expect(parsedMessage.deprecations.length).toBe(1);\n     });\n+\n+    it('only when keyword is at the beginning of a line', () => {\n+      const message = buildCommitMessage({\n+        body: 'This changes how the `DEPRECATED: ` commit message note\\n' +\n+            'keyword is detected for the changelog.',\n+      });\n+      const parsedMessage = parseCommitMessage(message);\n+      expect(parsedMessage.deprecations.length).toBe(0);\n+    });\n   });\n });"
        },
        {
            "sha": "0cebcc891365e123280df8c156bc5ce3af3aa387",
            "filename": "dev-infra/commit-message/parse.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d3531a7d415f2e90278edfceadafae6a819d08a2/dev-infra%2Fcommit-message%2Fparse.ts",
            "raw_url": "https://github.com/angular/angular/raw/d3531a7d415f2e90278edfceadafae6a819d08a2/dev-infra%2Fcommit-message%2Fparse.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fparse.ts?ref=d3531a7d415f2e90278edfceadafae6a819d08a2",
            "patch": "@@ -111,7 +111,7 @@ const parseOptions: Options&{notesPattern: (keywords: string) => RegExp} = {\n   headerPattern,\n   headerCorrespondence,\n   noteKeywords: [NoteSections.BREAKING_CHANGE, NoteSections.DEPRECATED],\n-  notesPattern: (keywords: string) => new RegExp(`(${keywords}): ?(.*)`),\n+  notesPattern: (keywords: string) => new RegExp(`^\\s*(${keywords}): ?(.*)`),\n };\n \n /** Parse a commit message into its composite parts. */"
        },
        {
            "sha": "dc1c8e5ddf504bfab8ea39983bfd1c2a4a151a0f",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d3531a7d415f2e90278edfceadafae6a819d08a2/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/d3531a7d415f2e90278edfceadafae6a819d08a2/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=d3531a7d415f2e90278edfceadafae6a819d08a2",
            "patch": "@@ -1843,7 +1843,7 @@ const parseOptions = {\n     headerPattern,\n     headerCorrespondence,\n     noteKeywords: [NoteSections.BREAKING_CHANGE, NoteSections.DEPRECATED],\n-    notesPattern: (keywords) => new RegExp(`(${keywords}): ?(.*)`),\n+    notesPattern: (keywords) => new RegExp(`^\\s*(${keywords}): ?(.*)`),\n };\n /** Parse a commit message into its composite parts. */\n const parseCommitMessage = parseInternal;"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 20,
        "deletions": 2
    }
}