{
    "author": "literalpie",
    "message": "test(compiler-cli): add integration test for relative rootDir (#41359)\n\nthis will make it easier to detect regressions of the relative rootDir behavior\n\nPR Close #41359",
    "sha": "42e3a5241db462539087ca7686c6aef758ce6eb5",
    "files": [
        {
            "sha": "baad8f32867a19e19e03a0ca88ddff91279c325d",
            "filename": "packages/compiler-cli/test/ngtsc/env.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 5,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/42e3a5241db462539087ca7686c6aef758ce6eb5/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fenv.ts",
            "raw_url": "https://github.com/angular/angular/raw/42e3a5241db462539087ca7686c6aef758ce6eb5/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fenv.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fenv.ts?ref=42e3a5241db462539087ca7686c6aef758ce6eb5",
            "patch": "@@ -30,6 +30,7 @@ export class NgtscTestEnvironment {\n   private multiCompileHostExt: MultiCompileHostExt|null = null;\n   private oldProgram: Program|null = null;\n   private changedResources: Set<string>|null = null;\n+  private commandLineArgs = ['-p', this.basePath];\n \n   private constructor(\n       private fs: FileSystem, readonly outDir: AbsoluteFsPath, readonly basePath: AbsoluteFsPath) {}\n@@ -114,6 +115,10 @@ export class NgtscTestEnvironment {\n     setWrapHostForTest(makeWrapHost(new ResourceLoadingCompileHost(this.fs)));\n   }\n \n+  addCommandLineArgs(...args: string[]): void {\n+    this.commandLineArgs.push(...args);\n+  }\n+\n   flushWrittenFileTracking(): void {\n     if (this.multiCompileHostExt === null) {\n       throw new Error(`Not tracking written files - call enableMultipleCompilations()`);\n@@ -214,7 +219,7 @@ export class NgtscTestEnvironment {\n       };\n     }\n     const exitCode = main(\n-        ['-p', this.basePath], errorSpy, undefined, customTransformers, reuseProgram,\n+        this.commandLineArgs, errorSpy, undefined, customTransformers, reuseProgram,\n         this.changedResources);\n     expect(errorSpy).not.toHaveBeenCalled();\n     expect(exitCode).toBe(0);\n@@ -236,7 +241,7 @@ export class NgtscTestEnvironment {\n     }\n \n     const diags = mainDiagnosticsForTest(\n-        ['-p', this.basePath], undefined, reuseProgram, this.changedResources);\n+        this.commandLineArgs, undefined, reuseProgram, this.changedResources);\n \n \n     if (this.multiCompileHostExt !== null) {\n@@ -248,7 +253,7 @@ export class NgtscTestEnvironment {\n   }\n \n   async driveDiagnosticsAsync(): Promise<ReadonlyArray<ts.Diagnostic>> {\n-    const {rootNames, options} = readNgcCommandLineAndConfiguration(['-p', this.basePath]);\n+    const {rootNames, options} = readNgcCommandLineAndConfiguration(this.commandLineArgs);\n     const host = createCompilerHost({options});\n     const program = createProgram({rootNames, host, options});\n     await program.loadNgStructureAsync();\n@@ -258,14 +263,14 @@ export class NgtscTestEnvironment {\n   }\n \n   driveRoutes(entryPoint?: string): LazyRoute[] {\n-    const {rootNames, options} = readNgcCommandLineAndConfiguration(['-p', this.basePath]);\n+    const {rootNames, options} = readNgcCommandLineAndConfiguration(this.commandLineArgs);\n     const host = createCompilerHost({options});\n     const program = createProgram({rootNames, host, options});\n     return program.listLazyRoutes(entryPoint);\n   }\n \n   driveIndexer(): Map<DeclarationNode, IndexedComponent> {\n-    const {rootNames, options} = readNgcCommandLineAndConfiguration(['-p', this.basePath]);\n+    const {rootNames, options} = readNgcCommandLineAndConfiguration(this.commandLineArgs);\n     const host = createCompilerHost({options});\n     const program = createProgram({rootNames, host, options});\n     return (program as NgtscProgram).getIndexedComponents();"
        },
        {
            "sha": "ae696115d88d5eb062da24fa0ed9f77f063c6cc7",
            "filename": "packages/compiler-cli/test/ngtsc/ngtsc_spec.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/42e3a5241db462539087ca7686c6aef758ce6eb5/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/42e3a5241db462539087ca7686c6aef758ce6eb5/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts?ref=42e3a5241db462539087ca7686c6aef758ce6eb5",
            "patch": "@@ -54,6 +54,25 @@ function allTests(os: string) {\n       env.tsconfig();\n     });\n \n+    it('should accept relative file paths as command line argument', () => {\n+      env.addCommandLineArgs('--rootDir', './rootDir');\n+      env.write('rootDir/test.html', '<p>Hello World</p>');\n+      env.write('rootDir/test.ts', `\n+        import {Component} from '@angular/core';\n+\n+        @Component({\n+          selector: 'test-cmp',\n+          templateUrl: 'test.html',\n+        })\n+        export class TestCmp {}\n+    `);\n+\n+      env.driveMain();\n+\n+      const jsContents = env.getContents('test.js');\n+      expect(jsContents).toContain('Hello World');\n+    });\n+\n     it('should compile Injectables without errors', () => {\n       env.write('test.ts', `\n         import {Injectable} from '@angular/core';"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 29,
        "deletions": 5
    }
}