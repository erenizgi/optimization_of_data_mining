{
    "author": "bjarkler",
    "message": "feat(core): allow returning Trusted Types from SanitizerFn (#39218)\n\nSanitizers in Angular currently return strings, which will then\neventually make their way down to the DOM, e.g. as the value of an\nattribute or property. This may cause a Trusted Types violation. As a\nstep towards fixing that, make it possible to return Trusted Types from\nthe SanitizerFn interface, which represents the internal sanitization\npipeline. DOM renderer interfaces are also updated to reflect the fact\nthat setAttribute and setAttributeNS must be able to accept Trusted\nTypes.\n\nPR Close #39218",
    "sha": "e8d47c2d41ede1bf2f0392a0196f09e1858e2276",
    "files": [
        {
            "sha": "7f3b6400902d2c492a994cc2c818f44d990e1762",
            "filename": "packages/core/src/render3/interfaces/renderer.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/e8d47c2d41ede1bf2f0392a0196f09e1858e2276/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Frenderer.ts",
            "raw_url": "https://github.com/angular/angular/raw/e8d47c2d41ede1bf2f0392a0196f09e1858e2276/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Frenderer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Frenderer.ts?ref=e8d47c2d41ede1bf2f0392a0196f09e1858e2276",
            "patch": "@@ -16,6 +16,7 @@\n  */\n \n import {RendererStyleFlags2, RendererType2} from '../../render/api';\n+import {TrustedHTML, TrustedScript, TrustedScriptURL} from '../../util/security/trusted_type_defs';\n import {getDocument} from './document';\n \n // TODO: cleanup once the code is merged in angular/angular\n@@ -80,7 +81,9 @@ export interface ProceduralRenderer3 {\n   parentNode(node: RNode): RElement|null;\n   nextSibling(node: RNode): RNode|null;\n \n-  setAttribute(el: RElement, name: string, value: string, namespace?: string|null): void;\n+  setAttribute(\n+      el: RElement, name: string, value: string|TrustedHTML|TrustedScript|TrustedScriptURL,\n+      namespace?: string|null): void;\n   removeAttribute(el: RElement, name: string, namespace?: string|null): void;\n   addClass(el: RElement, name: string): void;\n   removeClass(el: RElement, name: string): void;\n@@ -157,9 +160,11 @@ export interface RElement extends RNode {\n   classList: RDomTokenList;\n   className: string;\n   textContent: string|null;\n-  setAttribute(name: string, value: string): void;\n+  setAttribute(name: string, value: string|TrustedHTML|TrustedScript|TrustedScriptURL): void;\n   removeAttribute(name: string): void;\n-  setAttributeNS(namespaceURI: string, qualifiedName: string, value: string): void;\n+  setAttributeNS(\n+      namespaceURI: string, qualifiedName: string,\n+      value: string|TrustedHTML|TrustedScript|TrustedScriptURL): void;\n   addEventListener(type: string, listener: EventListener, useCapture?: boolean): void;\n   removeEventListener(type: string, listener?: EventListener, options?: boolean): void;\n "
        },
        {
            "sha": "3ebbb7c35affd030a2c82adf37b82e18d0057579",
            "filename": "packages/core/src/render3/interfaces/sanitization.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/e8d47c2d41ede1bf2f0392a0196f09e1858e2276/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fsanitization.ts",
            "raw_url": "https://github.com/angular/angular/raw/e8d47c2d41ede1bf2f0392a0196f09e1858e2276/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fsanitization.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fsanitization.ts?ref=e8d47c2d41ede1bf2f0392a0196f09e1858e2276",
            "patch": "@@ -6,7 +6,10 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {TrustedHTML, TrustedScript, TrustedScriptURL} from '../../util/security/trusted_type_defs';\n+\n /**\n  * Function used to sanitize the value before writing it into the renderer.\n  */\n-export type SanitizerFn = (value: any, tagName?: string, propName?: string) => string;\n+export type SanitizerFn = (value: any, tagName?: string, propName?: string) =>\n+    string|TrustedHTML|TrustedScript|TrustedScriptURL;"
        },
        {
            "sha": "2be379e4683a7ac9e88219d21a7da6ec8bdb5913",
            "filename": "packages/core/src/sanitization/sanitization.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/e8d47c2d41ede1bf2f0392a0196f09e1858e2276/packages%2Fcore%2Fsrc%2Fsanitization%2Fsanitization.ts",
            "raw_url": "https://github.com/angular/angular/raw/e8d47c2d41ede1bf2f0392a0196f09e1858e2276/packages%2Fcore%2Fsrc%2Fsanitization%2Fsanitization.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fsanitization%2Fsanitization.ts?ref=e8d47c2d41ede1bf2f0392a0196f09e1858e2276",
            "patch": "@@ -36,7 +36,7 @@ import {_sanitizeUrl as _sanitizeUrl} from './url_sanitizer';\n  *\n  * @codeGenApi\n  */\n-export function ɵɵsanitizeHtml(unsafeHtml: any): string {\n+export function ɵɵsanitizeHtml(unsafeHtml: any): TrustedHTML|string {\n   const sanitizer = getSanitizer();\n   if (sanitizer) {\n     return sanitizer.sanitize(SecurityContext.HTML, unsafeHtml) || '';\n@@ -107,7 +107,7 @@ export function ɵɵsanitizeUrl(unsafeUrl: any): string {\n  *\n  * @codeGenApi\n  */\n-export function ɵɵsanitizeResourceUrl(unsafeResourceUrl: any): string {\n+export function ɵɵsanitizeResourceUrl(unsafeResourceUrl: any): TrustedScriptURL|string {\n   const sanitizer = getSanitizer();\n   if (sanitizer) {\n     return sanitizer.sanitize(SecurityContext.RESOURCE_URL, unsafeResourceUrl) || '';\n@@ -130,7 +130,7 @@ export function ɵɵsanitizeResourceUrl(unsafeResourceUrl: any): string {\n  *\n  * @codeGenApi\n  */\n-export function ɵɵsanitizeScript(unsafeScript: any): string {\n+export function ɵɵsanitizeScript(unsafeScript: any): TrustedScript|string {\n   const sanitizer = getSanitizer();\n   if (sanitizer) {\n     return sanitizer.sanitize(SecurityContext.SCRIPT, unsafeScript) || '';"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 15,
        "deletions": 7
    }
}