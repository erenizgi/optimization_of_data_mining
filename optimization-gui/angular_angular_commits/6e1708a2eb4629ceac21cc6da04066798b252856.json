{
    "author": "bjarkler",
    "message": "test(core): make ivy-trusted-types similar to other integration tests (#39614)\n\n- @angular dependencies point to ../../dist\n- use absolute versions for other dependencies\n- add a yarn.lock\n- create ci-specific targets\n- make karma and protractor use correct Chrome binary\n\nPR Close #39614",
    "sha": "6e1708a2eb4629ceac21cc6da04066798b252856",
    "files": [
        {
            "sha": "03b880b5e1a2b1a4670ab6fd11a2f11c74327055",
            "filename": "integration/ivy-trusted-types/angular.json",
            "status": "modified",
            "additions": 20,
            "deletions": 3,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/6e1708a2eb4629ceac21cc6da04066798b252856/integration%2Fivy-trusted-types%2Fangular.json",
            "raw_url": "https://github.com/angular/angular/raw/6e1708a2eb4629ceac21cc6da04066798b252856/integration%2Fivy-trusted-types%2Fangular.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fivy-trusted-types%2Fangular.json?ref=6e1708a2eb4629ceac21cc6da04066798b252856",
            "patch": "@@ -30,7 +30,8 @@\n             \"styles\": [\n               \"src/styles.css\"\n             ],\n-            \"scripts\": []\n+            \"scripts\": [],\n+            \"progress\": false\n           },\n           \"configurations\": {\n             \"production\": {\n@@ -70,6 +71,13 @@\n           \"configurations\": {\n             \"production\": {\n               \"browserTarget\": \"ivy-trusted-types:build:production\"\n+            },\n+            \"ci\": {\n+              \"progress\": false\n+            },\n+            \"ci-production\": {\n+              \"browserTarget\": \"ivy-trusted-types:build:production\",\n+              \"progress\": false\n             }\n           }\n         },\n@@ -93,7 +101,9 @@\n             \"styles\": [\n               \"src/styles.css\"\n             ],\n-            \"scripts\": []\n+            \"scripts\": [],\n+            \"progress\": false,\n+            \"watch\": false\n           }\n         },\n         \"lint\": {\n@@ -113,11 +123,18 @@\n           \"builder\": \"@angular-devkit/build-angular:protractor\",\n           \"options\": {\n             \"protractorConfig\": \"e2e/protractor.conf.js\",\n-            \"devServerTarget\": \"ivy-trusted-types:serve\"\n+            \"devServerTarget\": \"ivy-trusted-types:serve\",\n+            \"webdriverUpdate\": false\n           },\n           \"configurations\": {\n             \"production\": {\n               \"devServerTarget\": \"ivy-trusted-types:serve:production\"\n+            },\n+            \"ci\": {\n+              \"devServerTarget\": \"ivy-trusted-types:serve:ci\"\n+            },\n+            \"ci-production\": {\n+              \"devServerTarget\": \"ivy-trusted-types:serve:ci-production\"\n             }\n           }\n         }"
        },
        {
            "sha": "900031813b4b362096ac64a885e194dadb03848d",
            "filename": "integration/ivy-trusted-types/e2e/protractor.conf.js",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/6e1708a2eb4629ceac21cc6da04066798b252856/integration%2Fivy-trusted-types%2Fe2e%2Fprotractor.conf.js",
            "raw_url": "https://github.com/angular/angular/raw/6e1708a2eb4629ceac21cc6da04066798b252856/integration%2Fivy-trusted-types%2Fe2e%2Fprotractor.conf.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fivy-trusted-types%2Fe2e%2Fprotractor.conf.js?ref=6e1708a2eb4629ceac21cc6da04066798b252856",
            "patch": "@@ -13,7 +13,12 @@ exports.config = {\n     './src/**/*.e2e-spec.ts'\n   ],\n   capabilities: {\n-    browserName: 'chrome'\n+    browserName: 'chrome',\n+    chromeOptions: {\n+      binary: require('puppeteer').executablePath(),\n+      // See /integration/README.md#browser-tests for more info on these args\n+      args: ['--no-sandbox', '--headless', '--disable-gpu', '--disable-dev-shm-usage', '--hide-scrollbars', '--mute-audio']\n+    },\n   },\n   directConnect: true,\n   SELENIUM_PROMISE_MANAGER: false,\n@@ -34,4 +39,4 @@ exports.config = {\n       }\n     }));\n   }\n-};\n\\ No newline at end of file\n+};"
        },
        {
            "sha": "b272ebe2973f6ad73fd3a459b96f38a9bda3fae1",
            "filename": "integration/ivy-trusted-types/karma.conf.js",
            "status": "modified",
            "additions": 17,
            "deletions": 2,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/6e1708a2eb4629ceac21cc6da04066798b252856/integration%2Fivy-trusted-types%2Fkarma.conf.js",
            "raw_url": "https://github.com/angular/angular/raw/6e1708a2eb4629ceac21cc6da04066798b252856/integration%2Fivy-trusted-types%2Fkarma.conf.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fivy-trusted-types%2Fkarma.conf.js?ref=6e1708a2eb4629ceac21cc6da04066798b252856",
            "patch": "@@ -1,7 +1,12 @@\n // Karma configuration file, see link for more information\n // https://karma-runner.github.io/1.0/config/configuration-file.html\n \n-module.exports = function (config) {\n+// Env var CHROME_BIN is later picked up by karma-chrome-launcher that is triggered by\n+// `browsers: ['ChromeHeadlessNoSandbox']` below.\n+// See https://github.com/karma-runner/karma-chrome-launcher#usage for more info.\n+process.env.CHROME_BIN = require('puppeteer').executablePath();\n+\n+module.exports = function(config) {\n   config.set({\n     basePath: '',\n     frameworks: ['jasmine', '@angular-devkit/build-angular'],\n@@ -28,7 +33,17 @@ module.exports = function (config) {\n     colors: true,\n     logLevel: config.LOG_INFO,\n     autoWatch: true,\n-    browsers: ['Chrome'],\n+    customLaunchers: {\n+      ChromeHeadlessNoSandbox: {\n+        base: 'ChromeHeadless',\n+        // See /integration/README.md#browser-tests for more info on these args\n+        flags: [\n+          '--no-sandbox', '--headless', '--disable-gpu', '--disable-dev-shm-usage',\n+          '--hide-scrollbars', '--mute-audio'\n+        ]\n+      }\n+    },\n+    browsers: ['ChromeHeadlessNoSandbox'],\n     singleRun: false,\n     restartOnFileChange: true\n   });"
        },
        {
            "sha": "6bfc000f6530718225583fcbbbb4fdef59c33175",
            "filename": "integration/ivy-trusted-types/package.json",
            "status": "modified",
            "additions": 38,
            "deletions": 31,
            "changes": 69,
            "blob_url": "https://github.com/angular/angular/blob/6e1708a2eb4629ceac21cc6da04066798b252856/integration%2Fivy-trusted-types%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/6e1708a2eb4629ceac21cc6da04066798b252856/integration%2Fivy-trusted-types%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fivy-trusted-types%2Fpackage.json?ref=6e1708a2eb4629ceac21cc6da04066798b252856",
            "patch": "@@ -4,42 +4,49 @@\n   \"scripts\": {\n     \"ng\": \"ng\",\n     \"start\": \"ng serve\",\n-    \"build\": \"ng build\",\n-    \"test\": \"ng test\",\n+    \"build\": \"ng build --prod\",\n+    \"pretest\": \"ng version\",\n+    \"test\": \"ng test && yarn e2e --configuration=ci && yarn e2e --configuration=ci-production\",\n     \"lint\": \"ng lint\",\n-    \"e2e\": \"ng e2e\"\n+    \"e2e\": \"ng e2e --port 0\",\n+    \"postinstall\": \"ngcc --properties es2015 --create-ivy-entry-points\"\n   },\n   \"private\": true,\n   \"dependencies\": {\n-    \"@angular/animations\": \"~11.0.0-rc.1\",\n-    \"@angular/common\": \"~11.0.0-rc.1\",\n-    \"@angular/compiler\": \"~11.0.0-rc.1\",\n-    \"@angular/core\": \"~11.0.0-rc.1\",\n-    \"@angular/forms\": \"~11.0.0-rc.1\",\n-    \"@angular/platform-browser\": \"~11.0.0-rc.1\",\n-    \"@angular/platform-browser-dynamic\": \"~11.0.0-rc.1\",\n-    \"@angular/router\": \"~11.0.0-rc.1\",\n-    \"rxjs\": \"~6.6.0\",\n-    \"tslib\": \"^2.0.0\",\n-    \"zone.js\": \"~0.10.2\"\n+    \"@angular/animations\": \"file:../../dist/packages-dist/animations\",\n+    \"@angular/common\": \"file:../../dist/packages-dist/common\",\n+    \"@angular/compiler\": \"file:../../dist/packages-dist/compiler\",\n+    \"@angular/core\": \"file:../../dist/packages-dist/core\",\n+    \"@angular/forms\": \"file:../../dist/packages-dist/forms\",\n+    \"@angular/platform-browser\": \"file:../../dist/packages-dist/platform-browser\",\n+    \"@angular/platform-browser-dynamic\": \"file:../../dist/packages-dist/platform-browser-dynamic\",\n+    \"@angular/router\": \"file:../../dist/packages-dist/router\",\n+    \"rxjs\": \"file:../../node_modules/rxjs\",\n+    \"tslib\": \"file:../../node_modules/tslib\",\n+    \"zone.js\": \"file:../../dist/zone.js-dist/archive/zone.js.tgz\"\n   },\n   \"devDependencies\": {\n-    \"@angular-devkit/build-angular\": \"~0.1100.0-rc.1\",\n-    \"@angular/cli\": \"~11.0.0-rc.1\",\n-    \"@angular/compiler-cli\": \"~11.0.0-rc.1\",\n-    \"@types/jasmine\": \"~3.6.0\",\n-    \"@types/node\": \"^12.11.1\",\n-    \"codelyzer\": \"^6.0.0\",\n-    \"jasmine-core\": \"~3.6.0\",\n-    \"jasmine-spec-reporter\": \"~5.0.0\",\n-    \"karma\": \"~5.2.0\",\n-    \"karma-chrome-launcher\": \"~3.1.0\",\n-    \"karma-coverage\": \"~2.0.3\",\n-    \"karma-jasmine\": \"~4.0.0\",\n-    \"karma-jasmine-html-reporter\": \"^1.5.0\",\n-    \"protractor\": \"~7.0.0\",\n-    \"ts-node\": \"~8.3.0\",\n-    \"tslint\": \"~6.1.0\",\n-    \"typescript\": \"~4.0.2\"\n+    \"@angular-devkit/build-angular\": \"file:../../node_modules/@angular-devkit/build-angular\",\n+    \"@angular/cli\": \"file:../../node_modules/@angular/cli\",\n+    \"@angular/compiler-cli\": \"file:../../dist/packages-dist/compiler-cli\",\n+    \"@types/jasmine\": \"file:../../node_modules/@types/jasmine\",\n+    \"@types/node\": \"file:../../node_modules/@types/node\",\n+    \"codelyzer\": \"6.0.1\",\n+    \"jasmine-core\": \"3.6.0\",\n+    \"jasmine-spec-reporter\": \"5.0.2\",\n+    \"karma\": \"5.2.3\",\n+    \"karma-chrome-launcher\": \"3.1.0\",\n+    \"karma-coverage\": \"2.0.3\",\n+    \"karma-jasmine\": \"4.0.1\",\n+    \"karma-jasmine-html-reporter\": \"1.5.4\",\n+    \"protractor\": \"file:../../node_modules/protractor\",\n+    \"puppeteer\": \"file:../../node_modules/puppeteer\",\n+    \"ts-node\": \"8.3.0\",\n+    \"tslint\": \"6.1.3\",\n+    \"typescript\": \"file:../../node_modules/typescript\"\n+  },\n+  \"//resolutions-comment\": \"Ensure a single version of webdriver-manager which comes from root node_modules that has already run webdriver-manager update\",\n+  \"resolutions\": {\n+    \"**/webdriver-manager\": \"file:../../node_modules/webdriver-manager\"\n   }\n }"
        },
        {
            "sha": "3f7143db586f133279910f59b0c1618e7c73d1e6",
            "filename": "integration/ivy-trusted-types/yarn.lock",
            "status": "added",
            "additions": 9116,
            "deletions": 0,
            "changes": 9116,
            "blob_url": "https://github.com/angular/angular/blob/6e1708a2eb4629ceac21cc6da04066798b252856/integration%2Fivy-trusted-types%2Fyarn.lock",
            "raw_url": "https://github.com/angular/angular/raw/6e1708a2eb4629ceac21cc6da04066798b252856/integration%2Fivy-trusted-types%2Fyarn.lock",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fivy-trusted-types%2Fyarn.lock?ref=6e1708a2eb4629ceac21cc6da04066798b252856"
        }
    ],
    "stats": {
        "total": 9236,
        "additions": 9198,
        "deletions": 38
    }
}