{
    "author": "JoostK",
    "message": "refactor(bazel): remove metadata collection from `ngc_wrapped` (#44269)\n\nThe generated metadata is obsolete now that ViewEngine is no longer\nused, so this commit removes the generation of those file from\n`ngc_wrapped`. This is needed to allow removal of the metadata collector\nin a subsequent commit.\n\nPR Close #44269",
    "sha": "4e6281f11494f1f866fb5005da6e43ca506626f0",
    "files": [
        {
            "sha": "fd0b47ee17b2f1a498668bbea54eeaf26fbd4572",
            "filename": "packages/bazel/src/ngc-wrapped/index.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 33,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/4e6281f11494f1f866fb5005da6e43ca506626f0/packages%2Fbazel%2Fsrc%2Fngc-wrapped%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/4e6281f11494f1f866fb5005da6e43ca506626f0/packages%2Fbazel%2Fsrc%2Fngc-wrapped%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fsrc%2Fngc-wrapped%2Findex.ts?ref=4e6281f11494f1f866fb5005da6e43ca506626f0",
            "patch": "@@ -422,13 +422,6 @@ export function compile({\n   // Make sure not to crash but report the diagnostics.\n   if (!program) return {program, diagnostics};\n \n-  if (!bazelOpts.nodeModulesPrefix) {\n-    // If there is no node modules, then metadata.json should be emitted since\n-    // there is no other way to obtain the information\n-    generateMetadataJson(\n-        program.getTsProgram(), files, compilerOpts.rootDirs, bazelBin, tsHost, ng);\n-  }\n-\n   if (bazelOpts.tsickleExternsPath) {\n     // Note: when tsickleExternsPath is provided, we always write a file as a\n     // marker that compilation succeeded, even if it's empty (just containing an\n@@ -445,32 +438,6 @@ export function compile({\n   return {program, diagnostics};\n }\n \n-/**\n- * Generate metadata.json for the specified `files`. By default, metadata.json\n- * is only generated by the compiler if --flatModuleOutFile is specified. But\n- * if compiled under blaze, we want the metadata to be generated for each\n- * Angular component.\n- */\n-function generateMetadataJson(\n-    program: ts.Program, files: string[], rootDirs: string[], bazelBin: string,\n-    tsHost: ts.CompilerHost, ng: CompilerCliModule) {\n-  const collector = new ng.MetadataCollector();\n-  for (let i = 0; i < files.length; i++) {\n-    const file = files[i];\n-    const sourceFile = program.getSourceFile(file);\n-    if (sourceFile) {\n-      const metadata = collector.getMetadata(sourceFile);\n-      if (metadata) {\n-        const relative = relativeToRootDirs(file, rootDirs);\n-        const shortPath = relative.replace(EXT, '.metadata.json');\n-        const outFile = resolveNormalizedPath(bazelBin, shortPath);\n-        const data = JSON.stringify(metadata);\n-        tsHost.writeFile(outFile, data, false, undefined, []);\n-      }\n-    }\n-  }\n-}\n-\n function isCompilationTarget(bazelOpts: BazelOptions, sf: ts.SourceFile): boolean {\n   return !NGC_GEN_FILES.test(sf.fileName) &&\n       (bazelOpts.compilationTargetSrc.indexOf(sf.fileName) !== -1);"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 0,
        "deletions": 33
    }
}