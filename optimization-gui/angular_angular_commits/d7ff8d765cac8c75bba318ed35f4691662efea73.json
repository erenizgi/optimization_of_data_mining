{
    "author": "devversion",
    "message": "refactor(dev-infra): use shared github repo interface (#38656)\n\nInstead of maintaining multiple interface for grouping\nowner name and repo name, we expose a shared interface\ndescribing a Github repository.\n\nOne unfortunate downside is that the GraphQL Github\nand Rest API diverge slightly with the key for the\nrepository name. i.e. rest uses `repo` for the name\nof a repository, while GraphQL uses `name` for the name.\n\nIf that would be consistent, we could use the rest operator\nto pass a repository to the Octokit REST or GraphQL API. This\ndoes not work, so we have a small manual overhead as seen\nin the `branches.ts` file.\n\nPR Close #38656",
    "sha": "d7ff8d765cac8c75bba318ed35f4691662efea73",
    "files": [
        {
            "sha": "151ec0aa7224afd16317f9b8b5b6e01630be5eb7",
            "filename": "dev-infra/pr/merge/defaults/branches.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 13,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/d7ff8d765cac8c75bba318ed35f4691662efea73/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Fbranches.ts",
            "raw_url": "https://github.com/angular/angular/raw/d7ff8d765cac8c75bba318ed35f4691662efea73/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Fbranches.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Fbranches.ts?ref=d7ff8d765cac8c75bba318ed35f4691662efea73",
            "patch": "@@ -7,16 +7,12 @@\n  */\n \n import * as semver from 'semver';\n-import {GithubClient} from '../../../utils/git/github';\n+import {GithubClient, GithubRepo} from '../../../utils/git/github';\n \n /** Type describing a Github repository with corresponding API client. */\n-export interface GithubRepo {\n+export interface GithubRepoWithApi extends GithubRepo {\n   /** API client that can access the repository. */\n   api: GithubClient;\n-  /** Owner login of the repository. */\n-  owner: string;\n-  /** Name of the repository. */\n-  repo: string;\n }\n \n /** Type describing a version-branch. */\n@@ -51,7 +47,7 @@ const releaseTrainBranchNameRegex = /(\\d+)\\.(\\d+)\\.x/;\n  * a currently active feature-freeze/release-candidate release-train.\n  */\n export async function fetchActiveReleaseTrainBranches(\n-    repo: GithubRepo, nextVersion: semver.SemVer): Promise<{\n+    repo: GithubRepoWithApi, nextVersion: semver.SemVer): Promise<{\n   /** Release-train currently in active release-candidate/feature-freeze phase. */\n   releaseCandidate: ReleaseTrain | null,\n   /** Latest non-prerelease release train (i.e. for the patch branch). */\n@@ -102,9 +98,9 @@ export async function fetchActiveReleaseTrainBranches(\n \n /** Gets the version of a given branch by reading the `package.json` upstream. */\n export async function getVersionOfBranch(\n-    repo: GithubRepo, branchName: string): Promise<semver.SemVer> {\n-  const {data} =\n-      await repo.api.repos.getContents({...repo, path: '/package.json', ref: branchName});\n+    repo: GithubRepoWithApi, branchName: string): Promise<semver.SemVer> {\n+  const {data} = await repo.api.repos.getContents(\n+      {owner: repo.owner, repo: repo.name, path: '/package.json', ref: branchName});\n   const {version} = JSON.parse(Buffer.from(data.content, 'base64').toString());\n   const parsedVersion = semver.parse(version);\n   if (parsedVersion === null) {\n@@ -136,8 +132,9 @@ export function getVersionForReleaseTrainBranch(branchName: string): semver.SemV\n  * order. i.e. latest version branches first.\n  */\n export async function getBranchesForMajorVersions(\n-    repo: GithubRepo, majorVersions: number[]): Promise<VersionBranch[]> {\n-  const {data: branchData} = await repo.api.repos.listBranches({...repo, protected: true});\n+    repo: GithubRepoWithApi, majorVersions: number[]): Promise<VersionBranch[]> {\n+  const {data: branchData} =\n+      await repo.api.repos.listBranches({owner: repo.owner, repo: repo.name, protected: true});\n   const branches: VersionBranch[] = [];\n \n   for (const {name} of branchData) {\n@@ -159,7 +156,7 @@ export async function getBranchesForMajorVersions(\n \n /** Finds the currently active release trains from the specified version branches. */\n export async function findActiveReleaseTrainsFromVersionBranches(\n-    repo: GithubRepo, nextVersion: semver.SemVer, branches: VersionBranch[],\n+    repo: GithubRepoWithApi, nextVersion: semver.SemVer, branches: VersionBranch[],\n     expectedReleaseCandidateMajor: number): Promise<{\n   latest: ReleaseTrain | null,\n   releaseCandidate: ReleaseTrain | null,"
        },
        {
            "sha": "09a67659b99b0d48193ea175f161feefc56701cc",
            "filename": "dev-infra/pr/merge/defaults/labels.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d7ff8d765cac8c75bba318ed35f4691662efea73/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flabels.ts",
            "raw_url": "https://github.com/angular/angular/raw/d7ff8d765cac8c75bba318ed35f4691662efea73/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flabels.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flabels.ts?ref=d7ff8d765cac8c75bba318ed35f4691662efea73",
            "patch": "@@ -11,7 +11,7 @@ import {GithubClient} from '../../../utils/git/github';\n import {TargetLabel} from '../config';\n import {InvalidTargetBranchError, InvalidTargetLabelError} from '../target-label';\n \n-import {fetchActiveReleaseTrainBranches, getVersionOfBranch, GithubRepo, isReleaseTrainBranch, nextBranchName} from './branches';\n+import {fetchActiveReleaseTrainBranches, getVersionOfBranch, GithubRepoWithApi, isReleaseTrainBranch, nextBranchName} from './branches';\n import {assertActiveLtsBranch} from './lts-branch';\n \n /**\n@@ -22,7 +22,7 @@ import {assertActiveLtsBranch} from './lts-branch';\n  */\n export async function getDefaultTargetLabelConfiguration(\n     api: GithubClient, github: GithubConfig, npmPackageName: string): Promise<TargetLabel[]> {\n-  const repo: GithubRepo = {owner: github.owner, repo: github.name, api};\n+  const repo: GithubRepoWithApi = {owner: github.owner, name: github.name, api};\n   const nextVersion = await getVersionOfBranch(repo, nextBranchName);\n   const hasNextMajorTrain = nextVersion.minor === 0;\n   const {latest, releaseCandidate} = await fetchActiveReleaseTrainBranches(repo, nextVersion);"
        },
        {
            "sha": "49073b46cf50121f3282277002a2a2d8ae08236c",
            "filename": "dev-infra/pr/merge/defaults/lts-branch.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d7ff8d765cac8c75bba318ed35f4691662efea73/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flts-branch.ts",
            "raw_url": "https://github.com/angular/angular/raw/d7ff8d765cac8c75bba318ed35f4691662efea73/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flts-branch.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fdefaults%2Flts-branch.ts?ref=d7ff8d765cac8c75bba318ed35f4691662efea73",
            "patch": "@@ -12,7 +12,7 @@ import * as semver from 'semver';\n import {promptConfirm, red, warn, yellow} from '../../../utils/console';\n import {InvalidTargetBranchError} from '../target-label';\n \n-import {getVersionOfBranch, GithubRepo} from './branches';\n+import {getVersionOfBranch, GithubRepoWithApi} from './branches';\n \n /**\n  * Number of months a major version in Angular is actively supported. See:\n@@ -39,7 +39,7 @@ const majorActiveTermSupportDuration = 12;\n  * @param branchName Branch that is checked to be an active LTS version-branch.\n  * */\n export async function assertActiveLtsBranch(\n-    repo: GithubRepo, representativeNpmPackage: string, branchName: string) {\n+    repo: GithubRepoWithApi, representativeNpmPackage: string, branchName: string) {\n   const version = await getVersionOfBranch(repo, branchName);\n   const {'dist-tags': distTags, time} =\n       await (await fetch(`https://registry.npmjs.org/${representativeNpmPackage}`)).json();"
        },
        {
            "sha": "b2aaa8b3f07f48ee45b514c0326f1c01c87006f6",
            "filename": "dev-infra/utils/git/github.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d7ff8d765cac8c75bba318ed35f4691662efea73/dev-infra%2Futils%2Fgit%2Fgithub.ts",
            "raw_url": "https://github.com/angular/angular/raw/d7ff8d765cac8c75bba318ed35f4691662efea73/dev-infra%2Futils%2Fgit%2Fgithub.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Fgithub.ts?ref=d7ff8d765cac8c75bba318ed35f4691662efea73",
            "patch": "@@ -11,6 +11,14 @@ import * as Octokit from '@octokit/rest';\n import {RequestParameters} from '@octokit/types';\n import {query, types} from 'typed-graphqlify';\n \n+/** Interface describing a Github repository. */\n+export interface GithubRepo {\n+  /** Owner login of the repository. */\n+  owner: string;\n+  /** Name of the repository. */\n+  name: string;\n+}\n+\n /** Error for failed Github API requests. */\n export class GithubApiRequestError extends Error {\n   constructor(public status: number, message: string) {"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 22,
        "deletions": 17
    }
}