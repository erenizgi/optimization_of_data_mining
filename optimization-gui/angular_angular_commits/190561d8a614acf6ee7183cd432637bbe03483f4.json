{
    "author": "petebacondarwin",
    "message": "feat(localize): implement message extraction tool (#32912)\n\nThis tool, which can be run from the node_modules bin folder, can parse\nthe source files in your compiled app and generate a translation file\nformatted with the configured syntax.\n\nFor example:\n\n```\n./node_modules/.bin/localize-extract -s 'dist/**/*.js' -f xliff1 -o dist/messages.en.xlf\n```\n\nPR Close #32912",
    "sha": "190561d8a614acf6ee7183cd432637bbe03483f4",
    "files": [
        {
            "sha": "37a802f06c5afbebdaf5ecb18143c4f130e55bac",
            "filename": "packages/localize/package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fpackage.json?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -3,7 +3,8 @@\n   \"version\": \"0.0.0-PLACEHOLDER\",\n   \"description\": \"Angular - library for localizing messages\",\n   \"bin\": {\n-    \"localize-translate\": \"./src/tools/src/translate/main.js\"\n+    \"localize-translate\": \"./src/tools/src/translate/main.js\",\n+    \"localize-extract\": \"./src/tools/src/extract/main.js\"\n   },\n   \"author\": \"angular\",\n   \"license\": \"MIT\","
        },
        {
            "sha": "c13422f9d8dbb02000dc84f5d498337c03c65e68",
            "filename": "packages/localize/src/tools/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2FBUILD.bazel?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -20,6 +20,8 @@ ts_library(\n     deps = [\n         \"//packages/compiler\",\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n+        \"//packages/compiler-cli/src/ngtsc/logging\",\n+        \"//packages/compiler-cli/src/ngtsc/sourcemaps\",\n         \"//packages/localize\",\n         \"@npm//@babel/core\",\n         \"@npm//@babel/types\","
        },
        {
            "sha": "242e88df9eb0521206c753a6d2baec04ac71629d",
            "filename": "packages/localize/src/tools/src/extract/extraction.ts",
            "status": "added",
            "additions": 108,
            "deletions": 0,
            "changes": 108,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fextraction.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fextraction.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fextraction.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,108 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {AbsoluteFsPath, FileSystem, PathSegment} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {Logger} from '@angular/compiler-cli/src/ngtsc/logging';\n+import {SourceFile, SourceFileLoader} from '@angular/compiler-cli/src/ngtsc/sourcemaps';\n+import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n+import {transformSync} from '@babel/core';\n+\n+import {makeEs2015ExtractPlugin} from './source_files/es2015_extract_plugin';\n+import {makeEs5ExtractPlugin} from './source_files/es5_extract_plugin';\n+\n+export interface ExtractionOptions {\n+  basePath: AbsoluteFsPath;\n+  useSourceMaps?: boolean;\n+  localizeName?: string;\n+}\n+\n+/**\n+ * Extracts parsed messages from file contents, by parsing the contents as JavaScript\n+ * and looking for occurrences of `$localize` in the source code.\n+ */\n+export class MessageExtractor {\n+  private basePath: AbsoluteFsPath;\n+  private useSourceMaps: boolean;\n+  private localizeName: string;\n+  private loader: SourceFileLoader;\n+\n+  constructor(\n+      private fs: FileSystem, private logger: Logger,\n+      {basePath, useSourceMaps = true, localizeName = '$localize'}: ExtractionOptions) {\n+    this.basePath = basePath;\n+    this.useSourceMaps = useSourceMaps;\n+    this.localizeName = localizeName;\n+    this.loader = new SourceFileLoader(this.fs, this.logger, {webpack: basePath});\n+  }\n+\n+  extractMessages(\n+      filename: string,\n+      ): ɵParsedMessage[] {\n+    const messages: ɵParsedMessage[] = [];\n+    const sourceCode = this.fs.readFile(this.fs.resolve(this.basePath, filename));\n+    if (sourceCode.includes(this.localizeName)) {\n+      // Only bother to parse the file if it contains a reference to `$localize`.\n+      transformSync(sourceCode, {\n+        sourceRoot: this.basePath,\n+        filename,\n+        plugins: [\n+          makeEs2015ExtractPlugin(messages, this.localizeName),\n+          makeEs5ExtractPlugin(messages, this.localizeName),\n+        ],\n+        code: false,\n+        ast: false\n+      });\n+    }\n+    if (this.useSourceMaps) {\n+      this.updateSourceLocations(filename, sourceCode, messages);\n+    }\n+    return messages;\n+  }\n+\n+  /**\n+   * Update the location of each message to point to the source-mapped original source location, if\n+   * available.\n+   */\n+  private updateSourceLocations(filename: string, contents: string, messages: ɵParsedMessage[]):\n+      void {\n+    const sourceFile =\n+        this.loader.loadSourceFile(this.fs.resolve(this.basePath, filename), contents);\n+    if (sourceFile === null) {\n+      return;\n+    }\n+    for (const message of messages) {\n+      if (message.location !== undefined) {\n+        message.location = this.getOriginalLocation(sourceFile, message.location);\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Find the original location using source-maps if available.\n+   *\n+   * @param sourceFile The generated `sourceFile` that contains the `location`.\n+   * @param location The location within the generated `sourceFile` that needs mapping.\n+   *\n+   * @returns A new location that refers to the original source location mapped from the given\n+   *     `location` in the generated `sourceFile`.\n+   */\n+  private getOriginalLocation(sourceFile: SourceFile, location: ɵSourceLocation): ɵSourceLocation {\n+    const originalStart =\n+        sourceFile.getOriginalLocation(location.start.line, location.start.column);\n+    if (originalStart === null) {\n+      return location;\n+    }\n+    const originalEnd = sourceFile.getOriginalLocation(location.end.line, location.end.column);\n+    const start = {line: originalStart.line, column: originalStart.column};\n+    // We check whether the files are the same, since the returned location can only have a single\n+    // `file` and it would not make sense to store the end position from a different source file.\n+    const end = (originalEnd !== null && originalEnd.file === originalStart.file) ?\n+        {line: originalEnd.line, column: originalEnd.column} :\n+        start;\n+    return {file: originalStart.file, start, end};\n+  }\n+}"
        },
        {
            "sha": "517146945b0e757da30b6f9d6058297553234118",
            "filename": "packages/localize/src/tools/src/extract/main.ts",
            "status": "added",
            "additions": 178,
            "deletions": 0,
            "changes": 178,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fmain.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fmain.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fmain.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,178 @@\n+#!/usr/bin/env node\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {getFileSystem, setFileSystem, NodeJSFileSystem, AbsoluteFsPath} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {ConsoleLogger, Logger, LogLevel} from '@angular/compiler-cli/src/ngtsc/logging';\n+import {ɵParsedMessage} from '@angular/localize';\n+import * as glob from 'glob';\n+import * as yargs from 'yargs';\n+import {MessageExtractor} from './extraction';\n+import {TranslationSerializer} from './translation_files/translation_serializer';\n+import {SimpleJsonTranslationSerializer} from './translation_files/json_translation_serializer';\n+import {Xliff1TranslationSerializer} from './translation_files/xliff1_translation_serializer';\n+import {Xliff2TranslationSerializer} from './translation_files/xliff2_translation_serializer';\n+import {XmbTranslationSerializer} from './translation_files/xmb_translation_serializer';\n+\n+if (require.main === module) {\n+  const args = process.argv.slice(2);\n+  const options =\n+      yargs\n+          .option('l', {\n+            alias: 'locale',\n+            describe: 'The locale of the source being processed',\n+            default: 'en',\n+          })\n+          .option('r', {\n+            alias: 'root',\n+            default: '.',\n+            describe: 'The root path for other paths provided in these options.\\n' +\n+                'This should either be absolute or relative to the current working directory.'\n+          })\n+          .option('s', {\n+            alias: 'source',\n+            required: true,\n+            describe:\n+                'A glob pattern indicating what files to search for translations, e.g. `./dist/**/*.js`.\\n' +\n+                'This should be relative to the root path.',\n+          })\n+          .option('f', {\n+            alias: 'format',\n+            required: true,\n+            choices: ['xmb', 'xlf', 'xlif', 'xliff', 'xlf2', 'xlif2', 'xliff2', 'json'],\n+            describe: 'The format of the translation file.',\n+          })\n+          .option('o', {\n+            alias: 'outputPath',\n+            required: true,\n+            describe:\n+                'A path to where the translation file will be written. This should be relative to the root path.'\n+          })\n+          .option('loglevel', {\n+            describe: 'The lowest severity logging message that should be output.',\n+            choices: ['debug', 'info', 'warn', 'error'],\n+          })\n+          .option('useSourceMaps', {\n+            type: 'boolean',\n+            default: true,\n+            describe:\n+                'Whether to generate source information in the output files by following source-map mappings found in the source files'\n+          })\n+          .option('useLegacyIds', {\n+            type: 'boolean',\n+            default: true,\n+            describe:\n+                'Whether to use the legacy id format for messages that were extracted from Angular templates.'\n+          })\n+          .strict()\n+          .help()\n+          .parse(args);\n+\n+  const fs = new NodeJSFileSystem();\n+  setFileSystem(fs);\n+\n+  const rootPath = options['root'];\n+  const sourceFilePaths = glob.sync(options['source'], {cwd: rootPath, nodir: true});\n+  const logLevel = options['loglevel'] as (keyof typeof LogLevel) | undefined;\n+  const logger = new ConsoleLogger(logLevel ? LogLevel[logLevel] : LogLevel.warn);\n+\n+\n+  extractTranslations({\n+    rootPath,\n+    sourceFilePaths,\n+    sourceLocale: options['locale'],\n+    format: options['format'],\n+    outputPath: options['outputPath'],\n+    logger,\n+    useSourceMaps: options['useSourceMaps'],\n+    useLegacyIds: options['useLegacyIds'],\n+  });\n+}\n+\n+export interface ExtractTranslationsOptions {\n+  /**\n+   * The locale of the source being processed.\n+   */\n+  sourceLocale: string;\n+  /**\n+   * The base path for other paths provided in these options.\n+   * This should either be absolute or relative to the current working directory.\n+   */\n+  rootPath: string;\n+  /**\n+   * An array of paths to files to search for translations. These should be relative to the\n+   * rootPath.\n+   */\n+  sourceFilePaths: string[];\n+  /**\n+   * The format of the translation file.\n+   */\n+  format: string;\n+  /**\n+   * A path to where the translation file will be written. This should be relative to the rootPath.\n+   */\n+  outputPath: string;\n+  /**\n+   * The logger to use for diagnostic messages.\n+   */\n+  logger: Logger;\n+  /**\n+   * Whether to generate source information in the output files by following source-map mappings\n+   * found in the source file.\n+   */\n+  useSourceMaps: boolean;\n+  /**\n+   * Whether to use the legacy id format for messages that were extracted from Angular templates\n+   */\n+  useLegacyIds: boolean;\n+}\n+\n+export function extractTranslations({\n+  rootPath,\n+  sourceFilePaths,\n+  sourceLocale,\n+  format,\n+  outputPath: output,\n+  logger,\n+  useSourceMaps,\n+  useLegacyIds\n+}: ExtractTranslationsOptions) {\n+  const fs = getFileSystem();\n+  const extractor =\n+      new MessageExtractor(fs, logger, {basePath: fs.resolve(rootPath), useSourceMaps});\n+\n+  const messages: ɵParsedMessage[] = [];\n+  for (const file of sourceFilePaths) {\n+    messages.push(...extractor.extractMessages(file));\n+  }\n+\n+  const outputPath = fs.resolve(rootPath, output);\n+  const serializer = getSerializer(format, sourceLocale, fs.dirname(outputPath), useLegacyIds);\n+  const translationFile = serializer.serialize(messages);\n+  fs.ensureDir(fs.dirname(outputPath));\n+  fs.writeFile(outputPath, translationFile);\n+}\n+\n+export function getSerializer(\n+    format: string, sourceLocale: string, rootPath: AbsoluteFsPath,\n+    useLegacyIds: boolean): TranslationSerializer {\n+  switch (format) {\n+    case 'xlf':\n+    case 'xlif':\n+    case 'xliff':\n+      return new Xliff1TranslationSerializer(sourceLocale, rootPath, useLegacyIds);\n+    case 'xlf2':\n+    case 'xlif2':\n+    case 'xliff2':\n+      return new Xliff2TranslationSerializer(sourceLocale, rootPath, useLegacyIds);\n+    case 'xmb':\n+      return new XmbTranslationSerializer(rootPath, useLegacyIds);\n+    case 'json':\n+      return new SimpleJsonTranslationSerializer(sourceLocale);\n+  }\n+  throw new Error(`No translation serializer can handle the provided format: ${format}`);\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "cada054ef4c0872341f81bf6d0cb11a4568aa2ff",
            "filename": "packages/localize/src/tools/src/extract/source_files/es2015_extract_plugin.ts",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes2015_extract_plugin.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes2015_extract_plugin.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes2015_extract_plugin.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,29 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {ɵParsedMessage, ɵparseMessage} from '@angular/localize';\n+import {NodePath, PluginObj} from '@babel/core';\n+import {TaggedTemplateExpression} from '@babel/types';\n+\n+import {getLocation, isGlobalIdentifier, isNamedIdentifier, unwrapMessagePartsFromTemplateLiteral} from '../../source_file_utils';\n+\n+export function makeEs2015ExtractPlugin(\n+    messages: ɵParsedMessage[], localizeName = '$localize'): PluginObj {\n+  return {\n+    visitor: {\n+      TaggedTemplateExpression(path: NodePath<TaggedTemplateExpression>) {\n+        const tag = path.get('tag');\n+        if (isNamedIdentifier(tag, localizeName) && isGlobalIdentifier(tag)) {\n+          const messageParts = unwrapMessagePartsFromTemplateLiteral(path.node.quasi.quasis);\n+          const location = getLocation(path.get('quasi'));\n+          const message = ɵparseMessage(messageParts, path.node.quasi.expressions, location);\n+          messages.push(message);\n+        }\n+      }\n+    }\n+  };\n+}"
        },
        {
            "sha": "4312f1e3c3837b38c8df78207e3f566f942acc1f",
            "filename": "packages/localize/src/tools/src/extract/source_files/es5_extract_plugin.ts",
            "status": "added",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes5_extract_plugin.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes5_extract_plugin.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes5_extract_plugin.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,30 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {ɵParsedMessage, ɵparseMessage} from '@angular/localize';\n+import {NodePath, PluginObj} from '@babel/core';\n+import {CallExpression} from '@babel/types';\n+\n+import {getLocation, isGlobalIdentifier, isNamedIdentifier, unwrapMessagePartsFromLocalizeCall, unwrapSubstitutionsFromLocalizeCall} from '../../source_file_utils';\n+\n+export function makeEs5ExtractPlugin(\n+    messages: ɵParsedMessage[], localizeName = '$localize'): PluginObj {\n+  return {\n+    visitor: {\n+      CallExpression(callPath: NodePath<CallExpression>) {\n+        const calleePath = callPath.get('callee');\n+        if (isNamedIdentifier(calleePath, localizeName) && isGlobalIdentifier(calleePath)) {\n+          const messageParts = unwrapMessagePartsFromLocalizeCall(callPath);\n+          const expressions = unwrapSubstitutionsFromLocalizeCall(callPath.node);\n+          const location = getLocation(callPath);\n+          const message = ɵparseMessage(messageParts, expressions, location);\n+          messages.push(message);\n+        }\n+      }\n+    }\n+  };\n+}"
        },
        {
            "sha": "9c27ef8b7005cc14fdee07d84be4417313fe7ee3",
            "filename": "packages/localize/src/tools/src/extract/translation_files/json_translation_serializer.ts",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fjson_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fjson_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fjson_translation_serializer.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,32 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {ɵMessageId, ɵParsedMessage, ɵSourceMessage} from '@angular/localize';\n+import {TranslationSerializer} from './translation_serializer';\n+\n+\n+interface SimpleJsonTranslationFile {\n+  locale: string;\n+  translations: Record<ɵMessageId, ɵSourceMessage>;\n+}\n+\n+/**\n+ * This is a semi-public bespoke serialization format that is used for testing and sometimes as a\n+ * format for storing translations that will be inlined at runtime.\n+ *\n+ * @see SimpleJsonTranslationParser\n+ */\n+export class SimpleJsonTranslationSerializer implements TranslationSerializer {\n+  constructor(private sourceLocale: string) {}\n+  serialize(messages: ɵParsedMessage[]): string {\n+    const fileObj: SimpleJsonTranslationFile = {locale: this.sourceLocale, translations: {}};\n+    for (const message of messages) {\n+      fileObj.translations[message.id] = message.text;\n+    }\n+    return JSON.stringify(fileObj, null, 2);\n+  }\n+}"
        },
        {
            "sha": "a313966bbe52784e52f621982c945aec76b8de6c",
            "filename": "packages/localize/src/tools/src/extract/translation_files/translation_serializer.ts",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Ftranslation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Ftranslation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Ftranslation_serializer.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,21 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {ɵParsedMessage} from '@angular/localize';\n+\n+/**\n+ * Implement this interface to provide a class that can render messages into a translation file.\n+ */\n+export interface TranslationSerializer {\n+  /**\n+   * Serialize the contents of a translation file containing the given `messages`.\n+   *\n+   * @param messages The messages to render to the file.\n+   * @returns The contents of the serialized file.\n+   */\n+  serialize(messages: ɵParsedMessage[]): string;\n+}"
        },
        {
            "sha": "8c1afb69f2b2206bd89a9f3ebc0eced56697c1a3",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff1_translation_serializer.ts",
            "status": "added",
            "additions": 111,
            "deletions": 0,
            "changes": 111,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,111 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {AbsoluteFsPath, relative} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n+\n+import {TranslationSerializer} from './translation_serializer';\n+import {XmlFile} from './xml_file';\n+\n+/** This is the number of characters that a legacy Xliff 1.2 message id has. */\n+const LEGACY_XLIFF_MESSAGE_LENGTH = 40;\n+\n+/**\n+ * A translation serializer that can write XLIFF 1.2 formatted files.\n+ *\n+ * http://docs.oasis-open.org/xliff/v1.2/os/xliff-core.html\n+ * http://docs.oasis-open.org/xliff/v1.2/xliff-profile-html/xliff-profile-html-1.2.html\n+ *\n+ * @see Xliff1TranslationParser\n+ */\n+export class Xliff1TranslationSerializer implements TranslationSerializer {\n+  constructor(\n+      private sourceLocale: string, private basePath: AbsoluteFsPath,\n+      private useLegacyIds: boolean) {}\n+\n+  serialize(messages: ɵParsedMessage[]): string {\n+    const ids = new Set<string>();\n+    const xml = new XmlFile();\n+    xml.startTag('xliff', {'version': '1.2', 'xmlns': 'urn:oasis:names:tc:xliff:document:1.2'});\n+    xml.startTag('file', {'source-language': this.sourceLocale, 'datatype': 'plaintext'});\n+    xml.startTag('body');\n+    for (const message of messages) {\n+      const id = this.getMessageId(message);\n+      if (ids.has(id)) {\n+        // Do not render the same message more than once\n+        continue;\n+      }\n+      ids.add(id);\n+\n+      xml.startTag('trans-unit', {id, datatype: 'html'});\n+      xml.startTag('source', {}, {preserveWhitespace: true});\n+      this.serializeMessage(xml, message);\n+      xml.endTag('source', {preserveWhitespace: false});\n+      if (message.location) {\n+        this.serializeLocation(xml, message.location);\n+      }\n+      if (message.description) {\n+        this.serializeNote(xml, 'description', message.description);\n+      }\n+      if (message.meaning) {\n+        this.serializeNote(xml, 'meaning', message.meaning);\n+      }\n+      xml.endTag('trans-unit');\n+    }\n+    xml.endTag('body');\n+    xml.endTag('file');\n+    xml.endTag('xliff');\n+    return xml.toString();\n+  }\n+\n+  private serializeMessage(xml: XmlFile, message: ɵParsedMessage): void {\n+    xml.text(message.messageParts[0]);\n+    for (let i = 1; i < message.messageParts.length; i++) {\n+      xml.startTag('x', {id: message.placeholderNames[i - 1]}, {selfClosing: true});\n+      xml.text(message.messageParts[i]);\n+    }\n+  }\n+\n+  private serializeNote(xml: XmlFile, name: string, value: string): void {\n+    xml.startTag('note', {priority: '1', from: name}, {preserveWhitespace: true});\n+    xml.text(value);\n+    xml.endTag('note', {preserveWhitespace: false});\n+  }\n+\n+  private serializeLocation(xml: XmlFile, location: ɵSourceLocation): void {\n+    xml.startTag('context-group', {purpose: 'location'});\n+    this.renderContext(xml, 'sourcefile', relative(this.basePath, location.file));\n+    const endLineString = location.end !== undefined && location.end.line !== location.start.line ?\n+        `,${location.end.line + 1}` :\n+        '';\n+    this.renderContext(xml, 'linenumber', `${location.start.line + 1}${endLineString}`);\n+    xml.endTag('context-group');\n+  }\n+\n+  private renderContext(xml: XmlFile, type: string, value: string): void {\n+    xml.startTag('context', {'context-type': type}, {preserveWhitespace: true});\n+    xml.text(value);\n+    xml.endTag('context', {preserveWhitespace: false});\n+  }\n+\n+  /**\n+   * Get the id for the given `message`.\n+   *\n+   * If we have requested legacy message ids, then try to return the appropriate id\n+   * from the list of legacy ids that were extracted.\n+   *\n+   * Otherwise return the canonical message id.\n+   *\n+   * An Xliff 1.2 legacy message id is a hex encoded SHA-1 string, which is 40 characters long. See\n+   * https://csrc.nist.gov/csrc/media/publications/fips/180/4/final/documents/fips180-4-draft-aug2014.pdf\n+   */\n+  private getMessageId(message: ɵParsedMessage): string {\n+    return this.useLegacyIds && message.legacyIds !== undefined &&\n+        message.legacyIds.find(id => id.length === LEGACY_XLIFF_MESSAGE_LENGTH) ||\n+        message.id;\n+  }\n+}"
        },
        {
            "sha": "31f2a42eeb84ac3918709f4f71fe83409d0dfd1e",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff2_translation_serializer.ts",
            "status": "added",
            "additions": 119,
            "deletions": 0,
            "changes": 119,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,119 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {AbsoluteFsPath, relative} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {ɵParsedMessage} from '@angular/localize';\n+\n+import {TranslationSerializer} from './translation_serializer';\n+import {XmlFile} from './xml_file';\n+\n+/** This is the maximum number of characters that can appear in a legacy XLIFF 2.0 message id. */\n+const MAX_LEGACY_XLIFF_2_MESSAGE_LENGTH = 20;\n+\n+/**\n+ * A translation serializer that can write translations in XLIFF 2 format.\n+ *\n+ * http://docs.oasis-open.org/xliff/xliff-core/v2.0/os/xliff-core-v2.0-os.html\n+ *\n+ * @see Xliff2TranslationParser\n+ */\n+export class Xliff2TranslationSerializer implements TranslationSerializer {\n+  constructor(\n+      private sourceLocale: string, private basePath: AbsoluteFsPath,\n+      private useLegacyIds: boolean) {}\n+\n+  serialize(messages: ɵParsedMessage[]): string {\n+    const ids = new Set<string>();\n+    const xml = new XmlFile();\n+    xml.startTag('xliff', {\n+      'version': '2.0',\n+      'xmlns': 'urn:oasis:names:tc:xliff:document:2.0',\n+      'srcLang': this.sourceLocale\n+    });\n+    xml.startTag('file');\n+    for (const message of messages) {\n+      const id = this.getMessageId(message);\n+      if (ids.has(id)) {\n+        // Do not render the same message more than once\n+        continue;\n+      }\n+      ids.add(id);\n+      xml.startTag('unit', {id});\n+      if (message.meaning || message.description) {\n+        xml.startTag('notes');\n+        if (message.location) {\n+          const {file, start, end} = message.location;\n+          const endLineString =\n+              end !== undefined && end.line !== start.line ? `,${end.line + 1}` : '';\n+          this.serializeNote(\n+              xml, 'location',\n+              `${relative(this.basePath, file)}:${start.line + 1}${endLineString}`);\n+        }\n+        if (message.description) {\n+          this.serializeNote(xml, 'description', message.description);\n+        }\n+        if (message.meaning) {\n+          this.serializeNote(xml, 'meaning', message.meaning);\n+        }\n+        xml.endTag('notes');\n+      }\n+      xml.startTag('segment');\n+      xml.startTag('source', {}, {preserveWhitespace: true});\n+      this.serializeMessage(xml, message);\n+      xml.endTag('source', {preserveWhitespace: false});\n+      xml.endTag('segment');\n+      xml.endTag('unit');\n+    }\n+    xml.endTag('file');\n+    xml.endTag('xliff');\n+    return xml.toString();\n+  }\n+\n+  private serializeMessage(xml: XmlFile, message: ɵParsedMessage): void {\n+    xml.text(message.messageParts[0]);\n+    for (let i = 1; i < message.messageParts.length; i++) {\n+      const placeholderName = message.placeholderNames[i - 1];\n+      if (placeholderName.startsWith('START_')) {\n+        xml.startTag('pc', {\n+          id: `${i}`,\n+          equivStart: placeholderName,\n+          equivEnd: placeholderName.replace(/^START/, 'CLOSE')\n+        });\n+      } else if (placeholderName.startsWith('CLOSE_')) {\n+        xml.endTag('pc');\n+      } else {\n+        xml.startTag('ph', {id: `${i}`, equiv: placeholderName}, {selfClosing: true});\n+      }\n+      xml.text(message.messageParts[i]);\n+    }\n+  }\n+\n+  private serializeNote(xml: XmlFile, name: string, value: string) {\n+    xml.startTag('note', {category: name}, {preserveWhitespace: true});\n+    xml.text(value);\n+    xml.endTag('note', {preserveWhitespace: false});\n+  }\n+\n+  /**\n+   * Get the id for the given `message`.\n+   *\n+   * If we have requested legacy message ids, then try to return the appropriate id\n+   * from the list of legacy ids that were extracted.\n+   *\n+   * Otherwise return the canonical message id.\n+   *\n+   * An Xliff 2.0 legacy message id is a 64 bit number encoded as a decimal string, which will have\n+   * at most 20 digits, since 2^65-1 = 36,893,488,147,419,103,231. This digest is based on:\n+   * https://github.com/google/closure-compiler/blob/master/src/com/google/javascript/jscomp/GoogleJsMessageIdGenerator.java\n+   */\n+  private getMessageId(message: ɵParsedMessage): string {\n+    return this.useLegacyIds && message.legacyIds !== undefined &&\n+        message.legacyIds.find(\n+            id => id.length <= MAX_LEGACY_XLIFF_2_MESSAGE_LENGTH && !/[^0-9]/.test(id)) ||\n+        message.id;\n+  }\n+}"
        },
        {
            "sha": "ffb43834098d4aee41b85dafc96248e17fb737ae",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xmb_translation_serializer.ts",
            "status": "added",
            "additions": 104,
            "deletions": 0,
            "changes": 104,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,104 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {AbsoluteFsPath, relative} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n+\n+import {TranslationSerializer} from './translation_serializer';\n+import {XmlFile} from './xml_file';\n+\n+/**\n+ * A translation serializer that can write files in XMB format.\n+ *\n+ * http://cldr.unicode.org/development/development-process/design-proposals/xmb\n+ *\n+ * @see XmbTranslationParser\n+ */\n+export class XmbTranslationSerializer implements TranslationSerializer {\n+  constructor(private basePath: AbsoluteFsPath, private useLegacyIds: boolean) {}\n+\n+  serialize(messages: ɵParsedMessage[]): string {\n+    const ids = new Set<string>();\n+    const xml = new XmlFile();\n+    xml.rawText(\n+        `<!DOCTYPE messagebundle [\\n` +\n+        `<!ELEMENT messagebundle (msg)*>\\n` +\n+        `<!ATTLIST messagebundle class CDATA #IMPLIED>\\n` +\n+        `\\n` +\n+        `<!ELEMENT msg (#PCDATA|ph|source)*>\\n` +\n+        `<!ATTLIST msg id CDATA #IMPLIED>\\n` +\n+        `<!ATTLIST msg seq CDATA #IMPLIED>\\n` +\n+        `<!ATTLIST msg name CDATA #IMPLIED>\\n` +\n+        `<!ATTLIST msg desc CDATA #IMPLIED>\\n` +\n+        `<!ATTLIST msg meaning CDATA #IMPLIED>\\n` +\n+        `<!ATTLIST msg obsolete (obsolete) #IMPLIED>\\n` +\n+        `<!ATTLIST msg xml:space (default|preserve) \"default\">\\n` +\n+        `<!ATTLIST msg is_hidden CDATA #IMPLIED>\\n` +\n+        `\\n` +\n+        `<!ELEMENT source (#PCDATA)>\\n` +\n+        `\\n` +\n+        `<!ELEMENT ph (#PCDATA|ex)*>\\n` +\n+        `<!ATTLIST ph name CDATA #REQUIRED>\\n` +\n+        `\\n` +\n+        `<!ELEMENT ex (#PCDATA)>\\n` +\n+        `]>\\n`);\n+    xml.startTag('messagebundle');\n+    for (const message of messages) {\n+      const id = this.getMessageId(message);\n+      if (ids.has(id)) {\n+        // Do not render the same message more than once\n+        continue;\n+      }\n+      ids.add(id);\n+      xml.startTag(\n+          'msg', {id, desc: message.description, meaning: message.meaning},\n+          {preserveWhitespace: true});\n+      if (message.location) {\n+        this.serializeLocation(xml, message.location);\n+      }\n+      this.serializeMessage(xml, message);\n+      xml.endTag('msg', {preserveWhitespace: false});\n+    }\n+    xml.endTag('messagebundle');\n+    return xml.toString();\n+  }\n+\n+  private serializeLocation(xml: XmlFile, location: ɵSourceLocation): void {\n+    xml.startTag('source');\n+    const endLineString = location.end !== undefined && location.end.line !== location.start.line ?\n+        `,${location.end.line + 1}` :\n+        '';\n+    xml.text(`${relative(this.basePath, location.file)}:${location.start.line}${endLineString}`);\n+    xml.endTag('source');\n+  }\n+\n+  private serializeMessage(xml: XmlFile, message: ɵParsedMessage): void {\n+    xml.text(message.messageParts[0]);\n+    for (let i = 1; i < message.messageParts.length; i++) {\n+      xml.startTag('ph', {name: message.placeholderNames[i - 1]}, {selfClosing: true});\n+      xml.text(message.messageParts[i]);\n+    }\n+  }\n+\n+  /**\n+   * Get the id for the given `message`.\n+   *\n+   * If we have requested legacy message ids, then try to return the appropriate id\n+   * from the list of legacy ids that were extracted.\n+   *\n+   * Otherwise return the canonical message id.\n+   *\n+   * An XMB legacy message id is a 64 bit number encoded as a decimal string, which will have\n+   * at most 20 digits, since 2^65-1 = 36,893,488,147,419,103,231. This digest is based on:\n+   * https://github.com/google/closure-compiler/blob/master/src/com/google/javascript/jscomp/GoogleJsMessageIdGenerator.java\n+   */\n+  private getMessageId(message: ɵParsedMessage): string {\n+    return this.useLegacyIds && message.legacyIds !== undefined &&\n+        message.legacyIds.find(id => id.length <= 20 && !/[^0-9]/.test(id)) ||\n+        message.id;\n+  }\n+}"
        },
        {
            "sha": "a38ca3b11e737366125db501037cb4aff234056c",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xml_file.ts",
            "status": "added",
            "additions": 106,
            "deletions": 0,
            "changes": 106,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxml_file.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxml_file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxml_file.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,106 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+interface Options {\n+  selfClosing?: boolean;\n+  preserveWhitespace?: boolean;\n+}\n+\n+export class XmlFile {\n+  private output = '<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\\n';\n+  private indent = '';\n+  private elements: string[] = [];\n+  private preservingWhitespace = false;\n+  toString() {\n+    return this.output;\n+  }\n+\n+  startTag(\n+      name: string, attributes: Record<string, string|undefined> = {},\n+      {selfClosing = false, preserveWhitespace}: Options = {}): this {\n+    if (!this.preservingWhitespace) {\n+      this.output += this.indent;\n+    }\n+\n+    this.output += `<${name}`;\n+\n+    for (const [attrName, attrValue] of Object.entries(attributes)) {\n+      if (attrValue) {\n+        this.output += ` ${attrName}=\"${escapeXml(attrValue)}\"`;\n+      }\n+    }\n+\n+    if (selfClosing) {\n+      this.output += '/>';\n+    } else {\n+      this.output += '>';\n+      this.elements.push(name);\n+      this.incIndent();\n+    }\n+\n+    if (preserveWhitespace !== undefined) {\n+      this.preservingWhitespace = preserveWhitespace;\n+    }\n+    if (!this.preservingWhitespace) {\n+      this.output += `\\n`;\n+    }\n+    return this;\n+  }\n+\n+  endTag(name: string, {preserveWhitespace}: Options = {}): this {\n+    const expectedTag = this.elements.pop();\n+    if (expectedTag !== name) {\n+      throw new Error(`Unexpected closing tag: \"${name}\", expected: \"${expectedTag}\"`);\n+    }\n+\n+    this.decIndent();\n+\n+    if (!this.preservingWhitespace) {\n+      this.output += this.indent;\n+    }\n+    this.output += `</${name}>`;\n+\n+    if (preserveWhitespace !== undefined) {\n+      this.preservingWhitespace = preserveWhitespace;\n+    }\n+    if (!this.preservingWhitespace) {\n+      this.output += `\\n`;\n+    }\n+    return this;\n+  }\n+\n+  text(str: string): this {\n+    this.output += escapeXml(str);\n+    return this;\n+  }\n+\n+  rawText(str: string): this {\n+    this.output += str;\n+    return this;\n+  }\n+\n+  private incIndent() {\n+    this.indent = this.indent + '  ';\n+  }\n+  private decIndent() {\n+    this.indent = this.indent.slice(0, -2);\n+  }\n+}\n+\n+const _ESCAPED_CHARS: [RegExp, string][] = [\n+  [/&/g, '&amp;'],\n+  [/\"/g, '&quot;'],\n+  [/'/g, '&apos;'],\n+  [/</g, '&lt;'],\n+  [/>/g, '&gt;'],\n+];\n+\n+function escapeXml(text: string): string {\n+  return _ESCAPED_CHARS.reduce(\n+      (text: string, entry: [RegExp, string]) => text.replace(entry[0], entry[1]), text);\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "898cd1330a9ec0b6b24039bc45699f357c9f9047",
            "filename": "packages/localize/src/tools/src/translate/translation_files/translation_parsers/simple_json_translation_parser.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fsimple_json_translation_parser.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fsimple_json_translation_parser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fsimple_json_translation_parser.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -22,6 +22,8 @@ import {ParsedTranslationBundle, TranslationParser} from './translation_parser';\n  *   }\n  * }\n  * ```\n+ *\n+ * @see SimpleJsonTranslationSerializer\n  */\n export class SimpleJsonTranslationParser implements TranslationParser<Object> {\n   canParse(filePath: string, contents: string): Object|false {"
        },
        {
            "sha": "664ec1c354fd44ee8e92920f84e9d1006757712f",
            "filename": "packages/localize/src/tools/src/translate/translation_files/translation_parsers/xliff1_translation_parser.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fxliff1_translation_parser.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fxliff1_translation_parser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fxliff1_translation_parser.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -22,6 +22,7 @@ import {addParseDiagnostic, addParseError, canParseXml, getAttribute, isNamedEle\n  * http://docs.oasis-open.org/xliff/v1.2/os/xliff-core.html\n  * http://docs.oasis-open.org/xliff/v1.2/xliff-profile-html/xliff-profile-html-1.2.html\n  *\n+ * @see Xliff1TranslationSerializer\n  */\n export class Xliff1TranslationParser implements TranslationParser<XmlTranslationParserHint> {\n   canParse(filePath: string, contents: string): XmlTranslationParserHint|false {"
        },
        {
            "sha": "7c83283e19e6e9ce0f38230e72ef730daf031e1b",
            "filename": "packages/localize/src/tools/src/translate/translation_files/translation_parsers/xliff2_translation_parser.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fxliff2_translation_parser.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fxliff2_translation_parser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fxliff2_translation_parser.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -21,6 +21,7 @@ import {addParseDiagnostic, addParseError, canParseXml, getAttribute, isNamedEle\n  *\n  * http://docs.oasis-open.org/xliff/xliff-core/v2.0/os/xliff-core-v2.0-os.html\n  *\n+ * @see Xliff2TranslationSerializer\n  */\n export class Xliff2TranslationParser implements TranslationParser<XmlTranslationParserHint> {\n   canParse(filePath: string, contents: string): XmlTranslationParserHint|false {"
        },
        {
            "sha": "494158dd8cfb5d31b4bbb0e1383f695eae37cd5e",
            "filename": "packages/localize/src/tools/src/translate/translation_files/translation_parsers/xtb_translation_parser.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fxtb_translation_parser.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fxtb_translation_parser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Fxtb_translation_parser.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -19,7 +19,11 @@ import {addParseDiagnostic, addParseError, canParseXml, getAttribute, parseInner\n \n \n /**\n- * A translation parser that can load XB files.\n+ * A translation parser that can load XTB files.\n+ *\n+ * http://cldr.unicode.org/development/development-process/design-proposals/xmb\n+ *\n+ * @see XmbTranslationSerializer\n  */\n export class XtbTranslationParser implements TranslationParser<XmlTranslationParserHint> {\n   canParse(filePath: string, contents: string): XmlTranslationParserHint|false {"
        },
        {
            "sha": "c441be3b2ecb92ff11184de8f1b1946896413263",
            "filename": "packages/localize/src/tools/test/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2FBUILD.bazel?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -4,15 +4,17 @@ ts_library(\n     name = \"test_lib\",\n     testonly = True,\n     srcs = glob(\n-        [\"**/*_spec.ts\"],\n+        [\"**/*.ts\"],\n     ),\n     deps = [\n         \"//packages:types\",\n         \"//packages/compiler\",\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n+        \"//packages/compiler-cli/src/ngtsc/logging/testing\",\n         \"//packages/localize\",\n         \"//packages/localize/src/tools\",\n+        \"//packages/localize/src/utils\",\n         \"@npm//@babel/core\",\n         \"@npm//@babel/generator\",\n         \"@npm//@babel/template\","
        },
        {
            "sha": "7c4c4d4f36d3874157b156265c524550b010b28d",
            "filename": "packages/localize/src/tools/test/extract/extractor_spec.ts",
            "status": "added",
            "additions": 57,
            "deletions": 0,
            "changes": 57,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fextractor_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fextractor_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fextractor_spec.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,57 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {absoluteFrom, getFileSystem, relativeFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n+import {MockLogger} from '@angular/compiler-cli/src/ngtsc/logging/testing';\n+\n+import {MessageExtractor} from '../../src/extract/extraction';\n+\n+runInEachFileSystem(() => {\n+  describe('extractMessages', () => {\n+    it('should extract a message for each $localize template tag', () => {\n+      const fs = getFileSystem();\n+      const logger = new MockLogger();\n+      const basePath = absoluteFrom('/root/path/');\n+      const filename = 'relative/path.js';\n+      const file = fs.resolve(basePath, filename);\n+      const extractor = new MessageExtractor(fs, logger, {basePath});\n+      fs.ensureDir(absoluteFrom('/root/path/relative'));\n+      fs.writeFile(file, [\n+        '$localize`:meaning|description:a${1}b${2}c`;',\n+        '$localize(__makeTemplateObject([\"a\", \":custom-placeholder:b\", \"c\"], [\"a\", \":custom-placeholder:b\", \"c\"]), 1, 2);'\n+      ].join('\\n'));\n+      const messages = extractor.extractMessages(filename);\n+\n+      expect(messages.length).toEqual(2);\n+\n+      expect(messages[0]).toEqual({\n+        id: '2714330828844000684',\n+        description: 'description',\n+        meaning: 'meaning',\n+        messageParts: ['a', 'b', 'c'],\n+        text: 'a{$PH}b{$PH_1}c',\n+        placeholderNames: ['PH', 'PH_1'],\n+        substitutions: jasmine.any(Object),\n+        legacyIds: [],\n+        location: {start: {line: 0, column: 9}, end: {line: 0, column: 43}, file},\n+      });\n+\n+      expect(messages[1]).toEqual({\n+        id: '5692770902395945649',\n+        description: '',\n+        meaning: '',\n+        messageParts: ['a', 'b', 'c'],\n+        text: 'a{$custom-placeholder}b{$PH_1}c',\n+        placeholderNames: ['custom-placeholder', 'PH_1'],\n+        substitutions: jasmine.any(Object),\n+        legacyIds: [],\n+        location: {start: {line: 1, column: 0}, end: {line: 1, column: 111}, file},\n+      });\n+    });\n+  });\n+});"
        },
        {
            "sha": "bad294d09dacd63f15639380d00641e12fb11cba",
            "filename": "packages/localize/src/tools/test/extract/integration/BUILD.bazel",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2FBUILD.bazel?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,33 @@\n+load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n+\n+ts_library(\n+    name = \"test_lib\",\n+    testonly = True,\n+    srcs = glob(\n+        [\"**/*_spec.ts\"],\n+    ),\n+    deps = [\n+        \"//packages:types\",\n+        \"//packages/compiler-cli/src/ngtsc/file_system\",\n+        \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n+        \"//packages/compiler-cli/src/ngtsc/logging\",\n+        \"//packages/compiler-cli/src/ngtsc/logging/testing\",\n+        \"//packages/compiler-cli/test/helpers\",\n+        \"//packages/localize/src/tools\",\n+    ],\n+)\n+\n+jasmine_node_test(\n+    name = \"integration\",\n+    bootstrap = [\"//tools/testing:node_no_angular_es5\"],\n+    data = [\n+        \"//packages/localize/src/tools/test/extract/integration/test_files\",\n+        \"//packages/localize/src/tools/test/extract/integration/test_files:compile_es2015\",\n+        \"//packages/localize/src/tools/test/extract/integration/test_files:compile_es5\",\n+    ],\n+    deps = [\n+        \":test_lib\",\n+        \"@npm//glob\",\n+        \"@npm//yargs\",\n+    ],\n+)"
        },
        {
            "sha": "bb7d19c2ee315ac2f1e70dc2f4db30d27bafea4d",
            "filename": "packages/localize/src/tools/test/extract/integration/main_spec.ts",
            "status": "added",
            "additions": 228,
            "deletions": 0,
            "changes": 228,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,228 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n+import {Logger} from '@angular/compiler-cli/src/ngtsc/logging';\n+import {MockLogger} from '@angular/compiler-cli/src/ngtsc/logging/testing';\n+import {loadTestDirectory} from '@angular/compiler-cli/test/helpers';\n+\n+import {extractTranslations} from '../../../src/extract/main';\n+\n+runInEachFileSystem(() => {\n+  let fs: FileSystem;\n+  let logger: Logger;\n+  let rootPath: AbsoluteFsPath;\n+  let outputPath: AbsoluteFsPath;\n+  let sourceFilePath: AbsoluteFsPath;\n+  let textFile1: AbsoluteFsPath;\n+  let textFile2: AbsoluteFsPath;\n+\n+  beforeEach(() => {\n+    fs = getFileSystem();\n+    logger = new MockLogger();\n+    rootPath = absoluteFrom('/project');\n+    outputPath = fs.resolve(rootPath, 'extracted-message-file');\n+    sourceFilePath = fs.resolve(rootPath, 'test_files/test.js');\n+    textFile1 = fs.resolve(rootPath, 'test_files/test-1.txt');\n+    textFile2 = fs.resolve(rootPath, 'test_files/test-2.txt');\n+\n+    fs.ensureDir(fs.dirname(sourceFilePath));\n+    loadTestDirectory(fs, __dirname + '/test_files', absoluteFrom('/project/test_files'));\n+  });\n+\n+  describe('extractTranslations()', () => {\n+    it('should ignore non-code files', () => {\n+      extractTranslations({\n+        rootPath,\n+        sourceLocale: 'en',\n+        sourceFilePaths: [],\n+        format: 'json',\n+        outputPath,\n+        logger,\n+        useSourceMaps: false,\n+        useLegacyIds: false,\n+      });\n+      expect(fs.readFile(outputPath)).toEqual([\n+        `{`,\n+        `  \"locale\": \"en\",`,\n+        `  \"translations\": {}`,\n+        `}`,\n+      ].join('\\n'));\n+    });\n+\n+    it('should extract translations from source code, and write as JSON format', () => {\n+      extractTranslations({\n+        rootPath,\n+        sourceLocale: 'en-GB',\n+        sourceFilePaths: [sourceFilePath],\n+        format: 'json',\n+        outputPath,\n+        logger,\n+        useSourceMaps: false,\n+        useLegacyIds: false,\n+      });\n+      expect(fs.readFile(outputPath)).toEqual([\n+        `{`,\n+        `  \"locale\": \"en-GB\",`,\n+        `  \"translations\": {`,\n+        `    \"3291030485717846467\": \"Hello, {$PH}!\",`,\n+        `    \"8669027859022295761\": \"try{$PH}me\"`,\n+        `  }`,\n+        `}`,\n+      ].join('\\n'));\n+    });\n+\n+    it('should extract translations from source code, and write as xmb format', () => {\n+      extractTranslations({\n+        rootPath,\n+        sourceLocale: 'en',\n+        sourceFilePaths: [sourceFilePath],\n+        format: 'xmb',\n+        outputPath,\n+        logger,\n+        useSourceMaps: false,\n+        useLegacyIds: false,\n+      });\n+      expect(fs.readFile(outputPath)).toEqual([\n+        `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n+        `<!DOCTYPE messagebundle [`,\n+        `<!ELEMENT messagebundle (msg)*>`,\n+        `<!ATTLIST messagebundle class CDATA #IMPLIED>`,\n+        ``,\n+        `<!ELEMENT msg (#PCDATA|ph|source)*>`,\n+        `<!ATTLIST msg id CDATA #IMPLIED>`,\n+        `<!ATTLIST msg seq CDATA #IMPLIED>`,\n+        `<!ATTLIST msg name CDATA #IMPLIED>`,\n+        `<!ATTLIST msg desc CDATA #IMPLIED>`,\n+        `<!ATTLIST msg meaning CDATA #IMPLIED>`,\n+        `<!ATTLIST msg obsolete (obsolete) #IMPLIED>`,\n+        `<!ATTLIST msg xml:space (default|preserve) \"default\">`,\n+        `<!ATTLIST msg is_hidden CDATA #IMPLIED>`,\n+        ``,\n+        `<!ELEMENT source (#PCDATA)>`,\n+        ``,\n+        `<!ELEMENT ph (#PCDATA|ex)*>`,\n+        `<!ATTLIST ph name CDATA #REQUIRED>`,\n+        ``,\n+        `<!ELEMENT ex (#PCDATA)>`,\n+        `]>`,\n+        `<messagebundle>`,\n+        `  <msg id=\"3291030485717846467\"><source>test_files/test.js:1</source>Hello, <ph name=\"PH\"/>!</msg>`,\n+        `  <msg id=\"8669027859022295761\"><source>test_files/test.js:2</source>try<ph name=\"PH\"/>me</msg>`,\n+        `</messagebundle>\\n`,\n+      ].join('\\n'));\n+    });\n+\n+    it('should extract translations from source code, and write as XLIFF 1.2 format', () => {\n+      extractTranslations({\n+        rootPath,\n+        sourceLocale: 'en-CA',\n+        sourceFilePaths: [sourceFilePath],\n+        format: 'xliff',\n+        outputPath,\n+        logger,\n+        useSourceMaps: false,\n+        useLegacyIds: false,\n+      });\n+      expect(fs.readFile(outputPath)).toEqual([\n+        `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n+        `<xliff version=\"1.2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">`,\n+        `  <file source-language=\"en-CA\" datatype=\"plaintext\">`,\n+        `    <body>`,\n+        `      <trans-unit id=\"3291030485717846467\" datatype=\"html\">`,\n+        `        <source>Hello, <x id=\"PH\"/>!</source>`,\n+        `        <context-group purpose=\"location\">`,\n+        `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n+        `          <context context-type=\"linenumber\">2</context>`,\n+        `        </context-group>`,\n+        `      </trans-unit>`,\n+        `      <trans-unit id=\"8669027859022295761\" datatype=\"html\">`,\n+        `        <source>try<x id=\"PH\"/>me</source>`,\n+        `        <context-group purpose=\"location\">`,\n+        `          <context context-type=\"sourcefile\">test_files/test.js</context>`,\n+        `          <context context-type=\"linenumber\">3</context>`,\n+        `        </context-group>`,\n+        `      </trans-unit>`,\n+        `    </body>`,\n+        `  </file>`,\n+        `</xliff>\\n`,\n+      ].join('\\n'));\n+    });\n+\n+    it('should extract translations from source code, and write as XLIFF 2 format', () => {\n+      extractTranslations({\n+        rootPath,\n+        sourceLocale: 'en-AU',\n+        sourceFilePaths: [sourceFilePath],\n+        format: 'xliff2',\n+        outputPath,\n+        logger,\n+        useSourceMaps: false,\n+        useLegacyIds: false,\n+      });\n+      expect(fs.readFile(outputPath)).toEqual([\n+        `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n+        `<xliff version=\"2.0\" xmlns=\"urn:oasis:names:tc:xliff:document:2.0\" srcLang=\"en-AU\">`,\n+        `  <file>`,\n+        `    <unit id=\"3291030485717846467\">`,\n+        `      <segment>`,\n+        `        <source>Hello, <ph id=\"1\" equiv=\"PH\"/>!</source>`,\n+        `      </segment>`,\n+        `    </unit>`,\n+        `    <unit id=\"8669027859022295761\">`,\n+        `      <segment>`,\n+        `        <source>try<ph id=\"1\" equiv=\"PH\"/>me</source>`,\n+        `      </segment>`,\n+        `    </unit>`,\n+        `  </file>`,\n+        `</xliff>\\n`,\n+      ].join('\\n'));\n+    });\n+\n+    for (const target of ['es2015', 'es5']) {\n+      it(`should render the original location of translations, when processing an ${\n+             target} bundle with source-maps`,\n+         () => {\n+           extractTranslations({\n+             rootPath,\n+             sourceLocale: 'en-CA',\n+             sourceFilePaths: [fs.resolve(rootPath, `test_files/dist_${target}/index.js`)],\n+             format: 'xliff',\n+             outputPath,\n+             logger,\n+             useSourceMaps: true,\n+             useLegacyIds: false,\n+           });\n+           expect(fs.readFile(outputPath)).toEqual([\n+             `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n+             `<xliff version=\"1.2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">`,\n+             `  <file source-language=\"en-CA\" datatype=\"plaintext\">`,\n+             `    <body>`,\n+             `      <trans-unit id=\"157258427077572998\" datatype=\"html\">`,\n+             `        <source>Message in <x id=\"a-file\"/>!</source>`,\n+             `        <context-group purpose=\"location\">`,\n+             // These source file paths are due to how Bazel TypeScript compilation source-maps work\n+             `          <context context-type=\"sourcefile\">../packages/localize/src/tools/test/extract/integration/test_files/src/a.ts</context>`,\n+             `          <context context-type=\"linenumber\">3</context>`,\n+             `        </context-group>`,\n+             `      </trans-unit>`,\n+             `      <trans-unit id=\"7829869508202074508\" datatype=\"html\">`,\n+             `        <source>Message in <x id=\"b-file\"/>!</source>`,\n+             `        <context-group purpose=\"location\">`,\n+             `          <context context-type=\"sourcefile\">../packages/localize/src/tools/test/extract/integration/test_files/src/b.ts</context>`,\n+             `          <context context-type=\"linenumber\">3</context>`,\n+             `        </context-group>`,\n+             `      </trans-unit>`,\n+             `    </body>`,\n+             `  </file>`,\n+             `</xliff>\\n`,\n+           ].join('\\n'));\n+         });\n+    }\n+  });\n+});"
        },
        {
            "sha": "3abde62d1091885db3bc15ce528402fe34a1d220",
            "filename": "packages/localize/src/tools/test/extract/integration/test_files/BUILD.bazel",
            "status": "added",
            "additions": 54,
            "deletions": 0,
            "changes": 54,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2FBUILD.bazel?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,54 @@\n+package(default_visibility = [\"//packages/localize/src/tools/test/extract/integration:__pkg__\"])\n+\n+load(\"@npm//typescript:index.bzl\", \"tsc\")\n+\n+tsc(\n+    name = \"compile_es5\",\n+    outs = [\n+        \"dist_es5/index.js\",\n+        \"dist_es5/index.js.map\",\n+    ],\n+    args = [\n+        \"--target\",\n+        \"es5\",\n+        \"--module\",\n+        \"amd\",\n+        \"--outFile\",\n+        \"$(execpath dist_es5/index.js)\",\n+        \"--skipLibCheck\",\n+        \"--sourceMap\",\n+        \"--inlineSources\",\n+        \"$(execpath src/index.ts)\",\n+    ],\n+    data = glob([\"src/*.ts\"]),\n+)\n+\n+tsc(\n+    name = \"compile_es2015\",\n+    outs = [\n+        \"dist_es2015/index.js\",\n+        \"dist_es2015/index.js.map\",\n+    ],\n+    args = [\n+        \"--target\",\n+        \"es2015\",\n+        \"--module\",\n+        \"amd\",\n+        \"--outFile\",\n+        \"$(execpath dist_es2015/index.js)\",\n+        \"--skipLibCheck\",\n+        \"--sourceMap\",\n+        \"--inlineSources\",\n+        \"$(execpath src/index.ts)\",\n+    ],\n+    data = glob([\"src/*.ts\"]),\n+)\n+\n+filegroup(\n+    name = \"test_files\",\n+    srcs = glob([\n+        \"**/*.js\",\n+        \"**/*.txt\",\n+        \"**/*.ts\",\n+    ]),\n+)"
        },
        {
            "sha": "47da6f3f06f0a96a0058e1c6a52bd826d95d4e84",
            "filename": "packages/localize/src/tools/test/extract/integration/test_files/src/a.ts",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Fsrc%2Fa.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Fsrc%2Fa.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Fsrc%2Fa.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,3 @@\n+declare const $localize: any;\n+const file = 'a.ts';\n+export const messageA = $localize`Message in ${file}:a-file:!`;"
        },
        {
            "sha": "430df79309e3d8874421d335e4ce2f15b0dfb5f7",
            "filename": "packages/localize/src/tools/test/extract/integration/test_files/src/b.ts",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Fsrc%2Fb.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Fsrc%2Fb.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Fsrc%2Fb.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,3 @@\n+declare const $localize: any;\n+const file = 'b.ts';\n+export const messageB = $localize`Message in ${file}:b-file:!`;"
        },
        {
            "sha": "b8e0ef47e6680cd91ac6c9b8fb6def247f3a274c",
            "filename": "packages/localize/src/tools/test/extract/integration/test_files/src/index.ts",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Fsrc%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Fsrc%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Fsrc%2Findex.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,2 @@\n+export * from './a';\n+export * from './b';"
        },
        {
            "sha": "46a9dd3a2d97f8bfa244a7aa8b23bc5e6a7a643f",
            "filename": "packages/localize/src/tools/test/extract/integration/test_files/test-1.txt",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest-1.txt",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest-1.txt",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest-1.txt?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1 @@\n+Contents of test-1.txt\n\\ No newline at end of file"
        },
        {
            "sha": "b48d58aff5755ca4e60d31de33961cae3d2b9548",
            "filename": "packages/localize/src/tools/test/extract/integration/test_files/test-2.txt",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest-2.txt",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest-2.txt",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest-2.txt?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1 @@\n+Contents of test-2.txt\n\\ No newline at end of file"
        },
        {
            "sha": "cef3d9603220cd847b185922df3a6da402add725",
            "filename": "packages/localize/src/tools/test/extract/integration/test_files/test.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest.js",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2Ftest.js?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,3 @@\n+var name = 'World';\n+var message = $localize`Hello, ${name}!`;\n+var other = $localize(__makeTemplateObject(['try', 'me'], ['try', 'me']), 40 + 2);\n\\ No newline at end of file"
        },
        {
            "sha": "bcfa7bd36e7fc43fa9620cab71c5c63646d98529",
            "filename": "packages/localize/src/tools/test/extract/translation_files/json_translation_serializer_spec.ts",
            "status": "added",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fjson_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fjson_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fjson_translation_serializer_spec.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,42 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {ɵParsedMessage} from '@angular/localize';\n+\n+import {SimpleJsonTranslationSerializer} from '../../../src/extract/translation_files/json_translation_serializer';\n+\n+import {mockMessage} from './mock_message';\n+\n+describe('JsonTranslationSerializer', () => {\n+  describe('renderFile()', () => {\n+    it('should convert a set of parsed messages into a JSON string', () => {\n+      const messages: ɵParsedMessage[] = [\n+        mockMessage('12345', ['a', 'b', 'c'], ['PH', 'PH_1'], {meaning: 'some meaning'}),\n+        mockMessage(\n+            '67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'],\n+            {description: 'some description'}),\n+        mockMessage('13579', ['', 'b', ''], ['START_BOLD_TEXT', 'CLOSE_BOLD_TEXT'], {}),\n+        mockMessage('24680', ['a'], [], {meaning: 'meaning', description: 'and description'}),\n+        mockMessage('80808', ['multi\\nlines'], [], {}),\n+      ];\n+      const serializer = new SimpleJsonTranslationSerializer('xx');\n+      const output = serializer.serialize(messages);\n+      expect(output).toEqual([\n+        `{`,\n+        `  \"locale\": \"xx\",`,\n+        `  \"translations\": {`,\n+        `    \"12345\": \"a{$PH}b{$PH_1}c\",`,\n+        `    \"13579\": \"{$START_BOLD_TEXT}b{$CLOSE_BOLD_TEXT}\",`,\n+        `    \"24680\": \"a\",`,\n+        `    \"67890\": \"a{$START_TAG_SPAN}{$CLOSE_TAG_SPAN}c\",`,\n+        `    \"80808\": \"multi\\\\nlines\"`,\n+        `  }`,\n+        `}`,\n+      ].join('\\n'));\n+    });\n+  });\n+});"
        },
        {
            "sha": "ec8a74717387afaa26d547ae0ba50aa883102fec",
            "filename": "packages/localize/src/tools/test/extract/translation_files/mock_message.ts",
            "status": "added",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fmock_message.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fmock_message.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fmock_message.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,40 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {ɵParsedMessage} from '@angular/localize';\n+import {SourceLocation} from '@angular/localize/src/utils';\n+\n+export interface MockMessageOptions {\n+  meaning?: string;\n+  description?: string;\n+  location?: SourceLocation;\n+  legacyIds?: string[];\n+}\n+/**\n+ * This helper is used to create `ParsedMessage` objects to be rendered in the\n+ * `TranslationSerializer` tests.\n+ */\n+export function mockMessage(\n+    id: string, messageParts: string[], placeholderNames: string[],\n+    {meaning = '', description = '', location, legacyIds = []}: MockMessageOptions):\n+    ɵParsedMessage {\n+  let text = messageParts[0];\n+  for (let i = 1; i < messageParts.length; i++) {\n+    text += `{$${placeholderNames[i - 1]}}${messageParts[i]}`;\n+  }\n+  return {\n+    id,\n+    text,\n+    messageParts,\n+    placeholderNames,\n+    description,\n+    meaning,\n+    substitutions: [],\n+    legacyIds,\n+    location,\n+  };\n+}"
        },
        {
            "sha": "2b89404fe22d118a8aeeb1e3b5e64f16f503aa3f",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xliff1_translation_serializer_spec.ts",
            "status": "added",
            "additions": 84,
            "deletions": 0,
            "changes": 84,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,84 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {absoluteFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n+import {ɵParsedMessage} from '@angular/localize';\n+\n+import {Xliff1TranslationSerializer} from '../../../src/extract/translation_files/xliff1_translation_serializer';\n+\n+import {mockMessage} from './mock_message';\n+\n+runInEachFileSystem(() => {\n+  describe('Xliff1TranslationSerializer', () => {\n+    [false, true].forEach(useLegacyIds => {\n+      describe(`renderFile() [using ${useLegacyIds ? 'legacy' : 'canonical'} ids]`, () => {\n+        it('should convert a set of parsed messages into an XML string', () => {\n+          const messages: ɵParsedMessage[] = [\n+            mockMessage('12345', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n+              meaning: 'some meaning',\n+              location: {\n+                file: absoluteFrom('/project/file.ts'),\n+                start: {line: 5, column: 10},\n+                end: {line: 5, column: 12}\n+              },\n+              legacyIds: ['1234567890ABCDEF1234567890ABCDEF12345678', '615790887472569365'],\n+            }),\n+            mockMessage(\n+                '67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'],\n+                {description: 'some description'}),\n+            mockMessage('13579', ['', 'b', ''], ['START_BOLD_TEXT', 'CLOSE_BOLD_TEXT'], {}),\n+            mockMessage('24680', ['a'], [], {meaning: 'meaning', description: 'and description'}),\n+            mockMessage('80808', ['multi\\nlines'], [], {}),\n+            mockMessage('90000', ['<escape', 'me>'], ['double-quotes-\"'], {})\n+          ];\n+          const serializer =\n+              new Xliff1TranslationSerializer('xx', absoluteFrom('/project'), useLegacyIds);\n+          const output = serializer.serialize(messages);\n+          expect(output).toEqual([\n+            `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n+            `<xliff version=\"1.2\" xmlns=\"urn:oasis:names:tc:xliff:document:1.2\">`,\n+            `  <file source-language=\"xx\" datatype=\"plaintext\">`,\n+            `    <body>`,\n+            `      <trans-unit id=\"${\n+                useLegacyIds ? '1234567890ABCDEF1234567890ABCDEF12345678' :\n+                               '12345'}\" datatype=\"html\">`,\n+            `        <source>a<x id=\"PH\"/>b<x id=\"PH_1\"/>c</source>`,\n+            `        <context-group purpose=\"location\">`,\n+            `          <context context-type=\"sourcefile\">file.ts</context>`,\n+            `          <context context-type=\"linenumber\">6</context>`,\n+            `        </context-group>`,\n+            `        <note priority=\"1\" from=\"meaning\">some meaning</note>`,\n+            `      </trans-unit>`,\n+            `      <trans-unit id=\"67890\" datatype=\"html\">`,\n+            `        <source>a<x id=\"START_TAG_SPAN\"/><x id=\"CLOSE_TAG_SPAN\"/>c</source>`,\n+            `        <note priority=\"1\" from=\"description\">some description</note>`,\n+            `      </trans-unit>`,\n+            `      <trans-unit id=\"13579\" datatype=\"html\">`,\n+            `        <source><x id=\"START_BOLD_TEXT\"/>b<x id=\"CLOSE_BOLD_TEXT\"/></source>`,\n+            `      </trans-unit>`,\n+            `      <trans-unit id=\"24680\" datatype=\"html\">`,\n+            `        <source>a</source>`,\n+            `        <note priority=\"1\" from=\"description\">and description</note>`,\n+            `        <note priority=\"1\" from=\"meaning\">meaning</note>`,\n+            `      </trans-unit>`,\n+            `      <trans-unit id=\"80808\" datatype=\"html\">`,\n+            `        <source>multi`,\n+            `lines</source>`,\n+            `      </trans-unit>`,\n+            `      <trans-unit id=\"90000\" datatype=\"html\">`,\n+            `        <source>&lt;escape<x id=\"double-quotes-&quot;\"/>me&gt;</source>`,\n+            `      </trans-unit>`,\n+            `    </body>`,\n+            `  </file>`,\n+            `</xliff>\\n`,\n+          ].join('\\n'));\n+        });\n+      });\n+    });\n+  });\n+});"
        },
        {
            "sha": "dbbf0fe84d724ccc4f44685c099971f575c3a008",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xliff2_translation_serializer_spec.ts",
            "status": "added",
            "additions": 102,
            "deletions": 0,
            "changes": 102,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,102 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {computeMsgId} from '@angular/compiler';\n+import {absoluteFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n+import {ɵParsedMessage} from '@angular/localize';\n+\n+import {Xliff2TranslationSerializer} from '../../../src/extract/translation_files/xliff2_translation_serializer';\n+\n+import {mockMessage} from './mock_message';\n+\n+runInEachFileSystem(() => {\n+  describe('Xliff2TranslationSerializer', () => {\n+    [false, true].forEach(useLegacyIds => {\n+      describe(`renderFile() [using ${useLegacyIds ? 'legacy' : 'canonical'} ids]`, () => {\n+        it('should convert a set of parsed messages into an XML string', () => {\n+          const messages: ɵParsedMessage[] = [\n+            mockMessage('12345', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n+              meaning: 'some meaning',\n+              location: {\n+                file: absoluteFrom('/project/file.ts'),\n+                start: {line: 5, column: 0},\n+                end: {line: 5, column: 3}\n+              },\n+              legacyIds: ['1234567890ABCDEF1234567890ABCDEF12345678', '615790887472569365'],\n+            }),\n+            mockMessage('67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'], {\n+              description: 'some description',\n+              location: {\n+                file: absoluteFrom('/project/file.ts'),\n+                start: {line: 2, column: 7},\n+                end: {line: 3, column: 2}\n+              }\n+            }),\n+            mockMessage('13579', ['', 'b', ''], ['START_BOLD_TEXT', 'CLOSE_BOLD_TEXT'], {}),\n+            mockMessage('24680', ['a'], [], {meaning: 'meaning', description: 'and description'}),\n+            mockMessage('80808', ['multi\\nlines'], [], {}),\n+            mockMessage('90000', ['<escape', 'me>'], ['double-quotes-\"'], {})\n+          ];\n+          const serializer =\n+              new Xliff2TranslationSerializer('xx', absoluteFrom('/project'), useLegacyIds);\n+          const output = serializer.serialize(messages);\n+          expect(output).toEqual([\n+            `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n+            `<xliff version=\"2.0\" xmlns=\"urn:oasis:names:tc:xliff:document:2.0\" srcLang=\"xx\">`,\n+            `  <file>`,\n+            `    <unit id=\"${useLegacyIds ? '615790887472569365' : '12345'}\">`,\n+            `      <notes>`,\n+            `        <note category=\"location\">file.ts:6</note>`,\n+            `        <note category=\"meaning\">some meaning</note>`,\n+            `      </notes>`,\n+            `      <segment>`,\n+            `        <source>a<ph id=\"1\" equiv=\"PH\"/>b<ph id=\"2\" equiv=\"PH_1\"/>c</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n+            `    <unit id=\"67890\">`,\n+            `      <notes>`,\n+            `        <note category=\"location\">file.ts:3,4</note>`,\n+            `        <note category=\"description\">some description</note>`,\n+            `      </notes>`,\n+            `      <segment>`,\n+            `        <source>a<pc id=\"1\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\"></pc>c</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n+            `    <unit id=\"13579\">`,\n+            `      <segment>`,\n+            `        <source><pc id=\"1\" equivStart=\"START_BOLD_TEXT\" equivEnd=\"CLOSE_BOLD_TEXT\">b</pc></source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n+            `    <unit id=\"24680\">`,\n+            `      <notes>`,\n+            `        <note category=\"description\">and description</note>`,\n+            `        <note category=\"meaning\">meaning</note>`,\n+            `      </notes>`,\n+            `      <segment>`,\n+            `        <source>a</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n+            `    <unit id=\"80808\">`,\n+            `      <segment>`,\n+            `        <source>multi`,\n+            `lines</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n+            `    <unit id=\"90000\">`,\n+            `      <segment>`,\n+            `        <source>&lt;escape<ph id=\"1\" equiv=\"double-quotes-&quot;\"/>me&gt;</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n+            `  </file>`,\n+            `</xliff>\\n`,\n+          ].join('\\n'));\n+        });\n+      });\n+    });\n+  });\n+});"
        },
        {
            "sha": "45a1608334913ebf0bf0c92fa3c9ce53c509531a",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xmb_translation_serializer_spec.ts",
            "status": "added",
            "additions": 53,
            "deletions": 0,
            "changes": 53,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer_spec.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -0,0 +1,53 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {absoluteFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n+import {ɵParsedMessage} from '@angular/localize';\n+\n+import {XmbTranslationSerializer} from '../../../src/extract/translation_files/xmb_translation_serializer';\n+\n+import {mockMessage} from './mock_message';\n+\n+runInEachFileSystem(() => {\n+  describe('XmbTranslationSerializer', () => {\n+    [false, true].forEach(useLegacyIds => {\n+      describe(`renderFile() [using ${useLegacyIds ? 'legacy' : 'canonical'} ids]`, () => {\n+        it('should convert a set of parsed messages into an XML string', () => {\n+          const messages: ɵParsedMessage[] = [\n+            mockMessage('12345', ['a', 'b', 'c'], ['PH', 'PH_1'], {\n+              meaning: 'some meaning',\n+              legacyIds: ['1234567890ABCDEF1234567890ABCDEF12345678', '615790887472569365'],\n+            }),\n+            mockMessage(\n+                '67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'],\n+                {description: 'some description'}),\n+            mockMessage('13579', ['', 'b', ''], ['START_BOLD_TEXT', 'CLOSE_BOLD_TEXT'], {}),\n+            mockMessage('24680', ['a'], [], {meaning: 'meaning', description: 'and description'}),\n+            mockMessage('80808', ['multi\\nlines'], [], {}),\n+            mockMessage('90000', ['<escape', 'me>'], ['double-quotes-\"'], {}),\n+          ];\n+          const serializer = new XmbTranslationSerializer(absoluteFrom('/project'), useLegacyIds);\n+          const output = serializer.serialize(messages);\n+          expect(output).toContain([\n+            `<messagebundle>`,\n+            `  <msg id=\"${\n+                useLegacyIds ?\n+                    '615790887472569365' :\n+                    '12345'}\" meaning=\"some meaning\">a<ph name=\"PH\"/>b<ph name=\"PH_1\"/>c</msg>`,\n+            `  <msg id=\"67890\" desc=\"some description\">a<ph name=\"START_TAG_SPAN\"/><ph name=\"CLOSE_TAG_SPAN\"/>c</msg>`,\n+            `  <msg id=\"13579\"><ph name=\"START_BOLD_TEXT\"/>b<ph name=\"CLOSE_BOLD_TEXT\"/></msg>`,\n+            `  <msg id=\"24680\" desc=\"and description\" meaning=\"meaning\">a</msg>`,\n+            `  <msg id=\"80808\">multi`, `lines</msg>`,\n+            `  <msg id=\"90000\">&lt;escape<ph name=\"double-quotes-&quot;\"/>me&gt;</msg>`,\n+            `</messagebundle>\\n`\n+          ].join('\\n'));\n+        });\n+      });\n+    });\n+  });\n+});"
        },
        {
            "sha": "46663cf90f6b1f5f8c46f1292b6ff6d2a9394b4f",
            "filename": "packages/localize/src/utils/src/messages.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Futils%2Fsrc%2Fmessages.ts",
            "raw_url": "https://github.com/angular/angular/raw/190561d8a614acf6ee7183cd432637bbe03483f4/packages%2Flocalize%2Fsrc%2Futils%2Fsrc%2Fmessages.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Futils%2Fsrc%2Fmessages.ts?ref=190561d8a614acf6ee7183cd432637bbe03483f4",
            "patch": "@@ -152,7 +152,7 @@ export function parseMessage(\n     cleanedMessageParts.push(messagePart);\n   }\n   const messageId = metadata.id || computeMsgId(messageString, metadata.meaning || '');\n-  const legacyIds = metadata.legacyIds && metadata.legacyIds.filter(id => id !== messageId);\n+  const legacyIds = metadata.legacyIds ? metadata.legacyIds.filter(id => id !== messageId) : [];\n   return {\n     id: messageId,\n     legacyIds,"
        }
    ],
    "stats": {
        "total": 1565,
        "additions": 1561,
        "deletions": 4
    }
}