{
    "author": "josephperrott",
    "message": "feat(dev-infra): update commit-message functions to properly type commits from git log (#41458)\n\nFor commits from git log entries additional fields are available such as the reference\nhash and author name, update the utility functions in commit-message to include the\nparsed fields.  Additionally define, per commit message type, whether to include the\ncommit in a release notes entry.\n\nPR Close #41458",
    "sha": "c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f",
    "files": [
        {
            "sha": "4675498cb5729d4b17d4a66ab1f0aae953fe86a4",
            "filename": "dev-infra/commit-message/config.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f/dev-infra%2Fcommit-message%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f/dev-infra%2Fcommit-message%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fconfig.ts?ref=c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f",
            "patch": "@@ -38,11 +38,17 @@ export enum ScopeRequirement {\n   Forbidden,\n }\n \n+export enum ReleaseNotesLevel {\n+  Hidden,\n+  Visible,\n+}\n+\n /** A commit type */\n export interface CommitType {\n   description: string;\n   name: string;\n   scope: ScopeRequirement;\n+  releaseNotesLevel: ReleaseNotesLevel;\n }\n \n /** The valid commit types for Angular commit messages. */\n@@ -51,45 +57,54 @@ export const COMMIT_TYPES: {[key: string]: CommitType} = {\n     name: 'build',\n     description: 'Changes to local repository build system and tooling',\n     scope: ScopeRequirement.Optional,\n+    releaseNotesLevel: ReleaseNotesLevel.Hidden,\n   },\n   ci: {\n     name: 'ci',\n     description: 'Changes to CI configuration and CI specific tooling',\n     scope: ScopeRequirement.Forbidden,\n+    releaseNotesLevel: ReleaseNotesLevel.Hidden,\n   },\n   docs: {\n     name: 'docs',\n     description: 'Changes which exclusively affects documentation.',\n     scope: ScopeRequirement.Optional,\n+    releaseNotesLevel: ReleaseNotesLevel.Hidden,\n   },\n   feat: {\n     name: 'feat',\n     description: 'Creates a new feature',\n     scope: ScopeRequirement.Required,\n+    releaseNotesLevel: ReleaseNotesLevel.Visible,\n   },\n   fix: {\n     name: 'fix',\n     description: 'Fixes a previously discovered failure/bug',\n     scope: ScopeRequirement.Required,\n+    releaseNotesLevel: ReleaseNotesLevel.Visible,\n   },\n   perf: {\n     name: 'perf',\n     description: 'Improves performance without any change in functionality or API',\n     scope: ScopeRequirement.Required,\n+    releaseNotesLevel: ReleaseNotesLevel.Visible,\n   },\n   refactor: {\n     name: 'refactor',\n     description: 'Refactor without any change in functionality or API (includes style changes)',\n     scope: ScopeRequirement.Required,\n+    releaseNotesLevel: ReleaseNotesLevel.Hidden,\n   },\n   release: {\n     name: 'release',\n     description: 'A release point in the repository',\n     scope: ScopeRequirement.Forbidden,\n+    releaseNotesLevel: ReleaseNotesLevel.Hidden,\n   },\n   test: {\n     name: 'test',\n     description: 'Improvements or corrections made to the project\\'s test suite',\n     scope: ScopeRequirement.Required,\n+    releaseNotesLevel: ReleaseNotesLevel.Hidden,\n   },\n };"
        },
        {
            "sha": "bfaf566bcca96a5cf0c9cc6a6869aee201ff9379",
            "filename": "dev-infra/commit-message/parse.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 1,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f/dev-infra%2Fcommit-message%2Fparse.ts",
            "raw_url": "https://github.com/angular/angular/raw/c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f/dev-infra%2Fcommit-message%2Fparse.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fparse.ts?ref=c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f",
            "patch": "@@ -41,6 +41,13 @@ export interface Commit {\n   isRevert: boolean;\n }\n \n+/** A parsed commit which originated from a Git Log entry */\n+export interface CommitFromGitLog extends Commit {\n+  author: string;\n+  hash: string;\n+  shortHash: string;\n+}\n+\n /**\n  * A list of tuples expressing the fields to extract from each commit log entry. The tuple contains\n  * two values, the first is the key for the property and the second is the template shortcut for the\n@@ -107,9 +114,16 @@ const parseOptions: Options&{notesPattern: (keywords: string) => RegExp} = {\n   notesPattern: (keywords: string) => new RegExp(`(${keywords})(?:: ?)(.*)`),\n };\n \n+/** Parse a commit message into its composite parts. */\n+export const parseCommitMessage: (fullText: string) => Commit = parseInternal;\n+\n+/** Parse a commit message from a git log entry into its composite parts. */\n+export const parseCommitFromGitLog: (fullText: Buffer) => CommitFromGitLog = parseInternal;\n \n /** Parse a full commit message into its composite parts. */\n-export function parseCommitMessage(fullText: string|Buffer): Commit {\n+function parseInternal(fullText: string): Commit;\n+function parseInternal(fullText: Buffer): CommitFromGitLog;\n+function parseInternal(fullText: string|Buffer): CommitFromGitLog|Commit {\n   // Ensure the fullText symbol is a `string`, even if a Buffer was provided.\n   fullText = fullText.toString();\n   /** The commit message text with the fixup and squash markers stripped out. */\n@@ -148,5 +162,8 @@ export function parseCommitMessage(fullText: string|Buffer): Commit {\n     isFixup: FIXUP_PREFIX_RE.test(fullText),\n     isSquash: SQUASH_PREFIX_RE.test(fullText),\n     isRevert: REVERT_PREFIX_RE.test(fullText),\n+    author: commit.author || undefined,\n+    hash: commit.hash || undefined,\n+    shortHash: commit.shortHash || undefined,\n   };\n }"
        },
        {
            "sha": "82af851e5d9f27e7bb61224269164ed721556198",
            "filename": "dev-infra/commit-message/utils.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f/dev-infra%2Fcommit-message%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f/dev-infra%2Fcommit-message%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Futils.ts?ref=c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f",
            "patch": "@@ -7,7 +7,7 @@\n  */\n import * as gitCommits_ from 'git-raw-commits';\n \n-import {Commit, gitLogFormatForParsing, parseCommitMessage} from './parse';\n+import {CommitFromGitLog, gitLogFormatForParsing, parseCommitFromGitLog} from './parse';\n \n // Set `gitCommits` as this imported value to address \"Cannot call a namespace\" error.\n const gitCommits = gitCommits_;\n@@ -16,16 +16,16 @@ const gitCommits = gitCommits_;\n /**\n  * Find all commits within the given range and return an object describing those.\n  */\n-export function getCommitsInRange(from: string, to: string = 'HEAD'): Promise<Commit[]> {\n+export function getCommitsInRange(from: string, to: string = 'HEAD'): Promise<CommitFromGitLog[]> {\n   return new Promise((resolve, reject) => {\n     /** List of parsed commit objects. */\n-    const commits: Commit[] = [];\n+    const commits: CommitFromGitLog[] = [];\n     /** Stream of raw git commit strings in the range provided. */\n     const commitStream = gitCommits({from, to, format: gitLogFormatForParsing});\n \n     // Accumulate the parsed commits for each commit from the Readable stream into an array, then\n     // resolve the promise with the array when the Readable stream ends.\n-    commitStream.on('data', (commit: Buffer) => commits.push(parseCommitMessage(commit)));\n+    commitStream.on('data', (commit: Buffer) => commits.push(parseCommitFromGitLog(commit)));\n     commitStream.on('error', (err: Error) => reject(err));\n     commitStream.on('end', () => resolve(commits));\n   });"
        },
        {
            "sha": "e3516dee5d454046497132bee99805c2a235e06a",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 23,
            "deletions": 3,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=c63d00e5b0d9b0f514f10ca9d877eb55a03fe68f",
            "patch": "@@ -1670,52 +1670,66 @@ var ScopeRequirement;\n     ScopeRequirement[ScopeRequirement[\"Optional\"] = 1] = \"Optional\";\n     ScopeRequirement[ScopeRequirement[\"Forbidden\"] = 2] = \"Forbidden\";\n })(ScopeRequirement || (ScopeRequirement = {}));\n+var ReleaseNotesLevel;\n+(function (ReleaseNotesLevel) {\n+    ReleaseNotesLevel[ReleaseNotesLevel[\"Hidden\"] = 0] = \"Hidden\";\n+    ReleaseNotesLevel[ReleaseNotesLevel[\"Visible\"] = 1] = \"Visible\";\n+})(ReleaseNotesLevel || (ReleaseNotesLevel = {}));\n /** The valid commit types for Angular commit messages. */\n const COMMIT_TYPES = {\n     build: {\n         name: 'build',\n         description: 'Changes to local repository build system and tooling',\n         scope: ScopeRequirement.Optional,\n+        releaseNotesLevel: ReleaseNotesLevel.Hidden,\n     },\n     ci: {\n         name: 'ci',\n         description: 'Changes to CI configuration and CI specific tooling',\n         scope: ScopeRequirement.Forbidden,\n+        releaseNotesLevel: ReleaseNotesLevel.Hidden,\n     },\n     docs: {\n         name: 'docs',\n         description: 'Changes which exclusively affects documentation.',\n         scope: ScopeRequirement.Optional,\n+        releaseNotesLevel: ReleaseNotesLevel.Hidden,\n     },\n     feat: {\n         name: 'feat',\n         description: 'Creates a new feature',\n         scope: ScopeRequirement.Required,\n+        releaseNotesLevel: ReleaseNotesLevel.Visible,\n     },\n     fix: {\n         name: 'fix',\n         description: 'Fixes a previously discovered failure/bug',\n         scope: ScopeRequirement.Required,\n+        releaseNotesLevel: ReleaseNotesLevel.Visible,\n     },\n     perf: {\n         name: 'perf',\n         description: 'Improves performance without any change in functionality or API',\n         scope: ScopeRequirement.Required,\n+        releaseNotesLevel: ReleaseNotesLevel.Visible,\n     },\n     refactor: {\n         name: 'refactor',\n         description: 'Refactor without any change in functionality or API (includes style changes)',\n         scope: ScopeRequirement.Required,\n+        releaseNotesLevel: ReleaseNotesLevel.Hidden,\n     },\n     release: {\n         name: 'release',\n         description: 'A release point in the repository',\n         scope: ScopeRequirement.Forbidden,\n+        releaseNotesLevel: ReleaseNotesLevel.Hidden,\n     },\n     test: {\n         name: 'test',\n         description: 'Improvements or corrections made to the project\\'s test suite',\n         scope: ScopeRequirement.Required,\n+        releaseNotesLevel: ReleaseNotesLevel.Hidden,\n     },\n };\n \n@@ -1790,8 +1804,11 @@ const parseOptions = {\n     noteKeywords: [NoteSections.BREAKING_CHANGE, NoteSections.DEPRECATED],\n     notesPattern: (keywords) => new RegExp(`(${keywords})(?:: ?)(.*)`),\n };\n-/** Parse a full commit message into its composite parts. */\n-function parseCommitMessage(fullText) {\n+/** Parse a commit message into its composite parts. */\n+const parseCommitMessage = parseInternal;\n+/** Parse a commit message from a git log entry into its composite parts. */\n+const parseCommitFromGitLog = parseInternal;\n+function parseInternal(fullText) {\n     // Ensure the fullText symbol is a `string`, even if a Buffer was provided.\n     fullText = fullText.toString();\n     /** The commit message text with the fixup and squash markers stripped out. */\n@@ -1828,6 +1845,9 @@ function parseCommitMessage(fullText) {\n         isFixup: FIXUP_PREFIX_RE.test(fullText),\n         isSquash: SQUASH_PREFIX_RE.test(fullText),\n         isRevert: REVERT_PREFIX_RE.test(fullText),\n+        author: commit.author || undefined,\n+        hash: commit.hash || undefined,\n+        shortHash: commit.shortHash || undefined,\n     };\n }\n \n@@ -2083,7 +2103,7 @@ function getCommitsInRange(from, to = 'HEAD') {\n         const commitStream = gitCommits({ from, to, format: gitLogFormatForParsing });\n         // Accumulate the parsed commits for each commit from the Readable stream into an array, then\n         // resolve the promise with the array when the Readable stream ends.\n-        commitStream.on('data', (commit) => commits.push(parseCommitMessage(commit)));\n+        commitStream.on('data', (commit) => commits.push(parseCommitFromGitLog(commit)));\n         commitStream.on('error', (err) => reject(err));\n         commitStream.on('end', () => resolve(commits));\n     });"
        }
    ],
    "stats": {
        "total": 68,
        "additions": 60,
        "deletions": 8
    }
}