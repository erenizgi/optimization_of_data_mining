{
    "author": "CaerusKaru",
    "message": "feat(core): add initialNavigation schematic (#36926)\n\nAdd a schematic to update users to the new v11 `initialNavigation`\noptions for `RouterModule`. This replaces the deprecated/removed\n`true`, `false`, `legacy_disabled`, and `legacy_enabled` options\nwith the newer `enabledBlocking` and `enabledNonBlocking` options.\n\nPR Close #36926",
    "sha": "0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
    "files": [
        {
            "sha": "b68ceb4eb97bc1a85f44a3d14b16fc98ddfca6b7",
            "filename": "packages/core/schematics/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2FBUILD.bazel?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -12,6 +12,7 @@ pkg_npm(\n     deps = [\n         \"//packages/core/schematics/migrations/abstract-control-parent\",\n         \"//packages/core/schematics/migrations/dynamic-queries\",\n+        \"//packages/core/schematics/migrations/initial-navigation\",\n         \"//packages/core/schematics/migrations/missing-injectable\",\n         \"//packages/core/schematics/migrations/module-with-providers\",\n         \"//packages/core/schematics/migrations/move-document\","
        },
        {
            "sha": "818a1535a383176be1b4150bd10359be5cc4bee9",
            "filename": "packages/core/schematics/migrations.json",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations.json",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations.json?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -74,6 +74,11 @@\n       \"version\": \"11.0.0-beta\",\n       \"description\": \"NavigationExtras.preserveQueryParams has been removed as of Angular version 11.  This migration replaces any usages with the appropriate assignment of the queryParamsHandler key.\",\n       \"factory\": \"./migrations/router-preserve-query-params/index\"\n+    },\n+    \"migration-v11-router-initial-navigation-options\": {\n+      \"version\": \"11.0.0-beta\",\n+      \"description\": \"Updates the `initialNavigation` property for `RouterModule.forRoot`.\",\n+      \"factory\": \"./migrations/initial-navigation/index\"\n     }\n   }\n }"
        },
        {
            "sha": "0eecceb17540adf81a0f9a8a37ef40663f08b4de",
            "filename": "packages/core/schematics/migrations/google3/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Fgoogle3%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Fgoogle3%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fgoogle3%2FBUILD.bazel?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -7,6 +7,8 @@ ts_library(\n     visibility = [\"//packages/core/schematics/test/google3:__pkg__\"],\n     deps = [\n         \"//packages/core/schematics/migrations/dynamic-queries\",\n+        \"//packages/core/schematics/migrations/initial-navigation\",\n+        \"//packages/core/schematics/migrations/initial-navigation/google3\",\n         \"//packages/core/schematics/migrations/missing-injectable\",\n         \"//packages/core/schematics/migrations/missing-injectable/google3\",\n         \"//packages/core/schematics/migrations/navigation-extras-omissions\","
        },
        {
            "sha": "41a2750c97c77d0dd36ba48ad777c4741a9e646d",
            "filename": "packages/core/schematics/migrations/google3/initialNavigationRule.ts",
            "status": "added",
            "additions": 55,
            "deletions": 0,
            "changes": 55,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Fgoogle3%2FinitialNavigationRule.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Fgoogle3%2FinitialNavigationRule.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fgoogle3%2FinitialNavigationRule.ts?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -0,0 +1,55 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {RuleFailure, Rules} from 'tslint';\n+import * as ts from 'typescript';\n+\n+import {InitialNavigationCollector} from '../initial-navigation/collector';\n+import {TslintUpdateRecorder} from '../initial-navigation/google3/tslint_update_recorder';\n+import {InitialNavigationTransform} from '../initial-navigation/transform';\n+\n+\n+\n+/**\n+ * TSLint rule that updates RouterModule `forRoot` options to be in line with v10 updates.\n+ */\n+export class Rule extends Rules.TypedRule {\n+  applyWithProgram(sourceFile: ts.SourceFile, program: ts.Program): RuleFailure[] {\n+    const ruleName = this.ruleName;\n+    const typeChecker = program.getTypeChecker();\n+    const sourceFiles = program.getSourceFiles().filter(\n+        s => !s.isDeclarationFile && !program.isSourceFileFromExternalLibrary(s));\n+    const initialNavigationCollector = new InitialNavigationCollector(typeChecker);\n+    const failures: RuleFailure[] = [];\n+\n+    // Analyze source files by detecting all ExtraOptions#InitialNavigation assignments\n+    sourceFiles.forEach(sourceFile => initialNavigationCollector.visitNode(sourceFile));\n+\n+    const {assignments} = initialNavigationCollector;\n+    const transformer = new InitialNavigationTransform(typeChecker, getUpdateRecorder);\n+    const updateRecorders = new Map<ts.SourceFile, TslintUpdateRecorder>();\n+\n+    transformer.migrateInitialNavigationAssignments(Array.from(assignments));\n+\n+    if (updateRecorders.has(sourceFile)) {\n+      failures.push(...updateRecorders.get(sourceFile)!.failures);\n+    }\n+\n+    return failures;\n+\n+    /** Gets the update recorder for the specified source file. */\n+    function getUpdateRecorder(sourceFile: ts.SourceFile): TslintUpdateRecorder {\n+      if (updateRecorders.has(sourceFile)) {\n+        return updateRecorders.get(sourceFile)!;\n+      }\n+      const recorder = new TslintUpdateRecorder(ruleName, sourceFile);\n+      updateRecorders.set(sourceFile, recorder);\n+      return recorder;\n+    }\n+  }\n+}"
        },
        {
            "sha": "43326967b01ac49e5315a258de812e9251505452",
            "filename": "packages/core/schematics/migrations/initial-navigation/BUILD.bazel",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2FBUILD.bazel?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -0,0 +1,19 @@\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"initial-navigation\",\n+    srcs = glob([\"**/*.ts\"]),\n+    tsconfig = \"//packages/core/schematics:tsconfig.json\",\n+    visibility = [\n+        \"//packages/core/schematics:__pkg__\",\n+        \"//packages/core/schematics/migrations/google3:__pkg__\",\n+        \"//packages/core/schematics/migrations/initial-navigation/google3:__pkg__\",\n+        \"//packages/core/schematics/test:__pkg__\",\n+    ],\n+    deps = [\n+        \"//packages/core/schematics/utils\",\n+        \"@npm//@angular-devkit/schematics\",\n+        \"@npm//@types/node\",\n+        \"@npm//typescript\",\n+    ],\n+)"
        },
        {
            "sha": "a279f273c7696fe85ab26425a681f59bdd6d8d17",
            "filename": "packages/core/schematics/migrations/initial-navigation/README.md",
            "status": "added",
            "additions": 43,
            "deletions": 0,
            "changes": 43,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2FREADME.md?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -0,0 +1,43 @@\n+## initialNavigation migration\n+\n+Automatically migrates the `initialNavigation` property of the `RouterModule` to the newly\n+available options: `enabledNonBlocking` (default), `enabledBlocking`, and `disabled`.\n+\n+#### Before\n+```ts\n+import { NgModule } from '@angular/core';\n+import { RouterModule } from '@angular/router';\n+\n+@NgModule({\n+  imports: [\n+    RouterModule.forRoot(ROUTES, {initialNavigation: 'legacy_disabled'}),\n+  ]\n+})\n+export class AppModule {\n+}\n+```\n+\n+#### After\n+```ts\n+import { NgModule } from '@angular/core';\n+import { RouterModule } from '@angular/router';\n+\n+@NgModule({\n+  imports: [\n+    RouterModule.forRoot(ROUTES, {initialNavigation: 'disabled'}),\n+  ]\n+})\n+export class AppModule {\n+}\n+```\n+\n+### Disclaimer\n+\n+The migration only covers the most common patterns where developers set the `ExtraOptions#InitialNavigation` \n+option to an outdated value. Therefore, if a user declares the option using a number of other methods, \n+e.g. shorthand notation, variable declaration, or some other crafty method, they will have to migrate \n+those options by hand. Otherwise, the compiler will error if the types are sufficiently enforced.\n+\n+The basic migration strategy is as follows:\n+* `legacy_disabled` || `false` => `disabled`\n+* `legacy_enabled` || `true` => `enabledNonBlocking` (new default)\n\\ No newline at end of file"
        },
        {
            "sha": "0c29ee7b3abb322871a36504eb3163b125a21ccf",
            "filename": "packages/core/schematics/migrations/initial-navigation/collector.ts",
            "status": "added",
            "additions": 116,
            "deletions": 0,
            "changes": 116,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Fcollector.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Fcollector.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Fcollector.ts?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -0,0 +1,116 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import * as ts from 'typescript';\n+import {isExtraOptions, isRouterModuleForRoot} from './util';\n+\n+\n+/** The property name for the options that need to be migrated */\n+const INITIAL_NAVIGATION = 'initialNavigation';\n+\n+/**\n+ * Visitor that walks through specified TypeScript nodes and collects all\n+ * found ExtraOptions#InitialNavigation assignments.\n+ */\n+export class InitialNavigationCollector {\n+  public assignments: Set<ts.PropertyAssignment> = new Set();\n+\n+  constructor(private readonly typeChecker: ts.TypeChecker) {}\n+\n+  visitNode(node: ts.Node) {\n+    let extraOptionsLiteral: ts.ObjectLiteralExpression|null = null;\n+    if (isRouterModuleForRoot(this.typeChecker, node) && node.arguments.length > 0) {\n+      if (node.arguments.length === 1) {\n+        return;\n+      }\n+\n+      if (ts.isObjectLiteralExpression(node.arguments[1])) {\n+        extraOptionsLiteral = node.arguments[1] as ts.ObjectLiteralExpression;\n+      } else if (ts.isIdentifier(node.arguments[1])) {\n+        extraOptionsLiteral =\n+            this.getLiteralNeedingMigrationFromIdentifier(node.arguments[1] as ts.Identifier);\n+      }\n+    } else if (ts.isVariableDeclaration(node)) {\n+      extraOptionsLiteral = this.getLiteralNeedingMigration(node);\n+    }\n+\n+    if (extraOptionsLiteral !== null) {\n+      this.visitExtraOptionsLiteral(extraOptionsLiteral);\n+    } else {\n+      // no match found, continue iteration\n+      ts.forEachChild(node, n => this.visitNode(n));\n+    }\n+  }\n+\n+  visitExtraOptionsLiteral(extraOptionsLiteral: ts.ObjectLiteralExpression) {\n+    for (const prop of extraOptionsLiteral.properties) {\n+      if (ts.isPropertyAssignment(prop) &&\n+          (ts.isIdentifier(prop.name) || ts.isStringLiteralLike(prop.name))) {\n+        if (prop.name.text === INITIAL_NAVIGATION && isValidInitialNavigationValue(prop)) {\n+          this.assignments.add(prop);\n+        }\n+      } else if (ts.isSpreadAssignment(prop) && ts.isIdentifier(prop.expression)) {\n+        const literalFromSpreadAssignment =\n+            this.getLiteralNeedingMigrationFromIdentifier(prop.expression);\n+        if (literalFromSpreadAssignment !== null) {\n+          this.visitExtraOptionsLiteral(literalFromSpreadAssignment);\n+        }\n+      }\n+    }\n+  }\n+\n+  private getLiteralNeedingMigrationFromIdentifier(id: ts.Identifier): ts.ObjectLiteralExpression\n+      |null {\n+    const symbolForIdentifier = this.typeChecker.getSymbolAtLocation(id);\n+    if (symbolForIdentifier === undefined) {\n+      return null;\n+    }\n+\n+    if (symbolForIdentifier.declarations.length === 0) {\n+      return null;\n+    }\n+\n+    const declarationNode = symbolForIdentifier.declarations[0];\n+    if (!ts.isVariableDeclaration(declarationNode) || declarationNode.initializer === undefined ||\n+        !ts.isObjectLiteralExpression(declarationNode.initializer)) {\n+      return null;\n+    }\n+\n+    return declarationNode.initializer;\n+  }\n+\n+  private getLiteralNeedingMigration(node: ts.VariableDeclaration): ts.ObjectLiteralExpression\n+      |null {\n+    if (node.initializer === undefined) {\n+      return null;\n+    }\n+\n+    // declaration could be `x: ExtraOptions = {}` or `x = {} as ExtraOptions`\n+    if (ts.isAsExpression(node.initializer) &&\n+        ts.isObjectLiteralExpression(node.initializer.expression) &&\n+        isExtraOptions(this.typeChecker, node.initializer.type)) {\n+      return node.initializer.expression;\n+    } else if (\n+        node.type !== undefined && ts.isObjectLiteralExpression(node.initializer) &&\n+        isExtraOptions(this.typeChecker, node.type)) {\n+      return node.initializer;\n+    }\n+\n+    return null;\n+  }\n+}\n+\n+/**\n+ * Check whether the value assigned to an `initialNavigation` assignment\n+ * conforms to the expected types for ExtraOptions#InitialNavigation\n+ * @param node the property assignment to check\n+ */\n+function isValidInitialNavigationValue(node: ts.PropertyAssignment): boolean {\n+  return ts.isStringLiteralLike(node.initializer) ||\n+      node.initializer.kind === ts.SyntaxKind.FalseKeyword ||\n+      node.initializer.kind === ts.SyntaxKind.TrueKeyword;\n+}"
        },
        {
            "sha": "28baae084ab647b55deab5c55ca8517be2845bdf",
            "filename": "packages/core/schematics/migrations/initial-navigation/google3/BUILD.bazel",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Fgoogle3%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Fgoogle3%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Fgoogle3%2FBUILD.bazel?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -0,0 +1,13 @@\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"google3\",\n+    srcs = glob([\"**/*.ts\"]),\n+    tsconfig = \"//packages/core/schematics:tsconfig.json\",\n+    visibility = [\"//packages/core/schematics/migrations/google3:__pkg__\"],\n+    deps = [\n+        \"//packages/core/schematics/migrations/initial-navigation\",\n+        \"@npm//tslint\",\n+        \"@npm//typescript\",\n+    ],\n+)"
        },
        {
            "sha": "09497f6289087aec6d1017e4ae8d5fdf7a1e6c07",
            "filename": "packages/core/schematics/migrations/initial-navigation/google3/tslint_update_recorder.ts",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Fgoogle3%2Ftslint_update_recorder.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Fgoogle3%2Ftslint_update_recorder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Fgoogle3%2Ftslint_update_recorder.ts?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -0,0 +1,26 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Replacement, RuleFailure} from 'tslint';\n+import * as ts from 'typescript';\n+\n+import {UpdateRecorder} from '../update_recorder';\n+\n+export class TslintUpdateRecorder implements UpdateRecorder {\n+  failures: RuleFailure[] = [];\n+\n+  constructor(private ruleName: string, private sourceFile: ts.SourceFile) {}\n+\n+  updateNode(node: ts.Node, newText: string): void {\n+    this.failures.push(new RuleFailure(\n+        this.sourceFile, node.getStart(), node.getEnd(), `Node needs to be updated to: ${newText}`,\n+        this.ruleName, Replacement.replaceFromTo(node.getStart(), node.getEnd(), newText)));\n+  }\n+\n+  commitUpdate() {}\n+}"
        },
        {
            "sha": "1cab6ed87d5f13dda697a11606ba66300df1fbc2",
            "filename": "packages/core/schematics/migrations/initial-navigation/index.ts",
            "status": "added",
            "additions": 73,
            "deletions": 0,
            "changes": 73,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Findex.ts?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -0,0 +1,73 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {Rule, SchematicsException, Tree} from '@angular-devkit/schematics';\n+import {relative} from 'path';\n+import * as ts from 'typescript';\n+import {getProjectTsConfigPaths} from '../../utils/project_tsconfig_paths';\n+import {createMigrationProgram} from '../../utils/typescript/compiler_host';\n+import {InitialNavigationCollector} from './collector';\n+import {InitialNavigationTransform} from './transform';\n+import {UpdateRecorder} from './update_recorder';\n+\n+/** Entry point for the v10 \"initialNavigation RouterModule options\" schematic. */\n+export default function(): Rule {\n+  return (tree: Tree) => {\n+    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+    const basePath = process.cwd();\n+\n+    if (!buildPaths.length && !testPaths.length) {\n+      throw new SchematicsException(\n+          'Could not find any tsconfig file. Cannot update the \"initialNavigation\" option for RouterModule');\n+    }\n+\n+    for (const tsconfigPath of [...buildPaths, ...testPaths]) {\n+      runInitialNavigationMigration(tree, tsconfigPath, basePath);\n+    }\n+  };\n+}\n+\n+function runInitialNavigationMigration(tree: Tree, tsconfigPath: string, basePath: string) {\n+  const {program} = createMigrationProgram(tree, tsconfigPath, basePath);\n+  const typeChecker = program.getTypeChecker();\n+  const initialNavigationCollector = new InitialNavigationCollector(typeChecker);\n+  const sourceFiles = program.getSourceFiles().filter(\n+      f => !f.isDeclarationFile && !program.isSourceFileFromExternalLibrary(f));\n+\n+  // Analyze source files by detecting all modules.\n+  sourceFiles.forEach(sourceFile => initialNavigationCollector.visitNode(sourceFile));\n+\n+  const {assignments} = initialNavigationCollector;\n+  const transformer = new InitialNavigationTransform(typeChecker, getUpdateRecorder);\n+  const updateRecorders = new Map<ts.SourceFile, UpdateRecorder>();\n+  transformer.migrateInitialNavigationAssignments(Array.from(assignments));\n+\n+  // Walk through each update recorder and commit the update. We need to commit the\n+  // updates in batches per source file as there can be only one recorder per source\n+  // file in order to avoid shift character offsets.\n+  updateRecorders.forEach(recorder => recorder.commitUpdate());\n+\n+  /** Gets the update recorder for the specified source file. */\n+  function getUpdateRecorder(sourceFile: ts.SourceFile): UpdateRecorder {\n+    if (updateRecorders.has(sourceFile)) {\n+      return updateRecorders.get(sourceFile)!;\n+    }\n+    const treeRecorder = tree.beginUpdate(relative(basePath, sourceFile.fileName));\n+    const recorder: UpdateRecorder = {\n+      updateNode(node: ts.Node, newText: string) {\n+        treeRecorder.remove(node.getStart(), node.getWidth());\n+        treeRecorder.insertRight(node.getStart(), newText);\n+      },\n+      commitUpdate() {\n+        tree.commitUpdate(treeRecorder);\n+      }\n+    };\n+    updateRecorders.set(sourceFile, recorder);\n+    return recorder;\n+  }\n+}"
        },
        {
            "sha": "32b105605dbfcc0d7a91e367090af1f289768ffa",
            "filename": "packages/core/schematics/migrations/initial-navigation/transform.ts",
            "status": "added",
            "additions": 75,
            "deletions": 0,
            "changes": 75,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Ftransform.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Ftransform.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Ftransform.ts?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -0,0 +1,75 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import * as ts from 'typescript';\n+\n+import {UpdateRecorder} from './update_recorder';\n+\n+\n+export class InitialNavigationTransform {\n+  private printer = ts.createPrinter();\n+\n+  constructor(\n+      private typeChecker: ts.TypeChecker,\n+      private getUpdateRecorder: (sf: ts.SourceFile) => UpdateRecorder) {}\n+\n+  /** Migrate the ExtraOptions#InitialNavigation property assignments. */\n+  migrateInitialNavigationAssignments(literals: ts.PropertyAssignment[]) {\n+    literals.forEach(l => this.migrateAssignment(l));\n+  }\n+\n+  /** Migrate an ExtraOptions#InitialNavigation expression to use the new options format. */\n+  migrateAssignment(assignment: ts.PropertyAssignment) {\n+    const newInitializer = getUpdatedInitialNavigationValue(assignment.initializer);\n+    if (newInitializer) {\n+      const newAssignment =\n+          ts.updatePropertyAssignment(assignment, assignment.name, newInitializer);\n+      this._updateNode(assignment, newAssignment);\n+    }\n+  }\n+\n+  private _updateNode(node: ts.Node, newNode: ts.Node) {\n+    const newText = this.printer.printNode(ts.EmitHint.Unspecified, newNode, node.getSourceFile());\n+    const recorder = this.getUpdateRecorder(node.getSourceFile());\n+    recorder.updateNode(node, newText);\n+  }\n+}\n+\n+/**\n+ * Updates the deprecated initialNavigation options to their v10 equivalents\n+ * (or as close as we can get).\n+ * @param initializer the old initializer to update\n+ */\n+function getUpdatedInitialNavigationValue(initializer: ts.Expression): ts.Expression|null {\n+  const oldText: string|boolean = ts.isStringLiteralLike(initializer) ?\n+      initializer.text :\n+      initializer.kind === ts.SyntaxKind.TrueKeyword;\n+  let newText: string|undefined;\n+  switch (oldText) {\n+    case false:\n+    case 'legacy_disabled':\n+      newText = 'disabled';\n+      break;\n+    case true:\n+    case 'legacy_enabled':\n+      newText = 'enabledNonBlocking';\n+      break;\n+  }\n+\n+  return !!newText ? ts.createIdentifier(`'${newText}'`) : null;\n+}\n+\n+/**\n+ * Check whether the value assigned to an `initialNavigation` assignment\n+ * conforms to the expected types for ExtraOptions#InitialNavigation\n+ * @param node the property assignment to check\n+ */\n+function isValidInitialNavigationValue(node: ts.PropertyAssignment): boolean {\n+  return ts.isStringLiteralLike(node.initializer) ||\n+      node.initializer.kind === ts.SyntaxKind.FalseKeyword ||\n+      node.initializer.kind === ts.SyntaxKind.TrueKeyword;\n+}"
        },
        {
            "sha": "82e1787968785fdb644ba4ce674b267d03aa6d22",
            "filename": "packages/core/schematics/migrations/initial-navigation/update_recorder.ts",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Fupdate_recorder.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Fupdate_recorder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Fupdate_recorder.ts?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -0,0 +1,19 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import * as ts from 'typescript';\n+\n+/**\n+ * Update recorder interface that is used to transform source files in a non-colliding\n+ * way. Also this indirection makes it possible to re-use logic for both TSLint rules\n+ * and CLI devkit schematic updates.\n+ */\n+export interface UpdateRecorder {\n+  updateNode(node: ts.Node, newText: string): void;\n+  commitUpdate(): void;\n+}"
        },
        {
            "sha": "d8a7c565624790175af05ced2516591ad202e8b2",
            "filename": "packages/core/schematics/migrations/initial-navigation/util.ts",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Futil.ts?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -0,0 +1,33 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import * as ts from 'typescript';\n+import {getImportOfIdentifier} from '../../utils/typescript/imports';\n+\n+/** Determine whether a node is a ModuleWithProviders type reference node without a generic type */\n+export function isRouterModuleForRoot(\n+    typeChecker: ts.TypeChecker, node: ts.Node): node is ts.CallExpression {\n+  if (!ts.isCallExpression(node) || !ts.isPropertyAccessExpression(node.expression) ||\n+      !ts.isIdentifier(node.expression.expression) || node.expression.name.text !== 'forRoot') {\n+    return false;\n+  }\n+  const imp = getImportOfIdentifier(typeChecker, node.expression.expression);\n+  return !!imp && imp.name === 'RouterModule' && imp.importModule === '@angular/router' &&\n+      !node.typeArguments;\n+}\n+\n+export function isExtraOptions(\n+    typeChecker: ts.TypeChecker, node: ts.Node): node is ts.TypeReferenceNode {\n+  if (!ts.isTypeReferenceNode(node) || !ts.isIdentifier(node.typeName)) {\n+    return false;\n+  }\n+\n+  const imp = getImportOfIdentifier(typeChecker, node.typeName);\n+  return imp !== null && imp.name === 'ExtraOptions' && imp.importModule === '@angular/router' &&\n+      !node.typeArguments;\n+}"
        },
        {
            "sha": "2995f83a7e7d1ccb0ee05a9f1ad8d1d7afda147b",
            "filename": "packages/core/schematics/migrations/module-with-providers/transform.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Fmodule-with-providers%2Ftransform.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Fmigrations%2Fmodule-with-providers%2Ftransform.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fmodule-with-providers%2Ftransform.ts?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -20,7 +20,7 @@ export interface AnalysisFailure {\n   message: string;\n }\n \n-const TODO_COMMENT = 'TODO: The following node requires a generic type for `ModuleWithProviders';\n+const TODO_COMMENT = 'TODO: The following node requires a generic type for `ModuleWithProviders`';\n \n export class ModuleWithProvidersTransform {\n   private printer = ts.createPrinter();"
        },
        {
            "sha": "a26b22892fa526e08f3403832267ee39ac4f0ce1",
            "filename": "packages/core/schematics/test/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2FBUILD.bazel?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -10,6 +10,7 @@ ts_library(\n     deps = [\n         \"//packages/core/schematics/migrations/abstract-control-parent\",\n         \"//packages/core/schematics/migrations/dynamic-queries\",\n+        \"//packages/core/schematics/migrations/initial-navigation\",\n         \"//packages/core/schematics/migrations/missing-injectable\",\n         \"//packages/core/schematics/migrations/module-with-providers\",\n         \"//packages/core/schematics/migrations/move-document\","
        },
        {
            "sha": "07cddb8fdb24034fea078880a9a6f7526e3c6de1",
            "filename": "packages/core/schematics/test/google3/initial_navigation_rule_spec.ts",
            "status": "added",
            "additions": 211,
            "deletions": 0,
            "changes": 211,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Ftest%2Fgoogle3%2Finitial_navigation_rule_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Ftest%2Fgoogle3%2Finitial_navigation_rule_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fgoogle3%2Finitial_navigation_rule_spec.ts?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -0,0 +1,211 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {readFileSync, writeFileSync} from 'fs';\n+import {dirname, join} from 'path';\n+import * as shx from 'shelljs';\n+import {Configuration, Linter} from 'tslint';\n+\n+describe('Google3 initial navigation tslint rule', () => {\n+  const rulesDirectory = dirname(require.resolve('../../migrations/google3/initialNavigationRule'));\n+\n+  let tmpDir: string;\n+\n+  beforeEach(() => {\n+    tmpDir = join(process.env['TEST_TMPDIR']!, 'google3-test');\n+    shx.mkdir('-p', tmpDir);\n+\n+    writeFile('tsconfig.json', JSON.stringify({compilerOptions: {module: 'es2015'}}));\n+  });\n+\n+  afterEach(() => shx.rm('-r', tmpDir));\n+\n+  function runTSLint(fix = true) {\n+    const program = Linter.createProgram(join(tmpDir, 'tsconfig.json'));\n+    const linter = new Linter({fix, rulesDirectory: [rulesDirectory]}, program);\n+    const config = Configuration.parseConfigFile({rules: {'initial-navigation': true}});\n+\n+    program.getRootFileNames().forEach(fileName => {\n+      linter.lint(fileName, program.getSourceFile(fileName)!.getFullText(), config);\n+    });\n+\n+    return linter;\n+  }\n+\n+  function writeFile(fileName: string, content: string) {\n+    writeFileSync(join(tmpDir, fileName), content);\n+  }\n+\n+  function getFile(fileName: string) {\n+    return readFileSync(join(tmpDir, fileName), 'utf8');\n+  }\n+\n+  it('should migrate legacy_disabled to disabled', () => {\n+    writeFile('/index.ts', `\n+      import { NgModule } from '@angular/core';\n+      import { RouterModule } from '@angular/router';\n+\n+      @NgModule({\n+        imports: [\n+          RouterModule.forRoot([], {initialNavigation: 'legacy_disabled'}),\n+        ]\n+      })\n+      export class AppModule {\n+      }\n+    `);\n+\n+\n+    runTSLint();\n+\n+    expect(getFile('/index.ts')).toContain(`{initialNavigation: 'disabled'}`);\n+  });\n+\n+  it(`should migrate false to disabled`, () => {\n+    writeFile('/index.ts', `\n+      import { NgModule } from '@angular/core';\n+      import { RouterModule } from '@angular/router';\n+\n+      @NgModule({\n+        imports: [\n+          RouterModule.forRoot([], {initialNavigation: false}),\n+        ]\n+      })\n+      export class AppModule {\n+      }\n+    `);\n+\n+    runTSLint();\n+\n+    expect(getFile('/index.ts')).toContain(`{initialNavigation: 'disabled'}`);\n+  });\n+\n+  it('should migrate legacy_enabled to enabledNonBlocking', () => {\n+    writeFile('/index.ts', `\n+      import { NgModule } from '@angular/core';\n+      import { RouterModule } from '@angular/router';\n+\n+      @NgModule({\n+        imports: [\n+          RouterModule.forRoot([], {initialNavigation: 'legacy_enabled'}),\n+        ]\n+      })\n+      export class AppModule {\n+      }\n+    `);\n+\n+    runTSLint(true);\n+\n+    expect(getFile('/index.ts')).toContain(`{initialNavigation: 'enabledNonBlocking'}`);\n+  });\n+\n+  it(`should migrate true to enabledNonBlocking`, () => {\n+    writeFile('/index.ts', `\n+      mport { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {initialNavigation: true}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+    `);\n+\n+    runTSLint(true);\n+\n+    expect(getFile('/index.ts')).toContain(`{initialNavigation: 'enabledNonBlocking'}`);\n+  });\n+\n+  it('should migrate nested objects', () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        const options = {initialNavigation: 'legacy_enabled'};\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {initialNavigation: 'legacy_disabled', ...options}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    runTSLint(true);\n+    expect(getFile('/index.ts'))\n+        .toContain(`const options = {initialNavigation: 'enabledNonBlocking'};`);\n+    expect(getFile('/index.ts')).toContain(`{initialNavigation: 'disabled', ...options}`);\n+  });\n+\n+  it('should migrate nested objects mixed validity', () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        const options = {initialNavigation: 'legacy_enabled'};\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {initialNavigation: 'disabled', ...options}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    runTSLint(true);\n+    expect(getFile('/index.ts'))\n+        .toContain(`const options = {initialNavigation: 'enabledNonBlocking'};`);\n+  });\n+\n+  it('should migrate nested objects opposite order', () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        const options = {initialNavigation: 'legacy_enabled'};\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {...options, initialNavigation: 'legacy_disabled'}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    runTSLint(true);\n+    expect(getFile('/index.ts'))\n+        .toContain(`const options = {initialNavigation: 'enabledNonBlocking'};`);\n+    expect(getFile('/index.ts')).toContain(`{...options, initialNavigation: 'disabled'}`);\n+  });\n+\n+  it('should migrate nested objects mixed validity opposite order', () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        const options = {initialNavigation: 'legacy_enabled'};\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {...options, initialNavigation: 'disabled'}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    runTSLint(true);\n+    expect(getFile('/index.ts'))\n+        .toContain(`const options = {initialNavigation: 'enabledNonBlocking'};`);\n+    expect(getFile('/index.ts')).toContain(`{...options, initialNavigation: 'disabled'}`);\n+  });\n+});"
        },
        {
            "sha": "22d9c0c26ff3fd8ecd9fa94732b8c8a11c96b4b9",
            "filename": "packages/core/schematics/test/initial_navigation_migration_spec.ts",
            "status": "added",
            "additions": 239,
            "deletions": 0,
            "changes": 239,
            "blob_url": "https://github.com/angular/angular/blob/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Ftest%2Finitial_navigation_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/0ec7043490b7ed688137ac4b8d8e7db2d8a5829e/packages%2Fcore%2Fschematics%2Ftest%2Finitial_navigation_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Finitial_navigation_migration_spec.ts?ref=0ec7043490b7ed688137ac4b8d8e7db2d8a5829e",
            "patch": "@@ -0,0 +1,239 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {getSystemPath, normalize, virtualFs} from '@angular-devkit/core';\n+import {TempScopedNodeJsSyncHost} from '@angular-devkit/core/node/testing';\n+import {HostTree} from '@angular-devkit/schematics';\n+import {SchematicTestRunner, UnitTestTree} from '@angular-devkit/schematics/testing';\n+import * as shx from 'shelljs';\n+\n+describe('initial navigation migration', () => {\n+  let runner: SchematicTestRunner;\n+  let host: TempScopedNodeJsSyncHost;\n+  let tree: UnitTestTree;\n+  let tmpDirPath: string;\n+  let previousWorkingDir: string;\n+\n+  beforeEach(() => {\n+    runner = new SchematicTestRunner('test', require.resolve('../migrations.json'));\n+    host = new TempScopedNodeJsSyncHost();\n+    tree = new UnitTestTree(new HostTree(host));\n+\n+    writeFile('/tsconfig.json', JSON.stringify({\n+      compilerOptions: {\n+        lib: ['es2015'],\n+      }\n+    }));\n+    writeFile('/angular.json', JSON.stringify({\n+      projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n+    }));\n+\n+    previousWorkingDir = shx.pwd();\n+    tmpDirPath = getSystemPath(host.root);\n+\n+    // Switch into the temporary directory path. This allows us to run\n+    // the schematic against our custom unit test tree.\n+    shx.cd(tmpDirPath);\n+  });\n+\n+  afterEach(() => {\n+    shx.cd(previousWorkingDir);\n+    shx.rm('-r', tmpDirPath);\n+  });\n+\n+  it('should migrate legacy_disabled to disabled', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {initialNavigation: 'legacy_disabled'}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts')).toContain(`{initialNavigation: 'disabled'}`);\n+  });\n+\n+  it('should migrate false to disabled', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {initialNavigation: false}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts')).toContain(`{initialNavigation: 'disabled'}`);\n+  });\n+\n+  it('should migrate legacy_enabled to enabledNonBlocking', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {initialNavigation: 'legacy_enabled'}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts')).toContain(`{initialNavigation: 'enabledNonBlocking'}`);\n+  });\n+\n+  it('should migrate true to enabledNonBlocking', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {initialNavigation: true}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts')).toContain(`{initialNavigation: 'enabledNonBlocking'}`);\n+  });\n+\n+  it('should migrate nested objects', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        const options = {initialNavigation: 'legacy_enabled'};\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {initialNavigation: 'legacy_disabled', ...options}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(`const options = {initialNavigation: 'enabledNonBlocking'};`);\n+    expect(tree.readContent('/index.ts')).toContain(`{initialNavigation: 'disabled', ...options}`);\n+  });\n+\n+  it('should migrate nested objects mixed validity', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        const options = {initialNavigation: 'legacy_enabled'};\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {initialNavigation: 'disabled', ...options}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(`const options = {initialNavigation: 'enabledNonBlocking'};`);\n+  });\n+\n+\n+  it('should migrate nested objects opposite order', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        const options = {initialNavigation: 'legacy_enabled'};\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {...options, initialNavigation: 'legacy_disabled'}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(`const options = {initialNavigation: 'enabledNonBlocking'};`);\n+    expect(tree.readContent('/index.ts')).toContain(`{...options, initialNavigation: 'disabled'}`);\n+  });\n+\n+  it('should migrate nested objects mixed validity opposite order', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        const options = {initialNavigation: 'legacy_enabled'};\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([], {...options, initialNavigation: 'disabled'}),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(`const options = {initialNavigation: 'enabledNonBlocking'};`);\n+    expect(tree.readContent('/index.ts')).toContain(`disabled`);\n+  });\n+\n+  it('should not migrate variable not used in forRoot', async () => {\n+    writeFile('/index.ts', `\n+        import { NgModule } from '@angular/core';\n+        import { RouterModule } from '@angular/router';\n+\n+        const options = {initialNavigation: 'legacy_enabled'};\n+\n+        @NgModule({\n+          imports: [\n+            RouterModule.forRoot([]),\n+          ]\n+        })\n+        export class AppModule {\n+        }\n+      `);\n+\n+    await runMigration();\n+    expect(tree.readContent('/index.ts'))\n+        .toContain(`const options = {initialNavigation: 'legacy_enabled'};`);\n+    expect(tree.readContent('/index.ts')).toContain(`RouterModule.forRoot([])`);\n+  });\n+\n+  function writeFile(filePath: string, contents: string) {\n+    host.sync.write(normalize(filePath), virtualFs.stringToFileBuffer(contents));\n+  }\n+\n+  function runMigration() {\n+    return runner.runSchematicAsync('migration-v11-router-initial-navigation-options', {}, tree)\n+        .toPromise();\n+  }\n+});"
        }
    ],
    "stats": {
        "total": 933,
        "additions": 932,
        "deletions": 1
    }
}