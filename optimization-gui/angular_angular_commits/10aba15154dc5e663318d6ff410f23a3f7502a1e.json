{
    "author": "ivanwonder",
    "message": "fix(language-service): remove completion for string (#37983)\n\nIf the user inputs a string(e.g. `<div [ngClass]=\"'str~{cursor}'\"></div>`), the completion is useless.\n\nPR Close #37983",
    "sha": "10aba15154dc5e663318d6ff410f23a3f7502a1e",
    "files": [
        {
            "sha": "f6cebc40d4b4692cd75fe32a5998762e4b693794",
            "filename": "packages/language-service/src/expressions.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/10aba15154dc5e663318d6ff410f23a3f7502a1e/packages%2Flanguage-service%2Fsrc%2Fexpressions.ts",
            "raw_url": "https://github.com/angular/angular/raw/10aba15154dc5e663318d6ff410f23a3f7502a1e/packages%2Flanguage-service%2Fsrc%2Fexpressions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Fexpressions.ts?ref=10aba15154dc5e663318d6ff410f23a3f7502a1e",
            "patch": "@@ -75,7 +75,16 @@ export function getExpressionCompletions(\n     visitKeyedWrite(_ast) {},\n     visitLiteralArray(_ast) {},\n     visitLiteralMap(_ast) {},\n-    visitLiteralPrimitive(_ast) {},\n+    visitLiteralPrimitive(ast) {\n+      // The type `LiteralPrimitive` include the `ERROR`, and it's wrapped as `string`.\n+      // packages/compiler/src/template_parser/binding_parser.ts#L308\n+      // So exclude the `ERROR` here.\n+      if (typeof ast.value === 'string' &&\n+          ast.value ===\n+              templateInfo.source.slice(ast.sourceSpan.start + 1, ast.sourceSpan.end - 1)) {\n+        result = undefined;\n+      }\n+    },\n     visitMethodCall(_ast) {},\n     visitPipe(ast) {\n       if (position >= ast.exp.span.end &&"
        },
        {
            "sha": "d39324426fdfe7873115387e56ffbaf2feb987f4",
            "filename": "packages/language-service/test/completions_spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/10aba15154dc5e663318d6ff410f23a3f7502a1e/packages%2Flanguage-service%2Ftest%2Fcompletions_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/10aba15154dc5e663318d6ff410f23a3f7502a1e/packages%2Flanguage-service%2Ftest%2Fcompletions_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Ftest%2Fcompletions_spec.ts?ref=10aba15154dc5e663318d6ff410f23a3f7502a1e",
            "patch": "@@ -848,6 +848,13 @@ describe('completions', () => {\n     const completions = ngLS.getCompletionsAtPosition(TEST_TEMPLATE, marker.start);\n     expect(completions).toBeUndefined();\n   });\n+\n+  it('should not provide completions for string', () => {\n+    mockHost.override(TEST_TEMPLATE, `<div [ngClass]=\"'str~{cursor}'\"></div>`);\n+    const marker = mockHost.getLocationMarkerFor(TEST_TEMPLATE, 'cursor');\n+    const completions = ngLS.getCompletionsAtPosition(TEST_TEMPLATE, marker.start);\n+    expect(completions).toBeUndefined();\n+  });\n });\n \n function expectContain("
        }
    ],
    "stats": {
        "total": 18,
        "additions": 17,
        "deletions": 1
    }
}