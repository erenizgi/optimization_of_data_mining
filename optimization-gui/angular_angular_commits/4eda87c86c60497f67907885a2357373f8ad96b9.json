{
    "author": "JoostK",
    "message": "refactor(compiler-cli): extend AST object and value helpers (#39518)\n\nThis introduces `AstObject.toMap` as an alternative to `AstObject\n.toLiteral`, and adds `AstValue.getSymbolName` to query the symbol name\nof a value using the encapsulated AST host.\n\nPR Close #39518",
    "sha": "4eda87c86c60497f67907885a2357373f8ad96b9",
    "files": [
        {
            "sha": "838e2ac63792e3dc28eba9beed0496f2afd7b461",
            "filename": "packages/compiler-cli/linker/src/ast/ast_value.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 1,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/4eda87c86c60497f67907885a2357373f8ad96b9/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Fast%2Fast_value.ts",
            "raw_url": "https://github.com/angular/angular/raw/4eda87c86c60497f67907885a2357373f8ad96b9/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Fast%2Fast_value.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Fast%2Fast_value.ts?ref=4eda87c86c60497f67907885a2357373f8ad96b9",
            "patch": "@@ -122,6 +122,18 @@ export class AstObject<TExpression> {\n     return result;\n   }\n \n+  /**\n+   * Converts the AstObject to a JavaScript Map, mapping each property value (as an\n+   * `AstValue`) to the generic type (`T`) via the `mapper` function.\n+   */\n+  toMap<T>(mapper: (value: AstValue<TExpression>) => T): Map<string, T> {\n+    const result = new Map<string, T>();\n+    for (const [key, expression] of this.obj) {\n+      result.set(key, mapper(new AstValue(expression, this.host)));\n+    }\n+    return result;\n+  }\n+\n   private getRequiredProperty(propertyName: string): TExpression {\n     if (!this.obj.has(propertyName)) {\n       throw new FatalLinkerError(\n@@ -136,7 +148,15 @@ export class AstObject<TExpression> {\n  * access to the underlying value of the wrapped expression.\n  */\n export class AstValue<TExpression> {\n-  constructor(private expression: TExpression, private host: AstHost<TExpression>) {}\n+  constructor(readonly expression: TExpression, private host: AstHost<TExpression>) {}\n+\n+  /**\n+   * Get the name of the symbol represented by the given expression node, or `null` if it is not a\n+   * symbol.\n+   */\n+  getSymbolName(): string|null {\n+    return this.host.getSymbolName(this.expression);\n+  }\n \n   /**\n    * Is this value a number?"
        },
        {
            "sha": "cdc61f1cd8cd04a95c42b608ce13386b92da52e2",
            "filename": "packages/compiler-cli/linker/test/ast/ast_value_spec.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/4eda87c86c60497f67907885a2357373f8ad96b9/packages%2Fcompiler-cli%2Flinker%2Ftest%2Fast%2Fast_value_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/4eda87c86c60497f67907885a2357373f8ad96b9/packages%2Fcompiler-cli%2Flinker%2Ftest%2Fast%2Fast_value_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Ftest%2Fast%2Fast_value_spec.ts?ref=4eda87c86c60497f67907885a2357373f8ad96b9",
            "patch": "@@ -141,9 +141,37 @@ describe('AstObject', () => {\n       });\n     });\n   });\n+\n+  describe('toMap()', () => {\n+    it('should convert the AstObject to a Map with each property mapped', () => {\n+      expect(obj.toMap(value => value.getOpaque())).toEqual(new Map([\n+        ['a', obj.getOpaque('a')],\n+        ['b', obj.getOpaque('b')],\n+        ['c', obj.getOpaque('c')],\n+        ['d', obj.getOpaque('d')],\n+        ['e', obj.getOpaque('e')],\n+      ]));\n+    });\n+  });\n });\n \n describe('AstValue', () => {\n+  describe('getSymbolName', () => {\n+    it('should return the name of an identifier', () => {\n+      expect(new AstValue(factory.createIdentifier('Foo'), host).getSymbolName()).toEqual('Foo');\n+    });\n+\n+    it('should return the name of a property access', () => {\n+      const propertyAccess = factory.createPropertyAccess(\n+          factory.createIdentifier('Foo'), factory.createIdentifier('Bar'));\n+      expect(new AstValue(propertyAccess, host).getSymbolName()).toEqual('Bar');\n+    });\n+\n+    it('should return null if no symbol name is available', () => {\n+      expect(new AstValue(factory.createLiteral('a'), host).getSymbolName()).toBeNull();\n+    });\n+  });\n+\n   describe('isNumber', () => {\n     it('should return true if the value is a number', () => {\n       expect(new AstValue(factory.createLiteral(42), host).isNumber()).toEqual(true);"
        }
    ],
    "stats": {
        "total": 50,
        "additions": 49,
        "deletions": 1
    }
}