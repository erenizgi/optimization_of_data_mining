{
    "author": "josephperrott",
    "message": "refactor(dev-infra): provide entire pull request object to waitForPullRequestToBeMerged (#42871)\n\n`waitForPullRequestToBeMerged` should get the entire `PullRequest` object rather than\njust the id to allow it to have more information/context for logging and messaging.\n\nPR Close #42871",
    "sha": "89509dffd26b714ecb774ba1a590661edd59a7ad",
    "files": [
        {
            "sha": "cbab138243b1b7806e80da6bd694da4c90b43439",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 16,
            "deletions": 16,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=89509dffd26b714ecb774ba1a590661edd59a7ad",
            "patch": "@@ -6615,7 +6615,7 @@ class ReleaseAction {\n      * API is 10 seconds (to not exceed any rate limits). If the pull request is closed without\n      * merge, the script will abort gracefully (considering a manual user abort).\n      */\n-    waitForPullRequestToBeMerged(id, interval = waitForPullRequestInterval) {\n+    waitForPullRequestToBeMerged({ id }, interval = waitForPullRequestInterval) {\n         return tslib.__awaiter(this, void 0, void 0, function* () {\n             return new Promise((resolve, reject) => {\n                 debug(`Waiting for pull request #${id} to be merged.`);\n@@ -6714,13 +6714,13 @@ class ReleaseAction {\n             yield this.createCommit(commitMessage, [changelogPath]);\n             info(green(`  ✓   Created changelog cherry-pick commit for: \"${releaseNotes.version}\".`));\n             // Create a cherry-pick pull request that should be merged by the caretaker.\n-            const { url, id } = yield this.pushChangesToForkAndCreatePullRequest(nextBranch, `changelog-cherry-pick-${releaseNotes.version}`, commitMessage, `Cherry-picks the changelog from the \"${stagingBranch}\" branch to the next ` +\n+            const pullRequest = yield this.pushChangesToForkAndCreatePullRequest(nextBranch, `changelog-cherry-pick-${releaseNotes.version}`, commitMessage, `Cherry-picks the changelog from the \"${stagingBranch}\" branch to the next ` +\n                 `branch (${nextBranch}).`);\n             info(green(`  ✓   Pull request for cherry-picking the changelog into \"${nextBranch}\" ` +\n                 'has been created.'));\n-            info(yellow(`      Please ask team members to review: ${url}.`));\n+            info(yellow(`      Please ask team members to review: ${pullRequest.url}.`));\n             // Wait for the Pull Request to be merged.\n-            yield this.waitForPullRequestToBeMerged(id);\n+            yield this.waitForPullRequestToBeMerged(pullRequest);\n             return true;\n         });\n     }\n@@ -6841,8 +6841,8 @@ class CutLongTermSupportPatchAction extends ReleaseAction {\n         return tslib.__awaiter(this, void 0, void 0, function* () {\n             const ltsBranch = yield this._promptForTargetLtsBranch();\n             const newVersion = semverInc(ltsBranch.version, 'patch');\n-            const { pullRequest: { id }, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, ltsBranch.name);\n-            yield this.waitForPullRequestToBeMerged(id);\n+            const { pullRequest, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, ltsBranch.name);\n+            yield this.waitForPullRequestToBeMerged(pullRequest);\n             yield this.buildAndPublish(releaseNotes, ltsBranch.name, ltsBranch.npmDistTag);\n             yield this.cherryPickChangelogIntoNextBranch(releaseNotes, ltsBranch.name);\n         });\n@@ -6918,8 +6918,8 @@ class CutNewPatchAction extends ReleaseAction {\n         return tslib.__awaiter(this, void 0, void 0, function* () {\n             const { branchName } = this.active.latest;\n             const newVersion = this._newVersion;\n-            const { pullRequest: { id }, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n-            yield this.waitForPullRequestToBeMerged(id);\n+            const { pullRequest, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n+            yield this.waitForPullRequestToBeMerged(pullRequest);\n             yield this.buildAndPublish(releaseNotes, branchName, 'latest');\n             yield this.cherryPickChangelogIntoNextBranch(releaseNotes, branchName);\n         });\n@@ -6988,8 +6988,8 @@ class CutNextPrereleaseAction extends ReleaseAction {\n             const releaseTrain = this._getActivePrereleaseTrain();\n             const { branchName } = releaseTrain;\n             const newVersion = yield this._newVersion;\n-            const { pullRequest: { id }, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n-            yield this.waitForPullRequestToBeMerged(id);\n+            const { pullRequest, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n+            yield this.waitForPullRequestToBeMerged(pullRequest);\n             yield this.buildAndPublish(releaseNotes, branchName, 'next');\n             // If the pre-release has been cut from a branch that is not corresponding\n             // to the next release-train, cherry-pick the changelog into the primary\n@@ -7055,8 +7055,8 @@ class CutReleaseCandidateAction extends ReleaseAction {\n         return tslib.__awaiter(this, void 0, void 0, function* () {\n             const { branchName } = this.active.releaseCandidate;\n             const newVersion = this._newVersion;\n-            const { pullRequest: { id }, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n-            yield this.waitForPullRequestToBeMerged(id);\n+            const { pullRequest, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n+            yield this.waitForPullRequestToBeMerged(pullRequest);\n             yield this.buildAndPublish(releaseNotes, branchName, 'next');\n             yield this.cherryPickChangelogIntoNextBranch(releaseNotes, branchName);\n         });\n@@ -7099,8 +7099,8 @@ class CutStableAction extends ReleaseAction {\n             const { branchName } = this.active.releaseCandidate;\n             const newVersion = this._newVersion;\n             const isNewMajor = (_a = this.active.releaseCandidate) === null || _a === void 0 ? void 0 : _a.isMajor;\n-            const { pullRequest: { id }, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n-            yield this.waitForPullRequestToBeMerged(id);\n+            const { pullRequest, releaseNotes } = yield this.checkoutBranchAndStageVersion(newVersion, branchName);\n+            yield this.waitForPullRequestToBeMerged(pullRequest);\n             // If a new major version is published, we publish to the `next` NPM dist tag temporarily.\n             // We do this because for major versions, we want all main Angular projects to have their\n             // new major become available at the same time. Publishing immediately to the `latest` NPM\n@@ -7179,11 +7179,11 @@ class MoveNextIntoFeatureFreezeAction extends ReleaseAction {\n             // Stage the new version for the newly created branch, and push changes to a\n             // fork in order to create a staging pull request. Note that we re-use the newly\n             // created branch instead of re-fetching from the upstream.\n-            const { pullRequest: { id }, releaseNotes } = yield this.stageVersionForBranchAndCreatePullRequest(newVersion, newBranch);\n+            const { pullRequest, releaseNotes } = yield this.stageVersionForBranchAndCreatePullRequest(newVersion, newBranch);\n             // Wait for the staging PR to be merged. Then build and publish the feature-freeze next\n             // pre-release. Finally, cherry-pick the release notes into the next branch in combination\n             // with bumping the version to the next minor too.\n-            yield this.waitForPullRequestToBeMerged(id);\n+            yield this.waitForPullRequestToBeMerged(pullRequest);\n             yield this.buildAndPublish(releaseNotes, newBranch, 'next');\n             yield this._createNextBranchUpdatePullRequest(releaseNotes, newVersion);\n         });"
        },
        {
            "sha": "c33f1950a4ed34b6410e9c78bd78eef2a6dce714",
            "filename": "dev-infra/release/publish/actions.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "raw_url": "https://github.com/angular/angular/raw/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions.ts?ref=89509dffd26b714ecb774ba1a590661edd59a7ad",
            "patch": "@@ -291,8 +291,8 @@ export abstract class ReleaseAction {\n    * API is 10 seconds (to not exceed any rate limits). If the pull request is closed without\n    * merge, the script will abort gracefully (considering a manual user abort).\n    */\n-  protected async waitForPullRequestToBeMerged(id: number, interval = waitForPullRequestInterval):\n-      Promise<void> {\n+  protected async waitForPullRequestToBeMerged(\n+      {id}: PullRequest, interval = waitForPullRequestInterval): Promise<void> {\n     return new Promise((resolve, reject) => {\n       debug(`Waiting for pull request #${id} to be merged.`);\n \n@@ -399,18 +399,18 @@ export abstract class ReleaseAction {\n     info(green(`  ✓   Created changelog cherry-pick commit for: \"${releaseNotes.version}\".`));\n \n     // Create a cherry-pick pull request that should be merged by the caretaker.\n-    const {url, id} = await this.pushChangesToForkAndCreatePullRequest(\n+    const pullRequest = await this.pushChangesToForkAndCreatePullRequest(\n         nextBranch, `changelog-cherry-pick-${releaseNotes.version}`, commitMessage,\n         `Cherry-picks the changelog from the \"${stagingBranch}\" branch to the next ` +\n             `branch (${nextBranch}).`);\n \n     info(green(\n         `  ✓   Pull request for cherry-picking the changelog into \"${nextBranch}\" ` +\n         'has been created.'));\n-    info(yellow(`      Please ask team members to review: ${url}.`));\n+    info(yellow(`      Please ask team members to review: ${pullRequest.url}.`));\n \n     // Wait for the Pull Request to be merged.\n-    await this.waitForPullRequestToBeMerged(id);\n+    await this.waitForPullRequestToBeMerged(pullRequest);\n \n     return true;\n   }"
        },
        {
            "sha": "7a5a06f0eb4e30f6e8c4c53f0969576d17f37663",
            "filename": "dev-infra/release/publish/actions/cut-lts-patch.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-lts-patch.ts",
            "raw_url": "https://github.com/angular/angular/raw/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-lts-patch.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-lts-patch.ts?ref=89509dffd26b714ecb774ba1a590661edd59a7ad",
            "patch": "@@ -30,10 +30,10 @@ export class CutLongTermSupportPatchAction extends ReleaseAction {\n   override async perform() {\n     const ltsBranch = await this._promptForTargetLtsBranch();\n     const newVersion = semverInc(ltsBranch.version, 'patch');\n-    const {pullRequest: {id}, releaseNotes} =\n+    const {pullRequest, releaseNotes} =\n         await this.checkoutBranchAndStageVersion(newVersion, ltsBranch.name);\n \n-    await this.waitForPullRequestToBeMerged(id);\n+    await this.waitForPullRequestToBeMerged(pullRequest);\n     await this.buildAndPublish(releaseNotes, ltsBranch.name, ltsBranch.npmDistTag);\n     await this.cherryPickChangelogIntoNextBranch(releaseNotes, ltsBranch.name);\n   }"
        },
        {
            "sha": "5d6957aaa0145d54830a77d207f5de519059e00f",
            "filename": "dev-infra/release/publish/actions/cut-new-patch.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-new-patch.ts",
            "raw_url": "https://github.com/angular/angular/raw/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-new-patch.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-new-patch.ts?ref=89509dffd26b714ecb774ba1a590661edd59a7ad",
            "patch": "@@ -28,10 +28,10 @@ export class CutNewPatchAction extends ReleaseAction {\n     const {branchName} = this.active.latest;\n     const newVersion = this._newVersion;\n \n-    const {pullRequest: {id}, releaseNotes} =\n+    const {pullRequest, releaseNotes} =\n         await this.checkoutBranchAndStageVersion(newVersion, branchName);\n \n-    await this.waitForPullRequestToBeMerged(id);\n+    await this.waitForPullRequestToBeMerged(pullRequest);\n     await this.buildAndPublish(releaseNotes, branchName, 'latest');\n     await this.cherryPickChangelogIntoNextBranch(releaseNotes, branchName);\n   }"
        },
        {
            "sha": "3572b8822186fb05a674cc6e166833f2a0908c89",
            "filename": "dev-infra/release/publish/actions/cut-next-prerelease.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-next-prerelease.ts",
            "raw_url": "https://github.com/angular/angular/raw/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-next-prerelease.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-next-prerelease.ts?ref=89509dffd26b714ecb774ba1a590661edd59a7ad",
            "patch": "@@ -32,10 +32,10 @@ export class CutNextPrereleaseAction extends ReleaseAction {\n     const {branchName} = releaseTrain;\n     const newVersion = await this._newVersion;\n \n-    const {pullRequest: {id}, releaseNotes} =\n+    const {pullRequest, releaseNotes} =\n         await this.checkoutBranchAndStageVersion(newVersion, branchName);\n \n-    await this.waitForPullRequestToBeMerged(id);\n+    await this.waitForPullRequestToBeMerged(pullRequest);\n     await this.buildAndPublish(releaseNotes, branchName, 'next');\n \n     // If the pre-release has been cut from a branch that is not corresponding"
        },
        {
            "sha": "ff7a9015327a367e23642c19730cad588870e9fe",
            "filename": "dev-infra/release/publish/actions/cut-release-candidate.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-release-candidate.ts",
            "raw_url": "https://github.com/angular/angular/raw/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-release-candidate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-release-candidate.ts?ref=89509dffd26b714ecb774ba1a590661edd59a7ad",
            "patch": "@@ -26,10 +26,10 @@ export class CutReleaseCandidateAction extends ReleaseAction {\n     const {branchName} = this.active.releaseCandidate!;\n     const newVersion = this._newVersion;\n \n-    const {pullRequest: {id}, releaseNotes} =\n+    const {pullRequest, releaseNotes} =\n         await this.checkoutBranchAndStageVersion(newVersion, branchName);\n \n-    await this.waitForPullRequestToBeMerged(id);\n+    await this.waitForPullRequestToBeMerged(pullRequest);\n     await this.buildAndPublish(releaseNotes, branchName, 'next');\n     await this.cherryPickChangelogIntoNextBranch(releaseNotes, branchName);\n   }"
        },
        {
            "sha": "7c8747a8dba63022fb0f4b3c6a0f814002d80703",
            "filename": "dev-infra/release/publish/actions/cut-stable.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-stable.ts",
            "raw_url": "https://github.com/angular/angular/raw/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-stable.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fcut-stable.ts?ref=89509dffd26b714ecb774ba1a590661edd59a7ad",
            "patch": "@@ -30,10 +30,10 @@ export class CutStableAction extends ReleaseAction {\n     const newVersion = this._newVersion;\n     const isNewMajor = this.active.releaseCandidate?.isMajor;\n \n-    const {pullRequest: {id}, releaseNotes} =\n+    const {pullRequest, releaseNotes} =\n         await this.checkoutBranchAndStageVersion(newVersion, branchName);\n \n-    await this.waitForPullRequestToBeMerged(id);\n+    await this.waitForPullRequestToBeMerged(pullRequest);\n \n     // If a new major version is published, we publish to the `next` NPM dist tag temporarily.\n     // We do this because for major versions, we want all main Angular projects to have their"
        },
        {
            "sha": "2259cced9e138f40bf8708fea88a39ecdb98599a",
            "filename": "dev-infra/release/publish/actions/move-next-into-feature-freeze.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions%2Fmove-next-into-feature-freeze.ts",
            "raw_url": "https://github.com/angular/angular/raw/89509dffd26b714ecb774ba1a590661edd59a7ad/dev-infra%2Frelease%2Fpublish%2Factions%2Fmove-next-into-feature-freeze.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions%2Fmove-next-into-feature-freeze.ts?ref=89509dffd26b714ecb774ba1a590661edd59a7ad",
            "patch": "@@ -40,13 +40,13 @@ export class MoveNextIntoFeatureFreezeAction extends ReleaseAction {\n     // Stage the new version for the newly created branch, and push changes to a\n     // fork in order to create a staging pull request. Note that we re-use the newly\n     // created branch instead of re-fetching from the upstream.\n-    const {pullRequest: {id}, releaseNotes} =\n+    const {pullRequest, releaseNotes} =\n         await this.stageVersionForBranchAndCreatePullRequest(newVersion, newBranch);\n \n     // Wait for the staging PR to be merged. Then build and publish the feature-freeze next\n     // pre-release. Finally, cherry-pick the release notes into the next branch in combination\n     // with bumping the version to the next minor too.\n-    await this.waitForPullRequestToBeMerged(id);\n+    await this.waitForPullRequestToBeMerged(pullRequest);\n     await this.buildAndPublish(releaseNotes, newBranch, 'next');\n     await this._createNextBranchUpdatePullRequest(releaseNotes, newVersion);\n   }"
        }
    ],
    "stats": {
        "total": 66,
        "additions": 33,
        "deletions": 33
    }
}