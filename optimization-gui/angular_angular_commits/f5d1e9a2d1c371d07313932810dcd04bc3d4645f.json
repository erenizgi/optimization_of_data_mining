{
    "author": "sonukapoor",
    "message": "docs(service-worker): add section to explain unrecoverable state (#36847)\n\nPR Close #36847",
    "sha": "f5d1e9a2d1c371d07313932810dcd04bc3d4645f",
    "files": [
        {
            "sha": "2754fa052a158a122c6729b1a0e3507c06012869",
            "filename": "aio/content/examples/service-worker-getting-started/src/app/handle-unrecoverable-state.service.ts",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/f5d1e9a2d1c371d07313932810dcd04bc3d4645f/aio%2Fcontent%2Fexamples%2Fservice-worker-getting-started%2Fsrc%2Fapp%2Fhandle-unrecoverable-state.service.ts",
            "raw_url": "https://github.com/angular/angular/raw/f5d1e9a2d1c371d07313932810dcd04bc3d4645f/aio%2Fcontent%2Fexamples%2Fservice-worker-getting-started%2Fsrc%2Fapp%2Fhandle-unrecoverable-state.service.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fservice-worker-getting-started%2Fsrc%2Fapp%2Fhandle-unrecoverable-state.service.ts?ref=f5d1e9a2d1c371d07313932810dcd04bc3d4645f",
            "patch": "@@ -0,0 +1,17 @@\n+import { Injectable } from '@angular/core';\n+import { SwUpdate } from '@angular/service-worker';\n+\n+function notifyUser(message: string): void { }\n+\n+// #docregion sw-unrecoverable-state\n+@Injectable()\n+export class HandleUnrecoverableStateService {\n+  constructor(updates: SwUpdate) {\n+    updates.unrecoverable.subscribe(event => {\n+      notifyUser(\n+        `An error occurred that we cannot recover from:\\n${event.reason}\\n\\n` +\n+        'Please reload the page.');\n+    });\n+  }\n+}\n+// #enddocregion sw-unrecoverable-state"
        },
        {
            "sha": "d38287973b572cb1a305175b0bb9f1f8a10b5cd1",
            "filename": "aio/content/guide/service-worker-communications.md",
            "status": "modified",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/f5d1e9a2d1c371d07313932810dcd04bc3d4645f/aio%2Fcontent%2Fguide%2Fservice-worker-communications.md",
            "raw_url": "https://github.com/angular/angular/raw/f5d1e9a2d1c371d07313932810dcd04bc3d4645f/aio%2Fcontent%2Fguide%2Fservice-worker-communications.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fguide%2Fservice-worker-communications.md?ref=f5d1e9a2d1c371d07313932810dcd04bc3d4645f",
            "patch": "@@ -67,6 +67,33 @@ Therefore, it is recommended to reload the page once the promise returned by `ac\n \n </div>\n \n+### Handling an unrecoverable state\n+\n+In some cases, the version of the app used by the service worker to serve a client might be in a broken state that cannot be recovered from without a full page reload.\n+\n+For example, imagine the following scenario:\n+- A user opens the app for the first time and the service worker caches the latest version of the app.\n+  Let's assume the app's cached assets include `index.html`, `main.<main-hash-1>.js` and `lazy-chunk.<lazy-hash-1>.js`.\n+- The user closes the app and does not open it for a while.\n+- After some time, a new version of the app is deployed to the server.\n+  This newer version includes the files `index.html`, `main.<main-hash-2>.js` and `lazy-chunk.<lazy-hash-2>.js` (note that the hashes are different now, because the content of the files has changed).\n+  The old version is no longer available on the server.\n+- In the meantime, the user's browser decides to evict `lazy-chunk.<lazy-hash-1>.js` from its cache.\n+  Browsers may decide to evict specific (or all) resources from a cache in order to reclaim disk space.\n+- The user opens the app again.\n+  The service worker serves the latest version known to it at this point, namely the old version (`index.html` and `main.<main-hash-1>.js`).\n+- At some later point, the app requests the lazy bundle, `lazy-chunk.<lazy-hash-1>.js`.\n+- The service worker is unable to find the asset in the cache (remember that the browser evicted it).\n+  Nor is it able to retrieve it from the server (since the server now only has `lazy-chunk.<lazy-hash-2>.js` from the newer version).\n+\n+In the above scenario, the service worker is not able to serve an asset that would normally be cached.\n+That particular app version is broken and there is no way to fix the state of the client without reloading the page.\n+In such cases, the service worker notifies the client by sending an `UnrecoverableStateEvent` event.\n+You can subscribe to `SwUpdate#unrecoverable` to be notified and handle these errors.\n+\n+<code-example path=\"service-worker-getting-started/src/app/handle-unrecoverable-state.service.ts\" header=\"handle-unrecoverable-state.service.ts\" region=\"sw-unrecoverable-state\"></code-example>\n+\n+\n ## More on Angular service workers\n \n You may also be interested in the following:"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 44,
        "deletions": 0
    }
}