{
    "author": "kyliau",
    "message": "fix(language-service): reinstate overridden compiler option after change (#40364)\n\nCurrently the language service has to force `compileNonExportedClasses` to\n`true` to handle inline NgModules in tests, regardless of the value in user's\ntsconfig.json.\n\nHowever, the override is not reinstated after the compiler option changes\n(triggered by a change in tsconfig.json).\nThis commit fixes the bug.\n\nPR Close #40364",
    "sha": "811cacc80c01ab8af875f14a9e98ea3b7a5a2072",
    "files": [
        {
            "sha": "82e3b75d9ff83a0af438c995b0f7e215dcd4223f",
            "filename": "packages/language-service/ivy/language_service.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 12,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/811cacc80c01ab8af875f14a9e98ea3b7a5a2072/packages%2Flanguage-service%2Fivy%2Flanguage_service.ts",
            "raw_url": "https://github.com/angular/angular/raw/811cacc80c01ab8af875f14a9e98ea3b7a5a2072/packages%2Flanguage-service%2Fivy%2Flanguage_service.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Flanguage_service.ts?ref=811cacc80c01ab8af875f14a9e98ea3b7a5a2072",
            "patch": "@@ -32,18 +32,6 @@ export class LanguageService {\n   constructor(project: ts.server.Project, private readonly tsLS: ts.LanguageService) {\n     this.parseConfigHost = new LSParseConfigHost(project.projectService.host);\n     this.options = parseNgCompilerOptions(project, this.parseConfigHost);\n-\n-    // Projects loaded into the Language Service often include test files which are not part of the\n-    // app's main compilation unit, and these test files often include inline NgModules that declare\n-    // components from the app. These declarations conflict with the main declarations of such\n-    // components in the app's NgModules. This conflict is not normally present during regular\n-    // compilation because the app and the tests are part of separate compilation units.\n-    //\n-    // As a temporary mitigation of this problem, we instruct the compiler to ignore classes which\n-    // are not exported. In many cases, this ensures the test NgModules are ignored by the compiler\n-    // and only the real component declaration is used.\n-    this.options.compileNonExportedClasses = false;\n-\n     this.strategy = createTypeCheckingProgramStrategy(project);\n     this.adapter = new LanguageServiceAdapter(project);\n     this.compilerFactory = new CompilerFactory(this.adapter, this.strategy, this.options);\n@@ -213,6 +201,17 @@ function parseNgCompilerOptions(\n     project.setProjectErrors(errors);\n   }\n \n+  // Projects loaded into the Language Service often include test files which are not part of the\n+  // app's main compilation unit, and these test files often include inline NgModules that declare\n+  // components from the app. These declarations conflict with the main declarations of such\n+  // components in the app's NgModules. This conflict is not normally present during regular\n+  // compilation because the app and the tests are part of separate compilation units.\n+  //\n+  // As a temporary mitigation of this problem, we instruct the compiler to ignore classes which\n+  // are not exported. In many cases, this ensures the test NgModules are ignored by the compiler\n+  // and only the real component declaration is used.\n+  options.compileNonExportedClasses = false;\n+\n   return options;\n }\n "
        }
    ],
    "stats": {
        "total": 23,
        "additions": 11,
        "deletions": 12
    }
}