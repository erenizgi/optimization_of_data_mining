{
    "author": "sonukapoor",
    "message": "refactor(docs-infra): Lazy-loads SVG icons (#38268)\n\nPrior to this commit, SVG icons were all loaded in the constructor\nof the `CustomIconRegistry`. This commit avoids that, and loads SVG\nicons on demand.\n\nPR Close #38268",
    "sha": "1b17722091775317418a7ce023fbb5827b040a54",
    "files": [
        {
            "sha": "5400b88e016b1a3536aaa53eee02f1f32f1b0b89",
            "filename": "aio/src/app/shared/custom-icon-registry.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 15,
            "changes": 43,
            "blob_url": "https://github.com/angular/angular/blob/1b17722091775317418a7ce023fbb5827b040a54/aio%2Fsrc%2Fapp%2Fshared%2Fcustom-icon-registry.ts",
            "raw_url": "https://github.com/angular/angular/raw/1b17722091775317418a7ce023fbb5827b040a54/aio%2Fsrc%2Fapp%2Fshared%2Fcustom-icon-registry.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fshared%2Fcustom-icon-registry.ts?ref=1b17722091775317418a7ce023fbb5827b040a54",
            "patch": "@@ -39,35 +39,48 @@ const DEFAULT_NS = '$$default';\n  */\n @Injectable()\n export class CustomIconRegistry extends MatIconRegistry {\n-  private preloadedSvgElements: SvgIconMap = {[DEFAULT_NS]: {}};\n+  private cachedSvgElements: SvgIconMap = {[DEFAULT_NS]: {}};\n \n   constructor(http: HttpClient, sanitizer: DomSanitizer, @Optional() @Inject(DOCUMENT) document: Document,\n-              errorHandler: ErrorHandler, @Inject(SVG_ICONS) svgIcons: SvgIconInfo[]) {\n+              errorHandler: ErrorHandler, @Inject(SVG_ICONS) private svgIcons: SvgIconInfo[]) {\n     super(http, sanitizer, document, errorHandler);\n-    this.loadSvgElements(svgIcons);\n   }\n \n   getNamedSvgIcon(iconName: string, namespace?: string) {\n-    const nsIconMap = this.preloadedSvgElements[namespace || DEFAULT_NS];\n-    const preloadedElement = nsIconMap && nsIconMap[iconName];\n+    const nsIconMap = this.cachedSvgElements[namespace || DEFAULT_NS];\n+    let preloadedElement: SVGElement | undefined = nsIconMap && nsIconMap[iconName];\n+    if (!preloadedElement) {\n+      preloadedElement = this.loadSvgElement(iconName, namespace);\n+    }\n \n     return preloadedElement\n         ? of(preloadedElement.cloneNode(true) as SVGElement)\n         : super.getNamedSvgIcon(iconName, namespace);\n   }\n \n-  private loadSvgElements(svgIcons: SvgIconInfo[]) {\n-    svgIcons.forEach(icon => {\n-      const ns = icon.namespace || DEFAULT_NS;\n-      const nsIconMap = this.preloadedSvgElements[ns] || (this.preloadedSvgElements[ns] = {});\n+  private loadSvgElement(iconName: string, namespace?: string): SVGElement | undefined {\n+    const svgIcon = this.svgIcons.find(icon => {\n+      return namespace\n+      ? icon.name === iconName && icon.namespace === namespace\n+      : icon.name === iconName;\n+    });\n \n-      // Creating a new `<div>` per icon is necessary for the SVGs to work correctly in IE11.\n-      const div = document.createElement('DIV');\n+    if (!svgIcon) {\n+      return;\n+    }\n \n-      // SECURITY: the source for the SVG icons is provided in code by trusted developers\n-      div.innerHTML = icon.svgSource;\n+    const ns = svgIcon.namespace || DEFAULT_NS;\n+    const nsIconMap = this.cachedSvgElements[ns] || (this.cachedSvgElements[ns] = {});\n \n-      nsIconMap[icon.name] = div.querySelector('svg')!;\n-    });\n+    // Creating a new `<div>` per icon is necessary for the SVGs to work correctly in IE11.\n+    const div = document.createElement('DIV');\n+\n+    // SECURITY: the source for the SVG icons is provided in code by trusted developers\n+    div.innerHTML = svgIcon.svgSource;\n+\n+    const svgElement = div.querySelector('svg')!;\n+    nsIconMap[svgIcon.name] = svgElement;\n+\n+    return svgElement;\n   }\n }"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 28,
        "deletions": 15
    }
}