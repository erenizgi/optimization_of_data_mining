{
    "author": "ivanwonder",
    "message": "fix(language-service): global autocomplete doesn't work when the user tries to modify the symbol (#42923)\n\nWhen the user tries to trigger suggestions from an interruption,\nthe LS should provide the global completions. For example,\n`[input]=\"t¦\"`, the `t` can be the `true` or the symbol from\nthe component context.\n\nPR Close #42923",
    "sha": "f0c5ba08f63c60f7542dfd3592c4cfd42bd579bc",
    "files": [
        {
            "sha": "48e64cb30453e6917fe411982329de5797fb7fd5",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/completion.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/f0c5ba08f63c60f7542dfd3592c4cfd42bd579bc/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fcompletion.ts",
            "raw_url": "https://github.com/angular/angular/raw/f0c5ba08f63c60f7542dfd3592c4cfd42bd579bc/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fcompletion.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fcompletion.ts?ref=f0c5ba08f63c60f7542dfd3592c4cfd42bd579bc",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import {TmplAstReference, TmplAstTemplate} from '@angular/compiler';\n-import {AST, EmptyExpr, LiteralPrimitive, MethodCall, PropertyRead, PropertyWrite, SafeMethodCall, SafePropertyRead, TmplAstNode} from '@angular/compiler/src/compiler';\n+import {AST, EmptyExpr, ImplicitReceiver, LiteralPrimitive, MethodCall, PropertyRead, PropertyWrite, SafeMethodCall, SafePropertyRead, TmplAstNode} from '@angular/compiler/src/compiler';\n import {TextAttribute} from '@angular/compiler/src/render3/r3_ast';\n import * as ts from 'typescript';\n \n@@ -91,6 +91,19 @@ export class CompletionEngine {\n       }\n     }\n \n+    if (node instanceof PropertyRead && node.receiver instanceof ImplicitReceiver) {\n+      const nodeLocation = findFirstMatchingNode(this.tcb, {\n+        filter: ts.isPropertyAccessExpression,\n+        withSpan: node.sourceSpan,\n+      });\n+      if (nodeLocation) {\n+        nodeContext = {\n+          shimPath: this.shimPath,\n+          positionInShimFile: nodeLocation.getStart(),\n+        };\n+      }\n+    }\n+\n     return {\n       componentContext: this.componentContext,\n       templateContext,"
        },
        {
            "sha": "83c565119fe2bcb14bc3c9358d29d40664500105",
            "filename": "packages/language-service/ivy/test/completions_spec.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/f0c5ba08f63c60f7542dfd3592c4cfd42bd579bc/packages%2Flanguage-service%2Fivy%2Ftest%2Fcompletions_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/f0c5ba08f63c60f7542dfd3592c4cfd42bd579bc/packages%2Flanguage-service%2Fivy%2Ftest%2Fcompletions_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fcompletions_spec.ts?ref=f0c5ba08f63c60f7542dfd3592c4cfd42bd579bc",
            "patch": "@@ -234,6 +234,18 @@ describe('completions', () => {\n          const {templateFile} = setup(`<input dir [myInput]=\"\">`, '', DIR_WITH_UNION_TYPE_INPUT);\n          templateFile.moveCursorToText('dir [myInput]=\"¦\">');\n \n+         const completions = templateFile.getCompletionsAtPosition();\n+         expectContain(completions, ts.ScriptElementKind.string, [`'foo'`, '42']);\n+         expectContain(completions, ts.ScriptElementKind.keyword, ['null']);\n+         expectContain(completions, ts.ScriptElementKind.variableElement, ['undefined']);\n+         expectDoesNotContain(completions, ts.ScriptElementKind.parameterElement, ['ctx']);\n+       });\n+\n+    it('should return completions of string literals, number literals, `true`, `false`, `null` and `undefined` when the user tries to modify the symbol',\n+       () => {\n+         const {templateFile} = setup(`<input dir [myInput]=\"a\">`, '', DIR_WITH_UNION_TYPE_INPUT);\n+         templateFile.moveCursorToText('dir [myInput]=\"a¦\">');\n+\n          const completions = templateFile.getCompletionsAtPosition();\n          expectContain(completions, ts.ScriptElementKind.string, [`'foo'`, '42']);\n          expectContain(completions, ts.ScriptElementKind.keyword, ['null']);"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 26,
        "deletions": 1
    }
}