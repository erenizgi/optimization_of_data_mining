{
    "author": "alxhub",
    "message": "test(compiler-cli): fix assertion of diagnostic filename on Windows (#37758)\n\nSeveral partial_evaluator tests in the diagnostics_spec check assert\ncorrectness of diagnostic filenames. Previously these assertions compared\na resolved (`absoluteFrom`) filename with the TypeScript `ts.SourceFile`'s\n`fileName` string, which caused the tests to fail on Windows because the\ndrive letter case differed.\n\nThis commit changes the assertions to use `absoluteFromSourceFile` instead\nof the `fileName` string, resulting in an apples-to-apples comparison of\ncanonicalized paths.\n\nPR Close #37758",
    "sha": "8572e885b4fbb93a881612753af876834321754d",
    "files": [
        {
            "sha": "e74b41bda7b2aed57c70836efc51969389b611ef",
            "filename": "packages/compiler-cli/src/ngtsc/partial_evaluator/test/diagnostics_spec.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 21,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/8572e885b4fbb93a881612753af876834321754d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fpartial_evaluator%2Ftest%2Fdiagnostics_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8572e885b4fbb93a881612753af876834321754d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fpartial_evaluator%2Ftest%2Fdiagnostics_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fpartial_evaluator%2Ftest%2Fdiagnostics_spec.ts?ref=8572e885b4fbb93a881612753af876834321754d",
            "patch": "@@ -8,7 +8,7 @@\n \n import * as ts from 'typescript';\n \n-import {absoluteFrom as _} from '../../file_system';\n+import {absoluteFrom as _, absoluteFromSourceFile} from '../../file_system';\n import {runInEachFileSystem} from '../../file_system/testing';\n import {Reference} from '../../imports';\n import {TypeScriptReflectionHost} from '../../reflection';\n@@ -109,7 +109,7 @@ runInEachFileSystem(() => {\n \n         expect(trace.length).toBe(1);\n         expect(trace[0].messageText).toBe(`Unknown reference.`);\n-        expect(trace[0].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[0].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[0])).toBe('nonexistent');\n       });\n \n@@ -118,7 +118,7 @@ runInEachFileSystem(() => {\n \n         expect(trace.length).toBe(1);\n         expect(trace[0].messageText).toBe(`Unknown reference.`);\n-        expect(trace[0].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[0].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[0])).toBe('nonexistent');\n       });\n \n@@ -127,11 +127,11 @@ runInEachFileSystem(() => {\n \n         expect(trace.length).toBe(2);\n         expect(trace[0].messageText).toBe('Unable to evaluate this expression statically.');\n-        expect(trace[0].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[0].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[0])).toBe('value');\n \n         expect(trace[1].messageText).toBe('Unknown reference.');\n-        expect(trace[1].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[1].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[1])).toBe('nonexistent');\n       });\n \n@@ -145,21 +145,21 @@ runInEachFileSystem(() => {\n \n         expect(trace.length).toBe(4);\n         expect(trace[0].messageText).toBe('Unable to evaluate this expression statically.');\n-        expect(trace[0].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[0].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[0])).toBe('child');\n \n         expect(trace[1].messageText).toBe('Unable to evaluate this expression statically.');\n-        expect(trace[1].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[1].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[1])).toBe('firstChild');\n \n         expect(trace[2].messageText).toBe('Unable to evaluate this expression statically.');\n-        expect(trace[2].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[2].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[2])).toBe('document.body');\n \n         expect(trace[3].messageText)\n             .toBe(\n                 `A value for 'document' cannot be determined statically, as it is an external declaration.`);\n-        expect(trace[3].file!.fileName).toBe(_('/lib.d.ts'));\n+        expect(absoluteFromSourceFile(trace[3].file!)).toBe(_('/lib.d.ts'));\n         expect(getSourceCode(trace[3])).toBe('document: any');\n       });\n \n@@ -168,7 +168,7 @@ runInEachFileSystem(() => {\n \n         expect(trace.length).toBe(1);\n         expect(trace[0].messageText).toBe('A string value could not be determined statically.');\n-        expect(trace[0].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[0].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[0])).toBe('document');\n       });\n \n@@ -177,7 +177,7 @@ runInEachFileSystem(() => {\n \n         expect(trace.length).toBe(1);\n         expect(trace[0].messageText).toBe('Unable to evaluate an invalid expression.');\n-        expect(trace[0].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[0].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[0])).toBe('true');\n       });\n \n@@ -186,7 +186,7 @@ runInEachFileSystem(() => {\n \n         expect(trace.length).toBe(1);\n         expect(trace[0].messageText).toBe('This syntax is not supported.');\n-        expect(trace[0].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[0].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[0])).toBe('new String(\\'test\\')');\n       });\n \n@@ -203,11 +203,11 @@ runInEachFileSystem(() => {\n         expect(trace[0].messageText)\n             .toBe(\n                 'Unable to evaluate function call of complex function. A function must have exactly one return statement.');\n-        expect(trace[0].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[0].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[0])).toBe('complex()');\n \n         expect(trace[1].messageText).toBe('Function is declared here.');\n-        expect(trace[1].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[1].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[1])).toContain(`console.log('test');`);\n       });\n \n@@ -216,13 +216,13 @@ runInEachFileSystem(() => {\n \n         expect(trace.length).toBe(2);\n         expect(trace[0].messageText).toBe('Unable to evaluate this expression statically.');\n-        expect(trace[0].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[0].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[0])).toBe('body: {firstChild}');\n \n         expect(trace[1].messageText)\n             .toBe(\n                 `A value for 'document' cannot be determined statically, as it is an external declaration.`);\n-        expect(trace[1].file!.fileName).toBe(_('/lib.d.ts'));\n+        expect(absoluteFromSourceFile(trace[1].file!)).toBe(_('/lib.d.ts'));\n         expect(getSourceCode(trace[1])).toBe('document: any');\n       });\n \n@@ -232,13 +232,13 @@ runInEachFileSystem(() => {\n \n         expect(trace.length).toBe(2);\n         expect(trace[0].messageText).toBe('Unable to evaluate this expression statically.');\n-        expect(trace[0].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[0].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[0])).toBe('body: {firstChild}');\n \n         expect(trace[1].messageText)\n             .toBe(\n                 `A value for 'document' cannot be determined statically, as it is an external declaration.`);\n-        expect(trace[1].file!.fileName).toBe(_('/lib.d.ts'));\n+        expect(absoluteFromSourceFile(trace[1].file!)).toBe(_('/lib.d.ts'));\n         expect(getSourceCode(trace[1])).toBe('document: any');\n       });\n \n@@ -248,17 +248,17 @@ runInEachFileSystem(() => {\n \n         expect(trace.length).toBe(3);\n         expect(trace[0].messageText).toBe('Unable to evaluate this expression statically.');\n-        expect(trace[0].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[0].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[0])).toBe('firstChild');\n \n         expect(trace[1].messageText).toBe('Unable to evaluate this expression statically.');\n-        expect(trace[1].file!.fileName).toBe(_('/entry.ts'));\n+        expect(absoluteFromSourceFile(trace[1].file!)).toBe(_('/entry.ts'));\n         expect(getSourceCode(trace[1])).toBe('document.body');\n \n         expect(trace[2].messageText)\n             .toBe(\n                 `A value for 'document' cannot be determined statically, as it is an external declaration.`);\n-        expect(trace[2].file!.fileName).toBe(_('/lib.d.ts'));\n+        expect(absoluteFromSourceFile(trace[2].file!)).toBe(_('/lib.d.ts'));\n         expect(getSourceCode(trace[2])).toBe('document: any');\n       });\n     });"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 21,
        "deletions": 21
    }
}