{
    "author": "bjarkler",
    "message": "fix(core): use Trusted Types policy in inert DOM builder (#39208)\n\nWhen Angular is used in an environment that enforces Trusted Types, the\ninert DOM builder raises a Trusted Types violation due to its use of\nDOMParser and element.innerHTML with plain strings. Since it is only\nused internally (in the HTML sanitizer and for i18n ICU parsing), we\nupdate it to use Angular's Trusted Types policy to promote the provided\nHTML to TrustedHTML.\n\nPR Close #39208",
    "sha": "7d4929918dace806d9165733f13899fa5d6c759c",
    "files": [
        {
            "sha": "d4aed031636ce5a0eefa32c9bf8e3a8d0a9b3c82",
            "filename": "packages/core/src/sanitization/inert_body.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/7d4929918dace806d9165733f13899fa5d6c759c/packages%2Fcore%2Fsrc%2Fsanitization%2Finert_body.ts",
            "raw_url": "https://github.com/angular/angular/raw/7d4929918dace806d9165733f13899fa5d6c759c/packages%2Fcore%2Fsrc%2Fsanitization%2Finert_body.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fsanitization%2Finert_body.ts?ref=7d4929918dace806d9165733f13899fa5d6c759c",
            "patch": "@@ -6,6 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {trustedHTMLFromString} from '../util/security/trusted_types';\n+\n /**\n  * This helper is used to get hold of an inert tree of DOM elements containing dirty HTML\n  * that needs sanitizing.\n@@ -36,8 +38,9 @@ class DOMParserHelper implements InertBodyHelper {\n     // in `html` from consuming the otherwise explicit `</body>` tag.\n     html = '<body><remove></remove>' + html;\n     try {\n-      const body = new (window as any).DOMParser().parseFromString(html, 'text/html').body as\n-          HTMLBodyElement;\n+      const body = new window.DOMParser()\n+                       .parseFromString(trustedHTMLFromString(html) as string, 'text/html')\n+                       .body as HTMLBodyElement;\n       body.removeChild(body.firstChild!);\n       return body;\n     } catch {\n@@ -71,7 +74,7 @@ class InertDocumentHelper implements InertBodyHelper {\n     // Prefer using <template> element if supported.\n     const templateEl = this.inertDocument.createElement('template');\n     if ('content' in templateEl) {\n-      templateEl.innerHTML = html;\n+      templateEl.innerHTML = trustedHTMLFromString(html) as string;\n       return templateEl;\n     }\n \n@@ -83,7 +86,7 @@ class InertDocumentHelper implements InertBodyHelper {\n     // down the line. This has been worked around by creating a new inert `body` and using it as\n     // the root node in which we insert the HTML.\n     const inertBody = this.inertDocument.createElement('body');\n-    inertBody.innerHTML = html;\n+    inertBody.innerHTML = trustedHTMLFromString(html) as string;\n \n     // Support: IE 9-11 only\n     // strip custom-namespaced attributes on IE<=11\n@@ -129,7 +132,8 @@ class InertDocumentHelper implements InertBodyHelper {\n  */\n export function isDOMParserAvailable() {\n   try {\n-    return !!new (window as any).DOMParser().parseFromString('', 'text/html');\n+    return !!new window.DOMParser().parseFromString(\n+        trustedHTMLFromString('') as string, 'text/html');\n   } catch {\n     return false;\n   }"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 9,
        "deletions": 5
    }
}