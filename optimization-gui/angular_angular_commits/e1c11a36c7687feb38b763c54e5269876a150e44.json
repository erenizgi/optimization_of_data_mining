{
    "author": "devversion",
    "message": "feat(dev-infra): introduce new configuration for release tool (#38656)\n\nIntroduces a new configuration for the `ng-dev release` command. This\nconfiguration will be the source of truth for all release packages\nand how they can be built.\n\nAdditionally, in a temporary manner where each project has its own\nway of generating the changelog, the changelog generation can be\nconfigured. This will be removed in the future when there is\ncanonical changelog generation in the dev-infra shared package.\n\nPR Close #38656",
    "sha": "e1c11a36c7687feb38b763c54e5269876a150e44",
    "files": [
        {
            "sha": "4f059b5a6ec63c69864086a9b3b0d0e8ca704b4d",
            "filename": ".ng-dev/config.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/e1c11a36c7687feb38b763c54e5269876a150e44/.ng-dev%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/e1c11a36c7687feb38b763c54e5269876a150e44/.ng-dev%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.ng-dev%2Fconfig.ts?ref=e1c11a36c7687feb38b763c54e5269876a150e44",
            "patch": "@@ -3,11 +3,13 @@ import {commitMessage} from './commit-message';\n import {format} from './format';\n import {github} from './github';\n import {merge} from './merge';\n+import {release} from './release';\n \n module.exports = {\n   commitMessage,\n   format,\n   github,\n   merge,\n   caretaker,\n+  release,\n };"
        },
        {
            "sha": "b285ece61a81ca17e69f5ceb01d57090a56ccada",
            "filename": ".ng-dev/release.ts",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/e1c11a36c7687feb38b763c54e5269876a150e44/.ng-dev%2Frelease.ts",
            "raw_url": "https://github.com/angular/angular/raw/e1c11a36c7687feb38b763c54e5269876a150e44/.ng-dev%2Frelease.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.ng-dev%2Frelease.ts?ref=e1c11a36c7687feb38b763c54e5269876a150e44",
            "patch": "@@ -0,0 +1,33 @@\n+import {join} from 'path';\n+import {exec} from 'shelljs';\n+import {ReleaseConfig} from '../dev-infra/release/config';\n+\n+/** Configuration for the `ng-dev release` command. */\n+export const release: ReleaseConfig = {\n+  npmPackages: [\n+    '@angular/animations',\n+    '@angular/bazel',\n+    '@angular/common',\n+    '@angular/compiler',\n+    '@angular/compiler-cli',\n+    '@angular/core',\n+    '@angular/elements',\n+    '@angular/forms',\n+    '@angular/language-service',\n+    '@angular/localize',\n+    '@angular/platform-browser',\n+    '@angular/platform-browser-dynamic',\n+    '@angular/platform-server',\n+    '@angular/platform-webworker',\n+    '@angular/platform-webworker-dynamic',\n+    '@angular/router',\n+    '@angular/service-worker',\n+    '@angular/upgrade',\n+  ],\n+  // TODO: Implement release package building here.\n+  buildPackages: async () => [],\n+  // TODO: This can be removed once there is a org-wide tool for changelog generation.\n+  generateReleaseNotesForHead: async () => {\n+    exec('yarn -s gulp changelog', {cwd: join(__dirname, '../')});\n+  },\n+};"
        },
        {
            "sha": "b8f17b6bf200f2e805f122f83fce9bafeb276197",
            "filename": "dev-infra/release/config/BUILD.bazel",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/e1c11a36c7687feb38b763c54e5269876a150e44/dev-infra%2Frelease%2Fconfig%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/e1c11a36c7687feb38b763c54e5269876a150e44/dev-infra%2Frelease%2Fconfig%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fconfig%2FBUILD.bazel?ref=e1c11a36c7687feb38b763c54e5269876a150e44",
            "patch": "@@ -0,0 +1,14 @@\n+load(\"@npm_bazel_typescript//:index.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"config\",\n+    srcs = glob([\n+        \"**/*.ts\",\n+    ]),\n+    module_name = \"@angular/dev-infra-private/release/config\",\n+    visibility = [\"//dev-infra:__subpackages__\"],\n+    deps = [\n+        \"//dev-infra/utils\",\n+        \"@npm//@types/semver\",\n+    ],\n+)"
        },
        {
            "sha": "da1f75911600bdd8fbbc294ea84ff1f6e6663761",
            "filename": "dev-infra/release/config/index.ts",
            "status": "added",
            "additions": 63,
            "deletions": 0,
            "changes": 63,
            "blob_url": "https://github.com/angular/angular/blob/e1c11a36c7687feb38b763c54e5269876a150e44/dev-infra%2Frelease%2Fconfig%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/e1c11a36c7687feb38b763c54e5269876a150e44/dev-infra%2Frelease%2Fconfig%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fconfig%2Findex.ts?ref=e1c11a36c7687feb38b763c54e5269876a150e44",
            "patch": "@@ -0,0 +1,63 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import * as semver from 'semver';\n+\n+import {assertNoErrors, getConfig, NgDevConfig} from '../../utils/config';\n+\n+/** Interface describing a built package. */\n+export interface BuiltPackage {\n+  /** Name of the package. */\n+  name: string;\n+  /** Path to the package output directory. */\n+  outputPath: string;\n+}\n+\n+/** Configuration for staging and publishing a release. */\n+export interface ReleaseConfig {\n+  /** Registry URL used for publishing release packages. Defaults to the NPM registry. */\n+  publishRegistry?: string;\n+  /** List of NPM packages that are published as part of this project. */\n+  npmPackages: string[];\n+  /** Builds release packages and returns a list of paths pointing to the output. */\n+  buildPackages: () => Promise<BuiltPackage[]|null>;\n+  /** Generates the release notes from the most recent tag to `HEAD`. */\n+  generateReleaseNotesForHead: (outputPath: string) => Promise<void>;\n+  /**\n+   * Gets a pattern for extracting the release notes of the a given version.\n+   * @returns A pattern matching the notes for a given version (including the header).\n+   */\n+  // TODO: Remove this in favor of a canonical changelog format across the Angular organization.\n+  extractReleaseNotesPattern?: (version: semver.SemVer) => RegExp;\n+}\n+\n+/** Configuration for releases in the dev-infra configuration. */\n+export type DevInfraReleaseConfig = NgDevConfig<{release: ReleaseConfig}>;\n+\n+/** Retrieve and validate the config as `ReleaseConfig`. */\n+export function getReleaseConfig(config: Partial<DevInfraReleaseConfig> = getConfig()):\n+    ReleaseConfig {\n+  // List of errors encountered validating the config.\n+  const errors: string[] = [];\n+\n+  if (config.release === undefined) {\n+    errors.push(`No configuration defined for \"release\"`);\n+  }\n+  if (config.release?.npmPackages === undefined) {\n+    errors.push(`No \"npmPackages\" configured for releasing.`);\n+  }\n+  if (config.release?.buildPackages === undefined) {\n+    errors.push(`No \"buildPackages\" function configured for releasing.`);\n+  }\n+  if (config.release?.generateReleaseNotesForHead === undefined) {\n+    errors.push(`No \"generateReleaseNotesForHead\" function configured for releasing.`);\n+  }\n+\n+  assertNoErrors(errors);\n+  return config.release!;\n+}"
        }
    ],
    "stats": {
        "total": 112,
        "additions": 112,
        "deletions": 0
    }
}