{
    "author": "atscott",
    "message": "fix(core): consistently use namespace short name rather than URI (#44766)\n\n`Renderer2` APIs expect to be called with the namespace name rather than\nthe namespace URI. Rather than passing around the URI and having to\naccount for different calling contexts, this change consistently uses\nthe namespace short names.\n\nImportantly, the URI was only used in `component_ref.ts` `create`\n(because `getNamespace returned the URIs`) and `createElementNode` in\n`node_manipulation.ts` (because `getNamespaceUri` also used the URIs).\nIn contrast, attributes would use the _short names instead of URIs_\n(see `setUpAttributes` in `attrs_utils.ts`). These names are pulled\ndirectly from the attribute, i.e. `xhtml:href` and not converted to URI.\nThis dichotomy is confusing and unnecessary. The change here aligns the two\napproaches in order to provide consistently throughout the system.\n\nThis relates to #44766 because the `createElementNode` was calling the\n`AnimationRenderer.createElement` which delegates to the\n`ServerRenderer`, which in turn was only set up to expect short names.\nAs a result, the `NAMESPACE_URIS` lookup failed and `Domino` created\nthe `svg` as a regular `Element` which does not have a `styles`\nproperty.\n\nresolves #44766\n\nPR Close #44766",
    "sha": "fb9163ae501e7b53f00201b366be6a07bce764e8",
    "files": [
        {
            "sha": "b1e9744aa19af2ba03a1d849f8503ff6b4820b2c",
            "filename": "packages/core/src/render3/namespaces.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fcore%2Fsrc%2Frender3%2Fnamespaces.ts",
            "raw_url": "https://github.com/angular/angular/raw/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fcore%2Fsrc%2Frender3%2Fnamespaces.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fnamespaces.ts?ref=fb9163ae501e7b53f00201b366be6a07bce764e8",
            "patch": "@@ -6,5 +6,13 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-export const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n-export const MATH_ML_NAMESPACE = 'http://www.w3.org/1998/MathML/';\n+export const SVG_NAMESPACE = 'svg';\n+export const SVG_NAMESPACE_URI = 'http://www.w3.org/2000/svg';\n+export const MATH_ML_NAMESPACE = 'math';\n+export const MATH_ML_NAMESPACE_URI = 'http://www.w3.org/1998/MathML/';\n+\n+export function getNamespaceUri(namespace: string): string|null {\n+  const name = namespace.toLowerCase();\n+  return name === SVG_NAMESPACE ? SVG_NAMESPACE_URI :\n+                                  (name === MATH_ML_NAMESPACE ? MATH_ML_NAMESPACE_URI : null);\n+}"
        },
        {
            "sha": "0085877c95874f9f9a34e83f65d41a403c54599d",
            "filename": "packages/core/src/render3/node_manipulation.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fcore%2Fsrc%2Frender3%2Fnode_manipulation.ts",
            "raw_url": "https://github.com/angular/angular/raw/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fcore%2Fsrc%2Frender3%2Fnode_manipulation.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fnode_manipulation.ts?ref=fb9163ae501e7b53f00201b366be6a07bce764e8",
            "patch": "@@ -25,6 +25,7 @@ import {isProceduralRenderer, ProceduralRenderer3, Renderer3, unusedValueExportT\n import {RComment, RElement, RNode, RText} from './interfaces/renderer_dom';\n import {isLContainer, isLView} from './interfaces/type_checks';\n import {CHILD_HEAD, CLEANUP, DECLARATION_COMPONENT_VIEW, DECLARATION_LCONTAINER, DestroyHookData, FLAGS, HookData, HookFn, HOST, LView, LViewFlags, NEXT, PARENT, QUERIES, RENDERER, T_HOST, TVIEW, TView, TViewType, unusedValueExportToPlacateAjd as unused5} from './interfaces/view';\n+import {getNamespaceUri} from './namespaces';\n import {assertTNodeType} from './node_assert';\n import {profiler, ProfilerEvent} from './profiler';\n import {getLViewParent} from './util/view_traversal_utils';\n@@ -132,8 +133,9 @@ export function createElementNode(\n   if (isProceduralRenderer(renderer)) {\n     return renderer.createElement(name, namespace);\n   } else {\n-    return namespace === null ? renderer.createElement(name) :\n-                                renderer.createElementNS(namespace, name);\n+    const namespaceUri = namespace !== null ? getNamespaceUri(namespace) : null;\n+    return namespaceUri === null ? renderer.createElement(name) :\n+                                   renderer.createElementNS(namespaceUri, name);\n   }\n }\n "
        },
        {
            "sha": "28e14a18663aac3d24e038d61295a07d616818d7",
            "filename": "packages/core/test/acceptance/i18n_spec.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fcore%2Ftest%2Facceptance%2Fi18n_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fcore%2Ftest%2Facceptance%2Fi18n_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fi18n_spec.ts?ref=fb9163ae501e7b53f00201b366be6a07bce764e8",
            "patch": "@@ -542,10 +542,6 @@ describe('runtime i18n', () => {\n       TestBed.configureTestingModule({\n         providers: [\n           {provide: DOCUMENT, useFactory: _document, deps: []},\n-          // TODO(FW-811): switch back to default server renderer (i.e. remove the line\n-          // below) once it starts to support Ivy namespace format (URIs) correctly. For\n-          // now, use `DomRenderer` that supports Ivy namespace format.\n-          {provide: RendererFactory2, useClass: DomRendererFactory2}\n         ],\n       });\n     });"
        },
        {
            "sha": "9318233d408c8ce7db29d1e07ebef1a04f3300c1",
            "filename": "packages/core/test/acceptance/view_container_ref_spec.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fcore%2Ftest%2Facceptance%2Fview_container_ref_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fcore%2Ftest%2Facceptance%2Fview_container_ref_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fview_container_ref_spec.ts?ref=fb9163ae501e7b53f00201b366be6a07bce764e8",
            "patch": "@@ -197,10 +197,6 @@ describe('ViewContainerRef', () => {\n             declarations: [TestComp, SvgComp, MathMLComp],\n             providers: [\n               {provide: DOCUMENT, useFactory: _document, deps: []},\n-              // TODO(FW-811): switch back to default server renderer (i.e. remove the line below)\n-              // once it starts to support Ivy namespace format (URIs) correctly. For now, use\n-              // `DomRenderer` that supports Ivy namespace format.\n-              {provide: RendererFactory2, useClass: DomRendererFactory2}\n             ],\n           });\n           const fixture = TestBed.createComponent(TestComp);"
        },
        {
            "sha": "9e42d52af890b158b8f2046bcd0b13e1b3dcf863",
            "filename": "packages/platform-browser/src/dom/dom_renderer.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 10,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fplatform-browser%2Fsrc%2Fdom%2Fdom_renderer.ts",
            "raw_url": "https://github.com/angular/angular/raw/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fplatform-browser%2Fsrc%2Fdom%2Fdom_renderer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Fsrc%2Fdom%2Fdom_renderer.ts?ref=fb9163ae501e7b53f00201b366be6a07bce764e8",
            "patch": "@@ -17,6 +17,7 @@ export const NAMESPACE_URIS: {[ns: string]: string} = {\n   'xlink': 'http://www.w3.org/1999/xlink',\n   'xml': 'http://www.w3.org/XML/1998/namespace',\n   'xmlns': 'http://www.w3.org/2000/xmlns/',\n+  'math': 'http://www.w3.org/1998/MathML/',\n };\n \n const COMPONENT_REGEX = /%COMP%/g;\n@@ -144,9 +145,7 @@ class DefaultDomRenderer2 implements Renderer2 {\n \n   createElement(name: string, namespace?: string): any {\n     if (namespace) {\n-      // In cases where Ivy (not ViewEngine) is giving us the actual namespace, the look up by key\n-      // will result in undefined, so we just return the namespace here.\n-      return document.createElementNS(NAMESPACE_URIS[namespace] || namespace, name);\n+      return document.createElementNS(NAMESPACE_URIS[namespace], name);\n     }\n \n     return document.createElement(name);\n@@ -199,8 +198,6 @@ class DefaultDomRenderer2 implements Renderer2 {\n   setAttribute(el: any, name: string, value: string, namespace?: string): void {\n     if (namespace) {\n       name = namespace + ':' + name;\n-      // TODO(FW-811): Ivy may cause issues here because it's passing around\n-      // full URIs for namespaces, therefore this lookup will fail.\n       const namespaceUri = NAMESPACE_URIS[namespace];\n       if (namespaceUri) {\n         el.setAttributeNS(namespaceUri, name, value);\n@@ -214,15 +211,10 @@ class DefaultDomRenderer2 implements Renderer2 {\n \n   removeAttribute(el: any, name: string, namespace?: string): void {\n     if (namespace) {\n-      // TODO(FW-811): Ivy may cause issues here because it's passing around\n-      // full URIs for namespaces, therefore this lookup will fail.\n       const namespaceUri = NAMESPACE_URIS[namespace];\n       if (namespaceUri) {\n         el.removeAttributeNS(namespaceUri, name);\n       } else {\n-        // TODO(FW-811): Since ivy is passing around full URIs for namespaces\n-        // this could result in properties like `http://www.w3.org/2000/svg:cx=\"123\"`,\n-        // which is wrong.\n         el.removeAttribute(`${namespace}:${name}`);\n       }\n     } else {"
        },
        {
            "sha": "75b68f91b62d02c02e9dfa010808fae8eadc8544",
            "filename": "packages/platform-server/src/server_renderer.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fplatform-server%2Fsrc%2Fserver_renderer.ts",
            "raw_url": "https://github.com/angular/angular/raw/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fplatform-server%2Fsrc%2Fserver_renderer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Fsrc%2Fserver_renderer.ts?ref=fb9163ae501e7b53f00201b366be6a07bce764e8",
            "patch": "@@ -72,8 +72,6 @@ class DefaultServerRenderer2 implements Renderer2 {\n   createElement(name: string, namespace?: string, debugInfo?: any): any {\n     if (namespace) {\n       const doc = this.document || getDOM().getDefaultDocument();\n-      // TODO(FW-811): Ivy may cause issues here because it's passing around\n-      // full URIs for namespaces, therefore this lookup will fail.\n       return doc.createElementNS(NAMESPACE_URIS[namespace], name);\n     }\n \n@@ -131,8 +129,6 @@ class DefaultServerRenderer2 implements Renderer2 {\n \n   setAttribute(el: any, name: string, value: string, namespace?: string): void {\n     if (namespace) {\n-      // TODO(FW-811): Ivy may cause issues here because it's passing around\n-      // full URIs for namespaces, therefore this lookup will fail.\n       el.setAttributeNS(NAMESPACE_URIS[namespace], namespace + ':' + name, value);\n     } else {\n       el.setAttribute(name, value);\n@@ -141,8 +137,6 @@ class DefaultServerRenderer2 implements Renderer2 {\n \n   removeAttribute(el: any, name: string, namespace?: string): void {\n     if (namespace) {\n-      // TODO(FW-811): Ivy may cause issues here because it's passing around\n-      // full URIs for namespaces, therefore this lookup will fail.\n       el.removeAttributeNS(NAMESPACE_URIS[namespace], name);\n     } else {\n       el.removeAttribute(name);"
        },
        {
            "sha": "bc12d5d938f019158ce52dcc8aadd4160c510f1d",
            "filename": "packages/platform-server/test/integration_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fplatform-server%2Ftest%2Fintegration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fb9163ae501e7b53f00201b366be6a07bce764e8/packages%2Fplatform-server%2Ftest%2Fintegration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-server%2Ftest%2Fintegration_spec.ts?ref=fb9163ae501e7b53f00201b366be6a07bce764e8",
            "patch": "@@ -193,7 +193,11 @@ class SVGServerModule {\n \n @Component({\n   selector: 'app',\n-  template: `<div [@myAnimation]=\"state\">{{text}}</div>`,\n+  template: `\n+  <div [@myAnimation]=\"state\">\n+    <svg *ngIf=\"true\"></svg>\n+    {{text}}\n+  </div>`,\n   animations: [trigger(\n       'myAnimation',\n       ["
        }
    ],
    "stats": {
        "total": 50,
        "additions": 21,
        "deletions": 29
    }
}