{
    "author": "gkalpak",
    "message": "build(docs-infra): switch the `generate-stackblitz/zips` scripts to ESM (#42921)\n\nSwitch the JS scripts used for generating StackBlitz projects and zips\nfrom CommonJS to ESM format. This is necessary for upgrading the\n`globby` dependency to [version 12.0.0][1] in a subsequent commit.\n\n[1]: https://github.com/sindresorhus/globby/releases/v12.0.0\n\nPR Close #42921",
    "sha": "662addb3554fdc6db201a352d68055d034f1b65b",
    "files": [
        {
            "sha": "5d8c4db67206055450780f99431a61004c6020db",
            "filename": "aio/package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fpackage.json?ref=662addb3554fdc6db201a352d68055d034f1b65b",
            "patch": "@@ -63,8 +63,8 @@\n     \"boilerplate:add\": \"node ./tools/examples/example-boilerplate add\",\n     \"boilerplate:remove\": \"node ./tools/examples/example-boilerplate remove\",\n     \"boilerplate:test\": \"node tools/examples/test.js\",\n-    \"generate-stackblitz\": \"node ./tools/stackblitz-builder/generateStackblitz\",\n-    \"generate-zips\": \"node ./tools/example-zipper/generateZips\",\n+    \"generate-stackblitz\": \"node ./tools/stackblitz-builder/generateStackblitz.mjs\",\n+    \"generate-zips\": \"node ./tools/example-zipper/generateZips.mjs\",\n     \"create-example\": \"node ./tools/examples/create-example.js\",\n     \"build-404-page\": \"node scripts/build-404-page\",\n     \"update-webdriver\": \"node ../scripts/webdriver-manager-update.js\","
        },
        {
            "sha": "4aedac701eabc818a530648ff79cbf42268f6342",
            "filename": "aio/tools/example-zipper/README.md",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Ftools%2Fexample-zipper%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Ftools%2Fexample-zipper%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexample-zipper%2FREADME.md?ref=662addb3554fdc6db201a352d68055d034f1b65b",
            "patch": "@@ -5,7 +5,7 @@ These zip files are generated by the utility in this folder.\n \n ## Example zipper\n \n-The `exampleZipper.js` tool is very similar to the Stackblitz's `builder.js`.\n+The `exampleZipper.mjs` tool is very similar to the Stackblitz's `builder.mjs`.\n The latter creates an HTML file with all the examples' files and the former creates a zip file instead.\n They both use the `stackblitz.json` file to flag an example as something to stackblitz or zip.\n For example:\n@@ -35,7 +35,7 @@ These example types have separate boilerplate directories with the files that ar\n There are appropriate `package.json` files for each type of example in the boilerplate directories.\n If there is no special `package.json` file for an example type, the one from the `cli` boilerplate directory will be used instead.\n \n-The `exampleZipper.js` won't include any `System.js` related files for CLI-based projects.\n+The `exampleZipper.mjs` won't include any `System.js` related files for CLI-based projects.\n \n ## The zipper.json\n \n@@ -46,7 +46,7 @@ In those cases, you can create a `zipper.json` file with the same syntax. It wil\n \n ## Executing the zip generation\n \n-`generateZips.js` will create a zip for each `stackblitz.json`  or `zipper.json` it finds.\n+`generateZips.mjs` will create a zip for each `stackblitz.json`  or `zipper.json` it finds.\n \n Where? At `src/generated/zips/`.\n "
        },
        {
            "sha": "4cfae83512aa2a8cc77e3ecf8ae00f1e043e6248",
            "filename": "aio/tools/example-zipper/exampleZipper.mjs",
            "status": "renamed",
            "additions": 14,
            "deletions": 12,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Ftools%2Fexample-zipper%2FexampleZipper.mjs",
            "raw_url": "https://github.com/angular/angular/raw/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Ftools%2Fexample-zipper%2FexampleZipper.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexample-zipper%2FexampleZipper.mjs?ref=662addb3554fdc6db201a352d68055d034f1b65b",
            "patch": "@@ -1,16 +1,16 @@\n-'use strict';\n-\n // Canonical path provides a consistent path (i.e. always forward slashes) across different OSes\n-const path = require('canonical-path');\n-const archiver = require('archiver');\n-const fs = require('fs-extra');\n-const globby = require('globby');\n+import archiver from 'archiver';\n+import path from 'canonical-path';\n+import fs from 'fs-extra';\n+import globby from 'globby';\n+import {fileURLToPath} from 'url';\n \n-const regionExtractor = require('../transforms/examples-package/services/region-parser');\n+import regionExtractor from '../transforms/examples-package/services/region-parser.js';\n \n+const __dirname = path.dirname(fileURLToPath(import.meta.url));\n const EXAMPLE_CONFIG_NAME = 'example-config.json';\n \n-class ExampleZipper {\n+export class ExampleZipper {\n   constructor(sourceDirName, outputDirName) {\n     this.examplesPackageJson = path.join(__dirname, '../examples/shared/package.json');\n     this.examplesSystemjsConfig = path.join(__dirname, '../examples/shared/boilerplate/systemjs/src/systemjs.config.js');\n@@ -46,12 +46,16 @@ class ExampleZipper {\n   _getExampleType(sourceFolder) {\n     const filePath = path.join(sourceFolder, EXAMPLE_CONFIG_NAME);\n     try {\n-      return require(filePath, 'utf-8').projectType || 'cli';\n+      return this._loadJson(filePath).projectType || 'cli';\n     } catch (err) { // empty file, so it is cli\n       return 'cli';\n     }\n   }\n \n+  _loadJson(filePath) {\n+    return JSON.parse(fs.readFileSync(filePath, 'utf8'));\n+  }\n+\n   // rename a custom main.ts or index.html file\n   _renameFile(file, exampleType) {\n     if (/src\\/main[-.]\\w+\\.ts$/.test(file) && exampleType !== 'universal') {\n@@ -66,7 +70,7 @@ class ExampleZipper {\n   }\n \n   _zipExample(configFileName, sourceDirName, outputDirName) {\n-    let json = require(configFileName, 'utf-8');\n+    let json = this._loadJson(configFileName);\n     const basePath = json.basePath || '';\n     const jsonFileName = configFileName.replace(/^.*[\\\\\\/]/, '');\n     let relativeDirName = path.dirname(path.relative(sourceDirName, configFileName));\n@@ -176,5 +180,3 @@ class ExampleZipper {\n     zip.finalize();\n   }\n }\n-\n-module.exports = ExampleZipper;",
            "previous_filename": "aio/tools/example-zipper/exampleZipper.js"
        },
        {
            "sha": "3ae43b83cf92da8a75cf69020f377bd3675acbcf",
            "filename": "aio/tools/example-zipper/generateZips.mjs",
            "status": "renamed",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Ftools%2Fexample-zipper%2FgenerateZips.mjs",
            "raw_url": "https://github.com/angular/angular/raw/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Ftools%2Fexample-zipper%2FgenerateZips.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexample-zipper%2FgenerateZips.mjs?ref=662addb3554fdc6db201a352d68055d034f1b65b",
            "patch": "@@ -1,6 +1,8 @@\n-const ExampleZipper = require('./exampleZipper');\n-const path = require('canonical-path');\n+import path from 'canonical-path';\n+import {fileURLToPath} from 'url';\n+import {ExampleZipper} from './exampleZipper.mjs';\n \n+const __dirname = path.dirname(fileURLToPath(import.meta.url));\n const EXAMPLES_PATH = path.join(__dirname, '../../content/examples');\n const ZIPS_PATH = path.join(__dirname, '../../src/generated/zips');\n ",
            "previous_filename": "aio/tools/example-zipper/generateZips.js"
        },
        {
            "sha": "ca841408182d05a65e69470af7d1f5f01822f209",
            "filename": "aio/tools/stackblitz-builder/README.md",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Ftools%2Fstackblitz-builder%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Ftools%2Fstackblitz-builder%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fstackblitz-builder%2FREADME.md?ref=662addb3554fdc6db201a352d68055d034f1b65b",
            "patch": "@@ -4,11 +4,11 @@\n In AIO we use it to share one or more runnable versions of our examples.\n \n Stackblitz can be used both on a separate page and in an embedded form.\n-* `generateStackblitz.js` - executes each of the StackblitzBuilder to generate a stackblitz file for each example.\n+* `generateStackblitz.mjs` - executes each of the StackblitzBuilder to generate a stackblitz file for each example.\n \n ## Stackblitz generation\n \n-Both forms are created within `builder.js`.\n+Both forms are created within `builder.mjs`.\n How is a stackblitz created?\n What is the process from a directory with files to a link with a stackblitz.\n \n@@ -17,13 +17,13 @@ It contains an `<input>` element for each file we need in the stackblitz.\n \n The form will be submitted on load, so you can either double click the HTML file or open it with an anchor tag to open the stackblitz.\n \n-So the `builder.js` job is to get all the needed files from an example and build this HTML file for you.\n+So the `builder.mjs` job is to get all the needed files from an example and build this HTML file for you.\n \n ## Customizing the generation per example basis\n \n How does this tool know what is an example and what is not?\n It will look for all folders containing a `stackblitz.json` file.\n-If found, all files within the folder and subfolders will be used in the stackblitz, with a few generic exceptions that you can find at `builder.js`.\n+If found, all files within the folder and subfolders will be used in the stackblitz, with a few generic exceptions that you can find at `builder.mjs`.\n \n You can use the `stackblitz.json` to customize the stackblitz generation.\n For example:\n@@ -44,7 +44,7 @@ Here you can specify a description for the stackblitz, some tags and also a file\n \n ## Executing the stackblitz generation\n \n-`generateStackblitz.js` will create a stackblitz for each `stackblitz.json` it finds.\n+`generateStackblitz.mjs` will create a stackblitz for each `stackblitz.json` it finds.\n \n Where?\n At `src/generated/live-examples/`."
        },
        {
            "sha": "71e299798fe634259c5fa7d4974b12a3fdb8dcd9",
            "filename": "aio/tools/stackblitz-builder/builder.mjs",
            "status": "renamed",
            "additions": 13,
            "deletions": 12,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Ftools%2Fstackblitz-builder%2Fbuilder.mjs",
            "raw_url": "https://github.com/angular/angular/raw/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Ftools%2Fstackblitz-builder%2Fbuilder.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fstackblitz-builder%2Fbuilder.mjs?ref=662addb3554fdc6db201a352d68055d034f1b65b",
            "patch": "@@ -1,15 +1,16 @@\n-'use strict';\n-\n // Canonical path provides a consistent path (i.e. always forward slashes) across different OSes\n-const path = require('canonical-path');\n-const fs = require('fs-extra');\n-const globby = require('globby');\n-const jsdom = require('jsdom');\n-const json5 = require('json5');\n+import path from 'canonical-path';\n+import fs from 'fs-extra';\n+import globby from 'globby';\n+import jsdom from 'jsdom';\n+import json5 from 'json5';\n+import {fileURLToPath} from 'url';\n+\n+import regionExtractor from '../transforms/examples-package/services/region-parser.js';\n \n-const regionExtractor = require('../transforms/examples-package/services/region-parser');\n+const __dirname = path.dirname(fileURLToPath(import.meta.url));\n \n-class StackblitzBuilder {\n+export class StackblitzBuilder {\n   constructor(basePath, destPath) {\n     this.basePath = basePath;\n     this.destPath = destPath;\n@@ -64,7 +65,9 @@ class StackblitzBuilder {\n   _getBoilerplatePackageJson(exampleType) {\n     if (!this._boilerplatePackageJsons.hasOwnProperty(exampleType)) {\n       const pkgJsonPath = `${__dirname}/../examples/shared/boilerplate/${exampleType}/package.json`;\n-      this._boilerplatePackageJsons[exampleType] = fs.existsSync(pkgJsonPath) ? require(pkgJsonPath) : null;\n+      this._boilerplatePackageJsons[exampleType] = fs.existsSync(pkgJsonPath)\n+          ? JSON.parse(fs.readFileSync(pkgJsonPath, 'utf8'))\n+          : null;\n     }\n \n     return this._boilerplatePackageJsons[exampleType];\n@@ -341,5 +344,3 @@ class StackblitzBuilder {\n     }\n   }\n }\n-\n-module.exports = StackblitzBuilder;",
            "previous_filename": "aio/tools/stackblitz-builder/builder.js"
        },
        {
            "sha": "0b80089ce0266e9e3c4ca72a9dc4cd56cba4387d",
            "filename": "aio/tools/stackblitz-builder/generateStackblitz.js",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/99f833869dbf2663d49bd28e1e825a81a5928dc5/aio%2Ftools%2Fstackblitz-builder%2FgenerateStackblitz.js",
            "raw_url": "https://github.com/angular/angular/raw/99f833869dbf2663d49bd28e1e825a81a5928dc5/aio%2Ftools%2Fstackblitz-builder%2FgenerateStackblitz.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fstackblitz-builder%2FgenerateStackblitz.js?ref=99f833869dbf2663d49bd28e1e825a81a5928dc5",
            "patch": "@@ -1,8 +0,0 @@\n-const path = require('path');\n-const StackblitzBuilder = require('./builder');\n-\n-const EXAMPLES_PATH = path.join(__dirname, '../../content/examples');\n-const LIVE_EXAMPLES_PATH = path.join(__dirname, '../../src/generated/live-examples');\n-\n-new StackblitzBuilder(EXAMPLES_PATH, LIVE_EXAMPLES_PATH).build();\n-"
        },
        {
            "sha": "8a8e91b0de52170ddb37329a37b2c7fe4b887716",
            "filename": "aio/tools/stackblitz-builder/generateStackblitz.mjs",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Ftools%2Fstackblitz-builder%2FgenerateStackblitz.mjs",
            "raw_url": "https://github.com/angular/angular/raw/662addb3554fdc6db201a352d68055d034f1b65b/aio%2Ftools%2Fstackblitz-builder%2FgenerateStackblitz.mjs",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fstackblitz-builder%2FgenerateStackblitz.mjs?ref=662addb3554fdc6db201a352d68055d034f1b65b",
            "patch": "@@ -0,0 +1,9 @@\n+import {dirname, join} from 'path';\n+import {fileURLToPath} from 'url';\n+import {StackblitzBuilder} from './builder.mjs';\n+\n+const __dirname = dirname(fileURLToPath(import.meta.url));\n+const EXAMPLES_PATH = join(__dirname, '../../content/examples');\n+const LIVE_EXAMPLES_PATH = join(__dirname, '../../src/generated/live-examples');\n+\n+new StackblitzBuilder(EXAMPLES_PATH, LIVE_EXAMPLES_PATH).build();"
        }
    ],
    "stats": {
        "total": 94,
        "additions": 50,
        "deletions": 44
    }
}