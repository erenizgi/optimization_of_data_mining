{
    "author": "alxhub",
    "message": "test(compiler-cli): validate broken external template incrementality (#39923)\n\nPreviously, if a component had an external template with a hard error, the\ncompiler would \"forget\" the link between that component and its NgModule.\nAdditionally, the NgModule would be marked as being in error, because the\ntemplate issue would prevent the compiler from registering the component\nclass as a component, so from the NgModule it would look like a declaration\nof a non-directive/pipe class. As a combined result, the next incremental\nstep could fix the template error, but would not refresh diagnostics for the\nNgModule, leading to an incrementality issue.\n\nThe various facets of this problem were fixed in prior commits. This commit\nadds a test verifying the above case works now as expected.\n\nPR Close #39923",
    "sha": "a6c8cc3215b28987aeb10243ffef67d0f5f5acf2",
    "files": [
        {
            "sha": "8e99294340c9744d6ef899c7ae3fd1d0ae949eac",
            "filename": "packages/compiler-cli/test/ngtsc/incremental_error_spec.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/a6c8cc3215b28987aeb10243ffef67d0f5f5acf2/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fincremental_error_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/a6c8cc3215b28987aeb10243ffef67d0f5f5acf2/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fincremental_error_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fincremental_error_spec.ts?ref=a6c8cc3215b28987aeb10243ffef67d0f5f5acf2",
            "patch": "@@ -288,6 +288,38 @@ runInEachFileSystem(() => {\n       ]);\n     });\n \n+    it('should recover from an error in an external template', () => {\n+      env.write('mod.ts', `\n+        import {NgModule} from '@angular/core';\n+        import {Cmp} from './cmp';\n+\n+        @NgModule({\n+          declarations: [Cmp],\n+        })\n+        export class Mod {}\n+      `);\n+      env.write('cmp.html', '{{ error = \"true\" }} ');\n+      env.write('cmp.ts', `\n+        import {Component} from '@angular/core';\n+\n+        @Component({\n+          templateUrl: './cmp.html',\n+          selector: 'some-cmp',\n+        })\n+        export class Cmp {\n+          error = 'false';\n+        }\n+      `);\n+\n+      // Diagnostics should show for the broken component template.\n+      expect(env.driveDiagnostics().length).toBeGreaterThan(0);\n+\n+      env.write('cmp.html', '{{ error }} ');\n+\n+      // There should be no diagnostics.\n+      env.driveMain();\n+    });\n+\n     it('should recover from an error even across multiple NgModules', () => {\n       // This test is a variation on the above. Two components (CmpA and CmpB) exist in an NgModule,\n       // which indirectly imports a LibModule (via another NgModule in the middle). The test is"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 32,
        "deletions": 0
    }
}