{
    "author": "josephperrott",
    "message": "refactor(dev-infra): use common git client for git environment reset (#39051)\n\nFor rebase tooling, use the `GitClient`'s `checkout` method rather than a custom\nfunction doing the same task.\n\nPR Close #39051",
    "sha": "c8d757624bb5066e264c4b31f7b9559fde474ffb",
    "files": [
        {
            "sha": "7aa63e6290c5d5be5c4cc14a9c5110ccc1ab3ea4",
            "filename": "dev-infra/pr/rebase/index.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 14,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/c8d757624bb5066e264c4b31f7b9559fde474ffb/dev-infra%2Fpr%2Frebase%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/c8d757624bb5066e264c4b31f7b9559fde474ffb/dev-infra%2Fpr%2Frebase%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Frebase%2Findex.ts?ref=c8d757624bb5066e264c4b31f7b9559fde474ffb",
            "patch": "@@ -7,7 +7,6 @@\n  */\n \n import {types as graphQLTypes} from 'typed-graphqlify';\n-import {URL} from 'url';\n \n import {getConfig, NgDevConfig} from '../../utils/config';\n import {error, info, promptConfirm} from '../../utils/console';\n@@ -100,12 +99,12 @@ export async function rebasePr(\n       info(`Pushing rebased PR #${prNumber} to ${fullHeadRef}`);\n       git.run(['push', headRefUrl, `HEAD:${headRefName}`, forceWithLeaseFlag]);\n       info(`Rebased and updated PR #${prNumber}`);\n-      cleanUpGitState();\n+      git.checkout(previousBranchOrRevision, true);\n       process.exit(0);\n     }\n   } catch (err) {\n     error(err.message);\n-    cleanUpGitState();\n+    git.checkout(previousBranchOrRevision, true);\n     process.exit(1);\n   }\n \n@@ -128,16 +127,6 @@ export async function rebasePr(\n     info(`Cleaning up git state, and restoring previous state.`);\n   }\n \n-  cleanUpGitState();\n+  git.checkout(previousBranchOrRevision, true);\n   process.exit(1);\n-\n-  /** Reset git back to the original branch. */\n-  function cleanUpGitState() {\n-    // Ensure that any outstanding rebases are aborted.\n-    git.runGraceful(['rebase', '--abort'], {stdio: 'ignore'});\n-    // Ensure that any changes in the current repo state are cleared.\n-    git.runGraceful(['reset', '--hard'], {stdio: 'ignore'});\n-    // Checkout the original branch from before the run began.\n-    git.runGraceful(['checkout', previousBranchOrRevision], {stdio: 'ignore'});\n-  }\n }"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 3,
        "deletions": 14
    }
}