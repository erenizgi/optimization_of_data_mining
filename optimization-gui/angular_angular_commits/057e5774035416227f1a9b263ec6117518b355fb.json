{
    "author": "danieltre23",
    "message": "refactor(compiler-cli): add makeTemplateDiagnostic wrapper (#42937)\n\nAdd a `makeTemplateDiagnostic` wrapper in the `TemplateTypeChecker`. This requiers less parameters to create template diagnostics, since the `TemplateTypeChecker` can get the templateId and mapping from it's scope with the `ts.ClassDeclartion`. The `TemplateTypeChecker` is often used to determine if a diagnostic should be produced, so it makes sense to have a function in it that helps create them.\n\nRefs #42966\n\nPR Close #42937",
    "sha": "057e5774035416227f1a9b263ec6117518b355fb",
    "files": [
        {
            "sha": "ef61fe05f119675ef4267c4e37f33d313177367c",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/api/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/057e5774035416227f1a9b263ec6117518b355fb/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/057e5774035416227f1a9b263ec6117518b355fb/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2FBUILD.bazel?ref=057e5774035416227f1a9b263ec6117518b355fb",
            "patch": "@@ -9,6 +9,7 @@ ts_library(\n     deps = [\n         \"//packages:types\",\n         \"//packages/compiler\",\n+        \"//packages/compiler-cli/src/ngtsc/diagnostics\",\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/imports\",\n         \"//packages/compiler-cli/src/ngtsc/metadata\","
        },
        {
            "sha": "84635508b85952ca6bfac53640db684af46d1555",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/api/checker.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/057e5774035416227f1a9b263ec6117518b355fb/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fchecker.ts",
            "raw_url": "https://github.com/angular/angular/raw/057e5774035416227f1a9b263ec6117518b355fb/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fchecker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fchecker.ts?ref=057e5774035416227f1a9b263ec6117518b355fb",
            "patch": "@@ -6,9 +6,10 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AST, MethodCall, ParseError, PropertyRead, SafeMethodCall, SafePropertyRead, TmplAstElement, TmplAstNode, TmplAstTemplate} from '@angular/compiler';\n+import {AST, MethodCall, ParseError, ParseSourceSpan, PropertyRead, SafeMethodCall, SafePropertyRead, TmplAstElement, TmplAstNode, TmplAstTemplate} from '@angular/compiler';\n import {AbsoluteFsPath} from '@angular/compiler-cli/src/ngtsc/file_system';\n import * as ts from 'typescript';\n+import {ErrorCode} from '../../diagnostics';\n \n import {FullTemplateMapping, TypeCheckableDirectiveMeta} from './api';\n import {GlobalCompletion} from './completion';\n@@ -154,6 +155,18 @@ export interface TemplateTypeChecker {\n    * the next request.\n    */\n   invalidateClass(clazz: ts.ClassDeclaration): void;\n+\n+  /**\n+   * Constructs a `ts.Diagnostic` for a given `ParseSourceSpan` within a template.\n+   */\n+  makeTemplateDiagnostic(\n+      clazz: ts.ClassDeclaration, sourceSpan: ParseSourceSpan, category: ts.DiagnosticCategory,\n+      errorCode: ErrorCode, message: string, relatedInformation?: {\n+        text: string,\n+        start: number,\n+        end: number,\n+        sourceFile: ts.SourceFile,\n+      }[]): ts.Diagnostic;\n }\n \n /**"
        },
        {
            "sha": "a3bd6f5394259fd08ad8030fb6e00a6ca1d986c4",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/checker.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 2,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/057e5774035416227f1a9b263ec6117518b355fb/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fchecker.ts",
            "raw_url": "https://github.com/angular/angular/raw/057e5774035416227f1a9b263ec6117518b355fb/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fchecker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fchecker.ts?ref=057e5774035416227f1a9b263ec6117518b355fb",
            "patch": "@@ -6,8 +6,9 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AST, CssSelector, DomElementSchemaRegistry, MethodCall, ParseError, parseTemplate, PropertyRead, SafeMethodCall, SafePropertyRead, TmplAstElement, TmplAstNode, TmplAstReference, TmplAstTemplate, TmplAstVariable} from '@angular/compiler';\n+import {AST, CssSelector, DomElementSchemaRegistry, MethodCall, ParseError, ParseSourceSpan, parseTemplate, PropertyRead, SafeMethodCall, SafePropertyRead, TmplAstElement, TmplAstNode, TmplAstReference, TmplAstTemplate, TmplAstVariable} from '@angular/compiler';\n import * as ts from 'typescript';\n+import {ErrorCode} from '../../diagnostics';\n \n import {absoluteFrom, absoluteFromSourceFile, AbsoluteFsPath, getSourceFileOrError} from '../../file_system';\n import {Reference, ReferenceEmitter} from '../../imports';\n@@ -19,7 +20,7 @@ import {ComponentScopeReader, TypeCheckScopeRegistry} from '../../scope';\n import {isShim} from '../../shims';\n import {getSourceFileOrNull, isSymbolWithValueDeclaration} from '../../util/src/typescript';\n import {DirectiveInScope, ElementSymbol, FullTemplateMapping, GlobalCompletion, OptimizeFor, PipeInScope, ProgramTypeCheckAdapter, ShimLocation, Symbol, TemplateId, TemplateSymbol, TemplateTypeChecker, TypeCheckableDirectiveMeta, TypeCheckingConfig} from '../api';\n-import {TemplateDiagnostic} from '../diagnostics';\n+import {makeTemplateDiagnostic, TemplateDiagnostic} from '../diagnostics';\n \n import {CompletionEngine} from './completion';\n import {InliningMode, ShimTypeCheckingData, TemplateData, TypeCheckContextImpl, TypeCheckingHost} from './context';\n@@ -297,6 +298,23 @@ export class TemplateTypeCheckerImpl implements TemplateTypeChecker {\n     this.isComplete = false;\n   }\n \n+  makeTemplateDiagnostic(\n+      clazz: ts.ClassDeclaration, sourceSpan: ParseSourceSpan, category: ts.DiagnosticCategory,\n+      errorCode: ErrorCode, message: string, relatedInformation?: {\n+        text: string,\n+        start: number,\n+        end: number,\n+        sourceFile: ts.SourceFile,\n+      }[]): TemplateDiagnostic {\n+    const sfPath = absoluteFromSourceFile(clazz.getSourceFile());\n+    const fileRecord = this.state.get(sfPath)!;\n+    const templateId = fileRecord.sourceManager.getTemplateId(clazz);\n+    const mapping = fileRecord.sourceManager.getSourceMapping(templateId);\n+\n+    return makeTemplateDiagnostic(\n+        templateId, mapping, sourceSpan, category, errorCode, message, relatedInformation);\n+  }\n+\n   private getOrCreateCompletionEngine(component: ts.ClassDeclaration): CompletionEngine|null {\n     if (this.completionCache.has(component)) {\n       return this.completionCache.get(component)!;"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 35,
        "deletions": 3
    }
}