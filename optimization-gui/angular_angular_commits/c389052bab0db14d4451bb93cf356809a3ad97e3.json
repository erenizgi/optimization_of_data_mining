{
    "author": "danieltre23",
    "message": "test(language-service): add extended diagnostics test (#43107)\n\nAdd a test in the langauge-service to make sure the extended template\ndiagnostics are being correctly generated.\n\nRefs #42966\n\nPR Close #43107",
    "sha": "c389052bab0db14d4451bb93cf356809a3ad97e3",
    "files": [
        {
            "sha": "62f49823cccc538b89ec6b58bd7a869b4547185e",
            "filename": "packages/language-service/ivy/test/diagnostic_spec.ts",
            "status": "modified",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/angular/angular/blob/c389052bab0db14d4451bb93cf356809a3ad97e3/packages%2Flanguage-service%2Fivy%2Ftest%2Fdiagnostic_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/c389052bab0db14d4451bb93cf356809a3ad97e3/packages%2Flanguage-service%2Fivy%2Ftest%2Fdiagnostic_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fdiagnostic_spec.ts?ref=c389052bab0db14d4451bb93cf356809a3ad97e3",
            "patch": "@@ -361,6 +361,47 @@ describe('getSemanticDiagnostics', () => {\n     expect(diag.category).toBe(ts.DiagnosticCategory.Error);\n     expect(getTextOfDiagnostic(diag)).toBe(`'./missing.css'`);\n   });\n+\n+  it('should produce invalid banana in box warning', () => {\n+    const files = {\n+      'app.ts': `\n+        import {Component} from '@angular/core';\n+        @Component({\n+          selector: 'test',\n+          template: '<div ([notARealThing])=\"bar\"></div>',\n+        })\n+        export class TestCmp { \n+          bar: string = \"text\"; \n+        }\n+    `\n+    };\n+    const project = createModuleAndProjectWithDeclarations(\n+        env, 'test', files, {strictTemplates: true, _extendedTemplateDiagnostics: true});\n+\n+    const diags = project.getDiagnosticsForFile('app.ts');\n+    expect(diags.length).toEqual(1);\n+    expect(diags[0].code).toEqual(ErrorCode.INVALID_BANANA_IN_BOX);\n+    expect(diags[0].category).toEqual(ts.DiagnosticCategory.Warning);\n+  });\n+\n+  it('should not produce invalid banana in box warning', () => {\n+    const files = {\n+      'app.ts': `\n+        import {Component} from '@angular/core';\n+        @Component({\n+          selector: 'test',\n+          template: '<div ([notARealThing])=\"bar\"></div>',\n+        })\n+        export class TestCmp { \n+          bar: string = \"text\"; \n+        }\n+    `\n+    };\n+    const project = createModuleAndProjectWithDeclarations(env, 'test', files);\n+\n+    const diags = project.getDiagnosticsForFile('app.ts');\n+    expect(diags.length).toEqual(0);\n+  });\n });\n \n function getTextOfDiagnostic(diag: ts.Diagnostic): string {"
        },
        {
            "sha": "18544da7ee23b5312db06bb716b560c8cd5c666f",
            "filename": "packages/language-service/ivy/testing/src/project.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/c389052bab0db14d4451bb93cf356809a3ad97e3/packages%2Flanguage-service%2Fivy%2Ftesting%2Fsrc%2Fproject.ts",
            "raw_url": "https://github.com/angular/angular/raw/c389052bab0db14d4451bb93cf356809a3ad97e3/packages%2Flanguage-service%2Fivy%2Ftesting%2Fsrc%2Fproject.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftesting%2Fsrc%2Fproject.ts?ref=c389052bab0db14d4451bb93cf356809a3ad97e3",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {LegacyNgcOptions, StrictTemplateOptions} from '@angular/compiler-cli/src/ngtsc/core/api';\n+import {InternalOptions, LegacyNgcOptions, StrictTemplateOptions} from '@angular/compiler-cli/src/ngtsc/core/api';\n import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem, getSourceFileOrError} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {OptimizeFor, TemplateTypeChecker} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import * as ts from 'typescript/lib/tsserverlibrary';\n@@ -44,7 +44,8 @@ function writeTsconfig(\n           null, 2));\n }\n \n-export type TestableOptions = StrictTemplateOptions&Pick<LegacyNgcOptions, 'fullTemplateTypeCheck'>;\n+export type TestableOptions =\n+    StrictTemplateOptions&InternalOptions&Pick<LegacyNgcOptions, 'fullTemplateTypeCheck'>;\n \n export class Project {\n   private tsProject: ts.server.Project;"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 44,
        "deletions": 2
    }
}