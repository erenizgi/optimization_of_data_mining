{
    "author": "zbirkenbuel",
    "message": "fix(router): update getRouteGuards to check if the context outlet is activated (#39049)\n\nIn certain circumstances (errors during component constructor) the router outlet may not be activated before\nredirecting to a new route. If the new route requires running guards and resolvers the current logic will throw\nwhen accessing outlet.component due to an isActivated check within the property getter.  This update brings the\nlogic inline with deactivateRouterAndItsChildren, namely checking outlet.isActivated before trying to access\noutlet.component.\n\nFixes #39030\n\nPR Close #39049",
    "sha": "ea1968317e3f7072184b1e0703d9e8a501231755",
    "files": [
        {
            "sha": "09e87c8ef574eaec2c7702ef527ba77fbc346ab5",
            "filename": "packages/router/src/utils/preactivation.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/ea1968317e3f7072184b1e0703d9e8a501231755/packages%2Frouter%2Fsrc%2Futils%2Fpreactivation.ts",
            "raw_url": "https://github.com/angular/angular/raw/ea1968317e3f7072184b1e0703d9e8a501231755/packages%2Frouter%2Fsrc%2Futils%2Fpreactivation.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Futils%2Fpreactivation.ts?ref=ea1968317e3f7072184b1e0703d9e8a501231755",
            "patch": "@@ -121,9 +121,8 @@ function getRouteGuards(\n       getChildRouteGuards(futureNode, currNode, parentContexts, futurePath, checks);\n     }\n \n-    if (shouldRun) {\n-      const component = context && context.outlet && context.outlet.component || null;\n-      checks.canDeactivateChecks.push(new CanDeactivate(component, curr));\n+    if (shouldRun && context && context.outlet && context.outlet.isActivated) {\n+      checks.canDeactivateChecks.push(new CanDeactivate(context.outlet.component, curr));\n     }\n   } else {\n     if (curr) {"
        },
        {
            "sha": "6c5e5e5d89b43728ebbf48c227f9bee0a9ad94ac",
            "filename": "packages/router/test/integration.spec.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/ea1968317e3f7072184b1e0703d9e8a501231755/packages%2Frouter%2Ftest%2Fintegration.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ea1968317e3f7072184b1e0703d9e8a501231755/packages%2Frouter%2Ftest%2Fintegration.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fintegration.spec.ts?ref=ea1968317e3f7072184b1e0703d9e8a501231755",
            "patch": "@@ -3027,6 +3027,13 @@ describe('Integration', () => {\n                   resolve: {data: 'resolver'},\n                 },\n               ]\n+            },\n+            {\n+              path: 'throwing',\n+              runGuardsAndResolvers,\n+              component: ThrowingCmp,\n+              canActivate: ['guard'],\n+              resolve: {data: 'resolver'}\n             }\n           ]);\n \n@@ -3125,6 +3132,15 @@ describe('Integration', () => {\n              advance(fixture);\n              expect(guardRunCount).toEqual(5);\n              expect(recordedData).toEqual([{data: 0}, {data: 1}, {data: 2}, {data: 3}, {data: 4}]);\n+\n+             // Issue #39030, always running guards and resolvers should not throw\n+             // when navigating away from a component with a throwing constructor.\n+             expect(() => {\n+               router.navigateByUrl('/throwing').catch(() => {});\n+               advance(fixture);\n+               router.navigateByUrl('/a;p=1');\n+               advance(fixture);\n+             }).not.toThrow();\n            })));\n \n         it('should rerun rerun guards and resolvers when path params change',"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 18,
        "deletions": 3
    }
}