{
    "author": "devversion",
    "message": "fix(dev-infra): `ng_rollup_bundle` rule should error if import cannot be resolved (#42760)\n\nRollup just prints a warning if an import cannot be resolved and ends up\nbeing treated as an external dependency. This in combination with the\n`silent = True` attribute for `rollup_bundle` means that bundles might\nend up being extremely small without people noticing that it misses\nactual imports.\n\nTo improve this situation, the warning is replaced by an error if\nan import cannot be resolved.\n\nThis unveiles an issue with the `ng_rollup_bundle` macro from\ndev-infra where imports in View Engine were not resolved but ended\nup being treated as external. This did not prevent benchmarks using\nthis macro from working because the ConcatJS devserver had builtin\nresolution for workspace manifest paths. Though given the new check\nfor no unresolved imports, this will now cause errors within Rollup, and\nwe need to fix the resolution. We can fix the issue by temporarily\nenabling workspace linking. This does not have any performance\ndownsides.\n\nTo enable workspace linking (which we might need more often in the\nfuture given the linker taking over patched module resolution), we\nhad to rename the `angular` dependency to a more specific one so\nthat the Angular linker could link into `node_modules/angular`.\n\nPR Close #42760",
    "sha": "b1fa1bf0d599ab55600748c753062169f8ecc926",
    "files": [
        {
            "sha": "9e2e0ae58497d4266192e0946f8284637d1358b3",
            "filename": "BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/b1fa1bf0d599ab55600748c753062169f8ecc926/BUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/b1fa1bf0d599ab55600748c753062169f8ecc926/BUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/BUILD.bazel?ref=b1fa1bf0d599ab55600748c753062169f8ecc926",
            "patch": "@@ -36,18 +36,18 @@ filegroup(\n     srcs = [\n         # We also declare the unminified AngularJS files since these can be used for\n         # local debugging (e.g. see: packages/upgrade/test/common/test_helpers.ts)\n-        \"@npm//:node_modules/angular/angular.js\",\n-        \"@npm//:node_modules/angular/angular.min.js\",\n         \"@npm//:node_modules/angular-1.5/angular.js\",\n         \"@npm//:node_modules/angular-1.5/angular.min.js\",\n         \"@npm//:node_modules/angular-1.6/angular.js\",\n         \"@npm//:node_modules/angular-1.6/angular.min.js\",\n         \"@npm//:node_modules/angular-1.7/angular.js\",\n         \"@npm//:node_modules/angular-1.7/angular.min.js\",\n-        \"@npm//:node_modules/angular-mocks/angular-mocks.js\",\n         \"@npm//:node_modules/angular-mocks-1.5/angular-mocks.js\",\n         \"@npm//:node_modules/angular-mocks-1.6/angular-mocks.js\",\n         \"@npm//:node_modules/angular-mocks-1.7/angular-mocks.js\",\n+        \"@npm//:node_modules/angular-mocks-1.8/angular-mocks.js\",\n+        \"@npm//:node_modules/angular-1.8/angular.js\",\n+        \"@npm//:node_modules/angular-1.8/angular.min.js\",\n     ],\n )\n "
        },
        {
            "sha": "166fb1bb218615ab5eebbaf740a1ec1d0b3abb8d",
            "filename": "dev-infra/benchmark/ng_rollup_bundle/ng_rollup_bundle.bzl",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/b1fa1bf0d599ab55600748c753062169f8ecc926/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Fng_rollup_bundle.bzl",
            "raw_url": "https://github.com/angular/angular/raw/b1fa1bf0d599ab55600748c753062169f8ecc926/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Fng_rollup_bundle.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Fng_rollup_bundle.bzl?ref=b1fa1bf0d599ab55600748c753062169f8ecc926",
            "patch": "@@ -71,6 +71,10 @@ def ng_rollup_bundle(\n         silent = True,\n         format = format,\n         sourcemap = \"true\",\n+        # TODO(devversion): consider removing when View Engine is removed. View Engine\n+        # uses Bazel manifest path imports in generated factory files.\n+        # e.g. `import \"<workspace_root>/<..>/some_file\";`\n+        link_workspace_root = True,\n         **kwargs\n     )\n "
        },
        {
            "sha": "ab45b6fe6b45be1f1ca828a0e2361a93e5e100a3",
            "filename": "dev-infra/benchmark/ng_rollup_bundle/rollup.config-tmpl.js",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/b1fa1bf0d599ab55600748c753062169f8ecc926/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Frollup.config-tmpl.js",
            "raw_url": "https://github.com/angular/angular/raw/b1fa1bf0d599ab55600748c753062169f8ecc926/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Frollup.config-tmpl.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbenchmark%2Fng_rollup_bundle%2Frollup.config-tmpl.js?ref=b1fa1bf0d599ab55600748c753062169f8ecc926",
            "patch": "@@ -49,6 +49,7 @@ const plugins = [\n     // https://github.com/angular/angular-cli/blob/1a1ceb609b9a87c4021cce3a6f0fc6d167cd09d2/packages/ngtools/webpack/src/angular_compiler_plugin.ts#L918-L920\n     mainFields: ivyEnabled ? ['module_ivy_ngcc', 'main_ivy_ngcc', 'module', 'main'] :\n                              ['module', 'main'],\n+    preferBuiltins: true,\n   }),\n   commonjs({ignoreGlobal: true}),\n   sourcemaps(),\n@@ -62,13 +63,26 @@ if (useBuildOptimizer) {\n \n module.exports = {\n   plugins,\n+  onwarn: customWarningHandler,\n   external: [TMPL_external],\n   output: {\n     globals: {TMPL_globals},\n     banner: extractBannerIfConfigured(),\n   }\n };\n \n+/** Custom warning handler for Rollup. */\n+function customWarningHandler(warning, defaultHandler) {\n+  // If rollup is unable to resolve an import, we want to throw an error\n+  // instead of silently treating the import as external dependency.\n+  // https://rollupjs.org/guide/en/#warning-treating-module-as-external-dependency\n+  if (warning.code === 'UNRESOLVED_IMPORT') {\n+    throw Error(`Unresolved import: ${warning.message}`);\n+  }\n+\n+  defaultHandler(warning);\n+}\n+\n /** Extracts the top-level bundle banner if specified. */\n function extractBannerIfConfigured() {\n   if (!bannerFile) {"
        },
        {
            "sha": "956b2860f8ca7fae59e412a6835fccdb7339cbd3",
            "filename": "karma-js.conf.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/b1fa1bf0d599ab55600748c753062169f8ecc926/karma-js.conf.js",
            "raw_url": "https://github.com/angular/angular/raw/b1fa1bf0d599ab55600748c753062169f8ecc926/karma-js.conf.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/karma-js.conf.js?ref=b1fa1bf0d599ab55600748c753062169f8ecc926",
            "patch": "@@ -36,8 +36,8 @@ module.exports = function(config) {\n       {pattern: 'node_modules/angular-mocks-1.6/angular-mocks.js', included: false, watched: false},\n       {pattern: 'node_modules/angular-1.7/angular?(.min).js', included: false, watched: false},\n       {pattern: 'node_modules/angular-mocks-1.7/angular-mocks.js', included: false, watched: false},\n-      {pattern: 'node_modules/angular/angular?(.min).js', included: false, watched: false},\n-      {pattern: 'node_modules/angular-mocks/angular-mocks.js', included: false, watched: false},\n+      {pattern: 'node_modules/angular-1.8/angular?(.min).js', included: false, watched: false},\n+      {pattern: 'node_modules/angular-mocks-1.8/angular-mocks.js', included: false, watched: false},\n \n       'node_modules/core-js-bundle/index.js',\n       'node_modules/jasmine-ajax/lib/mock-ajax.js',"
        },
        {
            "sha": "677f511ee00818f001e46f411c8351063ad25f12",
            "filename": "modules/benchmarks/src/tree/ng1/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/b1fa1bf0d599ab55600748c753062169f8ecc926/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng1%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/b1fa1bf0d599ab55600748c753062169f8ecc926/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng1%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Ftree%2Fng1%2FBUILD.bazel?ref=b1fa1bf0d599ab55600748c753062169f8ecc926",
            "patch": "@@ -16,7 +16,7 @@ ts_library(\n \n ts_devserver(\n     name = \"devserver\",\n-    bootstrap = [\"@npm//:node_modules/angular/angular.js\"],\n+    bootstrap = [\"@npm//:node_modules/angular-1.8/angular.js\"],\n     entry_module = \"angular/modules/benchmarks/src/tree/ng1/index\",\n     port = 4200,\n     static_files = [\"index.html\"],"
        },
        {
            "sha": "fad4b68f1058269603e2a7e73caf2bf2f6dcbdd0",
            "filename": "modules/playground/src/upgrade/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/b1fa1bf0d599ab55600748c753062169f8ecc926/modules%2Fplayground%2Fsrc%2Fupgrade%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/b1fa1bf0d599ab55600748c753062169f8ecc926/modules%2Fplayground%2Fsrc%2Fupgrade%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fplayground%2Fsrc%2Fupgrade%2FBUILD.bazel?ref=b1fa1bf0d599ab55600748c753062169f8ecc926",
            "patch": "@@ -20,7 +20,7 @@ ts_devserver(\n     bootstrap = [\n         \"//packages/zone.js/bundles:zone.umd.js\",\n         \"@npm//:node_modules/reflect-metadata/Reflect.js\",\n-        \"@npm//:node_modules/angular/angular.js\",\n+        \"@npm//:node_modules/angular-1.8/angular.js\",\n     ],\n     entry_module = \"angular/modules/playground/src/upgrade/index\",\n     port = 4200,"
        },
        {
            "sha": "0c63b5871fb154160d11bddac0a6dcff5c6346cb",
            "filename": "package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/b1fa1bf0d599ab55600748c753062169f8ecc926/package.json",
            "raw_url": "https://github.com/angular/angular/raw/b1fa1bf0d599ab55600748c753062169f8ecc926/package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/package.json?ref=b1fa1bf0d599ab55600748c753062169f8ecc926",
            "patch": "@@ -94,14 +94,14 @@\n     \"@types/yaml\": \"^1.9.7\",\n     \"@types/yargs\": \"^16.0.1\",\n     \"@webcomponents/custom-elements\": \"^1.1.0\",\n-    \"angular\": \"npm:angular@1.8\",\n     \"angular-1.5\": \"npm:angular@1.5\",\n     \"angular-1.6\": \"npm:angular@1.6\",\n     \"angular-1.7\": \"npm:angular@1.7\",\n-    \"angular-mocks\": \"npm:angular-mocks@1.8\",\n+    \"angular-1.8\": \"npm:angular@1.8\",\n     \"angular-mocks-1.5\": \"npm:angular-mocks@1.5\",\n     \"angular-mocks-1.6\": \"npm:angular-mocks@1.6\",\n     \"angular-mocks-1.7\": \"npm:angular-mocks@1.7\",\n+    \"angular-mocks-1.8\": \"npm:angular-mocks@1.8\",\n     \"base64-js\": \"1.5.1\",\n     \"bluebird\": \"^3.7.2\",\n     \"brotli\": \"^1.3.2\","
        },
        {
            "sha": "cd820eee2eb83d7578ec8c1d8b4ae30bde2ce5c2",
            "filename": "packages/examples/upgrade/upgrade_example.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/b1fa1bf0d599ab55600748c753062169f8ecc926/packages%2Fexamples%2Fupgrade%2Fupgrade_example.bzl",
            "raw_url": "https://github.com/angular/angular/raw/b1fa1bf0d599ab55600748c753062169f8ecc926/packages%2Fexamples%2Fupgrade%2Fupgrade_example.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fexamples%2Fupgrade%2Fupgrade_example.bzl?ref=b1fa1bf0d599ab55600748c753062169f8ecc926",
            "patch": "@@ -45,7 +45,7 @@ def create_upgrade_example_targets(name, srcs, e2e_srcs, entry_module, assets =\n         additional_root_paths = [\"angular/packages/examples\"],\n         bootstrap = [\n             \"//packages/zone.js/bundles:zone.umd.js\",\n-            \"@npm//:node_modules/angular/angular.js\",\n+            \"@npm//:node_modules/angular-1.8/angular.js\",\n             \"@npm//:node_modules/reflect-metadata/Reflect.js\",\n         ],\n         static_files = ["
        },
        {
            "sha": "edb3298c17fbda1956f02a53c8b4ce8645e5c193",
            "filename": "packages/language-service/bundles/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/b1fa1bf0d599ab55600748c753062169f8ecc926/packages%2Flanguage-service%2Fbundles%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/b1fa1bf0d599ab55600748c753062169f8ecc926/packages%2Flanguage-service%2Fbundles%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fbundles%2FBUILD.bazel?ref=b1fa1bf0d599ab55600748c753062169f8ecc926",
            "patch": "@@ -6,6 +6,7 @@ ng_rollup_bundle(\n     entry_point = \"//packages/language-service:src/ts_plugin.ts\",\n     format = \"amd\",\n     globals = {\n+        \"os\": \"os\",\n         \"fs\": \"fs\",\n         \"path\": \"path\",\n         \"typescript\": \"ts\",\n@@ -26,6 +27,7 @@ ng_rollup_bundle(\n     entry_point = \"//packages/language-service/ivy:ts_plugin.ts\",\n     format = \"amd\",\n     globals = {\n+        \"os\": \"os\",\n         \"fs\": \"fs\",\n         \"path\": \"path\",\n         \"typescript\": \"ts\","
        },
        {
            "sha": "f6e5f0ba5f4f000ace53ea230045203919a30276",
            "filename": "packages/upgrade/src/common/test/helpers/common_test_helpers.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/b1fa1bf0d599ab55600748c753062169f8ecc926/packages%2Fupgrade%2Fsrc%2Fcommon%2Ftest%2Fhelpers%2Fcommon_test_helpers.ts",
            "raw_url": "https://github.com/angular/angular/raw/b1fa1bf0d599ab55600748c753062169f8ecc926/packages%2Fupgrade%2Fsrc%2Fcommon%2Ftest%2Fhelpers%2Fcommon_test_helpers.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fupgrade%2Fsrc%2Fcommon%2Ftest%2Fhelpers%2Fcommon_test_helpers.ts?ref=b1fa1bf0d599ab55600748c753062169f8ecc926",
            "patch": "@@ -27,7 +27,7 @@ const ng1Versions = [\n   },\n   {\n     label: '1.8',\n-    files: [`angular/${ANGULARJS_FILENAME}`, 'angular-mocks/angular-mocks.js'],\n+    files: [`angular-1.8/${ANGULARJS_FILENAME}`, 'angular-mocks-1.8/angular-mocks.js'],\n   },\n ];\n "
        },
        {
            "sha": "06d7f9a115d12d07a5de58cf30030851f3a07e9c",
            "filename": "renovate.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/b1fa1bf0d599ab55600748c753062169f8ecc926/renovate.json",
            "raw_url": "https://github.com/angular/angular/raw/b1fa1bf0d599ab55600748c753062169f8ecc926/renovate.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/renovate.json?ref=b1fa1bf0d599ab55600748c753062169f8ecc926",
            "patch": "@@ -35,14 +35,14 @@\n     \"@types/babel__traverse\",\n     \"@types/node\",\n     \"@types/selenium-webdriver\",\n-    \"angular\",\n     \"angular-1.5\",\n     \"angular-1.6\",\n     \"angular-1.7\",\n-    \"angular-mocks\",\n+    \"angular-1.8\",\n     \"angular-mocks-1.5\",\n     \"angular-mocks-1.6\",\n     \"angular-mocks-1.7\",\n+    \"angular-mocks-1.8\",\n     \"puppeteer\",\n     \"rollup\",\n     \"selenium-webdriver\","
        },
        {
            "sha": "c31ed3c77a6f1d8672e7a1a49ed8cf7b8c9c4813",
            "filename": "yarn.lock",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/b1fa1bf0d599ab55600748c753062169f8ecc926/yarn.lock",
            "raw_url": "https://github.com/angular/angular/raw/b1fa1bf0d599ab55600748c753062169f8ecc926/yarn.lock",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/yarn.lock?ref=b1fa1bf0d599ab55600748c753062169f8ecc926",
            "patch": "@@ -2291,6 +2291,11 @@ alphanum-sort@^1.0.2:\n   resolved \"https://registry.yarnpkg.com/angular/-/angular-1.7.9.tgz#e52616e8701c17724c3c238cfe4f9446fd570bc4\"\n   integrity sha512-5se7ZpcOtu0MBFlzGv5dsM1quQDoDeUTwZrWjGtTNA7O88cD8TEk5IEKCTDa3uECV9XnvKREVUr7du1ACiWGFQ==\n \n+\"angular-1.8@npm:angular@1.8\":\n+  version \"1.8.2\"\n+  resolved \"https://registry.yarnpkg.com/angular/-/angular-1.8.2.tgz#5983bbb5a9fa63e213cb7749199e0d352de3a2f1\"\n+  integrity sha512-IauMOej2xEe7/7Ennahkbb5qd/HFADiNuLSESz9Q27inmi32zB0lnAsFeLEWcox3Gd1F6YhNd1CP7/9IukJ0Gw==\n+\n \"angular-mocks-1.5@npm:angular-mocks@1.5\":\n   version \"1.5.11\"\n   resolved \"https://registry.yarnpkg.com/angular-mocks/-/angular-mocks-1.5.11.tgz#a0e1dd0ea55fd77ee7a757d75536c5e964c86f81\"\n@@ -2306,16 +2311,11 @@ alphanum-sort@^1.0.2:\n   resolved \"https://registry.yarnpkg.com/angular-mocks/-/angular-mocks-1.7.9.tgz#0a3b7e28b9a493b4e3010ed2b0f69a68e9b4f79b\"\n   integrity sha512-LQRqqiV3sZ7NTHBnNmLT0bXtE5e81t97+hkJ56oU0k3dqKv1s6F+nBWRlOVzqHWPGFOiPS8ZJVdrS8DFzHyNIA==\n \n-\"angular-mocks@npm:angular-mocks@1.8\":\n+\"angular-mocks-1.8@npm:angular-mocks@1.8\":\n   version \"1.8.2\"\n   resolved \"https://registry.yarnpkg.com/angular-mocks/-/angular-mocks-1.8.2.tgz#dc022420b86978cf317a8447c116c0be73a853bf\"\n   integrity sha512-I5L3P0l21HPdVsP4A4qWmENt4ePjjbkDFdAzOaM7QiibFySbt14DptPbt2IjeG4vFBr4vSLbhIz8Fk03DISl8Q==\n \n-\"angular@npm:angular@1.8\":\n-  version \"1.8.2\"\n-  resolved \"https://registry.yarnpkg.com/angular/-/angular-1.8.2.tgz#5983bbb5a9fa63e213cb7749199e0d352de3a2f1\"\n-  integrity sha512-IauMOej2xEe7/7Ennahkbb5qd/HFADiNuLSESz9Q27inmi32zB0lnAsFeLEWcox3Gd1F6YhNd1CP7/9IukJ0Gw==\n-\n ansi-align@^3.0.0:\n   version \"3.0.0\"\n   resolved \"https://registry.yarnpkg.com/ansi-align/-/ansi-align-3.0.0.tgz#b536b371cf687caaef236c18d3e21fe3797467cb\""
        }
    ],
    "stats": {
        "total": 58,
        "additions": 39,
        "deletions": 19
    }
}