{
    "author": "petebacondarwin",
    "message": "refactor(localize): include text in original location of extracted messages (#38536)\n\nWhen extracting messages, source-mapping information is used to find\nthe original location of the message being extracted. This commit will\nnow include the text from the original source in the message location\nso that it can be serialized into the translation file.\n\nPR Close #38536",
    "sha": "bdba1a062dced20ea0c76d78ee3d0d7d11668877",
    "files": [
        {
            "sha": "61331064ee4cc6800e7380a48c1a06a38436908a",
            "filename": "packages/localize/src/tools/src/extract/extraction.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/bdba1a062dced20ea0c76d78ee3d0d7d11668877/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fextraction.ts",
            "raw_url": "https://github.com/angular/angular/raw/bdba1a062dced20ea0c76d78ee3d0d7d11668877/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fextraction.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fextraction.ts?ref=bdba1a062dced20ea0c76d78ee3d0d7d11668877",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem, PathSegment} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {AbsoluteFsPath, FileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {Logger} from '@angular/compiler-cli/src/ngtsc/logging';\n import {SourceFile, SourceFileLoader} from '@angular/compiler-cli/src/ngtsc/sourcemaps';\n import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n@@ -103,6 +103,11 @@ export class MessageExtractor {\n     const end = (originalEnd !== null && originalEnd.file === originalStart.file) ?\n         {line: originalEnd.line, column: originalEnd.column} :\n         start;\n-    return {file: originalStart.file, start, end};\n+    const originalSourceFile =\n+        sourceFile.sources.find(sf => sf?.sourcePath === originalStart.file)!;\n+    const startPos = originalSourceFile.startOfLinePositions[start.line] + start.column;\n+    const endPos = originalSourceFile.startOfLinePositions[end.line] + end.column;\n+    const text = originalSourceFile.contents.substring(startPos, endPos);\n+    return {file: originalStart.file, start, end, text};\n   }\n }"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 7,
        "deletions": 2
    }
}