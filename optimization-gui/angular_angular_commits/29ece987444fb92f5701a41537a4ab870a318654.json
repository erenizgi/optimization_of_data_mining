{
    "author": "swseverance",
    "message": "docs: asynchronous test spy method (#42274)\n\nfixes two `HeroService` tests that were synchronously\ntesting an asynchronous spy method\n\nPR Close #42274",
    "sha": "29ece987444fb92f5701a41537a4ab870a318654",
    "files": [
        {
            "sha": "936936a5b8e5a9973a414a6c5d93373cae3f324f",
            "filename": "aio/content/examples/testing/src/app/model/hero.service.spec.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 6,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/29ece987444fb92f5701a41537a4ab870a318654/aio%2Fcontent%2Fexamples%2Ftesting%2Fsrc%2Fapp%2Fmodel%2Fhero.service.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/29ece987444fb92f5701a41537a4ab870a318654/aio%2Fcontent%2Fexamples%2Ftesting%2Fsrc%2Fapp%2Fmodel%2Fhero.service.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Ftesting%2Fsrc%2Fapp%2Fmodel%2Fhero.service.spec.ts?ref=29ece987444fb92f5701a41537a4ab870a318654",
            "patch": "@@ -20,20 +20,23 @@ describe ('HeroesService (with spies)', () => {\n     heroService = new HeroService(httpClientSpy as any);\n   });\n \n-  it('should return expected heroes (HttpClient called once)', () => {\n+  it('should return expected heroes (HttpClient called once)', (done: DoneFn) => {\n     const expectedHeroes: Hero[] =\n       [{ id: 1, name: 'A' }, { id: 2, name: 'B' }];\n \n     httpClientSpy.get.and.returnValue(asyncData(expectedHeroes));\n \n     heroService.getHeroes().subscribe(\n-      heroes => expect(heroes).toEqual(expectedHeroes, 'expected heroes'),\n-      fail\n+      heroes => {\n+        expect(heroes).toEqual(expectedHeroes, 'expected heroes');\n+        done();\n+      },\n+      done.fail\n     );\n     expect(httpClientSpy.get.calls.count()).toBe(1, 'one call');\n   });\n \n-  it('should return an error when the server returns a 404', () => {\n+  it('should return an error when the server returns a 404', (done: DoneFn) => {\n     const errorResponse = new HttpErrorResponse({\n       error: 'test 404 error',\n       status: 404, statusText: 'Not Found'\n@@ -42,8 +45,11 @@ describe ('HeroesService (with spies)', () => {\n     httpClientSpy.get.and.returnValue(asyncError(errorResponse));\n \n     heroService.getHeroes().subscribe(\n-      heroes => fail('expected an error, not heroes'),\n-      error  => expect(error.message).toContain('test 404 error')\n+      heroes => done.fail('expected an error, not heroes'),\n+      error  => {\n+        expect(error.message).toContain('test 404 error');\n+        done();\n+      }\n     );\n   });\n   // #enddocregion test-with-spies"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 12,
        "deletions": 6
    }
}