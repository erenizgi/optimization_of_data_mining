{
    "author": "petebacondarwin",
    "message": "feat(localize): support \"associated message ids\" for placeholders (#43534)\n\nWhen extracting i18n messages, the Angular compiler needs to split ICU expressions\ninto their own message.  Currently there is no guaranteed way to re-associate\nthe ICU message with the original message where the ICU was found.\n\nThis change adds support in the localize tooling so that associated ids can be\nstored as metadata in the `$localize` tagged strings. These ids can then be\nused in generated translation files to provide a link between the two messages.\n\nThe XLIFF 1.2 and 2.0 formats have been updated to render these relationships,\nvia the `xid` and `subFlows` attributes respectively.\n\nPR Close #43534",
    "sha": "d3cf222a8193bc7ccd9e7ce886846d1f79131627",
    "files": [
        {
            "sha": "568dba3d31ccdfc80e84a6f28ed0aaa54e04d97a",
            "filename": "packages/localize/src/utils/src/messages.ts",
            "status": "modified",
            "additions": 54,
            "deletions": 11,
            "changes": 65,
            "blob_url": "https://github.com/angular/angular/blob/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Fsrc%2Futils%2Fsrc%2Fmessages.ts",
            "raw_url": "https://github.com/angular/angular/raw/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Fsrc%2Futils%2Fsrc%2Fmessages.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Futils%2Fsrc%2Fmessages.ts?ref=d3cf222a8193bc7ccd9e7ce886846d1f79131627",
            "patch": "@@ -97,7 +97,7 @@ export interface MessageMetadata {\n  *\n  * ```\n  * const name = 'Jo Bloggs';\n- * $localize`Hello ${name}:title!`;\n+ * $localize`Hello ${name}:title@@ID:!`;\n  * ```\n  *\n  * May be parsed into:\n@@ -107,6 +107,8 @@ export interface MessageMetadata {\n  *   id: '6998194507597730591',\n  *   substitutions: { title: 'Jo Bloggs' },\n  *   messageString: 'Hello {$title}!',\n+ *   placeholderNames: ['title'],\n+ *   associatedMessageIds: { title: 'ID' },\n  * }\n  * ```\n  */\n@@ -119,6 +121,11 @@ export interface ParsedMessage extends MessageMetadata {\n    * A mapping of placeholder names to substitution values.\n    */\n   substitutions: Record<string, any>;\n+  /**\n+   * An optional mapping of placeholder names to associated MessageIds.\n+   * This can be used to match ICU placeholders to the message that contains the ICU.\n+   */\n+  associatedMessageIds?: Record<string, MessageId>;\n   /**\n    * An optional mapping of placeholder names to source locations\n    */\n@@ -149,19 +156,23 @@ export function parseMessage(\n     expressionLocations: (SourceLocation|undefined)[] = []): ParsedMessage {\n   const substitutions: {[placeholderName: string]: any} = {};\n   const substitutionLocations: {[placeholderName: string]: SourceLocation|undefined} = {};\n+  const associatedMessageIds: {[placeholderName: string]: MessageId} = {};\n   const metadata = parseMetadata(messageParts[0], messageParts.raw[0]);\n   const cleanedMessageParts: string[] = [metadata.text];\n   const placeholderNames: string[] = [];\n   let messageString = metadata.text;\n   for (let i = 1; i < messageParts.length; i++) {\n-    const {text: messagePart, block: placeholderName = computePlaceholderName(i)} =\n-        splitBlock(messageParts[i], messageParts.raw[i]);\n+    const {messagePart, placeholderName = computePlaceholderName(i), associatedMessageId} =\n+        parsePlaceholder(messageParts[i], messageParts.raw[i]);\n     messageString += `{$${placeholderName}}${messagePart}`;\n     if (expressions !== undefined) {\n       substitutions[placeholderName] = expressions[i - 1];\n       substitutionLocations[placeholderName] = expressionLocations[i - 1];\n     }\n     placeholderNames.push(placeholderName);\n+    if (associatedMessageId !== undefined) {\n+      associatedMessageIds[placeholderName] = associatedMessageId;\n+    }\n     cleanedMessageParts.push(messagePart);\n   }\n   const messageId = metadata.customId || computeMsgId(messageString, metadata.meaning || '');\n@@ -178,6 +189,7 @@ export function parseMessage(\n     messageParts: cleanedMessageParts,\n     messagePartLocations,\n     placeholderNames,\n+    associatedMessageIds,\n     location,\n   };\n }\n@@ -194,14 +206,14 @@ export function parseMessage(\n  * For example:\n  *\n  * ```ts\n- * `:meaning|description@@custom-id`\n- * `:meaning|@@custom-id`\n- * `:meaning|description`\n- * `description@@custom-id`\n- * `meaning|`\n- * `description`\n- * `@@custom-id`\n- * `:meaning|description@@custom-id␟legacy-id-1␟legacy-id-2`\n+ * `:meaning|description@@custom-id:`\n+ * `:meaning|@@custom-id:`\n+ * `:meaning|description:`\n+ * `:description@@custom-id:`\n+ * `:meaning|:`\n+ * `:description:`\n+ * `:@@custom-id:`\n+ * `:meaning|description@@custom-id␟legacy-id-1␟legacy-id-2:`\n  * ```\n  *\n  * @param cooked The cooked version of the message part to parse.\n@@ -227,6 +239,37 @@ export function parseMetadata(cooked: string, raw: string): MessageMetadata {\n   }\n }\n \n+/**\n+ * Parse the given message part (`cooked` + `raw`) to extract any placeholder metadata from the\n+ * text.\n+ *\n+ * If the message part has a metadata block this function will extract the `placeholderName` and\n+ * `associatedMessageId` (if provided) from the block.\n+ *\n+ * These metadata properties are serialized in the string delimited by `@@`.\n+ *\n+ * For example:\n+ *\n+ * ```ts\n+ * `:placeholder-name@@associated-id:`\n+ * ```\n+ *\n+ * @param cooked The cooked version of the message part to parse.\n+ * @param raw The raw version of the message part to parse.\n+ * @returns A object containing the metadata (`placeholderName` and `associatedMesssageId`) of the\n+ *     preceding placeholder, along with the static text that follows.\n+ */\n+export function parsePlaceholder(cooked: string, raw: string):\n+    {messagePart: string; placeholderName?: string; associatedMessageId?: string;} {\n+  const {text: messagePart, block} = splitBlock(cooked, raw);\n+  if (block === undefined) {\n+    return {messagePart};\n+  } else {\n+    const [placeholderName, associatedMessageId] = block.split(ID_SEPARATOR);\n+    return {messagePart, placeholderName, associatedMessageId};\n+  }\n+}\n+\n /**\n  * Split a message part (`cooked` + `raw`) into an optional delimited \"block\" off the front and the\n  * rest of the text of the message part."
        },
        {
            "sha": "b34862ce1f14fda4529aaa96ceb8080549c2063a",
            "filename": "packages/localize/tools/src/extract/translation_files/xliff1_translation_serializer.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts?ref=d3cf222a8193bc7ccd9e7ce886846d1f79131627",
            "patch": "@@ -83,8 +83,11 @@ export class Xliff1TranslationSerializer implements TranslationSerializer {\n     const length = message.messageParts.length - 1;\n     for (let i = 0; i < length; i++) {\n       this.serializeTextPart(xml, message.messageParts[i]);\n-      const location = message.substitutionLocations?.[message.placeholderNames[i]];\n-      this.serializePlaceholder(xml, message.placeholderNames[i], location?.text);\n+      const name = message.placeholderNames[i];\n+      const location = message.substitutionLocations?.[name];\n+      const associatedMessageId =\n+          message.associatedMessageIds && message.associatedMessageIds[name];\n+      this.serializePlaceholder(xml, name, location?.text, associatedMessageId);\n     }\n     this.serializeTextPart(xml, message.messageParts[length]);\n   }\n@@ -94,12 +97,13 @@ export class Xliff1TranslationSerializer implements TranslationSerializer {\n     const length = pieces.length - 1;\n     for (let i = 0; i < length; i += 2) {\n       xml.text(pieces[i]);\n-      this.serializePlaceholder(xml, pieces[i + 1], undefined);\n+      this.serializePlaceholder(xml, pieces[i + 1], undefined, undefined);\n     }\n     xml.text(pieces[length]);\n   }\n \n-  private serializePlaceholder(xml: XmlFile, id: string, text: string|undefined): void {\n+  private serializePlaceholder(\n+      xml: XmlFile, id: string, text: string|undefined, associatedId: string|undefined): void {\n     const attrs: Record<string, string> = {id};\n     const ctype = getCtypeForPlaceholder(id);\n     if (ctype !== null) {\n@@ -108,6 +112,9 @@ export class Xliff1TranslationSerializer implements TranslationSerializer {\n     if (text !== undefined) {\n       attrs['equiv-text'] = text;\n     }\n+    if (associatedId !== undefined) {\n+      attrs['xid'] = associatedId;\n+    }\n     xml.startTag('x', attrs, {selfClosing: true});\n   }\n "
        },
        {
            "sha": "34b5b560683a04cf51c43db7942a59e1a7faa7e4",
            "filename": "packages/localize/tools/src/extract/translation_files/xliff2_translation_serializer.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts?ref=d3cf222a8193bc7ccd9e7ce886846d1f79131627",
            "patch": "@@ -92,7 +92,10 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n     const length = message.messageParts.length - 1;\n     for (let i = 0; i < length; i++) {\n       this.serializeTextPart(xml, message.messageParts[i]);\n-      this.serializePlaceholder(xml, message.placeholderNames[i], message.substitutionLocations);\n+      const name = message.placeholderNames[i];\n+      const associatedMessageId =\n+          message.associatedMessageIds && message.associatedMessageIds[name];\n+      this.serializePlaceholder(xml, name, message.substitutionLocations, associatedMessageId);\n     }\n     this.serializeTextPart(xml, message.messageParts[length]);\n   }\n@@ -102,14 +105,15 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n     const length = pieces.length - 1;\n     for (let i = 0; i < length; i += 2) {\n       xml.text(pieces[i]);\n-      this.serializePlaceholder(xml, pieces[i + 1], undefined);\n+      this.serializePlaceholder(xml, pieces[i + 1], undefined, undefined);\n     }\n     xml.text(pieces[length]);\n   }\n \n   private serializePlaceholder(\n       xml: XmlFile, placeholderName: string,\n-      substitutionLocations: Record<string, ɵSourceLocation|undefined>|undefined): void {\n+      substitutionLocations: Record<string, ɵSourceLocation|undefined>|undefined,\n+      associatedMessageId: string|undefined): void {\n     const text = substitutionLocations?.[placeholderName]?.text;\n \n     if (placeholderName.startsWith('START_')) {\n@@ -147,6 +151,9 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n       if (text !== undefined) {\n         attrs.disp = text;\n       }\n+      if (associatedMessageId !== undefined) {\n+        attrs['subFlows'] = associatedMessageId;\n+      }\n       xml.startTag('ph', attrs, {selfClosing: true});\n     }\n   }"
        },
        {
            "sha": "b0303721fbc0a51d90a6ef5d20d24a9dac7104ef",
            "filename": "packages/localize/tools/test/extract/extractor_spec.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 9,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Fextractor_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Fextractor_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Fextractor_spec.ts?ref=d3cf222a8193bc7ccd9e7ce886846d1f79131627",
            "patch": "@@ -22,7 +22,7 @@ runInNativeFileSystem(() => {\n       const extractor = new MessageExtractor(fs, logger, {basePath});\n       fs.ensureDir(fs.dirname(file));\n       fs.writeFile(file, [\n-        '$localize`:meaning|description:a${1}b${2}c`;',\n+        '$localize`:meaning|description:a${1}b${2}:ICU@@associated-id:c`;',\n         '$localize(__makeTemplateObject([\"a\", \":custom-placeholder:b\", \"c\"], [\"a\", \":custom-placeholder:b\", \"c\"]), 1, 2);',\n         '$localize`:@@custom-id:a${1}b${2}c`;',\n       ].join('\\n'));\n@@ -31,7 +31,7 @@ runInNativeFileSystem(() => {\n       expect(messages.length).toEqual(3);\n \n       expect(messages[0]).toEqual({\n-        id: '2714330828844000684',\n+        id: '8550342801935228331',\n         customId: undefined,\n         description: 'description',\n         meaning: 'meaning',\n@@ -51,24 +51,25 @@ runInNativeFileSystem(() => {\n           },\n           {\n             start: {line: 0, column: 41},\n-            end: {line: 0, column: 42},\n+            end: {line: 0, column: 62},\n             file,\n-            text: 'c',\n+            text: ':ICU@@associated-id:c',\n           }\n         ],\n-        text: 'a{$PH}b{$PH_1}c',\n-        placeholderNames: ['PH', 'PH_1'],\n+        text: 'a{$PH}b{$ICU}c',\n+        placeholderNames: ['PH', 'ICU'],\n+        associatedMessageIds: {ICU: 'associated-id'},\n         substitutions: jasmine.any(Object),\n         substitutionLocations: {\n           PH: {start: {line: 0, column: 34}, end: {line: 0, column: 35}, file, text: '1'},\n-          PH_1: {start: {line: 0, column: 39}, end: {line: 0, column: 40}, file, text: '2'}\n+          ICU: {start: {line: 0, column: 39}, end: {line: 0, column: 40}, file, text: '2'}\n         },\n         legacyIds: [],\n         location: {\n           start: {line: 0, column: 9},\n-          end: {line: 0, column: 43},\n+          end: {line: 0, column: 63},\n           file,\n-          text: '`:meaning|description:a${1}b${2}c`',\n+          text: '`:meaning|description:a${1}b${2}:ICU@@associated-id:c`',\n         },\n       });\n \n@@ -100,6 +101,7 @@ runInNativeFileSystem(() => {\n         ],\n         text: 'a{$custom-placeholder}b{$PH_1}c',\n         placeholderNames: ['custom-placeholder', 'PH_1'],\n+        associatedMessageIds: {},\n         substitutions: jasmine.any(Object),\n         substitutionLocations: {\n           'custom-placeholder':\n@@ -124,6 +126,7 @@ runInNativeFileSystem(() => {\n         messageParts: ['a', 'b', 'c'],\n         text: 'a{$PH}b{$PH_1}c',\n         placeholderNames: ['PH', 'PH_1'],\n+        associatedMessageIds: {},\n         substitutions: jasmine.any(Object),\n         substitutionLocations: {\n           PH: {start: {line: 2, column: 26}, end: {line: 2, column: 27}, file, text: '1'},"
        },
        {
            "sha": "62715615d9a621ff4cbf6076642108219ce8a864",
            "filename": "packages/localize/tools/test/extract/translation_files/mock_message.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fmock_message.ts",
            "raw_url": "https://github.com/angular/angular/raw/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fmock_message.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fmock_message.ts?ref=d3cf222a8193bc7ccd9e7ce886846d1f79131627",
            "patch": "@@ -16,6 +16,7 @@ export interface MockMessageOptions {\n   location?: SourceLocation;\n   legacyIds?: string[];\n   messagePartLocations?: (SourceLocation|undefined)[];\n+  associatedMessageIds?: Record<string, string>;\n   substitutionLocations?: Record<string, SourceLocation|undefined>;\n }\n "
        },
        {
            "sha": "731176ca4ef90a37c811668dae3f4c63fe5fba04",
            "filename": "packages/localize/tools/test/extract/translation_files/xliff1_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts?ref=d3cf222a8193bc7ccd9e7ce886846d1f79131627",
            "patch": "@@ -64,9 +64,12 @@ runInEachFileSystem(() => {\n               mockMessage('80808', ['multi\\nlines'], [], {}),\n               mockMessage('90000', ['<escape', 'me>'], ['double-quotes-\"'], {}),\n               mockMessage(\n-                  '100000',\n+                  '100000', ['pre-ICU ', ' post-ICU'], ['ICU'],\n+                  {associatedMessageIds: {ICU: 'SOME_ICU_ID'}}),\n+              mockMessage(\n+                  'SOME_ICU_ID',\n                   [\n-                    'pre-ICU {VAR_SELECT, select, a {a} b {{INTERPOLATION}} c {pre {INTERPOLATION_1} post}} post-ICU'\n+                    '{VAR_SELECT, select, a {a} b {{INTERPOLATION}} c {pre {INTERPOLATION_1} post}}'\n                   ],\n                   [], {}),\n               mockMessage(\n@@ -108,7 +111,10 @@ runInEachFileSystem(() => {\n               `        <source>&lt;escape<x id=\"double-quotes-&quot;\"/>me&gt;</source>`,\n               `      </trans-unit>`,\n               `      <trans-unit id=\"100000\" datatype=\"html\">`,\n-              `        <source>pre-ICU {VAR_SELECT, select, a {a} b {<x id=\"INTERPOLATION\"/>} c {pre <x id=\"INTERPOLATION_1\"/> post}} post-ICU</source>`,\n+              `        <source>pre-ICU <x id=\"ICU\" xid=\"SOME_ICU_ID\"/> post-ICU</source>`,\n+              `      </trans-unit>`,\n+              `      <trans-unit id=\"SOME_ICU_ID\" datatype=\"html\">`,\n+              `        <source>{VAR_SELECT, select, a {a} b {<x id=\"INTERPOLATION\"/>} c {pre <x id=\"INTERPOLATION_1\"/> post}}</source>`,\n               `      </trans-unit>`,\n               `      <trans-unit id=\"100001\" datatype=\"html\">`,\n               `        <source>{VAR_PLURAL, plural, one {<x id=\"START_BOLD_TEXT\" ctype=\"x-b\"/>something bold<x id=\"CLOSE_BOLD_TEXT\" ctype=\"x-b\"/>} other {pre <x id=\"START_TAG_SPAN\" ctype=\"x-span\"/>middle<x id=\"CLOSE_TAG_SPAN\" ctype=\"x-span\"/> post}}</source>`,"
        },
        {
            "sha": "47ace10825ef4b33c27f9fe8ec05d2137bbec70d",
            "filename": "packages/localize/tools/test/extract/translation_files/xliff2_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 6,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d3cf222a8193bc7ccd9e7ce886846d1f79131627/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts?ref=d3cf222a8193bc7ccd9e7ce886846d1f79131627",
            "patch": "@@ -69,9 +69,12 @@ runInEachFileSystem(() => {\n               mockMessage('80808', ['multi\\nlines'], [], {}),\n               mockMessage('90000', ['<escape', 'me>'], ['double-quotes-\"'], {}),\n               mockMessage(\n-                  '100000',\n+                  '100000', ['pre-ICU ', ' post-ICU'], ['ICU'],\n+                  {associatedMessageIds: {ICU: 'SOME_ICU_ID'}}),\n+              mockMessage(\n+                  'SOME_ICU_ID',\n                   [\n-                    'pre-ICU {VAR_SELECT, select, a {a} b {{INTERPOLATION}} c {pre {INTERPOLATION_1} post}} post-ICU'\n+                    '{VAR_SELECT, select, a {a} b {{INTERPOLATION}} c {pre {INTERPOLATION_1} post}}'\n                   ],\n                   [], {}),\n               mockMessage(\n@@ -84,7 +87,7 @@ runInEachFileSystem(() => {\n             const serializer = new Xliff2TranslationSerializer(\n                 'xx', absoluteFrom('/project'), useLegacyIds, options);\n             const output = serializer.serialize(messages);\n-            expect(output).toEqual([\n+            expect(output.split(/\\r?\\n/)).toEqual([\n               `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>`,\n               `<xliff version=\"2.0\" xmlns=\"urn:oasis:names:tc:xliff:document:2.0\" srcLang=\"xx\">`,\n               `  <file id=\"ngi18n\" original=\"ng.template\"${toAttributes(options)}>`,\n@@ -120,7 +123,12 @@ runInEachFileSystem(() => {\n               `    </unit>`,\n               `    <unit id=\"100000\">`,\n               `      <segment>`,\n-              `        <source>pre-ICU {VAR_SELECT, select, a {a} b {<ph id=\"0\" equiv=\"INTERPOLATION\"/>} c {pre <ph id=\"1\" equiv=\"INTERPOLATION_1\"/> post}} post-ICU</source>`,\n+              `        <source>pre-ICU <ph id=\"0\" equiv=\"ICU\" subFlows=\"SOME_ICU_ID\"/> post-ICU</source>`,\n+              `      </segment>`,\n+              `    </unit>`,\n+              `    <unit id=\"SOME_ICU_ID\">`,\n+              `      <segment>`,\n+              `        <source>{VAR_SELECT, select, a {a} b {<ph id=\"0\" equiv=\"INTERPOLATION\"/>} c {pre <ph id=\"1\" equiv=\"INTERPOLATION_1\"/> post}}</source>`,\n               `      </segment>`,\n               `    </unit>`,\n               `    <unit id=\"100001\">`,\n@@ -155,8 +163,9 @@ runInEachFileSystem(() => {\n               `      </segment>`,\n               `    </unit>`,\n               `  </file>`,\n-              `</xliff>\\n`,\n-            ].join('\\n'));\n+              `</xliff>`,\n+              ``,\n+            ]);\n           });\n \n           it('should convert a set of parsed messages into an XML string', () => {"
        }
    ],
    "stats": {
        "total": 148,
        "additions": 112,
        "deletions": 36
    }
}