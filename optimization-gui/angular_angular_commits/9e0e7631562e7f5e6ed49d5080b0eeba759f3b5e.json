{
    "author": "devversion",
    "message": "refactor(dev-infra): do not print git commands in silent mode (#38656)\n\nThe git client respects the `SpawnSyncOptions` when a command\nis executed. Currently it does not hide the command info\nmessages when commands are run in silent mode.\n\nWe fix this as part of this commit, so that the command info\nis only printed to `debug` if `stdio` is set to `ignore`.\n\nAdditonally, the github token is made public so that it can be\nused by commands if other repositories like forks are targeted.\n\nPR Close #38656",
    "sha": "9e0e7631562e7f5e6ed49d5080b0eeba759f3b5e",
    "files": [
        {
            "sha": "1322d62652497085863cd819d14db33523b2f3c0",
            "filename": "dev-infra/utils/git/index.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 11,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/9e0e7631562e7f5e6ed49d5080b0eeba759f3b5e/dev-infra%2Futils%2Fgit%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/9e0e7631562e7f5e6ed49d5080b0eeba759f3b5e/dev-infra%2Futils%2Fgit%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Findex.ts?ref=9e0e7631562e7f5e6ed49d5080b0eeba759f3b5e",
            "patch": "@@ -10,7 +10,7 @@ import * as Octokit from '@octokit/rest';\n import {spawnSync, SpawnSyncOptions, SpawnSyncReturns} from 'child_process';\n \n import {getConfig, getRepoBaseDir, NgDevConfig} from '../config';\n-import {info, yellow} from '../console';\n+import {debug, info, yellow} from '../console';\n import {GithubClient} from './github';\n import {getRepositoryGitUrl, GITHUB_TOKEN_GENERATE_URL, GITHUB_TOKEN_SETTINGS_URL} from './github-urls';\n \n@@ -47,26 +47,26 @@ export class GitClient {\n   /** Octokit request parameters object for targeting the configured remote. */\n   remoteParams = {owner: this.remoteConfig.owner, repo: this.remoteConfig.name};\n   /** Git URL that resolves to the configured repository. */\n-  repoGitUrl = getRepositoryGitUrl(this.remoteConfig, this._githubToken);\n+  repoGitUrl = getRepositoryGitUrl(this.remoteConfig, this.githubToken);\n   /** Instance of the authenticated Github octokit API. */\n-  github = new GithubClient(this._githubToken);\n+  github = new GithubClient(this.githubToken);\n \n   /** The OAuth scopes available for the provided Github token. */\n-  private _oauthScopes: Promise<string[]>|null = null;\n+  private _cachedOauthScopes: Promise<string[]>|null = null;\n   /**\n    * Regular expression that matches the provided Github token. Used for\n    * sanitizing the token from Git child process output.\n    */\n   private _githubTokenRegex: RegExp|null = null;\n \n   constructor(\n-      private _githubToken?: string, private _config: Pick<NgDevConfig, 'github'> = getConfig(),\n+      public githubToken?: string, private _config: Pick<NgDevConfig, 'github'> = getConfig(),\n       private _projectRoot = getRepoBaseDir()) {\n     // If a token has been specified (and is not empty), pass it to the Octokit API and\n     // also create a regular expression that can be used for sanitizing Git command output\n     // so that it does not print the token accidentally.\n-    if (_githubToken != null) {\n-      this._githubTokenRegex = new RegExp(_githubToken, 'g');\n+    if (githubToken != null) {\n+      this._githubTokenRegex = new RegExp(githubToken, 'g');\n     }\n   }\n \n@@ -87,10 +87,12 @@ export class GitClient {\n    * info failed commands.\n    */\n   runGraceful(args: string[], options: SpawnSyncOptions = {}): SpawnSyncReturns<string> {\n-    // To improve the infoging experience in case something fails, we print all executed\n-    // Git commands. Note that we do not want to print the token if is contained in the\n-    // command. It's common to share errors with others if the tool failed.\n-    info('Executing: git', this.omitGithubTokenFromMessage(args.join(' ')));\n+    // To improve the debugging experience in case something fails, we print all executed Git\n+    // commands unless the `stdio` is explicitly to `ignore` (which is equivalent to silent).\n+    // Note that we do not want to print the token if is contained in the command. It's common\n+    // to share errors with others if the tool failed, and we do not want to leak tokens.\n+    const printFn = options.stdio !== 'ignore' ? info : debug;\n+    printFn('Executing: git', this.omitGithubTokenFromMessage(args.join(' ')));\n \n     const result = spawnSync('git', args, {\n       cwd: this._projectRoot,"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 13,
        "deletions": 11
    }
}