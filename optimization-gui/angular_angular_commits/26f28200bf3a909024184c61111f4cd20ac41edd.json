{
    "author": "ajitsinghkaler",
    "message": "fix(common): do not round up fractions of a millisecond in `DatePipe` (#38009)\n\nCurrently, the `DatePipe` (via `formatDate()`) rounds fractions of a millisecond to the\nnearest millisecond. This can cause dates that are less than a millisecond before midnight\nto be incremented to the following day.\n\nThe [ECMAScript specification](https://www.ecma-international.org/ecma-262/5.1/#sec-15.9.1.11)\ndefines that `DateTime` milliseconds should always be rounded down, so that `999.9ms`\nbecomes `999ms`.\n\nThis change brings `formatDate()` and so `DatePipe` inline with the ECMAScript\nspecification.\n\nFixes #37989\n\nBREAKING CHANGE:\n\nWhen passing a date-time formatted string to the `DatePipe` in a format that contains\nfractions of a millisecond, the milliseconds will now always be rounded down rather than\nto the nearest millisecond.\n\nMost applications will not be affected by this change. If this is not the desired behaviour\nthen consider pre-processing the string to round the millisecond part before passing\nit to the `DatePipe`.\n\nPR Close #38009",
    "sha": "26f28200bf3a909024184c61111f4cd20ac41edd",
    "files": [
        {
            "sha": "c9ecd65c20a76557f5b45497a2a371bfeb646463",
            "filename": "packages/common/src/i18n/format_date.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/26f28200bf3a909024184c61111f4cd20ac41edd/packages%2Fcommon%2Fsrc%2Fi18n%2Fformat_date.ts",
            "raw_url": "https://github.com/angular/angular/raw/26f28200bf3a909024184c61111f4cd20ac41edd/packages%2Fcommon%2Fsrc%2Fi18n%2Fformat_date.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Fi18n%2Fformat_date.ts?ref=26f28200bf3a909024184c61111f4cd20ac41edd",
            "patch": "@@ -734,7 +734,10 @@ export function isoStringToDate(match: RegExpMatchArray): Date {\n   const h = Number(match[4] || 0) - tzHour;\n   const m = Number(match[5] || 0) - tzMin;\n   const s = Number(match[6] || 0);\n-  const ms = Math.round(parseFloat('0.' + (match[7] || 0)) * 1000);\n+  // The ECMAScript specification (https://www.ecma-international.org/ecma-262/5.1/#sec-15.9.1.11)\n+  // defines that `DateTime` milliseconds should always be rounded down, so that `999.9ms`\n+  // becomes `999ms`.\n+  const ms = Math.floor(parseFloat('0.' + (match[7] || 0)) * 1000);\n   timeSetter.call(date, h, m, s, ms);\n   return date;\n }"
        },
        {
            "sha": "21cf55ab7bb0a7ab2e23ecd4345ed95cc3a48b3e",
            "filename": "packages/common/test/pipes/date_pipe_spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/26f28200bf3a909024184c61111f4cd20ac41edd/packages%2Fcommon%2Ftest%2Fpipes%2Fdate_pipe_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/26f28200bf3a909024184c61111f4cd20ac41edd/packages%2Fcommon%2Ftest%2Fpipes%2Fdate_pipe_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Ftest%2Fpipes%2Fdate_pipe_spec.ts?ref=26f28200bf3a909024184c61111f4cd20ac41edd",
            "patch": "@@ -85,6 +85,13 @@ import {JitReflector} from '@angular/platform-browser-dynamic/src/compiler_refle\n            expect(pipe.transform('2012-12-30T00:00:00', 'w')).toEqual('1');\n            expect(pipe.transform('2012-12-31T00:00:00', 'w')).toEqual('1');\n          });\n+\n+\n+      it('should round milliseconds down to the nearest millisecond', () => {\n+        expect(pipe.transform('2020-08-01T23:59:59.999', 'yyyy-MM-dd')).toEqual('2020-08-01');\n+        expect(pipe.transform('2020-08-01T23:59:59.9999', 'yyyy-MM-dd, h:mm:ss SSS'))\n+            .toEqual('2020-08-01, 11:59:59 999');\n+      });\n     });\n   });\n }"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 11,
        "deletions": 1
    }
}