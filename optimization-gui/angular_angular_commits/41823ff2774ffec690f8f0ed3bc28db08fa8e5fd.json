{
    "author": "devversion",
    "message": "feat(dev-infra): add command for printing release train information (#42644)\n\nCurrently the active release trains are printed when a developer\nruns `ng-dev publish release`. This is not ideal because it requires\nthe developer to provide an OAuth token, to be on the next branch, and\nto have no uncommitted changes, while the actual release train\ninformation is not dependent on these checks.\n\nThis commit introduces a new command called `ng-dev release info` that\ncan be used to retrieve relase information without the aforementioned\nrequirements. Note that this command provides more detailed information\nabout release branches than the `ng-dev caretaker check` command (which\nalso requires on authentication as a side note). The `release info`\ncommand also prints active LTS branches for example.\n\nPR Close #42644",
    "sha": "41823ff2774ffec690f8f0ed3bc28db08fa8e5fd",
    "files": [
        {
            "sha": "76e8ae90bcdc57f06a8beef0340b49073022a1ca",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 98,
            "deletions": 73,
            "changes": 171,
            "blob_url": "https://github.com/angular/angular/blob/41823ff2774ffec690f8f0ed3bc28db08fa8e5fd/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/41823ff2774ffec690f8f0ed3bc28db08fa8e5fd/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=41823ff2774ffec690f8f0ed3bc28db08fa8e5fd",
            "patch": "@@ -5252,6 +5252,93 @@ const ReleaseBuildCommandModule = {\n     describe: 'Builds the release output for the current branch.',\n };\n \n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/**\n+ * Prints the active release trains to the console.\n+ * @params active Active release trains that should be printed.\n+ * @params config Release configuration used for querying NPM on published versions.\n+ */\n+function printActiveReleaseTrains(active, config) {\n+    return tslib.__awaiter(this, void 0, void 0, function* () {\n+        const { releaseCandidate, next, latest } = active;\n+        const isNextPublishedToNpm = yield isVersionPublishedToNpm(next.version, config);\n+        const nextTrainType = next.isMajor ? 'major' : 'minor';\n+        const ltsBranches = yield fetchLongTermSupportBranchesFromNpm(config);\n+        info();\n+        info(blue('Current version branches in the project:'));\n+        // Print information for release trains in the feature-freeze/release-candidate phase.\n+        if (releaseCandidate !== null) {\n+            const rcVersion = releaseCandidate.version;\n+            const rcTrainType = releaseCandidate.isMajor ? 'major' : 'minor';\n+            const rcTrainPhase = rcVersion.prerelease[0] === 'next' ? 'feature-freeze' : 'release-candidate';\n+            info(` • ${bold(releaseCandidate.branchName)} contains changes for an upcoming ` +\n+                `${rcTrainType} that is currently in ${bold(rcTrainPhase)} phase.`);\n+            info(`   Most recent pre-release for this branch is \"${bold(`v${rcVersion}`)}\".`);\n+        }\n+        // Print information about the release-train in the latest phase. i.e. the patch branch.\n+        info(` • ${bold(latest.branchName)} contains changes for the most recent patch.`);\n+        info(`   Most recent patch version for this branch is \"${bold(`v${latest.version}`)}\".`);\n+        // Print information about the release-train in the next phase.\n+        info(` • ${bold(next.branchName)} contains changes for a ${nextTrainType} ` +\n+            `currently in active development.`);\n+        // Note that there is a special case for versions in the next release-train. The version in\n+        // the next branch is not always published to NPM. This can happen when we recently branched\n+        // off for a feature-freeze release-train. More details are in the next pre-release action.\n+        if (isNextPublishedToNpm) {\n+            info(`   Most recent pre-release version for this branch is \"${bold(`v${next.version}`)}\".`);\n+        }\n+        else {\n+            info(`   Version is currently set to \"${bold(`v${next.version}`)}\", but has not been ` +\n+                `published yet.`);\n+        }\n+        // If no release-train in release-candidate or feature-freeze phase is active,\n+        // we print a message as last bullet point to make this clear.\n+        if (releaseCandidate === null) {\n+            info(' • No release-candidate or feature-freeze branch currently active.');\n+        }\n+        info();\n+        info(blue('Current active LTS version branches:'));\n+        // Print all active LTS branches (each branch as own bullet point).\n+        if (ltsBranches.active.length !== 0) {\n+            for (const ltsBranch of ltsBranches.active) {\n+                info(` • ${bold(ltsBranch.name)} is currently in active long-term support phase.`);\n+                info(`   Most recent patch version for this branch is \"${bold(`v${ltsBranch.version}`)}\".`);\n+            }\n+        }\n+        info();\n+    });\n+}\n+\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+/** Yargs command handler for printing release information. */\n+function handler$8() {\n+    return tslib.__awaiter(this, void 0, void 0, function* () {\n+        const git = GitClient.get();\n+        const gitRepoWithApi = Object.assign({ api: git.github }, git.remoteConfig);\n+        const releaseTrains = yield fetchActiveReleaseTrains(gitRepoWithApi);\n+        // Print the active release trains.\n+        yield printActiveReleaseTrains(releaseTrains, getReleaseConfig());\n+    });\n+}\n+/** CLI command module for retrieving release information. */\n+const ReleaseInfoCommandModule = {\n+    handler: handler$8,\n+    command: 'info',\n+    describe: 'Prints active release trains to the console.',\n+};\n+\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -5657,7 +5744,7 @@ function builder$8(argv) {\n     });\n }\n /** Yargs command handler for generating release notes. */\n-function handler$8({ releaseVersion, from, to, outFile, type }) {\n+function handler$9({ releaseVersion, from, to, outFile, type }) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n         // Since `yargs` evaluates defaults even if a value as been provided, if no value is provided to\n         // the handler, the latest semver tag on the branch is used.\n@@ -5679,7 +5766,7 @@ function handler$8({ releaseVersion, from, to, outFile, type }) {\n /** CLI command module for generating release notes. */\n const ReleaseNotesCommandModule = {\n     builder: builder$8,\n-    handler: handler$8,\n+    handler: handler$9,\n     command: 'notes',\n     describe: 'Generate release notes',\n };\n@@ -5856,69 +5943,6 @@ function npmLogout(registryUrl) {\n     });\n }\n \n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-/**\n- * Prints the active release trains to the console.\n- * @params active Active release trains that should be printed.\n- * @params config Release configuration used for querying NPM on published versions.\n- */\n-function printActiveReleaseTrains(active, config) {\n-    return tslib.__awaiter(this, void 0, void 0, function* () {\n-        const { releaseCandidate, next, latest } = active;\n-        const isNextPublishedToNpm = yield isVersionPublishedToNpm(next.version, config);\n-        const nextTrainType = next.isMajor ? 'major' : 'minor';\n-        const ltsBranches = yield fetchLongTermSupportBranchesFromNpm(config);\n-        info();\n-        info(blue('Current version branches in the project:'));\n-        // Print information for release trains in the feature-freeze/release-candidate phase.\n-        if (releaseCandidate !== null) {\n-            const rcVersion = releaseCandidate.version;\n-            const rcTrainType = releaseCandidate.isMajor ? 'major' : 'minor';\n-            const rcTrainPhase = rcVersion.prerelease[0] === 'next' ? 'feature-freeze' : 'release-candidate';\n-            info(` • ${bold(releaseCandidate.branchName)} contains changes for an upcoming ` +\n-                `${rcTrainType} that is currently in ${bold(rcTrainPhase)} phase.`);\n-            info(`   Most recent pre-release for this branch is \"${bold(`v${rcVersion}`)}\".`);\n-        }\n-        // Print information about the release-train in the latest phase. i.e. the patch branch.\n-        info(` • ${bold(latest.branchName)} contains changes for the most recent patch.`);\n-        info(`   Most recent patch version for this branch is \"${bold(`v${latest.version}`)}\".`);\n-        // Print information about the release-train in the next phase.\n-        info(` • ${bold(next.branchName)} contains changes for a ${nextTrainType} ` +\n-            `currently in active development.`);\n-        // Note that there is a special case for versions in the next release-train. The version in\n-        // the next branch is not always published to NPM. This can happen when we recently branched\n-        // off for a feature-freeze release-train. More details are in the next pre-release action.\n-        if (isNextPublishedToNpm) {\n-            info(`   Most recent pre-release version for this branch is \"${bold(`v${next.version}`)}\".`);\n-        }\n-        else {\n-            info(`   Version is currently set to \"${bold(`v${next.version}`)}\", but has not been ` +\n-                `published yet.`);\n-        }\n-        // If no release-train in release-candidate or feature-freeze phase is active,\n-        // we print a message as last bullet point to make this clear.\n-        if (releaseCandidate === null) {\n-            info(' • No release-candidate or feature-freeze branch currently active.');\n-        }\n-        info();\n-        info(blue('Current active LTS version branches:'));\n-        // Print all active LTS branches (each branch as own bullet point).\n-        if (ltsBranches.active.length !== 0) {\n-            for (const ltsBranch of ltsBranches.active) {\n-                info(` • ${bold(ltsBranch.name)} is currently in active long-term support phase.`);\n-                info(`   Most recent patch version for this branch is \"${bold(`v${ltsBranch.version}`)}\".`);\n-            }\n-        }\n-        info();\n-    });\n-}\n-\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n@@ -7308,7 +7332,7 @@ function builder$9(argv) {\n     return addGithubTokenOption(argv);\n }\n /** Yargs command handler for staging a release. */\n-function handler$9() {\n+function handler$a() {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n         const git = GitClient.get();\n         const config = getConfig();\n@@ -7334,7 +7358,7 @@ function handler$9() {\n /** CLI command module for publishing a release. */\n const ReleasePublishCommandModule = {\n     builder: builder$9,\n-    handler: handler$9,\n+    handler: handler$a,\n     command: 'publish',\n     describe: 'Publish new releases and configure version branches.',\n };\n@@ -7360,7 +7384,7 @@ function builder$a(args) {\n     });\n }\n /** Yargs command handler for building a release. */\n-function handler$a(args) {\n+function handler$b(args) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n         const { targetVersion: rawVersion, tagName } = args;\n         const { npmPackages, publishRegistry } = getReleaseConfig();\n@@ -7393,7 +7417,7 @@ function handler$a(args) {\n /** CLI command module for setting an NPM dist tag. */\n const ReleaseSetDistTagCommand = {\n     builder: builder$a,\n-    handler: handler$a,\n+    handler: handler$b,\n     command: 'set-dist-tag <tag-name> <target-version>',\n     describe: 'Sets a given NPM dist tag for all release packages.',\n };\n@@ -7480,15 +7504,15 @@ function builder$b(args) {\n         choices: ['snapshot', 'release']\n     });\n }\n-function handler$b({ mode }) {\n+function handler$c({ mode }) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n         buildEnvStamp(mode);\n     });\n }\n /** CLI command module for building the environment stamp. */\n const BuildEnvStampCommand = {\n     builder: builder$b,\n-    handler: handler$b,\n+    handler: handler$c,\n     command: 'build-env-stamp',\n     describe: 'Build the environment stamping information',\n };\n@@ -7500,6 +7524,7 @@ function buildReleaseParser(localYargs) {\n         .demandCommand()\n         .command(ReleasePublishCommandModule)\n         .command(ReleaseBuildCommandModule)\n+        .command(ReleaseInfoCommandModule)\n         .command(ReleaseSetDistTagCommand)\n         .command(BuildEnvStampCommand)\n         .command(ReleaseNotesCommandModule);\n@@ -7929,7 +7954,7 @@ function builder$c(argv) {\n     });\n }\n /** Yargs command handler for the command. */\n-function handler$c({ projectRoot }) {\n+function handler$d({ projectRoot }) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n         try {\n             if (!fs.lstatSync(projectRoot).isDirectory()) {\n@@ -7957,7 +7982,7 @@ function handler$c({ projectRoot }) {\n /** CLI command module. */\n const BuildAndLinkCommandModule = {\n     builder: builder$c,\n-    handler: handler$c,\n+    handler: handler$d,\n     command: 'build-and-link <projectRoot>',\n     describe: 'Builds the release output, registers the outputs as linked, and links via yarn to the provided project',\n };"
        },
        {
            "sha": "9dc9d941b49440b7eec4ce81f7b8bda6778416ce",
            "filename": "dev-infra/release/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/41823ff2774ffec690f8f0ed3bc28db08fa8e5fd/dev-infra%2Frelease%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/41823ff2774ffec690f8f0ed3bc28db08fa8e5fd/dev-infra%2Frelease%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2FBUILD.bazel?ref=41823ff2774ffec690f8f0ed3bc28db08fa8e5fd",
            "patch": "@@ -9,6 +9,7 @@ ts_library(\n     visibility = [\"//dev-infra:__subpackages__\"],\n     deps = [\n         \"//dev-infra/release/build\",\n+        \"//dev-infra/release/info\",\n         \"//dev-infra/release/notes\",\n         \"//dev-infra/release/publish\",\n         \"//dev-infra/release/set-dist-tag\","
        },
        {
            "sha": "7bcffa031231478ec423c85c6b28663095493fc6",
            "filename": "dev-infra/release/cli.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/41823ff2774ffec690f8f0ed3bc28db08fa8e5fd/dev-infra%2Frelease%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/41823ff2774ffec690f8f0ed3bc28db08fa8e5fd/dev-infra%2Frelease%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fcli.ts?ref=41823ff2774ffec690f8f0ed3bc28db08fa8e5fd",
            "patch": "@@ -8,6 +8,7 @@\n import * as yargs from 'yargs';\n \n import {ReleaseBuildCommandModule} from './build/cli';\n+import {ReleaseInfoCommandModule} from './info/cli';\n import {ReleaseNotesCommandModule} from './notes/cli';\n import {ReleasePublishCommandModule} from './publish/cli';\n import {ReleaseSetDistTagCommand} from './set-dist-tag/cli';\n@@ -20,6 +21,7 @@ export function buildReleaseParser(localYargs: yargs.Argv) {\n       .demandCommand()\n       .command(ReleasePublishCommandModule)\n       .command(ReleaseBuildCommandModule)\n+      .command(ReleaseInfoCommandModule)\n       .command(ReleaseSetDistTagCommand)\n       .command(BuildEnvStampCommand)\n       .command(ReleaseNotesCommandModule);"
        },
        {
            "sha": "193ef598b721ef713f58ffddda3c9c5e956aeda7",
            "filename": "dev-infra/release/info/BUILD.bazel",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/41823ff2774ffec690f8f0ed3bc28db08fa8e5fd/dev-infra%2Frelease%2Finfo%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/41823ff2774ffec690f8f0ed3bc28db08fa8e5fd/dev-infra%2Frelease%2Finfo%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Finfo%2FBUILD.bazel?ref=41823ff2774ffec690f8f0ed3bc28db08fa8e5fd",
            "patch": "@@ -0,0 +1,15 @@\n+load(\"@npm//@bazel/typescript:index.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"info\",\n+    srcs = [\"cli.ts\"],\n+    module_name = \"@angular/dev-infra-private/release/info\",\n+    visibility = [\"//dev-infra:__subpackages__\"],\n+    deps = [\n+        \"//dev-infra/release/config\",\n+        \"//dev-infra/release/versioning\",\n+        \"//dev-infra/utils\",\n+        \"@npm//@types/node\",\n+        \"@npm//@types/yargs\",\n+    ],\n+)"
        },
        {
            "sha": "966f4d0c25f0aefaad3b3dc5d7c93b9e58972648",
            "filename": "dev-infra/release/info/cli.ts",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/41823ff2774ffec690f8f0ed3bc28db08fa8e5fd/dev-infra%2Frelease%2Finfo%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/41823ff2774ffec690f8f0ed3bc28db08fa8e5fd/dev-infra%2Frelease%2Finfo%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Finfo%2Fcli.ts?ref=41823ff2774ffec690f8f0ed3bc28db08fa8e5fd",
            "patch": "@@ -0,0 +1,32 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {CommandModule} from 'yargs';\n+\n+import {info} from '../../utils/console';\n+import {GitClient} from '../../utils/git/git-client';\n+import {getReleaseConfig} from '../config/index';\n+import {fetchActiveReleaseTrains} from '../versioning/active-release-trains';\n+import {printActiveReleaseTrains} from '../versioning/print-active-trains';\n+\n+/** Yargs command handler for printing release information. */\n+async function handler() {\n+  const git = GitClient.get();\n+  const gitRepoWithApi = {api: git.github, ...git.remoteConfig};\n+  const releaseTrains = await fetchActiveReleaseTrains(gitRepoWithApi);\n+\n+  // Print the active release trains.\n+  await printActiveReleaseTrains(releaseTrains, getReleaseConfig());\n+}\n+\n+/** CLI command module for retrieving release information. */\n+export const ReleaseInfoCommandModule: CommandModule = {\n+  handler,\n+  command: 'info',\n+  describe: 'Prints active release trains to the console.',\n+};"
        }
    ],
    "stats": {
        "total": 221,
        "additions": 148,
        "deletions": 73
    }
}