{
    "author": "spike-rabbit",
    "message": "feat(service-worker): `SwUpdate#activeUpdate` and `SwUpdate#checkForUpdate` should have a meaningful outcome (#43668)\n\nPreviously `activateUpdate` and `checkForUpdate` returned `Promise<void>`, which did not provide any\ninformation of the actual outcome of the operation. Developers needed to subscribe to a\ncorresponding observable to obtain the outcome.\n\nWith this commit `SwUpdate#activateUpdate` will return `Promise<boolean>` which resolves to `true` if\nan update was activated, to `false` if no new version is available and rejects in case of any error.\n`SwUpdate#checkForUpdate` also returns a `Promise<boolean>` which resolves to `true` if an update is available, to `false` if no update was found and rejects in case of any error.\n\nCloses #39840\n\nBREAKING CHANGE: The return type of `SwUpdate#activateUpdate` and `SwUpdate#checkForUpdate` changed to `Promise<boolean>`.\n\nAlthough unlikely, it is possible that this change will cause TypeScript type-checking to fail in\nsome cases. If necessary, update your types to account for the new\nreturn type.\n\nDEPRECATED: The `SwUpdate#activated` observable is deprecated.\n\nThe `SwUpdate#activated` observable only emits values as a direct response to calling\n`SwUpdate#activateUpdate()` and was only useful for determining whether the call resulted in an\nupdate or not. Now, the return value of `SwUpdate#activateUpdate()` can be used to determine the\noutcome of the operation and therefore using `SwUpdate#activated` does not offer any benefit.\n\nPR Close #43668",
    "sha": "59225f5586f1319a47768cef2e3325d7ab6940af",
    "files": [
        {
            "sha": "6ffe23332c882519b90dfc3795d5d626f5e2e548",
            "filename": "aio/content/guide/deprecations.md",
            "status": "modified",
            "additions": 38,
            "deletions": 29,
            "changes": 67,
            "blob_url": "https://github.com/angular/angular/blob/59225f5586f1319a47768cef2e3325d7ab6940af/aio%2Fcontent%2Fguide%2Fdeprecations.md",
            "raw_url": "https://github.com/angular/angular/raw/59225f5586f1319a47768cef2e3325d7ab6940af/aio%2Fcontent%2Fguide%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fguide%2Fdeprecations.md?ref=59225f5586f1319a47768cef2e3325d7ab6940af",
            "patch": "@@ -33,37 +33,38 @@ v12 - v15\n v13 -> v16\n -->\n \n-| Area                    | API or Feature                                                                                | May be removed in     |\n-|:---                     |:---                                                                                           |:---                   |\n-| `@angular/common`       | [`ReflectiveInjector`](#reflectiveinjector)                                                   | <!--v8--> v11         |\n-| `@angular/common`       | [`CurrencyPipe` - `DEFAULT_CURRENCY_CODE`](api/common/CurrencyPipe#currency-code-deprecation) | <!--v9--> v11         |\n-| `@angular/common/http`  | [`XhrFactory`](api/common/http/XhrFactory)                                                    | <!--v12--> v15        |\n-| `@angular/core`         | [`DefaultIterableDiffer`](#core)                                                              | <!--v7--> v11         |\n-| `@angular/core`         | [`ReflectiveKey`](#core)                                                                      | <!--v8--> v11         |\n-| `@angular/core`         | [`RenderComponentType`](#core)                                                                | <!--v7--> v11         |\n-| `@angular/core`         | [Factory-based signature of `ApplicationRef.bootstrap`](#core)                                                                       | <!--v13--> v15        |\n-| `@angular/core`         | [`PlatformRef.bootstrapModuleFactory`](#core)                                                                       | <!--v13--> v15        |\n+| Area                      | API or Feature                                                                                | May be removed in     |\n+|:---                       |:---                                                                                           |:---                   |\n+| `@angular/common`         | [`ReflectiveInjector`](#reflectiveinjector)                                                   | <!--v8--> v11         |\n+| `@angular/common`         | [`CurrencyPipe` - `DEFAULT_CURRENCY_CODE`](api/common/CurrencyPipe#currency-code-deprecation) | <!--v9--> v11         |\n+| `@angular/common/http`    | [`XhrFactory`](api/common/http/XhrFactory)                                                    | <!--v12--> v15        |\n+| `@angular/core`           | [`DefaultIterableDiffer`](#core)                                                              | <!--v7--> v11         |\n+| `@angular/core`           | [`ReflectiveKey`](#core)                                                                      | <!--v8--> v11         |\n+| `@angular/core`           | [`RenderComponentType`](#core)                                                                | <!--v7--> v11         |\n+| `@angular/core`           | [Factory-based signature of `ApplicationRef.bootstrap`](#core)                                | <!--v13--> v15        |\n+| `@angular/core`           | [`PlatformRef.bootstrapModuleFactory`](#core)                                                 | <!--v13--> v15        |\n | `@angular/core`         | [`getModuleFactory`](#core)                                                                       | <!--v13--> v16        |\n-| `@angular/forms`        | [`ngModel` with reactive forms](#ngmodel-reactive)                                            | <!--v6--> v11         |\n-| `@angular/upgrade`      | [`@angular/upgrade`](#upgrade)                                                                | <!--v8--> v11         |\n-| `@angular/upgrade`      | [`getAngularLib`](#upgrade-static)                                                            | <!--v8--> v11         |\n-| `@angular/upgrade`      | [`setAngularLib`](#upgrade-static)                                                            | <!--v8--> v11         |\n-| template syntax         | [`<template>`](#template-tag)                                                                 | <!--v7--> v11         |\n-| polyfills               | [reflect-metadata](#reflect-metadata)                                                         | <!--v8--> v11         |\n-| npm package format      | [`esm5` and `fesm5` entry-points in @angular/* npm packages](guide/deprecations#esm5-fesm5)   | <!-- v9 --> v11       |\n-| `@angular/compiler-cli` | [Input setter coercion](#input-setter-coercion)                                               | <!--v13--> v15        |\n+| `@angular/forms`          | [`ngModel` with reactive forms](#ngmodel-reactive)                                            | <!--v6--> v11         |\n+| `@angular/upgrade`        | [`@angular/upgrade`](#upgrade)                                                                | <!--v8--> v11         |\n+| `@angular/upgrade`        | [`getAngularLib`](#upgrade-static)                                                            | <!--v8--> v11         |\n+| `@angular/upgrade`        | [`setAngularLib`](#upgrade-static)                                                            | <!--v8--> v11         |\n+| template syntax           | [`<template>`](#template-tag)                                                                 | <!--v7--> v11         |\n+| polyfills                 | [reflect-metadata](#reflect-metadata)                                                         | <!--v8--> v11         |\n+| npm package format        | [`esm5` and `fesm5` entry-points in @angular/* npm packages](guide/deprecations#esm5-fesm5)   | <!-- v9 --> v11       |\n+| `@angular/compiler-cli`   | [Input setter coercion](#input-setter-coercion)                                               | <!--v13--> v15        |\n | `@angular/compiler-cli` | [`fullTemplateTypeCheck`](#full-template-type-check)                                          | <!--v13--> v15        |\n-| `@angular/core`         | [`defineInjectable`](#core)                                                                   | <!--v8--> v11         |\n-| `@angular/core`         | [`entryComponents`](api/core/NgModule#entryComponents)                                        | <!--v9--> v11         |\n-| `@angular/core`         | [`ANALYZE_FOR_ENTRY_COMPONENTS`](api/core/ANALYZE_FOR_ENTRY_COMPONENTS)                       | <!--v9--> v11         |\n-| `@angular/core`         | [Factory-based signature of `ViewContainerRef.createComponent`](api/core/ViewContainerRef#createComponent)                       | <!--v13--> v15         |\n-| `@angular/core/testing` | [`TestBed.get`](#testing)                                                                     | <!--v9--> v12         |\n-| `@angular/core/testing` | [`async`](#testing)                                                                           | <!--v9--> v12         |\n-| `@angular/core/testing` | [`aotSummaries` argument in `TestBed.initTestEnvironment`](#testing)                                                                           | <!--v13--> v14         |\n-| `@angular/core/testing` | [`aotSummaries` field of the `TestModuleMetadata` type](#testing)                                                                           | <!--v13--> v14         |\n-| `@angular/forms`        | [`FormBuilder.group` legacy options parameter](api/forms/FormBuilder#group)                   | <!--v11--> v14        |\n-| `@angular/router`       | [`ActivatedRoute` params and `queryParams` properties](#activatedroute-props)                 | unspecified           |\n-| template syntax         | [`/deep/`, `>>>`, and `::ng-deep`](#deep-component-style-selector)                            | <!--v7--> unspecified |\n+| `@angular/core`           | [`defineInjectable`](#core)                                                                   | <!--v8--> v11         |\n+| `@angular/core`           | [`entryComponents`](api/core/NgModule#entryComponents)                                        | <!--v9--> v11         |\n+| `@angular/core`           | [`ANALYZE_FOR_ENTRY_COMPONENTS`](api/core/ANALYZE_FOR_ENTRY_COMPONENTS)                       | <!--v9--> v11         |\n+| `@angular/core`           | [Factory-based signature of `ViewContainerRef.createComponent`](api/core/ViewContainerRef#createComponent) | <!--v13--> v15         |\n+| `@angular/core/testing`   | [`TestBed.get`](#testing)                                                                     | <!--v9--> v12         |\n+| `@angular/core/testing`   | [`async`](#testing)                                                                           | <!--v9--> v12         |\n+| `@angular/core/testing`   | [`aotSummaries` argument in `TestBed.initTestEnvironment`](#testing)                          | <!--v13--> v14        |\n+| `@angular/core/testing`   | [`aotSummaries` field of the `TestModuleMetadata` type](#testing)                             | <!--v13--> v14        |\n+| `@angular/forms`          | [`FormBuilder.group` legacy options parameter](api/forms/FormBuilder#group)                   | <!--v11--> v14        |\n+| `@angular/router`         | [`ActivatedRoute` params and `queryParams` properties](#activatedroute-props)                 | unspecified           |\n+| `@angular/service-worker` | [`SwUpdate#activated`](api/service-worker/SwUpdate#activated)                                 | <!--v13--> v16        |\n+| template syntax           | [`/deep/`, `>>>`, and `::ng-deep`](#deep-component-style-selector)                            | <!--v7--> unspecified |\n | template syntax         | [`bind-`, `on-`, `bindon-`, and `ref-`](#bind-syntax)                            | <!--v13--> v15 |\n \n For information about Angular CDK and Angular Material deprecations, see the [changelog](https://github.com/angular/components/blob/master/CHANGELOG.md).\n@@ -133,6 +134,14 @@ This section contains a complete list all of the currently-deprecated APIs, with\n | [`ngModel` with reactive forms](#ngmodel-reactive)                          | [`FormControlDirective`](api/forms/FormControlDirective)                     | v6                    | none  |\n | [`FormBuilder.group` legacy options parameter](api/forms/FormBuilder#group) | [`AbstractControlOptions` parameter value](api/forms/AbstractControlOptions) | v11                   | none  |\n \n+{@a service-worker}\n+\n+### @angular/service-worker\n+\n+| API                                                           | Replacement                                                                            | Deprecation announced    | Notes\n+|:---                                                           |:---                                                                                    |:---                      |:---\n+| [`SwUpdate#activated`](api/service-worker/SwUpdate#activated) | [`SwUpdate#activateUpdate()` return value](api/service-worker/SwUpdate#activateUpdate) | v13                      | The return value of `SwUpdate#activateUpdate()` indicates whether an update was successfully activated. |\n+\n {@a upgrade}\n \n ### @angular/upgrade"
        },
        {
            "sha": "d60576ea6ce81e1c08ed3cc45ce98063f20ab6e4",
            "filename": "aio/content/guide/service-worker-communications.md",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/59225f5586f1319a47768cef2e3325d7ab6940af/aio%2Fcontent%2Fguide%2Fservice-worker-communications.md",
            "raw_url": "https://github.com/angular/angular/raw/59225f5586f1319a47768cef2e3325d7ab6940af/aio%2Fcontent%2Fguide%2Fservice-worker-communications.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fguide%2Fservice-worker-communications.md?ref=59225f5586f1319a47768cef2e3325d7ab6940af",
            "patch": "@@ -37,7 +37,8 @@ Do this with the `checkForUpdate()` method:\n \n <code-example path=\"service-worker-getting-started/src/app/check-for-update.service.ts\" header=\"check-for-update.service.ts\"></code-example>\n \n-This method returns a `Promise` which indicates that the update check completed successfully, though it does not indicate whether an update was discovered as a result of the check. Even if one is found, the service worker must still successfully download the changed files, which can fail. If successful, the `available` event indicates availability of a new version of the application.\n+This method returns a `Promise<boolean>` which indicates if an update is available for activation.\n+The check might fail, which will cause a rejection of the `Promise`.\n \n <div class=\"alert is-important\">\n "
        },
        {
            "sha": "9e9e4449ac22571603c7d08f546501ea29348452",
            "filename": "goldens/public-api/service-worker/service-worker.md",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/59225f5586f1319a47768cef2e3325d7ab6940af/goldens%2Fpublic-api%2Fservice-worker%2Fservice-worker.md",
            "raw_url": "https://github.com/angular/angular/raw/59225f5586f1319a47768cef2e3325d7ab6940af/goldens%2Fpublic-api%2Fservice-worker%2Fservice-worker.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fservice-worker%2Fservice-worker.md?ref=59225f5586f1319a47768cef2e3325d7ab6940af",
            "patch": "@@ -51,12 +51,11 @@ export abstract class SwRegistrationOptions {\n // @public\n export class SwUpdate {\n     constructor(sw: NgswCommChannel);\n+    // @deprecated\n     readonly activated: Observable<UpdateActivatedEvent>;\n-    // (undocumented)\n-    activateUpdate(): Promise<void>;\n+    activateUpdate(): Promise<boolean>;\n     readonly available: Observable<UpdateAvailableEvent>;\n-    // (undocumented)\n-    checkForUpdate(): Promise<void>;\n+    checkForUpdate(): Promise<boolean>;\n     get isEnabled(): boolean;\n     readonly unrecoverable: Observable<UnrecoverableStateEvent>;\n     // (undocumented)\n@@ -73,7 +72,7 @@ export interface UnrecoverableStateEvent {\n     type: 'UNRECOVERABLE_STATE';\n }\n \n-// @public\n+// @public @deprecated\n export interface UpdateActivatedEvent {\n     // (undocumented)\n     current: {"
        },
        {
            "sha": "3906c54c586d88f4c320b9dcb1e43449ad39dd39",
            "filename": "packages/service-worker/src/low_level.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 12,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/59225f5586f1319a47768cef2e3325d7ab6940af/packages%2Fservice-worker%2Fsrc%2Flow_level.ts",
            "raw_url": "https://github.com/angular/angular/raw/59225f5586f1319a47768cef2e3325d7ab6940af/packages%2Fservice-worker%2Fsrc%2Flow_level.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fsrc%2Flow_level.ts?ref=59225f5586f1319a47768cef2e3325d7ab6940af",
            "patch": "@@ -69,12 +69,14 @@ export interface TypedEvent {\n   type: string;\n }\n \n-interface StatusEvent {\n-  type: 'STATUS';\n+type OperationCompletedEvent = {\n+  type: 'OPERATION_COMPLETED'; nonce: number; result: boolean;\n+}|{\n+  type: 'OPERATION_COMPLETED';\n   nonce: number;\n-  status: boolean;\n-  error?: string;\n-}\n+  result?: undefined;\n+  error: string;\n+};\n \n \n function errorObservable(message: string): Observable<any> {\n@@ -127,10 +129,11 @@ export class NgswCommChannel {\n         .then(() => undefined);\n   }\n \n-  postMessageWithStatus(type: string, payload: Object, nonce: number): Promise<void> {\n-    const waitForStatus = this.waitForStatus(nonce);\n+  postMessageWithOperation(type: string, payload: Object, operationNonce: number):\n+      Promise<boolean> {\n+    const waitForOperationCompleted = this.waitForOperationCompleted(operationNonce);\n     const postMessage = this.postMessage(type, payload);\n-    return Promise.all([waitForStatus, postMessage]).then(() => undefined);\n+    return Promise.all([postMessage, waitForOperationCompleted]).then(([, result]) => result);\n   }\n \n   generateNonce(): number {\n@@ -146,11 +149,11 @@ export class NgswCommChannel {\n     return this.eventsOfType(type).pipe(take(1));\n   }\n \n-  waitForStatus(nonce: number): Promise<void> {\n-    return this.eventsOfType<StatusEvent>('STATUS')\n+  waitForOperationCompleted(nonce: number): Promise<boolean> {\n+    return this.eventsOfType<OperationCompletedEvent>('OPERATION_COMPLETED')\n         .pipe(filter(event => event.nonce === nonce), take(1), map(event => {\n-                if (event.status) {\n-                  return undefined;\n+                if (event.result !== undefined) {\n+                  return event.result;\n                 }\n                 throw new Error(event.error!);\n               }))"
        },
        {
            "sha": "21b12e3097e2be522c0e159960f83f8ddf4838c8",
            "filename": "packages/service-worker/src/update.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 6,
            "changes": 34,
            "blob_url": "https://github.com/angular/angular/blob/59225f5586f1319a47768cef2e3325d7ab6940af/packages%2Fservice-worker%2Fsrc%2Fupdate.ts",
            "raw_url": "https://github.com/angular/angular/raw/59225f5586f1319a47768cef2e3325d7ab6940af/packages%2Fservice-worker%2Fsrc%2Fupdate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fsrc%2Fupdate.ts?ref=59225f5586f1319a47768cef2e3325d7ab6940af",
            "patch": "@@ -30,6 +30,9 @@ export class SwUpdate {\n \n   /**\n    * Emits an `UpdateActivatedEvent` event whenever the app has been updated to a new version.\n+   *\n+   * @deprecated Use the return value of {@link SwUpdate#activateUpdate} instead.\n+   *\n    */\n   readonly activated: Observable<UpdateActivatedEvent>;\n \n@@ -60,19 +63,38 @@ export class SwUpdate {\n     this.unrecoverable = this.sw.eventsOfType<UnrecoverableStateEvent>('UNRECOVERABLE_STATE');\n   }\n \n-  checkForUpdate(): Promise<void> {\n+  /**\n+   * Checks for an update and waits until the new version is downloaded from the server and ready\n+   * for activation.\n+   *\n+   * @returns a promise that\n+   * - resolves to `true` if a new version was found and is ready to be activated.\n+   * - resolves to `false` if no new version was found\n+   * - rejects if any error occurs\n+   */\n+  checkForUpdate(): Promise<boolean> {\n     if (!this.sw.isEnabled) {\n       return Promise.reject(new Error(ERR_SW_NOT_SUPPORTED));\n     }\n-    const statusNonce = this.sw.generateNonce();\n-    return this.sw.postMessageWithStatus('CHECK_FOR_UPDATES', {statusNonce}, statusNonce);\n+    const nonce = this.sw.generateNonce();\n+    return this.sw.postMessageWithOperation('CHECK_FOR_UPDATES', {nonce}, nonce);\n   }\n \n-  activateUpdate(): Promise<void> {\n+  /**\n+   * Updates the current client (i.e. browser tab) to the latest version that is ready for\n+   * activation.\n+   *\n+   * @returns a promise that\n+   *  - resolves to `true` if an update was activated successfully\n+   *  - resolves to `false` if no update was available (for example, the client was already on the\n+   *    latest version).\n+   *  - rejects if any error occurs\n+   */\n+  activateUpdate(): Promise<boolean> {\n     if (!this.sw.isEnabled) {\n       return Promise.reject(new Error(ERR_SW_NOT_SUPPORTED));\n     }\n-    const statusNonce = this.sw.generateNonce();\n-    return this.sw.postMessageWithStatus('ACTIVATE_UPDATE', {statusNonce}, statusNonce);\n+    const nonce = this.sw.generateNonce();\n+    return this.sw.postMessageWithOperation('ACTIVATE_UPDATE', {nonce}, nonce);\n   }\n }"
        },
        {
            "sha": "24760fb9b877086e84001a4de4171bbce4cba986",
            "filename": "packages/service-worker/test/comm_spec.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 17,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/59225f5586f1319a47768cef2e3325d7ab6940af/packages%2Fservice-worker%2Ftest%2Fcomm_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/59225f5586f1319a47768cef2e3325d7ab6940af/packages%2Fservice-worker%2Ftest%2Fcomm_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Ftest%2Fcomm_spec.ts?ref=59225f5586f1319a47768cef2e3325d7ab6940af",
            "patch": "@@ -460,33 +460,27 @@ import {MockPushManager, MockPushSubscription, MockServiceWorkerContainer, MockS\n           },\n         });\n       });\n-      it('activates updates when requested', done => {\n-        mock.messages.subscribe((msg: {action: string, statusNonce: number}) => {\n+      it('activates updates when requested', async () => {\n+        mock.messages.subscribe((msg: {action: string, nonce: number}) => {\n           expect(msg.action).toEqual('ACTIVATE_UPDATE');\n           mock.sendMessage({\n-            type: 'STATUS',\n-            nonce: msg.statusNonce,\n-            status: true,\n+            type: 'OPERATION_COMPLETED',\n+            nonce: msg.nonce,\n+            result: true,\n           });\n         });\n-        update.activateUpdate().then(() => done()).catch(err => done.fail(err));\n+        expect(await update.activateUpdate()).toBeTruthy();\n       });\n-      it('reports activation failure when requested', done => {\n-        mock.messages.subscribe((msg: {action: string, statusNonce: number}) => {\n+      it('reports activation failure when requested', async () => {\n+        mock.messages.subscribe((msg: {action: string, nonce: number}) => {\n           expect(msg.action).toEqual('ACTIVATE_UPDATE');\n           mock.sendMessage({\n-            type: 'STATUS',\n-            nonce: msg.statusNonce,\n-            status: false,\n+            type: 'OPERATION_COMPLETED',\n+            nonce: msg.nonce,\n             error: 'Failed to activate',\n           });\n         });\n-        update.activateUpdate()\n-            .catch(err => {\n-              expect(err.message).toEqual('Failed to activate');\n-            })\n-            .then(() => done())\n-            .catch(err => done.fail(err));\n+        await expectAsync(update.activateUpdate()).toBeRejectedWithError('Failed to activate');\n       });\n       it('is injectable', () => {\n         TestBed.configureTestingModule({"
        },
        {
            "sha": "2e3283fcb3c3af8e31bfea8b1ea219a3c66a7173",
            "filename": "packages/service-worker/worker/src/driver.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 12,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/59225f5586f1319a47768cef2e3325d7ab6940af/packages%2Fservice-worker%2Fworker%2Fsrc%2Fdriver.ts",
            "raw_url": "https://github.com/angular/angular/raw/59225f5586f1319a47768cef2e3325d7ab6940af/packages%2Fservice-worker%2Fworker%2Fsrc%2Fdriver.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Fsrc%2Fdriver.ts?ref=59225f5586f1319a47768cef2e3325d7ab6940af",
            "patch": "@@ -319,12 +319,11 @@ export class Driver implements Debuggable, UpdateSource {\n \n   private async handleMessage(msg: MsgAny&{action: string}, from: Client): Promise<void> {\n     if (isMsgCheckForUpdates(msg)) {\n-      const action = (async () => {\n-        await this.checkForUpdate();\n-      })();\n-      await this.reportStatus(from, action, msg.statusNonce);\n+      const action = this.checkForUpdate();\n+      await this.completeOperation(from, action, msg.nonce);\n     } else if (isMsgActivateUpdate(msg)) {\n-      await this.reportStatus(from, this.updateClient(from), msg.statusNonce);\n+      const action = this.updateClient(from);\n+      await this.completeOperation(from, action, msg.nonce);\n     }\n   }\n \n@@ -398,27 +397,30 @@ export class Driver implements Debuggable, UpdateSource {\n     // As per the spec windowClients are `sorted in the most recently focused order`\n     return windowClients[0];\n   }\n-  private async reportStatus(client: Client, promise: Promise<void>, nonce: number): Promise<void> {\n-    const response = {type: 'STATUS', nonce, status: true};\n+\n+  private async completeOperation(client: Client, promise: Promise<boolean>, nonce: number):\n+      Promise<void> {\n+    const response = {type: 'OPERATION_COMPLETED', nonce};\n     try {\n-      await promise;\n-      client.postMessage(response);\n+      client.postMessage({\n+        ...response,\n+        result: await promise,\n+      });\n     } catch (e) {\n       client.postMessage({\n         ...response,\n-        status: false,\n         error: e.toString(),\n       });\n     }\n   }\n \n-  async updateClient(client: Client): Promise<void> {\n+  async updateClient(client: Client): Promise<boolean> {\n     // Figure out which version the client is on. If it's not on the latest,\n     // it needs to be moved.\n     const existing = this.clientVersionMap.get(client.id);\n     if (existing === this.latestHash) {\n       // Nothing to do, this client is already on the latest version.\n-      return;\n+      return false;\n     }\n \n     // Switch the client over.\n@@ -444,6 +446,7 @@ export class Driver implements Debuggable, UpdateSource {\n     };\n \n     client.postMessage(notice);\n+    return true;\n   }\n \n   private async handleFetch(event: FetchEvent): Promise<Response> {"
        },
        {
            "sha": "95843f42e9c7255270e06e34b95c25a155afa766",
            "filename": "packages/service-worker/worker/src/msg.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/59225f5586f1319a47768cef2e3325d7ab6940af/packages%2Fservice-worker%2Fworker%2Fsrc%2Fmsg.ts",
            "raw_url": "https://github.com/angular/angular/raw/59225f5586f1319a47768cef2e3325d7ab6940af/packages%2Fservice-worker%2Fworker%2Fsrc%2Fmsg.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Fsrc%2Fmsg.ts?ref=59225f5586f1319a47768cef2e3325d7ab6940af",
            "patch": "@@ -12,7 +12,7 @@ export interface MsgAny {\n \n export interface MsgCheckForUpdates {\n   action: 'CHECK_FOR_UPDATES';\n-  statusNonce: number;\n+  nonce: number;\n }\n \n export function isMsgCheckForUpdates(msg: MsgAny): msg is MsgCheckForUpdates {\n@@ -21,7 +21,7 @@ export function isMsgCheckForUpdates(msg: MsgAny): msg is MsgCheckForUpdates {\n \n export interface MsgActivateUpdate {\n   action: 'ACTIVATE_UPDATE';\n-  statusNonce: number;\n+  nonce: number;\n }\n \n export function isMsgActivateUpdate(msg: MsgAny): msg is MsgActivateUpdate {"
        }
    ],
    "stats": {
        "total": 199,
        "additions": 115,
        "deletions": 84
    }
}