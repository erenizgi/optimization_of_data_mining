{
    "author": "devversion",
    "message": "refactor: expose new `@angular/localize/tools` entry-point for CLI usage (#43431)\n\nThis wires up the `@angular/localize/tools` entry-point. For context:\nThis entry-point is being created to avoid deep imports into\n`@angular/localize/src/tools/<..>` like the CLI relies on. Deep imports\ndo not play well with strict ESM, and now that all APF packages are\nstrict ESM, the tool code needs to be either strict ESM as well.\n\nWe use ESBuild to create individual bundles for the CLI entry-points,\nand the actual tool entry-point. We use a bundler because this enables\nthe localize code be ESM compatible. Without a bundler, all relative imports\nwithin the `tools` entry-point would need to explicitly have the `.js`\nextension. This would be cumbersome and hard to maintain/enforce or\nvalidate.\n\nOne might wonder why this is not a standard APF entry-point then. The\nanswer is that the APF entry-points do not support exposing the CLI\nbinaries (like `yarn localize-translate`). This could be done through\ntertiary entry-points, but using ESBuild directly gives us more control\nfor now. We might want to revisit this in the future again.\n\nPR Close #43431",
    "sha": "27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
    "files": [
        {
            "sha": "789600040b22db7dd999a5d839217a61ae536cb0",
            "filename": ".pullapprove.yml",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/.pullapprove.yml",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/.pullapprove.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.pullapprove.yml?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -1028,7 +1028,8 @@ groups:\n       - *can-be-global-docs-approved\n       - >\n         contains_any_globs(files, [\n-          'packages/compiler-cli/src/tooling.ts'\n+          'packages/compiler-cli/src/tooling.ts',\n+          'packages/localize/tools/index.ts'\n         ])\n     reviewers:\n       users:"
        },
        {
            "sha": "19d68a68018f109305565c84a3a429665b5ab9cc",
            "filename": "packages/compiler-cli/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Fcompiler-cli%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Fcompiler-cli%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2FBUILD.bazel?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -1,6 +1,6 @@\n load(\"//tools:defaults.bzl\", \"api_golden_test\", \"pkg_npm\", \"ts_config\", \"ts_library\")\n load(\"@npm//@bazel/esbuild:index.bzl\", \"esbuild\", \"esbuild_config\")\n-load(\":extract_typings_rule.bzl\", \"extract_typings\")\n+load(\"//tools:extract_typings_rule.bzl\", \"extract_typings\")\n \n # Load ng_perf_flag explicitly from ng_perf.bzl as it's private API, and not exposed to other\n # consumers of @angular/bazel."
        },
        {
            "sha": "42066b3b98cbb3fc15ac91cb087c4310b771dbc3",
            "filename": "packages/localize/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2FBUILD.bazel?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -25,7 +25,7 @@ ng_package(\n     ],\n     nested_packages = [\n         \"//packages/localize/schematics:npm_package\",\n-        \"//packages/localize/src/tools:npm_package\",\n+        \"//packages/localize/tools:npm_package\",\n     ],\n     tags = [\n         \"release-with-framework\","
        },
        {
            "sha": "1d437e09b99c8430ad4953aa606cc34a447f0ba4",
            "filename": "packages/localize/package.json",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fpackage.json?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -3,9 +3,15 @@\n   \"version\": \"0.0.0-PLACEHOLDER\",\n   \"description\": \"Angular - library for localizing messages\",\n   \"bin\": {\n-    \"localize-translate\": \"./src/tools/src/translate/main.js\",\n-    \"localize-extract\": \"./src/tools/src/extract/main.js\",\n-    \"localize-migrate\": \"./src/tools/src/migrate/main.js\"\n+    \"localize-translate\": \"./tools/bundles/src/translate/cli.js\",\n+    \"localize-extract\": \"./tools/bundles/src/extract/cli.js\",\n+    \"localize-migrate\": \"./tools/bundles/src/migrate/cli.js\"\n+  },\n+  \"exports\": {\n+    \"./tools\": {\n+      \"types\": \"./tools/index.d.ts\",\n+      \"default\": \"./tools/bundles/index.js\"\n+    }\n   },\n   \"author\": \"angular\",\n   \"license\": \"MIT\",\n@@ -28,7 +34,8 @@\n     \"**/init.mjs\"\n   ],\n   \"dependencies\": {\n-    \"@babel/core\": \"7.8.3\",\n+    \"@babel/core\": \"7.8.6\",\n+    \"@babel/types\": \"7.8.6\",\n     \"glob\": \"7.2.0\",\n     \"yargs\": \"^17.0.0\"\n   },"
        },
        {
            "sha": "a7b42679670601dc9789ed513fb47a200edf49be",
            "filename": "packages/localize/src/tools/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 40,
            "changes": 40,
            "blob_url": "https://github.com/angular/angular/blob/a18981ab7b5fa581d62e7d65dcb752861389d800/packages%2Flocalize%2Fsrc%2Ftools%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/a18981ab7b5fa581d62e7d65dcb752861389d800/packages%2Flocalize%2Fsrc%2Ftools%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2FBUILD.bazel?ref=a18981ab7b5fa581d62e7d65dcb752861389d800",
            "patch": "@@ -1,40 +0,0 @@\n-load(\"//tools:defaults.bzl\", \"pkg_npm\", \"ts_config\", \"ts_library\")\n-\n-package(default_visibility = [\"//visibility:public\"])\n-\n-ts_config(\n-    name = \"tsconfig\",\n-    src = \"tsconfig-build.json\",\n-    deps = [\"//packages:tsconfig-build.json\"],\n-)\n-\n-ts_library(\n-    name = \"tools\",\n-    srcs = glob(\n-        [\n-            \"**/*.ts\",\n-        ],\n-    ),\n-    tsconfig = \":tsconfig\",\n-    deps = [\n-        \"//packages/compiler\",\n-        \"//packages/compiler-cli/private\",\n-        \"//packages/localize\",\n-        \"@npm//@babel/core\",\n-        \"@npm//@babel/types\",\n-        \"@npm//@types/babel__core\",\n-        \"@npm//@types/babel__traverse\",\n-        \"@npm//@types/glob\",\n-        \"@npm//@types/node\",\n-        \"@npm//@types/yargs\",\n-    ],\n-)\n-\n-pkg_npm(\n-    name = \"npm_package\",\n-    srcs = [\n-    ],\n-    deps = [\n-        \":tools\",\n-    ],\n-)"
        },
        {
            "sha": "d72ef484361a1cd064749f4b8fd3c41dd7ae1c1d",
            "filename": "packages/localize/src/tools/tsconfig-build.json",
            "status": "removed",
            "additions": 0,
            "deletions": 23,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/a18981ab7b5fa581d62e7d65dcb752861389d800/packages%2Flocalize%2Fsrc%2Ftools%2Ftsconfig-build.json",
            "raw_url": "https://github.com/angular/angular/raw/a18981ab7b5fa581d62e7d65dcb752861389d800/packages%2Flocalize%2Fsrc%2Ftools%2Ftsconfig-build.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftsconfig-build.json?ref=a18981ab7b5fa581d62e7d65dcb752861389d800",
            "patch": "@@ -1,23 +0,0 @@\n-{\n-  \"extends\": \"../../../tsconfig-build.json\",\n-\n-  \"compilerOptions\": {\n-    \"module\": \"commonjs\",\n-    \"stripInternal\": false,\n-    \"target\": \"es2015\",\n-    \"lib\": [\n-      \"es2015\",\n-      \"es2017.object\"\n-    ],\n-    \"paths\": {\n-      \"@angular/*\": [\"./packages/*\"]\n-    },\n-    \"strict\": true,\n-    \"types\": [\n-      \"node\"\n-    ]\n-  },\n-  \"bazelOptions\": {\n-    \"suppressTsconfigOverrideWarnings\": true\n-  }\n-}\n\\ No newline at end of file"
        },
        {
            "sha": "07231f7355c86403f8c65a309e4dd204bfcbd8a0",
            "filename": "packages/localize/tools/BUILD.bazel",
            "status": "added",
            "additions": 72,
            "deletions": 0,
            "changes": 72,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2FBUILD.bazel?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -0,0 +1,72 @@\n+load(\"@npm//@bazel/esbuild:index.bzl\", \"esbuild\", \"esbuild_config\")\n+load(\"//tools:defaults.bzl\", \"pkg_npm\", \"ts_library\")\n+load(\"//tools:extract_typings_rule.bzl\", \"extract_typings\")\n+\n+ts_library(\n+    name = \"tools\",\n+    srcs = glob(\n+        [\n+            \"**/*.ts\",\n+        ],\n+    ),\n+    visibility = [\"//packages/localize/tools:__subpackages__\"],\n+    deps = [\n+        \"//packages/compiler\",\n+        \"//packages/compiler-cli/private\",\n+        \"//packages/localize\",\n+        \"@npm//@babel/core\",\n+        \"@npm//@babel/types\",\n+        \"@npm//@types/babel__core\",\n+        \"@npm//@types/babel__traverse\",\n+        \"@npm//@types/glob\",\n+        \"@npm//@types/node\",\n+        \"@npm//@types/yargs\",\n+        \"@npm//glob\",\n+    ],\n+)\n+\n+esbuild_config(\n+    name = \"esbuild_config\",\n+    config_file = \"esbuild.config.js\",\n+)\n+\n+esbuild(\n+    name = \"bundles\",\n+    config = \":esbuild_config\",\n+    entry_points = [\n+        \":index.ts\",\n+        \":src/extract/cli.ts\",\n+        \":src/migrate/cli.ts\",\n+        \":src/translate/cli.ts\",\n+    ],\n+    external = [\n+        \"@angular/localize\",\n+        \"@angular/compiler\",\n+        \"@angular/compiler-cli/private/localize\",\n+        \"@babel/core\",\n+        \"@babel/types\",\n+        \"yargs\",\n+        \"glob\",\n+    ],\n+    format = \"esm\",\n+    platform = \"node\",\n+    target = \"node14\",\n+    deps = [\n+        \":tools\",\n+    ],\n+)\n+\n+extract_typings(\n+    name = \"api_type_definitions\",\n+    deps = [\":tools\"],\n+)\n+\n+pkg_npm(\n+    name = \"npm_package\",\n+    srcs = [\"README.md\"],\n+    visibility = [\"//packages/localize:__pkg__\"],\n+    deps = [\n+        \":api_type_definitions\",\n+        \":bundles\",\n+    ],\n+)"
        },
        {
            "sha": "11429306d8790f2ab812a6669f5e48ece3fbdac6",
            "filename": "packages/localize/tools/README.md",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2FREADME.md?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -0,0 +1,4 @@\n+### Disclaimer\n+\n+The localize tools are consumed via the Angular CLI. The programmatic APIs are not considered officially\n+supported though and are not subject to the breaking change guarantees of SemVer.\n\\ No newline at end of file"
        },
        {
            "sha": "33dec5e1164c9f8efb5e6127d34b1acaa86bc780",
            "filename": "packages/localize/tools/esbuild.config.js",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fesbuild.config.js",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fesbuild.config.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Fesbuild.config.js?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -0,0 +1,21 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+module.exports = {\n+  resolveExtensions: ['.mjs'],\n+  // Note: `@bazel/esbuild` has a bug and does not pass-through the format from Starlark.\n+  format: 'esm',\n+  banner: {\n+    // Workaround for: https://github.com/evanw/esbuild/issues/946\n+    // TODO: Remove this workaround in the future once devmode is ESM as well.\n+    js: `\n+      import {createRequire as __cjsCompatRequire} from 'module';\n+      const require = __cjsCompatRequire(import.meta.url);\n+    `,\n+  },\n+};"
        },
        {
            "sha": "3127e2f0572b90f45c9ed49da5b403e11dbd366b",
            "filename": "packages/localize/tools/index.ts",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Findex.ts?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -0,0 +1,32 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+// Note: Before changing any exports here, consult with the Angular tooling team\n+// as the CLI heavily relies on exports declared here.\n+\n+import {NodeJSFileSystem, setFileSystem} from '@angular/compiler-cli/private/localize';\n+setFileSystem(new NodeJSFileSystem());\n+\n+export {DiagnosticHandlingStrategy, Diagnostics} from './src/diagnostics';\n+export {checkDuplicateMessages} from './src/extract/duplicates';\n+export {MessageExtractor} from './src/extract/extraction';\n+export {ArbTranslationSerializer} from './src/extract/translation_files/arb_translation_serializer';\n+export {SimpleJsonTranslationSerializer} from './src/extract/translation_files/json_translation_serializer';\n+export {LegacyMessageIdMigrationSerializer} from './src/extract/translation_files/legacy_message_id_migration_serializer';\n+export {Xliff1TranslationSerializer} from './src/extract/translation_files/xliff1_translation_serializer';\n+export {Xliff2TranslationSerializer} from './src/extract/translation_files/xliff2_translation_serializer';\n+export {XmbTranslationSerializer} from './src/extract/translation_files/xmb_translation_serializer';\n+export {buildLocalizeReplacement, isGlobalIdentifier, translate, unwrapExpressionsFromTemplateLiteral, unwrapMessagePartsFromLocalizeCall, unwrapMessagePartsFromTemplateLiteral, unwrapSubstitutionsFromLocalizeCall} from './src/source_file_utils';\n+export {makeEs2015TranslatePlugin} from './src/translate/source_files/es2015_translate_plugin';\n+export {makeEs5TranslatePlugin} from './src/translate/source_files/es5_translate_plugin';\n+export {makeLocalePlugin} from './src/translate/source_files/locale_plugin';\n+export {ArbTranslationParser} from './src/translate/translation_files/translation_parsers/arb_translation_parser';\n+export {SimpleJsonTranslationParser} from './src/translate/translation_files/translation_parsers/simple_json_translation_parser';\n+export {Xliff1TranslationParser} from './src/translate/translation_files/translation_parsers/xliff1_translation_parser';\n+export {Xliff2TranslationParser} from './src/translate/translation_files/translation_parsers/xliff2_translation_parser';\n+export {XtbTranslationParser} from './src/translate/translation_files/translation_parsers/xtb_translation_parser';"
        },
        {
            "sha": "1422a7238bc5c08cc4a536d2445a0fbcc5e2239f",
            "filename": "packages/localize/tools/src/extract/cli.ts",
            "status": "added",
            "additions": 116,
            "deletions": 0,
            "changes": 116,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Fextract%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Fextract%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Fsrc%2Fextract%2Fcli.ts?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -0,0 +1,116 @@\n+#!/usr/bin/env node\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {ConsoleLogger, LogLevel, NodeJSFileSystem, setFileSystem} from '@angular/compiler-cli/private/localize';\n+import * as glob from 'glob';\n+import * as yargs from 'yargs';\n+\n+import {DiagnosticHandlingStrategy} from '../diagnostics';\n+import {parseFormatOptions} from './translation_files/format_options';\n+import {extractTranslations} from './index';\n+\n+process.title = 'Angular Localization Message Extractor (localize-extract)';\n+const args = process.argv.slice(2);\n+const options =\n+    yargs\n+        .option('l', {\n+          alias: 'locale',\n+          describe: 'The locale of the source being processed',\n+          default: 'en',\n+          type: 'string',\n+        })\n+        .option('r', {\n+          alias: 'root',\n+          default: '.',\n+          describe: 'The root path for other paths provided in these options.\\n' +\n+              'This should either be absolute or relative to the current working directory.',\n+          type: 'string',\n+        })\n+        .option('s', {\n+          alias: 'source',\n+          required: true,\n+          describe:\n+              'A glob pattern indicating what files to search for translations, e.g. `./dist/**/*.js`.\\n' +\n+              'This should be relative to the root path.',\n+          type: 'string',\n+        })\n+        .option('f', {\n+          alias: 'format',\n+          required: true,\n+          choices:\n+              ['xmb', 'xlf', 'xlif', 'xliff', 'xlf2', 'xlif2', 'xliff2', 'json', 'legacy-migrate'],\n+          describe: 'The format of the translation file.',\n+          type: 'string',\n+        })\n+        .option('formatOptions', {\n+          describe:\n+              'Additional options to pass to the translation file serializer, in the form of JSON formatted key-value string pairs:\\n' +\n+              'For example: `--formatOptions {\"xml:space\":\"preserve\"}.\\n' +\n+              'The meaning of the options is specific to the format being serialized.',\n+          type: 'string'\n+        })\n+        .option('o', {\n+          alias: 'outputPath',\n+          required: true,\n+          describe:\n+              'A path to where the translation file will be written. This should be relative to the root path.',\n+          type: 'string',\n+        })\n+        .option('loglevel', {\n+          describe: 'The lowest severity logging message that should be output.',\n+          choices: ['debug', 'info', 'warn', 'error'],\n+          type: 'string',\n+        })\n+        .option('useSourceMaps', {\n+          type: 'boolean',\n+          default: true,\n+          describe:\n+              'Whether to generate source information in the output files by following source-map mappings found in the source files',\n+        })\n+        .option('useLegacyIds', {\n+          type: 'boolean',\n+          default: true,\n+          describe:\n+              'Whether to use the legacy id format for messages that were extracted from Angular templates.',\n+        })\n+        .option('d', {\n+          alias: 'duplicateMessageHandling',\n+          describe: 'How to handle messages with the same id but different text.',\n+          choices: ['error', 'warning', 'ignore'],\n+          default: 'warning',\n+          type: 'string',\n+        })\n+        .strict()\n+        .help()\n+        .parse(args);\n+\n+const fileSystem = new NodeJSFileSystem();\n+setFileSystem(fileSystem);\n+\n+const rootPath = options.r;\n+const sourceFilePaths = glob.sync(options.s, {cwd: rootPath, nodir: true});\n+const logLevel = options.loglevel as (keyof typeof LogLevel) | undefined;\n+const logger = new ConsoleLogger(logLevel ? LogLevel[logLevel] : LogLevel.warn);\n+const duplicateMessageHandling = options.d as DiagnosticHandlingStrategy;\n+const formatOptions = parseFormatOptions(options.formatOptions);\n+const format = options.f;\n+\n+extractTranslations({\n+  rootPath,\n+  sourceFilePaths,\n+  sourceLocale: options.l,\n+  format,\n+  outputPath: options.o,\n+  logger,\n+  useSourceMaps: options.useSourceMaps,\n+  useLegacyIds: format === 'legacy-migrate' || options.useLegacyIds,\n+  duplicateMessageHandling,\n+  formatOptions,\n+  fileSystem,\n+});"
        },
        {
            "sha": "a36b20e67292520b551e0db7c8d26043da4832b0",
            "filename": "packages/localize/tools/src/extract/index.ts",
            "status": "renamed",
            "additions": 5,
            "deletions": 110,
            "changes": 115,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Fextract%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Fextract%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Fsrc%2Fextract%2Findex.ts?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -1,131 +1,26 @@\n-#!/usr/bin/env node\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n  *\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {setFileSystem, NodeJSFileSystem, AbsoluteFsPath, FileSystem, PathManipulation, ConsoleLogger, Logger, LogLevel} from '@angular/compiler-cli/private/localize';\n+import {AbsoluteFsPath, FileSystem, Logger, PathManipulation} from '@angular/compiler-cli/private/localize';\n import {ÉµParsedMessage} from '@angular/localize';\n-import * as glob from 'glob';\n-import * as yargs from 'yargs';\n \n-import {Diagnostics, DiagnosticHandlingStrategy} from '../diagnostics';\n+import {DiagnosticHandlingStrategy, Diagnostics} from '../diagnostics';\n \n import {checkDuplicateMessages} from './duplicates';\n import {MessageExtractor} from './extraction';\n-import {TranslationSerializer} from './translation_files/translation_serializer';\n import {ArbTranslationSerializer} from './translation_files/arb_translation_serializer';\n+import {FormatOptions} from './translation_files/format_options';\n import {SimpleJsonTranslationSerializer} from './translation_files/json_translation_serializer';\n+import {LegacyMessageIdMigrationSerializer} from './translation_files/legacy_message_id_migration_serializer';\n+import {TranslationSerializer} from './translation_files/translation_serializer';\n import {Xliff1TranslationSerializer} from './translation_files/xliff1_translation_serializer';\n import {Xliff2TranslationSerializer} from './translation_files/xliff2_translation_serializer';\n import {XmbTranslationSerializer} from './translation_files/xmb_translation_serializer';\n-import {FormatOptions, parseFormatOptions} from './translation_files/format_options';\n-import {LegacyMessageIdMigrationSerializer} from './translation_files/legacy_message_id_migration_serializer';\n \n-if (require.main === module) {\n-  process.title = 'Angular Localization Message Extractor (localize-extract)';\n-  const args = process.argv.slice(2);\n-  const options =\n-      yargs\n-          .option('l', {\n-            alias: 'locale',\n-            describe: 'The locale of the source being processed',\n-            default: 'en',\n-            type: 'string',\n-          })\n-          .option('r', {\n-            alias: 'root',\n-            default: '.',\n-            describe: 'The root path for other paths provided in these options.\\n' +\n-                'This should either be absolute or relative to the current working directory.',\n-            type: 'string',\n-          })\n-          .option('s', {\n-            alias: 'source',\n-            required: true,\n-            describe:\n-                'A glob pattern indicating what files to search for translations, e.g. `./dist/**/*.js`.\\n' +\n-                'This should be relative to the root path.',\n-            type: 'string',\n-          })\n-          .option('f', {\n-            alias: 'format',\n-            required: true,\n-            choices: [\n-              'xmb', 'xlf', 'xlif', 'xliff', 'xlf2', 'xlif2', 'xliff2', 'json', 'legacy-migrate'\n-            ],\n-            describe: 'The format of the translation file.',\n-            type: 'string',\n-          })\n-          .option('formatOptions', {\n-            describe:\n-                'Additional options to pass to the translation file serializer, in the form of JSON formatted key-value string pairs:\\n' +\n-                'For example: `--formatOptions {\"xml:space\":\"preserve\"}.\\n' +\n-                'The meaning of the options is specific to the format being serialized.',\n-            type: 'string'\n-          })\n-          .option('o', {\n-            alias: 'outputPath',\n-            required: true,\n-            describe:\n-                'A path to where the translation file will be written. This should be relative to the root path.',\n-            type: 'string',\n-          })\n-          .option('loglevel', {\n-            describe: 'The lowest severity logging message that should be output.',\n-            choices: ['debug', 'info', 'warn', 'error'],\n-            type: 'string',\n-          })\n-          .option('useSourceMaps', {\n-            type: 'boolean',\n-            default: true,\n-            describe:\n-                'Whether to generate source information in the output files by following source-map mappings found in the source files',\n-          })\n-          .option('useLegacyIds', {\n-            type: 'boolean',\n-            default: true,\n-            describe:\n-                'Whether to use the legacy id format for messages that were extracted from Angular templates.',\n-          })\n-          .option('d', {\n-            alias: 'duplicateMessageHandling',\n-            describe: 'How to handle messages with the same id but different text.',\n-            choices: ['error', 'warning', 'ignore'],\n-            default: 'warning',\n-            type: 'string',\n-          })\n-          .strict()\n-          .help()\n-          .parse(args);\n-\n-  const fileSystem = new NodeJSFileSystem();\n-  setFileSystem(fileSystem);\n-\n-  const rootPath = options.r;\n-  const sourceFilePaths = glob.sync(options.s, {cwd: rootPath, nodir: true});\n-  const logLevel = options.loglevel as (keyof typeof LogLevel) | undefined;\n-  const logger = new ConsoleLogger(logLevel ? LogLevel[logLevel] : LogLevel.warn);\n-  const duplicateMessageHandling = options.d as DiagnosticHandlingStrategy;\n-  const formatOptions = parseFormatOptions(options.formatOptions);\n-  const format = options.f;\n-\n-  extractTranslations({\n-    rootPath,\n-    sourceFilePaths,\n-    sourceLocale: options.l,\n-    format,\n-    outputPath: options.o,\n-    logger,\n-    useSourceMaps: options.useSourceMaps,\n-    useLegacyIds: format === 'legacy-migrate' || options.useLegacyIds,\n-    duplicateMessageHandling,\n-    formatOptions,\n-    fileSystem,\n-  });\n-}\n \n export interface ExtractTranslationsOptions {\n   /**",
            "previous_filename": "packages/localize/tools/src/extract/main.ts"
        },
        {
            "sha": "c0528662cabff336554878142b738dadf7b1b854",
            "filename": "packages/localize/tools/src/migrate/cli.ts",
            "status": "added",
            "additions": 51,
            "deletions": 0,
            "changes": 51,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Fmigrate%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Fmigrate%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Fsrc%2Fmigrate%2Fcli.ts?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -0,0 +1,51 @@\n+#!/usr/bin/env node\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {ConsoleLogger, LogLevel, NodeJSFileSystem, setFileSystem} from '@angular/compiler-cli/private/localize';\n+import * as glob from 'glob';\n+import * as yargs from 'yargs';\n+import {migrateFiles} from './index';\n+\n+const args = process.argv.slice(2);\n+const options =\n+    yargs\n+        .option('r', {\n+          alias: 'root',\n+          default: '.',\n+          describe: 'The root path for other paths provided in these options.\\n' +\n+              'This should either be absolute or relative to the current working directory.',\n+          type: 'string',\n+        })\n+        .option('f', {\n+          alias: 'files',\n+          required: true,\n+          describe:\n+              'A glob pattern indicating what files to migrate. This should be relative to the root path',\n+          type: 'string',\n+        })\n+        .option('m', {\n+          alias: 'mapFile',\n+          required: true,\n+          describe:\n+              'Path to the migration mapping file generated by `localize-extract`. This should be relative to the root path.',\n+          type: 'string',\n+        })\n+        .strict()\n+        .help()\n+        .parse(args);\n+\n+const fs = new NodeJSFileSystem();\n+setFileSystem(fs);\n+\n+const rootPath = options.r;\n+const translationFilePaths = glob.sync(options.f, {cwd: rootPath, nodir: true});\n+const logger = new ConsoleLogger(LogLevel.warn);\n+\n+migrateFiles({rootPath, translationFilePaths, mappingFilePath: options.m, logger});\n+process.exit(0);"
        },
        {
            "sha": "c05cdef9d634868d25d5860ee4c9c769976a6c85",
            "filename": "packages/localize/tools/src/migrate/index.ts",
            "status": "renamed",
            "additions": 2,
            "deletions": 44,
            "changes": 46,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Fmigrate%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Fmigrate%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Fsrc%2Fmigrate%2Findex.ts?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -1,55 +1,13 @@\n-#!/usr/bin/env node\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n  *\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {getFileSystem, NodeJSFileSystem, setFileSystem, ConsoleLogger, Logger, LogLevel} from '@angular/compiler-cli/private/localize';\n-import * as glob from 'glob';\n-import * as yargs from 'yargs';\n-import {migrateFile, MigrationMapping} from './migrate';\n-\n-if (require.main === module) {\n-  const args = process.argv.slice(2);\n-  const options =\n-      yargs\n-          .option('r', {\n-            alias: 'root',\n-            default: '.',\n-            describe: 'The root path for other paths provided in these options.\\n' +\n-                'This should either be absolute or relative to the current working directory.',\n-            type: 'string',\n-          })\n-          .option('f', {\n-            alias: 'files',\n-            required: true,\n-            describe:\n-                'A glob pattern indicating what files to migrate. This should be relative to the root path',\n-            type: 'string',\n-          })\n-          .option('m', {\n-            alias: 'mapFile',\n-            required: true,\n-            describe:\n-                'Path to the migration mapping file generated by `localize-extract`. This should be relative to the root path.',\n-            type: 'string',\n-          })\n-          .strict()\n-          .help()\n-          .parse(args);\n-\n-  const fs = new NodeJSFileSystem();\n-  setFileSystem(fs);\n \n-  const rootPath = options.r;\n-  const translationFilePaths = glob.sync(options.f, {cwd: rootPath, nodir: true});\n-  const logger = new ConsoleLogger(LogLevel.warn);\n-\n-  migrateFiles({rootPath, translationFilePaths, mappingFilePath: options.m, logger});\n-  process.exit(0);\n-}\n+import {getFileSystem, Logger} from '@angular/compiler-cli/private/localize';\n+import {migrateFile, MigrationMapping} from './migrate';\n \n export interface MigrateFilesOptions {\n   /**",
            "previous_filename": "packages/localize/tools/src/migrate/main.ts"
        },
        {
            "sha": "c1724552bd19b2e57669c32cb62fd93cdbb11688",
            "filename": "packages/localize/tools/src/translate/cli.ts",
            "status": "added",
            "additions": 131,
            "deletions": 0,
            "changes": 131,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Ftranslate%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Ftranslate%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Fsrc%2Ftranslate%2Fcli.ts?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -0,0 +1,131 @@\n+#!/usr/bin/env node\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {NodeJSFileSystem, setFileSystem} from '@angular/compiler-cli/private/localize';\n+import * as glob from 'glob';\n+import * as yargs from 'yargs';\n+\n+import {DiagnosticHandlingStrategy, Diagnostics} from '../diagnostics';\n+import {getOutputPathFn} from './output_path';\n+import {translateFiles} from './index';\n+\n+process.title = 'Angular Localization Message Translator (localize-translate)';\n+const args = process.argv.slice(2);\n+const options =\n+    yargs\n+        .option('r', {\n+          alias: 'root',\n+          required: true,\n+          describe:\n+              'The root path of the files to translate, either absolute or relative to the current working directory. E.g. `dist/en`.',\n+          type: 'string',\n+        })\n+        .option('s', {\n+          alias: 'source',\n+          required: true,\n+          describe:\n+              'A glob pattern indicating what files to translate, relative to the `root` path. E.g. `bundles/**/*`.',\n+          type: 'string',\n+        })\n+\n+        .option('l', {\n+          alias: 'source-locale',\n+          describe:\n+              'The source locale of the application. If this is provided then a copy of the application will be created with no translation but just the `$localize` calls stripped out.',\n+          type: 'string',\n+        })\n+\n+        .option('t', {\n+          alias: 'translations',\n+          required: true,\n+          array: true,\n+          describe:\n+              'A list of paths to the translation files to load, either absolute or relative to the current working directory.\\n' +\n+              'E.g. `-t src/locale/messages.en.xlf src/locale/messages.fr.xlf src/locale/messages.de.xlf`.\\n' +\n+              'If you want to merge multiple translation files for each locale, then provide the list of files in an array.\\n' +\n+              'Note that the arrays must be in double quotes if you include any whitespace within the array.\\n' +\n+              'E.g. `-t \"[src/locale/messages.en.xlf, src/locale/messages-2.en.xlf]\" [src/locale/messages.fr.xlf,src/locale/messages-2.fr.xlf]`',\n+          type: 'string',\n+        })\n+\n+        .option('target-locales', {\n+          array: true,\n+          describe:\n+              'A list of target locales for the translation files, which will override any target locale parsed from the translation file.\\n' +\n+              'E.g. \"-t en fr de\".',\n+          type: 'string',\n+        })\n+\n+        .option('o', {\n+          alias: 'outputPath',\n+          required: true,\n+          describe: 'A output path pattern to where the translated files will be written.\\n' +\n+              'The path must be either absolute or relative to the current working directory.\\n' +\n+              'The marker `{{LOCALE}}` will be replaced with the target locale. E.g. `dist/{{LOCALE}}`.',\n+          type: 'string',\n+        })\n+\n+        .option('m', {\n+          alias: 'missingTranslation',\n+          describe: 'How to handle missing translations.',\n+          choices: ['error', 'warning', 'ignore'],\n+          default: 'warning',\n+          type: 'string',\n+        })\n+\n+        .option('d', {\n+          alias: 'duplicateTranslation',\n+          describe: 'How to handle duplicate translations.',\n+          choices: ['error', 'warning', 'ignore'],\n+          default: 'warning',\n+          type: 'string',\n+        })\n+\n+        .strict()\n+        .help()\n+        .parse(args);\n+\n+const fs = new NodeJSFileSystem();\n+setFileSystem(fs);\n+\n+const sourceRootPath = options.r;\n+const sourceFilePaths = glob.sync(options.s, {cwd: sourceRootPath, nodir: true});\n+const translationFilePaths: (string|string[])[] = convertArraysFromArgs(options.t);\n+const outputPathFn = getOutputPathFn(fs, fs.resolve(options.o));\n+const diagnostics = new Diagnostics();\n+const missingTranslation = options.m as DiagnosticHandlingStrategy;\n+const duplicateTranslation = options.d as DiagnosticHandlingStrategy;\n+const sourceLocale: string|undefined = options.l;\n+const translationFileLocales: string[] = options['target-locales'] || [];\n+\n+translateFiles({\n+  sourceRootPath,\n+  sourceFilePaths,\n+  translationFilePaths,\n+  translationFileLocales,\n+  outputPathFn,\n+  diagnostics,\n+  missingTranslation,\n+  duplicateTranslation,\n+  sourceLocale\n+});\n+\n+diagnostics.messages.forEach(m => console.warn(`${m.type}: ${m.message}`));\n+process.exit(diagnostics.hasErrors ? 1 : 0);\n+\n+/**\n+ * Parse each of the given string `args` and convert it to an array if it is of the form\n+ * `[abc, def, ghi]`, i.e. it is enclosed in square brackets with comma delimited items.\n+ * @param args The string to potentially convert to arrays.\n+ */\n+function convertArraysFromArgs(args: string[]): (string|string[])[] {\n+  return args.map(\n+      arg => (arg.startsWith('[') && arg.endsWith(']')) ?\n+          arg.slice(1, -1).split(',').map(arg => arg.trim()) :\n+          arg);\n+}"
        },
        {
            "sha": "019cbfc7e504196574213ace28068abb11ed37e5",
            "filename": "packages/localize/tools/src/translate/index.ts",
            "status": "renamed",
            "additions": 2,
            "deletions": 123,
            "changes": 125,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Ftranslate%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Ftranslate%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Fsrc%2Ftranslate%2Findex.ts?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -1,18 +1,15 @@\n-#!/usr/bin/env node\n /**\n  * @license\n  * Copyright Google LLC All Rights Reserved.\n  *\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {getFileSystem, NodeJSFileSystem, setFileSystem, relativeFrom} from '@angular/compiler-cli/private/localize';\n-import * as glob from 'glob';\n-import * as yargs from 'yargs';\n+import {getFileSystem, relativeFrom} from '@angular/compiler-cli/private/localize';\n \n import {DiagnosticHandlingStrategy, Diagnostics} from '../diagnostics';\n import {AssetTranslationHandler} from './asset_files/asset_translation_handler';\n-import {getOutputPathFn, OutputPathFn} from './output_path';\n+import {OutputPathFn} from './output_path';\n import {SourceFileTranslationHandler} from './source_files/source_file_translation_handler';\n import {TranslationLoader} from './translation_files/translation_loader';\n import {ArbTranslationParser} from './translation_files/translation_parsers/arb_translation_parser';\n@@ -22,112 +19,6 @@ import {Xliff2TranslationParser} from './translation_files/translation_parsers/x\n import {XtbTranslationParser} from './translation_files/translation_parsers/xtb_translation_parser';\n import {Translator} from './translator';\n \n-if (require.main === module) {\n-  process.title = 'Angular Localization Message Translator (localize-translate)';\n-  const args = process.argv.slice(2);\n-  const options =\n-      yargs\n-          .option('r', {\n-            alias: 'root',\n-            required: true,\n-            describe:\n-                'The root path of the files to translate, either absolute or relative to the current working directory. E.g. `dist/en`.',\n-            type: 'string',\n-          })\n-          .option('s', {\n-            alias: 'source',\n-            required: true,\n-            describe:\n-                'A glob pattern indicating what files to translate, relative to the `root` path. E.g. `bundles/**/*`.',\n-            type: 'string',\n-          })\n-\n-          .option('l', {\n-            alias: 'source-locale',\n-            describe:\n-                'The source locale of the application. If this is provided then a copy of the application will be created with no translation but just the `$localize` calls stripped out.',\n-            type: 'string',\n-          })\n-\n-          .option('t', {\n-            alias: 'translations',\n-            required: true,\n-            array: true,\n-            describe:\n-                'A list of paths to the translation files to load, either absolute or relative to the current working directory.\\n' +\n-                'E.g. `-t src/locale/messages.en.xlf src/locale/messages.fr.xlf src/locale/messages.de.xlf`.\\n' +\n-                'If you want to merge multiple translation files for each locale, then provide the list of files in an array.\\n' +\n-                'Note that the arrays must be in double quotes if you include any whitespace within the array.\\n' +\n-                'E.g. `-t \"[src/locale/messages.en.xlf, src/locale/messages-2.en.xlf]\" [src/locale/messages.fr.xlf,src/locale/messages-2.fr.xlf]`',\n-            type: 'string',\n-          })\n-\n-          .option('target-locales', {\n-            array: true,\n-            describe:\n-                'A list of target locales for the translation files, which will override any target locale parsed from the translation file.\\n' +\n-                'E.g. \"-t en fr de\".',\n-            type: 'string',\n-          })\n-\n-          .option('o', {\n-            alias: 'outputPath',\n-            required: true,\n-            describe: 'A output path pattern to where the translated files will be written.\\n' +\n-                'The path must be either absolute or relative to the current working directory.\\n' +\n-                'The marker `{{LOCALE}}` will be replaced with the target locale. E.g. `dist/{{LOCALE}}`.',\n-            type: 'string',\n-          })\n-\n-          .option('m', {\n-            alias: 'missingTranslation',\n-            describe: 'How to handle missing translations.',\n-            choices: ['error', 'warning', 'ignore'],\n-            default: 'warning',\n-            type: 'string',\n-          })\n-\n-          .option('d', {\n-            alias: 'duplicateTranslation',\n-            describe: 'How to handle duplicate translations.',\n-            choices: ['error', 'warning', 'ignore'],\n-            default: 'warning',\n-            type: 'string',\n-          })\n-\n-          .strict()\n-          .help()\n-          .parse(args);\n-\n-  const fs = new NodeJSFileSystem();\n-  setFileSystem(fs);\n-\n-  const sourceRootPath = options.r;\n-  const sourceFilePaths = glob.sync(options.s, {cwd: sourceRootPath, nodir: true});\n-  const translationFilePaths: (string|string[])[] = convertArraysFromArgs(options.t);\n-  const outputPathFn = getOutputPathFn(fs, fs.resolve(options.o));\n-  const diagnostics = new Diagnostics();\n-  const missingTranslation = options.m as DiagnosticHandlingStrategy;\n-  const duplicateTranslation = options.d as DiagnosticHandlingStrategy;\n-  const sourceLocale: string|undefined = options.l;\n-  const translationFileLocales: string[] = options['target-locales'] || [];\n-\n-  translateFiles({\n-    sourceRootPath,\n-    sourceFilePaths,\n-    translationFilePaths,\n-    translationFileLocales,\n-    outputPathFn,\n-    diagnostics,\n-    missingTranslation,\n-    duplicateTranslation,\n-    sourceLocale\n-  });\n-\n-  diagnostics.messages.forEach(m => console.warn(`${m.type}: ${m.message}`));\n-  process.exit(diagnostics.hasErrors ? 1 : 0);\n-}\n-\n export interface TranslateFilesOptions {\n   /**\n    * The root path of the files to translate, either absolute or relative to the current working\n@@ -235,15 +126,3 @@ export function translateFiles({\n       sourceFilePaths.map(relativeFrom), fs.resolve(sourceRootPath), outputPathFn, translations,\n       sourceLocale);\n }\n-\n-/**\n- * Parse each of the given string `args` and convert it to an array if it is of the form\n- * `[abc, def, ghi]`, i.e. it is enclosed in square brackets with comma delimited items.\n- * @param args The string to potentially convert to arrays.\n- */\n-function convertArraysFromArgs(args: string[]): (string|string[])[] {\n-  return args.map(\n-      arg => (arg.startsWith('[') && arg.endsWith(']')) ?\n-          arg.slice(1, -1).split(',').map(arg => arg.trim()) :\n-          arg);\n-}",
            "previous_filename": "packages/localize/tools/src/translate/main.ts"
        },
        {
            "sha": "51d21009d9839813f8f86fe01e5857ce26c1b9cb",
            "filename": "packages/localize/tools/src/translate/translation_files/translation_parsers/translation_parser.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Ftranslation_parser.ts",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Ftranslation_parser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_parsers%2Ftranslation_parser.ts?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {ÉµMessageId, ÉµParsedTranslation} from '@angular/localize/private';\n+import {ÉµMessageId, ÉµParsedTranslation} from '@angular/localize';\n import {Diagnostics} from '../../../diagnostics';\n \n /**"
        },
        {
            "sha": "e575065a6f67d2b8b1a9d03d845cced6e7a7e437",
            "filename": "packages/localize/tools/test/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2FBUILD.bazel?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -6,17 +6,17 @@ ts_library(\n     srcs = glob(\n         [\"**/*.ts\"],\n     ),\n-    visibility = [\"//packages/localize/src/tools/test:__subpackages__\"],\n+    visibility = [\"//packages/localize/tools/test:__subpackages__\"],\n     deps = [\n         \"//packages:types\",\n         \"//packages/compiler\",\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n         \"//packages/compiler-cli/src/ngtsc/logging/testing\",\n         \"//packages/localize\",\n-        \"//packages/localize/src/tools\",\n-        \"//packages/localize/src/tools/test/helpers\",\n         \"//packages/localize/src/utils\",\n+        \"//packages/localize/tools\",\n+        \"//packages/localize/tools/test/helpers\",\n         \"@npm//@babel/core\",\n         \"@npm//@babel/generator\",\n         \"@npm//@babel/template\","
        },
        {
            "sha": "1464fa8e72b53a892ac8c1906b0ea02e1d011a23",
            "filename": "packages/localize/tools/test/extract/integration/BUILD.bazel",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Fintegration%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Fintegration%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Fintegration%2FBUILD.bazel?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -13,19 +13,19 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/logging\",\n         \"//packages/compiler-cli/src/ngtsc/logging/testing\",\n         \"//packages/compiler-cli/src/ngtsc/testing\",\n-        \"//packages/localize/src/tools\",\n-        \"//packages/localize/src/tools/test:test_lib\",\n-        \"//packages/localize/src/tools/test/helpers\",\n+        \"//packages/localize/tools\",\n+        \"//packages/localize/tools/test:test_lib\",\n+        \"//packages/localize/tools/test/helpers\",\n     ],\n )\n \n jasmine_node_test(\n     name = \"integration\",\n     bootstrap = [\"//tools/testing:node_no_angular_es5\"],\n     data = [\n-        \"//packages/localize/src/tools/test/extract/integration/test_files\",\n-        \"//packages/localize/src/tools/test/extract/integration/test_files:compile_es2015\",\n-        \"//packages/localize/src/tools/test/extract/integration/test_files:compile_es5\",\n+        \"//packages/localize/tools/test/extract/integration/test_files\",\n+        \"//packages/localize/tools/test/extract/integration/test_files:compile_es2015\",\n+        \"//packages/localize/tools/test/extract/integration/test_files:compile_es5\",\n     ],\n     deps = [\n         \":test_lib\","
        },
        {
            "sha": "c26a90b55c20d4ac29854a8e80bd574b765e7922",
            "filename": "packages/localize/tools/test/extract/integration/main_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -10,7 +10,7 @@ import {InvalidFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/src\n import {MockLogger} from '@angular/compiler-cli/src/ngtsc/logging/testing';\n import {loadTestDirectory} from '@angular/compiler-cli/src/ngtsc/testing';\n \n-import {extractTranslations} from '../../../src/extract/main';\n+import {extractTranslations} from '../../../src/extract/index';\n import {FormatOptions} from '../../../src/extract/translation_files/format_options';\n import {runInNativeFileSystem} from '../../helpers';\n import {toAttributes} from '../translation_files/utils';\n@@ -398,15 +398,15 @@ runInNativeFileSystem(() => {\n              `        <context-group purpose=\"location\">`,\n              // These source file paths are due to how Bazel TypeScript compilation source-maps\n              // work\n-             `          <context context-type=\"sourcefile\">../packages/localize/src/tools/test/extract/integration/test_files/src/a.ts</context>`,\n+             `          <context context-type=\"sourcefile\">../packages/localize/tools/test/extract/integration/test_files/src/a.ts</context>`,\n              `          <context context-type=\"linenumber\">3,${\n                  target === 'es2015' ? 7 : 5}</context>`,\n              `        </context-group>`,\n              `      </trans-unit>`,\n              `      <trans-unit id=\"7829869508202074508\" datatype=\"html\">`,\n              `        <source>Message in <x id=\"b-file\" equiv-text=\"file\"/>!</source>`,\n              `        <context-group purpose=\"location\">`,\n-             `          <context context-type=\"sourcefile\">../packages/localize/src/tools/test/extract/integration/test_files/src/b.ts</context>`,\n+             `          <context context-type=\"sourcefile\">../packages/localize/tools/test/extract/integration/test_files/src/b.ts</context>`,\n              `          <context context-type=\"linenumber\">3</context>`,\n              `        </context-group>`,\n              `      </trans-unit>`,"
        },
        {
            "sha": "5a89e435a17c11b146d4ac971ff73119d8541755",
            "filename": "packages/localize/tools/test/extract/integration/test_files/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Fextract%2Fintegration%2Ftest_files%2FBUILD.bazel?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -1,7 +1,7 @@\n load(\"@npm//typescript:index.bzl\", \"tsc\")\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\")\n \n-package(default_visibility = [\"//packages/localize/src/tools/test/extract/integration:__pkg__\"])\n+package(default_visibility = [\"//packages/localize/tools/test/extract/integration:__pkg__\"])\n \n tsc(\n     name = \"compile_es5\","
        },
        {
            "sha": "9f9ea16d7ef5f7922fdb1bed4948b4310110d365",
            "filename": "packages/localize/tools/test/helpers/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Fhelpers%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Fhelpers%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Fhelpers%2FBUILD.bazel?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -6,7 +6,7 @@ ts_library(\n     srcs = glob(\n         [\"**/*.ts\"],\n     ),\n-    visibility = [\"//packages/localize/src/tools/test:__subpackages__\"],\n+    visibility = [\"//packages/localize/tools/test:__subpackages__\"],\n     deps = [\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/file_system/testing\","
        },
        {
            "sha": "52b652f7544d2f1a9f42d5be097a9aeb2fcdee3c",
            "filename": "packages/localize/tools/test/migrate/integration/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Fmigrate%2Fintegration%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Fmigrate%2Fintegration%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Fmigrate%2Fintegration%2FBUILD.bazel?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -14,9 +14,9 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/logging\",\n         \"//packages/compiler-cli/src/ngtsc/logging/testing\",\n         \"//packages/compiler-cli/src/ngtsc/testing\",\n-        \"//packages/localize/src/tools\",\n-        \"//packages/localize/src/tools/test:test_lib\",\n-        \"//packages/localize/src/tools/test/helpers\",\n+        \"//packages/localize/tools\",\n+        \"//packages/localize/tools/test:test_lib\",\n+        \"//packages/localize/tools/test/helpers\",\n     ],\n )\n "
        },
        {
            "sha": "5c331a7bb920cef3020460d2ff131aa3ef1f13a6",
            "filename": "packages/localize/tools/test/migrate/integration/main_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Fmigrate%2Fintegration%2Fmain_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Fmigrate%2Fintegration%2Fmain_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Fmigrate%2Fintegration%2Fmain_spec.ts?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -8,7 +8,7 @@\n import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {MockLogger} from '@angular/compiler-cli/src/ngtsc/logging/testing';\n import {loadTestDirectory} from '@angular/compiler-cli/src/ngtsc/testing';\n-import {migrateFiles} from '../../../src/migrate/main';\n+import {migrateFiles} from '../../../src/migrate/index';\n import {runInNativeFileSystem} from '../../helpers';\n \n runInNativeFileSystem(() => {"
        },
        {
            "sha": "c0ac0e20e2791645ddcc36eb933113e7a6d12fd7",
            "filename": "packages/localize/tools/test/translate/integration/BUILD.bazel",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Ftranslate%2Fintegration%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Ftranslate%2Fintegration%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Ftranslate%2Fintegration%2FBUILD.bazel?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -11,17 +11,17 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n         \"//packages/compiler-cli/src/ngtsc/testing\",\n-        \"//packages/localize/src/tools\",\n-        \"//packages/localize/src/tools/test/helpers\",\n+        \"//packages/localize/tools\",\n+        \"//packages/localize/tools/test/helpers\",\n     ],\n )\n \n jasmine_node_test(\n     name = \"integration\",\n     bootstrap = [\"//tools/testing:node_no_angular_es5\"],\n     data = [\n-        \"//packages/localize/src/tools/test/translate/integration/locales\",\n-        \"//packages/localize/src/tools/test/translate/integration/test_files\",\n+        \"//packages/localize/tools/test/translate/integration/locales\",\n+        \"//packages/localize/tools/test/translate/integration/test_files\",\n     ],\n     deps = [\n         \":test_lib\","
        },
        {
            "sha": "115206c324decd286e989b32a34afa78aadaf304",
            "filename": "packages/localize/tools/test/translate/integration/locales/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Flocales%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Flocales%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Flocales%2FBUILD.bazel?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -1,6 +1,6 @@\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\")\n \n-package(default_visibility = [\"//packages/localize/src/tools/test/translate/integration:__pkg__\"])\n+package(default_visibility = [\"//packages/localize/tools/test/translate/integration:__pkg__\"])\n \n # Use copy_to_bin since filegroup doesn't seem to work on Windows.\n copy_to_bin("
        },
        {
            "sha": "d5a13760369d74096db52efbd892a467b270833c",
            "filename": "packages/localize/tools/test/translate/integration/main_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Fmain_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Fmain_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Fmain_spec.ts?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -10,7 +10,7 @@ import {loadTestDirectory} from '@angular/compiler-cli/src/ngtsc/testing';\n import {resolve as realResolve} from 'path';\n \n import {Diagnostics} from '../../../src/diagnostics';\n-import {translateFiles} from '../../../src/translate/main';\n+import {translateFiles} from '../../../src/translate/index';\n import {getOutputPathFn} from '../../../src/translate/output_path';\n import {runInNativeFileSystem} from '../../helpers';\n "
        },
        {
            "sha": "0fd5804885799375cb06b14080338b3cbb5e50a8",
            "filename": "packages/localize/tools/test/translate/integration/test_files/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Ftest_files%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/packages%2Flocalize%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Ftest_files%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Ftools%2Ftest%2Ftranslate%2Fintegration%2Ftest_files%2FBUILD.bazel?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -1,6 +1,6 @@\n load(\"@build_bazel_rules_nodejs//:index.bzl\", \"copy_to_bin\")\n \n-package(default_visibility = [\"//packages/localize/src/tools/test/translate/integration:__pkg__\"])\n+package(default_visibility = [\"//packages/localize/tools/test/translate/integration:__pkg__\"])\n \n # Use copy_to_bin since filegroup doesn't seem to work on Windows.\n copy_to_bin("
        },
        {
            "sha": "ee07748fdb7b81d0ecffa46efb00f4138116a8d1",
            "filename": "tools/extract_typings_rule.bzl",
            "status": "renamed",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/tools%2Fextract_typings_rule.bzl",
            "raw_url": "https://github.com/angular/angular/raw/27535bfb79bdf029f3cf2fe9388e2f36ecb08acb/tools%2Fextract_typings_rule.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fextract_typings_rule.bzl?ref=27535bfb79bdf029f3cf2fe9388e2f36ecb08acb",
            "patch": "@@ -14,6 +14,7 @@ def _extract_typings_rule_impl(ctx):\n \n     return [DefaultInfo(files = depset(transitive = transitive_depsets))]\n \n+# TODO: Move into shared dev-infra package.\n extract_typings = rule(\n     implementation = _extract_typings_rule_impl,\n     doc = \"\"\"Rule that extracts all transitive typings of dependencies\"\"\",",
            "previous_filename": "packages/compiler-cli/extract_typings_rule.bzl"
        }
    ],
    "stats": {
        "total": 851,
        "additions": 478,
        "deletions": 373
    }
}