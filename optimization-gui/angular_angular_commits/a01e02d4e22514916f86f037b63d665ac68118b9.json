{
    "author": "gkalpak",
    "message": "refactor(docs-infra): remove obsolete way of disabling `DocViewer` animations (#43977)\n\nPreviously, there were two ways to disable view transition animations in\n`DocViewerComponent`: Using a `.no-animations` CSS class on the\n`<aio-doc-viewer>` element and setting the static\n`DocViewerComponent.animationsEnabled` property to `false`. The latter\nwas only used to disable animations for testing purposes.\n\nWith the recent introduction of `AppComponent.reducedMotion`, there is\nnow an easy way to disable animations in tests using the\n`.no-animations` class (which is applied by `AppComponent` based on the\nvalue of `AppComponent.reducedMotion`). Therefore, it is no longer\nnecessary to have `DocViewerComponent.animationEnabled`.\n\nThis commit removes the now obsolete `animationsEnalbed` property.\n\nPR Close #43977",
    "sha": "a01e02d4e22514916f86f037b63d665ac68118b9",
    "files": [
        {
            "sha": "f970c25f8eda01c050e012cac66a5a2e21101404",
            "filename": "aio/src/app/app.component.spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/a01e02d4e22514916f86f037b63d665ac68118b9/aio%2Fsrc%2Fapp%2Fapp.component.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/a01e02d4e22514916f86f037b63d665ac68118b9/aio%2Fsrc%2Fapp%2Fapp.component.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fapp.component.spec.ts?ref=a01e02d4e22514916f86f037b63d665ac68118b9",
            "patch": "@@ -76,15 +76,17 @@ describe('AppComponent', () => {\n \n \n   describe('with proper DocViewer', () => {\n+    const originalReducedMotion = AppComponent.reducedMotion;\n \n     beforeEach(async () => {\n-      DocViewerComponent.animationsEnabled = false;\n+      // Set `reducedMotion` to `true` to disable animations (such as view transitions) for the tests.\n+      AppComponent.reducedMotion = true;\n \n       createTestingModule('a/b');\n       await initializeTest();\n     });\n \n-    afterEach(() => DocViewerComponent.animationsEnabled = true);\n+    afterEach(() => AppComponent.reducedMotion = originalReducedMotion);\n \n     it('should create', () => {\n       expect(component).toBeDefined();"
        },
        {
            "sha": "5eaba0827b8fa6ff9d16427ba59d9bd69c5fe479",
            "filename": "aio/src/app/layout/doc-viewer/doc-viewer.component.spec.ts",
            "status": "modified",
            "additions": 121,
            "deletions": 128,
            "changes": 249,
            "blob_url": "https://github.com/angular/angular/blob/a01e02d4e22514916f86f037b63d665ac68118b9/aio%2Fsrc%2Fapp%2Flayout%2Fdoc-viewer%2Fdoc-viewer.component.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/a01e02d4e22514916f86f037b63d665ac68118b9/aio%2Fsrc%2Fapp%2Flayout%2Fdoc-viewer%2Fdoc-viewer.component.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Flayout%2Fdoc-viewer%2Fdoc-viewer.component.spec.ts?ref=a01e02d4e22514916f86f037b63d665ac68118b9",
            "patch": "@@ -594,146 +594,139 @@ describe('DocViewerComponent', () => {\n     });\n \n     [true, false].forEach(animationsEnabled => {\n-      describe(`(animationsEnabled: ${animationsEnabled})`, () => {\n-        beforeEach(() => DocViewerComponent.animationsEnabled = animationsEnabled);\n-        afterEach(() => DocViewerComponent.animationsEnabled = true);\n+      describe(`(animations enabled: ${animationsEnabled})`, () => {\n+        beforeEach(() => docViewerEl.classList[animationsEnabled ? 'remove' : 'add'](NO_ANIMATIONS));\n \n-        [true, false].forEach(noAnimations => {\n-          describe(`(.${NO_ANIMATIONS}: ${noAnimations})`, () => {\n-            beforeEach(() => docViewerEl.classList[noAnimations ? 'add' : 'remove'](NO_ANIMATIONS));\n+        it('should return an observable', done => {\n+          docViewer.swapViews().subscribe(done, done.fail);\n+        });\n+\n+        it('should swap the views', async () => {\n+          await doSwapViews();\n+\n+          expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n+          expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n+          expect(docViewer.currViewContainer).toBe(oldNextViewContainer);\n+          expect(docViewer.nextViewContainer).toBe(oldCurrViewContainer);\n+\n+          await doSwapViews();\n \n-            it('should return an observable', done => {\n-              docViewer.swapViews().subscribe(done, done.fail);\n-            });\n+          expect(docViewerEl.contains(oldCurrViewContainer)).toBe(true);\n+          expect(docViewerEl.contains(oldNextViewContainer)).toBe(false);\n+          expect(docViewer.currViewContainer).toBe(oldCurrViewContainer);\n+          expect(docViewer.nextViewContainer).toBe(oldNextViewContainer);\n+        });\n+\n+        it('should emit `docRemoved` after removing the leaving view', async () => {\n+          const onDocRemovedSpy = jasmine.createSpy('onDocRemoved').and.callFake(() => {\n+            expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n+            expect(docViewerEl.contains(oldNextViewContainer)).toBe(false);\n+          });\n \n-            it('should swap the views', async () => {\n-              await doSwapViews();\n+          docViewer.docRemoved.subscribe(onDocRemovedSpy);\n \n-              expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n-              expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n-              expect(docViewer.currViewContainer).toBe(oldNextViewContainer);\n-              expect(docViewer.nextViewContainer).toBe(oldCurrViewContainer);\n+          expect(docViewerEl.contains(oldCurrViewContainer)).toBe(true);\n+          expect(docViewerEl.contains(oldNextViewContainer)).toBe(false);\n \n-              await doSwapViews();\n+          await doSwapViews();\n \n-              expect(docViewerEl.contains(oldCurrViewContainer)).toBe(true);\n-              expect(docViewerEl.contains(oldNextViewContainer)).toBe(false);\n-              expect(docViewer.currViewContainer).toBe(oldCurrViewContainer);\n-              expect(docViewer.nextViewContainer).toBe(oldNextViewContainer);\n-            });\n+          expect(onDocRemovedSpy).toHaveBeenCalledTimes(1);\n+          expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n+          expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n+        });\n \n-            it('should emit `docRemoved` after removing the leaving view', async () => {\n-              const onDocRemovedSpy = jasmine.createSpy('onDocRemoved').and.callFake(() => {\n-                expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n-                expect(docViewerEl.contains(oldNextViewContainer)).toBe(false);\n-              });\n+        it('should not emit `docRemoved` if the leaving view is already removed', async () => {\n+          const onDocRemovedSpy = jasmine.createSpy('onDocRemoved');\n \n-              docViewer.docRemoved.subscribe(onDocRemovedSpy);\n-\n-              expect(docViewerEl.contains(oldCurrViewContainer)).toBe(true);\n-              expect(docViewerEl.contains(oldNextViewContainer)).toBe(false);\n-\n-              await doSwapViews();\n-\n-              expect(onDocRemovedSpy).toHaveBeenCalledTimes(1);\n-              expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n-              expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n-            });\n-\n-            it('should not emit `docRemoved` if the leaving view is already removed', async () => {\n-              const onDocRemovedSpy = jasmine.createSpy('onDocRemoved');\n-\n-              docViewer.docRemoved.subscribe(onDocRemovedSpy);\n-              docViewerEl.removeChild(oldCurrViewContainer);\n-\n-              await doSwapViews();\n-\n-              expect(onDocRemovedSpy).not.toHaveBeenCalled();\n-            });\n-\n-            it('should emit `docInserted` after inserting the entering view', async () => {\n-              const onDocInsertedSpy = jasmine.createSpy('onDocInserted').and.callFake(() => {\n-                expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n-                expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n-              });\n-\n-              docViewer.docInserted.subscribe(onDocInsertedSpy);\n-\n-              expect(docViewerEl.contains(oldCurrViewContainer)).toBe(true);\n-              expect(docViewerEl.contains(oldNextViewContainer)).toBe(false);\n-\n-              await doSwapViews();\n-\n-              expect(onDocInsertedSpy).toHaveBeenCalledTimes(1);\n-              expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n-              expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n-            });\n-\n-            it('should call the callback after inserting the entering view', async () => {\n-              const onInsertedCb = jasmine.createSpy('onInsertedCb').and.callFake(() => {\n-                expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n-                expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n-              });\n-              const onDocInsertedSpy = jasmine.createSpy('onDocInserted');\n-\n-              docViewer.docInserted.subscribe(onDocInsertedSpy);\n-\n-              expect(docViewerEl.contains(oldCurrViewContainer)).toBe(true);\n-              expect(docViewerEl.contains(oldNextViewContainer)).toBe(false);\n-\n-              await doSwapViews(onInsertedCb);\n-\n-              expect(onInsertedCb).toHaveBeenCalledTimes(1);\n-              expect(onInsertedCb).toHaveBeenCalledBefore(onDocInsertedSpy);\n-              expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n-              expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n-            });\n-\n-            it('should empty the previous view', async () => {\n-              await doSwapViews();\n-\n-              expect(docViewer.currViewContainer.innerHTML).toBe('Next view');\n-              expect(docViewer.nextViewContainer.innerHTML).toBe('');\n-\n-              docViewer.nextViewContainer.innerHTML = 'Next view 2';\n-              await doSwapViews();\n+          docViewer.docRemoved.subscribe(onDocRemovedSpy);\n+          docViewerEl.removeChild(oldCurrViewContainer);\n \n-              expect(docViewer.currViewContainer.innerHTML).toBe('Next view 2');\n-              expect(docViewer.nextViewContainer.innerHTML).toBe('');\n-            });\n+          await doSwapViews();\n \n-            if (animationsEnabled && !noAnimations) {\n-              // Only test this when there are animations. Without animations, the views are swapped\n-              // synchronously, so there is no need (or way) to abort.\n-              it('should abort swapping if the returned observable is unsubscribed from', async () => {\n-                docViewer.swapViews().subscribe().unsubscribe();\n-                await doSwapViews();\n-\n-                // Since the first call was cancelled, only one swapping should have taken place.\n-                expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n-                expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n-                expect(docViewer.currViewContainer).toBe(oldNextViewContainer);\n-                expect(docViewer.nextViewContainer).toBe(oldCurrViewContainer);\n-                expect(docViewer.currViewContainer.innerHTML).toBe('Next view');\n-                expect(docViewer.nextViewContainer.innerHTML).toBe('');\n-              });\n-            } else {\n-              it('should swap views synchronously when animations are disabled', () => {\n-                const cbSpy = jasmine.createSpy('cb');\n-\n-                docViewer.swapViews(cbSpy).subscribe();\n-\n-                expect(cbSpy).toHaveBeenCalledTimes(1);\n-                expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n-                expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n-                expect(docViewer.currViewContainer).toBe(oldNextViewContainer);\n-                expect(docViewer.nextViewContainer).toBe(oldCurrViewContainer);\n-                expect(docViewer.currViewContainer.innerHTML).toBe('Next view');\n-                expect(docViewer.nextViewContainer.innerHTML).toBe('');\n-              });\n-            }\n+          expect(onDocRemovedSpy).not.toHaveBeenCalled();\n+        });\n+\n+        it('should emit `docInserted` after inserting the entering view', async () => {\n+          const onDocInsertedSpy = jasmine.createSpy('onDocInserted').and.callFake(() => {\n+            expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n+            expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n           });\n+\n+          docViewer.docInserted.subscribe(onDocInsertedSpy);\n+\n+          expect(docViewerEl.contains(oldCurrViewContainer)).toBe(true);\n+          expect(docViewerEl.contains(oldNextViewContainer)).toBe(false);\n+\n+          await doSwapViews();\n+\n+          expect(onDocInsertedSpy).toHaveBeenCalledTimes(1);\n+          expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n+          expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n         });\n+\n+        it('should call the callback after inserting the entering view', async () => {\n+          const onInsertedCb = jasmine.createSpy('onInsertedCb').and.callFake(() => {\n+            expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n+            expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n+          });\n+          const onDocInsertedSpy = jasmine.createSpy('onDocInserted');\n+\n+          docViewer.docInserted.subscribe(onDocInsertedSpy);\n+\n+          expect(docViewerEl.contains(oldCurrViewContainer)).toBe(true);\n+          expect(docViewerEl.contains(oldNextViewContainer)).toBe(false);\n+\n+          await doSwapViews(onInsertedCb);\n+\n+          expect(onInsertedCb).toHaveBeenCalledTimes(1);\n+          expect(onInsertedCb).toHaveBeenCalledBefore(onDocInsertedSpy);\n+          expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n+          expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n+        });\n+\n+        it('should empty the previous view', async () => {\n+          await doSwapViews();\n+\n+          expect(docViewer.currViewContainer.innerHTML).toBe('Next view');\n+          expect(docViewer.nextViewContainer.innerHTML).toBe('');\n+\n+          docViewer.nextViewContainer.innerHTML = 'Next view 2';\n+          await doSwapViews();\n+\n+          expect(docViewer.currViewContainer.innerHTML).toBe('Next view 2');\n+          expect(docViewer.nextViewContainer.innerHTML).toBe('');\n+        });\n+\n+        if (animationsEnabled) {\n+          // Only test this when there are animations. Without animations, the views are swapped\n+          // synchronously, so there is no need (or way) to abort.\n+          it('should abort swapping if the returned observable is unsubscribed from', async () => {\n+            docViewer.swapViews().subscribe().unsubscribe();\n+            await doSwapViews();\n+\n+            // Since the first call was cancelled, only one swapping should have taken place.\n+            expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n+            expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n+            expect(docViewer.currViewContainer).toBe(oldNextViewContainer);\n+            expect(docViewer.nextViewContainer).toBe(oldCurrViewContainer);\n+            expect(docViewer.currViewContainer.innerHTML).toBe('Next view');\n+            expect(docViewer.nextViewContainer.innerHTML).toBe('');\n+          });\n+        } else {\n+          it('should swap views synchronously when animations are disabled', () => {\n+            const cbSpy = jasmine.createSpy('cb');\n+\n+            docViewer.swapViews(cbSpy).subscribe();\n+\n+            expect(cbSpy).toHaveBeenCalledTimes(1);\n+            expect(docViewerEl.contains(oldCurrViewContainer)).toBe(false);\n+            expect(docViewerEl.contains(oldNextViewContainer)).toBe(true);\n+            expect(docViewer.currViewContainer).toBe(oldNextViewContainer);\n+            expect(docViewer.nextViewContainer).toBe(oldCurrViewContainer);\n+            expect(docViewer.currViewContainer.innerHTML).toBe('Next view');\n+            expect(docViewer.nextViewContainer.innerHTML).toBe('');\n+          });\n+        }\n       });\n     });\n   });"
        },
        {
            "sha": "9a805f7608a84f0637257d1a14beceb50d5c9587",
            "filename": "aio/src/app/layout/doc-viewer/doc-viewer.component.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/a01e02d4e22514916f86f037b63d665ac68118b9/aio%2Fsrc%2Fapp%2Flayout%2Fdoc-viewer%2Fdoc-viewer.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/a01e02d4e22514916f86f037b63d665ac68118b9/aio%2Fsrc%2Fapp%2Flayout%2Fdoc-viewer%2Fdoc-viewer.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Flayout%2Fdoc-viewer%2Fdoc-viewer.component.ts?ref=a01e02d4e22514916f86f037b63d665ac68118b9",
            "patch": "@@ -26,9 +26,6 @@ const initialDocViewerContent = initialDocViewerElement ? fromInnerHTML(initialD\n   // encapsulation: ViewEncapsulation.ShadowDom\n })\n export class DocViewerComponent implements OnDestroy {\n-  // Enable/Disable view transition animations.\n-  static animationsEnabled = true;\n-\n   private hostElement: HTMLElement;\n \n   private void$ = of<void>(undefined);\n@@ -220,8 +217,7 @@ export class DocViewerComponent implements OnDestroy {\n     >;\n     const animateProp =\n         (elem: HTMLElement, prop: StringValueCSSStyleDeclaration, from: string, to: string, duration = 200) => {\n-          const animationsDisabled = !DocViewerComponent.animationsEnabled\n-                                     || this.hostElement.classList.contains(NO_ANIMATIONS);\n+          const animationsDisabled = this.hostElement.classList.contains(NO_ANIMATIONS);\n           elem.style.transition = '';\n           return animationsDisabled\n               ? this.void$.pipe(tap(() => elem.style[prop] = to))"
        }
    ],
    "stats": {
        "total": 261,
        "additions": 126,
        "deletions": 135
    }
}