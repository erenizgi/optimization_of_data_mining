{
    "author": "JoostK",
    "message": "refactor(compiler): remove some unused output AST types (#44411)\n\nThis kind of output is no longer emitted into generated code, so the\nsupporting output AST is removed.\n\nPR Close #44411",
    "sha": "f352c2bed9ea18926d5336d2dc5c9db8d04e97bb",
    "files": [
        {
            "sha": "7667f333f404451bd1f60c3d514a06c6ffce0826",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/translator.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/f352c2bed9ea18926d5336d2dc5c9db8d04e97bb/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "raw_url": "https://github.com/angular/angular/raw/f352c2bed9ea18926d5336d2dc5c9db8d04e97bb/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts?ref=f352c2bed9ea18926d5336d2dc5c9db8d04e97bb",
            "patch": "@@ -108,17 +108,6 @@ export class ExpressionTranslatorVisitor<TStatement, TExpression> implements o.E\n         stmt.leadingComments);\n   }\n \n-  visitTryCatchStmt(_stmt: o.TryCatchStmt, _context: Context): never {\n-    throw new Error('Method not implemented.');\n-  }\n-\n-  visitThrowStmt(stmt: o.ThrowStmt, context: Context): TStatement {\n-    return this.attachComments(\n-        this.factory.createThrowStatement(\n-            stmt.error.visitExpression(this, context.withExpressionMode)),\n-        stmt.leadingComments);\n-  }\n-\n   visitReadVarExpr(ast: o.ReadVarExpr, _context: Context): TExpression {\n     const identifier = this.factory.createIdentifier(ast.name!);\n     this.setSourceMapRange(identifier, ast.sourceSpan);"
        },
        {
            "sha": "327b5066400b8529dc1532b4f07343b05f47854d",
            "filename": "packages/compiler/src/compiler.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/f352c2bed9ea18926d5336d2dc5c9db8d04e97bb/packages%2Fcompiler%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/f352c2bed9ea18926d5336d2dc5c9db8d04e97bb/packages%2Fcompiler%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler.ts?ref=f352c2bed9ea18926d5336d2dc5c9db8d04e97bb",
            "patch": "@@ -53,7 +53,7 @@ export * from './ml_parser/tags';\n export {ParseTreeResult, TreeError} from './ml_parser/parser';\n export {LexerRange} from './ml_parser/lexer';\n export * from './ml_parser/xml_parser';\n-export {ArrayType, AssertNotNull, DYNAMIC_TYPE, BinaryOperator, BinaryOperatorExpr, BuiltinType, BuiltinTypeName, BuiltinVar, CastExpr, ClassField, ClassMethod, ClassStmt, CommaExpr, ConditionalExpr, DeclareFunctionStmt, DeclareVarStmt, Expression, ExpressionStatement, ExpressionType, ExpressionVisitor, ExternalExpr, ExternalReference, literalMap, FunctionExpr, IfStmt, InstantiateExpr, InvokeFunctionExpr, LiteralArrayExpr, LiteralExpr, LiteralMapExpr, MapType, NotExpr, NONE_TYPE, ReadKeyExpr, ReadPropExpr, ReadVarExpr, ReturnStatement, StatementVisitor, TaggedTemplateExpr, TemplateLiteral, TemplateLiteralElement, ThrowStmt, TryCatchStmt, Type, TypeVisitor, WrappedNodeExpr, WriteKeyExpr, WritePropExpr, WriteVarExpr, StmtModifier, Statement, STRING_TYPE, TypeofExpr, collectExternalReferences, jsDocComment, leadingComment, LeadingComment, JSDocComment, UnaryOperator, UnaryOperatorExpr, LocalizedString} from './output/output_ast';\n+export {ArrayType, AssertNotNull, DYNAMIC_TYPE, BinaryOperator, BinaryOperatorExpr, BuiltinType, BuiltinTypeName, CastExpr, ClassField, ClassMethod, ClassStmt, CommaExpr, ConditionalExpr, DeclareFunctionStmt, DeclareVarStmt, Expression, ExpressionStatement, ExpressionType, ExpressionVisitor, ExternalExpr, ExternalReference, literalMap, FunctionExpr, IfStmt, InstantiateExpr, InvokeFunctionExpr, LiteralArrayExpr, LiteralExpr, LiteralMapExpr, MapType, NotExpr, NONE_TYPE, ReadKeyExpr, ReadPropExpr, ReadVarExpr, ReturnStatement, StatementVisitor, TaggedTemplateExpr, TemplateLiteral, TemplateLiteralElement, Type, TypeVisitor, WrappedNodeExpr, WriteKeyExpr, WritePropExpr, WriteVarExpr, StmtModifier, Statement, STRING_TYPE, TypeofExpr, collectExternalReferences, jsDocComment, leadingComment, LeadingComment, JSDocComment, UnaryOperator, UnaryOperatorExpr, LocalizedString} from './output/output_ast';\n export {EmitterVisitorContext} from './output/abstract_emitter';\n export {JitEvaluator} from './output/output_jit';\n export * from './parse_util';"
        },
        {
            "sha": "65e70a9d91de56c73960c338665ea7f0e8b1d22d",
            "filename": "packages/compiler/src/output/abstract_emitter.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 32,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/f352c2bed9ea18926d5336d2dc5c9db8d04e97bb/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_emitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/f352c2bed9ea18926d5336d2dc5c9db8d04e97bb/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_emitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_emitter.ts?ref=f352c2bed9ea18926d5336d2dc5c9db8d04e97bb",
            "patch": "@@ -14,8 +14,6 @@ import {SourceMapGenerator} from './source_map';\n const _SINGLE_QUOTE_ESCAPE_STRING_RE = /'|\\\\|\\n|\\r|\\$/g;\n const _LEGAL_IDENTIFIER_RE = /^[$A-Z_][0-9A-Z_$]*$/i;\n const _INDENT_WITH = '  ';\n-export const CATCH_ERROR_VAR = o.variable('error', null, null);\n-export const CATCH_STACK_VAR = o.variable('stack', null, null);\n \n class _EmittedLine {\n   partsLength = 0;\n@@ -259,16 +257,6 @@ export abstract class AbstractEmitterVisitor implements o.StatementVisitor, o.Ex\n     return null;\n   }\n \n-  abstract visitTryCatchStmt(stmt: o.TryCatchStmt, ctx: EmitterVisitorContext): any;\n-\n-  visitThrowStmt(stmt: o.ThrowStmt, ctx: EmitterVisitorContext): any {\n-    this.printLeadingComments(stmt, ctx);\n-    ctx.print(stmt, `throw `);\n-    stmt.error.visitExpression(this, ctx);\n-    ctx.println(stmt, `;`);\n-    return null;\n-  }\n-\n   abstract visitDeclareVarStmt(stmt: o.DeclareVarStmt, ctx: EmitterVisitorContext): any;\n \n   visitWriteVarExpr(expr: o.WriteVarExpr, ctx: EmitterVisitorContext): any {\n@@ -338,26 +326,7 @@ export abstract class AbstractEmitterVisitor implements o.StatementVisitor, o.Ex\n     expr.expr.visitExpression(this, ctx);\n   }\n   visitReadVarExpr(ast: o.ReadVarExpr, ctx: EmitterVisitorContext): any {\n-    let varName = ast.name!;\n-    if (ast.builtin != null) {\n-      switch (ast.builtin) {\n-        case o.BuiltinVar.Super:\n-          varName = 'super';\n-          break;\n-        case o.BuiltinVar.This:\n-          varName = 'this';\n-          break;\n-        case o.BuiltinVar.CatchError:\n-          varName = CATCH_ERROR_VAR.name!;\n-          break;\n-        case o.BuiltinVar.CatchStack:\n-          varName = CATCH_STACK_VAR.name!;\n-          break;\n-        default:\n-          throw new Error(`Unknown builtin variable ${ast.builtin}`);\n-      }\n-    }\n-    ctx.print(ast, varName);\n+    ctx.print(ast, ast.name);\n     return null;\n   }\n   visitInstantiateExpr(ast: o.InstantiateExpr, ctx: EmitterVisitorContext): any {"
        },
        {
            "sha": "512ec43ed14e27c952832daa945e7e7096ed1025",
            "filename": "packages/compiler/src/output/abstract_js_emitter.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 45,
            "changes": 46,
            "blob_url": "https://github.com/angular/angular/blob/f352c2bed9ea18926d5336d2dc5c9db8d04e97bb/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_js_emitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/f352c2bed9ea18926d5336d2dc5c9db8d04e97bb/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_js_emitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Fabstract_js_emitter.ts?ref=f352c2bed9ea18926d5336d2dc5c9db8d04e97bb",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n \n-import {AbstractEmitterVisitor, CATCH_ERROR_VAR, CATCH_STACK_VAR, EmitterVisitorContext, escapeIdentifier} from './abstract_emitter';\n+import {AbstractEmitterVisitor, EmitterVisitorContext, escapeIdentifier} from './abstract_emitter';\n import * as o from './output_ast';\n \n /**\n@@ -91,17 +91,6 @@ export abstract class AbstractJsEmitterVisitor extends AbstractEmitterVisitor {\n     throw new Error('Cannot emit a WrappedNodeExpr in Javascript.');\n   }\n \n-  override visitReadVarExpr(ast: o.ReadVarExpr, ctx: EmitterVisitorContext): string|null {\n-    if (ast.builtin === o.BuiltinVar.This) {\n-      ctx.print(ast, 'self');\n-    } else if (ast.builtin === o.BuiltinVar.Super) {\n-      throw new Error(\n-          `'super' needs to be handled at a parent ast node, not at the variable level!`);\n-    } else {\n-      super.visitReadVarExpr(ast, ctx);\n-    }\n-    return null;\n-  }\n   override visitDeclareVarStmt(stmt: o.DeclareVarStmt, ctx: EmitterVisitorContext): any {\n     ctx.print(stmt, `var ${stmt.name}`);\n     if (stmt.value) {\n@@ -115,22 +104,6 @@ export abstract class AbstractJsEmitterVisitor extends AbstractEmitterVisitor {\n     ast.value.visitExpression(this, ctx);\n     return null;\n   }\n-  override visitInvokeFunctionExpr(expr: o.InvokeFunctionExpr, ctx: EmitterVisitorContext): string\n-      |null {\n-    const fnExpr = expr.fn;\n-    if (fnExpr instanceof o.ReadVarExpr && fnExpr.builtin === o.BuiltinVar.Super) {\n-      ctx.currentClass!.parent!.visitExpression(this, ctx);\n-      ctx.print(expr, `.call(this`);\n-      if (expr.args.length > 0) {\n-        ctx.print(expr, `, `);\n-        this.visitAllExpressions(expr.args, ctx, ',');\n-      }\n-      ctx.print(expr, `)`);\n-    } else {\n-      super.visitInvokeFunctionExpr(expr, ctx);\n-    }\n-    return null;\n-  }\n   override visitTaggedTemplateExpr(ast: o.TaggedTemplateExpr, ctx: EmitterVisitorContext): any {\n     // The following convoluted piece of code is effectively the downlevelled equivalent of\n     // ```\n@@ -172,23 +145,6 @@ export abstract class AbstractJsEmitterVisitor extends AbstractEmitterVisitor {\n     ctx.println(stmt, `}`);\n     return null;\n   }\n-  override visitTryCatchStmt(stmt: o.TryCatchStmt, ctx: EmitterVisitorContext): any {\n-    ctx.println(stmt, `try {`);\n-    ctx.incIndent();\n-    this.visitAllStatements(stmt.bodyStmts, ctx);\n-    ctx.decIndent();\n-    ctx.println(stmt, `} catch (${CATCH_ERROR_VAR.name}) {`);\n-    ctx.incIndent();\n-    const catchStmts =\n-        [<o.Statement>CATCH_STACK_VAR.set(CATCH_ERROR_VAR.prop('stack')).toDeclStmt(null, [\n-          o.StmtModifier.Final\n-        ])].concat(stmt.catchStmts);\n-    this.visitAllStatements(catchStmts, ctx);\n-    ctx.decIndent();\n-    ctx.println(stmt, `}`);\n-    return null;\n-  }\n-\n   override visitLocalizedString(ast: o.LocalizedString, ctx: EmitterVisitorContext): any {\n     // The following convoluted piece of code is effectively the downlevelled equivalent of\n     // ```"
        },
        {
            "sha": "63e9d8518cc95dde78a6072e18b4825b7297769a",
            "filename": "packages/compiler/src/output/output_ast.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 83,
            "changes": 85,
            "blob_url": "https://github.com/angular/angular/blob/f352c2bed9ea18926d5336d2dc5c9db8d04e97bb/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts",
            "raw_url": "https://github.com/angular/angular/raw/f352c2bed9ea18926d5336d2dc5c9db8d04e97bb/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Foutput%2Foutput_ast.ts?ref=f352c2bed9ea18926d5336d2dc5c9db8d04e97bb",
            "patch": "@@ -260,30 +260,13 @@ export abstract class Expression {\n   }\n }\n \n-export enum BuiltinVar {\n-  This,\n-  Super,\n-  CatchError,\n-  CatchStack\n-}\n-\n export class ReadVarExpr extends Expression {\n-  public name: string|null;\n-  public builtin: BuiltinVar|null;\n-\n-  constructor(name: string|BuiltinVar, type?: Type|null, sourceSpan?: ParseSourceSpan|null) {\n+  constructor(public name: string, type?: Type|null, sourceSpan?: ParseSourceSpan|null) {\n     super(type, sourceSpan);\n-    if (typeof name === 'string') {\n-      this.name = name;\n-      this.builtin = null;\n-    } else {\n-      this.name = null;\n-      this.builtin = name;\n-    }\n   }\n \n   override isEquivalent(e: Expression): boolean {\n-    return e instanceof ReadVarExpr && this.name === e.name && this.builtin === e.builtin;\n+    return e instanceof ReadVarExpr && this.name === e.name;\n   }\n \n   override isConstant() {\n@@ -295,9 +278,6 @@ export class ReadVarExpr extends Expression {\n   }\n \n   set(value: Expression): WriteVarExpr {\n-    if (!this.name) {\n-      throw new Error(`Built in variable ${this.builtin} can not be assigned to.`);\n-    }\n     return new WriteVarExpr(this.name, value, null, this.sourceSpan);\n   }\n }\n@@ -1007,10 +987,6 @@ export interface ExpressionVisitor {\n   visitTypeofExpr(ast: TypeofExpr, context: any): any;\n }\n \n-export const THIS_EXPR = new ReadVarExpr(BuiltinVar.This, null, null);\n-export const SUPER_EXPR = new ReadVarExpr(BuiltinVar.Super, null, null);\n-export const CATCH_ERROR_VAR = new ReadVarExpr(BuiltinVar.CatchError, null, null);\n-export const CATCH_STACK_VAR = new ReadVarExpr(BuiltinVar.CatchStack, null, null);\n export const NULL_EXPR = new LiteralExpr(null, null, null);\n export const TYPED_NULL_EXPR = new LiteralExpr(null, INFERRED_TYPE, null);\n \n@@ -1205,45 +1181,13 @@ export class IfStmt extends Statement {\n   }\n }\n \n-export class TryCatchStmt extends Statement {\n-  constructor(\n-      public bodyStmts: Statement[], public catchStmts: Statement[],\n-      sourceSpan: ParseSourceSpan|null = null, leadingComments?: LeadingComment[]) {\n-    super([], sourceSpan, leadingComments);\n-  }\n-  override isEquivalent(stmt: Statement): boolean {\n-    return stmt instanceof TryCatchStmt && areAllEquivalent(this.bodyStmts, stmt.bodyStmts) &&\n-        areAllEquivalent(this.catchStmts, stmt.catchStmts);\n-  }\n-  override visitStatement(visitor: StatementVisitor, context: any): any {\n-    return visitor.visitTryCatchStmt(this, context);\n-  }\n-}\n-\n-\n-export class ThrowStmt extends Statement {\n-  constructor(\n-      public error: Expression, sourceSpan: ParseSourceSpan|null = null,\n-      leadingComments?: LeadingComment[]) {\n-    super([], sourceSpan, leadingComments);\n-  }\n-  override isEquivalent(stmt: ThrowStmt): boolean {\n-    return stmt instanceof TryCatchStmt && this.error.isEquivalent(stmt.error);\n-  }\n-  override visitStatement(visitor: StatementVisitor, context: any): any {\n-    return visitor.visitThrowStmt(this, context);\n-  }\n-}\n-\n export interface StatementVisitor {\n   visitDeclareVarStmt(stmt: DeclareVarStmt, context: any): any;\n   visitDeclareFunctionStmt(stmt: DeclareFunctionStmt, context: any): any;\n   visitExpressionStmt(stmt: ExpressionStatement, context: any): any;\n   visitReturnStmt(stmt: ReturnStatement, context: any): any;\n   visitDeclareClassStmt(stmt: ClassStmt, context: any): any;\n   visitIfStmt(stmt: IfStmt, context: any): any;\n-  visitTryCatchStmt(stmt: TryCatchStmt, context: any): any;\n-  visitThrowStmt(stmt: ThrowStmt, context: any): any;\n }\n \n export class AstTransformer implements StatementVisitor, ExpressionVisitor {\n@@ -1478,22 +1422,6 @@ export class AstTransformer implements StatementVisitor, ExpressionVisitor {\n         context);\n   }\n \n-  visitTryCatchStmt(stmt: TryCatchStmt, context: any): any {\n-    return this.transformStmt(\n-        new TryCatchStmt(\n-            this.visitAllStatements(stmt.bodyStmts, context),\n-            this.visitAllStatements(stmt.catchStmts, context), stmt.sourceSpan,\n-            stmt.leadingComments),\n-        context);\n-  }\n-\n-  visitThrowStmt(stmt: ThrowStmt, context: any): any {\n-    return this.transformStmt(\n-        new ThrowStmt(\n-            stmt.error.visitExpression(this, context), stmt.sourceSpan, stmt.leadingComments),\n-        context);\n-  }\n-\n   visitAllStatements(stmts: Statement[], context: any): Statement[] {\n     return stmts.map(stmt => stmt.visitStatement(this, context));\n   }\n@@ -1672,15 +1600,6 @@ export class RecursiveAstVisitor implements StatementVisitor, ExpressionVisitor\n     this.visitAllStatements(stmt.falseCase, context);\n     return stmt;\n   }\n-  visitTryCatchStmt(stmt: TryCatchStmt, context: any): any {\n-    this.visitAllStatements(stmt.bodyStmts, context);\n-    this.visitAllStatements(stmt.catchStmts, context);\n-    return stmt;\n-  }\n-  visitThrowStmt(stmt: ThrowStmt, context: any): any {\n-    stmt.error.visitExpression(this, context);\n-    return stmt;\n-  }\n   visitAllStatements(stmts: Statement[], context: any): void {\n     stmts.forEach(stmt => stmt.visitStatement(this, context));\n   }"
        }
    ],
    "stats": {
        "total": 177,
        "additions": 5,
        "deletions": 172
    }
}