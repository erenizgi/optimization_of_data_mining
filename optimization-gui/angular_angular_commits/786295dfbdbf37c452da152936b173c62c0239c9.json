{
    "author": "atscott",
    "message": "refactor(compiler-cli): Add nameSpan to SafePropertyRead TCB (#39768)\n\nIn order to map the a safe property read's method access in the type check block\ndirectly back to the property in the template source, we need to\ninclude the `SafePropertyRead`'s `nameSpan` with the `ts.propertyAccess` for\nthe pipe's transform method.\n\nNote that this is specifically relevant to the Language Service's \"find\nreferences\" feature. As an example, with something like `{{a?.value}}`,\nwhen calling \"find references\" on the 'value' we want the text\nspan of the reference to just be `value` rather than the entire source\n`a?.value`.\n\nPR Close #39768",
    "sha": "786295dfbdbf37c452da152936b173c62c0239c9",
    "files": [
        {
            "sha": "51469e76b1c9dcc7f1b39b96cbeb807ad232949e",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/expression.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/786295dfbdbf37c452da152936b173c62c0239c9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fexpression.ts",
            "raw_url": "https://github.com/angular/angular/raw/786295dfbdbf37c452da152936b173c62c0239c9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fexpression.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fexpression.ts?ref=786295dfbdbf37c452da152936b173c62c0239c9",
            "patch": "@@ -309,6 +309,7 @@ class AstTranslator implements AstVisitor {\n       // \"a?.b\" becomes (null as any ? a!.b : undefined)\n       // The type of this expression is (typeof a!.b) | undefined, which is exactly as desired.\n       const expr = ts.createPropertyAccess(ts.createNonNullExpression(receiver), ast.name);\n+      addParseSpanInfo(expr, ast.nameSpan);\n       node = ts.createParen(ts.createConditional(NULL_AS_ANY, expr, UNDEFINED));\n     } else if (VeSafeLhsInferenceBugDetector.veWillInferAnyFor(ast)) {\n       // Emulate a View Engine bug where 'any' is inferred for the left-hand side of the safe\n@@ -322,6 +323,7 @@ class AstTranslator implements AstVisitor {\n       // result is still inferred as `any`.\n       // \"a?.b\" becomes (a!.b as any)\n       const expr = ts.createPropertyAccess(ts.createNonNullExpression(receiver), ast.name);\n+      addParseSpanInfo(expr, ast.nameSpan);\n       node = tsCastToAny(expr);\n     }\n     addParseSpanInfo(node, ast.sourceSpan);"
        },
        {
            "sha": "47e1183dbb3c0e327d8d73be6ff734763a355b22",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/span_comments_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/786295dfbdbf37c452da152936b173c62c0239c9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/786295dfbdbf37c452da152936b173c62c0239c9/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts?ref=786295dfbdbf37c452da152936b173c62c0239c9",
            "patch": "@@ -116,7 +116,8 @@ describe('type check blocks diagnostics', () => {\n     it('should annotate safe property access', () => {\n       const TEMPLATE = `{{ a?.b }}`;\n       expect(tcbWithSpans(TEMPLATE))\n-          .toContain('((null as any) ? (((ctx).a /*3,4*/) /*3,4*/)!.b : undefined) /*3,7*/');\n+          .toContain(\n+              '((null as any) ? (((ctx).a /*3,4*/) /*3,4*/)!.b /*6,7*/ : undefined) /*3,7*/');\n     });\n \n     it('should annotate safe method calls', () => {"
        }
    ],
    "stats": {
        "total": 5,
        "additions": 4,
        "deletions": 1
    }
}