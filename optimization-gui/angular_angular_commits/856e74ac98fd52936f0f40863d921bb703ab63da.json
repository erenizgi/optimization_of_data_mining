{
    "author": "petebacondarwin",
    "message": "refactor(compiler-cli): remove undesirable cast in the type translator (#38775)\n\nThe cast to `ts.Identifier` was a hack that \"just happened to work\".\nThe new approach is more robust and doesn't have to undermine\nthe type checker.\n\nPR Close #38775",
    "sha": "856e74ac98fd52936f0f40863d921bb703ab63da",
    "files": [
        {
            "sha": "0c40567378d8d84085d4be1824517177971b299f",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/translator.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/856e74ac98fd52936f0f40863d921bb703ab63da/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "raw_url": "https://github.com/angular/angular/raw/856e74ac98fd52936f0f40863d921bb703ab63da/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts?ref=856e74ac98fd52936f0f40863d921bb703ab63da",
            "patch": "@@ -742,9 +742,12 @@ export class TypeTranslatorVisitor implements ExpressionVisitor, TypeVisitor {\n   }\n \n   visitTypeofExpr(ast: TypeofExpr, context: Context): ts.TypeQueryNode {\n-    let expr = translateExpression(\n-        ast.expr, this.imports, NOOP_DEFAULT_IMPORT_RECORDER, ts.ScriptTarget.ES2015);\n-    return ts.createTypeQueryNode(expr as ts.Identifier);\n+    const typeNode = this.translateExpression(ast.expr, context);\n+    if (!ts.isTypeReferenceNode(typeNode)) {\n+      throw new Error(`The target of a typeof expression must be a type reference, but it was\n+          ${ts.SyntaxKind[typeNode.kind]}`);\n+    }\n+    return ts.createTypeQueryNode(typeNode.typeName);\n   }\n \n   private translateType(type: Type, context: Context): ts.TypeNode {"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 6,
        "deletions": 3
    }
}