{
    "author": "sonukapoor",
    "message": "test(docs-infra): improve typeahead example and add unit test (#34190)\n\nThis commit improves the typeahead example, by using the emitted input\nvalue. It also adds a unit test to ensure that the example is working\nas intended.\n\nPR Close #34190",
    "sha": "44074499dc74465cf19d5378af6f1aa05fe585dd",
    "files": [
        {
            "sha": "285dd7e12e302bd920461f42801e67cb32aab396",
            "filename": "aio/content/examples/practical-observable-usage/src/typeahead.spec.ts",
            "status": "added",
            "additions": 72,
            "deletions": 0,
            "changes": 72,
            "blob_url": "https://github.com/angular/angular/blob/44074499dc74465cf19d5378af6f1aa05fe585dd/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Ftypeahead.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/44074499dc74465cf19d5378af6f1aa05fe585dd/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Ftypeahead.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Ftypeahead.spec.ts?ref=44074499dc74465cf19d5378af6f1aa05fe585dd",
            "patch": "@@ -0,0 +1,72 @@\n+import { of } from 'rxjs';\n+import { docRegionTypeahead } from './typeahead';\n+\n+describe('typeahead', () => {\n+  let document;\n+  let ajax;\n+  let triggertInputChange;\n+\n+  beforeEach(() => {\n+    jasmine.clock().install();\n+    const input = {\n+      addEventListener: jasmine\n+        .createSpy('addEvent')\n+        .and.callFake((eventName: string, cb: (e) => void) => {\n+          if (eventName === 'input') {\n+            triggertInputChange = cb;\n+          }\n+        }),\n+      removeEventListener: jasmine.createSpy('removeEvent'),\n+    };\n+\n+    document = { getElementById: (id: string) => input };\n+    ajax = jasmine.createSpy('ajax').and.callFake((url: string) => of('foo bar'));\n+  });\n+\n+  afterEach(() => {\n+    jasmine.clock().uninstall();\n+  });\n+\n+  it('should make an ajax call to the corrent endpoint', () => {\n+    docRegionTypeahead(document, ajax);\n+    triggertInputChange({ target: { value: 'foo' } });\n+    jasmine.clock().tick(11);\n+    expect(ajax).toHaveBeenCalledWith('/api/endpoint?search=foo');\n+  });\n+\n+  it('should not make an ajax call, when the input length < 3', () => {\n+    docRegionTypeahead(document, ajax);\n+    triggertInputChange({ target: { value: '' } });\n+    jasmine.clock().tick(11);\n+    expect(ajax).not.toHaveBeenCalled();\n+    triggertInputChange({ target: { value: 'fo' } });\n+    jasmine.clock().tick(11);\n+    expect(ajax).not.toHaveBeenCalled();\n+  });\n+\n+  it('should not make an ajax call for intermediate values when debouncing', () => {\n+    docRegionTypeahead(document, ajax);\n+    triggertInputChange({ target: { value: 'foo' } });\n+    jasmine.clock().tick(9);\n+    triggertInputChange({ target: { value: 'bar' } });\n+    jasmine.clock().tick(9);\n+    triggertInputChange({ target: { value: 'baz' } });\n+    jasmine.clock().tick(9);\n+    triggertInputChange({ target: { value: 'qux' } });\n+    expect(ajax).not.toHaveBeenCalled();\n+    jasmine.clock().tick(10);\n+    expect(ajax).toHaveBeenCalledTimes(1);\n+    expect(ajax).toHaveBeenCalledWith('/api/endpoint?search=qux');\n+  });\n+\n+  it('should not make an ajax call, when the input value has not changed', () => {\n+    docRegionTypeahead(document, ajax);\n+    triggertInputChange({ target: { value: 'foo' } });\n+    jasmine.clock().tick(11);\n+    expect(ajax).toHaveBeenCalled();\n+    ajax.calls.reset();\n+    triggertInputChange({ target: { value: 'foo' } });\n+    jasmine.clock().tick(11);\n+    expect(ajax).not.toHaveBeenCalled();\n+  });\n+});"
        },
        {
            "sha": "adbddd66c44682edc34f2b2c3b946814a9a61a97",
            "filename": "aio/content/examples/practical-observable-usage/src/typeahead.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 14,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/44074499dc74465cf19d5378af6f1aa05fe585dd/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Ftypeahead.ts",
            "raw_url": "https://github.com/angular/angular/raw/44074499dc74465cf19d5378af6f1aa05fe585dd/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Ftypeahead.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Ftypeahead.ts?ref=44074499dc74465cf19d5378af6f1aa05fe585dd",
            "patch": "@@ -1,18 +1,32 @@\n-import { fromEvent } from 'rxjs';\n-import { ajax } from 'rxjs/ajax';\n-import { debounceTime, distinctUntilChanged, filter, map, switchMap } from 'rxjs/operators';\n+/*\n+  Because of how the code is merged together using the doc regions,\n+  we need to indent the imports with the function below.\n+*/\n+// #docplaster\n+// #docregion\n+  import { fromEvent } from 'rxjs';\n+  import { ajax } from 'rxjs/ajax';\n+  import { debounceTime, distinctUntilChanged, filter, map, switchMap } from 'rxjs/operators';\n \n+// #enddocregion\n+/* tslint:disable:no-shadowed-variable */\n+/* tslint:disable:align */\n+export function docRegionTypeahead(document, ajax) {\n+  // #docregion\n+  const searchBox = document.getElementById('search-box');\n \n-const searchBox = document.getElementById('search-box');\n+  const typeahead = fromEvent(searchBox, 'input').pipe(\n+    map((e: KeyboardEvent) => (e.target as HTMLInputElement).value),\n+    filter(text => text.length > 2),\n+    debounceTime(10),\n+    distinctUntilChanged(),\n+    switchMap(searchTerm => ajax(`/api/endpoint?search=${searchTerm}`))\n+  );\n \n-const typeahead = fromEvent(searchBox, 'input').pipe(\n-  map((e: KeyboardEvent) => (e.target as HTMLInputElement).value),\n-  filter(text => text.length > 2),\n-  debounceTime(10),\n-  distinctUntilChanged(),\n-  switchMap(() => ajax('/api/endpoint'))\n-);\n+  typeahead.subscribe(data => {\n+    // Handle the data from the API\n+  });\n \n-typeahead.subscribe(data => {\n- // Handle the data from the API\n-});\n+  // #enddocregion\n+  return typeahead;\n+}"
        }
    ],
    "stats": {
        "total": 114,
        "additions": 100,
        "deletions": 14
    }
}