{
    "author": "petebacondarwin",
    "message": "refactor(compiler): move the line-ending handling decision (#38581)\n\nPreviously the lexer was responsible for deciding whether an \"inline\"\ntemplate should also have its line-endings normalized.\n\nNow this decision is made higher up in the call stack to allow more\nflexibility in the parser/lexer.\n\nPR Close #38581",
    "sha": "86e11f11103a2441340f230e019d2a97a36c7022",
    "files": [
        {
            "sha": "93f9061144d054a4292f6641f850f1d0c048c965",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/component.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/86e11f11103a2441340f230e019d2a97a36c7022/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/86e11f11103a2441340f230e019d2a97a36c7022/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts?ref=86e11f11103a2441340f230e019d2a97a36c7022",
            "patch": "@@ -771,14 +771,17 @@ export class ComponentDecoratorHandler implements\n       interpolation = InterpolationConfig.fromArray(value as [string, string]);\n     }\n \n+    // We always normalize line endings if the template has been escaped (i.e. is inline).\n+    const i18nNormalizeLineEndingsInICUs = escapedString || this.i18nNormalizeLineEndingsInICUs;\n+\n     const {errors, nodes: emitNodes, styleUrls, styles, ngContentSelectors} =\n         parseTemplate(templateStr, templateUrl, {\n           preserveWhitespaces,\n           interpolationConfig: interpolation,\n           range: templateRange,\n           escapedString,\n           enableI18nLegacyMessageIdFormat: this.enableI18nLegacyMessageIdFormat,\n-          i18nNormalizeLineEndingsInICUs: this.i18nNormalizeLineEndingsInICUs,\n+          i18nNormalizeLineEndingsInICUs,\n         });\n \n     // Unfortunately, the primary parse of the template above may not contain accurate source map\n@@ -800,7 +803,7 @@ export class ComponentDecoratorHandler implements\n       range: templateRange,\n       escapedString,\n       enableI18nLegacyMessageIdFormat: this.enableI18nLegacyMessageIdFormat,\n-      i18nNormalizeLineEndingsInICUs: this.i18nNormalizeLineEndingsInICUs,\n+      i18nNormalizeLineEndingsInICUs,\n       leadingTriviaChars: [],\n     });\n "
        },
        {
            "sha": "c6e7242b9ffbd2b26bc36d571aafb19a1256d5af",
            "filename": "packages/compiler/src/ml_parser/lexer.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/86e11f11103a2441340f230e019d2a97a36c7022/packages%2Fcompiler%2Fsrc%2Fml_parser%2Flexer.ts",
            "raw_url": "https://github.com/angular/angular/raw/86e11f11103a2441340f230e019d2a97a36c7022/packages%2Fcompiler%2Fsrc%2Fml_parser%2Flexer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fml_parser%2Flexer.ts?ref=86e11f11103a2441340f230e019d2a97a36c7022",
            "patch": "@@ -642,13 +642,11 @@ class _Tokenizer {\n     this._beginToken(TokenType.RAW_TEXT);\n     const condition = this._readUntil(chars.$COMMA);\n     const normalizedCondition = this._processCarriageReturns(condition);\n-    if (this._escapedString || this._i18nNormalizeLineEndingsInICUs) {\n-      // Either the template is inline or,\n-      // we explicitly want to normalize line endings for this text.\n+    if (this._i18nNormalizeLineEndingsInICUs) {\n+      // We explicitly want to normalize line endings for this text.\n       this._endToken([normalizedCondition]);\n     } else {\n-      // The expression is in an external template and, for backward compatibility,\n-      // we are not normalizing line endings.\n+      // We are not normalizing line endings.\n       const conditionToken = this._endToken([condition]);\n       if (normalizedCondition !== condition) {\n         this.nonNormalizedIcuExpressions.push(conditionToken);"
        },
        {
            "sha": "f6a67701b496c6e6e6985c603edb836e07951594",
            "filename": "packages/compiler/test/ml_parser/html_parser_spec.ts",
            "status": "modified",
            "additions": 124,
            "deletions": 55,
            "changes": 179,
            "blob_url": "https://github.com/angular/angular/blob/86e11f11103a2441340f230e019d2a97a36c7022/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_parser_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/86e11f11103a2441340f230e019d2a97a36c7022/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_parser_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_parser_spec.ts?ref=86e11f11103a2441340f230e019d2a97a36c7022",
            "patch": "@@ -332,40 +332,75 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn} from './ast_spe\n           ]);\n         });\n \n-        it('should normalize line-endings in expansion forms in inline templates', () => {\n-          const parsed = parser.parse(\n-              `<div>\\r\\n` +\n-                  `  {\\r\\n` +\n-                  `    messages.length,\\r\\n` +\n-                  `    plural,\\r\\n` +\n-                  `    =0 {You have \\r\\nno\\r\\n messages}\\r\\n` +\n-                  `    =1 {One {{message}}}}\\r\\n` +\n-                  `</div>`,\n-              'TestComp', {\n-                tokenizeExpansionForms: true,\n-                escapedString: true,\n-              });\n+        it('should normalize line-endings in expansion forms in inline templates if `i18nNormalizeLineEndingsInICUs` is true',\n+           () => {\n+             const parsed = parser.parse(\n+                 `<div>\\r\\n` +\n+                     `  {\\r\\n` +\n+                     `    messages.length,\\r\\n` +\n+                     `    plural,\\r\\n` +\n+                     `    =0 {You have \\r\\nno\\r\\n messages}\\r\\n` +\n+                     `    =1 {One {{message}}}}\\r\\n` +\n+                     `</div>`,\n+                 'TestComp', {\n+                   tokenizeExpansionForms: true,\n+                   escapedString: true,\n+                   i18nNormalizeLineEndingsInICUs: true,\n+                 });\n \n-          expect(humanizeDom(parsed)).toEqual([\n-            [html.Element, 'div', 0],\n-            [html.Text, '\\n  ', 1],\n-            [html.Expansion, '\\n    messages.length', 'plural', 1],\n-            [html.ExpansionCase, '=0', 2],\n-            [html.ExpansionCase, '=1', 2],\n-            [html.Text, '\\n', 1],\n-          ]);\n-          const cases = (<any>parsed.rootNodes[0]).children[1].cases;\n+             expect(humanizeDom(parsed)).toEqual([\n+               [html.Element, 'div', 0],\n+               [html.Text, '\\n  ', 1],\n+               [html.Expansion, '\\n    messages.length', 'plural', 1],\n+               [html.ExpansionCase, '=0', 2],\n+               [html.ExpansionCase, '=1', 2],\n+               [html.Text, '\\n', 1],\n+             ]);\n+             const cases = (<any>parsed.rootNodes[0]).children[1].cases;\n \n-          expect(humanizeDom(new ParseTreeResult(cases[0].expression, []))).toEqual([\n-            [html.Text, 'You have \\nno\\n messages', 0],\n-          ]);\n+             expect(humanizeDom(new ParseTreeResult(cases[0].expression, []))).toEqual([\n+               [html.Text, 'You have \\nno\\n messages', 0],\n+             ]);\n \n-          expect(humanizeDom(new ParseTreeResult(cases[1].expression, []))).toEqual([\n-            [html.Text, 'One {{message}}', 0]\n-          ]);\n+             expect(humanizeDom(new ParseTreeResult(cases[1].expression, []))).toEqual([\n+               [html.Text, 'One {{message}}', 0]\n+             ]);\n \n-          expect(parsed.errors).toEqual([]);\n-        });\n+             expect(parsed.errors).toEqual([]);\n+           });\n+\n+        it('should not normalize line-endings in ICU expressions in external templates when `i18nNormalizeLineEndingsInICUs` is not set',\n+           () => {\n+             const parsed = parser.parse(\n+                 `<div>\\r\\n` +\n+                     `  {\\r\\n` +\n+                     `    messages.length,\\r\\n` +\n+                     `    plural,\\r\\n` +\n+                     `    =0 {You have \\r\\nno\\r\\n messages}\\r\\n` +\n+                     `    =1 {One {{message}}}}\\r\\n` +\n+                     `</div>`,\n+                 'TestComp', {tokenizeExpansionForms: true, escapedString: true});\n+\n+             expect(humanizeDom(parsed)).toEqual([\n+               [html.Element, 'div', 0],\n+               [html.Text, '\\n  ', 1],\n+               [html.Expansion, '\\r\\n    messages.length', 'plural', 1],\n+               [html.ExpansionCase, '=0', 2],\n+               [html.ExpansionCase, '=1', 2],\n+               [html.Text, '\\n', 1],\n+             ]);\n+             const cases = (<any>parsed.rootNodes[0]).children[1].cases;\n+\n+             expect(humanizeDom(new ParseTreeResult(cases[0].expression, []))).toEqual([\n+               [html.Text, 'You have \\nno\\n messages', 0],\n+             ]);\n+\n+             expect(humanizeDom(new ParseTreeResult(cases[1].expression, []))).toEqual([\n+               [html.Text, 'One {{message}}', 0]\n+             ]);\n+\n+             expect(parsed.errors).toEqual([]);\n+           });\n \n         it('should normalize line-endings in expansion forms in external templates if `i18nNormalizeLineEndingsInICUs` is true',\n            () => {\n@@ -468,33 +503,67 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn} from './ast_spe\n           ]);\n         });\n \n-        it('should normalize line endings in nested expansion forms for inline templates', () => {\n-          const parsed = parser.parse(\n-              `{\\r\\n` +\n-                  `  messages.length, plural,\\r\\n` +\n-                  `  =0 { zero \\r\\n` +\n-                  `       {\\r\\n` +\n-                  `         p.gender, select,\\r\\n` +\n-                  `         male {m}\\r\\n` +\n-                  `       }\\r\\n` +\n-                  `     }\\r\\n` +\n-                  `}`,\n-              'TestComp', {tokenizeExpansionForms: true, escapedString: true});\n-          expect(humanizeDom(parsed)).toEqual([\n-            [html.Expansion, '\\n  messages.length', 'plural', 0],\n-            [html.ExpansionCase, '=0', 1],\n-          ]);\n+        it('should normalize line endings in nested expansion forms for inline templates, when `i18nNormalizeLineEndingsInICUs` is true',\n+           () => {\n+             const parsed = parser.parse(\n+                 `{\\r\\n` +\n+                     `  messages.length, plural,\\r\\n` +\n+                     `  =0 { zero \\r\\n` +\n+                     `       {\\r\\n` +\n+                     `         p.gender, select,\\r\\n` +\n+                     `         male {m}\\r\\n` +\n+                     `       }\\r\\n` +\n+                     `     }\\r\\n` +\n+                     `}`,\n+                 'TestComp', {\n+                   tokenizeExpansionForms: true,\n+                   escapedString: true,\n+                   i18nNormalizeLineEndingsInICUs: true\n+                 });\n+             expect(humanizeDom(parsed)).toEqual([\n+               [html.Expansion, '\\n  messages.length', 'plural', 0],\n+               [html.ExpansionCase, '=0', 1],\n+             ]);\n \n-          const expansion = parsed.rootNodes[0] as html.Expansion;\n-          expect(humanizeDom(new ParseTreeResult(expansion.cases[0].expression, []))).toEqual([\n-            [html.Text, 'zero \\n       ', 0],\n-            [html.Expansion, '\\n         p.gender', 'select', 0],\n-            [html.ExpansionCase, 'male', 1],\n-            [html.Text, '\\n     ', 0],\n-          ]);\n+             const expansion = parsed.rootNodes[0] as html.Expansion;\n+             expect(humanizeDom(new ParseTreeResult(expansion.cases[0].expression, []))).toEqual([\n+               [html.Text, 'zero \\n       ', 0],\n+               [html.Expansion, '\\n         p.gender', 'select', 0],\n+               [html.ExpansionCase, 'male', 1],\n+               [html.Text, '\\n     ', 0],\n+             ]);\n \n-          expect(parsed.errors).toEqual([]);\n-        });\n+             expect(parsed.errors).toEqual([]);\n+           });\n+\n+        it('should not normalize line endings in nested expansion forms for inline templates, when `i18nNormalizeLineEndingsInICUs` is not defined',\n+           () => {\n+             const parsed = parser.parse(\n+                 `{\\r\\n` +\n+                     `  messages.length, plural,\\r\\n` +\n+                     `  =0 { zero \\r\\n` +\n+                     `       {\\r\\n` +\n+                     `         p.gender, select,\\r\\n` +\n+                     `         male {m}\\r\\n` +\n+                     `       }\\r\\n` +\n+                     `     }\\r\\n` +\n+                     `}`,\n+                 'TestComp', {tokenizeExpansionForms: true, escapedString: true});\n+             expect(humanizeDom(parsed)).toEqual([\n+               [html.Expansion, '\\r\\n  messages.length', 'plural', 0],\n+               [html.ExpansionCase, '=0', 1],\n+             ]);\n+\n+             const expansion = parsed.rootNodes[0] as html.Expansion;\n+             expect(humanizeDom(new ParseTreeResult(expansion.cases[0].expression, []))).toEqual([\n+               [html.Text, 'zero \\n       ', 0],\n+               [html.Expansion, '\\r\\n         p.gender', 'select', 0],\n+               [html.ExpansionCase, 'male', 1],\n+               [html.Text, '\\n     ', 0],\n+             ]);\n+\n+             expect(parsed.errors).toEqual([]);\n+           });\n \n         it('should not normalize line endings in nested expansion forms for external templates, when `i18nNormalizeLineEndingsInICUs` is not set',\n            () => {"
        },
        {
            "sha": "f2a650a558a84feb27999c6d6a73db4038ff92fb",
            "filename": "packages/compiler/test/ml_parser/lexer_spec.ts",
            "status": "modified",
            "additions": 104,
            "deletions": 65,
            "changes": 169,
            "blob_url": "https://github.com/angular/angular/blob/86e11f11103a2441340f230e019d2a97a36c7022/packages%2Fcompiler%2Ftest%2Fml_parser%2Flexer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/86e11f11103a2441340f230e019d2a97a36c7022/packages%2Fcompiler%2Ftest%2Fml_parser%2Flexer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fml_parser%2Flexer_spec.ts?ref=86e11f11103a2441340f230e019d2a97a36c7022",
            "patch": "@@ -885,75 +885,114 @@ import {ParseLocation, ParseSourceFile, ParseSourceSpan} from '../../src/parse_u\n \n       describe('[line ending normalization', () => {\n         describe('{escapedString: true}', () => {\n-          it('should normalize line-endings in expansion forms', () => {\n-            const result = tokenizeWithoutErrors(\n-                `{\\r\\n` +\n-                    `    messages.length,\\r\\n` +\n-                    `    plural,\\r\\n` +\n-                    `    =0 {You have \\r\\nno\\r\\n messages}\\r\\n` +\n-                    `    =1 {One {{message}}}}\\r\\n`,\n-                {\n-                  tokenizeExpansionForms: true,\n-                  escapedString: true,\n-                });\n-\n-            expect(humanizeParts(result.tokens)).toEqual([\n-              [lex.TokenType.EXPANSION_FORM_START],\n-              [lex.TokenType.RAW_TEXT, '\\n    messages.length'],\n-              [lex.TokenType.RAW_TEXT, 'plural'],\n-              [lex.TokenType.EXPANSION_CASE_VALUE, '=0'],\n-              [lex.TokenType.EXPANSION_CASE_EXP_START],\n-              [lex.TokenType.TEXT, 'You have \\nno\\n messages'],\n-              [lex.TokenType.EXPANSION_CASE_EXP_END],\n-              [lex.TokenType.EXPANSION_CASE_VALUE, '=1'],\n-              [lex.TokenType.EXPANSION_CASE_EXP_START],\n-              [lex.TokenType.TEXT, 'One {{message}}'],\n-              [lex.TokenType.EXPANSION_CASE_EXP_END],\n-              [lex.TokenType.EXPANSION_FORM_END],\n-              [lex.TokenType.TEXT, '\\n'],\n-              [lex.TokenType.EOF],\n-            ]);\n+          it('should normalize line-endings in expansion forms if `i18nNormalizeLineEndingsInICUs` is true',\n+             () => {\n+               const result = tokenizeWithoutErrors(\n+                   `{\\r\\n` +\n+                       `    messages.length,\\r\\n` +\n+                       `    plural,\\r\\n` +\n+                       `    =0 {You have \\r\\nno\\r\\n messages}\\r\\n` +\n+                       `    =1 {One {{message}}}}\\r\\n`,\n+                   {\n+                     tokenizeExpansionForms: true,\n+                     escapedString: true,\n+                     i18nNormalizeLineEndingsInICUs: true\n+                   });\n \n-            expect(result.nonNormalizedIcuExpressions).toEqual([]);\n-          });\n-\n-          it('should normalize line endings in nested expansion forms for inline templates', () => {\n-            const result = tokenizeWithoutErrors(\n-                `{\\r\\n` +\n-                    `  messages.length, plural,\\r\\n` +\n-                    `  =0 { zero \\r\\n` +\n-                    `       {\\r\\n` +\n-                    `         p.gender, select,\\r\\n` +\n-                    `         male {m}\\r\\n` +\n-                    `       }\\r\\n` +\n-                    `     }\\r\\n` +\n-                    `}`,\n-                {tokenizeExpansionForms: true, escapedString: true});\n-            expect(humanizeParts(result.tokens)).toEqual([\n-              [lex.TokenType.EXPANSION_FORM_START],\n-              [lex.TokenType.RAW_TEXT, '\\n  messages.length'],\n-              [lex.TokenType.RAW_TEXT, 'plural'],\n-              [lex.TokenType.EXPANSION_CASE_VALUE, '=0'],\n-              [lex.TokenType.EXPANSION_CASE_EXP_START],\n-              [lex.TokenType.TEXT, 'zero \\n       '],\n+               expect(humanizeParts(result.tokens)).toEqual([\n+                 [lex.TokenType.EXPANSION_FORM_START],\n+                 [lex.TokenType.RAW_TEXT, '\\n    messages.length'],\n+                 [lex.TokenType.RAW_TEXT, 'plural'],\n+                 [lex.TokenType.EXPANSION_CASE_VALUE, '=0'],\n+                 [lex.TokenType.EXPANSION_CASE_EXP_START],\n+                 [lex.TokenType.TEXT, 'You have \\nno\\n messages'],\n+                 [lex.TokenType.EXPANSION_CASE_EXP_END],\n+                 [lex.TokenType.EXPANSION_CASE_VALUE, '=1'],\n+                 [lex.TokenType.EXPANSION_CASE_EXP_START],\n+                 [lex.TokenType.TEXT, 'One {{message}}'],\n+                 [lex.TokenType.EXPANSION_CASE_EXP_END],\n+                 [lex.TokenType.EXPANSION_FORM_END],\n+                 [lex.TokenType.TEXT, '\\n'],\n+                 [lex.TokenType.EOF],\n+               ]);\n \n-              [lex.TokenType.EXPANSION_FORM_START],\n-              [lex.TokenType.RAW_TEXT, '\\n         p.gender'],\n-              [lex.TokenType.RAW_TEXT, 'select'],\n-              [lex.TokenType.EXPANSION_CASE_VALUE, 'male'],\n-              [lex.TokenType.EXPANSION_CASE_EXP_START],\n-              [lex.TokenType.TEXT, 'm'],\n-              [lex.TokenType.EXPANSION_CASE_EXP_END],\n-              [lex.TokenType.EXPANSION_FORM_END],\n+               expect(result.nonNormalizedIcuExpressions).toEqual([]);\n+             });\n \n-              [lex.TokenType.TEXT, '\\n     '],\n-              [lex.TokenType.EXPANSION_CASE_EXP_END],\n-              [lex.TokenType.EXPANSION_FORM_END],\n-              [lex.TokenType.EOF],\n-            ]);\n+          it('should not normalize line-endings in ICU expressions when `i18nNormalizeLineEndingsInICUs` is not defined',\n+             () => {\n+               const result = tokenizeWithoutErrors(\n+                   `{\\r\\n` +\n+                       `    messages.length,\\r\\n` +\n+                       `    plural,\\r\\n` +\n+                       `    =0 {You have \\r\\nno\\r\\n messages}\\r\\n` +\n+                       `    =1 {One {{message}}}}\\r\\n`,\n+                   {tokenizeExpansionForms: true, escapedString: true});\n \n-            expect(result.nonNormalizedIcuExpressions).toEqual([]);\n-          });\n+               expect(humanizeParts(result.tokens)).toEqual([\n+                 [lex.TokenType.EXPANSION_FORM_START],\n+                 [lex.TokenType.RAW_TEXT, '\\r\\n    messages.length'],\n+                 [lex.TokenType.RAW_TEXT, 'plural'],\n+                 [lex.TokenType.EXPANSION_CASE_VALUE, '=0'],\n+                 [lex.TokenType.EXPANSION_CASE_EXP_START],\n+                 [lex.TokenType.TEXT, 'You have \\nno\\n messages'],\n+                 [lex.TokenType.EXPANSION_CASE_EXP_END],\n+                 [lex.TokenType.EXPANSION_CASE_VALUE, '=1'],\n+                 [lex.TokenType.EXPANSION_CASE_EXP_START],\n+                 [lex.TokenType.TEXT, 'One {{message}}'],\n+                 [lex.TokenType.EXPANSION_CASE_EXP_END],\n+                 [lex.TokenType.EXPANSION_FORM_END],\n+                 [lex.TokenType.TEXT, '\\n'],\n+                 [lex.TokenType.EOF],\n+               ]);\n+\n+               expect(result.nonNormalizedIcuExpressions!.length).toBe(1);\n+               expect(result.nonNormalizedIcuExpressions![0].sourceSpan.toString())\n+                   .toEqual('\\r\\n    messages.length');\n+             });\n+\n+          it('should not normalize line endings in nested expansion forms when `i18nNormalizeLineEndingsInICUs` is not defined',\n+             () => {\n+               const result = tokenizeWithoutErrors(\n+                   `{\\r\\n` +\n+                       `  messages.length, plural,\\r\\n` +\n+                       `  =0 { zero \\r\\n` +\n+                       `       {\\r\\n` +\n+                       `         p.gender, select,\\r\\n` +\n+                       `         male {m}\\r\\n` +\n+                       `       }\\r\\n` +\n+                       `     }\\r\\n` +\n+                       `}`,\n+                   {tokenizeExpansionForms: true, escapedString: true});\n+               expect(humanizeParts(result.tokens)).toEqual([\n+                 [lex.TokenType.EXPANSION_FORM_START],\n+                 [lex.TokenType.RAW_TEXT, '\\r\\n  messages.length'],\n+                 [lex.TokenType.RAW_TEXT, 'plural'],\n+                 [lex.TokenType.EXPANSION_CASE_VALUE, '=0'],\n+                 [lex.TokenType.EXPANSION_CASE_EXP_START],\n+                 [lex.TokenType.TEXT, 'zero \\n       '],\n+\n+                 [lex.TokenType.EXPANSION_FORM_START],\n+                 [lex.TokenType.RAW_TEXT, '\\r\\n         p.gender'],\n+                 [lex.TokenType.RAW_TEXT, 'select'],\n+                 [lex.TokenType.EXPANSION_CASE_VALUE, 'male'],\n+                 [lex.TokenType.EXPANSION_CASE_EXP_START],\n+                 [lex.TokenType.TEXT, 'm'],\n+                 [lex.TokenType.EXPANSION_CASE_EXP_END],\n+                 [lex.TokenType.EXPANSION_FORM_END],\n+\n+                 [lex.TokenType.TEXT, '\\n     '],\n+                 [lex.TokenType.EXPANSION_CASE_EXP_END],\n+                 [lex.TokenType.EXPANSION_FORM_END],\n+                 [lex.TokenType.EOF],\n+               ]);\n+\n+               expect(result.nonNormalizedIcuExpressions!.length).toBe(2);\n+               expect(result.nonNormalizedIcuExpressions![0].sourceSpan.toString())\n+                   .toEqual('\\r\\n  messages.length');\n+               expect(result.nonNormalizedIcuExpressions![1].sourceSpan.toString())\n+                   .toEqual('\\r\\n         p.gender');\n+             });\n         });\n \n         describe('{escapedString: false}', () => {"
        }
    ],
    "stats": {
        "total": 363,
        "additions": 236,
        "deletions": 127
    }
}