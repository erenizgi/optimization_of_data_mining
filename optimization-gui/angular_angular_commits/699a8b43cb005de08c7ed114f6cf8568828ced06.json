{
    "author": "crisbeto",
    "message": "test(compiler-cli): add additional safe keyed read tests (#42421)\n\nThis commit adds some tests that were mistakenly omitted from the original\nchange for safe keyed reads/writes.\n\nPR Close #42421",
    "sha": "699a8b43cb005de08c7ed114f6cf8568828ced06",
    "files": [
        {
            "sha": "0c153b47f7a89345aa093c274f6d2888d7e80a7e",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/span_comments_spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/699a8b43cb005de08c7ed114f6cf8568828ced06/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/699a8b43cb005de08c7ed114f6cf8568828ced06/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts?ref=699a8b43cb005de08c7ed114f6cf8568828ced06",
            "patch": "@@ -129,6 +129,13 @@ describe('type check blocks diagnostics', () => {\n               '(null as any ? (((ctx).a /*3,4*/) /*3,4*/)!.method /*6,12*/(((ctx).b /*13,14*/) /*13,14*/) : undefined) /*3,15*/');\n     });\n \n+    it('should annotate safe keyed reads', () => {\n+      const TEMPLATE = `{{ a?.[0] }}`;\n+      expect(tcbWithSpans(TEMPLATE))\n+          .toContain(\n+              '(null as any ? (((ctx).a /*3,4*/) /*3,4*/)![0 /*7,8*/] /*3,9*/ : undefined) /*3,9*/');\n+    });\n+\n     it('should annotate $any casts', () => {\n       const TEMPLATE = `{{ $any(a) }}`;\n       expect(tcbWithSpans(TEMPLATE)).toContain('(((ctx).a /*8,9*/) /*8,9*/ as any) /*3,10*/');"
        },
        {
            "sha": "290da7d875119642d9d0ca43035a0f983b99e789",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/type_checker__get_symbol_of_template_node_spec.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/699a8b43cb005de08c7ed114f6cf8568828ced06/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_checker__get_symbol_of_template_node_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/699a8b43cb005de08c7ed114f6cf8568828ced06/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_checker__get_symbol_of_template_node_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_checker__get_symbol_of_template_node_spec.ts?ref=699a8b43cb005de08c7ed114f6cf8568828ced06",
            "patch": "@@ -394,6 +394,7 @@ runInEachFileSystem(() => {\n         <div [inputA]=\"person?.address?.street\"></div>\n         <div [inputA]=\"person ? person.address : noPersonError\"></div>\n         <div [inputA]=\"person?.speak()\"></div>\n+        <div [inputA]=\"person?.cars?.[1].engine\"></div>\n       `;\n           const testValues = setup(\n               [\n@@ -405,9 +406,14 @@ runInEachFileSystem(() => {\n                 street: string;\n               }\n \n+              interface Car {\n+                engine: string;\n+              }\n+\n               interface Person {\n                 address: Address;\n                 speak(): string;\n+                cars?: Car[];\n               }\n               export class Cmp {person?: Person; noPersonError = 'no person'}\n             `,\n@@ -448,6 +454,19 @@ runInEachFileSystem(() => {\n               .toEqual('string | undefined');\n         });\n \n+        it('safe keyed reads', () => {\n+          const nodes = getAstElements(templateTypeChecker, cmp);\n+          const safeKeyedRead = nodes[3].inputs[0].value as ASTWithSource;\n+          const keyedReadSymbol = templateTypeChecker.getSymbolOfNode(safeKeyedRead, cmp)!;\n+          assertExpressionSymbol(keyedReadSymbol);\n+          expect(program.getTypeChecker().symbolToString(keyedReadSymbol.tsSymbol!))\n+              .toEqual('engine');\n+          expect((keyedReadSymbol.tsSymbol!.declarations![0] as ts.PropertyDeclaration)\n+                     .parent.name!.getText())\n+              .toEqual('Car');\n+          expect(program.getTypeChecker().typeToString(keyedReadSymbol.tsType)).toEqual('string');\n+        });\n+\n         it('ternary expressions', () => {\n           const nodes = getAstElements(templateTypeChecker, cmp);\n "
        },
        {
            "sha": "a23b9dd350aa8df6ee636b5505609d0888e8327f",
            "filename": "packages/language-service/ivy/test/quick_info_spec.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/699a8b43cb005de08c7ed114f6cf8568828ced06/packages%2Flanguage-service%2Fivy%2Ftest%2Fquick_info_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/699a8b43cb005de08c7ed114f6cf8568828ced06/packages%2Flanguage-service%2Fivy%2Ftest%2Fquick_info_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fquick_info_spec.ts?ref=699a8b43cb005de08c7ed114f6cf8568828ced06",
            "patch": "@@ -357,6 +357,20 @@ describe('quick info', () => {\n           expectedDisplayString: '(variable) name: { readonly name: \"name\"; }'\n         });\n       });\n+\n+      it('should work for safe keyed reads', () => {\n+        expectQuickInfo({\n+          templateOverride: `<div>{{constNames?.[0¦]}}</div>`,\n+          expectedSpanText: '0',\n+          expectedDisplayString: '(property) 0: {\\n    readonly name: \"name\";\\n}'\n+        });\n+\n+        expectQuickInfo({\n+          templateOverride: `<div>{{constNames?.[0]?.na¦me}}</div>`,\n+          expectedSpanText: 'constNames?.[0]?.name',\n+          expectedDisplayString: '(property) name: \"name\"'\n+        });\n+      });\n     });\n \n     describe('pipes', () => {"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 40,
        "deletions": 0
    }
}