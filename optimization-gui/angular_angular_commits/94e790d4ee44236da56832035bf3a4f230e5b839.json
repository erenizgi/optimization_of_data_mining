{
    "author": "krzysztof-grzybek",
    "message": "fix(compiler): report better error on interpolation in an expression (#30300)\n\nCompiler results in weird error message when encounters interpolation inside\nexisting expression context, e.g. *ngIf=\"name {{ name }}\"\n\nPR Close #30300",
    "sha": "94e790d4ee44236da56832035bf3a4f230e5b839",
    "files": [
        {
            "sha": "958f7e12304dbb73ae7ab2e31e0d951ed58df432",
            "filename": "packages/compiler/src/expression_parser/parser.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/94e790d4ee44236da56832035bf3a4f230e5b839/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts",
            "raw_url": "https://github.com/angular/angular/raw/94e790d4ee44236da56832035bf3a4f230e5b839/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts?ref=94e790d4ee44236da56832035bf3a4f230e5b839",
            "patch": "@@ -974,7 +974,8 @@ export class _ParseAST {\n         } else {\n           // Otherwise the key must be a directive keyword, like \"of\". Transform\n           // the key to actual key. Eg. of -> ngForOf, trackBy -> ngForTrackBy\n-          key.source = templateKey.source + key.source[0].toUpperCase() + key.source.substring(1);\n+          key.source =\n+              templateKey.source + key.source.charAt(0).toUpperCase() + key.source.substring(1);\n           bindings.push(...this.parseDirectiveKeywordBindings(key));\n         }\n       }"
        },
        {
            "sha": "0bc5323920fe10ba2c541a988bfc590ad2f1f917",
            "filename": "packages/compiler/test/expression_parser/parser_spec.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 5,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/94e790d4ee44236da56832035bf3a4f230e5b839/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/94e790d4ee44236da56832035bf3a4f230e5b839/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts?ref=94e790d4ee44236da56832035bf3a4f230e5b839",
            "patch": "@@ -779,6 +779,14 @@ describe('parser', () => {\n         ]);\n       });\n \n+      it('should report unexpected token when encountering interpolation', () => {\n+        const attr = '*ngIf=\"name && {{name}}\"';\n+\n+        expectParseTemplateBindingsError(\n+            attr,\n+            'Parser Error: Unexpected token {, expected identifier, keyword, or string at column 10 in [name && {{name}}] in foo.html');\n+      });\n+\n       it('should map variable declaration via \"as\"', () => {\n         const attr =\n             '*ngFor=\"let item; of items | slice:0:1 as collection, trackBy: func; index as i\"';\n@@ -1026,17 +1034,25 @@ function parseBinding(text: string, location: any = null, offset: number = 0): A\n }\n \n function parseTemplateBindings(attribute: string, templateUrl = 'foo.html'): TemplateBinding[] {\n+  const result = _parseTemplateBindings(attribute, templateUrl);\n+  expect(result.errors).toEqual([]);\n+  expect(result.warnings).toEqual([]);\n+  return result.templateBindings;\n+}\n+\n+function expectParseTemplateBindingsError(attribute: string, error: string) {\n+  const result = _parseTemplateBindings(attribute, 'foo.html');\n+  expect(result.errors[0].message).toEqual(error);\n+}\n+\n+function _parseTemplateBindings(attribute: string, templateUrl: string) {\n   const match = attribute.match(/^\\*(.+)=\"(.*)\"$/);\n   expect(match).toBeTruthy(`failed to extract key and value from ${attribute}`);\n   const [_, key, value] = match;\n   const absKeyOffset = 1;  // skip the * prefix\n   const absValueOffset = attribute.indexOf('=') + '=\"'.length;\n   const parser = createParser();\n-  const result =\n-      parser.parseTemplateBindings(key, value, templateUrl, absKeyOffset, absValueOffset);\n-  expect(result.errors).toEqual([]);\n-  expect(result.warnings).toEqual([]);\n-  return result.templateBindings;\n+  return parser.parseTemplateBindings(key, value, templateUrl, absKeyOffset, absValueOffset);\n }\n \n function parseInterpolation(text: string, location: any = null, offset: number = 0): ASTWithSource|"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 23,
        "deletions": 6
    }
}