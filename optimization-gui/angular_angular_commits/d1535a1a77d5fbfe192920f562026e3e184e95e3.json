{
    "author": "atscott",
    "message": "test(language-service): remove circular dependency (#40966)\n\nThis commit removes the circular dependency from buffer->util->project->buffer.\n\nPR Close #40966",
    "sha": "d1535a1a77d5fbfe192920f562026e3e184e95e3",
    "files": [
        {
            "sha": "41e8b4bf2b975f22e8aad9010e9a9032680477c4",
            "filename": "packages/language-service/ivy/test/quick_info_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d1535a1a77d5fbfe192920f562026e3e184e95e3/packages%2Flanguage-service%2Fivy%2Ftest%2Fquick_info_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d1535a1a77d5fbfe192920f562026e3e184e95e3/packages%2Flanguage-service%2Fivy%2Ftest%2Fquick_info_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fquick_info_spec.ts?ref=d1535a1a77d5fbfe192920f562026e3e184e95e3",
            "patch": "@@ -9,7 +9,7 @@\n import {initMockFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n \n import * as ts from 'typescript/lib/tsserverlibrary';\n-import {extractCursorInfo, LanguageServiceTestEnv, Project} from '../testing';\n+import {LanguageServiceTestEnv, Project} from '../testing';\n \n function quickInfoSkeleton(): {[fileName: string]: string} {\n   return {\n@@ -516,7 +516,7 @@ describe('quick info', () => {\n       {templateOverride, expectedSpanText, expectedDisplayString}:\n           {templateOverride: string, expectedSpanText: string, expectedDisplayString: string}):\n       ts.QuickInfo {\n-    const {text} = extractCursorInfo(templateOverride);\n+    const text = templateOverride.replace('¦', '');\n     const template = project.openFile('app.html');\n     template.contents = text;\n     env.expectNoSourceDiagnostics();"
        },
        {
            "sha": "ebe6ff11fac2135d09dbab8303efb5dd1f7cd8e8",
            "filename": "packages/language-service/ivy/test/type_definitions_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d1535a1a77d5fbfe192920f562026e3e184e95e3/packages%2Flanguage-service%2Fivy%2Ftest%2Ftype_definitions_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d1535a1a77d5fbfe192920f562026e3e184e95e3/packages%2Flanguage-service%2Fivy%2Ftest%2Ftype_definitions_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Ftype_definitions_spec.ts?ref=d1535a1a77d5fbfe192920f562026e3e184e95e3",
            "patch": "@@ -8,7 +8,7 @@\n \n import {initMockFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n \n-import {extractCursorInfo, humanizeDocumentSpanLike, LanguageServiceTestEnv, Project} from '../testing';\n+import {humanizeDocumentSpanLike, LanguageServiceTestEnv, Project} from '../testing';\n \n describe('type definitions', () => {\n   let env: LanguageServiceTestEnv;\n@@ -42,7 +42,7 @@ describe('type definitions', () => {\n \n   function getTypeDefinitionsAndAssertBoundSpan(\n       project: Project, {templateOverride}: {templateOverride: string}) {\n-    const {text} = extractCursorInfo(templateOverride);\n+    const text = templateOverride.replace('¦', '');\n     const template = project.openFile('app.html');\n     template.contents = text;\n     env.expectNoSourceDiagnostics();"
        },
        {
            "sha": "da6d0a2b9f8857a476e5e1b2744bba6f423bdd00",
            "filename": "packages/language-service/ivy/testing/src/buffer.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 2,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/d1535a1a77d5fbfe192920f562026e3e184e95e3/packages%2Flanguage-service%2Fivy%2Ftesting%2Fsrc%2Fbuffer.ts",
            "raw_url": "https://github.com/angular/angular/raw/d1535a1a77d5fbfe192920f562026e3e184e95e3/packages%2Flanguage-service%2Fivy%2Ftesting%2Fsrc%2Fbuffer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftesting%2Fsrc%2Fbuffer.ts?ref=d1535a1a77d5fbfe192920f562026e3e184e95e3",
            "patch": "@@ -9,8 +9,6 @@\n import * as ts from 'typescript/lib/tsserverlibrary';\n import {LanguageService} from '../../language_service';\n \n-import {extractCursorInfo} from './util';\n-\n /**\n  * A file that is currently open in the `ts.Project`, with a cursor position.\n  */\n@@ -101,3 +99,19 @@ export class OpenBuffer {\n     return this.ngLS.getRenameInfo(this.scriptInfo.fileName, this._cursor);\n   }\n }\n+\n+/**\n+ * Given a text snippet which contains exactly one cursor symbol ('¦'), extract both the offset of\n+ * that cursor within the text as well as the text snippet without the cursor.\n+ */\n+function extractCursorInfo(textWithCursor: string): {cursor: number, text: string} {\n+  const cursor = textWithCursor.indexOf('¦');\n+  if (cursor === -1 || textWithCursor.indexOf('¦', cursor + 1) !== -1) {\n+    throw new Error(`Expected to find exactly one cursor symbol '¦'`);\n+  }\n+\n+  return {\n+    cursor,\n+    text: textWithCursor.substr(0, cursor) + textWithCursor.substr(cursor + 1),\n+  };\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "b763c77f4def39439369978997023baa08d7d7f8",
            "filename": "packages/language-service/ivy/testing/src/util.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 25,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/d1535a1a77d5fbfe192920f562026e3e184e95e3/packages%2Flanguage-service%2Fivy%2Ftesting%2Fsrc%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/d1535a1a77d5fbfe192920f562026e3e184e95e3/packages%2Flanguage-service%2Fivy%2Ftesting%2Fsrc%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftesting%2Fsrc%2Futil.ts?ref=d1535a1a77d5fbfe192920f562026e3e184e95e3",
            "patch": "@@ -5,34 +5,9 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFrom} from '@angular/compiler-cli/src/ngtsc/file_system';\n-import {TestFile} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import {LanguageServiceTestEnv} from './env';\n import {Project, ProjectFiles, TestableOptions} from './project';\n \n-/**\n- * Given a text snippet which contains exactly one cursor symbol ('¦'), extract both the offset of\n- * that cursor within the text as well as the text snippet without the cursor.\n- */\n-export function extractCursorInfo(textWithCursor: string): {cursor: number, text: string} {\n-  const cursor = textWithCursor.indexOf('¦');\n-  if (cursor === -1 || textWithCursor.indexOf('¦', cursor + 1) !== -1) {\n-    throw new Error(`Expected to find exactly one cursor symbol '¦'`);\n-  }\n-\n-  return {\n-    cursor,\n-    text: textWithCursor.substr(0, cursor) + textWithCursor.substr(cursor + 1),\n-  };\n-}\n-\n-function last<T>(array: T[]): T {\n-  if (array.length === 0) {\n-    throw new Error(`last() called on empty array`);\n-  }\n-  return array[array.length - 1];\n-}\n-\n /**\n  * Expect that a list of objects with a `fileName` property matches a set of expected files by only\n  * comparing the file names and not any path prefixes.\n@@ -120,3 +95,10 @@ type Stringy<T> = {\n export function getText(contents: string, textSpan: ts.TextSpan) {\n   return contents.substr(textSpan.start, textSpan.length);\n }\n+\n+function last<T>(array: T[]): T {\n+  if (array.length === 0) {\n+    throw new Error(`last() called on empty array`);\n+  }\n+  return array[array.length - 1];\n+}\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 58,
        "additions": 27,
        "deletions": 31
    }
}