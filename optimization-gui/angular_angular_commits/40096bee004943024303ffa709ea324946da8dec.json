{
    "author": "JiaLiPassion",
    "message": "fix(zone.js): run tests in umd format (#37582)\n\nSince the `defineProperty` not swallow error any longer, now the tests compile\nsource code in `commonjs` mode, and the code generated includes the code like this\n```\nObject.defineProperty(exports, \"__esModule\", {value: true});\n```\n\nAnd the `exports` is undefined in some browsers, but the error is swallowed before\nthis PR, and all tests run successfully, but it is not correct behavior. After this PR,\nthe code above failed. So we need to compile the source code in `umd` mode.\n\nPR Close #37582",
    "sha": "40096bee004943024303ffa709ea324946da8dec",
    "files": [
        {
            "sha": "77c82697202a6fce9379f9ece391944d84431d1d",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/40096bee004943024303ffa709ea324946da8dec/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/angular/angular/raw/40096bee004943024303ffa709ea324946da8dec/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.circleci%2Fconfig.yml?ref=40096bee004943024303ffa709ea324946da8dec",
            "patch": "@@ -653,8 +653,10 @@ jobs:\n           name: Starting Saucelabs tunnel service\n           command: ./tools/saucelabs/sauce-service.sh run\n           background: true\n-      - run: yarn tsc -p packages\n-      - run: yarn tsc -p modules\n+      # add module umd tsc compile option so the test can work\n+      # properly in the legacy browsers\n+      - run: yarn tsc -p packages --module UMD\n+      - run: yarn tsc -p modules --module UMD\n       - run: yarn bazel build //packages/zone.js:npm_package\n       # Build test fixtures for a test that rely on Bazel-generated fixtures. Note that disabling\n       # specific tests which are reliant on such generated fixtures is not an option as SystemJS"
        },
        {
            "sha": "a053487aac41da4e6f3f0c8694419d715ec54ed6",
            "filename": "packages/zone.js/lib/browser/define-property.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/40096bee004943024303ffa709ea324946da8dec/packages%2Fzone.js%2Flib%2Fbrowser%2Fdefine-property.ts",
            "raw_url": "https://github.com/angular/angular/raw/40096bee004943024303ffa709ea324946da8dec/packages%2Fzone.js%2Flib%2Fbrowser%2Fdefine-property.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Flib%2Fbrowser%2Fdefine-property.ts?ref=40096bee004943024303ffa709ea324946da8dec",
            "patch": "@@ -16,8 +16,6 @@ let _defineProperty: any;\n let _getOwnPropertyDescriptor: any;\n let _create: any;\n let unconfigurablesKey: any;\n-const registerElementsCallbacks =\n-    ['createdCallback', 'attachedCallback', 'detachedCallback', 'attributeChangedCallback'];\n \n export function propertyPatch() {\n   zoneSymbol = Zone.__symbol__;\n@@ -105,9 +103,11 @@ function _tryDefineProperty(obj: any, prop: string, desc: any, originalConfigura\n         return _defineProperty(obj, prop, desc);\n       } catch (error) {\n         let swallowError = false;\n-        if (typeof document !== 'undefined' && obj === document &&\n-            registerElementsCallbacks.find(c => c === prop)) {\n+        if (prop === 'createdCallback' || prop === 'attachedCallback' ||\n+            prop === 'detachedCallback' || prop === 'attributeChangedCallback') {\n           // We only swallow the error in registerElement patch\n+          // this is the work around since some applications\n+          // fail if we throw the error\n           swallowError = true;\n         }\n         if (!swallowError) {"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 8,
        "deletions": 6
    }
}