{
    "author": "alan-agius4",
    "message": "fix(dev-infra): allow npm like scopes as commit message scopes (#41430)\n\nIn the CLI and Universal, we use the package name as commit message scope. The recent changes that introduced `conventional-commits-parser` in https://github.com/angular/angular/pull/41286 breaks the parsing of such commit scopes and caused commit validations to fail.\n\nExample: https://app.circleci.com/pipelines/github/angular/angular-cli/14420/workflows/85feb5c9-184f-4088-b924-6b9e6c91f062/jobs/238446/parallel-runs/0/steps/0-102\n\nPR Close #41430",
    "sha": "c5e9944c42e8d4a04f810522fb24e3d277a17204",
    "files": [
        {
            "sha": "0d92bdccb209c4cd9fd560610d54d1ea7c54645e",
            "filename": "dev-infra/commit-message/validate.spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/c5e9944c42e8d4a04f810522fb24e3d277a17204/dev-infra%2Fcommit-message%2Fvalidate.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/c5e9944c42e8d4a04f810522fb24e3d277a17204/dev-infra%2Fcommit-message%2Fvalidate.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate.spec.ts?ref=c5e9944c42e8d4a04f810522fb24e3d277a17204",
            "patch": "@@ -23,6 +23,7 @@ const config: {commitMessage: CommitMessageConfig} = {\n       'compiler',\n       'core',\n       'packaging',\n+      '@angular-devkit/build-angular',\n     ]\n   }\n };\n@@ -87,6 +88,11 @@ describe('validate-commit-message.js', () => {\n           [`'weird' is not an allowed type.\\n => TYPES: ${TYPES}`]);\n     });\n \n+    it('should pass when scope contains NPM scope', () => {\n+      expectValidationResult(\n+          validateCommitMessage('fix(@angular-devkit/build-angular): something'), true);\n+    });\n+\n     it('should fail when scope is invalid', () => {\n       const errorMessageFor = (scope: string, header: string) =>\n           `'${scope}' is not an allowed scope.\\n => SCOPES: ${SCOPES}`;"
        },
        {
            "sha": "4b630f7a7d47d804133de5968c2bc55f0e549f59",
            "filename": "dev-infra/commit-message/validate.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/c5e9944c42e8d4a04f810522fb24e3d277a17204/dev-infra%2Fcommit-message%2Fvalidate.ts",
            "raw_url": "https://github.com/angular/angular/raw/c5e9944c42e8d4a04f810522fb24e3d277a17204/dev-infra%2Fcommit-message%2Fvalidate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate.ts?ref=c5e9944c42e8d4a04f810522fb24e3d277a17204",
            "patch": "@@ -116,9 +116,10 @@ export function validateCommitMessage(\n       return false;\n     }\n \n-    if (commit.scope && !config.scopes.includes(commit.scope)) {\n+    const fullScope = commit.npmScope ? `${commit.npmScope}/${commit.scope}` : commit.scope;\n+    if (fullScope && !config.scopes.includes(fullScope)) {\n       errors.push(\n-          `'${commit.scope}' is not an allowed scope.\\n => SCOPES: ${config.scopes.join(', ')}`);\n+          `'${fullScope}' is not an allowed scope.\\n => SCOPES: ${config.scopes.join(', ')}`);\n       return false;\n     }\n "
        },
        {
            "sha": "333d75bf6c7b51392b48ea326eddb8becc42c85f",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/c5e9944c42e8d4a04f810522fb24e3d277a17204/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/c5e9944c42e8d4a04f810522fb24e3d277a17204/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=c5e9944c42e8d4a04f810522fb24e3d277a17204",
            "patch": "@@ -1871,8 +1871,9 @@ function validateCommitMessage(commitMsg, options = {}) {\n             errors.push(`Scopes are required for commits with type '${commit.type}', but no scope was provided.`);\n             return false;\n         }\n-        if (commit.scope && !config.scopes.includes(commit.scope)) {\n-            errors.push(`'${commit.scope}' is not an allowed scope.\\n => SCOPES: ${config.scopes.join(', ')}`);\n+        const fullScope = commit.npmScope ? `${commit.npmScope}/${commit.scope}` : commit.scope;\n+        if (fullScope && !config.scopes.includes(fullScope)) {\n+            errors.push(`'${fullScope}' is not an allowed scope.\\n => SCOPES: ${config.scopes.join(', ')}`);\n             return false;\n         }\n         // Commits with the type of `release` do not require a commit body."
        }
    ],
    "stats": {
        "total": 16,
        "additions": 12,
        "deletions": 4
    }
}