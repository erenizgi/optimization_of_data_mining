{
    "author": "gkalpak",
    "message": "build(docs-infra): improve applying post-install patches (#37896)\n\nIn `aio/`, we have a mechanism to apply patches in a `postinstall` hook.\nSee `aio/tools/cli-patches/README.md` for more info.\n\nPreviously, we had to update `aio/tools/cli-patches/patch.js` to list\neach `.patch` file separately. While working on #37688, I found it\nhelpful for the script to automatically pick up `.patch` files.\n\nThis commit updates the script to automatically pick up and apply\n`.patch` files from the `aio/tools/cli-patches/` directory. If one wants\nto keep a `.patch` file but not apply it, they can change the file's\nextension or move it to a sub-directory (without having to update the\nscript).\n\nPR Close #37896",
    "sha": "596fbb3f066e36ec0c0245b2e36767d8ea267077",
    "files": [
        {
            "sha": "a7e6407d7e41d993dd00ffb68c5af3f887f651db",
            "filename": "aio/tools/cli-patches/patch.js",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/596fbb3f066e36ec0c0245b2e36767d8ea267077/aio%2Ftools%2Fcli-patches%2Fpatch.js",
            "raw_url": "https://github.com/angular/angular/raw/596fbb3f066e36ec0c0245b2e36767d8ea267077/aio%2Ftools%2Fcli-patches%2Fpatch.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fcli-patches%2Fpatch.js?ref=596fbb3f066e36ec0c0245b2e36767d8ea267077",
            "patch": "@@ -1,9 +1,14 @@\n-const fs = require('fs');\n const sh = require('shelljs');\n \n const PATCH_LOCK = 'node_modules/@angular/cli/.patched';\n \n-if (!fs.existsSync(PATCH_LOCK)) {\n+sh.set('-e');\n+sh.cd(`${__dirname}/../../`);\n+\n+if (!sh.test('-f', PATCH_LOCK)) {\n+  sh.ls('-l', __dirname)\n+      .filter(stat => stat.isFile() && /\\.patch$/i.test(stat.name))\n+      .forEach(stat => sh.exec(`patch -p0 -i \"${__dirname}/${stat.name}\"`));\n+\n   sh.touch(PATCH_LOCK);\n }\n-"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 8,
        "deletions": 3
    }
}