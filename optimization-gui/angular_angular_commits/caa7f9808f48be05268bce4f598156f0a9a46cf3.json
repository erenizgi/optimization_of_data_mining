{
    "author": "devversion",
    "message": "feat(dev-infra): add logic for determining active LTS branches (#38656)\n\nAdds logic for determining active LTS branches for a given\nrelease configuration. The active LTS branches can be determined\nby querying NPM and matching dist tags against a specific\npattern. i.e. `v{major}-lts`.\n\nThis logic will be useful for the release tool that supports\npublishing of active LTS version branches.\n\nPR Close #38656",
    "sha": "caa7f9808f48be05268bce4f598156f0a9a46cf3",
    "files": [
        {
            "sha": "4dc33c37d95f44300aa0b3e9d09c947099eabe26",
            "filename": "dev-infra/release/versioning/long-term-support.ts",
            "status": "modified",
            "additions": 62,
            "deletions": 0,
            "changes": 62,
            "blob_url": "https://github.com/angular/angular/blob/caa7f9808f48be05268bce4f598156f0a9a46cf3/dev-infra%2Frelease%2Fversioning%2Flong-term-support.ts",
            "raw_url": "https://github.com/angular/angular/raw/caa7f9808f48be05268bce4f598156f0a9a46cf3/dev-infra%2Frelease%2Fversioning%2Flong-term-support.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Flong-term-support.ts?ref=caa7f9808f48be05268bce4f598156f0a9a46cf3",
            "patch": "@@ -6,6 +6,30 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import * as semver from 'semver';\n+\n+import {ReleaseConfig} from '../config/index';\n+\n+import {fetchProjectNpmPackageInfo} from './npm-registry';\n+\n+/** Interface describing determined LTS branches. */\n+export interface LtsBranches {\n+  /** List of active LTS version branches. */\n+  active: LtsBranch[];\n+  /** List of inactive LTS version branches. */\n+  inactive: LtsBranch[];\n+}\n+\n+/** Interface describing an LTS version branch. */\n+export interface LtsBranch {\n+  /** Name of the branch. */\n+  name: string;\n+  /** Most recent version for the given LTS branch. */\n+  version: semver.SemVer;\n+  /** NPM dist tag for the LTS version. */\n+  npmDistTag: string;\n+}\n+\n /**\n  * Number of months a major version in Angular is actively supported. See:\n  * https://angular.io/guide/releases#support-policy-and-schedule.\n@@ -18,6 +42,44 @@ export const majorActiveSupportDuration = 6;\n  */\n export const majorActiveTermSupportDuration = 12;\n \n+/** Regular expression that matches LTS NPM dist tags. */\n+export const ltsNpmDistTagRegex = /^v(\\d+)-lts$/;\n+\n+/** Finds all long-term support release trains from the specified NPM package. */\n+export async function fetchLongTermSupportBranchesFromNpm(config: ReleaseConfig):\n+    Promise<LtsBranches> {\n+  const {'dist-tags': distTags, time} = await fetchProjectNpmPackageInfo(config);\n+  const today = new Date();\n+  const active: LtsBranch[] = [];\n+  const inactive: LtsBranch[] = [];\n+\n+  // Iterate through the NPM package information and determine active/inactive LTS versions with\n+  // their corresponding branches. We assume that a LTS tagged version in NPM belongs to the\n+  // last-minor branch of a given major (i.e. we assume there are no outdated LTS NPM dist tags).\n+  for (const npmDistTag in distTags) {\n+    if (ltsNpmDistTagRegex.test(npmDistTag)) {\n+      const version = semver.parse(distTags[npmDistTag])!;\n+      const branchName = `${version.major}.${version.minor}.x`;\n+      const majorReleaseDate = new Date(time[`${version.major}.0.0`]);\n+      const ltsEndDate = computeLtsEndDateOfMajor(majorReleaseDate);\n+      const ltsBranch: LtsBranch = {name: branchName, version, npmDistTag};\n+      // Depending on whether the LTS phase is still active, add the branch\n+      // the list of active or inactive LTS branches.\n+      if (today <= ltsEndDate) {\n+        active.push(ltsBranch);\n+      } else {\n+        inactive.push(ltsBranch);\n+      }\n+    }\n+  }\n+\n+  // Sort LTS branches in descending order. i.e. most recent ones first.\n+  active.sort((a, b) => semver.rcompare(a.version, b.version));\n+  inactive.sort((a, b) => semver.rcompare(a.version, b.version));\n+\n+  return {active, inactive};\n+}\n+\n /**\n  * Computes the date when long-term support ends for a major released at the\n  * specified date."
        }
    ],
    "stats": {
        "total": 62,
        "additions": 62,
        "deletions": 0
    }
}