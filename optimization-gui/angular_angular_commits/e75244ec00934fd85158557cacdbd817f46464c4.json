{
    "author": "JoostK",
    "message": "feat(compiler-cli): support for partial compilation of components (#39707)\n\nThis commit implements partial compilation of components, together with\nlinking the partial declaration into its full AOT output.\n\nThis commit does not yet enable accurate source maps into external\ntemplates. This requires additional work to account for escape sequences\nwhich is non-trivial. Inline templates that were represented using a\nstring or template literal are transplated into the partial declaration\noutput, so their source maps should be accurate. Note, however, that\nthe accuracy of source maps is not currently verified in tests; this is\nalso left as future work.\n\nThe golden files of partial compilation output have been updated to\nreflect the generated code for components. Please note that the current\noutput should not yet be considered stable.\n\nPR Close #39707",
    "sha": "e75244ec00934fd85158557cacdbd817f46464c4",
    "files": [
        {
            "sha": "cf19f61bc213f2b612b5fc3605efd608ca8d90f8",
            "filename": "packages/compiler-cli/linker/src/file_linker/file_linker.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Ffile_linker.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Ffile_linker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Ffile_linker.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -18,7 +18,7 @@ export const NO_STATEMENTS: Readonly<any[]> = [] as const;\n  * This class is responsible for linking all the partial declarations found in a single file.\n  */\n export class FileLinker<TConstantScope, TStatement, TExpression> {\n-  private linkerSelector = new PartialLinkerSelector<TExpression>();\n+  private linkerSelector = new PartialLinkerSelector<TExpression>(this.linkerEnvironment.options);\n   private emitScopes = new Map<TConstantScope, EmitScope<TStatement, TExpression>>();\n \n   constructor("
        },
        {
            "sha": "3a7f4cbdf45ed74d50f456915a7dfe65cde25ced",
            "filename": "packages/compiler-cli/linker/src/file_linker/partial_linkers/partial_component_linker_1.ts",
            "status": "modified",
            "additions": 165,
            "deletions": 3,
            "changes": 168,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_component_linker_1.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_component_linker_1.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_component_linker_1.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -5,20 +5,182 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {ConstantPool} from '@angular/compiler';\n+import {compileComponentFromMetadata, ConstantPool, DEFAULT_INTERPOLATION_CONFIG, InterpolationConfig, makeBindingParser, parseTemplate, R3ComponentMetadata, R3UsedDirectiveMetadata} from '@angular/compiler';\n+import {ChangeDetectionStrategy, ViewEncapsulation} from '@angular/compiler/src/core';\n import * as o from '@angular/compiler/src/output/output_ast';\n \n-import {AstObject} from '../../ast/ast_value';\n+import {Range} from '../../ast/ast_host';\n+import {AstObject, AstValue} from '../../ast/ast_value';\n+import {FatalLinkerError} from '../../fatal_linker_error';\n+import {LinkerOptions} from '../linker_options';\n \n+import {toR3DirectiveMeta} from './partial_directive_linker_1';\n import {PartialLinker} from './partial_linker';\n \n /**\n  * A `PartialLinker` that is designed to process `ɵɵngDeclareComponent()` call expressions.\n  */\n export class PartialComponentLinkerVersion1<TExpression> implements PartialLinker<TExpression> {\n+  constructor(private readonly options: LinkerOptions) {}\n+\n   linkPartialDeclaration(\n       sourceUrl: string, code: string, constantPool: ConstantPool,\n       metaObj: AstObject<TExpression>): o.Expression {\n-    throw new Error('Not implemented.');\n+    const meta = toR3ComponentMeta(metaObj, code, sourceUrl, this.options);\n+    const def = compileComponentFromMetadata(meta, constantPool, makeBindingParser());\n+    return def.expression;\n+  }\n+}\n+\n+/**\n+ * This function derives the `R3ComponentMetadata` from the provided AST object.\n+ */\n+export function toR3ComponentMeta<TExpression>(\n+    metaObj: AstObject<TExpression>, code: string, sourceUrl: string,\n+    options: LinkerOptions): R3ComponentMetadata {\n+  let interpolation = DEFAULT_INTERPOLATION_CONFIG;\n+  if (metaObj.has('interpolation')) {\n+    interpolation = InterpolationConfig.fromArray(\n+        metaObj.getArray('interpolation').map(entry => entry.getString()) as [string, string]);\n+  }\n+  const templateObj = metaObj.getObject('template');\n+  const templateSource = templateObj.getValue('source');\n+  const range = getTemplateRange(templateSource, code);\n+  const isInline = templateObj.getBoolean('isInline');\n+\n+  // We always normalize line endings if the template is inline.\n+  const i18nNormalizeLineEndingsInICUs = isInline || options.i18nNormalizeLineEndingsInICUs;\n+\n+  const template = parseTemplate(code, sourceUrl, {\n+    escapedString: true,\n+    interpolationConfig: interpolation,\n+    range,\n+    enableI18nLegacyMessageIdFormat: options.enableI18nLegacyMessageIdFormat,\n+    preserveWhitespaces:\n+        metaObj.has('preserveWhitespaces') ? metaObj.getBoolean('preserveWhitespaces') : false,\n+    i18nNormalizeLineEndingsInICUs,\n+    isInline,\n+  });\n+  if (template.errors !== null) {\n+    const errors = template.errors.map(err => err.toString()).join('\\n');\n+    throw new FatalLinkerError(\n+        templateSource.expression, `Errors found in the template:\\n${errors}`);\n+  }\n+\n+  let wrapDirectivesAndPipesInClosure = false;\n+\n+  const directives: R3UsedDirectiveMetadata[] = metaObj.has('directives') ?\n+      metaObj.getArray('directives').map(directive => {\n+        const directiveExpr = directive.getObject();\n+        const type = directiveExpr.getValue('type');\n+        const selector = directiveExpr.getString('selector');\n+\n+        let typeExpr = type.getOpaque();\n+        if (type.isFunction()) {\n+          typeExpr = type.getFunctionReturnValue().getOpaque();\n+          wrapDirectivesAndPipesInClosure = true;\n+        }\n+        return {\n+          type: typeExpr,\n+          selector: selector,\n+          inputs: directiveExpr.has('inputs') ?\n+              directiveExpr.getArray('inputs').map(input => input.getString()) :\n+              [],\n+          outputs: directiveExpr.has('outputs') ?\n+              directiveExpr.getArray('outputs').map(input => input.getString()) :\n+              [],\n+          exportAs: directiveExpr.has('exportAs') ?\n+              directiveExpr.getArray('exportAs').map(exportAs => exportAs.getString()) :\n+              null,\n+        };\n+      }) :\n+      [];\n+\n+  const pipes = metaObj.has('pipes') ? metaObj.getObject('pipes').toMap(value => {\n+    if (value.isFunction()) {\n+      wrapDirectivesAndPipesInClosure = true;\n+      return value.getFunctionReturnValue().getOpaque();\n+    } else {\n+      return value.getOpaque();\n+    }\n+  }) :\n+                                       new Map<string, o.Expression>();\n+\n+  return {\n+    ...toR3DirectiveMeta(metaObj, code, sourceUrl),\n+    viewProviders: metaObj.has('viewProviders') ? metaObj.getOpaque('viewProviders') : null,\n+    template: {\n+      nodes: template.nodes,\n+      ngContentSelectors: template.ngContentSelectors,\n+    },\n+    wrapDirectivesAndPipesInClosure,\n+    styles: metaObj.has('styles') ? metaObj.getArray('styles').map(entry => entry.getString()) : [],\n+    encapsulation: metaObj.has('encapsulation') ?\n+        parseEncapsulation(metaObj.getValue('encapsulation')) :\n+        ViewEncapsulation.Emulated,\n+    interpolation,\n+    changeDetection: metaObj.has('changeDetection') ?\n+        parseChangeDetectionStrategy(metaObj.getValue('changeDetection')) :\n+        ChangeDetectionStrategy.Default,\n+    animations: metaObj.has('animations') ? metaObj.getOpaque('animations') : null,\n+    relativeContextFilePath: sourceUrl,\n+    i18nUseExternalIds: options.i18nUseExternalIds,\n+    pipes,\n+    directives,\n+  };\n+}\n+\n+/**\n+ * Determines the `ViewEncapsulation` mode from the AST value's symbol name.\n+ */\n+function parseEncapsulation<TExpression>(encapsulation: AstValue<TExpression>): ViewEncapsulation {\n+  const symbolName = encapsulation.getSymbolName();\n+  if (symbolName === null) {\n+    throw new FatalLinkerError(\n+        encapsulation.expression, 'Expected encapsulation to have a symbol name');\n+  }\n+  const enumValue = ViewEncapsulation[symbolName as keyof typeof ViewEncapsulation];\n+  if (enumValue === undefined) {\n+    throw new FatalLinkerError(encapsulation.expression, 'Unsupported encapsulation');\n+  }\n+  return enumValue;\n+}\n+\n+/**\n+ * Determines the `ChangeDetectionStrategy` from the AST value's symbol name.\n+ */\n+function parseChangeDetectionStrategy<TExpression>(changeDetectionStrategy: AstValue<TExpression>):\n+    ChangeDetectionStrategy {\n+  const symbolName = changeDetectionStrategy.getSymbolName();\n+  if (symbolName === null) {\n+    throw new FatalLinkerError(\n+        changeDetectionStrategy.expression,\n+        'Expected change detection strategy to have a symbol name');\n+  }\n+  const enumValue = ChangeDetectionStrategy[symbolName as keyof typeof ChangeDetectionStrategy];\n+  if (enumValue === undefined) {\n+    throw new FatalLinkerError(\n+        changeDetectionStrategy.expression, 'Unsupported change detection strategy');\n+  }\n+  return enumValue;\n+}\n+\n+/**\n+ * Update the range to remove the start and end chars, which should be quotes around the template.\n+ */\n+function getTemplateRange<TExpression>(templateNode: AstValue<TExpression>, code: string): Range {\n+  const {startPos, endPos, startLine, startCol} = templateNode.getRange();\n+\n+  if (!/[\"'`]/.test(code[startPos]) || code[startPos] !== code[endPos - 1]) {\n+    throw new FatalLinkerError(\n+        templateNode.expression,\n+        `Expected the template string to be wrapped in quotes but got: ${\n+            code.substring(startPos, endPos)}`);\n   }\n+  return {\n+    startPos: startPos + 1,\n+    endPos: endPos - 1,\n+    startLine,\n+    startCol: startCol + 1,\n+  };\n }"
        },
        {
            "sha": "4002f285d0d4003e36d6565af4c3212594ad94d6",
            "filename": "packages/compiler-cli/linker/src/file_linker/partial_linkers/partial_linker_selector.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_linker_selector.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_linker_selector.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_linker_selector.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -5,6 +5,8 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n+import {LinkerOptions} from '../linker_options';\n+\n import {PartialComponentLinkerVersion1} from './partial_component_linker_1';\n import {PartialDirectiveLinkerVersion1} from './partial_directive_linker_1';\n import {PartialLinker} from './partial_linker';\n@@ -15,10 +17,12 @@ export class PartialLinkerSelector<TExpression> {\n       1: new PartialDirectiveLinkerVersion1(),\n     },\n     'ɵɵngDeclareComponent': {\n-      1: new PartialComponentLinkerVersion1(),\n+      1: new PartialComponentLinkerVersion1(this.options),\n     },\n   };\n \n+  constructor(private options: LinkerOptions) {}\n+\n   /**\n    * Returns true if there are `PartialLinker` classes that can handle functions with this name.\n    */"
        },
        {
            "sha": "002f77bf462e4ce5458fbaf485b8e21f0a544e5f",
            "filename": "packages/compiler-cli/linker/test/file_linker/partial_linkers/partial_linker_selector_spec.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Fpartial_linkers%2Fpartial_linker_selector_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Fpartial_linkers%2Fpartial_linker_selector_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Ftest%2Ffile_linker%2Fpartial_linkers%2Fpartial_linker_selector_spec.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -6,15 +6,22 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {LinkerOptions} from '../../..';\n import {PartialComponentLinkerVersion1} from '../../../src/file_linker/partial_linkers/partial_component_linker_1';\n import {PartialDirectiveLinkerVersion1} from '../../../src/file_linker/partial_linkers/partial_directive_linker_1';\n import {PartialLinkerSelector} from '../../../src/file_linker/partial_linkers/partial_linker_selector';\n \n describe('PartialLinkerSelector', () => {\n+  const options: LinkerOptions = {\n+    i18nNormalizeLineEndingsInICUs: true,\n+    enableI18nLegacyMessageIdFormat: false,\n+    i18nUseExternalIds: false,\n+  };\n+\n   describe('supportsDeclaration()', () => {\n     it('should return true if there is at least one linker that matches the given function name',\n        () => {\n-         const selector = new PartialLinkerSelector();\n+         const selector = new PartialLinkerSelector(options);\n          expect(selector.supportsDeclaration('ɵɵngDeclareDirective')).toBe(true);\n          expect(selector.supportsDeclaration('ɵɵngDeclareComponent')).toBe(true);\n          expect(selector.supportsDeclaration('$foo')).toBe(false);\n@@ -23,15 +30,15 @@ describe('PartialLinkerSelector', () => {\n \n   describe('getLinker()', () => {\n     it('should return the linker that matches the name and version number', () => {\n-      const selector = new PartialLinkerSelector();\n+      const selector = new PartialLinkerSelector(options);\n       expect(selector.getLinker('ɵɵngDeclareDirective', 1))\n           .toBeInstanceOf(PartialDirectiveLinkerVersion1);\n       expect(selector.getLinker('ɵɵngDeclareComponent', 1))\n           .toBeInstanceOf(PartialComponentLinkerVersion1);\n     });\n \n     it('should throw an error if there is no linker that matches the given name or version', () => {\n-      const selector = new PartialLinkerSelector();\n+      const selector = new PartialLinkerSelector(options);\n       expect(() => selector.getLinker('$foo', 1))\n           .toThrowError('Unknown partial declaration function $foo.');\n       expect(() => selector.getLinker('ɵɵngDeclareDirective', 2))"
        },
        {
            "sha": "53253cacb08e14dc89f2f24e25b43203393ec673",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/component.ts",
            "status": "modified",
            "additions": 48,
            "deletions": 21,
            "changes": 69,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {compileComponentFromMetadata, ConstantPool, CssSelector, DEFAULT_INTERPOLATION_CONFIG, DomElementSchemaRegistry, Expression, ExternalExpr, Identifiers, InterpolationConfig, LexerRange, makeBindingParser, ParsedTemplate, ParseSourceFile, parseTemplate, R3ComponentMetadata, R3FactoryTarget, R3TargetBinder, SchemaMetadata, SelectorMatcher, Statement, TmplAstNode, WrappedNodeExpr} from '@angular/compiler';\n+import {compileComponentFromMetadata, compileDeclareComponentFromMetadata, ConstantPool, CssSelector, DEFAULT_INTERPOLATION_CONFIG, DomElementSchemaRegistry, Expression, ExternalExpr, Identifiers, InterpolationConfig, LexerRange, makeBindingParser, ParsedTemplate, ParseSourceFile, parseTemplate, R3ComponentDef, R3ComponentMetadata, R3FactoryTarget, R3TargetBinder, R3UsedDirectiveMetadata, SelectorMatcher, Statement, TmplAstNode, WrappedNodeExpr} from '@angular/compiler';\n import * as ts from 'typescript';\n \n import {CycleAnalyzer} from '../../cycles';\n@@ -506,11 +506,15 @@ export class ComponentDecoratorHandler implements\n       const bound = binder.bind({template: metadata.template.nodes});\n \n       // The BoundTarget knows which directives and pipes matched the template.\n-      const usedDirectives = bound.getUsedDirectives().map(directive => {\n+      type UsedDirective = R3UsedDirectiveMetadata&{ref: Reference};\n+      const usedDirectives: UsedDirective[] = bound.getUsedDirectives().map(directive => {\n         return {\n-          selector: directive.selector,\n-          expression: this.refEmitter.emit(directive.ref, context),\n           ref: directive.ref,\n+          type: this.refEmitter.emit(directive.ref, context),\n+          selector: directive.selector,\n+          inputs: directive.inputs.propertyNames,\n+          outputs: directive.outputs.propertyNames,\n+          exportAs: directive.exportAs,\n         };\n       });\n \n@@ -529,15 +533,14 @@ export class ComponentDecoratorHandler implements\n \n       // Scan through the directives/pipes actually used in the template and check whether any\n       // import which needs to be generated would create a cycle.\n-      const cycleDetected =\n-          usedDirectives.some(dir => this._isCyclicImport(dir.expression, context)) ||\n+      const cycleDetected = usedDirectives.some(dir => this._isCyclicImport(dir.type, context)) ||\n           usedPipes.some(pipe => this._isCyclicImport(pipe.expression, context));\n \n       if (!cycleDetected) {\n         // No cycle was detected. Record the imports that need to be created in the cycle detector\n         // so that future cyclic import checks consider their production.\n-        for (const {expression} of usedDirectives) {\n-          this._recordSyntheticImport(expression, context);\n+        for (const {type} of usedDirectives) {\n+          this._recordSyntheticImport(type, context);\n         }\n         for (const {expression} of usedPipes) {\n           this._recordSyntheticImport(expression, context);\n@@ -548,7 +551,7 @@ export class ComponentDecoratorHandler implements\n         // declared after this component.\n         const wrapDirectivesAndPipesInClosure =\n             usedDirectives.some(\n-                dir => isExpressionForwardReference(dir.expression, node.name, context)) ||\n+                dir => isExpressionForwardReference(dir.type, node.name, context)) ||\n             usedPipes.some(\n                 pipe => isExpressionForwardReference(pipe.expression, node.name, context));\n \n@@ -599,18 +602,35 @@ export class ComponentDecoratorHandler implements\n       node: ClassDeclaration, analysis: Readonly<ComponentAnalysisData>,\n       resolution: Readonly<ComponentResolutionData>, pool: ConstantPool): CompileResult[] {\n     const meta: R3ComponentMetadata = {...analysis.meta, ...resolution};\n-    const res = compileComponentFromMetadata(meta, pool, makeBindingParser());\n-    const factoryRes = compileNgFactoryDefField(\n-        {...meta, injectFn: Identifiers.directiveInject, target: R3FactoryTarget.Component});\n+    const def = compileComponentFromMetadata(meta, pool, makeBindingParser());\n+    return this.compileComponent(analysis, def);\n+  }\n+\n+  compilePartial(\n+      node: ClassDeclaration, analysis: Readonly<ComponentAnalysisData>,\n+      resolution: Readonly<ComponentResolutionData>): CompileResult[] {\n+    const meta: R3ComponentMetadata = {...analysis.meta, ...resolution};\n+    const def = compileDeclareComponentFromMetadata(meta, analysis.template);\n+    return this.compileComponent(analysis, def);\n+  }\n+\n+  private compileComponent(\n+      analysis: Readonly<ComponentAnalysisData>,\n+      {expression: initializer, type}: R3ComponentDef): CompileResult[] {\n+    const factoryRes = compileNgFactoryDefField({\n+      ...analysis.meta,\n+      injectFn: Identifiers.directiveInject,\n+      target: R3FactoryTarget.Component,\n+    });\n     if (analysis.metadataStmt !== null) {\n       factoryRes.statements.push(analysis.metadataStmt);\n     }\n     return [\n       factoryRes, {\n         name: 'ɵcmp',\n-        initializer: res.expression,\n+        initializer,\n         statements: [],\n-        type: res.type,\n+        type,\n       }\n     ];\n   }\n@@ -737,7 +757,8 @@ export class ComponentDecoratorHandler implements\n     }\n \n     const template = this._parseTemplate(\n-        component, templateStr, sourceMapUrl(resourceUrl), /* templateRange */ undefined,\n+        component, templateStr, /* templateLiteral */ null, sourceMapUrl(resourceUrl),\n+        /* templateRange */ undefined,\n         /* escapedString */ false);\n \n     return {\n@@ -763,6 +784,7 @@ export class ComponentDecoratorHandler implements\n     const templateExpr = component.get('template')!;\n \n     let templateStr: string;\n+    let templateLiteral: ts.Node|null = null;\n     let templateUrl: string = '';\n     let templateRange: LexerRange|undefined = undefined;\n     let sourceMapping: TemplateSourceMapping;\n@@ -774,6 +796,7 @@ export class ComponentDecoratorHandler implements\n       // strip\n       templateRange = getTemplateRange(templateExpr);\n       templateStr = templateExpr.getSourceFile().text;\n+      templateLiteral = templateExpr;\n       templateUrl = containingFile;\n       escapedString = true;\n       sourceMapping = {\n@@ -795,15 +818,16 @@ export class ComponentDecoratorHandler implements\n       };\n     }\n \n-    const template =\n-        this._parseTemplate(component, templateStr, templateUrl, templateRange, escapedString);\n+    const template = this._parseTemplate(\n+        component, templateStr, templateLiteral, templateUrl, templateRange, escapedString);\n \n     return {...template, sourceMapping};\n   }\n \n   private _parseTemplate(\n-      component: Map<string, ts.Expression>, templateStr: string, templateUrl: string,\n-      templateRange: LexerRange|undefined, escapedString: boolean): ParsedComponentTemplate {\n+      component: Map<string, ts.Expression>, templateStr: string, templateLiteral: ts.Node|null,\n+      templateUrl: string, templateRange: LexerRange|undefined,\n+      escapedString: boolean): ParsedComponentTemplate {\n     let preserveWhitespaces: boolean = this.defaultPreserveWhitespaces;\n     if (component.has('preserveWhitespaces')) {\n       const expr = component.get('preserveWhitespaces')!;\n@@ -829,13 +853,15 @@ export class ComponentDecoratorHandler implements\n     // We always normalize line endings if the template has been escaped (i.e. is inline).\n     const i18nNormalizeLineEndingsInICUs = escapedString || this.i18nNormalizeLineEndingsInICUs;\n \n+    const isInline = component.has('template');\n     const parsedTemplate = parseTemplate(templateStr, templateUrl, {\n       preserveWhitespaces,\n       interpolationConfig,\n       range: templateRange,\n       escapedString,\n       enableI18nLegacyMessageIdFormat: this.enableI18nLegacyMessageIdFormat,\n       i18nNormalizeLineEndingsInICUs,\n+      isInline,\n     });\n \n     // Unfortunately, the primary parse of the template above may not contain accurate source map\n@@ -859,14 +885,15 @@ export class ComponentDecoratorHandler implements\n       enableI18nLegacyMessageIdFormat: this.enableI18nLegacyMessageIdFormat,\n       i18nNormalizeLineEndingsInICUs,\n       leadingTriviaChars: [],\n+      isInline,\n     });\n \n     return {\n       ...parsedTemplate,\n       diagNodes,\n-      template: templateStr,\n+      template: templateLiteral !== null ? new WrappedNodeExpr(templateLiteral) : templateStr,\n       templateUrl,\n-      isInline: component.has('template'),\n+      isInline,\n       file: new ParseSourceFile(templateStr, templateUrl),\n     };\n   }"
        },
        {
            "sha": "dfa610334aca694cf9b0cb2fdf7149d2abcd89b4",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/elements/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 19,
            "deletions": 84,
            "changes": 103,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Felements%2FGOLDEN_PARTIAL.js?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -6,18 +6,7 @@ import * as i0 from \"@angular/core\";\n export class MyComponent {\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], decls: 5, vars: 0, consts: [[\"title\", \"Hello\", 1, \"my-app\"], [\"cx\", \"20\", \"cy\", \"30\", \"r\", \"50\"]], template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵelementStart(0, \"div\", 0);\n-        i0.ɵɵnamespaceSVG();\n-        i0.ɵɵelementStart(1, \"svg\");\n-        i0.ɵɵelement(2, \"circle\", 1);\n-        i0.ɵɵelementEnd();\n-        i0.ɵɵnamespaceHTML();\n-        i0.ɵɵelementStart(3, \"p\");\n-        i0.ɵɵtext(4, \"test\");\n-        i0.ɵɵelementEnd();\n-        i0.ɵɵelementEnd();\n-    } }, encapsulation: 2 });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyComponent, selector: \"my-component\", ngImport: i0, template: { source: '<div class=\"my-app\" title=\"Hello\"><svg><circle cx=\"20\" cy=\"30\" r=\"50\"/></svg><p>test</p></div>', isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{\n@@ -56,18 +45,7 @@ import * as i0 from \"@angular/core\";\n export class MyComponent {\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], decls: 5, vars: 0, consts: [[\"title\", \"Hello\", 1, \"my-app\"]], template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵelementStart(0, \"div\", 0);\n-        i0.ɵɵnamespaceMathML();\n-        i0.ɵɵelementStart(1, \"math\");\n-        i0.ɵɵelement(2, \"infinity\");\n-        i0.ɵɵelementEnd();\n-        i0.ɵɵnamespaceHTML();\n-        i0.ɵɵelementStart(3, \"p\");\n-        i0.ɵɵtext(4, \"test\");\n-        i0.ɵɵelementEnd();\n-        i0.ɵɵelementEnd();\n-    } }, encapsulation: 2 });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyComponent, selector: \"my-component\", ngImport: i0, template: { source: '<div class=\"my-app\" title=\"Hello\"><math><infinity/></math><p>test</p></div>', isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{\n@@ -106,15 +84,7 @@ import * as i0 from \"@angular/core\";\n export class MyComponent {\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], decls: 5, vars: 0, consts: [[\"title\", \"Hello\", 1, \"my-app\"]], template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵelementStart(0, \"div\", 0);\n-        i0.ɵɵtext(1, \"Hello \");\n-        i0.ɵɵelementStart(2, \"b\");\n-        i0.ɵɵtext(3, \"World\");\n-        i0.ɵɵelementEnd();\n-        i0.ɵɵtext(4, \"!\");\n-        i0.ɵɵelementEnd();\n-    } }, encapsulation: 2 });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyComponent, selector: \"my-component\", ngImport: i0, template: { source: '<div class=\"my-app\" title=\"Hello\">Hello <b>World</b>!</div>', isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{\n@@ -153,15 +123,7 @@ import * as i0 from \"@angular/core\";\n export class MyComponent {\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], decls: 5, vars: 0, consts: [[0, \"xmlns\", \"foo\", \"http://someuri/foo\", 0, \"foo\", \"bar\", \"baz\", \"title\", \"Hello\", 0, \"foo\", \"qux\", \"quacks\", 1, \"my-app\"]], template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵelementStart(0, \"div\", 0);\n-        i0.ɵɵtext(1, \"Hello \");\n-        i0.ɵɵelementStart(2, \"b\");\n-        i0.ɵɵtext(3, \"World\");\n-        i0.ɵɵelementEnd();\n-        i0.ɵɵtext(4, \"!\");\n-        i0.ɵɵelementEnd();\n-    } }, encapsulation: 2 });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyComponent, selector: \"my-component\", ngImport: i0, template: { source: '<div xmlns:foo=\"http://someuri/foo\" class=\"my-app\" foo:bar=\"baz\" title=\"Hello\" foo:qux=\"quacks\">Hello <b>World</b>!</div>', isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{\n@@ -200,14 +162,7 @@ import * as i0 from \"@angular/core\";\n export class MyComponent {\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], decls: 4, vars: 0, template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵelementContainerStart(0);\n-        i0.ɵɵelementStart(1, \"span\");\n-        i0.ɵɵtext(2, \"in a \");\n-        i0.ɵɵelementEnd();\n-        i0.ɵɵtext(3, \"container\");\n-        i0.ɵɵelementContainerEnd();\n-    } }, encapsulation: 2 });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyComponent, selector: \"my-component\", ngImport: i0, template: { source: '<ng-container><span>in a </span>container</ng-container>', isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{\n@@ -246,9 +201,7 @@ import * as i0 from \"@angular/core\";\n export class MyComponent {\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], decls: 1, vars: 0, template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵelementContainer(0);\n-    } }, encapsulation: 2 });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyComponent, selector: \"my-component\", ngImport: i0, template: { source: '<ng-container></ng-container>', isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{ selector: 'my-component', template: '<ng-container></ng-container>' }]\n@@ -287,11 +240,7 @@ export class MyComponent {\n     }\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], decls: 1, vars: 1, consts: [[3, \"id\"]], template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵelement(0, \"div\", 0);\n-    } if (rf & 2) {\n-        i0.ɵɵproperty(\"id\", ctx.id);\n-    } }, encapsulation: 2 });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyComponent, selector: \"my-component\", ngImport: i0, template: { source: '<div [id]=\"id\"></div>', isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{ selector: 'my-component', template: '<div [id]=\"id\"></div>' }]\n@@ -325,20 +274,18 @@ export declare class MyModule {\n  ****************************************************************************************************/\n import { Component, NgModule } from '@angular/core';\n import * as i0 from \"@angular/core\";\n-const _c0 = function (a0) { return [a0]; };\n-const _c1 = function () { return [0]; };\n export class MyComponent {\n     constructor() {\n         this.id = 'one';\n     }\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], decls: 2, vars: 15, consts: [[3, \"ternary\", \"pipe\", \"and\", \"or\"]], template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵelement(0, \"div\", 0);\n-        i0.ɵɵpipe(1, \"pipe\");\n-    } if (rf & 2) {\n-        i0.ɵɵproperty(\"ternary\", ctx.cond ? i0.ɵɵpureFunction1(8, _c0, ctx.a) : i0.ɵɵpureFunction0(10, _c1))(\"pipe\", i0.ɵɵpipeBind3(1, 4, ctx.value, 1, 2))(\"and\", ctx.cond && i0.ɵɵpureFunction1(11, _c0, ctx.b))(\"or\", ctx.cond || i0.ɵɵpureFunction1(13, _c0, ctx.c));\n-    } }, encapsulation: 2 });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyComponent, selector: \"my-component\", ngImport: i0, template: { source: `<div\n+    [ternary]=\"cond ? [a] : [0]\"\n+    [pipe]=\"value | pipe:1:2\"\n+    [and]=\"cond && [b]\"\n+    [or]=\"cond || [c]\"\n+  ></div>`, isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{\n@@ -380,20 +327,13 @@ export declare class MyModule {\n  ****************************************************************************************************/\n import { Component, Input, NgModule } from '@angular/core';\n import * as i0 from \"@angular/core\";\n-const _c0 = function (a0, a1) { return { collapsedHeight: a0, expandedHeight: a1 }; };\n-const _c1 = function (a0, a1) { return { value: a0, params: a1 }; };\n-const _c2 = function (a0, a1) { return { collapsedWidth: a0, expandedWidth: a1 }; };\n export class MyComponent {\n     getExpandedState() {\n         return 'expanded';\n     }\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], hostVars: 14, hostBindings: function MyComponent_HostBindings(rf, ctx) { if (rf & 2) {\n-        i0.ɵɵsyntheticHostProperty(\"@expansionHeight\", i0.ɵɵpureFunction2(5, _c1, ctx.getExpandedState(), i0.ɵɵpureFunction2(2, _c0, ctx.collapsedHeight, ctx.expandedHeight)))(\"@expansionWidth\", i0.ɵɵpureFunction2(11, _c1, ctx.getExpandedState(), i0.ɵɵpureFunction2(8, _c2, ctx.collapsedWidth, ctx.expandedWidth)));\n-    } }, inputs: { expandedHeight: \"expandedHeight\", collapsedHeight: \"collapsedHeight\", expandedWidth: \"expandedWidth\", collapsedWidth: \"collapsedWidth\" }, decls: 1, vars: 0, template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵtext(0, \"...\");\n-    } }, encapsulation: 2 });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyComponent, selector: \"my-component\", inputs: { expandedHeight: \"expandedHeight\", collapsedHeight: \"collapsedHeight\", expandedWidth: \"expandedWidth\", collapsedWidth: \"collapsedWidth\" }, host: { properties: { \"@expansionHeight\": \"{\\n        value: getExpandedState(),\\n        params: {\\n          collapsedHeight: collapsedHeight,\\n          expandedHeight: expandedHeight\\n        }\\n    }\", \"@expansionWidth\": \"{\\n      value: getExpandedState(),\\n      params: {\\n        collapsedWidth: collapsedWidth,\\n        expandedWidth: expandedWidth\\n      }\\n    }\" } }, ngImport: i0, template: { source: '...', isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{\n@@ -465,12 +405,7 @@ export class MyComponent {\n     }\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], decls: 1, vars: 4, template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵelement(0, \"div\");\n-    } if (rf & 2) {\n-        i0.ɵɵstyleProp(\"background-color\", ctx.color);\n-        i0.ɵɵclassProp(\"error\", ctx.error);\n-    } }, encapsulation: 2 });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyComponent, selector: \"my-component\", ngImport: i0, template: { source: '<div [class.error]=\"error\" [style.background-color]=\"color\"></div>', isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{\n@@ -511,10 +446,10 @@ import * as i0 from \"@angular/core\";\n export class MyComponent {\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], decls: 2, vars: 0, consts: [[\"title\", \"hi\"]], template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵelement(0, \"div\", 0);\n-        i0.ɵɵelement(1, \"span\", 0);\n-    } }, encapsulation: 2 });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyComponent, selector: \"my-component\", ngImport: i0, template: { source: `\n+    <div title=\"hi\"></div>\n+    <span title=\"hi\"></span>\n+  `, isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{"
        },
        {
            "sha": "16282198a6db1af48dbb40a4ab085c900cf3e22d",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler/interpolations/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler%2Finterpolations%2FGOLDEN_PARTIAL.js?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -9,11 +9,7 @@ export class MyApp {\n     }\n }\n MyApp.ɵfac = function MyApp_Factory(t) { return new (t || MyApp)(); };\n-MyApp.ɵcmp = i0.ɵɵdefineComponent({ type: MyApp, selectors: [[\"my-app\"]], decls: 1, vars: 9, template: function MyApp_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵtext(0);\n-    } if (rf & 2) {\n-        i0.ɵɵtextInterpolateV([\" \", ctx.list[0], \" \", ctx.list[1], \" \", ctx.list[2], \" \", ctx.list[3], \" \", ctx.list[4], \" \", ctx.list[5], \" \", ctx.list[6], \" \", ctx.list[7], \" \", ctx.list[8], \" \"]);\n-    } }, encapsulation: 2 });\n+MyApp.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyApp, selector: \"my-app\", ngImport: i0, template: { source: ' {{list[0]}} {{list[1]}} {{list[2]}} {{list[3]}} {{list[4]}} {{list[5]}} {{list[6]}} {{list[7]}} {{list[8]}} ', isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyApp, [{\n         type: Component,\n         args: [{"
        },
        {
            "sha": "1821e346a0c353bc72979dc60ebe2bc2fce8ce30",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_directives/directives/matching/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_directives%2Fdirectives%2Fmatching%2FGOLDEN_PARTIAL.js?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -14,9 +14,7 @@ I18nDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: 1, type: I18nDirectiv\n export class MyComponent {\n }\n MyComponent.ɵfac = function MyComponent_Factory(t) { return new (t || MyComponent)(); };\n-MyComponent.ɵcmp = i0.ɵɵdefineComponent({ type: MyComponent, selectors: [[\"my-component\"]], decls: 1, vars: 0, template: function MyComponent_Template(rf, ctx) { if (rf & 1) {\n-        i0.ɵɵelement(0, \"div\");\n-    } }, encapsulation: 2 });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: 1, type: MyComponent, selector: \"my-component\", ngImport: i0, template: { source: '<div i18n></div>', isInline: true } });\n /*@__PURE__*/ (function () { i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{ selector: 'my-component', template: '<div i18n></div>' }]"
        },
        {
            "sha": "a1041f372efffcb7731cbbe52a7813388a52d5fd",
            "filename": "packages/compiler/src/compiler.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -102,6 +102,7 @@ export {compilePipeFromMetadata, R3PipeMetadata} from './render3/r3_pipe_compile\n export {makeBindingParser, ParsedTemplate, parseTemplate, ParseTemplateOptions} from './render3/view/template';\n export {R3Reference} from './render3/util';\n export {compileComponentFromMetadata, compileDirectiveFromMetadata, parseHostBindings, ParsedHostBindings, verifyHostBindings} from './render3/view/compiler';\n+export {compileDeclareComponentFromMetadata} from './render3/partial/component';\n export {compileDeclareDirectiveFromMetadata} from './render3/partial/directive';\n export {publishFacade} from './jit_compiler_facade';\n // This file only reexports content of the `src` folder. Keep it that way."
        },
        {
            "sha": "d60b8be0141adc4a22dacc469e1802ce21f0729b",
            "filename": "packages/compiler/src/compiler_facade_interface.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Fcompiler_facade_interface.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Fcompiler_facade_interface.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler_facade_interface.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -154,14 +154,22 @@ export interface R3ComponentMetadataFacade extends R3DirectiveMetadataFacade {\n   preserveWhitespaces: boolean;\n   animations: any[]|undefined;\n   pipes: Map<string, any>;\n-  directives: {selector: string, expression: any}[];\n+  directives: R3UsedDirectiveMetadata[];\n   styles: string[];\n   encapsulation: ViewEncapsulation;\n   viewProviders: Provider[]|null;\n   interpolation?: [string, string];\n   changeDetection?: ChangeDetectionStrategy;\n }\n \n+export interface R3UsedDirectiveMetadata {\n+  selector: string;\n+  inputs: string[];\n+  outputs: string[];\n+  exportAs: string[]|null;\n+  type: any;\n+}\n+\n export interface R3FactoryDefMetadataFacade {\n   name: string;\n   type: any;"
        },
        {
            "sha": "e7a7ab4342c23cab867afebe8ec438ec974c9d7b",
            "filename": "packages/compiler/src/jit_compiler_facade.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -21,7 +21,7 @@ import {R3JitReflector} from './render3/r3_jit';\n import {compileInjector, compileNgModule, R3InjectorMetadata, R3NgModuleMetadata} from './render3/r3_module_compiler';\n import {compilePipeFromMetadata, R3PipeMetadata} from './render3/r3_pipe_compiler';\n import {R3Reference} from './render3/util';\n-import {R3DirectiveMetadata, R3QueryMetadata} from './render3/view/api';\n+import {R3ComponentMetadata, R3DirectiveMetadata, R3QueryMetadata} from './render3/view/api';\n import {compileComponentFromMetadata, compileDirectiveFromMetadata, ParsedHostBindings, parseHostBindings, verifyHostBindings} from './render3/view/compiler';\n import {makeBindingParser, parseTemplate} from './render3/view/template';\n import {ResourceLoader} from './resource_loader';\n@@ -136,7 +136,7 @@ export class CompilerFacadeImpl implements CompilerFacade {\n \n     // Compile the component metadata, including template, into an expression.\n     // TODO(alxhub): implement inputs, outputs, queries, etc.\n-    const metadata = {\n+    const metadata: R3ComponentMetadata = {\n       ...facade as R3ComponentMetadataFacadeNoPropAndWhitespace,\n       ...convertDirectiveFacadeToMetadata(facade),\n       selector: facade.selector || this.elementSchemaRegistry.getDefaultComponentElementName(),"
        },
        {
            "sha": "bb4abd04e7b233170e1e12b049156f7425884716",
            "filename": "packages/compiler/src/render3/partial/api.ts",
            "status": "modified",
            "additions": 102,
            "deletions": 0,
            "changes": 102,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fapi.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -5,6 +5,8 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n+import {ChangeDetectionStrategy, ViewEncapsulation} from '../../core';\n+import {InterpolationConfig} from '../../ml_parser/interpolation_config';\n import * as o from '../../output/output_ast';\n \n /**\n@@ -112,6 +114,106 @@ export interface R3DeclareDirectiveMetadata {\n   ngImport: o.Expression;\n }\n \n+/**\n+ * An extension of `R3DeclareDirectiveMetadata` that declares the shape of a partial declaration of\n+ * a component.\n+ */\n+export interface R3DeclareComponentMetadata extends R3DeclareDirectiveMetadata {\n+  /**\n+   * Information about the component's template.\n+   */\n+  template: {\n+    /**\n+     * The component's unparsed template string as opaque expression. The template is represented\n+     * using either a string literal or template literal without substitutions, but its value is\n+     * not read directly. Instead, the template parser is given the full source file's text and\n+     * the range of this expression to parse directly from source.\n+     */\n+    source: o.Expression;\n+\n+    /**\n+     * Whether the template was inline (using `template`) or external (using `templateUrl`).\n+     */\n+    isInline: boolean;\n+  };\n+\n+  /**\n+   * CSS from inline styles and included styleUrls.\n+   */\n+  styles?: string[];\n+\n+  /**\n+   * List of directives which matched in the template, including sufficient\n+   * metadata for each directive to attribute bindings and references within\n+   * the template to each directive specifically, if the runtime instructions\n+   * support this.\n+   */\n+  directives?: {\n+    /**\n+     * Selector of the directive.\n+     */\n+    selector: string;\n+\n+    /**\n+     * Reference to the directive class (possibly a forward reference).\n+     */\n+    type: o.Expression | (() => o.Expression);\n+\n+    /**\n+     * Property names of the directive's inputs.\n+     */\n+    inputs?: string[];\n+\n+    /**\n+     * Event names of the directive's outputs.\n+     */\n+    outputs?: string[];\n+\n+    /**\n+     * Names by which this directive exports itself for references.\n+     */\n+    exportAs?: string[];\n+  }[];\n+\n+  /**\n+   * A map of pipe names to an expression referencing the pipe type (possibly a forward reference)\n+   * which are used in the template.\n+   */\n+  pipes?: {[pipeName: string]: o.Expression|(() => o.Expression)};\n+\n+  /**\n+   * The list of view providers defined in the component.\n+   */\n+  viewProviders?: o.Expression;\n+\n+  /**\n+   * A collection of animation triggers that will be used in the component template.\n+   */\n+  animations?: o.Expression;\n+\n+  /**\n+   * Strategy used for detecting changes in the component.\n+   * Defaults to `ChangeDetectionStrategy.Default`.\n+   */\n+  changeDetection?: ChangeDetectionStrategy;\n+\n+  /**\n+   * An encapsulation policy for the template and CSS styles.\n+   * Defaults to `ViewEncapsulation.Emulated`.\n+   */\n+  encapsulation?: ViewEncapsulation;\n+\n+  /**\n+   * Overrides the default interpolation start and end delimiters. Defaults to {{ and }}.\n+   */\n+  interpolation?: InterpolationConfig;\n+\n+  /**\n+   * Whether whitespace in the template should be preserved. Defaults to false.\n+   */\n+  preserveWhitespaces?: boolean;\n+}\n+\n export interface R3DeclareQueryMetadata {\n   /**\n    * Name of the property on the class to update with query results."
        },
        {
            "sha": "050207051bf37ea5fe0551bc72ea5f6f6317d3b5",
            "filename": "packages/compiler/src/render3/partial/component.ts",
            "status": "added",
            "additions": 126,
            "deletions": 0,
            "changes": 126,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fcomponent.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -0,0 +1,126 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import * as core from '../../core';\n+import {DEFAULT_INTERPOLATION_CONFIG} from '../../ml_parser/interpolation_config';\n+import * as o from '../../output/output_ast';\n+import {Identifiers as R3} from '../r3_identifiers';\n+import {R3ComponentDef, R3ComponentMetadata} from '../view/api';\n+import {createComponentType} from '../view/compiler';\n+import {ParsedTemplate} from '../view/template';\n+import {DefinitionMap} from '../view/util';\n+\n+import {createDirectiveDefinitionMap} from './directive';\n+import {toOptionalLiteralArray} from './util';\n+\n+\n+/**\n+ * Compile a component declaration defined by the `R3ComponentMetadata`.\n+ */\n+export function compileDeclareComponentFromMetadata(\n+    meta: R3ComponentMetadata, template: ParsedTemplate): R3ComponentDef {\n+  const definitionMap = createComponentDefinitionMap(meta, template);\n+\n+  const expression = o.importExpr(R3.declareComponent).callFn([definitionMap.toLiteralMap()]);\n+  const type = createComponentType(meta);\n+\n+  return {expression, type};\n+}\n+\n+/**\n+ * Gathers the declaration fields for a component into a `DefinitionMap`.\n+ */\n+export function createComponentDefinitionMap(\n+    meta: R3ComponentMetadata, template: ParsedTemplate): DefinitionMap {\n+  const definitionMap = createDirectiveDefinitionMap(meta);\n+\n+  const templateMap = compileTemplateDefinition(template);\n+\n+  definitionMap.set('template', templateMap);\n+\n+  definitionMap.set('styles', toOptionalLiteralArray(meta.styles, o.literal));\n+  definitionMap.set('directives', compileUsedDirectiveMetadata(meta));\n+  definitionMap.set('pipes', compileUsedPipeMetadata(meta));\n+  definitionMap.set('viewProviders', meta.viewProviders);\n+  definitionMap.set('animations', meta.animations);\n+\n+  if (meta.changeDetection !== undefined) {\n+    definitionMap.set(\n+        'changeDetection',\n+        o.importExpr(R3.ChangeDetectionStrategy)\n+            .prop(core.ChangeDetectionStrategy[meta.changeDetection]));\n+  }\n+  if (meta.encapsulation !== core.ViewEncapsulation.Emulated) {\n+    definitionMap.set(\n+        'encapsulation',\n+        o.importExpr(R3.ViewEncapsulation).prop(core.ViewEncapsulation[meta.encapsulation]));\n+  }\n+  if (meta.interpolation !== DEFAULT_INTERPOLATION_CONFIG) {\n+    definitionMap.set(\n+        'interpolation',\n+        o.literalArr([o.literal(meta.interpolation.start), o.literal(meta.interpolation.end)]));\n+  }\n+\n+  if (template.preserveWhitespaces === true) {\n+    definitionMap.set('preserveWhitespaces', o.literal(true));\n+  }\n+\n+  return definitionMap;\n+}\n+\n+/**\n+ * Compiles the provided template into its partial definition.\n+ */\n+function compileTemplateDefinition(template: ParsedTemplate): o.LiteralMapExpr {\n+  const templateMap = new DefinitionMap();\n+  const templateExpr =\n+      typeof template.template === 'string' ? o.literal(template.template) : template.template;\n+  templateMap.set('source', templateExpr);\n+  templateMap.set('isInline', o.literal(template.isInline));\n+  return templateMap.toLiteralMap();\n+}\n+\n+/**\n+ * Compiles the directives as registered in the component metadata into an array literal of the\n+ * individual directives. If the component does not use any directives, then null is returned.\n+ */\n+function compileUsedDirectiveMetadata(meta: R3ComponentMetadata): o.LiteralArrayExpr|null {\n+  const wrapType = meta.wrapDirectivesAndPipesInClosure ?\n+      (expr: o.Expression) => o.fn([], [new o.ReturnStatement(expr)]) :\n+      (expr: o.Expression) => expr;\n+\n+  return toOptionalLiteralArray(meta.directives, directive => {\n+    const dirMeta = new DefinitionMap();\n+    dirMeta.set('type', wrapType(directive.type));\n+    dirMeta.set('selector', o.literal(directive.selector));\n+    dirMeta.set('inputs', toOptionalLiteralArray(directive.inputs, o.literal));\n+    dirMeta.set('outputs', toOptionalLiteralArray(directive.outputs, o.literal));\n+    dirMeta.set('exportAs', toOptionalLiteralArray(directive.exportAs, o.literal));\n+    return dirMeta.toLiteralMap();\n+  });\n+}\n+\n+/**\n+ * Compiles the pipes as registered in the component metadata into an object literal, where the\n+ * pipe's name is used as key and a reference to its type as value. If the component does not use\n+ * any pipes, then null is returned.\n+ */\n+function compileUsedPipeMetadata(meta: R3ComponentMetadata): o.LiteralMapExpr|null {\n+  if (meta.pipes.size === 0) {\n+    return null;\n+  }\n+\n+  const wrapType = meta.wrapDirectivesAndPipesInClosure ?\n+      (expr: o.Expression) => o.fn([], [new o.ReturnStatement(expr)]) :\n+      (expr: o.Expression) => expr;\n+\n+  const entries = [];\n+  for (const [name, pipe] of meta.pipes) {\n+    entries.push({key: name, value: wrapType(pipe), quoted: true});\n+  }\n+  return o.literalMap(entries);\n+}"
        },
        {
            "sha": "7f757c13ddee3396bce0a60d3a615ecc0d575e77",
            "filename": "packages/compiler/src/render3/r3_identifiers.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_identifiers.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_identifiers.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_identifiers.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -234,9 +234,19 @@ export class Identifiers {\n   static resolveBody: o.ExternalReference = {name: 'ɵɵresolveBody', moduleName: CORE};\n \n   static defineComponent: o.ExternalReference = {name: 'ɵɵdefineComponent', moduleName: CORE};\n+  static declareComponent: o.ExternalReference = {name: 'ɵɵngDeclareComponent', moduleName: CORE};\n \n   static setComponentScope: o.ExternalReference = {name: 'ɵɵsetComponentScope', moduleName: CORE};\n \n+  static ChangeDetectionStrategy: o.ExternalReference = {\n+    name: 'ChangeDetectionStrategy',\n+    moduleName: CORE,\n+  };\n+  static ViewEncapsulation: o.ExternalReference = {\n+    name: 'ViewEncapsulation',\n+    moduleName: CORE,\n+  };\n+\n   static ComponentDefWithMeta: o.ExternalReference = {\n     name: 'ɵɵComponentDefWithMeta',\n     moduleName: CORE,"
        },
        {
            "sha": "51f1b310ef2ed24fa321d0f6ced1404419759f61",
            "filename": "packages/compiler/src/render3/view/api.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 1,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fapi.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -149,7 +149,7 @@ export interface R3ComponentMetadata extends R3DirectiveMetadata {\n    * A list of directive selectors and an expression referencing the directive type which are in the\n    * scope of the compilation.\n    */\n-  directives: {selector: string, expression: o.Expression}[];\n+  directives: R3UsedDirectiveMetadata[];\n \n   /**\n    * Whether to wrap the 'directives' and/or `pipes` array, if one is generated, in a closure.\n@@ -206,6 +206,37 @@ export interface R3ComponentMetadata extends R3DirectiveMetadata {\n   changeDetection?: ChangeDetectionStrategy;\n }\n \n+/**\n+ * Information about a directive that is used in a component template. Only the stable, public\n+ * facing information of the directive is stored here.\n+ */\n+export interface R3UsedDirectiveMetadata {\n+  /**\n+   * The type of the directive as an expression.\n+   */\n+  type: o.Expression;\n+\n+  /**\n+   * The selector of the directive.\n+   */\n+  selector: string;\n+\n+  /**\n+   * The binding property names of the inputs of the directive.\n+   */\n+  inputs: string[];\n+\n+  /**\n+   * The binding property names of the outputs of the directive.\n+   */\n+  outputs: string[];\n+\n+  /**\n+   * Name under which the directive is exported, if any (exportAs in Angular). Null otherwise.\n+   */\n+  exportAs: string[]|null;\n+}\n+\n /**\n  * Information needed to compile a query (view or content).\n  */"
        },
        {
            "sha": "7bb178859330018c0f7df5e2e78eac5a707966ea",
            "filename": "packages/compiler/src/render3/view/compiler.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fcompiler.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -159,8 +159,8 @@ export function compileComponentFromMetadata(\n \n   if (meta.directives.length > 0) {\n     const matcher = new SelectorMatcher();\n-    for (const {selector, expression} of meta.directives) {\n-      matcher.addSelectables(CssSelector.parse(selector), expression);\n+    for (const {selector, type} of meta.directives) {\n+      matcher.addSelectables(CssSelector.parse(selector), type);\n     }\n     directiveMatcher = matcher;\n   }"
        },
        {
            "sha": "4a96cf91eabb7fa8ccb02fa95dc9954ce7b33c88",
            "filename": "packages/compiler/src/render3/view/template.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 2,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -2032,6 +2032,11 @@ export interface ParseTemplateOptions {\n    * The default is `false`, but this will be switched in a future major release.\n    */\n   i18nNormalizeLineEndingsInICUs?: boolean;\n+\n+  /**\n+   * Whether the template was inline.\n+   */\n+  isInline?: boolean;\n }\n \n /**\n@@ -2044,6 +2049,7 @@ export interface ParseTemplateOptions {\n export function parseTemplate(\n     template: string, templateUrl: string, options: ParseTemplateOptions = {}): ParsedTemplate {\n   const {interpolationConfig, preserveWhitespaces, enableI18nLegacyMessageIdFormat} = options;\n+  const isInline = options.isInline ?? false;\n   const bindingParser = makeBindingParser(interpolationConfig);\n   const htmlParser = new HtmlParser();\n   const parseResult = htmlParser.parse(\n@@ -2057,6 +2063,7 @@ export function parseTemplate(\n       interpolationConfig,\n       preserveWhitespaces,\n       template,\n+      isInline,\n       errors: parseResult.errors,\n       nodes: [],\n       styleUrls: [],\n@@ -2081,6 +2088,7 @@ export function parseTemplate(\n       interpolationConfig,\n       preserveWhitespaces,\n       template,\n+      isInline,\n       errors: i18nMetaResult.errors,\n       nodes: [],\n       styleUrls: [],\n@@ -2112,6 +2120,7 @@ export function parseTemplate(\n     preserveWhitespaces,\n     errors: errors.length > 0 ? errors : null,\n     template,\n+    isInline,\n     nodes,\n     styleUrls,\n     styles,\n@@ -2269,12 +2278,18 @@ export interface ParsedTemplate {\n   interpolationConfig?: InterpolationConfig;\n \n   /**\n-   * The string contents of the template.\n+   * The string contents of the template, or an expression that represents the string/template\n+   * literal as it occurs in the source.\n    *\n    * This is the \"logical\" template string, after expansion of any escaped characters (for inline\n    * templates). This may differ from the actual template bytes as they appear in the .ts file.\n    */\n-  template: string;\n+  template: string|o.Expression;\n+\n+  /**\n+   * Whether the template was inline (using `template`) or external (using `templateUrl`).\n+   */\n+  isInline: boolean;\n \n   /**\n    * Any errors from parsing the template the first time."
        },
        {
            "sha": "d60b8be0141adc4a22dacc469e1802ce21f0729b",
            "filename": "packages/core/src/compiler/compiler_facade_interface.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcore%2Fsrc%2Fcompiler%2Fcompiler_facade_interface.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcore%2Fsrc%2Fcompiler%2Fcompiler_facade_interface.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcompiler%2Fcompiler_facade_interface.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -154,14 +154,22 @@ export interface R3ComponentMetadataFacade extends R3DirectiveMetadataFacade {\n   preserveWhitespaces: boolean;\n   animations: any[]|undefined;\n   pipes: Map<string, any>;\n-  directives: {selector: string, expression: any}[];\n+  directives: R3UsedDirectiveMetadata[];\n   styles: string[];\n   encapsulation: ViewEncapsulation;\n   viewProviders: Provider[]|null;\n   interpolation?: [string, string];\n   changeDetection?: ChangeDetectionStrategy;\n }\n \n+export interface R3UsedDirectiveMetadata {\n+  selector: string;\n+  inputs: string[];\n+  outputs: string[];\n+  exportAs: string[]|null;\n+  type: any;\n+}\n+\n export interface R3FactoryDefMetadataFacade {\n   name: string;\n   type: any;"
        },
        {
            "sha": "e87609da44eae211cb63156261abc2224d087bb5",
            "filename": "packages/core/src/core_render3_private_export.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -165,6 +165,7 @@ export {\n   ɵɵnamespaceMathML,\n   ɵɵnamespaceSVG,\n   ɵɵnextContext,\n+  ɵɵngDeclareComponent,\n   ɵɵngDeclareDirective,\n   ɵɵNgOnChangesFeature,\n   ɵɵpipe,"
        },
        {
            "sha": "483f45e7b4d38d82fdc2cdf17c9b2ed179cd1da0",
            "filename": "packages/core/src/render3/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcore%2Fsrc%2Frender3%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcore%2Fsrc%2Frender3%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Findex.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -135,6 +135,7 @@ export {\n } from './interfaces/node';\n export {CssSelectorList, ProjectionSlots} from './interfaces/projection';\n export {\n+  ɵɵngDeclareComponent,\n   ɵɵngDeclareDirective,\n } from './jit/partial';\n export {"
        },
        {
            "sha": "be4aae16adfa06eaba7a8a180ad8a9836a054c26",
            "filename": "packages/core/src/render3/jit/environment.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fenvironment.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fenvironment.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fenvironment.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -10,8 +10,6 @@ import {ɵɵinject, ɵɵinvalidFactoryDep} from '../../di/injector_compatibility\n import {ɵɵdefineInjectable, ɵɵdefineInjector} from '../../di/interface/defs';\n import * as sanitization from '../../sanitization/sanitization';\n import * as r3 from '../index';\n-import * as partial from './partial';\n-\n \n \n /**\n@@ -169,6 +167,4 @@ export const angularCoreEnv: {[name: string]: Function} =\n        'ɵɵsanitizeUrlOrResourceUrl': sanitization.ɵɵsanitizeUrlOrResourceUrl,\n        'ɵɵtrustConstantHtml': sanitization.ɵɵtrustConstantHtml,\n        'ɵɵtrustConstantResourceUrl': sanitization.ɵɵtrustConstantResourceUrl,\n-\n-       'ɵɵngDeclareDirective': partial.ɵɵngDeclareDirective,\n      }))();"
        },
        {
            "sha": "402fcd499b2288cf21dbc0e99f8279b5e0b5e878",
            "filename": "packages/core/src/render3/jit/partial.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fpartial.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fpartial.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fpartial.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -14,3 +14,12 @@\n export function ɵɵngDeclareDirective(decl: unknown): unknown {\n   throw new Error('Not yet implemented');\n }\n+\n+/**\n+ * Compiles a partial component declaration object into a full component definition object.\n+ *\n+ * @codeGenApi\n+ */\n+export function ɵɵngDeclareComponent(decl: unknown): unknown {\n+  throw new Error('Not yet implemented');\n+}"
        },
        {
            "sha": "4f09a0910b3a3a5721b910b20225e4c3e4f15260",
            "filename": "packages/core/test/render3/jit_environment_spec.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcore%2Ftest%2Frender3%2Fjit_environment_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e75244ec00934fd85158557cacdbd817f46464c4/packages%2Fcore%2Ftest%2Frender3%2Fjit_environment_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fjit_environment_spec.ts?ref=e75244ec00934fd85158557cacdbd817f46464c4",
            "patch": "@@ -21,6 +21,17 @@ const INTERFACE_EXCEPTIONS = new Set<string>([\n   'ModuleWithProviders',\n ]);\n \n+/**\n+ * The following symbols are only referenced from partial declaration compilation outputs, which\n+ * will never be emitted by the JIT compiler so are allowed to be omitted from the JIT environment.\n+ */\n+const PARTIAL_ONLY = new Set<string>([\n+  'ɵɵngDeclareDirective',\n+  'ɵɵngDeclareComponent',\n+  'ChangeDetectionStrategy',\n+  'ViewEncapsulation',\n+]);\n+\n describe('r3 jit environment', () => {\n   // This test keeps render3/jit/environment and r3_identifiers in the compiler in sync, ensuring\n   // that if the compiler writes a reference to a render3 symbol, it will be resolvable at runtime\n@@ -33,7 +44,7 @@ describe('r3 jit environment', () => {\n         // A few such properties are string constants. Ignore them, and focus on ExternalReferences.\n         .filter(isExternalReference)\n         // Some references are to interface types. Only take properties which have runtime values.\n-        .filter(sym => !INTERFACE_EXCEPTIONS.has(sym.name))\n+        .filter(sym => !INTERFACE_EXCEPTIONS.has(sym.name) && !PARTIAL_ONLY.has(sym.name))\n         .forEach(sym => {\n           // Assert that angularCoreEnv has a reference to the runtime symbol.\n           expect(angularCoreEnv.hasOwnProperty(sym.name))"
        }
    ],
    "stats": {
        "total": 718,
        "additions": 583,
        "deletions": 135
    }
}