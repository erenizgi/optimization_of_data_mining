{
    "author": "iRealNirmal",
    "message": "fix(platform-browser): update started state on reset (#41608)\n\nThis commit fixes the state of variable _started on call of reset method.\n\nEarlier behaviour was on call of `reset()` method we are not setting back\n`_started` flag's value to false and it created various issue for end user\nwhich were expecting this behaviour as per name of method.\n\nWe provided end user `reset()` method, but it was empty method and on call\nof it wasn't doing anything. As end user/developer were not able to\nreuse animation not animation after call of reset method.\n\nIn this PR on call of `reset()` method we are setting flag `_started` value to false\nwhich can be accessed by `hasStarted()`.\n\nResolves #18140\n\nPR Close #41608",
    "sha": "3a6af8e629ba03d1202053a0ee9150372bbeda49",
    "files": [
        {
            "sha": "b3cc0242e8061046a3f480e69c9d4631f6685c24",
            "filename": "goldens/public-api/animations/browser/testing/testing.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/3a6af8e629ba03d1202053a0ee9150372bbeda49/goldens%2Fpublic-api%2Fanimations%2Fbrowser%2Ftesting%2Ftesting.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/3a6af8e629ba03d1202053a0ee9150372bbeda49/goldens%2Fpublic-api%2Fanimations%2Fbrowser%2Ftesting%2Ftesting.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fanimations%2Fbrowser%2Ftesting%2Ftesting.d.ts?ref=3a6af8e629ba03d1202053a0ee9150372bbeda49",
            "patch": "@@ -31,4 +31,5 @@ export declare class MockAnimationPlayer extends NoopAnimationPlayer {\n     finish(): void;\n     hasStarted(): boolean;\n     play(): void;\n+    reset(): void;\n }"
        },
        {
            "sha": "4facf82ff5aac568019e4020939c690974ed6d90",
            "filename": "packages/animations/browser/src/render/css_keyframes/css_keyframes_player.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/3a6af8e629ba03d1202053a0ee9150372bbeda49/packages%2Fanimations%2Fbrowser%2Fsrc%2Frender%2Fcss_keyframes%2Fcss_keyframes_player.ts",
            "raw_url": "https://github.com/angular/angular/raw/3a6af8e629ba03d1202053a0ee9150372bbeda49/packages%2Fanimations%2Fbrowser%2Fsrc%2Frender%2Fcss_keyframes%2Fcss_keyframes_player.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fanimations%2Fbrowser%2Fsrc%2Frender%2Fcss_keyframes%2Fcss_keyframes_player.ts?ref=3a6af8e629ba03d1202053a0ee9150372bbeda49",
            "patch": "@@ -15,6 +15,7 @@ const DEFAULT_FILL_MODE = 'forwards';\n const DEFAULT_EASING = 'linear';\n \n export const enum AnimatorControlState {\n+  RESET = 0,\n   INITIALIZED = 1,\n   STARTED = 2,\n   FINISHED = 3,\n@@ -26,7 +27,6 @@ export class CssKeyframesPlayer implements AnimationPlayer {\n   private _onStartFns: Function[] = [];\n   private _onDestroyFns: Function[] = [];\n \n-  private _started = false;\n   // TODO(issue/24571): remove '!'.\n   private _styler!: ElementAnimationStyleHandler;\n \n@@ -139,6 +139,7 @@ export class CssKeyframesPlayer implements AnimationPlayer {\n     this.play();\n   }\n   reset(): void {\n+    this._state = AnimatorControlState.RESET;\n     this._styler.destroy();\n     this._buildStyler();\n     this._styler.apply();"
        },
        {
            "sha": "b4d3dd46587d152b86bcd8617ab6e614fd6b7a7a",
            "filename": "packages/animations/browser/testing/src/mock_animation_driver.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/3a6af8e629ba03d1202053a0ee9150372bbeda49/packages%2Fanimations%2Fbrowser%2Ftesting%2Fsrc%2Fmock_animation_driver.ts",
            "raw_url": "https://github.com/angular/angular/raw/3a6af8e629ba03d1202053a0ee9150372bbeda49/packages%2Fanimations%2Fbrowser%2Ftesting%2Fsrc%2Fmock_animation_driver.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fanimations%2Fbrowser%2Ftesting%2Fsrc%2Fmock_animation_driver.ts?ref=3a6af8e629ba03d1202053a0ee9150372bbeda49",
            "patch": "@@ -83,6 +83,11 @@ export class MockAnimationPlayer extends NoopAnimationPlayer {\n     this._onInitFns = [];\n   }\n \n+  reset() {\n+    super.reset();\n+    this.__started = false;\n+  }\n+\n   finish(): void {\n     super.finish();\n     this.__finished = true;"
        },
        {
            "sha": "06775a0c254c129f3d2a0af59dd22378d10cab34",
            "filename": "packages/animations/src/players/animation_player.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/3a6af8e629ba03d1202053a0ee9150372bbeda49/packages%2Fanimations%2Fsrc%2Fplayers%2Fanimation_player.ts",
            "raw_url": "https://github.com/angular/angular/raw/3a6af8e629ba03d1202053a0ee9150372bbeda49/packages%2Fanimations%2Fsrc%2Fplayers%2Fanimation_player.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fanimations%2Fsrc%2Fplayers%2Fanimation_player.ts?ref=3a6af8e629ba03d1202053a0ee9150372bbeda49",
            "patch": "@@ -184,7 +184,9 @@ export class NoopAnimationPlayer implements AnimationPlayer {\n       this._onDestroyFns = [];\n     }\n   }\n-  reset(): void {}\n+  reset(): void {\n+    this._started = false;\n+  }\n   setPosition(position: number): void {\n     this._position = this.totalTime ? position * this.totalTime : 1;\n   }"
        },
        {
            "sha": "74959020dee27cc00b8db626f7850ffef956cc98",
            "filename": "packages/platform-browser/animations/src/animation_builder.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/3a6af8e629ba03d1202053a0ee9150372bbeda49/packages%2Fplatform-browser%2Fanimations%2Fsrc%2Fanimation_builder.ts",
            "raw_url": "https://github.com/angular/angular/raw/3a6af8e629ba03d1202053a0ee9150372bbeda49/packages%2Fplatform-browser%2Fanimations%2Fsrc%2Fanimation_builder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Fanimations%2Fsrc%2Fanimation_builder.ts?ref=3a6af8e629ba03d1202053a0ee9150372bbeda49",
            "patch": "@@ -104,6 +104,7 @@ export class RendererAnimationPlayer implements AnimationPlayer {\n \n   reset(): void {\n     this._command('reset');\n+    this._started = false;\n   }\n \n   setPosition(p: number): void {"
        },
        {
            "sha": "04ec02c68ae9de14ba18d4881f1437ccc58296d1",
            "filename": "packages/platform-browser/animations/test/browser_animation_builder_spec.ts",
            "status": "modified",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/angular/angular/blob/3a6af8e629ba03d1202053a0ee9150372bbeda49/packages%2Fplatform-browser%2Fanimations%2Ftest%2Fbrowser_animation_builder_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/3a6af8e629ba03d1202053a0ee9150372bbeda49/packages%2Fplatform-browser%2Fanimations%2Ftest%2Fbrowser_animation_builder_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Fanimations%2Ftest%2Fbrowser_animation_builder_spec.ts?ref=3a6af8e629ba03d1202053a0ee9150372bbeda49",
            "patch": "@@ -104,5 +104,43 @@ import {el} from '../../testing/src/browser_util';\n          expect(finished).toBeTruthy();\n          expect(destroyed).toBeTruthy();\n        }));\n+\n+    it('should update `hasStarted()` on `play()` and `reset()`', fakeAsync(() => {\n+         @Component({\n+           selector: 'ani-another-cmp',\n+           template: '...',\n+         })\n+         class CmpAnother {\n+           @ViewChild('target') public target: any;\n+\n+           constructor(public builder: AnimationBuilder) {}\n+\n+           build() {\n+             const definition =\n+                 this.builder.build([style({opacity: 0}), animate(1000, style({opacity: 1}))]);\n+\n+             return definition.create(this.target);\n+           }\n+         }\n+\n+         TestBed.configureTestingModule({declarations: [CmpAnother]});\n+\n+         const fixture = TestBed.createComponent(CmpAnother);\n+         const cmp = fixture.componentInstance;\n+         fixture.detectChanges();\n+\n+         const player = cmp.build();\n+\n+         expect(player.hasStarted()).toBeFalsy();\n+         flushMicrotasks();\n+\n+         player.play();\n+         flushMicrotasks();\n+         expect(player.hasStarted()).toBeTruthy();\n+\n+         player.reset();\n+         flushMicrotasks();\n+         expect(player.hasStarted()).toBeFalsy();\n+       }));\n   });\n }"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 50,
        "deletions": 2
    }
}