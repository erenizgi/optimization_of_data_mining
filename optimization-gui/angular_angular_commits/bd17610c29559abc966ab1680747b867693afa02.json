{
    "author": "alan-agius4",
    "message": "feat(dev-infra): make ts-api-guardian compatible with rules_nodejs version 3 (#40353)\n\nChanges include:\n- Remove `bazelWorkspaces` as this is no longer supported due to\n  a single version policy https://github.com/bazelbuild/rules_nodejs/pull/783\n  and `install_bazel_dependencies` has been removed.\n- Enable `bazel_patch_module_resolver` since monkey-patch the\n   implementation of `require()` in NodeJS is opt-in\n\nMore info about the changes can be found here: https://github.com/bazelbuild/rules_nodejs/wiki#migrating-to-30\n\nBlocking: https://github.com/angular/angular-cli/pull/19716\n\nPR Close #40353",
    "sha": "bd17610c29559abc966ab1680747b867693afa02",
    "files": [
        {
            "sha": "543e6af123cf6b22d5bc9cd2c143581206be36f3",
            "filename": "tools/ts-api-guardian/BUILD.bazel",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/bd17610c29559abc966ab1680747b867693afa02/tools%2Fts-api-guardian%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/bd17610c29559abc966ab1680747b867693afa02/tools%2Fts-api-guardian%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fts-api-guardian%2FBUILD.bazel?ref=bd17610c29559abc966ab1680747b867693afa02",
            "patch": "@@ -39,9 +39,8 @@ pkg_npm(\n         \"package.json\",\n     ],\n     substitutions = {\n-        \"@angular//tools/ts-api-guardian:bin\": \"@npm_ts_api_guardian//:bin\",\n+        \"@angular//tools/ts-api-guardian:bin\": \"//:node_modules/ts-api-guardian/bin\",\n         \"@angular//tools/ts-api-guardian:lib\": \"@npm//ts-api-guardian\",\n-        \"angular/tools/ts-api-guardian/\": \"npm_ts_api_guardian/\",\n     },\n     deps = [\n         \":lib\",\n@@ -103,7 +102,6 @@ jasmine_node_test(\n         \":ts-api-guardian\",\n     ],\n )\n-# END-INTERNAL\n \n filegroup(\n     name = \"bin\",\n@@ -113,3 +111,5 @@ filegroup(\n \n # Exported to be referenced as entry_point of the nodejs_binary\n exports_files([\"bin/ts-api-guardian\"])\n+\n+# END-INTERNAL"
        },
        {
            "sha": "383197e41e6220f2efe2beb00311ff0dae2083a5",
            "filename": "tools/ts-api-guardian/index.bzl",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/bd17610c29559abc966ab1680747b867693afa02/tools%2Fts-api-guardian%2Findex.bzl",
            "raw_url": "https://github.com/angular/angular/raw/bd17610c29559abc966ab1680747b867693afa02/tools%2Fts-api-guardian%2Findex.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fts-api-guardian%2Findex.bzl?ref=bd17610c29559abc966ab1680747b867693afa02",
            "patch": "@@ -34,7 +34,9 @@ def ts_api_guardian_test(\n         # Locally we need to add the TS build target\n         # But it will replaced to @npm//ts-api-guardian when publishing\n         \"@angular//tools/ts-api-guardian:lib\",\n+        # BEGIN-INTERNAL\n         \"@angular//tools/ts-api-guardian:bin\",\n+        # END-INTERNAL\n         # The below are required during runtime\n         \"@npm//chalk\",\n         \"@npm//diff\",\n@@ -46,6 +48,9 @@ def ts_api_guardian_test(\n         # Needed so that node doesn't walk back to the source directory.\n         # From there, the relative imports would point to .ts files.\n         \"--node_options=--preserve-symlinks\",\n+        # Since version 3, monkey-patch the implementation of require() in NodeJS is opt-in\n+        # https://github.com/bazelbuild/rules_nodejs/wiki#--bazel_patch_module_resolver-now-defaults-to-false-2324\n+        \"--bazel_patch_module_resolver\",\n     ]\n \n     for i in strip_export_pattern:\n@@ -62,7 +67,7 @@ def ts_api_guardian_test(\n     nodejs_test(\n         name = name,\n         data = data,\n-        entry_point = \"@angular//tools/ts-api-guardian:bin/ts-api-guardian\",\n+        entry_point = Label(\"@angular//tools/ts-api-guardian:bin/ts-api-guardian\"),\n         tags = kwargs.pop(\"tags\", []) + [\"api_guard\"],\n         templated_args = args + [\"--verify\", golden, actual],\n         **kwargs\n@@ -72,7 +77,7 @@ def ts_api_guardian_test(\n         name = name + \".accept\",\n         testonly = True,\n         data = data,\n-        entry_point = \"@angular//tools/ts-api-guardian:bin/ts-api-guardian\",\n+        entry_point = Label(\"@angular//tools/ts-api-guardian:bin/ts-api-guardian\"),\n         tags = kwargs.pop(\"tags\", []) + [\"api_guard\"],\n         templated_args = args + [\"--out\", golden, actual],\n         **kwargs"
        },
        {
            "sha": "2e5615ea9e48b74774bcf52df44104feed690f8e",
            "filename": "tools/ts-api-guardian/package.json",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/bd17610c29559abc966ab1680747b867693afa02/tools%2Fts-api-guardian%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/bd17610c29559abc966ab1680747b867693afa02/tools%2Fts-api-guardian%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fts-api-guardian%2Fpackage.json?ref=bd17610c29559abc966ab1680747b867693afa02",
            "patch": "@@ -4,12 +4,6 @@\n   \"description\": \"Guards the API of TypeScript libraries!\",\n   \"main\": \"lib/main.js\",\n   \"typings\": \"lib/main.d.ts\",\n-  \"bazelWorkspaces\": {\n-    \"npm_ts_api_guardian\": {\n-      \"version\": \"0.5.0\",\n-      \"rootPath\": \".\"\n-    }\n-  },\n   \"bin\": {\n     \"ts-api-guardian\": \"./bin/ts-api-guardian\"\n   },"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 10,
        "deletions": 11
    }
}