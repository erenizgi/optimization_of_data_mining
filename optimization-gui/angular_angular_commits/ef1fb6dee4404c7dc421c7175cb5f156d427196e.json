{
    "author": "ajitsinghkaler",
    "message": "fix(common): date pipe gives wrong week number (#37632)\n\nDate pipe is giving wrong week number when used with the date format 'w'. If first week(according to Iso)  has some days in previous year\n\nFixes #33961\n\nPR Close #37632",
    "sha": "ef1fb6dee4404c7dc421c7175cb5f156d427196e",
    "files": [
        {
            "sha": "355298a60f5bef9b3d19a388aa6b868e941655b1",
            "filename": "packages/common/src/i18n/format_date.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ef1fb6dee4404c7dc421c7175cb5f156d427196e/packages%2Fcommon%2Fsrc%2Fi18n%2Fformat_date.ts",
            "raw_url": "https://github.com/angular/angular/raw/ef1fb6dee4404c7dc421c7175cb5f156d427196e/packages%2Fcommon%2Fsrc%2Fi18n%2Fformat_date.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Fi18n%2Fformat_date.ts?ref=ef1fb6dee4404c7dc421c7175cb5f156d427196e",
            "patch": "@@ -382,8 +382,10 @@ function weekGetter(size: number, monthBased = false): DateFormatter {\n       const today = date.getDate();\n       result = 1 + Math.floor((today + nbDaysBefore1stDayOfMonth) / 7);\n     } else {\n-      const firstThurs = getFirstThursdayOfYear(date.getFullYear());\n       const thisThurs = getThursdayThisWeek(date);\n+      // Some days of a year are part of next year according to ISO 8601.\n+      // Compute the firstThurs from the year of this week's Thursday\n+      const firstThurs = getFirstThursdayOfYear(thisThurs.getFullYear());\n       const diff = thisThurs.getTime() - firstThurs.getTime();\n       result = 1 + Math.round(diff / 6.048e8);  // 6.048e8 ms per week\n     }"
        },
        {
            "sha": "ba532d5e25084024a61f510fad73482047921b84",
            "filename": "packages/common/test/pipes/date_pipe_spec.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/ef1fb6dee4404c7dc421c7175cb5f156d427196e/packages%2Fcommon%2Ftest%2Fpipes%2Fdate_pipe_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ef1fb6dee4404c7dc421c7175cb5f156d427196e/packages%2Fcommon%2Ftest%2Fpipes%2Fdate_pipe_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Ftest%2Fpipes%2Fdate_pipe_spec.ts?ref=ef1fb6dee4404c7dc421c7175cb5f156d427196e",
            "patch": "@@ -71,6 +71,20 @@ import {JitReflector} from '@angular/platform-browser-dynamic/src/compiler_refle\n     describe('transform', () => {\n       it('should use \"mediumDate\" as the default format',\n          () => expect(pipe.transform('2017-01-11T10:14:39+0000')).toEqual('Jan 11, 2017'));\n+\n+      it('should return first week if some dates fall in previous year but belong to next year according to ISO 8601 format',\n+         () => {\n+           expect(pipe.transform('2019-12-28T00:00:00', 'w')).toEqual('52');\n+           expect(pipe.transform('2019-12-29T00:00:00', 'w')).toEqual('1');\n+           expect(pipe.transform('2019-12-30T00:00:00', 'w')).toEqual('1');\n+         });\n+\n+      it('should return first week if some dates fall in previous leap year but belong to next year according to ISO 8601 format',\n+         () => {\n+           expect(pipe.transform('2012-12-29T00:00:00', 'w')).toEqual('52');\n+           expect(pipe.transform('2012-12-30T00:00:00', 'w')).toEqual('1');\n+           expect(pipe.transform('2012-12-31T00:00:00', 'w')).toEqual('1');\n+         });\n     });\n   });\n }"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 17,
        "deletions": 1
    }
}