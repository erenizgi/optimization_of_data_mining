{
    "author": "gkalpak",
    "message": "build(docs-infra): deploy angular.io to new Firebase sites (#39470)\n\nPreviously, the documentation for each major Angular version was hosted\non each own Firebase project. This required creating a new project for\neach major release and increased the administrative/maintenance cost.\n\nNow that Firebase supports hosting [multiple websites][1] as part of the\nsame project, we are switching to deploying all major versions to sites\ncreated on `angular-io` project.\n\nThis is part of the work needed to prepare angular.io for our\n[new versioning/branching process][2] (also tracked in #39366).\n\n[1]: https://firebase.google.com/docs/hosting/multisites\n[2]: https://docs.google.com/document/d/197kVillDwx-RZtSVOBtPb4BBIAw0E9RT3q3v6DZkykU\n\nPR Close #39470",
    "sha": "a55a5696a167184bdd324c1d57cdf851bc7c51d3",
    "files": [
        {
            "sha": "1f700dda00e614cd7fb3fb79eea5635098fafe88",
            "filename": "aio/scripts/deploy-to-firebase.js",
            "status": "modified",
            "additions": 7,
            "deletions": 9,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/a55a5696a167184bdd324c1d57cdf851bc7c51d3/aio%2Fscripts%2Fdeploy-to-firebase.js",
            "raw_url": "https://github.com/angular/angular/raw/a55a5696a167184bdd324c1d57cdf851bc7c51d3/aio%2Fscripts%2Fdeploy-to-firebase.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Fdeploy-to-firebase.js?ref=a55a5696a167184bdd324c1d57cdf851bc7c51d3",
            "patch": "@@ -34,7 +34,8 @@ if (require.main === module) {\n         `Build/deploy mode : ${deploymentInfo.deployEnv}\\n` +\n         `Firebase project  : ${deploymentInfo.projectId}\\n` +\n         `Firebase site     : ${deploymentInfo.siteId}\\n` +\n-        `Deployment URLs   : ${deploymentInfo.deployedUrl}\\n`);\n+        `Deployment URLs   : ${deploymentInfo.deployedUrl}\\n` +\n+        `                    https://${deploymentInfo.siteId}.web.app/`);\n \n     if (!isDryRun) {\n       deploy({...inputVars, ...deploymentInfo});\n@@ -64,14 +65,11 @@ function computeDeploymentInfo(\n \n   // The deployment mode is computed based on the branch we are building.\n   const currentBranchMajorVersion = computeMajorVersion(currentBranch);\n-  // Special-case v9, because it is piloting the Firebase hosting \"multisites\" setup.\n-  // See https://angular-team.atlassian.net/browse/DEV-125 for more info.\n-  const isV9 = currentBranchMajorVersion === 9;\n   const deploymentInfoPerTarget = {\n     next: {\n       deployEnv: 'next',\n-      projectId: 'aio-staging',\n-      siteId: 'aio-staging',\n+      projectId: 'angular-io',\n+      siteId: 'next-angular-io-site',\n       deployedUrl: 'https://next.angular.io/',\n     },\n     rc: {\n@@ -83,13 +81,13 @@ function computeDeploymentInfo(\n     stable: {\n       deployEnv: 'stable',\n       projectId: 'angular-io',\n-      siteId: 'angular-io',\n+      siteId: `v${currentBranchMajorVersion}-angular-io-site`,\n       deployedUrl: 'https://angular.io/',\n     },\n     archive: {\n       deployEnv: 'archive',\n-      projectId: isV9 ? 'aio-staging' : `v${currentBranchMajorVersion}-angular-io`,\n-      siteId: isV9 ? 'v9-angular-io' : `v${currentBranchMajorVersion}-angular-io`,\n+      projectId: 'angular-io',\n+      siteId: `v${currentBranchMajorVersion}-angular-io-site`,\n       deployedUrl: `https://v${currentBranchMajorVersion}.angular.io/`,\n     },\n   };"
        },
        {
            "sha": "1633b983d2e2f7f869aab6cc44f6cb2c5bec867c",
            "filename": "aio/scripts/deploy-to-firebase.spec.js",
            "status": "modified",
            "additions": 10,
            "deletions": 8,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/a55a5696a167184bdd324c1d57cdf851bc7c51d3/aio%2Fscripts%2Fdeploy-to-firebase.spec.js",
            "raw_url": "https://github.com/angular/angular/raw/a55a5696a167184bdd324c1d57cdf851bc7c51d3/aio%2Fscripts%2Fdeploy-to-firebase.spec.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Fdeploy-to-firebase.spec.js?ref=a55a5696a167184bdd324c1d57cdf851bc7c51d3",
            "patch": "@@ -45,8 +45,8 @@ describe('deploy-to-firebase:', () => {\n       CI_COMMIT: getLatestCommit('master'),\n     }))).toEqual({\n       deployEnv: 'next',\n-      projectId: 'aio-staging',\n-      siteId: 'aio-staging',\n+      projectId: 'angular-io',\n+      siteId: 'next-angular-io-site',\n       deployedUrl: 'https://next.angular.io/',\n     });\n   });\n@@ -77,7 +77,7 @@ describe('deploy-to-firebase:', () => {\n     }))).toEqual({\n       deployEnv: 'stable',\n       projectId: 'angular-io',\n-      siteId: 'angular-io',\n+      siteId: 'v4-angular-io-site',\n       deployedUrl: 'https://angular.io/',\n     });\n   });\n@@ -108,13 +108,15 @@ describe('deploy-to-firebase:', () => {\n       CI_COMMIT: getLatestCommit('2.4.x'),\n     }))).toEqual({\n       deployEnv: 'archive',\n-      projectId: 'v2-angular-io',\n-      siteId: 'v2-angular-io',\n+      projectId: 'angular-io',\n+      siteId: 'v2-angular-io-site',\n       deployedUrl: 'https://v2.angular.io/',\n     });\n   });\n \n-  it('archive - v9-angular-io multisite special case - deploy success', () => {\n+  // v9 used to be special-cased, because it was piloting the Firebase hosting \"multisites\" setup.\n+  // See https://angular-team.atlassian.net/browse/DEV-125 for more info.\n+  it('archive - deploy success (no special case for v9)', () => {\n     expect(computeDeploymentInfo(computeInputVars({\n       CI_REPO_OWNER: 'angular',\n       CI_REPO_NAME: 'angular',\n@@ -124,8 +126,8 @@ describe('deploy-to-firebase:', () => {\n       CI_COMMIT: getLatestCommit('9.1.x'),\n     }))).toEqual({\n       deployEnv: 'archive',\n-      projectId: 'aio-staging',\n-      siteId: 'v9-angular-io',\n+      projectId: 'angular-io',\n+      siteId: 'v9-angular-io-site',\n       deployedUrl: 'https://v9.angular.io/',\n     });\n   });"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 17,
        "deletions": 17
    }
}