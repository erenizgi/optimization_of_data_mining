{
    "author": "petebacondarwin",
    "message": "refactor(ngcc): move `sourcemaps` into `ngtsc` (#37114)\n\nThe `SourceFile` and associated code is general and reusable in\nother projects (such as `@angular/localize`). Moving it to `ngtsc`\nmakes it more easily shared.\n\nPR Close #37114",
    "sha": "2b53b07c70456088c2ee426d3ef90c670958df79",
    "files": [
        {
            "sha": "6241361c09c7dbe7027ea2e7439a824da050aec4",
            "filename": "packages/compiler-cli/ngcc/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fngcc%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fngcc%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2FBUILD.bazel?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "patch": "@@ -25,6 +25,7 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/perf\",\n         \"//packages/compiler-cli/src/ngtsc/reflection\",\n         \"//packages/compiler-cli/src/ngtsc/scope\",\n+        \"//packages/compiler-cli/src/ngtsc/sourcemaps\",\n         \"//packages/compiler-cli/src/ngtsc/transform\",\n         \"//packages/compiler-cli/src/ngtsc/translator\",\n         \"//packages/compiler-cli/src/ngtsc/util\",\n@@ -36,8 +37,6 @@ ts_library(\n         \"@npm//dependency-graph\",\n         \"@npm//magic-string\",\n         \"@npm//semver\",\n-        \"@npm//source-map\",\n-        \"@npm//sourcemap-codec\",\n         \"@npm//typescript\",\n     ],\n )"
        },
        {
            "sha": "e15e2cdaf52ce5be6c0c12a211d88f0f4b5a8748",
            "filename": "packages/compiler-cli/ngcc/src/rendering/source_maps.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fsource_maps.ts",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fsource_maps.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fsource_maps.ts?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "patch": "@@ -11,8 +11,7 @@ import * as ts from 'typescript';\n \n import {absoluteFrom, absoluteFromSourceFile, basename, FileSystem} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n-import {RawSourceMap} from '../sourcemaps/raw_source_map';\n-import {SourceFileLoader} from '../sourcemaps/source_file_loader';\n+import {RawSourceMap, SourceFileLoader} from '../../../src/ngtsc/sourcemaps';\n \n import {FileToWrite} from './utils';\n "
        },
        {
            "sha": "f4d1adee28455251cba783e7c35820972f56a8f6",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/BUILD.bazel",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2FBUILD.bazel?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "patch": "@@ -0,0 +1,18 @@\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n+\n+package(default_visibility = [\"//visibility:public\"])\n+\n+ts_library(\n+    name = \"sourcemaps\",\n+    srcs = [\"index.ts\"] + glob([\n+        \"src/**/*.ts\",\n+    ]),\n+    deps = [\n+        \"//packages/compiler-cli/src/ngtsc/file_system\",\n+        \"//packages/compiler-cli/src/ngtsc/logging\",\n+        \"@npm//@types/convert-source-map\",\n+        \"@npm//@types/node\",\n+        \"@npm//source-map\",\n+        \"@npm//sourcemap-codec\",\n+    ],\n+)"
        },
        {
            "sha": "22ec327b30bc581c117cc7c03c97bb3d739312e7",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/README.md",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2FREADME.md?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "patch": "@@ -0,0 +1,3 @@\n+# Source-map handling\n+\n+Here there are classes for loading and merging source-maps.\n\\ No newline at end of file"
        },
        {
            "sha": "583e3b1a0ceef5c4cbccbe857cbaaf1bd8dc5227",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/index.ts",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Findex.ts?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "patch": "@@ -0,0 +1,10 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+export {RawSourceMap} from './src/raw_source_map';\n+export {Mapping, SourceFile} from './src/source_file';\n+export {SourceFileLoader} from './src/source_file_loader';"
        },
        {
            "sha": "1a5e86369bb8cbf22bce2bbc065c5e2c4f756743",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/src/raw_source_map.ts",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fraw_source_map.ts",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fraw_source_map.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fraw_source_map.ts?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "previous_filename": "packages/compiler-cli/ngcc/src/sourcemaps/raw_source_map.ts"
        },
        {
            "sha": "82865869c685a9b8667c372512a1d607be4b84d5",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/src/segment_marker.ts",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsegment_marker.ts",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsegment_marker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsegment_marker.ts?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "previous_filename": "packages/compiler-cli/ngcc/src/sourcemaps/segment_marker.ts"
        },
        {
            "sha": "fad6e88705196ae6e4a3b16d36c63d2addcc0a48",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/src/source_file.ts",
            "status": "renamed",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file.ts",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file.ts?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "patch": "@@ -8,7 +8,7 @@\n import {removeComments, removeMapFileComments} from 'convert-source-map';\n import {decode, encode, SourceMapMappings, SourceMapSegment} from 'sourcemap-codec';\n \n-import {AbsoluteFsPath, dirname, relative} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, dirname, relative} from '../../file_system';\n \n import {RawSourceMap} from './raw_source_map';\n import {compareSegments, offsetSegment, SegmentMarker} from './segment_marker';",
            "previous_filename": "packages/compiler-cli/ngcc/src/sourcemaps/source_file.ts"
        },
        {
            "sha": "1b7d49333e292ef0fc101aeb104e9322866e6472",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/src/source_file_loader.ts",
            "status": "renamed",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file_loader.ts",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file_loader.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file_loader.ts?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "patch": "@@ -7,8 +7,8 @@\n  */\n import {commentRegex, fromComment, mapFileCommentRegex} from 'convert-source-map';\n \n-import {absoluteFrom, AbsoluteFsPath, FileSystem} from '../../../src/ngtsc/file_system';\n-import {Logger} from '../../../src/ngtsc/logging';\n+import {absoluteFrom, AbsoluteFsPath, FileSystem} from '../../file_system';\n+import {Logger} from '../../logging';\n \n import {RawSourceMap} from './raw_source_map';\n import {SourceFile} from './source_file';",
            "previous_filename": "packages/compiler-cli/ngcc/src/sourcemaps/source_file_loader.ts"
        },
        {
            "sha": "d678c8a3cf1ad6e1ae05654fbec997649c5209fc",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/test/BUILD.bazel",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2FBUILD.bazel?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "patch": "@@ -0,0 +1,28 @@\n+load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n+\n+package(default_visibility = [\"//visibility:public\"])\n+\n+ts_library(\n+    name = \"test_lib\",\n+    testonly = True,\n+    srcs = glob([\n+        \"**/*.ts\",\n+    ]),\n+    deps = [\n+        \"//packages/compiler-cli/src/ngtsc/file_system\",\n+        \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n+        \"//packages/compiler-cli/src/ngtsc/logging/testing\",\n+        \"//packages/compiler-cli/src/ngtsc/sourcemaps\",\n+        \"@npm//@types/convert-source-map\",\n+        \"@npm//convert-source-map\",\n+        \"@npm//sourcemap-codec\",\n+    ],\n+)\n+\n+jasmine_node_test(\n+    name = \"test\",\n+    bootstrap = [\"//tools/testing:node_no_angular_es5\"],\n+    deps = [\n+        \":test_lib\",\n+    ],\n+)"
        },
        {
            "sha": "d3fedc69b59d8801ad9e136fc1c08431dc477059",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/test/segment_marker_spec.ts",
            "status": "renamed",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2Fsegment_marker_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2Fsegment_marker_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2Fsegment_marker_spec.ts?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "patch": "@@ -5,8 +5,8 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {compareSegments, offsetSegment} from '../../src/sourcemaps/segment_marker';\n-import {computeStartOfLinePositions} from '../../src/sourcemaps/source_file';\n+import {compareSegments, offsetSegment} from '../src/segment_marker';\n+import {computeStartOfLinePositions} from '../src/source_file';\n \n describe('SegmentMarker utils', () => {\n   describe('compareSegments()', () => {",
            "previous_filename": "packages/compiler-cli/ngcc/test/sourcemaps/segment_marker_spec.ts"
        },
        {
            "sha": "3d68671674bf26c7cf7233f7d230ab1986b0342d",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/test/source_file_loader_spec.ts",
            "status": "renamed",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2Fsource_file_loader_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2Fsource_file_loader_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2Fsource_file_loader_spec.ts?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "patch": "@@ -5,13 +5,13 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFrom, FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {fromObject} from 'convert-source-map';\n \n-import {runInEachFileSystem} from '../../../src/ngtsc/file_system/testing';\n-import {MockLogger} from '../../../src/ngtsc/logging/testing';\n-import {RawSourceMap} from '../../src/sourcemaps/raw_source_map';\n-import {SourceFileLoader as SourceFileLoader} from '../../src/sourcemaps/source_file_loader';\n+import {absoluteFrom, FileSystem, getFileSystem} from '../../file_system';\n+import {runInEachFileSystem} from '../../file_system/testing';\n+import {MockLogger} from '../../logging/testing';\n+import {RawSourceMap} from '../src/raw_source_map';\n+import {SourceFileLoader as SourceFileLoader} from '../src/source_file_loader';\n \n runInEachFileSystem(() => {\n   describe('SourceFileLoader', () => {",
            "previous_filename": "packages/compiler-cli/ngcc/test/sourcemaps/source_file_loader_spec.ts"
        },
        {
            "sha": "9162e3724557026d820275d25a1a81eeeca9262e",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/test/source_file_spec.ts",
            "status": "renamed",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2Fsource_file_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2b53b07c70456088c2ee426d3ef90c670958df79/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2Fsource_file_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2Fsource_file_spec.ts?ref=2b53b07c70456088c2ee426d3ef90c670958df79",
            "patch": "@@ -7,11 +7,11 @@\n  */\n import {encode} from 'sourcemap-codec';\n \n-import {absoluteFrom} from '../../../src/ngtsc/file_system';\n-import {runInEachFileSystem} from '../../../src/ngtsc/file_system/testing';\n-import {RawSourceMap} from '../../src/sourcemaps/raw_source_map';\n-import {SegmentMarker} from '../../src/sourcemaps/segment_marker';\n-import {computeStartOfLinePositions, ensureOriginalSegmentLinks, extractOriginalSegments, findLastMappingIndexBefore, Mapping, parseMappings, SourceFile} from '../../src/sourcemaps/source_file';\n+import {absoluteFrom} from '../../file_system';\n+import {runInEachFileSystem} from '../../file_system/testing';\n+import {RawSourceMap} from '../src/raw_source_map';\n+import {SegmentMarker} from '../src/segment_marker';\n+import {computeStartOfLinePositions, ensureOriginalSegmentLinks, extractOriginalSegments, findLastMappingIndexBefore, Mapping, parseMappings, SourceFile} from '../src/source_file';\n \n runInEachFileSystem(() => {\n   describe('SourceFile and utilities', () => {",
            "previous_filename": "packages/compiler-cli/ngcc/test/sourcemaps/source_file_spec.ts"
        }
    ],
    "stats": {
        "total": 95,
        "additions": 76,
        "deletions": 19
    }
}