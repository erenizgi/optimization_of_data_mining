{
    "author": "devversion",
    "message": "refactor(bazel): remove `compilation_mode` attribute for `ng_module` (#43431)\n\nRemoves the `compilation_mode` attribute for the `ng_module` rule. We\nremove the attribute since we intend to control the compilation mode\nthrough the partial compilation build setting we have added before.\n\nNote: We could have named the build setting more generically, something\nlike `ng_compilation_mode`, but I think it's more readable only assuming\nthere is `partial` compilation, or `full`. We can always change this in\nthe future as it is not part of the public API.\n\nPR Close #43431",
    "sha": "713ed2006345f7f3248c70533c757cd3a8747328",
    "files": [
        {
            "sha": "c20571d169cc3bcea1dd2831e26f60562e7afb51",
            "filename": "packages/bazel/src/ng_module/ng_module.bzl",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/713ed2006345f7f3248c70533c757cd3a8747328/packages%2Fbazel%2Fsrc%2Fng_module%2Fng_module.bzl",
            "raw_url": "https://github.com/angular/angular/raw/713ed2006345f7f3248c70533c757cd3a8747328/packages%2Fbazel%2Fsrc%2Fng_module%2Fng_module.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fsrc%2Fng_module%2Fng_module.bzl?ref=713ed2006345f7f3248c70533c757cd3a8747328",
            "patch": "@@ -341,7 +341,6 @@ def _ngc_tsconfig(ctx, files, srcs, **kwargs):\n         # Summaries are only enabled if Angular outputs are to be produced.\n         \"enableSummariesForJit\": is_legacy_ngc,\n         \"enableIvy\": is_ivy_enabled(ctx),\n-        \"compilationMode\": ctx.attr.compilation_mode,\n         \"fullTemplateTypeCheck\": ctx.attr.type_check,\n         \"_extendedTemplateDiagnostics\": ctx.attr.experimental_extended_template_diagnostics,\n         \"compilationMode\": compilation_mode,\n@@ -740,14 +739,6 @@ NG_MODULE_ATTRIBUTES = {\n         doc = \"Experimental option, not publicly supported.\",\n     ),\n     \"inline_resources\": attr.bool(default = True),\n-    \"compilation_mode\": attr.string(\n-        doc = \"\"\"Set the compilation mode for the Angular compiler.\n-\n-        This attribute is a noop if Ivy is not enabled.\n-        \"\"\",\n-        values = [\"partial\", \"full\", \"\"],\n-        default = \"\",\n-    ),\n     \"no_i18n\": attr.bool(default = False),\n     \"compiler\": attr.label(\n         doc = \"\"\"Sets a different ngc compiler binary to use for this library."
        },
        {
            "sha": "b968019e9affca4034add991a4996ec623ee7eb6",
            "filename": "packages/bazel/test/ngc-wrapped/ivy_enabled/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/713ed2006345f7f3248c70533c757cd3a8747328/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/713ed2006345f7f3248c70533c757cd3a8747328/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2FBUILD.bazel?ref=713ed2006345f7f3248c70533c757cd3a8747328",
            "patch": "@@ -9,25 +9,6 @@ ts_library(\n     deps = [\"@npm//@bazel/runfiles\"],\n )\n \n-# `ng_module` with `compilation_mode` explicitly set to `partial`.\n-ng_module(\n-    name = \"test_module_partial_compilation\",\n-    srcs = [\"test_module_partial_compilation.ts\"],\n-    compilation_mode = \"partial\",\n-    tags = [\"ivy-only\"],\n-    deps = [\"//packages/core\"],\n-)\n-\n-# `ng_module` with `compilation_mode` explicitly set to `full`.\n-ng_module(\n-    name = \"test_module_full_compilation\",\n-    srcs = [\"test_module_full_compilation.ts\"],\n-    compilation_mode = \"full\",\n-    tags = [\"ivy-only\"],\n-    deps = [\"//packages/core\"],\n-)\n-\n-# `ng_module` with no specific `compilation_mode` attribute specified.\n ng_module(\n     name = \"test_module_default_compilation\",\n     srcs = [\"test_module_default_compilation.ts\"],\n@@ -40,8 +21,6 @@ jasmine_node_test(\n     srcs = [\":ng_module_ivy_test_lib\"],\n     data = [\n         \":test_module_default_compilation\",\n-        \":test_module_full_compilation\",\n-        \":test_module_partial_compilation\",\n     ],\n     tags = [\"ivy-only\"],\n )"
        },
        {
            "sha": "244df7e99122b6df063820202a1e7ce23bb9dde2",
            "filename": "packages/bazel/test/ngc-wrapped/ivy_enabled/ng_module_ivy_test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 25,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/713ed2006345f7f3248c70533c757cd3a8747328/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2Fng_module_ivy_test.ts",
            "raw_url": "https://github.com/angular/angular/raw/713ed2006345f7f3248c70533c757cd3a8747328/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2Fng_module_ivy_test.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2Fng_module_ivy_test.ts?ref=713ed2006345f7f3248c70533c757cd3a8747328",
            "patch": "@@ -10,30 +10,10 @@ import {runfiles} from '@bazel/runfiles';\n import {readFileSync} from 'fs';\n \n describe('ng_module with ivy enabled', () => {\n-  describe('default compilation mode', () => {\n-    it('should generate definitions', () => {\n-      const outputFile = runfiles.resolveWorkspaceRelative(\n-          'packages/bazel/test/ngc-wrapped/ivy_enabled/test_module_default_compilation.js');\n-      const fileContent = readFileSync(outputFile, 'utf8');\n-      expect(fileContent).toContain(`TestComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent(`);\n-    });\n-  });\n-\n-  describe('full compilation mode', () => {\n-    it('should generate definitions', () => {\n-      const outputFile = runfiles.resolveWorkspaceRelative(\n-          'packages/bazel/test/ngc-wrapped/ivy_enabled/test_module_full_compilation.js');\n-      const fileContent = readFileSync(outputFile, 'utf8');\n-      expect(fileContent).toContain(`TestComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent(`);\n-    });\n-  });\n-\n-  describe('partial compilation mode', () => {\n-    it('should generate declarations', () => {\n-      const outputFile = runfiles.resolveWorkspaceRelative(\n-          'packages/bazel/test/ngc-wrapped/ivy_enabled/test_module_partial_compilation.js');\n-      const fileContent = readFileSync(outputFile, 'utf8');\n-      expect(fileContent).toContain(`TestComponent.ɵcmp = i0.ɵɵngDeclareComponent(`);\n-    });\n+  it('should generate definitions as with full compilation mode', () => {\n+    const outputFile = runfiles.resolveWorkspaceRelative(\n+        'packages/bazel/test/ngc-wrapped/ivy_enabled/test_module_default_compilation.js');\n+    const fileContent = readFileSync(outputFile, 'utf8');\n+    expect(fileContent).toContain(`TestComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent(`);\n   });\n });"
        },
        {
            "sha": "8fb7607675b097f827da05305ebc11cfe2233446",
            "filename": "packages/bazel/test/ngc-wrapped/ivy_enabled/test_module_full_compilation.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/56d0d63df9bc4c1d54e6c0a7f89959bcb6e8161b/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2Ftest_module_full_compilation.ts",
            "raw_url": "https://github.com/angular/angular/raw/56d0d63df9bc4c1d54e6c0a7f89959bcb6e8161b/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2Ftest_module_full_compilation.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2Ftest_module_full_compilation.ts?ref=56d0d63df9bc4c1d54e6c0a7f89959bcb6e8161b",
            "patch": "@@ -1,15 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Component} from '@angular/core';\n-\n-@Component({\n-  template: 'Hello',\n-})\n-export class TestComponent {\n-}"
        },
        {
            "sha": "8fb7607675b097f827da05305ebc11cfe2233446",
            "filename": "packages/bazel/test/ngc-wrapped/ivy_enabled/test_module_partial_compilation.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/56d0d63df9bc4c1d54e6c0a7f89959bcb6e8161b/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2Ftest_module_partial_compilation.ts",
            "raw_url": "https://github.com/angular/angular/raw/56d0d63df9bc4c1d54e6c0a7f89959bcb6e8161b/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2Ftest_module_partial_compilation.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Ftest%2Fngc-wrapped%2Fivy_enabled%2Ftest_module_partial_compilation.ts?ref=56d0d63df9bc4c1d54e6c0a7f89959bcb6e8161b",
            "patch": "@@ -1,15 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {Component} from '@angular/core';\n-\n-@Component({\n-  template: 'Hello',\n-})\n-export class TestComponent {\n-}"
        }
    ],
    "stats": {
        "total": 90,
        "additions": 5,
        "deletions": 85
    }
}