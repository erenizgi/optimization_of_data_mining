{
    "author": "josephperrott",
    "message": "feat(dev-infra): Add support for formatting all staged files (#38402)\n\nAdds an ng-dev formatter option to format all of the staged files. This will can\nbe used to format only the staged files during the pre-commit hook.\n\nPR Close #38402",
    "sha": "28534d83eeaf721c117af6be6a7f6da20ab352e5",
    "files": [
        {
            "sha": "8c635575abb833c54b0f01c52c51a128a60695a8",
            "filename": "dev-infra/format/cli.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/28534d83eeaf721c117af6be6a7f6da20ab352e5/dev-infra%2Fformat%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/28534d83eeaf721c117af6be6a7f6da20ab352e5/dev-infra%2Fformat%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fcli.ts?ref=28534d83eeaf721c117af6be6a7f6da20ab352e5",
            "patch": "@@ -7,7 +7,7 @@\n  */\n import * as yargs from 'yargs';\n \n-import {allChangedFilesSince, allFiles} from '../utils/repo-files';\n+import {allChangedFilesSince, allFiles, allStagedFiles} from '../utils/repo-files';\n \n import {checkFiles, formatFiles} from './format';\n \n@@ -34,6 +34,12 @@ export function buildFormatParser(localYargs: yargs.Argv) {\n             const executionCmd = check ? checkFiles : formatFiles;\n             executionCmd(allChangedFilesSince(sha));\n           })\n+      .command(\n+          'staged', 'Run the formatter on all staged files', {},\n+          ({check}) => {\n+            const executionCmd = check ? checkFiles : formatFiles;\n+            executionCmd(allStagedFiles());\n+          })\n       .command('files <files..>', 'Run the formatter on provided files', {}, ({check, files}) => {\n         const executionCmd = check ? checkFiles : formatFiles;\n         executionCmd(files);"
        },
        {
            "sha": "b509e90fc0b572553a3d649956a466642d383122",
            "filename": "dev-infra/utils/repo-files.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/28534d83eeaf721c117af6be6a7f6da20ab352e5/dev-infra%2Futils%2Frepo-files.ts",
            "raw_url": "https://github.com/angular/angular/raw/28534d83eeaf721c117af6be6a7f6da20ab352e5/dev-infra%2Futils%2Frepo-files.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Frepo-files.ts?ref=28534d83eeaf721c117af6be6a7f6da20ab352e5",
            "patch": "@@ -27,6 +27,18 @@ export function allChangedFilesSince(sha = 'HEAD') {\n   return Array.from(new Set([...diffFiles, ...untrackedFiles]));\n }\n \n+/**\n+ * A list of all staged files which have been modified.\n+ *\n+ * Only added, created and modified files are listed as others (deleted, renamed, etc) aren't\n+ * changed or available as content to act upon.\n+ */\n+export function allStagedFiles() {\n+  return gitOutputAsArray(`git diff --staged --name-only --diff-filter=ACM`);\n+}\n+\n+\n+\n export function allFiles() {\n   return gitOutputAsArray(`git ls-files`);\n }"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 19,
        "deletions": 1
    }
}