{
    "author": "crisbeto",
    "message": "Revert \"perf(core): avoid storing LView in __ngContext__ (#41358)\" (#41901)\n\nThis reverts commit 18b33e79d3d64f98f80838503e802d0369fcdb16.\n\nPR Close #41901",
    "sha": "2dd96e08aec73677cc20b556b443c44bf74e3bf6",
    "files": [
        {
            "sha": "08bbaafdd76b453ff1554b63372185ebf3d71c6f",
            "filename": "goldens/size-tracking/integration-payloads.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Fintegration-payloads.json?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -3,7 +3,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 1170,\n-        \"main-es2015\": 138718,\n+        \"main-es2015\": 138189,\n         \"polyfills-es2015\": 36964\n       }\n     }\n@@ -30,7 +30,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 1190,\n-        \"main-es2015\": 137087,\n+        \"main-es2015\": 136546,\n         \"polyfills-es2015\": 37641\n       }\n     }"
        },
        {
            "sha": "f5db218fac7a326fb4c47fe891829ac07a2c7295",
            "filename": "packages/core/src/debug/debug_node.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 17,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Fdebug%2Fdebug_node.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Fdebug%2Fdebug_node.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdebug%2Fdebug_node.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -262,10 +262,9 @@ class DebugElement__POST_R3__ extends DebugNode__POST_R3__ implements DebugEleme\n   }\n \n   get name(): string {\n-    const context = getLContext(this.nativeNode)!;\n-    const lView = context ? context.lView : null;\n-\n-    if (lView !== null) {\n+    const context = getLContext(this.nativeNode);\n+    if (context !== null) {\n+      const lView = context.lView;\n       const tData = lView[TVIEW].data;\n       const tNode = tData[context.nodeIndex] as TNode;\n       return tNode.value!;\n@@ -287,13 +286,12 @@ class DebugElement__POST_R3__ extends DebugNode__POST_R3__ implements DebugEleme\n    *  - attribute bindings (e.g. `[attr.role]=\"menu\"`)\n    */\n   get properties(): {[key: string]: any;} {\n-    const context = getLContext(this.nativeNode)!;\n-    const lView = context ? context.lView : null;\n-\n-    if (lView === null) {\n+    const context = getLContext(this.nativeNode);\n+    if (context === null) {\n       return {};\n     }\n \n+    const lView = context.lView;\n     const tData = lView[TVIEW].data;\n     const tNode = tData[context.nodeIndex] as TNode;\n \n@@ -314,13 +312,12 @@ class DebugElement__POST_R3__ extends DebugNode__POST_R3__ implements DebugEleme\n       return attributes;\n     }\n \n-    const context = getLContext(element)!;\n-    const lView = context ? context.lView : null;\n-\n-    if (lView === null) {\n+    const context = getLContext(element);\n+    if (context === null) {\n       return {};\n     }\n \n+    const lView = context.lView;\n     const tNodeAttrs = (lView[TVIEW].data[context.nodeIndex] as TNode).attrs;\n     const lowercaseTNodeAttrs: string[] = [];\n \n@@ -505,12 +502,11 @@ function _queryAllR3(\n function _queryAllR3(\n     parentElement: DebugElement, predicate: Predicate<DebugElement>|Predicate<DebugNode>,\n     matches: DebugElement[]|DebugNode[], elementsOnly: boolean) {\n-  const context = getLContext(parentElement.nativeNode)!;\n-  const lView = context ? context.lView : null;\n-  if (lView !== null) {\n-    const parentTNode = lView[TVIEW].data[context.nodeIndex] as TNode;\n+  const context = getLContext(parentElement.nativeNode);\n+  if (context !== null) {\n+    const parentTNode = context.lView[TVIEW].data[context.nodeIndex] as TNode;\n     _queryNodeChildrenR3(\n-        parentTNode, lView, predicate, matches, elementsOnly, parentElement.nativeNode);\n+        parentTNode, context.lView, predicate, matches, elementsOnly, parentElement.nativeNode);\n   } else {\n     // If the context is null, then `parentElement` was either created with Renderer2 or native DOM\n     // APIs."
        },
        {
            "sha": "43f4207eb7ad22107db7bfecdbc983eceb014435",
            "filename": "packages/core/src/render3/context_discovery.ts",
            "status": "modified",
            "additions": 29,
            "deletions": 27,
            "changes": 56,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -8,15 +8,12 @@\n import '../util/ng_dev_mode';\n \n import {assertDefined, assertDomNode} from '../util/assert';\n-import {EMPTY_ARRAY} from '../util/empty';\n \n-import {assertLView} from './assert';\n+import {EMPTY_ARRAY} from '../util/empty';\n import {LContext} from './interfaces/context';\n-import {getLViewById} from './interfaces/lview_tracking';\n import {TNode, TNodeFlags} from './interfaces/node';\n import {RElement, RNode} from './interfaces/renderer_dom';\n-import {isLView} from './interfaces/type_checks';\n-import {CONTEXT, HEADER_OFFSET, HOST, ID, LView, TVIEW} from './interfaces/view';\n+import {CONTEXT, HEADER_OFFSET, HOST, LView, TVIEW} from './interfaces/view';\n import {getComponentLViewByIndex, unwrapRNode} from './util/view_utils';\n \n \n@@ -46,7 +43,7 @@ export function getLContext(target: any): LContext|null {\n   if (mpValue) {\n     // only when it's an array is it considered an LView instance\n     // ... otherwise it's an already constructed LContext instance\n-    if (isLView(mpValue)) {\n+    if (Array.isArray(mpValue)) {\n       const lView: LView = mpValue!;\n       let nodeIndex: number;\n       let component: any = undefined;\n@@ -108,7 +105,12 @@ export function getLContext(target: any): LContext|null {\n     while (parent = parent.parentNode) {\n       const parentContext = readPatchedData(parent);\n       if (parentContext) {\n-        const lView = Array.isArray(parentContext) ? parentContext as LView : parentContext.lView;\n+        let lView: LView|null;\n+        if (Array.isArray(parentContext)) {\n+          lView = parentContext as LView;\n+        } else {\n+          lView = parentContext.lView;\n+        }\n \n         // the edge of the app was also reached here through another means\n         // (maybe because the DOM was changed manually).\n@@ -134,7 +136,14 @@ export function getLContext(target: any): LContext|null {\n  * Creates an empty instance of a `LContext` context\n  */\n function createLContext(lView: LView, nodeIndex: number, native: RNode): LContext {\n-  return new LContext(lView[ID], nodeIndex, native);\n+  return {\n+    lView,\n+    nodeIndex,\n+    native,\n+    component: undefined,\n+    directives: undefined,\n+    localRefs: undefined,\n+  };\n }\n \n /**\n@@ -144,24 +153,21 @@ function createLContext(lView: LView, nodeIndex: number, native: RNode): LContex\n  * @returns The component's view\n  */\n export function getComponentViewByInstance(componentInstance: {}): LView {\n-  let patchedData = readPatchedData(componentInstance);\n-  let lView: LView;\n+  let lView = readPatchedData(componentInstance);\n+  let view: LView;\n \n-  if (isLView(patchedData)) {\n-    const contextLView: LView = patchedData;\n-    const nodeIndex = findViaComponent(contextLView, componentInstance);\n-    lView = getComponentLViewByIndex(nodeIndex, contextLView);\n-    const context = createLContext(contextLView, nodeIndex, lView[HOST] as RElement);\n+  if (Array.isArray(lView)) {\n+    const nodeIndex = findViaComponent(lView, componentInstance);\n+    view = getComponentLViewByIndex(nodeIndex, lView);\n+    const context = createLContext(lView, nodeIndex, view[HOST] as RElement);\n     context.component = componentInstance;\n     attachPatchData(componentInstance, context);\n     attachPatchData(context.native, context);\n   } else {\n-    const context = patchedData as unknown as LContext;\n-    const contextLView = context.lView!;\n-    ngDevMode && assertLView(contextLView);\n-    lView = getComponentLViewByIndex(context.nodeIndex, contextLView);\n+    const context = lView as any as LContext;\n+    view = getComponentLViewByIndex(context.nodeIndex, context.lView);\n   }\n-  return lView;\n+  return view;\n }\n \n /**\n@@ -175,10 +181,7 @@ const MONKEY_PATCH_KEY_NAME = '__ngContext__';\n  */\n export function attachPatchData(target: any, data: LView|LContext) {\n   ngDevMode && assertDefined(target, 'Target expected');\n-  // Only attach the ID of the view in order to avoid memory leaks (see #41047). We only do this\n-  // for `LView`, because we have control over when an `LView` is created and destroyed, whereas\n-  // we can't know when to remove an `LContext`.\n-  target[MONKEY_PATCH_KEY_NAME] = isLView(data) ? data[ID] : data;\n+  target[MONKEY_PATCH_KEY_NAME] = data;\n }\n \n /**\n@@ -187,14 +190,13 @@ export function attachPatchData(target: any, data: LView|LContext) {\n  */\n export function readPatchedData(target: any): LView|LContext|null {\n   ngDevMode && assertDefined(target, 'Target expected');\n-  const data = target[MONKEY_PATCH_KEY_NAME];\n-  return (typeof data === 'number') ? getLViewById(data) : data || null;\n+  return target[MONKEY_PATCH_KEY_NAME] || null;\n }\n \n export function readPatchedLView(target: any): LView|null {\n   const value = readPatchedData(target);\n   if (value) {\n-    return isLView(value) ? value : value.lView;\n+    return Array.isArray(value) ? value : (value as LContext).lView;\n   }\n   return null;\n }"
        },
        {
            "sha": "1fd21dfbfdbefccf5231f387523e984481af6d82",
            "filename": "packages/core/src/render3/instructions/lview_debug.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -25,7 +25,7 @@ import {LQueries, TQueries} from '../interfaces/query';\n import {Renderer3, RendererFactory3} from '../interfaces/renderer';\n import {RComment, RElement, RNode} from '../interfaces/renderer_dom';\n import {getTStylingRangeNext, getTStylingRangeNextDuplicate, getTStylingRangePrev, getTStylingRangePrevDuplicate, TStylingKey, TStylingRange} from '../interfaces/styling';\n-import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DebugNode, DECLARATION_VIEW, DestroyHookData, FLAGS, HEADER_OFFSET, HookData, HOST, HostBindingOpCodes, ID, INJECTOR, LContainerDebug as ILContainerDebug, LView, LViewDebug as ILViewDebug, LViewDebugRange, LViewDebugRangeContent, LViewFlags, NEXT, NodeInjectorDebug, PARENT, QUERIES, RENDERER, RENDERER_FACTORY, SANITIZER, T_HOST, TData, TView as ITView, TVIEW, TView, TViewType, TViewTypeAsString} from '../interfaces/view';\n+import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DebugNode, DECLARATION_VIEW, DestroyHookData, FLAGS, HEADER_OFFSET, HookData, HOST, HostBindingOpCodes, INJECTOR, LContainerDebug as ILContainerDebug, LView, LViewDebug as ILViewDebug, LViewDebugRange, LViewDebugRangeContent, LViewFlags, NEXT, NodeInjectorDebug, PARENT, QUERIES, RENDERER, RENDERER_FACTORY, SANITIZER, T_HOST, TData, TView as ITView, TVIEW, TView, TViewType, TViewTypeAsString} from '../interfaces/view';\n import {attachDebugObject} from '../util/debug_utils';\n import {getParentInjectorIndex, getParentInjectorView} from '../util/injector_utils';\n import {unwrapRNode} from '../util/view_utils';\n@@ -513,9 +513,6 @@ export class LViewDebug implements ILViewDebug {\n   get tHost(): ITNode|null {\n     return this._raw_lView[T_HOST];\n   }\n-  get id(): number {\n-    return this._raw_lView[ID];\n-  }\n \n   get decls(): LViewDebugRange {\n     return toLViewRange(this.tView, this._raw_lView, HEADER_OFFSET, this.tView.bindingStartIndex);"
        },
        {
            "sha": "34d6ef6daf871be1a77772831c33179b96765184",
            "filename": "packages/core/src/render3/instructions/shared.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 9,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -28,13 +28,12 @@ import {executeCheckHooks, executeInitAndCheckHooks, incrementInitPhaseFlags} fr\n import {CONTAINER_HEADER_OFFSET, HAS_TRANSPLANTED_VIEWS, LContainer, MOVED_VIEWS} from '../interfaces/container';\n import {ComponentDef, ComponentTemplate, DirectiveDef, DirectiveDefListOrFactory, HostBindingsFunction, PipeDefListOrFactory, RenderFlags, ViewQueriesFunction} from '../interfaces/definition';\n import {NodeInjectorFactory} from '../interfaces/injector';\n-import {registerLView} from '../interfaces/lview_tracking';\n import {AttributeMarker, InitialInputData, InitialInputs, LocalRefExtractor, PropertyAliases, PropertyAliasValue, TAttributes, TConstantsOrFactory, TContainerNode, TDirectiveHostNode, TElementContainerNode, TElementNode, TIcuContainerNode, TNode, TNodeFlags, TNodeType, TProjectionNode} from '../interfaces/node';\n import {isProceduralRenderer, Renderer3, RendererFactory3} from '../interfaces/renderer';\n import {RComment, RElement, RNode, RText} from '../interfaces/renderer_dom';\n import {SanitizerFn} from '../interfaces/sanitization';\n import {isComponentDef, isComponentHost, isContentQueryHost, isRootView} from '../interfaces/type_checks';\n-import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DECLARATION_COMPONENT_VIEW, DECLARATION_VIEW, FLAGS, HEADER_OFFSET, HOST, HostBindingOpCodes, ID, InitPhaseState, INJECTOR, LView, LViewFlags, NEXT, PARENT, RENDERER, RENDERER_FACTORY, RootContext, RootContextFlags, SANITIZER, T_HOST, TData, TRANSPLANTED_VIEWS_TO_REFRESH, TVIEW, TView, TViewType} from '../interfaces/view';\n+import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DECLARATION_COMPONENT_VIEW, DECLARATION_VIEW, FLAGS, HEADER_OFFSET, HOST, HostBindingOpCodes, InitPhaseState, INJECTOR, LView, LViewFlags, NEXT, PARENT, RENDERER, RENDERER_FACTORY, RootContext, RootContextFlags, SANITIZER, T_HOST, TData, TRANSPLANTED_VIEWS_TO_REFRESH, TVIEW, TView, TViewType} from '../interfaces/view';\n import {assertPureTNodeType, assertTNodeType} from '../node_assert';\n import {updateTextNode} from '../node_manipulation';\n import {isInlineTemplate, isNodeMatchingSelectorList} from '../node_selector_matcher';\n@@ -144,7 +143,6 @@ export function createLView<T>(\n   lView[SANITIZER] = sanitizer || parentLView && parentLView[SANITIZER] || null!;\n   lView[INJECTOR as any] = injector || parentLView && parentLView[INJECTOR] || null;\n   lView[T_HOST] = tHostNode;\n-  lView[ID] = registerLView(lView);\n   ngDevMode &&\n       assertEqual(\n           tView.type == TViewType.Embedded ? parentLView !== null : true, true,\n@@ -1908,12 +1906,9 @@ export function scheduleTick(rootContext: RootContext, flags: RootContextFlags)\n export function tickRootContext(rootContext: RootContext) {\n   for (let i = 0; i < rootContext.components.length; i++) {\n     const rootComponent = rootContext.components[i];\n-    const lView = readPatchedLView(rootComponent);\n-    // We might not have an `LView` if the component was destroyed.\n-    if (lView !== null) {\n-      const tView = lView[TVIEW];\n-      renderComponentOrTemplate(tView, lView, tView.template, rootComponent);\n-    }\n+    const lView = readPatchedLView(rootComponent)!;\n+    const tView = lView[TVIEW];\n+    renderComponentOrTemplate(tView, lView, tView.template, rootComponent);\n   }\n }\n "
        },
        {
            "sha": "6f78e268918d53ab81a25be3eaaa5639f7006b9d",
            "filename": "packages/core/src/render3/interfaces/context.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 28,
            "changes": 49,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fcontext.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fcontext.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fcontext.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -7,7 +7,6 @@\n  */\n \n \n-import {getLViewById} from './lview_tracking';\n import {RNode} from './renderer_dom';\n import {LView} from './view';\n \n@@ -22,41 +21,35 @@ import {LView} from './view';\n  * function. The component, element and each directive instance will share the same instance\n  * of the context.\n  */\n-export class LContext {\n+export interface LContext {\n+  /**\n+   * The component's parent view data.\n+   */\n+  lView: LView;\n+\n+  /**\n+   * The index instance of the node.\n+   */\n+  nodeIndex: number;\n+\n+  /**\n+   * The instance of the DOM node that is attached to the lNode.\n+   */\n+  native: RNode;\n+\n   /**\n    * The instance of the Component node.\n    */\n-  public component: {}|null|undefined;\n+  component: {}|null|undefined;\n \n   /**\n    * The list of active directives that exist on this element.\n    */\n-  public directives: any[]|null|undefined;\n+  directives: any[]|null|undefined;\n \n   /**\n-   * The map of local references (local reference name => element or directive instance) that\n-   * exist on this element.\n+   * The map of local references (local reference name => element or directive instance) that exist\n+   * on this element.\n    */\n-  public localRefs: {[key: string]: any}|null|undefined;\n-\n-  /** Component's parent view data. */\n-  get lView(): LView|null {\n-    return getLViewById(this.lViewId);\n-  }\n-\n-  constructor(\n-      /**\n-       * ID of the component's parent view data.\n-       */\n-      private lViewId: number,\n-\n-      /**\n-       * The index instance of the node.\n-       */\n-      public nodeIndex: number,\n-\n-      /**\n-       * The instance of the DOM node that is attached to the lNode.\n-       */\n-      public native: RNode) {}\n+  localRefs: {[key: string]: any}|null|undefined;\n }"
        },
        {
            "sha": "7c965ff98a6228cbaf5a364900d661b42f2ef322",
            "filename": "packages/core/src/render3/interfaces/lview_tracking.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 35,
            "changes": 35,
            "blob_url": "https://github.com/angular/angular/blob/0dfd940a186c5dde308542beb784d1c29b67ca1b/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Flview_tracking.ts",
            "raw_url": "https://github.com/angular/angular/raw/0dfd940a186c5dde308542beb784d1c29b67ca1b/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Flview_tracking.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Flview_tracking.ts?ref=0dfd940a186c5dde308542beb784d1c29b67ca1b",
            "patch": "@@ -1,35 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import {assertNumber} from '../../util/assert';\n-import {ID, LView} from './view';\n-\n-// Keeps track of the currently-active LViews.\n-const TRACKED_LVIEWS = new Map<number, LView>();\n-\n-// Used for generating unique IDs for LViews.\n-let uniqueIdCounter = 0;\n-\n-/** Starts tracking an LView and returns a unique ID that can be used for future lookups. */\n-export function registerLView(lView: LView): number {\n-  const id = uniqueIdCounter++;\n-  TRACKED_LVIEWS.set(id, lView);\n-  return id;\n-}\n-\n-/** Gets an LView by its unique ID. */\n-export function getLViewById(id: number): LView|null {\n-  ngDevMode && assertNumber(id, 'ID used for LView lookup must be a number');\n-  return TRACKED_LVIEWS.get(id) || null;\n-}\n-\n-/** Stops tracking an LView. */\n-export function unregisterLView(lView: LView): void {\n-  ngDevMode && assertNumber(lView[ID], 'Cannot stop tracking an LView that does not have an ID');\n-  TRACKED_LVIEWS.delete(lView[ID]);\n-}"
        },
        {
            "sha": "af0202bcf64f32201025e5457bbfe68eb2e3671c",
            "filename": "packages/core/src/render3/interfaces/view.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -47,15 +47,14 @@ export const DECLARATION_COMPONENT_VIEW = 16;\n export const DECLARATION_LCONTAINER = 17;\n export const PREORDER_HOOK_FLAGS = 18;\n export const QUERIES = 19;\n-export const ID = 20;\n /**\n  * Size of LView's header. Necessary to adjust for it when setting slots.\n  *\n  * IMPORTANT: `HEADER_OFFSET` should only be referred to the in the `ɵɵ*` instructions to translate\n  * instruction index into `LView` index. All other indexes should be in the `LView` index space and\n  * there should be no need to refer to `HEADER_OFFSET` anywhere else.\n  */\n-export const HEADER_OFFSET = 21;\n+export const HEADER_OFFSET = 20;\n \n \n // This interface replaces the real LView interface if it is an arg or a\n@@ -327,9 +326,6 @@ export interface LView extends Array<any> {\n    * are not `Dirty`/`CheckAlways`.\n    */\n   [TRANSPLANTED_VIEWS_TO_REFRESH]: number;\n-\n-  /** Unique ID of the view. Used for `__ngContext__` lookups in the `LView` registry. */\n-  [ID]: number;\n }\n \n /** Flags associated with an LView (saved in LView[FLAGS]) */"
        },
        {
            "sha": "801957fe21dc5d3c5d8f03e89c5780616d87758d",
            "filename": "packages/core/src/render3/node_manipulation.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Fnode_manipulation.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Fnode_manipulation.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fnode_manipulation.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -19,7 +19,6 @@ import {icuContainerIterate} from './i18n/i18n_tree_shaking';\n import {CONTAINER_HEADER_OFFSET, HAS_TRANSPLANTED_VIEWS, LContainer, MOVED_VIEWS, NATIVE, unusedValueExportToPlacateAjd as unused1} from './interfaces/container';\n import {ComponentDef} from './interfaces/definition';\n import {NodeInjectorFactory} from './interfaces/injector';\n-import {unregisterLView} from './interfaces/lview_tracking';\n import {TElementNode, TIcuContainerNode, TNode, TNodeFlags, TNodeType, TProjectionNode, unusedValueExportToPlacateAjd as unused2} from './interfaces/node';\n import {unusedValueExportToPlacateAjd as unused3} from './interfaces/projection';\n import {isProceduralRenderer, ProceduralRenderer3, Renderer3, unusedValueExportToPlacateAjd as unused4} from './interfaces/renderer';\n@@ -396,7 +395,6 @@ export function destroyLView(tView: TView, lView: LView) {\n     }\n \n     destroyViewTree(lView);\n-    unregisterLView(lView);\n   }\n }\n "
        },
        {
            "sha": "430df1bf2d8f8a505cedee85bb47b51b22c62c46",
            "filename": "packages/core/src/render3/util/discovery_utils.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 41,
            "changes": 69,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -11,7 +11,7 @@ import {Injector} from '../../di/injector';\n import {ViewEncapsulation} from '../../metadata/view';\n import {assertEqual} from '../../util/assert';\n import {assertLView} from '../assert';\n-import {discoverLocalRefs, getComponentAtNodeIndex, getDirectivesAtNodeIndex, getLContext, readPatchedLView} from '../context_discovery';\n+import {discoverLocalRefs, getComponentAtNodeIndex, getDirectivesAtNodeIndex, getLContext} from '../context_discovery';\n import {getComponentDef, getDirectiveDef} from '../definition';\n import {NodeInjector} from '../di';\n import {buildDebugNode} from '../instructions/lview_debug';\n@@ -20,7 +20,6 @@ import {DirectiveDef} from '../interfaces/definition';\n import {TElementNode, TNode, TNodeProviderIndexes} from '../interfaces/node';\n import {isLView} from '../interfaces/type_checks';\n import {CLEANUP, CONTEXT, DebugNode, FLAGS, LView, LViewFlags, T_HOST, TVIEW, TViewType} from '../interfaces/view';\n-\n import {stringifyForError} from './stringify_utils';\n import {getLViewParent, getRootContext} from './view_traversal_utils';\n import {getTNode, unwrapRNode} from './view_utils';\n@@ -53,16 +52,12 @@ import {getTNode, unwrapRNode} from './view_utils';\n  * @globalApi ng\n  */\n export function getComponent<T>(element: Element): T|null {\n-  ngDevMode && assertDomElement(element);\n+  assertDomElement(element);\n   const context = getLContext(element);\n   if (context === null) return null;\n \n   if (context.component === undefined) {\n-    const lView = context.lView;\n-    if (lView === null) {\n-      return null;\n-    }\n-    context.component = getComponentAtNodeIndex(context.nodeIndex, lView);\n+    context.component = getComponentAtNodeIndex(context.nodeIndex, context.lView);\n   }\n \n   return context.component as T;\n@@ -83,9 +78,8 @@ export function getComponent<T>(element: Element): T|null {\n  */\n export function getContext<T>(element: Element): T|null {\n   assertDomElement(element);\n-  const context = getLContext(element)!;\n-  const lView = context ? context.lView : null;\n-  return lView === null ? null : lView[CONTEXT] as T;\n+  const context = getLContext(element);\n+  return context === null ? null : context.lView[CONTEXT] as T;\n }\n \n /**\n@@ -104,11 +98,12 @@ export function getContext<T>(element: Element): T|null {\n  * @globalApi ng\n  */\n export function getOwningComponent<T>(elementOrDir: Element|{}): T|null {\n-  const context = getLContext(elementOrDir)!;\n-  let lView = context ? context.lView : null;\n-  if (lView === null) return null;\n+  const context = getLContext(elementOrDir);\n+  if (context === null) return null;\n \n+  let lView = context.lView;\n   let parent: LView|null;\n+  ngDevMode && assertLView(lView);\n   while (lView[TVIEW].type === TViewType.Embedded && (parent = getLViewParent(lView)!)) {\n     lView = parent;\n   }\n@@ -127,8 +122,7 @@ export function getOwningComponent<T>(elementOrDir: Element|{}): T|null {\n  * @globalApi ng\n  */\n export function getRootComponents(elementOrDir: Element|{}): {}[] {\n-  const lView = readPatchedLView(elementOrDir);\n-  return lView !== null ? [...getRootContext(lView).components] : [];\n+  return [...getRootContext(elementOrDir).components];\n }\n \n /**\n@@ -142,12 +136,11 @@ export function getRootComponents(elementOrDir: Element|{}): {}[] {\n  * @globalApi ng\n  */\n export function getInjector(elementOrDir: Element|{}): Injector {\n-  const context = getLContext(elementOrDir)!;\n-  const lView = context ? context.lView : null;\n-  if (lView === null) return Injector.NULL;\n+  const context = getLContext(elementOrDir);\n+  if (context === null) return Injector.NULL;\n \n-  const tNode = lView[TVIEW].data[context.nodeIndex] as TElementNode;\n-  return new NodeInjector(tNode, lView);\n+  const tNode = context.lView[TVIEW].data[context.nodeIndex] as TElementNode;\n+  return new NodeInjector(tNode, context.lView);\n }\n \n /**\n@@ -156,9 +149,9 @@ export function getInjector(elementOrDir: Element|{}): Injector {\n  * @param element Element for which the injection tokens should be retrieved.\n  */\n export function getInjectionTokens(element: Element): any[] {\n-  const context = getLContext(element)!;\n-  const lView = context ? context.lView : null;\n-  if (lView === null) return [];\n+  const context = getLContext(element);\n+  if (context === null) return [];\n+  const lView = context.lView;\n   const tView = lView[TVIEW];\n   const tNode = tView.data[context.nodeIndex] as TNode;\n   const providerTokens: any[] = [];\n@@ -207,12 +200,12 @@ export function getDirectives(node: Node): {}[] {\n     return [];\n   }\n \n-  const context = getLContext(node)!;\n-  const lView = context ? context.lView : null;\n-  if (lView === null) {\n+  const context = getLContext(node);\n+  if (context === null) {\n     return [];\n   }\n \n+  const lView = context.lView;\n   const tView = lView[TVIEW];\n   const nodeIndex = context.nodeIndex;\n   if (!tView?.data[nodeIndex]) {\n@@ -304,11 +297,7 @@ export function getLocalRefs(target: {}): {[key: string]: any} {\n   if (context === null) return {};\n \n   if (context.localRefs === undefined) {\n-    const lView = context.lView;\n-    if (lView === null) {\n-      return {};\n-    }\n-    context.localRefs = discoverLocalRefs(lView, context.nodeIndex);\n+    context.localRefs = discoverLocalRefs(context.lView, context.nodeIndex);\n   }\n \n   return context.localRefs || {};\n@@ -394,11 +383,11 @@ export interface Listener {\n  * @globalApi ng\n  */\n export function getListeners(element: Element): Listener[] {\n-  ngDevMode && assertDomElement(element);\n+  assertDomElement(element);\n   const lContext = getLContext(element);\n-  const lView = lContext === null ? null : lContext.lView;\n-  if (lView === null) return [];\n+  if (lContext === null) return [];\n \n+  const lView = lContext.lView;\n   const tView = lView[TVIEW];\n   const lCleanup = lView[CLEANUP];\n   const tCleanup = tView.cleanup;\n@@ -452,13 +441,12 @@ export function getDebugNode(element: Element): DebugNode|null {\n     throw new Error('Expecting instance of DOM Element');\n   }\n \n-  const lContext = getLContext(element)!;\n-  const lView = lContext ? lContext.lView : null;\n-\n-  if (lView === null) {\n+  const lContext = getLContext(element);\n+  if (lContext === null) {\n     return null;\n   }\n \n+  const lView = lContext.lView;\n   const nodeIndex = lContext.nodeIndex;\n   if (nodeIndex !== -1) {\n     const valueInLView = lView[nodeIndex];\n@@ -485,8 +473,7 @@ export function getDebugNode(element: Element): DebugNode|null {\n export function getComponentLView(target: any): LView {\n   const lContext = getLContext(target)!;\n   const nodeIndx = lContext.nodeIndex;\n-  const lView = lContext.lView!;\n-  ngDevMode && assertLView(lView);\n+  const lView = lContext.lView;\n   const componentLView = lView[nodeIndx];\n   ngDevMode && assertLView(componentLView);\n   return componentLView;"
        },
        {
            "sha": "31994aadac7389cf1c23368415b8720ded57cf7b",
            "filename": "packages/core/test/acceptance/component_spec.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 41,
            "changes": 41,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Facceptance%2Fcomponent_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Facceptance%2Fcomponent_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fcomponent_spec.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -141,47 +141,6 @@ describe('component', () => {\n        expect(fixture.nativeElement.textContent.trim()).toBe('hello');\n      });\n \n-  onlyInIvy('ViewEngine has a specific error for this while Ivy does not')\n-      .it('should not throw when calling `detectChanges` on the ChangeDetectorRef of a destroyed view',\n-          () => {\n-            @Component({template: 'hello'})\n-            class HelloComponent {\n-            }\n-\n-            // TODO: This module is only used to declare the `entryComponets` since\n-            //  `configureTestingModule` doesn't support it. The module can be removed\n-            // once ViewEngine is removed.\n-            @NgModule({\n-              declarations: [HelloComponent],\n-              exports: [HelloComponent],\n-              entryComponents: [HelloComponent]\n-            })\n-            class HelloModule {\n-            }\n-\n-            @Component({template: `<div #insertionPoint></div>`})\n-            class App {\n-              @ViewChild('insertionPoint', {read: ViewContainerRef})\n-              viewContainerRef!: ViewContainerRef;\n-              constructor(public componentFactoryResolver: ComponentFactoryResolver) {}\n-            }\n-\n-            TestBed.configureTestingModule({declarations: [App], imports: [HelloModule]});\n-            const fixture = TestBed.createComponent(App);\n-            fixture.detectChanges();\n-\n-            const instance = fixture.componentInstance;\n-            const factory =\n-                instance.componentFactoryResolver.resolveComponentFactory(HelloComponent);\n-            const componentRef = instance.viewContainerRef.createComponent(factory);\n-            fixture.detectChanges();\n-\n-            expect(() => {\n-              componentRef.destroy();\n-              componentRef.changeDetectorRef.detectChanges();\n-            }).not.toThrow();\n-          });\n-\n   // TODO: add tests with Native once tests run in real browser (domino doesn't support shadow root)\n   describe('encapsulation', () => {\n     @Component({"
        },
        {
            "sha": "436d134d8bac85f834d98938ca6215868fe11703",
            "filename": "packages/core/test/acceptance/debug_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Facceptance%2Fdebug_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Facceptance%2Fdebug_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fdebug_spec.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -27,7 +27,7 @@ onlyInIvy('Ivy specific').describe('Debug Representation', () => {\n     const fixture = TestBed.createComponent(MyComponent);\n     fixture.detectChanges();\n \n-    const hostView = getLContext(fixture.componentInstance)!.lView!.debug!;\n+    const hostView = getLContext(fixture.componentInstance)!.lView.debug!;\n     expect(hostView.hostHTML).toEqual(null);\n     const myCompView = hostView.childViews[0] as LViewDebug;\n     expect(myCompView.hostHTML).toContain('<div id=\"123\">Hello World</div>');\n@@ -47,7 +47,7 @@ onlyInIvy('Ivy specific').describe('Debug Representation', () => {\n         const fixture = TestBed.createComponent(MyComponent);\n         fixture.detectChanges();\n \n-        const hostView = getLContext(fixture.componentInstance)!.lView!.debug!;\n+        const hostView = getLContext(fixture.componentInstance)!.lView.debug!;\n         const myComponentView = hostView.childViews[0] as LViewDebug;\n         expect(myComponentView.decls).toEqual({\n           start: HEADER_OFFSET,"
        },
        {
            "sha": "a1d589eabe7550a2bcaa07eef86244d26422a512",
            "filename": "packages/core/test/acceptance/discover_utils_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 69,
            "changes": 71,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Facceptance%2Fdiscover_utils_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Facceptance%2Fdiscover_utils_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fdiscover_utils_spec.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -69,19 +69,16 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n   @Component({\n     selector: 'my-app',\n     template: `\n-      <span (click)=\"log($event)\" *ngIf=\"spanVisible\">{{text}}</span>\n+      <span (click)=\"log($event)\">{{text}}</span>\n       <div dirA #div #foo=\"dirA\"></div>\n       <child></child>\n       <child dirA #child></child>\n-      <child dirA *ngIf=\"conditionalChildVisible\"></child>\n+      <child dirA *ngIf=\"true\"></child>\n       <ng-container><p></p></ng-container>\n-      <b *ngIf=\"visible\">Bold</b>\n     `\n   })\n   class MyApp {\n     text: string = 'INIT';\n-    spanVisible = true;\n-    conditionalChildVisible = true;\n     @Input('a') b = 2;\n     @Output('c') d = new EventEmitter();\n     constructor() {\n@@ -108,15 +105,6 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getComponent<Child>(child[0])).toEqual(childComponent[0]);\n       expect(getComponent<Child>(child[1])).toEqual(childComponent[1]);\n     });\n-    it('should not throw when called on a destroyed node', () => {\n-      expect(getComponent(span[0])).toEqual(null);\n-      expect(getComponent<Child>(child[2])).toEqual(childComponent[2]);\n-      fixture.componentInstance.spanVisible = false;\n-      fixture.componentInstance.conditionalChildVisible = false;\n-      fixture.detectChanges();\n-      expect(getComponent(span[0])).toEqual(null);\n-      expect(getComponent<Child>(child[2])).toEqual(childComponent[2]);\n-    });\n   });\n \n   describe('getComponentLView', () => {\n@@ -143,12 +131,6 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getContext<{$implicit: boolean}>(child[2])!.$implicit).toEqual(true);\n       expect(getContext<Child>(p[0])).toEqual(childComponent[0]);\n     });\n-    it('should return null for destroyed node', () => {\n-      expect(getContext(span[0])).toBeTruthy();\n-      fixture.componentInstance.spanVisible = false;\n-      fixture.detectChanges();\n-      expect(getContext(span[0])).toBeNull();\n-    });\n   });\n \n   describe('getHostElement', () => {\n@@ -164,12 +146,6 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n     it('should throw on unknown target', () => {\n       expect(() => getHostElement({})).toThrowError();  //\n     });\n-    it('should return element for destroyed node', () => {\n-      expect(getHostElement(span[0])).toEqual(span[0]);\n-      fixture.componentInstance.spanVisible = false;\n-      fixture.detectChanges();\n-      expect(getHostElement(span[0])).toEqual(span[0]);\n-    });\n   });\n \n   describe('getInjector', () => {\n@@ -187,12 +163,6 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getInjector(dirA[0]).get(String)).toEqual('Module');\n       expect(getInjector(dirA[1]).get(String)).toEqual('Child');\n     });\n-    it('should retrieve injector from destroyed node', () => {\n-      expect(getInjector(span[0])).toBeTruthy();\n-      fixture.componentInstance.spanVisible = false;\n-      fixture.detectChanges();\n-      expect(getInjector(span[0])).toBeTruthy();\n-    });\n   });\n \n   describe('getDirectives', () => {\n@@ -205,12 +175,6 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getDirectives(div[0])).toEqual([dirA[0]]);\n       expect(getDirectives(child[1])).toEqual([dirA[1]]);\n     });\n-    it('should return empty array for destroyed node', () => {\n-      expect(getDirectives(span[0])).toEqual([]);\n-      fixture.componentInstance.spanVisible = false;\n-      fixture.detectChanges();\n-      expect(getDirectives(span[0])).toEqual([]);\n-    });\n   });\n \n   describe('getOwningComponent', () => {\n@@ -238,12 +202,6 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getOwningComponent<MyApp>(dirA[0])).toEqual(myApp);\n       expect(getOwningComponent<MyApp>(dirA[1])).toEqual(myApp);\n     });\n-    it('should return null for destroyed node', () => {\n-      expect(getOwningComponent<MyApp>(span[0])).toEqual(myApp);\n-      fixture.componentInstance.spanVisible = false;\n-      fixture.detectChanges();\n-      expect(getOwningComponent<MyApp>(span[0])).toEqual(null);\n-    });\n   });\n \n   describe('getLocalRefs', () => {\n@@ -261,13 +219,6 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getLocalRefs(child[1])).toEqual({child: childComponent[1]});\n       expect(getLocalRefs(dirA[1])).toEqual({child: childComponent[1]});\n     });\n-\n-    it('should retrieve from a destroyed node', () => {\n-      expect(getLocalRefs(span[0])).toEqual({});\n-      fixture.componentInstance.spanVisible = false;\n-      fixture.detectChanges();\n-      expect(getLocalRefs(span[0])).toEqual({});\n-    });\n   });\n \n   describe('getRootComponents', () => {\n@@ -283,12 +234,6 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getRootComponents(div[0])).toEqual(rootComponents);\n       expect(getRootComponents(p[0])).toEqual(rootComponents);\n     });\n-    it('should return an empty array for a destroyed node', () => {\n-      expect(getRootComponents(span[0])).toEqual([myApp]);\n-      fixture.componentInstance.spanVisible = false;\n-      fixture.detectChanges();\n-      expect(getRootComponents(span[0])).toEqual([]);\n-    });\n   });\n \n   describe('getListeners', () => {\n@@ -306,12 +251,6 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       listeners[0].callback('CLICKED');\n       expect(log).toEqual(['CLICKED']);\n     });\n-    it('should return no listeners for destroyed node', () => {\n-      expect(getListeners(span[0]).length).toEqual(1);\n-      fixture.componentInstance.spanVisible = false;\n-      fixture.detectChanges();\n-      expect(getListeners(span[0]).length).toEqual(0);\n-    });\n   });\n \n   describe('getInjectionTokens', () => {\n@@ -320,12 +259,6 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getInjectionTokens(child[0])).toEqual([String, Child]);\n       expect(getInjectionTokens(child[1])).toEqual([String, Child, DirectiveA]);\n     });\n-    it('should retrieve tokens from destroyed node', () => {\n-      expect(getInjectionTokens(span[0])).toEqual([]);\n-      fixture.componentInstance.spanVisible = false;\n-      fixture.detectChanges();\n-      expect(getInjectionTokens(span[0])).toEqual([]);\n-    });\n   });\n \n   describe('markDirty', () => {"
        },
        {
            "sha": "64763f76509061bb2f200235f35eb89c30264e9f",
            "filename": "packages/core/test/acceptance/ngdevmode_debug_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Facceptance%2Fngdevmode_debug_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Facceptance%2Fngdevmode_debug_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fngdevmode_debug_spec.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -32,7 +32,7 @@ onlyInIvy('Debug information exist in ivy only').describe('ngDevMode debug', ()\n \n       TestBed.configureTestingModule({declarations: [MyApp], imports: [CommonModule]});\n       const fixture = TestBed.createComponent(MyApp);\n-      const rootLView = getLContext(fixture.nativeElement)!.lView!;\n+      const rootLView = getLContext(fixture.nativeElement)!.lView;\n       expect(rootLView.constructor.name).toEqual('LRootView');\n \n       const componentLView = getComponentLView(fixture.componentInstance);\n@@ -41,7 +41,7 @@ onlyInIvy('Debug information exist in ivy only').describe('ngDevMode debug', ()\n       const element: HTMLElement = fixture.nativeElement;\n       fixture.detectChanges();\n       const li = element.querySelector('li')!;\n-      const embeddedLView = getLContext(li)!.lView!;\n+      const embeddedLView = getLContext(li)!.lView;\n       expect(embeddedLView.constructor.name).toEqual('LEmbeddedView_MyApp_li_1');\n     });\n   });"
        },
        {
            "sha": "dd29afd07a730564658f68d0080256b9c5ba517f",
            "filename": "packages/core/test/bundling/cyclic_import/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fcyclic_import%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fcyclic_import%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fcyclic_import%2Fbundle.golden_symbols.json?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -47,9 +47,6 @@\n   {\n     \"name\": \"SimpleChange\"\n   },\n-  {\n-    \"name\": \"TRACKED_LVIEWS\"\n-  },\n   {\n     \"name\": \"TriggerComponent\"\n   },\n@@ -257,9 +254,6 @@\n   {\n     \"name\": \"isInlineTemplate\"\n   },\n-  {\n-    \"name\": \"isLView\"\n-  },\n   {\n     \"name\": \"isNodeMatchingSelector\"\n   },\n@@ -359,9 +353,6 @@\n   {\n     \"name\": \"setUpAttributes\"\n   },\n-  {\n-    \"name\": \"uniqueIdCounter\"\n-  },\n   {\n     \"name\": \"updateTransplantedViewCount\"\n   },"
        },
        {
            "sha": "b89832be26bc15d9af4a25051b96b99a3d5d069d",
            "filename": "packages/core/test/bundling/forms_reactive/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fbundle.golden_symbols.json?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -548,9 +548,6 @@\n   {\n     \"name\": \"THROW_IF_NOT_FOUND\"\n   },\n-  {\n-    \"name\": \"TRACKED_LVIEWS\"\n-  },\n   {\n     \"name\": \"TRANSITION_ID\"\n   },\n@@ -1571,9 +1568,6 @@\n   {\n     \"name\": \"u\"\n   },\n-  {\n-    \"name\": \"uniqueIdCounter\"\n-  },\n   {\n     \"name\": \"unwrapRNode\"\n   },"
        },
        {
            "sha": "65ee1ee746dc3027063e06dd2bfc19d4cc0f6e97",
            "filename": "packages/core/test/bundling/forms_reactive/forms_e2e_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fforms_e2e_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fforms_e2e_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fforms_e2e_spec.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import '@angular/compiler';\n+import {ɵwhenRendered as whenRendered} from '@angular/core';\n import {withBody} from '@angular/private/testing';\n import * as path from 'path';\n \n@@ -17,8 +18,8 @@ describe('functional test for reactive forms', () => {\n   BUNDLES.forEach((bundle) => {\n     describe(`using ${bundle} bundle`, () => {\n       it('should render template form', withBody('<app-root></app-root>', async () => {\n-           const {whenRendered, bootstrapApp} = require(path.join(PACKAGE, bundle));\n-           await bootstrapApp();\n+           require(path.join(PACKAGE, bundle));\n+           await (window as any).waitForApp;\n \n            // Reactive forms\n            const reactiveFormsComponent = (window as any).reactiveFormsComponent;"
        },
        {
            "sha": "b44c4f410be69536e186705730eca61ffb3398ff",
            "filename": "packages/core/test/bundling/forms_reactive/index.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 13,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Findex.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {Component, NgModule, ɵNgModuleFactory as NgModuleFactory, ɵwhenRendered as whenRendered} from '@angular/core';\n+import {Component, NgModule, ɵNgModuleFactory as NgModuleFactory} from '@angular/core';\n import {FormArray, FormBuilder, FormControl, FormGroup, ReactiveFormsModule, Validators} from '@angular/forms';\n import {BrowserModule, platformBrowser} from '@angular/platform-browser';\n \n@@ -93,15 +93,5 @@ class FormsExampleModule {\n   }\n }\n \n-function bootstrapApp() {\n-  return platformBrowser().bootstrapModuleFactory(\n-      new NgModuleFactory(FormsExampleModule), {ngZone: 'noop'});\n-}\n-\n-// This bundle includes `@angular/core` within it which means that the test asserting\n-// against it will load a different core bundle. These symbols are exposed so that they\n-// can interact with the correct `@angular/core` instance.\n-module.exports = {\n-  whenRendered,\n-  bootstrapApp\n-};\n+(window as any).waitForApp = platformBrowser().bootstrapModuleFactory(\n+    new NgModuleFactory(FormsExampleModule), {ngZone: 'noop'});"
        },
        {
            "sha": "df9a8e4ae4a7fd65efb75804b9853384272d5678",
            "filename": "packages/core/test/bundling/forms_template_driven/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fbundle.golden_symbols.json?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -536,9 +536,6 @@\n   {\n     \"name\": \"THROW_IF_NOT_FOUND\"\n   },\n-  {\n-    \"name\": \"TRACKED_LVIEWS\"\n-  },\n   {\n     \"name\": \"TRANSITION_ID\"\n   },\n@@ -1544,9 +1541,6 @@\n   {\n     \"name\": \"u\"\n   },\n-  {\n-    \"name\": \"uniqueIdCounter\"\n-  },\n   {\n     \"name\": \"unwrapRNode\"\n   },"
        },
        {
            "sha": "fb67ed4908cf8a92687691dfbf9ad118832426f8",
            "filename": "packages/core/test/bundling/forms_template_driven/forms_e2e_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fforms_e2e_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fforms_e2e_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fforms_e2e_spec.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import '@angular/compiler';\n+import {ɵwhenRendered as whenRendered} from '@angular/core';\n import {withBody} from '@angular/private/testing';\n import * as path from 'path';\n \n@@ -17,8 +18,8 @@ describe('functional test for forms', () => {\n   BUNDLES.forEach((bundle) => {\n     describe(`using ${bundle} bundle`, () => {\n       it('should render template form', withBody('<app-root></app-root>', async () => {\n-           const {bootstrapApp, whenRendered} = require(path.join(PACKAGE, bundle));\n-           await bootstrapApp();\n+           require(path.join(PACKAGE, bundle));\n+           await (window as any).waitForApp;\n \n            // Template forms\n            const templateFormsComponent = (window as any).templateFormsComponent;"
        },
        {
            "sha": "fb03c5c0c50c8d8347cd46db8e26ac52d714f7be",
            "filename": "packages/core/test/bundling/forms_template_driven/index.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 13,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Findex.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {Component, NgModule, ɵNgModuleFactory as NgModuleFactory, ɵwhenRendered as whenRendered} from '@angular/core';\n+import {Component, NgModule, ɵNgModuleFactory as NgModuleFactory} from '@angular/core';\n import {FormsModule} from '@angular/forms';\n import {BrowserModule, platformBrowser} from '@angular/platform-browser';\n \n@@ -70,15 +70,5 @@ class FormsExampleModule {\n   }\n }\n \n-function bootstrapApp() {\n-  return platformBrowser().bootstrapModuleFactory(\n-      new NgModuleFactory(FormsExampleModule), {ngZone: 'noop'});\n-}\n-\n-// This bundle includes `@angular/core` within it which means that the test asserting\n-// against it will load a different core bundle. These symbols are exposed so that they\n-// can interact with the correct `@angular/core` instance.\n-module.exports = {\n-  whenRendered,\n-  bootstrapApp\n-};\n+(window as any).waitForApp = platformBrowser().bootstrapModuleFactory(\n+    new NgModuleFactory(FormsExampleModule), {ngZone: 'noop'});"
        },
        {
            "sha": "9f68ceb496c7128ff6c5fabdddd2513bc896e1a8",
            "filename": "packages/core/test/bundling/hello_world/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fhello_world%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Fhello_world%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fhello_world%2Fbundle.golden_symbols.json?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -41,9 +41,6 @@\n   {\n     \"name\": \"SimpleChange\"\n   },\n-  {\n-    \"name\": \"TRACKED_LVIEWS\"\n-  },\n   {\n     \"name\": \"ViewEncapsulation\"\n   },\n@@ -176,9 +173,6 @@\n   {\n     \"name\": \"isInCheckNoChangesMode\"\n   },\n-  {\n-    \"name\": \"isLView\"\n-  },\n   {\n     \"name\": \"isProceduralRenderer\"\n   },\n@@ -242,9 +236,6 @@\n   {\n     \"name\": \"setSelectedIndex\"\n   },\n-  {\n-    \"name\": \"uniqueIdCounter\"\n-  },\n   {\n     \"name\": \"updateTransplantedViewCount\"\n   },"
        },
        {
            "sha": "2f236a71e81397248ce6494884bf4a48c7a8b822",
            "filename": "packages/core/test/bundling/router/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -785,9 +785,6 @@\n   {\n     \"name\": \"TQuery_\"\n   },\n-  {\n-    \"name\": \"TRACKED_LVIEWS\"\n-  },\n   {\n     \"name\": \"TRANSITION_ID\"\n   },\n@@ -2018,9 +2015,6 @@\n   {\n     \"name\": \"u\"\n   },\n-  {\n-    \"name\": \"uniqueIdCounter\"\n-  },\n   {\n     \"name\": \"unwrapElementRef\"\n   },"
        },
        {
            "sha": "057cd33ab4948fbe6d930429495cea11932ebbfd",
            "filename": "packages/core/test/bundling/todo/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Fbundle.golden_symbols.json?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -32,9 +32,6 @@\n   {\n     \"name\": \"IterableDiffers\"\n   },\n-  {\n-    \"name\": \"LContext\"\n-  },\n   {\n     \"name\": \"NG_COMP_DEF\"\n   },\n@@ -113,9 +110,6 @@\n   {\n     \"name\": \"SkipSelf\"\n   },\n-  {\n-    \"name\": \"TRACKED_LVIEWS\"\n-  },\n   {\n     \"name\": \"TemplateRef\"\n   },\n@@ -386,9 +380,6 @@\n   {\n     \"name\": \"getLView\"\n   },\n-  {\n-    \"name\": \"getLViewById\"\n-  },\n   {\n     \"name\": \"getLViewParent\"\n   },\n@@ -749,9 +740,6 @@\n   {\n     \"name\": \"trackByIdentity\"\n   },\n-  {\n-    \"name\": \"uniqueIdCounter\"\n-  },\n   {\n     \"name\": \"unwrapRNode\"\n   },"
        },
        {
            "sha": "c9efb5b83b07996ec2855f991132050cbd5d5ad2",
            "filename": "packages/core/test/bundling/todo/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 9,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Findex.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -9,7 +9,7 @@\n import '@angular/core/test/bundling/util/src/reflect_metadata';\n \n import {CommonModule} from '@angular/common';\n-import {Component, Injectable, NgModule, ViewEncapsulation, ɵmarkDirty as markDirty, ɵrenderComponent as renderComponent, ɵwhenRendered as whenRendered} from '@angular/core';\n+import {Component, Injectable, NgModule, ViewEncapsulation, ɵmarkDirty as markDirty, ɵrenderComponent as renderComponent} from '@angular/core';\n \n class Todo {\n   editing: boolean;\n@@ -133,9 +133,7 @@ class TodoStore {\n class ToDoAppComponent {\n   newTodoText = '';\n \n-  constructor(public todoStore: TodoStore) {\n-    (window as any).todoAppComponent = this;\n-  }\n+  constructor(public todoStore: TodoStore) {}\n \n   cancelEditingTodo(todo: Todo) {\n     todo.editing = false;\n@@ -202,8 +200,3 @@ class ToDoAppModule {\n }\n \n renderComponent(ToDoAppComponent);\n-\n-// This bundle includes `@angular/core` within it which means that the test asserting\n-// against it will load a different core bundle. These symbols are exposed so that they\n-// can interact with the correct `@angular/core` instance.\n-module.exports = {whenRendered};"
        },
        {
            "sha": "b3506d457bcf440443e36f741709e41c7a2bd72d",
            "filename": "packages/core/test/bundling/todo/todo_e2e_spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Ftodo_e2e_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Ftodo_e2e_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Ftodo_e2e_spec.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -7,22 +7,28 @@\n  */\n \n import '@angular/compiler';\n+import {ɵwhenRendered as whenRendered} from '@angular/core';\n+import {getComponent} from '@angular/core/src/render3';\n import {withBody} from '@angular/private/testing';\n import * as path from 'path';\n \n+const UTF8 = {\n+  encoding: 'utf-8'\n+};\n const PACKAGE = 'angular/packages/core/test/bundling/todo';\n const BUNDLES = ['bundle.js', 'bundle.min_debug.js', 'bundle.min.js'];\n \n describe('functional test for todo', () => {\n   BUNDLES.forEach(bundle => {\n     describe(bundle, () => {\n       it('should render todo', withBody('<todo-app></todo-app>', async () => {\n-           const {whenRendered} = require(path.join(PACKAGE, bundle));\n+           require(path.join(PACKAGE, bundle));\n+           const toDoAppComponent = getComponent(document.querySelector('todo-app')!);\n            expect(document.body.textContent).toContain('todos');\n            expect(document.body.textContent).toContain('Demonstrate Components');\n            expect(document.body.textContent).toContain('4 items left');\n            document.querySelector('button')!.click();\n-           await whenRendered((window as any).todoAppComponent);\n+           await whenRendered(toDoAppComponent);\n            expect(document.body.textContent).toContain('3 items left');\n          }));\n     });"
        },
        {
            "sha": "0025af70e594bb76d06345e1d89a6f19400e819f",
            "filename": "packages/core/test/bundling/todo_i18n/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 9,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_i18n%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_i18n%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_i18n%2Findex.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -8,7 +8,7 @@\n import '@angular/core/test/bundling/util/src/reflect_metadata';\n import './translations';\n import {CommonModule} from '@angular/common';\n-import {Component, Injectable, NgModule, ViewEncapsulation, ɵmarkDirty as markDirty, ɵrenderComponent as renderComponent, ɵwhenRendered as whenRendered} from '@angular/core';\n+import {Component, Injectable, NgModule, ViewEncapsulation, ɵmarkDirty as markDirty, ɵrenderComponent as renderComponent} from '@angular/core';\n \n class Todo {\n   editing: boolean;\n@@ -127,9 +127,7 @@ class TodoStore {\n class ToDoAppComponent {\n   newTodoText = '';\n \n-  constructor(public todoStore: TodoStore) {\n-    (window as any).todoAppComponent = this;\n-  }\n+  constructor(public todoStore: TodoStore) {}\n \n   cancelEditingTodo(todo: Todo) {\n     todo.editing = false;\n@@ -196,8 +194,3 @@ class ToDoAppModule {\n }\n \n renderComponent(ToDoAppComponent);\n-\n-// This bundle includes `@angular/core` within it which means that the test asserting\n-// against it will load a different core bundle. These symbols are exposed so that they\n-// can interact with the correct `@angular/core` instance.\n-module.exports = {whenRendered};"
        },
        {
            "sha": "9e55a6df77a9239c369660a6270ecfb57bf6e0b1",
            "filename": "packages/core/test/bundling/todo_i18n/todo_e2e_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_i18n%2Ftodo_e2e_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_i18n%2Ftodo_e2e_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_i18n%2Ftodo_e2e_spec.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -8,6 +8,8 @@\n import '@angular/localize/init';\n import '@angular/compiler';\n \n+import {ɵwhenRendered as whenRendered} from '@angular/core';\n+import {getComponent} from '@angular/core/src/render3';\n import {clearTranslations} from '@angular/localize';\n import {withBody} from '@angular/private/testing';\n import * as path from 'path';\n@@ -20,15 +22,16 @@ describe('functional test for todo i18n', () => {\n     describe(bundle, () => {\n       it('should render todo i18n', withBody('<todo-app></todo-app>', async () => {\n            clearTranslations();\n-           const {whenRendered} = require(path.join(PACKAGE, bundle));\n+           require(path.join(PACKAGE, bundle));\n+           const toDoAppComponent = getComponent(document.querySelector('todo-app')!);\n            expect(document.body.textContent).toContain('liste de tâches');\n            expect(document.body.textContent).toContain('Démontrer les components');\n            expect(document.body.textContent).toContain('Démontrer NgModules');\n            expect(document.body.textContent).toContain('4 tâches restantes');\n            expect(document.querySelector('.new-todo')!.getAttribute('placeholder'))\n                .toEqual(`Qu'y a-t-il à faire ?`);\n            document.querySelector('button')!.click();\n-           await whenRendered((window as any).todoAppComponent);\n+           await whenRendered(toDoAppComponent);\n            expect(document.body.textContent).toContain('3 tâches restantes');\n          }));\n     });"
        },
        {
            "sha": "bd8b360f868f82b74e13296315b41e722943e762",
            "filename": "packages/core/test/bundling/todo_r2/index.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 13,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_r2%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_r2%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_r2%2Findex.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -9,7 +9,7 @@\n import '@angular/core/test/bundling/util/src/reflect_metadata';\n \n import {CommonModule} from '@angular/common';\n-import {Component, Injectable, NgModule, ɵNgModuleFactory as NgModuleFactory, ɵwhenRendered as whenRendered} from '@angular/core';\n+import {Component, Injectable, NgModule, ɵNgModuleFactory as NgModuleFactory} from '@angular/core';\n import {BrowserModule, platformBrowser} from '@angular/platform-browser';\n \n class Todo {\n@@ -195,15 +195,5 @@ class ToDoAppModule {\n   }\n }\n \n-function bootstrapApp() {\n-  return platformBrowser().bootstrapModuleFactory(\n-      new NgModuleFactory(ToDoAppModule), {ngZone: 'noop'});\n-}\n-\n-// This bundle includes `@angular/core` within it which means that the test asserting\n-// against it will load a different core bundle. These symbols are exposed so that they\n-// can interact with the correct `@angular/core` instance.\n-module.exports = {\n-  whenRendered,\n-  bootstrapApp\n-};\n+(window as any).waitForApp =\n+    platformBrowser().bootstrapModuleFactory(new NgModuleFactory(ToDoAppModule), {ngZone: 'noop'});"
        },
        {
            "sha": "7fb449cd96699bac25cafc8bafe78f72ba6f63b7",
            "filename": "packages/core/test/bundling/todo_r2/todo_e2e_spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_r2%2Ftodo_e2e_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_r2%2Ftodo_e2e_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_r2%2Ftodo_e2e_spec.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -7,9 +7,13 @@\n  */\n \n import '@angular/compiler';\n+import {ɵwhenRendered as whenRendered} from '@angular/core';\n import {withBody} from '@angular/private/testing';\n import * as path from 'path';\n \n+const UTF8 = {\n+  encoding: 'utf-8'\n+};\n const PACKAGE = 'angular/packages/core/test/bundling/todo_r2';\n const BUNDLES = ['bundle.js', 'bundle.min_debug.js', 'bundle.min.js'];\n \n@@ -18,8 +22,8 @@ describe('functional test for todo', () => {\n     describe(bundle, () => {\n       it('should place styles on the elements within the component',\n          withBody('<todo-app></todo-app>', async () => {\n-           const {bootstrapApp, whenRendered} = require(path.join(PACKAGE, bundle));\n-           await bootstrapApp();\n+           require(path.join(PACKAGE, bundle));\n+           await (window as any).waitForApp;\n            const toDoAppComponent = (window as any).toDoAppComponent;\n            await whenRendered(toDoAppComponent);\n "
        },
        {
            "sha": "7608ac69aa729ef8018e26e5bfbc733a778f4669",
            "filename": "packages/core/test/render3/i18n/i18n_parse_spec.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 20,
            "changes": 40,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_parse_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_parse_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_parse_spec.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -40,16 +40,16 @@ describe('i18n_parse', () => {\n       //     TData                  | LView\n       // ---------------------------+-------------------------------\n       //                     ----- DECL -----\n-      // 21: TI18n                  |\n+      // 20: TI18n                  |\n       //                     ----- VARS -----\n-      // 22: Binding for ICU        |\n+      // 21: Binding for ICU        |\n       //                   ----- EXPANDO -----\n-      // 23: null                   | #text(before|)\n-      // 24: TIcu                   | <!-- ICU 20:0 -->\n-      // 25: null                   | currently selected ICU case\n-      // 26: null                   | #text(caseA)\n-      // 27: null                   | #text(otherCase)\n-      // 28: null                   | #text(|after)\n+      // 22: null                   | #text(before|)\n+      // 23: TIcu                   | <!-- ICU 20:0 -->\n+      // 24: null                   | currently selected ICU case\n+      // 25: null                   | #text(caseA)\n+      // 26: null                   | #text(otherCase)\n+      // 27: null                   | #text(|after)\n       const tI18n = toT18n(`before|{\n           �0�, select,\n             A {caseA}\n@@ -153,21 +153,21 @@ describe('i18n_parse', () => {\n       //     TData                  | LView\n       // ---------------------------+-------------------------------\n       //                     ----- DECL -----\n-      // 21: TI18n                  |\n+      // 20: TI18n                  |\n       //                     ----- VARS -----\n-      // 22: Binding for parent ICU |\n+      // 21: Binding for parent ICU |\n+      // 22: Binding for child ICU  |\n       // 23: Binding for child ICU  |\n-      // 24: Binding for child ICU  |\n       //                   ----- EXPANDO -----\n-      // 25: TIcu (parent)          | <!-- ICU 20:0 -->\n-      // 26: null                   | currently selected ICU case\n-      // 27: null                   | #text( parentA )\n-      // 28: TIcu (child)           | <!-- nested ICU 0 -->\n-      // 29:     null               |     currently selected ICU case\n-      // 30:     null               |     #text(nested0)\n-      // 31:     null               |     #text({{�2�}})\n-      // 32: null                   | #text( )\n-      // 33: null                   | #text( parentOther )\n+      // 24: TIcu (parent)          | <!-- ICU 20:0 -->\n+      // 25: null                   | currently selected ICU case\n+      // 26: null                   | #text( parentA )\n+      // 27: TIcu (child)           | <!-- nested ICU 0 -->\n+      // 28:     null               |     currently selected ICU case\n+      // 29:     null               |     #text(nested0)\n+      // 30:     null               |     #text({{�2�}})\n+      // 31: null                   | #text( )\n+      // 32: null                   | #text( parentOther )\n       const tI18n = toT18n(`{\n           �0�, select,\n             A {parentA {�1�, select, 0 {nested0} other {�2�}}!}"
        },
        {
            "sha": "fdd830d44b84266e2eff0f30f24aab87118232a2",
            "filename": "packages/core/test/render3/integration_spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Frender3%2Fintegration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2dd96e08aec73677cc20b556b443c44bf74e3bf6/packages%2Fcore%2Ftest%2Frender3%2Fintegration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fintegration_spec.ts?ref=2dd96e08aec73677cc20b556b443c44bf74e3bf6",
            "patch": "@@ -13,7 +13,7 @@ import {AttributeMarker, ɵɵadvance, ɵɵattribute, ɵɵdefineComponent, ɵɵde\n import {ɵɵelement, ɵɵelementEnd, ɵɵelementStart, ɵɵprojection, ɵɵprojectionDef, ɵɵtemplate, ɵɵtext} from '../../src/render3/instructions/all';\n import {RenderFlags} from '../../src/render3/interfaces/definition';\n import {domRendererFactory3, Renderer3, RendererFactory3} from '../../src/render3/interfaces/renderer';\n-import {CONTEXT, HEADER_OFFSET, ID, LView} from '../../src/render3/interfaces/view';\n+import {CONTEXT, HEADER_OFFSET} from '../../src/render3/interfaces/view';\n import {ɵɵsanitizeUrl} from '../../src/sanitization/sanitization';\n import {Sanitizer} from '../../src/sanitization/sanitizer';\n import {SecurityContext} from '../../src/sanitization/security';\n@@ -399,17 +399,19 @@ describe('element discovery', () => {\n \n     const section = fixture.hostElement.querySelector('section')!;\n     const sectionContext = getLContext(section)!;\n+    const sectionLView = sectionContext.lView!;\n     expect(sectionContext.nodeIndex).toEqual(HEADER_OFFSET);\n-    expect(sectionContext.lView!.length).toBeGreaterThan(HEADER_OFFSET);\n+    expect(sectionLView.length).toBeGreaterThan(HEADER_OFFSET);\n     expect(sectionContext.native).toBe(section);\n \n     const div = fixture.hostElement.querySelector('div')!;\n     const divContext = getLContext(div)!;\n+    const divLView = divContext.lView!;\n     expect(divContext.nodeIndex).toEqual(HEADER_OFFSET + 1);\n-    expect(divContext.lView!.length).toBeGreaterThan(HEADER_OFFSET);\n+    expect(divLView.length).toBeGreaterThan(HEADER_OFFSET);\n     expect(divContext.native).toBe(div);\n \n-    expect(divContext.lView).toBe(sectionContext.lView);\n+    expect(divLView).toBe(sectionLView);\n   });\n \n   it('should cache the element context on a element was pre-emptively monkey-patched', () => {\n@@ -736,7 +738,7 @@ describe('element discovery', () => {\n        const div1 = hostElm.querySelector('div:first-child')! as any;\n        const div2 = hostElm.querySelector('div:last-child')! as any;\n        const context = getLContext(hostElm)!;\n-       const componentView = context.lView![context.nodeIndex];\n+       const componentView = context.lView[context.nodeIndex];\n \n        expect(componentView).toContain(myDir1Instance);\n        expect(componentView).toContain(myDir2Instance);\n@@ -915,7 +917,7 @@ describe('element discovery', () => {\n        const context = getLContext(child)!;\n        expect(readPatchedData(child)).toBeTruthy();\n \n-       const componentData = context.lView![context.nodeIndex];\n+       const componentData = context.lView[context.nodeIndex];\n        const component = componentData[CONTEXT];\n        expect(component instanceof ChildComp).toBeTruthy();\n        expect(readPatchedData(component)).toBe(context.lView);"
        }
    ],
    "stats": {
        "total": 596,
        "additions": 171,
        "deletions": 425
    }
}