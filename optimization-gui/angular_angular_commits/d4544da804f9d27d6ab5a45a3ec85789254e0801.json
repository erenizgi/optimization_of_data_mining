{
    "author": "peruukki",
    "message": "refactor(core): split inert strategies to separate classes (#36578) (#36578)\n\nThe `inertDocument` member is only needed when using the InertDocument\nstrategy. By separating the DOMParser and InertDocument strategies into\nseparate classes, we can easily avoid creating the inert document\nunnecessarily when using DOMParser.\n\nPR Close #36578",
    "sha": "d4544da804f9d27d6ab5a45a3ec85789254e0801",
    "files": [
        {
            "sha": "1377482c80d9e64b1d9ea6617f69a6b061c74349",
            "filename": "packages/core/src/render3/i18n.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d4544da804f9d27d6ab5a45a3ec85789254e0801/packages%2Fcore%2Fsrc%2Frender3%2Fi18n.ts",
            "raw_url": "https://github.com/angular/angular/raw/d4544da804f9d27d6ab5a45a3ec85789254e0801/packages%2Fcore%2Fsrc%2Frender3%2Fi18n.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fi18n.ts?ref=d4544da804f9d27d6ab5a45a3ec85789254e0801",
            "patch": "@@ -9,7 +9,7 @@ import '../util/ng_i18n_closure_mode';\n \n import {DEFAULT_LOCALE_ID, getPluralCase} from '../i18n/localization';\n import {getTemplateContent, SRCSET_ATTRS, URI_ATTRS, VALID_ATTRS, VALID_ELEMENTS} from '../sanitization/html_sanitizer';\n-import {InertBodyHelper} from '../sanitization/inert_body';\n+import {getInertBodyHelper} from '../sanitization/inert_body';\n import {_sanitizeUrl, sanitizeSrcset} from '../sanitization/url_sanitizer';\n import {addAllToArray} from '../util/array_utils';\n import {assertDataInRange, assertDefined, assertEqual} from '../util/assert';\n@@ -1233,7 +1233,7 @@ function icuStart(\n function parseIcuCase(\n     unsafeHtml: string, parentIndex: number, nestedIcus: IcuExpression[], tIcus: TIcu[],\n     expandoStartIndex: number): IcuCase {\n-  const inertBodyHelper = new InertBodyHelper(getDocument());\n+  const inertBodyHelper = getInertBodyHelper(getDocument());\n   const inertBodyElement = inertBodyHelper.getInertBodyElement(unsafeHtml);\n   if (!inertBodyElement) {\n     throw new Error('Unable to generate inert body element');"
        },
        {
            "sha": "ab7bbbe8369d7c5cf6269cecfe362d77233a21b3",
            "filename": "packages/core/src/sanitization/html_sanitizer.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d4544da804f9d27d6ab5a45a3ec85789254e0801/packages%2Fcore%2Fsrc%2Fsanitization%2Fhtml_sanitizer.ts",
            "raw_url": "https://github.com/angular/angular/raw/d4544da804f9d27d6ab5a45a3ec85789254e0801/packages%2Fcore%2Fsrc%2Fsanitization%2Fhtml_sanitizer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fsanitization%2Fhtml_sanitizer.ts?ref=d4544da804f9d27d6ab5a45a3ec85789254e0801",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import {isDevMode} from '../util/is_dev_mode';\n-import {InertBodyHelper} from './inert_body';\n+import {getInertBodyHelper, InertBodyHelper} from './inert_body';\n import {_sanitizeUrl, sanitizeSrcset} from './url_sanitizer';\n \n function tagSet(tags: string): {[k: string]: boolean} {\n@@ -245,7 +245,7 @@ let inertBodyHelper: InertBodyHelper;\n export function _sanitizeHtml(defaultDoc: any, unsafeHtmlInput: string): string {\n   let inertBodyElement: HTMLElement|null = null;\n   try {\n-    inertBodyHelper = inertBodyHelper || new InertBodyHelper(defaultDoc);\n+    inertBodyHelper = inertBodyHelper || getInertBodyHelper(defaultDoc);\n     // Make sure unsafeHtml is actually a string (TypeScript types are not enforced at runtime).\n     let unsafeHtml = unsafeHtmlInput ? String(unsafeHtmlInput) : '';\n     inertBodyElement = inertBodyHelper.getInertBodyElement(unsafeHtml);"
        },
        {
            "sha": "9e3530be71f0c07e790c2fc21e11631dc5ad310d",
            "filename": "packages/core/src/sanitization/inert_body.ts",
            "status": "modified",
            "additions": 36,
            "deletions": 30,
            "changes": 66,
            "blob_url": "https://github.com/angular/angular/blob/d4544da804f9d27d6ab5a45a3ec85789254e0801/packages%2Fcore%2Fsrc%2Fsanitization%2Finert_body.ts",
            "raw_url": "https://github.com/angular/angular/raw/d4544da804f9d27d6ab5a45a3ec85789254e0801/packages%2Fcore%2Fsrc%2Fsanitization%2Finert_body.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fsanitization%2Finert_body.ts?ref=d4544da804f9d27d6ab5a45a3ec85789254e0801",
            "patch": "@@ -7,40 +7,29 @@\n  */\n \n /**\n- * This helper class is used to get hold of an inert tree of DOM elements containing dirty HTML\n+ * This helper is used to get hold of an inert tree of DOM elements containing dirty HTML\n  * that needs sanitizing.\n  * Depending upon browser support we use one of two strategies for doing this.\n- * Default: DomParser strategy\n+ * Default: DOMParser strategy\n  * Fallback: InertDocument strategy\n  */\n-export class InertBodyHelper {\n-  private inertDocument: Document;\n-\n-  constructor(private defaultDoc: Document) {\n-    this.inertDocument = this.defaultDoc.implementation.createHTMLDocument('sanitization-inert');\n-    if (this.inertDocument.body == null) {\n-      // usually there should be only one body element in the document, but IE doesn't have any, so\n-      // we need to create one.\n-      const inertHtml = this.inertDocument.createElement('html');\n-      this.inertDocument.appendChild(inertHtml);\n-      const inertBodyElement = this.inertDocument.createElement('body');\n-      inertHtml.appendChild(inertBodyElement);\n-    }\n-\n-    this.getInertBodyElement = isDOMParserAvailable() ? this.getInertBodyElement_DOMParser :\n-                                                        this.getInertBodyElement_InertDocument;\n-  }\n+export function getInertBodyHelper(defaultDoc: Document): InertBodyHelper {\n+  return isDOMParserAvailable() ? new DOMParserHelper() : new InertDocumentHelper(defaultDoc);\n+}\n \n+export interface InertBodyHelper {\n   /**\n    * Get an inert DOM element containing DOM created from the dirty HTML string provided.\n-   * The implementation of this is determined in the constructor, when the class is instantiated.\n    */\n   getInertBodyElement: (html: string) => HTMLElement | null;\n+}\n \n-  /**\n-   * Use DOMParser to create and fill an inert body element in browsers that support it.\n-   */\n-  private getInertBodyElement_DOMParser(html: string) {\n+/**\n+ * Uses DOMParser to create and fill an inert body element.\n+ * This is the default strategy used in browsers that support it.\n+ */\n+class DOMParserHelper implements InertBodyHelper {\n+  getInertBodyElement(html: string): HTMLElement|null {\n     // We add these extra elements to ensure that the rest of the content is parsed as expected\n     // e.g. leading whitespace is maintained and tags like `<meta>` do not get hoisted to the\n     // `<head>` tag.\n@@ -54,13 +43,30 @@ export class InertBodyHelper {\n       return null;\n     }\n   }\n+}\n \n-  /**\n-   * Use an HTML5 `template` element, if supported, or an inert body element created via\n-   * `createHtmlDocument` to create and fill an inert DOM element.\n-   * This is the fallback strategy if the browser does not support DOMParser.\n-   */\n-  private getInertBodyElement_InertDocument(html: string) {\n+/**\n+ * Use an HTML5 `template` element, if supported, or an inert body element created via\n+ * `createHtmlDocument` to create and fill an inert DOM element.\n+ * This is the fallback strategy if the browser does not support DOMParser.\n+ */\n+class InertDocumentHelper implements InertBodyHelper {\n+  private inertDocument: Document;\n+\n+  constructor(private defaultDoc: Document) {\n+    this.inertDocument = this.defaultDoc.implementation.createHTMLDocument('sanitization-inert');\n+\n+    if (this.inertDocument.body == null) {\n+      // usually there should be only one body element in the document, but IE doesn't have any, so\n+      // we need to create one.\n+      const inertHtml = this.inertDocument.createElement('html');\n+      this.inertDocument.appendChild(inertHtml);\n+      const inertBodyElement = this.inertDocument.createElement('body');\n+      inertHtml.appendChild(inertBodyElement);\n+    }\n+  }\n+\n+  getInertBodyElement(html: string): HTMLElement|null {\n     // Prefer using <template> element if supported.\n     const templateEl = this.inertDocument.createElement('template');\n     if ('content' in templateEl) {"
        }
    ],
    "stats": {
        "total": 74,
        "additions": 40,
        "deletions": 34
    }
}