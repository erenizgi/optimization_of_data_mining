{
    "author": "kyliau",
    "message": "refactor(language-service): Move two-way binding logic to visitBoundEvent (#38985)\n\nInstead of doing all sorts of checks in the `visit()` method, move checks\nthat are specific to `BoundEvent` to the `visitBoundEvent()` method.\n\nPR Close #38985",
    "sha": "ded9aeb44710dd6cf5fec25c1ba727ec5a768ca1",
    "files": [
        {
            "sha": "2cc7933d92f8bbf34ad4efdaaef5d7fc141ad09a",
            "filename": "packages/language-service/ivy/hybrid_visitor.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 11,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/ded9aeb44710dd6cf5fec25c1ba727ec5a768ca1/packages%2Flanguage-service%2Fivy%2Fhybrid_visitor.ts",
            "raw_url": "https://github.com/angular/angular/raw/ded9aeb44710dd6cf5fec25c1ba727ec5a768ca1/packages%2Flanguage-service%2Fivy%2Fhybrid_visitor.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Fhybrid_visitor.ts?ref=ded9aeb44710dd6cf5fec25c1ba727ec5a768ca1",
            "patch": "@@ -58,15 +58,6 @@ class R3Visitor implements t.Visitor {\n           return;\n         }\n       }\n-      if (node instanceof t.BoundEvent &&\n-          this.path.find((n => n instanceof t.BoundAttribute && node.name === n.name + 'Change'))) {\n-        // For two-way binding aka banana-in-a-box, there are two matches:\n-        // BoundAttribute and BoundEvent. Both have the same spans. We choose to\n-        // return BoundAttribute because it matches the identifier name verbatim.\n-        // TODO: For operations like go to definition, ideally we want to return\n-        // both.\n-        return;\n-      }\n       this.path.push(node);\n       node.visit(this);\n     }\n@@ -111,9 +102,20 @@ class R3Visitor implements t.Visitor {\n     visitor.visit(attribute.value, this.path);\n   }\n \n-  visitBoundEvent(attribute: t.BoundEvent) {\n+  visitBoundEvent(event: t.BoundEvent) {\n+    const isTwoWayBinding =\n+        this.path.some(n => n instanceof t.BoundAttribute && event.name === n.name + 'Change');\n+    if (isTwoWayBinding) {\n+      // For two-way binding aka banana-in-a-box, there are two matches:\n+      // BoundAttribute and BoundEvent. Both have the same spans. We choose to\n+      // return BoundAttribute because it matches the identifier name verbatim.\n+      // TODO: For operations like go to definition, ideally we want to return\n+      // both.\n+      this.path.pop();  // remove bound event from the AST path\n+      return;\n+    }\n     const visitor = new ExpressionVisitor(this.position);\n-    visitor.visit(attribute.handler, this.path);\n+    visitor.visit(event.handler, this.path);\n   }\n \n   visitText(text: t.Text) {"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 13,
        "deletions": 11
    }
}