{
    "author": "devversion",
    "message": "test(compiler): use v12 view engine packages for compiler AOT test (#43431)\n\nIn preparation for the v13 Angular Package Format, where partial\ndeclarations are emitted only, the AOT compiler test is updated\nto rely on package artifacts from v12 instead. This allows us\nto switch to the new package format without breaking the tests\nwhich require metadata files to exist in the NPM packages.\n\nPR Close #43431",
    "sha": "297237f981d8fc226446a43c603bbab6f2e5d39e",
    "files": [
        {
            "sha": "812093266544ca399bf9911a29ba3760648bc3db",
            "filename": "package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/297237f981d8fc226446a43c603bbab6f2e5d39e/package.json",
            "raw_url": "https://github.com/angular/angular/raw/297237f981d8fc226446a43c603bbab6f2e5d39e/package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/package.json?ref=297237f981d8fc226446a43c603bbab6f2e5d39e",
            "patch": "@@ -45,6 +45,7 @@\n     \"@angular-devkit/build-optimizer\": \"0.1300.0-next.6\",\n     \"@angular-devkit/core\": \"13.0.0-next.6\",\n     \"@angular-devkit/schematics\": \"13.0.0-next.6\",\n+    \"@angular/animations-12\": \"npm:@angular/animations@12.2.2\",\n     \"@angular/cli\": \"13.0.0-next.6\",\n     \"@angular/common-12\": \"npm:@angular/common@12.2.2\",\n     \"@angular/core-12\": \"npm:@angular/core@12.2.2\","
        },
        {
            "sha": "615328782af1021aceef1299562a43a134055bed",
            "filename": "packages/compiler/test/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/297237f981d8fc226446a43c603bbab6f2e5d39e/packages%2Fcompiler%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/297237f981d8fc226446a43c603bbab6f2e5d39e/packages%2Fcompiler%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2FBUILD.bazel?ref=297237f981d8fc226446a43c603bbab6f2e5d39e",
            "patch": "@@ -80,9 +80,8 @@ jasmine_node_test(\n     name = \"test\",\n     bootstrap = [\"//tools/testing:node_es5\"],\n     data = [\n-        \"//packages/animations:npm_package\",\n-        \"//packages/common:npm_package\",\n-        \"//packages/core:npm_package\",\n+        \"@npm//@angular/animations-12\",\n+        \"@npm//@angular/core-12\",\n     ],\n     tags = [\n         # Disabled as these tests pertain to the old ngc compilation and are not relevant in Ivy."
        },
        {
            "sha": "ad1f90ff9eeba3b82c6b5c66ae8b6f6bd99df9ed",
            "filename": "packages/compiler/test/aot/test_util.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 23,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/297237f981d8fc226446a43c603bbab6f2e5d39e/packages%2Fcompiler%2Ftest%2Faot%2Ftest_util.ts",
            "raw_url": "https://github.com/angular/angular/raw/297237f981d8fc226446a43c603bbab6f2e5d39e/packages%2Fcompiler%2Ftest%2Faot%2Ftest_util.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Faot%2Ftest_util.ts?ref=297237f981d8fc226446a43c603bbab6f2e5d39e",
            "patch": "@@ -664,8 +664,6 @@ export function setup(options: {\n } = {\n   compileAngular: true,\n   compileAnimations: true,\n-  compileCommon: false,\n-  compileFakeCore: false,\n }) {\n   let angularFiles = new Map<string, string>();\n \n@@ -682,27 +680,15 @@ export function setup(options: {\n       if (options.compileAngular) {\n         // If this fails please add //packages/core:npm_package as a test data dependency.\n         readBazelWrittenFilesFrom(\n-            resolveNpmTreeArtifact('angular/packages/core/npm_package'), 'core', angularFiles,\n+            resolveNpmTreeArtifact('npm/node_modules/@angular/core-12'), 'core', angularFiles,\n             skipDirs);\n       }\n-      if (options.compileFakeCore) {\n-        readBazelWrittenFilesFrom(\n-            resolveNpmTreeArtifact(\n-                'angular/packages/compiler-cli/src/ngtsc/testing/fake_core/npm_package'),\n-            'core', angularFiles, skipDirs);\n-      }\n       if (options.compileAnimations) {\n         // If this fails please add //packages/animations:npm_package as a test data dependency.\n         readBazelWrittenFilesFrom(\n-            resolveNpmTreeArtifact('angular/packages/animations/npm_package'), 'animations',\n+            resolveNpmTreeArtifact('npm/node_modules/@angular/animations-12'), 'animations',\n             angularFiles, skipDirs);\n       }\n-      if (options.compileCommon) {\n-        // If this fails please add //packages/common:npm_package as a test data dependency.\n-        readBazelWrittenFilesFrom(\n-            resolveNpmTreeArtifact('angular/packages/common/npm_package'), 'common', angularFiles,\n-            skipDirs);\n-      }\n       return;\n     }\n \n@@ -713,13 +699,6 @@ export function setup(options: {\n       emittingProgram.emit();\n       emittingHost.writtenAngularFiles(angularFiles);\n     }\n-    if (options.compileCommon) {\n-      const emittingHost =\n-          new EmittingCompilerHost(['@angular/common/index.ts'], {emitMetadata: true});\n-      const emittingProgram = ts.createProgram(emittingHost.scripts, settings, emittingHost);\n-      emittingProgram.emit();\n-      emittingHost.writtenAngularFiles(angularFiles);\n-    }\n     if (options.compileAnimations) {\n       const emittingHost =\n           new EmittingCompilerHost(['@angular/animations/index.ts'], {emitMetadata: true});"
        },
        {
            "sha": "759b22691e5290644e0b7b32ddb9554a8aad1916",
            "filename": "yarn.lock",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/297237f981d8fc226446a43c603bbab6f2e5d39e/yarn.lock",
            "raw_url": "https://github.com/angular/angular/raw/297237f981d8fc226446a43c603bbab6f2e5d39e/yarn.lock",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/yarn.lock?ref=297237f981d8fc226446a43c603bbab6f2e5d39e",
            "patch": "@@ -172,6 +172,13 @@\n     ora \"5.4.1\"\n     rxjs \"6.6.7\"\n \n+\"@angular/animations-12@npm:@angular/animations@12.2.2\":\n+  version \"12.2.2\"\n+  resolved \"https://registry.yarnpkg.com/@angular/animations/-/animations-12.2.2.tgz#da221d892d8da9056e833da04dced0707720e5ba\"\n+  integrity sha512-arJzev1GYJYU5cR0x02WFm98ucuPaMuEjAoD+Yggl8Y0usefUm282ZZ+Jl4wCgbhus1JAjpFpoVQuZCVSn6F1g==\n+  dependencies:\n+    tslib \"^2.2.0\"\n+\n \"@angular/benchpress@0.2.1\":\n   version \"0.2.1\"\n   resolved \"https://registry.yarnpkg.com/@angular/benchpress/-/benchpress-0.2.1.tgz#f8b58d9acfda0d29959b87dcb8082b1c33735db5\""
        }
    ],
    "stats": {
        "total": 38,
        "additions": 12,
        "deletions": 26
    }
}