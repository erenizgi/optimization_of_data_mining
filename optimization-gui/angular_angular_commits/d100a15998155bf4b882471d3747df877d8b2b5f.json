{
    "author": "petebacondarwin",
    "message": "refactor(compiler-cli): update to use new file-system interfaces (#40281)\n\nNow that `ReadonlyFileSystem` and `PathManipulation` interfaces are\navailable, this commit updates the compiler-cli to use these more\nfocussed interfaces.\n\nPR Close #40281",
    "sha": "d100a15998155bf4b882471d3747df877d8b2b5f",
    "files": [
        {
            "sha": "b3e25c7b40d8937d206878edbdabaae6940c014b",
            "filename": "packages/compiler-cli/linker/babel/src/linker_plugin_options.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Fsrc%2Flinker_plugin_options.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Fsrc%2Flinker_plugin_options.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Fsrc%2Flinker_plugin_options.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -6,14 +6,14 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import {LinkerOptions} from '../..';\n-import {FileSystem} from '../../../src/ngtsc/file_system';\n+import {ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n \n export interface LinkerPluginOptions extends Partial<LinkerOptions> {\n   /**\n    * File-system, used to load up the input source-map and content.\n    */\n-  fileSystem: FileSystem;\n+  fileSystem: ReadonlyFileSystem;\n \n   /**\n    * Logger used by the linker."
        },
        {
            "sha": "d6dfd0f1610e9c5e7ca66b8348bed1058d2ccdeb",
            "filename": "packages/compiler-cli/linker/src/file_linker/linker_environment.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Flinker_environment.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Flinker_environment.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Flinker_environment.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {FileSystem} from '../../../src/ngtsc/file_system';\n+import {ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n import {SourceFileLoader} from '../../../src/ngtsc/sourcemaps';\n import {AstFactory} from '../../../src/ngtsc/translator';\n@@ -20,11 +20,12 @@ export class LinkerEnvironment<TStatement, TExpression> {\n       this.options.sourceMapping ? new SourceFileLoader(this.fileSystem, this.logger, {}) : null;\n \n   private constructor(\n-      readonly fileSystem: FileSystem, readonly logger: Logger, readonly host: AstHost<TExpression>,\n-      readonly factory: AstFactory<TStatement, TExpression>, readonly options: LinkerOptions) {}\n+      readonly fileSystem: ReadonlyFileSystem, readonly logger: Logger,\n+      readonly host: AstHost<TExpression>, readonly factory: AstFactory<TStatement, TExpression>,\n+      readonly options: LinkerOptions) {}\n \n   static create<TStatement, TExpression>(\n-      fileSystem: FileSystem, logger: Logger, host: AstHost<TExpression>,\n+      fileSystem: ReadonlyFileSystem, logger: Logger, host: AstHost<TExpression>,\n       factory: AstFactory<TStatement, TExpression>,\n       options: Partial<LinkerOptions>): LinkerEnvironment<TStatement, TExpression> {\n     return new LinkerEnvironment(fileSystem, logger, host, factory, {"
        },
        {
            "sha": "141b81602691a1eeb987e8b241b8f6ec2f1eb2e4",
            "filename": "packages/compiler-cli/ngcc/src/analysis/decoration_analyzer.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fdecoration_analyzer.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fdecoration_analyzer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fdecoration_analyzer.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -12,7 +12,7 @@ import {ParsedConfiguration} from '../../..';\n import {ComponentDecoratorHandler, DirectiveDecoratorHandler, InjectableDecoratorHandler, NgModuleDecoratorHandler, PipeDecoratorHandler, ReferencesRegistry, ResourceLoader} from '../../../src/ngtsc/annotations';\n import {CycleAnalyzer, ImportGraph} from '../../../src/ngtsc/cycles';\n import {isFatalDiagnosticError} from '../../../src/ngtsc/diagnostics';\n-import {absoluteFrom, absoluteFromSourceFile, dirname, FileSystem, LogicalFileSystem, resolve} from '../../../src/ngtsc/file_system';\n+import {absoluteFromSourceFile, LogicalFileSystem, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {AbsoluteModuleStrategy, LocalIdentifierStrategy, LogicalProjectStrategy, ModuleResolver, NOOP_DEFAULT_IMPORT_RECORDER, PrivateExportAliasingHost, Reexport, ReferenceEmitter} from '../../../src/ngtsc/imports';\n import {CompoundMetadataReader, CompoundMetadataRegistry, DtsMetadataReader, InjectableClassRegistry, LocalMetadataRegistry, ResourceRegistry} from '../../../src/ngtsc/metadata';\n import {PartialEvaluator} from '../../../src/ngtsc/partial_evaluator';\n@@ -36,16 +36,16 @@ import {isWithinPackage, NOOP_DEPENDENCY_TRACKER} from './util';\n  * Simple class that resolves and loads files directly from the filesystem.\n  */\n class NgccResourceLoader implements ResourceLoader {\n-  constructor(private fs: FileSystem) {}\n+  constructor(private fs: ReadonlyFileSystem) {}\n   canPreload = false;\n   preload(): undefined|Promise<void> {\n     throw new Error('Not implemented.');\n   }\n   load(url: string): string {\n-    return this.fs.readFile(resolve(url));\n+    return this.fs.readFile(this.fs.resolve(url));\n   }\n   resolve(url: string, containingFile: string): string {\n-    return resolve(dirname(absoluteFrom(containingFile)), url);\n+    return this.fs.resolve(this.fs.dirname(containingFile), url);\n   }\n }\n \n@@ -139,7 +139,7 @@ export class DecorationAnalyzer {\n   ];\n \n   constructor(\n-      private fs: FileSystem, private bundle: EntryPointBundle,\n+      private fs: ReadonlyFileSystem, private bundle: EntryPointBundle,\n       private reflectionHost: NgccReflectionHost, private referencesRegistry: ReferencesRegistry,\n       private diagnosticHandler: (error: ts.Diagnostic) => void = () => {},\n       private tsConfig: ParsedConfiguration|null = null) {}"
        },
        {
            "sha": "cff5f305b5827f94e44b1064cf2048e853d01997",
            "filename": "packages/compiler-cli/ngcc/src/command_line_options.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fcommand_line_options.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fcommand_line_options.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fcommand_line_options.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -8,7 +8,7 @@\n  */\n import * as yargs from 'yargs';\n \n-import {resolve, setFileSystem, NodeJSFileSystem} from '../../src/ngtsc/file_system';\n+import {setFileSystem, NodeJSFileSystem} from '../../src/ngtsc/file_system';\n import {ConsoleLogger, LogLevel} from '../../src/ngtsc/logging';\n import {NgccOptions} from './ngcc_options';\n \n@@ -115,9 +115,10 @@ export function parseCommandLineOptions(args: string[]): NgccOptions {\n     process.exit(1);\n   }\n \n-  setFileSystem(new NodeJSFileSystem());\n+  const fs = new NodeJSFileSystem();\n+  setFileSystem(fs);\n \n-  const baseSourcePath = resolve(options.s || './node_modules');\n+  const baseSourcePath = fs.resolve(options.s || './node_modules');\n   const propertiesToConsider = options.p;\n   const targetEntryPointPath = options.t;\n   const compileAllFormats = !options['first-only'];"
        },
        {
            "sha": "8fdbb64169ea45292bb4a8826c0f90d4a61167fd",
            "filename": "packages/compiler-cli/ngcc/src/dependencies/dependency_host.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fdependency_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fdependency_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fdependency_host.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem, PathSegment} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, PathSegment, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {EntryPoint} from '../packages/entry_point';\n import {resolveFileWithPostfixes} from '../utils';\n \n@@ -32,7 +32,7 @@ export function createDependencyInfo(): DependencyInfo {\n }\n \n export abstract class DependencyHostBase implements DependencyHost {\n-  constructor(protected fs: FileSystem, protected moduleResolver: ModuleResolver) {}\n+  constructor(protected fs: ReadonlyFileSystem, protected moduleResolver: ModuleResolver) {}\n \n   /**\n    * Find all the dependencies for the entry-point at the given path."
        },
        {
            "sha": "7d6d7f3219acc63430207d1eb3ad3b220c7e5ba1",
            "filename": "packages/compiler-cli/ngcc/src/dependencies/dependency_resolver.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fdependency_resolver.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fdependency_resolver.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fdependency_resolver.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -8,7 +8,7 @@\n \n import {DepGraph} from 'dependency-graph';\n \n-import {AbsoluteFsPath, FileSystem, resolve} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n import {NgccConfiguration} from '../packages/configuration';\n import {EntryPoint, EntryPointFormat, getEntryPointFormat, SUPPORTED_FORMAT_PROPERTIES} from '../packages/entry_point';\n@@ -84,7 +84,7 @@ export interface SortedEntryPointsInfo extends DependencyDiagnostics {\n  */\n export class DependencyResolver {\n   constructor(\n-      private fs: FileSystem, private logger: Logger, private config: NgccConfiguration,\n+      private fs: ReadonlyFileSystem, private logger: Logger, private config: NgccConfiguration,\n       private hosts: Partial<Record<EntryPointFormat, DependencyHost>>,\n       private typingsHost: DependencyHost) {}\n   /**\n@@ -212,7 +212,7 @@ export class DependencyResolver {\n       const format = getEntryPointFormat(this.fs, entryPoint, property);\n       if (format === undefined) continue;\n \n-      return {format, path: resolve(entryPoint.path, formatPath)};\n+      return {format, path: this.fs.resolve(entryPoint.path, formatPath)};\n     }\n \n     throw new Error("
        },
        {
            "sha": "9d66446ac6238c2f42d970068338d76e55d876fe",
            "filename": "packages/compiler-cli/ngcc/src/dependencies/dts_dependency_host.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fdts_dependency_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fdts_dependency_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fdts_dependency_host.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {PathMappings} from '../path_mappings';\n import {EsmDependencyHost} from './esm_dependency_host';\n import {ModuleResolver} from './module_resolver';\n@@ -14,7 +14,7 @@ import {ModuleResolver} from './module_resolver';\n  * Helper functions for computing dependencies via typings files.\n  */\n export class DtsDependencyHost extends EsmDependencyHost {\n-  constructor(fs: FileSystem, pathMappings?: PathMappings) {\n+  constructor(fs: ReadonlyFileSystem, pathMappings?: PathMappings) {\n     super(\n         fs, new ModuleResolver(fs, pathMappings, ['', '.d.ts', '/index.d.ts', '.js', '/index.js']),\n         false);"
        },
        {
            "sha": "77b82427335381c5eea5d9731148456b6d6a5972",
            "filename": "packages/compiler-cli/ngcc/src/dependencies/esm_dependency_host.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fesm_dependency_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fesm_dependency_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fesm_dependency_host.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import * as ts from 'typescript';\n-import {AbsoluteFsPath, FileSystem} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {DependencyHostBase} from './dependency_host';\n import {ModuleResolver} from './module_resolver';\n \n@@ -15,7 +15,8 @@ import {ModuleResolver} from './module_resolver';\n  */\n export class EsmDependencyHost extends DependencyHostBase {\n   constructor(\n-      fs: FileSystem, moduleResolver: ModuleResolver, private scanImportExpressions = true) {\n+      fs: ReadonlyFileSystem, moduleResolver: ModuleResolver,\n+      private scanImportExpressions = true) {\n     super(fs, moduleResolver);\n   }\n   // By skipping trivia here we don't have to account for it in the processing below"
        },
        {
            "sha": "35c854a9821c3b052542ef09e0caeb05ca53499a",
            "filename": "packages/compiler-cli/ngcc/src/dependencies/module_resolver.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 15,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fmodule_resolver.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fmodule_resolver.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fdependencies%2Fmodule_resolver.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFrom, AbsoluteFsPath, dirname, FileSystem, isRoot, join, resolve} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {PathMappings} from '../path_mappings';\n import {isRelativePath, resolveFileWithPostfixes} from '../utils';\n \n@@ -25,9 +25,9 @@ import {isRelativePath, resolveFileWithPostfixes} from '../utils';\n export class ModuleResolver {\n   private pathMappings: ProcessedPathMapping[];\n \n-  constructor(private fs: FileSystem, pathMappings?: PathMappings, readonly relativeExtensions = [\n-    '', '.js', '/index.js'\n-  ]) {\n+  constructor(\n+      private fs: ReadonlyFileSystem, pathMappings?: PathMappings,\n+      readonly relativeExtensions = ['', '.js', '/index.js']) {\n     this.pathMappings = pathMappings ? this.processPathMappings(pathMappings) : [];\n   }\n \n@@ -54,7 +54,7 @@ export class ModuleResolver {\n    * Convert the `pathMappings` into a collection of `PathMapper` functions.\n    */\n   private processPathMappings(pathMappings: PathMappings): ProcessedPathMapping[] {\n-    const baseUrl = absoluteFrom(pathMappings.baseUrl);\n+    const baseUrl = this.fs.resolve(pathMappings.baseUrl);\n     return Object.keys(pathMappings.paths).map(pathPattern => {\n       const matcher = splitOnStar(pathPattern);\n       const templates = pathMappings.paths[pathPattern].map(splitOnStar);\n@@ -71,7 +71,7 @@ export class ModuleResolver {\n    */\n   private resolveAsRelativePath(moduleName: string, fromPath: AbsoluteFsPath): ResolvedModule|null {\n     const resolvedPath = resolveFileWithPostfixes(\n-        this.fs, resolve(dirname(fromPath), moduleName), this.relativeExtensions);\n+        this.fs, this.fs.resolve(this.fs.dirname(fromPath), moduleName), this.relativeExtensions);\n     return resolvedPath && new ResolvedRelativeModule(resolvedPath);\n   }\n \n@@ -115,13 +115,13 @@ export class ModuleResolver {\n    */\n   private resolveAsEntryPoint(moduleName: string, fromPath: AbsoluteFsPath): ResolvedModule|null {\n     let folder = fromPath;\n-    while (!isRoot(folder)) {\n-      folder = dirname(folder);\n+    while (!this.fs.isRoot(folder)) {\n+      folder = this.fs.dirname(folder);\n       if (folder.endsWith('node_modules')) {\n         // Skip up if the folder already ends in node_modules\n-        folder = dirname(folder);\n+        folder = this.fs.dirname(folder);\n       }\n-      const modulePath = resolve(folder, 'node_modules', moduleName);\n+      const modulePath = this.fs.resolve(folder, 'node_modules', moduleName);\n       if (this.isEntryPoint(modulePath)) {\n         return new ResolvedExternalModule(modulePath);\n       } else if (this.resolveAsRelativePath(modulePath, fromPath)) {\n@@ -138,7 +138,7 @@ export class ModuleResolver {\n    * This is achieved by checking for the existence of `${modulePath}/package.json`.\n    */\n   private isEntryPoint(modulePath: AbsoluteFsPath): boolean {\n-    return this.fs.exists(join(modulePath, 'package.json'));\n+    return this.fs.exists(this.fs.join(modulePath, 'package.json'));\n   }\n \n   /**\n@@ -203,7 +203,7 @@ export class ModuleResolver {\n    */\n   private computeMappedTemplates(mapping: ProcessedPathMapping, match: string) {\n     return mapping.templates.map(\n-        template => resolve(mapping.baseUrl, template.prefix + match + template.postfix));\n+        template => this.fs.resolve(mapping.baseUrl, template.prefix + match + template.postfix));\n   }\n \n   /**\n@@ -212,9 +212,9 @@ export class ModuleResolver {\n    */\n   private findPackagePath(path: AbsoluteFsPath): AbsoluteFsPath|null {\n     let folder = path;\n-    while (!isRoot(folder)) {\n-      folder = dirname(folder);\n-      if (this.fs.exists(join(folder, 'package.json'))) {\n+    while (!this.fs.isRoot(folder)) {\n+      folder = this.fs.dirname(folder);\n+      if (this.fs.exists(this.fs.join(folder, 'package.json'))) {\n         return folder;\n       }\n     }"
        },
        {
            "sha": "1d29a95c22e52ae856b26c95a39bc345ed2757ba",
            "filename": "packages/compiler-cli/ngcc/src/entry_point_finder/entry_point_collector.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Fentry_point_collector.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Fentry_point_collector.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Fentry_point_collector.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,9 +5,8 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem, PathSegment} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, PathSegment, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n-\n import {EntryPointWithDependencies} from '../dependencies/dependency_host';\n import {DependencyResolver} from '../dependencies/dependency_resolver';\n import {NgccConfiguration} from '../packages/configuration';\n@@ -20,7 +19,7 @@ import {NGCC_DIRECTORY} from '../writing/new_entry_point_file_writer';\n  */\n export class EntryPointCollector {\n   constructor(\n-      private fs: FileSystem, private config: NgccConfiguration, private logger: Logger,\n+      private fs: ReadonlyFileSystem, private config: NgccConfiguration, private logger: Logger,\n       private resolver: DependencyResolver) {}\n \n   /**"
        },
        {
            "sha": "01f9330989a452b9badbad37923f9372f744ac18",
            "filename": "packages/compiler-cli/ngcc/src/entry_point_finder/program_based_entry_point_finder.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Fprogram_based_entry_point_finder.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Fprogram_based_entry_point_finder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Fprogram_based_entry_point_finder.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n import {ParsedConfiguration} from '../../../src/perform_compile';\n \n@@ -32,12 +32,13 @@ export class ProgramBasedEntryPointFinder extends TracingEntryPointFinder {\n   private entryPointsWithDependencies: Map<AbsoluteFsPath, EntryPointWithDependencies>|null = null;\n \n   constructor(\n-      fs: FileSystem, config: NgccConfiguration, logger: Logger, resolver: DependencyResolver,\n-      private entryPointCollector: EntryPointCollector,\n+      fs: ReadonlyFileSystem, config: NgccConfiguration, logger: Logger,\n+      resolver: DependencyResolver, private entryPointCollector: EntryPointCollector,\n       private entryPointManifest: EntryPointManifest, basePath: AbsoluteFsPath,\n       private tsConfig: ParsedConfiguration, projectPath: AbsoluteFsPath) {\n     super(\n-        fs, config, logger, resolver, basePath, getPathMappingsFromTsConfig(tsConfig, projectPath));\n+        fs, config, logger, resolver, basePath,\n+        getPathMappingsFromTsConfig(fs, tsConfig, projectPath));\n   }\n \n   /**"
        },
        {
            "sha": "26d15045c3f1ebac2b2871e4c40b7f0075ab4dca",
            "filename": "packages/compiler-cli/ngcc/src/entry_point_finder/targeted_entry_point_finder.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Ftargeted_entry_point_finder.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Ftargeted_entry_point_finder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Ftargeted_entry_point_finder.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem, join, PathSegment, relative, relativeFrom} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, PathSegment, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n import {EntryPointWithDependencies} from '../dependencies/dependency_host';\n import {DependencyResolver, SortedEntryPointsInfo} from '../dependencies/dependency_resolver';\n@@ -25,8 +25,8 @@ import {TracingEntryPointFinder} from './tracing_entry_point_finder';\n  */\n export class TargetedEntryPointFinder extends TracingEntryPointFinder {\n   constructor(\n-      fs: FileSystem, config: NgccConfiguration, logger: Logger, resolver: DependencyResolver,\n-      basePath: AbsoluteFsPath, pathMappings: PathMappings|undefined,\n+      fs: ReadonlyFileSystem, config: NgccConfiguration, logger: Logger,\n+      resolver: DependencyResolver, basePath: AbsoluteFsPath, pathMappings: PathMappings|undefined,\n       private targetPath: AbsoluteFsPath) {\n     super(fs, config, logger, resolver, basePath, pathMappings);\n   }\n@@ -162,31 +162,31 @@ export class TargetedEntryPointFinder extends TracingEntryPointFinder {\n   private computePackagePathFromContainingPath(\n       entryPointPath: AbsoluteFsPath, containingPath: AbsoluteFsPath): AbsoluteFsPath|null {\n     let packagePath = containingPath;\n-    const segments = this.splitPath(relative(containingPath, entryPointPath));\n-    let nodeModulesIndex = segments.lastIndexOf(relativeFrom('node_modules'));\n+    const segments = this.splitPath(this.fs.relative(containingPath, entryPointPath));\n+    let nodeModulesIndex = segments.lastIndexOf('node_modules' as PathSegment);\n \n     // If there are no `node_modules` in the relative path between the `basePath` and the\n     // `entryPointPath` then just try the `basePath` as the `packagePath`.\n     // (This can be the case with path-mapped entry-points.)\n     if (nodeModulesIndex === -1) {\n-      if (this.fs.exists(join(packagePath, 'package.json'))) {\n+      if (this.fs.exists(this.fs.join(packagePath, 'package.json'))) {\n         return packagePath;\n       }\n     }\n \n     // Start the search at the deepest nested `node_modules` folder that is below the `basePath`\n     // but above the `entryPointPath`, if there are any.\n     while (nodeModulesIndex >= 0) {\n-      packagePath = join(packagePath, segments.shift()!);\n+      packagePath = this.fs.join(packagePath, segments.shift()!);\n       nodeModulesIndex--;\n     }\n \n     // Note that we start at the folder below the current candidate `packagePath` because the\n     // initial candidate `packagePath` is either a `node_modules` folder or the `basePath` with\n     // no `package.json`.\n     for (const segment of segments) {\n-      packagePath = join(packagePath, segment);\n-      if (this.fs.exists(join(packagePath, 'package.json'))) {\n+      packagePath = this.fs.join(packagePath, segment);\n+      if (this.fs.exists(this.fs.join(packagePath, 'package.json'))) {\n         return packagePath;\n       }\n     }\n@@ -207,12 +207,12 @@ export class TargetedEntryPointFinder extends TracingEntryPointFinder {\n       containerPath = this.fs.dirname(containerPath);\n     }\n \n-    if (this.fs.exists(join(packagePath, 'package.json'))) {\n+    if (this.fs.exists(this.fs.join(packagePath, 'package.json'))) {\n       // The directory directly below `node_modules` is a package - use it\n       return packagePath;\n     } else if (\n         this.fs.basename(packagePath).startsWith('@') &&\n-        this.fs.exists(join(scopedPackagePath, 'package.json'))) {\n+        this.fs.exists(this.fs.join(scopedPackagePath, 'package.json'))) {\n       // The directory directly below the `node_modules` is a scope and the directory directly\n       // below that is a scoped package - use it\n       return scopedPackagePath;"
        },
        {
            "sha": "a39d131638ea5661a67fcc7f81788afc5114089f",
            "filename": "packages/compiler-cli/ngcc/src/entry_point_finder/tracing_entry_point_finder.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Ftracing_entry_point_finder.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Ftracing_entry_point_finder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Ftracing_entry_point_finder.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,9 +5,8 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, PathManipulation, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n-\n import {EntryPointWithDependencies} from '../dependencies/dependency_host';\n import {DependencyResolver, SortedEntryPointsInfo} from '../dependencies/dependency_resolver';\n import {NgccConfiguration} from '../packages/configuration';\n@@ -36,9 +35,9 @@ export abstract class TracingEntryPointFinder implements EntryPointFinder {\n   private basePaths: AbsoluteFsPath[]|null = null;\n \n   constructor(\n-      protected fs: FileSystem, protected config: NgccConfiguration, protected logger: Logger,\n-      protected resolver: DependencyResolver, protected basePath: AbsoluteFsPath,\n-      protected pathMappings: PathMappings|undefined) {}\n+      protected fs: ReadonlyFileSystem, protected config: NgccConfiguration,\n+      protected logger: Logger, protected resolver: DependencyResolver,\n+      protected basePath: AbsoluteFsPath, protected pathMappings: PathMappings|undefined) {}\n \n   /**\n    * Search for Angular package entry-points."
        },
        {
            "sha": "d32498f35033b9a59eab15ec3ff60104413542d7",
            "filename": "packages/compiler-cli/ngcc/src/entry_point_finder/utils.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fentry_point_finder%2Futils.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, getFileSystem, isRoot, resolve} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, getFileSystem, PathManipulation} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n import {PathMappings} from '../path_mappings';\n \n@@ -34,7 +34,7 @@ export function getBasePaths(\n   const fs = getFileSystem();\n   const basePaths = [sourceDirectory];\n   if (pathMappings) {\n-    const baseUrl = resolve(pathMappings.baseUrl);\n+    const baseUrl = fs.resolve(pathMappings.baseUrl);\n     if (fs.isRoot(baseUrl)) {\n       logger.warn(\n           `The provided pathMappings baseUrl is the root path ${baseUrl}.\\n` +\n@@ -58,7 +58,7 @@ export function getBasePaths(\n     }));\n   }\n \n-  const dedupedBasePaths = dedupePaths(basePaths);\n+  const dedupedBasePaths = dedupePaths(fs, basePaths);\n \n   // We want to ensure that the `sourceDirectory` is included when it is a node_modules folder.\n   // Otherwise our entry-point finding algorithm would fail to walk that folder.\n@@ -103,20 +103,20 @@ export function trackDuration<T = void>(task: () => T extends Promise<unknown>?\n  * (Note that we do not get `d` even though `d/e` and `d/f` share a base directory, since `d` is not\n  * one of the base paths.)\n  */\n-export function dedupePaths(paths: AbsoluteFsPath[]): AbsoluteFsPath[] {\n+function dedupePaths(fs: PathManipulation, paths: AbsoluteFsPath[]): AbsoluteFsPath[] {\n   const root: Node = {children: new Map()};\n   for (const path of paths) {\n-    addPath(root, path);\n+    addPath(fs, root, path);\n   }\n   return flattenTree(root);\n }\n \n /**\n  * Add a path (defined by the `segments`) to the current `node` in the tree.\n  */\n-function addPath(root: Node, path: AbsoluteFsPath): void {\n+function addPath(fs: PathManipulation, root: Node, path: AbsoluteFsPath): void {\n   let node = root;\n-  if (!isRoot(path)) {\n+  if (!fs.isRoot(path)) {\n     const segments = path.split('/');\n     for (let index = 0; index < segments.length; index++) {\n       if (isLeaf(node)) {"
        },
        {
            "sha": "82c8bbcb2dcc4e8ef4f298302e3310724001656e",
            "filename": "packages/compiler-cli/ngcc/src/execution/cluster/executor.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Fcluster%2Fexecutor.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Fcluster%2Fexecutor.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Fcluster%2Fexecutor.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {FileSystem} from '../../../../src/ngtsc/file_system';\n+import {PathManipulation} from '../../../../src/ngtsc/file_system';\n import {Logger} from '../../../../src/ngtsc/logging';\n import {AsyncLocker} from '../../locking/async_locker';\n import {FileWriter} from '../../writing/file_writer';\n@@ -21,7 +21,7 @@ import {ClusterMaster} from './master';\n  */\n export class ClusterExecutor implements Executor {\n   constructor(\n-      private workerCount: number, private fileSystem: FileSystem, private logger: Logger,\n+      private workerCount: number, private fileSystem: PathManipulation, private logger: Logger,\n       private fileWriter: FileWriter, private pkgJsonUpdater: PackageJsonUpdater,\n       private lockFile: AsyncLocker,\n       private createTaskCompletedCallback: CreateTaskCompletedCallback) {}"
        },
        {
            "sha": "9024a96ff78491515c26270497b5c2eac15d8da6",
            "filename": "packages/compiler-cli/ngcc/src/execution/cluster/master.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Fcluster%2Fmaster.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Fcluster%2Fmaster.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Fcluster%2Fmaster.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -10,7 +10,7 @@\n \n import * as cluster from 'cluster';\n \n-import {AbsoluteFsPath, FileSystem} from '../../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, PathManipulation} from '../../../../src/ngtsc/file_system';\n import {Logger} from '../../../../src/ngtsc/logging';\n import {FileWriter} from '../../writing/file_writer';\n import {PackageJsonUpdater} from '../../writing/package_json_updater';\n@@ -35,7 +35,7 @@ export class ClusterMaster {\n   private remainingRespawnAttempts = 3;\n \n   constructor(\n-      private maxWorkerCount: number, private fileSystem: FileSystem, private logger: Logger,\n+      private maxWorkerCount: number, private fileSystem: PathManipulation, private logger: Logger,\n       private fileWriter: FileWriter, private pkgJsonUpdater: PackageJsonUpdater,\n       analyzeEntryPoints: AnalyzeEntryPointsFn,\n       createTaskCompletedCallback: CreateTaskCompletedCallback) {"
        },
        {
            "sha": "c46e021a0fca0adec8eec8021cee436b5a0f65df",
            "filename": "packages/compiler-cli/ngcc/src/execution/tasks/completion.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Ftasks%2Fcompletion.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Ftasks%2Fcompletion.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fexecution%2Ftasks%2Fcompletion.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {FileSystem, resolve} from '../../../../src/ngtsc/file_system';\n+import {PathManipulation, ReadonlyFileSystem} from '../../../../src/ngtsc/file_system';\n import {Logger} from '../../../../src/ngtsc/logging';\n import {markAsProcessed} from '../../packages/build_marker';\n import {getEntryPointFormat, PackageJsonFormatProperties} from '../../packages/entry_point';\n@@ -46,11 +46,11 @@ export function composeTaskCompletedCallbacks(\n  *\n  * @param pkgJsonUpdater The service used to update the package.json\n  */\n-export function createMarkAsProcessedHandler(pkgJsonUpdater: PackageJsonUpdater):\n-    TaskCompletedHandler {\n+export function createMarkAsProcessedHandler(\n+    fs: PathManipulation, pkgJsonUpdater: PackageJsonUpdater): TaskCompletedHandler {\n   return (task: Task): void => {\n     const {entryPoint, formatPropertiesToMarkAsProcessed, processDts} = task;\n-    const packageJsonPath = resolve(entryPoint.path, 'package.json');\n+    const packageJsonPath = fs.resolve(entryPoint.path, 'package.json');\n     const propsToMarkAsProcessed: PackageJsonFormatProperties[] =\n         [...formatPropertiesToMarkAsProcessed];\n     if (processDts) {\n@@ -64,7 +64,7 @@ export function createMarkAsProcessedHandler(pkgJsonUpdater: PackageJsonUpdater)\n /**\n  * Create a handler that will throw an error.\n  */\n-export function createThrowErrorHandler(fs: FileSystem): TaskCompletedHandler {\n+export function createThrowErrorHandler(fs: ReadonlyFileSystem): TaskCompletedHandler {\n   return (task: Task, message: string|null): void => {\n     const format = getEntryPointFormat(fs, task.entryPoint, task.formatProperty);\n     throw new Error(\n@@ -78,7 +78,7 @@ export function createThrowErrorHandler(fs: FileSystem): TaskCompletedHandler {\n  * Create a handler that logs an error and marks the task as failed.\n  */\n export function createLogErrorHandler(\n-    logger: Logger, fs: FileSystem, taskQueue: TaskQueue): TaskCompletedHandler {\n+    logger: Logger, fs: ReadonlyFileSystem, taskQueue: TaskQueue): TaskCompletedHandler {\n   return (task: Task, message: string|null): void => {\n     taskQueue.markAsFailed(task);\n     const format = getEntryPointFormat(fs, task.entryPoint, task.formatProperty);"
        },
        {
            "sha": "08f141c0ee7712e137b771f947222e9eb8bea0c4",
            "filename": "packages/compiler-cli/ngcc/src/locking/lock_file.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Flocking%2Flock_file.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Flocking%2Flock_file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Flocking%2Flock_file.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,9 +5,9 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, PathManipulation} from '../../../src/ngtsc/file_system';\n \n-export function getLockFilePath(fs: FileSystem) {\n+export function getLockFilePath(fs: PathManipulation) {\n   return fs.resolve(require.resolve('@angular/compiler-cli/ngcc'), '../__ngcc_lock_file__');\n }\n "
        },
        {
            "sha": "619250f1768d15a136afc70673d16bcd9fe1592f",
            "filename": "packages/compiler-cli/ngcc/src/main.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmain.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmain.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fmain.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -8,7 +8,7 @@\n \n /// <reference types=\"node\" />\n \n-import {AbsoluteFsPath, FileSystem, resolve} from '../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, FileSystem, ReadonlyFileSystem} from '../../src/ngtsc/file_system';\n import {Logger} from '../../src/ngtsc/logging';\n import {ParsedConfiguration} from '../../src/perform_compile';\n \n@@ -78,8 +78,9 @@ export function mainNgcc(options: AsyncNgccOptions|SyncNgccOptions): void|Promis\n \n   // Bail out early if the work is already done.\n   const supportedPropertiesToConsider = ensureSupportedProperties(propertiesToConsider);\n-  const absoluteTargetEntryPointPath =\n-      targetEntryPointPath !== undefined ? resolve(basePath, targetEntryPointPath) : null;\n+  const absoluteTargetEntryPointPath = targetEntryPointPath !== undefined ?\n+      fileSystem.resolve(basePath, targetEntryPointPath) :\n+      null;\n   const finder = getEntryPointFinder(\n       fileSystem, logger, dependencyResolver, config, entryPointManifest, absBasePath,\n       absoluteTargetEntryPointPath, pathMappings,\n@@ -140,9 +141,10 @@ function ensureSupportedProperties(properties: string[]): EntryPointJsonProperty\n \n function getCreateTaskCompletedCallback(\n     pkgJsonUpdater: PackageJsonUpdater, errorOnFailedEntryPoint: boolean, logger: Logger,\n-    fileSystem: FileSystem): CreateTaskCompletedCallback {\n+    fileSystem: ReadonlyFileSystem): CreateTaskCompletedCallback {\n   return taskQueue => composeTaskCompletedCallbacks({\n-           [TaskProcessingOutcome.Processed]: createMarkAsProcessedHandler(pkgJsonUpdater),\n+           [TaskProcessingOutcome.Processed]:\n+               createMarkAsProcessedHandler(fileSystem, pkgJsonUpdater),\n            [TaskProcessingOutcome.Failed]:\n                errorOnFailedEntryPoint ? createThrowErrorHandler(fileSystem) :\n                                          createLogErrorHandler(logger, fileSystem, taskQueue),\n@@ -175,7 +177,7 @@ function getExecutor(\n }\n \n function getDependencyResolver(\n-    fileSystem: FileSystem, logger: Logger, config: NgccConfiguration,\n+    fileSystem: ReadonlyFileSystem, logger: Logger, config: NgccConfiguration,\n     pathMappings: PathMappings|undefined): DependencyResolver {\n   const moduleResolver = new ModuleResolver(fileSystem, pathMappings);\n   const esmDependencyHost = new EsmDependencyHost(fileSystem, moduleResolver);\n@@ -193,7 +195,7 @@ function getDependencyResolver(\n }\n \n function getEntryPointFinder(\n-    fs: FileSystem, logger: Logger, resolver: DependencyResolver, config: NgccConfiguration,\n+    fs: ReadonlyFileSystem, logger: Logger, resolver: DependencyResolver, config: NgccConfiguration,\n     entryPointManifest: EntryPointManifest, basePath: AbsoluteFsPath,\n     absoluteTargetEntryPointPath: AbsoluteFsPath|null, pathMappings: PathMappings|undefined,\n     tsConfig: ParsedConfiguration|null, projectPath: AbsoluteFsPath): EntryPointFinder {"
        },
        {
            "sha": "8bd81f1c873599bafb9b1b8e5014b3600fd17d25",
            "filename": "packages/compiler-cli/ngcc/src/ngcc_options.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fngcc_options.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fngcc_options.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fngcc_options.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -7,7 +7,7 @@\n  */\n import * as os from 'os';\n \n-import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem} from '../../src/ngtsc/file_system';\n+import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem, PathManipulation} from '../../src/ngtsc/file_system';\n import {ConsoleLogger, Logger, LogLevel} from '../../src/ngtsc/logging';\n import {ParsedConfiguration, readConfiguration} from '../../src/perform_compile';\n \n@@ -175,7 +175,7 @@ export function getSharedSetup(options: NgccOptions): SharedSetup&RequiredNgccOp\n     compileAllFormats = true,\n     createNewEntryPointFormats = false,\n     logger = new ConsoleLogger(LogLevel.info),\n-    pathMappings = getPathMappingsFromTsConfig(tsConfig, projectPath),\n+    pathMappings = getPathMappingsFromTsConfig(fileSystem, tsConfig, projectPath),\n     async = false,\n     errorOnFailedEntryPoint = false,\n     enableI18nLegacyMessageIdFormat = true,\n@@ -239,7 +239,7 @@ export function clearTsConfigCache() {\n }\n \n function checkForSolutionStyleTsConfig(\n-    fileSystem: FileSystem, logger: Logger, projectPath: AbsoluteFsPath,\n+    fileSystem: PathManipulation, logger: Logger, projectPath: AbsoluteFsPath,\n     tsConfigPath: string|null|undefined, tsConfig: ParsedConfiguration|null): void {\n   if (tsConfigPath !== null && !tsConfigPath && tsConfig !== null &&\n       tsConfig.rootNames.length === 0 && tsConfig.projectReferences !== undefined &&"
        },
        {
            "sha": "acf3b42ee137f15632fb3148b16f0cafa81bed74",
            "filename": "packages/compiler-cli/ngcc/src/packages/bundle_program.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fbundle_program.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fbundle_program.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fbundle_program.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -7,7 +7,7 @@\n  */\n import * as ts from 'typescript';\n \n-import {AbsoluteFsPath, dirname, FileSystem, resolve} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n \n import {patchTsGetExpandoInitializer, restoreGetExpandoInitializer} from './patch_ts_expando_initializer';\n \n@@ -34,10 +34,10 @@ export interface BundleProgram {\n  * Create a bundle program.\n  */\n export function makeBundleProgram(\n-    fs: FileSystem, isCore: boolean, pkg: AbsoluteFsPath, path: AbsoluteFsPath, r3FileName: string,\n-    options: ts.CompilerOptions, host: ts.CompilerHost,\n+    fs: ReadonlyFileSystem, isCore: boolean, pkg: AbsoluteFsPath, path: AbsoluteFsPath,\n+    r3FileName: string, options: ts.CompilerOptions, host: ts.CompilerHost,\n     additionalFiles: AbsoluteFsPath[] = []): BundleProgram {\n-  const r3SymbolsPath = isCore ? findR3SymbolsPath(fs, dirname(path), r3FileName) : null;\n+  const r3SymbolsPath = isCore ? findR3SymbolsPath(fs, fs.dirname(path), r3FileName) : null;\n   let rootPaths =\n       r3SymbolsPath ? [path, r3SymbolsPath, ...additionalFiles] : [path, ...additionalFiles];\n \n@@ -58,8 +58,8 @@ export function makeBundleProgram(\n  * Search the given directory hierarchy to find the path to the `r3_symbols` file.\n  */\n export function findR3SymbolsPath(\n-    fs: FileSystem, directory: AbsoluteFsPath, filename: string): AbsoluteFsPath|null {\n-  const r3SymbolsFilePath = resolve(directory, filename);\n+    fs: ReadonlyFileSystem, directory: AbsoluteFsPath, filename: string): AbsoluteFsPath|null {\n+  const r3SymbolsFilePath = fs.resolve(directory, filename);\n   if (fs.exists(r3SymbolsFilePath)) {\n     return r3SymbolsFilePath;\n   }\n@@ -72,12 +72,12 @@ export function findR3SymbolsPath(\n           .filter(p => p !== 'node_modules')\n           // Only interested in directories (and only those that are not symlinks)\n           .filter(p => {\n-            const stat = fs.lstat(resolve(directory, p));\n+            const stat = fs.lstat(fs.resolve(directory, p));\n             return stat.isDirectory() && !stat.isSymbolicLink();\n           });\n \n   for (const subDirectory of subDirectories) {\n-    const r3SymbolsFilePath = findR3SymbolsPath(fs, resolve(directory, subDirectory), filename);\n+    const r3SymbolsFilePath = findR3SymbolsPath(fs, fs.resolve(directory, subDirectory), filename);\n     if (r3SymbolsFilePath) {\n       return r3SymbolsFilePath;\n     }"
        },
        {
            "sha": "93583509b1ae383a0f50709ce66e1c050c0ff95f",
            "filename": "packages/compiler-cli/ngcc/src/packages/configuration.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 9,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fconfiguration.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fconfiguration.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fconfiguration.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -9,7 +9,7 @@ import {createHash} from 'crypto';\n import {satisfies} from 'semver';\n import * as vm from 'vm';\n \n-import {AbsoluteFsPath, dirname, FileSystem, join, resolve} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, PathManipulation, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n \n import {PackageJsonFormatPropertiesMap} from './entry_point';\n \n@@ -186,13 +186,14 @@ export class ProcessedNgccPackageConfig implements Omit<RawNgccPackageConfig, 'e\n    */\n   ignorableDeepImportMatchers: RegExp[];\n \n-  constructor(packagePath: AbsoluteFsPath, {\n+  constructor(fs: PathManipulation, packagePath: AbsoluteFsPath, {\n     entryPoints = {},\n     ignorableDeepImportMatchers = [],\n   }: RawNgccPackageConfig) {\n     const absolutePathEntries: [AbsoluteFsPath, NgccEntryPointConfig][] =\n-        Object.entries(entryPoints).map(([relativePath,\n-                                          config]) => [resolve(packagePath, relativePath), config]);\n+        Object.entries(entryPoints).map(([\n+                                          relativePath, config\n+                                        ]) => [fs.resolve(packagePath, relativePath), config]);\n \n     this.packagePath = packagePath;\n     this.entryPoints = new Map(absolutePathEntries);\n@@ -230,7 +231,7 @@ export class NgccConfiguration {\n   private cache = new Map<string, VersionedPackageConfig>();\n   readonly hash: string;\n \n-  constructor(private fs: FileSystem, baseDir: AbsoluteFsPath) {\n+  constructor(private fs: ReadonlyFileSystem, baseDir: AbsoluteFsPath) {\n     this.defaultConfig = this.processProjectConfig(DEFAULT_NGCC_CONFIG);\n     this.projectConfig = this.processProjectConfig(this.loadProjectConfig(baseDir));\n     this.hash = this.computeHash();\n@@ -261,7 +262,7 @@ export class NgccConfiguration {\n   getPackageConfig(packageName: string, packagePath: AbsoluteFsPath, version: string|null):\n       ProcessedNgccPackageConfig {\n     const rawPackageConfig = this.getRawPackageConfig(packageName, packagePath, version);\n-    return new ProcessedNgccPackageConfig(packagePath, rawPackageConfig);\n+    return new ProcessedNgccPackageConfig(this.fs, packagePath, rawPackageConfig);\n   }\n \n   private getRawPackageConfig(\n@@ -320,7 +321,7 @@ export class NgccConfiguration {\n   }\n \n   private loadProjectConfig(baseDir: AbsoluteFsPath): NgccProjectConfig {\n-    const configFilePath = join(baseDir, NGCC_CONFIG_FILENAME);\n+    const configFilePath = this.fs.join(baseDir, NGCC_CONFIG_FILENAME);\n     if (this.fs.exists(configFilePath)) {\n       try {\n         return this.evalSrcFile(configFilePath);\n@@ -334,7 +335,7 @@ export class NgccConfiguration {\n \n   private loadPackageConfig(packagePath: AbsoluteFsPath, version: string|null):\n       VersionedPackageConfig|null {\n-    const configFilePath = join(packagePath, NGCC_CONFIG_FILENAME);\n+    const configFilePath = this.fs.join(packagePath, NGCC_CONFIG_FILENAME);\n     if (this.fs.exists(configFilePath)) {\n       try {\n         const packageConfig = this.evalSrcFile(configFilePath);\n@@ -357,7 +358,7 @@ export class NgccConfiguration {\n       module: {exports: theExports},\n       exports: theExports,\n       require,\n-      __dirname: dirname(srcPath),\n+      __dirname: this.fs.dirname(srcPath),\n       __filename: srcPath\n     };\n     vm.runInNewContext(src, sandbox, {filename: srcPath});"
        },
        {
            "sha": "37d094c4f2ea5e31c2e91882d1fa935a9d8ede98",
            "filename": "packages/compiler-cli/ngcc/src/packages/entry_point.ts",
            "status": "modified",
            "additions": 25,
            "deletions": 24,
            "changes": 49,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,11 +5,9 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {relative} from 'canonical-path';\n-import {basename} from 'path';\n import * as ts from 'typescript';\n \n-import {AbsoluteFsPath, FileSystem, join, resolve} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, PathManipulation, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n import {parseStatementForUmdModule} from '../host/umd_host';\n import {resolveFileWithPostfixes} from '../utils';\n@@ -130,10 +128,10 @@ export type GetEntryPointResult =\n  *   entry-point.\n  */\n export function getEntryPointInfo(\n-    fs: FileSystem, config: NgccConfiguration, logger: Logger, packagePath: AbsoluteFsPath,\n+    fs: ReadonlyFileSystem, config: NgccConfiguration, logger: Logger, packagePath: AbsoluteFsPath,\n     entryPointPath: AbsoluteFsPath): GetEntryPointResult {\n-  const packagePackageJsonPath = resolve(packagePath, 'package.json');\n-  const entryPointPackageJsonPath = resolve(entryPointPath, 'package.json');\n+  const packagePackageJsonPath = fs.resolve(packagePath, 'package.json');\n+  const entryPointPackageJsonPath = fs.resolve(entryPointPath, 'package.json');\n   const loadedPackagePackageJson = loadPackageJson(fs, packagePackageJsonPath);\n   const loadedEntryPointPackageJson = (packagePackageJsonPath === entryPointPackageJsonPath) ?\n       loadedPackagePackageJson :\n@@ -163,7 +161,7 @@ export function getEntryPointInfo(\n     return IGNORED_ENTRY_POINT;\n   } else {\n     entryPointPackageJson = mergeConfigAndPackageJson(\n-        loadedEntryPointPackageJson, entryPointConfig, packagePath, entryPointPath);\n+        fs, loadedEntryPointPackageJson, entryPointConfig, packagePath, entryPointPath);\n   }\n \n   const typings = entryPointPackageJson.typings || entryPointPackageJson.types ||\n@@ -176,7 +174,8 @@ export function getEntryPointInfo(\n   // An entry-point is assumed to be compiled by Angular if there is either:\n   // * a `metadata.json` file next to the typings entry-point\n   // * a custom config for this entry-point\n-  const metadataPath = resolve(entryPointPath, typings.replace(/\\.d\\.ts$/, '') + '.metadata.json');\n+  const metadataPath =\n+      fs.resolve(entryPointPath, typings.replace(/\\.d\\.ts$/, '') + '.metadata.json');\n   const compiledByAngular = entryPointConfig !== undefined || fs.exists(metadataPath);\n \n   const entryPointInfo: EntryPoint = {\n@@ -185,7 +184,7 @@ export function getEntryPointInfo(\n     packageName,\n     packagePath,\n     packageJson: entryPointPackageJson,\n-    typings: resolve(entryPointPath, typings),\n+    typings: fs.resolve(entryPointPath, typings),\n     compiledByAngular,\n     ignoreMissingDependencies:\n         entryPointConfig !== undefined ? !!entryPointConfig.ignoreMissingDependencies : false,\n@@ -208,8 +207,8 @@ export function isEntryPoint(result: GetEntryPointResult): result is EntryPoint\n  * @returns An entry-point format or `undefined` if none match the given property.\n  */\n export function getEntryPointFormat(\n-    fs: FileSystem, entryPoint: EntryPoint, property: EntryPointJsonProperty): EntryPointFormat|\n-    undefined {\n+    fs: ReadonlyFileSystem, entryPoint: EntryPoint,\n+    property: EntryPointJsonProperty): EntryPointFormat|undefined {\n   switch (property) {\n     case 'fesm2015':\n       return 'esm2015';\n@@ -226,13 +225,13 @@ export function getEntryPointFormat(\n       if (typeof browserFile !== 'string') {\n         return undefined;\n       }\n-      return sniffModuleFormat(fs, join(entryPoint.path, browserFile));\n+      return sniffModuleFormat(fs, fs.join(entryPoint.path, browserFile));\n     case 'main':\n       const mainFile = entryPoint.packageJson['main'];\n       if (mainFile === undefined) {\n         return undefined;\n       }\n-      return sniffModuleFormat(fs, join(entryPoint.path, mainFile));\n+      return sniffModuleFormat(fs, fs.join(entryPoint.path, mainFile));\n     case 'module':\n       const moduleFilePath = entryPoint.packageJson['module'];\n       // As of version 10, the `module` property in `package.json` should point to\n@@ -254,17 +253,17 @@ export function getEntryPointFormat(\n  * @param packageJsonPath the absolute path to the `package.json` file.\n  * @returns JSON from the `package.json` file if it is valid, `null` otherwise.\n  */\n-function loadPackageJson(fs: FileSystem, packageJsonPath: AbsoluteFsPath): EntryPointPackageJson|\n-    null {\n+function loadPackageJson(\n+    fs: ReadonlyFileSystem, packageJsonPath: AbsoluteFsPath): EntryPointPackageJson|null {\n   try {\n     return JSON.parse(fs.readFile(packageJsonPath));\n   } catch {\n     return null;\n   }\n }\n \n-function sniffModuleFormat(fs: FileSystem, sourceFilePath: AbsoluteFsPath): EntryPointFormat|\n-    undefined {\n+function sniffModuleFormat(\n+    fs: ReadonlyFileSystem, sourceFilePath: AbsoluteFsPath): EntryPointFormat|undefined {\n   const resolvedPath = resolveFileWithPostfixes(fs, sourceFilePath, ['', '.js', '/index.js']);\n   if (resolvedPath === null) {\n     return undefined;\n@@ -285,18 +284,19 @@ function sniffModuleFormat(fs: FileSystem, sourceFilePath: AbsoluteFsPath): Entr\n }\n \n function mergeConfigAndPackageJson(\n-    entryPointPackageJson: EntryPointPackageJson|null, entryPointConfig: NgccEntryPointConfig,\n-    packagePath: AbsoluteFsPath, entryPointPath: AbsoluteFsPath): EntryPointPackageJson {\n+    fs: PathManipulation, entryPointPackageJson: EntryPointPackageJson|null,\n+    entryPointConfig: NgccEntryPointConfig, packagePath: AbsoluteFsPath,\n+    entryPointPath: AbsoluteFsPath): EntryPointPackageJson {\n   if (entryPointPackageJson !== null) {\n     return {...entryPointPackageJson, ...entryPointConfig.override};\n   } else {\n-    const name = `${basename(packagePath)}/${relative(packagePath, entryPointPath)}`;\n+    const name = `${fs.basename(packagePath)}/${fs.relative(packagePath, entryPointPath)}`;\n     return {name, ...entryPointConfig.override};\n   }\n }\n \n function guessTypingsFromPackageJson(\n-    fs: FileSystem, entryPointPath: AbsoluteFsPath,\n+    fs: ReadonlyFileSystem, entryPointPath: AbsoluteFsPath,\n     entryPointPackageJson: EntryPointPackageJson): AbsoluteFsPath|null {\n   for (const prop of SUPPORTED_FORMAT_PROPERTIES) {\n     const field = entryPointPackageJson[prop];\n@@ -305,7 +305,7 @@ function guessTypingsFromPackageJson(\n       continue;\n     }\n     const relativeTypingsPath = field.replace(/\\.js$/, '.d.ts');\n-    const typingsPath = resolve(entryPointPath, relativeTypingsPath);\n+    const typingsPath = fs.resolve(entryPointPath, relativeTypingsPath);\n     if (fs.exists(typingsPath)) {\n       return typingsPath;\n     }\n@@ -321,14 +321,15 @@ function guessTypingsFromPackageJson(\n  * - The version is read off of the `version` property of the package's `package.json` file (if\n  *   available).\n  *\n- * @param fs The `FileSystem` instance to use for parsing `packagePath` (if needed).\n+ * @param fs The file-system to use for processing `packagePath`.\n  * @param packagePath the absolute path to the package.\n  * @param packagePackageJson the parsed `package.json` of the package (if available).\n  * @param entryPointPackageJson the parsed `package.json` of an entry-point (if available).\n  * @returns the computed name and version of the package.\n  */\n function getPackageNameAndVersion(\n-    fs: FileSystem, packagePath: AbsoluteFsPath, packagePackageJson: EntryPointPackageJson|null,\n+    fs: PathManipulation, packagePath: AbsoluteFsPath,\n+    packagePackageJson: EntryPointPackageJson|null,\n     entryPointPackageJson: EntryPointPackageJson|\n     null): {packageName: string, packageVersion: string|null} {\n   let packageName: string;"
        },
        {
            "sha": "eaabf72f9ddd321403086b93c638eee6fb6d3f83",
            "filename": "packages/compiler-cli/ngcc/src/packages/entry_point_bundle.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point_bundle.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point_bundle.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point_bundle.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import * as ts from 'typescript';\n-import {AbsoluteFsPath, FileSystem} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, FileSystem, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {PathMappings} from '../path_mappings';\n import {BundleProgram, makeBundleProgram} from './bundle_program';\n import {EntryPoint, EntryPointFormat} from './entry_point';\n@@ -86,7 +86,7 @@ export function makeEntryPointBundle(\n }\n \n function computePotentialDtsFilesFromJsFiles(\n-    fs: FileSystem, srcProgram: ts.Program, formatPath: AbsoluteFsPath,\n+    fs: ReadonlyFileSystem, srcProgram: ts.Program, formatPath: AbsoluteFsPath,\n     typingsPath: AbsoluteFsPath) {\n   const formatRoot = fs.dirname(formatPath);\n   const typingsRoot = fs.dirname(typingsPath);"
        },
        {
            "sha": "2305e3dde067fb7e2e68954ea17f30bd0ea9b63c",
            "filename": "packages/compiler-cli/ngcc/src/packages/source_file_cache.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fsource_file_cache.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fsource_file_cache.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fsource_file_cache.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import * as ts from 'typescript';\n-import {AbsoluteFsPath, FileSystem} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n \n /**\n  * A cache that holds on to source files that can be shared for processing all entry-points in a\n@@ -29,7 +29,7 @@ import {AbsoluteFsPath, FileSystem} from '../../../src/ngtsc/file_system';\n export class SharedFileCache {\n   private sfCache = new Map<AbsoluteFsPath, ts.SourceFile>();\n \n-  constructor(private fs: FileSystem) {}\n+  constructor(private fs: ReadonlyFileSystem) {}\n \n   /**\n    * Loads a `ts.SourceFile` if the provided `fileName` is deemed appropriate to be cached. To\n@@ -95,7 +95,7 @@ const DEFAULT_LIB_PATTERN = ['node_modules', 'typescript', 'lib', /^lib\\..+\\.d\\.\n  * @param absPath The path for which to determine if it corresponds with a default library file.\n  * @param fs The filesystem to use for inspecting the path.\n  */\n-export function isDefaultLibrary(absPath: AbsoluteFsPath, fs: FileSystem): boolean {\n+export function isDefaultLibrary(absPath: AbsoluteFsPath, fs: ReadonlyFileSystem): boolean {\n   return isFile(absPath, DEFAULT_LIB_PATTERN, fs);\n }\n \n@@ -109,7 +109,7 @@ const ANGULAR_DTS_PATTERN = ['node_modules', '@angular', /./, /\\.d\\.ts$/];\n  * @param absPath The path for which to determine if it corresponds with an @angular .d.ts file.\n  * @param fs The filesystem to use for inspecting the path.\n  */\n-export function isAngularDts(absPath: AbsoluteFsPath, fs: FileSystem): boolean {\n+export function isAngularDts(absPath: AbsoluteFsPath, fs: ReadonlyFileSystem): boolean {\n   return isFile(absPath, ANGULAR_DTS_PATTERN, fs);\n }\n \n@@ -122,7 +122,7 @@ export function isAngularDts(absPath: AbsoluteFsPath, fs: FileSystem): boolean {\n  * @param fs The filesystem to use for inspecting the path.\n  */\n function isFile(\n-    path: AbsoluteFsPath, segments: ReadonlyArray<string|RegExp>, fs: FileSystem): boolean {\n+    path: AbsoluteFsPath, segments: ReadonlyArray<string|RegExp>, fs: ReadonlyFileSystem): boolean {\n   for (let i = segments.length - 1; i >= 0; i--) {\n     const pattern = segments[i];\n     const segment = fs.basename(path);\n@@ -147,7 +147,7 @@ function isFile(\n export class EntryPointFileCache {\n   private readonly sfCache = new Map<AbsoluteFsPath, ts.SourceFile>();\n \n-  constructor(private fs: FileSystem, private sharedFileCache: SharedFileCache) {}\n+  constructor(private fs: ReadonlyFileSystem, private sharedFileCache: SharedFileCache) {}\n \n   /**\n    * Returns and caches a parsed `ts.SourceFile` for the provided `fileName`. If the `fileName` is\n@@ -178,7 +178,7 @@ export class EntryPointFileCache {\n   }\n }\n \n-function readFile(absPath: AbsoluteFsPath, fs: FileSystem): string|undefined {\n+function readFile(absPath: AbsoluteFsPath, fs: ReadonlyFileSystem): string|undefined {\n   if (!fs.exists(absPath) || !fs.stat(absPath).isFile()) {\n     return undefined;\n   }\n@@ -190,7 +190,7 @@ function readFile(absPath: AbsoluteFsPath, fs: FileSystem): string|undefined {\n  *\n  * @param fs The filesystem to use for path operations.\n  */\n-export function createModuleResolutionCache(fs: FileSystem): ts.ModuleResolutionCache {\n+export function createModuleResolutionCache(fs: ReadonlyFileSystem): ts.ModuleResolutionCache {\n   return ts.createModuleResolutionCache(fs.pwd(), fileName => {\n     return fs.isCaseSensitive() ? fileName : fileName.toLowerCase();\n   });"
        },
        {
            "sha": "3567a3519f7b4ef4ae6aa2cc29dee0a1d24ebe03",
            "filename": "packages/compiler-cli/ngcc/src/packages/transformer.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Ftransformer.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Ftransformer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Ftransformer.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -8,7 +8,7 @@\n import * as ts from 'typescript';\n \n import {ParsedConfiguration} from '../../..';\n-import {FileSystem} from '../../../src/ngtsc/file_system';\n+import {ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n import {TypeScriptReflectionHost} from '../../../src/ngtsc/reflection';\n import {DecorationAnalyzer} from '../analysis/decoration_analyzer';\n@@ -64,7 +64,7 @@ export type TransformResult = {\n  */\n export class Transformer {\n   constructor(\n-      private fs: FileSystem, private logger: Logger,\n+      private fs: ReadonlyFileSystem, private logger: Logger,\n       private tsConfig: ParsedConfiguration|null = null) {}\n \n   /**\n@@ -100,7 +100,7 @@ export class Transformer {\n         decorationAnalyses, switchMarkerAnalyses, privateDeclarationsAnalyses);\n \n     if (bundle.dts) {\n-      const dtsFormatter = new EsmRenderingFormatter(reflectionHost, bundle.isCore);\n+      const dtsFormatter = new EsmRenderingFormatter(this.fs, reflectionHost, bundle.isCore);\n       const dtsRenderer =\n           new DtsRenderer(dtsFormatter, this.fs, this.logger, reflectionHost, bundle);\n       const renderedDtsFiles = dtsRenderer.renderProgram(\n@@ -129,16 +129,16 @@ export class Transformer {\n   getRenderingFormatter(host: NgccReflectionHost, bundle: EntryPointBundle): RenderingFormatter {\n     switch (bundle.format) {\n       case 'esm2015':\n-        return new EsmRenderingFormatter(host, bundle.isCore);\n+        return new EsmRenderingFormatter(this.fs, host, bundle.isCore);\n       case 'esm5':\n-        return new Esm5RenderingFormatter(host, bundle.isCore);\n+        return new Esm5RenderingFormatter(this.fs, host, bundle.isCore);\n       case 'umd':\n         if (!(host instanceof UmdReflectionHost)) {\n           throw new Error('UmdRenderer requires a UmdReflectionHost');\n         }\n-        return new UmdRenderingFormatter(host, bundle.isCore);\n+        return new UmdRenderingFormatter(this.fs, host, bundle.isCore);\n       case 'commonjs':\n-        return new CommonJsRenderingFormatter(host, bundle.isCore);\n+        return new CommonJsRenderingFormatter(this.fs, host, bundle.isCore);\n       default:\n         throw new Error(`Renderer for \"${bundle.format}\" not yet implemented.`);\n     }"
        },
        {
            "sha": "e41311d0d6c1ab2c596924d3914ec5a9f21b2cf8",
            "filename": "packages/compiler-cli/ngcc/src/path_mappings.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpath_mappings.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpath_mappings.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpath_mappings.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,10 +5,9 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, resolve} from '../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, PathManipulation} from '../../src/ngtsc/file_system';\n import {ParsedConfiguration} from '../../src/perform_compile';\n \n-\n export type PathMappings = {\n   baseUrl: string,\n   paths: {[key: string]: string[]}\n@@ -18,11 +17,12 @@ export type PathMappings = {\n  * If `pathMappings` is not provided directly, then try getting it from `tsConfig`, if available.\n  */\n export function getPathMappingsFromTsConfig(\n-    tsConfig: ParsedConfiguration|null, projectPath: AbsoluteFsPath): PathMappings|undefined {\n+    fs: PathManipulation, tsConfig: ParsedConfiguration|null,\n+    projectPath: AbsoluteFsPath): PathMappings|undefined {\n   if (tsConfig !== null && tsConfig.options.baseUrl !== undefined &&\n       tsConfig.options.paths !== undefined) {\n     return {\n-      baseUrl: resolve(projectPath, tsConfig.options.baseUrl),\n+      baseUrl: fs.resolve(projectPath, tsConfig.options.baseUrl),\n       paths: tsConfig.options.paths,\n     };\n   }"
        },
        {
            "sha": "426be4d4e73b304fe5be07adf70f55ab922ed614",
            "filename": "packages/compiler-cli/ngcc/src/rendering/commonjs_rendering_formatter.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fcommonjs_rendering_formatter.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fcommonjs_rendering_formatter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fcommonjs_rendering_formatter.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {dirname, relative} from 'canonical-path';\n+import {PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import MagicString from 'magic-string';\n import * as ts from 'typescript';\n \n@@ -24,8 +24,8 @@ import {stripExtension} from './utils';\n  * wrapper function for AMD, CommonJS and global module formats.\n  */\n export class CommonJsRenderingFormatter extends Esm5RenderingFormatter {\n-  constructor(protected commonJsHost: NgccReflectionHost, isCore: boolean) {\n-    super(commonJsHost, isCore);\n+  constructor(fs: PathManipulation, protected commonJsHost: NgccReflectionHost, isCore: boolean) {\n+    super(fs, commonJsHost, isCore);\n   }\n \n   /**\n@@ -51,7 +51,7 @@ export class CommonJsRenderingFormatter extends Esm5RenderingFormatter {\n       importManager: ImportManager, file: ts.SourceFile): void {\n     exports.forEach(e => {\n       const basePath = stripExtension(e.from);\n-      const relativePath = './' + relative(dirname(entryPointBasePath), basePath);\n+      const relativePath = './' + this.fs.relative(this.fs.dirname(entryPointBasePath), basePath);\n       const namedImport = entryPointBasePath !== basePath ?\n           importManager.generateNamedImport(relativePath, e.identifier) :\n           {symbol: e.identifier, moduleImport: null};"
        },
        {
            "sha": "337cb673d9ac316cfa14de96fdc38bc15d100c4b",
            "filename": "packages/compiler-cli/ngcc/src/rendering/dts_renderer.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fdts_renderer.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fdts_renderer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fdts_renderer.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -8,7 +8,7 @@\n import MagicString from 'magic-string';\n import * as ts from 'typescript';\n \n-import {FileSystem} from '../../../src/ngtsc/file_system';\n+import {ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {Reexport} from '../../../src/ngtsc/imports';\n import {Logger} from '../../../src/ngtsc/logging';\n import {CompileResult} from '../../../src/ngtsc/transform';\n@@ -56,8 +56,8 @@ export interface DtsClassInfo {\n  */\n export class DtsRenderer {\n   constructor(\n-      private dtsFormatter: RenderingFormatter, private fs: FileSystem, private logger: Logger,\n-      private host: NgccReflectionHost, private bundle: EntryPointBundle) {}\n+      private dtsFormatter: RenderingFormatter, private fs: ReadonlyFileSystem,\n+      private logger: Logger, private host: NgccReflectionHost, private bundle: EntryPointBundle) {}\n \n   renderProgram(\n       decorationAnalyses: DecorationAnalyses,"
        },
        {
            "sha": "06303cc19c38b283f95f6f60e8f3746cf8816be1",
            "filename": "packages/compiler-cli/ngcc/src/rendering/esm_rendering_formatter.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fesm_rendering_formatter.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fesm_rendering_formatter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fesm_rendering_formatter.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -9,7 +9,7 @@ import {Statement} from '@angular/compiler';\n import MagicString from 'magic-string';\n import * as ts from 'typescript';\n \n-import {absoluteFromSourceFile, AbsoluteFsPath, dirname, relative, toRelativeImport} from '../../../src/ngtsc/file_system';\n+import {absoluteFromSourceFile, AbsoluteFsPath, PathManipulation, toRelativeImport} from '../../../src/ngtsc/file_system';\n import {Reexport} from '../../../src/ngtsc/imports';\n import {Import, ImportManager, translateStatement} from '../../../src/ngtsc/translator';\n import {isDtsPath} from '../../../src/ngtsc/util/src/typescript';\n@@ -28,7 +28,9 @@ import {stripExtension} from './utils';\n export class EsmRenderingFormatter implements RenderingFormatter {\n   protected printer = ts.createPrinter({newLine: ts.NewLineKind.LineFeed});\n \n-  constructor(protected host: NgccReflectionHost, protected isCore: boolean) {}\n+  constructor(\n+      protected fs: PathManipulation, protected host: NgccReflectionHost,\n+      protected isCore: boolean) {}\n \n   /**\n    *  Add the imports at the top of the file, after any imports that are already there.\n@@ -57,7 +59,7 @@ export class EsmRenderingFormatter implements RenderingFormatter {\n \n       if (from) {\n         const basePath = stripExtension(from);\n-        const relativePath = relative(dirname(entryPointBasePath), basePath);\n+        const relativePath = this.fs.relative(this.fs.dirname(entryPointBasePath), basePath);\n         const relativeImport = toRelativeImport(relativePath);\n         exportFrom = entryPointBasePath !== basePath ? ` from '${relativeImport}'` : '';\n       }\n@@ -198,7 +200,7 @@ export class EsmRenderingFormatter implements RenderingFormatter {\n       const ngModuleName = info.ngModule.node.name.text;\n       const declarationFile = absoluteFromSourceFile(info.declaration.getSourceFile());\n       const ngModuleFile = absoluteFromSourceFile(info.ngModule.node.getSourceFile());\n-      const relativePath = relative(dirname(declarationFile), ngModuleFile);\n+      const relativePath = this.fs.relative(this.fs.dirname(declarationFile), ngModuleFile);\n       const relativeImport = toRelativeImport(relativePath);\n       const importPath = info.ngModule.ownedByModuleGuess ||\n           (declarationFile !== ngModuleFile ? stripExtension(relativeImport) : null);"
        },
        {
            "sha": "8cbe2edea21744682980778c1325320bde4e07b2",
            "filename": "packages/compiler-cli/ngcc/src/rendering/renderer.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Frenderer.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Frenderer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Frenderer.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -9,7 +9,7 @@ import {ConstantPool, Expression, jsDocComment, LeadingComment, Statement, Wrapp\n import MagicString from 'magic-string';\n import * as ts from 'typescript';\n \n-import {FileSystem} from '../../../src/ngtsc/file_system';\n+import {ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n import {ImportManager} from '../../../src/ngtsc/translator';\n import {ParsedConfiguration} from '../../../src/perform_compile';\n@@ -33,7 +33,7 @@ import {FileToWrite, getImportRewriter, stripExtension} from './utils';\n export class Renderer {\n   constructor(\n       private host: NgccReflectionHost, private srcFormatter: RenderingFormatter,\n-      private fs: FileSystem, private logger: Logger, private bundle: EntryPointBundle,\n+      private fs: ReadonlyFileSystem, private logger: Logger, private bundle: EntryPointBundle,\n       private tsConfig: ParsedConfiguration|null = null) {}\n \n   renderProgram("
        },
        {
            "sha": "91d772649e31948cc81f4171540f8dd0075f947f",
            "filename": "packages/compiler-cli/ngcc/src/rendering/source_maps.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fsource_maps.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fsource_maps.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fsource_maps.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -9,7 +9,7 @@ import {fromObject, generateMapFileComment, SourceMapConverter} from 'convert-so\n import MagicString from 'magic-string';\n import * as ts from 'typescript';\n \n-import {absoluteFrom, absoluteFromSourceFile, basename, FileSystem} from '../../../src/ngtsc/file_system';\n+import {absoluteFrom, absoluteFromSourceFile, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n import {RawSourceMap, SourceFileLoader} from '../../../src/ngtsc/sourcemaps';\n \n@@ -26,7 +26,7 @@ export interface SourceMapInfo {\n  * with an appropriate source-map comment pointing to the merged source-map.\n  */\n export function renderSourceAndMap(\n-    logger: Logger, fs: FileSystem, sourceFile: ts.SourceFile,\n+    logger: Logger, fs: ReadonlyFileSystem, sourceFile: ts.SourceFile,\n     generatedMagicString: MagicString): FileToWrite[] {\n   const generatedPath = absoluteFromSourceFile(sourceFile);\n   const generatedMapPath = absoluteFrom(`${generatedPath}.map`);\n@@ -55,7 +55,7 @@ export function renderSourceAndMap(\n         {path: generatedPath, contents: `${generatedFile.contents}\\n${mergedMap.toComment()}`}\n       ];\n     } else {\n-      const sourceMapComment = generateMapFileComment(`${basename(generatedPath)}.map`);\n+      const sourceMapComment = generateMapFileComment(`${fs.basename(generatedPath)}.map`);\n       return [\n         {path: generatedPath, contents: `${generatedFile.contents}\\n${sourceMapComment}`},\n         {path: generatedMapPath, contents: mergedMap.toJSON()}"
        },
        {
            "sha": "4055c81865cb125e68a06e3d692bcc3f9429576c",
            "filename": "packages/compiler-cli/ngcc/src/rendering/umd_rendering_formatter.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fumd_rendering_formatter.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fumd_rendering_formatter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Frendering%2Fumd_rendering_formatter.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,10 +5,10 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {dirname, relative} from 'canonical-path';\n import MagicString from 'magic-string';\n import * as ts from 'typescript';\n \n+import {PathManipulation} from '../../../src/ngtsc/file_system';\n import {Reexport} from '../../../src/ngtsc/imports';\n import {Import, ImportManager} from '../../../src/ngtsc/translator';\n import {ExportInfo} from '../analysis/private_declarations_analyzer';\n@@ -26,8 +26,8 @@ type AmdConditional = ts.ConditionalExpression&{whenTrue: ts.CallExpression};\n  * wrapper function for AMD, CommonJS and global module formats.\n  */\n export class UmdRenderingFormatter extends Esm5RenderingFormatter {\n-  constructor(protected umdHost: UmdReflectionHost, isCore: boolean) {\n-    super(umdHost, isCore);\n+  constructor(fs: PathManipulation, protected umdHost: UmdReflectionHost, isCore: boolean) {\n+    super(fs, umdHost, isCore);\n   }\n \n   /**\n@@ -87,7 +87,7 @@ export class UmdRenderingFormatter extends Esm5RenderingFormatter {\n         lastStatement ? lastStatement.getEnd() : factoryFunction.body.getEnd() - 1;\n     exports.forEach(e => {\n       const basePath = stripExtension(e.from);\n-      const relativePath = './' + relative(dirname(entryPointBasePath), basePath);\n+      const relativePath = './' + this.fs.relative(this.fs.dirname(entryPointBasePath), basePath);\n       const namedImport = entryPointBasePath !== basePath ?\n           importManager.generateNamedImport(relativePath, e.identifier) :\n           {symbol: e.identifier, moduleImport: null};"
        },
        {
            "sha": "91cc0f9538a2edd51129bc791cd9ff3f45e29c12",
            "filename": "packages/compiler-cli/ngcc/src/utils.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Futils.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -7,7 +7,7 @@\n  */\n import * as ts from 'typescript';\n \n-import {absoluteFrom, AbsoluteFsPath, FileSystem, isRooted} from '../../src/ngtsc/file_system';\n+import {absoluteFrom, AbsoluteFsPath, isRooted, ReadonlyFileSystem} from '../../src/ngtsc/file_system';\n import {DeclarationNode, KnownDeclaration} from '../../src/ngtsc/reflection';\n \n /**\n@@ -122,7 +122,7 @@ export class FactoryMap<K, V> {\n  * @returns An absolute path to the first matching existing file, or `null` if none exist.\n  */\n export function resolveFileWithPostfixes(\n-    fs: FileSystem, path: AbsoluteFsPath, postFixes: string[]): AbsoluteFsPath|null {\n+    fs: ReadonlyFileSystem, path: AbsoluteFsPath, postFixes: string[]): AbsoluteFsPath|null {\n   for (const postFix of postFixes) {\n     const testPath = absoluteFrom(path + postFix);\n     if (fs.exists(testPath) && fs.stat(testPath).isFile()) {"
        },
        {
            "sha": "5b3321af2a46f8455b97343012458dd2739c1049",
            "filename": "packages/compiler-cli/ngcc/src/writing/cleaning/package_cleaner.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fcleaning%2Fpackage_cleaner.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fcleaning%2Fpackage_cleaner.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fcleaning%2Fpackage_cleaner.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem} from '../../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, FileSystem, ReadonlyFileSystem} from '../../../../src/ngtsc/file_system';\n import {needsCleaning} from '../../packages/build_marker';\n import {EntryPoint} from '../../packages/entry_point';\n \n@@ -16,7 +16,7 @@ import {isLocalDirectory} from './utils';\n  * A class that can clean ngcc artifacts from a directory.\n  */\n export class PackageCleaner {\n-  constructor(private fs: FileSystem, private cleaners: CleaningStrategy[]) {}\n+  constructor(private fs: ReadonlyFileSystem, private cleaners: CleaningStrategy[]) {}\n \n   /**\n    * Recurse through the file-system cleaning files and directories as determined by the configured"
        },
        {
            "sha": "8d36f84637b3294e9d626862e8460a4153a5f233",
            "filename": "packages/compiler-cli/ngcc/src/writing/cleaning/utils.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fcleaning%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fcleaning%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fcleaning%2Futils.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,15 +5,15 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem} from '../../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, ReadonlyFileSystem} from '../../../../src/ngtsc/file_system';\n \n /**\n  * Returns true if the given `path` is a directory (not a symlink) and actually exists.\n  *\n  * @param fs the current filesystem\n  * @param path the path to check\n  */\n-export function isLocalDirectory(fs: FileSystem, path: AbsoluteFsPath): boolean {\n+export function isLocalDirectory(fs: ReadonlyFileSystem, path: AbsoluteFsPath): boolean {\n   if (fs.exists(path)) {\n     const stat = fs.lstat(path);\n     return stat.isDirectory();"
        },
        {
            "sha": "47f0dff96b27190ae30f578ae7ec2e5aee70a6b2",
            "filename": "packages/compiler-cli/ngcc/src/writing/new_entry_point_file_writer.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 15,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fnew_entry_point_file_writer.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fnew_entry_point_file_writer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fnew_entry_point_file_writer.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -6,7 +6,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFromSourceFile, AbsoluteFsPath, dirname, FileSystem, isLocalRelativePath, join, relative, resolve} from '../../../src/ngtsc/file_system';\n+import {absoluteFromSourceFile, AbsoluteFsPath, FileSystem, isLocalRelativePath} from '../../../src/ngtsc/file_system';\n import {Logger} from '../../../src/ngtsc/logging';\n import {isDtsPath} from '../../../src/ngtsc/util/src/typescript';\n import {EntryPoint, EntryPointJsonProperty} from '../packages/entry_point';\n@@ -39,7 +39,7 @@ export class NewEntryPointFileWriter extends InPlaceFileWriter {\n       formatProperties: EntryPointJsonProperty[]) {\n     // The new folder is at the root of the overall package\n     const entryPoint = bundle.entryPoint;\n-    const ngccFolder = join(entryPoint.packagePath, NGCC_DIRECTORY);\n+    const ngccFolder = this.fs.join(entryPoint.packagePath, NGCC_DIRECTORY);\n     this.copyBundle(bundle, entryPoint.packagePath, ngccFolder);\n     transformedFiles.forEach(file => this.writeFile(file, entryPoint.packagePath, ngccFolder));\n     this.updatePackageJson(entryPoint, formatProperties, ngccFolder);\n@@ -69,11 +69,11 @@ export class NewEntryPointFileWriter extends InPlaceFileWriter {\n   protected copyBundle(\n       bundle: EntryPointBundle, packagePath: AbsoluteFsPath, ngccFolder: AbsoluteFsPath) {\n     bundle.src.program.getSourceFiles().forEach(sourceFile => {\n-      const relativePath = relative(packagePath, absoluteFromSourceFile(sourceFile));\n+      const relativePath = this.fs.relative(packagePath, absoluteFromSourceFile(sourceFile));\n       const isInsidePackage = isLocalRelativePath(relativePath);\n       if (!sourceFile.isDeclarationFile && isInsidePackage) {\n-        const newFilePath = resolve(ngccFolder, relativePath);\n-        this.fs.ensureDir(dirname(newFilePath));\n+        const newFilePath = this.fs.resolve(ngccFolder, relativePath);\n+        this.fs.ensureDir(this.fs.dirname(newFilePath));\n         this.fs.copyFile(absoluteFromSourceFile(sourceFile), newFilePath);\n       }\n     });\n@@ -85,9 +85,9 @@ export class NewEntryPointFileWriter extends InPlaceFileWriter {\n       // This is either `.d.ts` or `.d.ts.map` file\n       super.writeFileAndBackup(file);\n     } else {\n-      const relativePath = relative(packagePath, file.path);\n-      const newFilePath = resolve(ngccFolder, relativePath);\n-      this.fs.ensureDir(dirname(newFilePath));\n+      const relativePath = this.fs.relative(packagePath, file.path);\n+      const newFilePath = this.fs.resolve(ngccFolder, relativePath);\n+      this.fs.ensureDir(this.fs.dirname(newFilePath));\n       this.fs.writeFile(newFilePath, file.contents);\n     }\n   }\n@@ -97,8 +97,8 @@ export class NewEntryPointFileWriter extends InPlaceFileWriter {\n       // This is either `.d.ts` or `.d.ts.map` file\n       super.revertFileAndBackup(filePath);\n     } else if (this.fs.exists(filePath)) {\n-      const relativePath = relative(packagePath, filePath);\n-      const newFilePath = resolve(packagePath, NGCC_DIRECTORY, relativePath);\n+      const relativePath = this.fs.relative(packagePath, filePath);\n+      const newFilePath = this.fs.resolve(packagePath, NGCC_DIRECTORY, relativePath);\n       this.fs.removeFile(newFilePath);\n     }\n   }\n@@ -112,15 +112,15 @@ export class NewEntryPointFileWriter extends InPlaceFileWriter {\n     }\n \n     const packageJson = entryPoint.packageJson;\n-    const packageJsonPath = join(entryPoint.path, 'package.json');\n+    const packageJsonPath = this.fs.join(entryPoint.path, 'package.json');\n \n     // All format properties point to the same format-path.\n     const oldFormatProp = formatProperties[0]!;\n     const oldFormatPath = packageJson[oldFormatProp]!;\n-    const oldAbsFormatPath = resolve(entryPoint.path, oldFormatPath);\n+    const oldAbsFormatPath = this.fs.resolve(entryPoint.path, oldFormatPath);\n     const newAbsFormatPath =\n-        resolve(ngccFolder, relative(entryPoint.packagePath, oldAbsFormatPath));\n-    const newFormatPath = relative(entryPoint.path, newAbsFormatPath);\n+        this.fs.resolve(ngccFolder, this.fs.relative(entryPoint.packagePath, oldAbsFormatPath));\n+    const newFormatPath = this.fs.relative(entryPoint.path, newAbsFormatPath);\n \n     // Update all properties in `package.json` (both in memory and on disk).\n     const update = this.pkgJsonUpdater.createUpdate();\n@@ -146,7 +146,7 @@ export class NewEntryPointFileWriter extends InPlaceFileWriter {\n     }\n \n     const packageJson = entryPoint.packageJson;\n-    const packageJsonPath = join(entryPoint.path, 'package.json');\n+    const packageJsonPath = this.fs.join(entryPoint.path, 'package.json');\n \n     // Revert all properties in `package.json` (both in memory and on disk).\n     // Since `updatePackageJson()` only adds properties, it is safe to just remove them (if they"
        },
        {
            "sha": "d4b908bc0a236555b51101a2e2aa26e677a7e607",
            "filename": "packages/compiler-cli/ngcc/test/entry_point_finder/directory_walker_entry_point_finder_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Fdirectory_walker_entry_point_finder_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Fdirectory_walker_entry_point_finder_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Fdirectory_walker_entry_point_finder_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem, relative} from '../../../src/ngtsc/file_system';\n+import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem, TestFile} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n import {loadTestFiles} from '../../../src/ngtsc/testing';\n@@ -114,7 +114,7 @@ runInEachFileSystem(() => {\n         loadTestFiles(createPackage(basePath, 'some-package'));\n         spyOn(config, 'getPackageConfig')\n             .and.returnValue(\n-                new ProcessedNgccPackageConfig(_Abs('/project/node_modules/some-package'), {\n+                new ProcessedNgccPackageConfig(fs, _Abs('/project/node_modules/some-package'), {\n                   entryPoints: {\n                     '.': {ignore: true},\n                   },\n@@ -137,7 +137,7 @@ runInEachFileSystem(() => {\n         ]);\n         spyOn(config, 'getPackageConfig')\n             .and.returnValue(\n-                new ProcessedNgccPackageConfig(_Abs('/project/node_modules/some-package'), {\n+                new ProcessedNgccPackageConfig(fs, _Abs('/project/node_modules/some-package'), {\n                   entryPoints: {\n                     './sub-entry-point-1': {ignore: true},\n                   },\n@@ -457,7 +457,7 @@ runInEachFileSystem(() => {\n       function dumpEntryPointPaths(\n           basePath: AbsoluteFsPath, entryPoints: EntryPoint[]): [string, string][] {\n         return entryPoints.map(\n-            x => [relative(basePath, x.packagePath), relative(basePath, x.path)]);\n+            x => [fs.relative(basePath, x.packagePath), fs.relative(basePath, x.path)]);\n       }\n     });\n   });"
        },
        {
            "sha": "b38af49eb8ac022c04f67ff6c4876a37fe12ac4d",
            "filename": "packages/compiler-cli/ngcc/test/entry_point_finder/program_based_entry_point_finder_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Fprogram_based_entry_point_finder_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Fprogram_based_entry_point_finder_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Fprogram_based_entry_point_finder_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem, relative} from '../../../src/ngtsc/file_system';\n+import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem, TestFile} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n import {loadTestFiles} from '../../../src/ngtsc/testing';\n@@ -231,7 +231,7 @@ runInEachFileSystem(() => {\n       function dumpEntryPointPaths(\n           basePath: AbsoluteFsPath, entryPoints: EntryPoint[]): [string, string][] {\n         return entryPoints.map(\n-            x => [relative(basePath, x.packagePath), relative(basePath, x.path)]);\n+            x => [fs.relative(basePath, x.packagePath), fs.relative(basePath, x.path)]);\n       }\n     });\n   });"
        },
        {
            "sha": "d3433ff505b84d0322ee99d23d159d4d3e885381",
            "filename": "packages/compiler-cli/ngcc/test/entry_point_finder/targeted_entry_point_finder_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Ftargeted_entry_point_finder_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Ftargeted_entry_point_finder_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Ftargeted_entry_point_finder_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem, relative} from '../../../src/ngtsc/file_system';\n+import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem, TestFile} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n import {loadTestFiles} from '../../../src/ngtsc/testing';\n@@ -118,7 +118,7 @@ runInEachFileSystem(() => {\n         loadTestFiles(createPackage(basePath, 'some-package'));\n         spyOn(config, 'getPackageConfig')\n             .and.returnValue(\n-                new ProcessedNgccPackageConfig(_Abs('/project/node_modules/some-package'), {\n+                new ProcessedNgccPackageConfig(fs, _Abs('/project/node_modules/some-package'), {\n                   entryPoints: {\n                     '.': {ignore: true},\n                   },\n@@ -383,7 +383,7 @@ runInEachFileSystem(() => {\n       function dumpEntryPointPaths(\n           basePath: AbsoluteFsPath, entryPoints: EntryPoint[]): [string, string][] {\n         return entryPoints.map(\n-            x => [relative(basePath, x.packagePath), relative(basePath, x.path)]);\n+            x => [fs.relative(basePath, x.packagePath), fs.relative(basePath, x.path)]);\n       }\n     });\n \n@@ -419,7 +419,7 @@ runInEachFileSystem(() => {\n         loadTestFiles(createPackage(basePath, 'some-package'));\n         spyOn(config, 'getPackageConfig')\n             .and.returnValue(\n-                new ProcessedNgccPackageConfig(_Abs('/project/node_modules/some-package'), {\n+                new ProcessedNgccPackageConfig(fs, _Abs('/project/node_modules/some-package'), {\n                   entryPoints: {\n                     '.': {ignore: true},\n                   },"
        },
        {
            "sha": "ca3b483f767438dff99b5673b828cfb966ab8bbe",
            "filename": "packages/compiler-cli/ngcc/test/helpers/mock_lock_file.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhelpers%2Fmock_lock_file.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhelpers%2Fmock_lock_file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhelpers%2Fmock_lock_file.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,15 +5,15 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {FileSystem} from '../../../src/ngtsc/file_system';\n+import {PathManipulation} from '../../../src/ngtsc/file_system';\n import {LockFile} from '../../src/locking/lock_file';\n \n /**\n  * A mock implementation of `LockFile` that just logs its calls.\n  */\n export class MockLockFile implements LockFile {\n   constructor(\n-      fs: FileSystem, private log: string[] = [], public path = fs.resolve('/lockfile'),\n+      fs: PathManipulation, private log: string[] = [], public path = fs.resolve('/lockfile'),\n       private pid = '1234') {}\n   write() {\n     this.log.push('write()');"
        },
        {
            "sha": "624aa8b26d774481791fa02b10a3efc0c642c324",
            "filename": "packages/compiler-cli/ngcc/test/integration/ngcc_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -10,7 +10,7 @@\n import {readFileSync} from 'fs';\n import * as os from 'os';\n \n-import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem, join} from '../../../src/ngtsc/file_system';\n+import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem} from '../../../src/ngtsc/file_system';\n import {Folder, MockFileSystem, runInEachFileSystem, TestFile} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n import {loadStandardTestFiles, loadTestFiles} from '../../../src/ngtsc/testing';\n@@ -1017,7 +1017,7 @@ runInEachFileSystem(() => {\n \n     function markPropertiesAsProcessed(packagePath: string, properties: EntryPointJsonProperty[]) {\n       const basePath = _('/node_modules');\n-      const targetPackageJsonPath = join(basePath, packagePath, 'package.json');\n+      const targetPackageJsonPath = fs.join(basePath, packagePath, 'package.json');\n       const targetPackage = loadPackage(packagePath);\n       markAsProcessed(\n           pkgJsonUpdater, targetPackage, targetPackageJsonPath, ['typings', ...properties]);"
        },
        {
            "sha": "1e39b914d10e76329c4d7a6f6ad5514df6bd7aed",
            "filename": "packages/compiler-cli/ngcc/test/packages/configuration_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fconfiguration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fconfiguration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fconfiguration_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -7,15 +7,15 @@\n  */\n import {createHash} from 'crypto';\n \n-import {absoluteFrom, FileSystem, getFileSystem} from '../../../src/ngtsc/file_system';\n+import {absoluteFrom, getFileSystem, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem} from '../../../src/ngtsc/file_system/testing';\n import {loadTestFiles} from '../../../src/ngtsc/testing';\n import {DEFAULT_NGCC_CONFIG, NgccConfiguration, ProcessLockingConfiguration} from '../../src/packages/configuration';\n \n \n runInEachFileSystem(() => {\n   let _Abs: typeof absoluteFrom;\n-  let fs: FileSystem;\n+  let fs: ReadonlyFileSystem;\n \n   beforeEach(() => {\n     _Abs = absoluteFrom;"
        },
        {
            "sha": "29a3a9e9cc7aa60d9f80444768450b66ad80e7ee",
            "filename": "packages/compiler-cli/ngcc/test/packages/entry_point_manifest_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_manifest_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_manifest_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_manifest_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -225,7 +225,7 @@ runInEachFileSystem(() => {\n \n         spyOn(config, 'getPackageConfig')\n             .and.returnValue(\n-                new ProcessedNgccPackageConfig(_Abs('/project/node_modules/some_package'), {\n+                new ProcessedNgccPackageConfig(fs, _Abs('/project/node_modules/some_package'), {\n                   entryPoints: {\n                     './ignored_entry_point': {ignore: true},\n                   },"
        },
        {
            "sha": "9f5880264c0c09a9e1554f1e02c6c34aefc4042a",
            "filename": "packages/compiler-cli/ngcc/test/packages/entry_point_spec.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 24,
            "changes": 48,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem, join, relative} from '../../../src/ngtsc/file_system';\n+import {absoluteFrom, AbsoluteFsPath, getFileSystem, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n import {loadTestFiles} from '../../../src/ngtsc/testing';\n@@ -17,7 +17,7 @@ runInEachFileSystem(() => {\n   describe('getEntryPointInfo()', () => {\n     let SOME_PACKAGE: AbsoluteFsPath;\n     let _: typeof absoluteFrom;\n-    let fs: FileSystem;\n+    let fs: ReadonlyFileSystem;\n \n     beforeEach(() => {\n       _ = absoluteFrom;\n@@ -71,7 +71,7 @@ runInEachFileSystem(() => {\n       const config = new NgccConfiguration(fs, _('/project'));\n       spyOn(config, 'getPackageConfig')\n           .and.returnValue(new ProcessedNgccPackageConfig(\n-              _('/project/node_modules/some_package'),\n+              fs, _('/project/node_modules/some_package'),\n               {entryPoints: {'./valid_entry_point': {ignore: true}}}));\n       const entryPoint = getEntryPointInfo(\n           fs, config, new MockLogger(), SOME_PACKAGE,\n@@ -80,7 +80,7 @@ runInEachFileSystem(() => {\n     });\n \n     it('should retrieve the entry-point\\'s version from the package\\'s `package.json`', () => {\n-      const entryPointPath = join(SOME_PACKAGE, 'valid_entry_point');\n+      const entryPointPath = fs.join(SOME_PACKAGE, 'valid_entry_point');\n \n       loadTestFiles([\n         {\n@@ -102,15 +102,15 @@ runInEachFileSystem(() => {\n           `,\n         },\n         {\n-          name: join(SOME_PACKAGE, 'package.json'),\n+          name: fs.join(SOME_PACKAGE, 'package.json'),\n           contents: createPackageJson('', {version: '1.0.0'}),\n         },\n         {\n-          name: join(entryPointPath, 'package.json'),\n+          name: fs.join(entryPointPath, 'package.json'),\n           contents: createPackageJson('valid_entry_point', {version: '2.0.0'}),\n         },\n         {\n-          name: join(entryPointPath, 'valid_entry_point.metadata.json'),\n+          name: fs.join(entryPointPath, 'valid_entry_point.metadata.json'),\n           contents: 'some meta data',\n         },\n       ]);\n@@ -123,7 +123,7 @@ runInEachFileSystem(() => {\n     });\n \n     it('should use `null` for version if it cannot be retrieved from a `package.json`', () => {\n-      const entryPointPath = join(SOME_PACKAGE, 'valid_entry_point');\n+      const entryPointPath = fs.join(SOME_PACKAGE, 'valid_entry_point');\n \n       loadTestFiles([\n         {\n@@ -145,15 +145,15 @@ runInEachFileSystem(() => {\n           `,\n         },\n         {\n-          name: join(SOME_PACKAGE, 'package.json'),\n+          name: fs.join(SOME_PACKAGE, 'package.json'),\n           contents: createPackageJson(''),\n         },\n         {\n-          name: join(entryPointPath, 'package.json'),\n+          name: fs.join(entryPointPath, 'package.json'),\n           contents: createPackageJson('valid_entry_point'),\n         },\n         {\n-          name: join(entryPointPath, 'valid_entry_point.metadata.json'),\n+          name: fs.join(entryPointPath, 'valid_entry_point.metadata.json'),\n           contents: 'some meta data',\n         },\n       ]);\n@@ -184,7 +184,7 @@ runInEachFileSystem(() => {\n       };\n       spyOn(config, 'getPackageConfig')\n           .and.returnValue(new ProcessedNgccPackageConfig(\n-              _('/project/node_modules/some_package'),\n+              fs, _('/project/node_modules/some_package'),\n               {entryPoints: {'./valid_entry_point': {override}}}));\n       const entryPoint = getEntryPointInfo(\n           fs, config, new MockLogger(), SOME_PACKAGE,\n@@ -236,7 +236,7 @@ runInEachFileSystem(() => {\n              JSON.parse(createPackageJson('missing_package_json', {excludes: ['name']}));\n          spyOn(config, 'getPackageConfig')\n              .and.returnValue(new ProcessedNgccPackageConfig(\n-                 _('/project/node_modules/some_package/'),\n+                 fs, _('/project/node_modules/some_package/'),\n                  {entryPoints: {'./missing_package_json': {override}}}));\n          const entryPoint = getEntryPointInfo(\n              fs, config, new MockLogger(), SOME_PACKAGE,\n@@ -273,7 +273,7 @@ runInEachFileSystem(() => {\n             // Ensure a `package.json` exists for the entry-point (containing `entryPointName`).\n             loadTestFiles([\n               {\n-                name: join(entryPointPath, 'package.json'),\n+                name: fs.join(entryPointPath, 'package.json'),\n                 contents: JSON.stringify({name: entryPointName, typings: './index.d.ts'}),\n               },\n             ]);\n@@ -284,11 +284,11 @@ runInEachFileSystem(() => {\n             // avoid returning `INCOMPATIBLE_ENTRY_POINT` (since there is no `package.json`).\n             loadTestFiles([\n               {\n-                name: join(packagePath, 'ngcc.config.js'),\n+                name: fs.join(packagePath, 'ngcc.config.js'),\n                 contents: `\n                   module.exports = {\n                     entryPoints: {\n-                      '${relative(packagePath, entryPointPath)}': {\n+                      '${fs.relative(packagePath, entryPointPath)}': {\n                         override: {typings: './index.d.ts'},\n                       },\n                     },\n@@ -321,7 +321,7 @@ runInEachFileSystem(() => {\n \n         it('for a secondary entry-point with a `package.json`', () => {\n           const packagePath = _(`/project/node_modules/${nameWithScope('on-disk-package-name')}`);\n-          const entryPointPath = join(packagePath, 'some-entry-point');\n+          const entryPointPath = fs.join(packagePath, 'some-entry-point');\n           const expectedPackageName = nameWithScope('package-json-package-name');\n \n           setUpPackageWithEntryPointPackageJson(\n@@ -332,7 +332,7 @@ runInEachFileSystem(() => {\n \n         it('for a secondary entry-point without a `package.json`', () => {\n           const packagePath = _(`/project/node_modules/${nameWithScope('on-disk-package-name')}`);\n-          const entryPointPath = join(packagePath, 'some-entry-point');\n+          const entryPointPath = fs.join(packagePath, 'some-entry-point');\n           const expectedPackageName = nameWithScope('on-disk-package-name');\n \n           setUpPackageWithoutEntryPointPackageJson(packagePath, entryPointPath);\n@@ -354,7 +354,7 @@ runInEachFileSystem(() => {\n         it('for a secondary entry-point without a `package.json` in nested `node_modules/`', () => {\n           const packagePath = _(`/project/node_modules/other-package/node_modules/${\n               nameWithScope('on-disk-package-name')}`);\n-          const entryPointPath = join(packagePath, 'some-entry-point');\n+          const entryPointPath = fs.join(packagePath, 'some-entry-point');\n           const expectedPackageName = nameWithScope('on-disk-package-name');\n \n           setUpPackageWithoutEntryPointPackageJson(packagePath, entryPointPath);\n@@ -384,7 +384,7 @@ runInEachFileSystem(() => {\n \n         it('for a secondary entry-point with a `package.json` outside `node_modules/`', () => {\n           const packagePath = _(`/project/libs/${nameWithScope('on-disk-package-name')}`);\n-          const entryPointPath = join(packagePath, 'some-entry-point');\n+          const entryPointPath = fs.join(packagePath, 'some-entry-point');\n           const expectedPackageName = nameWithScope('package-json-package-name');\n \n           setUpPackageWithEntryPointPackageJson(expectedPackageName, entryPointPath);\n@@ -394,7 +394,7 @@ runInEachFileSystem(() => {\n \n         it('for a secondary entry-point without a `package.json` outside `node_modules/`', () => {\n           const packagePath = _(`/project/libs/${nameWithScope('on-disk-package-name')}`);\n-          const entryPointPath = join(packagePath, 'some-entry-point');\n+          const entryPointPath = fs.join(packagePath, 'some-entry-point');\n           const expectedPackageName = nameWithScope('on-disk-package-name');\n \n           setUpPackageWithoutEntryPointPackageJson(packagePath, entryPointPath);\n@@ -522,7 +522,7 @@ runInEachFileSystem(() => {\n          const config = new NgccConfiguration(fs, _('/project'));\n          spyOn(config, 'getPackageConfig')\n              .and.returnValue(new ProcessedNgccPackageConfig(\n-                 _('/project/node_modules/some_package'),\n+                 fs, _('/project/node_modules/some_package'),\n                  {entryPoints: {'./missing_metadata': {}}}));\n          const entryPoint = getEntryPointInfo(\n              fs, config, new MockLogger(), SOME_PACKAGE,\n@@ -626,7 +626,7 @@ runInEachFileSystem(() => {\n   describe('getEntryPointFormat()', () => {\n     let SOME_PACKAGE: AbsoluteFsPath;\n     let _: typeof absoluteFrom;\n-    let fs: FileSystem;\n+    let fs: ReadonlyFileSystem;\n     let entryPoint: EntryPoint;\n \n     beforeEach(() => {\n@@ -781,6 +781,6 @@ export function createPackageJson(\n   return JSON.stringify(packageJson);\n }\n \n-export function loadPackageJson(fs: FileSystem, packagePath: string) {\n+export function loadPackageJson(fs: ReadonlyFileSystem, packagePath: string) {\n   return JSON.parse(fs.readFile(fs.resolve(packagePath + '/package.json')));\n }"
        },
        {
            "sha": "423a3ec6738054f7d32fff9e74694a5bfa268316",
            "filename": "packages/compiler-cli/ngcc/test/rendering/commonjs_rendering_formatter_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fcommonjs_rendering_formatter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fcommonjs_rendering_formatter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fcommonjs_rendering_formatter_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -157,7 +157,7 @@ exports.D = D;\n           new DecorationAnalyzer(fs, bundle, host, referencesRegistry).analyzeProgram();\n       const switchMarkerAnalyses = new SwitchMarkerAnalyzer(host, bundle.entryPoint.packagePath)\n                                        .analyzeProgram(bundle.src.program);\n-      const renderer = new CommonJsRenderingFormatter(host, false);\n+      const renderer = new CommonJsRenderingFormatter(fs, host, false);\n       const importManager = new ImportManager(new NoopImportRewriter(), 'i');\n       return {\n         host,"
        },
        {
            "sha": "4c82098f014976af2bf344de058eb0070b0abb32",
            "filename": "packages/compiler-cli/ngcc/test/rendering/esm5_rendering_formatter_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fesm5_rendering_formatter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fesm5_rendering_formatter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fesm5_rendering_formatter_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -34,7 +34,7 @@ function setup(file: {name: AbsoluteFsPath, contents: string}) {\n       new DecorationAnalyzer(fs, bundle, host, referencesRegistry).analyzeProgram();\n   const switchMarkerAnalyses = new SwitchMarkerAnalyzer(host, bundle.entryPoint.packagePath)\n                                    .analyzeProgram(bundle.src.program);\n-  const renderer = new Esm5RenderingFormatter(host, false);\n+  const renderer = new Esm5RenderingFormatter(fs, host, false);\n   const importManager = new ImportManager(new NoopImportRewriter(), IMPORT_PREFIX);\n   return {\n     host,"
        },
        {
            "sha": "eae5f15d9ef9c3499c2889bf176231c163922a76",
            "filename": "packages/compiler-cli/ngcc/test/rendering/esm_rendering_formatter_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fesm_rendering_formatter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fesm_rendering_formatter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fesm_rendering_formatter_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -40,7 +40,7 @@ function setup(files: TestFile[], dtsFiles?: TestFile[]) {\n       new DecorationAnalyzer(fs, bundle, host, referencesRegistry).analyzeProgram();\n   const switchMarkerAnalyses = new SwitchMarkerAnalyzer(host, bundle.entryPoint.packagePath)\n                                    .analyzeProgram(bundle.src.program);\n-  const renderer = new EsmRenderingFormatter(host, false);\n+  const renderer = new EsmRenderingFormatter(fs, host, false);\n   const importManager = new ImportManager(new NoopImportRewriter(), IMPORT_PREFIX);\n   return {\n     host,"
        },
        {
            "sha": "b1a6e2ca362de7df9515532d8bc47506769b3480",
            "filename": "packages/compiler-cli/ngcc/test/rendering/umd_rendering_formatter_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fumd_rendering_formatter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fumd_rendering_formatter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Fumd_rendering_formatter_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -34,7 +34,7 @@ function setup(file: TestFile) {\n       new DecorationAnalyzer(fs, bundle, host, referencesRegistry).analyzeProgram();\n   const switchMarkerAnalyses =\n       new SwitchMarkerAnalyzer(host, bundle.entryPoint.packagePath).analyzeProgram(src.program);\n-  const renderer = new UmdRenderingFormatter(host, false);\n+  const renderer = new UmdRenderingFormatter(fs, host, false);\n   const importManager = new ImportManager(new NoopImportRewriter(), 'i');\n   return {\n     decorationAnalyses,"
        },
        {
            "sha": "83d03feb9f6619519f71d694f5b166c338ffd1e7",
            "filename": "packages/compiler-cli/ngcc/test/writing/new_entry_point_file_writer_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fnew_entry_point_file_writer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fnew_entry_point_file_writer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fnew_entry_point_file_writer_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFrom, FileSystem, getFileSystem, join} from '../../../src/ngtsc/file_system';\n+import {absoluteFrom, FileSystem, getFileSystem} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n import {loadTestFiles} from '../../../src/ngtsc/testing';\n@@ -578,7 +578,7 @@ runInEachFileSystem(() => {\n \n       it('should revert changes to `package.json`', () => {\n         const entryPoint = esm5bundle.entryPoint;\n-        const packageJsonPath = join(entryPoint.packagePath, 'package.json');\n+        const packageJsonPath = fs.join(entryPoint.packagePath, 'package.json');\n \n         fileWriter.writeBundle(\n             esm5bundle,"
        },
        {
            "sha": "21f92b593577685504f5c73200df8492d97a4195",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/component.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -10,8 +10,8 @@ import {compileComponentFromMetadata, compileDeclareComponentFromMetadata, Const\n import * as ts from 'typescript';\n \n import {CycleAnalyzer} from '../../cycles';\n-import {ErrorCode, FatalDiagnosticError, ngErrorCode} from '../../diagnostics';\n-import {absoluteFrom, relative, resolve} from '../../file_system';\n+import {ErrorCode, FatalDiagnosticError} from '../../diagnostics';\n+import {absoluteFrom, relative} from '../../file_system';\n import {DefaultImportRecorder, ModuleResolver, Reference, ReferenceEmitter} from '../../imports';\n import {DependencyTracker} from '../../incremental/api';\n import {IndexingContext} from '../../indexer';\n@@ -21,7 +21,6 @@ import {ClassDeclaration, DeclarationNode, Decorator, ReflectionHost, reflectObj\n import {ComponentScopeReader, LocalModuleScopeRegistry, TypeCheckScopeRegistry} from '../../scope';\n import {AnalysisOutput, CompileResult, DecoratorHandler, DetectResult, HandlerFlags, HandlerPrecedence, ResolveResult} from '../../transform';\n import {TemplateSourceMapping, TypeCheckContext} from '../../typecheck/api';\n-import {getTemplateId, makeTemplateDiagnostic} from '../../typecheck/diagnostics';\n import {tsSourceMapBug29300Fixed} from '../../util/src/ts_source_map_bug_29300';\n import {SubsetOfKeys} from '../../util/src/typescript';\n "
        },
        {
            "sha": "09f602c6d1240051f86d11b1144afbcaa6a01d77",
            "filename": "packages/compiler-cli/src/ngtsc/cycles/test/util.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcycles%2Ftest%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcycles%2Ftest%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcycles%2Ftest%2Futil.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import * as ts from 'typescript';\n-import {FileSystem} from '../../file_system';\n+import {PathManipulation} from '../../file_system';\n import {TestFile} from '../../file_system/testing';\n import {makeProgram} from '../../testing';\n \n@@ -31,7 +31,7 @@ import {makeProgram} from '../../testing';\n  *\n  * represents a program where a.ts exports from b.ts and imports from c.ts.\n  */\n-export function makeProgramFromGraph(fs: FileSystem, graph: string): {\n+export function makeProgramFromGraph(fs: PathManipulation, graph: string): {\n   program: ts.Program,\n   host: ts.CompilerHost,\n   options: ts.CompilerOptions,"
        },
        {
            "sha": "8b41354b0fd15c3a2b0e4bba615f6e17202f7247",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/src/source_file.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -8,7 +8,7 @@\n import {removeComments, removeMapFileComments} from 'convert-source-map';\n import {decode, encode, SourceMapMappings, SourceMapSegment} from 'sourcemap-codec';\n \n-import {AbsoluteFsPath, FileSystem} from '../../file_system';\n+import {AbsoluteFsPath, PathManipulation} from '../../file_system';\n \n import {RawSourceMap} from './raw_source_map';\n import {compareSegments, offsetSegment, SegmentMarker} from './segment_marker';\n@@ -39,7 +39,7 @@ export class SourceFile {\n       readonly inline: boolean,\n       /** Any source files referenced by the raw source map associated with this source file. */\n       readonly sources: (SourceFile|null)[],\n-      private fs: FileSystem,\n+      private fs: PathManipulation,\n   ) {\n     this.contents = removeSourceMapComments(contents);\n     this.startOfLinePositions = computeStartOfLinePositions(this.contents);"
        },
        {
            "sha": "1a3c01cb977c70da8816d428a601847d6b33b2a3",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/src/source_file_loader.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file_loader.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file_loader.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file_loader.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -7,7 +7,7 @@\n  */\n import {commentRegex, fromComment, mapFileCommentRegex} from 'convert-source-map';\n \n-import {AbsoluteFsPath, FileSystem} from '../../file_system';\n+import {AbsoluteFsPath, ReadonlyFileSystem} from '../../file_system';\n import {Logger} from '../../logging';\n \n import {RawSourceMap} from './raw_source_map';\n@@ -28,7 +28,7 @@ export class SourceFileLoader {\n   private currentPaths: AbsoluteFsPath[] = [];\n \n   constructor(\n-      private fs: FileSystem, private logger: Logger,\n+      private fs: ReadonlyFileSystem, private logger: Logger,\n       /** A map of URL schemes to base paths. The scheme name should be lowercase. */\n       private schemeMap: Record<string, AbsoluteFsPath>) {}\n "
        },
        {
            "sha": "acd7f1eceb99d6991253ae80c2803eab87070261",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/test/source_file_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2Fsource_file_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2Fsource_file_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Ftest%2Fsource_file_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -7,15 +7,15 @@\n  */\n import {encode} from 'sourcemap-codec';\n \n-import {absoluteFrom, FileSystem, getFileSystem} from '../../file_system';\n+import {absoluteFrom, getFileSystem, PathManipulation} from '../../file_system';\n import {runInEachFileSystem} from '../../file_system/testing';\n import {RawSourceMap} from '../src/raw_source_map';\n import {SegmentMarker} from '../src/segment_marker';\n import {computeStartOfLinePositions, ensureOriginalSegmentLinks, extractOriginalSegments, findLastMappingIndexBefore, Mapping, parseMappings, SourceFile} from '../src/source_file';\n \n runInEachFileSystem(() => {\n   describe('SourceFile and utilities', () => {\n-    let fs: FileSystem;\n+    let fs: PathManipulation;\n     let _: typeof absoluteFrom;\n \n     beforeEach(() => {"
        },
        {
            "sha": "63c86058b4240053e831184c91694b5153606bae",
            "filename": "packages/compiler-cli/src/ngtsc/testing/src/mock_file_loading.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Fsrc%2Fmock_file_loading.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Fsrc%2Fmock_file_loading.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Fsrc%2Fmock_file_loading.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -109,6 +109,11 @@ function loadAngularFolder(): Folder {\n \n /**\n  * Load real files from the real file-system into a mock file-system.\n+ *\n+ * Note that this function contains a mix of `FileSystem` calls and NodeJS `fs` calls.\n+ * This is because the function is a bridge between the \"real\" file-system (via `fs`) and the \"mock\"\n+ * file-system (via `FileSystem`).\n+ *\n  * @param fs the file-system where the directory is to be loaded.\n  * @param directoryPath the path to the directory we want to load.\n  * @param mockPath the path within the mock file-system where the directory is to be loaded."
        },
        {
            "sha": "d92b574017db1eacbf93c0c214beb252e8385d4e",
            "filename": "packages/compiler-cli/src/perform_compile.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fperform_compile.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Fsrc%2Fperform_compile.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fperform_compile.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -9,7 +9,7 @@\n import {isSyntaxError, Position} from '@angular/compiler';\n import * as ts from 'typescript';\n \n-import {absoluteFrom, AbsoluteFsPath, FileSystem, getFileSystem, relative, resolve} from '../src/ngtsc/file_system';\n+import {absoluteFrom, AbsoluteFsPath, getFileSystem, ReadonlyFileSystem, relative, resolve} from '../src/ngtsc/file_system';\n \n import {replaceTsWithNgInErrors} from './ngtsc/diagnostics';\n import * as api from './transformers/api';\n@@ -109,10 +109,8 @@ export function formatDiagnostics(\n }\n \n /** Used to read configuration files. */\n-// TODO(ayazhafiz): split FileSystem into a ReadonlyFileSystem and make this a\n-// subset of that.\n-export type ConfigurationHost =\n-    Pick<FileSystem, 'readFile'|'exists'|'lstat'|'resolve'|'join'|'dirname'|'extname'|'pwd'>;\n+export type ConfigurationHost = Pick<\n+    ReadonlyFileSystem, 'readFile'|'exists'|'lstat'|'resolve'|'join'|'dirname'|'extname'|'pwd'>;\n \n export interface ParsedConfiguration {\n   project: string;"
        },
        {
            "sha": "40bf25cd6025456d0ade2ad32b3a88ea6585f937",
            "filename": "packages/compiler-cli/test/compliance/test_helpers/check_expectations.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fcheck_expectations.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fcheck_expectations.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fcheck_expectations.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {FileSystem} from '../../../src/ngtsc/file_system';\n+import {ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n \n import {getBuildOutputDirectory, getRootDirectory} from './compile_test';\n import {verifyUniqueFactory} from './di_checks';\n@@ -33,7 +33,7 @@ const EXTRA_CHECK_FUNCTIONS: Record<string, ExtraCheckFunction> = {\n  * @param expectedFiles The list of expected-generated pairs to compare.\n  */\n export function checkExpectations(\n-    fs: FileSystem, testPath: string, failureMessage: string, expectedFiles: ExpectedFile[],\n+    fs: ReadonlyFileSystem, testPath: string, failureMessage: string, expectedFiles: ExpectedFile[],\n     extraChecks: ExtraCheck[]): void {\n   const builtDirectory = getBuildOutputDirectory(fs);\n   for (const expectedFile of expectedFiles) {"
        },
        {
            "sha": "70eda234f5c747e9a19dafd3175bd29df591da68",
            "filename": "packages/compiler-cli/test/compliance/test_helpers/compile_test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fcompile_test.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fcompile_test.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fcompile_test.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -7,7 +7,7 @@\n  */\n import * as ts from 'typescript';\n \n-import {AbsoluteFsPath, FileSystem} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, FileSystem, PathManipulation, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {initMockFileSystem} from '../../../src/ngtsc/file_system/testing';\n import {loadStandardTestFiles, loadTestDirectory, NgtscTestCompilerHost} from '../../../src/ngtsc/testing';\n import {Diagnostics, performCompilation} from '../../../src/perform_compile';\n@@ -65,7 +65,7 @@ export function compileTest(\n  *\n  * @param fs the mock file-system where the compilation is happening.\n  */\n-export function getRootDirectory(fs: FileSystem): AbsoluteFsPath {\n+export function getRootDirectory(fs: PathManipulation): AbsoluteFsPath {\n   return fs.resolve('/');\n }\n \n@@ -75,7 +75,7 @@ export function getRootDirectory(fs: FileSystem): AbsoluteFsPath {\n  *\n  * @param fs the mock file-system where the compilation is happening.\n  */\n-export function getBuildOutputDirectory(fs: FileSystem): AbsoluteFsPath {\n+export function getBuildOutputDirectory(fs: PathManipulation): AbsoluteFsPath {\n   return fs.resolve('/built');\n }\n \n@@ -129,7 +129,7 @@ function getOptions(\n  * This allows us to simulate, more reliably, files that have `\\r\\n` line-endings.\n  * (See `test_cases/r3_view_compiler_i18n/line_ending_normalization/template.html`.)\n  */\n-function monkeyPatchReadFile(fs: FileSystem): void {\n+function monkeyPatchReadFile(fs: ReadonlyFileSystem): void {\n   const originalReadFile = fs.readFile;\n   fs.readFile = (path: AbsoluteFsPath): string => {\n     const file = originalReadFile.call(fs, path);"
        },
        {
            "sha": "9c3d98276fc793a1dcd195ab376ce2e38faf34ca",
            "filename": "packages/compiler-cli/test/compliance/test_helpers/get_compliance_tests.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fget_compliance_tests.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fget_compliance_tests.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fget_compliance_tests.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem, NodeJSFileSystem, PathSegment} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, NodeJSFileSystem, PathSegment, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n \n const fs = new NodeJSFileSystem();\n const basePath = fs.resolve(__dirname, '../test_cases');\n@@ -55,7 +55,7 @@ export function* getComplianceTests(testConfigPath: string): Generator<Complianc\n }\n \n function loadTestCasesFile(\n-    fs: FileSystem, testCasesPath: AbsoluteFsPath, basePath: AbsoluteFsPath): any {\n+    fs: ReadonlyFileSystem, testCasesPath: AbsoluteFsPath, basePath: AbsoluteFsPath): any {\n   try {\n     return JSON.parse(fs.readFile(testCasesPath));\n   } catch (e) {"
        },
        {
            "sha": "3b3ec9141261e99a86bc9c7525d756b26de1c375",
            "filename": "packages/compiler-cli/test/compliance/test_helpers/sourcemap_helpers.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fsourcemap_helpers.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fsourcemap_helpers.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fsourcemap_helpers.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem} from '../../../src/ngtsc/file_system';\n+import {AbsoluteFsPath, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {ConsoleLogger, LogLevel} from '../../../src/ngtsc/logging';\n import {SourceFileLoader} from '../../../src/ngtsc/sourcemaps';\n \n@@ -33,8 +33,8 @@ import {SourceFileLoader} from '../../../src/ngtsc/sourcemaps';\n  * @returns The content of the expected source file, stripped of the mapping information.\n  */\n export function checkMappings(\n-    fs: FileSystem, generated: string, generatedPath: AbsoluteFsPath, expectedSource: string,\n-    expectedPath: AbsoluteFsPath): string {\n+    fs: ReadonlyFileSystem, generated: string, generatedPath: AbsoluteFsPath,\n+    expectedSource: string, expectedPath: AbsoluteFsPath): string {\n   const actualMappings = getMappedSegments(fs, generatedPath, generated);\n \n   const {expected, mappings} = extractMappings(fs, expectedSource);\n@@ -77,7 +77,7 @@ interface SegmentMapping {\n  * @param expected The content of the expected file containing source-map information.\n  */\n function extractMappings(\n-    fs: FileSystem, expected: string): {expected: string, mappings: SegmentMapping[]} {\n+    fs: ReadonlyFileSystem, expected: string): {expected: string, mappings: SegmentMapping[]} {\n   const mappings: SegmentMapping[] = [];\n   // capture and remove source mapping info\n   expected = expected.replace(\n@@ -113,7 +113,8 @@ function unescape(str: string): string {\n  *     empty array is returned if there is no source-map file found.\n  */\n function getMappedSegments(\n-    fs: FileSystem, generatedPath: AbsoluteFsPath, generatedContents: string): SegmentMapping[] {\n+    fs: ReadonlyFileSystem, generatedPath: AbsoluteFsPath,\n+    generatedContents: string): SegmentMapping[] {\n   const logger = new ConsoleLogger(LogLevel.debug);\n   const loader = new SourceFileLoader(fs, logger, {});\n   const generatedFile = loader.loadSourceFile(generatedPath, generatedContents);"
        },
        {
            "sha": "d6734a46e353356b7695d0ae2e2721b8e6091de6",
            "filename": "packages/compiler-cli/test/ngtsc/component_indexing_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fcomponent_indexing_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d100a15998155bf4b882471d3747df877d8b2b5f/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fcomponent_indexing_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fcomponent_indexing_spec.ts?ref=d100a15998155bf4b882471d3747df877d8b2b5f",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, resolve} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {AbsoluteFsPath, getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import {AbsoluteSourceSpan, IdentifierKind, IndexedComponent, TopLevelIdentifier} from '@angular/compiler-cli/src/ngtsc/indexer';\n import {ParseSourceFile} from '@angular/compiler/src/compiler';\n@@ -14,15 +14,17 @@ import {NgtscTestEnvironment} from './env';\n \n runInEachFileSystem(() => {\n   describe('ngtsc component indexing', () => {\n+    let fs: PathManipulation;\n     let env!: NgtscTestEnvironment;\n     let testSourceFile: AbsoluteFsPath;\n     let testTemplateFile: AbsoluteFsPath;\n \n     beforeEach(() => {\n       env = NgtscTestEnvironment.setup();\n       env.tsconfig();\n-      testSourceFile = resolve(env.basePath, 'test.ts');\n-      testTemplateFile = resolve(env.basePath, 'test.html');\n+      fs = getFileSystem();\n+      testSourceFile = fs.resolve(env.basePath, 'test.ts');\n+      testTemplateFile = fs.resolve(env.basePath, 'test.html');\n     });\n \n     describe('indexing metadata', () => {"
        }
    ],
    "stats": {
        "total": 557,
        "additions": 285,
        "deletions": 272
    }
}