{
    "author": "gkalpak",
    "message": "build(docs-infra): remove boilerplate file listings in `example-boilerplate.js` (#38173)\n\nTo avoid unnecessary code duplication in docs examples, we have some\nboilerplate files for various example types (in\n`aio/tools/examples/shared/boilerplate/`). These files are copied to\neach example project in `aio/content/examples/` (according to the\nexample's type, as specified in its `example-config.json` file).\n\nPreviously, the `example-boilerplate.js`, which is responsible for\ncopying the boilerplate files, had lists for files to be copied for each\nproject type and only copied the listed files from the boilerplate\ndirectory to the example directory. This approach had some drawbacks:\n- Files need to be updated in two separate locations: in the boilerplate\n  directory that includes the files and the file list in\n  `example-boilerplate.js`.\n- It is easy to add a file in the boilerplate directory but forget to\n  add it in `example-boilerplate.js` and not realize that it is not\n  being included in the example project (including the generated\n  StackBlitz project and ZIP archive).\n\nThis commit changes the approach by removing the boilerplate file\nlistings from `example-boilerplate.js` and copying all files from a\nboilerplate directory to example directories. This addresses the above\ndrawbacks and simplifies the `example-boilerplate.js` script.\n\nI have verified that the resulting code example doc regions as well as\nthe generated StackBlitz projects and ZIP archives are identical to the\nones generated before this commit.\n\nPR Close #38173",
    "sha": "5a733629b531083fd35563ee5bc286a8954da5fc",
    "files": [
        {
            "sha": "bc1c9396564262de74076da00fff5381bfe19662",
            "filename": "aio/tools/examples/example-boilerplate.js",
            "status": "modified",
            "additions": 38,
            "deletions": 82,
            "changes": 120,
            "blob_url": "https://github.com/angular/angular/blob/5a733629b531083fd35563ee5bc286a8954da5fc/aio%2Ftools%2Fexamples%2Fexample-boilerplate.js",
            "raw_url": "https://github.com/angular/angular/raw/5a733629b531083fd35563ee5bc286a8954da5fc/aio%2Ftools%2Fexamples%2Fexample-boilerplate.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2Fexample-boilerplate.js?ref=5a733629b531083fd35563ee5bc286a8954da5fc",
            "patch": "@@ -6,65 +6,13 @@ const yargs = require('yargs');\n \n const SHARED_PATH = path.resolve(__dirname, 'shared');\n const SHARED_NODE_MODULES_PATH = path.resolve(SHARED_PATH, 'node_modules');\n-const BOILERPLATE_BASE_PATH = path.resolve(SHARED_PATH, 'boilerplate');\n-const BOILERPLATE_COMMON_BASE_PATH = path.resolve(BOILERPLATE_BASE_PATH, 'common');\n-const EXAMPLES_BASE_PATH = path.resolve(__dirname, '../../content/examples');\n \n-const BOILERPLATE_PATHS = {\n-  cli: [\n-    'src/environments/environment.prod.ts', 'src/environments/environment.ts',\n-    'src/assets/.gitkeep', 'browserslist', 'src/favicon.ico', 'karma.conf.js',\n-    'src/polyfills.ts', 'src/test.ts', 'tsconfig.app.json', 'tsconfig.spec.json',\n-    'tslint.json', 'e2e/src/app.po.ts', 'e2e/protractor-puppeteer.conf.js',\n-    'e2e/protractor.conf.js', 'e2e/tsconfig.json', '.editorconfig', '.gitignore', 'angular.json',\n-    'package.json', 'tsconfig.json', 'tslint.json'\n-  ],\n-  systemjs: [\n-    'src/systemjs-angular-loader.js', 'src/systemjs.config.js', 'src/tsconfig.json',\n-    'bs-config.json', 'bs-config.e2e.json', 'package.json', 'tslint.json'\n-  ],\n-  common: ['src/styles.css']\n-};\n-\n-// All paths in this tool are relative to the current boilerplate folder, i.e boilerplate/i18n\n-// This maps the CLI files that exists in a parent folder\n-const cliRelativePath = BOILERPLATE_PATHS.cli.map(file => `../cli/${file}`);\n-\n-BOILERPLATE_PATHS.elements = [...cliRelativePath, 'package.json', 'src/polyfills.ts'];\n-\n-BOILERPLATE_PATHS.i18n = [...cliRelativePath, 'angular.json', 'package.json', 'src/polyfills.ts'];\n-\n-BOILERPLATE_PATHS['service-worker'] = [...cliRelativePath, 'angular.json', 'package.json'];\n-\n-BOILERPLATE_PATHS.testing = [\n-  ...cliRelativePath,\n-  'angular.json',\n-  'tsconfig.app.json',\n-  'tsconfig.spec.json'\n-];\n-\n-BOILERPLATE_PATHS.universal = [...cliRelativePath, 'angular.json', 'package.json'];\n-\n-BOILERPLATE_PATHS['getting-started'] = [\n-  ...cliRelativePath,\n-  'src/styles.css'\n-];\n-\n-BOILERPLATE_PATHS.schematics = [\n-  ...cliRelativePath,\n-  'angular.json'\n-];\n-\n-BOILERPLATE_PATHS['cli-ajs'] = [\n-  ...cliRelativePath,\n-  'package.json'\n-];\n-\n-BOILERPLATE_PATHS.viewengine = {\n-  systemjs: ['rollup-config.js', 'tsconfig-aot.json'],\n-  cli: ['tsconfig.json']\n-};\n+const BOILERPLATE_BASE_PATH = path.resolve(SHARED_PATH, 'boilerplate');\n+const BOILERPLATE_CLI_PATH = path.resolve(BOILERPLATE_BASE_PATH, 'cli');\n+const BOILERPLATE_COMMON_PATH = path.resolve(BOILERPLATE_BASE_PATH, 'common');\n+const BOILERPLATE_VIEWENGINE_PATH = path.resolve(BOILERPLATE_BASE_PATH, 'viewengine');\n \n+const EXAMPLES_BASE_PATH = path.resolve(__dirname, '../../content/examples');\n const EXAMPLE_CONFIG_FILENAME = 'example-config.json';\n \n class ExampleBoilerPlate {\n@@ -96,24 +44,26 @@ class ExampleBoilerPlate {\n       const boilerPlateType = exampleConfig.projectType || 'cli';\n       const boilerPlateBasePath = path.resolve(BOILERPLATE_BASE_PATH, boilerPlateType);\n \n-      // Copy the boilerplate specific files\n-      BOILERPLATE_PATHS[boilerPlateType].forEach(\n-          filePath => this.copyFile(boilerPlateBasePath, exampleFolder, filePath));\n+      // All example types other than `cli` and `systemjs` are based on `cli`. Copy over the `cli`\n+      // boilerplate files first.\n+      // (Some of these files might be later overwritten by type-specific files.)\n+      if (boilerPlateType !== 'cli' && boilerPlateType !== 'systemjs') {\n+        this.copyDirectoryContents(BOILERPLATE_CLI_PATH, exampleFolder);\n+      }\n \n-      // Copy the boilerplate common files\n-      const useCommonBoilerplate = exampleConfig.useCommonBoilerplate !== false;\n+      // Copy the type-specific boilerplate files.\n+      this.copyDirectoryContents(boilerPlateBasePath, exampleFolder);\n \n-      if (useCommonBoilerplate) {\n-        BOILERPLATE_PATHS.common.forEach(filePath => this.copyFile(BOILERPLATE_COMMON_BASE_PATH, exampleFolder, filePath));\n+      // Copy the common boilerplate files (unless explicitly not used).\n+      if (exampleConfig.useCommonBoilerplate !== false) {\n+        this.copyDirectoryContents(BOILERPLATE_COMMON_PATH, exampleFolder);\n       }\n \n       // Copy ViewEngine (pre-Ivy) specific files\n       if (viewengine) {\n         const veBoilerPlateType = boilerPlateType === 'systemjs' ? 'systemjs' : 'cli';\n-        const veBoilerPlateBasePath =\n-            path.resolve(BOILERPLATE_BASE_PATH, 'viewengine', veBoilerPlateType);\n-        BOILERPLATE_PATHS.viewengine[veBoilerPlateType].forEach(\n-            filePath => this.copyFile(veBoilerPlateBasePath, exampleFolder, filePath));\n+        const veBoilerPlateBasePath = path.resolve(BOILERPLATE_VIEWENGINE_PATH, veBoilerPlateType);\n+        this.copyDirectoryContents(veBoilerPlateBasePath, exampleFolder);\n       }\n     });\n   }\n@@ -137,22 +87,28 @@ class ExampleBoilerPlate {\n     return glob.sync(pattern, {ignore: [ignorePattern]}).map(file => path.dirname(file));\n   }\n \n-  copyFile(sourceFolder, destinationFolder, filePath) {\n-    const sourcePath = path.resolve(sourceFolder, filePath);\n-\n-    // normalize path if needed\n-    filePath = this.normalizePath(filePath);\n-\n-    const destinationPath = path.resolve(destinationFolder, filePath);\n-    fs.copySync(sourcePath, destinationPath, {overwrite: true});\n-    fs.chmodSync(destinationPath, 444);\n-  }\n-\n   loadJsonFile(filePath) { return fs.readJsonSync(filePath, {throws: false}) || {}; }\n \n-  normalizePath(filePath) {\n-    // transform for example ../cli/src/tsconfig.app.json to src/tsconfig.app.json\n-    return filePath.replace(/\\.{2}\\/\\w+\\//, '');\n+  copyDirectoryContents(srcDir, dstDir) {\n+    shelljs.ls('-Al', srcDir).forEach(stat => {\n+      const srcPath = path.resolve(srcDir, stat.name);\n+      const dstPath = path.resolve(dstDir, stat.name);\n+\n+      if (stat.isDirectory()) {\n+        // `srcPath` is a directory: Recursively copy it to `dstDir`.\n+        shelljs.mkdir('-p', dstPath);\n+        return this.copyDirectoryContents(srcPath, dstPath);\n+      } else {\n+        // `srcPath` is a file: Copy it to `dstDir`.\n+        // (Also make the file non-writable to avoid accidental editing of boilerplate files).\n+        if (shelljs.test('-f', dstPath)) {\n+          // If the file already exists, ensure it is writable (so it can be overwritten).\n+          shelljs.chmod(666, dstPath);\n+        }\n+        shelljs.cp(srcPath, dstDir);\n+        shelljs.chmod(444, dstPath);\n+      }\n+    });\n   }\n }\n "
        },
        {
            "sha": "cff911a1c38d3e7fb499fd8e61d0fc1771d7a403",
            "filename": "aio/tools/examples/example-boilerplate.spec.js",
            "status": "modified",
            "additions": 211,
            "deletions": 77,
            "changes": 288,
            "blob_url": "https://github.com/angular/angular/blob/5a733629b531083fd35563ee5bc286a8954da5fc/aio%2Ftools%2Fexamples%2Fexample-boilerplate.spec.js",
            "raw_url": "https://github.com/angular/angular/raw/5a733629b531083fd35563ee5bc286a8954da5fc/aio%2Ftools%2Fexamples%2Fexample-boilerplate.spec.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2Fexample-boilerplate.spec.js?ref=5a733629b531083fd35563ee5bc286a8954da5fc",
            "patch": "@@ -9,24 +9,13 @@ describe('example-boilerplate tool', () => {\n   describe('add', () => {\n     const sharedDir = path.resolve(__dirname, 'shared');\n     const sharedNodeModulesDir = path.resolve(sharedDir, 'node_modules');\n-    const BPFiles = {\n-      cli: 21,\n-      i18n: 3,\n-      universal: 2,\n-      systemjs: 7,\n-      common: 1,\n-      viewengine: {\n-        cli: 1,\n-        systemjs: 2,\n-      },\n-    };\n     const exampleFolders = ['a/b', 'c/d'];\n \n     beforeEach(() => {\n       spyOn(fs, 'ensureSymlinkSync');\n       spyOn(fs, 'existsSync').and.returnValue(true);\n       spyOn(shelljs, 'exec');\n-      spyOn(exampleBoilerPlate, 'copyFile');\n+      spyOn(exampleBoilerPlate, 'copyDirectoryContents');\n       spyOn(exampleBoilerPlate, 'getFoldersContaining').and.returnValue(exampleFolders);\n       spyOn(exampleBoilerPlate, 'loadJsonFile').and.returnValue({});\n     });\n@@ -61,58 +50,81 @@ describe('example-boilerplate tool', () => {\n \n     it('should copy all the source boilerplate files for systemjs', () => {\n       const boilerplateDir = path.resolve(sharedDir, 'boilerplate');\n-      exampleBoilerPlate.loadJsonFile.and.callFake(filePath => filePath.indexOf('a/b') !== -1 ? { projectType: 'systemjs' } : {});\n+      exampleBoilerPlate.loadJsonFile.and.returnValue({ projectType: 'systemjs' });\n+\n       exampleBoilerPlate.add();\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledTimes(\n-        (BPFiles.cli) +\n-        (BPFiles.systemjs) +\n-        (BPFiles.common * exampleFolders.length)\n-      );\n-      // for example\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledWith(`${boilerplateDir}/systemjs`, 'a/b', 'package.json');\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledWith(`${boilerplateDir}/common`, 'a/b', 'src/styles.css');\n+\n+      expect(exampleBoilerPlate.copyDirectoryContents).toHaveBeenCalledTimes(4);\n+      expect(exampleBoilerPlate.copyDirectoryContents.calls.allArgs()).toEqual([\n+        [`${boilerplateDir}/systemjs`, 'a/b'],\n+        [`${boilerplateDir}/common`, 'a/b'],\n+        [`${boilerplateDir}/systemjs`, 'c/d'],\n+        [`${boilerplateDir}/common`, 'c/d'],\n+      ]);\n     });\n \n     it('should copy all the source boilerplate files for cli', () => {\n       const boilerplateDir = path.resolve(sharedDir, 'boilerplate');\n+      exampleBoilerPlate.loadJsonFile.and.returnValue({ projectType: 'cli' });\n+\n       exampleBoilerPlate.add();\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledTimes(\n-        (BPFiles.cli * exampleFolders.length) +\n-        (BPFiles.common * exampleFolders.length)\n-      );\n-      // for example\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledWith(`${boilerplateDir}/cli`, 'a/b', 'package.json');\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledWith(`${boilerplateDir}/common`, 'c/d', 'src/styles.css');\n+\n+      expect(exampleBoilerPlate.copyDirectoryContents).toHaveBeenCalledTimes(4);\n+      expect(exampleBoilerPlate.copyDirectoryContents.calls.allArgs()).toEqual([\n+        [`${boilerplateDir}/cli`, 'a/b'],\n+        [`${boilerplateDir}/common`, 'a/b'],\n+        [`${boilerplateDir}/cli`, 'c/d'],\n+        [`${boilerplateDir}/common`, 'c/d'],\n+      ]);\n     });\n \n-    it('should copy all the source boilerplate files for i18n', () => {\n+    it('should default to `cli` if `projectType` is not specified', () => {\n       const boilerplateDir = path.resolve(sharedDir, 'boilerplate');\n-      exampleBoilerPlate.loadJsonFile.and.callFake(filePath => filePath.indexOf('a/b') !== -1 ? { projectType: 'i18n' } : {})\n+      exampleBoilerPlate.loadJsonFile.and.returnValue({});\n+\n       exampleBoilerPlate.add();\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledTimes(\n-        (BPFiles.cli + BPFiles.i18n) +\n-        (BPFiles.cli) +\n-        (BPFiles.common * exampleFolders.length)\n-      );\n-      // for example\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledWith(`${boilerplateDir}/i18n`, 'a/b', '../cli/angular.json');\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledWith(`${boilerplateDir}/i18n`, 'a/b', 'package.json');\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledWith(`${boilerplateDir}/common`, 'c/d', 'src/styles.css');\n-    });\n-\n-    it('should copy all the source boilerplate files for universal', () => {\n+\n+      expect(exampleBoilerPlate.copyDirectoryContents).toHaveBeenCalledTimes(4);\n+      expect(exampleBoilerPlate.copyDirectoryContents.calls.allArgs()).toEqual([\n+        [`${boilerplateDir}/cli`, 'a/b'],\n+        [`${boilerplateDir}/common`, 'a/b'],\n+        [`${boilerplateDir}/cli`, 'c/d'],\n+        [`${boilerplateDir}/common`, 'c/d'],\n+      ]);\n+    });\n+\n+    it('should copy all the source boilerplate files for i18n (on top of the cli ones)', () => {\n       const boilerplateDir = path.resolve(sharedDir, 'boilerplate');\n-      exampleBoilerPlate.loadJsonFile.and.callFake(filePath => filePath.indexOf('a/b') !== -1 ? { projectType: 'universal' } : {})\n+      exampleBoilerPlate.loadJsonFile.and.returnValue({ projectType: 'i18n' });\n+\n       exampleBoilerPlate.add();\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledTimes(\n-        (BPFiles.cli + BPFiles.universal) +\n-        (BPFiles.cli) +\n-        (BPFiles.common * exampleFolders.length)\n-      );\n-      // for example\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledWith(`${boilerplateDir}/universal`, 'a/b', '../cli/tslint.json');\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledWith(`${boilerplateDir}/universal`, 'a/b', 'angular.json');\n-      expect(exampleBoilerPlate.copyFile).toHaveBeenCalledWith(`${boilerplateDir}/common`, 'c/d', 'src/styles.css');\n+\n+      expect(exampleBoilerPlate.copyDirectoryContents).toHaveBeenCalledTimes(6);\n+      expect(exampleBoilerPlate.copyDirectoryContents.calls.allArgs()).toEqual([\n+        [`${boilerplateDir}/cli`, 'a/b'],\n+        [`${boilerplateDir}/i18n`, 'a/b'],\n+        [`${boilerplateDir}/common`, 'a/b'],\n+        [`${boilerplateDir}/cli`, 'c/d'],\n+        [`${boilerplateDir}/i18n`, 'c/d'],\n+        [`${boilerplateDir}/common`, 'c/d'],\n+      ]);\n+    });\n+\n+    it('should copy all the source boilerplate files for universal (on top of the cli ones)', () => {\n+      const boilerplateDir = path.resolve(sharedDir, 'boilerplate');\n+      exampleBoilerPlate.loadJsonFile.and.returnValue({ projectType: 'universal' });\n+\n+      exampleBoilerPlate.add();\n+\n+      expect(exampleBoilerPlate.copyDirectoryContents).toHaveBeenCalledTimes(6);\n+      expect(exampleBoilerPlate.copyDirectoryContents.calls.allArgs()).toEqual([\n+        [`${boilerplateDir}/cli`, 'a/b'],\n+        [`${boilerplateDir}/universal`, 'a/b'],\n+        [`${boilerplateDir}/common`, 'a/b'],\n+        [`${boilerplateDir}/cli`, 'c/d'],\n+        [`${boilerplateDir}/universal`, 'c/d'],\n+        [`${boilerplateDir}/common`, 'c/d'],\n+      ]);\n     });\n \n     it('should try to load the example config file', () => {\n@@ -130,27 +142,55 @@ describe('example-boilerplate tool', () => {\n \n       it('should copy all the source boilerplate files for systemjs', () => {\n         const boilerplateDir = path.resolve(sharedDir, 'boilerplate');\n-        exampleBoilerPlate.loadJsonFile.and.callFake(filePath => filePath.indexOf('a/b') !== -1 ? { projectType: 'systemjs' } : {});\n+        exampleBoilerPlate.loadJsonFile.and.returnValue({ projectType: 'systemjs' });\n+\n         exampleBoilerPlate.add(true);\n-        expect(exampleBoilerPlate.copyFile).toHaveBeenCalledTimes(\n-          (BPFiles.cli + BPFiles.viewengine.cli) +\n-          (BPFiles.systemjs + BPFiles.viewengine.systemjs) +\n-          (BPFiles.common * exampleFolders.length)\n-        );\n-        // for example\n-        expect(exampleBoilerPlate.copyFile).toHaveBeenCalledWith(`${boilerplateDir}/viewengine/systemjs`, 'a/b', 'tsconfig-aot.json');\n+\n+        expect(exampleBoilerPlate.copyDirectoryContents).toHaveBeenCalledTimes(6);\n+        expect(exampleBoilerPlate.copyDirectoryContents.calls.allArgs()).toEqual([\n+          [`${boilerplateDir}/systemjs`, 'a/b'],\n+          [`${boilerplateDir}/common`, 'a/b'],\n+          [`${boilerplateDir}/viewengine/systemjs`, 'a/b'],\n+          [`${boilerplateDir}/systemjs`, 'c/d'],\n+          [`${boilerplateDir}/common`, 'c/d'],\n+          [`${boilerplateDir}/viewengine/systemjs`, 'c/d'],\n+        ]);\n       });\n \n       it('should copy all the source boilerplate files for cli', () => {\n         const boilerplateDir = path.resolve(sharedDir, 'boilerplate');\n+        exampleBoilerPlate.loadJsonFile.and.returnValue({ projectType: 'cli' });\n+\n         exampleBoilerPlate.add(true);\n-        expect(exampleBoilerPlate.copyFile).toHaveBeenCalledTimes(\n-          (BPFiles.cli * exampleFolders.length) +\n-          (BPFiles.viewengine.cli * exampleFolders.length) +\n-          (BPFiles.common * exampleFolders.length)\n-        );\n-        // for example\n-        expect(exampleBoilerPlate.copyFile).toHaveBeenCalledWith(`${boilerplateDir}/viewengine/cli`, 'a/b', 'tsconfig.json');\n+\n+        expect(exampleBoilerPlate.copyDirectoryContents).toHaveBeenCalledTimes(6);\n+        expect(exampleBoilerPlate.copyDirectoryContents.calls.allArgs()).toEqual([\n+          [`${boilerplateDir}/cli`, 'a/b'],\n+          [`${boilerplateDir}/common`, 'a/b'],\n+          [`${boilerplateDir}/viewengine/cli`, 'a/b'],\n+          [`${boilerplateDir}/cli`, 'c/d'],\n+          [`${boilerplateDir}/common`, 'c/d'],\n+          [`${boilerplateDir}/viewengine/cli`, 'c/d'],\n+        ]);\n+      });\n+\n+      it('should copy all the source boilerplate files for elements', () => {\n+        const boilerplateDir = path.resolve(sharedDir, 'boilerplate');\n+        exampleBoilerPlate.loadJsonFile.and.returnValue({ projectType: 'elements' });\n+\n+        exampleBoilerPlate.add(true);\n+\n+        expect(exampleBoilerPlate.copyDirectoryContents).toHaveBeenCalledTimes(8);\n+        expect(exampleBoilerPlate.copyDirectoryContents.calls.allArgs()).toEqual([\n+          [`${boilerplateDir}/cli`, 'a/b'],\n+          [`${boilerplateDir}/elements`, 'a/b'],\n+          [`${boilerplateDir}/common`, 'a/b'],\n+          [`${boilerplateDir}/viewengine/cli`, 'a/b'],\n+          [`${boilerplateDir}/cli`, 'c/d'],\n+          [`${boilerplateDir}/elements`, 'c/d'],\n+          [`${boilerplateDir}/common`, 'c/d'],\n+          [`${boilerplateDir}/viewengine/cli`, 'c/d'],\n+        ]);\n       });\n     });\n   });\n@@ -172,16 +212,110 @@ describe('example-boilerplate tool', () => {\n     });\n   });\n \n-  describe('copyFile', () => {\n-    it('should use copySync and chmodSync', () => {\n-      spyOn(fs, 'copySync');\n-      spyOn(fs, 'chmodSync');\n-      exampleBoilerPlate.copyFile('source/folder', 'destination/folder', 'some/file/path');\n-      expect(fs.copySync).toHaveBeenCalledWith(\n-        path.resolve('source/folder/some/file/path'),\n-        path.resolve('destination/folder/some/file/path'),\n-        { overwrite: true });\n-      expect(fs.chmodSync).toHaveBeenCalledWith(path.resolve('destination/folder/some/file/path'), 444);\n+  describe('copyDirectoryContents', () => {\n+    const spyFnFor = fnName => (...args) => { callLog.push(`${fnName}(${args.join(', ')})`); };\n+    let callLog;\n+\n+    beforeEach(() => {\n+      callLog = [];\n+      spyOn(shelljs, 'chmod').and.callFake(spyFnFor('chmod'));\n+      spyOn(shelljs, 'cp').and.callFake(spyFnFor('cp'));\n+      spyOn(shelljs, 'mkdir').and.callFake(spyFnFor('mkdir'));\n+      spyOn(shelljs, 'test').and.callFake(spyFnFor('test'));\n+    });\n+\n+    it('should list all contents of a directory', () => {\n+      const lsSpy = spyOn(shelljs, 'ls').and.returnValue([]);\n+      exampleBoilerPlate.copyDirectoryContents('source/dir', 'destination/dir');\n+      expect(lsSpy).toHaveBeenCalledWith('-Al', 'source/dir');\n+    });\n+\n+    it('should use copy files and make them read-only', () => {\n+      spyOn(shelljs, 'ls').and.returnValue([\n+        {name: 'file-1.txt', isDirectory: () => false},\n+        {name: 'file-2.txt', isDirectory: () => false},\n+      ]);\n+\n+      exampleBoilerPlate.copyDirectoryContents('source/dir', 'destination/dir');\n+\n+      expect(callLog).toEqual([\n+        `test(-f, ${path.resolve('destination/dir/file-1.txt')})`,\n+        `cp(${path.resolve('source/dir/file-1.txt')}, destination/dir)`,\n+        `chmod(444, ${path.resolve('destination/dir/file-1.txt')})`,\n+\n+        `test(-f, ${path.resolve('destination/dir/file-2.txt')})`,\n+        `cp(${path.resolve('source/dir/file-2.txt')}, destination/dir)`,\n+        `chmod(444, ${path.resolve('destination/dir/file-2.txt')})`,\n+      ]);\n+    });\n+\n+    it('should make existing files in destination writable before overwriting', () => {\n+      spyOn(shelljs, 'ls').and.returnValue([\n+        {name: 'new-file.txt', isDirectory: () => false},\n+        {name: 'existing-file.txt', isDirectory: () => false},\n+      ]);\n+      shelljs.test.and.callFake((_, filePath) => filePath.endsWith('existing-file.txt'));\n+\n+      exampleBoilerPlate.copyDirectoryContents('source/dir', 'destination/dir');\n+\n+      expect(callLog).toEqual([\n+        `cp(${path.resolve('source/dir/new-file.txt')}, destination/dir)`,\n+        `chmod(444, ${path.resolve('destination/dir/new-file.txt')})`,\n+\n+        `chmod(666, ${path.resolve('destination/dir/existing-file.txt')})`,\n+        `cp(${path.resolve('source/dir/existing-file.txt')}, destination/dir)`,\n+        `chmod(444, ${path.resolve('destination/dir/existing-file.txt')})`,\n+      ]);\n+    });\n+\n+    it('should recursively copy sub-directories', () => {\n+      spyOn(shelljs, 'ls')\n+        .withArgs('-Al', 'source/dir').and.returnValue([\n+          {name: 'file-1.txt', isDirectory: () => false},\n+          {name: 'sub-dir-1', isDirectory: () => true},\n+          {name: 'file-2.txt', isDirectory: () => false},\n+        ])\n+        .withArgs('-Al', path.resolve('source/dir/sub-dir-1')).and.returnValue([\n+          {name: 'file-3.txt', isDirectory: () => false},\n+          {name: 'sub-dir-2', isDirectory: () => true},\n+        ])\n+        .withArgs('-Al', path.resolve('source/dir/sub-dir-1/sub-dir-2')).and.returnValue([\n+          {name: 'file-4.txt', isDirectory: () => false},\n+        ]);\n+\n+      exampleBoilerPlate.copyDirectoryContents('source/dir', 'destination/dir');\n+\n+      expect(callLog).toEqual([\n+        // Copy `file-1.txt`.\n+        `test(-f, ${path.resolve('destination/dir/file-1.txt')})`,\n+        `cp(${path.resolve('source/dir/file-1.txt')}, destination/dir)`,\n+        `chmod(444, ${path.resolve('destination/dir/file-1.txt')})`,\n+\n+        // Create `sub-dir-1` and recursively copy its contents.\n+        `mkdir(-p, ${path.resolve('destination/dir/sub-dir-1')})`,\n+\n+          // Copy `sub-dir-1/file-3.txt`.\n+          `test(-f, ${path.resolve('destination/dir/sub-dir-1/file-3.txt')})`,\n+          'cp(' +\n+              `${path.resolve('source/dir/sub-dir-1/file-3.txt')}, ` +\n+              `${path.resolve('destination/dir/sub-dir-1')})`,\n+          `chmod(444, ${path.resolve('destination/dir/sub-dir-1/file-3.txt')})`,\n+\n+          // Create `sub-dir-1/sub-dir-2` and recursively copy its contents.\n+          `mkdir(-p, ${path.resolve('destination/dir/sub-dir-1/sub-dir-2')})`,\n+\n+            // Copy `sub-dir-1/sub-dir-2/file-4.txt`.\n+            `test(-f, ${path.resolve('destination/dir/sub-dir-1/sub-dir-2/file-4.txt')})`,\n+            'cp(' +\n+                `${path.resolve('source/dir/sub-dir-1/sub-dir-2/file-4.txt')}, ` +\n+                `${path.resolve('destination/dir/sub-dir-1/sub-dir-2')})`,\n+            `chmod(444, ${path.resolve('destination/dir/sub-dir-1/sub-dir-2/file-4.txt')})`,\n+\n+        // Copy `file-2.txt`.\n+        `test(-f, ${path.resolve('destination/dir/file-2.txt')})`,\n+        `cp(${path.resolve('source/dir/file-2.txt')}, destination/dir)`,\n+        `chmod(444, ${path.resolve('destination/dir/file-2.txt')})`,\n+      ]);\n     });\n   });\n "
        }
    ],
    "stats": {
        "total": 408,
        "additions": 249,
        "deletions": 159
    }
}