{
    "author": "alxhub",
    "message": "Revert \"fix(compiler): mark `NgModuleFactory` construction as not side effectful (#38147)\" (#38303)\n\nThis reverts commit 7f8c2225f2cba3dfcf3ec23e0fe08b7d2e3497e8.\n\nThis commit caused test failures internally, which were traced back to the\noptimizer removing NgModuleFactory constructor calls when those calls caused\nside-effectful registration of NgModules by their ids.\n\nPR Close #38303",
    "sha": "3a525d196b4d7bd40f7bd1bd38de8a160e0247e5",
    "files": [
        {
            "sha": "122b39982909c58b4b65b6fe6fe1200c54152e27",
            "filename": "packages/compiler-cli/src/ngtsc/imports/src/core.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/3a525d196b4d7bd40f7bd1bd38de8a160e0247e5/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Fcore.ts",
            "raw_url": "https://github.com/angular/angular/raw/3a525d196b4d7bd40f7bd1bd38de8a160e0247e5/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Fcore.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Fcore.ts?ref=3a525d196b4d7bd40f7bd1bd38de8a160e0247e5",
            "patch": "@@ -65,7 +65,6 @@ const CORE_SUPPORTED_SYMBOLS = new Map<string, string>([\n   ['ɵɵInjectorDef', 'ɵɵInjectorDef'],\n   ['ɵɵNgModuleDefWithMeta', 'ɵɵNgModuleDefWithMeta'],\n   ['ɵNgModuleFactory', 'NgModuleFactory'],\n-  ['ɵnoSideEffects', 'ɵnoSideEffects'],\n ]);\n \n const CORE_MODULE = '@angular/core';"
        },
        {
            "sha": "8e54e282a5efd36530d0b864412114dc44ba4936",
            "filename": "packages/compiler-cli/src/ngtsc/shims/src/factory_generator.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/3a525d196b4d7bd40f7bd1bd38de8a160e0247e5/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fshims%2Fsrc%2Ffactory_generator.ts",
            "raw_url": "https://github.com/angular/angular/raw/3a525d196b4d7bd40f7bd1bd38de8a160e0247e5/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fshims%2Fsrc%2Ffactory_generator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fshims%2Fsrc%2Ffactory_generator.ts?ref=3a525d196b4d7bd40f7bd1bd38de8a160e0247e5",
            "patch": "@@ -63,8 +63,7 @@ export class FactoryGenerator implements PerFileShimGenerator, FactoryTracker {\n       // because it won't miss any that do.\n       const varLines = symbolNames.map(\n           name => `export const ${\n-              name}NgFactory: i0.ɵNgModuleFactory<any> = i0.ɵnoSideEffects(() => new i0.ɵNgModuleFactory(${\n-              name}));`);\n+              name}NgFactory: i0.ɵNgModuleFactory<any> = new i0.ɵNgModuleFactory(${name});`);\n       sourceText += [\n         // This might be incorrect if the current package being compiled is Angular core, but it's\n         // okay to leave in at type checking time. TypeScript can handle this reference via its path"
        },
        {
            "sha": "7aad1050cff0dfab0bf6390e210568e04f747a7c",
            "filename": "packages/compiler-cli/test/ngtsc/fake_core/index.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/3a525d196b4d7bd40f7bd1bd38de8a160e0247e5/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Ffake_core%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/3a525d196b4d7bd40f7bd1bd38de8a160e0247e5/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Ffake_core%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Ffake_core%2Findex.ts?ref=3a525d196b4d7bd40f7bd1bd38de8a160e0247e5",
            "patch": "@@ -103,5 +103,3 @@ export interface QueryList<T>/* implements Iterable<T> */ {\n export type NgIterable<T> = Array<T>|Iterable<T>;\n \n export class NgZone {}\n-\n-export declare function ɵnoSideEffects<T>(fn: () => T): T;"
        },
        {
            "sha": "6e6848a80d56eff18414e2e3ab3f5d0cb6dd6491",
            "filename": "packages/compiler-cli/test/ngtsc/ngtsc_spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 11,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/3a525d196b4d7bd40f7bd1bd38de8a160e0247e5/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/3a525d196b4d7bd40f7bd1bd38de8a160e0247e5/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts?ref=3a525d196b4d7bd40f7bd1bd38de8a160e0247e5",
            "patch": "@@ -3538,9 +3538,7 @@ runInEachFileSystem(os => {\n       expect(factoryContents).toContain(`import * as i0 from '@angular/core';`);\n       expect(factoryContents).toContain(`import { NotAModule, TestModule } from './test';`);\n       expect(factoryContents)\n-          .toContain(\n-              'export var TestModuleNgFactory = ' +\n-              'i0.ɵnoSideEffects(function () { return new i0.\\u0275NgModuleFactory(TestModule); });');\n+          .toContain(`export var TestModuleNgFactory = new i0.\\u0275NgModuleFactory(TestModule);`);\n       expect(factoryContents).not.toContain(`NotAModuleNgFactory`);\n       expect(factoryContents).not.toContain('\\u0275NonEmptyModule');\n \n@@ -3679,14 +3677,11 @@ runInEachFileSystem(os => {\n         env.driveMain();\n \n         const factoryContents = env.getContents('test.ngfactory.js');\n-        expect(normalize(factoryContents))\n-            .toBe(\n-                'import * as i0 from \"./r3_symbols\"; ' +\n-                'import { TestModule } from \\'./test\\'; ' +\n-                'export var TestModuleNgFactory = ' +\n-                'i0.\\u0275noSideEffects(function () { ' +\n-                'return new i0.NgModuleFactory(TestModule); ' +\n-                '});');\n+        expect(normalize(factoryContents)).toBe(normalize(`\n+        import * as i0 from \"./r3_symbols\";\n+        import { TestModule } from './test';\n+        export var TestModuleNgFactory = new i0.NgModuleFactory(TestModule);\n+      `));\n       });\n \n       describe('file-level comments', () => {"
        },
        {
            "sha": "d20a6449ac7951c1831e34a76d8415c5dc03d17f",
            "filename": "packages/core/src/core_render3_private_export.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/3a525d196b4d7bd40f7bd1bd38de8a160e0247e5/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts",
            "raw_url": "https://github.com/angular/angular/raw/3a525d196b4d7bd40f7bd1bd38de8a160e0247e5/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts?ref=3a525d196b4d7bd40f7bd1bd38de8a160e0247e5",
            "patch": "@@ -292,6 +292,5 @@ export {\n   ɵɵsanitizeUrl,\n   ɵɵsanitizeUrlOrResourceUrl,\n } from './sanitization/sanitization';\n-export {noSideEffects as ɵnoSideEffects} from './util/closure';\n \n // clang-format on"
        },
        {
            "sha": "391bb8bf562a4b474911214573fe5b06a4f1bb5f",
            "filename": "packages/core/src/r3_symbols.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/3a525d196b4d7bd40f7bd1bd38de8a160e0247e5/packages%2Fcore%2Fsrc%2Fr3_symbols.ts",
            "raw_url": "https://github.com/angular/angular/raw/3a525d196b4d7bd40f7bd1bd38de8a160e0247e5/packages%2Fcore%2Fsrc%2Fr3_symbols.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fr3_symbols.ts?ref=3a525d196b4d7bd40f7bd1bd38de8a160e0247e5",
            "patch": "@@ -28,7 +28,6 @@ export {ɵɵdefineNgModule} from './render3/definition';\n export {ɵɵFactoryDef} from './render3/interfaces/definition';\n export {setClassMetadata} from './render3/metadata';\n export {NgModuleFactory} from './render3/ng_module_ref';\n-export {noSideEffects as ɵnoSideEffects} from './util/closure';\n \n \n "
        }
    ],
    "stats": {
        "total": 25,
        "additions": 7,
        "deletions": 18
    }
}