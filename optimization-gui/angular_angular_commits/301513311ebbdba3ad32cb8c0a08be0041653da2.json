{
    "author": "josephperrott",
    "message": "refactor(dev-infra): update yargs and typings for yargs (#38470)\n\nUpdating yargs and typings for the updated yargs module.\n\nPR Close #38470",
    "sha": "301513311ebbdba3ad32cb8c0a08be0041653da2",
    "files": [
        {
            "sha": "90143ccee2f38b8002703f41156c3926deb6eceb",
            "filename": "dev-infra/commit-message/cli.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/301513311ebbdba3ad32cb8c0a08be0041653da2/dev-infra%2Fcommit-message%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/301513311ebbdba3ad32cb8c0a08be0041653da2/dev-infra%2Fcommit-message%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fcli.ts?ref=301513311ebbdba3ad32cb8c0a08be0041653da2",
            "patch": "@@ -18,14 +18,16 @@ export function buildCommitMessageParser(localYargs: yargs.Argv) {\n   return localYargs.help()\n       .strict()\n       .command(\n-          'restore-commit-message-draft', false, {\n-            'file-env-variable': {\n+          'restore-commit-message-draft', false,\n+          args => {\n+            return args.option('file-env-variable', {\n               type: 'string',\n+              array: true,\n               conflicts: ['file'],\n               required: true,\n               description:\n-                  'The key for the environment variable which holds the arguments for the ' +\n-                  'prepare-commit-msg hook as described here: ' +\n+                  'The key for the environment variable which holds the arguments for the\\n' +\n+                  'prepare-commit-msg hook as described here:\\n' +\n                   'https://git-scm.com/docs/githooks#_prepare_commit_msg',\n               coerce: arg => {\n                 const [file, source] = (process.env[arg] || '').split(' ');\n@@ -34,10 +36,10 @@ export function buildCommitMessageParser(localYargs: yargs.Argv) {\n                 }\n                 return [file, source];\n               },\n-            }\n+            });\n           },\n           args => {\n-            restoreCommitMessage(args.fileEnvVariable[0], args.fileEnvVariable[1]);\n+            restoreCommitMessage(args['file-env-variable'][0], args['file-env-variable'][1] as any);\n           })\n       .command(\n           'pre-commit-validate', 'Validate the most recent commit message', {\n@@ -61,7 +63,7 @@ export function buildCommitMessageParser(localYargs: yargs.Argv) {\n             }\n           },\n           args => {\n-            const file = args.file || args.fileEnvVariable || '.git/COMMIT_EDITMSG';\n+            const file = args.file || args['file-env-variable'] || '.git/COMMIT_EDITMSG';\n             validateFile(file);\n           })\n       .command("
        },
        {
            "sha": "77dc6503699bc0294553764366679f30c7872f13",
            "filename": "dev-infra/format/cli.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 7,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/301513311ebbdba3ad32cb8c0a08be0041653da2/dev-infra%2Fformat%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/301513311ebbdba3ad32cb8c0a08be0041653da2/dev-infra%2Fformat%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fformat%2Fcli.ts?ref=301513311ebbdba3ad32cb8c0a08be0041653da2",
            "patch": "@@ -22,28 +22,31 @@ export function buildFormatParser(localYargs: yargs.Argv) {\n         description: 'Run the formatter to check formatting rather than updating code format'\n       })\n       .command(\n-          'all', 'Run the formatter on all files in the repository', {},\n+          'all', 'Run the formatter on all files in the repository', args => args,\n           ({check}) => {\n             const executionCmd = check ? checkFiles : formatFiles;\n             executionCmd(allFiles());\n           })\n       .command(\n-          'changed [shaOrRef]', 'Run the formatter on files changed since the provided sha/ref', {},\n+          'changed [shaOrRef]', 'Run the formatter on files changed since the provided sha/ref',\n+          args => args.positional('shaOrRef', {type: 'string'}),\n           ({shaOrRef, check}) => {\n             const sha = shaOrRef || 'master';\n             const executionCmd = check ? checkFiles : formatFiles;\n             executionCmd(allChangedFilesSince(sha));\n           })\n       .command(\n-          'staged', 'Run the formatter on all staged files', {},\n+          'staged', 'Run the formatter on all staged files', args => args,\n           ({check}) => {\n             const executionCmd = check ? checkFiles : formatFiles;\n             executionCmd(allStagedFiles());\n           })\n-      .command('files <files..>', 'Run the formatter on provided files', {}, ({check, files}) => {\n-        const executionCmd = check ? checkFiles : formatFiles;\n-        executionCmd(files);\n-      });\n+      .command(\n+          'files <files..>', 'Run the formatter on provided files',\n+          args => args.positional('files', {array: true, type: 'string'}), ({check, files}) => {\n+            const executionCmd = check ? checkFiles : formatFiles;\n+            executionCmd(files!);\n+          });\n }\n \n if (require.main === module) {"
        },
        {
            "sha": "27f83b69e92890040478babe237debb44ab4b0fc",
            "filename": "dev-infra/pr/discover-new-conflicts/cli.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 10,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/301513311ebbdba3ad32cb8c0a08be0041653da2/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/301513311ebbdba3ad32cb8c0a08be0041653da2/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Fcli.ts?ref=301513311ebbdba3ad32cb8c0a08be0041653da2",
            "patch": "@@ -12,18 +12,28 @@ import {error} from '../../utils/console';\n \n import {discoverNewConflictsForPr} from './index';\n \n+/** The options available to the discover-new-conflicts command via CLI. */\n+export interface DiscoverNewConflictsCommandOptions {\n+  date: number;\n+  'pr-number': number;\n+}\n+\n /** Builds the discover-new-conflicts pull request command. */\n-export function buildDiscoverNewConflictsCommand(yargs: Argv) {\n-  return yargs.option('date', {\n-    description: 'Only consider PRs updated since provided date',\n-    defaultDescription: '30 days ago',\n-    coerce: Date.parse,\n-    default: getThirtyDaysAgoDate,\n-  });\n+export function buildDiscoverNewConflictsCommand(yargs: Argv):\n+    Argv<DiscoverNewConflictsCommandOptions> {\n+  return yargs\n+      .option('date', {\n+        description: 'Only consider PRs updated since provided date',\n+        defaultDescription: '30 days ago',\n+        coerce: (date) => typeof date === 'number' ? date : Date.parse(date),\n+        default: getThirtyDaysAgoDate(),\n+      })\n+      .positional('pr-number', {demandOption: true, type: 'number'});\n }\n \n /** Handles the discover-new-conflicts pull request command. */\n-export async function handleDiscoverNewConflictsCommand({prNumber, date}: Arguments) {\n+export async function handleDiscoverNewConflictsCommand(\n+    {'pr-number': prNumber, date}: Arguments<DiscoverNewConflictsCommandOptions>) {\n   // If a provided date is not able to be parsed, yargs provides it as NaN.\n   if (isNaN(date)) {\n     error('Unable to parse the value provided via --date flag');\n@@ -33,11 +43,11 @@ export async function handleDiscoverNewConflictsCommand({prNumber, date}: Argume\n }\n \n /** Gets a date object 30 days ago from today. */\n-function getThirtyDaysAgoDate(): Date {\n+function getThirtyDaysAgoDate() {\n   const date = new Date();\n   // Set the hours, minutes and seconds to 0 to only consider date.\n   date.setHours(0, 0, 0, 0);\n   // Set the date to 30 days in the past.\n   date.setDate(date.getDate() - 30);\n-  return date;\n+  return date.getTime();\n }"
        },
        {
            "sha": "785b9fb2dae79d2302232f7f86d8c3986ecfa73d",
            "filename": "dev-infra/pr/merge/cli.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 8,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/301513311ebbdba3ad32cb8c0a08be0041653da2/dev-infra%2Fpr%2Fmerge%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/301513311ebbdba3ad32cb8c0a08be0041653da2/dev-infra%2Fpr%2Fmerge%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fcli.ts?ref=301513311ebbdba3ad32cb8c0a08be0041653da2",
            "patch": "@@ -12,23 +12,32 @@ import {error, red, yellow} from '../../utils/console';\n \n import {GITHUB_TOKEN_GENERATE_URL, mergePullRequest} from './index';\n \n+/** The options available to the merge command via CLI. */\n+export interface MergeCommandOptions {\n+  'github-token'?: string;\n+  'pr-number': number;\n+}\n+\n /** Builds the options for the merge command. */\n-export function buildMergeCommand(yargs: Argv) {\n-  return yargs.help().strict().option('github-token', {\n-    type: 'string',\n-    description: 'Github token. If not set, token is retrieved from the environment variables.'\n-  });\n+export function buildMergeCommand(yargs: Argv): Argv<MergeCommandOptions> {\n+  return yargs.help()\n+      .strict()\n+      .positional('pr-number', {demandOption: true, type: 'number'})\n+      .option('github-token', {\n+        type: 'string',\n+        description: 'Github token. If not set, token is retrieved from the environment variables.'\n+      });\n }\n \n /** Handles the merge command. i.e. performs the merge of a specified pull request. */\n-export async function handleMergeCommand(args: Arguments) {\n-  const githubToken = args.githubToken || process.env.GITHUB_TOKEN || process.env.TOKEN;\n+export async function handleMergeCommand(args: Arguments<MergeCommandOptions>) {\n+  const githubToken = args['github-token'] || process.env.GITHUB_TOKEN || process.env.TOKEN;\n   if (!githubToken) {\n     error(red('No Github token set. Please set the `GITHUB_TOKEN` environment variable.'));\n     error(red('Alternatively, pass the `--github-token` command line flag.'));\n     error(yellow(`You can generate a token here: ${GITHUB_TOKEN_GENERATE_URL}`));\n     process.exit(1);\n   }\n \n-  await mergePullRequest(args.prNumber, githubToken);\n+  await mergePullRequest(args['pr-number'], githubToken);\n }"
        },
        {
            "sha": "d06ace794a7b469a42a4127efc078e6219a11377",
            "filename": "dev-infra/pr/rebase/cli.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 7,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/301513311ebbdba3ad32cb8c0a08be0041653da2/dev-infra%2Fpr%2Frebase%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/301513311ebbdba3ad32cb8c0a08be0041653da2/dev-infra%2Fpr%2Frebase%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Frebase%2Fcli.ts?ref=301513311ebbdba3ad32cb8c0a08be0041653da2",
            "patch": "@@ -15,17 +15,26 @@ import {rebasePr} from './index';\n /** URL to the Github page where personal access tokens can be generated. */\n export const GITHUB_TOKEN_GENERATE_URL = `https://github.com/settings/tokens`;\n \n+/** The options available to the rebase command via CLI. */\n+export interface RebaseCommandOptions {\n+  'github-token'?: string;\n+  prNumber: number;\n+}\n+\n /** Builds the rebase pull request command. */\n-export function buildRebaseCommand(yargs: Argv) {\n-  return yargs.option('github-token', {\n-    type: 'string',\n-    description: 'Github token. If not set, token is retrieved from the environment variables.'\n-  });\n+export function buildRebaseCommand(yargs: Argv): Argv<RebaseCommandOptions> {\n+  return yargs\n+      .option('github-token', {\n+        type: 'string',\n+        description: 'Github token. If not set, token is retrieved from the environment variables.'\n+      })\n+      .positional('prNumber', {type: 'number', demandOption: true});\n }\n \n+\n /** Handles the rebase pull request command. */\n-export async function handleRebaseCommand(args: Arguments) {\n-  const githubToken = args.githubToken || process.env.GITHUB_TOKEN || process.env.TOKEN;\n+export async function handleRebaseCommand(args: Arguments<RebaseCommandOptions>) {\n+  const githubToken = args['github-token'] || process.env.GITHUB_TOKEN || process.env.TOKEN;\n   if (!githubToken) {\n     error('No Github token set. Please set the `GITHUB_TOKEN` environment variable.');\n     error('Alternatively, pass the `--github-token` command line flag.');"
        },
        {
            "sha": "fb90015f2fc8b31321b749d3161286e2cf2f8348",
            "filename": "dev-infra/ts-circular-dependencies/index.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 10,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/301513311ebbdba3ad32cb8c0a08be0041653da2/dev-infra%2Fts-circular-dependencies%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/301513311ebbdba3ad32cb8c0a08be0041653da2/dev-infra%2Fts-circular-dependencies%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fts-circular-dependencies%2Findex.ts?ref=301513311ebbdba3ad32cb8c0a08be0041653da2",
            "patch": "@@ -30,20 +30,19 @@ export function tsCircularDependenciesBuilder(localYargs: yargs.Argv) {\n           {type: 'string', demandOption: true, description: 'Path to the configuration file.'})\n       .option('warnings', {type: 'boolean', description: 'Prints all warnings.'})\n       .command(\n-          'check', 'Checks if the circular dependencies have changed.', {},\n-          (argv: yargs.Arguments) => {\n+          'check', 'Checks if the circular dependencies have changed.', args => args,\n+          argv => {\n             const {config: configArg, warnings} = argv;\n             const configPath = isAbsolute(configArg) ? configArg : resolve(configArg);\n             const config = loadTestConfig(configPath);\n-            process.exit(main(false, config, warnings));\n+            process.exit(main(false, config, !!warnings));\n           })\n-      .command(\n-          'approve', 'Approves the current circular dependencies.', {}, (argv: yargs.Arguments) => {\n-            const {config: configArg, warnings} = argv;\n-            const configPath = isAbsolute(configArg) ? configArg : resolve(configArg);\n-            const config = loadTestConfig(configPath);\n-            process.exit(main(true, config, warnings));\n-          });\n+      .command('approve', 'Approves the current circular dependencies.', args => args, argv => {\n+        const {config: configArg, warnings} = argv;\n+        const configPath = isAbsolute(configArg) ? configArg : resolve(configArg);\n+        const config = loadTestConfig(configPath);\n+        process.exit(main(true, config, !!warnings));\n+      });\n }\n \n /**"
        },
        {
            "sha": "2fcd6424bccfcdc70abb61a47bb952b263e44c4d",
            "filename": "package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/301513311ebbdba3ad32cb8c0a08be0041653da2/package.json",
            "raw_url": "https://github.com/angular/angular/raw/301513311ebbdba3ad32cb8c0a08be0041653da2/package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/package.json?ref=301513311ebbdba3ad32cb8c0a08be0041653da2",
            "patch": "@@ -88,7 +88,7 @@\n     \"@types/shelljs\": \"^0.8.6\",\n     \"@types/systemjs\": \"0.19.32\",\n     \"@types/yaml\": \"^1.2.0\",\n-    \"@types/yargs\": \"^11.1.1\",\n+    \"@types/yargs\": \"^15.0.5\",\n     \"@webcomponents/custom-elements\": \"^1.1.0\",\n     \"angular\": \"npm:angular@1.7\",\n     \"angular-1.5\": \"npm:angular@1.5\",\n@@ -153,7 +153,7 @@\n     \"typescript\": \"~3.9.5\",\n     \"xhr2\": \"0.2.0\",\n     \"yaml\": \"^1.7.2\",\n-    \"yargs\": \"15.3.0\"\n+    \"yargs\": \"^15.4.1\"\n   },\n   \"// 2\": \"devDependencies are not used under Bazel. Many can be removed after test.sh is deleted.\",\n   \"devDependencies\": {"
        },
        {
            "sha": "54131051c6cad12dc346c235eeef2a1d3fd6c380",
            "filename": "yarn.lock",
            "status": "modified",
            "additions": 32,
            "deletions": 25,
            "changes": 57,
            "blob_url": "https://github.com/angular/angular/blob/301513311ebbdba3ad32cb8c0a08be0041653da2/yarn.lock",
            "raw_url": "https://github.com/angular/angular/raw/301513311ebbdba3ad32cb8c0a08be0041653da2/yarn.lock",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/yarn.lock?ref=301513311ebbdba3ad32cb8c0a08be0041653da2",
            "patch": "@@ -2352,10 +2352,17 @@\n   resolved \"https://registry.yarnpkg.com/@types/yaml/-/yaml-1.2.0.tgz#4ed577fc4ebbd6b829b28734e56d10c9e6984e09\"\n   integrity sha512-GW8b9qM+ebgW3/zjzPm0I1NxMvLaz/YKT9Ph6tTb+Fkeyzd9yLTvQ6ciQ2MorTRmb/qXmfjMerRpG4LviixaqQ==\n \n-\"@types/yargs@^11.1.1\":\n-  version \"11.1.5\"\n-  resolved \"https://registry.yarnpkg.com/@types/yargs/-/yargs-11.1.5.tgz#8d71dfe4848ac5d714b75eca3df9cac75a4f8dac\"\n-  integrity sha512-1jmXgoIyzxQSm33lYgEXvegtkhloHbed2I0QGlTN66U2F9/ExqJWSCSmaWC0IB/g1tW+IYSp+tDhcZBYB1ZGog==\n+\"@types/yargs-parser@*\":\n+  version \"15.0.0\"\n+  resolved \"https://registry.yarnpkg.com/@types/yargs-parser/-/yargs-parser-15.0.0.tgz#cb3f9f741869e20cce330ffbeb9271590483882d\"\n+  integrity sha512-FA/BWv8t8ZWJ+gEOnLLd8ygxH/2UFbAvgEonyfN6yWGLKc7zVjbpl2Y4CTjid9h2RfgPP6SEt6uHwEOply00yw==\n+\n+\"@types/yargs@^15.0.5\":\n+  version \"15.0.5\"\n+  resolved \"https://registry.yarnpkg.com/@types/yargs/-/yargs-15.0.5.tgz#947e9a6561483bdee9adffc983e91a6902af8b79\"\n+  integrity sha512-Dk/IDOPtOgubt/IaevIUbTgV7doaKkoorvOyYM2CMwuDyP89bekI7H4xLIwunNYiK9jhCkmc6pUrJk3cj2AB9w==\n+  dependencies:\n+    \"@types/yargs-parser\" \"*\"\n \n \"@types/yauzl@^2.9.1\":\n   version \"2.9.1\"\n@@ -16301,10 +16308,10 @@ yargs-parser@^15.0.1:\n     camelcase \"^5.0.0\"\n     decamelize \"^1.2.0\"\n \n-yargs-parser@^18.1.0:\n-  version \"18.1.2\"\n-  resolved \"https://registry.yarnpkg.com/yargs-parser/-/yargs-parser-18.1.2.tgz#2f482bea2136dbde0861683abea7756d30b504f1\"\n-  integrity sha512-hlIPNR3IzC1YuL1c2UwwDKpXlNFBqD1Fswwh1khz5+d8Cq/8yc/Mn0i+rQXduu8hcrFKvO7Eryk+09NecTQAAQ==\n+yargs-parser@^18.1.2:\n+  version \"18.1.3\"\n+  resolved \"https://registry.yarnpkg.com/yargs-parser/-/yargs-parser-18.1.3.tgz#be68c4975c6b2abf469236b0c870362fab09a7b0\"\n+  integrity sha512-o50j0JeToy/4K6OZcaQmW6lyXXKhq7csREXcDwk2omFPJEwUNOVtJKvmDr9EI1fAJZUyZcRF7kxGBWmRXudrCQ==\n   dependencies:\n     camelcase \"^5.0.0\"\n     decamelize \"^1.2.0\"\n@@ -16316,23 +16323,6 @@ yargs-parser@^9.0.2:\n   dependencies:\n     camelcase \"^4.1.0\"\n \n-yargs@15.3.0:\n-  version \"15.3.0\"\n-  resolved \"https://registry.yarnpkg.com/yargs/-/yargs-15.3.0.tgz#403af6edc75b3ae04bf66c94202228ba119f0976\"\n-  integrity sha512-g/QCnmjgOl1YJjGsnUg2SatC7NUYEiLXJqxNOQU9qSpjzGtGXda9b+OKccr1kLTy8BN9yqEyqfq5lxlwdc13TA==\n-  dependencies:\n-    cliui \"^6.0.0\"\n-    decamelize \"^1.2.0\"\n-    find-up \"^4.1.0\"\n-    get-caller-file \"^2.0.1\"\n-    require-directory \"^2.1.1\"\n-    require-main-filename \"^2.0.0\"\n-    set-blocking \"^2.0.0\"\n-    string-width \"^4.2.0\"\n-    which-module \"^2.0.0\"\n-    y18n \"^4.0.0\"\n-    yargs-parser \"^18.1.0\"\n-\n yargs@^11.0.0:\n   version \"11.1.1\"\n   resolved \"https://registry.yarnpkg.com/yargs/-/yargs-11.1.1.tgz#5052efe3446a4df5ed669c995886cc0f13702766\"\n@@ -16384,6 +16374,23 @@ yargs@^14.2.3:\n     y18n \"^4.0.0\"\n     yargs-parser \"^15.0.1\"\n \n+yargs@^15.4.1:\n+  version \"15.4.1\"\n+  resolved \"https://registry.yarnpkg.com/yargs/-/yargs-15.4.1.tgz#0d87a16de01aee9d8bec2bfbf74f67851730f4f8\"\n+  integrity sha512-aePbxDmcYW++PaqBsJ+HYUFwCdv4LVvdnhBy78E57PIor8/OVvhMrADFFEDh8DHDFRv/O9i3lPhsENjO7QX0+A==\n+  dependencies:\n+    cliui \"^6.0.0\"\n+    decamelize \"^1.2.0\"\n+    find-up \"^4.1.0\"\n+    get-caller-file \"^2.0.1\"\n+    require-directory \"^2.1.1\"\n+    require-main-filename \"^2.0.0\"\n+    set-blocking \"^2.0.0\"\n+    string-width \"^4.2.0\"\n+    which-module \"^2.0.0\"\n+    y18n \"^4.0.0\"\n+    yargs-parser \"^18.1.2\"\n+\n yauzl@^2.10.0:\n   version \"2.10.0\"\n   resolved \"https://registry.yarnpkg.com/yauzl/-/yauzl-2.10.0.tgz#c7eb17c93e112cb1086fa6d8e51fb0667b79a5f9\""
        }
    ],
    "stats": {
        "total": 191,
        "additions": 115,
        "deletions": 76
    }
}