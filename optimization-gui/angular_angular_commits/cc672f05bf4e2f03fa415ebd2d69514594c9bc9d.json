{
    "author": "crisbeto",
    "message": "feat(compiler): add support for shorthand property declarations in templates (#42421)\n\nAdds support for shorthand property declarations inside Angular templates. E.g. doing `{foo, bar}` instead of `{foo: foo, bar: bar}`.\n\nFixes #10277.\n\nPR Close #42421",
    "sha": "cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
    "files": [
        {
            "sha": "696b425bbc430c9ecc8e5827da063fdde9860ca5",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/template_symbol_builder.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 3,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftemplate_symbol_builder.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftemplate_symbol_builder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftemplate_symbol_builder.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {AST, ASTWithSource, BindingPipe, MethodCall, PropertyWrite, SafeMethodCall, SafePropertyRead, TmplAstBoundAttribute, TmplAstBoundEvent, TmplAstElement, TmplAstNode, TmplAstReference, TmplAstTemplate, TmplAstTextAttribute, TmplAstVariable} from '@angular/compiler';\n+import {AST, ASTWithSource, BindingPipe, MethodCall, PropertyRead, PropertyWrite, SafeMethodCall, SafePropertyRead, TmplAstBoundAttribute, TmplAstBoundEvent, TmplAstElement, TmplAstNode, TmplAstReference, TmplAstTemplate, TmplAstTextAttribute, TmplAstVariable} from '@angular/compiler';\n import * as ts from 'typescript';\n \n import {AbsoluteFsPath} from '../../file_system';\n@@ -482,8 +482,20 @@ export class SymbolBuilder {\n         expression.nameSpan :\n         expression.sourceSpan;\n \n-    let node = findFirstMatchingNode(\n-        this.typeCheckBlock, {withSpan, filter: (n: ts.Node): n is ts.Node => true});\n+    let node: ts.Node|null = null;\n+\n+    // Property reads in templates usually map to a `PropertyAccessExpression`\n+    // (e.g. `ctx.foo`) so try looking for one first.\n+    if (expression instanceof PropertyRead) {\n+      node = findFirstMatchingNode(\n+          this.typeCheckBlock, {withSpan, filter: ts.isPropertyAccessExpression});\n+    }\n+\n+    // Otherwise fall back to searching for any AST node.\n+    if (node === null) {\n+      node = findFirstMatchingNode(this.typeCheckBlock, {withSpan, filter: anyNodeFilter});\n+    }\n+\n     if (node === null) {\n       return null;\n     }\n@@ -560,3 +572,8 @@ export class SymbolBuilder {\n     }\n   }\n }\n+\n+/** Filter predicate function that matches any AST node. */\n+function anyNodeFilter(n: ts.Node): n is ts.Node {\n+  return true;\n+}"
        },
        {
            "sha": "42914425a5d23c062e280ebc0ce6da7cd2d62a7d",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/diagnostics_spec.ts",
            "status": "modified",
            "additions": 44,
            "deletions": 0,
            "changes": 44,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fdiagnostics_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fdiagnostics_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fdiagnostics_spec.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -462,6 +462,50 @@ class TestComponent {\n         `TestComponent.html(4, 18): Property 'heihgt' does not exist on type 'TestComponent'. Did you mean 'height'?`,\n       ]);\n     });\n+\n+    it('works for shorthand property declarations', () => {\n+      const messages = diagnose(\n+          `<div dir [input]=\"{a, b: 2}\"></div>`, `\n+        class Dir {\n+          input: {a: string, b: number};\n+        }\n+        class TestComponent {\n+          a: number;\n+        }`,\n+          [{\n+            type: 'directive',\n+            name: 'Dir',\n+            selector: '[dir]',\n+            exportAs: ['dir'],\n+            inputs: {input: 'input'},\n+          }]);\n+\n+      expect(messages).toEqual(\n+          [`TestComponent.html(1, 20): Type 'number' is not assignable to type 'string'.`]);\n+    });\n+\n+    it('works for shorthand property declarations referring to template variables', () => {\n+      const messages = diagnose(\n+          `\n+          <span #span></span>\n+          <div dir [input]=\"{span, b: 2}\"></div>\n+        `,\n+          `\n+          class Dir {\n+            input: {span: string, b: number};\n+          }\n+          class TestComponent {}`,\n+          [{\n+            type: 'directive',\n+            name: 'Dir',\n+            selector: '[dir]',\n+            exportAs: ['dir'],\n+            inputs: {input: 'input'},\n+          }]);\n+\n+      expect(messages).toEqual(\n+          [`TestComponent.html(3, 30): Type 'HTMLElement' is not assignable to type 'string'.`]);\n+    });\n   });\n \n   describe('method call spans', () => {"
        },
        {
            "sha": "3507d8952cab802eedf52862c139f3869e797de6",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/span_comments_spec.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -42,6 +42,15 @@ describe('type check blocks diagnostics', () => {\n               '(ctx).m /*3,4*/({ \"foo\": ((ctx).a /*11,12*/) /*11,12*/, \"bar\": ((ctx).b /*19,20*/) /*19,20*/ } /*5,21*/) /*3,22*/');\n     });\n \n+    it('should annotate literal map expressions with shorthand declarations', () => {\n+      // The additional method call is present to avoid that the object literal is emitted as\n+      // statement, which would wrap it into parenthesis that clutter the expected output.\n+      const TEMPLATE = '{{ m({a, b}) }}';\n+      expect(tcbWithSpans(TEMPLATE))\n+          .toContain(\n+              '((ctx).m /*3,4*/({ \"a\": ((ctx).a /*6,7*/) /*6,7*/, \"b\": ((ctx).b /*9,10*/) /*9,10*/ } /*5,11*/) /*3,12*/)');\n+    });\n+\n     it('should annotate literal array expressions', () => {\n       const TEMPLATE = '{{ [a, b] }}';\n       expect(tcbWithSpans(TEMPLATE))"
        },
        {
            "sha": "8c133e94d1f123a084c407d6756b14aaf461af56",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/type_checker__get_symbol_of_template_node_spec.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_checker__get_symbol_of_template_node_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_checker__get_symbol_of_template_node_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_checker__get_symbol_of_template_node_spec.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -668,12 +668,16 @@ runInEachFileSystem(() => {\n           const fileName = absoluteFrom('/main.ts');\n           const templateString = `\n           {{ [1, 2, 3] }}\n-          {{ { hello: \"world\" } }}`;\n+          {{ { hello: \"world\" } }}\n+          {{ { foo } }}`;\n           const testValues = setup([\n             {\n               fileName,\n               templates: {'Cmp': templateString},\n-              source: `export class Cmp {}`,\n+              source: `\n+                type Foo {name: string;}\n+                export class Cmp {foo: Foo;}\n+              `,\n             },\n           ]);\n           templateTypeChecker = testValues.templateTypeChecker;\n@@ -701,6 +705,15 @@ runInEachFileSystem(() => {\n           expect(program.getTypeChecker().typeToString(symbol.tsType))\n               .toEqual('{ hello: string; }');\n         });\n+\n+        it('literal map shorthand property', () => {\n+          const shorthandProp =\n+              (interpolation.expressions[2] as LiteralMap).values[0] as PropertyRead;\n+          const symbol = templateTypeChecker.getSymbolOfNode(shorthandProp, cmp)!;\n+          assertExpressionSymbol(symbol);\n+          expect(program.getTypeChecker().symbolToString(symbol.tsSymbol!)).toEqual('foo');\n+          expect(program.getTypeChecker().typeToString(symbol.tsType)).toEqual('Foo');\n+        });\n       });\n \n       describe('pipes', () => {"
        },
        {
            "sha": "31bd342a118071508a70458dddc51fcceaa40df3",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_template/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 51,
            "deletions": 0,
            "changes": 51,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_template%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_template%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_template%2FGOLDEN_PARTIAL.js?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -870,3 +870,54 @@ export declare class MyModule {\n     static ɵinj: i0.ɵɵInjectorDeclaration<MyModule>;\n }\n \n+/****************************************************************************************************\n+ * PARTIAL FILE: shorthand_property_declaration.js\n+ ****************************************************************************************************/\n+import { Component, NgModule } from '@angular/core';\n+import * as i0 from \"@angular/core\";\n+export class MyComponent {\n+    constructor() {\n+        this.a = 1;\n+        this.c = 3;\n+    }\n+    _handleClick(_value) { }\n+}\n+MyComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });\n+MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"ng-component\", ngImport: i0, template: `\n+    <div (click)=\"_handleClick({a, b: 2, c})\"></div>\n+  `, isInline: true });\n+i0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyComponent, decorators: [{\n+            type: Component,\n+            args: [{\n+                    template: `\n+    <div (click)=\"_handleClick({a, b: 2, c})\"></div>\n+  `\n+                }]\n+        }] });\n+export class MyModule {\n+}\n+MyModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\n+MyModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule, declarations: [MyComponent] });\n+MyModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule });\n+i0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyModule, decorators: [{\n+            type: NgModule,\n+            args: [{ declarations: [MyComponent] }]\n+        }] });\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: shorthand_property_declaration.d.ts\n+ ****************************************************************************************************/\n+import * as i0 from \"@angular/core\";\n+export declare class MyComponent {\n+    a: number;\n+    c: number;\n+    _handleClick(_value: any): void;\n+    static ɵfac: i0.ɵɵFactoryDeclaration<MyComponent, never>;\n+    static ɵcmp: i0.ɵɵComponentDeclaration<MyComponent, \"ng-component\", never, {}, {}, never, never>;\n+}\n+export declare class MyModule {\n+    static ɵfac: i0.ɵɵFactoryDeclaration<MyModule, never>;\n+    static ɵmod: i0.ɵɵNgModuleDeclaration<MyModule, [typeof MyComponent], never, never>;\n+    static ɵinj: i0.ɵɵInjectorDeclaration<MyModule>;\n+}\n+"
        },
        {
            "sha": "602379b99f737ed24e182534b5c321a73e782c3b",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_template/TEST_CASES.json",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_template%2FTEST_CASES.json",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_template%2FTEST_CASES.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_template%2FTEST_CASES.json?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -269,6 +269,23 @@\n           \"failureMessage\": \"Incorrect template\"\n         }\n       ]\n+    },\n+    {\n+      \"description\": \"should handle shorthand property declarations in templates\",\n+      \"inputFiles\": [\n+        \"shorthand_property_declaration.ts\"\n+      ],\n+      \"expectations\": [\n+        {\n+          \"files\": [\n+            {\n+              \"expected\": \"shorthand_property_declaration_template.js\",\n+              \"generated\": \"shorthand_property_declaration.js\"\n+            }\n+          ],\n+          \"failureMessage\": \"Incorrect template\"\n+        }\n+      ]\n     }\n   ]\n }"
        },
        {
            "sha": "e2a673de481a86cc70681496e77f647fe6824355",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_template/shorthand_property_declaration.ts",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_template%2Fshorthand_property_declaration.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_template%2Fshorthand_property_declaration.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_template%2Fshorthand_property_declaration.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -0,0 +1,16 @@\n+import {Component, NgModule} from '@angular/core';\n+\n+@Component({\n+  template: `\n+    <div (click)=\"_handleClick({a, b: 2, c})\"></div>\n+  `\n+})\n+export class MyComponent {\n+  a = 1;\n+  c = 3;\n+  _handleClick(_value: any) {}\n+}\n+\n+@NgModule({declarations: [MyComponent]})\n+export class MyModule {\n+}"
        },
        {
            "sha": "03de9b391b551b1c0f9b0f49d6106a2d4aa80f66",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_template/shorthand_property_declaration_template.js",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_template%2Fshorthand_property_declaration_template.js",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_template%2Fshorthand_property_declaration_template.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_template%2Fshorthand_property_declaration_template.js?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -0,0 +1,13 @@\n+template: function MyComponent_Template(rf, ctx) {\n+  if (rf & 1) {\n+    …\n+    i0.ɵɵlistener(\"click\", function MyComponent_Template_div_click_0_listener() {\n+      return ctx._handleClick({\n+        a: ctx.a,\n+        b: 2,\n+        c: ctx.c\n+      });\n+    });\n+    …\n+  }\n+}"
        },
        {
            "sha": "66e5bc2c0639ff5d8f0760ea6234f87506c8347d",
            "filename": "packages/compiler/src/expression_parser/parser.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fexpression_parser%2Fparser.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -929,11 +929,23 @@ export class _ParseAST {\n     if (!this.consumeOptionalCharacter(chars.$RBRACE)) {\n       this.rbracesExpected++;\n       do {\n+        const keyStart = this.inputIndex;\n         const quoted = this.next.isString();\n         const key = this.expectIdentifierOrKeywordOrString();\n         keys.push({key, quoted});\n-        this.expectCharacter(chars.$COLON);\n-        values.push(this.parsePipe());\n+\n+        // Properties with quoted keys can't use the shorthand syntax.\n+        if (quoted) {\n+          this.expectCharacter(chars.$COLON);\n+          values.push(this.parsePipe());\n+        } else if (this.consumeOptionalCharacter(chars.$COLON)) {\n+          values.push(this.parsePipe());\n+        } else {\n+          const span = this.span(keyStart);\n+          const sourceSpan = this.sourceSpan(keyStart);\n+          values.push(new PropertyRead(\n+              span, sourceSpan, sourceSpan, new ImplicitReceiver(span, sourceSpan), key));\n+        }\n       } while (this.consumeOptionalCharacter(chars.$COMMA));\n       this.rbracesExpected--;\n       this.expectCharacter(chars.$RBRACE);"
        },
        {
            "sha": "444995483bea8ec2e74cc6ea81f5688099332f05",
            "filename": "packages/compiler/test/expression_parser/parser_spec.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fexpression_parser%2Fparser_spec.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -122,6 +122,23 @@ describe('parser', () => {\n         expectActionError('{1234:0}', 'expected identifier, keyword, or string');\n         expectActionError('{#myField:0}', 'expected identifier, keyword or string');\n       });\n+\n+      it('should parse property shorthand declarations', () => {\n+        checkAction('{a, b, c}', '{a: a, b: b, c: c}');\n+        checkAction('{a: 1, b}', '{a: 1, b: b}');\n+        checkAction('{a, b: 1}', '{a: a, b: 1}');\n+        checkAction('{a: 1, b, c: 2}', '{a: 1, b: b, c: 2}');\n+      });\n+\n+      it('should not allow property shorthand declaration on quoted properties', () => {\n+        expectActionError('{\"a-b\"}', 'expected : at column 7');\n+      });\n+\n+      it('should not infer invalid identifiers as shorthand property declarations', () => {\n+        expectActionError('{a.b}', 'expected } at column 3');\n+        expectActionError('{a[\"b\"]}', 'expected } at column 3');\n+        expectActionError('{1234}', ' expected identifier, keyword, or string at column 2');\n+      });\n     });\n \n     describe('member access', () => {"
        },
        {
            "sha": "9d89aaeb35e01bbdfd9c895ed8ca2d8a96095cd9",
            "filename": "packages/compiler/test/render3/r3_ast_absolute_span_spec.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_ast_absolute_span_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_ast_absolute_span_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_ast_absolute_span_spec.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -360,4 +360,15 @@ describe('expression AST absolute source spans', () => {\n       expect(spans).toContain(['nestedPlaceholder', new AbsoluteSourceSpan(89, 106)]);\n     });\n   });\n+\n+  describe('object literal', () => {\n+    it('is correct for object literals with shorthand property declarations', () => {\n+      const spans =\n+          humanizeExpressionSource(parse('<div (click)=\"test({a: 1, b, c: 3, foo})\"></div>').nodes);\n+\n+      expect(spans).toContain(['{a: 1, b: b, c: 3, foo: foo}', new AbsoluteSourceSpan(19, 39)]);\n+      expect(spans).toContain(['b', new AbsoluteSourceSpan(26, 27)]);\n+      expect(spans).toContain(['foo', new AbsoluteSourceSpan(35, 38)]);\n+    });\n+  });\n });"
        },
        {
            "sha": "ce00467707f1e60fbf88b8d3dcef0f9bcb682cb3",
            "filename": "packages/core/test/acceptance/integration_spec.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fintegration_spec.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -2041,6 +2041,26 @@ describe('acceptance integration tests', () => {\n     expect(fixture.nativeElement.innerHTML).toContain('<text>Hello</text>');\n   });\n \n+  it('should handle shorthand property declarations in templates', () => {\n+    @Directive({selector: '[my-dir]'})\n+    class Dir {\n+      @Input('my-dir') value: any;\n+    }\n+\n+    @Component({template: `<div [my-dir]=\"{a, b: 2, someProp}\"></div>`})\n+    class App {\n+      @ViewChild(Dir) directive!: Dir;\n+      a = 1;\n+      someProp = 3;\n+    }\n+\n+    TestBed.configureTestingModule({declarations: [App, Dir]});\n+    const fixture = TestBed.createComponent(App);\n+    fixture.detectChanges();\n+\n+    expect(fixture.componentInstance.directive.value).toEqual({a: 1, b: 2, someProp: 3});\n+  });\n+\n   describe('tView.firstUpdatePass', () => {\n     function isFirstUpdatePass() {\n       const lView = getLView();"
        },
        {
            "sha": "b7d7efbd10a3784761cc4071e2f03556b79ab632",
            "filename": "packages/language-service/ivy/test/legacy/definitions_spec.ts",
            "status": "modified",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Flanguage-service%2Fivy%2Ftest%2Flegacy%2Fdefinitions_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Flanguage-service%2Fivy%2Ftest%2Flegacy%2Fdefinitions_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Flegacy%2Fdefinitions_spec.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -458,6 +458,32 @@ describe('definitions', () => {\n       const definitionAndBoundSpan = ngLS.getDefinitionAndBoundSpan(APP_COMPONENT, position);\n       expect(definitionAndBoundSpan).toBeUndefined();\n     });\n+\n+    it('should work for object literals with shorthand declarations in an action', () => {\n+      const definitions = getDefinitionsAndAssertBoundSpan({\n+        templateOverride: `<div (click)=\"setHero({na¦me, id: 1})\"></div>`,\n+        expectedSpanText: 'name',\n+      });\n+      expect(definitions!.length).toEqual(1);\n+\n+      const [def] = definitions;\n+      expect(def.textSpan).toEqual('name');\n+      expect(def.fileName).toContain('/app/app.component.ts');\n+      expect(def.contextSpan).toContain(`name = 'Frodo';`);\n+    });\n+\n+    it('should work for object literals with shorthand declarations in a data binding', () => {\n+      const definitions = getDefinitionsAndAssertBoundSpan({\n+        templateOverride: `{{ {na¦me} }}`,\n+        expectedSpanText: 'name',\n+      });\n+      expect(definitions!.length).toEqual(1);\n+\n+      const [def] = definitions;\n+      expect(def.textSpan).toEqual('name');\n+      expect(def.fileName).toContain('/app/app.component.ts');\n+      expect(def.contextSpan).toContain(`name = 'Frodo';`);\n+    });\n   });\n \n   describe('external resources', () => {"
        },
        {
            "sha": "91d53adc73bf9352c9a96e1affb9c72f405070b7",
            "filename": "packages/language-service/ivy/test/legacy/template_target_spec.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Flanguage-service%2Fivy%2Ftest%2Flegacy%2Ftemplate_target_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Flanguage-service%2Fivy%2Ftest%2Flegacy%2Ftemplate_target_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Flegacy%2Ftemplate_target_spec.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -622,6 +622,38 @@ describe('getTargetAtPosition for expression AST', () => {\n     expect(isExpressionNode(node!)).toBe(true);\n     expect(node).toBeInstanceOf(e.Conditional);\n   });\n+\n+  describe('object literal shorthand', () => {\n+    it('should locate on literal with one shorthand property', () => {\n+      const {errors, nodes, position} = parse(`{{ {va¦l1} }}`);\n+      expect(errors).toBe(null);\n+      const {context} = getTargetAtPosition(nodes, position)!;\n+      expect(context.kind).toBe(TargetNodeKind.RawExpression);\n+      const {node} = context as SingleNodeTarget;\n+      expect(node).toBeInstanceOf(e.PropertyRead);\n+      expect((node as e.PropertyRead).name).toBe('val1');\n+    });\n+\n+    it('should locate on literal with multiple shorthand properties', () => {\n+      const {errors, nodes, position} = parse(`{{ {val1, va¦l2} }}`);\n+      expect(errors).toBe(null);\n+      const {context} = getTargetAtPosition(nodes, position)!;\n+      expect(context.kind).toBe(TargetNodeKind.RawExpression);\n+      const {node} = context as SingleNodeTarget;\n+      expect(node).toBeInstanceOf(e.PropertyRead);\n+      expect((node as e.PropertyRead).name).toBe('val2');\n+    });\n+\n+    it('should locale on property with mixed shorthand and regular properties', () => {\n+      const {errors, nodes, position} = parse(`{{ {val1: 'val1', va¦l2} }}`);\n+      expect(errors).toBe(null);\n+      const {context} = getTargetAtPosition(nodes, position)!;\n+      expect(context.kind).toBe(TargetNodeKind.RawExpression);\n+      const {node} = context as SingleNodeTarget;\n+      expect(node).toBeInstanceOf(e.PropertyRead);\n+      expect((node as e.PropertyRead).name).toBe('val2');\n+    });\n+  });\n });\n \n describe('findNodeAtPosition for microsyntax expression', () => {"
        },
        {
            "sha": "ab18e13e126af15aec04fa4e784661382545c29a",
            "filename": "packages/language-service/ivy/test/quick_info_spec.ts",
            "status": "modified",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Flanguage-service%2Fivy%2Ftest%2Fquick_info_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Flanguage-service%2Fivy%2Ftest%2Fquick_info_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fquick_info_spec.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -500,6 +500,48 @@ describe('quick info', () => {\n         expect(documentation).toBe('This is the title of the `AppCmp` Component.');\n       });\n     });\n+\n+    it('should work for object literal with shorthand property declarations', () => {\n+      initMockFileSystem('Native');\n+      env = LanguageServiceTestEnv.setup();\n+      project = env.addProject(\n+          'test', {\n+            'app.ts': `\n+            import {Component, NgModule} from '@angular/core';\n+            import {CommonModule} from '@angular/common';\n+\n+            @Component({\n+              selector: 'some-cmp',\n+              templateUrl: './app.html',\n+            })\n+            export class SomeCmp {\n+              val1 = 'one';\n+              val2 = 2;\n+\n+              doSomething(obj: {val1: string, val2: number}) {}\n+            }\n+\n+            @NgModule({\n+              declarations: [SomeCmp],\n+              imports: [CommonModule],\n+            })\n+            export class AppModule{\n+            }\n+          `,\n+            'app.html': `{{doSomething({val1, val2})}}`,\n+          },\n+          {strictTemplates: true});\n+      env.expectNoSourceDiagnostics();\n+      project.expectNoSourceDiagnostics();\n+\n+      const template = project.openFile('app.html');\n+      template.moveCursorToText('val¦1');\n+      const quickInfo = template.getQuickInfoAtPosition();\n+      expect(toText(quickInfo!.displayParts)).toEqual('(property) SomeCmp.val1: string');\n+      template.moveCursorToText('val¦2');\n+      const quickInfo2 = template.getQuickInfoAtPosition();\n+      expect(toText(quickInfo2!.displayParts)).toEqual('(property) SomeCmp.val2: number');\n+    });\n   });\n \n   describe('generics', () => {"
        },
        {
            "sha": "c732dec80ef8971d325177104315cd4e864573db",
            "filename": "packages/language-service/ivy/test/references_and_rename_spec.ts",
            "status": "modified",
            "additions": 39,
            "deletions": 3,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Flanguage-service%2Fivy%2Ftest%2Freferences_and_rename_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Flanguage-service%2Fivy%2Ftest%2Freferences_and_rename_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Freferences_and_rename_spec.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -235,7 +235,7 @@ describe('find references and rename locations', () => {\n \n     beforeEach(() => {\n       const files = {\n-        'app.ts': ` \n+        'app.ts': `\n           import {Component} from '@angular/core';\n \n           @Component({template: '<div (click)=\"title = otherTitle\"></div>' })\n@@ -617,7 +617,7 @@ describe('find references and rename locations', () => {\n       let file: OpenBuffer;\n       beforeEach(() => {\n         const files = {\n-          'app.ts': ` \n+          'app.ts': `\n           import {Component} from '@angular/core';\n \n           @Component({template: '<div *ngFor=\"let hero of heroes; let iRef = index\">{{iRef}}</div>'})\n@@ -739,6 +739,42 @@ describe('find references and rename locations', () => {\n         assertTextSpans(renameLocations, ['name']);\n       });\n     });\n+\n+    describe('when cursor is on property read of variable', () => {\n+      let file: OpenBuffer;\n+      beforeEach(() => {\n+        const files = {\n+          'app.ts': `\n+            import {Component} from '@angular/core';\n+\n+            @Component({template: '<div (click)=\"setHero({name})\"></div>'})\n+            export class AppCmp {\n+              name = 'Frodo';\n+\n+              setHero(hero: {name: string}) {}\n+            }`\n+        };\n+\n+        env = LanguageServiceTestEnv.setup();\n+        const project = createModuleAndProjectWithDeclarations(env, 'test', files);\n+        file = project.openFile('app.ts');\n+        file.moveCursorToText('{na¦me}');\n+      });\n+\n+      it('should find references', () => {\n+        const refs = getReferencesAtPosition(file)!;\n+        expect(refs.length).toBe(2);\n+        assertFileNames(refs, ['app.ts']);\n+        assertTextSpans(refs, ['name']);\n+      });\n+\n+      it('should find rename locations', () => {\n+        const renameLocations = getRenameLocationsAtPosition(file)!;\n+        expect(renameLocations.length).toBe(2);\n+        assertFileNames(renameLocations, ['app.ts']);\n+        assertTextSpans(renameLocations, ['name']);\n+      });\n+    });\n   });\n \n   describe('pipes', () => {\n@@ -1245,7 +1281,7 @@ describe('find references and rename locations', () => {\n       }`,\n       'app.ts': `\n       import {Component} from '@angular/core';\n-  \n+\n       @Component({template: '<div string-model [(model)]=\"title\"></div>'})\n       export class AppCmp {\n         title = 'title';"
        },
        {
            "sha": "67a24e0da1031df790c18731a7385e1cde878daf",
            "filename": "packages/language-service/test/project/app/app.component.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Flanguage-service%2Ftest%2Fproject%2Fapp%2Fapp.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/cc672f05bf4e2f03fa415ebd2d69514594c9bc9d/packages%2Flanguage-service%2Ftest%2Fproject%2Fapp%2Fapp.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Ftest%2Fproject%2Fapp%2Fapp.component.ts?ref=cc672f05bf4e2f03fa415ebd2d69514594c9bc9d",
            "patch": "@@ -48,7 +48,11 @@ export class AppComponent {\n   constNames = [{name: 'name'}] as const;\n   private myField = 'My Field';\n   strOrNumber: string|number = '';\n+  name = 'Frodo';\n   setTitle(newTitle: string) {\n     this.title = newTitle;\n   }\n+  setHero(obj: Hero) {\n+    this.hero = obj;\n+  }\n }"
        }
    ],
    "stats": {
        "total": 400,
        "additions": 390,
        "deletions": 10
    }
}