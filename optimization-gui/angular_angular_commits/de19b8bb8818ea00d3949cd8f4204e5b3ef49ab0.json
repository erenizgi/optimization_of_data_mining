{
    "author": "gkalpak",
    "message": "fix(docs-infra): do not process generated nodes for auto-linking (#41709)\n\nWhile generating the docs, when a `<code>` element is inspected for\nauto-linking, the `autoLinkCode` Dgeni post-processor will break its\ncontents up into words and generate text nodes for those words that\nshould not be auto-linked.\n\nPreviously, our text node visitor would visit these generated text nodes\nand try to auto-link them too. As a result, it would unnecessarily\nprocess nodes that had already been checked (and could potentially\ngenerate links that would otherwise be ignored).\n\nYou can see an occurrence of this issue in the\n[Create the product list][1] section of the\n\"Getting started with Angular\" tutorial (look for `<a>`).\n\nThis commit fixes this by ensuring the visitor will skip the current\nnode and any nodes generated by `autoLinkCode`.\n\n[1]: https://v11.angular.io/start#create-the-product-list\n\nPR Close #41709",
    "sha": "de19b8bb8818ea00d3949cd8f4204e5b3ef49ab0",
    "files": [
        {
            "sha": "4fe687ffd19d8fa54ed6922be2fee11fd10bd96a",
            "filename": "aio/tools/transforms/angular-base-package/post-processors/auto-link-code.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/de19b8bb8818ea00d3949cd8f4204e5b3ef49ab0/aio%2Ftools%2Ftransforms%2Fangular-base-package%2Fpost-processors%2Fauto-link-code.js",
            "raw_url": "https://github.com/angular/angular/raw/de19b8bb8818ea00d3949cd8f4204e5b3ef49ab0/aio%2Ftools%2Ftransforms%2Fangular-base-package%2Fpost-processors%2Fauto-link-code.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fangular-base-package%2Fpost-processors%2Fauto-link-code.js?ref=de19b8bb8818ea00d3949cd8f4204e5b3ef49ab0",
            "patch": "@@ -63,6 +63,8 @@ module.exports = function autoLinkCode(getDocFromAlias) {\n             const nodes = getNodes(node, file);\n             // Replace the text node with the links and leftover text nodes\n             Array.prototype.splice.apply(parent.children, [index, 1].concat(nodes));\n+            // Do not visit this node's children or the newly added nodes\n+            return [visit.SKIP, index + nodes.length];\n           }\n         });\n       });"
        },
        {
            "sha": "cfd58ca55c347ca9d6464c724c9a3713f586210b",
            "filename": "aio/tools/transforms/angular-base-package/post-processors/auto-link-code.spec.js",
            "status": "modified",
            "additions": 22,
            "deletions": 1,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/de19b8bb8818ea00d3949cd8f4204e5b3ef49ab0/aio%2Ftools%2Ftransforms%2Fangular-base-package%2Fpost-processors%2Fauto-link-code.spec.js",
            "raw_url": "https://github.com/angular/angular/raw/de19b8bb8818ea00d3949cd8f4204e5b3ef49ab0/aio%2Ftools%2Ftransforms%2Fangular-base-package%2Fpost-processors%2Fauto-link-code.spec.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fangular-base-package%2Fpost-processors%2Fauto-link-code.spec.js?ref=de19b8bb8818ea00d3949cd8f4204e5b3ef49ab0",
            "patch": "@@ -110,11 +110,32 @@ describe('autoLinkCode post-processor', () => {\n             '{ xyz | <a href=\"a/b/myclass\" class=\"code-anchor\">myClass</a> } ' +\n             '{ xyz|<a href=\"a/b/myclass\" class=\"code-anchor\">myClass</a> } ' +\n             '<a href=\"a/b/myclass\" class=\"code-anchor\">MyClass</a> ' +\n-            '<a href=\"a/b/myclass\" class=\"code-anchor\">myClass</a> ' +\n+            'myClass ' +\n             'OtherClass|<a href=\"a/b/myclass\" class=\"code-anchor\">MyClass</a>' +\n             '</code>');\n   });\n \n+  it('should ignore generated nodes', () => {\n+    const filterAnchors = (docs, words, index) => (words[index].toLowerCase() === 'a') ? [] : docs;\n+    autoLinkCode.customFilters = [filterAnchors];\n+    autoLinkCode.docTypes = ['directive'];\n+\n+    aliasMap.addDoc({\n+      docType: 'directive',\n+      id: 'MyAnchorDirective',\n+      aliases: ['MyAnchorDirective', 'a'],\n+      path: 'a/b/my-anchor-directive',\n+    });\n+    const doc = {\n+      docType: 'test-doc',\n+      renderedContent: '<code>&#x3C;a></code>',\n+    };\n+\n+    processor.$process([doc]);\n+\n+    expect(doc.renderedContent).toBe('<code>&#x3C;a></code>');\n+  });\n+\n   it('should ignore code items that match an internal API doc', () => {\n     aliasMap.addDoc({\n       docType: 'class',"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 24,
        "deletions": 1
    }
}