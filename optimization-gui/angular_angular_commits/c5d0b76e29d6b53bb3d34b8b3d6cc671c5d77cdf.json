{
    "author": "gkalpak",
    "message": "refactor(service-worker): avoid unnecessary writes to cache when version fails (#43680)\n\nWhen an app version is detected as broken, the SW calls the\n`Driver#versionFailed()` method. Previously, this method would in turn\ncall the `Driver#sync()` method, which writes some metadata about the\nSW's state to the `ngsw:/:db:contol` cache. More specifically,\n`Driver#sync()` persists info about all known app versions, which one is\nthe latest and also what version each client is assigned to.\n\nHowever, no relevant info is changed inside `Driver#versionFailed()`, so\nthe call to `Driver#sync()` is redundant (since there are no changes\nthat need to be synced with the cache). This is a left-over from\nbefore #43518, when `Driver#versionFailed()` used to update version\nassignments and thus did require synchronization with the cache.\n\nThis commit removes the redundant `Driver#sync()` call to avoid an\nunnecessary write to the cache.\n\nPR Close #43680",
    "sha": "c5d0b76e29d6b53bb3d34b8b3d6cc671c5d77cdf",
    "files": [
        {
            "sha": "d77c4eebdfcfd5280fe852c8173cbe2ca3ed4609",
            "filename": "packages/service-worker/worker/src/driver.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/c5d0b76e29d6b53bb3d34b8b3d6cc671c5d77cdf/packages%2Fservice-worker%2Fworker%2Fsrc%2Fdriver.ts",
            "raw_url": "https://github.com/angular/angular/raw/c5d0b76e29d6b53bb3d34b8b3d6cc671c5d77cdf/packages%2Fservice-worker%2Fworker%2Fsrc%2Fdriver.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Fsrc%2Fdriver.ts?ref=c5d0b76e29d6b53bb3d34b8b3d6cc671c5d77cdf",
            "patch": "@@ -822,14 +822,6 @@ export class Driver implements Debuggable, UpdateSource {\n       // but caches continue to be valid for previous versions. This is unfortunate but unavoidable.\n       this.state = DriverReadyState.EXISTING_CLIENTS_ONLY;\n       this.stateMessage = `Degraded due to: ${errorToString(err)}`;\n-\n-      try {\n-        await this.sync();\n-      } catch (err2) {\n-        // We are already in a bad state. No need to make things worse.\n-        // Just log the error and move on.\n-        this.debugger.log(err2, `Driver.versionFailed(${err.message || err})`);\n-      }\n     }\n   }\n "
        }
    ],
    "stats": {
        "total": 8,
        "additions": 0,
        "deletions": 8
    }
}