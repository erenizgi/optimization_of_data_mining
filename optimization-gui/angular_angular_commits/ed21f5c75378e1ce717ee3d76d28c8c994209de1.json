{
    "author": "crisbeto",
    "message": "feat(common): add injector input to ngTemplateOutlet (#44761)\n\nImplements the new `injector` option from #44666 into `ngTemplateOutlet`.\n\nPR Close #44761",
    "sha": "ed21f5c75378e1ce717ee3d76d28c8c994209de1",
    "files": [
        {
            "sha": "d5079133cd4340e1e571f7deb40804fa51973414",
            "filename": "goldens/public-api/common/common.md",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/ed21f5c75378e1ce717ee3d76d28c8c994209de1/goldens%2Fpublic-api%2Fcommon%2Fcommon.md",
            "raw_url": "https://github.com/angular/angular/raw/ed21f5c75378e1ce717ee3d76d28c8c994209de1/goldens%2Fpublic-api%2Fcommon%2Fcommon.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fcommon%2Fcommon.md?ref=ed21f5c75378e1ce717ee3d76d28c8c994209de1",
            "patch": "@@ -581,8 +581,9 @@ export class NgTemplateOutlet implements OnChanges {\n     ngOnChanges(changes: SimpleChanges): void;\n     ngTemplateOutlet: TemplateRef<any> | null;\n     ngTemplateOutletContext: Object | null;\n+    ngTemplateOutletInjector: Injector | null;\n     // (undocumented)\n-    static ɵdir: i0.ɵɵDirectiveDeclaration<NgTemplateOutlet, \"[ngTemplateOutlet]\", never, { \"ngTemplateOutletContext\": \"ngTemplateOutletContext\"; \"ngTemplateOutlet\": \"ngTemplateOutlet\"; }, {}, never>;\n+    static ɵdir: i0.ɵɵDirectiveDeclaration<NgTemplateOutlet, \"[ngTemplateOutlet]\", never, { \"ngTemplateOutletContext\": \"ngTemplateOutletContext\"; \"ngTemplateOutlet\": \"ngTemplateOutlet\"; \"ngTemplateOutletInjector\": \"ngTemplateOutletInjector\"; }, {}, never>;\n     // (undocumented)\n     static ɵfac: i0.ɵɵFactoryDeclaration<NgTemplateOutlet, never>;\n }"
        },
        {
            "sha": "cd3da1dc0637738a93979bf171f57fc42402cea6",
            "filename": "packages/common/src/directives/ng_template_outlet.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 4,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/ed21f5c75378e1ce717ee3d76d28c8c994209de1/packages%2Fcommon%2Fsrc%2Fdirectives%2Fng_template_outlet.ts",
            "raw_url": "https://github.com/angular/angular/raw/ed21f5c75378e1ce717ee3d76d28c8c994209de1/packages%2Fcommon%2Fsrc%2Fdirectives%2Fng_template_outlet.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fsrc%2Fdirectives%2Fng_template_outlet.ts?ref=ed21f5c75378e1ce717ee3d76d28c8c994209de1",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Directive, EmbeddedViewRef, Input, OnChanges, SimpleChange, SimpleChanges, TemplateRef, ViewContainerRef} from '@angular/core';\n+import {Directive, EmbeddedViewRef, Injector, Input, OnChanges, SimpleChanges, TemplateRef, ViewContainerRef} from '@angular/core';\n \n /**\n  * @ngModule CommonModule\n@@ -49,6 +49,9 @@ export class NgTemplateOutlet implements OnChanges {\n    */\n   @Input() public ngTemplateOutlet: TemplateRef<any>|null = null;\n \n+  /** Injector to be used within the embedded view. */\n+  @Input() public ngTemplateOutletInjector: Injector|null = null;\n+\n   constructor(private _viewContainerRef: ViewContainerRef) {}\n \n   ngOnChanges(changes: SimpleChanges) {\n@@ -59,9 +62,17 @@ export class NgTemplateOutlet implements OnChanges {\n         viewContainerRef.remove(viewContainerRef.indexOf(this._viewRef));\n       }\n \n-      this._viewRef = this.ngTemplateOutlet ?\n-          viewContainerRef.createEmbeddedView(this.ngTemplateOutlet, this.ngTemplateOutletContext) :\n-          null;\n+      if (this.ngTemplateOutlet) {\n+        const {\n+          ngTemplateOutlet: template,\n+          ngTemplateOutletContext: context,\n+          ngTemplateOutletInjector: injector\n+        } = this;\n+        this._viewRef = viewContainerRef.createEmbeddedView(\n+            template, context, injector ? {injector} : undefined);\n+      } else {\n+        this._viewRef = null;\n+      }\n     } else if (\n         this._viewRef && changes['ngTemplateOutletContext'] && this.ngTemplateOutletContext) {\n       this._viewRef.context = this.ngTemplateOutletContext;"
        },
        {
            "sha": "485cf4007e82c1a4b924f95590ba4751a579bbaf",
            "filename": "packages/common/test/directives/ng_template_outlet_spec.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 2,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/ed21f5c75378e1ce717ee3d76d28c8c994209de1/packages%2Fcommon%2Ftest%2Fdirectives%2Fng_template_outlet_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ed21f5c75378e1ce717ee3d76d28c8c994209de1/packages%2Fcommon%2Ftest%2Fdirectives%2Fng_template_outlet_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Ftest%2Fdirectives%2Fng_template_outlet_spec.ts?ref=ed21f5c75378e1ce717ee3d76d28c8c994209de1",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import {CommonModule} from '@angular/common';\n-import {Component, ContentChildren, Directive, Injectable, NO_ERRORS_SCHEMA, OnDestroy, QueryList, TemplateRef} from '@angular/core';\n+import {Component, ContentChildren, Directive, Inject, Injectable, InjectionToken, Injector, NO_ERRORS_SCHEMA, OnDestroy, QueryList, TemplateRef} from '@angular/core';\n import {ComponentFixture, TestBed, waitForAsync} from '@angular/core/testing';\n import {expect} from '@angular/platform-browser/testing/src/matchers';\n \n@@ -29,7 +29,13 @@ describe('NgTemplateOutlet', () => {\n \n   beforeEach(() => {\n     TestBed.configureTestingModule({\n-      declarations: [TestComponent, CaptureTplRefs, DestroyableCmpt, MultiContextComponent],\n+      declarations: [\n+        TestComponent,\n+        CaptureTplRefs,\n+        DestroyableCmpt,\n+        MultiContextComponent,\n+        InjectValueComponent,\n+      ],\n       imports: [CommonModule],\n       providers: [DestroyedSpyService]\n     });\n@@ -262,8 +268,19 @@ describe('NgTemplateOutlet', () => {\n     expect(componentInstance.context1).toEqual({name: 'two'});\n     expect(componentInstance.context2).toEqual({name: 'one'});\n   });\n+\n+  it('should be able to specify an injector', waitForAsync(() => {\n+       const template = `<ng-template #tpl><inject-value></inject-value></ng-template>` +\n+           `<ng-container *ngTemplateOutlet=\"tpl; injector: injector\"></ng-container>`;\n+       fixture = createTestComponent(template);\n+       fixture.componentInstance.injector =\n+           Injector.create({providers: [{provide: templateToken, useValue: 'world'}]});\n+       detectChangesAndExpectText('Hello world');\n+     }));\n });\n \n+const templateToken = new InjectionToken<string>('templateToken');\n+\n @Injectable()\n class DestroyedSpyService {\n   destroyed = false;\n@@ -290,6 +307,15 @@ class TestComponent {\n   currentTplRef!: TemplateRef<any>;\n   context: any = {foo: 'bar'};\n   value = 'bar';\n+  injector: Injector|null = null;\n+}\n+\n+@Component({\n+  selector: 'inject-value',\n+  template: 'Hello {{tokenValue}}',\n+})\n+class InjectValueComponent {\n+  constructor(@Inject(templateToken) public tokenValue: string) {}\n }\n \n @Component({"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 45,
        "deletions": 7
    }
}