{
    "author": "trotyl",
    "message": "fix(router): better ngZone checking for warning (#25839)\n\nDo not warn that navigation was triggered outside Angular zone if the\nRouter was created outside Angular zone in the first place.\n\nCloses #25837\n\nPR Close #25839",
    "sha": "76954688b18f1509d4c9cca41b8e113ee423d4db",
    "files": [
        {
            "sha": "d3e9fd040ac37122b451f998ebad25fd941de50f",
            "filename": "packages/router/src/router.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/76954688b18f1509d4c9cca41b8e113ee423d4db/packages%2Frouter%2Fsrc%2Frouter.ts",
            "raw_url": "https://github.com/angular/angular/raw/76954688b18f1509d4c9cca41b8e113ee423d4db/packages%2Frouter%2Fsrc%2Frouter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Frouter.ts?ref=76954688b18f1509d4c9cca41b8e113ee423d4db",
            "patch": "@@ -491,7 +491,7 @@ export class Router {\n     this.ngModule = injector.get(NgModuleRef);\n     this.console = injector.get(Console);\n     const ngZone = injector.get(NgZone);\n-    this.isNgZoneEnabled = ngZone instanceof NgZone;\n+    this.isNgZoneEnabled = ngZone instanceof NgZone && NgZone.isInAngularZone();\n \n     this.resetConfig(config);\n     this.currentUrlTree = createEmptyUrlTree();"
        },
        {
            "sha": "ebcaf1e86d97163438b4b7fba1eeb4c185b8e964",
            "filename": "packages/router/test/integration.spec.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 12,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/76954688b18f1509d4c9cca41b8e113ee423d4db/packages%2Frouter%2Ftest%2Fintegration.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/76954688b18f1509d4c9cca41b8e113ee423d4db/packages%2Frouter%2Ftest%2Fintegration.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fintegration.spec.ts?ref=76954688b18f1509d4c9cca41b8e113ee423d4db",
            "patch": "@@ -306,7 +306,9 @@ describe('Integration', () => {\n   });\n \n   describe('navigation warning', () => {\n+    const isInAngularZoneFn = NgZone.isInAngularZone;\n     let warnings: string[] = [];\n+    let isInAngularZone = true;\n \n     class MockConsole {\n       warn(message: string) {\n@@ -316,15 +318,20 @@ describe('Integration', () => {\n \n     beforeEach(() => {\n       warnings = [];\n+      isInAngularZone = true;\n+      NgZone.isInAngularZone = () => isInAngularZone;\n       TestBed.overrideProvider(Console, {useValue: new MockConsole()});\n     });\n \n+    afterEach(() => {\n+      NgZone.isInAngularZone = isInAngularZoneFn;\n+    });\n+\n     describe('with NgZone enabled', () => {\n       it('should warn when triggered outside Angular zone',\n-         fakeAsync(inject([Router, NgZone], (router: Router, ngZone: NgZone) => {\n-           ngZone.runOutsideAngular(() => {\n-             router.navigateByUrl('/simple');\n-           });\n+         fakeAsync(inject([Router], (router: Router) => {\n+           isInAngularZone = false;\n+           router.navigateByUrl('/simple');\n \n            expect(warnings.length).toBe(1);\n            expect(warnings[0])\n@@ -333,10 +340,8 @@ describe('Integration', () => {\n          })));\n \n       it('should not warn when triggered inside Angular zone',\n-         fakeAsync(inject([Router, NgZone], (router: Router, ngZone: NgZone) => {\n-           ngZone.run(() => {\n-             router.navigateByUrl('/simple');\n-           });\n+         fakeAsync(inject([Router], (router: Router) => {\n+           router.navigateByUrl('/simple');\n \n            expect(warnings.length).toBe(0);\n          })));\n@@ -348,10 +353,9 @@ describe('Integration', () => {\n       });\n \n       it('should not warn when triggered outside Angular zone',\n-         fakeAsync(inject([Router, NgZone], (router: Router, ngZone: NgZone) => {\n-           ngZone.runOutsideAngular(() => {\n-             router.navigateByUrl('/simple');\n-           });\n+         fakeAsync(inject([Router], (router: Router) => {\n+           isInAngularZone = false;\n+           router.navigateByUrl('/simple');\n \n            expect(warnings.length).toBe(0);\n          })));"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 17,
        "deletions": 13
    }
}