{
    "author": "gkalpak",
    "message": "fix(docs-infra): correctly handle entry-points with no public exports (#40737)\n\nPreviously, if an entry-point had no public exports (such as the\n`@angular/platform-server/shims` introduced in #40559, which is a\nside-effect-ful entry-point), it was incorrectly marked as having all\nits exports deprecated (which marks the entry-point as deprecated as\nwell).\n\nThis commit fixes this by ensuring that an entry-point is not marked as\nhaving all its exports deprecated if it has no public exports.\n\nPR Close #40737",
    "sha": "4e4fcacb6d1d4e2c063eeba3a56c31c9e11fae88",
    "files": [
        {
            "sha": "d9af8ac3a16c670274515e88758832e7082dc342",
            "filename": "aio/tools/transforms/angular-api-package/processors/processPackages.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/4e4fcacb6d1d4e2c063eeba3a56c31c9e11fae88/aio%2Ftools%2Ftransforms%2Fangular-api-package%2Fprocessors%2FprocessPackages.js",
            "raw_url": "https://github.com/angular/angular/raw/4e4fcacb6d1d4e2c063eeba3a56c31c9e11fae88/aio%2Ftools%2Ftransforms%2Fangular-api-package%2Fprocessors%2FprocessPackages.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fangular-api-package%2Fprocessors%2FprocessPackages.js?ref=4e4fcacb6d1d4e2c063eeba3a56c31c9e11fae88",
            "patch": "@@ -18,6 +18,7 @@ module.exports = function processPackages(collectPackageContentDocsProcessor) {\n           // Partition the exports into groups by type\n           if (doc.exports) {\n             const publicExports = doc.exports.filter(doc => !doc.privateExport);\n+            doc.hasPublicExports = publicExports.length > 0;\n             doc.ngmodules = publicExports.filter(doc => doc.docType === 'ngmodule').sort(byId);\n             doc.classes = publicExports.filter(doc => doc.docType === 'class').sort(byId);\n             doc.decorators = publicExports.filter(doc => doc.docType === 'decorator').sort(byId);\n@@ -26,7 +27,7 @@ module.exports = function processPackages(collectPackageContentDocsProcessor) {\n             doc.directives = publicExports.filter(doc => doc.docType === 'directive').sort(byId);\n             doc.pipes = publicExports.filter(doc => doc.docType === 'pipe').sort(byId);\n             doc.types = publicExports.filter(doc => doc.docType === 'type-alias' || doc.docType === 'const').sort(byId);\n-            if (publicExports.every(doc => !!doc.deprecated)) {\n+            if (doc.hasPublicExports && publicExports.every(doc => !!doc.deprecated)) {\n               doc.deprecated = 'all exports of this entry point are deprecated.';\n             }\n           }"
        },
        {
            "sha": "7fa4b11acc84888124f0c44deba6ab10e59e0988",
            "filename": "aio/tools/transforms/angular-api-package/processors/processPackages.spec.js",
            "status": "modified",
            "additions": 48,
            "deletions": 0,
            "changes": 48,
            "blob_url": "https://github.com/angular/angular/blob/4e4fcacb6d1d4e2c063eeba3a56c31c9e11fae88/aio%2Ftools%2Ftransforms%2Fangular-api-package%2Fprocessors%2FprocessPackages.spec.js",
            "raw_url": "https://github.com/angular/angular/raw/4e4fcacb6d1d4e2c063eeba3a56c31c9e11fae88/aio%2Ftools%2Ftransforms%2Fangular-api-package%2Fprocessors%2FprocessPackages.spec.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fangular-api-package%2Fprocessors%2FprocessPackages.spec.js?ref=4e4fcacb6d1d4e2c063eeba3a56c31c9e11fae88",
            "patch": "@@ -163,6 +163,47 @@ describe('processPackages processor', () => {\n     ]);\n   });\n \n+  it('should compute whether the entry point has public exports', () => {\n+    const docs = [\n+      {\n+        fileInfo: { filePath: 'some/package-1/index' },\n+        docType: 'module',\n+        id: 'package-1',\n+        exports: [\n+          { docType: 'class', id: 'class-1' },\n+        ]\n+      },\n+      {\n+        fileInfo: { filePath: 'some/package-1/sub-1index' },\n+        docType: 'module',\n+        id: 'package-1/sub-1',\n+        exports: [],\n+      },\n+      {\n+        fileInfo: { filePath: 'some/package-2/index' },\n+        docType: 'module',\n+        id: 'package-2',\n+        exports: [],\n+      },\n+      {\n+        fileInfo: { filePath: 'some/package-1/sub-1index' },\n+        docType: 'module',\n+        id: 'package-1/sub-1',\n+        exports: [\n+          { docType: 'const', id: 'const-2' },\n+          { docType: 'enum', id: 'enum-3' },\n+        ],\n+      },\n+    ];\n+    const processor = processorFactory({ packageContentFiles: {} });\n+    processor.$process(docs);\n+\n+    expect(docs[0].hasPublicExports).toBeTrue();\n+    expect(docs[1].hasPublicExports).toBeFalse();\n+    expect(docs[2].hasPublicExports).toBeFalse();\n+    expect(docs[3].hasPublicExports).toBeTrue();\n+  });\n+\n   it('should compute the deprecated status of each entry point', () => {\n     const docs = [\n       {\n@@ -199,6 +240,12 @@ describe('processPackages processor', () => {\n           { docType: 'class', id: 'class-6' },\n         ]\n       },\n+      {\n+        fileInfo: { filePath: 'some/package-4/index' },\n+        docType: 'module',\n+        id: 'package-4',\n+        exports: []\n+      },\n     ];\n     const processor = processorFactory({ packageContentFiles: {} });\n     processor.$process(docs);\n@@ -207,6 +254,7 @@ describe('processPackages processor', () => {\n     expect(docs[1].deprecated).toBeTruthy();\n     expect(docs[2].deprecated).toBeUndefined();\n     expect(docs[3].deprecated).toBeUndefined();\n+    expect(docs[4].deprecated).toBeUndefined();\n   });\n \n   it('should compute the deprecated status of packages', () => {"
        },
        {
            "sha": "4d0952ac8d9a3a79a7e9b3c8ef294d4015d49603",
            "filename": "aio/tools/transforms/templates/api/package.template.html",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/4e4fcacb6d1d4e2c063eeba3a56c31c9e11fae88/aio%2Ftools%2Ftransforms%2Ftemplates%2Fapi%2Fpackage.template.html",
            "raw_url": "https://github.com/angular/angular/raw/4e4fcacb6d1d4e2c063eeba3a56c31c9e11fae88/aio%2Ftools%2Ftransforms%2Ftemplates%2Fapi%2Fpackage.template.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Ftemplates%2Fapi%2Fpackage.template.html?ref=4e4fcacb6d1d4e2c063eeba3a56c31c9e11fae88",
            "patch": "@@ -43,6 +43,9 @@ <h2>Entry points</h2>\n   {% endif %}\n \n   <h2>{% if doc.isPrimaryPackage %}Primary entry{% else %}Entry{% endif %} point exports</h2>\n+  {% if not doc.hasPublicExports %}\n+    <p><i>No public exports.</i></p>\n+  {% endif %}\n   {% include \"includes/deprecation.html\" %}\n   {$ listItems(doc.ngmodules, 'NgModules') $}\n   {$ listItems(doc.classes, 'Classes') $}"
        }
    ],
    "stats": {
        "total": 54,
        "additions": 53,
        "deletions": 1
    }
}