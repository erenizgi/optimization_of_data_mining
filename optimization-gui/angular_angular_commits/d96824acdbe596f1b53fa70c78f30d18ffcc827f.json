{
    "author": "gkalpak",
    "message": "fix(docs-infra): preserve focus on copy (and prevent scrolling to bottom on IE11) (#38244)\n\nThe `CopierService` is used for copying text to the user's clipboard. It\nis, for example, used in `CodeComponent` to copy example code snippets.\nThis is implemented by creating a temporary, hidden `<textarea>`\nelements, setting its value to the text that needs to be copied,\nexecuting the `copy` command and finally removing the element from the\nDOM.\n\nPreviously, as a result of `CopierService`'s implementation, the focused\nelement would lose focus, while the temporary `<textarea>` element would\nimplicitly gain focus when selecting its contents. This had an even\nworse side-effect on IE11, which seems to scroll to the bottom of the\ncontaining element (here `<body>`) when the focused element is removed.\n\nThis commit fixes these issues by keeping track of the previously\nfocused element and restoring its focus after the copy operation.\n\nNOTE: This fix is inspired by Angular CDK's [PendingCopy][1] class.\n\n[1]: https://github.com/angular/components/blob/89b5fa89d1437c3054c5/src/cdk/clipboard/pending-copy.ts\n\nFixes #37796\n\nPR Close #38244",
    "sha": "d96824acdbe596f1b53fa70c78f30d18ffcc827f",
    "files": [
        {
            "sha": "420d8ef6830bd9d2c3f8e06d7c91f6b3747c0450",
            "filename": "aio/src/app/shared/copier.service.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/d96824acdbe596f1b53fa70c78f30d18ffcc827f/aio%2Fsrc%2Fapp%2Fshared%2Fcopier.service.ts",
            "raw_url": "https://github.com/angular/angular/raw/d96824acdbe596f1b53fa70c78f30d18ffcc827f/aio%2Fsrc%2Fapp%2Fshared%2Fcopier.service.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fshared%2Fcopier.service.ts?ref=d96824acdbe596f1b53fa70c78f30d18ffcc827f",
            "patch": "@@ -5,6 +5,9 @@\n  * - https://github.com/zenorocha/clipboard.js/\n  *\n  * Both released under MIT license - Â© Zeno Rocha\n+ *\n+ * It is also influenced by the Angular CDK `PendingCopy` class:\n+ * https://github.com/angular/components/blob/master/src/cdk/clipboard/pending-copy.ts\n  */\n \n \n@@ -18,13 +21,19 @@ export class CopierService {\n    * @return Whether the copy operation was successful.\n    */\n   private copyTextArea(textArea: HTMLTextAreaElement): boolean {\n+    const currentFocus = document.activeElement as HTMLOrSVGElement | null;\n+\n     try {\n       textArea.select();\n       textArea.setSelectionRange(0, textArea.value.length);\n \n       return document.execCommand('copy');\n     } catch {\n       return false;\n+    } finally {\n+      // Calling `.select()` on the `<textarea>` element may have also focused it.\n+      // Change the focus back to the previously focused element.\n+      currentFocus?.focus();\n     }\n   }\n "
        }
    ],
    "stats": {
        "total": 9,
        "additions": 9,
        "deletions": 0
    }
}