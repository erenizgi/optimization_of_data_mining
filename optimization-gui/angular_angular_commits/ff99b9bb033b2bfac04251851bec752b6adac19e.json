{
    "author": "mgechev",
    "message": "feat(devtools): add filtering functionality in the profiler\n\nAllow to filter using a simple DSL:\n\n```\nsearch := query*\nquery := `source:` \\w+ | `duration:` [>|<|=|>=|<=]\\d+ (ms)?\n```",
    "sha": "ff99b9bb033b2bfac04251851bec752b6adac19e",
    "files": [
        {
            "sha": "3a1ef41ab3bbdb7393bfc3539c36bcb23582b5be",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/filter.spec.ts",
            "status": "added",
            "additions": 194,
            "deletions": 0,
            "changes": 194,
            "blob_url": "https://github.com/angular/angular/blob/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ffilter.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ffilter.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ffilter.spec.ts?ref=ff99b9bb033b2bfac04251851bec752b6adac19e",
            "patch": "@@ -0,0 +1,194 @@\n+import { createFilter, parseFilter } from './filter';\n+\n+describe('filtering', () => {\n+  describe('parsing', () => {\n+    it('should parse filters', () => {\n+      const result = parseFilter('');\n+      expect(result).toEqual([]);\n+    });\n+\n+    it('should return empty filter if the query is invalid', () => {\n+      const result = parseFilter('foobar');\n+      expect(result.length).toBe(0);\n+    });\n+\n+    it('should return proper result with duration', () => {\n+      const result = parseFilter('duration  :  =2');\n+      expect(result.length).toBe(1);\n+      expect(result[0][0]).toBe('duration');\n+      expect(result[0][1]).toEqual(['=', 2]);\n+    });\n+\n+    it('should return proper result with source', () => {\n+      const result = parseFilter('source  :  foobar');\n+      expect(result.length).toBe(1);\n+      expect(result[0][0]).toBe('source');\n+      expect(result[0][1]).toEqual('foobar');\n+    });\n+\n+    it('should return proper result with composite filters', () => {\n+      const result = parseFilter('source  : foobar  baz duration: >= 4200');\n+      expect(result.length).toBe(2);\n+      expect(result[0][0]).toBe('source');\n+      expect(result[0][1]).toEqual('foobar  baz');\n+\n+      expect(result[1][0]).toBe('duration');\n+      expect(result[1][1]).toEqual(['>=', 4200]);\n+    });\n+\n+    it('should ignore invalid operators', () => {\n+      const result1 = parseFilter('sorce  : foobar  baz duration: >= 4200');\n+      expect(result1.length).toBe(1);\n+      expect(result1[0][0]).toBe('duration');\n+      expect(result1[0][1]).toEqual(['>=', 4200]);\n+\n+      const result2 = parseFilter('sorce  : foobar  baz dration: >= 4200');\n+      expect(result2.length).toBe(0);\n+    });\n+\n+    it('should consider decimal values in durations queries with a ms suffix', () => {\n+      const result = parseFilter('source: foobar duration: >=42.42ms');\n+      expect(result.length).toBe(2);\n+      expect(result[0][0]).toBe('source');\n+      expect(result[0][1]).toEqual('foobar');\n+\n+      expect(result[1][0]).toBe('duration');\n+      expect(result[1][1]).toEqual(['>=', 42.42]);\n+    });\n+  });\n+\n+  describe('filtering', () => {\n+    it('should filter results with a source query', () => {\n+      const filter = createFilter('source:click');\n+      expect(\n+        filter({\n+          frame: {\n+            directives: [],\n+            duration: 10,\n+            source: 'click',\n+          },\n+          style: {},\n+          toolTip: '',\n+        })\n+      ).toBeTrue();\n+\n+      expect(\n+        filter({\n+          frame: {\n+            directives: [],\n+            duration: 10,\n+            source: 'mouseenter',\n+          },\n+          style: {},\n+          toolTip: '',\n+        })\n+      ).toBeFalse();\n+    });\n+\n+    it('should filter results with a duration query', () => {\n+      const filter1 = createFilter('duration:>10ms');\n+      expect(\n+        filter1({\n+          frame: {\n+            directives: [],\n+            duration: 10,\n+            source: 'click',\n+          },\n+          style: {},\n+          toolTip: '',\n+        })\n+      ).toBeFalse();\n+\n+      expect(\n+        filter1({\n+          frame: {\n+            directives: [],\n+            duration: 15,\n+            source: 'mouseenter',\n+          },\n+          style: {},\n+          toolTip: '',\n+        })\n+      ).toBeTrue();\n+\n+      const filter2 = createFilter('duration:=10ms');\n+      expect(\n+        filter2({\n+          frame: {\n+            directives: [],\n+            duration: 11,\n+            source: 'mouseenter',\n+          },\n+          style: {},\n+          toolTip: '',\n+        })\n+      ).toBeFalse();\n+      expect(\n+        filter2({\n+          frame: {\n+            directives: [],\n+            duration: 10,\n+            source: 'mouseenter',\n+          },\n+          style: {},\n+          toolTip: '',\n+        })\n+      ).toBeTrue();\n+    });\n+\n+    it('should work with composite selectors', () => {\n+      const filter = createFilter('duration:>10ms source: click');\n+      expect(\n+        filter({\n+          frame: {\n+            directives: [],\n+            duration: 10,\n+            source: 'click',\n+          },\n+          style: {},\n+          toolTip: '',\n+        })\n+      ).toBeFalse();\n+\n+      expect(\n+        filter({\n+          frame: {\n+            directives: [],\n+            duration: 15,\n+            source: 'mouseenter',\n+          },\n+          style: {},\n+          toolTip: '',\n+        })\n+      ).toBeFalse();\n+\n+      expect(\n+        filter({\n+          frame: {\n+            directives: [],\n+            duration: 15,\n+            source: 'click',\n+          },\n+          style: {},\n+          toolTip: '',\n+        })\n+      ).toBeTrue();\n+    });\n+\n+    it('should work with invalid arguments', () => {\n+      const filter = createFilter('duration:>ms');\n+\n+      expect(\n+        filter({\n+          frame: {\n+            directives: [],\n+            duration: 15,\n+            source: 'click',\n+          },\n+          style: {},\n+          toolTip: '',\n+        })\n+      ).toBeTrue();\n+    });\n+  });\n+});"
        },
        {
            "sha": "c9e0dbe93b04fc9eb3dda56f3df69ab796480418",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/filter.ts",
            "status": "added",
            "additions": 123,
            "deletions": 0,
            "changes": 123,
            "blob_url": "https://github.com/angular/angular/blob/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ffilter.ts",
            "raw_url": "https://github.com/angular/angular/raw/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ffilter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ffilter.ts?ref=ff99b9bb033b2bfac04251851bec752b6adac19e",
            "patch": "@@ -0,0 +1,123 @@\n+import { ProfilerFrame } from 'protocol';\n+import { GraphNode } from './record-formatter/record-formatter';\n+\n+export type Filter = (nodes: GraphNode) => boolean;\n+\n+export const noopFilter = (_: GraphNode) => true;\n+\n+interface Query<Arguments = unknown> {\n+  readonly name: QueryType;\n+  parseArguments(args: string[]): Arguments | undefined;\n+  apply(node: ProfilerFrame, args: Arguments): boolean;\n+}\n+\n+type Operator = '>' | '<' | '=' | '<=' | '>=';\n+\n+const ops: { [operator in Operator]: (a: number, b: number) => boolean } = {\n+  '>'(a: number, b: number): boolean {\n+    return a > b;\n+  },\n+  '<'(a: number, b: number): boolean {\n+    return a < b;\n+  },\n+  '='(a: number, b: number): boolean {\n+    return a === b;\n+  },\n+  '<='(a: number, b: number): boolean {\n+    return a <= b;\n+  },\n+  '>='(a: number, b: number): boolean {\n+    return a >= b;\n+  },\n+};\n+\n+type DurationArgument = [Operator, number];\n+type SourceArgument = string;\n+\n+const enum QueryType {\n+  Duration = 'duration',\n+  Source = 'source',\n+}\n+\n+type QueryArguments = DurationArgument | SourceArgument;\n+\n+const operatorRe = /^(>=|<=|=|<|>|)/;\n+class DurationQuery implements Query<DurationArgument> {\n+  readonly name = QueryType.Duration;\n+  parseArguments([arg]: string[]): DurationArgument | undefined {\n+    arg.trim();\n+    const operator = (arg.match(operatorRe) ?? [null])[0];\n+    if (!operator) {\n+      return undefined;\n+    }\n+    const num = parseFloat(arg.replace(operatorRe, '').trim());\n+    if (isNaN(num)) {\n+      return undefined;\n+    }\n+    return [operator as Operator, num] as DurationArgument;\n+  }\n+\n+  apply(node: ProfilerFrame, args: DurationArgument): boolean {\n+    return ops[args[0]](node.duration, args[1]);\n+  }\n+}\n+\n+class SourceQuery implements Query<SourceArgument> {\n+  readonly name = QueryType.Source;\n+  parseArguments([arg]: string[]): SourceArgument {\n+    return arg;\n+  }\n+\n+  apply(node: ProfilerFrame, args: SourceArgument): boolean {\n+    return node.source.indexOf(args) >= 0;\n+  }\n+}\n+\n+const queryMap: { [query in QueryType]: Query } = [new DurationQuery(), new SourceQuery()].reduce((map, query) => {\n+  map[query.name] = query;\n+  return map;\n+}, {} as { [query in QueryType]: Query });\n+\n+const queryRe = new RegExp(`(${QueryType.Duration}|${QueryType.Source})$`, 'g');\n+\n+export const parseFilter = (query: string): [QueryType, QueryArguments][] => {\n+  const parts = query.split(':').map((part) => part.trim());\n+  if (parts.length <= 1) {\n+    return [];\n+  }\n+  const result: [QueryType, QueryArguments][] = [];\n+  for (let i = 0; i < parts.length - 1; i++) {\n+    const part = parts[i];\n+    if (!queryRe.test(part)) {\n+      continue;\n+    }\n+    const match = part.match(/(\\w+)$/);\n+    if (!match) {\n+      continue;\n+    }\n+    const operator = queryMap[match[0] as QueryType];\n+    if (!operator) {\n+      continue;\n+    }\n+    const operandString = parts[i + 1].replace(queryRe, '').trim();\n+    const operand = operator.parseArguments([operandString]) as QueryArguments;\n+    if (!operand) {\n+      continue;\n+    }\n+    result.push([operator.name, operand]);\n+  }\n+  return result;\n+};\n+\n+export const createFilter = (query: string) => {\n+  const queries = parseFilter(query);\n+  return (frame: GraphNode) => {\n+    return queries.every(([queryName, args]) => {\n+      const currentQuery = queryMap[queryName];\n+      if (!currentQuery) {\n+        return true;\n+      }\n+      return currentQuery.apply(frame.frame, args);\n+    });\n+  };\n+};"
        },
        {
            "sha": "6b59f3496438013ca100188ef41ec07ab95679d2",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/record-formatter/record-formatter.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Frecord-formatter%2Frecord-formatter.ts",
            "raw_url": "https://github.com/angular/angular/raw/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Frecord-formatter%2Frecord-formatter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Frecord-formatter%2Frecord-formatter.ts?ref=ff99b9bb033b2bfac04251851bec752b6adac19e",
            "patch": "@@ -13,6 +13,7 @@ export interface AppEntry<T> {\n export interface GraphNode {\n   toolTip: string;\n   style: any;\n+  frame: ProfilerFrame;\n }\n \n export abstract class RecordFormatter<T> {"
        },
        {
            "sha": "9008c8f0f8c825be396f34b80062f41c97c0e9ac",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/timeline-controls/timeline-controls.component.html",
            "status": "modified",
            "additions": 25,
            "deletions": 13,
            "changes": 38,
            "blob_url": "https://github.com/angular/angular/blob/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline-controls%2Ftimeline-controls.component.html",
            "raw_url": "https://github.com/angular/angular/raw/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline-controls%2Ftimeline-controls.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline-controls%2Ftimeline-controls.component.html?ref=ff99b9bb033b2bfac04251851bec752b6adac19e",
            "patch": "@@ -1,17 +1,29 @@\n <div class=\"controls\">\n-  <mat-form-field *ngIf=\"record\">\n-    <mat-select [value]=\"visualizationMode\" (selectionChange)=\"this.changeVisualizationMode.emit($event.value)\">\n-      <mat-option [value]=\"flameGraphMode\">\n-        Flame graph\n-      </mat-option>\n-      <mat-option [value]=\"treeMapMode\">\n-        Tree map\n-      </mat-option>\n-      <mat-option [value]=\"barGraphMode\">\n-        Bar chart\n-      </mat-option>\n-    </mat-select>\n-  </mat-form-field>\n+  <div class=\"visual-controls\">\n+    <mat-form-field>\n+      <mat-label>Filter</mat-label>\n+      <input\n+        matInput\n+        class=\"filter-input\"\n+        (keyup)=\"filter.emit($event.target.value)\"\n+        placeholder=\"duration: >30 source: click\"\n+      />\n+    </mat-form-field>\n+\n+    <mat-form-field [class.hidden]=\"!record\">\n+      <mat-select [value]=\"visualizationMode\" (selectionChange)=\"this.changeVisualizationMode.emit($event.value)\">\n+        <mat-option [value]=\"flameGraphMode\">\n+          Flame graph\n+        </mat-option>\n+        <mat-option [value]=\"treeMapMode\">\n+          Tree map\n+        </mat-option>\n+        <mat-option [value]=\"barGraphMode\">\n+          Bar chart\n+        </mat-option>\n+      </mat-select>\n+    </mat-form-field>\n+  </div>\n \n   <div\n     class=\"details\""
        },
        {
            "sha": "a68c42ba0020b68671278a98db102797292ca5a4",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/timeline-controls/timeline-controls.component.scss",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline-controls%2Ftimeline-controls.component.scss",
            "raw_url": "https://github.com/angular/angular/raw/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline-controls%2Ftimeline-controls.component.scss",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline-controls%2Ftimeline-controls.component.scss?ref=ff99b9bb033b2bfac04251851bec752b6adac19e",
            "patch": "@@ -2,6 +2,19 @@\n   height: 60px;\n }\n \n+.visual-controls {\n+  display: flex;\n+  flex-direction: column;\n+  height: 80px;\n+  justify-content: space-around;\n+  margin-right: 25px;\n+  width: 150px;\n+}\n+\n+.hidden {\n+  visibility: hidden;\n+}\n+\n .controls {\n   display: flex;\n   white-space: nowrap;"
        },
        {
            "sha": "5f142763a09889672d011c72d6f7c9b9b3c39ba0",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/timeline-controls/timeline-controls.component.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline-controls%2Ftimeline-controls.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline-controls%2Ftimeline-controls.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline-controls%2Ftimeline-controls.component.ts?ref=ff99b9bb033b2bfac04251851bec752b6adac19e",
            "patch": "@@ -17,6 +17,7 @@ export class TimelineControlsComponent {\n   @Output() changeVisualizationMode = new EventEmitter<VisualizationMode>();\n   @Output() exportProfile = new EventEmitter<void>();\n   @Output() toggleChangeDetection = new EventEmitter<boolean>();\n+  @Output() filter = new EventEmitter<string>();\n \n   flameGraphMode = VisualizationMode.FlameGraph;\n   treeMapMode = VisualizationMode.TreeMap;"
        },
        {
            "sha": "9249ecdb95b3ba0ea95415806c8641185f5a3578",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/timeline.component.html",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.html",
            "raw_url": "https://github.com/angular/angular/raw/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.html?ref=ff99b9bb033b2bfac04251851bec752b6adac19e",
            "patch": "@@ -2,7 +2,7 @@\n \n <p class=\"info\" *ngIf=\"!hasFrames && visualizing\">There's no information to show.</p>\n \n-<div style=\"margin: 10px; height: 100%\">\n+<div style=\"margin: 10px; height: 100%;\">\n   <ng-timeline-controls\n     [class.hidden]=\"!hasFrames\"\n     [record]=\"frame\"\n@@ -14,6 +14,7 @@\n     (changeVisualizationMode)=\"visualizationMode = $event\"\n     (exportProfile)=\"exportProfile.emit($event)\"\n     (toggleChangeDetection)=\"changeDetection = $event\"\n+    (filter)=\"setFilter($event)\"\n   ></ng-timeline-controls>\n \n   <ng-frame-selector"
        },
        {
            "sha": "4054b57b4274e629f8541a7fa2703f672f04dfe1",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/timeline.component.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 12,
            "changes": 35,
            "blob_url": "https://github.com/angular/angular/blob/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.component.ts?ref=ff99b9bb033b2bfac04251851bec752b6adac19e",
            "patch": "@@ -2,8 +2,9 @@ import { Component, EventEmitter, Input, Output, OnDestroy } from '@angular/core\n import { ProfilerFrame } from 'protocol';\n import { GraphNode } from './record-formatter/record-formatter';\n import { Observable, Subscription, BehaviorSubject } from 'rxjs';\n-import { share } from 'rxjs/operators';\n+import { map, share } from 'rxjs/operators';\n import { mergeFrames } from './record-formatter/frame-merger';\n+import { createFilter, Filter, noopFilter } from './filter';\n \n export enum VisualizationMode {\n   FlameGraph,\n@@ -24,6 +25,7 @@ export class TimelineComponent implements OnDestroy {\n       this._subscription.unsubscribe();\n     }\n     this._allRecords = [];\n+    this._filtered = [];\n     this._maxDuration = -Infinity;\n     this._subscription = data.subscribe({\n       next: (frames: ProfilerFrame[]): void => {\n@@ -39,26 +41,38 @@ export class TimelineComponent implements OnDestroy {\n   changeDetection = false;\n   frame: ProfilerFrame | null = null;\n \n+  private _filter: Filter = noopFilter;\n   private _maxDuration = -Infinity;\n   private _subscription: Subscription;\n   private _allRecords: ProfilerFrame[] = [];\n+  private _filtered: GraphNode[] = [];\n   private _graphDataSubject = new BehaviorSubject<GraphNode[]>([]);\n   visualizing = false;\n-  graphData$ = this._graphDataSubject.asObservable().pipe(share());\n+  graphData$ = this._graphDataSubject.pipe(\n+    share(),\n+    map((nodes) => {\n+      return (this._filtered = nodes.filter((node) => this._filter(node)));\n+    })\n+  );\n \n   selectFrames({ indexes }: { indexes: number[] }): void {\n-    this.frame = mergeFrames(indexes.map((index) => this._allRecords[index]));\n+    this.frame = mergeFrames(indexes.map((index) => this._filtered[index].frame));\n   }\n \n   get hasFrames(): boolean {\n-    return this._allRecords.length > 0;\n+    return this._graphDataSubject.value.length > 0;\n   }\n \n   estimateFrameRate(timeSpent: number): number {\n     const multiplier = Math.max(Math.ceil(timeSpent / 16) - 1, 0);\n     return Math.floor(60 / 2 ** multiplier);\n   }\n \n+  setFilter(filter: string): void {\n+    this._filter = createFilter(filter);\n+    this._graphDataSubject.next(this._graphDataSubject.value);\n+  }\n+\n   getColorByFrameRate(framerate: number): string {\n     if (framerate >= 60) {\n       return '#d6f0d1';\n@@ -104,13 +118,10 @@ export class TimelineComponent implements OnDestroy {\n     return this._allRecords.map((r) => this._getBarStyles(r, multiplicationFactor));\n   }\n \n-  private _getBarStyles(\n-    record: ProfilerFrame,\n-    multiplicationFactor: number\n-  ): { style: { [key: string]: string }; toolTip: string } {\n-    const height = record.duration * multiplicationFactor;\n+  private _getBarStyles(frame: ProfilerFrame, multiplicationFactor: number): GraphNode {\n+    const height = frame.duration * multiplicationFactor;\n     const colorPercentage = Math.max(10, Math.round((height / MAX_HEIGHT) * 100));\n-    const backgroundColor = this.getColorByFrameRate(this.estimateFrameRate(record.duration));\n+    const backgroundColor = this.getColorByFrameRate(this.estimateFrameRate(frame.duration));\n \n     const style = {\n       'background-image': `-webkit-linear-gradient(bottom, ${backgroundColor} ${colorPercentage}%, transparent ${colorPercentage}%)`,\n@@ -119,7 +130,7 @@ export class TimelineComponent implements OnDestroy {\n       width: '25px',\n       height: '50px',\n     };\n-    const toolTip = `${record.source} TimeSpent: ${record.duration.toFixed(3)}ms`;\n-    return { style, toolTip };\n+    const toolTip = `${frame.source} TimeSpent: ${frame.duration.toFixed(3)}ms`;\n+    return { style, toolTip, frame };\n   }\n }"
        },
        {
            "sha": "4986791e1268725bf5812e8ea0a59c444d2be9b8",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/timeline.module.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.module.ts",
            "raw_url": "https://github.com/angular/angular/raw/ff99b9bb033b2bfac04251851bec752b6adac19e/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.module.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Ftimeline.module.ts?ref=ff99b9bb033b2bfac04251851bec752b6adac19e",
            "patch": "@@ -17,6 +17,7 @@ import { RecordingDialogComponent } from './recording-modal/recording-dialog/rec\n import { RecordingModalComponent } from './recording-modal/recording-modal.component';\n import { MatProgressBarModule } from '@angular/material/progress-bar';\n import { MatDialogModule } from '@angular/material/dialog';\n+import { MatInputModule } from '@angular/material/input';\n \n @NgModule({\n   declarations: [\n@@ -38,6 +39,7 @@ import { MatDialogModule } from '@angular/material/dialog';\n     MatTooltipModule,\n     MatIconModule,\n     MatCardModule,\n+    MatInputModule,\n     NgxFlamegraphModule,\n     MatSelectModule,\n   ],"
        }
    ],
    "stats": {
        "total": 410,
        "additions": 384,
        "deletions": 26
    }
}