{
    "author": "JoostK",
    "message": "fix(compiler-cli): prefer non-aliased exports in reference emitters (#41866)\n\nThis commit changes the reference emitters in the Ivy compiler to prefer\nnon-aliased exports if they exist. This avoids selecting \"private\nexports\" that may not be stable, e.g. the reexports that have been added\nby the View Engine compiler. Such reexports are not stable and are\ntherefore not suitable to be emitted into partial compilations, as the\noutput of partial compilations should only reference stable symbols\nfrom upstream libraries.\n\nAn alternative solution has been considered where ViewEngine-generated\nexports would gain a certain prefix, such that the Ivy compiler could\njust exclude those exports (see #41443). However, that solution would\nbe insufficient in case a library is built using partial compilation and\nwhile depending itself on a VE-compiled library from earlier versions of\nAngular, where the magic prefix would be missing. For such libraries,\nngcc would have generated reexports using the declared name if not already\npresent so this change does result in choosing the correct export.\n\nBecause ngcc always generates reexports using the declared name even if\nan aliased export is present, this change causes those ngcc-generated\nexports to be chosen in downstream libraries using partial compilation.\nThis is unfortunate as it means that the declared names become\neffectively public even if the library author was intentionally\nexporting it using an alias. This commit does not address this problem;\nit is expected that this should not result in widespread issues across\nthe library ecosystem.\n\nFixes #41277\n\nPR Close #41866",
    "sha": "35450c78f7908d43c1d7d8598c915a8c86a28d2e",
    "files": [
        {
            "sha": "80b2bf95b1baa245a989f65e546e2b280fb144fe",
            "filename": "packages/compiler-cli/src/ngtsc/imports/src/emitter.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 3,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Femitter.ts",
            "raw_url": "https://github.com/angular/angular/raw/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Femitter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Femitter.ts?ref=35450c78f7908d43c1d7d8598c915a8c86a28d2e",
            "patch": "@@ -12,7 +12,7 @@ import {UnifiedModulesHost} from '../../core/api';\n import {absoluteFromSourceFile, dirname, LogicalFileSystem, LogicalProjectPath, relative, toRelativeImport} from '../../file_system';\n import {stripExtension} from '../../file_system/src/util';\n import {DeclarationNode, ReflectionHost} from '../../reflection';\n-import {getSourceFile, isDeclaration, isTypeDeclaration, nodeNameForError} from '../../util/src/typescript';\n+import {getSourceFile, isDeclaration, isNamedDeclaration, isTypeDeclaration, nodeNameForError} from '../../util/src/typescript';\n \n import {findExportedNameOfNode} from './find_export';\n import {Reference} from './references';\n@@ -255,9 +255,20 @@ export class AbsoluteModuleStrategy implements ReferenceEmitStrategy {\n       return null;\n     }\n     const exportMap = new Map<DeclarationNode, string>();\n-    exports.forEach((declaration, name) => {\n+    for (const [name, declaration] of exports) {\n+      if (exportMap.has(declaration.node)) {\n+        // An export for this declaration has already been registered. We prefer an export that\n+        // has the same name as the declared name, i.e. is not an aliased export. This is relevant\n+        // for partial compilations where emitted references should import symbols using a stable\n+        // name. This is particularly relevant for declarations inside VE-generated libraries, as\n+        // such libraries contain private, unstable reexports of symbols.\n+        const existingExport = exportMap.get(declaration.node)!;\n+        if (isNamedDeclaration(declaration.node) && declaration.node.name.text === existingExport) {\n+          continue;\n+        }\n+      }\n       exportMap.set(declaration.node, name);\n-    });\n+    }\n     return {module: entryPointFile, exportMap};\n   }\n }"
        },
        {
            "sha": "3809845f6e0db0db24b9f25c15136962028068ef",
            "filename": "packages/compiler-cli/src/ngtsc/imports/src/find_export.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 7,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Ffind_export.ts",
            "raw_url": "https://github.com/angular/angular/raw/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Ffind_export.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Ffind_export.ts?ref=35450c78f7908d43c1d7d8598c915a8c86a28d2e",
            "patch": "@@ -8,6 +8,7 @@\n \n import * as ts from 'typescript';\n import {ReflectionHost} from '../../reflection';\n+import {isNamedDeclaration} from '../../util/src/typescript';\n \n /**\n  * Find the name, if any, by which a node is exported from a given file.\n@@ -18,18 +19,29 @@ export function findExportedNameOfNode(\n   if (exports === null) {\n     return null;\n   }\n+\n+  const declaredName = isNamedDeclaration(target) ? target.name.text : null;\n+\n   // Look for the export which declares the node.\n-  const keys = Array.from(exports.keys());\n-  const name = keys.find(key => {\n-    const decl = exports.get(key);\n-    return decl !== undefined && decl.node === target;\n-  });\n+  let foundExportName: string|null = null;\n+  for (const [exportName, declaration] of exports) {\n+    if (declaration.node !== target) {\n+      continue;\n+    }\n+\n+    if (exportName === declaredName) {\n+      // A non-alias export exists which is always preferred, so use that one.\n+      return exportName;\n+    }\n+\n+    foundExportName = exportName;\n+  }\n \n-  if (name === undefined) {\n+  if (foundExportName === null) {\n     throw new Error(\n         `Failed to find exported name of node (${target.getText()}) in '${file.fileName}'.`);\n   }\n-  return name;\n+  return foundExportName;\n }\n \n /**"
        },
        {
            "sha": "569b513b7a7e23dd562d2f052d1b9edf64df834a",
            "filename": "packages/compiler-cli/src/ngtsc/imports/test/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Ftest%2FBUILD.bazel?ref=35450c78f7908d43c1d7d8598c915a8c86a28d2e",
            "patch": "@@ -11,6 +11,7 @@ ts_library(\n     deps = [\n         \"//packages:types\",\n         \"//packages/compiler\",\n+        \"//packages/compiler-cli/src/ngtsc/core:api\",\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n         \"//packages/compiler-cli/src/ngtsc/imports\","
        },
        {
            "sha": "f38190865f75ee79d223fc098967c1b4106a2730",
            "filename": "packages/compiler-cli/src/ngtsc/imports/test/emitter_spec.ts",
            "status": "modified",
            "additions": 141,
            "deletions": 2,
            "changes": 143,
            "blob_url": "https://github.com/angular/angular/blob/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Ftest%2Femitter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Ftest%2Femitter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Ftest%2Femitter_spec.ts?ref=35450c78f7908d43c1d7d8598c915a8c86a28d2e",
            "patch": "@@ -7,12 +7,13 @@\n  */\n import {ExternalExpr} from '@angular/compiler';\n import * as ts from 'typescript';\n+import {UnifiedModulesHost} from '../../core/api';\n \n-import {absoluteFrom as _, LogicalFileSystem} from '../../file_system';\n+import {absoluteFrom as _, basename, LogicalFileSystem} from '../../file_system';\n import {runInEachFileSystem, TestFile} from '../../file_system/testing';\n import {Declaration, TypeScriptReflectionHost} from '../../reflection';\n import {getDeclaration, makeProgram} from '../../testing';\n-import {AbsoluteModuleStrategy, ImportFlags, LogicalProjectStrategy} from '../src/emitter';\n+import {AbsoluteModuleStrategy, ImportFlags, LogicalProjectStrategy, RelativePathStrategy, UnifiedModulesStrategy} from '../src/emitter';\n import {Reference} from '../src/references';\n import {ModuleResolver} from '../src/resolver';\n \n@@ -49,6 +50,41 @@ runInEachFileSystem(() => {\n       expect(emitted).toBeNull();\n     });\n \n+    it('should prefer non-aliased exports', () => {\n+      const {strategy, program} = makeStrategy([\n+        {\n+          name: _('/node_modules/external.d.ts'),\n+          contents: `\n+             declare class Foo {}\n+             export {Foo as A};\n+             export {Foo};\n+             export {Foo as B};\n+           `,\n+        },\n+        {\n+          name: _('/context.ts'),\n+          contents: 'export class Context {}',\n+        },\n+      ]);\n+      const decl =\n+          getDeclaration(program, _('/node_modules/external.d.ts'), 'Foo', ts.isClassDeclaration);\n+      const context = program.getSourceFile(_('/context.ts'))!;\n+\n+      const reference = new Reference(decl, {\n+        specifier: 'external',\n+        resolutionContext: context.fileName,\n+      });\n+      const emitted = strategy.emit(reference, context, ImportFlags.None);\n+      if (emitted === null) {\n+        return fail('Reference should be emitted');\n+      }\n+      if (!(emitted.expression instanceof ExternalExpr)) {\n+        return fail('Reference should be emitted as ExternalExpr');\n+      }\n+      expect(emitted.expression.value.name).toEqual('Foo');\n+      expect(emitted.expression.value.moduleName).toEqual('external');\n+    });\n+\n     it('should generate an import using the exported name of the declaration', () => {\n       const {strategy, program} = makeStrategy([\n         {\n@@ -173,5 +209,108 @@ runInEachFileSystem(() => {\n       // Expect the prefixed name from the TestHost.\n       expect((ref!.expression as ExternalExpr).value.name).toEqual('testFoo');\n     });\n+\n+    it('should prefer non-aliased exports', () => {\n+      const {program, host} = makeProgram([\n+        {\n+          name: _('/index.ts'),\n+          contents: `\n+             declare class Foo {}\n+             export {Foo as A};\n+             export {Foo};\n+             export {Foo as B};\n+           `,\n+        },\n+        {\n+          name: _('/context.ts'),\n+          contents: 'export class Context {}',\n+        }\n+      ]);\n+      const checker = program.getTypeChecker();\n+      const logicalFs = new LogicalFileSystem([_('/')], host);\n+      const strategy = new LogicalProjectStrategy(new TypeScriptReflectionHost(checker), logicalFs);\n+      const decl = getDeclaration(program, _('/index.ts'), 'Foo', ts.isClassDeclaration);\n+      const context = program.getSourceFile(_('/context.ts'))!;\n+      const emitted = strategy.emit(new Reference(decl), context);\n+      if (emitted === null) {\n+        return fail('Reference should be emitted');\n+      }\n+      if (!(emitted.expression instanceof ExternalExpr)) {\n+        return fail('Reference should be emitted as ExternalExpr');\n+      }\n+      expect(emitted.expression.value.name).toEqual('Foo');\n+      expect(emitted.expression.value.moduleName).toEqual('./index');\n+    });\n+  });\n+\n+  describe('RelativePathStrategy', () => {\n+    it('should prefer non-aliased exports', () => {\n+      const {program} = makeProgram([\n+        {\n+          name: _('/index.ts'),\n+          contents: `\n+             declare class Foo {}\n+             export {Foo as A};\n+             export {Foo};\n+             export {Foo as B};\n+           `,\n+        },\n+        {\n+          name: _('/context.ts'),\n+          contents: 'export class Context {}',\n+        }\n+      ]);\n+      const checker = program.getTypeChecker();\n+      const strategy = new RelativePathStrategy(new TypeScriptReflectionHost(checker));\n+      const decl = getDeclaration(program, _('/index.ts'), 'Foo', ts.isClassDeclaration);\n+      const context = program.getSourceFile(_('/context.ts'))!;\n+      const emitted = strategy.emit(new Reference(decl), context);\n+      if (emitted === null) {\n+        return fail('Reference should be emitted');\n+      }\n+      if (!(emitted.expression instanceof ExternalExpr)) {\n+        return fail('Reference should be emitted as ExternalExpr');\n+      }\n+      expect(emitted.expression.value.name).toEqual('Foo');\n+      expect(emitted.expression.value.moduleName).toEqual('./index');\n+    });\n+  });\n+\n+  describe('UnifiedModulesStrategy', () => {\n+    it('should prefer non-aliased exports', () => {\n+      const {program} = makeProgram([\n+        {\n+          name: _('/index.ts'),\n+          contents: `\n+             declare class Foo {}\n+             export {Foo as A};\n+             export {Foo};\n+             export {Foo as B};\n+           `,\n+        },\n+        {\n+          name: _('/context.ts'),\n+          contents: 'export class Context {}',\n+        }\n+      ]);\n+      const checker = program.getTypeChecker();\n+      const host: UnifiedModulesHost = {\n+        fileNameToModuleName(importedFilePath): string {\n+          return basename(importedFilePath, '.ts');\n+        }\n+      };\n+      const strategy = new UnifiedModulesStrategy(new TypeScriptReflectionHost(checker), host);\n+      const decl = getDeclaration(program, _('/index.ts'), 'Foo', ts.isClassDeclaration);\n+      const context = program.getSourceFile(_('/context.ts'))!;\n+      const emitted = strategy.emit(new Reference(decl), context);\n+      if (emitted === null) {\n+        return fail('Reference should be emitted');\n+      }\n+      if (!(emitted.expression instanceof ExternalExpr)) {\n+        return fail('Reference should be emitted as ExternalExpr');\n+      }\n+      expect(emitted.expression.value.name).toEqual('Foo');\n+      expect(emitted.expression.value.moduleName).toEqual('index');\n+    });\n   });\n });"
        },
        {
            "sha": "44854f778b48caff0e535fc8799ea43d52688ec9",
            "filename": "packages/compiler-cli/src/ngtsc/util/src/typescript.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts",
            "raw_url": "https://github.com/angular/angular/raw/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts?ref=35450c78f7908d43c1d7d8598c915a8c86a28d2e",
            "patch": "@@ -83,6 +83,11 @@ export function isTypeDeclaration(node: ts.Node): node is ts.EnumDeclaration|\n       ts.isInterfaceDeclaration(node);\n }\n \n+export function isNamedDeclaration(node: ts.Node): node is ts.Declaration&{name: ts.Identifier} {\n+  const namedNode = node as {name?: ts.Identifier};\n+  return namedNode.name !== undefined && ts.isIdentifier(namedNode.name);\n+}\n+\n export function isExported(node: DeclarationNode): boolean {\n   let topLevel: ts.Node = node;\n   if (ts.isVariableDeclaration(node) && ts.isVariableDeclarationList(node.parent)) {"
        },
        {
            "sha": "ec7381e4d5b18835cb3275eb5b32b99c1cf68849",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 52,
            "deletions": 0,
            "changes": 52,
            "blob_url": "https://github.com/angular/angular/blob/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2FGOLDEN_PARTIAL.js?ref=35450c78f7908d43c1d7d8598c915a8c86a28d2e",
            "patch": "@@ -567,3 +567,55 @@ export declare class TestCmp {\n     static ɵcmp: i0.ɵɵComponentDeclaration<TestCmp, \"test-cmp\", never, {}, {}, never, never>;\n }\n \n+/****************************************************************************************************\n+ * PARTIAL FILE: library_exports.js\n+ ****************************************************************************************************/\n+// This test verifies that a directive from an external library is emitted using its declared name,\n+// even in the presence of alias exports that could have been chosen.\n+// See https://github.com/angular/angular/issues/41277.\n+import { Component, NgModule } from '@angular/core';\n+import { LibModule } from 'external_library';\n+import * as i0 from \"@angular/core\";\n+import * as i1 from \"external_library\";\n+export class TestComponent {\n+}\n+TestComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: TestComponent, deps: [], target: i0.ɵɵFactoryTarget.Component });\n+TestComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: TestComponent, selector: \"ng-component\", ngImport: i0, template: `\n+    <lib-dir></lib-dir>\n+  `, isInline: true, directives: [{ type: i1.LibDirective, selector: \"lib-dir\" }] });\n+i0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: TestComponent, decorators: [{\n+            type: Component,\n+            args: [{\n+                    template: `\n+    <lib-dir></lib-dir>\n+  `,\n+                }]\n+        }] });\n+export class TestModule {\n+}\n+TestModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: TestModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\n+TestModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: TestModule, declarations: [TestComponent], imports: [LibModule] });\n+TestModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: TestModule, imports: [[LibModule]] });\n+i0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: TestModule, decorators: [{\n+            type: NgModule,\n+            args: [{\n+                    declarations: [TestComponent],\n+                    imports: [LibModule],\n+                }]\n+        }] });\n+\n+/****************************************************************************************************\n+ * PARTIAL FILE: library_exports.d.ts\n+ ****************************************************************************************************/\n+import * as i0 from \"@angular/core\";\n+import * as i1 from \"external_library\";\n+export declare class TestComponent {\n+    static ɵfac: i0.ɵɵFactoryDeclaration<TestComponent, never>;\n+    static ɵcmp: i0.ɵɵComponentDeclaration<TestComponent, \"ng-component\", never, {}, {}, never, never>;\n+}\n+export declare class TestModule {\n+    static ɵfac: i0.ɵɵFactoryDeclaration<TestModule, never>;\n+    static ɵmod: i0.ɵɵNgModuleDeclaration<TestModule, [typeof TestComponent], [typeof i1.LibModule], never>;\n+    static ɵinj: i0.ɵɵInjectorDeclaration<TestModule>;\n+}\n+"
        },
        {
            "sha": "168e866fce2af43a7b5d71a45251f0e4d192c5c7",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/TEST_CASES.json",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2FTEST_CASES.json",
            "raw_url": "https://github.com/angular/angular/raw/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2FTEST_CASES.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2FTEST_CASES.json?ref=35450c78f7908d43c1d7d8598c915a8c86a28d2e",
            "patch": "@@ -178,6 +178,27 @@\n       \"inputFiles\": [\n         \"non_literal_template_with_concatenation.ts\"\n       ]\n+    },\n+    {\n+      \"description\": \"should not use reexport names inside declarations when a direct export is available\",\n+      \"inputFiles\": [\n+        \"external_library.d.ts\",\n+        \"library_exports.ts\"\n+      ],\n+      \"expectations\": [\n+        {\n+          \"failureMessage\": \"Invalid list of directives\",\n+          \"files\": [\n+            \"library_exports.js\"\n+          ]\n+        }\n+      ],\n+      \"compilerOptions\": {\n+        \"baseUrl\": \".\",\n+        \"paths\": {\n+          \"external_library\": [\"./external_library\"]\n+        }\n+      }\n     }\n   ]\n }"
        },
        {
            "sha": "dc662e908141b36161267dae5a34561df714184c",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/external_library.d.ts",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fexternal_library.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fexternal_library.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fexternal_library.d.ts?ref=35450c78f7908d43c1d7d8598c915a8c86a28d2e",
            "patch": "@@ -0,0 +1,16 @@\n+import * as ɵngcc0 from '@angular/core';\n+\n+declare class LibDirective {\n+  static ɵfac: ɵngcc0.ɵɵFactoryDeclaration<LibDirective, never>;\n+  static ɵdir: ɵngcc0.ɵɵDirectiveDeclaration<LibDirective, 'lib-dir', never, {}, {}, never>;\n+}\n+\n+export declare class LibModule {\n+  static ɵfac: ɵngcc0.ɵɵFactoryDeclaration<LibModule, never>;\n+  static ɵmod: ɵngcc0.ɵɵNgModuleDeclaration<LibModule, [typeof LibDirective], never, [typeof LibDirective]>;\n+  static ɵinj: ɵngcc0.ɵɵInjectorDeclaration<LibModule>;\n+}\n+\n+export {LibDirective as ɵangular_packages_forms_forms_a}\n+export {LibDirective}\n+export {LibDirective as ɵangular_packages_forms_forms_b}"
        },
        {
            "sha": "91fa9baf35bb1abc33e6166a2538ec2a2a39f57b",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/library_exports.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Flibrary_exports.js",
            "raw_url": "https://github.com/angular/angular/raw/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Flibrary_exports.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Flibrary_exports.js?ref=35450c78f7908d43c1d7d8598c915a8c86a28d2e",
            "patch": "@@ -0,0 +1,3 @@\n+// NOTE: The declared name must have been used to refer to `LibDirective`, as the aliased exports\n+// NOTE: are not stable and therefore not suitable for partial compilation outputs.\n+directives: [$i0$.LibDirective]"
        },
        {
            "sha": "4f643ab12ab5a7dfa6f5549ac4ae4aae39048fff",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/library_exports.ts",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Flibrary_exports.ts",
            "raw_url": "https://github.com/angular/angular/raw/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Flibrary_exports.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Flibrary_exports.ts?ref=35450c78f7908d43c1d7d8598c915a8c86a28d2e",
            "patch": "@@ -0,0 +1,20 @@\n+// This test verifies that a directive from an external library is emitted using its declared name,\n+// even in the presence of alias exports that could have been chosen.\n+// See https://github.com/angular/angular/issues/41277.\n+import {Component, NgModule} from '@angular/core';\n+import {LibModule} from 'external_library';\n+\n+@Component({\n+  template: `\n+    <lib-dir></lib-dir>\n+  `,\n+})\n+export class TestComponent {\n+}\n+\n+@NgModule({\n+  declarations: [TestComponent],\n+  imports: [LibModule],\n+})\n+export class TestModule {\n+}"
        },
        {
            "sha": "c6b466c5b3addf92dd0f6994f0028875fb2adb91",
            "filename": "packages/compiler-cli/test/ngtsc/incremental_semantic_changes_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fincremental_semantic_changes_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/35450c78f7908d43c1d7d8598c915a8c86a28d2e/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fincremental_semantic_changes_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fincremental_semantic_changes_spec.ts?ref=35450c78f7908d43c1d7d8598c915a8c86a28d2e",
            "patch": "@@ -1217,7 +1217,7 @@ runInEachFileSystem(() => {\n             selector: 'cmp-dep',\n             template: 'Dep',\n           })\n-          export class CmpDep {}\n+          class CmpDep {}\n         `);\n         env.write('module.ts', `\n           import {NgModule} from '@angular/core';\n@@ -1246,7 +1246,7 @@ runInEachFileSystem(() => {\n             selector: 'cmp-dep',\n             template: 'Dep',\n           })\n-          export class CmpDep {}\n+          class CmpDep {}\n         `);\n         env.write('module.ts', `\n           import {NgModule} from '@angular/core';"
        }
    ],
    "stats": {
        "total": 308,
        "additions": 294,
        "deletions": 14
    }
}