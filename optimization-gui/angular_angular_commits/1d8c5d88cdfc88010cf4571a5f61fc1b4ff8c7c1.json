{
    "author": "petebacondarwin",
    "message": "refactor(compiler): `element.sourceSpan` should span the `outerHTML` (#38581)\n\nPreviously, the `sourceSpan` and `startSourceSpan` were the same\nobject, which meant that you had the following situation:\n\n```\nelement = <div>some content</div>\nsourceSpan = <div>\nstartSourceSpan = <div>\nendSourceSpan = </div>\n```\n\nThis made `sourceSpan` redundant and meant that if you\nwanted a span for the whole element including its content\nand closing tag, it had to be computed.\n\nNow `sourceSpan` is separated from `startSourceSpan`\nresulting in:\n\n```\nelement = <div>some content</div>\nsourceSpan = <div>some content</div>\nstartSourceSpan = <div>\nendSourceSpan = </div>\n```\n\nPR Close #38581",
    "sha": "1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1",
    "files": [
        {
            "sha": "5303112c872c1a62aa7e3b8f79fb138ad20e6d66",
            "filename": "packages/compiler-cli/src/ngtsc/indexer/src/template.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Ftemplate.ts",
            "raw_url": "https://github.com/angular/angular/raw/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Ftemplate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Findexer%2Fsrc%2Ftemplate.ts?ref=1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1",
            "patch": "@@ -246,7 +246,7 @@ class TemplateVisitor extends TmplAstRecursiveVisitor {\n       name = node.name;\n       kind = IdentifierKind.Element;\n     }\n-    const {sourceSpan} = node;\n+    const sourceSpan = node.startSourceSpan;\n     // An element's or template's source span can be of the form `<element>`, `<element />`, or\n     // `<element></element>`. Only the selector is interesting to the indexer, so the source is\n     // searched for the first occurrence of the element (selector) name."
        },
        {
            "sha": "a946a2539d8b6aa520bdea0144224afb47040c00",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/dom.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fdom.ts",
            "raw_url": "https://github.com/angular/angular/raw/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fdom.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fdom.ts?ref=1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1",
            "patch": "@@ -93,7 +93,7 @@ export class RegistryDomSchemaChecker implements DomSchemaChecker {\n       }\n \n       const diag = makeTemplateDiagnostic(\n-          id, mapping, element.sourceSpan, ts.DiagnosticCategory.Error,\n+          id, mapping, element.startSourceSpan, ts.DiagnosticCategory.Error,\n           ngErrorCode(ErrorCode.SCHEMA_INVALID_ELEMENT), errorMsg);\n       this._diagnostics.push(diag);\n     }"
        },
        {
            "sha": "4e77cced287f9311e5785425b3baa24bc88e2eec",
            "filename": "packages/compiler-cli/test/extract_i18n_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler-cli%2Ftest%2Fextract_i18n_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler-cli%2Ftest%2Fextract_i18n_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fextract_i18n_spec.ts?ref=1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1",
            "patch": "@@ -42,7 +42,7 @@ const EXPECTED_XMB = `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n   <msg id=\"5811701742971715242\" desc=\"with ICU and other things\"><source>src/icu.html:4,6</source>\n      foo <ph name=\"ICU\"><ex>{ count, plural, =1 {...} other {...}}</ex>{ count, plural, =1 {...} other {...}}</ph>\n     </msg>\n-  <msg id=\"7254052530614200029\" desc=\"with placeholders\"><source>src/placeholders.html:1</source>Name: <ph name=\"START_BOLD_TEXT\"><ex>&lt;b&gt;</ex>&lt;b&gt;</ph><ph name=\"NAME\"><ex>{{\n+  <msg id=\"7254052530614200029\" desc=\"with placeholders\"><source>src/placeholders.html:1,3</source>Name: <ph name=\"START_BOLD_TEXT\"><ex>&lt;b&gt;</ex>&lt;b&gt;</ph><ph name=\"NAME\"><ex>{{\n       name // i18n(ph=&quot;name&quot;)\n     }}</ex>{{\n       name // i18n(ph=&quot;name&quot;)\n@@ -182,7 +182,7 @@ const EXPECTED_XLIFF2 = `<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n     <unit id=\"7254052530614200029\">\n       <notes>\n         <note category=\"description\">with placeholders</note>\n-        <note category=\"location\">src/placeholders.html:1</note>\n+        <note category=\"location\">src/placeholders.html:1,3</note>\n       </notes>\n       <segment>\n         <source>Name: <pc id=\"0\" equivStart=\"START_BOLD_TEXT\" equivEnd=\"CLOSE_BOLD_TEXT\" type=\"fmt\" dispStart=\"&lt;b&gt;\" dispEnd=\"&lt;/b&gt;\"><ph id=\"1\" equiv=\"NAME\" disp=\"{{"
        },
        {
            "sha": "20d3162834d936f8ebbe71b820af75005c9e789f",
            "filename": "packages/compiler-cli/test/ngtsc/template_mapping_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Ftemplate_mapping_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Ftemplate_mapping_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Ftemplate_mapping_spec.ts?ref=1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1",
            "patch": "@@ -342,7 +342,7 @@ runInEachFileSystem((os) => {\n           expect(mappings).toContain(\n               {source: '<h3>', generated: 'i0.ɵɵelementStart(0, \"h3\")', sourceUrl: '../test.ts'});\n           expect(mappings).toContain({\n-            source: '<ng-content select=\"title\">',\n+            source: '<ng-content select=\"title\"></ng-content>',\n             generated: 'i0.ɵɵprojection(1)',\n             sourceUrl: '../test.ts'\n           });\n@@ -351,7 +351,7 @@ runInEachFileSystem((os) => {\n           expect(mappings).toContain(\n               {source: '<div>', generated: 'i0.ɵɵelementStart(2, \"div\")', sourceUrl: '../test.ts'});\n           expect(mappings).toContain({\n-            source: '<ng-content>',\n+            source: '<ng-content></ng-content>',\n             generated: 'i0.ɵɵprojection(3, 1)',\n             sourceUrl: '../test.ts'\n           });"
        },
        {
            "sha": "1747e64463dc0d7186f98c74dd02737d43f06760",
            "filename": "packages/compiler/src/i18n/i18n_parser.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Fsrc%2Fi18n%2Fi18n_parser.ts",
            "raw_url": "https://github.com/angular/angular/raw/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Fsrc%2Fi18n%2Fi18n_parser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fi18n%2Fi18n_parser.ts?ref=1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1",
            "patch": "@@ -83,7 +83,7 @@ class _I18nVisitor implements html.Visitor {\n     const isVoid: boolean = getHtmlTagDefinition(el.name).isVoid;\n     const startPhName =\n         context.placeholderRegistry.getStartTagPlaceholderName(el.name, attrs, isVoid);\n-    context.placeholderToContent[startPhName] = el.sourceSpan.toString();\n+    context.placeholderToContent[startPhName] = el.startSourceSpan.toString();\n \n     let closePhName = '';\n "
        },
        {
            "sha": "5c5a3f9805295bfa8bfabbdd1ececc16a868b15b",
            "filename": "packages/compiler/src/ml_parser/parser.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Fsrc%2Fml_parser%2Fparser.ts",
            "raw_url": "https://github.com/angular/angular/raw/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Fsrc%2Fml_parser%2Fparser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fml_parser%2Fparser.ts?ref=1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1",
            "patch": "@@ -258,7 +258,9 @@ class _TreeBuilder {\n     }\n     const end = this._peek.sourceSpan.start;\n     const span = new ParseSourceSpan(startTagToken.sourceSpan.start, end);\n-    const el = new html.Element(fullName, attrs, [], span, span, undefined);\n+    // Create a separate `startSpan` because `span` will be modified when there is an `end` span.\n+    const startSpan = new ParseSourceSpan(startTagToken.sourceSpan.start, end);\n+    const el = new html.Element(fullName, attrs, [], span, startSpan, undefined);\n     this._pushElement(el);\n     if (selfClosing) {\n       // Elements that are self-closed have their `endSourceSpan` set to the full span, as the\n@@ -301,6 +303,7 @@ class _TreeBuilder {\n         // removed from the element stack at this point are closed implicitly, so they won't get\n         // an end source span (as there is no explicit closing element).\n         el.endSourceSpan = endSourceSpan;\n+        el.sourceSpan.end = endSourceSpan.end || el.sourceSpan.end;\n \n         this._elementStack.splice(stackIndex, this._elementStack.length - stackIndex);\n         return true;"
        },
        {
            "sha": "b0599fc717ae93f3c212f443b29e19ab4f04429f",
            "filename": "packages/compiler/src/render3/view/template.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts",
            "raw_url": "https://github.com/angular/angular/raw/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Ftemplate.ts?ref=1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1",
            "patch": "@@ -544,7 +544,7 @@ export class TemplateDefinitionBuilder implements t.Visitor<void>, LocalResolver\n \n   private addNamespaceInstruction(nsInstruction: o.ExternalReference, element: t.Element) {\n     this._namespace = nsInstruction;\n-    this.creationInstruction(element.sourceSpan, nsInstruction);\n+    this.creationInstruction(element.startSourceSpan, nsInstruction);\n   }\n \n   /**\n@@ -671,15 +671,16 @@ export class TemplateDefinitionBuilder implements t.Visitor<void>, LocalResolver\n           trimTrailingNulls(parameters));\n     } else {\n       this.creationInstruction(\n-          element.sourceSpan, isNgContainer ? R3.elementContainerStart : R3.elementStart,\n+          element.startSourceSpan, isNgContainer ? R3.elementContainerStart : R3.elementStart,\n           trimTrailingNulls(parameters));\n \n       if (isNonBindableMode) {\n-        this.creationInstruction(element.sourceSpan, R3.disableBindings);\n+        this.creationInstruction(element.startSourceSpan, R3.disableBindings);\n       }\n \n       if (i18nAttrs.length > 0) {\n-        this.i18nAttributesInstruction(elementIndex, i18nAttrs, element.sourceSpan);\n+        this.i18nAttributesInstruction(\n+            elementIndex, i18nAttrs, element.startSourceSpan ?? element.sourceSpan);\n       }\n \n       // Generate Listeners (outputs)\n@@ -695,7 +696,7 @@ export class TemplateDefinitionBuilder implements t.Visitor<void>, LocalResolver\n       // Note: it's important to keep i18n/i18nStart instructions after i18nAttributes and\n       // listeners, to make sure i18nAttributes instruction targets current element at runtime.\n       if (isI18nRootElement) {\n-        this.i18nStart(element.sourceSpan, element.i18n!, createSelfClosingI18nInstruction);\n+        this.i18nStart(element.startSourceSpan, element.i18n!, createSelfClosingI18nInstruction);\n       }\n     }\n \n@@ -827,7 +828,7 @@ export class TemplateDefinitionBuilder implements t.Visitor<void>, LocalResolver\n \n     if (!createSelfClosingInstruction) {\n       // Finish element construction mode.\n-      const span = element.endSourceSpan || element.sourceSpan;\n+      const span = element.endSourceSpan ?? element.sourceSpan;\n       if (isI18nRootElement) {\n         this.i18nEnd(span, createSelfClosingI18nInstruction);\n       }\n@@ -919,7 +920,8 @@ export class TemplateDefinitionBuilder implements t.Visitor<void>, LocalResolver\n       // elements, in case of inline templates, corresponding instructions will be generated in the\n       // nested template function.\n       if (i18nAttrs.length > 0) {\n-        this.i18nAttributesInstruction(templateIndex, i18nAttrs, template.sourceSpan);\n+        this.i18nAttributesInstruction(\n+            templateIndex, i18nAttrs, template.startSourceSpan ?? template.sourceSpan);\n       }\n \n       // Add the input bindings"
        },
        {
            "sha": "e607d42e4f31882fe6b14714e30449cc413686a4",
            "filename": "packages/compiler/test/i18n/extractor_merger_spec.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 4,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Ftest%2Fi18n%2Fextractor_merger_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Ftest%2Fi18n%2Fextractor_merger_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fi18n%2Fextractor_merger_spec.ts?ref=1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1",
            "patch": "@@ -322,19 +322,28 @@ import {serializeNodes as serializeHtmlNodes} from '../ml_parser/util/util';\n       describe('elements', () => {\n         it('should report nested translatable elements', () => {\n           expect(extractErrors(`<p i18n><b i18n></b></p>`)).toEqual([\n-            ['Could not mark an element as translatable inside a translatable section', '<b i18n>'],\n+            [\n+              'Could not mark an element as translatable inside a translatable section',\n+              '<b i18n></b>'\n+            ],\n           ]);\n         });\n \n         it('should report translatable elements in implicit elements', () => {\n           expect(extractErrors(`<p><b i18n></b></p>`, ['p'])).toEqual([\n-            ['Could not mark an element as translatable inside a translatable section', '<b i18n>'],\n+            [\n+              'Could not mark an element as translatable inside a translatable section',\n+              '<b i18n></b>'\n+            ],\n           ]);\n         });\n \n         it('should report translatable elements in translatable blocks', () => {\n           expect(extractErrors(`<!-- i18n --><b i18n></b><!-- /i18n -->`)).toEqual([\n-            ['Could not mark an element as translatable inside a translatable section', '<b i18n>'],\n+            [\n+              'Could not mark an element as translatable inside a translatable section',\n+              '<b i18n></b>'\n+            ],\n           ]);\n         });\n       });\n@@ -370,7 +379,7 @@ import {serializeNodes as serializeHtmlNodes} from '../ml_parser/util/util';\n         it('should report when start and end of a block are not at the same level', () => {\n           expect(extractErrors(`<!-- i18n --><p><!-- /i18n --></p>`)).toEqual([\n             ['I18N blocks should not cross element boundaries', '<!--'],\n-            ['Unclosed block', '<p>'],\n+            ['Unclosed block', '<p><!-- /i18n --></p>'],\n           ]);\n \n           expect(extractErrors(`<p><!-- i18n --></p><!-- /i18n -->`)).toEqual(["
        },
        {
            "sha": "6dd3f9e97e5d6a211cfc8b830d74ca606bfd1d33",
            "filename": "packages/compiler/test/ml_parser/html_parser_spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_parser_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_parser_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fml_parser%2Fhtml_parser_spec.ts?ref=1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1",
            "patch": "@@ -653,7 +653,8 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn} from './ast_spe\n                      '<div [prop]=\"v1\" (e)=\"do()\" attr=\"v2\" noValue>\\na\\n</div>', 'TestComp')))\n               .toEqual([\n                 [\n-                  html.Element, 'div', 0, '<div [prop]=\"v1\" (e)=\"do()\" attr=\"v2\" noValue>',\n+                  html.Element, 'div', 0,\n+                  '<div [prop]=\"v1\" (e)=\"do()\" attr=\"v2\" noValue>\\na\\n</div>',\n                   '<div [prop]=\"v1\" (e)=\"do()\" attr=\"v2\" noValue>', '</div>'\n                 ],\n                 [html.Attribute, '[prop]', 'v1', '[prop]=\"v1\"'],\n@@ -676,14 +677,14 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn} from './ast_spe\n \n         it('should not set the end source span for void elements', () => {\n           expect(humanizeDomSourceSpans(parser.parse('<div><br></div>', 'TestComp'))).toEqual([\n-            [html.Element, 'div', 0, '<div>', '<div>', '</div>'],\n+            [html.Element, 'div', 0, '<div><br></div>', '<div>', '</div>'],\n             [html.Element, 'br', 1, '<br>', '<br>', null],\n           ]);\n         });\n \n         it('should not set the end source span for multiple void elements', () => {\n           expect(humanizeDomSourceSpans(parser.parse('<div><br><hr></div>', 'TestComp'))).toEqual([\n-            [html.Element, 'div', 0, '<div>', '<div>', '</div>'],\n+            [html.Element, 'div', 0, '<div><br><hr></div>', '<div>', '</div>'],\n             [html.Element, 'br', 1, '<br>', '<br>', null],\n             [html.Element, 'hr', 1, '<hr>', '<hr>', null],\n           ]);\n@@ -703,19 +704,19 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn} from './ast_spe\n \n         it('should set the end source span for self-closing elements', () => {\n           expect(humanizeDomSourceSpans(parser.parse('<div><br/></div>', 'TestComp'))).toEqual([\n-            [html.Element, 'div', 0, '<div>', '<div>', '</div>'],\n+            [html.Element, 'div', 0, '<div><br/></div>', '<div>', '</div>'],\n             [html.Element, 'br', 1, '<br/>', '<br/>', '<br/>'],\n           ]);\n         });\n \n         it('should not set the end source span for elements that are implicitly closed', () => {\n           expect(humanizeDomSourceSpans(parser.parse('<div><p></div>', 'TestComp'))).toEqual([\n-            [html.Element, 'div', 0, '<div>', '<div>', '</div>'],\n+            [html.Element, 'div', 0, '<div><p></div>', '<div>', '</div>'],\n             [html.Element, 'p', 1, '<p>', '<p>', null],\n           ]);\n           expect(humanizeDomSourceSpans(parser.parse('<div><li>A<li>B</div>', 'TestComp')))\n               .toEqual([\n-                [html.Element, 'div', 0, '<div>', '<div>', '</div>'],\n+                [html.Element, 'div', 0, '<div><li>A<li>B</div>', '<div>', '</div>'],\n                 [html.Element, 'li', 1, '<li>', '<li>', null],\n                 [html.Text, 'A', 2, 'A'],\n                 [html.Element, 'li', 1, '<li>', '<li>', null],\n@@ -728,7 +729,7 @@ import {humanizeDom, humanizeDomSourceSpans, humanizeLineColumn} from './ast_spe\n                      '<div>{count, plural, =0 {msg}}</div>', 'TestComp',\n                      {tokenizeExpansionForms: true})))\n               .toEqual([\n-                [html.Element, 'div', 0, '<div>', '<div>', '</div>'],\n+                [html.Element, 'div', 0, '<div>{count, plural, =0 {msg}}</div>', '<div>', '</div>'],\n                 [html.Expansion, 'count', 'plural', 1, '{count, plural, =0 {msg}}'],\n                 [html.ExpansionCase, '=0', 2, '=0 {msg}'],\n               ]);"
        },
        {
            "sha": "6fc6b3003b747990115b9b8ebf7dc34a9019c5ad",
            "filename": "packages/compiler/test/render3/r3_ast_spans_spec.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_ast_spans_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_ast_spans_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Frender3%2Fr3_ast_spans_spec.ts?ref=1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1",
            "patch": "@@ -173,56 +173,56 @@ describe('R3 AST source spans', () => {\n   describe('templates', () => {\n     it('is correct for * directives', () => {\n       expectFromHtml('<div *ngIf></div>').toEqual([\n-        ['Template', '0:11', '0:11', '11:17'],\n+        ['Template', '0:17', '0:11', '11:17'],\n         ['TextAttribute', '5:10', '<empty>'],\n         ['Element', '0:17', '0:11', '11:17'],\n       ]);\n     });\n \n     it('is correct for <ng-template>', () => {\n       expectFromHtml('<ng-template></ng-template>').toEqual([\n-        ['Template', '0:13', '0:13', '13:27'],\n+        ['Template', '0:27', '0:13', '13:27'],\n       ]);\n     });\n \n     it('is correct for reference via #...', () => {\n       expectFromHtml('<ng-template #a></ng-template>').toEqual([\n-        ['Template', '0:16', '0:16', '16:30'],\n+        ['Template', '0:30', '0:16', '16:30'],\n         ['Reference', '13:15', '<empty>'],\n       ]);\n     });\n \n     it('is correct for reference with name', () => {\n       expectFromHtml('<ng-template #a=\"b\"></ng-template>').toEqual([\n-        ['Template', '0:20', '0:20', '20:34'],\n+        ['Template', '0:34', '0:20', '20:34'],\n         ['Reference', '13:19', '17:18'],\n       ]);\n     });\n \n     it('is correct for reference via ref-...', () => {\n       expectFromHtml('<ng-template ref-a></ng-template>').toEqual([\n-        ['Template', '0:19', '0:19', '19:33'],\n+        ['Template', '0:33', '0:19', '19:33'],\n         ['Reference', '13:18', '<empty>'],\n       ]);\n     });\n \n     it('is correct for variables via let-...', () => {\n       expectFromHtml('<ng-template let-a=\"b\"></ng-template>').toEqual([\n-        ['Template', '0:23', '0:23', '23:37'],\n+        ['Template', '0:37', '0:23', '23:37'],\n         ['Variable', '13:22', '20:21'],\n       ]);\n     });\n \n     it('is correct for attributes', () => {\n       expectFromHtml('<ng-template k1=\"v1\"></ng-template>').toEqual([\n-        ['Template', '0:21', '0:21', '21:35'],\n+        ['Template', '0:35', '0:21', '21:35'],\n         ['TextAttribute', '13:20', '17:19'],\n       ]);\n     });\n \n     it('is correct for bound attributes', () => {\n       expectFromHtml('<ng-template [k1]=\"v1\"></ng-template>').toEqual([\n-        ['Template', '0:23', '0:23', '23:37'],\n+        ['Template', '0:37', '0:23', '23:37'],\n         ['BoundAttribute', '13:22', '19:21'],\n       ]);\n     });\n@@ -236,7 +236,7 @@ describe('R3 AST source spans', () => {\n       //   <div></div>\n       // </ng-template>\n       expectFromHtml('<div *ngFor=\"let item of items\"></div>').toEqual([\n-        ['Template', '0:32', '0:32', '32:38'],\n+        ['Template', '0:38', '0:32', '32:38'],\n         ['TextAttribute', '5:31', '<empty>'],\n         ['BoundAttribute', '5:31', '25:30'],  // *ngFor=\"let item of items\" -> items\n         ['Variable', '13:22', '<empty>'],     // let item\n@@ -250,7 +250,7 @@ describe('R3 AST source spans', () => {\n       //   <div></div>\n       // </ng-template>\n       expectFromHtml('<div *ngFor=\"item of items\"></div>').toEqual([\n-        ['Template', '0:28', '0:28', '28:34'],\n+        ['Template', '0:34', '0:28', '28:34'],\n         ['BoundAttribute', '5:27', '13:17'],  // ngFor=\"item of items\" -> item\n         ['BoundAttribute', '5:27', '21:26'],  // ngFor=\"item of items\" -> items\n         ['Element', '0:34', '0:28', '28:34'],\n@@ -259,7 +259,7 @@ describe('R3 AST source spans', () => {\n \n     it('is correct for variables via let ...', () => {\n       expectFromHtml('<div *ngIf=\"let a=b\"></div>').toEqual([\n-        ['Template', '0:21', '0:21', '21:27'],\n+        ['Template', '0:27', '0:21', '21:27'],\n         ['TextAttribute', '5:20', '<empty>'],\n         ['Variable', '12:19', '18:19'],  // let a=b -> b\n         ['Element', '0:27', '0:21', '21:27'],\n@@ -268,7 +268,7 @@ describe('R3 AST source spans', () => {\n \n     it('is correct for variables via as ...', () => {\n       expectFromHtml('<div *ngIf=\"expr as local\"></div>').toEqual([\n-        ['Template', '0:27', '0:27', '27:33'],\n+        ['Template', '0:33', '0:27', '27:33'],\n         ['BoundAttribute', '5:26', '12:16'],  // ngIf=\"expr as local\" -> expr\n         ['Variable', '6:25', '6:10'],         // ngIf=\"expr as local -> ngIf\n         ['Element', '0:33', '0:27', '27:33'],"
        },
        {
            "sha": "d43238c102f16df7d556ee88b1d49ccdfccf823f",
            "filename": "packages/compiler/test/template_parser/template_parser_spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Ftest%2Ftemplate_parser%2Ftemplate_parser_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1/packages%2Fcompiler%2Ftest%2Ftemplate_parser%2Ftemplate_parser_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Ftemplate_parser%2Ftemplate_parser_spec.ts?ref=1d8c5d88cdfc88010cf4571a5f61fc1b4ff8c7c1",
            "patch": "@@ -2046,7 +2046,7 @@ Property binding a not used by any directive on an embedded template. Make sure\n \n     it('should support embedded template', () => {\n       expect(humanizeTplAstSourceSpans(parse('<ng-template></ng-template>', []))).toEqual([\n-        [EmbeddedTemplateAst, '<ng-template>']\n+        [EmbeddedTemplateAst, '<ng-template></ng-template>']\n       ]);\n     });\n \n@@ -2058,14 +2058,14 @@ Property binding a not used by any directive on an embedded template. Make sure\n \n     it('should support references', () => {\n       expect(humanizeTplAstSourceSpans(parse('<div #a></div>', []))).toEqual([\n-        [ElementAst, 'div', '<div #a>'], [ReferenceAst, 'a', null, '#a']\n+        [ElementAst, 'div', '<div #a></div>'], [ReferenceAst, 'a', null, '#a']\n       ]);\n     });\n \n     it('should support variables', () => {\n       expect(humanizeTplAstSourceSpans(parse('<ng-template let-a=\"b\"></ng-template>', [])))\n           .toEqual([\n-            [EmbeddedTemplateAst, '<ng-template let-a=\"b\">'],\n+            [EmbeddedTemplateAst, '<ng-template let-a=\"b\"></ng-template>'],\n             [VariableAst, 'a', 'b', 'let-a=\"b\"'],\n           ]);\n     });\n@@ -2128,7 +2128,7 @@ Property binding a not used by any directive on an embedded template. Make sure\n       expect(humanizeTplAstSourceSpans(\n                  parse('<svg><circle /><use xlink:href=\"Port\" /></svg>', [tagSel, attrSel])))\n           .toEqual([\n-            [ElementAst, ':svg:svg', '<svg>'],\n+            [ElementAst, ':svg:svg', '<svg><circle /><use xlink:href=\"Port\" /></svg>'],\n             [ElementAst, ':svg:circle', '<circle />'],\n             [DirectiveAst, tagSel, '<circle />'],\n             [ElementAst, ':svg:use', '<use xlink:href=\"Port\" />'],\n@@ -2144,7 +2144,8 @@ Property binding a not used by any directive on an embedded template. Make sure\n                      inputs: ['aProp']\n                    }).toSummary();\n       expect(humanizeTplAstSourceSpans(parse('<div [aProp]=\"foo\"></div>', [dirA]))).toEqual([\n-        [ElementAst, 'div', '<div [aProp]=\"foo\">'], [DirectiveAst, dirA, '<div [aProp]=\"foo\">'],\n+        [ElementAst, 'div', '<div [aProp]=\"foo\"></div>'],\n+        [DirectiveAst, dirA, '<div [aProp]=\"foo\"></div>'],\n         [BoundDirectivePropertyAst, 'aProp', 'foo', '[aProp]=\"foo\"']\n       ]);\n     });"
        }
    ],
    "stats": {
        "total": 102,
        "additions": 59,
        "deletions": 43
    }
}