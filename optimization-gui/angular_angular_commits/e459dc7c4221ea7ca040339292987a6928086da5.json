{
    "author": "gkalpak",
    "message": "test(docs-infra): add missing test for the `rx-library` docs example (#38905)\n\nThis commit adds an extra test for the `retry-on-error` snippet of the\n`rx-library` docs example to ensure it can successfully recover after a\ncouple of failed attempts.\n\nThis commit addresses comment\nhttps://github.com/angular/angular/pull/38905#discussion_r491494196.\n\nPR Close #38905",
    "sha": "e459dc7c4221ea7ca040339292987a6928086da5",
    "files": [
        {
            "sha": "6638749ee72c9d074b57fc582df77b1476c2841e",
            "filename": "aio/content/examples/rx-library/src/retry-on-error.spec.ts",
            "status": "modified",
            "additions": 25,
            "deletions": 1,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/e459dc7c4221ea7ca040339292987a6928086da5/aio%2Fcontent%2Fexamples%2Frx-library%2Fsrc%2Fretry-on-error.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e459dc7c4221ea7ca040339292987a6928086da5/aio%2Fcontent%2Fexamples%2Frx-library%2Fsrc%2Fretry-on-error.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Frx-library%2Fsrc%2Fretry-on-error.spec.ts?ref=e459dc7c4221ea7ca040339292987a6928086da5",
            "patch": "@@ -1,5 +1,5 @@\n import { of, throwError } from 'rxjs';\n-import { tap } from 'rxjs/operators';\n+import { mergeMap, tap } from 'rxjs/operators';\n import { docRegionDefault } from './retry-on-error';\n \n describe('retry-on-error', () => {\n@@ -34,6 +34,30 @@ describe('retry-on-error', () => {\n     ]);\n   });\n \n+  it('should return the response if the request succeeds upon retrying', () => {\n+    // Fail on the first two requests, but succeed from the 3rd onwards.\n+    let failCount = 2;\n+    const ajax = () => of(null).pipe(\n+      tap(() => mockConsole.log('Subscribed to AJAX')),\n+      // Fail on the first 2 requests, but succeed from the 3rd onwards.\n+      mergeMap(() => {\n+        if (failCount > 0) {\n+          failCount--;\n+          return throwError('Test error');\n+        }\n+        return of({ response: { foo: 'bar' } });\n+      }),\n+    );\n+\n+    docRegionDefault(mockConsole, ajax);\n+    expect(mockConsole.log.calls.allArgs()).toEqual([\n+      ['Subscribed to AJAX'],  // Initial request   | 1st attempt overall\n+      ['Subscribed to AJAX'],  // 1st retry attempt | 2nd attempt overall\n+      ['Subscribed to AJAX'],  // 2nd retry attempt | 3rd attempt overall\n+      ['data: ', { foo: 'bar' }],\n+    ]);\n+  });\n+\n   it('should return an empty array when the ajax observable throws an error', () => {\n     const ajax = () => throwError('Test Error');\n "
        }
    ],
    "stats": {
        "total": 26,
        "additions": 25,
        "deletions": 1
    }
}