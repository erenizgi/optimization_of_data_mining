{
    "author": "alxhub",
    "message": "refactor(language-service): introduce DisplayParts abstraction for Ivy (#39505)\n\nThis commit refactors the QuickInfo abstraction shared between the VE and\nIvy services and used to implement hover tooltips (quick info), which was\nextracted from the VE code in commit faa81dc. The new DisplayParts\nabstraction is more general and can be used to extract information needed by\nvarious LS functions (e.g. autocompletion).\n\nThis commit effectively reverts faa81dc, returning the original code to the\nVE implementation as the Ivy code is now diverged.\n\nPR Close #39505",
    "sha": "643c96184c48bb6c07e5c7db371e116ff1021ea5",
    "files": [
        {
            "sha": "320cc2399550d472b2826274bef808245ccb9e8e",
            "filename": "packages/language-service/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2FBUILD.bazel?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -19,7 +19,6 @@ ts_library(\n         \"//packages/compiler\",\n         \"//packages/compiler-cli\",\n         \"//packages/core\",\n-        \"//packages/language-service/common\",\n         \"@npm//@types/node\",\n         \"@npm//typescript\",\n     ],"
        },
        {
            "sha": "afe8f39b56e876792dc91e9b4aee1223d02d728e",
            "filename": "packages/language-service/common/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/cf48d508af1cd525bdab8db4aeccb7b20451d0f9/packages%2Flanguage-service%2Fcommon%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/cf48d508af1cd525bdab8db4aeccb7b20451d0f9/packages%2Flanguage-service%2Fcommon%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fcommon%2FBUILD.bazel?ref=cf48d508af1cd525bdab8db4aeccb7b20451d0f9",
            "patch": "@@ -1,11 +0,0 @@\n-load(\"//tools:defaults.bzl\", \"ts_library\")\n-\n-package(default_visibility = [\"//packages/language-service:__subpackages__\"])\n-\n-ts_library(\n-    name = \"common\",\n-    srcs = glob([\"*.ts\"]),\n-    deps = [\n-        \"@npm//typescript\",\n-    ],\n-)"
        },
        {
            "sha": "7e38cd8f8f184b6d2f321c7a8b3658574d3bfe46",
            "filename": "packages/language-service/common/definitions.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 107,
            "changes": 107,
            "blob_url": "https://github.com/angular/angular/blob/cf48d508af1cd525bdab8db4aeccb7b20451d0f9/packages%2Flanguage-service%2Fcommon%2Fdefinitions.ts",
            "raw_url": "https://github.com/angular/angular/raw/cf48d508af1cd525bdab8db4aeccb7b20451d0f9/packages%2Flanguage-service%2Fcommon%2Fdefinitions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fcommon%2Fdefinitions.ts?ref=cf48d508af1cd525bdab8db4aeccb7b20451d0f9",
            "patch": "@@ -1,107 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as ts from 'typescript';\n-\n-import {findTightestNode, getClassDeclFromDecoratorProp, getPropertyAssignmentFromValue} from './ts_utils';\n-\n-export interface ResourceResolver {\n-  /**\n-   * Resolve the url of a resource relative to the file that contains the reference to it.\n-   *\n-   * @param file The, possibly relative, url of the resource.\n-   * @param basePath The path to the file that contains the URL of the resource.\n-   * @returns A resolved url of resource.\n-   * @throws An error if the resource cannot be resolved.\n-   */\n-  resolve(file: string, basePath: string): string;\n-}\n-\n-/**\n- * Gets an Angular-specific definition in a TypeScript source file.\n- */\n-export function getTsDefinitionAndBoundSpan(\n-    sf: ts.SourceFile, position: number,\n-    resourceResolver: ResourceResolver): ts.DefinitionInfoAndBoundSpan|undefined {\n-  const node = findTightestNode(sf, position);\n-  if (!node) return;\n-  switch (node.kind) {\n-    case ts.SyntaxKind.StringLiteral:\n-    case ts.SyntaxKind.NoSubstitutionTemplateLiteral:\n-      // Attempt to extract definition of a URL in a property assignment.\n-      return getUrlFromProperty(node as ts.StringLiteralLike, resourceResolver);\n-    default:\n-      return undefined;\n-  }\n-}\n-\n-/**\n- * Attempts to get the definition of a file whose URL is specified in a property assignment in a\n- * directive decorator.\n- * Currently applies to `templateUrl` and `styleUrls` properties.\n- */\n-function getUrlFromProperty(urlNode: ts.StringLiteralLike, resourceResolver: ResourceResolver):\n-    ts.DefinitionInfoAndBoundSpan|undefined {\n-  // Get the property assignment node corresponding to the `templateUrl` or `styleUrls` assignment.\n-  // These assignments are specified differently; `templateUrl` is a string, and `styleUrls` is\n-  // an array of strings:\n-  //   {\n-  //        templateUrl: './template.ng.html',\n-  //        styleUrls: ['./style.css', './other-style.css']\n-  //   }\n-  // `templateUrl`'s property assignment can be found from the string literal node;\n-  // `styleUrls`'s property assignment can be found from the array (parent) node.\n-  //\n-  // First search for `templateUrl`.\n-  let asgn = getPropertyAssignmentFromValue(urlNode, 'templateUrl');\n-  if (!asgn) {\n-    // `templateUrl` assignment not found; search for `styleUrls` array assignment.\n-    asgn = getPropertyAssignmentFromValue(urlNode.parent, 'styleUrls');\n-    if (!asgn) {\n-      // Nothing found, bail.\n-      return;\n-    }\n-  }\n-\n-  // If the property assignment is not a property of a class decorator, don't generate definitions\n-  // for it.\n-  if (!getClassDeclFromDecoratorProp(asgn)) {\n-    return;\n-  }\n-\n-  const sf = urlNode.getSourceFile();\n-  let url: string;\n-  try {\n-    url = resourceResolver.resolve(urlNode.text, sf.fileName);\n-  } catch {\n-    // If the file does not exist, bail.\n-    return;\n-  }\n-\n-  const templateDefinitions: ts.DefinitionInfo[] = [{\n-    kind: ts.ScriptElementKind.externalModuleName,\n-    name: url,\n-    containerKind: ts.ScriptElementKind.unknown,\n-    containerName: '',\n-    // Reading the template is expensive, so don't provide a preview.\n-    // TODO(ayazhafiz): Consider providing an actual span:\n-    //  1. We're likely to read the template anyway\n-    //  2. We could show just the first 100 chars or so\n-    textSpan: {start: 0, length: 0},\n-    fileName: url,\n-  }];\n-\n-  return {\n-    definitions: templateDefinitions,\n-    textSpan: {\n-      // Exclude opening and closing quotes in the url span.\n-      start: urlNode.getStart() + 1,\n-      length: urlNode.getWidth() - 2,\n-    },\n-  };\n-}"
        },
        {
            "sha": "9f1076e98a1a9ceff769e2675692774bacf72774",
            "filename": "packages/language-service/common/quick_info.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 60,
            "changes": 60,
            "blob_url": "https://github.com/angular/angular/blob/cf48d508af1cd525bdab8db4aeccb7b20451d0f9/packages%2Flanguage-service%2Fcommon%2Fquick_info.ts",
            "raw_url": "https://github.com/angular/angular/raw/cf48d508af1cd525bdab8db4aeccb7b20451d0f9/packages%2Flanguage-service%2Fcommon%2Fquick_info.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fcommon%2Fquick_info.ts?ref=cf48d508af1cd525bdab8db4aeccb7b20451d0f9",
            "patch": "@@ -1,60 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as ts from 'typescript';\n-\n-// Reverse mappings of enum would generate strings\n-export const ALIAS_NAME = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.aliasName];\n-export const SYMBOL_INTERFACE = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.interfaceName];\n-export const SYMBOL_PUNC = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.punctuation];\n-export const SYMBOL_SPACE = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.space];\n-export const SYMBOL_TEXT = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.text];\n-\n-/**\n- * Construct a QuickInfo object taking into account its container and type.\n- * @param name Name of the QuickInfo target\n- * @param kind component, directive, pipe, etc.\n- * @param textSpan span of the target\n- * @param containerName either the Symbol's container or the NgModule that contains the directive\n- * @param type user-friendly name of the type\n- * @param documentation docstring or comment\n- */\n-export function createQuickInfo(\n-    name: string, kind: string, textSpan: ts.TextSpan, containerName?: string, type?: string,\n-    documentation?: ts.SymbolDisplayPart[]): ts.QuickInfo {\n-  const containerDisplayParts = containerName ?\n-      [\n-        {text: containerName, kind: SYMBOL_INTERFACE},\n-        {text: '.', kind: SYMBOL_PUNC},\n-      ] :\n-      [];\n-\n-  const typeDisplayParts = type ?\n-      [\n-        {text: ':', kind: SYMBOL_PUNC},\n-        {text: ' ', kind: SYMBOL_SPACE},\n-        {text: type, kind: SYMBOL_INTERFACE},\n-      ] :\n-      [];\n-\n-  return {\n-    kind: kind as ts.ScriptElementKind,\n-    kindModifiers: ts.ScriptElementKindModifier.none,\n-    textSpan: textSpan,\n-    displayParts: [\n-      {text: '(', kind: SYMBOL_PUNC},\n-      {text: kind, kind: SYMBOL_TEXT},\n-      {text: ')', kind: SYMBOL_PUNC},\n-      {text: ' ', kind: SYMBOL_SPACE},\n-      ...containerDisplayParts,\n-      {text: name, kind: SYMBOL_INTERFACE},\n-      ...typeDisplayParts,\n-    ],\n-    documentation,\n-  };\n-}"
        },
        {
            "sha": "3ff50242e0afc767c42bf67529ead3810ae2a5a1",
            "filename": "packages/language-service/common/ts_utils.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 87,
            "changes": 87,
            "blob_url": "https://github.com/angular/angular/blob/cf48d508af1cd525bdab8db4aeccb7b20451d0f9/packages%2Flanguage-service%2Fcommon%2Fts_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/cf48d508af1cd525bdab8db4aeccb7b20451d0f9/packages%2Flanguage-service%2Fcommon%2Fts_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fcommon%2Fts_utils.ts?ref=cf48d508af1cd525bdab8db4aeccb7b20451d0f9",
            "patch": "@@ -1,87 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-import * as ts from 'typescript';\n-\n-/**\n- * Return the node that most tightly encompass the specified `position`.\n- * @param node\n- * @param position\n- */\n-export function findTightestNode(node: ts.Node, position: number): ts.Node|undefined {\n-  if (node.getStart() <= position && position < node.getEnd()) {\n-    return node.forEachChild(c => findTightestNode(c, position)) || node;\n-  }\n-}\n-\n-/**\n- * Returns a property assignment from the assignment value if the property name\n- * matches the specified `key`, or `undefined` if there is no match.\n- */\n-export function getPropertyAssignmentFromValue(value: ts.Node, key: string): ts.PropertyAssignment|\n-    undefined {\n-  const propAssignment = value.parent;\n-  if (!propAssignment || !ts.isPropertyAssignment(propAssignment) ||\n-      propAssignment.name.getText() !== key) {\n-    return;\n-  }\n-  return propAssignment;\n-}\n-\n-/**\n- * Given a decorator property assignment, return the ClassDeclaration node that corresponds to the\n- * directive class the property applies to.\n- * If the property assignment is not on a class decorator, no declaration is returned.\n- *\n- * For example,\n- *\n- * @Component({\n- *   template: '<div></div>'\n- *   ^^^^^^^^^^^^^^^^^^^^^^^---- property assignment\n- * })\n- * class AppComponent {}\n- *           ^---- class declaration node\n- *\n- * @param propAsgnNode property assignment\n- */\n-export function getClassDeclFromDecoratorProp(propAsgnNode: ts.PropertyAssignment):\n-    ts.ClassDeclaration|undefined {\n-  if (!propAsgnNode.parent || !ts.isObjectLiteralExpression(propAsgnNode.parent)) {\n-    return;\n-  }\n-  const objLitExprNode = propAsgnNode.parent;\n-  if (!objLitExprNode.parent || !ts.isCallExpression(objLitExprNode.parent)) {\n-    return;\n-  }\n-  const callExprNode = objLitExprNode.parent;\n-  if (!callExprNode.parent || !ts.isDecorator(callExprNode.parent)) {\n-    return;\n-  }\n-  const decorator = callExprNode.parent;\n-  if (!decorator.parent || !ts.isClassDeclaration(decorator.parent)) {\n-    return;\n-  }\n-  const classDeclNode = decorator.parent;\n-  return classDeclNode;\n-}\n-\n-/**\n- * Given the node which is the string of the inline template for a component, returns the\n- * `ts.ClassDeclaration` for the component.\n- */\n-export function getClassDeclOfInlineTemplateNode(templateStringNode: ts.Node): ts.ClassDeclaration|\n-    undefined {\n-  if (!ts.isStringLiteralLike(templateStringNode)) {\n-    return;\n-  }\n-  const tmplAsgn = getPropertyAssignmentFromValue(templateStringNode, 'template');\n-  if (!tmplAsgn) {\n-    return;\n-  }\n-  return getClassDeclFromDecoratorProp(tmplAsgn);\n-}"
        },
        {
            "sha": "6a48cdcde57c682bd7c540eff9623200563877ed",
            "filename": "packages/language-service/ivy/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fivy%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fivy%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2FBUILD.bazel?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -17,7 +17,6 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/shims\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/api\",\n-        \"//packages/language-service/common\",\n         \"@npm//typescript\",\n     ],\n )"
        },
        {
            "sha": "94f2feeb732c05a7e71e1431b24bf062780d07b7",
            "filename": "packages/language-service/ivy/definitions.ts",
            "status": "modified",
            "additions": 99,
            "deletions": 3,
            "changes": 102,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fivy%2Fdefinitions.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fivy%2Fdefinitions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Fdefinitions.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -11,10 +11,106 @@ import {NgCompiler} from '@angular/compiler-cli/src/ngtsc/core';\n import {DirectiveSymbol, DomBindingSymbol, ElementSymbol, ShimLocation, Symbol, SymbolKind, TemplateSymbol} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import * as ts from 'typescript';\n \n-import {getTsDefinitionAndBoundSpan, ResourceResolver} from '../common/definitions';\n-\n import {getPathToNodeAtPosition} from './hybrid_visitor';\n-import {flatMap, getDirectiveMatchesForAttribute, getDirectiveMatchesForElementTag, getTemplateInfoAtPosition, getTextSpanOfNode, isDollarEvent, isTypeScriptFile, TemplateInfo, toTextSpan} from './utils';\n+import {findTightestNode, flatMap, getClassDeclFromDecoratorProp, getDirectiveMatchesForAttribute, getDirectiveMatchesForElementTag, getPropertyAssignmentFromValue, getTemplateInfoAtPosition, getTextSpanOfNode, isDollarEvent, isTypeScriptFile, TemplateInfo, toTextSpan} from './utils';\n+\n+\n+export interface ResourceResolver {\n+  /**\n+   * Resolve the url of a resource relative to the file that contains the reference to it.\n+   *\n+   * @param file The, possibly relative, url of the resource.\n+   * @param basePath The path to the file that contains the URL of the resource.\n+   * @returns A resolved url of resource.\n+   * @throws An error if the resource cannot be resolved.\n+   */\n+  resolve(file: string, basePath: string): string;\n+}\n+\n+/**\n+ * Gets an Angular-specific definition in a TypeScript source file.\n+ */\n+export function getTsDefinitionAndBoundSpan(\n+    sf: ts.SourceFile, position: number,\n+    resourceResolver: ResourceResolver): ts.DefinitionInfoAndBoundSpan|undefined {\n+  const node = findTightestNode(sf, position);\n+  if (!node) return;\n+  switch (node.kind) {\n+    case ts.SyntaxKind.StringLiteral:\n+    case ts.SyntaxKind.NoSubstitutionTemplateLiteral:\n+      // Attempt to extract definition of a URL in a property assignment.\n+      return getUrlFromProperty(node as ts.StringLiteralLike, resourceResolver);\n+    default:\n+      return undefined;\n+  }\n+}\n+\n+/**\n+ * Attempts to get the definition of a file whose URL is specified in a property assignment in a\n+ * directive decorator.\n+ * Currently applies to `templateUrl` and `styleUrls` properties.\n+ */\n+function getUrlFromProperty(urlNode: ts.StringLiteralLike, resourceResolver: ResourceResolver):\n+    ts.DefinitionInfoAndBoundSpan|undefined {\n+  // Get the property assignment node corresponding to the `templateUrl` or `styleUrls` assignment.\n+  // These assignments are specified differently; `templateUrl` is a string, and `styleUrls` is\n+  // an array of strings:\n+  //   {\n+  //        templateUrl: './template.ng.html',\n+  //        styleUrls: ['./style.css', './other-style.css']\n+  //   }\n+  // `templateUrl`'s property assignment can be found from the string literal node;\n+  // `styleUrls`'s property assignment can be found from the array (parent) node.\n+  //\n+  // First search for `templateUrl`.\n+  let asgn = getPropertyAssignmentFromValue(urlNode, 'templateUrl');\n+  if (!asgn) {\n+    // `templateUrl` assignment not found; search for `styleUrls` array assignment.\n+    asgn = getPropertyAssignmentFromValue(urlNode.parent, 'styleUrls');\n+    if (!asgn) {\n+      // Nothing found, bail.\n+      return;\n+    }\n+  }\n+\n+  // If the property assignment is not a property of a class decorator, don't generate definitions\n+  // for it.\n+  if (!getClassDeclFromDecoratorProp(asgn)) {\n+    return;\n+  }\n+\n+  const sf = urlNode.getSourceFile();\n+  let url: string;\n+  try {\n+    url = resourceResolver.resolve(urlNode.text, sf.fileName);\n+  } catch {\n+    // If the file does not exist, bail.\n+    return;\n+  }\n+\n+  const templateDefinitions: ts.DefinitionInfo[] = [{\n+    kind: ts.ScriptElementKind.externalModuleName,\n+    name: url,\n+    containerKind: ts.ScriptElementKind.unknown,\n+    containerName: '',\n+    // Reading the template is expensive, so don't provide a preview.\n+    // TODO(ayazhafiz): Consider providing an actual span:\n+    //  1. We're likely to read the template anyway\n+    //  2. We could show just the first 100 chars or so\n+    textSpan: {start: 0, length: 0},\n+    fileName: url,\n+  }];\n+\n+  return {\n+    definitions: templateDefinitions,\n+    textSpan: {\n+      // Exclude opening and closing quotes in the url span.\n+      start: urlNode.getStart() + 1,\n+      length: urlNode.getWidth() - 2,\n+    },\n+  };\n+}\n+\n \n interface DefinitionMeta {\n   node: AST|TmplAstNode;"
        },
        {
            "sha": "aff731fbf62db81affae55c4b6b674f9c65b26a7",
            "filename": "packages/language-service/ivy/display_parts.ts",
            "status": "added",
            "additions": 126,
            "deletions": 0,
            "changes": 126,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fivy%2Fdisplay_parts.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fivy%2Fdisplay_parts.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Fdisplay_parts.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -0,0 +1,126 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {ReferenceSymbol, ShimLocation, Symbol, SymbolKind, VariableSymbol} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n+import * as ts from 'typescript';\n+\n+\n+// Reverse mappings of enum would generate strings\n+export const ALIAS_NAME = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.aliasName];\n+export const SYMBOL_INTERFACE = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.interfaceName];\n+export const SYMBOL_PUNC = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.punctuation];\n+export const SYMBOL_SPACE = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.space];\n+export const SYMBOL_TEXT = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.text];\n+\n+\n+/**\n+ * Label for various kinds of Angular entities for TS display info.\n+ */\n+export enum DisplayInfoKind {\n+  COMPONENT = 'component',\n+  DIRECTIVE = 'directive',\n+  EVENT = 'event',\n+  REFERENCE = 'reference',\n+  ELEMENT = 'element',\n+  VARIABLE = 'variable',\n+  PIPE = 'pipe',\n+  PROPERTY = 'property',\n+  METHOD = 'method',\n+  TEMPLATE = 'template',\n+}\n+\n+export interface DisplayInfo {\n+  kind: DisplayInfoKind;\n+  displayParts: ts.SymbolDisplayPart[];\n+  documentation: ts.SymbolDisplayPart[]|undefined;\n+}\n+\n+export function getDisplayInfo(\n+    tsLS: ts.LanguageService, typeChecker: ts.TypeChecker,\n+    symbol: ReferenceSymbol|VariableSymbol): DisplayInfo {\n+  let kind: DisplayInfoKind;\n+  if (symbol.kind === SymbolKind.Reference) {\n+    kind = DisplayInfoKind.REFERENCE;\n+  } else if (symbol.kind === SymbolKind.Variable) {\n+    kind = DisplayInfoKind.VARIABLE;\n+  } else {\n+    throw new Error(\n+        `AssertionError: unexpected symbol kind ${SymbolKind[(symbol as Symbol).kind]}`);\n+  }\n+\n+  const displayParts = createDisplayParts(\n+      symbol.declaration.name, kind, /* containerName */ undefined,\n+      typeChecker.typeToString(symbol.tsType));\n+  const documentation = getDocumentationFromTypeDefAtLocation(tsLS, symbol.shimLocation);\n+  return {\n+    kind,\n+    displayParts,\n+    documentation,\n+  };\n+}\n+\n+/**\n+ * Construct a compound `ts.SymbolDisplayPart[]` which incorporates the container and type of a\n+ * target declaration.\n+ * @param name Name of the target\n+ * @param kind component, directive, pipe, etc.\n+ * @param containerName either the Symbol's container or the NgModule that contains the directive\n+ * @param type user-friendly name of the type\n+ * @param documentation docstring or comment\n+ */\n+export function createDisplayParts(\n+    name: string, kind: DisplayInfoKind, containerName: string|undefined,\n+    type: string|undefined): ts.SymbolDisplayPart[] {\n+  const containerDisplayParts = containerName !== undefined ?\n+      [\n+        {text: containerName, kind: SYMBOL_INTERFACE},\n+        {text: '.', kind: SYMBOL_PUNC},\n+      ] :\n+      [];\n+\n+  const typeDisplayParts = type !== undefined ?\n+      [\n+        {text: ':', kind: SYMBOL_PUNC},\n+        {text: ' ', kind: SYMBOL_SPACE},\n+        {text: type, kind: SYMBOL_INTERFACE},\n+      ] :\n+      [];\n+  return [\n+    {text: '(', kind: SYMBOL_PUNC},\n+    {text: kind, kind: SYMBOL_TEXT},\n+    {text: ')', kind: SYMBOL_PUNC},\n+    {text: ' ', kind: SYMBOL_SPACE},\n+    ...containerDisplayParts,\n+    {text: name, kind: SYMBOL_INTERFACE},\n+    ...typeDisplayParts,\n+  ];\n+}\n+\n+/**\n+ * Convert a `SymbolDisplayInfoKind` to a `ts.ScriptElementKind` type, allowing it to pass through\n+ * TypeScript APIs.\n+ *\n+ * In practice, this is an \"illegal\" type cast. Since `ts.ScriptElementKind` is a string, this is\n+ * safe to do if TypeScript only uses the value in a string context. Consumers of this conversion\n+ * function are responsible for ensuring this is the case.\n+ */\n+export function unsafeCastDisplayInfoKindToScriptElementKind(kind: DisplayInfoKind):\n+    ts.ScriptElementKind {\n+  return kind as string as ts.ScriptElementKind;\n+}\n+\n+function getDocumentationFromTypeDefAtLocation(\n+    tsLS: ts.LanguageService, shimLocation: ShimLocation): ts.SymbolDisplayPart[]|undefined {\n+  const typeDefs =\n+      tsLS.getTypeDefinitionAtPosition(shimLocation.shimPath, shimLocation.positionInShimFile);\n+  if (typeDefs === undefined || typeDefs.length === 0) {\n+    return undefined;\n+  }\n+  return tsLS.getQuickInfoAtPosition(typeDefs[0].fileName, typeDefs[0].textSpan.start)\n+      ?.documentation;\n+}"
        },
        {
            "sha": "377eea2779d48b3a8e7c5568d60100cf12f8cca7",
            "filename": "packages/language-service/ivy/language_service_adapter.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fivy%2Flanguage_service_adapter.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fivy%2Flanguage_service_adapter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Flanguage_service_adapter.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -11,8 +11,7 @@ import {absoluteFrom, AbsoluteFsPath} from '@angular/compiler-cli/src/ngtsc/file\n import {AdapterResourceLoader} from '@angular/compiler-cli/src/ngtsc/resource';\n import {isShim} from '@angular/compiler-cli/src/ngtsc/shims';\n import * as ts from 'typescript/lib/tsserverlibrary';\n-\n-import {ResourceResolver} from '../common/definitions';\n+import {ResourceResolver} from './definitions';\n \n import {isTypeScriptFile} from './utils';\n "
        },
        {
            "sha": "312c23fdddefe4c6dbb5a1d95a0410f9014743d5",
            "filename": "packages/language-service/ivy/quick_info.ts",
            "status": "modified",
            "additions": 35,
            "deletions": 27,
            "changes": 62,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fivy%2Fquick_info.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fivy%2Fquick_info.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Fquick_info.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -10,27 +10,10 @@ import {NgCompiler} from '@angular/compiler-cli/src/ngtsc/core';\n import {DirectiveSymbol, DomBindingSymbol, ElementSymbol, ExpressionSymbol, InputBindingSymbol, OutputBindingSymbol, ReferenceSymbol, ShimLocation, Symbol, SymbolKind, VariableSymbol} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import * as ts from 'typescript';\n \n-import {createQuickInfo, SYMBOL_PUNC, SYMBOL_SPACE, SYMBOL_TEXT} from '../common/quick_info';\n-\n+import {createDisplayParts, DisplayInfoKind, SYMBOL_PUNC, SYMBOL_SPACE, SYMBOL_TEXT, unsafeCastDisplayInfoKindToScriptElementKind} from './display_parts';\n import {findNodeAtPosition} from './hybrid_visitor';\n import {filterAliasImports, getDirectiveMatchesForAttribute, getDirectiveMatchesForElementTag, getTemplateInfoAtPosition, getTextSpanOfNode} from './utils';\n \n-/**\n- * The type of Angular directive. Used for QuickInfo in template.\n- */\n-export enum QuickInfoKind {\n-  COMPONENT = 'component',\n-  DIRECTIVE = 'directive',\n-  EVENT = 'event',\n-  REFERENCE = 'reference',\n-  ELEMENT = 'element',\n-  VARIABLE = 'variable',\n-  PIPE = 'pipe',\n-  PROPERTY = 'property',\n-  METHOD = 'method',\n-  TEMPLATE = 'template',\n-}\n-\n export class QuickInfoBuilder {\n   private readonly typeChecker = this.compiler.getNextProgram().getTypeChecker();\n   constructor(private readonly tsLS: ts.LanguageService, private readonly compiler: NgCompiler) {}\n@@ -86,7 +69,8 @@ export class QuickInfoBuilder {\n       return undefined;\n     }\n \n-    const kind = symbol.kind === SymbolKind.Input ? QuickInfoKind.PROPERTY : QuickInfoKind.EVENT;\n+    const kind =\n+        symbol.kind === SymbolKind.Input ? DisplayInfoKind.PROPERTY : DisplayInfoKind.EVENT;\n \n     const quickInfo = this.getQuickInfoAtShimLocation(symbol.bindings[0].shimLocation, node);\n     return quickInfo === undefined ? undefined : updateQuickInfoKind(quickInfo, kind);\n@@ -100,30 +84,31 @@ export class QuickInfoBuilder {\n     }\n \n     return createQuickInfo(\n-        templateNode.name, QuickInfoKind.ELEMENT, getTextSpanOfNode(templateNode),\n+        templateNode.name, DisplayInfoKind.ELEMENT, getTextSpanOfNode(templateNode),\n         undefined /* containerName */, this.typeChecker.typeToString(symbol.tsType));\n   }\n \n   private getQuickInfoForVariableSymbol(symbol: VariableSymbol, node: TmplAstNode|AST):\n       ts.QuickInfo {\n     const documentation = this.getDocumentationFromTypeDefAtLocation(symbol.shimLocation);\n     return createQuickInfo(\n-        symbol.declaration.name, QuickInfoKind.VARIABLE, getTextSpanOfNode(node),\n+        symbol.declaration.name, DisplayInfoKind.VARIABLE, getTextSpanOfNode(node),\n         undefined /* containerName */, this.typeChecker.typeToString(symbol.tsType), documentation);\n   }\n \n   private getQuickInfoForReferenceSymbol(symbol: ReferenceSymbol, node: TmplAstNode|AST):\n       ts.QuickInfo {\n     const documentation = this.getDocumentationFromTypeDefAtLocation(symbol.shimLocation);\n     return createQuickInfo(\n-        symbol.declaration.name, QuickInfoKind.REFERENCE, getTextSpanOfNode(node),\n+        symbol.declaration.name, DisplayInfoKind.REFERENCE, getTextSpanOfNode(node),\n         undefined /* containerName */, this.typeChecker.typeToString(symbol.tsType), documentation);\n   }\n \n   private getQuickInfoForPipeSymbol(symbol: ExpressionSymbol, node: TmplAstNode|AST): ts.QuickInfo\n       |undefined {\n     const quickInfo = this.getQuickInfoAtShimLocation(symbol.shimLocation, node);\n-    return quickInfo === undefined ? undefined : updateQuickInfoKind(quickInfo, QuickInfoKind.PIPE);\n+    return quickInfo === undefined ? undefined :\n+                                     updateQuickInfoKind(quickInfo, DisplayInfoKind.PIPE);\n   }\n \n   private getQuickInfoForDomBinding(node: TmplAstNode|AST, symbol: DomBindingSymbol) {\n@@ -141,7 +126,7 @@ export class QuickInfoBuilder {\n \n   private getQuickInfoForDirectiveSymbol(dir: DirectiveSymbol, node: TmplAstNode|AST):\n       ts.QuickInfo {\n-    const kind = dir.isComponent ? QuickInfoKind.COMPONENT : QuickInfoKind.DIRECTIVE;\n+    const kind = dir.isComponent ? DisplayInfoKind.COMPONENT : DisplayInfoKind.DIRECTIVE;\n     const documentation = this.getDocumentationFromTypeDefAtLocation(dir.shimLocation);\n     let containerName: string|undefined;\n     if (ts.isClassDeclaration(dir.tsSymbol.valueDeclaration) && dir.ngModule !== null) {\n@@ -179,7 +164,7 @@ export class QuickInfoBuilder {\n   }\n }\n \n-function updateQuickInfoKind(quickInfo: ts.QuickInfo, kind: QuickInfoKind): ts.QuickInfo {\n+function updateQuickInfoKind(quickInfo: ts.QuickInfo, kind: DisplayInfoKind): ts.QuickInfo {\n   if (quickInfo.displayParts === undefined) {\n     return quickInfo;\n   }\n@@ -214,7 +199,7 @@ function isDollarAny(node: TmplAstNode|AST): node is MethodCall {\n function createDollarAnyQuickInfo(node: MethodCall): ts.QuickInfo {\n   return createQuickInfo(\n       '$any',\n-      QuickInfoKind.METHOD,\n+      DisplayInfoKind.METHOD,\n       getTextSpanOfNode(node),\n       /** containerName */ undefined,\n       'any',\n@@ -229,7 +214,7 @@ function createDollarAnyQuickInfo(node: MethodCall): ts.QuickInfo {\n function createNgTemplateQuickInfo(node: TmplAstNode|AST): ts.QuickInfo {\n   return createQuickInfo(\n       'ng-template',\n-      QuickInfoKind.TEMPLATE,\n+      DisplayInfoKind.TEMPLATE,\n       getTextSpanOfNode(node),\n       /** containerName */ undefined,\n       /** type */ undefined,\n@@ -240,3 +225,26 @@ function createNgTemplateQuickInfo(node: TmplAstNode|AST): ts.QuickInfo {\n       }],\n   );\n }\n+\n+/**\n+ * Construct a QuickInfo object taking into account its container and type.\n+ * @param name Name of the QuickInfo target\n+ * @param kind component, directive, pipe, etc.\n+ * @param textSpan span of the target\n+ * @param containerName either the Symbol's container or the NgModule that contains the directive\n+ * @param type user-friendly name of the type\n+ * @param documentation docstring or comment\n+ */\n+export function createQuickInfo(\n+    name: string, kind: DisplayInfoKind, textSpan: ts.TextSpan, containerName?: string,\n+    type?: string, documentation?: ts.SymbolDisplayPart[]): ts.QuickInfo {\n+  const displayParts = createDisplayParts(name, kind, containerName, type);\n+\n+  return {\n+    kind: unsafeCastDisplayInfoKindToScriptElementKind(kind),\n+    kindModifiers: ts.ScriptElementKindModifier.none,\n+    textSpan: textSpan,\n+    displayParts,\n+    documentation,\n+  };\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "266c43f1f485c453bafb8ba236a0432f678d91c1",
            "filename": "packages/language-service/ivy/utils.ts",
            "status": "modified",
            "additions": 82,
            "deletions": 2,
            "changes": 84,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fivy%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fivy%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Futils.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -13,8 +13,88 @@ import * as e from '@angular/compiler/src/expression_parser/ast';  // e for expr\n import * as t from '@angular/compiler/src/render3/r3_ast';         // t for template AST\n import * as ts from 'typescript';\n \n-import {ALIAS_NAME, SYMBOL_PUNC} from '../common/quick_info';\n-import {findTightestNode, getClassDeclOfInlineTemplateNode} from '../common/ts_utils';\n+import {ALIAS_NAME, SYMBOL_PUNC} from './display_parts';\n+\n+\n+\n+/**\n+ * Return the node that most tightly encompass the specified `position`.\n+ * @param node\n+ * @param position\n+ */\n+export function findTightestNode(node: ts.Node, position: number): ts.Node|undefined {\n+  if (node.getStart() <= position && position < node.getEnd()) {\n+    return node.forEachChild(c => findTightestNode(c, position)) || node;\n+  }\n+}\n+\n+/**\n+ * Returns a property assignment from the assignment value if the property name\n+ * matches the specified `key`, or `undefined` if there is no match.\n+ */\n+export function getPropertyAssignmentFromValue(value: ts.Node, key: string): ts.PropertyAssignment|\n+    undefined {\n+  const propAssignment = value.parent;\n+  if (!propAssignment || !ts.isPropertyAssignment(propAssignment) ||\n+      propAssignment.name.getText() !== key) {\n+    return;\n+  }\n+  return propAssignment;\n+}\n+\n+/**\n+ * Given a decorator property assignment, return the ClassDeclaration node that corresponds to the\n+ * directive class the property applies to.\n+ * If the property assignment is not on a class decorator, no declaration is returned.\n+ *\n+ * For example,\n+ *\n+ * @Component({\n+ *   template: '<div></div>'\n+ *   ^^^^^^^^^^^^^^^^^^^^^^^---- property assignment\n+ * })\n+ * class AppComponent {}\n+ *           ^---- class declaration node\n+ *\n+ * @param propAsgnNode property assignment\n+ */\n+export function getClassDeclFromDecoratorProp(propAsgnNode: ts.PropertyAssignment):\n+    ts.ClassDeclaration|undefined {\n+  if (!propAsgnNode.parent || !ts.isObjectLiteralExpression(propAsgnNode.parent)) {\n+    return;\n+  }\n+  const objLitExprNode = propAsgnNode.parent;\n+  if (!objLitExprNode.parent || !ts.isCallExpression(objLitExprNode.parent)) {\n+    return;\n+  }\n+  const callExprNode = objLitExprNode.parent;\n+  if (!callExprNode.parent || !ts.isDecorator(callExprNode.parent)) {\n+    return;\n+  }\n+  const decorator = callExprNode.parent;\n+  if (!decorator.parent || !ts.isClassDeclaration(decorator.parent)) {\n+    return;\n+  }\n+  const classDeclNode = decorator.parent;\n+  return classDeclNode;\n+}\n+\n+/**\n+ * Given the node which is the string of the inline template for a component, returns the\n+ * `ts.ClassDeclaration` for the component.\n+ */\n+export function getClassDeclOfInlineTemplateNode(templateStringNode: ts.Node): ts.ClassDeclaration|\n+    undefined {\n+  if (!ts.isStringLiteralLike(templateStringNode)) {\n+    return;\n+  }\n+  const tmplAsgn = getPropertyAssignmentFromValue(templateStringNode, 'template');\n+  if (!tmplAsgn) {\n+    return;\n+  }\n+  return getClassDeclFromDecoratorProp(tmplAsgn);\n+}\n+\n \n export function getTextSpanOfNode(node: t.Node|e.AST): ts.TextSpan {\n   if (isTemplateNodeWithKeyAndValue(node)) {"
        },
        {
            "sha": "620e954e5eff9d8bd285249fcf4ec98cc7a34e13",
            "filename": "packages/language-service/src/definitions.ts",
            "status": "modified",
            "additions": 83,
            "deletions": 0,
            "changes": 83,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Fdefinitions.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Fdefinitions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Fdefinitions.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -6,9 +6,11 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import * as path from 'path';\n import * as ts from 'typescript';  // used as value and is provided at runtime\n \n import {locateSymbols} from './locate_symbol';\n+import {findTightestNode, getClassDeclFromDecoratorProp, getPropertyAssignmentFromValue} from './ts_utils';\n import {AstResult, Span} from './types';\n \n /**\n@@ -22,6 +24,69 @@ function ngSpanToTsTextSpan(span: Span): ts.TextSpan {\n     length: span.end - span.start,\n   };\n }\n+/**\n+ * Attempts to get the definition of a file whose URL is specified in a property assignment in a\n+ * directive decorator.\n+ * Currently applies to `templateUrl` and `styleUrls` properties.\n+ */\n+function getUrlFromProperty(\n+    urlNode: ts.StringLiteralLike,\n+    tsLsHost: Readonly<ts.LanguageServiceHost>): ts.DefinitionInfoAndBoundSpan|undefined {\n+  // Get the property assignment node corresponding to the `templateUrl` or `styleUrls` assignment.\n+  // These assignments are specified differently; `templateUrl` is a string, and `styleUrls` is\n+  // an array of strings:\n+  //   {\n+  //        templateUrl: './template.ng.html',\n+  //        styleUrls: ['./style.css', './other-style.css']\n+  //   }\n+  // `templateUrl`'s property assignment can be found from the string literal node;\n+  // `styleUrls`'s property assignment can be found from the array (parent) node.\n+  //\n+  // First search for `templateUrl`.\n+  let asgn = getPropertyAssignmentFromValue(urlNode, 'templateUrl');\n+  if (!asgn) {\n+    // `templateUrl` assignment not found; search for `styleUrls` array assignment.\n+    asgn = getPropertyAssignmentFromValue(urlNode.parent, 'styleUrls');\n+    if (!asgn) {\n+      // Nothing found, bail.\n+      return;\n+    }\n+  }\n+\n+  // If the property assignment is not a property of a class decorator, don't generate definitions\n+  // for it.\n+  if (!getClassDeclFromDecoratorProp(asgn)) {\n+    return;\n+  }\n+\n+  const sf = urlNode.getSourceFile();\n+  // Extract url path specified by the url node, which is relative to the TypeScript source file\n+  // the url node is defined in.\n+  const url = path.join(path.dirname(sf.fileName), urlNode.text);\n+\n+  // If the file does not exist, bail. It is possible that the TypeScript language service host\n+  // does not have a `fileExists` method, in which case optimistically assume the file exists.\n+  if (tsLsHost.fileExists && !tsLsHost.fileExists(url)) return;\n+\n+  const templateDefinitions: ts.DefinitionInfo[] = [{\n+    kind: ts.ScriptElementKind.externalModuleName,\n+    name: url,\n+    containerKind: ts.ScriptElementKind.unknown,\n+    containerName: '',\n+    // Reading the template is expensive, so don't provide a preview.\n+    textSpan: {start: 0, length: 0},\n+    fileName: url,\n+  }];\n+\n+  return {\n+    definitions: templateDefinitions,\n+    textSpan: {\n+      // Exclude opening and closing quotes in the url span.\n+      start: urlNode.getStart() + 1,\n+      length: urlNode.getWidth() - 2,\n+    },\n+  };\n+}\n \n /**\n  * Traverse the template AST and look for the symbol located at `position`, then\n@@ -80,3 +145,21 @@ export function getDefinitionAndBoundSpan(\n     textSpan: symbols[0].span,\n   };\n }\n+\n+/**\n+ * Gets an Angular-specific definition in a TypeScript source file.\n+ */\n+export function getTsDefinitionAndBoundSpan(\n+    sf: ts.SourceFile, position: number,\n+    tsLsHost: Readonly<ts.LanguageServiceHost>): ts.DefinitionInfoAndBoundSpan|undefined {\n+  const node = findTightestNode(sf, position);\n+  if (!node) return;\n+  switch (node.kind) {\n+    case ts.SyntaxKind.StringLiteral:\n+    case ts.SyntaxKind.NoSubstitutionTemplateLiteral:\n+      // Attempt to extract definition of a URL in a property assignment.\n+      return getUrlFromProperty(node as ts.StringLiteralLike, tsLsHost);\n+    default:\n+      return undefined;\n+  }\n+}"
        },
        {
            "sha": "adbf824a045e112a7d1233d6e12f5bf42df2c609",
            "filename": "packages/language-service/src/diagnostics.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Fdiagnostics.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Fdiagnostics.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Fdiagnostics.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -10,11 +10,9 @@ import {NgAnalyzedModules} from '@angular/compiler';\n import * as path from 'path';\n import * as ts from 'typescript';\n \n-import {findTightestNode} from '../common/ts_utils';\n-\n import {createDiagnostic, Diagnostic} from './diagnostic_messages';\n import {getTemplateExpressionDiagnostics} from './expression_diagnostics';\n-import {findPropertyValueOfType} from './ts_utils';\n+import {findPropertyValueOfType, findTightestNode} from './ts_utils';\n import * as ng from './types';\n import {TypeScriptServiceHost} from './typescript_host';\n import {offsetSpan, spanOf} from './utils';"
        },
        {
            "sha": "3130318a80d005f1fde9d5aeecb2cf90b42c60c6",
            "filename": "packages/language-service/src/hover.ts",
            "status": "modified",
            "additions": 53,
            "deletions": 2,
            "changes": 55,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Fhover.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Fhover.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Fhover.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -9,8 +9,6 @@\n import {NgAnalyzedModules} from '@angular/compiler';\n import * as ts from 'typescript';\n \n-import {createQuickInfo} from '../common/quick_info';\n-\n import {locateSymbols} from './locate_symbol';\n import * as ng from './types';\n import {inSpan} from './utils';\n@@ -67,3 +65,56 @@ export function getTsHover(\n     }\n   }\n }\n+\n+\n+\n+// Reverse mappings of enum would generate strings\n+const ALIAS_NAME = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.aliasName];\n+const SYMBOL_INTERFACE = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.interfaceName];\n+const SYMBOL_PUNC = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.punctuation];\n+const SYMBOL_SPACE = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.space];\n+const SYMBOL_TEXT = ts.SymbolDisplayPartKind[ts.SymbolDisplayPartKind.text];\n+\n+/**\n+ * Construct a QuickInfo object taking into account its container and type.\n+ * @param name Name of the QuickInfo target\n+ * @param kind component, directive, pipe, etc.\n+ * @param textSpan span of the target\n+ * @param containerName either the Symbol's container or the NgModule that contains the directive\n+ * @param type user-friendly name of the type\n+ * @param documentation docstring or comment\n+ */\n+function createQuickInfo(\n+    name: string, kind: string, textSpan: ts.TextSpan, containerName?: string, type?: string,\n+    documentation?: ts.SymbolDisplayPart[]): ts.QuickInfo {\n+  const containerDisplayParts = containerName ?\n+      [\n+        {text: containerName, kind: SYMBOL_INTERFACE},\n+        {text: '.', kind: SYMBOL_PUNC},\n+      ] :\n+      [];\n+\n+  const typeDisplayParts = type ?\n+      [\n+        {text: ':', kind: SYMBOL_PUNC},\n+        {text: ' ', kind: SYMBOL_SPACE},\n+        {text: type, kind: SYMBOL_INTERFACE},\n+      ] :\n+      [];\n+\n+  return {\n+    kind: kind as ts.ScriptElementKind,\n+    kindModifiers: ts.ScriptElementKindModifier.none,\n+    textSpan: textSpan,\n+    displayParts: [\n+      {text: '(', kind: SYMBOL_PUNC},\n+      {text: kind, kind: SYMBOL_TEXT},\n+      {text: ')', kind: SYMBOL_PUNC},\n+      {text: ' ', kind: SYMBOL_SPACE},\n+      ...containerDisplayParts,\n+      {text: name, kind: SYMBOL_INTERFACE},\n+      ...typeDisplayParts,\n+    ],\n+    documentation,\n+  };\n+}"
        },
        {
            "sha": "177a73f0d640875ff713fcb0d58589fdf8f5a672",
            "filename": "packages/language-service/src/language_service.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 22,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Flanguage_service.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Flanguage_service.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Flanguage_service.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -9,10 +9,8 @@\n import * as path from 'path';\n import * as tss from 'typescript/lib/tsserverlibrary';\n \n-import {getTsDefinitionAndBoundSpan, ResourceResolver} from '../common/definitions';\n-\n import {getTemplateCompletions} from './completions';\n-import {getDefinitionAndBoundSpan} from './definitions';\n+import {getDefinitionAndBoundSpan, getTsDefinitionAndBoundSpan} from './definitions';\n import {getDeclarationDiagnostics, getTemplateDiagnostics, ngDiagnosticToTsDiagnostic} from './diagnostics';\n import {getTemplateHover, getTsHover} from './hover';\n import * as ng from './types';\n@@ -83,8 +81,7 @@ class LanguageServiceImpl implements ng.LanguageService {\n     if (fileName.endsWith('.ts')) {\n       const sf = this.host.getSourceFile(fileName);\n       if (sf) {\n-        return getTsDefinitionAndBoundSpan(\n-            sf, position, new ViewEngineLSResourceResolver(this.host.tsLsHost));\n+        return getTsDefinitionAndBoundSpan(sf, position, this.host.tsLsHost);\n       }\n     }\n   }\n@@ -115,20 +112,3 @@ class LanguageServiceImpl implements ng.LanguageService {\n     return this.host.tsLS.getReferencesAtPosition(tsDef.fileName, tsDef.textSpan.start);\n   }\n }\n-\n-class ViewEngineLSResourceResolver implements ResourceResolver {\n-  constructor(private host: ts.LanguageServiceHost) {}\n-\n-  resolve(file: string, basePath: string): string {\n-    // Extract url path specified by the url node, which is relative to the TypeScript source file\n-    // the url node is defined in.\n-    const url = path.join(path.dirname(basePath), file);\n-\n-    // If the file does not exist, bail. It is possible that the TypeScript language service host\n-    // does not have a `fileExists` method, in which case optimistically assume the file exists.\n-    if (this.host.fileExists && !this.host.fileExists(url)) {\n-      throw new Error(`ResourceResolver: could not resolve ${url} in context of ${basePath})`);\n-    }\n-    return url;\n-  }\n-}"
        },
        {
            "sha": "ca740e43e6f0dfed530cfa5b3f32e69194b25bcf",
            "filename": "packages/language-service/src/ts_utils.ts",
            "status": "modified",
            "additions": 78,
            "deletions": 0,
            "changes": 78,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Fts_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Fts_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Fts_utils.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -68,3 +68,81 @@ export function findPropertyValueOfType<T extends ts.Node>(\n   }\n   return startNode.forEachChild(c => findPropertyValueOfType(c, propName, predicate));\n }\n+\n+/**\n+ * Return the node that most tightly encompass the specified `position`.\n+ * @param node\n+ * @param position\n+ */\n+export function findTightestNode(node: ts.Node, position: number): ts.Node|undefined {\n+  if (node.getStart() <= position && position < node.getEnd()) {\n+    return node.forEachChild(c => findTightestNode(c, position)) || node;\n+  }\n+}\n+\n+/**\n+ * Returns a property assignment from the assignment value if the property name\n+ * matches the specified `key`, or `undefined` if there is no match.\n+ */\n+export function getPropertyAssignmentFromValue(value: ts.Node, key: string): ts.PropertyAssignment|\n+    undefined {\n+  const propAssignment = value.parent;\n+  if (!propAssignment || !ts.isPropertyAssignment(propAssignment) ||\n+      propAssignment.name.getText() !== key) {\n+    return;\n+  }\n+  return propAssignment;\n+}\n+\n+/**\n+ * Given the node which is the string of the inline template for a component, returns the\n+ * `ts.ClassDeclaration` for the component.\n+ */\n+export function getClassDeclOfInlineTemplateNode(templateStringNode: ts.Node): ts.ClassDeclaration|\n+    undefined {\n+  if (!ts.isStringLiteralLike(templateStringNode)) {\n+    return;\n+  }\n+  const tmplAsgn = getPropertyAssignmentFromValue(templateStringNode, 'template');\n+  if (!tmplAsgn) {\n+    return;\n+  }\n+  return getClassDeclFromDecoratorProp(tmplAsgn);\n+}\n+\n+/**\n+ * Given a decorator property assignment, return the ClassDeclaration node that corresponds to the\n+ * directive class the property applies to.\n+ * If the property assignment is not on a class decorator, no declaration is returned.\n+ *\n+ * For example,\n+ *\n+ * @Component({\n+ *   template: '<div></div>'\n+ *   ^^^^^^^^^^^^^^^^^^^^^^^---- property assignment\n+ * })\n+ * class AppComponent {}\n+ *           ^---- class declaration node\n+ *\n+ * @param propAsgnNode property assignment\n+ */\n+export function getClassDeclFromDecoratorProp(propAsgnNode: ts.PropertyAssignment):\n+    ts.ClassDeclaration|undefined {\n+  if (!propAsgnNode.parent || !ts.isObjectLiteralExpression(propAsgnNode.parent)) {\n+    return;\n+  }\n+  const objLitExprNode = propAsgnNode.parent;\n+  if (!objLitExprNode.parent || !ts.isCallExpression(objLitExprNode.parent)) {\n+    return;\n+  }\n+  const callExprNode = objLitExprNode.parent;\n+  if (!callExprNode.parent || !ts.isDecorator(callExprNode.parent)) {\n+    return;\n+  }\n+  const decorator = callExprNode.parent;\n+  if (!decorator.parent || !ts.isClassDeclaration(decorator.parent)) {\n+    return;\n+  }\n+  const classDeclNode = decorator.parent;\n+  return classDeclNode;\n+}"
        },
        {
            "sha": "1ce6b56f8b0d065b5a699ec2b8da0d3d5fd1d29c",
            "filename": "packages/language-service/src/typescript_host.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Ftypescript_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Ftypescript_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Ftypescript_host.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -10,12 +10,10 @@ import {analyzeNgModules, AotSummaryResolver, CompileDirectiveSummary, CompileMe\n import {SchemaMetadata, ViewEncapsulation, Console as Console} from '@angular/core';\n import * as tss from 'typescript/lib/tsserverlibrary';\n \n-import {findTightestNode, getClassDeclOfInlineTemplateNode} from '../common/ts_utils';\n-\n import {createLanguageService} from './language_service';\n import {ReflectorHost} from './reflector_host';\n import {ExternalTemplate, InlineTemplate} from './template';\n-import {getDirectiveClassLike} from './ts_utils';\n+import {findTightestNode, getClassDeclOfInlineTemplateNode, getDirectiveClassLike} from './ts_utils';\n import {AstResult, Declaration, DeclarationError, DiagnosticMessageChain, LanguageService, LanguageServiceHost, Span, TemplateSource} from './types';\n \n /**"
        },
        {
            "sha": "9cbb0432fb5c8a2802e1d8281f8639c9fc5fffa7",
            "filename": "packages/language-service/src/utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Fsrc%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fsrc%2Futils.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n import {AstPath, BoundEventAst, CompileDirectiveSummary, CompileTypeMetadata, CssSelector, DirectiveAst, ElementAst, EmbeddedTemplateAst, HtmlAstPath, identifierName, Identifiers, Node, ParseSourceSpan, RecursiveTemplateAstVisitor, RecursiveVisitor, TemplateAst, TemplateAstPath, templateVisitAll, visitAll} from '@angular/compiler';\n+import {getClassDeclFromDecoratorProp, getPropertyAssignmentFromValue} from './ts_utils';\n import {AstResult, DiagnosticTemplateInfo, SelectorInfo, Span, Symbol, SymbolQuery} from './types';\n \n interface SpanHolder {"
        },
        {
            "sha": "36bd6f7771f73c4d41a00183b991470b7d8f8a49",
            "filename": "packages/language-service/test/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Ftest%2FBUILD.bazel?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -59,7 +59,6 @@ ts_library(\n         \"//packages/compiler\",\n         \"//packages/language-service\",\n         \"//packages/language-service:ts_utils\",\n-        \"//packages/language-service/common\",\n         \"@npm//typescript\",\n     ],\n )"
        },
        {
            "sha": "b29b7cccb02f4dd332c22752770285ea8495aac9",
            "filename": "packages/language-service/test/utils_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Ftest%2Futils_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/643c96184c48bb6c07e5c7db371e116ff1021ea5/packages%2Flanguage-service%2Ftest%2Futils_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Ftest%2Futils_spec.ts?ref=643c96184c48bb6c07e5c7db371e116ff1021ea5",
            "patch": "@@ -9,8 +9,7 @@\n import * as ng from '@angular/compiler';\n import * as ts from 'typescript';\n \n-import {getClassDeclFromDecoratorProp} from '../common/ts_utils';\n-import {getDirectiveClassLike} from '../src/ts_utils';\n+import {getClassDeclFromDecoratorProp, getDirectiveClassLike} from '../src/ts_utils';\n import {getPathToNodeAtPosition} from '../src/utils';\n import {MockTypescriptHost} from './test_utils';\n "
        }
    ],
    "stats": {
        "total": 897,
        "additions": 563,
        "deletions": 334
    }
}