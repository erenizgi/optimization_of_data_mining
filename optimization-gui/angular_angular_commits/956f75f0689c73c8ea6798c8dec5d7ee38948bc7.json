{
    "author": "kasaharu",
    "message": "docs: fix the docs because the interface does not exist (#40308)\n\nPR Close #40308",
    "sha": "956f75f0689c73c8ea6798c8dec5d7ee38948bc7",
    "files": [
        {
            "sha": "a94cde3174462167db13cfea07533dbbcc3266de",
            "filename": "aio/content/examples/schematics-for-libraries/projects/my-lib/schematics/my-service/index.ts",
            "status": "modified",
            "additions": 33,
            "deletions": 17,
            "changes": 50,
            "blob_url": "https://github.com/angular/angular/blob/956f75f0689c73c8ea6798c8dec5d7ee38948bc7/aio%2Fcontent%2Fexamples%2Fschematics-for-libraries%2Fprojects%2Fmy-lib%2Fschematics%2Fmy-service%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/956f75f0689c73c8ea6798c8dec5d7ee38948bc7/aio%2Fcontent%2Fexamples%2Fschematics-for-libraries%2Fprojects%2Fmy-lib%2Fschematics%2Fmy-service%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fschematics-for-libraries%2Fprojects%2Fmy-lib%2Fschematics%2Fmy-service%2Findex.ts?ref=956f75f0689c73c8ea6798c8dec5d7ee38948bc7",
            "patch": "@@ -6,37 +6,53 @@ import {\n   chain, mergeWith\n } from '@angular-devkit/schematics';\n \n-import { strings, normalize, experimental } from '@angular-devkit/core';\n+import { strings, normalize, virtualFs, workspaces } from '@angular-devkit/core';\n // #enddocregion schematics-imports\n \n import { Schema as MyServiceSchema } from './schema';\n // #enddocregion schema-imports\n \n-export function myService(options: MyServiceSchema): Rule {\n-  return (tree: Tree) => {\n-    const workspaceConfig = tree.read('/angular.json');\n-    if (!workspaceConfig) {\n-      throw new SchematicsException('Could not find Angular workspace configuration');\n-    }\n+function createHost(tree: Tree): workspaces.WorkspaceHost {\n+  return {\n+    async readFile(path: string): Promise<string> {\n+      const data = tree.read(path);\n+      if (!data) {\n+        throw new SchematicsException('File not found.');\n+      }\n+      return virtualFs.fileBufferToString(data);\n+    },\n+    async writeFile(path: string, data: string): Promise<void> {\n+      return tree.overwrite(path, data);\n+    },\n+    async isDirectory(path: string): Promise<boolean> {\n+      return !tree.exists(path) && tree.getDir(path).subfiles.length > 0;\n+    },\n+    async isFile(path: string): Promise<boolean> {\n+      return tree.exists(path);\n+    },\n+  };\n+}\n \n-    // convert workspace to string\n-    const workspaceContent = workspaceConfig.toString();\n+export function myService(options: MyServiceSchema): Rule {\n+  return async (tree: Tree) => {\n+    const host = createHost(tree);\n+    const { workspace } = await workspaces.readWorkspace('/', host);\n \n-    // parse workspace string into JSON object\n-    const workspace: experimental.workspace.WorkspaceSchema = JSON.parse(workspaceContent);\n // #enddocregion workspace\n+\n+// #docregion project-info\n // #docregion project-fallback\n     if (!options.project) {\n-      options.project = workspace.defaultProject;\n+      options.project = workspace.extensions.defaultProject;\n     }\n // #enddocregion project-fallback\n \n-// #docregion project-info\n-    const projectName = options.project as string;\n-\n-    const project = workspace.projects[projectName];\n+    const project = workspace.projects.get(options.project);\n+    if (!project) {\n+      throw new SchematicsException(`Invalid project name: ${options.project}`);\n+    }\n \n-    const projectType = project.projectType === 'application' ? 'app' : 'lib';\n+    const projectType = project.extensions.projectType === 'application' ? 'app' : 'lib';\n // #enddocregion project-info\n \n // #docregion path"
        },
        {
            "sha": "727bb9c54a2a17a3cf625fc3671f59330bbd231c",
            "filename": "aio/content/guide/schematics-for-libraries.md",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/956f75f0689c73c8ea6798c8dec5d7ee38948bc7/aio%2Fcontent%2Fguide%2Fschematics-for-libraries.md",
            "raw_url": "https://github.com/angular/angular/raw/956f75f0689c73c8ea6798c8dec5d7ee38948bc7/aio%2Fcontent%2Fguide%2Fschematics-for-libraries.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fguide%2Fschematics-for-libraries.md?ref=956f75f0689c73c8ea6798c8dec5d7ee38948bc7",
            "patch": "@@ -218,17 +218,16 @@ The `Tree` methods give you access to the complete file tree in your workspace,\n \n ### Get the project configuration\n \n-1. To determine the destination project, use the `Tree.read()` method to read the contents of the workspace configuration file, `angular.json`, at the root of the workspace.\n+1. To determine the destination project, use the `workspaces.readWorkspace` method to read the contents of the workspace configuration file, `angular.json`.\n+   To use `workspaces.readWorkspace` you need to create a `workspaces.WorkspaceHost` from the `Tree`.\n    Add the following code to your factory function.\n \n <code-example header=\"projects/my-lib/schematics/my-service/index.ts (Schema Import)\" path=\"schematics-for-libraries/projects/my-lib/schematics/my-service/index.ts\" region=\"workspace\">\n </code-example>\n \n   * Be sure to check that the context exists and throw the appropriate error.\n \n-  * After reading the contents into a string, parse the configuration into a JSON object, typed to the `WorkspaceSchema`.\n-\n-1. The `WorkspaceSchema` contains all the properties of the workspace configuration, including a `defaultProject` value for determining which project to use if not provided.\n+1. The `WorkspaceDefinition`, `extensions` property includes a `defaultProject` value for determining which project to use if not provided.\n    We will use that value as a fallback, if no project is explicitly specified in the `ng generate` command.\n \n <code-example header=\"projects/my-lib/schematics/my-service/index.ts (Default Project)\" path=\"schematics-for-libraries/projects/my-lib/schematics/my-service/index.ts\" region=\"project-fallback\">"
        }
    ],
    "stats": {
        "total": 57,
        "additions": 36,
        "deletions": 21
    }
}