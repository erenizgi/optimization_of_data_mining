{
    "author": "crisbeto",
    "message": "perf(core): avoid storing LView in __ngContext__ (#41358)\n\nCurrently we save a reference to an `LView` on most DOM nodes created by Angular either by saving\nthe `LView` directly in the `__ngContext__` or by saving the `LContext` which has a reference to\nthe `LView`. This can be a problem if the DOM node is retained in memory, because the `LView` has\nreferences to all of the child nodes of the view, as well as other internal data structures.\n\nPreviously we tried to resolve the issue by clearing the `__ngContext__` when a node is removed\n(see https://github.com/angular/angular/pull/36011), but we decided not to proceeed, because it can\nslow down destruction due to a megamorphic write.\n\nThese changes aim to address the issue while reducing the performance impact by assigning a unique\nID when an `LView` is created and adding it to `__ngContext__`. All active views are tracked in\na map where their unique ID is used as the key. We don't need to worry about leaks within that map,\nbecause `LView`s are an internal data structure and we have complete control over when they are\ncreated and destroyed.\n\nFixes #41047.\n\nPR Close #41358",
    "sha": "18b33e79d3d64f98f80838503e802d0369fcdb16",
    "files": [
        {
            "sha": "504f3a5b36c833e061623d7bccf8dab04a155064",
            "filename": "goldens/size-tracking/aio-payloads.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/goldens%2Fsize-tracking%2Faio-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/goldens%2Fsize-tracking%2Faio-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Faio-payloads.json?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -12,7 +12,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 3033,\n-        \"main-es2015\": 453111,\n+        \"main-es2015\": 453725,\n         \"polyfills-es2015\": 55230\n       }\n     }"
        },
        {
            "sha": "6a6ab6f0937d047f11101203c3dcb6601061ca26",
            "filename": "goldens/size-tracking/integration-payloads.json",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Fintegration-payloads.json?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -3,7 +3,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 1170,\n-        \"main-es2015\": 138189,\n+        \"main-es2015\": 138718,\n         \"polyfills-es2015\": 36964\n       }\n     }\n@@ -30,7 +30,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 1190,\n-        \"main-es2015\": 136546,\n+        \"main-es2015\": 137087,\n         \"polyfills-es2015\": 37641\n       }\n     }\n@@ -39,7 +39,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 3354,\n-        \"main-es2015\": 295076,\n+        \"main-es2015\": 295755,\n         \"polyfills-es2015\": 36975,\n         \"src_app_lazy_lazy_module_ts-es2015\": 825\n       }"
        },
        {
            "sha": "c630f82a3cd6f0ee2d0aba995294fddec1774734",
            "filename": "packages/core/src/debug/debug_node.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 13,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Fdebug%2Fdebug_node.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Fdebug%2Fdebug_node.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdebug%2Fdebug_node.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -262,9 +262,10 @@ class DebugElement__POST_R3__ extends DebugNode__POST_R3__ implements DebugEleme\n   }\n \n   get name(): string {\n-    const context = getLContext(this.nativeNode);\n-    if (context !== null) {\n-      const lView = context.lView;\n+    const context = getLContext(this.nativeNode)!;\n+    const lView = context ? context.lView : null;\n+\n+    if (lView !== null) {\n       const tData = lView[TVIEW].data;\n       const tNode = tData[context.nodeIndex] as TNode;\n       return tNode.value!;\n@@ -286,12 +287,13 @@ class DebugElement__POST_R3__ extends DebugNode__POST_R3__ implements DebugEleme\n    *  - attribute bindings (e.g. `[attr.role]=\"menu\"`)\n    */\n   get properties(): {[key: string]: any;} {\n-    const context = getLContext(this.nativeNode);\n-    if (context === null) {\n+    const context = getLContext(this.nativeNode)!;\n+    const lView = context ? context.lView : null;\n+\n+    if (lView === null) {\n       return {};\n     }\n \n-    const lView = context.lView;\n     const tData = lView[TVIEW].data;\n     const tNode = tData[context.nodeIndex] as TNode;\n \n@@ -312,12 +314,13 @@ class DebugElement__POST_R3__ extends DebugNode__POST_R3__ implements DebugEleme\n       return attributes;\n     }\n \n-    const context = getLContext(element);\n-    if (context === null) {\n+    const context = getLContext(element)!;\n+    const lView = context ? context.lView : null;\n+\n+    if (lView === null) {\n       return {};\n     }\n \n-    const lView = context.lView;\n     const tNodeAttrs = (lView[TVIEW].data[context.nodeIndex] as TNode).attrs;\n     const lowercaseTNodeAttrs: string[] = [];\n \n@@ -502,11 +505,12 @@ function _queryAllR3(\n function _queryAllR3(\n     parentElement: DebugElement, predicate: Predicate<DebugElement>|Predicate<DebugNode>,\n     matches: DebugElement[]|DebugNode[], elementsOnly: boolean) {\n-  const context = getLContext(parentElement.nativeNode);\n-  if (context !== null) {\n-    const parentTNode = context.lView[TVIEW].data[context.nodeIndex] as TNode;\n+  const context = getLContext(parentElement.nativeNode)!;\n+  const lView = context ? context.lView : null;\n+  if (lView !== null) {\n+    const parentTNode = lView[TVIEW].data[context.nodeIndex] as TNode;\n     _queryNodeChildrenR3(\n-        parentTNode, context.lView, predicate, matches, elementsOnly, parentElement.nativeNode);\n+        parentTNode, lView, predicate, matches, elementsOnly, parentElement.nativeNode);\n   } else {\n     // If the context is null, then `parentElement` was either created with Renderer2 or native DOM\n     // APIs."
        },
        {
            "sha": "e57b980f0c6a348127147dcfd6eef75d1bc4ae0d",
            "filename": "packages/core/src/render3/context_discovery.ts",
            "status": "modified",
            "additions": 27,
            "deletions": 29,
            "changes": 56,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fcontext_discovery.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -8,12 +8,15 @@\n import '../util/ng_dev_mode';\n \n import {assertDefined, assertDomNode} from '../util/assert';\n-\n import {EMPTY_ARRAY} from '../util/empty';\n+\n+import {assertLView} from './assert';\n import {LContext} from './interfaces/context';\n+import {getLViewById} from './interfaces/lview_tracking';\n import {TNode, TNodeFlags} from './interfaces/node';\n import {RElement, RNode} from './interfaces/renderer_dom';\n-import {CONTEXT, HEADER_OFFSET, HOST, LView, TVIEW} from './interfaces/view';\n+import {isLView} from './interfaces/type_checks';\n+import {CONTEXT, HEADER_OFFSET, HOST, ID, LView, TVIEW} from './interfaces/view';\n import {getComponentLViewByIndex, unwrapRNode} from './util/view_utils';\n \n \n@@ -43,7 +46,7 @@ export function getLContext(target: any): LContext|null {\n   if (mpValue) {\n     // only when it's an array is it considered an LView instance\n     // ... otherwise it's an already constructed LContext instance\n-    if (Array.isArray(mpValue)) {\n+    if (isLView(mpValue)) {\n       const lView: LView = mpValue!;\n       let nodeIndex: number;\n       let component: any = undefined;\n@@ -105,12 +108,7 @@ export function getLContext(target: any): LContext|null {\n     while (parent = parent.parentNode) {\n       const parentContext = readPatchedData(parent);\n       if (parentContext) {\n-        let lView: LView|null;\n-        if (Array.isArray(parentContext)) {\n-          lView = parentContext as LView;\n-        } else {\n-          lView = parentContext.lView;\n-        }\n+        const lView = Array.isArray(parentContext) ? parentContext as LView : parentContext.lView;\n \n         // the edge of the app was also reached here through another means\n         // (maybe because the DOM was changed manually).\n@@ -136,14 +134,7 @@ export function getLContext(target: any): LContext|null {\n  * Creates an empty instance of a `LContext` context\n  */\n function createLContext(lView: LView, nodeIndex: number, native: RNode): LContext {\n-  return {\n-    lView,\n-    nodeIndex,\n-    native,\n-    component: undefined,\n-    directives: undefined,\n-    localRefs: undefined,\n-  };\n+  return new LContext(lView[ID], nodeIndex, native);\n }\n \n /**\n@@ -153,21 +144,24 @@ function createLContext(lView: LView, nodeIndex: number, native: RNode): LContex\n  * @returns The component's view\n  */\n export function getComponentViewByInstance(componentInstance: {}): LView {\n-  let lView = readPatchedData(componentInstance);\n-  let view: LView;\n+  let patchedData = readPatchedData(componentInstance);\n+  let lView: LView;\n \n-  if (Array.isArray(lView)) {\n-    const nodeIndex = findViaComponent(lView, componentInstance);\n-    view = getComponentLViewByIndex(nodeIndex, lView);\n-    const context = createLContext(lView, nodeIndex, view[HOST] as RElement);\n+  if (isLView(patchedData)) {\n+    const contextLView: LView = patchedData;\n+    const nodeIndex = findViaComponent(contextLView, componentInstance);\n+    lView = getComponentLViewByIndex(nodeIndex, contextLView);\n+    const context = createLContext(contextLView, nodeIndex, lView[HOST] as RElement);\n     context.component = componentInstance;\n     attachPatchData(componentInstance, context);\n     attachPatchData(context.native, context);\n   } else {\n-    const context = lView as any as LContext;\n-    view = getComponentLViewByIndex(context.nodeIndex, context.lView);\n+    const context = patchedData as unknown as LContext;\n+    const contextLView = context.lView!;\n+    ngDevMode && assertLView(contextLView);\n+    lView = getComponentLViewByIndex(context.nodeIndex, contextLView);\n   }\n-  return view;\n+  return lView;\n }\n \n /**\n@@ -181,7 +175,10 @@ const MONKEY_PATCH_KEY_NAME = '__ngContext__';\n  */\n export function attachPatchData(target: any, data: LView|LContext) {\n   ngDevMode && assertDefined(target, 'Target expected');\n-  target[MONKEY_PATCH_KEY_NAME] = data;\n+  // Only attach the ID of the view in order to avoid memory leaks (see #41047). We only do this\n+  // for `LView`, because we have control over when an `LView` is created and destroyed, whereas\n+  // we can't know when to remove an `LContext`.\n+  target[MONKEY_PATCH_KEY_NAME] = isLView(data) ? data[ID] : data;\n }\n \n /**\n@@ -190,13 +187,14 @@ export function attachPatchData(target: any, data: LView|LContext) {\n  */\n export function readPatchedData(target: any): LView|LContext|null {\n   ngDevMode && assertDefined(target, 'Target expected');\n-  return target[MONKEY_PATCH_KEY_NAME] || null;\n+  const data = target[MONKEY_PATCH_KEY_NAME];\n+  return (typeof data === 'number') ? getLViewById(data) : data || null;\n }\n \n export function readPatchedLView(target: any): LView|null {\n   const value = readPatchedData(target);\n   if (value) {\n-    return Array.isArray(value) ? value : (value as LContext).lView;\n+    return isLView(value) ? value : value.lView;\n   }\n   return null;\n }"
        },
        {
            "sha": "7a7551f27df690e51351372435158abe8b47deb0",
            "filename": "packages/core/src/render3/instructions/lview_debug.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -25,7 +25,7 @@ import {LQueries, TQueries} from '../interfaces/query';\n import {Renderer3, RendererFactory3} from '../interfaces/renderer';\n import {RComment, RElement, RNode} from '../interfaces/renderer_dom';\n import {getTStylingRangeNext, getTStylingRangeNextDuplicate, getTStylingRangePrev, getTStylingRangePrevDuplicate, TStylingKey, TStylingRange} from '../interfaces/styling';\n-import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DebugNode, DECLARATION_VIEW, DestroyHookData, FLAGS, HEADER_OFFSET, HookData, HOST, HostBindingOpCodes, INJECTOR, LContainerDebug as ILContainerDebug, LView, LViewDebug as ILViewDebug, LViewDebugRange, LViewDebugRangeContent, LViewFlags, NEXT, NodeInjectorDebug, PARENT, QUERIES, RENDERER, RENDERER_FACTORY, SANITIZER, T_HOST, TData, TView as ITView, TVIEW, TView, TViewType, TViewTypeAsString} from '../interfaces/view';\n+import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DebugNode, DECLARATION_VIEW, DestroyHookData, FLAGS, HEADER_OFFSET, HookData, HOST, HostBindingOpCodes, ID, INJECTOR, LContainerDebug as ILContainerDebug, LView, LViewDebug as ILViewDebug, LViewDebugRange, LViewDebugRangeContent, LViewFlags, NEXT, NodeInjectorDebug, PARENT, QUERIES, RENDERER, RENDERER_FACTORY, SANITIZER, T_HOST, TData, TView as ITView, TVIEW, TView, TViewType, TViewTypeAsString} from '../interfaces/view';\n import {attachDebugObject} from '../util/debug_utils';\n import {getParentInjectorIndex, getParentInjectorView} from '../util/injector_utils';\n import {unwrapRNode} from '../util/view_utils';\n@@ -513,6 +513,9 @@ export class LViewDebug implements ILViewDebug {\n   get tHost(): ITNode|null {\n     return this._raw_lView[T_HOST];\n   }\n+  get id(): number {\n+    return this._raw_lView[ID];\n+  }\n \n   get decls(): LViewDebugRange {\n     return toLViewRange(this.tView, this._raw_lView, HEADER_OFFSET, this.tView.bindingStartIndex);"
        },
        {
            "sha": "47590176da46ad17bfcb7f8892b930164ca12bba",
            "filename": "packages/core/src/render3/instructions/shared.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -28,12 +28,13 @@ import {executeCheckHooks, executeInitAndCheckHooks, incrementInitPhaseFlags} fr\n import {CONTAINER_HEADER_OFFSET, HAS_TRANSPLANTED_VIEWS, LContainer, MOVED_VIEWS} from '../interfaces/container';\n import {ComponentDef, ComponentTemplate, DirectiveDef, DirectiveDefListOrFactory, HostBindingsFunction, PipeDefListOrFactory, RenderFlags, ViewQueriesFunction} from '../interfaces/definition';\n import {NodeInjectorFactory} from '../interfaces/injector';\n+import {registerLView} from '../interfaces/lview_tracking';\n import {AttributeMarker, InitialInputData, InitialInputs, LocalRefExtractor, PropertyAliases, PropertyAliasValue, TAttributes, TConstantsOrFactory, TContainerNode, TDirectiveHostNode, TElementContainerNode, TElementNode, TIcuContainerNode, TNode, TNodeFlags, TNodeType, TProjectionNode} from '../interfaces/node';\n import {isProceduralRenderer, Renderer3, RendererFactory3} from '../interfaces/renderer';\n import {RComment, RElement, RNode, RText} from '../interfaces/renderer_dom';\n import {SanitizerFn} from '../interfaces/sanitization';\n import {isComponentDef, isComponentHost, isContentQueryHost, isRootView} from '../interfaces/type_checks';\n-import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DECLARATION_COMPONENT_VIEW, DECLARATION_VIEW, FLAGS, HEADER_OFFSET, HOST, HostBindingOpCodes, InitPhaseState, INJECTOR, LView, LViewFlags, NEXT, PARENT, RENDERER, RENDERER_FACTORY, RootContext, RootContextFlags, SANITIZER, T_HOST, TData, TRANSPLANTED_VIEWS_TO_REFRESH, TVIEW, TView, TViewType} from '../interfaces/view';\n+import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DECLARATION_COMPONENT_VIEW, DECLARATION_VIEW, FLAGS, HEADER_OFFSET, HOST, HostBindingOpCodes, ID, InitPhaseState, INJECTOR, LView, LViewFlags, NEXT, PARENT, RENDERER, RENDERER_FACTORY, RootContext, RootContextFlags, SANITIZER, T_HOST, TData, TRANSPLANTED_VIEWS_TO_REFRESH, TVIEW, TView, TViewType} from '../interfaces/view';\n import {assertPureTNodeType, assertTNodeType} from '../node_assert';\n import {updateTextNode} from '../node_manipulation';\n import {isInlineTemplate, isNodeMatchingSelectorList} from '../node_selector_matcher';\n@@ -143,6 +144,7 @@ export function createLView<T>(\n   lView[SANITIZER] = sanitizer || parentLView && parentLView[SANITIZER] || null!;\n   lView[INJECTOR as any] = injector || parentLView && parentLView[INJECTOR] || null;\n   lView[T_HOST] = tHostNode;\n+  lView[ID] = registerLView(lView);\n   ngDevMode &&\n       assertEqual(\n           tView.type == TViewType.Embedded ? parentLView !== null : true, true,\n@@ -1906,9 +1908,12 @@ export function scheduleTick(rootContext: RootContext, flags: RootContextFlags)\n export function tickRootContext(rootContext: RootContext) {\n   for (let i = 0; i < rootContext.components.length; i++) {\n     const rootComponent = rootContext.components[i];\n-    const lView = readPatchedLView(rootComponent)!;\n-    const tView = lView[TVIEW];\n-    renderComponentOrTemplate(tView, lView, tView.template, rootComponent);\n+    const lView = readPatchedLView(rootComponent);\n+    // We might not have an `LView` if the component was destroyed.\n+    if (lView !== null) {\n+      const tView = lView[TVIEW];\n+      renderComponentOrTemplate(tView, lView, tView.template, rootComponent);\n+    }\n   }\n }\n "
        },
        {
            "sha": "e097719190d110b41b826fedccf03704322b082f",
            "filename": "packages/core/src/render3/interfaces/context.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 21,
            "changes": 49,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fcontext.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fcontext.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fcontext.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -7,6 +7,7 @@\n  */\n \n \n+import {getLViewById} from './lview_tracking';\n import {RNode} from './renderer_dom';\n import {LView} from './view';\n \n@@ -21,35 +22,41 @@ import {LView} from './view';\n  * function. The component, element and each directive instance will share the same instance\n  * of the context.\n  */\n-export interface LContext {\n-  /**\n-   * The component's parent view data.\n-   */\n-  lView: LView;\n-\n-  /**\n-   * The index instance of the node.\n-   */\n-  nodeIndex: number;\n-\n-  /**\n-   * The instance of the DOM node that is attached to the lNode.\n-   */\n-  native: RNode;\n-\n+export class LContext {\n   /**\n    * The instance of the Component node.\n    */\n-  component: {}|null|undefined;\n+  public component: {}|null|undefined;\n \n   /**\n    * The list of active directives that exist on this element.\n    */\n-  directives: any[]|null|undefined;\n+  public directives: any[]|null|undefined;\n \n   /**\n-   * The map of local references (local reference name => element or directive instance) that exist\n-   * on this element.\n+   * The map of local references (local reference name => element or directive instance) that\n+   * exist on this element.\n    */\n-  localRefs: {[key: string]: any}|null|undefined;\n+  public localRefs: {[key: string]: any}|null|undefined;\n+\n+  /** Component's parent view data. */\n+  get lView(): LView|null {\n+    return getLViewById(this.lViewId);\n+  }\n+\n+  constructor(\n+      /**\n+       * ID of the component's parent view data.\n+       */\n+      private lViewId: number,\n+\n+      /**\n+       * The index instance of the node.\n+       */\n+      public nodeIndex: number,\n+\n+      /**\n+       * The instance of the DOM node that is attached to the lNode.\n+       */\n+      public native: RNode) {}\n }"
        },
        {
            "sha": "7c965ff98a6228cbaf5a364900d661b42f2ef322",
            "filename": "packages/core/src/render3/interfaces/lview_tracking.ts",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Flview_tracking.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Flview_tracking.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Flview_tracking.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -0,0 +1,35 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {assertNumber} from '../../util/assert';\n+import {ID, LView} from './view';\n+\n+// Keeps track of the currently-active LViews.\n+const TRACKED_LVIEWS = new Map<number, LView>();\n+\n+// Used for generating unique IDs for LViews.\n+let uniqueIdCounter = 0;\n+\n+/** Starts tracking an LView and returns a unique ID that can be used for future lookups. */\n+export function registerLView(lView: LView): number {\n+  const id = uniqueIdCounter++;\n+  TRACKED_LVIEWS.set(id, lView);\n+  return id;\n+}\n+\n+/** Gets an LView by its unique ID. */\n+export function getLViewById(id: number): LView|null {\n+  ngDevMode && assertNumber(id, 'ID used for LView lookup must be a number');\n+  return TRACKED_LVIEWS.get(id) || null;\n+}\n+\n+/** Stops tracking an LView. */\n+export function unregisterLView(lView: LView): void {\n+  ngDevMode && assertNumber(lView[ID], 'Cannot stop tracking an LView that does not have an ID');\n+  TRACKED_LVIEWS.delete(lView[ID]);\n+}"
        },
        {
            "sha": "34d12482f4db6edcc2e974673df41eecdcb51151",
            "filename": "packages/core/src/render3/interfaces/view.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -47,14 +47,15 @@ export const DECLARATION_COMPONENT_VIEW = 16;\n export const DECLARATION_LCONTAINER = 17;\n export const PREORDER_HOOK_FLAGS = 18;\n export const QUERIES = 19;\n+export const ID = 20;\n /**\n  * Size of LView's header. Necessary to adjust for it when setting slots.\n  *\n  * IMPORTANT: `HEADER_OFFSET` should only be referred to the in the `ɵɵ*` instructions to translate\n  * instruction index into `LView` index. All other indexes should be in the `LView` index space and\n  * there should be no need to refer to `HEADER_OFFSET` anywhere else.\n  */\n-export const HEADER_OFFSET = 20;\n+export const HEADER_OFFSET = 21;\n \n \n // This interface replaces the real LView interface if it is an arg or a\n@@ -326,6 +327,9 @@ export interface LView extends Array<any> {\n    * are not `Dirty`/`CheckAlways`.\n    */\n   [TRANSPLANTED_VIEWS_TO_REFRESH]: number;\n+\n+  /** Unique ID of the view. Used for `__ngContext__` lookups in the `LView` registry. */\n+  [ID]: number;\n }\n \n /** Flags associated with an LView (saved in LView[FLAGS]) */"
        },
        {
            "sha": "35ce7660982b54a65a3929159b8a1cb275b8fb16",
            "filename": "packages/core/src/render3/node_manipulation.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Fnode_manipulation.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Fnode_manipulation.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fnode_manipulation.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -19,6 +19,7 @@ import {icuContainerIterate} from './i18n/i18n_tree_shaking';\n import {CONTAINER_HEADER_OFFSET, HAS_TRANSPLANTED_VIEWS, LContainer, MOVED_VIEWS, NATIVE, unusedValueExportToPlacateAjd as unused1} from './interfaces/container';\n import {ComponentDef} from './interfaces/definition';\n import {NodeInjectorFactory} from './interfaces/injector';\n+import {unregisterLView} from './interfaces/lview_tracking';\n import {TElementNode, TIcuContainerNode, TNode, TNodeFlags, TNodeType, TProjectionNode, unusedValueExportToPlacateAjd as unused2} from './interfaces/node';\n import {unusedValueExportToPlacateAjd as unused3} from './interfaces/projection';\n import {isProceduralRenderer, ProceduralRenderer3, Renderer3, unusedValueExportToPlacateAjd as unused4} from './interfaces/renderer';\n@@ -395,6 +396,7 @@ export function destroyLView(tView: TView, lView: LView) {\n     }\n \n     destroyViewTree(lView);\n+    unregisterLView(lView);\n   }\n }\n "
        },
        {
            "sha": "37d60efe8fd35d9d27ed34625f4a36eef2a62a74",
            "filename": "packages/core/src/render3/util/discovery_utils.ts",
            "status": "modified",
            "additions": 41,
            "deletions": 28,
            "changes": 69,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -11,7 +11,7 @@ import {Injector} from '../../di/injector';\n import {ViewEncapsulation} from '../../metadata/view';\n import {assertEqual} from '../../util/assert';\n import {assertLView} from '../assert';\n-import {discoverLocalRefs, getComponentAtNodeIndex, getDirectivesAtNodeIndex, getLContext} from '../context_discovery';\n+import {discoverLocalRefs, getComponentAtNodeIndex, getDirectivesAtNodeIndex, getLContext, readPatchedLView} from '../context_discovery';\n import {getComponentDef, getDirectiveDef} from '../definition';\n import {NodeInjector} from '../di';\n import {buildDebugNode} from '../instructions/lview_debug';\n@@ -20,6 +20,7 @@ import {DirectiveDef} from '../interfaces/definition';\n import {TElementNode, TNode, TNodeProviderIndexes} from '../interfaces/node';\n import {isLView} from '../interfaces/type_checks';\n import {CLEANUP, CONTEXT, DebugNode, FLAGS, LView, LViewFlags, T_HOST, TVIEW, TViewType} from '../interfaces/view';\n+\n import {stringifyForError} from './stringify_utils';\n import {getLViewParent, getRootContext} from './view_traversal_utils';\n import {getTNode, unwrapRNode} from './view_utils';\n@@ -52,12 +53,16 @@ import {getTNode, unwrapRNode} from './view_utils';\n  * @globalApi ng\n  */\n export function getComponent<T>(element: Element): T|null {\n-  assertDomElement(element);\n+  ngDevMode && assertDomElement(element);\n   const context = getLContext(element);\n   if (context === null) return null;\n \n   if (context.component === undefined) {\n-    context.component = getComponentAtNodeIndex(context.nodeIndex, context.lView);\n+    const lView = context.lView;\n+    if (lView === null) {\n+      return null;\n+    }\n+    context.component = getComponentAtNodeIndex(context.nodeIndex, lView);\n   }\n \n   return context.component as T;\n@@ -78,8 +83,9 @@ export function getComponent<T>(element: Element): T|null {\n  */\n export function getContext<T>(element: Element): T|null {\n   assertDomElement(element);\n-  const context = getLContext(element);\n-  return context === null ? null : context.lView[CONTEXT] as T;\n+  const context = getLContext(element)!;\n+  const lView = context ? context.lView : null;\n+  return lView === null ? null : lView[CONTEXT] as T;\n }\n \n /**\n@@ -98,12 +104,11 @@ export function getContext<T>(element: Element): T|null {\n  * @globalApi ng\n  */\n export function getOwningComponent<T>(elementOrDir: Element|{}): T|null {\n-  const context = getLContext(elementOrDir);\n-  if (context === null) return null;\n+  const context = getLContext(elementOrDir)!;\n+  let lView = context ? context.lView : null;\n+  if (lView === null) return null;\n \n-  let lView = context.lView;\n   let parent: LView|null;\n-  ngDevMode && assertLView(lView);\n   while (lView[TVIEW].type === TViewType.Embedded && (parent = getLViewParent(lView)!)) {\n     lView = parent;\n   }\n@@ -122,7 +127,8 @@ export function getOwningComponent<T>(elementOrDir: Element|{}): T|null {\n  * @globalApi ng\n  */\n export function getRootComponents(elementOrDir: Element|{}): {}[] {\n-  return [...getRootContext(elementOrDir).components];\n+  const lView = readPatchedLView(elementOrDir);\n+  return lView !== null ? [...getRootContext(lView).components] : [];\n }\n \n /**\n@@ -136,11 +142,12 @@ export function getRootComponents(elementOrDir: Element|{}): {}[] {\n  * @globalApi ng\n  */\n export function getInjector(elementOrDir: Element|{}): Injector {\n-  const context = getLContext(elementOrDir);\n-  if (context === null) return Injector.NULL;\n+  const context = getLContext(elementOrDir)!;\n+  const lView = context ? context.lView : null;\n+  if (lView === null) return Injector.NULL;\n \n-  const tNode = context.lView[TVIEW].data[context.nodeIndex] as TElementNode;\n-  return new NodeInjector(tNode, context.lView);\n+  const tNode = lView[TVIEW].data[context.nodeIndex] as TElementNode;\n+  return new NodeInjector(tNode, lView);\n }\n \n /**\n@@ -149,9 +156,9 @@ export function getInjector(elementOrDir: Element|{}): Injector {\n  * @param element Element for which the injection tokens should be retrieved.\n  */\n export function getInjectionTokens(element: Element): any[] {\n-  const context = getLContext(element);\n-  if (context === null) return [];\n-  const lView = context.lView;\n+  const context = getLContext(element)!;\n+  const lView = context ? context.lView : null;\n+  if (lView === null) return [];\n   const tView = lView[TVIEW];\n   const tNode = tView.data[context.nodeIndex] as TNode;\n   const providerTokens: any[] = [];\n@@ -200,12 +207,12 @@ export function getDirectives(node: Node): {}[] {\n     return [];\n   }\n \n-  const context = getLContext(node);\n-  if (context === null) {\n+  const context = getLContext(node)!;\n+  const lView = context ? context.lView : null;\n+  if (lView === null) {\n     return [];\n   }\n \n-  const lView = context.lView;\n   const tView = lView[TVIEW];\n   const nodeIndex = context.nodeIndex;\n   if (!tView?.data[nodeIndex]) {\n@@ -297,7 +304,11 @@ export function getLocalRefs(target: {}): {[key: string]: any} {\n   if (context === null) return {};\n \n   if (context.localRefs === undefined) {\n-    context.localRefs = discoverLocalRefs(context.lView, context.nodeIndex);\n+    const lView = context.lView;\n+    if (lView === null) {\n+      return {};\n+    }\n+    context.localRefs = discoverLocalRefs(lView, context.nodeIndex);\n   }\n \n   return context.localRefs || {};\n@@ -383,11 +394,11 @@ export interface Listener {\n  * @globalApi ng\n  */\n export function getListeners(element: Element): Listener[] {\n-  assertDomElement(element);\n+  ngDevMode && assertDomElement(element);\n   const lContext = getLContext(element);\n-  if (lContext === null) return [];\n+  const lView = lContext === null ? null : lContext.lView;\n+  if (lView === null) return [];\n \n-  const lView = lContext.lView;\n   const tView = lView[TVIEW];\n   const lCleanup = lView[CLEANUP];\n   const tCleanup = tView.cleanup;\n@@ -441,12 +452,13 @@ export function getDebugNode(element: Element): DebugNode|null {\n     throw new Error('Expecting instance of DOM Element');\n   }\n \n-  const lContext = getLContext(element);\n-  if (lContext === null) {\n+  const lContext = getLContext(element)!;\n+  const lView = lContext ? lContext.lView : null;\n+\n+  if (lView === null) {\n     return null;\n   }\n \n-  const lView = lContext.lView;\n   const nodeIndex = lContext.nodeIndex;\n   if (nodeIndex !== -1) {\n     const valueInLView = lView[nodeIndex];\n@@ -473,7 +485,8 @@ export function getDebugNode(element: Element): DebugNode|null {\n export function getComponentLView(target: any): LView {\n   const lContext = getLContext(target)!;\n   const nodeIndx = lContext.nodeIndex;\n-  const lView = lContext.lView;\n+  const lView = lContext.lView!;\n+  ngDevMode && assertLView(lView);\n   const componentLView = lView[nodeIndx];\n   ngDevMode && assertLView(componentLView);\n   return componentLView;"
        },
        {
            "sha": "5b4c2b23aeeb715814b6493fd74ce100290fa020",
            "filename": "packages/core/test/acceptance/component_spec.ts",
            "status": "modified",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Facceptance%2Fcomponent_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Facceptance%2Fcomponent_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fcomponent_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -141,6 +141,47 @@ describe('component', () => {\n        expect(fixture.nativeElement.textContent.trim()).toBe('hello');\n      });\n \n+  onlyInIvy('ViewEngine has a specific error for this while Ivy does not')\n+      .it('should not throw when calling `detectChanges` on the ChangeDetectorRef of a destroyed view',\n+          () => {\n+            @Component({template: 'hello'})\n+            class HelloComponent {\n+            }\n+\n+            // TODO: This module is only used to declare the `entryComponets` since\n+            //  `configureTestingModule` doesn't support it. The module can be removed\n+            // once ViewEngine is removed.\n+            @NgModule({\n+              declarations: [HelloComponent],\n+              exports: [HelloComponent],\n+              entryComponents: [HelloComponent]\n+            })\n+            class HelloModule {\n+            }\n+\n+            @Component({template: `<div #insertionPoint></div>`})\n+            class App {\n+              @ViewChild('insertionPoint', {read: ViewContainerRef})\n+              viewContainerRef!: ViewContainerRef;\n+              constructor(public componentFactoryResolver: ComponentFactoryResolver) {}\n+            }\n+\n+            TestBed.configureTestingModule({declarations: [App], imports: [HelloModule]});\n+            const fixture = TestBed.createComponent(App);\n+            fixture.detectChanges();\n+\n+            const instance = fixture.componentInstance;\n+            const factory =\n+                instance.componentFactoryResolver.resolveComponentFactory(HelloComponent);\n+            const componentRef = instance.viewContainerRef.createComponent(factory);\n+            fixture.detectChanges();\n+\n+            expect(() => {\n+              componentRef.destroy();\n+              componentRef.changeDetectorRef.detectChanges();\n+            }).not.toThrow();\n+          });\n+\n   // TODO: add tests with Native once tests run in real browser (domino doesn't support shadow root)\n   describe('encapsulation', () => {\n     @Component({"
        },
        {
            "sha": "c12985b8abe96b0762eacd964d1debb1a7b7b25d",
            "filename": "packages/core/test/acceptance/debug_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Facceptance%2Fdebug_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Facceptance%2Fdebug_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fdebug_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -27,7 +27,7 @@ onlyInIvy('Ivy specific').describe('Debug Representation', () => {\n     const fixture = TestBed.createComponent(MyComponent);\n     fixture.detectChanges();\n \n-    const hostView = getLContext(fixture.componentInstance)!.lView.debug!;\n+    const hostView = getLContext(fixture.componentInstance)!.lView!.debug!;\n     expect(hostView.hostHTML).toEqual(null);\n     const myCompView = hostView.childViews[0] as LViewDebug;\n     expect(myCompView.hostHTML).toContain('<div id=\"123\">Hello World</div>');\n@@ -47,7 +47,7 @@ onlyInIvy('Ivy specific').describe('Debug Representation', () => {\n         const fixture = TestBed.createComponent(MyComponent);\n         fixture.detectChanges();\n \n-        const hostView = getLContext(fixture.componentInstance)!.lView.debug!;\n+        const hostView = getLContext(fixture.componentInstance)!.lView!.debug!;\n         const myComponentView = hostView.childViews[0] as LViewDebug;\n         expect(myComponentView.decls).toEqual({\n           start: HEADER_OFFSET,"
        },
        {
            "sha": "05a583b3a4b90bd30672552a54eb1f15312b9776",
            "filename": "packages/core/test/acceptance/discover_utils_spec.ts",
            "status": "modified",
            "additions": 69,
            "deletions": 2,
            "changes": 71,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Facceptance%2Fdiscover_utils_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Facceptance%2Fdiscover_utils_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fdiscover_utils_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -69,16 +69,19 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n   @Component({\n     selector: 'my-app',\n     template: `\n-      <span (click)=\"log($event)\">{{text}}</span>\n+      <span (click)=\"log($event)\" *ngIf=\"spanVisible\">{{text}}</span>\n       <div dirA #div #foo=\"dirA\"></div>\n       <child></child>\n       <child dirA #child></child>\n-      <child dirA *ngIf=\"true\"></child>\n+      <child dirA *ngIf=\"conditionalChildVisible\"></child>\n       <ng-container><p></p></ng-container>\n+      <b *ngIf=\"visible\">Bold</b>\n     `\n   })\n   class MyApp {\n     text: string = 'INIT';\n+    spanVisible = true;\n+    conditionalChildVisible = true;\n     @Input('a') b = 2;\n     @Output('c') d = new EventEmitter();\n     constructor() {\n@@ -105,6 +108,15 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getComponent<Child>(child[0])).toEqual(childComponent[0]);\n       expect(getComponent<Child>(child[1])).toEqual(childComponent[1]);\n     });\n+    it('should not throw when called on a destroyed node', () => {\n+      expect(getComponent(span[0])).toEqual(null);\n+      expect(getComponent<Child>(child[2])).toEqual(childComponent[2]);\n+      fixture.componentInstance.spanVisible = false;\n+      fixture.componentInstance.conditionalChildVisible = false;\n+      fixture.detectChanges();\n+      expect(getComponent(span[0])).toEqual(null);\n+      expect(getComponent<Child>(child[2])).toEqual(childComponent[2]);\n+    });\n   });\n \n   describe('getComponentLView', () => {\n@@ -131,6 +143,12 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getContext<{$implicit: boolean}>(child[2])!.$implicit).toEqual(true);\n       expect(getContext<Child>(p[0])).toEqual(childComponent[0]);\n     });\n+    it('should return null for destroyed node', () => {\n+      expect(getContext(span[0])).toBeTruthy();\n+      fixture.componentInstance.spanVisible = false;\n+      fixture.detectChanges();\n+      expect(getContext(span[0])).toBeNull();\n+    });\n   });\n \n   describe('getHostElement', () => {\n@@ -146,6 +164,12 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n     it('should throw on unknown target', () => {\n       expect(() => getHostElement({})).toThrowError();  //\n     });\n+    it('should return element for destroyed node', () => {\n+      expect(getHostElement(span[0])).toEqual(span[0]);\n+      fixture.componentInstance.spanVisible = false;\n+      fixture.detectChanges();\n+      expect(getHostElement(span[0])).toEqual(span[0]);\n+    });\n   });\n \n   describe('getInjector', () => {\n@@ -163,6 +187,12 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getInjector(dirA[0]).get(String)).toEqual('Module');\n       expect(getInjector(dirA[1]).get(String)).toEqual('Child');\n     });\n+    it('should retrieve injector from destroyed node', () => {\n+      expect(getInjector(span[0])).toBeTruthy();\n+      fixture.componentInstance.spanVisible = false;\n+      fixture.detectChanges();\n+      expect(getInjector(span[0])).toBeTruthy();\n+    });\n   });\n \n   describe('getDirectives', () => {\n@@ -175,6 +205,12 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getDirectives(div[0])).toEqual([dirA[0]]);\n       expect(getDirectives(child[1])).toEqual([dirA[1]]);\n     });\n+    it('should return empty array for destroyed node', () => {\n+      expect(getDirectives(span[0])).toEqual([]);\n+      fixture.componentInstance.spanVisible = false;\n+      fixture.detectChanges();\n+      expect(getDirectives(span[0])).toEqual([]);\n+    });\n   });\n \n   describe('getOwningComponent', () => {\n@@ -202,6 +238,12 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getOwningComponent<MyApp>(dirA[0])).toEqual(myApp);\n       expect(getOwningComponent<MyApp>(dirA[1])).toEqual(myApp);\n     });\n+    it('should return null for destroyed node', () => {\n+      expect(getOwningComponent<MyApp>(span[0])).toEqual(myApp);\n+      fixture.componentInstance.spanVisible = false;\n+      fixture.detectChanges();\n+      expect(getOwningComponent<MyApp>(span[0])).toEqual(null);\n+    });\n   });\n \n   describe('getLocalRefs', () => {\n@@ -219,6 +261,13 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getLocalRefs(child[1])).toEqual({child: childComponent[1]});\n       expect(getLocalRefs(dirA[1])).toEqual({child: childComponent[1]});\n     });\n+\n+    it('should retrieve from a destroyed node', () => {\n+      expect(getLocalRefs(span[0])).toEqual({});\n+      fixture.componentInstance.spanVisible = false;\n+      fixture.detectChanges();\n+      expect(getLocalRefs(span[0])).toEqual({});\n+    });\n   });\n \n   describe('getRootComponents', () => {\n@@ -234,6 +283,12 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getRootComponents(div[0])).toEqual(rootComponents);\n       expect(getRootComponents(p[0])).toEqual(rootComponents);\n     });\n+    it('should return an empty array for a destroyed node', () => {\n+      expect(getRootComponents(span[0])).toEqual([myApp]);\n+      fixture.componentInstance.spanVisible = false;\n+      fixture.detectChanges();\n+      expect(getRootComponents(span[0])).toEqual([]);\n+    });\n   });\n \n   describe('getListeners', () => {\n@@ -251,6 +306,12 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       listeners[0].callback('CLICKED');\n       expect(log).toEqual(['CLICKED']);\n     });\n+    it('should return no listeners for destroyed node', () => {\n+      expect(getListeners(span[0]).length).toEqual(1);\n+      fixture.componentInstance.spanVisible = false;\n+      fixture.detectChanges();\n+      expect(getListeners(span[0]).length).toEqual(0);\n+    });\n   });\n \n   describe('getInjectionTokens', () => {\n@@ -259,6 +320,12 @@ onlyInIvy('Ivy-specific utilities').describe('discovery utils', () => {\n       expect(getInjectionTokens(child[0])).toEqual([String, Child]);\n       expect(getInjectionTokens(child[1])).toEqual([String, Child, DirectiveA]);\n     });\n+    it('should retrieve tokens from destroyed node', () => {\n+      expect(getInjectionTokens(span[0])).toEqual([]);\n+      fixture.componentInstance.spanVisible = false;\n+      fixture.detectChanges();\n+      expect(getInjectionTokens(span[0])).toEqual([]);\n+    });\n   });\n \n   describe('markDirty', () => {"
        },
        {
            "sha": "d430787feb0073cb22c02dcc70fc42da2426ad04",
            "filename": "packages/core/test/acceptance/i18n_spec.ts",
            "status": "modified",
            "additions": 41,
            "deletions": 41,
            "changes": 82,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Facceptance%2Fi18n_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Facceptance%2Fi18n_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fi18n_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -652,12 +652,12 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n         const lViewDebug = lView.debug!;\n         fixture.detectChanges();\n         expect((fixture.nativeElement as Element).textContent).toEqual('just now');\n-        expect(lViewDebug.nodes.map(toTypeContent)).toEqual(['IcuContainer(<!--ICU 20:0-->)']);\n+        expect(lViewDebug.nodes.map(toTypeContent)).toEqual(['IcuContainer(<!--ICU 21:0-->)']);\n         // We want to ensure that the ICU container does not have any content!\n         // This is because the content is instance dependent and therefore can't be shared\n         // across `TNode`s.\n         expect(lViewDebug.nodes[0].children.map(toTypeContent)).toEqual([]);\n-        expect(fixture.nativeElement.innerHTML).toEqual('just now<!--ICU 20:0-->');\n+        expect(fixture.nativeElement.innerHTML).toEqual('just now<!--ICU 21:0-->');\n       });\n \n       it('should support multiple ICUs', () => {\n@@ -674,15 +674,15 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n         `);\n         const lView = getComponentLView(fixture.componentInstance);\n         expect(lView.debug!.nodes.map(toTypeContent)).toEqual([\n-          'IcuContainer(<!--ICU 20:0-->)',\n           'IcuContainer(<!--ICU 21:0-->)',\n+          'IcuContainer(<!--ICU 22:0-->)',\n         ]);\n         // We want to ensure that the ICU container does not have any content!\n         // This is because the content is instance dependent and therefore can't be shared\n         // across `TNode`s.\n         expect(lView.debug!.nodes[0].children.map(toTypeContent)).toEqual([]);\n         expect(fixture.nativeElement.innerHTML)\n-            .toEqual('just now<!--ICU 20:0-->Mr. Angular<!--ICU 21:0-->');\n+            .toEqual('just now<!--ICU 21:0-->Mr. Angular<!--ICU 22:0-->');\n       });\n     });\n   });\n@@ -778,19 +778,19 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n         other {({{name}})}\n       }</div>`);\n       expect(fixture.nativeElement.innerHTML)\n-          .toEqual(`<div>aucun <b>email</b>!<!--ICU 21:0--> - (Angular)<!--ICU 21:3--></div>`);\n+          .toEqual(`<div>aucun <b>email</b>!<!--ICU 22:0--> - (Angular)<!--ICU 22:3--></div>`);\n \n       fixture.componentRef.instance.count = 4;\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n           .toEqual(\n-              `<div>4 <span title=\"Angular\">emails</span><!--ICU 21:0--> - (Angular)<!--ICU 21:3--></div>`);\n+              `<div>4 <span title=\"Angular\">emails</span><!--ICU 22:0--> - (Angular)<!--ICU 22:3--></div>`);\n \n       fixture.componentRef.instance.count = 0;\n       fixture.componentRef.instance.name = 'John';\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n-          .toEqual(`<div>aucun <b>email</b>!<!--ICU 21:0--> - (John)<!--ICU 21:3--></div>`);\n+          .toEqual(`<div>aucun <b>email</b>!<!--ICU 22:0--> - (John)<!--ICU 22:3--></div>`);\n     });\n \n     it('with custom interpolation config', () => {\n@@ -829,19 +829,19 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n       expect(fixture.nativeElement.innerHTML)\n           .toEqual(\n               `<div>` +\n-              `<span>aucun <b>email</b>!<!--ICU 21:0--></span>` +\n+              `<span>aucun <b>email</b>!<!--ICU 22:0--></span>` +\n               ` - ` +\n-              `<span>(Angular)<!--ICU 21:3--></span>` +\n+              `<span>(Angular)<!--ICU 22:3--></span>` +\n               `</div>`);\n \n       fixture.componentRef.instance.count = 4;\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n           .toEqual(\n               `<div>` +\n-              `<span>4 <span title=\"Angular\">emails</span><!--ICU 21:0--></span>` +\n+              `<span>4 <span title=\"Angular\">emails</span><!--ICU 22:0--></span>` +\n               ` - ` +\n-              `<span>(Angular)<!--ICU 21:3--></span>` +\n+              `<span>(Angular)<!--ICU 22:3--></span>` +\n               `</div>`);\n \n       fixture.componentRef.instance.count = 0;\n@@ -850,9 +850,9 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n       expect(fixture.nativeElement.innerHTML)\n           .toEqual(\n               `<div>` +\n-              `<span>aucun <b>email</b>!<!--ICU 21:0--></span>` +\n+              `<span>aucun <b>email</b>!<!--ICU 22:0--></span>` +\n               ` - ` +\n-              `<span>(John)<!--ICU 21:3--></span>` +\n+              `<span>(John)<!--ICU 22:3--></span>` +\n               `</div>`);\n     });\n \n@@ -867,7 +867,7 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n         other {({{name}})}\n       }</span></div>`);\n       expect(fixture.nativeElement.innerHTML)\n-          .toEqual(`<div><span>(Angular)<!--ICU 20:0--></span><!--bindings={\n+          .toEqual(`<div><span>(Angular)<!--ICU 21:0--></span><!--bindings={\n   \"ng-reflect-ng-if\": \"true\"\n }--></div>`);\n \n@@ -887,7 +887,7 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n         other {({{name}})}\n       }</ng-container>`);\n       expect(fixture.nativeElement.innerHTML)\n-          .toEqual(`(Angular)<!--ICU 21:0--><!--ng-container-->`);\n+          .toEqual(`(Angular)<!--ICU 22:0--><!--ng-container-->`);\n     });\n \n     it('inside <ng-template>', () => {\n@@ -922,12 +922,12 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n                        other {animals}\n                      }!}\n       }</div>`);\n-      expect(fixture.nativeElement.innerHTML).toEqual(`<div>zero<!--ICU 21:1--></div>`);\n+      expect(fixture.nativeElement.innerHTML).toEqual(`<div>zero<!--ICU 22:1--></div>`);\n \n       fixture.componentRef.instance.count = 4;\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n-          .toEqual(`<div>4 animaux<!--nested ICU 0-->!<!--ICU 21:1--></div>`);\n+          .toEqual(`<div>4 animaux<!--nested ICU 0-->!<!--ICU 22:1--></div>`);\n     });\n \n     it('nested with interpolations in \"other\" blocks', () => {\n@@ -947,16 +947,16 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n                      }!}\n         other {other - {{count}}}\n       }</div>`);\n-      expect(fixture.nativeElement.innerHTML).toEqual(`<div>zero<!--ICU 21:1--></div>`);\n+      expect(fixture.nativeElement.innerHTML).toEqual(`<div>zero<!--ICU 22:1--></div>`);\n \n       fixture.componentRef.instance.count = 2;\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n-          .toEqual(`<div>2 animaux<!--nested ICU 0-->!<!--ICU 21:1--></div>`);\n+          .toEqual(`<div>2 animaux<!--nested ICU 0-->!<!--ICU 22:1--></div>`);\n \n       fixture.componentRef.instance.count = 4;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual(`<div>autre - 4<!--ICU 21:1--></div>`);\n+      expect(fixture.nativeElement.innerHTML).toEqual(`<div>autre - 4<!--ICU 22:1--></div>`);\n     });\n \n     it('should return the correct plural form for ICU expressions when using \"ro\" locale', () => {\n@@ -989,31 +989,31 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n             =other {lots of emails}\n           }`);\n \n-      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 21:0-->');\n \n       // Change detection cycle, no model changes\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 21:0-->');\n \n       fixture.componentInstance.count = 3;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('a few emails<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('a few emails<!--ICU 21:0-->');\n \n       fixture.componentInstance.count = 1;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('one email<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('one email<!--ICU 21:0-->');\n \n       fixture.componentInstance.count = 10;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('a few emails<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('a few emails<!--ICU 21:0-->');\n \n       fixture.componentInstance.count = 20;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 21:0-->');\n \n       fixture.componentInstance.count = 0;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 21:0-->');\n     });\n \n     it(`should return the correct plural form for ICU expressions when using \"es\" locale`, () => {\n@@ -1040,31 +1040,31 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n             =other {lots of emails}\n           }`);\n \n-      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 21:0-->');\n \n       // Change detection cycle, no model changes\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 21:0-->');\n \n       fixture.componentInstance.count = 3;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 21:0-->');\n \n       fixture.componentInstance.count = 1;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('one email<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('one email<!--ICU 21:0-->');\n \n       fixture.componentInstance.count = 10;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 21:0-->');\n \n       fixture.componentInstance.count = 20;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('lots of emails<!--ICU 21:0-->');\n \n       fixture.componentInstance.count = 0;\n       fixture.detectChanges();\n-      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 20:0-->');\n+      expect(fixture.nativeElement.innerHTML).toEqual('no email<!--ICU 21:0-->');\n     });\n \n     it('projection', () => {\n@@ -1159,12 +1159,12 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n       const fixture = TestBed.createComponent(App);\n       fixture.detectChanges();\n       expect(fixture.debugElement.nativeElement.innerHTML)\n-          .toContain('<my-cmp><div>ONE<!--ICU 21:0--></div><!--container--></my-cmp>');\n+          .toContain('<my-cmp><div>ONE<!--ICU 22:0--></div><!--container--></my-cmp>');\n \n       fixture.componentRef.instance.count = 2;\n       fixture.detectChanges();\n       expect(fixture.debugElement.nativeElement.innerHTML)\n-          .toContain('<my-cmp><div>OTHER<!--ICU 21:0--></div><!--container--></my-cmp>');\n+          .toContain('<my-cmp><div>OTHER<!--ICU 22:0--></div><!--container--></my-cmp>');\n \n       // destroy component\n       fixture.componentInstance.condition = false;\n@@ -1176,7 +1176,7 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n       fixture.componentInstance.count = 1;\n       fixture.detectChanges();\n       expect(fixture.debugElement.nativeElement.innerHTML)\n-          .toContain('<my-cmp><div>ONE<!--ICU 21:0--></div><!--container--></my-cmp>');\n+          .toContain('<my-cmp><div>ONE<!--ICU 22:0--></div><!--container--></my-cmp>');\n     });\n \n     it('with nested ICU expression and inside a container when creating a view via vcr.createEmbeddedView',\n@@ -1248,12 +1248,12 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n          fixture.detectChanges();\n          expect(fixture.debugElement.nativeElement.innerHTML)\n              .toBe(\n-                 '<my-cmp><div>2 animals<!--nested ICU 0-->!<!--ICU 21:1--></div><!--container--></my-cmp>');\n+                 '<my-cmp><div>2 animals<!--nested ICU 0-->!<!--ICU 22:1--></div><!--container--></my-cmp>');\n \n          fixture.componentRef.instance.count = 1;\n          fixture.detectChanges();\n          expect(fixture.debugElement.nativeElement.innerHTML)\n-             .toBe('<my-cmp><div>ONE<!--ICU 21:1--></div><!--container--></my-cmp>');\n+             .toBe('<my-cmp><div>ONE<!--ICU 22:1--></div><!--container--></my-cmp>');\n        });\n \n     it('with nested containers', () => {\n@@ -2357,13 +2357,13 @@ onlyInIvy('Ivy i18n logic').describe('runtime i18n', () => {\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n           .toEqual(\n-              `<child><div>Contenu enfant et projection depuis Parent<!--ICU 21:0--></div></child>`);\n+              `<child><div>Contenu enfant et projection depuis Parent<!--ICU 22:0--></div></child>`);\n \n       fixture.componentRef.instance.name = 'angular';\n       fixture.detectChanges();\n       expect(fixture.nativeElement.innerHTML)\n           .toEqual(\n-              `<child><div>Contenu enfant et projection depuis Angular<!--ICU 21:0--></div></child>`);\n+              `<child><div>Contenu enfant et projection depuis Angular<!--ICU 22:0--></div></child>`);\n     });\n \n     it(`shouldn't project deleted projections in i18n blocks`, () => {"
        },
        {
            "sha": "f3db593b68d750649cb4542c16eeb3b72f4761a4",
            "filename": "packages/core/test/acceptance/ngdevmode_debug_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Facceptance%2Fngdevmode_debug_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Facceptance%2Fngdevmode_debug_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fngdevmode_debug_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -32,7 +32,7 @@ onlyInIvy('Debug information exist in ivy only').describe('ngDevMode debug', ()\n \n       TestBed.configureTestingModule({declarations: [MyApp], imports: [CommonModule]});\n       const fixture = TestBed.createComponent(MyApp);\n-      const rootLView = getLContext(fixture.nativeElement)!.lView;\n+      const rootLView = getLContext(fixture.nativeElement)!.lView!;\n       expect(rootLView.constructor.name).toEqual('LRootView');\n \n       const componentLView = getComponentLView(fixture.componentInstance);\n@@ -41,7 +41,7 @@ onlyInIvy('Debug information exist in ivy only').describe('ngDevMode debug', ()\n       const element: HTMLElement = fixture.nativeElement;\n       fixture.detectChanges();\n       const li = element.querySelector('li')!;\n-      const embeddedLView = getLContext(li)!.lView;\n+      const embeddedLView = getLContext(li)!.lView!;\n       expect(embeddedLView.constructor.name).toEqual('LEmbeddedView_MyApp_li_1');\n     });\n   });"
        },
        {
            "sha": "5b040b0822dc9c1753cd9486dfa8bb445e87aca2",
            "filename": "packages/core/test/bundling/cyclic_import/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fcyclic_import%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fcyclic_import%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fcyclic_import%2Fbundle.golden_symbols.json?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -47,6 +47,9 @@\n   {\n     \"name\": \"SimpleChange\"\n   },\n+  {\n+    \"name\": \"TRACKED_LVIEWS\"\n+  },\n   {\n     \"name\": \"TriggerComponent\"\n   },\n@@ -254,6 +257,9 @@\n   {\n     \"name\": \"isInlineTemplate\"\n   },\n+  {\n+    \"name\": \"isLView\"\n+  },\n   {\n     \"name\": \"isNodeMatchingSelector\"\n   },\n@@ -353,6 +359,9 @@\n   {\n     \"name\": \"setUpAttributes\"\n   },\n+  {\n+    \"name\": \"uniqueIdCounter\"\n+  },\n   {\n     \"name\": \"updateTransplantedViewCount\"\n   },"
        },
        {
            "sha": "3bd0484344a124734d5e4ff88e4aedbdad4a300d",
            "filename": "packages/core/test/bundling/forms_reactive/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fbundle.golden_symbols.json?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -548,6 +548,9 @@\n   {\n     \"name\": \"THROW_IF_NOT_FOUND\"\n   },\n+  {\n+    \"name\": \"TRACKED_LVIEWS\"\n+  },\n   {\n     \"name\": \"TRANSITION_ID\"\n   },\n@@ -1568,6 +1571,9 @@\n   {\n     \"name\": \"u\"\n   },\n+  {\n+    \"name\": \"uniqueIdCounter\"\n+  },\n   {\n     \"name\": \"unwrapRNode\"\n   },"
        },
        {
            "sha": "5efe851e897e1b109fb4ec28337ddad415a1ecc3",
            "filename": "packages/core/test/bundling/forms_reactive/forms_e2e_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fforms_e2e_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fforms_e2e_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Fforms_e2e_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -7,7 +7,6 @@\n  */\n \n import '@angular/compiler';\n-import {ɵwhenRendered as whenRendered} from '@angular/core';\n import {withBody} from '@angular/private/testing';\n import * as path from 'path';\n \n@@ -18,8 +17,8 @@ describe('functional test for reactive forms', () => {\n   BUNDLES.forEach((bundle) => {\n     describe(`using ${bundle} bundle`, () => {\n       it('should render template form', withBody('<app-root></app-root>', async () => {\n-           require(path.join(PACKAGE, bundle));\n-           await (window as any).waitForApp;\n+           const {whenRendered, bootstrapApp} = require(path.join(PACKAGE, bundle));\n+           await bootstrapApp();\n \n            // Reactive forms\n            const reactiveFormsComponent = (window as any).reactiveFormsComponent;"
        },
        {
            "sha": "441b97afb824c18b64d685d8ddc48027b9c5ed4e",
            "filename": "packages/core/test/bundling/forms_reactive/index.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_reactive%2Findex.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {Component, NgModule, ɵNgModuleFactory as NgModuleFactory} from '@angular/core';\n+import {Component, NgModule, ɵNgModuleFactory as NgModuleFactory, ɵwhenRendered as whenRendered} from '@angular/core';\n import {FormArray, FormBuilder, FormControl, FormGroup, ReactiveFormsModule, Validators} from '@angular/forms';\n import {BrowserModule, platformBrowser} from '@angular/platform-browser';\n \n@@ -93,5 +93,15 @@ class FormsExampleModule {\n   }\n }\n \n-(window as any).waitForApp = platformBrowser().bootstrapModuleFactory(\n-    new NgModuleFactory(FormsExampleModule), {ngZone: 'noop'});\n+function bootstrapApp() {\n+  return platformBrowser().bootstrapModuleFactory(\n+      new NgModuleFactory(FormsExampleModule), {ngZone: 'noop'});\n+}\n+\n+// This bundle includes `@angular/core` within it which means that the test asserting\n+// against it will load a different core bundle. These symbols are exposed so that they\n+// can interact with the correct `@angular/core` instance.\n+module.exports = {\n+  whenRendered,\n+  bootstrapApp\n+};"
        },
        {
            "sha": "76743abf90da20aea6f8c2e9967a519b6494e373",
            "filename": "packages/core/test/bundling/forms_template_driven/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fbundle.golden_symbols.json?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -536,6 +536,9 @@\n   {\n     \"name\": \"THROW_IF_NOT_FOUND\"\n   },\n+  {\n+    \"name\": \"TRACKED_LVIEWS\"\n+  },\n   {\n     \"name\": \"TRANSITION_ID\"\n   },\n@@ -1541,6 +1544,9 @@\n   {\n     \"name\": \"u\"\n   },\n+  {\n+    \"name\": \"uniqueIdCounter\"\n+  },\n   {\n     \"name\": \"unwrapRNode\"\n   },"
        },
        {
            "sha": "3cbb8b2a9791008f325277480eab9b92d4849595",
            "filename": "packages/core/test/bundling/forms_template_driven/forms_e2e_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fforms_e2e_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fforms_e2e_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Fforms_e2e_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -7,7 +7,6 @@\n  */\n \n import '@angular/compiler';\n-import {ɵwhenRendered as whenRendered} from '@angular/core';\n import {withBody} from '@angular/private/testing';\n import * as path from 'path';\n \n@@ -18,8 +17,8 @@ describe('functional test for forms', () => {\n   BUNDLES.forEach((bundle) => {\n     describe(`using ${bundle} bundle`, () => {\n       it('should render template form', withBody('<app-root></app-root>', async () => {\n-           require(path.join(PACKAGE, bundle));\n-           await (window as any).waitForApp;\n+           const {bootstrapApp, whenRendered} = require(path.join(PACKAGE, bundle));\n+           await bootstrapApp();\n \n            // Template forms\n            const templateFormsComponent = (window as any).templateFormsComponent;"
        },
        {
            "sha": "ac81bc9e2342fd4eb254a81a311fae4945f953f3",
            "filename": "packages/core/test/bundling/forms_template_driven/index.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fforms_template_driven%2Findex.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {Component, NgModule, ɵNgModuleFactory as NgModuleFactory} from '@angular/core';\n+import {Component, NgModule, ɵNgModuleFactory as NgModuleFactory, ɵwhenRendered as whenRendered} from '@angular/core';\n import {FormsModule} from '@angular/forms';\n import {BrowserModule, platformBrowser} from '@angular/platform-browser';\n \n@@ -70,5 +70,15 @@ class FormsExampleModule {\n   }\n }\n \n-(window as any).waitForApp = platformBrowser().bootstrapModuleFactory(\n-    new NgModuleFactory(FormsExampleModule), {ngZone: 'noop'});\n+function bootstrapApp() {\n+  return platformBrowser().bootstrapModuleFactory(\n+      new NgModuleFactory(FormsExampleModule), {ngZone: 'noop'});\n+}\n+\n+// This bundle includes `@angular/core` within it which means that the test asserting\n+// against it will load a different core bundle. These symbols are exposed so that they\n+// can interact with the correct `@angular/core` instance.\n+module.exports = {\n+  whenRendered,\n+  bootstrapApp\n+};"
        },
        {
            "sha": "99bd5d32ecba1c94e9a3e844d9f18cec909c7604",
            "filename": "packages/core/test/bundling/hello_world/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fhello_world%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Fhello_world%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Fhello_world%2Fbundle.golden_symbols.json?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -41,6 +41,9 @@\n   {\n     \"name\": \"SimpleChange\"\n   },\n+  {\n+    \"name\": \"TRACKED_LVIEWS\"\n+  },\n   {\n     \"name\": \"ViewEncapsulation\"\n   },\n@@ -173,6 +176,9 @@\n   {\n     \"name\": \"isInCheckNoChangesMode\"\n   },\n+  {\n+    \"name\": \"isLView\"\n+  },\n   {\n     \"name\": \"isProceduralRenderer\"\n   },\n@@ -236,6 +242,9 @@\n   {\n     \"name\": \"setSelectedIndex\"\n   },\n+  {\n+    \"name\": \"uniqueIdCounter\"\n+  },\n   {\n     \"name\": \"updateTransplantedViewCount\"\n   },"
        },
        {
            "sha": "d84e3b0b762d0273317aa1ebad14915ab2c6a6f7",
            "filename": "packages/core/test/bundling/router/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Frouter%2Fbundle.golden_symbols.json?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -785,6 +785,9 @@\n   {\n     \"name\": \"TQuery_\"\n   },\n+  {\n+    \"name\": \"TRACKED_LVIEWS\"\n+  },\n   {\n     \"name\": \"TRANSITION_ID\"\n   },\n@@ -2015,6 +2018,9 @@\n   {\n     \"name\": \"u\"\n   },\n+  {\n+    \"name\": \"uniqueIdCounter\"\n+  },\n   {\n     \"name\": \"unwrapElementRef\"\n   },"
        },
        {
            "sha": "80bf8cb9911c3b0bccaa469c1684522eca554bbb",
            "filename": "packages/core/test/bundling/todo/bundle.golden_symbols.json",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Fbundle.golden_symbols.json",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Fbundle.golden_symbols.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Fbundle.golden_symbols.json?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -32,6 +32,9 @@\n   {\n     \"name\": \"IterableDiffers\"\n   },\n+  {\n+    \"name\": \"LContext\"\n+  },\n   {\n     \"name\": \"NG_COMP_DEF\"\n   },\n@@ -110,6 +113,9 @@\n   {\n     \"name\": \"SkipSelf\"\n   },\n+  {\n+    \"name\": \"TRACKED_LVIEWS\"\n+  },\n   {\n     \"name\": \"TemplateRef\"\n   },\n@@ -380,6 +386,9 @@\n   {\n     \"name\": \"getLView\"\n   },\n+  {\n+    \"name\": \"getLViewById\"\n+  },\n   {\n     \"name\": \"getLViewParent\"\n   },\n@@ -740,6 +749,9 @@\n   {\n     \"name\": \"trackByIdentity\"\n   },\n+  {\n+    \"name\": \"uniqueIdCounter\"\n+  },\n   {\n     \"name\": \"unwrapRNode\"\n   },"
        },
        {
            "sha": "de6dc37dbe138a7557b2a77766f565adde5637af",
            "filename": "packages/core/test/bundling/todo/index.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Findex.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -9,7 +9,7 @@\n import '@angular/core/test/bundling/util/src/reflect_metadata';\n \n import {CommonModule} from '@angular/common';\n-import {Component, Injectable, NgModule, ViewEncapsulation, ɵmarkDirty as markDirty, ɵrenderComponent as renderComponent} from '@angular/core';\n+import {Component, Injectable, NgModule, ViewEncapsulation, ɵmarkDirty as markDirty, ɵrenderComponent as renderComponent, ɵwhenRendered as whenRendered} from '@angular/core';\n \n class Todo {\n   editing: boolean;\n@@ -133,7 +133,9 @@ class TodoStore {\n class ToDoAppComponent {\n   newTodoText = '';\n \n-  constructor(public todoStore: TodoStore) {}\n+  constructor(public todoStore: TodoStore) {\n+    (window as any).todoAppComponent = this;\n+  }\n \n   cancelEditingTodo(todo: Todo) {\n     todo.editing = false;\n@@ -200,3 +202,8 @@ class ToDoAppModule {\n }\n \n renderComponent(ToDoAppComponent);\n+\n+// This bundle includes `@angular/core` within it which means that the test asserting\n+// against it will load a different core bundle. These symbols are exposed so that they\n+// can interact with the correct `@angular/core` instance.\n+module.exports = {whenRendered};"
        },
        {
            "sha": "be682aa0f2ab2cda81bc0f51fbd2f3f461bb2586",
            "filename": "packages/core/test/bundling/todo/todo_e2e_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Ftodo_e2e_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Ftodo_e2e_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo%2Ftodo_e2e_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -7,28 +7,22 @@\n  */\n \n import '@angular/compiler';\n-import {ɵwhenRendered as whenRendered} from '@angular/core';\n-import {getComponent} from '@angular/core/src/render3';\n import {withBody} from '@angular/private/testing';\n import * as path from 'path';\n \n-const UTF8 = {\n-  encoding: 'utf-8'\n-};\n const PACKAGE = 'angular/packages/core/test/bundling/todo';\n const BUNDLES = ['bundle.js', 'bundle.min_debug.js', 'bundle.min.js'];\n \n describe('functional test for todo', () => {\n   BUNDLES.forEach(bundle => {\n     describe(bundle, () => {\n       it('should render todo', withBody('<todo-app></todo-app>', async () => {\n-           require(path.join(PACKAGE, bundle));\n-           const toDoAppComponent = getComponent(document.querySelector('todo-app')!);\n+           const {whenRendered} = require(path.join(PACKAGE, bundle));\n            expect(document.body.textContent).toContain('todos');\n            expect(document.body.textContent).toContain('Demonstrate Components');\n            expect(document.body.textContent).toContain('4 items left');\n            document.querySelector('button')!.click();\n-           await whenRendered(toDoAppComponent);\n+           await whenRendered((window as any).todoAppComponent);\n            expect(document.body.textContent).toContain('3 items left');\n          }));\n     });"
        },
        {
            "sha": "b20a3532b59aa664ce518d74c1c7dd220dd6fd72",
            "filename": "packages/core/test/bundling/todo_i18n/index.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_i18n%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_i18n%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_i18n%2Findex.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -8,7 +8,7 @@\n import '@angular/core/test/bundling/util/src/reflect_metadata';\n import './translations';\n import {CommonModule} from '@angular/common';\n-import {Component, Injectable, NgModule, ViewEncapsulation, ɵmarkDirty as markDirty, ɵrenderComponent as renderComponent} from '@angular/core';\n+import {Component, Injectable, NgModule, ViewEncapsulation, ɵmarkDirty as markDirty, ɵrenderComponent as renderComponent, ɵwhenRendered as whenRendered} from '@angular/core';\n \n class Todo {\n   editing: boolean;\n@@ -127,7 +127,9 @@ class TodoStore {\n class ToDoAppComponent {\n   newTodoText = '';\n \n-  constructor(public todoStore: TodoStore) {}\n+  constructor(public todoStore: TodoStore) {\n+    (window as any).todoAppComponent = this;\n+  }\n \n   cancelEditingTodo(todo: Todo) {\n     todo.editing = false;\n@@ -194,3 +196,8 @@ class ToDoAppModule {\n }\n \n renderComponent(ToDoAppComponent);\n+\n+// This bundle includes `@angular/core` within it which means that the test asserting\n+// against it will load a different core bundle. These symbols are exposed so that they\n+// can interact with the correct `@angular/core` instance.\n+module.exports = {whenRendered};"
        },
        {
            "sha": "5979f08c69d66e657d6c743dde7f3cb250cf3d35",
            "filename": "packages/core/test/bundling/todo_i18n/todo_e2e_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_i18n%2Ftodo_e2e_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_i18n%2Ftodo_e2e_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_i18n%2Ftodo_e2e_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -8,8 +8,6 @@\n import '@angular/localize/init';\n import '@angular/compiler';\n \n-import {ɵwhenRendered as whenRendered} from '@angular/core';\n-import {getComponent} from '@angular/core/src/render3';\n import {clearTranslations} from '@angular/localize';\n import {withBody} from '@angular/private/testing';\n import * as path from 'path';\n@@ -22,16 +20,15 @@ describe('functional test for todo i18n', () => {\n     describe(bundle, () => {\n       it('should render todo i18n', withBody('<todo-app></todo-app>', async () => {\n            clearTranslations();\n-           require(path.join(PACKAGE, bundle));\n-           const toDoAppComponent = getComponent(document.querySelector('todo-app')!);\n+           const {whenRendered} = require(path.join(PACKAGE, bundle));\n            expect(document.body.textContent).toContain('liste de tâches');\n            expect(document.body.textContent).toContain('Démontrer les components');\n            expect(document.body.textContent).toContain('Démontrer NgModules');\n            expect(document.body.textContent).toContain('4 tâches restantes');\n            expect(document.querySelector('.new-todo')!.getAttribute('placeholder'))\n                .toEqual(`Qu'y a-t-il à faire ?`);\n            document.querySelector('button')!.click();\n-           await whenRendered(toDoAppComponent);\n+           await whenRendered((window as any).todoAppComponent);\n            expect(document.body.textContent).toContain('3 tâches restantes');\n          }));\n     });"
        },
        {
            "sha": "2c1860b4a727829953d058f75f1184e59fdec2b5",
            "filename": "packages/core/test/bundling/todo_r2/index.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_r2%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_r2%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_r2%2Findex.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -9,7 +9,7 @@\n import '@angular/core/test/bundling/util/src/reflect_metadata';\n \n import {CommonModule} from '@angular/common';\n-import {Component, Injectable, NgModule, ɵNgModuleFactory as NgModuleFactory} from '@angular/core';\n+import {Component, Injectable, NgModule, ɵNgModuleFactory as NgModuleFactory, ɵwhenRendered as whenRendered} from '@angular/core';\n import {BrowserModule, platformBrowser} from '@angular/platform-browser';\n \n class Todo {\n@@ -195,5 +195,15 @@ class ToDoAppModule {\n   }\n }\n \n-(window as any).waitForApp =\n-    platformBrowser().bootstrapModuleFactory(new NgModuleFactory(ToDoAppModule), {ngZone: 'noop'});\n+function bootstrapApp() {\n+  return platformBrowser().bootstrapModuleFactory(\n+      new NgModuleFactory(ToDoAppModule), {ngZone: 'noop'});\n+}\n+\n+// This bundle includes `@angular/core` within it which means that the test asserting\n+// against it will load a different core bundle. These symbols are exposed so that they\n+// can interact with the correct `@angular/core` instance.\n+module.exports = {\n+  whenRendered,\n+  bootstrapApp\n+};"
        },
        {
            "sha": "98781a640756762b1897f118bc5796cf2d7cdd6a",
            "filename": "packages/core/test/bundling/todo_r2/todo_e2e_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_r2%2Ftodo_e2e_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_r2%2Ftodo_e2e_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2Ftodo_r2%2Ftodo_e2e_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -7,13 +7,9 @@\n  */\n \n import '@angular/compiler';\n-import {ɵwhenRendered as whenRendered} from '@angular/core';\n import {withBody} from '@angular/private/testing';\n import * as path from 'path';\n \n-const UTF8 = {\n-  encoding: 'utf-8'\n-};\n const PACKAGE = 'angular/packages/core/test/bundling/todo_r2';\n const BUNDLES = ['bundle.js', 'bundle.min_debug.js', 'bundle.min.js'];\n \n@@ -22,8 +18,8 @@ describe('functional test for todo', () => {\n     describe(bundle, () => {\n       it('should place styles on the elements within the component',\n          withBody('<todo-app></todo-app>', async () => {\n-           require(path.join(PACKAGE, bundle));\n-           await (window as any).waitForApp;\n+           const {bootstrapApp, whenRendered} = require(path.join(PACKAGE, bundle));\n+           await bootstrapApp();\n            const toDoAppComponent = (window as any).toDoAppComponent;\n            await whenRendered(toDoAppComponent);\n "
        },
        {
            "sha": "e0b4b4f5828f37d1f25bca7557b39676558036ba",
            "filename": "packages/core/test/render3/i18n/i18n_insert_before_index_spec.ts",
            "status": "modified",
            "additions": 64,
            "deletions": 64,
            "changes": 128,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_insert_before_index_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_insert_before_index_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_insert_before_index_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -29,69 +29,69 @@ describe('addTNodeAndUpdateInsertBeforeIndex', () => {\n \n   it('should add first node', () => {\n     const previousTNodes: TNode[] = [];\n-    addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(20));\n+    addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(21));\n     expect(previousTNodes).toEqual([\n-      matchTNode({index: 20, insertBeforeIndex: null}),\n+      matchTNode({index: 21, insertBeforeIndex: null}),\n     ]);\n   });\n \n   describe('when adding a placeholder', () => {\n     describe('whose index is greater than those already there', () => {\n       it('should not update the `insertBeforeIndex` values', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(20),\n           tPlaceholderElementNode(21),\n+          tPlaceholderElementNode(22),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(22));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(23));\n         expect(previousTNodes).toEqual([\n-          matchTNode({index: 20, insertBeforeIndex: null}),\n           matchTNode({index: 21, insertBeforeIndex: null}),\n           matchTNode({index: 22, insertBeforeIndex: null}),\n+          matchTNode({index: 23, insertBeforeIndex: null}),\n         ]);\n       });\n     });\n \n     describe('whose index is smaller than current nodes', () => {\n       it('should update the previous insertBeforeIndex', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(21),\n           tPlaceholderElementNode(22),\n+          tPlaceholderElementNode(23),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(20));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(21));\n         expect(previousTNodes).toEqual([\n-          matchTNode({index: 21, insertBeforeIndex: 20}),\n-          matchTNode({index: 22, insertBeforeIndex: 20}),\n-          matchTNode({index: 20, insertBeforeIndex: null}),\n+          matchTNode({index: 22, insertBeforeIndex: 21}),\n+          matchTNode({index: 23, insertBeforeIndex: 21}),\n+          matchTNode({index: 21, insertBeforeIndex: null}),\n         ]);\n       });\n \n       it('should not update the previous insertBeforeIndex if it is already set', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(22, 21),\n-          tPlaceholderElementNode(23, 21),\n-          tPlaceholderElementNode(21),\n+          tPlaceholderElementNode(23, 22),\n+          tPlaceholderElementNode(24, 22),\n+          tPlaceholderElementNode(22),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(20));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(21));\n         expect(previousTNodes).toEqual([\n+          matchTNode({index: 23, insertBeforeIndex: 22}),\n+          matchTNode({index: 24, insertBeforeIndex: 22}),\n           matchTNode({index: 22, insertBeforeIndex: 21}),\n-          matchTNode({index: 23, insertBeforeIndex: 21}),\n-          matchTNode({index: 21, insertBeforeIndex: 20}),\n-          matchTNode({index: 20, insertBeforeIndex: null}),\n+          matchTNode({index: 21, insertBeforeIndex: null}),\n         ]);\n       });\n \n       it('should not update the previous insertBeforeIndex if it is created after', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(25, 20),\n-          tPlaceholderElementNode(26, 20),\n-          tPlaceholderElementNode(20),\n+          tPlaceholderElementNode(26, 21),\n+          tPlaceholderElementNode(27, 21),\n+          tPlaceholderElementNode(21),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(23));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(24));\n         expect(previousTNodes).toEqual([\n-          matchTNode({index: 25, insertBeforeIndex: 20}),\n-          matchTNode({index: 26, insertBeforeIndex: 20}),\n-          matchTNode({index: 20, insertBeforeIndex: null}),\n-          matchTNode({index: 23, insertBeforeIndex: null}),\n+          matchTNode({index: 26, insertBeforeIndex: 21}),\n+          matchTNode({index: 27, insertBeforeIndex: 21}),\n+          matchTNode({index: 21, insertBeforeIndex: null}),\n+          matchTNode({index: 24, insertBeforeIndex: null}),\n         ]);\n       });\n     });\n@@ -101,59 +101,59 @@ describe('addTNodeAndUpdateInsertBeforeIndex', () => {\n     describe('whose index is greater than those already there', () => {\n       it('should not update the `insertBeforeIndex` values', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(20),\n           tPlaceholderElementNode(21),\n+          tPlaceholderElementNode(22),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(22));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(23));\n         expect(previousTNodes).toEqual([\n-          matchTNode({index: 20, insertBeforeIndex: 22}),\n-          matchTNode({index: 21, insertBeforeIndex: 22}),\n-          matchTNode({index: 22, insertBeforeIndex: null}),\n+          matchTNode({index: 21, insertBeforeIndex: 23}),\n+          matchTNode({index: 22, insertBeforeIndex: 23}),\n+          matchTNode({index: 23, insertBeforeIndex: null}),\n         ]);\n       });\n     });\n \n     describe('whose index is smaller than current nodes', () => {\n       it('should update the previous insertBeforeIndex', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(21),\n           tPlaceholderElementNode(22),\n+          tPlaceholderElementNode(23),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(20));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(21));\n         expect(previousTNodes).toEqual([\n-          matchTNode({index: 21, insertBeforeIndex: 20}),\n-          matchTNode({index: 22, insertBeforeIndex: 20}),\n-          matchTNode({index: 20, insertBeforeIndex: null}),\n+          matchTNode({index: 22, insertBeforeIndex: 21}),\n+          matchTNode({index: 23, insertBeforeIndex: 21}),\n+          matchTNode({index: 21, insertBeforeIndex: null}),\n         ]);\n       });\n \n       it('should not update the previous insertBeforeIndex if it is already set', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(22, 21),\n-          tPlaceholderElementNode(23, 21),\n-          tPlaceholderElementNode(21),\n+          tPlaceholderElementNode(23, 22),\n+          tPlaceholderElementNode(24, 22),\n+          tPlaceholderElementNode(22),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(20));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(21));\n         expect(previousTNodes).toEqual([\n+          matchTNode({index: 23, insertBeforeIndex: 22}),\n+          matchTNode({index: 24, insertBeforeIndex: 22}),\n           matchTNode({index: 22, insertBeforeIndex: 21}),\n-          matchTNode({index: 23, insertBeforeIndex: 21}),\n-          matchTNode({index: 21, insertBeforeIndex: 20}),\n-          matchTNode({index: 20, insertBeforeIndex: null}),\n+          matchTNode({index: 21, insertBeforeIndex: null}),\n         ]);\n       });\n \n       it('should not update the previous insertBeforeIndex if it is created after', () => {\n         const previousTNodes: TNode[] = [\n-          tPlaceholderElementNode(25, 20),\n-          tPlaceholderElementNode(26, 20),\n-          tPlaceholderElementNode(20),\n+          tPlaceholderElementNode(26, 21),\n+          tPlaceholderElementNode(27, 21),\n+          tPlaceholderElementNode(21),\n         ];\n-        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(23));\n+        addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(24));\n         expect(previousTNodes).toEqual([\n-          matchTNode({index: 25, insertBeforeIndex: 20}),\n-          matchTNode({index: 26, insertBeforeIndex: 20}),\n-          matchTNode({index: 20, insertBeforeIndex: 23}),\n-          matchTNode({index: 23, insertBeforeIndex: null}),\n+          matchTNode({index: 26, insertBeforeIndex: 21}),\n+          matchTNode({index: 27, insertBeforeIndex: 21}),\n+          matchTNode({index: 21, insertBeforeIndex: 24}),\n+          matchTNode({index: 24, insertBeforeIndex: null}),\n         ]);\n       });\n     });\n@@ -162,22 +162,22 @@ describe('addTNodeAndUpdateInsertBeforeIndex', () => {\n   describe('scenario', () => {\n     it('should rearrange the nodes', () => {\n       const previousTNodes: TNode[] = [];\n-      addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(22));\n-      addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(28));\n-      addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(24));\n-      addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(25));\n-      addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(29));\n       addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(23));\n-      addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(27));\n+      addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(29));\n+      addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(25));\n+      addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(26));\n+      addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tI18NTextNode(30));\n+      addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(24));\n+      addTNodeAndUpdateInsertBeforeIndex(previousTNodes, tPlaceholderElementNode(28));\n       expect(previousTNodes).toEqual([\n-        matchTNode({index: 22, insertBeforeIndex: 29}),\n-        matchTNode({index: 28, insertBeforeIndex: 24}),\n-        matchTNode({index: 24, insertBeforeIndex: 29}),\n-        matchTNode({index: 25, insertBeforeIndex: 29}),\n-        matchTNode({index: 29, insertBeforeIndex: null}),\n-        matchTNode({index: 23, insertBeforeIndex: null}),\n-        matchTNode({index: 27, insertBeforeIndex: null}),\n+        matchTNode({index: 23, insertBeforeIndex: 30}),\n+        matchTNode({index: 29, insertBeforeIndex: 25}),\n+        matchTNode({index: 25, insertBeforeIndex: 30}),\n+        matchTNode({index: 26, insertBeforeIndex: 30}),\n+        matchTNode({index: 30, insertBeforeIndex: null}),\n+        matchTNode({index: 24, insertBeforeIndex: null}),\n+        matchTNode({index: 28, insertBeforeIndex: null}),\n       ]);\n     });\n   });\n-});\n\\ No newline at end of file\n+});"
        },
        {
            "sha": "41826fbc5e5b8dcbafdc858856afab019ea4d53f",
            "filename": "packages/core/test/render3/i18n/i18n_parse_spec.ts",
            "status": "modified",
            "additions": 77,
            "deletions": 77,
            "changes": 154,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_parse_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_parse_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_parse_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -26,8 +26,8 @@ describe('i18n_parse', () => {\n       const tI18n = toT18n('some text');\n       expect(tI18n).toEqual(matchTI18n({\n         create: matchDebug([\n-          'lView[22] = document.createText(\"some text\");',\n-          'parent.appendChild(lView[22]);',\n+          'lView[23] = document.createText(\"some text\");',\n+          'parent.appendChild(lView[23]);',\n         ]),\n         update: [] as unknown as I18nUpdateOpCodes,\n       }));\n@@ -40,77 +40,77 @@ describe('i18n_parse', () => {\n       //     TData                  | LView\n       // ---------------------------+-------------------------------\n       //                     ----- DECL -----\n-      // 20: TI18n                  |\n+      // 21: TI18n                  |\n       //                     ----- VARS -----\n-      // 21: Binding for ICU        |\n+      // 22: Binding for ICU        |\n       //                   ----- EXPANDO -----\n-      // 22: null                   | #text(before|)\n-      // 23: TIcu                   | <!-- ICU 20:0 -->\n-      // 24: null                   | currently selected ICU case\n-      // 25: null                   | #text(caseA)\n-      // 26: null                   | #text(otherCase)\n-      // 27: null                   | #text(|after)\n+      // 23: null                   | #text(before|)\n+      // 24: TIcu                   | <!-- ICU 20:0 -->\n+      // 25: null                   | currently selected ICU case\n+      // 26: null                   | #text(caseA)\n+      // 27: null                   | #text(otherCase)\n+      // 28: null                   | #text(|after)\n       const tI18n = toT18n(`before|{\n           �0�, select,\n             A {caseA}\n             other {otherCase}\n         }|after`);\n       expect(tI18n).toEqual(matchTI18n({\n         create: matchDebug([\n-          'lView[22] = document.createText(\"before|\");',\n-          'parent.appendChild(lView[22]);',\n-          'lView[23] = document.createComment(\"ICU 20:0\");',\n+          'lView[23] = document.createText(\"before|\");',\n           'parent.appendChild(lView[23]);',\n-          'lView[27] = document.createText(\"|after\");',\n-          'parent.appendChild(lView[27]);',\n+          'lView[24] = document.createComment(\"ICU 21:0\");',\n+          'parent.appendChild(lView[24]);',\n+          'lView[28] = document.createText(\"|after\");',\n+          'parent.appendChild(lView[28]);',\n         ]),\n         update: matchDebug([\n-          'if (mask & 0b1) { icuSwitchCase(23, `${lView[i-1]}`); }',\n+          'if (mask & 0b1) { icuSwitchCase(24, `${lView[i-1]}`); }',\n         ])\n       }));\n-      expect(getTIcu(fixture.tView, 23)).toEqual(matchTIcu({\n+      expect(getTIcu(fixture.tView, 24)).toEqual(matchTIcu({\n         type: IcuType.select,\n-        anchorIdx: 23,\n-        currentCaseLViewIndex: 24,\n+        anchorIdx: 24,\n+        currentCaseLViewIndex: 25,\n         cases: ['A', 'other'],\n         create: [\n           matchDebug([\n-            'lView[25] = document.createTextNode(\"caseA\")',\n-            '(lView[0] as Element).appendChild(lView[25])'\n+            'lView[26] = document.createTextNode(\"caseA\")',\n+            '(lView[0] as Element).appendChild(lView[26])'\n           ]),\n           matchDebug([\n-            'lView[26] = document.createTextNode(\"otherCase\")',\n-            '(lView[0] as Element).appendChild(lView[26])',\n+            'lView[27] = document.createTextNode(\"otherCase\")',\n+            '(lView[0] as Element).appendChild(lView[27])',\n           ])\n         ],\n         update: [\n           matchDebug([]),\n           matchDebug([]),\n         ],\n         remove: [\n-          matchDebug(['remove(lView[25])']),\n           matchDebug(['remove(lView[26])']),\n+          matchDebug(['remove(lView[27])']),\n         ],\n       }));\n \n       fixture.apply(() => {\n         applyCreateOpCodes(fixture.lView, tI18n.create, fixture.host, null);\n-        expect(fixture.host.innerHTML).toEqual('before|<!--ICU 20:0-->|after');\n+        expect(fixture.host.innerHTML).toEqual('before|<!--ICU 21:0-->|after');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('before|caseA<!--ICU 20:0-->|after');\n+        expect(fixture.host.innerHTML).toEqual('before|caseA<!--ICU 21:0-->|after');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('x');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('before|otherCase<!--ICU 20:0-->|after');\n+        expect(fixture.host.innerHTML).toEqual('before|otherCase<!--ICU 21:0-->|after');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('before|caseA<!--ICU 20:0-->|after');\n+        expect(fixture.host.innerHTML).toEqual('before|caseA<!--ICU 21:0-->|after');\n       });\n     });\n \n@@ -122,23 +122,23 @@ describe('i18n_parse', () => {\n       }`);\n       fixture.apply(() => {\n         applyCreateOpCodes(fixture.lView, tI18n.create, fixture.host, null);\n-        expect(fixture.host.innerHTML).toEqual('<!--ICU 20:0-->');\n+        expect(fixture.host.innerHTML).toEqual('<!--ICU 21:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('Hello <b>world<i>!</i></b><!--ICU 20:0-->');\n+        expect(fixture.host.innerHTML).toEqual('Hello <b>world<i>!</i></b><!--ICU 21:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('x');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n         expect(fixture.host.innerHTML)\n-            .toEqual('<div>nestedOther<!--nested ICU 0--></div><!--ICU 20:0-->');\n+            .toEqual('<div>nestedOther<!--nested ICU 0--></div><!--ICU 21:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('Hello <b>world<i>!</i></b><!--ICU 20:0-->');\n+        expect(fixture.host.innerHTML).toEqual('Hello <b>world<i>!</i></b><!--ICU 21:0-->');\n       });\n     });\n \n@@ -148,54 +148,54 @@ describe('i18n_parse', () => {\n       //     TData                  | LView\n       // ---------------------------+-------------------------------\n       //                     ----- DECL -----\n-      // 20: TI18n                  |\n+      // 21: TI18n                  |\n       //                     ----- VARS -----\n-      // 21: Binding for parent ICU |\n-      // 22: Binding for child ICU  |\n+      // 22: Binding for parent ICU |\n       // 23: Binding for child ICU  |\n+      // 24: Binding for child ICU  |\n       //                   ----- EXPANDO -----\n-      // 24: TIcu (parent)          | <!-- ICU 20:0 -->\n-      // 25: null                   | currently selected ICU case\n-      // 26: null                   | #text( parentA )\n-      // 27: TIcu (child)           | <!-- nested ICU 0 -->\n-      // 28:     null               |     currently selected ICU case\n-      // 29:     null               |     #text(nested0)\n-      // 30:     null               |     #text({{�2�}})\n-      // 31: null                   | #text( )\n-      // 32: null                   | #text( parentOther )\n+      // 25: TIcu (parent)          | <!-- ICU 20:0 -->\n+      // 26: null                   | currently selected ICU case\n+      // 27: null                   | #text( parentA )\n+      // 28: TIcu (child)           | <!-- nested ICU 0 -->\n+      // 29:     null               |     currently selected ICU case\n+      // 30:     null               |     #text(nested0)\n+      // 31:     null               |     #text({{�2�}})\n+      // 32: null                   | #text( )\n+      // 33: null                   | #text( parentOther )\n       const tI18n = toT18n(`{\n           �0�, select,\n             A {parentA {�1�, select, 0 {nested0} other {�2�}}!}\n             other {parentOther}\n         }`);\n       expect(tI18n).toEqual(matchTI18n({\n         create: matchDebug([\n-          'lView[24] = document.createComment(\"ICU 20:0\");',\n-          'parent.appendChild(lView[24]);',\n+          'lView[25] = document.createComment(\"ICU 21:0\");',\n+          'parent.appendChild(lView[25]);',\n         ]),\n         update: matchDebug([\n-          'if (mask & 0b1) { icuSwitchCase(24, `${lView[i-1]}`); }',\n-          'if (mask & 0b10) { icuSwitchCase(27, `${lView[i-2]}`); }',\n-          'if (mask & 0b100) { icuUpdateCase(27); }',\n+          'if (mask & 0b1) { icuSwitchCase(25, `${lView[i-1]}`); }',\n+          'if (mask & 0b10) { icuSwitchCase(28, `${lView[i-2]}`); }',\n+          'if (mask & 0b100) { icuUpdateCase(28); }',\n         ]),\n       }));\n-      expect(getTIcu(fixture.tView, 24)).toEqual(matchTIcu({\n+      expect(getTIcu(fixture.tView, 25)).toEqual(matchTIcu({\n         type: IcuType.select,\n-        anchorIdx: 24,\n-        currentCaseLViewIndex: 25,\n+        anchorIdx: 25,\n+        currentCaseLViewIndex: 26,\n         cases: ['A', 'other'],\n         create: [\n           matchDebug([\n-            'lView[26] = document.createTextNode(\"parentA \")',\n-            '(lView[0] as Element).appendChild(lView[26])',\n-            'lView[27] = document.createComment(\"nested ICU 0\")',\n+            'lView[27] = document.createTextNode(\"parentA \")',\n             '(lView[0] as Element).appendChild(lView[27])',\n-            'lView[31] = document.createTextNode(\"!\")',\n-            '(lView[0] as Element).appendChild(lView[31])',\n+            'lView[28] = document.createComment(\"nested ICU 0\")',\n+            '(lView[0] as Element).appendChild(lView[28])',\n+            'lView[32] = document.createTextNode(\"!\")',\n+            '(lView[0] as Element).appendChild(lView[32])',\n           ]),\n           matchDebug([\n-            'lView[32] = document.createTextNode(\"parentOther\")',\n-            '(lView[0] as Element).appendChild(lView[32])',\n+            'lView[33] = document.createTextNode(\"parentOther\")',\n+            '(lView[0] as Element).appendChild(lView[33])',\n           ])\n         ],\n         update: [\n@@ -204,76 +204,76 @@ describe('i18n_parse', () => {\n         ],\n         remove: [\n           matchDebug([\n-            'remove(lView[26])',\n-            'removeNestedICU(27)',\n             'remove(lView[27])',\n-            'remove(lView[31])',\n+            'removeNestedICU(28)',\n+            'remove(lView[28])',\n+            'remove(lView[32])',\n           ]),\n           matchDebug([\n-            'remove(lView[32])',\n+            'remove(lView[33])',\n           ])\n         ],\n       }));\n \n-      expect(getTIcu(fixture.tView, 27)).toEqual(matchTIcu({\n+      expect(getTIcu(fixture.tView, 28)).toEqual(matchTIcu({\n         type: IcuType.select,\n-        anchorIdx: 27,\n-        currentCaseLViewIndex: 28,\n+        anchorIdx: 28,\n+        currentCaseLViewIndex: 29,\n         cases: ['0', 'other'],\n         create: [\n           matchDebug([\n-            'lView[29] = document.createTextNode(\"nested0\")',\n-            '(lView[0] as Element).appendChild(lView[29])'\n+            'lView[30] = document.createTextNode(\"nested0\")',\n+            '(lView[0] as Element).appendChild(lView[30])'\n           ]),\n           matchDebug([\n-            'lView[30] = document.createTextNode(\"\")',\n-            '(lView[0] as Element).appendChild(lView[30])',\n+            'lView[31] = document.createTextNode(\"\")',\n+            '(lView[0] as Element).appendChild(lView[31])',\n           ])\n         ],\n         update: [\n           matchDebug([]),\n           matchDebug([\n-            'if (mask & 0b100) { (lView[30] as Text).textContent = `${lView[i-3]}`; }',\n+            'if (mask & 0b100) { (lView[31] as Text).textContent = `${lView[i-3]}`; }',\n           ]),\n         ],\n         remove: [\n-          matchDebug(['remove(lView[29])']),\n           matchDebug(['remove(lView[30])']),\n+          matchDebug(['remove(lView[31])']),\n         ],\n       }));\n \n       fixture.apply(() => {\n         applyCreateOpCodes(fixture.lView, tI18n.create, fixture.host, null);\n-        expect(fixture.host.innerHTML).toEqual('<!--ICU 20:0-->');\n+        expect(fixture.host.innerHTML).toEqual('<!--ICU 21:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nExp('0');\n         ɵɵi18nExp('value1');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n         expect(fixture.host.innerHTML)\n-            .toEqual('parentA nested0<!--nested ICU 0-->!<!--ICU 20:0-->');\n+            .toEqual('parentA nested0<!--nested ICU 0-->!<!--ICU 21:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nExp('x');\n         ɵɵi18nExp('value1');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('parentA value1<!--nested ICU 0-->!<!--ICU 20:0-->');\n+        expect(fixture.host.innerHTML).toEqual('parentA value1<!--nested ICU 0-->!<!--ICU 21:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('x');\n         ɵɵi18nExp('x');\n         ɵɵi18nExp('value2');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('parentOther<!--ICU 20:0-->');\n+        expect(fixture.host.innerHTML).toEqual('parentOther<!--ICU 21:0-->');\n       });\n       fixture.apply(() => {\n         ɵɵi18nExp('A');\n         ɵɵi18nExp('A');\n         ɵɵi18nExp('value2');\n         ɵɵi18nApply(0);  // index 0 + HEADER_OFFSET = 20;\n-        expect(fixture.host.innerHTML).toEqual('parentA value2<!--nested ICU 0-->!<!--ICU 20:0-->');\n+        expect(fixture.host.innerHTML).toEqual('parentA value2<!--nested ICU 0-->!<!--ICU 21:0-->');\n       });\n     });\n   });"
        },
        {
            "sha": "70666f4257a838c27701f842e9a24262c4c92cb6",
            "filename": "packages/core/test/render3/i18n/i18n_spec.ts",
            "status": "modified",
            "additions": 58,
            "deletions": 58,
            "changes": 116,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fi18n%2Fi18n_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -128,7 +128,7 @@ describe('Runtime i18n', () => {\n       }, undefined, nbConsts, HEADER_OFFSET + index);\n \n       expect((opCodes as any).update.debug).toEqual([\n-        'if (mask & 0b1) { (lView[22] as Text).textContent = `Hello ${lView[i-1]}!`; }'\n+        'if (mask & 0b1) { (lView[23] as Text).textContent = `Hello ${lView[i-1]}!`; }'\n       ]);\n \n       expect(opCodes).toEqual({\n@@ -137,7 +137,7 @@ describe('Runtime i18n', () => {\n           `parent.appendChild(lView[${HEADER_OFFSET + 2}]);`,\n         ]),\n         update: matchDebug([\n-          'if (mask & 0b1) { (lView[22] as Text).textContent = `Hello ${lView[i-1]}!`; }',\n+          'if (mask & 0b1) { (lView[23] as Text).textContent = `Hello ${lView[i-1]}!`; }',\n         ]),\n       });\n     });\n@@ -158,7 +158,7 @@ describe('Runtime i18n', () => {\n           `parent.appendChild(lView[${HEADER_OFFSET + 2}]);`,\n         ]),\n         update: matchDebug([\n-          'if (mask & 0b11) { (lView[22] as Text).textContent = `Hello ${lView[i-1]} and ${lView[i-2]}, again ${lView[i-1]}!`; }',\n+          'if (mask & 0b11) { (lView[23] as Text).textContent = `Hello ${lView[i-1]} and ${lView[i-2]}, again ${lView[i-1]}!`; }',\n         ]),\n       });\n     });\n@@ -193,7 +193,7 @@ describe('Runtime i18n', () => {\n           `parent.appendChild(lView[${HEADER_OFFSET + 4}]);`,\n         ]),\n         update: matchDebug([\n-          'if (mask & 0b1) { (lView[23] as Text).textContent = `${lView[i-1]} is rendered as: `; }',\n+          'if (mask & 0b1) { (lView[24] as Text).textContent = `${lView[i-1]} is rendered as: `; }',\n         ]),\n       });\n \n@@ -249,26 +249,26 @@ describe('Runtime i18n', () => {\n \n       expect(opCodes).toEqual({\n         create: matchDebug([\n-          `lView[${HEADER_OFFSET + 2}] = document.createComment(\"ICU 21:0\");`,\n+          `lView[${HEADER_OFFSET + 2}] = document.createComment(\"ICU 22:0\");`,\n           `parent.appendChild(lView[${HEADER_OFFSET + 2}]);`,\n         ]),\n         update: matchDebug([\n-          'if (mask & 0b1) { icuSwitchCase(22, `${lView[i-1]}`); }',\n-          'if (mask & 0b1) { icuUpdateCase(22); }',\n+          'if (mask & 0b1) { icuSwitchCase(23, `${lView[i-1]}`); }',\n+          'if (mask & 0b1) { icuUpdateCase(23); }',\n         ]),\n       });\n-      expect(getTIcu(tView, 22)).toEqual(<TIcu>{\n+      expect(getTIcu(tView, 23)).toEqual(<TIcu>{\n         type: 1,\n-        currentCaseLViewIndex: 23,\n-        anchorIdx: 22,\n+        currentCaseLViewIndex: 24,\n+        anchorIdx: 23,\n         cases: ['0', '1', 'other'],\n         create: [\n           matchDebug([\n             `lView[${HEADER_OFFSET + 4}] = document.createTextNode(\"no \")`,\n             `(lView[${HEADER_OFFSET + 0}] as Element).appendChild(lView[${HEADER_OFFSET + 4}])`,\n-            'lView[25] = document.createElement(\"b\")',\n+            'lView[26] = document.createElement(\"b\")',\n             `(lView[${HEADER_OFFSET + 0}] as Element).appendChild(lView[${HEADER_OFFSET + 5}])`,\n-            '(lView[25] as Element).setAttribute(\"title\", \"none\")',\n+            '(lView[26] as Element).setAttribute(\"title\", \"none\")',\n             `lView[${HEADER_OFFSET + 6}] = document.createTextNode(\"emails\")`,\n             `(lView[${HEADER_OFFSET + 5}] as Element).appendChild(lView[${HEADER_OFFSET + 6}])`,\n             `lView[${HEADER_OFFSET + 7}] = document.createTextNode(\"!\")`,\n@@ -277,41 +277,41 @@ describe('Runtime i18n', () => {\n           matchDebug([\n             `lView[${HEADER_OFFSET + 8}] = document.createTextNode(\"one \")`,\n             `(lView[${HEADER_OFFSET + 0}] as Element).appendChild(lView[${HEADER_OFFSET + 8}])`,\n-            'lView[29] = document.createElement(\"i\")',\n+            'lView[30] = document.createElement(\"i\")',\n             `(lView[${HEADER_OFFSET + 0}] as Element).appendChild(lView[${HEADER_OFFSET + 9}])`,\n-            'lView[30] = document.createTextNode(\"email\")',\n-            '(lView[29] as Element).appendChild(lView[30])',\n+            'lView[31] = document.createTextNode(\"email\")',\n+            '(lView[30] as Element).appendChild(lView[31])',\n           ]),\n           matchDebug([\n-            'lView[31] = document.createTextNode(\"\")',\n-            '(lView[20] as Element).appendChild(lView[31])',\n-            'lView[32] = document.createElement(\"span\")',\n-            '(lView[20] as Element).appendChild(lView[32])',\n-            'lView[33] = document.createTextNode(\"emails\")',\n-            '(lView[32] as Element).appendChild(lView[33])',\n+            'lView[32] = document.createTextNode(\"\")',\n+            '(lView[21] as Element).appendChild(lView[32])',\n+            'lView[33] = document.createElement(\"span\")',\n+            '(lView[21] as Element).appendChild(lView[33])',\n+            'lView[34] = document.createTextNode(\"emails\")',\n+            '(lView[33] as Element).appendChild(lView[34])',\n           ]),\n         ],\n         remove: [\n           matchDebug([\n-            'remove(lView[24])',\n             'remove(lView[25])',\n-            'remove(lView[27])',\n+            'remove(lView[26])',\n+            'remove(lView[28])',\n           ]),\n           matchDebug([\n-            'remove(lView[28])',\n             'remove(lView[29])',\n+            'remove(lView[30])',\n           ]),\n           matchDebug([\n-            'remove(lView[31])',\n             'remove(lView[32])',\n+            'remove(lView[33])',\n           ]),\n         ],\n         update: [\n           matchDebug([]),\n           matchDebug([]),\n           matchDebug([\n-            'if (mask & 0b1) { (lView[31] as Text).textContent = `${lView[i-1]} `; }',\n-            'if (mask & 0b10) { (lView[32] as Element).setAttribute(\\'title\\', `${lView[i-2]}`); }',\n+            'if (mask & 0b1) { (lView[32] as Text).textContent = `${lView[i-1]} `; }',\n+            'if (mask & 0b10) { (lView[33] as Element).setAttribute(\\'title\\', `${lView[i-2]}`); }',\n           ]),\n         ]\n       });\n@@ -336,19 +336,19 @@ describe('Runtime i18n', () => {\n \n       expect(opCodes).toEqual({\n         create: matchDebug([\n-          `lView[${HEADER_OFFSET + 2}] = document.createComment(\"ICU 21:0\");`,\n+          `lView[${HEADER_OFFSET + 2}] = document.createComment(\"ICU 22:0\");`,\n           `parent.appendChild(lView[${HEADER_OFFSET + 2}]);`,\n         ]),\n         update: matchDebug([\n-          'if (mask & 0b1) { icuSwitchCase(22, `${lView[i-1]}`); }',\n-          'if (mask & 0b10) { icuSwitchCase(26, `${lView[i-2]}`); }',\n-          'if (mask & 0b1) { icuUpdateCase(22); }',\n+          'if (mask & 0b1) { icuSwitchCase(23, `${lView[i-1]}`); }',\n+          'if (mask & 0b10) { icuSwitchCase(27, `${lView[i-2]}`); }',\n+          'if (mask & 0b1) { icuUpdateCase(23); }',\n         ]),\n       });\n-      expect(getTIcu(tView, 22)).toEqual({\n+      expect(getTIcu(tView, 23)).toEqual({\n         type: 1,\n-        anchorIdx: 22,\n-        currentCaseLViewIndex: 23,\n+        anchorIdx: 23,\n+        currentCaseLViewIndex: 24,\n         cases: ['0', 'other'],\n         create: [\n           matchDebug([\n@@ -358,34 +358,34 @@ describe('Runtime i18n', () => {\n           matchDebug([\n             `lView[${HEADER_OFFSET + 5}] = document.createTextNode(\"\")`,\n             `(lView[${HEADER_OFFSET + 0}] as Element).appendChild(lView[${HEADER_OFFSET + 5}])`,\n-            'lView[26] = document.createComment(\"nested ICU 0\")',\n+            'lView[27] = document.createComment(\"nested ICU 0\")',\n             `(lView[${HEADER_OFFSET + 0}] as Element).appendChild(lView[${HEADER_OFFSET + 6}])`,\n-            'lView[31] = document.createTextNode(\"!\")',\n-            '(lView[20] as Element).appendChild(lView[31])',\n+            'lView[32] = document.createTextNode(\"!\")',\n+            '(lView[21] as Element).appendChild(lView[32])',\n           ]),\n         ],\n         update: [\n           matchDebug([]),\n           matchDebug([\n-            'if (mask & 0b1) { (lView[25] as Text).textContent = `${lView[i-1]} `; }',\n+            'if (mask & 0b1) { (lView[26] as Text).textContent = `${lView[i-1]} `; }',\n           ]),\n         ],\n         remove: [\n           matchDebug([\n-            'remove(lView[24])',\n+            'remove(lView[25])',\n           ]),\n           matchDebug([\n-            'remove(lView[25])',\n-            'removeNestedICU(26)',\n             'remove(lView[26])',\n-            'remove(lView[31])',\n+            'removeNestedICU(27)',\n+            'remove(lView[27])',\n+            'remove(lView[32])',\n           ]),\n         ],\n       });\n-      expect(tView.data[26]).toEqual({\n+      expect(tView.data[27]).toEqual({\n         type: 0,\n-        anchorIdx: 26,\n-        currentCaseLViewIndex: 27,\n+        anchorIdx: 27,\n+        currentCaseLViewIndex: 28,\n         cases: ['cat', 'dog', 'other'],\n         create: [\n           matchDebug([\n@@ -397,8 +397,8 @@ describe('Runtime i18n', () => {\n             `(lView[${HEADER_OFFSET + 0}] as Element).appendChild(lView[${HEADER_OFFSET + 9}])`,\n           ]),\n           matchDebug([\n-            'lView[30] = document.createTextNode(\"animals\")',\n-            '(lView[20] as Element).appendChild(lView[30])',\n+            'lView[31] = document.createTextNode(\"animals\")',\n+            '(lView[21] as Element).appendChild(lView[31])',\n           ]),\n         ],\n         update: [\n@@ -407,9 +407,9 @@ describe('Runtime i18n', () => {\n           matchDebug([]),\n         ],\n         remove: [\n-          matchDebug(['remove(lView[28])']),\n           matchDebug(['remove(lView[29])']),\n           matchDebug(['remove(lView[30])']),\n+          matchDebug(['remove(lView[31])']),\n         ],\n       });\n     });\n@@ -428,7 +428,7 @@ describe('Runtime i18n', () => {\n       }, undefined, nbConsts, HEADER_OFFSET + index);\n \n       expect(opCodes).toEqual(matchDebug([\n-        'if (mask & 0b1) { (lView[20] as Element).setAttribute(\\'title\\', `Hello ${lView[i-1]}!`); }',\n+        'if (mask & 0b1) { (lView[21] as Element).setAttribute(\\'title\\', `Hello ${lView[i-1]}!`); }',\n       ]));\n     });\n \n@@ -444,7 +444,7 @@ describe('Runtime i18n', () => {\n       }, undefined, nbConsts, HEADER_OFFSET + index);\n \n       expect(opCodes).toEqual(matchDebug([\n-        'if (mask & 0b11) { (lView[20] as Element).setAttribute(\\'title\\', `Hello ${lView[i-1]} and ${lView[i-2]}, again ${lView[i-1]}!`); }',\n+        'if (mask & 0b11) { (lView[21] as Element).setAttribute(\\'title\\', `Hello ${lView[i-1]} and ${lView[i-2]}, again ${lView[i-1]}!`); }',\n       ]));\n     });\n \n@@ -460,8 +460,8 @@ describe('Runtime i18n', () => {\n       }, undefined, nbConsts, HEADER_OFFSET + index);\n \n       expect(opCodes).toEqual(matchDebug([\n-        'if (mask & 0b1) { (lView[20] as Element).setAttribute(\\'title\\', `Hello ${lView[i-1]}!`); }',\n-        'if (mask & 0b1) { (lView[20] as Element).setAttribute(\\'aria-label\\', `Hello ${lView[i-1]}!`); }',\n+        'if (mask & 0b1) { (lView[21] as Element).setAttribute(\\'title\\', `Hello ${lView[i-1]}!`); }',\n+        'if (mask & 0b1) { (lView[21] as Element).setAttribute(\\'aria-label\\', `Hello ${lView[i-1]}!`); }',\n       ]));\n     });\n   });\n@@ -702,8 +702,8 @@ describe('Runtime i18n', () => {\n         ],\n       }));\n       expect(ti18n.update).toEqual(matchDebug([\n-        'if (mask & 0b1) { (lView[50] as Text).textContent = `${lView[i-1]} `; }',\n-        'if (mask & 0b10) { (lView[51] as Text).textContent = `${lView[i-2]}`; }'\n+        'if (mask & 0b1) { (lView[51] as Text).textContent = `${lView[i-1]} `; }',\n+        'if (mask & 0b10) { (lView[52] as Text).textContent = `${lView[i-2]}`; }'\n       ]));\n       const lViewDebug = fixture.lView.debug!;\n       expect(lViewDebug.template).toEqual('<div>{{?}}<Placeholder>{{?}}</Placeholder>!</div>');\n@@ -714,16 +714,16 @@ describe('Runtime i18n', () => {\n           fixture.tView, 0, fixture.lView, HEADER_OFFSET + 1, 'Hello �*2:1�World�/*2:1�!', -1);\n       const ti18n = fixture.tView.data[HEADER_OFFSET + 1] as TI18n;\n       expect(ti18n.create.debug).toEqual([\n-        'lView[50] = document.createText(\"Hello \");',\n-        'parent.appendChild(lView[50]);',\n-        'lView[51] = document.createText(\"!\");',\n+        'lView[51] = document.createText(\"Hello \");',\n         'parent.appendChild(lView[51]);',\n+        'lView[52] = document.createText(\"!\");',\n+        'parent.appendChild(lView[52]);',\n       ]);\n       // Leave behind `Placeholder` to be picked up by `TNode` creation.\n       // It should insert itself in front of \"!\"\n       expect(fixture.tView.data[HEADER_OFFSET + 2]).toEqual(matchTNode({\n         type: TNodeType.Placeholder,\n-        insertBeforeIndex: 51,\n+        insertBeforeIndex: 52,\n       }));\n     });\n   });"
        },
        {
            "sha": "99b7a06c7902c7f81acf9a061f9f861b6abca1c3",
            "filename": "packages/core/test/render3/instructions/lview_debug_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Flview_debug_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Flview_debug_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Finstructions%2Flview_debug_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -242,7 +242,7 @@ describe('lView_debug', () => {\n         cumulativeBloom: jasmine.anything(),\n         providers: [MyChild.ɵdir],\n         viewProviders: [],\n-        parentInjectorIndex: 22,\n+        parentInjectorIndex: 23,\n       });\n     });\n   });"
        },
        {
            "sha": "56784af80870a4f0ad4eebf48206af7a750ac3bd",
            "filename": "packages/core/test/render3/integration_spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 8,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Frender3%2Fintegration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18b33e79d3d64f98f80838503e802d0369fcdb16/packages%2Fcore%2Ftest%2Frender3%2Fintegration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fintegration_spec.ts?ref=18b33e79d3d64f98f80838503e802d0369fcdb16",
            "patch": "@@ -13,7 +13,7 @@ import {AttributeMarker, ɵɵadvance, ɵɵattribute, ɵɵdefineComponent, ɵɵde\n import {ɵɵelement, ɵɵelementEnd, ɵɵelementStart, ɵɵprojection, ɵɵprojectionDef, ɵɵtemplate, ɵɵtext} from '../../src/render3/instructions/all';\n import {RenderFlags} from '../../src/render3/interfaces/definition';\n import {domRendererFactory3, Renderer3, RendererFactory3} from '../../src/render3/interfaces/renderer';\n-import {CONTEXT, HEADER_OFFSET} from '../../src/render3/interfaces/view';\n+import {CONTEXT, HEADER_OFFSET, ID, LView} from '../../src/render3/interfaces/view';\n import {ɵɵsanitizeUrl} from '../../src/sanitization/sanitization';\n import {Sanitizer} from '../../src/sanitization/sanitizer';\n import {SecurityContext} from '../../src/sanitization/security';\n@@ -399,19 +399,17 @@ describe('element discovery', () => {\n \n     const section = fixture.hostElement.querySelector('section')!;\n     const sectionContext = getLContext(section)!;\n-    const sectionLView = sectionContext.lView!;\n     expect(sectionContext.nodeIndex).toEqual(HEADER_OFFSET);\n-    expect(sectionLView.length).toBeGreaterThan(HEADER_OFFSET);\n+    expect(sectionContext.lView!.length).toBeGreaterThan(HEADER_OFFSET);\n     expect(sectionContext.native).toBe(section);\n \n     const div = fixture.hostElement.querySelector('div')!;\n     const divContext = getLContext(div)!;\n-    const divLView = divContext.lView!;\n     expect(divContext.nodeIndex).toEqual(HEADER_OFFSET + 1);\n-    expect(divLView.length).toBeGreaterThan(HEADER_OFFSET);\n+    expect(divContext.lView!.length).toBeGreaterThan(HEADER_OFFSET);\n     expect(divContext.native).toBe(div);\n \n-    expect(divLView).toBe(sectionLView);\n+    expect(divContext.lView).toBe(sectionContext.lView);\n   });\n \n   it('should cache the element context on a element was pre-emptively monkey-patched', () => {\n@@ -738,7 +736,7 @@ describe('element discovery', () => {\n        const div1 = hostElm.querySelector('div:first-child')! as any;\n        const div2 = hostElm.querySelector('div:last-child')! as any;\n        const context = getLContext(hostElm)!;\n-       const componentView = context.lView[context.nodeIndex];\n+       const componentView = context.lView![context.nodeIndex];\n \n        expect(componentView).toContain(myDir1Instance);\n        expect(componentView).toContain(myDir2Instance);\n@@ -917,7 +915,7 @@ describe('element discovery', () => {\n        const context = getLContext(child)!;\n        expect(readPatchedData(child)).toBeTruthy();\n \n-       const componentData = context.lView[context.nodeIndex];\n+       const componentData = context.lView![context.nodeIndex];\n        const component = componentData[CONTEXT];\n        expect(component instanceof ChildComp).toBeTruthy();\n        expect(readPatchedData(component)).toBe(context.lView);"
        }
    ],
    "stats": {
        "total": 1042,
        "additions": 648,
        "deletions": 394
    }
}