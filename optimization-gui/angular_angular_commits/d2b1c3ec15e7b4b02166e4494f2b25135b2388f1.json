{
    "author": "josephperrott",
    "message": "fix(dev-infra): fix creating experimental semver versions to include prerelease chunk (#42917)\n\nSemVers created for experimental versions should also include the prerelease chunk (i.e. -next.3).\n\nPR Close #42917",
    "sha": "d2b1c3ec15e7b4b02166e4494f2b25135b2388f1",
    "files": [
        {
            "sha": "1ca11e79466b12e1e99778b57c3f07bb0d5785ce",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/d2b1c3ec15e7b4b02166e4494f2b25135b2388f1/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/d2b1c3ec15e7b4b02166e4494f2b25135b2388f1/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=d2b1c3ec15e7b4b02166e4494f2b25135b2388f1",
            "patch": "@@ -6199,6 +6199,13 @@ function semverInc(version, release, identifier) {\n     const clone = new semver.SemVer(version.version);\n     return clone.inc(release, identifier);\n }\n+/** Creates the equivalent experimental version for a provided SemVer. */\n+function createExperimentalSemver(version) {\n+    const experimentalVersion = new semver.SemVer(version.format());\n+    experimentalVersion.major = 0;\n+    experimentalVersion.minor = version.major * 100 + version.minor;\n+    return new semver.SemVer(experimentalVersion.format());\n+}\n \n /**\n  * @license\n@@ -6843,7 +6850,7 @@ class ReleaseAction {\n     _verifyPackageVersions(version, packages) {\n         return tslib.__awaiter(this, void 0, void 0, function* () {\n             /** Experimental equivalent version for packages created with the provided version. */\n-            const experimentalVersion = new semver.SemVer(`0.${version.major * 100 + version.minor}.${version.patch}`);\n+            const experimentalVersion = createExperimentalSemver(version);\n             for (const pkg of packages) {\n                 const { version: packageJsonVersion } = JSON.parse(yield fs.promises.readFile(path.join(pkg.outputPath, 'package.json'), 'utf8'));\n                 const mismatchesVersion = version.compare(packageJsonVersion) !== 0;"
        },
        {
            "sha": "3a892279ae16cb48521aa0035e75bbad29ef1058",
            "filename": "dev-infra/release/publish/actions.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/d2b1c3ec15e7b4b02166e4494f2b25135b2388f1/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "raw_url": "https://github.com/angular/angular/raw/d2b1c3ec15e7b4b02166e4494f2b25135b2388f1/dev-infra%2Frelease%2Fpublish%2Factions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Factions.ts?ref=d2b1c3ec15e7b4b02166e4494f2b25135b2388f1",
            "patch": "@@ -18,6 +18,7 @@ import {BuiltPackage, ReleaseConfig} from '../config/index';\n import {ReleaseNotes} from '../notes/release-notes';\n import {NpmDistTag} from '../versioning';\n import {ActiveReleaseTrains} from '../versioning/active-release-trains';\n+import {createExperimentalSemver} from '../versioning/inc-semver';\n import {runNpmPublish} from '../versioning/npm-publish';\n \n import {FatalReleaseActionError, UserAbortedReleaseActionError} from './actions-error';\n@@ -521,8 +522,8 @@ export abstract class ReleaseAction {\n   /** Verify the version of each generated package exact matches the specified version. */\n   private async _verifyPackageVersions(version: semver.SemVer, packages: BuiltPackage[]) {\n     /** Experimental equivalent version for packages created with the provided version. */\n-    const experimentalVersion =\n-        new semver.SemVer(`0.${version.major * 100 + version.minor}.${version.patch}`);\n+    const experimentalVersion = createExperimentalSemver(version);\n+\n     for (const pkg of packages) {\n       const {version: packageJsonVersion} =\n           JSON.parse(await fs.readFile(join(pkg.outputPath, 'package.json'), 'utf8')) as"
        },
        {
            "sha": "3fcc1ffbf47624e64d4589645fedb3fe3609ad58",
            "filename": "dev-infra/release/versioning/inc-semver.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/d2b1c3ec15e7b4b02166e4494f2b25135b2388f1/dev-infra%2Frelease%2Fversioning%2Finc-semver.ts",
            "raw_url": "https://github.com/angular/angular/raw/d2b1c3ec15e7b4b02166e4494f2b25135b2388f1/dev-infra%2Frelease%2Fversioning%2Finc-semver.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Finc-semver.ts?ref=d2b1c3ec15e7b4b02166e4494f2b25135b2388f1",
            "patch": "@@ -17,3 +17,11 @@ export function semverInc(\n   const clone = new semver.SemVer(version.version);\n   return clone.inc(release, identifier);\n }\n+\n+/** Creates the equivalent experimental version for a provided SemVer. */\n+export function createExperimentalSemver(version: semver.SemVer): semver.SemVer {\n+  const experimentalVersion = new semver.SemVer(version.format());\n+  experimentalVersion.major = 0;\n+  experimentalVersion.minor = version.major * 100 + version.minor;\n+  return new semver.SemVer(experimentalVersion.format());\n+}"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 19,
        "deletions": 3
    }
}