{
    "author": "JoostK",
    "message": "perf(compiler-cli): reduce analysis work during incremental rebuilds (#44731)\n\nThis commit reduces the analysis work that needs to happen during an\nincremental rebuild by properly recording files for which no traits were found\nin the set of files that have no traits, such that the same file doesn't have\nto be reanalyzed during subsequent rebuilds. It also excludes shim files from\nanalysis.\n\nPR Close #44731",
    "sha": "5efebf87be0955220f07c706cb83efba45532cd0",
    "files": [
        {
            "sha": "d89d3aa232fb92f3ef77b8207afebac5398eb257",
            "filename": "packages/compiler-cli/src/ngtsc/transform/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/5efebf87be0955220f07c706cb83efba45532cd0/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/5efebf87be0955220f07c706cb83efba45532cd0/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2FBUILD.bazel?ref=5efebf87be0955220f07c706cb83efba45532cd0",
            "patch": "@@ -17,6 +17,7 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/indexer\",\n         \"//packages/compiler-cli/src/ngtsc/perf\",\n         \"//packages/compiler-cli/src/ngtsc/reflection\",\n+        \"//packages/compiler-cli/src/ngtsc/shims\",\n         \"//packages/compiler-cli/src/ngtsc/translator\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/api\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/extended/api\","
        },
        {
            "sha": "6141d3cadb300afcebaafe8ba5776800b08070ca",
            "filename": "packages/compiler-cli/src/ngtsc/transform/src/compilation.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/5efebf87be0955220f07c706cb83efba45532cd0/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Fcompilation.ts",
            "raw_url": "https://github.com/angular/angular/raw/5efebf87be0955220f07c706cb83efba45532cd0/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Fcompilation.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Fcompilation.ts?ref=5efebf87be0955220f07c706cb83efba45532cd0",
            "patch": "@@ -15,6 +15,7 @@ import {SemanticDepGraphUpdater, SemanticSymbol} from '../../incremental/semanti\n import {IndexingContext} from '../../indexer';\n import {PerfEvent, PerfRecorder} from '../../perf';\n import {ClassDeclaration, DeclarationNode, Decorator, isNamedClassDeclaration, ReflectionHost} from '../../reflection';\n+import {isShim} from '../../shims';\n import {ProgramTypeCheckAdapter, TypeCheckContext} from '../../typecheck/api';\n import {ExtendedTemplateChecker} from '../../typecheck/extended/api';\n import {getSourceFile, isExported} from '../../util/src/typescript';\n@@ -118,7 +119,7 @@ export class TraitCompiler implements ProgramTypeCheckAdapter {\n   private analyze(sf: ts.SourceFile, preanalyze: true): Promise<void>|undefined;\n   private analyze(sf: ts.SourceFile, preanalyze: boolean): Promise<void>|undefined {\n     // We shouldn't analyze declaration files.\n-    if (sf.isDeclarationFile) {\n+    if (sf.isDeclarationFile || isShim(sf)) {\n       return undefined;\n     }\n \n@@ -153,6 +154,13 @@ export class TraitCompiler implements ProgramTypeCheckAdapter {\n \n     visit(sf);\n \n+    if (!this.fileToClasses.has(sf)) {\n+      // If no traits were detected in the source file we record the source file itself to not have\n+      // any traits, such that analysis of the source file can be skipped during incremental\n+      // rebuilds.\n+      this.filesWithoutTraits.add(sf);\n+    }\n+\n     if (preanalyze && promises.length > 0) {\n       return Promise.all(promises).then(() => undefined as void);\n     } else {"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 10,
        "deletions": 1
    }
}