{
    "author": "sonukapoor",
    "message": "test(docs-infra): add missing unit tests for backoff example (#38896)\n\nThis commit adds the missing unit test for the backoff example.\n\nPR Close #38896",
    "sha": "8422633b8ab070d3321b7f9d557677773695e8aa",
    "files": [
        {
            "sha": "0390a476d1346cd7e194467bf7b19242ce120e98",
            "filename": "aio/content/examples/practical-observable-usage/src/backoff.spec.ts",
            "status": "added",
            "additions": 70,
            "deletions": 0,
            "changes": 70,
            "blob_url": "https://github.com/angular/angular/blob/8422633b8ab070d3321b7f9d557677773695e8aa/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Fbackoff.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8422633b8ab070d3321b7f9d557677773695e8aa/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Fbackoff.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Fbackoff.spec.ts?ref=8422633b8ab070d3321b7f9d557677773695e8aa",
            "patch": "@@ -0,0 +1,70 @@\n+import { interval } from 'rxjs';\n+import { tap } from 'rxjs/operators';\n+import { backoff } from './backoff';\n+\n+describe('backoff()', () => {\n+  beforeEach(() => jasmine.clock().install());\n+  afterEach(() => jasmine.clock().uninstall());\n+\n+  it('should retry in case of error', () => {\n+    const mockConsole = {log: jasmine.createSpy('log')};\n+    const source = interval(10).pipe(\n+      tap(i => {\n+        if (i > 0) {\n+          throw new Error('Test error');\n+        }\n+      }),\n+      backoff(3, 100),\n+    );\n+    source.subscribe({\n+      next: v => mockConsole.log(`Emitted: ${v}`),\n+      error: e => mockConsole.log(`Errored: ${e.message || e}`),\n+      complete: () => mockConsole.log('Completed'),\n+    });\n+\n+    // Initial try:\n+    // Errors on second emission and schedules retrying (with delay).\n+    jasmine.clock().tick(10);\n+    expect(mockConsole.log.calls.allArgs()).toEqual([['Emitted: 0']]);\n+\n+    jasmine.clock().tick(10);\n+    expect(mockConsole.log.calls.allArgs()).toEqual([['Emitted: 0']]);\n+    mockConsole.log.calls.reset();\n+\n+    // First re-attempt after 100ms:\n+    // Errors again on second emission and schedules retrying (with larger delay).\n+    jasmine.clock().tick(100);\n+    expect(mockConsole.log).not.toHaveBeenCalled();\n+\n+    jasmine.clock().tick(10);\n+    expect(mockConsole.log.calls.allArgs()).toEqual([['Emitted: 0']]);\n+\n+    jasmine.clock().tick(10);\n+    expect(mockConsole.log.calls.allArgs()).toEqual([['Emitted: 0']]);\n+    mockConsole.log.calls.reset();\n+\n+    // Second re-attempt after 400ms:\n+    // Errors again on second emission and schedules retrying (with even larger delay).\n+    jasmine.clock().tick(400);\n+    expect(mockConsole.log).not.toHaveBeenCalled();\n+\n+    jasmine.clock().tick(10);\n+    expect(mockConsole.log.calls.allArgs()).toEqual([['Emitted: 0']]);\n+\n+    jasmine.clock().tick(10);\n+    expect(mockConsole.log.calls.allArgs()).toEqual([['Emitted: 0']]);\n+    mockConsole.log.calls.reset();\n+\n+    // Third re-attempt after 900ms:\n+    // Errors again on second emission and gives up (no retrying).\n+    jasmine.clock().tick(900);\n+    expect(mockConsole.log).not.toHaveBeenCalled();\n+\n+    jasmine.clock().tick(10);\n+    expect(mockConsole.log.calls.allArgs()).toEqual([['Emitted: 0']]);\n+    mockConsole.log.calls.reset();\n+\n+    jasmine.clock().tick(10);\n+    expect(mockConsole.log.calls.allArgs()).toEqual([['Errored: Test error']]);\n+  });\n+});"
        },
        {
            "sha": "68d724d0972cabd8cc7ea6f8bc0044d4a075d188",
            "filename": "aio/content/examples/practical-observable-usage/src/backoff.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 6,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/8422633b8ab070d3321b7f9d557677773695e8aa/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Fbackoff.ts",
            "raw_url": "https://github.com/angular/angular/raw/8422633b8ab070d3321b7f9d557677773695e8aa/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Fbackoff.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fpractical-observable-usage%2Fsrc%2Fbackoff.ts?ref=8422633b8ab070d3321b7f9d557677773695e8aa",
            "patch": "@@ -1,9 +1,10 @@\n-// TODO: Add unit tests for this file.\n+// #docplaster\n+// #docregion\n import { of, pipe, range, throwError, timer, zip } from 'rxjs';\n import { ajax } from 'rxjs/ajax';\n import { map, mergeMap, retryWhen } from 'rxjs/operators';\n \n-function backoff(maxTries, delay) {\n+export function backoff(maxTries, delay) {\n   return pipe(\n     retryWhen(attempts =>\n       zip(range(1, maxTries + 1), attempts).pipe(\n@@ -15,10 +16,17 @@ function backoff(maxTries, delay) {\n   );\n }\n \n+// #enddocregion\n+/*\n+  This function declaration is necessary to ensure that it does not get called\n+  when running the unit tests. It will not get rendered into the docs.\n+  The indentation needs to start in the leftmost level position as well because of how\n+  the docplaster combines the different regions together.\n+*/\n+function docRegionAjaxCall() {\n+// #docregion\n ajax('/api/endpoint')\n   .pipe(backoff(3, 250))\n-  .subscribe(data => handleData(data));\n-\n-function handleData(data) {\n-  // ...\n+  .subscribe(function handleData(data) { /* ... */ });\n+// #enddocregion\n }"
        }
    ],
    "stats": {
        "total": 90,
        "additions": 84,
        "deletions": 6
    }
}