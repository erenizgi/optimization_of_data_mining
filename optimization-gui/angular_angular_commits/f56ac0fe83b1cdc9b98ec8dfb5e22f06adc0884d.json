{
    "author": "dario-piotrowicz",
    "message": "refactor(animations): improve _finalKeyframe non-null assertion (#44458)\n\ninstead of declaring the WebAnimationsPlayer's _finalKeyframe\nfield with a non-null assertion, declare it as optional field\nand use a non-null assertion only when it is being used in the\nbeforeDestroy function\n\nrelates to #24571\n\nPR Close #44458",
    "sha": "f56ac0fe83b1cdc9b98ec8dfb5e22f06adc0884d",
    "files": [
        {
            "sha": "89cc3bff3638cee206cc338121668d6d30d8cd8e",
            "filename": "packages/animations/browser/src/render/web_animations/web_animations_player.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/f56ac0fe83b1cdc9b98ec8dfb5e22f06adc0884d/packages%2Fanimations%2Fbrowser%2Fsrc%2Frender%2Fweb_animations%2Fweb_animations_player.ts",
            "raw_url": "https://github.com/angular/angular/raw/f56ac0fe83b1cdc9b98ec8dfb5e22f06adc0884d/packages%2Fanimations%2Fbrowser%2Fsrc%2Frender%2Fweb_animations%2Fweb_animations_player.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fanimations%2Fbrowser%2Fsrc%2Frender%2Fweb_animations%2Fweb_animations_player.ts?ref=f56ac0fe83b1cdc9b98ec8dfb5e22f06adc0884d",
            "patch": "@@ -22,8 +22,7 @@ export class WebAnimationsPlayer implements AnimationPlayer {\n   private _finished = false;\n   private _started = false;\n   private _destroyed = false;\n-  // TODO(issue/24571): remove '!'.\n-  private _finalKeyframe!: {[key: string]: string|number};\n+  private _finalKeyframe?: {[key: string]: string|number};\n \n   // TODO(issue/24571): remove '!'.\n   public readonly domPlayer!: DOMAnimation;\n@@ -173,10 +172,13 @@ export class WebAnimationsPlayer implements AnimationPlayer {\n   beforeDestroy() {\n     const styles: {[key: string]: string|number} = {};\n     if (this.hasStarted()) {\n-      Object.keys(this._finalKeyframe).forEach(prop => {\n+      // note: this code is invoked only when the `play` function was called prior to this\n+      // (thus `hasStarted` returns true), this implies that the code that initializes\n+      // `_finalKeyframe` has also been executed and the non-null assertion can be safely used here\n+      const finalKeyframe = this._finalKeyframe!;\n+      Object.keys(finalKeyframe).forEach(prop => {\n         if (prop != 'offset') {\n-          styles[prop] =\n-              this._finished ? this._finalKeyframe[prop] : computeStyle(this.element, prop);\n+          styles[prop] = this._finished ? finalKeyframe[prop] : computeStyle(this.element, prop);\n         }\n       });\n     }"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 7,
        "deletions": 5
    }
}