{
    "author": "JoostK",
    "message": "fix(compiler-cli): expose the linker as a Babel plugin (#41918)\n\nThis allows the linker to be used as a true Babel plugin. In a Babel\nconfiguration file, include the linker as follows:\n\n```js\n{\n  plugins: [\n    '@angular/compiler-cli/linker/babel',\n  ]\n}\n```\n\nor, if you need to specify configuration options:\n\n```js\n{\n  plugins: [\n    ['@angular/compiler-cli/linker/babel', {linkerJitMode: true}],\n  ]\n}\n```\n\nPR Close #41918",
    "sha": "6eafaa7b5e2b85e53b4213f9f7756474609a0fa3",
    "files": [
        {
            "sha": "6b6132e7fe74419cca8853fdd22d296f5ac466f5",
            "filename": "packages/compiler-cli/linker/babel/index.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/6eafaa7b5e2b85e53b4213f9f7756474609a0fa3/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/6eafaa7b5e2b85e53b4213f9f7756474609a0fa3/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Findex.ts?ref=6eafaa7b5e2b85e53b4213f9f7756474609a0fa3",
            "patch": "@@ -5,4 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-export {createEs2015LinkerPlugin} from './src/es2015_linker_plugin';\n\\ No newline at end of file\n+import {defaultLinkerPlugin} from './src/babel_plugin';\n+\n+export {createEs2015LinkerPlugin} from './src/es2015_linker_plugin';\n+export default defaultLinkerPlugin;"
        },
        {
            "sha": "68013ee0d1da5ed92362d8d43893988211030947",
            "filename": "packages/compiler-cli/linker/babel/src/babel_plugin.ts",
            "status": "added",
            "additions": 39,
            "deletions": 0,
            "changes": 39,
            "blob_url": "https://github.com/angular/angular/blob/6eafaa7b5e2b85e53b4213f9f7756474609a0fa3/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Fsrc%2Fbabel_plugin.ts",
            "raw_url": "https://github.com/angular/angular/raw/6eafaa7b5e2b85e53b4213f9f7756474609a0fa3/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Fsrc%2Fbabel_plugin.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Fsrc%2Fbabel_plugin.ts?ref=6eafaa7b5e2b85e53b4213f9f7756474609a0fa3",
            "patch": "@@ -0,0 +1,39 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {ConfigAPI, PluginObj} from '@babel/core';\n+\n+import {NodeJSFileSystem} from '../../../src/ngtsc/file_system';\n+import {ConsoleLogger, LogLevel} from '../../../src/ngtsc/logging';\n+import {LinkerOptions} from '../../src/file_linker/linker_options';\n+\n+import {createEs2015LinkerPlugin} from './es2015_linker_plugin';\n+\n+/**\n+ * This is the Babel plugin definition that is provided as a default export from the package, such\n+ * that the plugin can be used using the module specifier of the package. This is the recommended\n+ * way of integrating the Angular Linker into a build pipeline other than the Angular CLI.\n+ *\n+ * When the module specifier `@angular/compiler-cli/linker/babel` is used as a plugin in a Babel\n+ * configuration, Babel invokes this function (by means of the default export) to create the plugin\n+ * instance according to the provided options.\n+ *\n+ * The linker plugin that is created uses the native NodeJS filesystem APIs to interact with the\n+ * filesystem. Any logging output is printed to the console.\n+ *\n+ * @param api Provides access to the Babel environment that is configuring this plugin.\n+ * @param options The plugin options that have been configured.\n+ */\n+export function defaultLinkerPlugin(api: ConfigAPI, options: Partial<LinkerOptions>): PluginObj {\n+  api.assertVersion(7);\n+\n+  return createEs2015LinkerPlugin({\n+    ...options,\n+    fileSystem: new NodeJSFileSystem(),\n+    logger: new ConsoleLogger(LogLevel.info),\n+  });\n+}"
        },
        {
            "sha": "781cd3b868593e9712ae6f92e1b315e5b1a02283",
            "filename": "packages/compiler-cli/linker/babel/test/babel_plugin_spec.ts",
            "status": "added",
            "additions": 56,
            "deletions": 0,
            "changes": 56,
            "blob_url": "https://github.com/angular/angular/blob/6eafaa7b5e2b85e53b4213f9f7756474609a0fa3/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Ftest%2Fbabel_plugin_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/6eafaa7b5e2b85e53b4213f9f7756474609a0fa3/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Ftest%2Fbabel_plugin_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fbabel%2Ftest%2Fbabel_plugin_spec.ts?ref=6eafaa7b5e2b85e53b4213f9f7756474609a0fa3",
            "patch": "@@ -0,0 +1,56 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {transformSync} from '@babel/core';\n+\n+describe('default babel plugin entry-point', () => {\n+  it('should work as a Babel plugin using the module specifier', () => {\n+    const result = transformSync(\n+        `\n+        import * as i0 from \"@angular/core\";\n+\n+        export class MyMod {}\n+        export class MyComponent {}\n+\n+        MyMod.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyMod, declarations: [MyComponent] });\n+       `,\n+        {\n+          plugins: [\n+            '@angular/compiler-cli/linker/babel',\n+          ],\n+          filename: 'test.js',\n+        })!;\n+\n+    expect(result).not.toBeNull();\n+    expect(result.code).not.toContain('ɵɵngDeclareNgModule');\n+    expect(result.code).toContain('i0.ɵɵdefineNgModule');\n+    expect(result.code).not.toMatch(/declarations:\\s*\\[MyComponent]/);\n+  });\n+\n+  it('should be configurable', () => {\n+    const result = transformSync(\n+        `\n+        import * as i0 from \"@angular/core\";\n+\n+        export class MyMod {}\n+        export class MyComponent {}\n+\n+        MyMod.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyMod, declarations: [MyComponent] });\n+       `,\n+        {\n+          plugins: [\n+            ['@angular/compiler-cli/linker/babel', {linkerJitMode: true}],\n+          ],\n+          filename: 'test.js',\n+        })!;\n+\n+    expect(result).not.toBeNull();\n+    expect(result.code).not.toContain('ɵɵngDeclareNgModule');\n+    expect(result.code).toContain('i0.ɵɵdefineNgModule');\n+    expect(result.code).toMatch(/declarations:\\s*\\[MyComponent]/);\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 100,
        "additions": 99,
        "deletions": 1
    }
}