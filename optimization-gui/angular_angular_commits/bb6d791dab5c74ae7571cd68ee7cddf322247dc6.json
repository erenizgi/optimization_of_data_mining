{
    "author": "petebacondarwin",
    "message": "refactor(localize): update to use new file-system interfaces (#40281)\n\nNow that `ReadonlyFileSystem` and `PathManipulation` interfaces are\navailable, this commit updates the localize package to use these more\nfocussed interfaces.\n\nPR Close #40281",
    "sha": "bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
    "files": [
        {
            "sha": "932bda6ed7d907c24ff20152bf3d6b1d6a624ced",
            "filename": "packages/localize/src/tools/src/extract/duplicates.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fduplicates.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fduplicates.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fduplicates.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {AbsoluteFsPath, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵMessageId, ɵParsedMessage} from '@angular/localize';\n \n import {DiagnosticHandlingStrategy, Diagnostics} from '../diagnostics';\n@@ -17,7 +17,7 @@ import {serializeLocationPosition} from '../source_file_utils';\n  * object (as necessary).\n  */\n export function checkDuplicateMessages(\n-    fs: FileSystem, messages: ɵParsedMessage[],\n+    fs: PathManipulation, messages: ɵParsedMessage[],\n     duplicateMessageHandling: DiagnosticHandlingStrategy, basePath: AbsoluteFsPath): Diagnostics {\n   const diagnostics = new Diagnostics();\n   if (duplicateMessageHandling === 'ignore') return diagnostics;\n@@ -47,7 +47,7 @@ export function checkDuplicateMessages(\n  * Serialize the given `message` object into a string.\n  */\n function serializeMessage(\n-    fs: FileSystem, basePath: AbsoluteFsPath, message: ɵParsedMessage): string {\n+    fs: PathManipulation, basePath: AbsoluteFsPath, message: ɵParsedMessage): string {\n   if (message.location === undefined) {\n     return `   - \"${message.text}\"`;\n   } else {"
        },
        {
            "sha": "45144073a0dc13ba7138ff565172cf050e82953d",
            "filename": "packages/localize/src/tools/src/extract/extraction.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fextraction.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fextraction.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fextraction.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {AbsoluteFsPath, ReadonlyFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {Logger} from '@angular/compiler-cli/src/ngtsc/logging';\n import {SourceFile, SourceFileLoader} from '@angular/compiler-cli/src/ngtsc/sourcemaps';\n import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n@@ -33,7 +33,7 @@ export class MessageExtractor {\n   private loader: SourceFileLoader;\n \n   constructor(\n-      private fs: FileSystem, private logger: Logger,\n+      private fs: ReadonlyFileSystem, private logger: Logger,\n       {basePath, useSourceMaps = true, localizeName = '$localize'}: ExtractionOptions) {\n     this.basePath = basePath;\n     this.useSourceMaps = useSourceMaps;"
        },
        {
            "sha": "6ece99292c69f97d04ca65084f2b8035f56ba5a0",
            "filename": "packages/localize/src/tools/src/extract/main.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fmain.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fmain.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fmain.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -6,7 +6,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {setFileSystem, NodeJSFileSystem, AbsoluteFsPath, FileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {setFileSystem, NodeJSFileSystem, AbsoluteFsPath, FileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ConsoleLogger, Logger, LogLevel} from '@angular/compiler-cli/src/ngtsc/logging';\n import {ɵParsedMessage} from '@angular/localize';\n import * as glob from 'glob';\n@@ -214,7 +214,7 @@ export function extractTranslations({\n \n export function getSerializer(\n     format: string, sourceLocale: string, rootPath: AbsoluteFsPath, useLegacyIds: boolean,\n-    formatOptions: FormatOptions = {}, fs: FileSystem): TranslationSerializer {\n+    formatOptions: FormatOptions = {}, fs: PathManipulation): TranslationSerializer {\n   switch (format) {\n     case 'xlf':\n     case 'xlif':"
        },
        {
            "sha": "70e53e7ba5b85efc47a140348aac8bcf7424dacf",
            "filename": "packages/localize/src/tools/src/extract/source_files/es2015_extract_plugin.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes2015_extract_plugin.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes2015_extract_plugin.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes2015_extract_plugin.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,15 +5,15 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {FileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵParsedMessage, ɵparseMessage} from '@angular/localize';\n import {NodePath, PluginObj} from '@babel/core';\n import {TaggedTemplateExpression} from '@babel/types';\n \n import {getLocation, isGlobalIdentifier, isNamedIdentifier, unwrapExpressionsFromTemplateLiteral, unwrapMessagePartsFromTemplateLiteral} from '../../source_file_utils';\n \n export function makeEs2015ExtractPlugin(\n-    fs: FileSystem, messages: ɵParsedMessage[], localizeName = '$localize'): PluginObj {\n+    fs: PathManipulation, messages: ɵParsedMessage[], localizeName = '$localize'): PluginObj {\n   return {\n     visitor: {\n       TaggedTemplateExpression(path: NodePath<TaggedTemplateExpression>) {"
        },
        {
            "sha": "732a102636349c2f49f3d9113b5ce09d97feea73",
            "filename": "packages/localize/src/tools/src/extract/source_files/es5_extract_plugin.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes5_extract_plugin.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes5_extract_plugin.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Fsource_files%2Fes5_extract_plugin.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,15 +5,15 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {FileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵParsedMessage, ɵparseMessage} from '@angular/localize';\n import {NodePath, PluginObj} from '@babel/core';\n import {CallExpression} from '@babel/types';\n \n import {getLocation, isGlobalIdentifier, isNamedIdentifier, unwrapMessagePartsFromLocalizeCall, unwrapSubstitutionsFromLocalizeCall} from '../../source_file_utils';\n \n export function makeEs5ExtractPlugin(\n-    fs: FileSystem, messages: ɵParsedMessage[], localizeName = '$localize'): PluginObj {\n+    fs: PathManipulation, messages: ɵParsedMessage[], localizeName = '$localize'): PluginObj {\n   return {\n     visitor: {\n       CallExpression(callPath: NodePath<CallExpression>) {"
        },
        {
            "sha": "765512a439c06d42156a42af39e7bb94984b5cfc",
            "filename": "packages/localize/src/tools/src/extract/translation_files/arb_translation_serializer.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Farb_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Farb_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Farb_translation_serializer.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,9 +5,8 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {AbsoluteFsPath, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n-import {ArbJsonObject, ArbLocation, ArbMetadata} from '../../translate/translation_files/translation_parsers/arb_translation_parser';\n import {TranslationSerializer} from './translation_serializer';\n import {consolidateMessages, hasLocation} from './utils';\n \n@@ -45,7 +44,8 @@ import {consolidateMessages, hasLocation} from './utils';\n  */\n export class ArbTranslationSerializer implements TranslationSerializer {\n   constructor(\n-      private sourceLocale: string, private basePath: AbsoluteFsPath, private fs: FileSystem) {}\n+      private sourceLocale: string, private basePath: AbsoluteFsPath,\n+      private fs: PathManipulation) {}\n \n   serialize(messages: ɵParsedMessage[]): string {\n     const messageGroups = consolidateMessages(messages, message => getMessageId(message));"
        },
        {
            "sha": "a71e211e40fab7084fe82abc40614a30052ea9c3",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff1_translation_serializer.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {AbsoluteFsPath, getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n \n import {FormatOptions, validateOptions} from './format_options';\n@@ -29,7 +29,7 @@ const LEGACY_XLIFF_MESSAGE_LENGTH = 40;\n export class Xliff1TranslationSerializer implements TranslationSerializer {\n   constructor(\n       private sourceLocale: string, private basePath: AbsoluteFsPath, private useLegacyIds: boolean,\n-      private formatOptions: FormatOptions = {}, private fs: FileSystem = getFileSystem()) {\n+      private formatOptions: FormatOptions = {}, private fs: PathManipulation = getFileSystem()) {\n     validateOptions('Xliff1TranslationSerializer', [['xml:space', ['preserve']]], formatOptions);\n   }\n "
        },
        {
            "sha": "a5a75f7ec585889060688dfb53989f60e3679217",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff2_translation_serializer.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {AbsoluteFsPath, getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n \n import {FormatOptions, validateOptions} from './format_options';\n@@ -29,7 +29,7 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n   private currentPlaceholderId = 0;\n   constructor(\n       private sourceLocale: string, private basePath: AbsoluteFsPath, private useLegacyIds: boolean,\n-      private formatOptions: FormatOptions = {}, private fs: FileSystem = getFileSystem()) {\n+      private formatOptions: FormatOptions = {}, private fs: PathManipulation = getFileSystem()) {\n     validateOptions('Xliff1TranslationSerializer', [['xml:space', ['preserve']]], formatOptions);\n   }\n "
        },
        {
            "sha": "8cb33981c31dfef35c5dd7801883af24b4ef419e",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xmb_translation_serializer.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {AbsoluteFsPath, getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n \n import {extractIcuPlaceholders} from './icu_parsing';\n@@ -24,7 +24,7 @@ import {XmlFile} from './xml_file';\n export class XmbTranslationSerializer implements TranslationSerializer {\n   constructor(\n       private basePath: AbsoluteFsPath, private useLegacyIds: boolean,\n-      private fs: FileSystem = getFileSystem()) {}\n+      private fs: PathManipulation = getFileSystem()) {}\n \n   serialize(messages: ɵParsedMessage[]): string {\n     const messageGroups = consolidateMessages(messages, message => this.getMessageId(message));"
        },
        {
            "sha": "e0814955e8502fe914f6d369ae041e2c7fde3f22",
            "filename": "packages/localize/src/tools/src/source_file_utils.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fsource_file_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fsource_file_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fsource_file_utils.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {AbsoluteFsPath, getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵisMissingTranslationError, ɵmakeTemplateObject, ɵParsedTranslation, ɵSourceLocation, ɵtranslate} from '@angular/localize';\n import {NodePath} from '@babel/traverse';\n import * as t from '@babel/types';\n@@ -74,7 +74,7 @@ export function buildLocalizeReplacement(\n  */\n export function unwrapMessagePartsFromLocalizeCall(\n     call: NodePath<t.CallExpression>,\n-    fs: FileSystem = getFileSystem(),\n+    fs: PathManipulation = getFileSystem(),\n     ): [TemplateStringsArray, (ɵSourceLocation | undefined)[]] {\n   let cooked = call.get('arguments')[0];\n \n@@ -160,7 +160,7 @@ export function unwrapMessagePartsFromLocalizeCall(\n  */\n export function unwrapSubstitutionsFromLocalizeCall(\n     call: NodePath<t.CallExpression>,\n-    fs: FileSystem = getFileSystem()): [t.Expression[], (ɵSourceLocation | undefined)[]] {\n+    fs: PathManipulation = getFileSystem()): [t.Expression[], (ɵSourceLocation | undefined)[]] {\n   const expressions = call.get('arguments').splice(1);\n   if (!isArrayOfExpressions(expressions)) {\n     const badExpression = expressions.find(expression => !expression.isExpression())!;\n@@ -182,8 +182,8 @@ export function unwrapSubstitutionsFromLocalizeCall(\n  * @publicApi used by CLI\n  */\n export function unwrapMessagePartsFromTemplateLiteral(\n-    elements: NodePath<t.TemplateElement>[],\n-    fs: FileSystem = getFileSystem()): [TemplateStringsArray, (ɵSourceLocation | undefined)[]] {\n+    elements: NodePath<t.TemplateElement>[], fs: PathManipulation = getFileSystem()):\n+    [TemplateStringsArray, (ɵSourceLocation | undefined)[]] {\n   const cooked = elements.map(q => {\n     if (q.node.value.cooked === undefined) {\n       throw new BabelParseError(\n@@ -207,7 +207,7 @@ export function unwrapMessagePartsFromTemplateLiteral(\n  */\n export function unwrapExpressionsFromTemplateLiteral(\n     quasi: NodePath<t.TemplateLiteral>,\n-    fs: FileSystem = getFileSystem()): [t.Expression[], (ɵSourceLocation | undefined)[]] {\n+    fs: PathManipulation = getFileSystem()): [t.Expression[], (ɵSourceLocation | undefined)[]] {\n   return [quasi.node.expressions, quasi.get('expressions').map(e => getLocation(fs, e))];\n }\n \n@@ -235,7 +235,7 @@ export function wrapInParensIfNecessary(expression: t.Expression): t.Expression\n  */\n export function unwrapStringLiteralArray(\n     array: NodePath<t.Expression>,\n-    fs: FileSystem = getFileSystem()): [string[], (ɵSourceLocation | undefined)[]] {\n+    fs: PathManipulation = getFileSystem()): [string[], (ɵSourceLocation | undefined)[]] {\n   if (!isStringLiteralArray(array.node)) {\n     throw new BabelParseError(\n         array.node, 'Unexpected messageParts for `$localize` (expected an array of strings).');\n@@ -400,7 +400,7 @@ export function buildCodeFrameError(path: NodePath, e: BabelParseError): string\n }\n \n export function getLocation(\n-    fs: FileSystem, startPath: NodePath, endPath?: NodePath): ɵSourceLocation|undefined {\n+    fs: PathManipulation, startPath: NodePath, endPath?: NodePath): ɵSourceLocation|undefined {\n   const startLocation = startPath.node.loc;\n   const file = getFileFromPath(fs, startPath);\n   if (!startLocation || !file) {\n@@ -425,7 +425,7 @@ export function serializeLocationPosition(location: ɵSourceLocation): string {\n   return `${location.start.line + 1}${endLineString}`;\n }\n \n-function getFileFromPath(fs: FileSystem, path: NodePath|undefined): AbsoluteFsPath|null {\n+function getFileFromPath(fs: PathManipulation, path: NodePath|undefined): AbsoluteFsPath|null {\n   const opts = path?.hub.file.opts;\n   return opts?.filename ?\n       fs.resolve(opts.generatorOpts.sourceRoot ?? opts.cwd, fs.relative(opts.cwd, opts.filename)) :"
        },
        {
            "sha": "be1f3513618f60cb8c2601736f3bc0162c40ce90",
            "filename": "packages/localize/src/tools/src/translate/source_files/es2015_translate_plugin.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fes2015_translate_plugin.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fes2015_translate_plugin.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fes2015_translate_plugin.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,13 +5,12 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵParsedTranslation} from '@angular/localize';\n import {NodePath, PluginObj} from '@babel/core';\n import {TaggedTemplateExpression} from '@babel/types';\n \n import {Diagnostics} from '../../diagnostics';\n-\n import {buildCodeFrameError, buildLocalizeReplacement, isBabelParseError, isLocalize, translate, TranslatePluginOptions, unwrapMessagePartsFromTemplateLiteral} from '../../source_file_utils';\n \n /**\n@@ -23,7 +22,7 @@ import {buildCodeFrameError, buildLocalizeReplacement, isBabelParseError, isLoca\n export function makeEs2015TranslatePlugin(\n     diagnostics: Diagnostics, translations: Record<string, ɵParsedTranslation>,\n     {missingTranslation = 'error', localizeName = '$localize'}: TranslatePluginOptions = {},\n-    fs: FileSystem = getFileSystem()): PluginObj {\n+    fs: PathManipulation = getFileSystem()): PluginObj {\n   return {\n     visitor: {\n       TaggedTemplateExpression(path: NodePath<TaggedTemplateExpression>) {"
        },
        {
            "sha": "6a98ff8729402e3ac031fc997038f700cad8ef24",
            "filename": "packages/localize/src/tools/src/translate/source_files/es5_translate_plugin.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fes5_translate_plugin.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fes5_translate_plugin.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Fsource_files%2Fes5_translate_plugin.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,13 +5,12 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵParsedTranslation} from '@angular/localize';\n import {NodePath, PluginObj} from '@babel/core';\n import {CallExpression} from '@babel/types';\n \n import {Diagnostics} from '../../diagnostics';\n-\n import {buildCodeFrameError, buildLocalizeReplacement, isBabelParseError, isLocalize, translate, TranslatePluginOptions, unwrapMessagePartsFromLocalizeCall, unwrapSubstitutionsFromLocalizeCall} from '../../source_file_utils';\n \n /**\n@@ -23,7 +22,7 @@ import {buildCodeFrameError, buildLocalizeReplacement, isBabelParseError, isLoca\n export function makeEs5TranslatePlugin(\n     diagnostics: Diagnostics, translations: Record<string, ɵParsedTranslation>,\n     {missingTranslation = 'error', localizeName = '$localize'}: TranslatePluginOptions = {},\n-    fs: FileSystem = getFileSystem()): PluginObj {\n+    fs: PathManipulation = getFileSystem()): PluginObj {\n   return {\n     visitor: {\n       CallExpression(callPath: NodePath<CallExpression>) {"
        },
        {
            "sha": "9a9254a6bcda83578849bb4f09a84ef2d43d3fb8",
            "filename": "packages/localize/src/tools/src/translate/translation_files/translation_loader.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_loader.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_loader.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslation_files%2Ftranslation_loader.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {AbsoluteFsPath, ReadonlyFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {DiagnosticHandlingStrategy, Diagnostics} from '../../diagnostics';\n import {TranslationBundle} from '../translator';\n \n@@ -16,7 +16,7 @@ import {ParseAnalysis, TranslationParser} from './translation_parsers/translatio\n  */\n export class TranslationLoader {\n   constructor(\n-      private fs: FileSystem, private translationParsers: TranslationParser<any>[],\n+      private fs: ReadonlyFileSystem, private translationParsers: TranslationParser<any>[],\n       private duplicateTranslation: DiagnosticHandlingStrategy,\n       /** @deprecated */ private diagnostics?: Diagnostics) {}\n "
        },
        {
            "sha": "dd5465a8d7bebf0f52a0eca3dc822b303de41fd4",
            "filename": "packages/localize/src/tools/src/translate/translator.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslator.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Ftranslate%2Ftranslator.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {AbsoluteFsPath, FileSystem, PathSegment} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {AbsoluteFsPath, PathSegment, ReadonlyFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {ɵMessageId, ɵParsedTranslation} from '@angular/localize';\n \n import {Diagnostics} from '../diagnostics';\n@@ -64,7 +64,7 @@ export interface TranslationHandler {\n  */\n export class Translator {\n   constructor(\n-      private fs: FileSystem, private resourceHandlers: TranslationHandler[],\n+      private fs: ReadonlyFileSystem, private resourceHandlers: TranslationHandler[],\n       private diagnostics: Diagnostics) {}\n \n   translateFiles("
        },
        {
            "sha": "e93925dffa0c42394e5a6b01929835acc36db12d",
            "filename": "packages/localize/src/tools/test/extract/translation_files/arb_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Farb_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Farb_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Farb_translation_serializer_spec.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFrom, FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {absoluteFrom, getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import {ɵParsedMessage} from '@angular/localize';\n \n@@ -14,7 +14,7 @@ import {ArbTranslationSerializer} from '../../../src/extract/translation_files/a\n import {location, mockMessage} from './mock_message';\n \n runInEachFileSystem(() => {\n-  let fs: FileSystem;\n+  let fs: PathManipulation;\n   describe('ArbTranslationSerializer', () => {\n     beforeEach(() => {\n       fs = getFileSystem();"
        },
        {
            "sha": "9570e6e376c96e3addd2742e2c372c1b1d820113",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xmb_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxmb_translation_serializer_spec.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFrom, FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {absoluteFrom, getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import {ɵParsedMessage, ɵSourceLocation} from '@angular/localize';\n \n@@ -14,7 +14,7 @@ import {XmbTranslationSerializer} from '../../../src/extract/translation_files/x\n import {location, mockMessage} from './mock_message';\n \n runInEachFileSystem(() => {\n-  let fs: FileSystem;\n+  let fs: PathManipulation;\n   beforeEach(() => fs = getFileSystem());\n   describe('XmbTranslationSerializer', () => {\n     [false, true].forEach(useLegacyIds => {"
        },
        {
            "sha": "1f8421fcd70da3ac09ce83a176231ec2eec86c7b",
            "filename": "packages/localize/src/tools/test/source_file_utils_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fsource_file_utils_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fsource_file_utils_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fsource_file_utils_spec.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {absoluteFrom, FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n+import {absoluteFrom, getFileSystem, PathManipulation} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import {ɵmakeTemplateObject} from '@angular/localize';\n import {NodePath, TransformOptions, transformSync} from '@babel/core';\n@@ -16,7 +16,7 @@ import {Expression, Identifier, TaggedTemplateExpression, ExpressionStatement, C\n import {isGlobalIdentifier, isNamedIdentifier, isStringLiteralArray, isArrayOfExpressions, unwrapStringLiteralArray, unwrapMessagePartsFromLocalizeCall, wrapInParensIfNecessary, buildLocalizeReplacement, unwrapSubstitutionsFromLocalizeCall, unwrapMessagePartsFromTemplateLiteral, getLocation} from '../src/source_file_utils';\n \n runInEachFileSystem(() => {\n-  let fs: FileSystem;\n+  let fs: PathManipulation;\n   beforeEach(() => fs = getFileSystem());\n   describe('utils', () => {\n     describe('isNamedIdentifier()', () => {"
        },
        {
            "sha": "b224924511384415ccefa96681c93878604642a0",
            "filename": "packages/localize/src/tools/test/translate/source_files/es2015_translate_plugin_spec.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fes2015_translate_plugin_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fes2015_translate_plugin_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fes2015_translate_plugin_spec.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,6 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import {ɵcomputeMsgId, ɵparseTranslation} from '@angular/localize';\n import {ɵParsedTranslation} from '@angular/localize/private';\n@@ -16,8 +15,6 @@ import {TranslatePluginOptions} from '../../../src/source_file_utils';\n import {makeEs2015TranslatePlugin} from '../../../src/translate/source_files/es2015_translate_plugin';\n \n runInEachFileSystem(() => {\n-  let fs: FileSystem;\n-  beforeEach(() => fs = getFileSystem());\n   describe('makeEs2015Plugin', () => {\n     describe('(no translations)', () => {\n       it('should transform `$localize` tags with binary expression', () => {"
        },
        {
            "sha": "c89294b5e8b44a7e9eb6a204954e9ba2b1da023a",
            "filename": "packages/localize/src/tools/test/translate/source_files/es5_translate_plugin_spec.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fes5_translate_plugin_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/bb6d791dab5c74ae7571cd68ee7cddf322247dc6/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fes5_translate_plugin_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Ftranslate%2Fsource_files%2Fes5_translate_plugin_spec.ts?ref=bb6d791dab5c74ae7571cd68ee7cddf322247dc6",
            "patch": "@@ -5,7 +5,6 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {FileSystem, getFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system';\n import {runInEachFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import {ɵcomputeMsgId, ɵparseTranslation} from '@angular/localize';\n import {ɵParsedTranslation} from '@angular/localize/private';\n@@ -16,8 +15,6 @@ import {TranslatePluginOptions} from '../../../src/source_file_utils';\n import {makeEs5TranslatePlugin} from '../../../src/translate/source_files/es5_translate_plugin';\n \n runInEachFileSystem(() => {\n-  let fs: FileSystem;\n-  beforeEach(() => fs = getFileSystem());\n   describe('makeEs5Plugin', () => {\n     describe('(no translations)', () => {\n       it('should transform `$localize` calls with binary expression', () => {"
        }
    ],
    "stats": {
        "total": 94,
        "additions": 43,
        "deletions": 51
    }
}