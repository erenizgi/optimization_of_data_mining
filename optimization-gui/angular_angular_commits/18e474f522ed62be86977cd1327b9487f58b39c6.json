{
    "author": "rifler",
    "message": "fix(zone.js): zone.js toString patch should check typeof Promise is function (#38350)\n\nClose #38361\n\nzone.js monkey patch toString, and check the instance is `Promise` or not by using `instanceof Promise`,\nsometimes when Promise is not available, the `instanceof` operation fails\nand throw `TypeError: Right-hand side of 'instanceof' is not an object`\nthis PR check `typeof Promise` equals to function or not to prevent the error.\n\nPR Close #38350",
    "sha": "18e474f522ed62be86977cd1327b9487f58b39c6",
    "files": [
        {
            "sha": "7722623c7a24061763db0384b3c04eed19215827",
            "filename": "packages/zone.js/lib/common/to-string.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/18e474f522ed62be86977cd1327b9487f58b39c6/packages%2Fzone.js%2Flib%2Fcommon%2Fto-string.ts",
            "raw_url": "https://github.com/angular/angular/raw/18e474f522ed62be86977cd1327b9487f58b39c6/packages%2Fzone.js%2Flib%2Fcommon%2Fto-string.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Flib%2Fcommon%2Fto-string.ts?ref=18e474f522ed62be86977cd1327b9487f58b39c6",
            "patch": "@@ -49,9 +49,10 @@ Zone.__load_patch('toString', (global: any) => {\n   const originalObjectToString = Object.prototype.toString;\n   const PROMISE_OBJECT_TO_STRING = '[object Promise]';\n   Object.prototype.toString = function() {\n-    if (this instanceof Promise) {\n+    if (typeof Promise === 'function' && this instanceof Promise) {\n       return PROMISE_OBJECT_TO_STRING;\n     }\n+\n     return originalObjectToString.call(this);\n   };\n });"
        },
        {
            "sha": "d1f0320726532eee327fd3d4a4994e8bbd327b9a",
            "filename": "packages/zone.js/test/common/toString.spec.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/18e474f522ed62be86977cd1327b9487f58b39c6/packages%2Fzone.js%2Ftest%2Fcommon%2FtoString.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/18e474f522ed62be86977cd1327b9487f58b39c6/packages%2Fzone.js%2Ftest%2Fcommon%2FtoString.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Ftest%2Fcommon%2FtoString.spec.ts?ref=18e474f522ed62be86977cd1327b9487f58b39c6",
            "patch": "@@ -18,6 +18,18 @@ describe('global function patch', () => {\n           .toEqual(Function.prototype.toString.call(g[zoneSymbol('setTimeout')]));\n     });\n \n+    it('should not throw error if Promise is not a function', () => {\n+      const P = g.Promise;\n+      try {\n+        g.Promise = undefined;\n+        expect(() => {\n+          const a = {}.toString();\n+        }).not.toThrow();\n+      } finally {\n+        g.Promise = P;\n+      }\n+    });\n+\n     it('MutationObserver toString should be the same with native version',\n        ifEnvSupports('MutationObserver', () => {\n          const nativeMutationObserver = g[zoneSymbol('MutationObserver')];"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 14,
        "deletions": 1
    }
}