{
    "author": "danieltre23",
    "message": "refactor(compiler-cli): move `ExtendedTemplateChecker` to `LazyCompilationState` (#43134)\n\nCreate the `ExtendedTemplateChecker` during `makeCompilation`, that way\nit's avaiblable in the whole compiler.\n\nRefs #42966\n\nPR Close #43134",
    "sha": "6af6de732864f637a0019d24ddad5e4104ca11d2",
    "files": [
        {
            "sha": "37cacabe25e9c93baa48815f42cc65bf69ed6fea",
            "filename": "packages/compiler-cli/src/ngtsc/core/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/6af6de732864f637a0019d24ddad5e4104ca11d2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/6af6de732864f637a0019d24ddad5e4104ca11d2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2FBUILD.bazel?ref=6af6de732864f637a0019d24ddad5e4104ca11d2",
            "patch": "@@ -38,6 +38,7 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/typecheck/api\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/diagnostics\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/extended\",\n+        \"//packages/compiler-cli/src/ngtsc/typecheck/extended/api\",\n         \"//packages/compiler-cli/src/ngtsc/typecheck/extended/src/template_checks/invalid_banana_in_box\",\n         \"//packages/compiler-cli/src/ngtsc/util\",\n         \"//packages/compiler-cli/src/ngtsc/xi18n\","
        },
        {
            "sha": "5c5df5223876a051817a612d13c47df480fed6ad",
            "filename": "packages/compiler-cli/src/ngtsc/core/src/compiler.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/6af6de732864f637a0019d24ddad5e4104ca11d2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/6af6de732864f637a0019d24ddad5e4104ca11d2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts?ref=6af6de732864f637a0019d24ddad5e4104ca11d2",
            "patch": "@@ -31,6 +31,7 @@ import {aliasTransformFactory, CompilationMode, declarationTransformFactory, Dec\n import {TemplateTypeCheckerImpl} from '../../typecheck';\n import {OptimizeFor, TemplateTypeChecker, TypeCheckingConfig} from '../../typecheck/api';\n import {ExtendedTemplateCheckerImpl} from '../../typecheck/extended';\n+import {ExtendedTemplateChecker} from '../../typecheck/extended/api';\n import {InvalidBananaInBoxCheck} from '../../typecheck/extended/src/template_checks/invalid_banana_in_box';\n import {getSourceFileOrNull, isDtsPath, resolveModuleName, toUnredirectedSourceFile} from '../../util/src/typescript';\n import {Xi18nContext} from '../../xi18n';\n@@ -54,6 +55,7 @@ interface LazyCompilationState {\n   refEmitter: ReferenceEmitter;\n   templateTypeChecker: TemplateTypeChecker;\n   resourceRegistry: ResourceRegistry;\n+  extendedTemplateChecker: ExtendedTemplateChecker;\n }\n \n \n@@ -917,10 +919,7 @@ export class NgCompiler {\n   private getExtendedTemplateDiagnostics(sf?: ts.SourceFile): ts.Diagnostic[] {\n     const diagnostics: ts.Diagnostic[] = [];\n     const compilation = this.ensureAnalyzed();\n-    const typeChecker = this.inputProgram.getTypeChecker();\n-    const templateChecks = [new InvalidBananaInBoxCheck()];\n-    const extendedTemplateChecker = new ExtendedTemplateCheckerImpl(\n-        compilation.templateTypeChecker, typeChecker, templateChecks);\n+    const extendedTemplateChecker = compilation.extendedTemplateChecker;\n     if (sf !== undefined) {\n       return compilation.traitCompiler.extendedTemplateCheck(sf, extendedTemplateChecker);\n     }\n@@ -1095,6 +1094,10 @@ export class NgCompiler {\n         reflector, this.adapter, this.incrementalCompilation, scopeRegistry, typeCheckScopeRegistry,\n         this.delegatingPerfRecorder);\n \n+    const templateChecks = [new InvalidBananaInBoxCheck()];\n+    const extendedTemplateChecker =\n+        new ExtendedTemplateCheckerImpl(templateTypeChecker, checker, templateChecks);\n+\n     return {\n       isCore,\n       traitCompiler,\n@@ -1109,6 +1112,7 @@ export class NgCompiler {\n       refEmitter,\n       templateTypeChecker,\n       resourceRegistry,\n+      extendedTemplateChecker\n     };\n   }\n }"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 9,
        "deletions": 4
    }
}