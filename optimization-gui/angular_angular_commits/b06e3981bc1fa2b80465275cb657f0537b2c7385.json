{
    "author": "rohan-pednekar",
    "message": "fix(core): add missing info about a component in the \"pipe could not be found\" error message (#44081)\n\nAdd error handling for pipe with component class name in which it has a problem. Add it in ngDevMode, so that it will be a tree-shake away from the production bundle.\n\nPR Close #44081",
    "sha": "b06e3981bc1fa2b80465275cb657f0537b2c7385",
    "files": [
        {
            "sha": "d615705940c9055674c1018f088d2efcd056d177",
            "filename": "packages/core/src/render3/pipe.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 4,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/b06e3981bc1fa2b80465275cb657f0537b2c7385/packages%2Fcore%2Fsrc%2Frender3%2Fpipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/b06e3981bc1fa2b80465275cb657f0537b2c7385/packages%2Fcore%2Fsrc%2Frender3%2Fpipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fpipe.ts?ref=b06e3981bc1fa2b80465275cb657f0537b2c7385",
            "patch": "@@ -8,12 +8,13 @@\n \n import {PipeTransform} from '../change_detection/pipe_transform';\n import {setInjectImplementation} from '../di/inject_switch';\n+\n import {getFactoryDef} from './definition_factory';\n import {setIncludeViewProviders} from './di';\n import {RuntimeError, RuntimeErrorCode} from './error_code';\n import {store, ɵɵdirectiveInject} from './instructions/all';\n import {PipeDef, PipeDefList} from './interfaces/definition';\n-import {HEADER_OFFSET, LView, TVIEW} from './interfaces/view';\n+import {CONTEXT, DECLARATION_COMPONENT_VIEW, HEADER_OFFSET, LView, TVIEW} from './interfaces/view';\n import {pureFunction1Internal, pureFunction2Internal, pureFunction3Internal, pureFunction4Internal, pureFunctionVInternal} from './pure_function';\n import {getBindingRoot, getLView, getTView} from './state';\n import {load} from './util/view_utils';\n@@ -35,7 +36,9 @@ export function ɵɵpipe(index: number, pipeName: string): any {\n   const adjustedIndex = index + HEADER_OFFSET;\n \n   if (tView.firstCreatePass) {\n-    pipeDef = getPipeDef(pipeName, tView.pipeRegistry);\n+    // The `getPipeDef` throws if a pipe with a given name is not found\n+    // (so we use non-null assertion below).\n+    pipeDef = getPipeDef(pipeName, tView.pipeRegistry)!;\n     tView.data[adjustedIndex] = pipeDef;\n     if (pipeDef.onDestroy) {\n       (tView.destroyHooks || (tView.destroyHooks = [])).push(adjustedIndex, pipeDef.onDestroy);\n@@ -69,7 +72,7 @@ export function ɵɵpipe(index: number, pipeName: string): any {\n  * @param registry Full list of available pipes\n  * @returns Matching PipeDef\n  */\n-function getPipeDef(name: string, registry: PipeDefList|null): PipeDef<any> {\n+function getPipeDef(name: string, registry: PipeDefList|null): PipeDef<any>|undefined {\n   if (registry) {\n     for (let i = registry.length - 1; i >= 0; i--) {\n       const pipeDef = registry[i];\n@@ -78,7 +81,14 @@ function getPipeDef(name: string, registry: PipeDefList|null): PipeDef<any> {\n       }\n     }\n   }\n-  throw new RuntimeError(RuntimeErrorCode.PIPE_NOT_FOUND, `The pipe '${name}' could not be found!`);\n+  if (ngDevMode) {\n+    const lView = getLView();\n+    const declarationLView = lView[DECLARATION_COMPONENT_VIEW];\n+    const context = declarationLView[CONTEXT];\n+    const component = context ? ` in the '${context.constructor.name}' component` : '';\n+    throw new RuntimeError(\n+        RuntimeErrorCode.PIPE_NOT_FOUND, `The pipe '${name}' could not be found${component}!`);\n+  }\n }\n \n /**"
        },
        {
            "sha": "51e6a9e1595e5cee817b6dd8a99f2252d7d47973",
            "filename": "packages/core/test/acceptance/pipe_spec.ts",
            "status": "modified",
            "additions": 125,
            "deletions": 15,
            "changes": 140,
            "blob_url": "https://github.com/angular/angular/blob/b06e3981bc1fa2b80465275cb657f0537b2c7385/packages%2Fcore%2Ftest%2Facceptance%2Fpipe_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b06e3981bc1fa2b80465275cb657f0537b2c7385/packages%2Fcore%2Ftest%2Facceptance%2Fpipe_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fpipe_spec.ts?ref=b06e3981bc1fa2b80465275cb657f0537b2c7385",
            "patch": "@@ -42,21 +42,6 @@ describe('pipe', () => {\n     expect(fixture.nativeElement.textContent).toBe('bob state:0');\n   });\n \n-  it('should throw if pipe is not found', () => {\n-    @Component({\n-      template: '{{1 | randomPipeName}}',\n-    })\n-    class App {\n-    }\n-\n-    TestBed.configureTestingModule({declarations: [App]});\n-\n-    expect(() => {\n-      const fixture = TestBed.createComponent(App);\n-      fixture.detectChanges();\n-    }).toThrowError(/The pipe 'randomPipeName' could not be found/);\n-  });\n-\n   it('should support bindings', () => {\n     @Directive({selector: '[my-dir]'})\n     class Dir {\n@@ -721,4 +706,129 @@ describe('pipe', () => {\n       }\n     });\n   });\n+\n+  describe('missing pipe detection logic', () => {\n+    it('should throw an error if a pipe is not found in a component', () => {\n+      @Component({\n+        template: '{{ 1 | testMissingPipe }}',\n+      })\n+      class TestComponent {\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [TestComponent]});\n+\n+      expect(() => {\n+        const fixture = TestBed.createComponent(TestComponent);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              /The pipe 'testMissingPipe' could not be found in the 'TestComponent' component!/);\n+    });\n+\n+    it('should throw an error if a pipe is not found inside an inline template', () => {\n+      @Component({\n+        template: `\n+          <ng-container *ngIf=\"true\">\n+            {{ value | testMissingPipe }}\n+          </ng-container>`\n+      })\n+      class TestComponent {\n+        value: string = 'test';\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [TestComponent]});\n+\n+      expect(() => {\n+        const fixture = TestBed.createComponent(TestComponent);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              /The pipe 'testMissingPipe' could not be found in the 'TestComponent' component!/);\n+    });\n+\n+    it('should throw an error if a pipe is not found inside a projected content', () => {\n+      @Component({selector: 'app-test-child', template: '<ng-content></ng-content>'})\n+      class TestChildComponent {\n+      }\n+\n+      @Component({\n+        template: `\n+          <app-test-child>\n+            {{ value | testMissingPipe }}\n+          </app-test-child>`\n+      })\n+      class TestComponent {\n+        value: string = 'test';\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [TestComponent, TestChildComponent]});\n+\n+      expect(() => {\n+        const fixture = TestBed.createComponent(TestComponent);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              /The pipe 'testMissingPipe' could not be found in the 'TestComponent' component!/);\n+    });\n+\n+    it('should throw an error if a pipe is not found inside a projected content in an inline template',\n+       () => {\n+         @Component({selector: 'app-test-child', template: '<ng-content></ng-content>'})\n+         class TestChildComponent {\n+         }\n+\n+         @Component({\n+           template: `\n+          <app-test-child>\n+            <ng-container *ngIf=\"true\">\n+              {{ value | testMissingPipe }}\n+            </ng-container>\n+          </app-test-child>`\n+         })\n+         class TestComponent {\n+           value: string = 'test';\n+         }\n+\n+         TestBed.configureTestingModule({declarations: [TestComponent, TestChildComponent]});\n+\n+         expect(() => {\n+           const fixture = TestBed.createComponent(TestComponent);\n+           fixture.detectChanges();\n+         })\n+             .toThrowError(\n+                 /The pipe 'testMissingPipe' could not be found in the 'TestComponent' component!/);\n+       });\n+\n+    it('should throw an error if a pipe is not found in a property binding', () => {\n+      @Component({template: '<div [title]=\"value | testMissingPipe\"></div>'})\n+      class TestComponent {\n+        value: string = 'test';\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [TestComponent]});\n+\n+      expect(() => {\n+        const fixture = TestBed.createComponent(TestComponent);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              /The pipe 'testMissingPipe' could not be found in the 'TestComponent' component!/);\n+    });\n+\n+    it('should throw an error if a pipe is not found inside a structural directive input', () => {\n+      @Component({template: '<div *ngIf=\"isVisible | testMissingPipe\"></div>'})\n+      class TestComponent {\n+        isVisible: boolean = true;\n+      }\n+\n+      TestBed.configureTestingModule({declarations: [TestComponent]});\n+\n+      expect(() => {\n+        const fixture = TestBed.createComponent(TestComponent);\n+        fixture.detectChanges();\n+      })\n+          .toThrowError(\n+              /The pipe 'testMissingPipe' could not be found in the 'TestComponent' component!/);\n+    });\n+  });\n });"
        }
    ],
    "stats": {
        "total": 158,
        "additions": 139,
        "deletions": 19
    }
}