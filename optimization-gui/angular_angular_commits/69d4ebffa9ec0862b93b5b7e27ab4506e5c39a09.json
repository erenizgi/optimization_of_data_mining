{
    "author": "josephperrott",
    "message": "Revert \"fix(dev-infra): perform actual npm login verification for wombot proxy (#42871)\" (#42917)\n\nThis reverts commit fd92a3e87f08253ac8d20d01bc726c7460bd9ec9.\n\nIt turns out that wombot proxy will return who is logged in, but does so regardless of\nif the users token is currently active.  Since we cannot rely on `npm whoami` to\ndetermine the login state, we revert to our previous state of assuming new login is\nneeded.\n\nPR Close #42917",
    "sha": "69d4ebffa9ec0862b93b5b7e27ab4506e5c39a09",
    "files": [
        {
            "sha": "a8e76a74a097f83e1d97e4866844c374916eda5b",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/69d4ebffa9ec0862b93b5b7e27ab4506e5c39a09/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/69d4ebffa9ec0862b93b5b7e27ab4506e5c39a09/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=69d4ebffa9ec0862b93b5b7e27ab4506e5c39a09",
            "patch": "@@ -7513,9 +7513,21 @@ class ReleaseTool {\n      * @returns a boolean indicating whether the user is logged into NPM.\n      */\n     _verifyNpmLoginState() {\n-        var _a;\n+        var _a, _b;\n         return tslib.__awaiter(this, void 0, void 0, function* () {\n             const registry = `NPM at the ${(_a = this._config.publishRegistry) !== null && _a !== void 0 ? _a : 'default NPM'} registry`;\n+            // TODO(josephperrott): remove wombat specific block once wombot allows `npm whoami` check to\n+            // check the status of the local token in the .npmrc file.\n+            if ((_b = this._config.publishRegistry) === null || _b === void 0 ? void 0 : _b.includes('wombat-dressing-room.appspot.com')) {\n+                info('Unable to determine NPM login state for wombat proxy, requiring login now.');\n+                try {\n+                    yield npmLogin(this._config.publishRegistry);\n+                }\n+                catch (_c) {\n+                    return false;\n+                }\n+                return true;\n+            }\n             if (yield npmIsLoggedIn(this._config.publishRegistry)) {\n                 debug(`Already logged into ${registry}.`);\n                 return true;\n@@ -7527,7 +7539,7 @@ class ReleaseTool {\n                 try {\n                     yield npmLogin(this._config.publishRegistry);\n                 }\n-                catch (_b) {\n+                catch (_d) {\n                     return false;\n                 }\n                 return true;"
        },
        {
            "sha": "f5c551a2d02c6ea6281e0c667a3a4160bce2c4de",
            "filename": "dev-infra/release/publish/index.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/69d4ebffa9ec0862b93b5b7e27ab4506e5c39a09/dev-infra%2Frelease%2Fpublish%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/69d4ebffa9ec0862b93b5b7e27ab4506e5c39a09/dev-infra%2Frelease%2Fpublish%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Findex.ts?ref=69d4ebffa9ec0862b93b5b7e27ab4506e5c39a09",
            "patch": "@@ -183,6 +183,17 @@ export class ReleaseTool {\n    */\n   private async _verifyNpmLoginState(): Promise<boolean> {\n     const registry = `NPM at the ${this._config.publishRegistry ?? 'default NPM'} registry`;\n+    // TODO(josephperrott): remove wombat specific block once wombot allows `npm whoami` check to\n+    // check the status of the local token in the .npmrc file.\n+    if (this._config.publishRegistry?.includes('wombat-dressing-room.appspot.com')) {\n+      info('Unable to determine NPM login state for wombat proxy, requiring login now.');\n+      try {\n+        await npmLogin(this._config.publishRegistry);\n+      } catch {\n+        return false;\n+      }\n+      return true;\n+    }\n     if (await npmIsLoggedIn(this._config.publishRegistry)) {\n       debug(`Already logged into ${registry}.`);\n       return true;"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 25,
        "deletions": 2
    }
}