{
    "author": "wagnermaciel",
    "message": "fix(benchpress): update the check for start and end events (#42085)\n\n* recently, performance events started showing up with a -bpstart and -bpend\n  suffix to indicate their being the start and end events for our performance\n  testing. to fix this, we added an additional check for those suffixes in\n  addition to the old checks.\n\nPR Close #42085",
    "sha": "2e7eb270dfe26d157b8bf819fcb669d9f0d0a066",
    "files": [
        {
            "sha": "cf22d63905beaa67f653fd4835ab427d60b4680b",
            "filename": "packages/benchpress/src/metric/perflog_metric.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/2e7eb270dfe26d157b8bf819fcb669d9f0d0a066/packages%2Fbenchpress%2Fsrc%2Fmetric%2Fperflog_metric.ts",
            "raw_url": "https://github.com/angular/angular/raw/2e7eb270dfe26d157b8bf819fcb669d9f0d0a066/packages%2Fbenchpress%2Fsrc%2Fmetric%2Fperflog_metric.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbenchpress%2Fsrc%2Fmetric%2Fperflog_metric.ts?ref=2e7eb270dfe26d157b8bf819fcb669d9f0d0a066",
            "patch": "@@ -238,13 +238,25 @@ export class PerflogMetric extends Metric {\n     events.forEach((event) => {\n       const ph = event['ph'];\n       const name = event['name'];\n-      if (ph === 'B' && name === markName) {\n+\n+      // Here we are determining if this is the event signaling the start or end of our performance\n+      // testing (this is triggered by us calling #timeBegin and #timeEnd).\n+      //\n+      // Previously, this was done by checking that the event name matched our mark name and that\n+      // the phase was either \"B\" or \"E\" (\"begin\" or \"end\"). However, for some reason now this is\n+      // showing up as \"-bpstart\" and \"-bpend\" (\"benchpress start/end\"), which is what one would\n+      // actually expect since that is the mark name used in ChromeDriverExtension - see the\n+      // #timeBegin and #timeEnd implementations in chrome_driver_extension.ts. We are not sure why\n+      // the markName didn't show up with the \"-bp(start/end)\" suffix before.\n+      const isStartEvent = (ph === 'B' && name === markName) || name === markName + '-bpstart';\n+      const isEndEvent = (ph === 'E' && name === markName) || name === markName + '-bpend';\n+      if (isStartEvent) {\n         markStartEvent = event;\n       } else if (ph === 'I' && name === 'navigationStart' && !this._ignoreNavigation) {\n         // if a benchmark measures reload of a page, use the last\n         // navigationStart as begin event\n         markStartEvent = event;\n-      } else if (ph === 'E' && name === markName) {\n+      } else if (isEndEvent) {\n         markEndEvent = event;\n       }\n     });"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 14,
        "deletions": 2
    }
}