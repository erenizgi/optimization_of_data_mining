{
    "author": "danieltre23",
    "message": "refactor(compiler-cli): add `BananaInBoxCheck` to the template checks (#42984)\n\nAdd the implementation of a Template Check that ensures the correct\nuse of two-way binding syntax. Generates a warning when\n'([foo])=\"bar\"' is found instead of '[(foo)]=\"bar\"'.\n\nRefs #42966\n\nPR Close #42984",
    "sha": "d6411c27291b69f46b3b7f648d3445c9c4ba3a4a",
    "files": [
        {
            "sha": "7134a7b404bd7398eb6ef1d454313bdbf6992ba2",
            "filename": "goldens/public-api/compiler-cli/error_code.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d6411c27291b69f46b3b7f648d3445c9c4ba3a4a/goldens%2Fpublic-api%2Fcompiler-cli%2Ferror_code.md",
            "raw_url": "https://github.com/angular/angular/raw/d6411c27291b69f46b3b7f648d3445c9c4ba3a4a/goldens%2Fpublic-api%2Fcompiler-cli%2Ferror_code.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fcompiler-cli%2Ferror_code.md?ref=d6411c27291b69f46b3b7f648d3445c9c4ba3a4a",
            "patch": "@@ -34,6 +34,7 @@ export enum ErrorCode {\n     INJECTABLE_DUPLICATE_PROV = 9001,\n     INLINE_TCB_REQUIRED = 8900,\n     INLINE_TYPE_CTOR_REQUIRED = 8901,\n+    INVALID_BANANA_IN_BOX = 8101,\n     MISSING_PIPE = 8004,\n     MISSING_REFERENCE_TARGET = 8003,\n     NGMODULE_DECLARATION_NOT_UNIQUE = 6007,\n@@ -67,7 +68,6 @@ export enum ErrorCode {\n     WRITE_TO_READ_ONLY_VARIABLE = 8005\n }\n \n-\n // (No @packageDocumentation comment for this package)\n \n ```"
        },
        {
            "sha": "26c5ffd5873839f113ebf5618f456319dabbc063",
            "filename": "packages/compiler-cli/src/ngtsc/diagnostics/src/error_code.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/d6411c27291b69f46b3b7f648d3445c9c4ba3a4a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fdiagnostics%2Fsrc%2Ferror_code.ts",
            "raw_url": "https://github.com/angular/angular/raw/d6411c27291b69f46b3b7f648d3445c9c4ba3a4a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fdiagnostics%2Fsrc%2Ferror_code.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fdiagnostics%2Fsrc%2Ferror_code.ts?ref=d6411c27291b69f46b3b7f648d3445c9c4ba3a4a",
            "patch": "@@ -172,6 +172,16 @@ export enum ErrorCode {\n    */\n   SPLIT_TWO_WAY_BINDING = 8007,\n \n+  /**\n+   * A two way binding in a template has an incorrect syntax,\n+   * parentheses outside brackets. For example:\n+   *\n+   * ```\n+   * <div ([foo])=\"bar\" />\n+   * ```\n+   */\n+  INVALID_BANANA_IN_BOX = 8101,\n+\n   /**\n    * The template type-checking engine would need to generate an inline type check block for a\n    * component, but the current type-checking environment doesn't support it."
        },
        {
            "sha": "f2a1359185090602a5d591c2a989c66c6f0f5236",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/src/template_checks/invalid_banana_in_box/BUILD.bazel",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/d6411c27291b69f46b3b7f648d3445c9c4ba3a4a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Ftemplate_checks%2Finvalid_banana_in_box%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/d6411c27291b69f46b3b7f648d3445c9c4ba3a4a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Ftemplate_checks%2Finvalid_banana_in_box%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Ftemplate_checks%2Finvalid_banana_in_box%2FBUILD.bazel?ref=d6411c27291b69f46b3b7f648d3445c9c4ba3a4a",
            "patch": "@@ -0,0 +1,13 @@\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n+\n+ts_library(\n+    name = \"invalid_banana_in_box\",\n+    srcs = [\"index.ts\"],\n+    visibility = [\"//packages/compiler-cli/src/ngtsc/typecheck/extended:__subpackages__\"],\n+    deps = [\n+        \"//packages/compiler\",\n+        \"//packages/compiler-cli/src/ngtsc/diagnostics\",\n+        \"//packages/compiler-cli/src/ngtsc/typecheck/extended/api\",\n+        \"@npm//typescript\",\n+    ],\n+)"
        },
        {
            "sha": "93ae48b89b48b386e31f1b49575df7d4346ff410",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/src/template_checks/invalid_banana_in_box/index.ts",
            "status": "added",
            "additions": 65,
            "deletions": 0,
            "changes": 65,
            "blob_url": "https://github.com/angular/angular/blob/d6411c27291b69f46b3b7f648d3445c9c4ba3a4a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Ftemplate_checks%2Finvalid_banana_in_box%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/d6411c27291b69f46b3b7f648d3445c9c4ba3a4a/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Ftemplate_checks%2Finvalid_banana_in_box%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Ftemplate_checks%2Finvalid_banana_in_box%2Findex.ts?ref=d6411c27291b69f46b3b7f648d3445c9c4ba3a4a",
            "patch": "@@ -0,0 +1,65 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {TmplAstBoundEvent, TmplAstNode, TmplAstRecursiveVisitor} from '@angular/compiler';\n+import * as ts from 'typescript';\n+import {ErrorCode} from '../../../../../diagnostics';\n+import {TemplateCheck, TemplateContext, TemplateDiagnostic} from '../../../api/api';\n+\n+/**\n+ * Ensures the two-way binding syntax is correct.\n+ * Parentheses should be inside the brackets \"[()]\".\n+ * Will return diagnostic information when \"([])\" is found.\n+ */\n+export class InvalidBananaInBoxCheck implements TemplateCheck<ErrorCode.INVALID_BANANA_IN_BOX> {\n+  code: ErrorCode.INVALID_BANANA_IN_BOX = 8101;\n+\n+  run(ctx: TemplateContext,\n+      template: TmplAstNode[]): TemplateDiagnostic<ErrorCode.INVALID_BANANA_IN_BOX>[] {\n+    const visitor = new BananaVisitor(ctx);\n+\n+    return visitor.getDiagnostics(template);\n+  }\n+}\n+\n+class BananaVisitor extends TmplAstRecursiveVisitor {\n+  private diagnostics: ts.Diagnostic[] = [];\n+\n+  constructor(public readonly ctx: TemplateContext) {\n+    super();\n+  }\n+\n+  /**\n+   * Check for outputs with names surrounded in brackets \"[]\".\n+   * The syntax '([foo])=\"bar\"' would be interpreted as an @Output()\n+   * with name '[foo]'. Just like '(foo)=\"bar\"' would have the name 'foo'.\n+   * Generate diagnostic information for the cases found.\n+   */\n+  override visitBoundEvent(boundEvent: TmplAstBoundEvent) {\n+    const name = boundEvent.name;\n+    if (name.startsWith('[') && name.endsWith(']')) {\n+      const boundSyntax = boundEvent.sourceSpan.toString();\n+      const expectedBoundSyntax = boundSyntax.replace(`(${name})`, `[(${name.slice(1, -1)})]`);\n+      this.diagnostics.push(\n+          this.ctx.templateTypeChecker.makeTemplateDiagnostic<ErrorCode.INVALID_BANANA_IN_BOX>(\n+              this.ctx.component, boundEvent.sourceSpan, ts.DiagnosticCategory.Warning,\n+              ErrorCode.INVALID_BANANA_IN_BOX,\n+              `In the two-way binding syntax the parentheses should be inside the brackets, ex. '${\n+                  expectedBoundSyntax}'. \n+                Find more at https://angular.io/guide/two-way-binding`));\n+    }\n+  }\n+\n+  getDiagnostics(template: TmplAstNode[]): ts.Diagnostic[] {\n+    this.diagnostics = [];\n+    for (const node of template) {\n+      node.visit(this);\n+    }\n+    return this.diagnostics;\n+  }\n+}"
        }
    ],
    "stats": {
        "total": 90,
        "additions": 89,
        "deletions": 1
    }
}