{
    "author": "rubenschuckit",
    "message": "fix(router): properly compare array queryParams for equality (#37709) (#37860)\n\nqueryParams will be judged different if the arrays do not contain the same frequency of elements and the same otherwise.\n\nPR Close #37860",
    "sha": "1801d0c6500ea5e677e753fbcfb73dbd3675f054",
    "files": [
        {
            "sha": "c1cee55f9780d4d3b3844db18951f6a683d0c3e1",
            "filename": "packages/router/src/url_tree.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/1801d0c6500ea5e677e753fbcfb73dbd3675f054/packages%2Frouter%2Fsrc%2Furl_tree.ts",
            "raw_url": "https://github.com/angular/angular/raw/1801d0c6500ea5e677e753fbcfb73dbd3675f054/packages%2Frouter%2Fsrc%2Furl_tree.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Furl_tree.ts?ref=1801d0c6500ea5e677e753fbcfb73dbd3675f054",
            "patch": "@@ -39,7 +39,6 @@ function equalSegmentGroups(container: UrlSegmentGroup, containee: UrlSegmentGro\n }\n \n function containsQueryParams(container: Params, containee: Params): boolean {\n-  // TODO: This does not handle array params correctly.\n   return Object.keys(containee).length <= Object.keys(container).length &&\n       Object.keys(containee).every(key => equalArraysOrString(container[key], containee[key]));\n }"
        },
        {
            "sha": "f3a9359a6a65cc6555d6ff9078486e707ea7a0ed",
            "filename": "packages/router/src/utils/collection.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/1801d0c6500ea5e677e753fbcfb73dbd3675f054/packages%2Frouter%2Fsrc%2Futils%2Fcollection.ts",
            "raw_url": "https://github.com/angular/angular/raw/1801d0c6500ea5e677e753fbcfb73dbd3675f054/packages%2Frouter%2Fsrc%2Futils%2Fcollection.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Futils%2Fcollection.ts?ref=1801d0c6500ea5e677e753fbcfb73dbd3675f054",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {NgModuleFactory, ɵisObservable as isObservable, ɵisPromise as isPromise} from '@angular/core';\n+import {ɵisObservable as isObservable, ɵisPromise as isPromise} from '@angular/core';\n import {from, Observable, of} from 'rxjs';\n import {concatAll, last as lastValue, map} from 'rxjs/operators';\n \n@@ -45,8 +45,10 @@ export function shallowEqual(a: Params, b: Params): boolean {\n  */\n export function equalArraysOrString(a: string|string[], b: string|string[]) {\n   if (Array.isArray(a) && Array.isArray(b)) {\n-    if (a.length != b.length) return false;\n-    return a.every(aItem => b.indexOf(aItem) > -1);\n+    if (a.length !== b.length) return false;\n+    const aSorted = [...a].sort();\n+    const bSorted = [...b].sort();\n+    return aSorted.every((val, index) => bSorted[index] === val);\n   } else {\n     return a === b;\n   }"
        },
        {
            "sha": "34aac7b3b2d2d6a98011169f6aa718ba27116a24",
            "filename": "packages/router/test/url_tree.spec.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/1801d0c6500ea5e677e753fbcfb73dbd3675f054/packages%2Frouter%2Ftest%2Furl_tree.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1801d0c6500ea5e677e753fbcfb73dbd3675f054/packages%2Frouter%2Ftest%2Furl_tree.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Furl_tree.spec.ts?ref=1801d0c6500ea5e677e753fbcfb73dbd3675f054",
            "patch": "@@ -67,6 +67,24 @@ describe('UrlTree', () => {\n         expect(containsTree(t1, t2, true)).toBe(false);\n       });\n \n+      it('should return false when queryParams are not the same', () => {\n+        const t1 = serializer.parse('/one/two?test=4&test=4&test=2');\n+        const t2 = serializer.parse('/one/two?test=4&test=3&test=2');\n+        expect(containsTree(t1, t2, false)).toBe(false);\n+      });\n+\n+      it('should return true when queryParams are the same in different order', () => {\n+        const t1 = serializer.parse('/one/two?test=4&test=3&test=2');\n+        const t2 = serializer.parse('/one/two?test=2&test=3&test=4');\n+        expect(containsTree(t1, t2, false)).toBe(true);\n+      });\n+\n+      it('should return true when queryParams are the same in different order', () => {\n+        const t1 = serializer.parse('/one/two?test=4&test=4&test=1');\n+        const t2 = serializer.parse('/one/two?test=1&test=4&test=4');\n+        expect(containsTree(t1, t2, false)).toBe(true);\n+      });\n+\n       it('should return false when containee is missing queryParams', () => {\n         const t1 = serializer.parse('/one/two?page=5');\n         const t2 = serializer.parse('/one/two');"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 23,
        "deletions": 4
    }
}