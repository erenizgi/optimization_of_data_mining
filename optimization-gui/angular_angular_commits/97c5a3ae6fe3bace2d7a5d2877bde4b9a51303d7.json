{
    "author": "devversion",
    "message": "feat(dev-infra): prevent deprecations from being merged into patch branch (#42454)\n\nAs per SemVer, deprecations should only be released if the\nminor version is incremented. This means that we should error\nif commits w/ deprecations target an upcoming patch, LTS release.\n\nAdditionally, we also error if deprecations are made as part of\nan upcoming release-candidate.\n\nPR Close #42454",
    "sha": "97c5a3ae6fe3bace2d7a5d2877bde4b9a51303d7",
    "files": [
        {
            "sha": "ce99daa2e457e3ff2cdb2698b942be79a9fbdd34",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 23,
            "deletions": 7,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/97c5a3ae6fe3bace2d7a5d2877bde4b9a51303d7/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/97c5a3ae6fe3bace2d7a5d2877bde4b9a51303d7/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=97c5a3ae6fe3bace2d7a5d2877bde4b9a51303d7",
            "patch": "@@ -3453,6 +3453,12 @@ var PullRequestFailure = /** @class */ (function () {\n             \"breaking changes. Breaking changes can only be merged with the \\\"target: major\\\" label.\";\n         return new this(message);\n     };\n+    PullRequestFailure.hasDeprecations = function (label) {\n+        var message = \"Cannot merge into branch for \\\"\" + label.pattern + \"\\\" as the pull request \" +\n+            \"contains deprecations. Deprecations can only be merged with the \\\"target: minor\\\" or \" +\n+            \"\\\"target: major\\\" label.\";\n+        return new this(message);\n+    };\n     PullRequestFailure.hasFeatureCommits = function (label) {\n         var message = \"Cannot merge into branch for \\\"\" + label.pattern + \"\\\" as the pull request has \" +\n             'commits with the \"feat\" type. New features can only be merged with the \"target: minor\" ' +\n@@ -3611,15 +3617,13 @@ var PR_SCHEMA$2 = {\n /** Fetches a pull request from Github. Returns null if an error occurred. */\n function fetchPullRequestFromGithub(git, prNumber) {\n     return tslib.__awaiter(this, void 0, void 0, function () {\n-        var x, e_1;\n+        var e_1;\n         return tslib.__generator(this, function (_a) {\n             switch (_a.label) {\n                 case 0:\n                     _a.trys.push([0, 2, , 3]);\n                     return [4 /*yield*/, getPr(PR_SCHEMA$2, prNumber, git)];\n-                case 1:\n-                    x = _a.sent();\n-                    return [2 /*return*/, x];\n+                case 1: return [2 /*return*/, _a.sent()];\n                 case 2:\n                     e_1 = _a.sent();\n                     // If the pull request could not be found, we want to return `null` so\n@@ -3638,8 +3642,9 @@ function isPullRequest(v) {\n     return v.targetBranches !== undefined;\n }\n /**\n- * Assert the commits provided are allowed to merge to the provided target label, throwing a\n- * PullRequestFailure otherwise.\n+ * Assert the commits provided are allowed to merge to the provided target label,\n+ * throwing an error otherwise.\n+ * @throws {PullRequestFailure}\n  */\n function assertChangesAllowForTargetLabel(commits, label, config) {\n     /**\n@@ -3650,6 +3655,7 @@ function assertChangesAllowForTargetLabel(commits, label, config) {\n     /** List of commits which are subject to content requirements for the target label. */\n     commits = commits.filter(function (commit) { return !exemptedScopes.includes(commit.scope); });\n     var hasBreakingChanges = commits.some(function (commit) { return commit.breakingChanges.length !== 0; });\n+    var hasDeprecations = commits.some(function (commit) { return commit.deprecations.length !== 0; });\n     var hasFeatureCommits = commits.some(function (commit) { return commit.type === 'feat'; });\n     switch (label.pattern) {\n         case 'target: major':\n@@ -3668,6 +3674,12 @@ function assertChangesAllowForTargetLabel(commits, label, config) {\n             if (hasFeatureCommits) {\n                 throw PullRequestFailure.hasFeatureCommits(label);\n             }\n+            // Deprecations should not be merged into RC, patch or LTS branches.\n+            // https://semver.org/#spec-item-7. Deprecations should be part of\n+            // minor releases, or major releases according to SemVer.\n+            if (hasDeprecations) {\n+                throw PullRequestFailure.hasDeprecations(label);\n+            }\n             break;\n         default:\n             warn(red('WARNING: Unable to confirm all commits in the pull request are eligible to be'));\n@@ -3678,6 +3690,7 @@ function assertChangesAllowForTargetLabel(commits, label, config) {\n /**\n  * Assert the pull request has the proper label for breaking changes if there are breaking change\n  * commits, and only has the label if there are breaking change commits.\n+ * @throws {PullRequestFailure}\n  */\n function assertCorrectBreakingChangeLabeling(commits, labels, config) {\n     /** Whether the PR has a label noting a breaking change. */\n@@ -3691,7 +3704,10 @@ function assertCorrectBreakingChangeLabeling(commits, labels, config) {\n         throw PullRequestFailure.missingBreakingChangeCommit();\n     }\n }\n-/** Assert the pull request is pending, not closed, merged or in draft. */\n+/**\n+ * Assert the pull request is pending, not closed, merged or in draft.\n+ * @throws {PullRequestFailure} if the pull request is not pending.\n+ */\n function assertPendingState(pr) {\n     if (pr.isDraft) {\n         throw PullRequestFailure.isDraft();"
        },
        {
            "sha": "29e5725c0978597c8b7e6c3ccfd018d8e331a21c",
            "filename": "dev-infra/pr/merge/failures.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/97c5a3ae6fe3bace2d7a5d2877bde4b9a51303d7/dev-infra%2Fpr%2Fmerge%2Ffailures.ts",
            "raw_url": "https://github.com/angular/angular/raw/97c5a3ae6fe3bace2d7a5d2877bde4b9a51303d7/dev-infra%2Fpr%2Fmerge%2Ffailures.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Ffailures.ts?ref=97c5a3ae6fe3bace2d7a5d2877bde4b9a51303d7",
            "patch": "@@ -93,6 +93,13 @@ export class PullRequestFailure {\n     return new this(message);\n   }\n \n+  static hasDeprecations(label: TargetLabel) {\n+    const message = `Cannot merge into branch for \"${label.pattern}\" as the pull request ` +\n+        `contains deprecations. Deprecations can only be merged with the \"target: minor\" or ` +\n+        `\"target: major\" label.`;\n+    return new this(message);\n+  }\n+\n   static hasFeatureCommits(label: TargetLabel) {\n     const message = `Cannot merge into branch for \"${label.pattern}\" as the pull request has ` +\n         'commits with the \"feat\" type. New features can only be merged with the \"target: minor\" ' +"
        },
        {
            "sha": "ec8e7110e87dcae1aa8f42dbafdfae7ce833e299",
            "filename": "dev-infra/pr/merge/pull-request.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/97c5a3ae6fe3bace2d7a5d2877bde4b9a51303d7/dev-infra%2Fpr%2Fmerge%2Fpull-request.ts",
            "raw_url": "https://github.com/angular/angular/raw/97c5a3ae6fe3bace2d7a5d2877bde4b9a51303d7/dev-infra%2Fpr%2Fmerge%2Fpull-request.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fpull-request.ts?ref=97c5a3ae6fe3bace2d7a5d2877bde4b9a51303d7",
            "patch": "@@ -201,6 +201,7 @@ function assertChangesAllowForTargetLabel(\n   /** List of commits which are subject to content requirements for the target label. */\n   commits = commits.filter(commit => !exemptedScopes.includes(commit.scope));\n   const hasBreakingChanges = commits.some(commit => commit.breakingChanges.length !== 0);\n+  const hasDeprecations = commits.some(commit => commit.deprecations.length !== 0);\n   const hasFeatureCommits = commits.some(commit => commit.type === 'feat');\n   switch (label.pattern) {\n     case 'target: major':\n@@ -219,6 +220,12 @@ function assertChangesAllowForTargetLabel(\n       if (hasFeatureCommits) {\n         throw PullRequestFailure.hasFeatureCommits(label);\n       }\n+      // Deprecations should not be merged into RC, patch or LTS branches.\n+      // https://semver.org/#spec-item-7. Deprecations should be part of\n+      // minor releases, or major releases according to SemVer.\n+      if (hasDeprecations) {\n+        throw PullRequestFailure.hasDeprecations(label);\n+      }\n       break;\n     default:\n       warn(red('WARNING: Unable to confirm all commits in the pull request are eligible to be'));"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 37,
        "deletions": 7
    }
}