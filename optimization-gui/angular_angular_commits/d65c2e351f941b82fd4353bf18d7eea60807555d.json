{
    "author": "josephperrott",
    "message": "build: define the package building function for ng-dev release tooling (#39711)\n\nThe packages are built during the release process on demand via a function\ndefined locally in the ng-dev config.\n\nPR Close #39711",
    "sha": "d65c2e351f941b82fd4353bf18d7eea60807555d",
    "files": [
        {
            "sha": "1867eab1b3681040d7d3c2979e9e094e388647da",
            "filename": ".ng-dev/release.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/d65c2e351f941b82fd4353bf18d7eea60807555d/.ng-dev%2Frelease.ts",
            "raw_url": "https://github.com/angular/angular/raw/d65c2e351f941b82fd4353bf18d7eea60807555d/.ng-dev%2Frelease.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.ng-dev%2Frelease.ts?ref=d65c2e351f941b82fd4353bf18d7eea60807555d",
            "patch": "@@ -18,14 +18,16 @@ export const release: ReleaseConfig = {\n     '@angular/platform-browser',\n     '@angular/platform-browser-dynamic',\n     '@angular/platform-server',\n-    '@angular/platform-webworker',\n-    '@angular/platform-webworker-dynamic',\n     '@angular/router',\n     '@angular/service-worker',\n     '@angular/upgrade',\n   ],\n-  // TODO: Implement release package building here.\n-  buildPackages: async () => [],\n+  buildPackages: async () => {\n+    // The buildTargetPackages function is loaded at runtime as the loading the script causes an\n+    // invocation of bazel.\n+    const {buildTargetPackages} = require(join(__dirname, '../scripts/build/package-builder'));\n+    return buildTargetPackages('dist/release-output', false, 'Release');\n+  },\n   // TODO: This can be removed once there is an org-wide tool for changelog generation.\n   generateReleaseNotesForHead: async () => {\n     exec('yarn -s gulp changelog', {cwd: join(__dirname, '../')});"
        },
        {
            "sha": "bb0c90b6887f78dda705589090f142ea3df5693a",
            "filename": "scripts/build/package-builder.js",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/d65c2e351f941b82fd4353bf18d7eea60807555d/scripts%2Fbuild%2Fpackage-builder.js",
            "raw_url": "https://github.com/angular/angular/raw/d65c2e351f941b82fd4353bf18d7eea60807555d/scripts%2Fbuild%2Fpackage-builder.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/scripts%2Fbuild%2Fpackage-builder.js?ref=d65c2e351f941b82fd4353bf18d7eea60807555d",
            "patch": "@@ -62,6 +62,7 @@ module.exports = {\n  * This path should either be absolute or relative to the project root.\n  * @param {boolean} enableIvy True, if Ivy should be used.\n  * @param {string} description Human-readable description of the build.\n+ * @returns {Array<{name: string, outputPath: string}} A list of packages built.\n  */\n function buildTargetPackages(destPath, enableIvy, description) {\n   console.info('##################################');\n@@ -70,6 +71,8 @@ function buildTargetPackages(destPath, enableIvy, description) {\n   console.info(`  Mode: ${description}`);\n   console.info('##################################');\n \n+  /** The list of packages which were built. */\n+  const builtPackages = [];\n   // List of targets to build, e.g. core, common, compiler, etc. Note that we want to also remove\n   // all carriage return (`\\r`) characters form the query output, because otherwise the carriage\n   // return is part of the bazel target name and bazel will complain.\n@@ -97,10 +100,12 @@ function buildTargetPackages(destPath, enableIvy, description) {\n       rm('-rf', destDir);\n       cp('-R', srcDir, destDir);\n       chmod('-R', 'u+w', destDir);\n+      builtPackages.push({name: `@angular/${pkg}`, outputPath: destDir});\n     }\n   });\n \n   console.info('');\n+  return builtPackages;\n }\n \n /**"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 11,
        "deletions": 4
    }
}