{
    "author": "atscott",
    "message": "feat(compiler-cli): define interfaces to be used for TemplateTypeChecker (#38618)\n\nThis commit defines the interfaces which outline the information the\n`TemplateTypeChecker` can return when requesting a Symbol for an item in the\n`TemplateAst`.\nRather than providing the `ts.Symbol`, `ts.Type`, etc.\ninformation in several separate functions, the `TemplateTypeChecker` can\ninstead provide all the useful information it knows about a particular\nnode in the `TemplateAst` and allow the callers to determine what to do\nwith it.\n\nPR Close #38618",
    "sha": "9e77bd30875c8bb40e7b7cf11332c5843b845502",
    "files": [
        {
            "sha": "c6994c26d926fe98babbaf074164399e7bcbed56",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/api/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/9e77bd30875c8bb40e7b7cf11332c5843b845502/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/9e77bd30875c8bb40e7b7cf11332c5843b845502/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Findex.ts?ref=9e77bd30875c8bb40e7b7cf11332c5843b845502",
            "patch": "@@ -9,3 +9,4 @@\n export * from './api';\n export * from './checker';\n export * from './context';\n+export * from './symbols';"
        },
        {
            "sha": "062d67b04d6cbf3550134a4e0dbf9bcfa0bbac51",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/api/symbols.ts",
            "status": "added",
            "additions": 230,
            "deletions": 0,
            "changes": 230,
            "blob_url": "https://github.com/angular/angular/blob/9e77bd30875c8bb40e7b7cf11332c5843b845502/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fsymbols.ts",
            "raw_url": "https://github.com/angular/angular/raw/9e77bd30875c8bb40e7b7cf11332c5843b845502/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fsymbols.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fapi%2Fsymbols.ts?ref=9e77bd30875c8bb40e7b7cf11332c5843b845502",
            "patch": "@@ -0,0 +1,230 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {TmplAstElement, TmplAstReference, TmplAstTemplate, TmplAstVariable} from '@angular/compiler';\n+import * as ts from 'typescript';\n+\n+import {AbsoluteFsPath} from '../../file_system';\n+\n+export enum SymbolKind {\n+  Input,\n+  Output,\n+  Binding,\n+  Reference,\n+  Variable,\n+  Directive,\n+  Element,\n+  Template,\n+  Expression,\n+}\n+\n+/**\n+ * A representation of an entity in the `TemplateAst`.\n+ */\n+export type Symbol = InputBindingSymbol|OutputBindingSymbol|ElementSymbol|ReferenceSymbol|\n+    VariableSymbol|ExpressionSymbol|DirectiveSymbol|TemplateSymbol;\n+\n+/** Information about where a `ts.Node` can be found in the type check block shim file. */\n+export interface ShimLocation {\n+  /**\n+   * The fully qualified path of the file which contains the generated TypeScript type check\n+   * code for the component's template.\n+   */\n+  shimPath: AbsoluteFsPath;\n+\n+  /** The location in the shim file where node appears. */\n+  positionInShimFile: number;\n+}\n+\n+/**\n+ * A generic representation of some node in a template.\n+ */\n+export interface TsNodeSymbolInfo {\n+  /** The `ts.Type` of the template node. */\n+  tsType: ts.Type;\n+\n+  /** The `ts.Symbol` for the template node */\n+  tsSymbol: ts.Symbol|null;\n+\n+  /** The position of the most relevant part of the template node. */\n+  shimLocation: ShimLocation;\n+}\n+\n+/**\n+ * A representation of an expression in a component template.\n+ */\n+export interface ExpressionSymbol {\n+  kind: SymbolKind.Expression;\n+\n+  /** The `ts.Type` of the expression AST. */\n+  tsType: ts.Type;\n+\n+  /**\n+   * The `ts.Symbol` of the entity. This could be `null`, for example `AST` expression\n+   * `{{foo.bar + foo.baz}}` does not have a `ts.Symbol` but `foo.bar` and `foo.baz` both do.\n+   */\n+  tsSymbol: ts.Symbol|null;\n+\n+  /** The position of the most relevant part of the expression. */\n+  shimLocation: ShimLocation;\n+}\n+\n+/** Represents either an input or output binding in a template. */\n+export interface BindingSymbol {\n+  kind: SymbolKind.Binding;\n+\n+  /** The `ts.Type` of the class member on the directive that is the target of the binding. */\n+  tsType: ts.Type;\n+\n+  /** The `ts.Symbol` of the class member on the directive that is the target of the binding. */\n+  tsSymbol: ts.Symbol;\n+\n+  /**\n+   * The `DirectiveSymbol` or `ElementSymbol` for the Directive, Component, or `HTMLElement` with\n+   * the binding.\n+   */\n+  target: DirectiveSymbol|ElementSymbol|TemplateSymbol;\n+\n+  /** The location in the shim file where the field access for the binding appears. */\n+  shimLocation: ShimLocation;\n+}\n+\n+/**\n+ * A representation of an input binding in a component template.\n+ */\n+export interface InputBindingSymbol {\n+  kind: SymbolKind.Input;\n+\n+  /** A single input may be bound to multiple components or directives. */\n+  bindings: BindingSymbol[];\n+}\n+\n+/**\n+ * A representation of an output binding in a component template.\n+ */\n+export interface OutputBindingSymbol {\n+  kind: SymbolKind.Output;\n+\n+  /** A single output may be bound to multiple components or directives. */\n+  bindings: BindingSymbol[];\n+}\n+\n+/**\n+ * A representation of a local reference in a component template.\n+ */\n+export interface ReferenceSymbol {\n+  kind: SymbolKind.Reference;\n+\n+  /**\n+   * The `ts.Type` of the Reference value.\n+   *\n+   * `TmplAstTemplate` - The type of the `TemplateRef`\n+   * `TmplAstElement` - The `ts.Type` for the `HTMLElement`.\n+   * Directive - The `ts.Type` for the class declaration.\n+   */\n+  tsType: ts.Type;\n+\n+  /**\n+   * The `ts.Symbol` for the Reference value.\n+   *\n+   * `TmplAstTemplate` - A `TemplateRef` symbol.\n+   * `TmplAstElement` - The symbol for the `HTMLElement`.\n+   * Directive - The symbol for the class declaration of the directive.\n+   */\n+  tsSymbol: ts.Symbol;\n+\n+  /**\n+   * Depending on the type of the reference, this is one of the following:\n+   *  - `TmplAstElement` when the local ref refers to the HTML element\n+   *  - `TmplAstTemplate` when the ref refers to an `ng-template`\n+   *  - `ts.ClassDeclaration` when the local ref refers to a Directive instance (#ref=\"myExportAs\")\n+   */\n+  target: TmplAstElement|TmplAstTemplate|ts.ClassDeclaration;\n+\n+  /**\n+   * The node in the `TemplateAst` where the symbol is declared. That is, node for the `#ref` or\n+   * `#ref=\"exportAs\"`.\n+   */\n+  declaration: TmplAstReference;\n+\n+  /** The location in the shim file of a variable that holds the type of the local ref. */\n+  shimLocation: ShimLocation;\n+}\n+\n+/**\n+ * A representation of a context variable in a component template.\n+ */\n+export interface VariableSymbol {\n+  kind: SymbolKind.Variable;\n+\n+  /**\n+   * The `ts.Type` of the entity.\n+   *\n+   * This will be `any` if there is no `ngTemplateContextGuard`.\n+   */\n+  tsType: ts.Type;\n+\n+  /**\n+   * The `ts.Symbol` for the context variable.\n+   *\n+   * This will be `null` if there is no `ngTemplateContextGuard`.\n+   */\n+  tsSymbol: ts.Symbol|null;\n+\n+  /**\n+   * The node in the `TemplateAst` where the variable is declared. That is, the node for the `let-`\n+   * node in the template.\n+   */\n+  declaration: TmplAstVariable;\n+\n+  /** The location in the shim file of a variable that holds the type of the template variable. */\n+  shimLocation: ShimLocation;\n+}\n+\n+/**\n+ * A representation of an element in a component template.\n+ */\n+export interface ElementSymbol {\n+  kind: SymbolKind.Element;\n+\n+  /** The `ts.Type` for the `HTMLElement`. */\n+  tsType: ts.Type;\n+\n+  /** The `ts.Symbol` for the `HTMLElement`. */\n+  tsSymbol: ts.Symbol|null;\n+\n+  /** A list of directives applied to the element. */\n+  directives: DirectiveSymbol[];\n+\n+  /** The location in the shim file for the variable that holds the type of the element. */\n+  shimLocation: ShimLocation;\n+}\n+\n+export interface TemplateSymbol {\n+  kind: SymbolKind.Template;\n+\n+  /** A list of directives applied to the element. */\n+  directives: DirectiveSymbol[];\n+}\n+\n+/**\n+ * A representation of a directive/component whose selector matches a node in a component\n+ * template.\n+ */\n+export interface DirectiveSymbol {\n+  kind: SymbolKind.Directive;\n+\n+  /** The `ts.Type` for the class declaration. */\n+  tsType: ts.Type;\n+\n+  /** The `ts.Symbol` for the class declaration. */\n+  tsSymbol: ts.Symbol;\n+\n+  /** The location in the shim file for the variable that holds the type of the directive. */\n+  shimLocation: ShimLocation;\n+}"
        }
    ],
    "stats": {
        "total": 231,
        "additions": 231,
        "deletions": 0
    }
}