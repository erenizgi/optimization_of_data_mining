{
    "author": "IgorMinar",
    "message": "feat(dev-infra): add support for minBodyLengthTypeExcludes to  commit-message validation (#37764)\n\nThis feature will allow us to exclude certain commits from the 100 chars minBodyLength requirement for commit\nmessages which is hard to satisfy for commits that make trivial changes (e.g. fixing typos in docs or comments).\n\nPR Close #37764",
    "sha": "c5b125b7db50914840849a8d86cbb3304d2f4e68",
    "files": [
        {
            "sha": "2d9739cecf368d718f64e6f384c1eff831eb2cbc",
            "filename": "dev-infra/commit-message/config.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/c5b125b7db50914840849a8d86cbb3304d2f4e68/dev-infra%2Fcommit-message%2Fconfig.ts",
            "raw_url": "https://github.com/angular/angular/raw/c5b125b7db50914840849a8d86cbb3304d2f4e68/dev-infra%2Fcommit-message%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fconfig.ts?ref=c5b125b7db50914840849a8d86cbb3304d2f4e68",
            "patch": "@@ -11,6 +11,7 @@ import {assertNoErrors, getConfig, NgDevConfig} from '../utils/config';\n export interface CommitMessageConfig {\n   maxLineLength: number;\n   minBodyLength: number;\n+  minBodyLengthTypeExcludes?: string[];\n   types: string[];\n   scopes: string[];\n }\n@@ -19,7 +20,7 @@ export interface CommitMessageConfig {\n export function getCommitMessageConfig() {\n   // List of errors encountered validating the config.\n   const errors: string[] = [];\n-  // The unvalidated config object.\n+  // The non-validated config object.\n   const config: Partial<NgDevConfig<{commitMessage: CommitMessageConfig}>> = getConfig();\n \n   if (config.commitMessage === undefined) {"
        },
        {
            "sha": "ad1bf5b1e9d561bd04231c9be0263aef96f9017c",
            "filename": "dev-infra/commit-message/validate.spec.ts",
            "status": "modified",
            "additions": 46,
            "deletions": 6,
            "changes": 52,
            "blob_url": "https://github.com/angular/angular/blob/c5b125b7db50914840849a8d86cbb3304d2f4e68/dev-infra%2Fcommit-message%2Fvalidate.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/c5b125b7db50914840849a8d86cbb3304d2f4e68/dev-infra%2Fcommit-message%2Fvalidate.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate.spec.ts?ref=c5b125b7db50914840849a8d86cbb3304d2f4e68",
            "patch": "@@ -10,19 +10,22 @@\n import * as validateConfig from './config';\n import {validateCommitMessage} from './validate';\n \n+type CommitMessageConfig = validateConfig.CommitMessageConfig;\n+\n+\n // Constants\n-const config = {\n-  'commitMessage': {\n-    'maxLineLength': 120,\n-    'minBodyLength': 0,\n-    'types': [\n+const config: {commitMessage: CommitMessageConfig} = {\n+  commitMessage: {\n+    maxLineLength: 120,\n+    minBodyLength: 0,\n+    types: [\n       'feat',\n       'fix',\n       'refactor',\n       'release',\n       'style',\n     ],\n-    'scopes': [\n+    scopes: [\n       'common',\n       'compiler',\n       'core',\n@@ -224,5 +227,42 @@ describe('validate-commit-message.js', () => {\n         });\n       });\n     });\n+\n+    describe('minBodyLength', () => {\n+      const minBodyLengthConfig: {commitMessage: CommitMessageConfig} = {\n+        commitMessage: {\n+          maxLineLength: 120,\n+          minBodyLength: 30,\n+          minBodyLengthTypeExcludes: ['docs'],\n+          types: ['fix', 'docs'],\n+          scopes: ['core']\n+        }\n+      };\n+\n+      beforeEach(() => {\n+        (validateConfig.getCommitMessageConfig as jasmine.Spy).and.returnValue(minBodyLengthConfig);\n+      });\n+\n+      it('should fail validation if the body is shorter than `minBodyLength`', () => {\n+        expect(validateCommitMessage(\n+                   'fix(core): something\\n\\n Explanation of the motivation behind this change'))\n+            .toBe(VALID);\n+        expect(validateCommitMessage('fix(core): something\\n\\n too short')).toBe(INVALID);\n+        expect(lastError).toContain(\n+            'The commit message body does not meet the minimum length of 30 characters');\n+        expect(validateCommitMessage('fix(core): something')).toBe(INVALID);\n+        expect(lastError).toContain(\n+            'The commit message body does not meet the minimum length of 30 characters');\n+      });\n+\n+      it('should pass validation if the body is shorter than `minBodyLength` but the commit type is in the `minBodyLengthTypeExclusions` list',\n+         () => {\n+           expect(validateCommitMessage('docs: just fixing a typo')).toBe(VALID);\n+           expect(validateCommitMessage('docs(core): just fixing a typo')).toBe(VALID);\n+           expect(validateCommitMessage(\n+                      'docs(core): just fixing a typo\\n\\nThis was just a silly typo.'))\n+               .toBe(VALID);\n+         });\n+    });\n   });\n });"
        },
        {
            "sha": "a9b01f1c4dea530681c11cf8a0377a61f939d63f",
            "filename": "dev-infra/commit-message/validate.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/c5b125b7db50914840849a8d86cbb3304d2f4e68/dev-infra%2Fcommit-message%2Fvalidate.ts",
            "raw_url": "https://github.com/angular/angular/raw/c5b125b7db50914840849a8d86cbb3304d2f4e68/dev-infra%2Fcommit-message%2Fvalidate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate.ts?ref=c5b125b7db50914840849a8d86cbb3304d2f4e68",
            "patch": "@@ -148,7 +148,8 @@ export function validateCommitMessage(\n   // Checking commit body //\n   //////////////////////////\n \n-  if (commit.bodyWithoutLinking.trim().length < config.minBodyLength) {\n+  if (!config.minBodyLengthTypeExcludes?.includes(commit.type) &&\n+      commit.bodyWithoutLinking.trim().length < config.minBodyLength) {\n     printError(`The commit message body does not meet the minimum length of ${\n         config.minBodyLength} characters`);\n     return false;\n@@ -157,7 +158,7 @@ export function validateCommitMessage(\n   const bodyByLine = commit.body.split('\\n');\n   if (bodyByLine.some(line => line.length > config.maxLineLength)) {\n     printError(\n-        `The commit messsage body contains lines greater than ${config.maxLineLength} characters`);\n+        `The commit message body contains lines greater than ${config.maxLineLength} characters`);\n     return false;\n   }\n "
        }
    ],
    "stats": {
        "total": 60,
        "additions": 51,
        "deletions": 9
    }
}