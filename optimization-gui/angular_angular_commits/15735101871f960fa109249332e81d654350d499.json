{
    "author": "petebacondarwin",
    "message": "refactor(docs-infra): tidy up systemjs boilerplate for upgrade examples (#41689)\n\nThe ngUpgrade examples mostly rely upon SystemJS configuration.\nThis commit tidies up how these examples are built and tested so that\nit will be easier to migrate them to work with Angular 11.2.x\n\nPR Close #41689",
    "sha": "15735101871f960fa109249332e81d654350d499",
    "files": [
        {
            "sha": "a89a619231e075b5e19dca9adb052c055856c3c6",
            "filename": "aio/content/examples/upgrade-phonecat-1-typescript/tsconfig.json",
            "status": "removed",
            "additions": 0,
            "deletions": 26,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/e06f1960f442032f94badece2f0956d7e8dc23e8/aio%2Fcontent%2Fexamples%2Fupgrade-phonecat-1-typescript%2Ftsconfig.json",
            "raw_url": "https://github.com/angular/angular/raw/e06f1960f442032f94badece2f0956d7e8dc23e8/aio%2Fcontent%2Fexamples%2Fupgrade-phonecat-1-typescript%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fupgrade-phonecat-1-typescript%2Ftsconfig.json?ref=e06f1960f442032f94badece2f0956d7e8dc23e8",
            "patch": "@@ -1,26 +0,0 @@\n-{\n-  \"compilerOptions\": {\n-    \"target\": \"es5\",\n-    \"module\": \"commonjs\",\n-    \"moduleResolution\": \"node\",\n-    \"sourceMap\": true,\n-    \"emitDecoratorMetadata\": true,\n-    \"experimentalDecorators\": true,\n-    \"lib\": [\n-      \"es2015\",\n-      \"dom\"\n-    ],\n-    \"noImplicitAny\": true,\n-    \"skipLibCheck\": true,\n-    \"suppressImplicitAnyIndexErrors\": true,\n-    \"typeRoots\": [\n-      \"node_modules/@types\"\n-    ]\n-  },\n-  \"compileOnSave\": true,\n-  \"exclude\": [\n-    \"node_modules/*\",\n-    \"**/*-aot.ts\",\n-    \"aot/**/*\"\n-  ]\n-}"
        },
        {
            "sha": "d1f02feb5b96eed7ba055ba0eed30e53856ff4ae",
            "filename": "aio/content/examples/upgrade-phonecat-2-hybrid/tsconfig.json",
            "status": "removed",
            "additions": 0,
            "deletions": 25,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/e06f1960f442032f94badece2f0956d7e8dc23e8/aio%2Fcontent%2Fexamples%2Fupgrade-phonecat-2-hybrid%2Ftsconfig.json",
            "raw_url": "https://github.com/angular/angular/raw/e06f1960f442032f94badece2f0956d7e8dc23e8/aio%2Fcontent%2Fexamples%2Fupgrade-phonecat-2-hybrid%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fupgrade-phonecat-2-hybrid%2Ftsconfig.json?ref=e06f1960f442032f94badece2f0956d7e8dc23e8",
            "patch": "@@ -1,25 +0,0 @@\n-{\n-  \"compilerOptions\": {\n-    \"target\": \"es5\",\n-    \"module\": \"commonjs\",\n-    \"moduleResolution\": \"node\",\n-    \"sourceMap\": true,\n-    \"emitDecoratorMetadata\": true,\n-    \"experimentalDecorators\": true,\n-    \"lib\": [\n-      \"es2015\",\n-      \"dom\"\n-    ],\n-    \"noImplicitAny\": true,\n-    \"skipLibCheck\": true,\n-    \"suppressImplicitAnyIndexErrors\": true,\n-    \"typeRoots\": [\n-      \"node_modules/@types\"\n-    ]\n-  },\n-  \"compileOnSave\": true,\n-  \"exclude\": [\n-    \"node_modules/*\",\n-    \"**/*-aot.ts\"\n-  ]\n-}"
        },
        {
            "sha": "d1f02feb5b96eed7ba055ba0eed30e53856ff4ae",
            "filename": "aio/content/examples/upgrade-phonecat-3-final/tsconfig.json",
            "status": "removed",
            "additions": 0,
            "deletions": 25,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/e06f1960f442032f94badece2f0956d7e8dc23e8/aio%2Fcontent%2Fexamples%2Fupgrade-phonecat-3-final%2Ftsconfig.json",
            "raw_url": "https://github.com/angular/angular/raw/e06f1960f442032f94badece2f0956d7e8dc23e8/aio%2Fcontent%2Fexamples%2Fupgrade-phonecat-3-final%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fupgrade-phonecat-3-final%2Ftsconfig.json?ref=e06f1960f442032f94badece2f0956d7e8dc23e8",
            "patch": "@@ -1,25 +0,0 @@\n-{\n-  \"compilerOptions\": {\n-    \"target\": \"es5\",\n-    \"module\": \"commonjs\",\n-    \"moduleResolution\": \"node\",\n-    \"sourceMap\": true,\n-    \"emitDecoratorMetadata\": true,\n-    \"experimentalDecorators\": true,\n-    \"lib\": [\n-      \"es2015\",\n-      \"dom\"\n-    ],\n-    \"noImplicitAny\": true,\n-    \"skipLibCheck\": true,\n-    \"suppressImplicitAnyIndexErrors\": true,\n-    \"typeRoots\": [\n-      \"node_modules/@types\"\n-    ]\n-  },\n-  \"compileOnSave\": true,\n-  \"exclude\": [\n-    \"node_modules/*\",\n-    \"**/*-aot.ts\"\n-  ]\n-}"
        },
        {
            "sha": "0ab8b40cde5a81e04c5b293b0f32529794645cbe",
            "filename": "aio/tools/examples/README.md",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/15735101871f960fa109249332e81d654350d499/aio%2Ftools%2Fexamples%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/15735101871f960fa109249332e81d654350d499/aio%2Ftools%2Fexamples%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2FREADME.md?ref=15735101871f960fa109249332e81d654350d499",
            "patch": "@@ -118,12 +118,10 @@ This will be picked up by the default testing command (see the [example configur\n If you are using a custom test command, make sure e2e specs are picked up (if applicable).\n \n For SystemJS-based examples, create an `e2e-spec.ts` file inside the example root folder.\n-These apps will be tested with the following command:\n+These apps will be tested with the following command (and an optional `outputFile` to receive log messages):\n \n ```sh\n-yarn protractor aio/tools/examples/shared/protractor.config.js \\\n-  --specs=<example-folder>/e2e-spec.ts \\\n-  --params.appDir=<example-folder>\n+yarn protractor [--params.outputFile=path/to/logfile.txt]\n ```\n \n "
        },
        {
            "sha": "2da24028236a141410a319e7bc999c206369c494",
            "filename": "aio/tools/examples/run-example-e2e.js",
            "status": "modified",
            "additions": 1,
            "deletions": 9,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/15735101871f960fa109249332e81d654350d499/aio%2Ftools%2Fexamples%2Frun-example-e2e.js",
            "raw_url": "https://github.com/angular/angular/raw/15735101871f960fa109249332e81d654350d499/aio%2Ftools%2Fexamples%2Frun-example-e2e.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2Frun-example-e2e.js?ref=15735101871f960fa109249332e81d654350d499",
            "patch": "@@ -13,9 +13,7 @@ shelljs.set('-e');\n process.env.CHROME_BIN = require('puppeteer').executablePath();\n \n const AIO_PATH = path.join(__dirname, '../../');\n-const SHARED_PATH = path.join(__dirname, '/shared');\n const EXAMPLES_PATH = path.join(AIO_PATH, './content/examples/');\n-const PROTRACTOR_CONFIG_FILENAME = path.join(__dirname, './shared/protractor.config.js');\n const SJS_SPEC_FILENAME = 'e2e-spec.ts';\n const CLI_SPEC_FILENAME = 'e2e/src/app.e2e-spec.ts';\n const EXAMPLE_CONFIG_FILENAME = 'example-config.json';\n@@ -194,13 +192,7 @@ function runProtractorSystemJS(prepPromise, appDir, appRunSpawnInfo, outputFile)\n \n         // Start protractor.\n         console.log(`\\n\\n=========== Running aio example tests for: ${appDir}`);\n-        const spawnInfo = spawnExt(\n-            'yarn',\n-            [\n-              'protractor', PROTRACTOR_CONFIG_FILENAME, `--specs=${specFilename}`,\n-              '--params.appDir=' + appDir, '--params.outputFile=' + outputFile\n-            ],\n-            {cwd: SHARED_PATH});\n+        const spawnInfo = spawnExt('yarn', [ 'protractor', '--params.outputFile=' + outputFile ], {cwd: appDir});\n \n         spawnInfo.proc.stderr.on('data', function(data) {\n           transpileError = transpileError || /npm ERR! Exit status 100/.test(data.toString());"
        },
        {
            "sha": "9b1802a540c7af3679f3b68427bd0c1e4edc71ce",
            "filename": "aio/tools/examples/shared/boilerplate/systemjs/package.json",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/15735101871f960fa109249332e81d654350d499/aio%2Ftools%2Fexamples%2Fshared%2Fboilerplate%2Fsystemjs%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/15735101871f960fa109249332e81d654350d499/aio%2Ftools%2Fexamples%2Fshared%2Fboilerplate%2Fsystemjs%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2Fshared%2Fboilerplate%2Fsystemjs%2Fpackage.json?ref=15735101871f960fa109249332e81d654350d499",
            "patch": "@@ -4,16 +4,14 @@\n   \"description\": \"Example project from an angular.io guide.\",\n   \"license\": \"MIT\",\n   \"scripts\": {\n-    \"build\": \"tsc -p src/\",\n-    \"build:watch\": \"tsc -p src/ -w\",\n-    \"build:e2e\": \"tsc -p e2e/\",\n+    \"build\": \"tsc\",\n+    \"build:watch\": \"tsc -w\",\n     \"serve\": \"lite-server -c=bs-config.json\",\n     \"serve:e2e\": \"lite-server -c=bs-config.e2e.json\",\n     \"prestart\": \"npm run build\",\n     \"start\": \"concurrently \\\"npm run build:watch\\\" \\\"npm run serve\\\"\",\n-    \"pree2e\": \"webdriver-manager update && npm run build:e2e\",\n     \"e2e\": \"concurrently \\\"npm run serve:e2e\\\" \\\"npm run protractor\\\" --kill-others --success first\",\n-    \"protractor\": \"protractor protractor.config.js\",\n+    \"protractor\": \"protractor protractor.config.js --specs=e2e-spec.ts\",\n     \"pretest\": \"npm run build\",\n     \"test\": \"concurrently \\\"npm run build:watch\\\" \\\"karma start karma.conf.js\\\"\",\n     \"pretest:once\": \"npm run build\","
        },
        {
            "sha": "8d3ffa24924d95cf88fa4071bc3f4b2317860d30",
            "filename": "aio/tools/examples/shared/boilerplate/systemjs/protractor.config.js",
            "status": "renamed",
            "additions": 9,
            "deletions": 16,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/15735101871f960fa109249332e81d654350d499/aio%2Ftools%2Fexamples%2Fshared%2Fboilerplate%2Fsystemjs%2Fprotractor.config.js",
            "raw_url": "https://github.com/angular/angular/raw/15735101871f960fa109249332e81d654350d499/aio%2Ftools%2Fexamples%2Fshared%2Fboilerplate%2Fsystemjs%2Fprotractor.config.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2Fshared%2Fboilerplate%2Fsystemjs%2Fprotractor.config.js?ref=15735101871f960fa109249332e81d654350d499",
            "patch": "@@ -49,7 +49,7 @@ exports.config = {\n     // debugging\n     // console.log('browser.params:' + JSON.stringify(browser.params));\n \n-    jasmine.getEnv().addReporter(new Reporter( browser.params ));\n+    jasmine.getEnv().addReporter(new Reporter(browser.params.outputFile));\n   },\n \n   jasmineNodeOpts: {\n@@ -68,12 +68,8 @@ exports.config = {\n };\n \n // See https://jasmine.github.io/2.1/custom_reporter.html\n-function Reporter(options) {\n-  var _defaultOutputFile = path.resolve(__dirname, '../../protractor-results.txt');\n-  options.outputFile = options.outputFile || _defaultOutputFile;\n-\n-  var _root = { appDir: options.appDir, suites: [] };\n-  log('AppDir: ' + options.appDir, +1);\n+function Reporter(outputFile) {\n+  var _root = { suites: [] };\n   var _currentSuite;\n \n   this.suiteStarted = function(suite) {\n@@ -114,21 +110,18 @@ function Reporter(options) {\n     }\n   };\n \n-  this.jasmineDone = function() {\n-    outputFile = options.outputFile;\n-    //// Alternate approach - just stringify the _root - not as pretty\n-    //// but might be more useful for automation.\n-    // var output = JSON.stringify(_root, null, 2);\n-    var output = formatOutput(_root);\n-    fs.appendFileSync(outputFile, output);\n-  };\n+  if (outputFile) {\n+    this.jasmineDone = function() {\n+      var output = formatOutput(_root);\n+      fs.appendFileSync(outputFile, output);\n+    };\n+  }\n \n   // for output file output\n   function formatOutput(output) {\n     var indent = '  ';\n     var pad = '  ';\n     var results = [];\n-    results.push('AppDir:' + output.appDir);\n     output.suites.forEach(function(suite) {\n       results.push(pad + 'Suite: ' + suite.description + ' -- ' + suite.status);\n       pad+=indent;",
            "previous_filename": "aio/tools/examples/shared/protractor.config.js"
        },
        {
            "sha": "e12e9a7fec366b42012eeceef9c571c422dcbf45",
            "filename": "aio/tools/examples/shared/boilerplate/systemjs/tsconfig.json",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/angular/angular/blob/15735101871f960fa109249332e81d654350d499/aio%2Ftools%2Fexamples%2Fshared%2Fboilerplate%2Fsystemjs%2Ftsconfig.json",
            "raw_url": "https://github.com/angular/angular/raw/15735101871f960fa109249332e81d654350d499/aio%2Ftools%2Fexamples%2Fshared%2Fboilerplate%2Fsystemjs%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2Fshared%2Fboilerplate%2Fsystemjs%2Ftsconfig.json?ref=15735101871f960fa109249332e81d654350d499",
            "previous_filename": "aio/tools/examples/shared/boilerplate/systemjs/src/tsconfig.json"
        }
    ],
    "stats": {
        "total": 125,
        "additions": 15,
        "deletions": 110
    }
}