{
    "author": "mhevery",
    "message": "refactor(core): add debug ranges to `LViewDebug` with matchers (#38359)\n\nThis change provides better typing for the `LView.debug` property which\nis intended to be used by humans while debugging the application with\n`ngDevMode` turned on.\n\nIn addition this chang also adds jasmine matchers for better asserting\nthat `LView` is in the correct state.\n\nPR Close #38359",
    "sha": "702958e9684a21f3e079a21ff7e796fe2906dde0",
    "files": [
        {
            "sha": "e8aebc92303efae29016afb0f1bd838e178587c6",
            "filename": "goldens/circular-deps/packages.json",
            "status": "modified",
            "additions": 16,
            "deletions": 19,
            "changes": 35,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/goldens%2Fcircular-deps%2Fpackages.json",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/goldens%2Fcircular-deps%2Fpackages.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fcircular-deps%2Fpackages.json?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -223,15 +223,7 @@\n     \"packages/core/src/render3/assert.ts\",\n     \"packages/core/src/render3/interfaces/container.ts\",\n     \"packages/core/src/render3/interfaces/node.ts\",\n-    \"packages/core/src/render3/interfaces/definition.ts\",\n-    \"packages/core/src/core.ts\",\n-    \"packages/core/src/metadata.ts\",\n-    \"packages/core/src/di.ts\",\n-    \"packages/core/src/di/index.ts\",\n-    \"packages/core/src/di/injectable.ts\",\n-    \"packages/core/src/di/jit/injectable.ts\",\n-    \"packages/core/src/di/jit/environment.ts\",\n-    \"packages/core/src/di/injector_compatibility.ts\",\n+    \"packages/core/src/render3/interfaces/view.ts\",\n     \"packages/core/src/di/injector.ts\",\n     \"packages/core/src/di/r3_injector.ts\",\n     \"packages/core/src/render3/definition.ts\",\n@@ -247,8 +239,14 @@\n     \"packages/core/src/render3/assert.ts\",\n     \"packages/core/src/render3/interfaces/container.ts\",\n     \"packages/core/src/render3/interfaces/node.ts\",\n-    \"packages/core/src/render3/interfaces/definition.ts\",\n     \"packages/core/src/render3/interfaces/view.ts\",\n+    \"packages/core/src/metadata.ts\",\n+    \"packages/core/src/di.ts\",\n+    \"packages/core/src/di/index.ts\",\n+    \"packages/core/src/di/injectable.ts\",\n+    \"packages/core/src/di/jit/injectable.ts\",\n+    \"packages/core/src/di/jit/environment.ts\",\n+    \"packages/core/src/di/injector_compatibility.ts\",\n     \"packages/core/src/di/injector.ts\",\n     \"packages/core/src/di/r3_injector.ts\",\n     \"packages/core/src/render3/definition.ts\",\n@@ -264,8 +262,9 @@\n     \"packages/core/src/render3/assert.ts\",\n     \"packages/core/src/render3/interfaces/container.ts\",\n     \"packages/core/src/render3/interfaces/node.ts\",\n-    \"packages/core/src/render3/interfaces/definition.ts\",\n     \"packages/core/src/render3/interfaces/view.ts\",\n+    \"packages/core/src/render3/interfaces/definition.ts\",\n+    \"packages/core/src/core.ts\",\n     \"packages/core/src/metadata.ts\",\n     \"packages/core/src/di.ts\",\n     \"packages/core/src/di/index.ts\",\n@@ -1766,27 +1765,25 @@\n   [\n     \"packages/core/src/render3/interfaces/container.ts\",\n     \"packages/core/src/render3/interfaces/node.ts\",\n-    \"packages/core/src/render3/interfaces/definition.ts\",\n     \"packages/core/src/render3/interfaces/view.ts\"\n   ],\n   [\n     \"packages/core/src/render3/interfaces/definition.ts\",\n-    \"packages/core/src/render3/interfaces/node.ts\"\n+    \"packages/core/src/render3/interfaces/node.ts\",\n+    \"packages/core/src/render3/interfaces/view.ts\"\n   ],\n   [\n     \"packages/core/src/render3/interfaces/definition.ts\",\n     \"packages/core/src/render3/interfaces/view.ts\"\n   ],\n   [\n-    \"packages/core/src/render3/interfaces/definition.ts\",\n-    \"packages/core/src/render3/interfaces/view.ts\",\n-    \"packages/core/src/render3/interfaces/node.ts\"\n+    \"packages/core/src/render3/interfaces/node.ts\",\n+    \"packages/core/src/render3/interfaces/view.ts\"\n   ],\n   [\n-    \"packages/core/src/render3/interfaces/definition.ts\",\n+    \"packages/core/src/render3/interfaces/node.ts\",\n     \"packages/core/src/render3/interfaces/view.ts\",\n-    \"packages/core/src/render3/interfaces/query.ts\",\n-    \"packages/core/src/render3/interfaces/node.ts\"\n+    \"packages/core/src/render3/interfaces/query.ts\"\n   ],\n   [\n     \"packages/core/src/render3/interfaces/query.ts\","
        },
        {
            "sha": "2f69e3ce40414825a833804a978edef50197db4a",
            "filename": "goldens/size-tracking/integration-payloads.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/goldens%2Fsize-tracking%2Fintegration-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Fintegration-payloads.json?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -62,7 +62,7 @@\n         \"bundle\": \"TODO(i): we should define ngDevMode to false in Closure, but --define only works in the global scope.\",\n         \"bundle\": \"TODO(i): (FW-2164) TS 3.9 new class shape seems to have broken Closure in big ways. The size went from 169991 to 252338\",\n         \"bundle\": \"TODO(i): after removal of tsickle from ngc-wrapped / ng_package, we had to switch to SIMPLE optimizations which increased the size from 252338 to 1198917, see PR#37221 and PR#37317 for more info\",\n-        \"bundle\": 1212027\n+        \"bundle\": 1213130\n       }\n     }\n   }"
        },
        {
            "sha": "7ea4307567475487522abfe127d7c23adbf1ed3d",
            "filename": "packages/core/src/render3/instructions/lview_debug.ts",
            "status": "modified",
            "additions": 59,
            "deletions": 34,
            "changes": 93,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Flview_debug.ts?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -15,15 +15,14 @@ import {createNamedArrayType} from '../../util/named_array_type';\n import {initNgDevMode} from '../../util/ng_dev_mode';\n import {CONTAINER_HEADER_OFFSET, HAS_TRANSPLANTED_VIEWS, LContainer, MOVED_VIEWS, NATIVE} from '../interfaces/container';\n import {DirectiveDefList, PipeDefList, ViewQueriesFunction} from '../interfaces/definition';\n-import {COMMENT_MARKER, ELEMENT_MARKER, I18nMutateOpCode, I18nMutateOpCodes, I18nUpdateOpCode, I18nUpdateOpCodes, TIcu} from '../interfaces/i18n';\n-import {PropertyAliases, TConstants, TContainerNode, TElementNode, TNode as ITNode, TNodeFlags, TNodeProviderIndexes, TNodeType, TViewNode} from '../interfaces/node';\n+import {PropertyAliases, TConstants, TContainerNode, TElementNode, TNode as ITNode, TNodeFlags, TNodeProviderIndexes, TNodeType, TNodeTypeAsString, TViewNode} from '../interfaces/node';\n import {SelectorFlags} from '../interfaces/projection';\n import {LQueries, TQueries} from '../interfaces/query';\n import {RComment, RElement, Renderer3, RendererFactory3, RNode} from '../interfaces/renderer';\n import {getTStylingRangeNext, getTStylingRangeNextDuplicate, getTStylingRangePrev, getTStylingRangePrevDuplicate, TStylingKey, TStylingRange} from '../interfaces/styling';\n-import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DECLARATION_VIEW, DestroyHookData, ExpandoInstructions, FLAGS, HEADER_OFFSET, HookData, HOST, INJECTOR, LView, LViewFlags, NEXT, PARENT, QUERIES, RENDERER, RENDERER_FACTORY, SANITIZER, T_HOST, TData, TVIEW, TView as ITView, TView, TViewType} from '../interfaces/view';\n+import {CHILD_HEAD, CHILD_TAIL, CLEANUP, CONTEXT, DebugNode, DECLARATION_VIEW, DestroyHookData, ExpandoInstructions, FLAGS, HEADER_OFFSET, HookData, HOST, INJECTOR, LContainerDebug as ILContainerDebug, LView, LViewDebug as ILViewDebug, LViewDebugRange, LViewDebugRangeContent, LViewFlags, NEXT, PARENT, QUERIES, RENDERER, RENDERER_FACTORY, SANITIZER, T_HOST, TData, TView as ITView, TVIEW, TView, TViewType} from '../interfaces/view';\n import {attachDebugObject} from '../util/debug_utils';\n-import {getTNode, unwrapRNode} from '../util/view_utils';\n+import {unwrapRNode} from '../util/view_utils';\n \n const NG_DEV_MODE = ((typeof ngDevMode === 'undefined' || !!ngDevMode) && initNgDevMode());\n \n@@ -143,7 +142,10 @@ export const TViewConstructor = class TView implements ITView {\n       public firstChild: ITNode|null,                        //\n       public schemas: SchemaMetadata[]|null,                 //\n       public consts: TConstants|null,                        //\n-      public incompleteFirstPass: boolean                    //\n+      public incompleteFirstPass: boolean,                   //\n+      public _decls: number,                                 //\n+      public _vars: number,                                  //\n+\n   ) {}\n \n   get template_(): string {\n@@ -335,9 +337,9 @@ export function attachLContainerDebug(lContainer: LContainer) {\n   attachDebugObject(lContainer, new LContainerDebug(lContainer));\n }\n \n-export function toDebug(obj: LView): LViewDebug;\n-export function toDebug(obj: LView|null): LViewDebug|null;\n-export function toDebug(obj: LView|LContainer|null): LViewDebug|LContainerDebug|null;\n+export function toDebug(obj: LView): ILViewDebug;\n+export function toDebug(obj: LView|null): ILViewDebug|null;\n+export function toDebug(obj: LView|LContainer|null): ILViewDebug|ILContainerDebug|null;\n export function toDebug(obj: any): any {\n   if (obj) {\n     const debug = (obj as any).debug;\n@@ -375,7 +377,7 @@ function toHtml(value: any, includeChildren: boolean = false): string|null {\n   }\n }\n \n-export class LViewDebug {\n+export class LViewDebug implements ILViewDebug {\n   constructor(private readonly _raw_lView: LView) {}\n \n   /**\n@@ -396,10 +398,10 @@ export class LViewDebug {\n       indexWithinInitPhase: flags >> LViewFlags.IndexWithinInitPhaseShift,\n     };\n   }\n-  get parent(): LViewDebug|LContainerDebug|null {\n+  get parent(): ILViewDebug|ILContainerDebug|null {\n     return toDebug(this._raw_lView[PARENT]);\n   }\n-  get host(): string|null {\n+  get hostHTML(): string|null {\n     return toHtml(this._raw_lView[HOST], true);\n   }\n   get html(): string {\n@@ -410,10 +412,9 @@ export class LViewDebug {\n   }\n   /**\n    * The tree of nodes associated with the current `LView`. The nodes have been normalized into\n-   * a\n-   * tree structure with relevant details pulled out for readability.\n+   * a tree structure with relevant details pulled out for readability.\n    */\n-  get nodes(): DebugNode[]|null {\n+  get nodes(): DebugNode[] {\n     const lView = this._raw_lView;\n     const tNode = lView[TVIEW].firstChild;\n     return toDebugNodes(tNode, lView);\n@@ -437,16 +438,16 @@ export class LViewDebug {\n   get sanitizer(): Sanitizer|null {\n     return this._raw_lView[SANITIZER];\n   }\n-  get childHead(): LViewDebug|LContainerDebug|null {\n+  get childHead(): ILViewDebug|ILContainerDebug|null {\n     return toDebug(this._raw_lView[CHILD_HEAD]);\n   }\n-  get next(): LViewDebug|LContainerDebug|null {\n+  get next(): ILViewDebug|ILContainerDebug|null {\n     return toDebug(this._raw_lView[NEXT]);\n   }\n-  get childTail(): LViewDebug|LContainerDebug|null {\n+  get childTail(): ILViewDebug|ILContainerDebug|null {\n     return toDebug(this._raw_lView[CHILD_TAIL]);\n   }\n-  get declarationView(): LViewDebug|null {\n+  get declarationView(): ILViewDebug|null {\n     return toDebug(this._raw_lView[DECLARATION_VIEW]);\n   }\n   get queries(): LQueries|null {\n@@ -456,11 +457,35 @@ export class LViewDebug {\n     return this._raw_lView[T_HOST];\n   }\n \n+  get decls(): LViewDebugRange {\n+    const tView = this.tView as any as {_decls: number, _vars: number};\n+    const start = HEADER_OFFSET;\n+    return toLViewRange(this.tView, this._raw_lView, start, start + tView._decls);\n+  }\n+\n+  get vars(): LViewDebugRange {\n+    const tView = this.tView as any as {_decls: number, _vars: number};\n+    const start = HEADER_OFFSET + tView._decls;\n+    return toLViewRange(this.tView, this._raw_lView, start, start + tView._vars);\n+  }\n+\n+  get i18n(): LViewDebugRange {\n+    const tView = this.tView as any as {_decls: number, _vars: number};\n+    const start = HEADER_OFFSET + tView._decls + tView._vars;\n+    return toLViewRange(this.tView, this._raw_lView, start, this.tView.expandoStartIndex);\n+  }\n+\n+  get expando(): LViewDebugRange {\n+    const tView = this.tView as any as {_decls: number, _vars: number};\n+    return toLViewRange(\n+        this.tView, this._raw_lView, this.tView.expandoStartIndex, this._raw_lView.length);\n+  }\n+\n   /**\n    * Normalized view of child views (and containers) attached at this location.\n    */\n-  get childViews(): Array<LViewDebug|LContainerDebug> {\n-    const childViews: Array<LViewDebug|LContainerDebug> = [];\n+  get childViews(): Array<ILViewDebug|ILContainerDebug> {\n+    const childViews: Array<ILViewDebug|ILContainerDebug> = [];\n     let child = this.childHead;\n     while (child) {\n       childViews.push(child);\n@@ -470,11 +495,12 @@ export class LViewDebug {\n   }\n }\n \n-export interface DebugNode {\n-  html: string|null;\n-  native: Node;\n-  nodes: DebugNode[]|null;\n-  component: LViewDebug|null;\n+function toLViewRange(tView: TView, lView: LView, start: number, end: number): LViewDebugRange {\n+  let content: LViewDebugRangeContent[] = [];\n+  for (let index = start; index < end; index++) {\n+    content.push({index: index, t: tView.data[index], l: lView[index]});\n+  }\n+  return {start: start, end: end, length: end - start, content: content};\n }\n \n /**\n@@ -483,7 +509,7 @@ export interface DebugNode {\n  * @param tNode\n  * @param lView\n  */\n-export function toDebugNodes(tNode: ITNode|null, lView: LView): DebugNode[]|null {\n+export function toDebugNodes(tNode: ITNode|null, lView: LView): DebugNode[] {\n   if (tNode) {\n     const debugNodes: DebugNode[] = [];\n     let tNodeCursor: ITNode|null = tNode;\n@@ -493,33 +519,32 @@ export function toDebugNodes(tNode: ITNode|null, lView: LView): DebugNode[]|null\n     }\n     return debugNodes;\n   } else {\n-    return null;\n+    return [];\n   }\n }\n \n export function buildDebugNode(tNode: ITNode, lView: LView, nodeIndex: number): DebugNode {\n   const rawValue = lView[nodeIndex];\n   const native = unwrapRNode(rawValue);\n-  const componentLViewDebug = toDebug(readLViewValue(rawValue));\n   return {\n     html: toHtml(native),\n+    type: TNodeTypeAsString[tNode.type],\n     native: native as any,\n-    nodes: toDebugNodes(tNode.child, lView),\n-    component: componentLViewDebug,\n+    children: toDebugNodes(tNode.child, lView),\n   };\n }\n \n-export class LContainerDebug {\n+export class LContainerDebug implements ILContainerDebug {\n   constructor(private readonly _raw_lContainer: LContainer) {}\n \n   get hasTransplantedViews(): boolean {\n     return this._raw_lContainer[HAS_TRANSPLANTED_VIEWS];\n   }\n-  get views(): LViewDebug[] {\n+  get views(): ILViewDebug[] {\n     return this._raw_lContainer.slice(CONTAINER_HEADER_OFFSET)\n-        .map(toDebug as (l: LView) => LViewDebug);\n+        .map(toDebug as (l: LView) => ILViewDebug);\n   }\n-  get parent(): LViewDebug|LContainerDebug|null {\n+  get parent(): ILViewDebug|null {\n     return toDebug(this._raw_lContainer[PARENT]);\n   }\n   get movedViews(): LView[]|null {"
        },
        {
            "sha": "929a5fa78c6d8d5a7940c11791fa3512d48ba6f0",
            "filename": "packages/core/src/render3/instructions/shared.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finstructions%2Fshared.ts?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -699,7 +699,9 @@ export function createTView(\n              null,                                           // firstChild: TNode|null,\n              schemas,                                        // schemas: SchemaMetadata[]|null,\n              consts,                                         // consts: TConstants|null\n-             false                                           // incompleteFirstPass: boolean\n+             false,                                          // incompleteFirstPass: boolean\n+             decls,                                          // ngDevMode only: decls\n+             vars,                                           // ngDevMode only: vars\n              ) :\n       {\n         type: type,"
        },
        {
            "sha": "468423206537b0e1fe5cbddef16e447bce60aacc",
            "filename": "packages/core/src/render3/interfaces/node.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 3,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fnode.ts",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fnode.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fnode.ts?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -7,14 +7,11 @@\n  */\n import {KeyValueArray} from '../../util/array_utils';\n import {TStylingRange} from '../interfaces/styling';\n-\n-import {DirectiveDef} from './definition';\n import {CssSelector} from './projection';\n import {RNode} from './renderer';\n import {LView, TView} from './view';\n \n \n-\n /**\n  * TNodeType corresponds to the {@link TNode} `type` property.\n  */\n@@ -45,6 +42,20 @@ export const enum TNodeType {\n   IcuContainer = 5,\n }\n \n+/**\n+ * Converts `TNodeType` into human readable text.\n+ * Make sure this matches with `TNodeType`\n+ */\n+export const TNodeTypeAsString = [\n+  'Container',         // 0\n+  'Projection',        // 1\n+  'View',              // 2\n+  'Element',           // 3\n+  'ElementContainer',  // 4\n+  'IcuContainer'       // 5\n+] as const;\n+\n+\n /**\n  * Corresponds to the TNode.flags property.\n  */"
        },
        {
            "sha": "0aec9344b340d9f46db7cd5c50ffa3e140041602",
            "filename": "packages/core/src/render3/interfaces/view.ts",
            "status": "modified",
            "additions": 198,
            "deletions": 2,
            "changes": 200,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Finterfaces%2Fview.ts?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -15,10 +15,10 @@ import {Sanitizer} from '../../sanitization/sanitizer';\n import {LContainer} from './container';\n import {ComponentDef, ComponentTemplate, DirectiveDef, DirectiveDefList, HostBindingsFunction, PipeDef, PipeDefList, ViewQueriesFunction} from './definition';\n import {I18nUpdateOpCodes, TI18n} from './i18n';\n-import {TConstants, TElementNode, TNode, TViewNode} from './node';\n+import {TConstants, TElementNode, TNode, TNodeTypeAsString, TViewNode} from './node';\n import {PlayerHandler} from './player';\n import {LQueries, TQueries} from './query';\n-import {RElement, Renderer3, RendererFactory3} from './renderer';\n+import {RComment, RElement, Renderer3, RendererFactory3} from './renderer';\n import {TStylingKey, TStylingRange} from './styling';\n \n \n@@ -69,6 +69,15 @@ export interface OpaqueViewState {\n  * don't have to edit the data array based on which views are present.\n  */\n export interface LView extends Array<any> {\n+  /**\n+   * Human readable representation of the `LView`.\n+   *\n+   * NOTE: This property only exists if `ngDevMode` is set to `true` and it is not present in\n+   * production. Its presence is purely to help debug issue in development, and should not be relied\n+   * on in production application.\n+   */\n+  debug?: LViewDebug;\n+\n   /**\n    * The host node for this LView instance, if this is a component view.\n    * If this is an embedded view, HOST will be null.\n@@ -826,3 +835,190 @@ export type TData =\n // Note: This hack is necessary so we don't erroneously get a circular dependency\n // failure based on types.\n export const unusedValueExportToPlacateAjd = 1;\n+\n+/**\n+ * Human readable version of the `LView`.\n+ *\n+ * `LView` is a data structure used internally to keep track of views. The `LView` is designed for\n+ * efficiency and so at times it is difficult to read or write tests which assert on its values. For\n+ * this reason when `ngDevMode` is true we patch a `LView.debug` property which points to\n+ * `LViewDebug` for easier debugging and test writing. It is the intent of `LViewDebug` to be used\n+ * in tests.\n+ */\n+export interface LViewDebug {\n+  /**\n+   * Flags associated with the `LView` unpacked into a more readable state.\n+   *\n+   * See `LViewFlags` for the flag meanings.\n+   */\n+  readonly flags: {\n+    initPhaseState: number,\n+    creationMode: boolean,\n+    firstViewPass: boolean,\n+    checkAlways: boolean,\n+    dirty: boolean,\n+    attached: boolean,\n+    destroyed: boolean,\n+    isRoot: boolean,\n+    indexWithinInitPhase: number,\n+  };\n+\n+  /**\n+   * Parent view (or container)\n+   */\n+  readonly parent: LViewDebug|LContainerDebug|null;\n+\n+  /**\n+   * Next sibling to the `LView`.\n+   */\n+  readonly next: LViewDebug|LContainerDebug|null;\n+\n+  /**\n+   * The context used for evaluation of the `LView`\n+   *\n+   * (Usually the component)\n+   */\n+  readonly context: {}|null;\n+\n+  /**\n+   * Hierarchical tree of nodes.\n+   */\n+  readonly nodes: DebugNode[];\n+\n+  /**\n+   * HTML representation of the `LView`.\n+   *\n+   * This is only approximate to actual HTML as child `LView`s are removed.\n+   */\n+  readonly html: string;\n+\n+  /**\n+   * The host element to which this `LView` is attached.\n+   */\n+  readonly hostHTML: string|null;\n+\n+  /**\n+   * Child `LView`s\n+   */\n+  readonly childViews: Array<LViewDebug|LContainerDebug>;\n+\n+  /**\n+   * Sub range of `LView` containing decls (DOM elements).\n+   */\n+  readonly decls: LViewDebugRange;\n+\n+  /**\n+   * Sub range of `LView` containing vars (bindings).\n+   */\n+  readonly vars: LViewDebugRange;\n+\n+  /**\n+   * Sub range of `LView` containing i18n (translated DOM elements).\n+   */\n+  readonly i18n: LViewDebugRange;\n+\n+  /**\n+   * Sub range of `LView` containing expando (used by DI).\n+   */\n+  readonly expando: LViewDebugRange;\n+}\n+\n+/**\n+ * Human readable version of the `LContainer`\n+ *\n+ * `LContainer` is a data structure used internally to keep track of child views. The `LContainer`\n+ * is designed for efficiency and so at times it is difficult to read or write tests which assert on\n+ * its values. For this reason when `ngDevMode` is true we patch a `LContainer.debug` property which\n+ * points to `LContainerDebug` for easier debugging and test writing. It is the intent of\n+ * `LContainerDebug` to be used in tests.\n+ */\n+export interface LContainerDebug {\n+  readonly native: RComment;\n+  /**\n+   * Child `LView`s.\n+   */\n+  readonly views: LViewDebug[];\n+  readonly parent: LViewDebug|null;\n+  readonly movedViews: LView[]|null;\n+  readonly host: RElement|RComment|LView;\n+  readonly next: LViewDebug|LContainerDebug|null;\n+  readonly hasTransplantedViews: boolean;\n+}\n+\n+\n+\n+/**\n+ * `LView` is subdivided to ranges where the actual data is stored. Some of these ranges such as\n+ * `decls` and `vars` are known at compile time. Other such as `i18n` and `expando` are runtime only\n+ * concepts.\n+ */\n+export interface LViewDebugRange {\n+  /**\n+   * The starting index in `LView` where the range begins. (Inclusive)\n+   */\n+  start: number;\n+\n+  /**\n+   * The ending index in `LView` where the range ends. (Exclusive)\n+   */\n+  end: number;\n+\n+  /**\n+   * The length of the range\n+   */\n+  length: number;\n+\n+  /**\n+   * The merged content of the range. `t` contains data from `TView.data` and `l` contains `LView`\n+   * data at an index.\n+   */\n+  content: LViewDebugRangeContent[];\n+}\n+\n+/**\n+ * For convenience the static and instance portions of `TView` and `LView` are merged into a single\n+ * object in `LViewRange`.\n+ */\n+export interface LViewDebugRangeContent {\n+  /**\n+   * Index into original `LView` or `TView.data`.\n+   */\n+  index: number;\n+\n+  /**\n+   * Value from the `TView.data[index]` location.\n+   */\n+  t: any;\n+\n+  /**\n+   * Value from the `LView[index]` location.\n+   */\n+  l: any;\n+}\n+\n+\n+/**\n+ * A logical node which comprise into `LView`s.\n+ *\n+ */\n+export interface DebugNode {\n+  /**\n+   * HTML representation of the node.\n+   */\n+  html: string|null;\n+\n+  /**\n+   * Human readable node type.\n+   */\n+  type: typeof TNodeTypeAsString[number];\n+\n+  /**\n+   * DOM native node.\n+   */\n+  native: Node;\n+\n+  /**\n+   * Child nodes\n+   */\n+  children: DebugNode[];\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "94de7d03d58248dbfe3873de0a473dafc7e52943",
            "filename": "packages/core/src/render3/util/discovery_utils.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Futil%2Fdiscovery_utils.ts?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -10,12 +10,12 @@ import {Injector} from '../../di/injector';\n import {assertLView} from '../assert';\n import {discoverLocalRefs, getComponentAtNodeIndex, getDirectivesAtNodeIndex, getLContext} from '../context_discovery';\n import {NodeInjector} from '../di';\n-import {buildDebugNode, DebugNode} from '../instructions/lview_debug';\n+import {buildDebugNode} from '../instructions/lview_debug';\n import {LContext} from '../interfaces/context';\n import {DirectiveDef} from '../interfaces/definition';\n import {TElementNode, TNode, TNodeProviderIndexes} from '../interfaces/node';\n import {isLView} from '../interfaces/type_checks';\n-import {CLEANUP, CONTEXT, FLAGS, HEADER_OFFSET, HOST, LView, LViewFlags, T_HOST, TVIEW} from '../interfaces/view';\n+import {CLEANUP, CONTEXT, DebugNode, FLAGS, HEADER_OFFSET, HOST, LView, LViewFlags, T_HOST, TVIEW} from '../interfaces/view';\n \n import {stringifyForError} from './misc_utils';\n import {getLViewParent, getRootContext} from './view_traversal_utils';"
        },
        {
            "sha": "a32706052a99934594d2eeeaa876e9a24b28628f",
            "filename": "packages/core/test/acceptance/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Facceptance%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Facceptance%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2FBUILD.bazel?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -20,6 +20,7 @@ ts_library(\n         \"//packages/compiler/testing\",\n         \"//packages/core\",\n         \"//packages/core/src/util\",\n+        \"//packages/core/test/render3:matchers\",\n         \"//packages/core/testing\",\n         \"//packages/localize\",\n         \"//packages/localize/init\","
        },
        {
            "sha": "ef1e3d3ea39d9e651e2e2cba3302eee87bc1895d",
            "filename": "packages/core/test/acceptance/debug_spec.ts",
            "status": "modified",
            "additions": 56,
            "deletions": 7,
            "changes": 63,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Facceptance%2Fdebug_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Facceptance%2Fdebug_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fdebug_spec.ts?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -8,13 +8,17 @@\n \n import {Component} from '@angular/core';\n import {getLContext} from '@angular/core/src/render3/context_discovery';\n-import {LViewDebug, toDebug} from '@angular/core/src/render3/instructions/lview_debug';\n+import {LViewDebug} from '@angular/core/src/render3/instructions/lview_debug';\n+import {TNodeType} from '@angular/core/src/render3/interfaces/node';\n+import {HEADER_OFFSET} from '@angular/core/src/render3/interfaces/view';\n import {TestBed} from '@angular/core/testing';\n import {expect} from '@angular/platform-browser/testing/src/matchers';\n import {onlyInIvy} from '@angular/private/testing';\n \n-describe('Debug Representation', () => {\n-  onlyInIvy('Ivy specific').it('should generate a human readable version', () => {\n+import {matchDomElement, matchDomText, matchTI18n, matchTNode} from '../render3/matchers';\n+\n+onlyInIvy('Ivy specific').describe('Debug Representation', () => {\n+  it('should generate a human readable version', () => {\n     @Component({selector: 'my-comp', template: '<div id=\"123\">Hello World</div>'})\n     class MyComponent {\n     }\n@@ -23,11 +27,56 @@ describe('Debug Representation', () => {\n     const fixture = TestBed.createComponent(MyComponent);\n     fixture.detectChanges();\n \n-    const hostView = toDebug(getLContext(fixture.componentInstance)!.lView);\n-    expect(hostView.host).toEqual(null);\n+    const hostView = getLContext(fixture.componentInstance)!.lView.debug!;\n+    expect(hostView.hostHTML).toEqual(null);\n     const myCompView = hostView.childViews[0] as LViewDebug;\n-    expect(myCompView.host).toContain('<div id=\"123\">Hello World</div>');\n+    expect(myCompView.hostHTML).toContain('<div id=\"123\">Hello World</div>');\n     expect(myCompView.nodes![0].html).toEqual('<div id=\"123\">');\n-    expect(myCompView.nodes![0].nodes![0].html).toEqual('Hello World');\n+    expect(myCompView.nodes![0].children![0].html).toEqual('Hello World');\n+  });\n+\n+  describe('LViewDebug', () => {\n+    describe('range', () => {\n+      it('should show ranges', () => {\n+        @Component({selector: 'my-comp', template: '<div i18n>Hello {{name}}</div>'})\n+        class MyComponent {\n+          name = 'World';\n+        }\n+\n+        TestBed.configureTestingModule({declarations: [MyComponent]});\n+        const fixture = TestBed.createComponent(MyComponent);\n+        fixture.detectChanges();\n+\n+        const hostView = getLContext(fixture.componentInstance)!.lView.debug!;\n+        const myComponentView = hostView.childViews[0] as LViewDebug;\n+        expect(myComponentView.decls).toEqual({\n+          start: HEADER_OFFSET,\n+          end: HEADER_OFFSET + 2,\n+          length: 2,\n+          content: [\n+            {index: HEADER_OFFSET + 0, t: matchTNode({tagName: 'div'}), l: matchDomElement('div')},\n+            {index: HEADER_OFFSET + 1, t: matchTI18n(), l: null},\n+          ]\n+        });\n+        expect(myComponentView.vars).toEqual({\n+          start: HEADER_OFFSET + 2,\n+          end: HEADER_OFFSET + 3,\n+          length: 1,\n+          content: [{index: HEADER_OFFSET + 2, t: null, l: 'World'}]\n+        });\n+        expect(myComponentView.i18n).toEqual({\n+          start: HEADER_OFFSET + 3,\n+          end: HEADER_OFFSET + 4,\n+          length: 1,\n+          content: [{\n+            index: HEADER_OFFSET + 3,\n+            t: matchTNode({type: TNodeType.Element, tagName: null}),\n+            l: matchDomText('Hello World')\n+          }]\n+        });\n+        expect(myComponentView.expando)\n+            .toEqual({start: HEADER_OFFSET + 4, end: HEADER_OFFSET + 4, length: 0, content: []});\n+      });\n+    });\n   });\n });"
        },
        {
            "sha": "66855c2a1df2dd371c7ffdd0e3ab71d39d233264",
            "filename": "packages/core/test/render3/BUILD.bazel",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Frender3%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Frender3%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2FBUILD.bazel?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -11,10 +11,13 @@ ts_library(\n             \"**/*_perf.ts\",\n             \"domino.d.ts\",\n             \"load_domino.ts\",\n+            \"is_shape_of.ts\",\n             \"jit_spec.ts\",\n+            \"matchers.ts\",\n         ],\n     ),\n     deps = [\n+        \":matchers\",\n         \"//packages:types\",\n         \"//packages/animations\",\n         \"//packages/animations/browser\",\n@@ -34,6 +37,18 @@ ts_library(\n     ],\n )\n \n+ts_library(\n+    name = \"matchers\",\n+    testonly = True,\n+    srcs = [\n+        \"is_shape_of.ts\",\n+        \"matchers.ts\",\n+    ],\n+    deps = [\n+        \"//packages/core\",\n+    ],\n+)\n+\n ts_library(\n     name = \"domino\",\n     testonly = True,"
        },
        {
            "sha": "cd2a3a1516d3e8808543d17bab4cb07065d20c9f",
            "filename": "packages/core/test/render3/interfaces/node_spec.ts",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Frender3%2Finterfaces%2Fnode_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Frender3%2Finterfaces%2Fnode_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Finterfaces%2Fnode_spec.ts?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -0,0 +1,22 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {TNodeType, TNodeTypeAsString} from '@angular/core/src/render3/interfaces/node';\n+\n+describe('node interfaces', () => {\n+  describe('TNodeType', () => {\n+    it('should agree with TNodeTypeAsString', () => {\n+      expect(TNodeTypeAsString[TNodeType.Container]).toEqual('Container');\n+      expect(TNodeTypeAsString[TNodeType.Projection]).toEqual('Projection');\n+      expect(TNodeTypeAsString[TNodeType.View]).toEqual('View');\n+      expect(TNodeTypeAsString[TNodeType.Element]).toEqual('Element');\n+      expect(TNodeTypeAsString[TNodeType.ElementContainer]).toEqual('ElementContainer');\n+      expect(TNodeTypeAsString[TNodeType.IcuContainer]).toEqual('IcuContainer');\n+    });\n+  });\n+});\n\\ No newline at end of file"
        },
        {
            "sha": "86bbf66b86d17efa4d0fbad551acae249cb46237",
            "filename": "packages/core/test/render3/is_shape_of.ts",
            "status": "added",
            "additions": 186,
            "deletions": 0,
            "changes": 186,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Frender3%2Fis_shape_of.ts",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Frender3%2Fis_shape_of.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fis_shape_of.ts?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -0,0 +1,186 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {TI18n} from '@angular/core/src/render3/interfaces/i18n';\n+import {TNode} from '@angular/core/src/render3/interfaces/node';\n+import {TView} from '@angular/core/src/render3/interfaces/view';\n+\n+/**\n+ * A type used to create a runtime representation of a shape of object which matches the declared\n+ * interface at compile time.\n+ *\n+ * The purpose of this type is to ensure that the object must match all of the properties of a type.\n+ * This is later used by `isShapeOf` method to ensure that a particular object has a particular\n+ * shape.\n+ *\n+ * ```\n+ * interface MyShape {\n+ *   foo: string,\n+ *   bar: number\n+ * }\n+ *\n+ * const myShapeObj: {foo: '', bar: 0};\n+ * const ExpectedPropertiesOfShape = {foo: true, bar: true};\n+ *\n+ * isShapeOf(myShapeObj, ExpectedPropertiesOfShape);\n+ * ```\n+ *\n+ * The above code would verify that `myShapeObj` has `foo` and `bar` properties. However if later\n+ * `MyShape` is refactored to change a set of properties we would like to have a compile time error\n+ * that the `ExpectedPropertiesOfShape` also needs to be changed.\n+ *\n+ * ```\n+ * const ExpectedPropertiesOfShape = <ShapeOf<MyShape>>{foo: true, bar: true};\n+ * ```\n+ * The above code will force through compile time checks that the `ExpectedPropertiesOfShape` match\n+ * that of `MyShape`.\n+ *\n+ * See: `isShapeOf`\n+ *\n+ */\n+export type ShapeOf<T> = {\n+  [P in keyof T]: true;\n+};\n+\n+/**\n+ * Determines if a particular object is of a given shape (duck-type version of `instanceof`.)\n+ *\n+ * ```\n+ * isShapeOf(someObj, {foo: true, bar: true});\n+ * ```\n+ *\n+ * The above code will be true if the `someObj` has both `foo` and `bar` property\n+ *\n+ * @param obj Object to test for.\n+ * @param shapeOf Desired shape.\n+ */\n+export function isShapeOf<T>(obj: any, shapeOf: ShapeOf<T>): obj is T {\n+  if (typeof obj === 'object' && obj) {\n+    return Object.keys(shapeOf).reduce(\n+        (prev, key) => prev && obj.hasOwnProperty(key), true as boolean);\n+  }\n+  return false;\n+}\n+\n+/**\n+ * Determines if `obj` matches the shape `TI18n`.\n+ * @param obj\n+ */\n+export function isTI18n(obj: any): obj is TI18n {\n+  return isShapeOf<TI18n>(obj, ShapeOfTI18n);\n+}\n+const ShapeOfTI18n: ShapeOf<TI18n> = {\n+  vars: true,\n+  create: true,\n+  update: true,\n+  icus: true,\n+};\n+\n+\n+/**\n+ * Determines if `obj` matches the shape `TView`.\n+ * @param obj\n+ */\n+export function isTView(obj: any): obj is TView {\n+  return isShapeOf<TView>(obj, ShapeOfTView);\n+}\n+const ShapeOfTView: ShapeOf<TView> = {\n+  type: true,\n+  id: true,\n+  blueprint: true,\n+  template: true,\n+  viewQuery: true,\n+  node: true,\n+  firstCreatePass: true,\n+  firstUpdatePass: true,\n+  data: true,\n+  bindingStartIndex: true,\n+  expandoStartIndex: true,\n+  staticViewQueries: true,\n+  staticContentQueries: true,\n+  firstChild: true,\n+  expandoInstructions: true,\n+  directiveRegistry: true,\n+  pipeRegistry: true,\n+  preOrderHooks: true,\n+  preOrderCheckHooks: true,\n+  contentHooks: true,\n+  contentCheckHooks: true,\n+  viewHooks: true,\n+  viewCheckHooks: true,\n+  destroyHooks: true,\n+  cleanup: true,\n+  components: true,\n+  queries: true,\n+  contentQueries: true,\n+  schemas: true,\n+  consts: true,\n+  incompleteFirstPass: true,\n+};\n+\n+\n+/**\n+ * Determines if `obj` matches the shape `TI18n`.\n+ * @param obj\n+ */\n+export function isTNode(obj: any): obj is TNode {\n+  return isShapeOf<TNode>(obj, ShapeOfTNode);\n+}\n+const ShapeOfTNode: ShapeOf<TNode> = {\n+  type: true,\n+  index: true,\n+  injectorIndex: true,\n+  directiveStart: true,\n+  directiveEnd: true,\n+  directiveStylingLast: true,\n+  propertyBindings: true,\n+  flags: true,\n+  providerIndexes: true,\n+  tagName: true,\n+  attrs: true,\n+  mergedAttrs: true,\n+  localNames: true,\n+  initialInputs: true,\n+  inputs: true,\n+  outputs: true,\n+  tViews: true,\n+  next: true,\n+  projectionNext: true,\n+  child: true,\n+  parent: true,\n+  projection: true,\n+  styles: true,\n+  stylesWithoutHost: true,\n+  residualStyles: true,\n+  classes: true,\n+  classesWithoutHost: true,\n+  residualClasses: true,\n+  classBindings: true,\n+  styleBindings: true,\n+};\n+\n+/**\n+ * Determines if `obj` is DOM `Node`.\n+ */\n+export function isDOMNode(obj: any): obj is Node {\n+  return obj instanceof Node;\n+}\n+\n+/**\n+ * Determines if `obj` is DOM `Text`.\n+ */\n+export function isDOMElement(obj: any): obj is Element {\n+  return obj instanceof Element;\n+}\n+\n+/**\n+ * Determines if `obj` is DOM `Text`.\n+ */\n+export function isDOMText(obj: any): obj is Text {\n+  return obj instanceof Text;\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "43818a396d22cdafb5e8a11534ec7e63a8e8c9c4",
            "filename": "packages/core/test/render3/is_shape_of_spec.ts",
            "status": "added",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Frender3%2Fis_shape_of_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Frender3%2Fis_shape_of_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fis_shape_of_spec.ts?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -0,0 +1,37 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {isShapeOf, ShapeOf} from './is_shape_of';\n+\n+describe('isShapeOf', () => {\n+  const ShapeOfEmptyObject: ShapeOf<{}> = {};\n+  it('should not match for non objects', () => {\n+    expect(isShapeOf(null, ShapeOfEmptyObject)).toBeFalse();\n+    expect(isShapeOf(0, ShapeOfEmptyObject)).toBeFalse();\n+    expect(isShapeOf(1, ShapeOfEmptyObject)).toBeFalse();\n+    expect(isShapeOf(true, ShapeOfEmptyObject)).toBeFalse();\n+    expect(isShapeOf(false, ShapeOfEmptyObject)).toBeFalse();\n+    expect(isShapeOf(undefined, ShapeOfEmptyObject)).toBeFalse();\n+  });\n+\n+  it('should match on empty object', () => {\n+    expect(isShapeOf({}, ShapeOfEmptyObject)).toBeTrue();\n+    expect(isShapeOf({extra: 'is ok'}, ShapeOfEmptyObject)).toBeTrue();\n+  });\n+\n+  it('should match on shape', () => {\n+    expect(isShapeOf({required: 1}, {required: true})).toBeTrue();\n+    expect(isShapeOf({required: true, extra: 'is ok'}, {required: true})).toBeTrue();\n+  });\n+\n+  it('should not match if missing property', () => {\n+    expect(isShapeOf({required: 1}, {required: true, missing: true})).toBeFalse();\n+    expect(isShapeOf({required: true, extra: 'is ok'}, {required: true, missing: true}))\n+        .toBeFalse();\n+  });\n+});\n\\ No newline at end of file"
        },
        {
            "sha": "59826612ab0231bef59b5dd08df1678f80514ed7",
            "filename": "packages/core/test/render3/matchers.ts",
            "status": "added",
            "additions": 218,
            "deletions": 0,
            "changes": 218,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Frender3%2Fmatchers.ts",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Frender3%2Fmatchers.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fmatchers.ts?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -0,0 +1,218 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {TI18n} from '@angular/core/src/render3/interfaces/i18n';\n+import {TNode} from '@angular/core/src/render3/interfaces/node';\n+import {TView} from '@angular/core/src/render3/interfaces/view';\n+\n+import {isDOMElement, isDOMText, isTI18n, isTNode, isTView} from './is_shape_of';\n+\n+\n+/**\n+ * Generic matcher which asserts that an object is of a given shape (`shapePredicate`) and that it\n+ * contains a subset of properties.\n+ *\n+ * @param name Name of `shapePredicate` to display when assertion fails.\n+ * @param shapePredicate Predicate which verifies that the object is of correct shape.\n+ * @param expected Expected set of properties to be found on the object.\n+ */\n+export function matchObjectShape<T>(\n+    name: string, shapePredicate: (obj: any) => obj is T,\n+    expected: Partial<T> = {}): jasmine.AsymmetricMatcher<T> {\n+  const matcher = function() {};\n+  let _actual: any = null;\n+\n+  matcher.asymmetricMatch = function(actual: any) {\n+    _actual = actual;\n+    if (!shapePredicate(actual)) return false;\n+    for (const key in expected) {\n+      if (expected.hasOwnProperty(key) && !jasmine.matchersUtil.equals(actual[key], expected[key]))\n+        return false;\n+    }\n+    return true;\n+  };\n+  matcher.jasmineToString = function() {\n+    return `${toString(_actual, false)} != ${toString(expected, true)})`;\n+  };\n+\n+  function toString(obj: any, isExpected: boolean) {\n+    if (isExpected || shapePredicate(obj)) {\n+      const props =\n+          Object.keys(expected).map(key => `${key}: ${JSON.stringify((obj as any)[key])}`);\n+      if (isExpected === false) {\n+        // Push something to let the user know that there may be other ignored properties in actual\n+        props.push('...');\n+      }\n+      return `${name}({${props.length === 0 ? '' : '\\n  ' + props.join(',\\n  ') + '\\n'}})`;\n+    } else {\n+      return JSON.stringify(obj);\n+    }\n+  }\n+  return matcher;\n+}\n+\n+\n+/**\n+ * Asymmetric matcher which matches a `TView` of a given shape.\n+ *\n+ * Expected usage:\n+ * ```\n+ * expect(tNode).toEqual(matchTView({type: TViewType.Root}));\n+ * expect({\n+ *   node: tNode\n+ * }).toEqual({\n+ *   node: matchTNode({type: TViewType.Root})\n+ * });\n+ * ```\n+ *\n+ * @param expected optional properties which the `TView` must contain.\n+ */\n+export function matchTView(expected?: Partial<TView>): jasmine.AsymmetricMatcher<TView> {\n+  return matchObjectShape('TView', isTView, expected);\n+}\n+\n+/**\n+ * Asymmetric matcher which matches a `TNode` of a given shape.\n+ *\n+ * Expected usage:\n+ * ```\n+ * expect(tNode).toEqual(matchTNode({type: TNodeType.Element}));\n+ * expect({\n+ *   node: tNode\n+ * }).toEqual({\n+ *   node: matchTNode({type: TNodeType.Element})\n+ * });\n+ * ```\n+ *\n+ * @param expected optional properties which the `TNode` must contain.\n+ */\n+export function matchTNode(expected?: Partial<TNode>): jasmine.AsymmetricMatcher<TNode> {\n+  return matchObjectShape('TNode', isTNode, expected);\n+}\n+\n+\n+/**\n+ * Asymmetric matcher which matches a `T18n` of a given shape.\n+ *\n+ * Expected usage:\n+ * ```\n+ * expect(tNode).toEqual(matchT18n({vars: 0}));\n+ * expect({\n+ *   node: tNode\n+ * }).toEqual({\n+ *   node: matchT18n({vars: 0})\n+ * });\n+ * ```\n+ *\n+ * @param expected optional properties which the `TI18n` must contain.\n+ */\n+export function matchTI18n(expected?: Partial<TI18n>): jasmine.AsymmetricMatcher<TI18n> {\n+  return matchObjectShape('TI18n', isTI18n, expected);\n+}\n+\n+\n+\n+/**\n+ * Asymmetric matcher which matches a DOM Element.\n+ *\n+ * Expected usage:\n+ * ```\n+ * expect(div).toEqual(matchT18n('div', {id: '123'}));\n+ * expect({\n+ *   node: div\n+ * }).toEqual({\n+ *   node: matchT18n('div', {id: '123'})\n+ * });\n+ * ```\n+ *\n+ * @param expectedTagName optional DOM tag name.\n+ * @param expectedAttributes optional DOM element properties.\n+ */\n+export function matchDomElement(\n+    expectedTagName: string|undefined = undefined,\n+    expectedAttrs: {[key: string]: string|null} = {}): jasmine.AsymmetricMatcher<Element> {\n+  const matcher = function() {};\n+  let _actual: any = null;\n+\n+  matcher.asymmetricMatch = function(actual: any) {\n+    _actual = actual;\n+    if (!isDOMElement(actual)) return false;\n+    if (expectedTagName && (expectedTagName.toUpperCase() !== actual.tagName.toUpperCase())) {\n+      return false;\n+    }\n+    if (expectedAttrs) {\n+      for (const attrName in expectedAttrs) {\n+        if (expectedAttrs.hasOwnProperty(attrName)) {\n+          const expectedAttrValue = expectedAttrs[attrName];\n+          const actualAttrValue = actual.getAttribute(attrName);\n+          if (expectedAttrValue !== actualAttrValue) {\n+            return false;\n+          }\n+        }\n+      }\n+    }\n+    return true;\n+  };\n+  matcher.jasmineToString = function() {\n+    let actualStr = isDOMElement(_actual) ? `<${_actual.tagName}${toString(_actual.attributes)}>` :\n+                                            JSON.stringify(_actual);\n+    let expectedStr = `<${expectedTagName || '*'}${\n+        Object.keys(expectedAttrs).map(key => ` ${key}=${JSON.stringify(expectedAttrs[key])}`)}>`;\n+    return `[${actualStr} != ${expectedStr}]`;\n+  };\n+\n+  function toString(attrs: NamedNodeMap) {\n+    let text = '';\n+    for (let i = 0; i < attrs.length; i++) {\n+      const attr = attrs[i];\n+      text += ` ${attr.name}=${JSON.stringify(attr.value)}`;\n+    }\n+    return text;\n+  }\n+\n+\n+  return matcher;\n+}\n+\n+/**\n+ * Asymmetric matcher which matches DOM text node.\n+ *\n+ * Expected usage:\n+ * ```\n+ * expect(div).toEqual(matchDomText('text'));\n+ * expect({\n+ *   node: div\n+ * }).toEqual({\n+ *   node: matchDomText('text')\n+ * });\n+ * ```\n+ *\n+ * @param expectedText optional DOM text.\n+ */\n+export function matchDomText(expectedText: string|undefined = undefined):\n+    jasmine.AsymmetricMatcher<Text> {\n+  const matcher = function() {};\n+  let _actual: any = null;\n+\n+  matcher.asymmetricMatch = function(actual: any) {\n+    _actual = actual;\n+    if (!isDOMText(actual)) return false;\n+    if (expectedText && (expectedText !== actual.textContent)) {\n+      return false;\n+    }\n+    return true;\n+  };\n+  matcher.jasmineToString = function() {\n+    let actualStr = isDOMText(_actual) ? `#TEXT: ${JSON.stringify(_actual.textContent)}` :\n+                                         JSON.stringify(_actual);\n+    let expectedStr = `#TEXT: ${JSON.stringify(expectedText)}`;\n+    return `[${actualStr} != ${expectedStr}]`;\n+  };\n+\n+  return matcher;\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "10170064eed5f46dbeae31e34709206dc942fe60",
            "filename": "packages/core/test/render3/matchers_spec.ts",
            "status": "added",
            "additions": 101,
            "deletions": 0,
            "changes": 101,
            "blob_url": "https://github.com/angular/angular/blob/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Frender3%2Fmatchers_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/702958e9684a21f3e079a21ff7e796fe2906dde0/packages%2Fcore%2Ftest%2Frender3%2Fmatchers_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fmatchers_spec.ts?ref=702958e9684a21f3e079a21ff7e796fe2906dde0",
            "patch": "@@ -0,0 +1,101 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {createTNode, createTView} from '@angular/core/src/render3/instructions/shared';\n+import {TNodeType} from '@angular/core/src/render3/interfaces/node';\n+import {TViewType} from '@angular/core/src/render3/interfaces/view';\n+import {onlyInIvy} from '@angular/private/testing';\n+\n+import {isShapeOf, ShapeOf} from './is_shape_of';\n+import {matchDomElement, matchDomText, matchObjectShape, matchTNode, matchTView} from './matchers';\n+import {dedent} from './utils';\n+\n+describe('render3 matchers', () => {\n+  describe('matchObjectShape', () => {\n+    interface MyShape {\n+      propA: any;\n+      propB: any;\n+    }\n+\n+    const myShape: MyShape = {propA: 'value', propB: 3};\n+    function isMyShape(obj: any): obj is MyShape {\n+      return isShapeOf<MyShape>(obj, ShapeOfMyShape);\n+    }\n+    const ShapeOfMyShape: ShapeOf<MyShape> = {propA: true, propB: true};\n+    function matchMyShape(expected?: Partial<MyShape>): jasmine.AsymmetricMatcher<MyShape> {\n+      return matchObjectShape('MyShape', isMyShape, expected);\n+    }\n+\n+    it('should match', () => {\n+      expect(isMyShape(myShape)).toBeTrue();\n+      expect(myShape).toEqual(matchMyShape());\n+      expect(myShape).toEqual(matchMyShape({propA: 'value'}));\n+      expect({node: myShape}).toEqual({node: matchMyShape({propA: 'value'})});\n+    });\n+\n+    it('should produce human readable errors', () => {\n+      const matcher = matchMyShape({propA: 'different'});\n+      expect(matcher.asymmetricMatch(myShape, [])).toEqual(false);\n+      expect(matcher.jasmineToString!()).toEqual(dedent`\n+        MyShape({\n+          propA: \"value\",\n+          ...\n+        }) != MyShape({\n+          propA: \"different\"\n+        }))`);\n+    });\n+  });\n+\n+  describe('matchTView', () => {\n+    const tView = createTView(TViewType.Root, 1, null, 2, 3, null, null, null, null, null);\n+    it('should match', () => {\n+      expect(tView).toEqual(matchTView());\n+      expect(tView).toEqual(matchTView({type: TViewType.Root}));\n+      expect({node: tView}).toEqual({node: matchTView({type: TViewType.Root})});\n+    });\n+  });\n+  describe('matchTNode', () => {\n+    const tView = createTView(TViewType.Root, 1, null, 2, 3, null, null, null, null, null);\n+    const tNode = createTNode(tView, null, TNodeType.Element, 1, 'tagName', []);\n+\n+    it('should match', () => {\n+      expect(tNode).toEqual(matchTNode());\n+      expect(tNode).toEqual(matchTNode({type: TNodeType.Element, tagName: 'tagName'}));\n+      expect({node: tNode}).toEqual({node: matchTNode({type: TNodeType.Element})});\n+    });\n+  });\n+\n+  describe('matchDomElement', () => {\n+    const div = document.createElement('div');\n+    div.setAttribute('name', 'Name');\n+    it('should match', () => {\n+      expect(div).toEqual(matchDomElement());\n+      expect(div).toEqual(matchDomElement('div', {name: 'Name'}));\n+    });\n+\n+    it('should produce human readable error', () => {\n+      const matcher = matchDomElement('div', {name: 'other'});\n+      expect(matcher.asymmetricMatch(div, [])).toEqual(false);\n+      expect(matcher.jasmineToString!()).toEqual(`[<DIV name=\"Name\"> != <div name=\"other\">]`);\n+    });\n+  });\n+\n+  describe('matchDomText', () => {\n+    const text = document.createTextNode('myText');\n+    it('should match', () => {\n+      expect(text).toEqual(matchDomText());\n+      expect(text).toEqual(matchDomText('myText'));\n+    });\n+\n+    it('should produce human readable error', () => {\n+      const matcher = matchDomText('other text');\n+      expect(matcher.asymmetricMatch(text, [])).toEqual(false);\n+      expect(matcher.jasmineToString!()).toEqual(`[#TEXT: \"myText\" != #TEXT: \"other text\"]`);\n+    });\n+  });\n+});\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 998,
        "additions": 929,
        "deletions": 69
    }
}