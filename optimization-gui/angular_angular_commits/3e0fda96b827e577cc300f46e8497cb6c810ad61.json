{
    "author": "literalpie",
    "message": "fix(compiler-cli): resolve `rootDirs` to absolute (#41359)\n\nEnsure that `rootDirs` are absolute by resolving them against the current working directory.\n\nFixes #36290\n\nPR Close #41359",
    "sha": "3e0fda96b827e577cc300f46e8497cb6c810ad61",
    "files": [
        {
            "sha": "6063442aad39bbdecf03361dd95ce97b13eda3b5",
            "filename": "packages/compiler-cli/src/ngtsc/util/src/typescript.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/3e0fda96b827e577cc300f46e8497cb6c810ad61/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts",
            "raw_url": "https://github.com/angular/angular/raw/3e0fda96b827e577cc300f46e8497cb6c810ad61/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts?ref=3e0fda96b827e577cc300f46e8497cb6c810ad61",
            "patch": "@@ -10,7 +10,7 @@ const TS = /\\.tsx?$/i;\n const D_TS = /\\.d\\.ts$/i;\n \n import * as ts from 'typescript';\n-import {AbsoluteFsPath, absoluteFrom} from '../../file_system';\n+import {AbsoluteFsPath, getFileSystem} from '../../file_system';\n import {DeclarationNode} from '../../reflection';\n \n export function isDtsPath(filePath: string): boolean {\n@@ -96,19 +96,21 @@ export function getRootDirs(\n     host: Pick<ts.CompilerHost, 'getCurrentDirectory'|'getCanonicalFileName'>,\n     options: ts.CompilerOptions): AbsoluteFsPath[] {\n   const rootDirs: string[] = [];\n+  const cwd = host.getCurrentDirectory();\n+  const fs = getFileSystem();\n   if (options.rootDirs !== undefined) {\n     rootDirs.push(...options.rootDirs);\n   } else if (options.rootDir !== undefined) {\n     rootDirs.push(options.rootDir);\n   } else {\n-    rootDirs.push(host.getCurrentDirectory());\n+    rootDirs.push(cwd);\n   }\n \n   // In Windows the above might not always return posix separated paths\n   // See:\n   // https://github.com/Microsoft/TypeScript/blob/3f7357d37f66c842d70d835bc925ec2a873ecfec/src/compiler/sys.ts#L650\n   // Also compiler options might be set via an API which doesn't normalize paths\n-  return rootDirs.map(rootDir => absoluteFrom(host.getCanonicalFileName(rootDir)));\n+  return rootDirs.map(rootDir => fs.resolve(cwd, host.getCanonicalFileName(rootDir)));\n }\n \n export function nodeDebugInfo(node: ts.Node): string {"
        },
        {
            "sha": "31aa679625d7c2d95c4de27091fed368d96443a7",
            "filename": "packages/compiler-cli/src/ngtsc/util/test/typescript_spec.ts",
            "status": "added",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/angular/angular/blob/3e0fda96b827e577cc300f46e8497cb6c810ad61/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Ftest%2Ftypescript_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/3e0fda96b827e577cc300f46e8497cb6c810ad61/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Ftest%2Ftypescript_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Ftest%2Ftypescript_spec.ts?ref=3e0fda96b827e577cc300f46e8497cb6c810ad61",
            "patch": "@@ -0,0 +1,30 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {FileSystem, getFileSystem} from '../../file_system';\n+import {runInEachFileSystem} from '../../file_system/testing';\n+import {getRootDirs} from '../src/typescript';\n+\n+runInEachFileSystem(() => {\n+  let fs: FileSystem;\n+\n+  beforeEach(() => {\n+    fs = getFileSystem();\n+  });\n+\n+  describe('typescript', () => {\n+    it('should allow relative root directories', () => {\n+      const mockCompilerHost = {\n+        getCanonicalFileName: (val: string) => val,\n+        getCurrentDirectory: () => '/fs-root/projects'\n+      };\n+      const result = getRootDirs(mockCompilerHost, {rootDir: './test-project-root'});\n+      expect(result).toEqual([fs.resolve('/fs-root/projects/test-project-root')]);\n+    });\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 35,
        "deletions": 3
    }
}