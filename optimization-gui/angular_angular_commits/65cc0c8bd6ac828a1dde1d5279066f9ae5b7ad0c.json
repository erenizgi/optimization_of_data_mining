{
    "author": "atscott",
    "message": "fix(compiler-cli): Add support for string literal class members (#38226)\n\nThe current implementation of the TypeScriptReflectionHost does not account for members that\nare string literals, i.e. `class A { 'string-literal-prop': string; }`\n\nPR Close #38226",
    "sha": "65cc0c8bd6ac828a1dde1d5279066f9ae5b7ad0c",
    "files": [
        {
            "sha": "bb46477213c9cd9cfe8a6406952e3cad7ff0748d",
            "filename": "packages/compiler-cli/src/ngtsc/reflection/src/host.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/65cc0c8bd6ac828a1dde1d5279066f9ae5b7ad0c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Fhost.ts",
            "raw_url": "https://github.com/angular/angular/raw/65cc0c8bd6ac828a1dde1d5279066f9ae5b7ad0c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Fhost.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Fhost.ts?ref=65cc0c8bd6ac828a1dde1d5279066f9ae5b7ad0c",
            "patch": "@@ -152,13 +152,13 @@ export interface ClassMember {\n   name: string;\n \n   /**\n-   * TypeScript `ts.Identifier` representing the name of the member, or `null` if no such node\n-   * is present.\n+   * TypeScript `ts.Identifier` or `ts.StringLiteral` representing the name of the member, or `null`\n+   * if no such node is present.\n    *\n    * The `nameNode` is useful in writing references to this member that will be correctly source-\n    * mapped back to the original file.\n    */\n-  nameNode: ts.Identifier|null;\n+  nameNode: ts.Identifier|ts.StringLiteral|null;\n \n   /**\n    * TypeScript `ts.Expression` which represents the value of the member."
        },
        {
            "sha": "56b54b24dc3c7ff6729aa13022e75f8c597d235a",
            "filename": "packages/compiler-cli/src/ngtsc/reflection/src/typescript.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/65cc0c8bd6ac828a1dde1d5279066f9ae5b7ad0c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Ftypescript.ts",
            "raw_url": "https://github.com/angular/angular/raw/65cc0c8bd6ac828a1dde1d5279066f9ae5b7ad0c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Ftypescript.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Ftypescript.ts?ref=65cc0c8bd6ac828a1dde1d5279066f9ae5b7ad0c",
            "patch": "@@ -363,7 +363,7 @@ export class TypeScriptReflectionHost implements ReflectionHost {\n     let kind: ClassMemberKind|null = null;\n     let value: ts.Expression|null = null;\n     let name: string|null = null;\n-    let nameNode: ts.Identifier|null = null;\n+    let nameNode: ts.Identifier|ts.StringLiteral|null = null;\n \n     if (ts.isPropertyDeclaration(node)) {\n       kind = ClassMemberKind.Property;\n@@ -385,6 +385,9 @@ export class TypeScriptReflectionHost implements ReflectionHost {\n     } else if (ts.isIdentifier(node.name)) {\n       name = node.name.text;\n       nameNode = node.name;\n+    } else if (ts.isStringLiteral(node.name)) {\n+      name = node.name.text;\n+      nameNode = node.name;\n     } else {\n       return null;\n     }"
        },
        {
            "sha": "54ce4125d2ed57f6de1482290274a0842006a27c",
            "filename": "packages/compiler-cli/src/ngtsc/reflection/test/ts_host_spec.ts",
            "status": "modified",
            "additions": 90,
            "deletions": 1,
            "changes": 91,
            "blob_url": "https://github.com/angular/angular/blob/65cc0c8bd6ac828a1dde1d5279066f9ae5b7ad0c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Ftest%2Fts_host_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/65cc0c8bd6ac828a1dde1d5279066f9ae5b7ad0c/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Ftest%2Fts_host_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Ftest%2Fts_host_spec.ts?ref=65cc0c8bd6ac828a1dde1d5279066f9ae5b7ad0c",
            "patch": "@@ -9,7 +9,7 @@ import * as ts from 'typescript';\n import {absoluteFrom, getSourceFileOrError} from '../../file_system';\n import {runInEachFileSystem} from '../../file_system/testing';\n import {getDeclaration, makeProgram} from '../../testing';\n-import {CtorParameter} from '../src/host';\n+import {ClassMember, ClassMemberKind, CtorParameter} from '../src/host';\n import {TypeScriptReflectionHost} from '../src/typescript';\n import {isNamedClassDeclaration} from '../src/util';\n \n@@ -450,6 +450,95 @@ runInEachFileSystem(() => {\n         ]);\n       });\n     });\n+\n+    describe('getMembersOfClass()', () => {\n+      it('should get string literal members of class', () => {\n+        const {program} = makeProgram([{\n+          name: _('/entry.ts'),\n+          contents: `\n+            class Foo {\n+              'string-literal-property-member' = 'my value';\n+            }\n+        `\n+        }]);\n+        const members = getMembers(program);\n+        expect(members.length).toBe(1);\n+        expectMember(members[0], 'string-literal-property-member', ClassMemberKind.Property);\n+      });\n+\n+      it('should retrieve method members', () => {\n+        const {program} = makeProgram([{\n+          name: _('/entry.ts'),\n+          contents: `\n+            class Foo {\n+              myMethod(): void {\n+              }\n+            }\n+        `\n+        }]);\n+        const members = getMembers(program);\n+        expect(members.length).toBe(1);\n+        expectMember(members[0], 'myMethod', ClassMemberKind.Method);\n+      });\n+\n+      it('should retrieve constructor as member', () => {\n+        const {program} = makeProgram([{\n+          name: _('/entry.ts'),\n+          contents: `\n+            class Foo {\n+              constructor() {}\n+            }\n+        `\n+        }]);\n+        const members = getMembers(program);\n+        expect(members.length).toBe(1);\n+        expectMember(members[0], 'constructor', ClassMemberKind.Constructor);\n+      });\n+\n+      it('should retrieve decorators of member', () => {\n+        const {program} = makeProgram([{\n+          name: _('/entry.ts'),\n+          contents: `\n+            declare var Input;\n+\n+            class Foo {\n+              @Input()\n+              prop: string;\n+            }\n+        `\n+        }]);\n+        const members = getMembers(program);\n+        expect(members.length).toBe(1);\n+        expect(members[0].decorators).not.toBeNull();\n+        expect(members[0].decorators![0].name).toBe('Input');\n+      });\n+\n+      it('identifies static members', () => {\n+        const {program} = makeProgram([{\n+          name: _('/entry.ts'),\n+          contents: `\n+            class Foo {\n+              static staticMember = '';\n+            }\n+        `\n+        }]);\n+        const members = getMembers(program);\n+        expect(members.length).toBe(1);\n+        expect(members[0].isStatic).toBeTrue();\n+      });\n+\n+      function getMembers(program: ts.Program) {\n+        const clazz = getDeclaration(program, _('/entry.ts'), 'Foo', isNamedClassDeclaration);\n+        const checker = program.getTypeChecker();\n+        const host = new TypeScriptReflectionHost(checker);\n+        return host.getMembersOfClass(clazz);\n+      }\n+\n+      function expectMember(member: ClassMember, name: string, kind: ClassMemberKind) {\n+        expect(member.name).toEqual(name);\n+        expect(member.kind).toEqual(kind);\n+      }\n+    });\n   });\n \n   function expectParameter("
        }
    ],
    "stats": {
        "total": 102,
        "additions": 97,
        "deletions": 5
    }
}