{
    "author": "petebacondarwin",
    "message": "perf(ngcc): do not copy files that have been processed (#40429)\n\nWhen using the `NewEntryPointWriter`, we must copy over all files from the\nentry-point bundle to the new entry-point. But since we are going to\nwrite out the modified files directly, there is no need to copy those.\nThis commit skips copying the files that have been modified.\n\nPR Close #40429",
    "sha": "b971bc6f70b19ad65dc7b68582e805f57f31351f",
    "files": [
        {
            "sha": "87ac6addb63c9aed80aeba87b758c1b7d9e75416",
            "filename": "packages/compiler-cli/ngcc/src/writing/new_entry_point_file_writer.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/b971bc6f70b19ad65dc7b68582e805f57f31351f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fnew_entry_point_file_writer.ts",
            "raw_url": "https://github.com/angular/angular/raw/b971bc6f70b19ad65dc7b68582e805f57f31351f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fnew_entry_point_file_writer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fnew_entry_point_file_writer.ts?ref=b971bc6f70b19ad65dc7b68582e805f57f31351f",
            "patch": "@@ -40,7 +40,7 @@ export class NewEntryPointFileWriter extends InPlaceFileWriter {\n     // The new folder is at the root of the overall package\n     const entryPoint = bundle.entryPoint;\n     const ngccFolder = this.fs.join(entryPoint.packagePath, NGCC_DIRECTORY);\n-    this.copyBundle(bundle, entryPoint.packagePath, ngccFolder);\n+    this.copyBundle(bundle, entryPoint.packagePath, ngccFolder, transformedFiles);\n     transformedFiles.forEach(file => this.writeFile(file, entryPoint.packagePath, ngccFolder));\n     this.updatePackageJson(entryPoint, formatProperties, ngccFolder);\n   }\n@@ -67,9 +67,14 @@ export class NewEntryPointFileWriter extends InPlaceFileWriter {\n   }\n \n   protected copyBundle(\n-      bundle: EntryPointBundle, packagePath: AbsoluteFsPath, ngccFolder: AbsoluteFsPath) {\n+      bundle: EntryPointBundle, packagePath: AbsoluteFsPath, ngccFolder: AbsoluteFsPath,\n+      transformedFiles: FileToWrite[]) {\n+    const doNotCopy = new Set(transformedFiles.map(f => f.path));\n     bundle.src.program.getSourceFiles().forEach(sourceFile => {\n       const originalPath = absoluteFromSourceFile(sourceFile);\n+      if (doNotCopy.has(originalPath)) {\n+        return;\n+      }\n       const relativePath = this.fs.relative(packagePath, originalPath);\n       const isInsidePackage = isLocalRelativePath(relativePath);\n       if (!sourceFile.isDeclarationFile && isInsidePackage) {"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 7,
        "deletions": 2
    }
}