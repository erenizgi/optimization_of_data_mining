{
    "author": "crisbeto",
    "message": "build: remove unnecessary polyfills from tests (#42567)\n\nRemoves the polyfills for `MutationObserver` and `setPrototypeOf` from our testing setup, because none of the browsers that we support require them. It also removes a bit of code and one external dependency.\n\nPR Close #42567",
    "sha": "a66dd8834c4ce27d317c5fc6e11fa38807747e9e",
    "files": [
        {
            "sha": "2e122a56a4ea130dc93860ce1ef19ea123e8b808",
            "filename": "karma-js.conf.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/a66dd8834c4ce27d317c5fc6e11fa38807747e9e/karma-js.conf.js",
            "raw_url": "https://github.com/angular/angular/raw/a66dd8834c4ce27d317c5fc6e11fa38807747e9e/karma-js.conf.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/karma-js.conf.js?ref=a66dd8834c4ce27d317c5fc6e11fa38807747e9e",
            "patch": "@@ -59,7 +59,6 @@ module.exports = function(config) {\n         included: false,\n         watched: false\n       },\n-      {pattern: 'node_modules/mutation-observer/index.js', included: false, watched: false},\n \n       {pattern: 'node_modules/rxjs/**', included: false, watched: false, served: true},\n       'node_modules/reflect-metadata/Reflect.js',"
        },
        {
            "sha": "3a661a044c6a1008a3c1590c572b1c961d161ebd",
            "filename": "package.json",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/a66dd8834c4ce27d317c5fc6e11fa38807747e9e/package.json",
            "raw_url": "https://github.com/angular/angular/raw/a66dd8834c4ce27d317c5fc6e11fa38807747e9e/package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/package.json?ref=a66dd8834c4ce27d317c5fc6e11fa38807747e9e",
            "patch": "@@ -191,7 +191,6 @@\n     \"karma-sauce-launcher\": \"^2.0.2\",\n     \"madge\": \"^4.0.2\",\n     \"multimatch\": \"^5.0.0\",\n-    \"mutation-observer\": \"^1.0.3\",\n     \"nock\": \"^13.0.3\",\n     \"ora\": \"^5.0.0\",\n     \"prettier\": \"^2.3.0\","
        },
        {
            "sha": "6e8ca29aa7dc7dba1a7ffd21396f7dbec1d04bb3",
            "filename": "test-main.js",
            "status": "modified",
            "additions": 32,
            "deletions": 75,
            "changes": 107,
            "blob_url": "https://github.com/angular/angular/blob/a66dd8834c4ce27d317c5fc6e11fa38807747e9e/test-main.js",
            "raw_url": "https://github.com/angular/angular/raw/a66dd8834c4ce27d317c5fc6e11fa38807747e9e/test-main.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/test-main.js?ref=a66dd8834c4ce27d317c5fc6e11fa38807747e9e",
            "patch": "@@ -134,42 +134,6 @@ Promise\n \n \n function loadCustomElementsPolyfills() {\n-  var loadedPromise = Promise.resolve();\n-\n-  // The custom elements polyfill relies on `MutationObserver`.\n-  if (!window.MutationObserver) {\n-    loadedPromise = loadedPromise\n-                        .then(function() {\n-                          return System.import('node_modules/mutation-observer/index.js');\n-                        })\n-                        .then(function(MutationObserver) {\n-                          window.MutationObserver = MutationObserver;\n-                        });\n-  }\n-\n-  // The custom elements polyfill relies on `Object.setPrototypeOf()`.\n-  if (!Object.setPrototypeOf) {\n-    var getDescriptor = function getDescriptor(obj, prop) {\n-      var descriptor;\n-      while (obj && !descriptor) {\n-        descriptor = Object.getOwnPropertyDescriptor(obj, prop);\n-        obj = Object.getPrototypeOf(obj);\n-      }\n-      return descriptor || {};\n-    };\n-    var setPrototypeOf = function setPrototypeOf(obj, proto) {\n-      for (var prop in proto) {\n-        if (!obj.hasOwnProperty(prop)) {\n-          Object.defineProperty(obj, prop, getDescriptor(proto, prop));\n-        }\n-      }\n-      return obj;\n-    };\n-\n-    Object.defineProperty(setPrototypeOf, '$$shimmed', {value: true});\n-    Object.setPrototypeOf = setPrototypeOf;\n-  }\n-\n   // The custom elements polyfill will patch properties and methods on `(HTML)Element` and `Node`\n   // (among others), including `(HTML)Element#innerHTML` and `Node#removeChild()`:\n   // https://github.com/webcomponents/custom-elements/blob/4f7072c0dbda4beb505d16967acfffd33337b325/src/Patch/Element.js#L28-L73\n@@ -209,46 +173,39 @@ function loadCustomElementsPolyfills() {\n       // Allow ES5 functions as custom element constructors.\n       'node_modules/@webcomponents/custom-elements/src/native-shim.js';\n \n-  loadedPromise = loadedPromise\n-                      .then(function() {\n-                        return System.import(polyfillPath);\n-                      })\n-                      .then(function() {\n-                        // `packages/compiler/test/schema/schema_extractor.ts` relies on\n-                        // `HTMLElement.name`, but custom element polyfills will replace\n-                        // `HTMLElement` with an anonymous function.\n-                        Object.defineProperty(HTMLElement, 'name', {value: 'HTMLElement'});\n+  return System.import(polyfillPath).then(function() {\n+    // `packages/compiler/test/schema/schema_extractor.ts` relies on\n+    // `HTMLElement.name`, but custom element polyfills will replace\n+    // `HTMLElement` with an anonymous function.\n+    Object.defineProperty(HTMLElement, 'name', {value: 'HTMLElement'});\n \n-                        // Create helper functions on `window` for patching/restoring\n-                        // properties/methods.\n-                        Object.keys(patchConfig).forEach(function(prop) {\n-                          var patchMethod = '$$patch_' + prop;\n-                          var restoreMethod = '$$restore_' + prop;\n-\n-                          if (!patchTargets[prop]) {\n-                            // No patching detected. Create no-op functions.\n-                            window[patchMethod] = window[restoreMethod] = function() {};\n-                          } else {\n-                            var patchTarget = patchTargets[prop];\n-                            var originalDescriptor = originalDescriptors[prop];\n-                            var patchedDescriptor =\n-                                Object.getOwnPropertyDescriptor(patchTarget, prop);\n-\n-                            window[patchMethod] = function() {\n-                              Object.defineProperty(patchTarget, prop, patchedDescriptor);\n-                            };\n-                            window[restoreMethod] = function() {\n-                              Object.defineProperty(patchTarget, prop, originalDescriptor);\n-                            };\n-\n-                            // Restore `prop`. The patch will be manually applied only during the\n-                            // `@angular/elements` tests that need it.\n-                            window[restoreMethod]();\n-                          }\n-                        });\n-                      });\n-\n-  return loadedPromise;\n+    // Create helper functions on `window` for patching/restoring\n+    // properties/methods.\n+    Object.keys(patchConfig).forEach(function(prop) {\n+      var patchMethod = '$$patch_' + prop;\n+      var restoreMethod = '$$restore_' + prop;\n+\n+      if (!patchTargets[prop]) {\n+        // No patching detected. Create no-op functions.\n+        window[patchMethod] = window[restoreMethod] = function() {};\n+      } else {\n+        var patchTarget = patchTargets[prop];\n+        var originalDescriptor = originalDescriptors[prop];\n+        var patchedDescriptor = Object.getOwnPropertyDescriptor(patchTarget, prop);\n+\n+        window[patchMethod] = function() {\n+          Object.defineProperty(patchTarget, prop, patchedDescriptor);\n+        };\n+        window[restoreMethod] = function() {\n+          Object.defineProperty(patchTarget, prop, originalDescriptor);\n+        };\n+\n+        // Restore `prop`. The patch will be manually applied only during the\n+        // `@angular/elements` tests that need it.\n+        window[restoreMethod]();\n+      }\n+    });\n+  });\n }\n \n function onlySpecFiles(path) {"
        },
        {
            "sha": "06f3193a56c361102e54d8db819791abdd41bdeb",
            "filename": "yarn.lock",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/a66dd8834c4ce27d317c5fc6e11fa38807747e9e/yarn.lock",
            "raw_url": "https://github.com/angular/angular/raw/a66dd8834c4ce27d317c5fc6e11fa38807747e9e/yarn.lock",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/yarn.lock?ref=a66dd8834c4ce27d317c5fc6e11fa38807747e9e",
            "patch": "@@ -9178,11 +9178,6 @@ multimatch@*, multimatch@^5.0.0:\n     arrify \"^2.0.1\"\n     minimatch \"^3.0.4\"\n \n-mutation-observer@^1.0.3:\n-  version \"1.0.3\"\n-  resolved \"https://registry.yarnpkg.com/mutation-observer/-/mutation-observer-1.0.3.tgz#42e9222b101bca82e5ba9d5a7acf4a14c0f263d0\"\n-  integrity sha512-M/O/4rF2h776hV7qGMZUH3utZLO/jK7p8rnNgGkjKUw8zCGjRQPxB8z6+5l8+VjRUQ3dNYu4vjqXYLr+U8ZVNA==\n-\n mute-stdout@^1.0.0:\n   version \"1.0.1\"\n   resolved \"https://registry.yarnpkg.com/mute-stdout/-/mute-stdout-1.0.1.tgz#acb0300eb4de23a7ddeec014e3e96044b3472331\""
        }
    ],
    "stats": {
        "total": 114,
        "additions": 32,
        "deletions": 82
    }
}