{
    "author": "alan-agius4",
    "message": "ci: don't save node_modules directory (#41467)\n\nStoring node_modules directory in cache causes a number of issues, such as increase in the laid out node_modules tree and also in some cases break module resolution. This is because modules are not hoisted correctly when running `yarn install`.\n\nExample of related failures https://app.circleci.com/pipelines/github/angular/angular/30441/workflows/c1a16135-f5c9-478d-a298-d720c6657d52/jobs/952138\n\nA better cache strategy would be to save yarn cache, more information can be found in https://circleci.com/docs/2.0/caching/#yarn-node.\n\nPR Close #41467",
    "sha": "a35758113cabb86488625bcbb4fc759547a81acb",
    "files": [
        {
            "sha": "42415d9770580975059c06a45f317535231b5664",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 13,
            "deletions": 14,
            "changes": 27,
            "blob_url": "https://github.com/angular/angular/blob/a35758113cabb86488625bcbb4fc759547a81acb/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/angular/angular/raw/a35758113cabb86488625bcbb4fc759547a81acb/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.circleci%2Fconfig.yml?ref=a35758113cabb86488625bcbb4fc759547a81acb",
            "patch": "@@ -22,11 +22,11 @@ version: 2.1\n # **NOTE 1 **: If you change the cache key prefix, also sync the cache_key_fallback to match.\n # **NOTE 2 **: Keep the static part of the cache key as prefix to enable correct fallbacks.\n # See https://circleci.com/docs/2.0/caching/#restoring-cache for how prefixes work in CircleCI.\n-var_3: &cache_key v1-angular-node-12-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}-{{ checksum \"packages/bazel/package.bzl\" }}-{{ checksum \"aio/yarn.lock\" }}\n+var_3: &cache_key v4-angular-node-12-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}-{{ checksum \"packages/bazel/package.bzl\" }}-{{ checksum \"aio/yarn.lock\" }}\n # We invalidate the cache if the Bazel version changes because otherwise the `bazelisk` cache\n # folder will contain all previously used versions and ultimately cause the cache restoring to\n # be slower due to its growing size.\n-var_4: &cache_key_fallback v1-angular-node-12-{{ checksum \".bazelversion\" }}\n+var_4: &cache_key_fallback v4-angular-node-12-{{ checksum \".bazelversion\" }}\n \n # Cache key for the `components-repo-unit-tests` job. **Note** when updating the SHA in the\n # cache keys also update the SHA for the \"COMPONENTS_REPO_COMMIT\" environment variable.\n@@ -232,10 +232,10 @@ jobs:\n             - *cache_key_fallback\n       - run:\n           name: Running Yarn install\n-          command: yarn install --frozen-lockfile --non-interactive\n+          command: yarn install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n           # Yarn's requests sometimes take more than 10mins to complete.\n           no_output_timeout: 45m\n-      - run: yarn --cwd aio install --frozen-lockfile --non-interactive\n+      - run: yarn --cwd aio install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n       # Make the bazel directories and add a file to them if they don't exist already so that\n       # persist_to_workspace does not fail.\n       - run: |\n@@ -424,7 +424,7 @@ jobs:\n       - custom_attach_workspace\n       - init_environment\n         # Install\n-      - run: yarn --cwd aio install --frozen-lockfile --non-interactive\n+      - run: yarn --cwd aio install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n       - run: yarn --cwd aio extract-cli-command-docs\n         # Run tools tests\n       - run: yarn --cwd aio tools-test\n@@ -444,7 +444,7 @@ jobs:\n       - init_environment\n       - install_chrome_libs\n         # Install aio\n-      - run: yarn --cwd aio install --frozen-lockfile --non-interactive\n+      - run: yarn --cwd aio install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n         # Run examples tests. The \"CIRCLE_NODE_INDEX\" will be set if \"parallelism\" is enabled.\n         # Since the parallelism is set to \"5\", there will be five parallel CircleCI containers.\n         # with either \"0\", \"1\", etc as node index. This can be passed to the \"--shard\" argument.\n@@ -473,7 +473,7 @@ jobs:\n       - custom_attach_workspace\n       - init_environment\n       - install_chrome_libs\n-      - run: yarn --cwd aio install --frozen-lockfile --non-interactive\n+      - run: yarn --cwd aio install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n       - run:\n           name: Wait for preview and run tests\n           command: node aio/scripts/test-preview.js $CI_PULL_REQUEST $CI_COMMIT $CI_AIO_MIN_PWA_SCORE\n@@ -508,10 +508,9 @@ jobs:\n       - save_cache:\n           key: *cache_key\n           paths:\n-            - \"node_modules\"\n-            - \"aio/node_modules\"\n-            - \"~/bazel_repository_cache\"\n-            - \"~/.cache/bazelisk\"\n+            - ~/.cache/yarn\n+            - ~/bazel_repository_cache\n+            - ~/.cache/bazelisk\n \n   # Build the ivy npm packages.\n   build-ivy-npm-packages:\n@@ -716,7 +715,7 @@ jobs:\n           # We temporarily ignore the \"engines\" because the Angular components repository has\n           # minimum dependency on NodeJS v12 and Yarn 1.19.1, but the framework repository uses\n           # older versions.\n-          command: yarn --ignore-engines --cwd ${COMPONENTS_REPO_TMP_DIR} install --frozen-lockfile --non-interactive\n+          command: yarn --ignore-engines --cwd ${COMPONENTS_REPO_TMP_DIR} install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n       - save_cache:\n           key: *components_repo_unit_tests_cache_key\n           paths:\n@@ -743,7 +742,7 @@ jobs:\n       - init_environment\n       - install_java\n         # Install\n-      - run: yarn --cwd packages/zone.js install --frozen-lockfile --non-interactive\n+      - run: yarn --cwd packages/zone.js install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n         # Run zone.js tools tests\n       - run: yarn --cwd packages/zone.js promisetest\n       - run: yarn --cwd packages/zone.js promisefinallytest\n@@ -755,7 +754,7 @@ jobs:\n       - run: yarn --cwd packages/zone.js jest:nodetest\n       - run: yarn --cwd packages/zone.js electrontest\n       - run: yarn --cwd packages/zone.js closuretest\n-      - run: yarn --cwd packages/zone.js/test/typings install --frozen-lockfile --non-interactive\n+      - run: yarn --cwd packages/zone.js/test/typings install --frozen-lockfile --non-interactive --cache-folder ~/.cache/yarn\n       - run: yarn --cwd packages/zone.js/test/typings test\n \n   # Windows jobs"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 13,
        "deletions": 14
    }
}