{
    "author": "petebacondarwin",
    "message": "test(compiler-cli): update new compliance test partial rules (#39661)\n\nThere is now a dedicated rule for debugging generation of partial\ngolden files. The README has been updated accordingly.\n\nPR Close #39661",
    "sha": "63dcfb291354321b37e3aa9678000e9d690cb57a",
    "files": [
        {
            "sha": "77dde089aa5df1fabefb675e3f2a0e86679f87db",
            "filename": "packages/compiler-cli/test/compliance/README.md",
            "status": "modified",
            "additions": 14,
            "deletions": 5,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/63dcfb291354321b37e3aa9678000e9d690cb57a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/63dcfb291354321b37e3aa9678000e9d690cb57a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2FREADME.md?ref=63dcfb291354321b37e3aa9678000e9d690cb57a",
            "patch": "@@ -114,7 +114,6 @@ yarn test-ivy-aot //packages/compiler-cli/test/compliance/test_cases/...\n \n (The last command runs the partial compilation tests.)\n \n-\n ## Updating a golden partial file\n \n There is one golden partial file per `TEST_CASES.json` file. So even if this file defines multiple\n@@ -137,11 +136,22 @@ that contains the `GOLDEN_PARTIAL.js` to update.\n \n ## Debugging test-cases\n \n-Compliance tests are basically `jasmine_node_test` rules. As such, they can be debugged\n-just like any other `jasmine_node_test`.  The standard approach is to add `--config=debug`\n+The full and linked compliance tests are basically `jasmine_node_test` rules. As such, they can be\n+debugged just like any other `jasmine_node_test`.  The standard approach is to add `--config=debug`\n to the Bazel test command.\n \n-It is useful when debugging to focus on a single test-case.\n+For example:\n+\n+```sg\n+yarn test-ivy-aot //packages/compiler-cli/test/compliance/full --config=debug\n+yarn test-ivy-aot //packages/compiler-cli/test/compliance/linked --config=debug\n+```\n+\n+To debug generating the partial golden output use the following form of Bazel command:\n+\n+```sh\n+yarn bazel run //packages/compiler-cli/test/compliance/test_cases:generate_partial_for_<path/to/test_case>.debug\n+```\n \n \n ### Focusing test-cases\n@@ -154,4 +164,3 @@ This is equivalent to using jasmine `fit()`.\n \n You can exclude a test case by setting `\"excludeTest\": true` in the `TEST_CASES.json` file.\n This is equivalent to using jasmine `xit()`.\n-"
        },
        {
            "sha": "ea296400cd281e0aa71bb48764dfa9924b01a173",
            "filename": "packages/compiler-cli/test/compliance/partial/partial_compliance_goldens.bzl",
            "status": "modified",
            "additions": 21,
            "deletions": 12,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/63dcfb291354321b37e3aa9678000e9d690cb57a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fpartial%2Fpartial_compliance_goldens.bzl",
            "raw_url": "https://github.com/angular/angular/raw/63dcfb291354321b37e3aa9678000e9d690cb57a/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fpartial%2Fpartial_compliance_goldens.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Fpartial%2Fpartial_compliance_goldens.bzl?ref=63dcfb291354321b37e3aa9678000e9d690cb57a",
            "patch": "@@ -6,26 +6,39 @@ def partial_compliance_golden(filePath):\n \n     # Remove the \"TEST_CASES.json\" substring from the end of the provided path.\n     path = filePath[:-len(\"/TEST_CASES.json\")]\n+    generate_partial_name = \"generate_partial_for_%s\" % path\n+    data = [\n+        \"//packages/compiler-cli/test/compliance/partial:generate_golden_partial_lib\",\n+        \"//packages/compiler-cli/test/compliance/test_cases\",\n+        \"//packages/compiler-cli/src/ngtsc/testing/fake_core:npm_package\",\n+    ]\n \n     nodejs_binary(\n-        name = \"_generate_%s\" % path,\n+        name = generate_partial_name,\n         testonly = True,\n-        data = [\n-            \"//packages/compiler-cli/test/compliance/partial:generate_golden_partial_lib\",\n-            \"//packages/compiler-cli/test/compliance/test_cases\",\n-            \"//packages/compiler-cli/src/ngtsc/testing/fake_core:npm_package\",\n+        data = data,\n+        visibility = [\":__pkg__\"],\n+        entry_point = \"//packages/compiler-cli/test/compliance/partial:cli.ts\",\n+        templated_args = [\n+            filePath,\n         ],\n+    )\n+\n+    nodejs_binary(\n+        name = generate_partial_name + \".debug\",\n+        testonly = True,\n+        data = data,\n         visibility = [\":__pkg__\"],\n         entry_point = \"//packages/compiler-cli/test/compliance/partial:cli.ts\",\n         templated_args = [\n-            # \"--node_options=--inspect-brk\",\n+            \"--node_options=--inspect-brk\",\n             filePath,\n         ],\n     )\n \n     npm_package_bin(\n         name = \"_generated_%s\" % path,\n-        tool = \"_generate_%s\" % path,\n+        tool = generate_partial_name,\n         testonly = True,\n         stdout = \"%s/this_file_should_not_be_committed\" % path,\n         link_workspace_root = True,\n@@ -34,11 +47,7 @@ def partial_compliance_golden(filePath):\n             \"no-windows\",\n         ],\n         visibility = [\":__pkg__\"],\n-        data = [\n-            \"//packages/compiler-cli/test/compliance/partial:generate_golden_partial_lib\",\n-            \"//packages/compiler-cli/test/compliance/test_cases\",\n-            \"//packages/compiler-cli/src/ngtsc/testing/fake_core:npm_package\",\n-        ],\n+        data = data,\n     )\n \n     generated_file_test("
        }
    ],
    "stats": {
        "total": 52,
        "additions": 35,
        "deletions": 17
    }
}