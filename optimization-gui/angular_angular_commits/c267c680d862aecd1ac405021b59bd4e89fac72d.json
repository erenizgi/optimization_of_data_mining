{
    "author": "zarend",
    "message": "refactor(compiler-cli): don't use FakeEnvironment for tcb tests (#41043)\n\nFor the tests in //packages/compiler-cli/src/ngtsc/typecheck, this\ncommits uses a `TypeCheckFile` for the environment, rather than a\n`FakeEnvironment`. Using a real environment gives us more flexibility\nwith testing.\n\nPR Close #41043",
    "sha": "c267c680d862aecd1ac405021b59bd4e89fac72d",
    "files": [
        {
            "sha": "446b9f39b6547224ff484ec83bf699ae4cdf0aac",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/context.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/c267c680d862aecd1ac405021b59bd4e89fac72d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fcontext.ts",
            "raw_url": "https://github.com/angular/angular/raw/c267c680d862aecd1ac405021b59bd4e89fac72d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fcontext.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Fcontext.ts?ref=c267c680d862aecd1ac405021b59bd4e89fac72d",
            "patch": "@@ -385,7 +385,8 @@ export class TypeCheckContextImpl implements TypeCheckContext {\n           path: pendingShimData.file.fileName,\n           templates: pendingShimData.templates,\n         });\n-        updates.set(pendingShimData.file.fileName, pendingShimData.file.render());\n+        updates.set(\n+            pendingShimData.file.fileName, pendingShimData.file.render(false /* removeComments */));\n       }\n     }\n "
        },
        {
            "sha": "56c2f85e71e7680f55ac6058340bad47026d2493",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/type_check_file.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/c267c680d862aecd1ac405021b59bd4e89fac72d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_file.ts",
            "raw_url": "https://github.com/angular/angular/raw/c267c680d862aecd1ac405021b59bd4e89fac72d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_file.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_file.ts?ref=c267c680d862aecd1ac405021b59bd4e89fac72d",
            "patch": "@@ -49,12 +49,12 @@ export class TypeCheckFile extends Environment {\n     this.tcbStatements.push(fn);\n   }\n \n-  render(): string {\n+  render(removeComments: boolean): string {\n     let source: string = this.importManager.getAllImports(this.contextFile.fileName)\n                              .map(i => `import * as ${i.qualifier.text} from '${i.specifier}';`)\n                              .join('\\n') +\n         '\\n\\n';\n-    const printer = ts.createPrinter();\n+    const printer = ts.createPrinter({removeComments});\n     source += '\\n';\n     for (const stmt of this.pipeInstStatements) {\n       source += printer.printNode(ts.EmitHint.Unspecified, stmt, this.contextFile) + '\\n';"
        },
        {
            "sha": "231a1e17128cb61de41f269826917330d5f4a589",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/span_comments_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/c267c680d862aecd1ac405021b59bd4e89fac72d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/c267c680d862aecd1ac405021b59bd4e89fac72d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts?ref=c267c680d862aecd1ac405021b59bd4e89fac72d",
            "patch": "@@ -6,9 +6,12 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {initMockFileSystem} from '../../file_system/testing';\n import {tcb, TestDeclaration} from './test_utils';\n \n describe('type check blocks diagnostics', () => {\n+  beforeEach(() => initMockFileSystem('Native'));\n+\n   describe('parse spans', () => {\n     it('should annotate unary ops', () => {\n       expect(tcbWithSpans('{{ -a }}')).toContain('(-((ctx).a /*4,5*/) /*4,5*/) /*3,5*/');\n@@ -146,8 +149,9 @@ describe('type check blocks diagnostics', () => {\n         pipeName: 'test',\n       }];\n       const block = tcbWithSpans(TEMPLATE, PIPES);\n+      expect(block).toContain('var _pipe1: i0.TestPipe = null!');\n       expect(block).toContain(\n-          '((null as TestPipe).transform /*7,11*/(((ctx).a /*3,4*/) /*3,4*/, ((ctx).b /*12,13*/) /*12,13*/) /*3,13*/);');\n+          '(_pipe1.transform /*7,11*/(((ctx).a /*3,4*/) /*3,4*/, ((ctx).b /*12,13*/) /*12,13*/) /*3,13*/);');\n     });\n \n     describe('attaching multiple comments for multiple references', () => {"
        },
        {
            "sha": "0f1caacc25025d5fa39d6308469075088b1ff05a",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/test_utils.ts",
            "status": "modified",
            "additions": 27,
            "deletions": 8,
            "changes": 35,
            "blob_url": "https://github.com/angular/angular/blob/c267c680d862aecd1ac405021b59bd4e89fac72d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftest_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/c267c680d862aecd1ac405021b59bd4e89fac72d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftest_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftest_utils.ts?ref=c267c680d862aecd1ac405021b59bd4e89fac72d",
            "patch": "@@ -11,7 +11,7 @@ import * as ts from 'typescript';\n \n import {absoluteFrom, AbsoluteFsPath, getSourceFileOrError, LogicalFileSystem} from '../../file_system';\n import {TestFile} from '../../file_system/testing';\n-import {AbsoluteModuleStrategy, LocalIdentifierStrategy, LogicalProjectStrategy, ModuleResolver, Reexport, Reference, ReferenceEmitter} from '../../imports';\n+import {AbsoluteModuleStrategy, LocalIdentifierStrategy, LogicalProjectStrategy, ModuleResolver, Reexport, Reference, ReferenceEmitter, RelativePathStrategy} from '../../imports';\n import {NOOP_INCREMENTAL_BUILD} from '../../incremental';\n import {ClassPropertyMapping, CompoundMetadataReader} from '../../metadata';\n import {ClassDeclaration, isNamedClassDeclaration, TypeScriptReflectionHost} from '../../reflection';\n@@ -28,6 +28,7 @@ import {Environment} from '../src/environment';\n import {OutOfBandDiagnosticRecorder} from '../src/oob';\n import {TypeCheckShimGenerator} from '../src/shim';\n import {generateTypeCheckBlock} from '../src/type_check_block';\n+import {TypeCheckFile} from '../src/type_check_file';\n \n export function typescriptLibDts(): TestFile {\n   return {\n@@ -201,6 +202,7 @@ export type TestDirective = Partial<Pick<\n       coercedInputFields?: string[], restrictedInputFields?: string[],\n       stringLiteralInputFields?: string[], undeclaredInputFields?: string[], isGeneric?: boolean;\n };\n+\n export type TestPipe = {\n   name: string,\n   file?: AbsoluteFsPath, pipeName: string, type: 'pipe',\n@@ -212,9 +214,14 @@ export function tcb(\n     template: string, declarations: TestDeclaration[] = [], config?: TypeCheckingConfig,\n     options?: {emitSpans?: boolean}): string {\n   const classes = ['Test', ...declarations.map(decl => decl.name)];\n-  const code = classes.map(name => `class ${name}<T extends string> {}`).join('\\n');\n+  const code = classes.map(name => `export class ${name}<T extends string> {}`).join('\\n');\n+\n+  const rootFilePath = absoluteFrom('/synthetic.ts');\n+  const {program, host} = makeProgram([\n+    {name: rootFilePath, contents: code, isRoot: true},\n+  ]);\n \n-  const sf = ts.createSourceFile('synthetic.ts', code, ts.ScriptTarget.Latest, true);\n+  const sf = getSourceFileOrError(program, rootFilePath);\n   const clazz = getClass(sf, 'Test');\n   const templateUrl = 'synthetic.html';\n   const {nodes} = parseTemplate(template, templateUrl);\n@@ -251,13 +258,25 @@ export function tcb(\n     emitSpans: false,\n   };\n \n+  const fileName = absoluteFrom('/type-check-file.ts');\n+\n+  const reflectionHost = new TypeScriptReflectionHost(program.getTypeChecker());\n+\n+  const refEmmiter: ReferenceEmitter = new ReferenceEmitter(\n+      [new LocalIdentifierStrategy(), new RelativePathStrategy(reflectionHost)]);\n+\n+  const env = new TypeCheckFile(fileName, config, refEmmiter, reflectionHost, host);\n+\n+  const ref = new Reference(clazz);\n+\n   const tcb = generateTypeCheckBlock(\n-      FakeEnvironment.newFake(config), new Reference(clazz), ts.createIdentifier('Test_TCB'), meta,\n-      new NoopSchemaChecker(), new NoopOobRecorder());\n+      env, ref, ts.createIdentifier('Test_TCB'), meta, new NoopSchemaChecker(),\n+      new NoopOobRecorder());\n+\n+  env.addTypeCheckBlock(ref, meta, new NoopSchemaChecker(), new NoopOobRecorder());\n \n-  const removeComments = !options.emitSpans;\n-  const res = ts.createPrinter({removeComments}).printNode(ts.EmitHint.Unspecified, tcb, sf);\n-  return res.replace(/\\s+/g, ' ');\n+  const rendered = env.render(!options.emitSpans /* removeComments */);\n+  return rendered.replace(/\\s+/g, ' ');\n }\n \n /**"
        },
        {
            "sha": "6a36e7547cecaa9dd9c6626108cd9a6fdf8a85cc",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/type_check_block_spec.ts",
            "status": "modified",
            "additions": 58,
            "deletions": 49,
            "changes": 107,
            "blob_url": "https://github.com/angular/angular/blob/c267c680d862aecd1ac405021b59bd4e89fac72d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/c267c680d862aecd1ac405021b59bd4e89fac72d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts?ref=c267c680d862aecd1ac405021b59bd4e89fac72d",
            "patch": "@@ -6,12 +6,15 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {initMockFileSystem} from '../../file_system/testing';\n import {TypeCheckingConfig} from '../api';\n \n import {ALL_ENABLED_CONFIG, tcb, TestDeclaration, TestDirective} from './test_utils';\n \n \n describe('type check blocks', () => {\n+  beforeEach(() => initMockFileSystem('Native'));\n+\n   it('should generate a basic block for a binding', () => {\n     expect(tcb('{{hello}} {{world}}')).toContain('\"\" + (((ctx).hello)) + (((ctx).world));');\n   });\n@@ -60,7 +63,7 @@ describe('type check blocks', () => {\n       selector: '[dir]',\n       inputs: {inputA: 'inputA'},\n     }];\n-    expect(tcb(TEMPLATE, DIRECTIVES)).toContain('_t1: DirA = null!; _t1.inputA = (\"value\");');\n+    expect(tcb(TEMPLATE, DIRECTIVES)).toContain('_t1: i0.DirA = null!; _t1.inputA = (\"value\");');\n   });\n \n   it('should handle multiple bindings to the same property', () => {\n@@ -133,9 +136,11 @@ describe('type check blocks', () => {\n         },\n         isGeneric: true,\n       }];\n-      expect(tcb(TEMPLATE, DIRECTIVES))\n-          .toContain(\n-              'var _t1 = Dir.ngTypeCtor({ \"fieldA\": (((ctx).foo)), \"fieldB\": null as any });');\n+      const actual = tcb(TEMPLATE, DIRECTIVES);\n+      expect(actual).toContain(\n+          'const _ctor1: <T extends string = any>(init: Pick<i0.Dir<T>, \"fieldA\" | \"fieldB\">) => i0.Dir<T> = null!;');\n+      expect(actual).toContain(\n+          'var _t1 = _ctor1({ \"fieldA\": (((ctx).foo)), \"fieldB\": null as any });');\n     });\n \n     it('should handle multiple bindings to the same property', () => {\n@@ -183,11 +188,14 @@ describe('type check blocks', () => {\n         inputs: {input: 'input'},\n         isGeneric: true,\n       }];\n-      expect(tcb(TEMPLATE, DIRECTIVES))\n-          .toContain(\n-              'var _t2 = Dir.ngTypeCtor({ \"input\": (null!) }); ' +\n-              'var _t1 = _t2; ' +\n-              '_t2.input = (_t1);');\n+\n+      const actual = tcb(TEMPLATE, DIRECTIVES);\n+      expect(actual).toContain(\n+          'const _ctor1: <T extends string = any>(init: Pick<i0.Dir<T>, \"input\">) => i0.Dir<T> = null!;');\n+      expect(actual).toContain(\n+          'var _t2 = _ctor1({ \"input\": (null!) }); ' +\n+          'var _t1 = _t2; ' +\n+          '_t2.input = (_t1);');\n     });\n \n     it('should generate circular references between two directives correctly', () => {\n@@ -213,14 +221,16 @@ describe('type check blocks', () => {\n           isGeneric: true,\n         }\n       ];\n-      expect(tcb(TEMPLATE, DIRECTIVES))\n-          .toContain(\n-              'var _t4 = DirA.ngTypeCtor({ \"inputA\": (null!) }); ' +\n-              'var _t3 = _t4; ' +\n-              'var _t2 = DirB.ngTypeCtor({ \"inputB\": (_t3) }); ' +\n-              'var _t1 = _t2; ' +\n-              '_t4.inputA = (_t1); ' +\n-              '_t2.inputB = (_t3);');\n+      const actual = tcb(TEMPLATE, DIRECTIVES);\n+      expect(actual).toContain(\n+          'const _ctor1: <T extends string = any>(init: Pick<i0.DirA<T>, \"inputA\">) => i0.DirA<T> = null!; const _ctor2: <T extends string = any>(init: Pick<i0.DirB<T>, \"inputB\">) => i0.DirB<T> = null!;');\n+      expect(actual).toContain(\n+          'var _t4 = _ctor1({ \"inputA\": (null!) }); ' +\n+          'var _t3 = _t4; ' +\n+          'var _t2 = _ctor2({ \"inputB\": (_t3) }); ' +\n+          'var _t1 = _t2; ' +\n+          '_t4.inputA = (_t1); ' +\n+          '_t2.inputB = (_t3);');\n     });\n \n     it('should handle empty bindings', () => {\n@@ -261,7 +271,7 @@ describe('type check blocks', () => {\n       }];\n       expect(tcb(TEMPLATE, DIRECTIVES))\n           .toContain(\n-              'var _t1: typeof Dir.ngAcceptInputType_fieldA = null!; ' +\n+              'var _t1: typeof i0.Dir.ngAcceptInputType_fieldA = null!; ' +\n               '_t1 = (((ctx).foo));');\n     });\n   });\n@@ -321,11 +331,11 @@ describe('type check blocks', () => {\n       },\n     ];\n     const block = tcb(TEMPLATE, DIRECTIVES);\n-    expect(block).toContain('var _t1: HasInput = null!');\n+    expect(block).toContain('var _t1: i0.HasInput = null!');\n     expect(block).toContain('_t1.input = (((ctx).value));');\n-    expect(block).toContain('var _t2: HasOutput = null!');\n+    expect(block).toContain('var _t2: i0.HasOutput = null!');\n     expect(block).toContain('_t2[\"output\"]');\n-    expect(block).toContain('var _t4: HasReference = null!');\n+    expect(block).toContain('var _t4: i0.HasReference = null!');\n     expect(block).toContain('var _t3 = _t4;');\n     expect(block).toContain('(_t3).a');\n     expect(block).not.toContain('NoBindings');\n@@ -355,7 +365,7 @@ describe('type check blocks', () => {\n     }];\n     expect(tcb(TEMPLATE, DIRECTIVES))\n         .toContain(\n-            'var _t2: Dir = null!; ' +\n+            'var _t2: i0.Dir = null!; ' +\n             'var _t1 = _t2; ' +\n             '\"\" + (((_t1).value));');\n   });\n@@ -403,7 +413,7 @@ describe('type check blocks', () => {\n     }];\n     expect(tcb(TEMPLATE, DIRECTIVES))\n         .toContain(\n-            'var _t2: Dir = null!; ' +\n+            'var _t2: i0.Dir = null!; ' +\n             'var _t1 = _t2; ' +\n             '_t2.input = (_t1);');\n   });\n@@ -431,9 +441,9 @@ describe('type check blocks', () => {\n     ];\n     expect(tcb(TEMPLATE, DIRECTIVES))\n         .toContain(\n-            'var _t2: DirB = null!; ' +\n+            'var _t2: i0.DirB = null!; ' +\n             'var _t1 = _t2; ' +\n-            'var _t3: DirA = null!; ' +\n+            'var _t3: i0.DirA = null!; ' +\n             '_t3.inputA = (_t1); ' +\n             'var _t4 = _t3; ' +\n             '_t2.inputA = (_t4);');\n@@ -468,7 +478,7 @@ describe('type check blocks', () => {\n     }];\n     expect(tcb(TEMPLATE, DIRECTIVES))\n         .toContain(\n-            'var _t1: Dir = null!; ' +\n+            'var _t1: i0.Dir = null!; ' +\n             'var _t2: typeof _t1[\"fieldA\"] = null!; ' +\n             '_t2 = (((ctx).foo)); ');\n   });\n@@ -487,7 +497,7 @@ describe('type check blocks', () => {\n        }];\n        const block = tcb(TEMPLATE, DIRECTIVES);\n        expect(block).toContain(\n-           'var _t1: Dir = null!; ' +\n+           'var _t1: i0.Dir = null!; ' +\n            '_t1[\"some-input.xs\"] = (((ctx).foo)); ');\n      });\n \n@@ -504,7 +514,7 @@ describe('type check blocks', () => {\n     }];\n     expect(tcb(TEMPLATE, DIRECTIVES))\n         .toContain(\n-            'var _t1: Dir = null!; ' +\n+            'var _t1: i0.Dir = null!; ' +\n             '_t1.field2 = _t1.field1 = (((ctx).foo));');\n   });\n \n@@ -523,8 +533,8 @@ describe('type check blocks', () => {\n        }];\n        expect(tcb(TEMPLATE, DIRECTIVES))\n            .toContain(\n-               'var _t1: typeof Dir.ngAcceptInputType_field1 = null!; ' +\n-               'var _t2: Dir = null!; ' +\n+               'var _t1: typeof i0.Dir.ngAcceptInputType_field1 = null!; ' +\n+               'var _t2: i0.Dir = null!; ' +\n                '_t2.field2 = _t1 = (((ctx).foo));');\n      });\n \n@@ -543,7 +553,7 @@ describe('type check blocks', () => {\n        }];\n        expect(tcb(TEMPLATE, DIRECTIVES))\n            .toContain(\n-               'var _t1: Dir = null!; ' +\n+               'var _t1: i0.Dir = null!; ' +\n                '_t1.field2 = (((ctx).foo));');\n      });\n \n@@ -561,7 +571,7 @@ describe('type check blocks', () => {\n     const block = tcb(TEMPLATE, DIRECTIVES);\n     expect(block).not.toContain('var _t1: Dir = null!;');\n     expect(block).toContain(\n-        'var _t1: typeof Dir.ngAcceptInputType_fieldA = null!; ' +\n+        'var _t1: typeof i0.Dir.ngAcceptInputType_fieldA = null!; ' +\n         '_t1 = (((ctx).foo));');\n   });\n \n@@ -580,7 +590,7 @@ describe('type check blocks', () => {\n     const block = tcb(TEMPLATE, DIRECTIVES);\n     expect(block).not.toContain('var _t1: Dir = null!;');\n     expect(block).toContain(\n-        'var _t1: typeof Dir.ngAcceptInputType_fieldA = null!; ' +\n+        'var _t1: typeof i0.Dir.ngAcceptInputType_fieldA = null!; ' +\n         '_t1 = (((ctx).foo));');\n   });\n \n@@ -619,7 +629,7 @@ describe('type check blocks', () => {\n       }];\n       const TEMPLATE = `<div *ngIf=\"person\">{{person.name}}</div>`;\n       const block = tcb(TEMPLATE, DIRECTIVES);\n-      expect(block).toContain('if (NgIf.ngTemplateGuard_ngIf(_t1, ((ctx).person)))');\n+      expect(block).toContain('if (i0.NgIf.ngTemplateGuard_ngIf(_t1, ((ctx).person)))');\n     });\n \n     it('should emit binding guards', () => {\n@@ -672,8 +682,7 @@ describe('type check blocks', () => {\n     it('should emit a listener function with AnimationEvent for animation events', () => {\n       const TEMPLATE = `<div (@animation.done)=\"foo($event)\"></div>`;\n       const block = tcb(TEMPLATE);\n-      expect(block).toContain(\n-          'function ($event: animations.AnimationEvent): any { (ctx).foo($event); }');\n+      expect(block).toContain('function ($event: i1.AnimationEvent): any { (ctx).foo($event); }');\n     });\n \n     it('should emit addEventListener calls for unclaimed outputs', () => {\n@@ -740,7 +749,7 @@ describe('type check blocks', () => {\n \n     describe('config.applyTemplateContextGuards', () => {\n       const TEMPLATE = `<div *dir>{{ value }}</div>`;\n-      const GUARD_APPLIED = 'if (Dir.ngTemplateContextGuard(';\n+      const GUARD_APPLIED = 'if (i0.Dir.ngTemplateContextGuard(';\n \n       it('should apply template context guards when enabled', () => {\n         const block = tcb(TEMPLATE, DIRECTIVES);\n@@ -769,13 +778,13 @@ describe('type check blocks', () => {\n \n       it('generates a references var when enabled', () => {\n         const block = tcb(TEMPLATE, DIRECTIVES);\n-        expect(block).toContain('var _t1 = (_t2 as any as core.TemplateRef<any>);');\n+        expect(block).toContain('var _t1 = (_t2 as any as i1.TemplateRef<any>);');\n       });\n \n       it('generates a reference var when disabled', () => {\n         const DISABLED_CONFIG: TypeCheckingConfig = {...BASE_CONFIG, checkTemplateBodies: false};\n         const block = tcb(TEMPLATE, DIRECTIVES, DISABLED_CONFIG);\n-        expect(block).toContain('var _t1 = (_t2 as any as core.TemplateRef<any>);');\n+        expect(block).toContain('var _t1 = (_t2 as any as i1.TemplateRef<any>);');\n       });\n     });\n \n@@ -848,8 +857,7 @@ describe('type check blocks', () => {\n \n       it('should check types of animation events when enabled', () => {\n         const block = tcb(TEMPLATE, DIRECTIVES);\n-        expect(block).toContain(\n-            'function ($event: animations.AnimationEvent): any { (ctx).foo($event); }');\n+        expect(block).toContain('function ($event: i1.AnimationEvent): any { (ctx).foo($event); }');\n       });\n       it('should not check types of animation events when disabled', () => {\n         const DISABLED_CONFIG:\n@@ -919,7 +927,7 @@ describe('type check blocks', () => {\n       it('should trace references to an <ng-template> when enabled', () => {\n         const block = tcb(TEMPLATE, DIRECTIVES);\n         expect(block).toContain(\n-            'var _t3 = (_t4 as any as core.TemplateRef<any>); ' +\n+            'var _t3 = (_t4 as any as i1.TemplateRef<any>); ' +\n             '\"\" + (((_t3).value2));');\n       });\n \n@@ -968,13 +976,14 @@ describe('type check blocks', () => {\n \n       it('should check types of pipes when enabled', () => {\n         const block = tcb(TEMPLATE, PIPES);\n-        expect(block).toContain('(null as TestPipe).transform(((ctx).a), ((ctx).b), ((ctx).c))');\n+        expect(block).toContain('var _pipe1: i0.TestPipe = null!;');\n+        expect(block).toContain('(_pipe1.transform(((ctx).a), ((ctx).b), ((ctx).c)));');\n       });\n       it('should not check types of pipes when disabled', () => {\n         const DISABLED_CONFIG: TypeCheckingConfig = {...BASE_CONFIG, checkTypeOfPipes: false};\n         const block = tcb(TEMPLATE, PIPES, DISABLED_CONFIG);\n-        expect(block).toContain(\n-            '((null as TestPipe) as any).transform(((ctx).a), ((ctx).b), ((ctx).c))');\n+        expect(block).toContain('var _pipe1: i0.TestPipe = null!;');\n+        expect(block).toContain('((_pipe1 as any).transform(((ctx).a), ((ctx).b), ((ctx).c)));');\n       });\n     });\n \n@@ -1016,13 +1025,13 @@ describe('type check blocks', () => {\n \n       it('should use the generic type of the context when enabled', () => {\n         const block = tcb(TEMPLATE);\n-        expect(block).toContain('function Test_TCB<T extends string>(ctx: Test<T>)');\n+        expect(block).toContain('function _tcb1<T extends string>(ctx: i0.Test<T>)');\n       });\n \n       it('should use any for the context generic type when disabled', () => {\n         const DISABLED_CONFIG: TypeCheckingConfig = {...BASE_CONFIG, useContextGenericType: false};\n         const block = tcb(TEMPLATE, undefined, DISABLED_CONFIG);\n-        expect(block).toContain('function Test_TCB(ctx: Test<any>)');\n+        expect(block).toContain('function _tcb1(ctx: i0.Test<any>)');\n       });\n     });\n \n@@ -1045,7 +1054,7 @@ describe('type check blocks', () => {\n                TypeCheckingConfig = {...BASE_CONFIG, honorAccessModifiersForInputBindings: true};\n            const block = tcb(TEMPLATE, DIRECTIVES, enableChecks);\n            expect(block).toContain(\n-               'var _t1: Dir = null!; ' +\n+               'var _t1: i0.Dir = null!; ' +\n                '_t1[\"some-input.xs\"] = (((ctx).foo)); ');\n          });\n \n@@ -1063,7 +1072,7 @@ describe('type check blocks', () => {\n             TypeCheckingConfig = {...BASE_CONFIG, honorAccessModifiersForInputBindings: true};\n         const block = tcb(TEMPLATE, DIRECTIVES, enableChecks);\n         expect(block).toContain(\n-            'var _t1: Dir = null!; ' +\n+            'var _t1: i0.Dir = null!; ' +\n             '_t1.fieldA = (((ctx).foo)); ');\n       });\n     });"
        },
        {
            "sha": "4ac6638c0e71a44b3e18858f20a68e63777cfa59",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/type_constructor_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/c267c680d862aecd1ac405021b59bd4e89fac72d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_constructor_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/c267c680d862aecd1ac405021b59bd4e89fac72d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_constructor_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_constructor_spec.ts?ref=c267c680d862aecd1ac405021b59bd4e89fac72d",
            "patch": "@@ -43,7 +43,7 @@ runInEachFileSystem(() => {\n       const file = new TypeCheckFile(\n           _('/_typecheck_.ts'), ALL_ENABLED_CONFIG, new ReferenceEmitter([]),\n           /* reflector */ null!, host);\n-      const sf = file.render();\n+      const sf = file.render(false /* removeComments */);\n       expect(sf).toContain('export const IS_A_MODULE = true;');\n     });\n "
        }
    ],
    "stats": {
        "total": 157,
        "additions": 95,
        "deletions": 62
    }
}