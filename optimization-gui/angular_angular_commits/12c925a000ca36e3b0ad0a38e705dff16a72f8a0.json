{
    "author": "petebacondarwin",
    "message": "refactor(compiler): consolidate `wrapReference()` (#41080)\n\nThis function is declared in multiple places. The instances inside\n`compiler` are slightly different to those in `compiler-cli`. So this\ncommit consolidates them into two reusable functions.\n\nPR Close #41080",
    "sha": "12c925a000ca36e3b0ad0a38e705dff16a72f8a0",
    "files": [
        {
            "sha": "16b75c530d86a0518364fff6eca4dd1ed1f1db1a",
            "filename": "packages/compiler-cli/linker/src/file_linker/partial_linkers/partial_directive_linker_1.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/12c925a000ca36e3b0ad0a38e705dff16a72f8a0/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_directive_linker_1.ts",
            "raw_url": "https://github.com/angular/angular/raw/12c925a000ca36e3b0ad0a38e705dff16a72f8a0/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_directive_linker_1.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_directive_linker_1.ts?ref=12c925a000ca36e3b0ad0a38e705dff16a72f8a0",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {compileDirectiveFromMetadata, ConstantPool, makeBindingParser, ParseLocation, ParseSourceFile, ParseSourceSpan, R3DeclareDirectiveMetadata, R3DeclareQueryMetadata, R3DirectiveMetadata, R3HostMetadata, R3PartialDeclaration, R3QueryMetadata, R3Reference} from '@angular/compiler';\n+import {compileDirectiveFromMetadata, ConstantPool, makeBindingParser, ParseLocation, ParseSourceFile, ParseSourceSpan, R3DeclareDirectiveMetadata, R3DeclareQueryMetadata, R3DirectiveMetadata, R3HostMetadata, R3PartialDeclaration, R3QueryMetadata} from '@angular/compiler';\n import * as o from '@angular/compiler/src/output/output_ast';\n \n import {AbsoluteFsPath} from '../../../../src/ngtsc/file_system';\n@@ -14,6 +14,7 @@ import {AstObject, AstValue} from '../../ast/ast_value';\n import {FatalLinkerError} from '../../fatal_linker_error';\n \n import {PartialLinker} from './partial_linker';\n+import {wrapReference} from './util';\n \n /**\n  * A `PartialLinker` that is designed to process `ɵɵngDeclareDirective()` call expressions.\n@@ -154,10 +155,6 @@ function toQueryMetadata<TExpression>(obj: AstObject<R3DeclareQueryMetadata, TEx\n   };\n }\n \n-function wrapReference<TExpression>(wrapped: o.WrappedNodeExpr<TExpression>): R3Reference {\n-  return {value: wrapped, type: wrapped};\n-}\n-\n export function createSourceSpan(range: Range, code: string, sourceUrl: string): ParseSourceSpan {\n   const sourceFile = new ParseSourceFile(code, sourceUrl);\n   const startLocation ="
        },
        {
            "sha": "a3d4df827a3c7584279f5be5ff593745a45d26fb",
            "filename": "packages/compiler-cli/linker/src/file_linker/partial_linkers/partial_pipe_linker_1.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/12c925a000ca36e3b0ad0a38e705dff16a72f8a0/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_pipe_linker_1.ts",
            "raw_url": "https://github.com/angular/angular/raw/12c925a000ca36e3b0ad0a38e705dff16a72f8a0/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_pipe_linker_1.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_pipe_linker_1.ts?ref=12c925a000ca36e3b0ad0a38e705dff16a72f8a0",
            "patch": "@@ -5,13 +5,14 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {compilePipeFromMetadata, ConstantPool, R3DeclarePipeMetadata, R3PartialDeclaration, R3PipeMetadata, R3Reference} from '@angular/compiler';\n+import {compilePipeFromMetadata, ConstantPool, R3DeclarePipeMetadata, R3PartialDeclaration, R3PipeMetadata} from '@angular/compiler';\n import * as o from '@angular/compiler/src/output/output_ast';\n \n import {AstObject} from '../../ast/ast_value';\n import {FatalLinkerError} from '../../fatal_linker_error';\n \n import {PartialLinker} from './partial_linker';\n+import {wrapReference} from './util';\n \n /**\n  * A `PartialLinker` that is designed to process `ɵɵngDeclarePipe()` call expressions.\n@@ -52,7 +53,3 @@ export function toR3PipeMeta<TExpression>(metaObj: AstObject<R3DeclarePipeMetada\n     pure,\n   };\n }\n-\n-function wrapReference<TExpression>(wrapped: o.WrappedNodeExpr<TExpression>): R3Reference {\n-  return {value: wrapped, type: wrapped};\n-}"
        },
        {
            "sha": "87e391d9bde2a0aee9fdd279062bcbc34c751c71",
            "filename": "packages/compiler-cli/linker/src/file_linker/partial_linkers/util.ts",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/12c925a000ca36e3b0ad0a38e705dff16a72f8a0/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/12c925a000ca36e3b0ad0a38e705dff16a72f8a0/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Futil.ts?ref=12c925a000ca36e3b0ad0a38e705dff16a72f8a0",
            "patch": "@@ -0,0 +1,13 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+import {R3Reference} from '@angular/compiler';\n+import * as o from '@angular/compiler/src/output/output_ast';\n+\n+export function wrapReference<TExpression>(wrapped: o.WrappedNodeExpr<TExpression>): R3Reference {\n+  return {value: wrapped, type: wrapped};\n+}"
        },
        {
            "sha": "33cc08452c9580f7d885441c61942078d9c8e1af",
            "filename": "packages/compiler/src/jit_compiler_facade.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/12c925a000ca36e3b0ad0a38e705dff16a72f8a0/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "raw_url": "https://github.com/angular/angular/raw/12c925a000ca36e3b0ad0a38e705dff16a72f8a0/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts?ref=12c925a000ca36e3b0ad0a38e705dff16a72f8a0",
            "patch": "@@ -20,7 +20,7 @@ import {compileFactoryFunction, R3DependencyMetadata, R3FactoryTarget, R3Resolve\n import {R3JitReflector} from './render3/r3_jit';\n import {compileInjector, compileNgModule, R3InjectorMetadata, R3NgModuleMetadata} from './render3/r3_module_compiler';\n import {compilePipeFromMetadata, R3PipeMetadata} from './render3/r3_pipe_compiler';\n-import {getSafePropertyAccessString, R3Reference} from './render3/util';\n+import {getSafePropertyAccessString, wrapReference} from './render3/util';\n import {DeclarationListEmitMode, R3ComponentMetadata, R3DirectiveMetadata, R3HostMetadata, R3QueryMetadata, R3UsedDirectiveMetadata} from './render3/view/api';\n import {compileComponentFromMetadata, compileDirectiveFromMetadata, ParsedHostBindings, parseHostBindings, verifyHostBindings} from './render3/view/compiler';\n import {makeBindingParser, parseTemplate} from './render3/view/template';\n@@ -239,11 +239,6 @@ const USE_FACTORY = Object.keys({useFactory: null})[0];\n const USE_VALUE = Object.keys({useValue: null})[0];\n const USE_EXISTING = Object.keys({useExisting: null})[0];\n \n-const wrapReference = function(value: any): R3Reference {\n-  const wrapped = new WrappedNodeExpr(value);\n-  return {value: wrapped, type: wrapped};\n-};\n-\n function convertToR3QueryMetadata(facade: R3QueryMetadataFacade): R3QueryMetadata {\n   return {\n     ...facade,"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 18,
        "deletions": 16
    }
}