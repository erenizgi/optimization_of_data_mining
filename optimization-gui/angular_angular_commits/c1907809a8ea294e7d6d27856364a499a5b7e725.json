{
    "author": "gkalpak",
    "message": "test(elements): add integration tests for Angular Elements using `ShadowDom` (#39452)\n\nPreviously, the project used for running integration tests for Angular\nElements declared a component that used `ShadowDom` for view\nencopsulation, but it did not include any tests to verify that the view\nwas updated correctly.\n\nThis commit adds the missing tests.\n\nPR Close #39452",
    "sha": "c1907809a8ea294e7d6d27856364a499a5b7e725",
    "files": [
        {
            "sha": "8da6d63c439a7b6966a25951d32b93134d3bb53f",
            "filename": "integration/ng_elements/e2e/app.e2e-spec.ts",
            "status": "modified",
            "additions": 30,
            "deletions": 10,
            "changes": 40,
            "blob_url": "https://github.com/angular/angular/blob/c1907809a8ea294e7d6d27856364a499a5b7e725/integration%2Fng_elements%2Fe2e%2Fapp.e2e-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/c1907809a8ea294e7d6d27856364a499a5b7e725/integration%2Fng_elements%2Fe2e%2Fapp.e2e-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fng_elements%2Fe2e%2Fapp.e2e-spec.ts?ref=c1907809a8ea294e7d6d27856364a499a5b7e725",
            "patch": "@@ -1,22 +1,42 @@\n-import { browser, element, ExpectedConditions as EC, by } from 'protractor';\n+import {browser, by, element, ElementFinder, ExpectedConditions as EC} from 'protractor';\n \n browser.waitForAngularEnabled(false);\n describe('Element E2E Tests', function () {\n   describe('Hello World Elements', () => {\n-    const helloWorldEl = element(by.css('hello-world-el'));\n-\n     beforeEach(() => browser.get('hello-world.html'));\n \n-    it('should display \"Hello World!\"', function () {\n-      expect(helloWorldEl.getText()).toEqual('Hello World!');\n+    describe('(with default view encapsulation)', () => {\n+      const helloWorldEl = element(by.css('hello-world-el'));\n+\n+      it('should display \"Hello World!\"', function () {\n+        expect(helloWorldEl.getText()).toBe('Hello World!');\n+      });\n+\n+      it('should display \"Hello Foo!\" via name attribute', function () {\n+        const input = element(by.css('input[type=text]'));\n+        input.sendKeys('Foo');\n+\n+        // Make tests less flaky on CI by waiting up to 5s for the element text to be updated.\n+        browser.wait(EC.textToBePresentInElement(helloWorldEl, 'Hello Foo!'), 5000);\n+      });\n     });\n \n-    it('should display \"Hello Foo!\" via name attribute', function () {\n-      const input = element(by.css('input[type=text]'));\n-      input.sendKeys('Foo');\n+    describe('(with `ShadowDom` view encapsulation)', () => {\n+      const helloWorldShadowEl = element(by.css('hello-world-shadow-el'));\n+      const getShadowDomText = (el: ElementFinder) =>\n+        browser.executeScript('return arguments[0].shadowRoot.textContent', el);\n+\n+      it('should display \"Hello World!\"', function () {\n+        expect(getShadowDomText(helloWorldShadowEl)).toBe('Hello World!');\n+      });\n+\n+      it('should display \"Hello Foo!\" via name attribute', function () {\n+        const input = element(by.css('input[type=text]'));\n+        input.sendKeys('Foo');\n \n-      // Make tests less flaky on CI by waiting up to 5s for the element text to be updated.\n-      browser.wait(EC.textToBePresentInElement(helloWorldEl, 'Hello Foo!'), 5000);\n+        // Make tests less flaky on CI by waiting up to 5s for the element text to be updated.\n+        browser.wait(async () => await getShadowDomText(helloWorldShadowEl) === 'Hello Foo!', 5000);\n+      });\n     });\n   });\n });"
        },
        {
            "sha": "23dbddb997212f7f3f385bd79b6fdcaa9d30da82",
            "filename": "integration/ng_elements/src/app.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/c1907809a8ea294e7d6d27856364a499a5b7e725/integration%2Fng_elements%2Fsrc%2Fapp.ts",
            "raw_url": "https://github.com/angular/angular/raw/c1907809a8ea294e7d6d27856364a499a5b7e725/integration%2Fng_elements%2Fsrc%2Fapp.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fng_elements%2Fsrc%2Fapp.ts?ref=c1907809a8ea294e7d6d27856364a499a5b7e725",
            "patch": "@@ -11,7 +11,7 @@ import {HelloWorldComponent, HelloWorldShadowComponent, TestCardComponent} from\n   imports: [BrowserModule],\n })\n export class AppModule {\n-  constructor(private injector: Injector) {\n+  constructor(injector: Injector) {\n     customElements.define('hello-world-el', createCustomElement(HelloWorldComponent, {injector}));\n     customElements.define(\n         'hello-world-shadow-el', createCustomElement(HelloWorldShadowComponent, {injector}));"
        },
        {
            "sha": "33276decda82fe67b497adc0bcb14ead649321bd",
            "filename": "integration/ng_elements/src/elements.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/c1907809a8ea294e7d6d27856364a499a5b7e725/integration%2Fng_elements%2Fsrc%2Felements.ts",
            "raw_url": "https://github.com/angular/angular/raw/c1907809a8ea294e7d6d27856364a499a5b7e725/integration%2Fng_elements%2Fsrc%2Felements.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fng_elements%2Fsrc%2Felements.ts?ref=c1907809a8ea294e7d6d27856364a499a5b7e725",
            "patch": "@@ -2,22 +2,21 @@ import {Component, Input, ViewEncapsulation} from '@angular/core';\n \n @Component({\n   selector: 'hello-world-el',\n-  template: `Hello {{name}}!`,\n+  template: 'Hello {{name}}!',\n })\n export class HelloWorldComponent {\n   @Input() name: string = 'World';\n }\n \n @Component({\n   selector: 'hello-world-shadow-el',\n-  template: `Hello {{name}}!`,\n-  encapsulation: ViewEncapsulation.ShadowDom\n+  template: 'Hello {{name}}!',\n+  encapsulation: ViewEncapsulation.ShadowDom,\n })\n export class HelloWorldShadowComponent {\n   @Input() name: string = 'World';\n }\n \n-\n @Component({\n   selector: 'test-card',\n   template: `\n@@ -29,7 +28,6 @@ export class HelloWorldShadowComponent {\n       <slot name=\"card-footer\"></slot>\n     </footer>`,\n   encapsulation: ViewEncapsulation.ShadowDom,\n-  styles: []\n })\n export class TestCardComponent {\n }"
        },
        {
            "sha": "022a84790ad688a150677b04550e011a707520f4",
            "filename": "integration/ng_elements/src/hello-world.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/c1907809a8ea294e7d6d27856364a499a5b7e725/integration%2Fng_elements%2Fsrc%2Fhello-world.html",
            "raw_url": "https://github.com/angular/angular/raw/c1907809a8ea294e7d6d27856364a499a5b7e725/integration%2Fng_elements%2Fsrc%2Fhello-world.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fng_elements%2Fsrc%2Fhello-world.html?ref=c1907809a8ea294e7d6d27856364a499a5b7e725",
            "patch": "@@ -10,8 +10,8 @@\n <body>\n   <input type=\"text\">\n   <hello-world-el></hello-world-el>\n+  <hello-world-shadow-el></hello-world-shadow-el>\n   <script src=\"dist/bundle.js\"></script>\n-\n </body>\n \n </html>"
        },
        {
            "sha": "f700992f2fa3a6bb1c452aa1772fcce673cb2887",
            "filename": "integration/ng_elements/src/main.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/c1907809a8ea294e7d6d27856364a499a5b7e725/integration%2Fng_elements%2Fsrc%2Fmain.ts",
            "raw_url": "https://github.com/angular/angular/raw/c1907809a8ea294e7d6d27856364a499a5b7e725/integration%2Fng_elements%2Fsrc%2Fmain.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fng_elements%2Fsrc%2Fmain.ts?ref=c1907809a8ea294e7d6d27856364a499a5b7e725",
            "patch": "@@ -3,8 +3,11 @@ import {AppModuleNgFactory} from './app.ngfactory';\n \n platformBrowser().bootstrapModuleFactory(AppModuleNgFactory, {ngZone: 'noop'});\n \n-const input = document.querySelector('input');\n-const helloWorld = document.querySelector('hello-world-el');\n-if(input && helloWorld){\n-  input.addEventListener('input', () => helloWorld.setAttribute('name', input.value));\n-}\n+const input = document.querySelector('input')!;\n+const helloWorld = document.querySelector('hello-world-el')!;\n+const helloWorldShadow = document.querySelector('hello-world-shadow-el')!;\n+\n+input.addEventListener('input', () => {\n+  helloWorld.setAttribute('name', input.value);\n+  helloWorldShadow.setAttribute('name', input.value);\n+});"
        }
    ],
    "stats": {
        "total": 65,
        "additions": 43,
        "deletions": 22
    }
}