{
    "author": "petebacondarwin",
    "message": "refactor(compiler): remove `R3ResolvedDependencyType` altogether (#41231)\n\nNow that other values were removed from `R3ResolvedDependencyType`,\nits meaning can now be inferred from the other properties in the\n`R3DeclareDependencyMetadata` type. This commit removes this enum\nand updates the code to work without it.\n\nPR Close #41231",
    "sha": "72b65f995d21847e473cac398d52c25978446f4d",
    "files": [
        {
            "sha": "c19e50971680376a87337d677677623cdf806b22",
            "filename": "packages/compiler-cli/linker/src/file_linker/partial_linkers/partial_factory_linker_1.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 16,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_factory_linker_1.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_factory_linker_1.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Flinker%2Fsrc%2Ffile_linker%2Fpartial_linkers%2Fpartial_factory_linker_1.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {compileFactoryFunction, ConstantPool, R3DeclareFactoryMetadata, R3DependencyMetadata, R3FactoryMetadata, R3FactoryTarget, R3PartialDeclaration, R3ResolvedDependencyType} from '@angular/compiler';\n+import {compileFactoryFunction, ConstantPool, R3DeclareDependencyMetadata, R3DeclareFactoryMetadata, R3DependencyMetadata, R3FactoryMetadata, R3FactoryTarget, R3PartialDeclaration} from '@angular/compiler';\n import * as o from '@angular/compiler/src/output/output_ast';\n \n import {AstObject} from '../../ast/ast_value';\n@@ -39,18 +39,14 @@ export function toR3FactoryMeta<TExpression>(\n         typeExpr.expression, 'Unsupported type, its name could not be determined');\n   }\n \n-  const deps = getDeps(metaObj, 'deps');\n-\n-  const meta: R3FactoryMetadata = {\n+  return {\n     name: typeName,\n     type: wrapReference(typeExpr.getOpaque()),\n     internalType: metaObj.getOpaque('type'),\n     typeArgumentCount: 0,\n     target: parseEnum(metaObj.getValue('target'), R3FactoryTarget),\n-    deps,\n+    deps: getDeps(metaObj, 'deps'),\n   };\n-\n-  return meta;\n }\n \n function getDeps<TExpression>(\n@@ -69,15 +65,24 @@ function getDeps<TExpression>(\n   return null;\n }\n \n-function getDep<TExpression>(dep: AstObject<R3DependencyMetadata, TExpression>):\n+function getDep<TExpression>(depObj: AstObject<R3DeclareDependencyMetadata, TExpression>):\n     R3DependencyMetadata {\n-  return {\n-    token: dep.getOpaque('token'),\n-    attribute: null,\n-    resolved: parseEnum(dep.getValue('resolved'), R3ResolvedDependencyType),\n-    host: dep.has('host') && dep.getBoolean('host'),\n-    optional: dep.has('optional') && dep.getBoolean('optional'),\n-    self: dep.has('self') && dep.getBoolean('self'),\n-    skipSelf: dep.has('skipSelf') && dep.getBoolean('skipSelf'),\n+  const isAttribute = depObj.has('attribute') && depObj.getBoolean('attribute');\n+  const token = depObj.getOpaque('token');\n+  // Normally `attribute` is a string literal and so its `attributeNameType` is the same string\n+  // literal. If the `attribute` is some other expression, the `attributeNameType` would be the\n+  // `unknown` type. It is not possible to generate this when linking, since it only deals with JS\n+  // and not typings. When linking the existence of the `attributeNameType` only acts as a marker to\n+  // change the injection instruction that is generated, so we just pass the literal string\n+  // `\"unknown\"`.\n+  const attributeNameType = isAttribute ? o.literal('unknown') : null;\n+  const dep: R3DependencyMetadata = {\n+    token,\n+    attributeNameType,\n+    host: depObj.has('host') && depObj.getBoolean('host'),\n+    optional: depObj.has('optional') && depObj.getBoolean('optional'),\n+    self: depObj.has('self') && depObj.getBoolean('self'),\n+    skipSelf: depObj.has('skipSelf') && depObj.getBoolean('skipSelf'),\n   };\n+  return dep;\n }"
        },
        {
            "sha": "14202934815b25e1ed55e4b89d74545d98a4dec2",
            "filename": "packages/compiler-cli/ngcc/test/integration/ngcc_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -384,7 +384,7 @@ runInEachFileSystem(() => {\n          expect(jsContents).toContain('__spreadArray([], __read(arguments))');\n          expect(jsContents)\n              .toContain(\n-                 'var ɵSubClass_BaseFactory = /*@__PURE__*/ ɵngcc0.ɵɵgetInheritedFactory(SubClass);');\n+                 'var ɵSubClass_BaseFactory; return function SubClass_Factory(t) { return (ɵSubClass_BaseFactory || (ɵSubClass_BaseFactory = ɵngcc0.ɵɵgetInheritedFactory(SubClass)))(t || SubClass); };');\n        });\n \n     it(`should be able to detect synthesized constructors in ES5 with downlevelIteration enabled (emitted helpers)`,\n@@ -423,7 +423,7 @@ runInEachFileSystem(() => {\n          expect(jsContents).toContain('__spreadArray([], __read(arguments))');\n          expect(jsContents)\n              .toContain(\n-                 'var ɵSubClass_BaseFactory = /*@__PURE__*/ ɵngcc0.ɵɵgetInheritedFactory(SubClass);');\n+                 'var ɵSubClass_BaseFactory; return function SubClass_Factory(t) { return (ɵSubClass_BaseFactory || (ɵSubClass_BaseFactory = ɵngcc0.ɵɵgetInheritedFactory(SubClass)))(t || SubClass); };');\n        });\n \n     it('should not add `const` in ES5 generated code', () => {"
        },
        {
            "sha": "4898493dffbb4340e5b2b8484bcfa8e70ff79d93",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/component.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {compileComponentFromMetadata, compileDeclareComponentFromMetadata, ConstantPool, CssSelector, DeclarationListEmitMode, DEFAULT_INTERPOLATION_CONFIG, DomElementSchemaRegistry, Expression, ExternalExpr, Identifiers, InterpolationConfig, LexerRange, makeBindingParser, ParsedTemplate, ParseSourceFile, parseTemplate, R3CompiledExpression, R3ComponentMetadata, R3FactoryMetadata, R3FactoryTarget, R3TargetBinder, R3UsedDirectiveMetadata, SelectorMatcher, Statement, TmplAstNode, WrappedNodeExpr} from '@angular/compiler';\n+import {compileComponentFromMetadata, compileDeclareComponentFromMetadata, ConstantPool, CssSelector, DeclarationListEmitMode, DEFAULT_INTERPOLATION_CONFIG, DomElementSchemaRegistry, Expression, ExternalExpr, InterpolationConfig, LexerRange, makeBindingParser, ParsedTemplate, ParseSourceFile, parseTemplate, R3ComponentMetadata, R3FactoryMetadata, R3FactoryTarget, R3TargetBinder, R3UsedDirectiveMetadata, SelectorMatcher, Statement, TmplAstNode, WrappedNodeExpr} from '@angular/compiler';\n import * as ts from 'typescript';\n \n import {Cycle, CycleAnalyzer, CycleHandlingStrategy} from '../../cycles';"
        },
        {
            "sha": "0a175d7eeb00c5aa3da201b295ce902a0d5ddb29",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/directive.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 18,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {compileDeclareDirectiveFromMetadata, compileDirectiveFromMetadata, ConstantPool, Expression, ExternalExpr, getSafePropertyAccessString, Identifiers, makeBindingParser, ParsedHostBindings, ParseError, parseHostBindings, R3CompiledExpression, R3DependencyMetadata, R3DirectiveMetadata, R3FactoryMetadata, R3FactoryTarget, R3QueryMetadata, R3ResolvedDependencyType, Statement, verifyHostBindings, WrappedNodeExpr} from '@angular/compiler';\n+import {compileDeclareDirectiveFromMetadata, compileDirectiveFromMetadata, ConstantPool, Expression, ExternalExpr, getSafePropertyAccessString, makeBindingParser, ParsedHostBindings, ParseError, parseHostBindings, R3DirectiveMetadata, R3FactoryMetadata, R3FactoryTarget, R3QueryMetadata, Statement, verifyHostBindings, WrappedNodeExpr} from '@angular/compiler';\n import {emitDistinctChangesOnlyDefaultValue} from '@angular/compiler/src/core';\n import * as ts from 'typescript';\n \n@@ -468,27 +468,19 @@ export function extractDirectiveMetadata(\n   }\n \n   const rawCtorDeps = getConstructorDependencies(clazz, reflector, defaultImportRecorder, isCore);\n-  let ctorDeps: R3DependencyMetadata[]|'invalid'|null;\n \n   // Non-abstract directives (those with a selector) require valid constructor dependencies, whereas\n   // abstract directives are allowed to have invalid dependencies, given that a subclass may call\n   // the constructor explicitly.\n-  if (selector !== null) {\n-    ctorDeps = validateConstructorDependencies(clazz, rawCtorDeps);\n-  } else {\n-    ctorDeps = unwrapConstructorDependencies(rawCtorDeps);\n-  }\n-\n-  const isStructural = ctorDeps !== null && ctorDeps !== 'invalid' && ctorDeps.some(dep => {\n-    if (dep.resolved !== R3ResolvedDependencyType.Token || !(dep.token instanceof ExternalExpr)) {\n-      return false;\n-    }\n-    if (dep.token.value.moduleName !== '@angular/core' || dep.token.value.name !== 'TemplateRef') {\n-      return false;\n-    }\n-\n-    return true;\n-  });\n+  const ctorDeps = selector !== null ? validateConstructorDependencies(clazz, rawCtorDeps) :\n+                                       unwrapConstructorDependencies(rawCtorDeps);\n+\n+  // Structural directives must have a `TemplateRef` dependency.\n+  const isStructural = ctorDeps !== null && ctorDeps !== 'invalid' &&\n+      ctorDeps.some(\n+          dep => (dep.token instanceof ExternalExpr) &&\n+              dep.token.value.moduleName === '@angular/core' &&\n+              dep.token.value.name === 'TemplateRef');\n \n   // Detect if the component inherits from another class\n   const usesInheritance = reflector.hasBaseClass(clazz);"
        },
        {
            "sha": "65d5e4839b010ceb0047dba82f18fd96c766725c",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/injectable.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Finjectable.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Finjectable.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Finjectable.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {compileInjectable as compileIvyInjectable, Expression, LiteralExpr, R3DependencyMetadata, R3FactoryMetadata, R3FactoryTarget, R3InjectableMetadata, R3ResolvedDependencyType, Statement, WrappedNodeExpr} from '@angular/compiler';\n+import {compileInjectable as compileIvyInjectable, Expression, LiteralExpr, R3DependencyMetadata, R3FactoryMetadata, R3FactoryTarget, R3InjectableMetadata, Statement, WrappedNodeExpr} from '@angular/compiler';\n import * as ts from 'typescript';\n \n import {ErrorCode, FatalDiagnosticError} from '../../diagnostics';\n@@ -320,9 +320,8 @@ function extractInjectableCtorDeps(\n function getDep(dep: ts.Expression, reflector: ReflectionHost): R3DependencyMetadata {\n   const meta: R3DependencyMetadata = {\n     token: new WrappedNodeExpr(dep),\n-    attribute: null,\n+    attributeNameType: null,\n     host: false,\n-    resolved: R3ResolvedDependencyType.Token,\n     optional: false,\n     self: false,\n     skipSelf: false,"
        },
        {
            "sha": "2fbf65c983125c655f25a441c16704bbd193c113",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/util.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Futil.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Expression, ExternalExpr, LiteralExpr, ParseLocation, ParseSourceFile, ParseSourceSpan, R3CompiledExpression, R3DependencyMetadata, R3Reference, R3ResolvedDependencyType, ReadPropExpr, Statement, WrappedNodeExpr} from '@angular/compiler';\n+import {Expression, ExternalExpr, LiteralExpr, ParseLocation, ParseSourceFile, ParseSourceSpan, R3CompiledExpression, R3DependencyMetadata, R3Reference, ReadPropExpr, Statement, WrappedNodeExpr} from '@angular/compiler';\n import * as ts from 'typescript';\n \n import {ErrorCode, FatalDiagnosticError, makeDiagnostic, makeRelatedInformation} from '../../diagnostics';\n@@ -44,9 +44,8 @@ export function getConstructorDependencies(\n   }\n   ctorParams.forEach((param, idx) => {\n     let token = valueReferenceToExpression(param.typeValueReference, defaultImportRecorder);\n-    let attribute: Expression|null = null;\n+    let attributeNameType: Expression|null = null;\n     let optional = false, self = false, skipSelf = false, host = false;\n-    let resolved = R3ResolvedDependencyType.Token;\n \n     (param.decorators || []).filter(dec => isCore || isAngularCore(dec)).forEach(dec => {\n       const name = isCore || dec.import === null ? dec.name : dec.import!.name;\n@@ -74,11 +73,11 @@ export function getConstructorDependencies(\n         const attributeName = dec.args[0];\n         token = new WrappedNodeExpr(attributeName);\n         if (ts.isStringLiteralLike(attributeName)) {\n-          attribute = new LiteralExpr(attributeName.text);\n+          attributeNameType = new LiteralExpr(attributeName.text);\n         } else {\n-          attribute = new WrappedNodeExpr(ts.createKeywordTypeNode(ts.SyntaxKind.UnknownKeyword));\n+          attributeNameType =\n+              new WrappedNodeExpr(ts.createKeywordTypeNode(ts.SyntaxKind.UnknownKeyword));\n         }\n-        resolved = R3ResolvedDependencyType.Attribute;\n       } else {\n         throw new FatalDiagnosticError(\n             ErrorCode.DECORATOR_UNEXPECTED, Decorator.nodeForError(dec),\n@@ -97,7 +96,7 @@ export function getConstructorDependencies(\n         reason: param.typeValueReference.reason,\n       });\n     } else {\n-      deps.push({token, attribute, optional, self, skipSelf, host, resolved});\n+      deps.push({token, attributeNameType, optional, self, skipSelf, host});\n     }\n   });\n   if (errors.length === 0) {"
        },
        {
            "sha": "f57ec5ffbb679f0351d5d6eaee90c68fc1432ff7",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/lifecycle_hooks/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Flifecycle_hooks%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Flifecycle_hooks%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Flifecycle_hooks%2FGOLDEN_PARTIAL.js?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -43,7 +43,7 @@ import * as i0 from \"@angular/core\";\n export class IfDirective {\n     constructor(template) { }\n }\n-IfDirective.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: IfDirective, deps: [{ token: i0.TemplateRef, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.Directive });\n+IfDirective.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: IfDirective, deps: [{ token: i0.TemplateRef }], target: i0.ɵɵFactoryTarget.Directive });\n IfDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: IfDirective, selector: \"[if]\", ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(IfDirective, [{\n         type: Directive,"
        },
        {
            "sha": "46909d4709db4c487b7cf1aad69ca9e100062868",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/pipes/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fpipes%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fpipes%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fpipes%2FGOLDEN_PARTIAL.js?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -156,7 +156,7 @@ export class MyPipe {\n         return value;\n     }\n }\n-MyPipe.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyPipe, deps: [{ token: i0.ChangeDetectorRef, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.Pipe });\n+MyPipe.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyPipe, deps: [{ token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Pipe });\n MyPipe.ɵpipe = i0.ɵɵngDeclarePipe({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyPipe, name: \"myPipe\" });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyPipe, [{\n         type: Pipe,\n@@ -168,7 +168,7 @@ export class MyOtherPipe {\n         return value;\n     }\n }\n-MyOtherPipe.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyOtherPipe, deps: [{ token: i0.ChangeDetectorRef, resolved: i0.ɵɵResolvedDependencyType.Token, optional: true }], target: i0.ɵɵFactoryTarget.Pipe });\n+MyOtherPipe.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyOtherPipe, deps: [{ token: i0.ChangeDetectorRef, optional: true }], target: i0.ɵɵFactoryTarget.Pipe });\n MyOtherPipe.ɵpipe = i0.ɵɵngDeclarePipe({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyOtherPipe, name: \"myOtherPipe\" });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyOtherPipe, [{\n         type: Pipe,"
        },
        {
            "sha": "c9dd4dd27a1e5bd08fced4ac8ba3698105e19150",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/template_variables/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Ftemplate_variables%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Ftemplate_variables%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Ftemplate_variables%2FGOLDEN_PARTIAL.js?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -10,7 +10,7 @@ export class ForOfDirective {\n     }\n     ngOnChanges(simpleChanges) { }\n }\n-ForOfDirective.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: ForOfDirective, deps: [{ token: i0.ViewContainerRef, resolved: i0.ɵɵResolvedDependencyType.Token }, { token: i0.TemplateRef, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.Directive });\n+ForOfDirective.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: ForOfDirective, deps: [{ token: i0.ViewContainerRef }, { token: i0.TemplateRef }], target: i0.ɵɵFactoryTarget.Directive });\n ForOfDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: ForOfDirective, selector: \"[forOf]\", inputs: { forOf: \"forOf\" }, usesOnChanges: true, ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(ForOfDirective, [{\n         type: Directive,\n@@ -101,7 +101,7 @@ export class ForOfDirective {\n     }\n     ngOnChanges(simpleChanges) { }\n }\n-ForOfDirective.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: ForOfDirective, deps: [{ token: i0.ViewContainerRef, resolved: i0.ɵɵResolvedDependencyType.Token }, { token: i0.TemplateRef, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.Directive });\n+ForOfDirective.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: ForOfDirective, deps: [{ token: i0.ViewContainerRef }, { token: i0.TemplateRef }], target: i0.ɵɵFactoryTarget.Directive });\n ForOfDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: ForOfDirective, selector: \"[forOf]\", inputs: { forOf: \"forOf\" }, usesOnChanges: true, ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(ForOfDirective, [{\n         type: Directive,\n@@ -192,7 +192,7 @@ export class ForOfDirective {\n     }\n     ngOnChanges(simpleChanges) { }\n }\n-ForOfDirective.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: ForOfDirective, deps: [{ token: i0.ViewContainerRef, resolved: i0.ɵɵResolvedDependencyType.Token }, { token: i0.TemplateRef, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.Directive });\n+ForOfDirective.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: ForOfDirective, deps: [{ token: i0.ViewContainerRef }, { token: i0.TemplateRef }], target: i0.ɵɵFactoryTarget.Directive });\n ForOfDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: ForOfDirective, selector: \"[forOf]\", inputs: { forOf: \"forOf\" }, usesOnChanges: true, ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(ForOfDirective, [{\n         type: Directive,\n@@ -309,7 +309,7 @@ export class ForOfDirective {\n     }\n     ngOnChanges(simpleChanges) { }\n }\n-ForOfDirective.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: ForOfDirective, deps: [{ token: i0.ViewContainerRef, resolved: i0.ɵɵResolvedDependencyType.Token }, { token: i0.TemplateRef, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.Directive });\n+ForOfDirective.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: ForOfDirective, deps: [{ token: i0.ViewContainerRef }, { token: i0.TemplateRef }], target: i0.ɵɵFactoryTarget.Directive });\n ForOfDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: ForOfDirective, selector: \"[forOf]\", inputs: { forOf: \"forOf\" }, usesOnChanges: true, ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(ForOfDirective, [{\n         type: Directive,"
        },
        {
            "sha": "38db1b6e6d4270c59c282eb3d20341d6f4698033",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/value_composition/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fvalue_composition%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fvalue_composition%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fvalue_composition%2FGOLDEN_PARTIAL.js?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -206,7 +206,7 @@ export class MyComponent {\n         this.cdr = cdr;\n     }\n }\n-MyComponent.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyComponent, deps: [{ token: i0.ElementRef, resolved: i0.ɵɵResolvedDependencyType.Token }, { token: i0.ViewContainerRef, resolved: i0.ɵɵResolvedDependencyType.Token }, { token: i0.ChangeDetectorRef, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.Component });\n+MyComponent.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyComponent, deps: [{ token: i0.ElementRef }, { token: i0.ViewContainerRef }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });\n MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", ngImport: i0, template: '', isInline: true });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n@@ -249,7 +249,7 @@ import * as i0 from \"@angular/core\";\n export class IfDirective {\n     constructor(template) { }\n }\n-IfDirective.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: IfDirective, deps: [{ token: i0.TemplateRef, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.Directive });\n+IfDirective.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: IfDirective, deps: [{ token: i0.TemplateRef }], target: i0.ɵɵFactoryTarget.Directive });\n IfDirective.ɵdir = i0.ɵɵngDeclareDirective({ version: \"0.0.0-PLACEHOLDER\", type: IfDirective, selector: \"[if]\", ngImport: i0 });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(IfDirective, [{\n         type: Directive,"
        },
        {
            "sha": "c3038d1b96e2d3a5a906a09da9d24369cf4431be",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/ng_modules/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fng_modules%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fng_modules%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fng_modules%2FGOLDEN_PARTIAL.js?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -177,7 +177,7 @@ export class BaseService {\n     }\n     ;\n }\n-BaseService.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: BaseService, deps: [{ token: Thing, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.Injectable });\n+BaseService.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: BaseService, deps: [{ token: Thing }], target: i0.ɵɵFactoryTarget.Injectable });\n BaseService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: BaseService, factory: BaseService.ɵfac });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(BaseService, [{\n         type: Injectable\n@@ -478,7 +478,7 @@ export class BaseModule {\n         this.service = service;\n     }\n }\n-BaseModule.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: BaseModule, deps: [{ token: Service, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.NgModule });\n+BaseModule.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: BaseModule, deps: [{ token: Service }], target: i0.ɵɵFactoryTarget.NgModule });\n BaseModule.ɵmod = i0.ɵɵngDeclareNgModule({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: BaseModule });\n BaseModule.ɵinj = i0.ɵɵngDeclareInjector({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: BaseModule, providers: [Service] });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(BaseModule, [{"
        },
        {
            "sha": "3fff571e694b4d19655fc12226ac4dda65cc1906",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_di/di/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 14,
            "deletions": 8,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_di%2Fdi%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_di%2Fdi%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_di%2Fdi%2FGOLDEN_PARTIAL.js?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -10,17 +10,23 @@ MyService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: MyService, fac\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyService, [{\n         type: Injectable\n     }], null, null); })();\n+function dynamicAttrName() {\n+    return 'the-attr';\n+}\n export class MyComponent {\n-    constructor(name, s1, s2, s4, s3, s5, s6) { }\n+    constructor(name, other, s1, s2, s4, s3, s5, s6) { }\n }\n-MyComponent.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyComponent, deps: [{ token: 'name', resolved: i0.ɵɵResolvedDependencyType.Attribute }, { token: MyService, resolved: i0.ɵɵResolvedDependencyType.Token }, { token: MyService, resolved: i0.ɵɵResolvedDependencyType.Token, host: true }, { token: MyService, resolved: i0.ɵɵResolvedDependencyType.Token, self: true }, { token: MyService, resolved: i0.ɵɵResolvedDependencyType.Token, skipSelf: true }, { token: MyService, resolved: i0.ɵɵResolvedDependencyType.Token, optional: true }, { token: MyService, resolved: i0.ɵɵResolvedDependencyType.Token, optional: true, self: true }], target: i0.ɵɵFactoryTarget.Component });\n+MyComponent.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyComponent, deps: [{ token: 'name', attribute: true }, { token: dynamicAttrName(), attribute: true }, { token: MyService }, { token: MyService, host: true }, { token: MyService, self: true }, { token: MyService, skipSelf: true }, { token: MyService, optional: true }, { token: MyService, optional: true, self: true }], target: i0.ɵɵFactoryTarget.Component });\n MyComponent.ɵcmp = i0.ɵɵngDeclareComponent({ version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", ngImport: i0, template: ``, isInline: true });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyComponent, [{\n         type: Component,\n         args: [{ selector: 'my-component', template: `` }]\n     }], function () { return [{ type: undefined, decorators: [{\n                 type: Attribute,\n                 args: ['name']\n+            }] }, { type: undefined, decorators: [{\n+                type: Attribute,\n+                args: [dynamicAttrName()]\n             }] }, { type: MyService }, { type: MyService, decorators: [{\n                 type: Host\n             }] }, { type: MyService, decorators: [{\n@@ -53,8 +59,8 @@ export declare class MyService {\n     static ɵprov: i0.ɵɵInjectableDef<MyService>;\n }\n export declare class MyComponent {\n-    constructor(name: string, s1: MyService, s2: MyService, s4: MyService, s3: MyService, s5: MyService, s6: MyService);\n-    static ɵfac: i0.ɵɵFactoryDeclaration<MyComponent, [{ attribute: \"name\"; }, null, { host: true; }, { self: true; }, { skipSelf: true; }, { optional: true; }, { optional: true; self: true; }]>;\n+    constructor(name: string, other: string, s1: MyService, s2: MyService, s4: MyService, s3: MyService, s5: MyService, s6: MyService);\n+    static ɵfac: i0.ɵɵFactoryDeclaration<MyComponent, [{ attribute: \"name\"; }, { attribute: unknown; }, null, { host: true; }, { self: true; }, { skipSelf: true; }, { optional: true; }, { optional: true; self: true; }]>;\n     static ɵcmp: i0.ɵɵComponentDeclaration<MyComponent, \"my-component\", never, {}, {}, never, never>;\n }\n export declare class MyModule {\n@@ -73,7 +79,7 @@ class MyDependency {\n export class MyService {\n     constructor(dep) { }\n }\n-MyService.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyService, deps: [{ token: MyDependency, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.Injectable });\n+MyService.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyService, deps: [{ token: MyDependency }], target: i0.ɵɵFactoryTarget.Injectable });\n MyService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: MyService, factory: MyService.ɵfac });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyService, [{\n         type: Injectable\n@@ -104,7 +110,7 @@ class MyOptionalDependency {\n export class MyService {\n     constructor(dep, optionalDep) { }\n }\n-MyService.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyService, deps: [{ token: MyDependency, resolved: i0.ɵɵResolvedDependencyType.Token }, { token: MyOptionalDependency, resolved: i0.ɵɵResolvedDependencyType.Token, optional: true }], target: i0.ɵɵFactoryTarget.Injectable });\n+MyService.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyService, deps: [{ token: MyDependency }, { token: MyOptionalDependency, optional: true }], target: i0.ɵɵFactoryTarget.Injectable });\n MyService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: MyService, factory: MyService.ɵfac });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyService, [{\n         type: Injectable\n@@ -296,7 +302,7 @@ export class MyPipe {\n         return value;\n     }\n }\n-MyPipe.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyPipe, deps: [{ token: Service, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.Pipe });\n+MyPipe.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyPipe, deps: [{ token: Service }], target: i0.ɵɵFactoryTarget.Pipe });\n MyPipe.ɵpipe = i0.ɵɵngDeclarePipe({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyPipe, name: \"myPipe\" });\n MyPipe.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: MyPipe, factory: MyPipe.ɵfac });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyPipe, [{\n@@ -311,7 +317,7 @@ export class MyOtherPipe {\n         return value;\n     }\n }\n-MyOtherPipe.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyOtherPipe, deps: [{ token: Service, resolved: i0.ɵɵResolvedDependencyType.Token }], target: i0.ɵɵFactoryTarget.Pipe });\n+MyOtherPipe.ɵfac = i0.ɵɵngDeclareFactory({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyOtherPipe, deps: [{ token: Service }], target: i0.ɵɵFactoryTarget.Pipe });\n MyOtherPipe.ɵpipe = i0.ɵɵngDeclarePipe({ version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyOtherPipe, name: \"myOtherPipe\" });\n MyOtherPipe.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: MyOtherPipe, factory: MyOtherPipe.ɵfac });\n (function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(MyOtherPipe, [{"
        },
        {
            "sha": "0f784bd3509c93d6f26133ba80093d8cc035ca56",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_di/di/component_factory.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_di%2Fdi%2Fcomponent_factory.js",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_di%2Fdi%2Fcomponent_factory.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_di%2Fdi%2Fcomponent_factory.js?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -2,6 +2,7 @@\n MyComponent.ɵfac = function MyComponent_Factory(t) {\n   return new (t || MyComponent)(\n     $r3$.ɵɵinjectAttribute('name'),\n+    $r3$.ɵɵinjectAttribute(dynamicAttrName()),\n     $r3$.ɵɵdirectiveInject(MyService),\n     $r3$.ɵɵdirectiveInject(MyService, 1),\n     $r3$.ɵɵdirectiveInject(MyService, 2),"
        },
        {
            "sha": "fd77f5aa65af35a931fc2fe49e537ce30d700749",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_di/di/component_factory.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_di%2Fdi%2Fcomponent_factory.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_di%2Fdi%2Fcomponent_factory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_di%2Fdi%2Fcomponent_factory.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -4,10 +4,15 @@ import {Attribute, Component, Host, Injectable, NgModule, Optional, Self, SkipSe\n export class MyService {\n }\n \n+function dynamicAttrName() {\n+  return 'the-attr';\n+}\n+\n @Component({selector: 'my-component', template: ``})\n export class MyComponent {\n   constructor(\n       @Attribute('name') name: string,\n+      @Attribute(dynamicAttrName()) other: string,\n       s1: MyService,\n       @Host() s2: MyService,\n       @Self() s4: MyService,"
        },
        {
            "sha": "91820d3953088a86d15d436c9d99b14d34a05642",
            "filename": "packages/compiler-cli/test/compliance_old/r3_view_compiler_di_spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance_old%2Fr3_view_compiler_di_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler-cli%2Ftest%2Fcompliance_old%2Fr3_view_compiler_di_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance_old%2Fr3_view_compiler_di_spec.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -25,13 +25,18 @@ describe('compiler compliance: dependency injection', () => {\n               @Injectable()\n               export class MyService {}\n \n+              function dynamicAttrName() {\n+                return 'the-attr';\n+              }\n+\n               @Component({\n                 selector: 'my-component',\n                 template: \\`\\`\n               })\n               export class MyComponent {\n                 constructor(\n                   @Attribute('name') name:string,\n+                  @Attribute(dynamicAttrName()) other: string,\n                   s1: MyService,\n                   @Host() s2: MyService,\n                   @Self() s4: MyService,\n@@ -51,6 +56,7 @@ describe('compiler compliance: dependency injection', () => {\n       MyComponent.ɵfac = function MyComponent_Factory(t) {\n         return new (t || MyComponent)(\n           $r3$.ɵɵinjectAttribute('name'),\n+          $r3$.ɵɵinjectAttribute(dynamicAttrName()),\n           $r3$.ɵɵdirectiveInject(MyService),\n           $r3$.ɵɵdirectiveInject(MyService, 1),\n           $r3$.ɵɵdirectiveInject(MyService, 2),"
        },
        {
            "sha": "6800cf5d20b1fb291ca9b95de95467221d23892a",
            "filename": "packages/compiler/src/compiler.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -97,7 +97,7 @@ export {BoundAttribute as TmplAstBoundAttribute, BoundEvent as TmplAstBoundEvent\n export * from './render3/view/t2_api';\n export * from './render3/view/t2_binder';\n export {Identifiers as R3Identifiers} from './render3/r3_identifiers';\n-export {compileFactoryFunction, R3DependencyMetadata, R3FactoryMetadata, R3FactoryTarget, R3ResolvedDependencyType} from './render3/r3_factory';\n+export {compileFactoryFunction, R3DependencyMetadata, R3FactoryMetadata, R3FactoryTarget} from './render3/r3_factory';\n export {compileNgModule, R3NgModuleMetadata} from './render3/r3_module_compiler';\n export {compileInjector, R3InjectorMetadata} from './render3/r3_injector_compiler';\n export {compilePipeFromMetadata, R3PipeMetadata} from './render3/r3_pipe_compiler';"
        },
        {
            "sha": "d18ee130105f3f01d589a37e2f553baeb6093e21",
            "filename": "packages/compiler/src/compiler_facade_interface.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 16,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Fcompiler_facade_interface.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Fcompiler_facade_interface.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler_facade_interface.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -60,7 +60,6 @@ export interface CompilerFacade {\n \n   createParseSourceSpan(kind: string, typeName: string, sourceUrl: string): ParseSourceSpan;\n \n-  R3ResolvedDependencyType: typeof R3ResolvedDependencyType;\n   R3FactoryTarget: typeof R3FactoryTarget;\n   ResourceLoader: {new(): ResourceLoader};\n }\n@@ -83,12 +82,6 @@ export type StringMapWithRename = {\n \n export type Provider = any;\n \n-export enum R3ResolvedDependencyType {\n-  Token = 0,\n-  Attribute = 1,\n-  Invalid = 2,\n-}\n-\n export enum R3FactoryTarget {\n   Directive = 0,\n   Component = 1,\n@@ -98,17 +91,17 @@ export enum R3FactoryTarget {\n }\n \n export interface R3DependencyMetadataFacade {\n-  token: any;\n-  resolved: R3ResolvedDependencyType;\n+  token: unknown;\n+  attribute: string|null;\n   host: boolean;\n   optional: boolean;\n   self: boolean;\n-  skipSelf?: boolean;\n+  skipSelf: boolean;\n }\n \n export interface R3DeclareDependencyMetadataFacade {\n-  token: any;\n-  resolved: R3ResolvedDependencyType;\n+  token: unknown;\n+  attribute?: boolean;\n   host?: boolean;\n   optional?: boolean;\n   self?: boolean;\n@@ -118,9 +111,7 @@ export interface R3DeclareDependencyMetadataFacade {\n export interface R3PipeMetadataFacade {\n   name: string;\n   type: any;\n-  typeArgumentCount: number;\n   pipeName: string;\n-  deps: R3DependencyMetadataFacade[]|null;\n   pure: boolean;\n }\n \n@@ -156,9 +147,7 @@ export interface R3InjectorMetadataFacade {\n export interface R3DirectiveMetadataFacade {\n   name: string;\n   type: any;\n-  typeArgumentCount: number;\n   typeSourceSpan: ParseSourceSpan;\n-  deps: R3DependencyMetadataFacade[]|null;\n   selector: string|null;\n   queries: R3QueryMetadataFacade[];\n   host: {[key: string]: string};"
        },
        {
            "sha": "7ba0e815913f597647c66b6f55778ef9838c599a",
            "filename": "packages/compiler/src/jit_compiler_facade.ts",
            "status": "modified",
            "additions": 35,
            "deletions": 33,
            "changes": 68,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -10,26 +10,24 @@\n import {CompilerFacade, CoreEnvironment, ExportedCompilerFacade, OpaqueValue, R3ComponentMetadataFacade, R3DeclareComponentFacade, R3DeclareDependencyMetadataFacade, R3DeclareDirectiveFacade, R3DeclareFactoryFacade, R3DeclareInjectorFacade, R3DeclareNgModuleFacade, R3DeclarePipeFacade, R3DeclareQueryMetadataFacade, R3DependencyMetadataFacade, R3DirectiveMetadataFacade, R3FactoryDefMetadataFacade, R3InjectableMetadataFacade, R3InjectorMetadataFacade, R3NgModuleMetadataFacade, R3PipeMetadataFacade, R3QueryMetadataFacade, StringMap, StringMapWithRename} from './compiler_facade_interface';\n import {ConstantPool} from './constant_pool';\n import {ChangeDetectionStrategy, HostBinding, HostListener, Input, Output, Type, ViewEncapsulation} from './core';\n-import {Identifiers} from './identifiers';\n import {compileInjectable} from './injectable_compiler_2';\n import {DEFAULT_INTERPOLATION_CONFIG, InterpolationConfig} from './ml_parser/interpolation_config';\n-import {DeclareVarStmt, Expression, LiteralExpr, Statement, StmtModifier, WrappedNodeExpr} from './output/output_ast';\n+import {DeclareVarStmt, Expression, literal, LiteralExpr, Statement, StmtModifier, WrappedNodeExpr} from './output/output_ast';\n import {JitEvaluator} from './output/output_jit';\n import {ParseError, ParseSourceSpan, r3JitTypeSourceSpan} from './parse_util';\n-import {compileFactoryFunction, R3DependencyMetadata, R3FactoryTarget, R3ResolvedDependencyType} from './render3/r3_factory';\n+import {compileFactoryFunction, R3DependencyMetadata, R3FactoryTarget} from './render3/r3_factory';\n import {compileInjector, R3InjectorMetadata} from './render3/r3_injector_compiler';\n import {R3JitReflector} from './render3/r3_jit';\n import {compileNgModule, compileNgModuleDeclarationExpression, R3NgModuleMetadata} from './render3/r3_module_compiler';\n import {compilePipeFromMetadata, R3PipeMetadata} from './render3/r3_pipe_compiler';\n-import {getSafePropertyAccessString, R3Reference, wrapReference} from './render3/util';\n+import {getSafePropertyAccessString, wrapReference} from './render3/util';\n import {DeclarationListEmitMode, R3ComponentMetadata, R3DirectiveMetadata, R3HostMetadata, R3QueryMetadata, R3UsedDirectiveMetadata} from './render3/view/api';\n import {compileComponentFromMetadata, compileDirectiveFromMetadata, ParsedHostBindings, parseHostBindings, verifyHostBindings} from './render3/view/compiler';\n import {makeBindingParser, parseTemplate} from './render3/view/template';\n import {ResourceLoader} from './resource_loader';\n import {DomElementSchemaRegistry} from './schema/dom_element_schema_registry';\n \n export class CompilerFacadeImpl implements CompilerFacade {\n-  R3ResolvedDependencyType = R3ResolvedDependencyType as any;\n   R3FactoryTarget = R3FactoryTarget as any;\n   ResourceLoader = ResourceLoader;\n   private elementSchemaRegistry = new DomElementSchemaRegistry();\n@@ -42,8 +40,8 @@ export class CompilerFacadeImpl implements CompilerFacade {\n       name: facade.name,\n       type: wrapReference(facade.type),\n       internalType: new WrappedNodeExpr(facade.type),\n-      typeArgumentCount: facade.typeArgumentCount,\n-      deps: convertR3DependencyMetadataArray(facade.deps),\n+      typeArgumentCount: 0,\n+      deps: null,\n       pipeName: facade.pipeName,\n       pure: facade.pure,\n     };\n@@ -220,7 +218,7 @@ export class CompilerFacadeImpl implements CompilerFacade {\n       type: wrapReference(meta.type),\n       internalType: new WrappedNodeExpr(meta.type),\n       typeArgumentCount: 0,\n-      deps: convertR3DeclareDependencyMetadataArray(meta.deps),\n+      deps: meta.deps && meta.deps.map(convertR3DeclareDependencyMetadata),\n       target: meta.target,\n     });\n     return this.jitExpression(\n@@ -314,10 +312,11 @@ function convertDirectiveFacadeToMetadata(facade: R3DirectiveMetadataFacade): R3\n \n   return {\n     ...facade as R3DirectiveMetadataFacadeNoPropAndWhitespace,\n+    typeArgumentCount: 0,\n     typeSourceSpan: facade.typeSourceSpan,\n     type: wrapReference(facade.type),\n     internalType: new WrappedNodeExpr(facade.type),\n-    deps: convertR3DependencyMetadataArray(facade.deps),\n+    deps: null,\n     host: extractHostBindings(facade.propMetadata, facade.typeSourceSpan, facade.host),\n     inputs: {...inputsFromMetadata, ...inputsFromType},\n     outputs: {...outputsFromMetadata, ...outputsFromType},\n@@ -462,35 +461,38 @@ function computeProvidedIn(providedIn: Type|string|null|undefined): Expression {\n   }\n }\n \n-function convertR3DependencyMetadata(facade: R3DeclareDependencyMetadataFacade):\n-    R3DependencyMetadata {\n-  let tokenExpr;\n-  if (facade.token === null) {\n-    tokenExpr = new LiteralExpr(null);\n-  } else if (facade.resolved === R3ResolvedDependencyType.Attribute) {\n-    tokenExpr = new LiteralExpr(facade.token);\n-  } else {\n-    tokenExpr = new WrappedNodeExpr(facade.token);\n-  }\n-  return {\n-    token: tokenExpr,\n-    attribute: null,\n-    resolved: facade.resolved,\n-    host: !!facade.host,\n-    optional: !!facade.optional,\n-    self: !!facade.self,\n-    skipSelf: !!facade.skipSelf,\n-  };\n-}\n-\n function convertR3DependencyMetadataArray(facades: R3DependencyMetadataFacade[]|null|\n                                           undefined): R3DependencyMetadata[]|null {\n   return facades == null ? null : facades.map(convertR3DependencyMetadata);\n }\n \n-function convertR3DeclareDependencyMetadataArray(facades: R3DeclareDependencyMetadataFacade[]|null|\n-                                                 undefined): R3DependencyMetadata[]|null {\n-  return facades == null ? null : facades.map(convertR3DependencyMetadata);\n+function convertR3DependencyMetadata(facade: R3DependencyMetadataFacade): R3DependencyMetadata {\n+  const isAttributeDep = facade.attribute != null;  // both `null` and `undefined`\n+  const rawToken = facade.token === null ? null : new WrappedNodeExpr(facade.token);\n+  // In JIT mode, if the dep is an `@Attribute()` then we use the attribute name given in\n+  // `attribute` rather than the `token`.\n+  const token = isAttributeDep ? new WrappedNodeExpr(facade.attribute) : rawToken;\n+  return createR3DependencyMetadata(\n+      token, isAttributeDep, facade.host, facade.optional, facade.self, facade.skipSelf);\n+}\n+\n+function convertR3DeclareDependencyMetadata(facade: R3DeclareDependencyMetadataFacade):\n+    R3DependencyMetadata {\n+  const isAttributeDep = facade.attribute ?? false;\n+  const token = facade.token === null ? null : new WrappedNodeExpr(facade.token);\n+  return createR3DependencyMetadata(\n+      token, isAttributeDep, facade.host ?? false, facade.optional ?? false, facade.self ?? false,\n+      facade.skipSelf ?? false);\n+}\n+\n+function createR3DependencyMetadata(\n+    token: WrappedNodeExpr<unknown>|null, isAttributeDep: boolean, host: boolean, optional: boolean,\n+    self: boolean, skipSelf: boolean): R3DependencyMetadata {\n+  // If the dep is an `@Attribute()` the `attributeNameType` ought to be the `unknown` type.\n+  // But types are not available at runtime so we just use a literal `\"<unknown>\"` string as a dummy\n+  // marker.\n+  const attributeNameType = isAttributeDep ? literal('unknown') : null;\n+  return {token, attributeNameType, host, optional, self, skipSelf};\n }\n \n function extractHostBindings("
        },
        {
            "sha": "2ca458e4b66874051b97c4f399824a3ddc4876f7",
            "filename": "packages/compiler/src/render3/partial/api.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 46,
            "changes": 65,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fapi.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fapi.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fapi.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -343,26 +343,22 @@ export interface R3DeclarePipeMetadata extends R3PartialDeclaration {\n  */\n export interface R3DeclareFactoryMetadata extends R3PartialDeclaration {\n   /**\n-   * Regardless of whether `fnOrClass` is a constructor function or a user-defined factory, it\n-   * may have 0 or more parameters, which will be injected according to the `R3DependencyMetadata`\n-   * for those parameters. If this is `null`, then the type's constructor is nonexistent and will\n-   * be inherited from `fnOrClass` which is interpreted as the current type. If this is `'invalid'`,\n-   * then one or more of the parameters wasn't resolvable and any attempt to use these deps will\n-   * result in a runtime error.\n+   * A collection of dependencies that this factory relies upon.\n+   *\n+   * If this is `null`, then the type's constructor is nonexistent and will be inherited from an\n+   * ancestor of the type.\n+   *\n+   * If this is `'invalid'`, then one or more of the parameters wasn't resolvable and any attempt to\n+   * use these deps will result in a runtime error.\n    */\n-  deps: R3DependencyMetadata[]|'invalid'|null;\n+  deps: R3DeclareDependencyMetadata[]|'invalid'|null;\n \n   /**\n    * Type of the target being created by the factory.\n    */\n   target: R3FactoryTarget;\n }\n \n-export enum R3FactoryDelegateType {\n-  Class = 0,\n-  Function = 1,\n-}\n-\n export enum R3FactoryTarget {\n   Directive = 0,\n   Component = 1,\n@@ -372,19 +368,23 @@ export enum R3FactoryTarget {\n }\n \n /**\n- * Metadata representing a single dependency to be injected into a constructor or function call.\n+ * Metadata indicating how a dependency should be injected into a factory.\n  */\n-export interface R3DependencyMetadata {\n+export interface R3DeclareDependencyMetadata {\n   /**\n-   * An expression representing the token or value to be injected.\n+   * An expression representing the token or value to be injected, or `null` if the dependency is\n+   * not valid.\n+   *\n+   * If this dependency is due to the `@Attribute()` decorator, then this is an expression\n+   * evaluating to the name of the attribute.\n    */\n-  token: o.Expression;\n+  token: o.Expression|null;\n \n   /**\n-   * An enum indicating whether this dependency has special meaning to Angular and needs to be\n-   * injected specially.\n+   * Whether the dependency is injecting an attribute value.\n+   * Default: false.\n    */\n-  resolved: R3ResolvedDependencyType;\n+  attribute?: boolean;\n \n   /**\n    * Whether the dependency has an @Host qualifier.\n@@ -410,30 +410,3 @@ export interface R3DependencyMetadata {\n    */\n   skipSelf?: boolean;\n }\n-\n-/**\n- * Resolved type of a dependency.\n- *\n- * Occasionally, dependencies will have special significance which is known statically. In that\n- * case the `R3ResolvedDependencyType` informs the factory generator that a particular dependency\n- * should be generated specially (usually by calling a special injection function instead of the\n- * standard one).\n- */\n-export enum R3ResolvedDependencyType {\n-  /**\n-   * A normal token dependency.\n-   */\n-  Token = 0,\n-\n-  /**\n-   * The dependency is for an attribute.\n-   *\n-   * The token expression is a string representing the attribute name.\n-   */\n-  Attribute = 1,\n-\n-  /**\n-   * An invalid dependency (no token could be determined). An error should be thrown at runtime.\n-   */\n-  Invalid = 2,\n-}"
        },
        {
            "sha": "8b371c8419b97fa077e284e34241016639a108cf",
            "filename": "packages/compiler/src/render3/partial/factory.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Ffactory.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Ffactory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Ffactory.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -6,12 +6,12 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import * as o from '../../output/output_ast';\n-import {createFactoryType, R3FactoryMetadata, R3FactoryTarget, R3ResolvedDependencyType} from '../r3_factory';\n+import {createFactoryType, R3DependencyMetadata, R3FactoryMetadata, R3FactoryTarget} from '../r3_factory';\n import {Identifiers as R3} from '../r3_identifiers';\n import {R3CompiledExpression} from '../util';\n import {DefinitionMap} from '../view/util';\n \n-import {R3DeclareFactoryMetadata, R3DependencyMetadata} from './api';\n+import {R3DeclareDependencyMetadata, R3DeclareFactoryMetadata} from './api';\n \n export function compileDeclareFactoryFunction(meta: R3FactoryMetadata): R3CompiledExpression {\n   const definitionMap = new DefinitionMap<R3DeclareFactoryMetadata>();\n@@ -40,22 +40,22 @@ function compileDependencies(deps: R3DependencyMetadata[]|'invalid'|null): o.Lit\n }\n \n function compileDependency(dep: R3DependencyMetadata): o.LiteralMapExpr {\n-  const depMeta = new DefinitionMap<R3DependencyMetadata>();\n+  const depMeta = new DefinitionMap<R3DeclareDependencyMetadata>();\n   depMeta.set('token', dep.token);\n-  depMeta.set(\n-      'resolved',\n-      o.importExpr(R3.R3ResolvedDependencyType).prop(R3ResolvedDependencyType[dep.resolved]));\n+  if (dep.attributeNameType !== null) {\n+    depMeta.set('attribute', o.literal(true));\n+  }\n   if (dep.host) {\n-    depMeta.set('host', o.literal(dep.host));\n+    depMeta.set('host', o.literal(true));\n   }\n   if (dep.optional) {\n-    depMeta.set('optional', o.literal(dep.optional));\n+    depMeta.set('optional', o.literal(true));\n   }\n   if (dep.self) {\n-    depMeta.set('self', o.literal(dep.self));\n+    depMeta.set('self', o.literal(true));\n   }\n   if (dep.skipSelf) {\n-    depMeta.set('skipSelf', o.literal(dep.skipSelf));\n+    depMeta.set('skipSelf', o.literal(true));\n   }\n   return depMeta.toLiteralMap();\n }"
        },
        {
            "sha": "90b898928cb29e5c7a0bcdd645ac7e318b680163",
            "filename": "packages/compiler/src/render3/r3_factory.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 74,
            "changes": 111,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -8,9 +8,7 @@\n \n import {StaticSymbol} from '../aot/static_symbol';\n import {CompileTypeMetadata, tokenReference} from '../compile_metadata';\n-import {CompileReflector} from '../compile_reflector';\n import {InjectFlags} from '../core';\n-import {Identifiers} from '../identifiers';\n import * as o from '../output/output_ast';\n import {Identifiers as R3} from '../render3/r3_identifiers';\n import {OutputContext} from '../util';\n@@ -88,54 +86,19 @@ export enum R3FactoryTarget {\n   NgModule = 4,\n }\n \n-/**\n- * Resolved type of a dependency.\n- *\n- * Occasionally, dependencies will have special significance which is known statically. In that\n- * case the `R3ResolvedDependencyType` informs the factory generator that a particular dependency\n- * should be generated specially (usually by calling a special injection function instead of the\n- * standard one).\n- */\n-export enum R3ResolvedDependencyType {\n-  /**\n-   * A normal token dependency.\n-   */\n-  Token = 0,\n-\n-  /**\n-   * The dependency is for an attribute.\n-   *\n-   * The token expression is a string representing the attribute name.\n-   */\n-  Attribute = 1,\n-\n-  /**\n-   * An invalid dependency (no token could be determined). An error should be thrown at runtime.\n-   */\n-  Invalid = 2,\n-}\n-\n-/**\n- * Metadata representing a single dependency to be injected into a constructor or function call.\n- */\n export interface R3DependencyMetadata {\n   /**\n    * An expression representing the token or value to be injected.\n+   * Or `null` if the dependency could not be resolved - making it invalid.\n    */\n-  token: o.Expression;\n+  token: o.Expression|null;\n \n   /**\n    * If an @Attribute decorator is present, this is the literal type of the attribute name, or\n    * the unknown type if no literal type is available (e.g. the attribute name is an expression).\n-   * Will be null otherwise.\n+   * Otherwise it is null;\n    */\n-  attribute: o.Expression|null;\n-\n-  /**\n-   * An enum indicating whether this dependency has special meaning to Angular and needs to be\n-   * injected specially.\n-   */\n-  resolved: R3ResolvedDependencyType;\n+  attributeNameType: o.Expression|null;\n \n   /**\n    * Whether the dependency has an @Host qualifier.\n@@ -266,35 +229,37 @@ function injectDependencies(deps: R3DependencyMetadata[], target: R3FactoryTarge\n function compileInjectDependency(\n     dep: R3DependencyMetadata, target: R3FactoryTarget, index: number): o.Expression {\n   // Interpret the dependency according to its resolved type.\n-  switch (dep.resolved) {\n-    case R3ResolvedDependencyType.Token:\n-      // Build up the injection flags according to the metadata.\n-      const flags = InjectFlags.Default | (dep.self ? InjectFlags.Self : 0) |\n-          (dep.skipSelf ? InjectFlags.SkipSelf : 0) | (dep.host ? InjectFlags.Host : 0) |\n-          (dep.optional ? InjectFlags.Optional : 0) |\n-          (target === R3FactoryTarget.Pipe ? InjectFlags.ForPipe : 0);\n-\n-      // If this dependency is optional or otherwise has non-default flags, then additional\n-      // parameters describing how to inject the dependency must be passed to the inject function\n-      // that's being used.\n-      let flagsParam: o.LiteralExpr|null =\n-          (flags !== InjectFlags.Default || dep.optional) ? o.literal(flags) : null;\n-\n-      // Build up the arguments to the injectFn call.\n-      const injectArgs = [dep.token];\n-      if (flagsParam) {\n-        injectArgs.push(flagsParam);\n-      }\n-      const injectFn = getInjectFn(target);\n-      return o.importExpr(injectFn).callFn(injectArgs);\n-    case R3ResolvedDependencyType.Attribute:\n-      // In the case of attributes, the attribute name in question is given as the token.\n-      return o.importExpr(R3.injectAttribute).callFn([dep.token]);\n-    case R3ResolvedDependencyType.Invalid:\n-      return o.importExpr(R3.invalidFactoryDep).callFn([o.literal(index)]);\n-    default:\n-      return unsupported(\n-          `Unknown R3ResolvedDependencyType: ${R3ResolvedDependencyType[dep.resolved]}`);\n+  if (dep.token === null) {\n+    return o.importExpr(R3.invalidFactoryDep).callFn([o.literal(index)]);\n+  } else if (dep.attributeNameType === null) {\n+    // Build up the injection flags according to the metadata.\n+    const flags = InjectFlags.Default | (dep.self ? InjectFlags.Self : 0) |\n+        (dep.skipSelf ? InjectFlags.SkipSelf : 0) | (dep.host ? InjectFlags.Host : 0) |\n+        (dep.optional ? InjectFlags.Optional : 0) |\n+        (target === R3FactoryTarget.Pipe ? InjectFlags.ForPipe : 0);\n+\n+    // If this dependency is optional or otherwise has non-default flags, then additional\n+    // parameters describing how to inject the dependency must be passed to the inject function\n+    // that's being used.\n+    let flagsParam: o.LiteralExpr|null =\n+        (flags !== InjectFlags.Default || dep.optional) ? o.literal(flags) : null;\n+\n+    // Build up the arguments to the injectFn call.\n+    const injectArgs = [dep.token];\n+    if (flagsParam) {\n+      injectArgs.push(flagsParam);\n+    }\n+    const injectFn = getInjectFn(target);\n+    return o.importExpr(injectFn).callFn(injectArgs);\n+  } else {\n+    // The `dep.attributeTypeName` value is defined, which indicates that this is an `@Attribute()`\n+    // type dependency. For the generated JS we still want to use the `dep.token` value in case the\n+    // name given for the attribute is not a string literal. For example given `@Attribute(foo())`,\n+    // we want to generate `ɵɵinjectAttribute(foo())`.\n+    //\n+    // The `dep.attributeTypeName` is only actually used (in `createCtorDepType()`) to generate\n+    // typings.\n+    return o.importExpr(R3.injectAttribute).callFn([dep.token]);\n   }\n }\n \n@@ -320,10 +285,8 @@ function createCtorDepsType(deps: R3DependencyMetadata[]): o.Type {\n function createCtorDepType(dep: R3DependencyMetadata): o.LiteralMapExpr|null {\n   const entries: {key: string, quoted: boolean, value: o.Expression}[] = [];\n \n-  if (dep.resolved === R3ResolvedDependencyType.Attribute) {\n-    if (dep.attribute !== null) {\n-      entries.push({key: 'attribute', value: dep.attribute, quoted: false});\n-    }\n+  if (dep.attributeNameType !== null) {\n+    entries.push({key: 'attribute', value: dep.attributeNameType, quoted: false});\n   }\n   if (dep.optional) {\n     entries.push({key: 'optional', value: o.literal(true), quoted: false});"
        },
        {
            "sha": "329f17095f3446236065482f09fee1c6fbeadac6",
            "filename": "packages/compiler/src/render3/r3_identifiers.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_identifiers.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_identifiers.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_identifiers.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -258,10 +258,6 @@ export class Identifiers {\n   };\n   static declareFactory: o.ExternalReference = {name: 'ɵɵngDeclareFactory', moduleName: CORE};\n   static R3FactoryTarget: o.ExternalReference = {name: 'ɵɵFactoryTarget', moduleName: CORE};\n-  static R3ResolvedDependencyType:\n-      o.ExternalReference = {name: 'ɵɵResolvedDependencyType', moduleName: CORE};\n-  static R3FactoryDelegateType:\n-      o.ExternalReference = {name: 'ɵɵFactoryDelegateType', moduleName: CORE};\n \n   static defineDirective: o.ExternalReference = {name: 'ɵɵdefineDirective', moduleName: CORE};\n   static declareDirective: o.ExternalReference = {name: 'ɵɵngDeclareDirective', moduleName: CORE};"
        },
        {
            "sha": "9082d3b9ba189f4f4bf374f888fb8bc9256ab41f",
            "filename": "packages/compiler/test/compiler_facade_interface_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 16,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Ftest%2Fcompiler_facade_interface_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcompiler%2Ftest%2Fcompiler_facade_interface_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fcompiler_facade_interface_spec.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -7,7 +7,7 @@\n  */\n \n import * as core from '../../core/src/compiler/compiler_facade_interface';\n-import {R3FactoryTarget, R3ResolvedDependencyType} from '../public_api';\n+import {R3FactoryTarget} from '../public_api';\n import * as compiler from '../src/compiler_facade_interface';\n \n /**\n@@ -45,21 +45,6 @@ const compilerStringMap: compiler.StringMap = null! as core.StringMap;\n const coreProvider: core.Provider = null! as compiler.Provider;\n const compilerProvider: compiler.Provider = null! as core.Provider;\n \n-const coreR3ResolvedDependencyType: core.R3ResolvedDependencyType =\n-    null! as compiler.R3ResolvedDependencyType;\n-const compilerR3ResolvedDependencyType: compiler.R3ResolvedDependencyType =\n-    null! as core.R3ResolvedDependencyType;\n-\n-const coreR3ResolvedDependencyType2: R3ResolvedDependencyType =\n-    null! as core.R3ResolvedDependencyType;\n-const compilerR3ResolvedDependencyType2: R3ResolvedDependencyType =\n-    null! as core.R3ResolvedDependencyType;\n-\n-const coreR3ResolvedDependencyType3: core.R3ResolvedDependencyType =\n-    null! as R3ResolvedDependencyType;\n-const compilerR3ResolvedDependencyType3: compiler.R3ResolvedDependencyType =\n-    null! as R3ResolvedDependencyType;\n-\n const coreR3FactoryTarget: core.R3FactoryTarget = null! as compiler.R3FactoryTarget;\n const compilerR3FactoryTarget: compiler.R3FactoryTarget = null! as core.R3FactoryTarget;\n "
        },
        {
            "sha": "ac3264d0c0b4a558bb346cc3498e44fc9c78368f",
            "filename": "packages/core/src/compiler/compiler_facade_interface.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 20,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Fsrc%2Fcompiler%2Fcompiler_facade_interface.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Fsrc%2Fcompiler%2Fcompiler_facade_interface.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcompiler%2Fcompiler_facade_interface.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -60,8 +60,7 @@ export interface CompilerFacade {\n \n   createParseSourceSpan(kind: string, typeName: string, sourceUrl: string): ParseSourceSpan;\n \n-  R3ResolvedDependencyType: typeof R3ResolvedDependencyType;\n-  R3FactoryTarget: typeof R3FactoryTarget;\n+  R3FactoryTarget: typeof FactoryTarget;\n   ResourceLoader: {new(): ResourceLoader};\n }\n \n@@ -83,13 +82,7 @@ export type StringMapWithRename = {\n \n export type Provider = any;\n \n-export enum R3ResolvedDependencyType {\n-  Token = 0,\n-  Attribute = 1,\n-  Invalid = 2,\n-}\n-\n-export enum R3FactoryTarget {\n+export enum FactoryTarget {\n   Directive = 0,\n   Component = 1,\n   Injectable = 2,\n@@ -98,17 +91,17 @@ export enum R3FactoryTarget {\n }\n \n export interface R3DependencyMetadataFacade {\n-  token: any;\n-  resolved: R3ResolvedDependencyType;\n+  token: unknown;\n+  attribute: string|null;\n   host: boolean;\n   optional: boolean;\n   self: boolean;\n-  skipSelf?: boolean;\n+  skipSelf: boolean;\n }\n \n export interface R3DeclareDependencyMetadataFacade {\n-  token: any;\n-  resolved: R3ResolvedDependencyType;\n+  token: unknown;\n+  attribute?: boolean;\n   host?: boolean;\n   optional?: boolean;\n   self?: boolean;\n@@ -118,9 +111,7 @@ export interface R3DeclareDependencyMetadataFacade {\n export interface R3PipeMetadataFacade {\n   name: string;\n   type: any;\n-  typeArgumentCount: number;\n   pipeName: string;\n-  deps: R3DependencyMetadataFacade[]|null;\n   pure: boolean;\n }\n \n@@ -156,9 +147,7 @@ export interface R3InjectorMetadataFacade {\n export interface R3DirectiveMetadataFacade {\n   name: string;\n   type: any;\n-  typeArgumentCount: number;\n   typeSourceSpan: ParseSourceSpan;\n-  deps: R3DependencyMetadataFacade[]|null;\n   selector: string|null;\n   queries: R3QueryMetadataFacade[];\n   host: {[key: string]: string};\n@@ -239,13 +228,13 @@ export interface R3FactoryDefMetadataFacade {\n   type: any;\n   typeArgumentCount: number;\n   deps: R3DependencyMetadataFacade[]|null;\n-  target: R3FactoryTarget;\n+  target: FactoryTarget;\n }\n \n export interface R3DeclareFactoryFacade {\n   type: Function;\n   deps: R3DeclareDependencyMetadataFacade[]|null;\n-  target: R3FactoryTarget;\n+  target: FactoryTarget;\n }\n \n export enum ViewEncapsulation {"
        },
        {
            "sha": "940db40ba29ffc3e543173fe5c6770bbedda7341",
            "filename": "packages/core/src/core_render3_private_export.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -268,9 +268,7 @@ export {\n   transitiveScopesFor as ɵtransitiveScopesFor,\n } from './render3/jit/module';\n export {\n-  R3FactoryDelegateType as ɵɵFactoryDelegateType,\n   R3FactoryTarget as ɵɵFactoryTarget,\n-  R3ResolvedDependencyType as ɵɵResolvedDependencyType,\n   ɵɵngDeclareComponent,\n   ɵɵngDeclareDirective,\n   ɵɵngDeclareFactory,"
        },
        {
            "sha": "a19b72340cf2be338ff1bd1d0a17aac5f7a03efe",
            "filename": "packages/core/src/di/jit/util.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 16,
            "changes": 24,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Futil.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {CompilerFacade, getCompilerFacade, R3DependencyMetadataFacade, R3ResolvedDependencyType} from '../../compiler/compiler_facade';\n+import {R3DependencyMetadataFacade} from '../../compiler/compiler_facade';\n import {Type} from '../../interface/type';\n import {ReflectionCapabilities} from '../../reflection/reflection_capabilities';\n import {Host, Inject, Optional, Self, SkipSelf} from '../metadata';\n@@ -23,25 +23,19 @@ export function reflectDependencies(type: Type<any>): R3DependencyMetadataFacade\n }\n \n export function convertDependencies(deps: any[]): R3DependencyMetadataFacade[] {\n-  const compiler = getCompilerFacade();\n-  return deps.map(dep => reflectDependency(compiler, dep));\n+  return deps.map(dep => reflectDependency(dep));\n }\n \n-function reflectDependency(compiler: CompilerFacade, dep: any|any[]): R3DependencyMetadataFacade {\n+function reflectDependency(dep: any|any[]): R3DependencyMetadataFacade {\n   const meta: R3DependencyMetadataFacade = {\n     token: null,\n+    attribute: null,\n     host: false,\n     optional: false,\n-    resolved: compiler.R3ResolvedDependencyType.Token,\n     self: false,\n     skipSelf: false,\n   };\n \n-  function setTokenAndResolvedType(token: any): void {\n-    meta.resolved = compiler.R3ResolvedDependencyType.Token;\n-    meta.token = token;\n-  }\n-\n   if (Array.isArray(dep) && dep.length > 0) {\n     for (let j = 0; j < dep.length; j++) {\n       const param = dep[j];\n@@ -66,17 +60,15 @@ function reflectDependency(compiler: CompilerFacade, dep: any|any[]): R3Dependen\n         if (param.attributeName === undefined) {\n           throw new Error(`Attribute name must be defined.`);\n         }\n-        meta.token = param.attributeName;\n-        meta.resolved = compiler.R3ResolvedDependencyType.Attribute;\n+        meta.attribute = param.attributeName;\n       } else {\n-        setTokenAndResolvedType(param);\n+        meta.token = param;\n       }\n     }\n   } else if (dep === undefined || (Array.isArray(dep) && dep.length === 0)) {\n-    meta.token = undefined;\n-    meta.resolved = R3ResolvedDependencyType.Invalid;\n+    meta.token = null;\n   } else {\n-    setTokenAndResolvedType(dep);\n+    meta.token = dep;\n   }\n   return meta;\n }"
        },
        {
            "sha": "c619b9c59f52c7c45c251c9b7b1403372b056f8a",
            "filename": "packages/core/src/render3/jit/directive.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fdirective.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -210,9 +210,13 @@ function addDirectiveFactoryDef(type: Type<any>, metadata: Directive|Component)\n       if (ngFactoryDef === null) {\n         const meta = getDirectiveMetadata(type, metadata);\n         const compiler = getCompilerFacade();\n-        ngFactoryDef = compiler.compileFactory(\n-            angularCoreEnv, `ng:///${type.name}/ɵfac.js`,\n-            {...meta.metadata, target: compiler.R3FactoryTarget.Directive});\n+        ngFactoryDef = compiler.compileFactory(angularCoreEnv, `ng:///${type.name}/ɵfac.js`, {\n+          name: meta.metadata.name,\n+          type: meta.metadata.type,\n+          typeArgumentCount: 0,\n+          deps: reflectDependencies(type),\n+          target: compiler.R3FactoryTarget.Directive\n+        });\n       }\n       return ngFactoryDef;\n     },\n@@ -237,9 +241,7 @@ export function directiveMetadata(type: Type<any>, metadata: Directive): R3Direc\n   return {\n     name: type.name,\n     type: type,\n-    typeArgumentCount: 0,\n     selector: metadata.selector !== undefined ? metadata.selector : null,\n-    deps: reflectDependencies(type),\n     host: metadata.host || EMPTY_OBJ,\n     propMetadata: propMetadata,\n     inputs: metadata.inputs || EMPTY_ARRAY,"
        },
        {
            "sha": "320a6bbcfb51ed6b4b6fe0b1379b7af7c704858f",
            "filename": "packages/core/src/render3/jit/partial.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fpartial.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fpartial.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fpartial.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -45,7 +45,7 @@ export function ɵɵngDeclareFactory(decl: R3DeclareFactoryFacade): unknown {\n /**\n  * These enums are used in the partial factory declaration calls.\n  */\n-export {R3FactoryTarget, R3ResolvedDependencyType, R3FactoryDelegateType} from '../../compiler/compiler_facade';\n+export {R3FactoryTarget} from '../../compiler/compiler_facade';\n \n /**\n  * Compiles a partial injector declaration object into a full injector definition object."
        },
        {
            "sha": "34e3427cfeafc8fbcbf481b0944eb74ded575ad8",
            "filename": "packages/core/src/render3/jit/pipe.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fpipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fpipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fpipe.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -23,9 +23,13 @@ export function compilePipe(type: Type<any>, meta: Pipe): void {\n       if (ngFactoryDef === null) {\n         const metadata = getPipeMetadata(type, meta);\n         const compiler = getCompilerFacade();\n-        ngFactoryDef = compiler.compileFactory(\n-            angularCoreEnv, `ng:///${metadata.name}/ɵfac.js`,\n-            {...metadata, target: compiler.R3FactoryTarget.Pipe});\n+        ngFactoryDef = compiler.compileFactory(angularCoreEnv, `ng:///${metadata.name}/ɵfac.js`, {\n+          name: metadata.name,\n+          type: metadata.type,\n+          typeArgumentCount: 0,\n+          deps: reflectDependencies(type),\n+          target: compiler.R3FactoryTarget.Pipe\n+        });\n       }\n       return ngFactoryDef;\n     },\n@@ -50,9 +54,7 @@ export function compilePipe(type: Type<any>, meta: Pipe): void {\n function getPipeMetadata(type: Type<any>, meta: Pipe): R3PipeMetadataFacade {\n   return {\n     type: type,\n-    typeArgumentCount: 0,\n     name: type.name,\n-    deps: reflectDependencies(type),\n     pipeName: meta.name,\n     pure: meta.pure !== undefined ? meta.pure : true\n   };"
        },
        {
            "sha": "4bf39a3022087ee3bc4a9287f95efb24b686c2c0",
            "filename": "packages/core/test/render3/jit/declare_factory_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_factory_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_factory_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_factory_spec.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -6,7 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {Injector, ɵcreateInjector, ɵɵFactoryTarget, ɵɵngDeclareFactory, ɵɵResolvedDependencyType} from '@angular/core';\n+import {Injector, ɵcreateInjector, ɵɵFactoryTarget, ɵɵngDeclareFactory} from '@angular/core';\n import {ɵɵdefineInjector} from '@angular/core/src/di';\n import {setCurrentInjector} from '@angular/core/src/di/injector_compatibility';\n \n@@ -47,7 +47,7 @@ class DependingClass {\n   constructor(readonly testClass: TestClass) {}\n   static ɵfac = ɵɵngDeclareFactory({\n     type: DependingClass,\n-    deps: [{token: TestClass, resolved: ɵɵResolvedDependencyType.Token}],\n+    deps: [{token: TestClass}],\n     target: ɵɵFactoryTarget.Injectable,\n   });\n }"
        },
        {
            "sha": "e3c12a83eb2aa9474cf99c67c83b661f216aa82e",
            "filename": "packages/core/test/render3/jit_environment_spec.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Ftest%2Frender3%2Fjit_environment_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/72b65f995d21847e473cac398d52c25978446f4d/packages%2Fcore%2Ftest%2Frender3%2Fjit_environment_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fjit_environment_spec.ts?ref=72b65f995d21847e473cac398d52c25978446f4d",
            "patch": "@@ -34,8 +34,6 @@ const PARTIAL_ONLY = new Set<string>([\n   'ɵɵngDeclareNgModule',\n   'ɵɵngDeclarePipe',\n   'ɵɵFactoryTarget',\n-  'ɵɵResolvedDependencyType',\n-  'ɵɵFactoryDelegateType',\n   'ChangeDetectionStrategy',\n   'ViewEncapsulation',\n ]);"
        }
    ],
    "stats": {
        "total": 540,
        "additions": 221,
        "deletions": 319
    }
}