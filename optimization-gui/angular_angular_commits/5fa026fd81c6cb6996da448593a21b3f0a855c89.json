{
    "author": "JoostK",
    "message": "refactor(compiler): add type information to `DefinitionMap` (#39961)\n\nThis allows the code generation to correspond with a type, which is\nhelpful for documentation and discoverability purposes. This does not\noffer any type-safety with respect to the actually generated code.\n\nPR Close #39961",
    "sha": "5fa026fd81c6cb6996da448593a21b3f0a855c89",
    "files": [
        {
            "sha": "a19f0020bc0dece13dd5f45536f3f74d6110d8b1",
            "filename": "packages/compiler/src/render3/partial/component.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/5fa026fd81c6cb6996da448593a21b3f0a855c89/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/5fa026fd81c6cb6996da448593a21b3f0a855c89/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fcomponent.ts?ref=5fa026fd81c6cb6996da448593a21b3f0a855c89",
            "patch": "@@ -9,10 +9,11 @@ import * as core from '../../core';\n import {DEFAULT_INTERPOLATION_CONFIG} from '../../ml_parser/interpolation_config';\n import * as o from '../../output/output_ast';\n import {Identifiers as R3} from '../r3_identifiers';\n-import {R3ComponentDef, R3ComponentMetadata} from '../view/api';\n+import {R3ComponentDef, R3ComponentMetadata, R3UsedDirectiveMetadata} from '../view/api';\n import {createComponentType} from '../view/compiler';\n import {ParsedTemplate} from '../view/template';\n import {DefinitionMap} from '../view/util';\n+import {R3DeclareComponentMetadata} from './api';\n \n import {createDirectiveDefinitionMap} from './directive';\n import {toOptionalLiteralArray} from './util';\n@@ -34,9 +35,10 @@ export function compileDeclareComponentFromMetadata(\n /**\n  * Gathers the declaration fields for a component into a `DefinitionMap`.\n  */\n-export function createComponentDefinitionMap(\n-    meta: R3ComponentMetadata, template: ParsedTemplate): DefinitionMap {\n-  const definitionMap = createDirectiveDefinitionMap(meta);\n+export function createComponentDefinitionMap(meta: R3ComponentMetadata, template: ParsedTemplate):\n+    DefinitionMap<R3DeclareComponentMetadata> {\n+  const definitionMap: DefinitionMap<R3DeclareComponentMetadata> =\n+      createDirectiveDefinitionMap(meta);\n \n   const templateMap = compileTemplateDefinition(template);\n \n@@ -76,7 +78,7 @@ export function createComponentDefinitionMap(\n  * Compiles the provided template into its partial definition.\n  */\n function compileTemplateDefinition(template: ParsedTemplate): o.LiteralMapExpr {\n-  const templateMap = new DefinitionMap();\n+  const templateMap = new DefinitionMap<R3DeclareComponentMetadata['template']>();\n   const templateExpr =\n       typeof template.template === 'string' ? o.literal(template.template) : template.template;\n   templateMap.set('source', templateExpr);\n@@ -94,7 +96,7 @@ function compileUsedDirectiveMetadata(meta: R3ComponentMetadata): o.LiteralArray\n       (expr: o.Expression) => expr;\n \n   return toOptionalLiteralArray(meta.directives, directive => {\n-    const dirMeta = new DefinitionMap();\n+    const dirMeta = new DefinitionMap<R3UsedDirectiveMetadata>();\n     dirMeta.set('type', wrapType(directive.type));\n     dirMeta.set('selector', o.literal(directive.selector));\n     dirMeta.set('inputs', toOptionalLiteralArray(directive.inputs, o.literal));"
        },
        {
            "sha": "c4d6cd0af339a78d63fc722855c9346c8c0cadbf",
            "filename": "packages/compiler/src/render3/partial/directive.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/5fa026fd81c6cb6996da448593a21b3f0a855c89/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/5fa026fd81c6cb6996da448593a21b3f0a855c89/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fpartial%2Fdirective.ts?ref=5fa026fd81c6cb6996da448593a21b3f0a855c89",
            "patch": "@@ -10,6 +10,7 @@ import {Identifiers as R3} from '../r3_identifiers';\n import {R3DirectiveDef, R3DirectiveMetadata, R3HostMetadata, R3QueryMetadata} from '../view/api';\n import {createDirectiveType} from '../view/compiler';\n import {asLiteral, conditionallyCreateMapObjectLiteral, DefinitionMap} from '../view/util';\n+import {R3DeclareDirectiveMetadata, R3DeclareQueryMetadata} from './api';\n import {toOptionalLiteralMap} from './util';\n \n \n@@ -29,8 +30,9 @@ export function compileDeclareDirectiveFromMetadata(meta: R3DirectiveMetadata):\n  * Gathers the declaration fields for a directive into a `DefinitionMap`. This allows for reusing\n  * this logic for components, as they extend the directive metadata.\n  */\n-export function createDirectiveDefinitionMap(meta: R3DirectiveMetadata): DefinitionMap {\n-  const definitionMap = new DefinitionMap();\n+export function createDirectiveDefinitionMap(meta: R3DirectiveMetadata):\n+    DefinitionMap<R3DeclareDirectiveMetadata> {\n+  const definitionMap = new DefinitionMap<R3DeclareDirectiveMetadata>();\n \n   definitionMap.set('version', o.literal('0.0.0-PLACEHOLDER'));\n \n@@ -77,7 +79,7 @@ export function createDirectiveDefinitionMap(meta: R3DirectiveMetadata): Definit\n  * by `R3DeclareQueryMetadata`.\n  */\n function compileQuery(query: R3QueryMetadata): o.LiteralMapExpr {\n-  const meta = new DefinitionMap();\n+  const meta = new DefinitionMap<R3DeclareQueryMetadata>();\n   meta.set('propertyName', o.literal(query.propertyName));\n   if (query.first) {\n     meta.set('first', o.literal(true));\n@@ -99,7 +101,7 @@ function compileQuery(query: R3QueryMetadata): o.LiteralMapExpr {\n  * in `R3DeclareDirectiveMetadata['host']`\n  */\n function compileHostMetadata(meta: R3HostMetadata): o.LiteralMapExpr|null {\n-  const hostMetadata = new DefinitionMap();\n+  const hostMetadata = new DefinitionMap<NonNullable<R3DeclareDirectiveMetadata['host']>>();\n   hostMetadata.set('attributes', toOptionalLiteralMap(meta.attributes, expression => expression));\n   hostMetadata.set('listeners', toOptionalLiteralMap(meta.listeners, o.literal));\n   hostMetadata.set('properties', toOptionalLiteralMap(meta.properties, o.literal));"
        },
        {
            "sha": "34e4fedd70cb14b450f733fd220679305a5d3b95",
            "filename": "packages/compiler/src/render3/view/util.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/5fa026fd81c6cb6996da448593a21b3f0a855c89/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/5fa026fd81c6cb6996da448593a21b3f0a855c89/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Futil.ts?ref=5fa026fd81c6cb6996da448593a21b3f0a855c89",
            "patch": "@@ -142,12 +142,17 @@ export function getQueryPredicate(\n   }\n }\n \n-export class DefinitionMap {\n+/**\n+ * A representation for an object literal used during codegen of definition objects. The generic\n+ * type `T` allows to reference a documented type of the generated structure, such that the\n+ * property names that are set can be resolved to their documented declaration.\n+ */\n+export class DefinitionMap<T = any> {\n   values: {key: string, quoted: boolean, value: o.Expression}[] = [];\n \n-  set(key: string, value: o.Expression|null): void {\n+  set(key: keyof T, value: o.Expression|null): void {\n     if (value) {\n-      this.values.push({key, value, quoted: false});\n+      this.values.push({key: key as string, value, quoted: false});\n     }\n   }\n "
        }
    ],
    "stats": {
        "total": 35,
        "additions": 22,
        "deletions": 13
    }
}