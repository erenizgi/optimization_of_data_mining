{
    "author": "devversion",
    "message": "feat(compiler-cli): inline resources when generating class metadata calls (#43178)\n\nPreviously with View Engine output, the `enableResourceInlining` option\ncould be set to inline external templates and styles (also for the\nresulting `.metadata.json` files). We want to do the same for the Ivy\ncompilation pipeline (regardless of the compilation mode). The full\ncompilation definitions, and partial declarations currently already\ninline resources in a way that no external requests need to be made.\n\nAlthough there is one exception currently. These are the calls for\nsetting class metadata (for testbed overrides). This commit updates\nthe set class metadata calls (for both partial and full compilation)\nto always inline resources. This means that libraries do not need\nto start shipping external styles/templates just for the\n`setClassMetadata` calls.\n\nNote: Only doing this for partial compilation has been considered, but\nit seems like it would be simpler implementation-wise to do this for\nfull compilation as well. Given the external resources are already\ninlined (through their `ecmp` definitions), it seems acceptable (or\neven more aligned) to do the same for the set class metadata calls.\n\nPR Close #43178",
    "sha": "bed121c34f9c4ec4741a4690693423bb7ed66982",
    "files": [
        {
            "sha": "8ecd2c990ee5b66809a8a71a084324b291a8d745",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/component.ts",
            "status": "modified",
            "additions": 51,
            "deletions": 1,
            "changes": 52,
            "blob_url": "https://github.com/angular/angular/blob/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts?ref=bed121c34f9c4ec4741a4690693423bb7ed66982",
            "patch": "@@ -504,7 +504,8 @@ export class ComponentDecoratorHandler implements\n         },\n         typeCheckMeta: extractDirectiveTypeCheckMeta(node, inputs, this.reflector),\n         classMetadata: extractClassMetadata(\n-            node, this.reflector, this.isCore, this.annotateForClosureCompiler),\n+            node, this.reflector, this.isCore, this.annotateForClosureCompiler,\n+            dec => this._transformDecoratorToInlineResources(dec, component, styles, template)),\n         template,\n         providersRequiringFactory,\n         viewProvidersRequiringFactory,\n@@ -920,6 +921,55 @@ export class ComponentDecoratorHandler implements\n     return compileResults(fac, def, classMetadata, 'Éµcmp');\n   }\n \n+  /**\n+   * Transforms the given decorator to inline external resources. i.e. if the decorator\n+   * resolves to `@Component`, the `templateUrl` and `styleUrls` metadata fields will be\n+   * transformed to their semantically-equivalent inline variants.\n+   *\n+   * This method is used for serializing decorators into the class metadata. The emitted\n+   * class metadata should not refer to external resources as this would be inconsistent\n+   * with the component definitions/declarations which already inline external resources.\n+   *\n+   * Additionally, the references to external resources would require libraries to ship\n+   * external resources exclusively for the class metadata.\n+   */\n+  private _transformDecoratorToInlineResources(\n+      dec: Decorator, component: Map<string, ts.Expression>, styles: string[],\n+      template: ParsedTemplateWithSource): Decorator {\n+    if (dec.name !== 'Component') {\n+      return dec;\n+    }\n+\n+    // If no external resources are referenced, preserve the original decorator\n+    // for the best source map experience when the decorator is emitted in TS.\n+    if (!component.has('templateUrl') && !component.has('styleUrls')) {\n+      return dec;\n+    }\n+\n+    const metadata = new Map(component);\n+\n+    // Set the `template` property if the `templateUrl` property is set.\n+    if (metadata.has('templateUrl')) {\n+      metadata.delete('templateUrl');\n+      metadata.set('template', ts.createStringLiteral(template.content));\n+    }\n+\n+    // Set the `styles` property if the `styleUrls` property is set.\n+    if (metadata.has('styleUrls')) {\n+      metadata.delete('styleUrls');\n+      metadata.set('styles', ts.createArrayLiteral(styles.map(s => ts.createStringLiteral(s))));\n+    }\n+\n+    // Convert the metadata to TypeScript AST object literal element nodes.\n+    const newMetadataFields: ts.ObjectLiteralElementLike[] = [];\n+    for (const [name, value] of metadata.entries()) {\n+      newMetadataFields.push(ts.createPropertyAssignment(name, value));\n+    }\n+\n+    // Return the original decorator with the overridden metadata argument.\n+    return {...dec, args: [ts.createObjectLiteral(newMetadataFields)]};\n+  }\n+\n   private _resolveLiteral(decorator: Decorator): ts.ObjectLiteralExpression {\n     if (this.literalCache.has(decorator)) {\n       return this.literalCache.get(decorator)!;"
        },
        {
            "sha": "537e53543837c854684e6b26e84d6dde08451b02",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/metadata.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fmetadata.ts",
            "raw_url": "https://github.com/angular/angular/raw/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fmetadata.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fmetadata.ts?ref=bed121c34f9c4ec4741a4690693423bb7ed66982",
            "patch": "@@ -23,7 +23,8 @@ import {valueReferenceToExpression, wrapFunctionExpressionsInParens} from './uti\n  */\n export function extractClassMetadata(\n     clazz: DeclarationNode, reflection: ReflectionHost, isCore: boolean,\n-    annotateForClosureCompiler?: boolean): R3ClassMetadata|null {\n+    annotateForClosureCompiler?: boolean,\n+    angularDecoratorTransform: (dec: Decorator) => Decorator = dec => dec): R3ClassMetadata|null {\n   if (!reflection.isClass(clazz)) {\n     return null;\n   }\n@@ -37,7 +38,9 @@ export function extractClassMetadata(\n   }\n   const ngClassDecorators =\n       classDecorators.filter(dec => isAngularDecorator(dec, isCore))\n-          .map(decorator => decoratorToMetadata(decorator, annotateForClosureCompiler))\n+          .map(\n+              decorator => decoratorToMetadata(\n+                  angularDecoratorTransform(decorator), annotateForClosureCompiler))\n           // Since the `setClassMetadata` call is intended to be emitted after the class\n           // declaration, we have to strip references to the existing identifiers or\n           // TypeScript might generate invalid code when it emits to JS. In particular\n@@ -156,8 +159,8 @@ function isAngularDecorator(decorator: Decorator, isCore: boolean): boolean {\n \n /**\n  * Recursively recreates all of the `Identifier` descendant nodes with a particular name inside\n- * of an AST node, thus removing any references to them. Useful if a particular node has to be t\n- * aken from one place any emitted to another one exactly as it has been written.\n+ * of an AST node, thus removing any references to them. Useful if a particular node has to be\n+ * taken from one place any emitted to another one exactly as it has been written.\n  */\n function removeIdentifierReferences<T extends ts.Node>(node: T, name: string): T {\n   const result = ts.transform("
        },
        {
            "sha": "2775e81a26be2d5d93bf19b0140ad87f0fdad341",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/class_metadata/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 13,
            "deletions": 1,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fclass_metadata%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fclass_metadata%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fclass_metadata%2FGOLDEN_PARTIAL.js?ref=bed121c34f9c4ec4741a4690693423bb7ed66982",
            "patch": "@@ -27,7 +27,7 @@ var __decorate = (this && this.__decorate) || function (decorators, target, key,\n     else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n     return c > 3 && r && Object.defineProperty(target, key, r), r;\n };\n-import { Injectable } from '@angular/core';\n+import { Component, Injectable } from '@angular/core';\n import { CustomClassDecorator } from './custom';\n import * as i0 from \"@angular/core\";\n export class BasicInjectable {\n@@ -55,6 +55,14 @@ CustomInjectable = __decorate([\n i0.ÉµÉµngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: CustomInjectable, decorators: [{\n             type: Injectable\n         }] });\n+export class ComponentWithExternalResource {\n+}\n+ComponentWithExternalResource.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: ComponentWithExternalResource, deps: [], target: i0.ÉµÉµFactoryTarget.Component });\n+ComponentWithExternalResource.Éµcmp = i0.ÉµÉµngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: ComponentWithExternalResource, selector: \"test-cmp\", ngImport: i0, template: \"<span>Test template</span>\\n\" });\n+i0.ÉµÉµngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: ComponentWithExternalResource, decorators: [{\n+            type: Component,\n+            args: [{ selector: 'test-cmp', template: \"<span>Test template</span>\\n\" }]\n+        }] });\n \n /****************************************************************************************************\n  * PARTIAL FILE: class_decorators.d.ts\n@@ -68,6 +76,10 @@ export declare class RootInjectable {\n     static Éµfac: i0.ÉµÉµFactoryDeclaration<RootInjectable, never>;\n     static Éµprov: i0.ÉµÉµInjectableDeclaration<RootInjectable>;\n }\n+export declare class ComponentWithExternalResource {\n+    static Éµfac: i0.ÉµÉµFactoryDeclaration<ComponentWithExternalResource, never>;\n+    static Éµcmp: i0.ÉµÉµComponentDeclaration<ComponentWithExternalResource, \"test-cmp\", never, {}, {}, never, never>;\n+}\n \n /****************************************************************************************************\n  * PARTIAL FILE: custom.js"
        },
        {
            "sha": "6206b8bc32ebae27e7ac97f0ef4db8bd34146bf0",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/class_metadata/class_decorators.js",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fclass_metadata%2Fclass_decorators.js",
            "raw_url": "https://github.com/angular/angular/raw/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fclass_metadata%2Fclass_decorators.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fclass_metadata%2Fclass_decorators.js?ref=bed121c34f9c4ec4741a4690693423bb7ed66982",
            "patch": "@@ -29,3 +29,17 @@ CustomInjectable = __decorate([\n     type: Injectable\n   }], null, null);\n })();\n+\n+â€¦\n+\n+ComponentWithExternalResource.Éµfac = â€¦;\n+ComponentWithExternalResource.Éµcmp = â€¦;\n+(function () {\n+  (typeof ngDevMode === \"undefined\" || ngDevMode) && $i0$.ÉµsetClassMetadata(ComponentWithExternalResource, [{\n+    type: Component,\n+    args: [{\n+      selector: 'test-cmp',\n+      template: \"<span>Test template</span>\\n\"\n+    }]\n+  }], null, null);\n+})();"
        },
        {
            "sha": "4ed74a423d53b2562a9a5739b6ff11af8c558667",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/class_metadata/class_decorators.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fclass_metadata%2Fclass_decorators.ts",
            "raw_url": "https://github.com/angular/angular/raw/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fclass_metadata%2Fclass_decorators.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fclass_metadata%2Fclass_decorators.ts?ref=bed121c34f9c4ec4741a4690693423bb7ed66982",
            "patch": "@@ -1,4 +1,5 @@\n-import {Injectable} from '@angular/core';\n+import {Component, Injectable} from '@angular/core';\n+\n import {CustomClassDecorator} from './custom';\n \n @Injectable()\n@@ -13,3 +14,10 @@ export class RootInjectable {\n @CustomClassDecorator()\n class CustomInjectable {\n }\n+\n+@Component({\n+  selector: 'test-cmp',\n+  templateUrl: 'test_cmp_template.html',\n+})\n+export class ComponentWithExternalResource {\n+}"
        },
        {
            "sha": "7737c5dde7ffd1464ad0ade5aaceab3b9859225e",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/class_metadata/test_cmp_template.html",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fclass_metadata%2Ftest_cmp_template.html",
            "raw_url": "https://github.com/angular/angular/raw/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fclass_metadata%2Ftest_cmp_template.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fclass_metadata%2Ftest_cmp_template.html?ref=bed121c34f9c4ec4741a4690693423bb7ed66982",
            "patch": "@@ -0,0 +1 @@\n+<span>Test template</span>"
        },
        {
            "sha": "d71d0a6bfebde1b1239d277931781b46ed5d6196",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_view_compiler_i18n/line_ending_normalization/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 4,
            "deletions": 24,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_i18n%2Fline_ending_normalization%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_i18n%2Fline_ending_normalization%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_view_compiler_i18n%2Fline_ending_normalization%2FGOLDEN_PARTIAL.js?ref=bed121c34f9c4ec4741a4690693423bb7ed66982",
            "patch": "@@ -135,12 +135,7 @@ MyComponent.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.\n MyComponent.Éµcmp = i0.ÉµÉµngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", ngImport: i0, template: \"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div title=\\\"abc\\r\\ndef\\\" i18n-title i18n>\\r\\n  Some Message\\r\\n  {\\r\\n    value,\\r\\n    select,\\r\\n    =0 {\\r\\n      zero\\r\\n    }\\r\\n  }</div>\" });\n i0.ÉµÉµngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyComponent, decorators: [{\n             type: Component,\n-            args: [{\n-                    selector: 'my-component',\n-                    // NOTE: The template has escaped `\\r\\n` line-endings markers that will be converted to real\n-                    // `\\r\\n` line-ending chars when loaded from the test file-system.\n-                    templateUrl: 'template.html'\n-                }]\n+            args: [{ selector: 'my-component', template: \"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div title=\\\"abc\\r\\ndef\\\" i18n-title i18n>\\r\\n  Some Message\\r\\n  {\\r\\n    value,\\r\\n    select,\\r\\n    =0 {\\r\\n      zero\\r\\n    }\\r\\n  }</div>\" }]\n         }] });\n export class MyModule {\n }\n@@ -178,12 +173,7 @@ MyComponent.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.\n MyComponent.Éµcmp = i0.ÉµÉµngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", ngImport: i0, template: \"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div title=\\\"abc\\r\\ndef\\\" i18n-title i18n>\\r\\n  Some Message\\r\\n  {\\r\\n    value,\\r\\n    select,\\r\\n    =0 {\\r\\n      zero\\r\\n    }\\r\\n  }</div>\" });\n i0.ÉµÉµngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyComponent, decorators: [{\n             type: Component,\n-            args: [{\n-                    selector: 'my-component',\n-                    // NOTE: The template has escaped `\\r\\n` line-endings markers that will be converted to real\n-                    // `\\r\\n` line-ending chars when loaded from the test file-system.\n-                    templateUrl: 'template.html'\n-                }]\n+            args: [{ selector: 'my-component', template: \"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div title=\\\"abc\\r\\ndef\\\" i18n-title i18n>\\r\\n  Some Message\\r\\n  {\\r\\n    value,\\r\\n    select,\\r\\n    =0 {\\r\\n      zero\\r\\n    }\\r\\n  }</div>\" }]\n         }] });\n export class MyModule {\n }\n@@ -347,12 +337,7 @@ MyComponent.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.\n MyComponent.Éµcmp = i0.ÉµÉµngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", ngImport: i0, template: \"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div title=\\\"abc\\r\\ndef\\\" i18n-title i18n>\\r\\n  Some Message\\r\\n  {\\r\\n    value,\\r\\n    select,\\r\\n    =0 {\\r\\n      zero\\r\\n    }\\r\\n  }</div>\" });\n i0.ÉµÉµngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyComponent, decorators: [{\n             type: Component,\n-            args: [{\n-                    selector: 'my-component',\n-                    // NOTE: The template has escaped `\\r\\n` line-endings markers that will be converted to real\n-                    // `\\r\\n` line-ending chars when loaded from the test file-system.\n-                    templateUrl: 'template.html'\n-                }]\n+            args: [{ selector: 'my-component', template: \"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div title=\\\"abc\\r\\ndef\\\" i18n-title i18n>\\r\\n  Some Message\\r\\n  {\\r\\n    value,\\r\\n    select,\\r\\n    =0 {\\r\\n      zero\\r\\n    }\\r\\n  }</div>\" }]\n         }] });\n export class MyModule {\n }\n@@ -390,12 +375,7 @@ MyComponent.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.\n MyComponent.Éµcmp = i0.ÉµÉµngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: MyComponent, selector: \"my-component\", ngImport: i0, template: \"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div title=\\\"abc\\r\\ndef\\\" i18n-title i18n>\\r\\n  Some Message\\r\\n  {\\r\\n    value,\\r\\n    select,\\r\\n    =0 {\\r\\n      zero\\r\\n    }\\r\\n  }</div>\" });\n i0.ÉµÉµngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyComponent, decorators: [{\n             type: Component,\n-            args: [{\n-                    selector: 'my-component',\n-                    // NOTE: The template has escaped `\\r\\n` line-endings markers that will be converted to real\n-                    // `\\r\\n` line-ending chars when loaded from the test file-system.\n-                    templateUrl: 'template.html'\n-                }]\n+            args: [{ selector: 'my-component', template: \"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div title=\\\"abc\\r\\ndef\\\" i18n-title i18n>\\r\\n  Some Message\\r\\n  {\\r\\n    value,\\r\\n    select,\\r\\n    =0 {\\r\\n      zero\\r\\n    }\\r\\n  }</div>\" }]\n         }] });\n export class MyModule {\n }"
        },
        {
            "sha": "1cd00c3885674edd7e957553315934bff5f47c36",
            "filename": "packages/compiler-cli/test/compliance/test_cases/source_mapping/external_templates/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 12,
            "deletions": 30,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fsource_mapping%2Fexternal_templates%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/bed121c34f9c4ec4741a4690693423bb7ed66982/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fsource_mapping%2Fexternal_templates%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fsource_mapping%2Fexternal_templates%2FGOLDEN_PARTIAL.js?ref=bed121c34f9c4ec4741a4690693423bb7ed66982",
            "patch": "@@ -9,16 +9,13 @@ TestCmp.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-\n TestCmp.Éµcmp = i0.ÉµÉµngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: TestCmp, selector: \"test-cmp\", ngImport: i0, template: \"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\" });\n i0.ÉµÉµngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: TestCmp, decorators: [{\n             type: Component,\n-            args: [{\n-                    selector: 'test-cmp',\n-                    templateUrl: './dir/test.html',\n-                }]\n+            args: [{ selector: 'test-cmp', template: \"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\" }]\n         }] });\n //# sourceMappingURL=external_template.js.map\n /****************************************************************************************************\n  * PARTIAL FILE: external_template.js.map\n  ****************************************************************************************************/\n-{\"version\":3,\"file\":\"external_template.js\",\"sourceRoot\":\"\",\"sources\":[\"../external_template.ts\",\"../dir/test.html\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;;AAMxC,MAAM,OAAO,OAAO;;+GAAP,OAAO;mGAAP,OAAO,gDCNpB,mDACsB;sGDKT,OAAO;kBAJnB,SAAS;mBAAC;oBACT,QAAQ,EAAE,UAAU;oBACpB,WAAW,EAAE,iBAAiB;iBAC/B\",\"sourcesContent\":[\"import {Component} from '@angular/core';\\n\\n@Component({\\n  selector: 'test-cmp',\\n  templateUrl: './dir/test.html',\\n})\\nexport class TestCmp {\\n}\\n\",\"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\"]}\n+{\"version\":3,\"file\":\"external_template.js\",\"sourceRoot\":\"\",\"sources\":[\"../external_template.ts\",\"../dir/test.html\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;;AAMxC,MAAM,OAAO,OAAO;;+GAAP,OAAO;mGAAP,OAAO,gDCNpB,mDACsB;sGDKT,OAAO;kBAJnB,SAAS;+BACE,UAAU\",\"sourcesContent\":[\"import {Component} from '@angular/core';\\n\\n@Component({\\n  selector: 'test-cmp',\\n  templateUrl: './dir/test.html',\\n})\\nexport class TestCmp {\\n}\\n\",\"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\"]}\n /****************************************************************************************************\n  * PARTIAL FILE: external_template.d.ts\n  ****************************************************************************************************/\n@@ -39,16 +36,13 @@ TestCmp.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-\n TestCmp.Éµcmp = i0.ÉµÉµngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: TestCmp, selector: \"test-cmp\", ngImport: i0, template: \"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\" });\n i0.ÉµÉµngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: TestCmp, decorators: [{\n             type: Component,\n-            args: [{\n-                    selector: 'test-cmp',\n-                    templateUrl: './dir/test.html',\n-                }]\n+            args: [{ selector: 'test-cmp', template: \"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\" }]\n         }] });\n //# sourceMappingURL=external_template.js.map\n /****************************************************************************************************\n  * PARTIAL FILE: external_template.js.map\n  ****************************************************************************************************/\n-{\"version\":3,\"file\":\"external_template.js\",\"sourceRoot\":\"\",\"sources\":[\"../external_template.ts\",\"../dir/test.html\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;;AAMxC,MAAM,OAAO,OAAO;;+GAAP,OAAO;mGAAP,OAAO,gDCNpB,mDACsB;sGDKT,OAAO;kBAJnB,SAAS;mBAAC;oBACT,QAAQ,EAAE,UAAU;oBACpB,WAAW,EAAE,iBAAiB;iBAC/B\",\"sourcesContent\":[\"import {Component} from '@angular/core';\\n\\n@Component({\\n  selector: 'test-cmp',\\n  templateUrl: './dir/test.html',\\n})\\nexport class TestCmp {\\n}\\n\",\"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\"]}\n+{\"version\":3,\"file\":\"external_template.js\",\"sourceRoot\":\"\",\"sources\":[\"../external_template.ts\",\"../dir/test.html\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;;AAMxC,MAAM,OAAO,OAAO;;+GAAP,OAAO;mGAAP,OAAO,gDCNpB,mDACsB;sGDKT,OAAO;kBAJnB,SAAS;+BACE,UAAU\",\"sourcesContent\":[\"import {Component} from '@angular/core';\\n\\n@Component({\\n  selector: 'test-cmp',\\n  templateUrl: './dir/test.html',\\n})\\nexport class TestCmp {\\n}\\n\",\"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\"]}\n /****************************************************************************************************\n  * PARTIAL FILE: external_template.d.ts\n  ****************************************************************************************************/\n@@ -69,16 +63,13 @@ TestCmp.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-\n TestCmp.Éµcmp = i0.ÉµÉµngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: TestCmp, selector: \"test-cmp\", ngImport: i0, template: \"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\" });\n i0.ÉµÉµngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: TestCmp, decorators: [{\n             type: Component,\n-            args: [{\n-                    selector: 'test-cmp',\n-                    templateUrl: './dir/extra.html',\n-                }]\n+            args: [{ selector: 'test-cmp', template: \"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\" }]\n         }] });\n //# sourceMappingURL=extra_root_dir.js.map\n /****************************************************************************************************\n  * PARTIAL FILE: extra_root_dir.js.map\n  ****************************************************************************************************/\n-{\"version\":3,\"file\":\"extra_root_dir.js\",\"sourceRoot\":\"\",\"sources\":[\"../extra_root_dir.ts\",\"../extraRootDir/dir/extra.html\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;;AAMxC,MAAM,OAAO,OAAO;;+GAAP,OAAO;mGAAP,OAAO,gDCNpB,mDACsB;sGDKT,OAAO;kBAJnB,SAAS;mBAAC;oBACT,QAAQ,EAAE,UAAU;oBACpB,WAAW,EAAE,kBAAkB;iBAChC\",\"sourcesContent\":[\"import {Component} from '@angular/core';\\n\\n@Component({\\n  selector: 'test-cmp',\\n  templateUrl: './dir/extra.html',\\n})\\nexport class TestCmp {\\n}\\n\",\"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\"]}\n+{\"version\":3,\"file\":\"extra_root_dir.js\",\"sourceRoot\":\"\",\"sources\":[\"../extra_root_dir.ts\",\"../extraRootDir/dir/extra.html\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;;AAMxC,MAAM,OAAO,OAAO;;+GAAP,OAAO;mGAAP,OAAO,gDCNpB,mDACsB;sGDKT,OAAO;kBAJnB,SAAS;+BACE,UAAU\",\"sourcesContent\":[\"import {Component} from '@angular/core';\\n\\n@Component({\\n  selector: 'test-cmp',\\n  templateUrl: './dir/extra.html',\\n})\\nexport class TestCmp {\\n}\\n\",\"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\"]}\n /****************************************************************************************************\n  * PARTIAL FILE: extra_root_dir.d.ts\n  ****************************************************************************************************/\n@@ -99,16 +90,13 @@ TestCmp.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-\n TestCmp.Éµcmp = i0.ÉµÉµngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: TestCmp, selector: \"test-cmp\", ngImport: i0, template: \"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\" });\n i0.ÉµÉµngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: TestCmp, decorators: [{\n             type: Component,\n-            args: [{\n-                    selector: 'test-cmp',\n-                    templateUrl: './dir/extra.html',\n-                }]\n+            args: [{ selector: 'test-cmp', template: \"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\" }]\n         }] });\n //# sourceMappingURL=extra_root_dir.js.map\n /****************************************************************************************************\n  * PARTIAL FILE: extra_root_dir.js.map\n  ****************************************************************************************************/\n-{\"version\":3,\"file\":\"extra_root_dir.js\",\"sourceRoot\":\"\",\"sources\":[\"../extra_root_dir.ts\",\"../extraRootDir/dir/extra.html\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;;AAMxC,MAAM,OAAO,OAAO;;+GAAP,OAAO;mGAAP,OAAO,gDCNpB,mDACsB;sGDKT,OAAO;kBAJnB,SAAS;mBAAC;oBACT,QAAQ,EAAE,UAAU;oBACpB,WAAW,EAAE,kBAAkB;iBAChC\",\"sourcesContent\":[\"import {Component} from '@angular/core';\\n\\n@Component({\\n  selector: 'test-cmp',\\n  templateUrl: './dir/extra.html',\\n})\\nexport class TestCmp {\\n}\\n\",\"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\"]}\n+{\"version\":3,\"file\":\"extra_root_dir.js\",\"sourceRoot\":\"\",\"sources\":[\"../extra_root_dir.ts\",\"../extraRootDir/dir/extra.html\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;;AAMxC,MAAM,OAAO,OAAO;;+GAAP,OAAO;mGAAP,OAAO,gDCNpB,mDACsB;sGDKT,OAAO;kBAJnB,SAAS;+BACE,UAAU\",\"sourcesContent\":[\"import {Component} from '@angular/core';\\n\\n@Component({\\n  selector: 'test-cmp',\\n  templateUrl: './dir/extra.html',\\n})\\nexport class TestCmp {\\n}\\n\",\"<div>this is a test</div>\\n<div>{{ 1 + 2 }}</div>\"]}\n /****************************************************************************************************\n  * PARTIAL FILE: extra_root_dir.d.ts\n  ****************************************************************************************************/\n@@ -129,16 +117,13 @@ TestCmp.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-\n TestCmp.Éµcmp = i0.ÉµÉµngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: TestCmp, selector: \"test-cmp\", ngImport: i0, template: \"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div>\\r\\n  Some Message\\r\\n  Encoded character: \\uD83D\\uDE80\\r\\n</div>\" });\n i0.ÉµÉµngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: TestCmp, decorators: [{\n             type: Component,\n-            args: [{\n-                    selector: 'test-cmp',\n-                    templateUrl: './escaped_chars.html',\n-                }]\n+            args: [{ selector: 'test-cmp', template: \"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div>\\r\\n  Some Message\\r\\n  Encoded character: \\uD83D\\uDE80\\r\\n</div>\" }]\n         }] });\n //# sourceMappingURL=escaped_chars.js.map\n /****************************************************************************************************\n  * PARTIAL FILE: escaped_chars.js.map\n  ****************************************************************************************************/\n-{\"version\":3,\"file\":\"escaped_chars.js\",\"sourceRoot\":\"\",\"sources\":[\"../escaped_chars.ts\",\"../escaped_chars.html\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;;AAMxC,MAAM,OAAO,OAAO;;+GAAP,OAAO;mGAAP,OAAO,gDCNpB,4VAOM;sGDDO,OAAO;kBAJnB,SAAS;mBAAC;oBACT,QAAQ,EAAE,UAAU;oBACpB,WAAW,EAAE,sBAAsB;iBACpC\",\"sourcesContent\":[\"import {Component} from '@angular/core';\\n\\n@Component({\\n  selector: 'test-cmp',\\n  templateUrl: './escaped_chars.html',\\n})\\nexport class TestCmp {\\n}\\n\",\"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div>\\r\\n  Some Message\\r\\n  Encoded character: ðŸš€\\r\\n</div>\"]}\n+{\"version\":3,\"file\":\"escaped_chars.js\",\"sourceRoot\":\"\",\"sources\":[\"../escaped_chars.ts\",\"../escaped_chars.html\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;;AAMxC,MAAM,OAAO,OAAO;;+GAAP,OAAO;mGAAP,OAAO,gDCNpB,4VAOM;sGDDO,OAAO;kBAJnB,SAAS;+BACE,UAAU\",\"sourcesContent\":[\"import {Component} from '@angular/core';\\n\\n@Component({\\n  selector: 'test-cmp',\\n  templateUrl: './escaped_chars.html',\\n})\\nexport class TestCmp {\\n}\\n\",\"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div>\\r\\n  Some Message\\r\\n  Encoded character: ðŸš€\\r\\n</div>\"]}\n /****************************************************************************************************\n  * PARTIAL FILE: escaped_chars.d.ts\n  ****************************************************************************************************/\n@@ -159,16 +144,13 @@ TestCmp.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-\n TestCmp.Éµcmp = i0.ÉµÉµngDeclareComponent({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", type: TestCmp, selector: \"test-cmp\", ngImport: i0, template: \"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div>\\r\\n  Some Message\\r\\n  Encoded character: \\uD83D\\uDE80\\r\\n</div>\" });\n i0.ÉµÉµngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: TestCmp, decorators: [{\n             type: Component,\n-            args: [{\n-                    selector: 'test-cmp',\n-                    templateUrl: './escaped_chars.html',\n-                }]\n+            args: [{ selector: 'test-cmp', template: \"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div>\\r\\n  Some Message\\r\\n  Encoded character: \\uD83D\\uDE80\\r\\n</div>\" }]\n         }] });\n //# sourceMappingURL=escaped_chars.js.map\n /****************************************************************************************************\n  * PARTIAL FILE: escaped_chars.js.map\n  ****************************************************************************************************/\n-{\"version\":3,\"file\":\"escaped_chars.js\",\"sourceRoot\":\"\",\"sources\":[\"../escaped_chars.ts\",\"../escaped_chars.html\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;;AAMxC,MAAM,OAAO,OAAO;;+GAAP,OAAO;mGAAP,OAAO,gDCNpB,4VAOM;sGDDO,OAAO;kBAJnB,SAAS;mBAAC;oBACT,QAAQ,EAAE,UAAU;oBACpB,WAAW,EAAE,sBAAsB;iBACpC\",\"sourcesContent\":[\"import {Component} from '@angular/core';\\n\\n@Component({\\n  selector: 'test-cmp',\\n  templateUrl: './escaped_chars.html',\\n})\\nexport class TestCmp {\\n}\\n\",\"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div>\\r\\n  Some Message\\r\\n  Encoded character: ðŸš€\\r\\n</div>\"]}\n+{\"version\":3,\"file\":\"escaped_chars.js\",\"sourceRoot\":\"\",\"sources\":[\"../escaped_chars.ts\",\"../escaped_chars.html\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;;AAMxC,MAAM,OAAO,OAAO;;+GAAP,OAAO;mGAAP,OAAO,gDCNpB,4VAOM;sGDDO,OAAO;kBAJnB,SAAS;+BACE,UAAU\",\"sourcesContent\":[\"import {Component} from '@angular/core';\\n\\n@Component({\\n  selector: 'test-cmp',\\n  templateUrl: './escaped_chars.html',\\n})\\nexport class TestCmp {\\n}\\n\",\"<!--\\n  NOTE: This template has escaped `\\\\r\\\\n` line-endings markers that will be converted to real `\\\\r\\\\n` line-ending chars when loaded from the test file-system.\\n        This conversion happens in the monkeyPatchReadFile() function, which changes `fs.readFile()`.\\n-->\\n<div>\\r\\n  Some Message\\r\\n  Encoded character: ðŸš€\\r\\n</div>\"]}\n /****************************************************************************************************\n  * PARTIAL FILE: escaped_chars.d.ts\n  ****************************************************************************************************/"
        }
    ],
    "stats": {
        "total": 172,
        "additions": 111,
        "deletions": 61
    }
}