{
    "author": "gkalpak",
    "message": "fix(docs-infra): correctly handle in-page anchor links (#43460)\n\nPreviously, anchor links that were supposed to point to fragments inside\nthe current page (e.g. `href=\"#something\"`) would end up navigating to\nthe homepage (`/`). This was due to them being resolved relative to the\nbase URL, which is set to `/` (via `<base href=\"/\">`). See also\nhttps://developer.mozilla.org/en-US/docs/Web/HTML/Element/base#in-page_anchors.\n\nThis commit fixes this issue by handling such links specially in\n`LocationService#handleAnchorClick()` and prepending the current path to\nthe URL.\n\nThis will also be useful for implementing a \"skip to content\" link as\ndescribed in #42936.\n\nPR Close #43460",
    "sha": "4dd107d18ca7fbe60dfb31f07074ae6eb37a3949",
    "files": [
        {
            "sha": "1fff1357b270da1dce972379fe0a93521328cf98",
            "filename": "aio/src/app/shared/location.service.spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/4dd107d18ca7fbe60dfb31f07074ae6eb37a3949/aio%2Fsrc%2Fapp%2Fshared%2Flocation.service.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/4dd107d18ca7fbe60dfb31f07074ae6eb37a3949/aio%2Fsrc%2Fapp%2Fshared%2Flocation.service.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fshared%2Flocation.service.spec.ts?ref=4dd107d18ca7fbe60dfb31f07074ae6eb37a3949",
            "patch": "@@ -436,6 +436,14 @@ describe('LocationService', () => {\n         expect(result).toBe(false);\n       });\n \n+      it('local fragment-only URL', () => {\n+        location.internalPath = '/some/path';\n+        anchor.href = '#some-fragment';\n+        const result = service.handleAnchorClick(anchor);\n+        expect(service.go).toHaveBeenCalledWith('/some/path#some-fragment');\n+        expect(result).toBe(false);\n+      });\n+\n       it('local url with query params', () => {\n         anchor.href = 'some/local/url?query=xxx&other=yyy';\n         const result = service.handleAnchorClick(anchor);"
        },
        {
            "sha": "0d314929362835f1d41a7ea3ce4953d8ef6b3874",
            "filename": "aio/src/app/shared/location.service.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/4dd107d18ca7fbe60dfb31f07074ae6eb37a3949/aio%2Fsrc%2Fapp%2Fshared%2Flocation.service.ts",
            "raw_url": "https://github.com/angular/angular/raw/4dd107d18ca7fbe60dfb31f07074ae6eb37a3949/aio%2Fsrc%2Fapp%2Fshared%2Flocation.service.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fshared%2Flocation.service.ts?ref=4dd107d18ca7fbe60dfb31f07074ae6eb37a3949",
            "patch": "@@ -145,11 +145,16 @@ export class LocationService {\n     }\n \n     const { pathname, search, hash } = anchor;\n-    const relativeUrl = pathname + search + hash;\n+    // Fix in-page anchors that are supposed to point to fragments inside the page, but are resolved\n+    // relative the the root path (`/`), due to the base URL being set to `/`.\n+    // (See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base#in-page_anchors.)\n+    const isInPageAnchor = anchor.getAttribute('href')?.startsWith('#') ?? false;\n+    const correctPathname = isInPageAnchor ? this.location.path() : pathname;\n+    const relativeUrl = correctPathname + search + hash;\n     this.urlParser.href = relativeUrl;\n \n     // don't navigate if external link or has extension\n-    if ( anchor.href !== this.urlParser.href ||\n+    if ( (!isInPageAnchor && anchor.href !== this.urlParser.href) ||\n          !/\\/[^/.]*$/.test(pathname) ) {\n       return true;\n     }"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 15,
        "deletions": 2
    }
}