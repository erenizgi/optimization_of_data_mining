{
    "author": "dgp1130",
    "message": "refactor(compiler-cli): add initial compiler options definitions for extended template diagnostics (#44391)\n\nRefs #42966.\n\nThis includes a mapping of extended template diagnostics to their associated diagnostic category. It is generated from the list of diagnostic names, so the list should always be implicitly kept up to date. Usage looks like:\n\n```json\n{\n  \"angularCompilerOptions\": {\n    \"extendedDiagnostics\": {\n      \"checks\": {\n        \"invalidBananaInBox\": \"error\",\n        \"nullishCoalescingNotNullable\": \"suppress\"\n      }\n    }\n  }\n}\n```\n\nPR Close #44391",
    "sha": "416368a587c467e162da334886c07b71dd6fb2cf",
    "files": [
        {
            "sha": "2125d3d7e9af6077f7837746bb2faa47dbe7c7ab",
            "filename": "goldens/public-api/compiler-cli/compiler_options.md",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/416368a587c467e162da334886c07b71dd6fb2cf/goldens%2Fpublic-api%2Fcompiler-cli%2Fcompiler_options.md",
            "raw_url": "https://github.com/angular/angular/raw/416368a587c467e162da334886c07b71dd6fb2cf/goldens%2Fpublic-api%2Fcompiler-cli%2Fcompiler_options.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fcompiler-cli%2Fcompiler_options.md?ref=416368a587c467e162da334886c07b71dd6fb2cf",
            "patch": "@@ -10,6 +10,22 @@ export interface BazelAndG3Options {\n     generateDeepReexports?: boolean;\n }\n \n+// @public\n+export enum DiagnosticCategoryLabel {\n+    Error = \"error\",\n+    Suppress = \"suppress\",\n+    Warning = \"warning\"\n+}\n+\n+// @public\n+export interface DiagnosticOptions {\n+    extendedDiagnostics?: {\n+        checks?: {\n+            [Name in ExtendedTemplateDiagnosticName]?: DiagnosticCategoryLabel;\n+        };\n+    };\n+}\n+\n // @public\n export interface I18nOptions {\n     enableI18nLegacyMessageIdFormat?: boolean;"
        },
        {
            "sha": "0dc379f3a5d6277b1ce8319379bd6e250cced528",
            "filename": "packages/compiler-cli/src/ngtsc/core/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/416368a587c467e162da334886c07b71dd6fb2cf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/416368a587c467e162da334886c07b71dd6fb2cf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2FBUILD.bazel?ref=416368a587c467e162da334886c07b71dd6fb2cf",
            "patch": "@@ -47,6 +47,7 @@ ts_library(\n     name = \"api\",\n     srcs = glob([\"api/**/*.ts\"]),\n     deps = [\n+        \"//packages/compiler-cli/src/ngtsc/diagnostics\",\n         \"//packages/compiler-cli/src/ngtsc/file_system\",\n         \"//packages/compiler-cli/src/ngtsc/shims:api\",\n         \"@npm//typescript\","
        },
        {
            "sha": "923b09722722af48c511376a0f68a2aee9f1beb3",
            "filename": "packages/compiler-cli/src/ngtsc/core/api/src/options.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/416368a587c467e162da334886c07b71dd6fb2cf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fapi%2Fsrc%2Foptions.ts",
            "raw_url": "https://github.com/angular/angular/raw/416368a587c467e162da334886c07b71dd6fb2cf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fapi%2Fsrc%2Foptions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fapi%2Fsrc%2Foptions.ts?ref=416368a587c467e162da334886c07b71dd6fb2cf",
            "patch": "@@ -8,7 +8,7 @@\n \n import ts from 'typescript';\n \n-import {BazelAndG3Options, I18nOptions, LegacyNgcOptions, MiscOptions, NgcCompatibilityOptions, StrictTemplateOptions, TargetOptions} from './public_options';\n+import {BazelAndG3Options, DiagnosticOptions, I18nOptions, LegacyNgcOptions, MiscOptions, NgcCompatibilityOptions, StrictTemplateOptions, TargetOptions} from './public_options';\n \n \n /**\n@@ -53,6 +53,12 @@ export interface InternalOptions {\n  * Also includes a few miscellaneous options.\n  */\n export interface NgCompilerOptions extends ts.CompilerOptions, LegacyNgcOptions, BazelAndG3Options,\n-                                           NgcCompatibilityOptions, StrictTemplateOptions,\n-                                           TestOnlyOptions, I18nOptions, TargetOptions,\n-                                           InternalOptions, MiscOptions {}\n+                                           DiagnosticOptions, NgcCompatibilityOptions,\n+                                           StrictTemplateOptions, TestOnlyOptions, I18nOptions,\n+                                           TargetOptions, InternalOptions, MiscOptions {\n+  // Replace the index signature type from `ts.CompilerOptions` as it is more strict than it needs\n+  // to be and would conflict with some types from the other interfaces. This is ok because Angular\n+  // compiler options are actually separate from TS compiler options in the `tsconfig.json` and we\n+  // have full control over the structure of Angular's compiler options.\n+  [prop: string]: any;\n+}"
        },
        {
            "sha": "765718eae74bd675fa259418ca34b8b22260dc18",
            "filename": "packages/compiler-cli/src/ngtsc/core/api/src/public_options.ts",
            "status": "modified",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/416368a587c467e162da334886c07b71dd6fb2cf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fapi%2Fsrc%2Fpublic_options.ts",
            "raw_url": "https://github.com/angular/angular/raw/416368a587c467e162da334886c07b71dd6fb2cf/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fapi%2Fsrc%2Fpublic_options.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fapi%2Fsrc%2Fpublic_options.ts?ref=416368a587c467e162da334886c07b71dd6fb2cf",
            "patch": "@@ -6,6 +6,8 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {ExtendedTemplateDiagnosticName} from '../../../../ngtsc/diagnostics';\n+\n /**\n  * Options supported by the legacy View Engine compiler, which are still consumed by the Angular Ivy\n  * compiler for backwards compatibility.\n@@ -258,6 +260,40 @@ export interface StrictTemplateOptions {\n   strictLiteralTypes?: boolean;\n }\n \n+/**\n+ * A label referring to a `ts.DiagnosticCategory` or `'suppress'`, meaning the associated diagnostic\n+ * should not be displayed at all.\n+ *\n+ * @publicApi\n+ */\n+export enum DiagnosticCategoryLabel {\n+  /** Treat the diagnostic as a warning, don't fail the compilation. */\n+  Warning = 'warning',\n+\n+  /** Treat the diagnostic as a hard error, fail the compilation. */\n+  Error = 'error',\n+\n+  /** Ignore the diagnostic altogether. */\n+  Suppress = 'suppress',\n+}\n+\n+/**\n+ * Options which control how diagnostics are emitted from the compiler.\n+ *\n+ * @publicApi\n+ */\n+export interface DiagnosticOptions {\n+  /** Options which control how diagnostics are emitted from the compiler. */\n+  extendedDiagnostics?: {\n+    /**\n+     * A map of each extended template diagnostic's name to its category. This can be expanded in\n+     * the future with more information for each check or for additional diagnostics not part of the\n+     * extended template diagnostics system.\n+     */\n+    checks?: {[Name in ExtendedTemplateDiagnosticName]?: DiagnosticCategoryLabel};\n+  };\n+}\n+\n /**\n  * Options which control behavior useful for \"monorepo\" build cases using Bazel (such as the\n  * internal Google monorepo, g3)."
        }
    ],
    "stats": {
        "total": 67,
        "additions": 63,
        "deletions": 4
    }
}