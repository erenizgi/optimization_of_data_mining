{
    "author": "danieltre23",
    "message": "refactor(compiler-cli): add test for `BananaInBoxCheck` (#42984)\n\nCreate the test package for extended_template_diagnostics and add a unit\ntest for the `BananaInBoxCheck`.\n\nRefs #42966\n\nPR Close #42984",
    "sha": "e25d35f4cba97595e0bf664a4624d627e031d756",
    "files": [
        {
            "sha": "0d5b0803804648128ff17faf2a3496769cd228fb",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/test/template_checks/invalid_banana_in_box/BUILD.bazel",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/e25d35f4cba97595e0bf664a4624d627e031d756/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Ftemplate_checks%2Finvalid_banana_in_box%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/e25d35f4cba97595e0bf664a4624d627e031d756/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Ftemplate_checks%2Finvalid_banana_in_box%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Ftemplate_checks%2Finvalid_banana_in_box%2FBUILD.bazel?ref=e25d35f4cba97595e0bf664a4624d627e031d756",
            "patch": "@@ -0,0 +1,26 @@\n+load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n+\n+ts_library(\n+    name = \"test_lib\",\n+    testonly = True,\n+    srcs = [\"spec.ts\"],\n+    deps = [\n+        \"//packages/compiler\",\n+        \"//packages/compiler-cli/src/ngtsc/diagnostics\",\n+        \"//packages/compiler-cli/src/ngtsc/file_system\",\n+        \"//packages/compiler-cli/src/ngtsc/file_system/testing\",\n+        \"//packages/compiler-cli/src/ngtsc/testing\",\n+        \"//packages/compiler-cli/src/ngtsc/typecheck/extended\",\n+        \"//packages/compiler-cli/src/ngtsc/typecheck/extended/src/template_checks/invalid_banana_in_box\",\n+        \"//packages/compiler-cli/src/ngtsc/typecheck/testing\",\n+        \"@npm//typescript\",\n+    ],\n+)\n+\n+jasmine_node_test(\n+    name = \"test\",\n+    bootstrap = [\"//tools/testing:node_no_angular_es5\"],\n+    deps = [\n+        \":test_lib\",\n+    ],\n+)"
        },
        {
            "sha": "4561fd166a82e722bd7e746e35c48ce8ccbfd91a",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/test/template_checks/invalid_banana_in_box/spec.ts",
            "status": "added",
            "additions": 103,
            "deletions": 0,
            "changes": 103,
            "blob_url": "https://github.com/angular/angular/blob/e25d35f4cba97595e0bf664a4624d627e031d756/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Ftemplate_checks%2Finvalid_banana_in_box%2Fspec.ts",
            "raw_url": "https://github.com/angular/angular/raw/e25d35f4cba97595e0bf664a4624d627e031d756/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Ftemplate_checks%2Finvalid_banana_in_box%2Fspec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Ftest%2Ftemplate_checks%2Finvalid_banana_in_box%2Fspec.ts?ref=e25d35f4cba97595e0bf664a4624d627e031d756",
            "patch": "@@ -0,0 +1,103 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import * as ts from 'typescript';\n+import {ErrorCode} from '../../../../../diagnostics';\n+import {absoluteFrom, getSourceFileOrError} from '../../../../../file_system';\n+import {runInEachFileSystem} from '../../../../../file_system/testing';\n+import {getSourceCodeForDiagnostic} from '../../../../../testing';\n+import {getClass, setup} from '../../../../testing';\n+import {getExtendedTemplateDiagnosticsForComponent} from '../../../src/template_checker';\n+import {InvalidBananaInBoxCheck} from '../../../src/template_checks/invalid_banana_in_box/index';\n+\n+runInEachFileSystem(() => {\n+  describe('TemplateChecks', () => {\n+    it('should produce invalid banana in a box warning', () => {\n+      const fileName = absoluteFrom('/main.ts');\n+      const {program, templateTypeChecker} = setup([{\n+        fileName,\n+        templates: {\n+          'TestCmp': '<div ([input])=\"var1\"> </div>',\n+        },\n+        source: 'export class TestCmp { var1: string = \"text\"; }'\n+      }]);\n+      const sf = getSourceFileOrError(program, fileName);\n+      const component = getClass(sf, 'TestCmp');\n+      const diags = getExtendedTemplateDiagnosticsForComponent(\n+          component, templateTypeChecker, program.getTypeChecker(),\n+          [new InvalidBananaInBoxCheck()]);\n+      expect(diags.length).toBe(1);\n+      expect(diags[0].category).toBe(ts.DiagnosticCategory.Warning);\n+      expect(diags[0].code).toBe(ErrorCode.INVALID_BANANA_IN_BOX);\n+      expect(getSourceCodeForDiagnostic(diags[0])).toBe('([input])=\"var1\"');\n+    });\n+\n+    it('should not produce invalid banana in a box warning if written correctly', () => {\n+      const fileName = absoluteFrom('/main.ts');\n+      const {program, templateTypeChecker} = setup([{\n+        fileName,\n+        templates: {\n+          'TestCmp': '<div [(input)]=\"var1\"> </div>',\n+        },\n+        source: 'export class TestCmp { var1: string = \"text\"; }'\n+      }]);\n+      const sf = getSourceFileOrError(program, fileName);\n+      const component = getClass(sf, 'TestCmp');\n+      const diags = getExtendedTemplateDiagnosticsForComponent(\n+          component, templateTypeChecker, program.getTypeChecker(),\n+          [new InvalidBananaInBoxCheck()]);\n+      expect(diags.length).toBe(0);\n+    });\n+\n+    it('should not produce invalid banana in a box warning with bracket in the middle of the name',\n+       () => {\n+         const fileName = absoluteFrom('/main.ts');\n+         const {program, templateTypeChecker} = setup([{\n+           fileName,\n+           templates: {\n+             'TestCmp': '<div (abc[123]def)=\"var1\"> </div>',\n+           },\n+           source: 'export class TestCmp { var1: string = \"text\"; }'\n+         }]);\n+         const sf = getSourceFileOrError(program, fileName);\n+         const component = getClass(sf, 'TestCmp');\n+         const diags = getExtendedTemplateDiagnosticsForComponent(\n+             component, templateTypeChecker, program.getTypeChecker(),\n+             [new InvalidBananaInBoxCheck()]);\n+         expect(diags.length).toBe(0);\n+       });\n+\n+    it('should produce invalid banana in a box warnings for *ngIf and ng-template', () => {\n+      const fileName = absoluteFrom('/main.ts');\n+      const {program, templateTypeChecker} = setup([{\n+        fileName,\n+        templates: {\n+          'TestCmp': `<div> \n+             <div *ngIf=\"false\" ([foo])=\"var1\"> </div>\n+             <ng-template #elseBlock ([bar])=\"var1\">Content to render when condition is false.</ng-template>\n+           </div>`,\n+        },\n+        source: `export class TestCmp { \n+           var1: string = \"text\";\n+         }`\n+      }]);\n+      const sf = getSourceFileOrError(program, fileName);\n+      const component = getClass(sf, 'TestCmp');\n+      const diags = getExtendedTemplateDiagnosticsForComponent(\n+          component, templateTypeChecker, program.getTypeChecker(),\n+          [new InvalidBananaInBoxCheck()]);\n+      expect(diags.length).toBe(2);\n+      expect(diags[0].category).toBe(ts.DiagnosticCategory.Warning);\n+      expect(diags[0].code).toBe(ErrorCode.INVALID_BANANA_IN_BOX);\n+      expect(getSourceCodeForDiagnostic(diags[0])).toBe('([foo])=\"var1\"');\n+      expect(diags[1].category).toBe(ts.DiagnosticCategory.Warning);\n+      expect(diags[1].code).toBe(ErrorCode.INVALID_BANANA_IN_BOX);\n+      expect(getSourceCodeForDiagnostic(diags[1])).toBe('([bar])=\"var1\"');\n+    });\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 129,
        "additions": 129,
        "deletions": 0
    }
}