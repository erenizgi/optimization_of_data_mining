{
    "author": "alxhub",
    "message": "test(compiler-cli): add a `fake_common` package alongside `fake_core` (#39594)\n\nngtsc's testing infrastructure uses a mock version of @angular/core, which\nallows tests to run without requiring the real version of core to be built.\n\nThis commit adds a mock version of @angular/common as well, as the language\nservice tests are written to test against common.\n\nOnly a handful of directives/pipes from common are currently supported.\n\nPR Close #39594",
    "sha": "c243ff3b6b9b11626c05293e962c18ca10ebe3a2",
    "files": [
        {
            "sha": "a6a4a1bd63fb8ba809b1823ea41a0008a69bd849",
            "filename": "packages/compiler-cli/src/ngtsc/testing/fake_common/BUILD.bazel",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/c243ff3b6b9b11626c05293e962c18ca10ebe3a2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Ffake_common%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/c243ff3b6b9b11626c05293e962c18ca10ebe3a2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Ffake_common%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Ffake_common%2FBUILD.bazel?ref=c243ff3b6b9b11626c05293e962c18ca10ebe3a2",
            "patch": "@@ -0,0 +1,25 @@\n+package(default_visibility = [\"//visibility:public\"])\n+\n+load(\"//tools:defaults.bzl\", \"ng_package\", \"ts_library\")\n+\n+ts_library(\n+    name = \"fake_common\",\n+    srcs = [\n+        \"index.ts\",\n+    ],\n+    module_name = \"@angular/common\",\n+    deps = [\n+        \"//packages/compiler-cli/src/ngtsc/testing/fake_core\",\n+    ],\n+)\n+\n+ng_package(\n+    name = \"npm_package\",\n+    srcs = [\n+        \"package.json\",\n+    ],\n+    entry_point = \":index.ts\",\n+    deps = [\n+        \":fake_common\",\n+    ],\n+)"
        },
        {
            "sha": "f2d0c5f257dea9249194aa71b94c760a66243081",
            "filename": "packages/compiler-cli/src/ngtsc/testing/fake_common/index.ts",
            "status": "added",
            "additions": 72,
            "deletions": 0,
            "changes": 72,
            "blob_url": "https://github.com/angular/angular/blob/c243ff3b6b9b11626c05293e962c18ca10ebe3a2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Ffake_common%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/c243ff3b6b9b11626c05293e962c18ca10ebe3a2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Ffake_common%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Ffake_common%2Findex.ts?ref=c243ff3b6b9b11626c05293e962c18ca10ebe3a2",
            "patch": "@@ -0,0 +1,72 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {NgIterable, TemplateRef, ɵɵDirectiveDefWithMeta, ɵɵNgModuleDefWithMeta, ɵɵPipeDefWithMeta} from '@angular/core';\n+\n+export interface NgForOfContext<T, U extends NgIterable<T>> {\n+  $implicit: T;\n+  ngForOf: U;\n+}\n+\n+export interface TrackByFunction<T> {\n+  (index: number, item: T): any;\n+}\n+\n+export interface NgIfContext<T = unknown> {\n+  $implicit: T;\n+  ngIf: T;\n+}\n+\n+/**\n+ * A fake version of the NgFor directive.\n+ */\n+export declare class NgForOf<T, U extends NgIterable<T>> {\n+  ngForOf: U&NgIterable<T>|null|undefined;\n+  ngForTrackBy: TrackByFunction<T>;\n+  ngForTemplate: TemplateRef<NgForOfContext<T, U>>;\n+\n+  static ɵdir: ɵɵDirectiveDefWithMeta < NgForOf<any, any>, '[ngFor][ngForOf]', never, {\n+    'ngForOf': 'ngForOf';\n+    'ngForTrackBy': 'ngForTrackBy';\n+    'ngForTemplate': 'ngForTemplate';\n+  }\n+  , {}, never > ;\n+  static ngTemplateContextGuard<T, U extends NgIterable<T>>(dir: NgForOf<T, U>, ctx: any):\n+      ctx is NgForOfContext<T, U>;\n+}\n+\n+export declare class NgIf<T = unknown> {\n+  ngIf: T;\n+  ngIfThen: TemplateRef<NgIfContext<T>>|null;\n+  ngIfElse: TemplateRef<NgIfContext<T>>|null;\n+  static ɵdir: ɵɵDirectiveDefWithMeta < NgIf<any>, '[ngIf]', never, {\n+    'ngIf': 'ngIf';\n+    'ngIfThen': 'ngIfThen';\n+    'ngIfElse': 'ngIfElse';\n+  }\n+  , {}, never > ;\n+  static ngTemplateContextGuard<T>(dir: NgIf<T>, ctx: any):\n+      ctx is NgIfContext<Exclude<T, false|0|''|null|undefined>>;\n+}\n+\n+export declare class DatePipe {\n+  transform(value: Date|string|number, format?: string, timezone?: string, locale?: string): string\n+      |null;\n+  transform(value: null|undefined, format?: string, timezone?: string, locale?: string): null;\n+  transform(\n+      value: Date|string|number|null|undefined, format?: string, timezone?: string,\n+      locale?: string): string|null;\n+  static ɵpipe: ɵɵPipeDefWithMeta<DatePipe, 'date'>;\n+}\n+\n+export declare class CommonModule {\n+  static ɵmod:\n+      ɵɵNgModuleDefWithMeta<CommonModule, [typeof NgForOf, typeof NgIf, typeof DatePipe], never, [\n+        typeof NgForOf, typeof NgIf, typeof DatePipe\n+      ]>;\n+}"
        },
        {
            "sha": "18910da93eaecfbccfe239b4ece27e1992714195",
            "filename": "packages/compiler-cli/src/ngtsc/testing/fake_common/package.json",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/c243ff3b6b9b11626c05293e962c18ca10ebe3a2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Ffake_common%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/c243ff3b6b9b11626c05293e962c18ca10ebe3a2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Ffake_common%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Ffake_common%2Fpackage.json?ref=c243ff3b6b9b11626c05293e962c18ca10ebe3a2",
            "patch": "@@ -0,0 +1,5 @@\n+{\n+  \"name\": \"@angular/common\",\n+  \"version\": \"0.0.0-FAKE-FOR-TESTS\",\n+  \"description\": \"Fake version of common for tests\"\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "8915e105c146e3178cc642ecdfa0bde656eade92",
            "filename": "packages/compiler-cli/src/ngtsc/testing/src/mock_file_loading.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 1,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/c243ff3b6b9b11626c05293e962c18ca10ebe3a2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Fsrc%2Fmock_file_loading.ts",
            "raw_url": "https://github.com/angular/angular/raw/c243ff3b6b9b11626c05293e962c18ca10ebe3a2/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Fsrc%2Fmock_file_loading.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftesting%2Fsrc%2Fmock_file_loading.ts?ref=c243ff3b6b9b11626c05293e962c18ca10ebe3a2",
            "patch": "@@ -43,7 +43,8 @@ const angularFolder = new CachedFolder(loadAngularFolder);\n const rxjsFolder = new CachedFolder(() => loadFolder(resolveNpmTreeArtifact('rxjs')));\n \n export function loadStandardTestFiles(\n-    {fakeCore = true, rxjs = false}: {fakeCore?: boolean, rxjs?: boolean} = {}): Folder {\n+    {fakeCore = true, fakeCommon = false, rxjs = false}:\n+        {fakeCore?: boolean, fakeCommon?: boolean, rxjs?: boolean} = {}): Folder {\n   const tmpFs = new MockFileSystemPosix(true);\n   const basePath = '/' as AbsoluteFsPath;\n \n@@ -57,6 +58,10 @@ export function loadStandardTestFiles(\n     tmpFs.mount(tmpFs.resolve('/node_modules/@angular'), angularFolder.get());\n   }\n \n+  if (fakeCommon) {\n+    loadFakeCommon(tmpFs, basePath);\n+  }\n+\n   if (rxjs) {\n     tmpFs.mount(tmpFs.resolve('/node_modules/rxjs'), rxjsFolder.get());\n   }\n@@ -77,6 +82,15 @@ export function loadFakeCore(fs: FileSystem, basePath: string = '/') {\n       fs.resolve(basePath, 'node_modules/@angular/core'));\n }\n \n+export function loadFakeCommon(fs: FileSystem, basePath: string = '/') {\n+  loadTestDirectory(\n+      fs,\n+      resolveNpmTreeArtifact(\n+          'angular/packages/compiler-cli/src/ngtsc/testing/fake_common/npm_package'),\n+      fs.resolve(basePath, 'node_modules/@angular/common'));\n+}\n+\n+\n function loadFolder(path: string): Folder {\n   const tmpFs = new MockFileSystemPosix(true);\n   // Note that we intentionally pass the native `path`, without resolving it through the file"
        }
    ],
    "stats": {
        "total": 118,
        "additions": 117,
        "deletions": 1
    }
}