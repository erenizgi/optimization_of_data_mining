{
    "author": "josephperrott",
    "message": "feat(dev-infra): prompt caretaker to confirm the merge branches on merge (#39333)\n\nPerviously, it was not immediately clear what branches a PR would merge\ninto during the merge process.  This prompt allows for caretakers to\nunderstand and acknowledge where the PR will merge to.\n\nPR Close #39333",
    "sha": "767fdccf593bf2aaa77e2bc2e409c175f0873fd4",
    "files": [
        {
            "sha": "34a34ce3db5b25e352f9fd9bfd71221c45734df6",
            "filename": "dev-infra/pr/merge/messages.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/767fdccf593bf2aaa77e2bc2e409c175f0873fd4/dev-infra%2Fpr%2Fmerge%2Fmessages.ts",
            "raw_url": "https://github.com/angular/angular/raw/767fdccf593bf2aaa77e2bc2e409c175f0873fd4/dev-infra%2Fpr%2Fmerge%2Fmessages.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Fmessages.ts?ref=767fdccf593bf2aaa77e2bc2e409c175f0873fd4",
            "patch": "@@ -11,5 +11,11 @@ import {PullRequest} from './pull-request';\n \n export function getCaretakerNotePromptMessage(pullRequest: PullRequest): string {\n   return red('Pull request has a caretaker note applied. Please make sure you read it.') +\n-      `\\nQuick link to PR: ${pullRequest.url}`;\n+      `\\nQuick link to PR: ${pullRequest.url}\\nDo you want to proceed merging?`;\n+}\n+\n+export function getTargettedBranchesConfirmationPromptMessage(pullRequest: PullRequest): string {\n+  const targetBranchListAsString = pullRequest.targetBranches.map(b => ` - ${b}\\n`).join('');\n+  return `Pull request #${pullRequest.prNumber} will merge into:\\n${\n+      targetBranchListAsString}\\nDo you want to proceed merging?`;\n }"
        },
        {
            "sha": "42ca89898fbb46b032f9246a721668c95a3aa0ad",
            "filename": "dev-infra/pr/merge/task.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/767fdccf593bf2aaa77e2bc2e409c175f0873fd4/dev-infra%2Fpr%2Fmerge%2Ftask.ts",
            "raw_url": "https://github.com/angular/angular/raw/767fdccf593bf2aaa77e2bc2e409c175f0873fd4/dev-infra%2Fpr%2Fmerge%2Ftask.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fmerge%2Ftask.ts?ref=767fdccf593bf2aaa77e2bc2e409c175f0873fd4",
            "patch": "@@ -9,9 +9,9 @@\n import {promptConfirm} from '../../utils/console';\n import {GitClient, GitCommandError} from '../../utils/git';\n \n-import {MergeConfig, MergeConfigWithRemote} from './config';\n+import {MergeConfigWithRemote} from './config';\n import {PullRequestFailure} from './failures';\n-import {getCaretakerNotePromptMessage} from './messages';\n+import {getCaretakerNotePromptMessage, getTargettedBranchesConfirmationPromptMessage} from './messages';\n import {isPullRequest, loadAndValidatePullRequest,} from './pull-request';\n import {GithubApiMergeStrategy} from './strategies/api-merge';\n import {AutosquashMergeStrategy} from './strategies/autosquash-merge';\n@@ -78,11 +78,16 @@ export class PullRequestMergeTask {\n       return {status: MergeStatus.FAILED, failure: pullRequest};\n     }\n \n+\n+    if (!await promptConfirm(getTargettedBranchesConfirmationPromptMessage(pullRequest))) {\n+      return {status: MergeStatus.USER_ABORTED};\n+    }\n+\n+\n     // If the pull request has a caretaker note applied, raise awareness by prompting\n     // the caretaker. The caretaker can then decide to proceed or abort the merge.\n     if (pullRequest.hasCaretakerNote &&\n-        !await promptConfirm(\n-            getCaretakerNotePromptMessage(pullRequest) + `\\nDo you want to proceed merging?`)) {\n+        !await promptConfirm(getCaretakerNotePromptMessage(pullRequest))) {\n       return {status: MergeStatus.USER_ABORTED};\n     }\n "
        }
    ],
    "stats": {
        "total": 21,
        "additions": 16,
        "deletions": 5
    }
}