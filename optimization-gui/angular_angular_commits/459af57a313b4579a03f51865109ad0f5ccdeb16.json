{
    "author": "atscott",
    "message": "refactor(compiler-cli): Adjust generated TCB when checkTypeOfPipes is false (#40523)\n\nWhen `checkTypeOfPipes` is set to `false`, our TCB currently generates\nthe a statement like the following when pipes appear in the template:\n`(_pipe1 as any).transform(args)`\n\nThis did enable us to get _some_ information from the Language Service\nabout pipes in this case because we still had access to the pipe\ninstance. However, because it is immediately cast to `any`, we cannot\nget type information about the transform access. That means actions like \"go to\ndefinition\", \"find references\", \"quick info\", etc. will return\nincomplete information or fail altogether.\n\nInstead, this commit changes the TCB to generate `(_pipe1.transform as any)(args)`.\nThis gives us the ability to get complete information for the LS\noperations listed above.\n\nPR Close #40523",
    "sha": "459af57a313b4579a03f51865109ad0f5ccdeb16",
    "files": [
        {
            "sha": "904970050205de5a18b4e48115926cc427e01725",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/template_symbol_builder.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 10,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftemplate_symbol_builder.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftemplate_symbol_builder.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftemplate_symbol_builder.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -430,19 +430,14 @@ export class SymbolBuilder {\n   }\n \n   private getSymbolOfPipe(expression: BindingPipe): PipeSymbol|null {\n-    const node = findFirstMatchingNode(\n-        this.typeCheckBlock, {withSpan: expression.sourceSpan, filter: ts.isCallExpression});\n-    if (node === null || !ts.isPropertyAccessExpression(node.expression)) {\n+    const methodAccess = findFirstMatchingNode(\n+        this.typeCheckBlock,\n+        {withSpan: expression.nameSpan, filter: ts.isPropertyAccessExpression});\n+    if (methodAccess === null) {\n       return null;\n     }\n \n-    const methodAccess = node.expression;\n-    // Find the node for the pipe variable from the transform property access. This will be one of\n-    // two forms: `_pipe1.transform` or `(_pipe1 as any).transform`.\n-    const pipeVariableNode = ts.isParenthesizedExpression(methodAccess.expression) &&\n-            ts.isAsExpression(methodAccess.expression.expression) ?\n-        methodAccess.expression.expression.expression :\n-        methodAccess.expression;\n+    const pipeVariableNode = methodAccess.expression;\n     const pipeDeclaration = this.getTypeChecker().getSymbolAtLocation(pipeVariableNode);\n     if (pipeDeclaration === undefined || pipeDeclaration.valueDeclaration === undefined) {\n       return null;"
        },
        {
            "sha": "47ad813ae3fcd33d251b70413cb1b79d47759098",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/type_check_block.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -1712,17 +1712,19 @@ class TcbExpressionTranslator {\n \n         // Use an 'any' value to at least allow the rest of the expression to be checked.\n         pipe = NULL_AS_ANY;\n-      } else if (this.tcb.env.config.checkTypeOfPipes) {\n+      } else {\n         // Use a variable declared as the pipe's type.\n         pipe = this.tcb.env.pipeInst(pipeRef);\n-      } else {\n-        // Use an 'any' value when not checking the type of the pipe.\n-        pipe = ts.createAsExpression(\n-            this.tcb.env.pipeInst(pipeRef), ts.createKeywordTypeNode(ts.SyntaxKind.AnyKeyword));\n       }\n       const args = ast.args.map(arg => this.translate(arg));\n-      const methodAccess = ts.createPropertyAccess(pipe, 'transform');\n+      let methodAccess: ts.Expression =\n+          ts.factory.createPropertyAccessExpression(pipe, 'transform');\n       addParseSpanInfo(methodAccess, ast.nameSpan);\n+      if (!this.tcb.env.config.checkTypeOfPipes) {\n+        methodAccess = ts.factory.createAsExpression(\n+            methodAccess, ts.factory.createKeywordTypeNode(ts.SyntaxKind.AnyKeyword));\n+      }\n+\n       const result = ts.createCall(\n           /* expression */ methodAccess,\n           /* typeArguments */ undefined,"
        },
        {
            "sha": "ce6ba8fd1beeac7e717583c28b9f07b8e9d04505",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/type_check_block_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_check_block_spec.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -992,7 +992,7 @@ describe('type check blocks', () => {\n         const DISABLED_CONFIG: TypeCheckingConfig = {...BASE_CONFIG, checkTypeOfPipes: false};\n         const block = tcb(TEMPLATE, PIPES, DISABLED_CONFIG);\n         expect(block).toContain('var _pipe1: i0.TestPipe = null!;');\n-        expect(block).toContain('((_pipe1 as any).transform(((ctx).a), ((ctx).b), ((ctx).c)));');\n+        expect(block).toContain('((_pipe1.transform as any)(((ctx).a), ((ctx).b), ((ctx).c))');\n       });\n     });\n "
        },
        {
            "sha": "9fec2bbda4f453d390118c9bcd31c9143ae815d4",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/type_checker__get_symbol_of_template_node_spec.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 23,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_checker__get_symbol_of_template_node_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_checker__get_symbol_of_template_node_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Ftype_checker__get_symbol_of_template_node_spec.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -722,29 +722,19 @@ runInEachFileSystem(() => {\n               BindingPipe;\n         }\n \n-        it('should get symbol for pipe', () => {\n-          setupPipesTest();\n-          const pipeSymbol = templateTypeChecker.getSymbolOfNode(binding, cmp)!;\n-          assertPipeSymbol(pipeSymbol);\n-          expect(program.getTypeChecker().symbolToString(pipeSymbol.tsSymbol!))\n-              .toEqual('transform');\n-          expect(program.getTypeChecker().symbolToString(pipeSymbol.classSymbol.tsSymbol))\n-              .toEqual('TestPipe');\n-          expect(program.getTypeChecker().typeToString(pipeSymbol.tsType!))\n-              .toEqual('(value: string, repeat: number, commaSeparate: boolean) => string[]');\n-        });\n-\n-        it('should get symbol for pipe, checkTypeOfPipes: false', () => {\n-          setupPipesTest(false);\n-          const pipeSymbol = templateTypeChecker.getSymbolOfNode(binding, cmp)! as PipeSymbol;\n-          assertPipeSymbol(pipeSymbol);\n-          expect(pipeSymbol.tsSymbol).toBeNull();\n-          expect(program.getTypeChecker().typeToString(pipeSymbol.tsType!)).toEqual('any');\n-          expect(program.getTypeChecker().symbolToString(pipeSymbol.classSymbol.tsSymbol))\n-              .toEqual('TestPipe');\n-          expect(program.getTypeChecker().typeToString(pipeSymbol.classSymbol.tsType))\n-              .toEqual('TestPipe');\n-        });\n+        for (const checkTypeOfPipes of [true, false]) {\n+          it(`should get symbol for pipe, checkTypeOfPipes: ${checkTypeOfPipes}`, () => {\n+            setupPipesTest(checkTypeOfPipes);\n+            const pipeSymbol = templateTypeChecker.getSymbolOfNode(binding, cmp)!;\n+            assertPipeSymbol(pipeSymbol);\n+            expect(program.getTypeChecker().symbolToString(pipeSymbol.tsSymbol!))\n+                .toEqual('transform');\n+            expect(program.getTypeChecker().symbolToString(pipeSymbol.classSymbol.tsSymbol))\n+                .toEqual('TestPipe');\n+            expect(program.getTypeChecker().typeToString(pipeSymbol.tsType!))\n+                .toEqual('(value: string, repeat: number, commaSeparate: boolean) => string[]');\n+          });\n+        }\n \n         it('should get symbols for pipe expression and args', () => {\n           setupPipesTest(false);"
        },
        {
            "sha": "7c28109ba7bf32736aabb86f8f3e688a216dc93d",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/GOLDEN_PARTIAL.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2FGOLDEN_PARTIAL.js",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2FGOLDEN_PARTIAL.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2FGOLDEN_PARTIAL.js?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -71,6 +71,7 @@ i0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDE\n                 }]\n         }] });\n class MyForwardPipe {\n+    transform() { }\n }\n MyForwardPipe.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyForwardPipe, deps: [], target: i0.ɵɵFactoryTarget.Pipe });\n MyForwardPipe.ɵpipe = i0.ɵɵngDeclarePipe({ minVersion: \"12.0.0\", version: \"0.0.0-PLACEHOLDER\", ngImport: i0, type: MyForwardPipe, name: \"my_forward_pipe\" });"
        },
        {
            "sha": "c127944498eab18849df0ee85c5ef6641682853a",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/forward_referenced_pipe.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fforward_referenced_pipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fforward_referenced_pipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fforward_referenced_pipe.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -11,6 +11,7 @@ export class HostBindingComp {\n \n @Pipe({name: 'my_forward_pipe'})\n class MyForwardPipe {\n+  transform() {}\n }\n \n @NgModule({declarations: [HostBindingComp, MyForwardPipe]})"
        },
        {
            "sha": "42db9c4c66c17f4fa16f300ab7ae8765475f61c0",
            "filename": "packages/compiler-cli/test/ngtsc/incremental_semantic_changes_spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fincremental_semantic_changes_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fincremental_semantic_changes_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fincremental_semantic_changes_spec.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -1361,7 +1361,9 @@ runInEachFileSystem(() => {\n           @Pipe({\n             name: 'dep',\n           })\n-          export class DepB {}\n+          export class DepB {\n+            transform() {}\n+          }\n         `);\n         env.write('module.ts', `\n           import {NgModule} from '@angular/core';\n@@ -1385,7 +1387,9 @@ runInEachFileSystem(() => {\n           @Pipe({\n             name: 'dep',\n           })\n-          export class DepA {}\n+          export class DepA {\n+            transform() {}\n+          }\n \n           @Directive({\n             selector: 'dep',"
        },
        {
            "sha": "75780f19a88335acc7707ff5ea60968e16c7d78c",
            "filename": "packages/compiler-cli/test/ngtsc/incremental_spec.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 4,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fincremental_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fincremental_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fincremental_spec.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -200,7 +200,9 @@ runInEachFileSystem(() => {\n         import {Pipe} from '@angular/core';\n \n         @Pipe({name: 'myPipe'})\n-        export class MyPipe {}\n+        export class MyPipe {\n+          transform() {}\n+        }\n       `);\n       env.write('module.ts', `\n         import {NgModule, NO_ERRORS_SCHEMA} from '@angular/core';\n@@ -238,7 +240,9 @@ runInEachFileSystem(() => {\n         import {Pipe} from '@angular/core';\n \n         @Pipe({name: 'foo_changed'})\n-        export class FooPipe {}\n+        export class FooPipe {\n+          transform() {}\n+        }\n       `);\n       env.driveMain();\n       const written = env.getFilesWrittenSinceLastFlush();\n@@ -910,7 +914,9 @@ runInEachFileSystem(() => {\n     import {Pipe} from '@angular/core';\n \n     @Pipe({name: 'foo'})\n-    export class FooPipe {}\n+    export class FooPipe {\n+      transform() {}\n+    }\n   `);\n     env.write('foo_module.ts', `\n     import {NgModule} from '@angular/core';\n@@ -940,7 +946,9 @@ runInEachFileSystem(() => {\n     import {Pipe} from '@angular/core';\n \n     @Pipe({name: 'foo'})\n-    export class BarPipe {}\n+    export class BarPipe {\n+      transform() {}\n+    }\n   `);\n     env.write('bar_module.ts', `\n     import {NgModule} from '@angular/core';"
        },
        {
            "sha": "ea26ae2de416d524418a3a28fa297987a4380a6c",
            "filename": "packages/compiler-cli/test/ngtsc/ngtsc_spec.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 5,
            "changes": 20,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fngtsc_spec.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -757,7 +757,9 @@ function allTests(os: string) {\n         // ModuleA classes\n \n         @Pipe({name: 'number'})\n-        class PipeA {}\n+        class PipeA {\n+          transform() {}\n+        }\n \n         @NgModule({\n           declarations: [PipeA],\n@@ -768,7 +770,9 @@ function allTests(os: string) {\n         // ModuleB classes\n \n         @Pipe({name: 'number'})\n-        class PipeB {}\n+        class PipeB {\n+          transform() {}\n+        }\n \n         @Component({\n           selector: 'app',\n@@ -800,7 +804,9 @@ function allTests(os: string) {\n             // ModuleA classes\n \n             @Pipe({name: 'number'})\n-            class PipeA {}\n+            class PipeA {\n+              transform() {}\n+            }\n \n             @NgModule({\n               declarations: [PipeA],\n@@ -811,7 +817,9 @@ function allTests(os: string) {\n             // ModuleB classes\n \n             @Pipe({name: 'number'})\n-            class PipeB {}\n+            class PipeB {\n+              transform() {}\n+            }\n \n             @NgModule({\n               declarations: [PipeB],\n@@ -1647,7 +1655,9 @@ function allTests(os: string) {\n         import {Component, NgModule, Pipe} from '@angular/core';\n \n         @Pipe({name: 'test'})\n-        export class TestPipe {}\n+        export class TestPipe {\n+          transform() {}\n+        }\n \n         @Component({selector: 'test-cmp', template: '{{value | test}}'})\n         export class TestCmp {"
        },
        {
            "sha": "b1ed3ef3fdc2c46a5d4a8404a6572e294c65f7a6",
            "filename": "packages/language-service/ivy/test/definitions_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Flanguage-service%2Fivy%2Ftest%2Fdefinitions_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Flanguage-service%2Fivy%2Ftest%2Fdefinitions_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fdefinitions_spec.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -8,7 +8,7 @@\n \n import {initMockFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n \n-import {assertFileNames, createModuleAndProjectWithDeclarations, humanizeDocumentSpanLike, LanguageServiceTestEnv, OpenBuffer} from '../testing';\n+import {assertFileNames, assertTextSpans, createModuleAndProjectWithDeclarations, humanizeDocumentSpanLike, LanguageServiceTestEnv, OpenBuffer} from '../testing';\n \n describe('definitions', () => {\n   it('gets definition for template reference in overridden template', () => {\n@@ -35,7 +35,7 @@ describe('definitions', () => {\n     assertFileNames(Array.from(definitions!), ['app.html']);\n   });\n \n-  it('returns the pipe class as definition when checkTypeOfPipes is false', () => {\n+  it('returns the pipe definitions when checkTypeOfPipes is false', () => {\n     initMockFileSystem('Native');\n     const files = {\n       'app.ts': `\n@@ -57,10 +57,9 @@ describe('definitions', () => {\n \n     const {textSpan, definitions} = getDefinitionsAndAssertBoundSpan(env, template);\n     expect(template.contents.substr(textSpan.start, textSpan.length)).toEqual('date');\n-    expect(definitions!.length).toEqual(1);\n-    const [def] = definitions!;\n-    expect(def.textSpan).toContain('DatePipe');\n-    expect(def.contextSpan).toContain('DatePipe');\n+    expect(definitions.length).toEqual(3);\n+    assertTextSpans(definitions, ['transform']);\n+    assertFileNames(definitions, ['index.d.ts']);\n   });\n \n   it('gets definitions for all inputs when attribute matches more than one', () => {"
        },
        {
            "sha": "c8a1f0b9a76ecc3b512309782d4d5b36579072cc",
            "filename": "packages/language-service/ivy/test/quick_info_spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Flanguage-service%2Fivy%2Ftest%2Fquick_info_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Flanguage-service%2Fivy%2Ftest%2Fquick_info_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fquick_info_spec.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -559,8 +559,13 @@ describe('quick info', () => {\n       // checkTypeOfPipes is set to false when strict templates is false\n       project = env.addProject('test', quickInfoSkeleton(), {strictTemplates: false});\n       const templateOverride = `<p>The hero's birthday is {{birthday | da¦te: \"MM/dd/yy\"}}</p>`;\n-      expectQuickInfo(\n-          {templateOverride, expectedSpanText: 'date', expectedDisplayString: '(pipe) DatePipe'});\n+      expectQuickInfo({\n+        templateOverride,\n+        expectedSpanText: 'date',\n+        expectedDisplayString:\n+            '(pipe) DatePipe.transform(value: string | number | Date, format?: string | undefined, timezone?: ' +\n+            'string | undefined, locale?: string | undefined): string | null (+2 overloads)'\n+      });\n     });\n \n     it('should still get quick info if there is an invalid css resource', () => {"
        },
        {
            "sha": "c12b9142cdd73025eda3f9dd714535b9bae1da2b",
            "filename": "packages/language-service/ivy/test/references_and_rename_spec.ts",
            "status": "modified",
            "additions": 31,
            "deletions": 29,
            "changes": 60,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Flanguage-service%2Fivy%2Ftest%2Freferences_and_rename_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Flanguage-service%2Fivy%2Ftest%2Freferences_and_rename_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Freferences_and_rename_spec.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -754,47 +754,49 @@ describe('find references and rename locations', () => {\n           }\n         }`;\n \n-    describe('when cursor is on pipe name', () => {\n-      let file: OpenBuffer;\n-      beforeEach(() => {\n-        const files = {\n-          'app.ts': `\n+    for (const checkTypeOfPipes of [true, false]) {\n+      describe(`when cursor is on pipe name, checkTypeOfPipes: ${checkTypeOfPipes}`, () => {\n+        let file: OpenBuffer;\n+        beforeEach(() => {\n+          const files = {\n+            'app.ts': `\n         import {Component} from '@angular/core';\n \n         @Component({template: '{{birthday | prefixPipe: \"MM/dd/yy\"}}'})\n         export class AppCmp {\n           birthday = '';\n         }\n       `,\n-          'prefix-pipe.ts': prefixPipe\n-        };\n+            'prefix-pipe.ts': prefixPipe\n+          };\n \n-        env = LanguageServiceTestEnv.setup();\n-        const project = createModuleAndProjectWithDeclarations(env, 'test', files);\n-        file = project.openFile('app.ts');\n-        file.moveCursorToText('prefi¦xPipe:');\n-      });\n+          env = LanguageServiceTestEnv.setup();\n+          const project = createModuleAndProjectWithDeclarations(env, 'test', files);\n+          file = project.openFile('app.ts');\n+          file.moveCursorToText('prefi¦xPipe:');\n+        });\n \n-      it('should find references', () => {\n-        const refs = getReferencesAtPosition(file)!;\n-        expect(refs.length).toBe(5);\n-        assertFileNames(refs, ['index.d.ts', 'prefix-pipe.ts', 'app.ts']);\n-        assertTextSpans(refs, ['transform', 'prefixPipe']);\n-      });\n+        it('should find references', () => {\n+          const refs = getReferencesAtPosition(file)!;\n+          expect(refs.length).toBe(5);\n+          assertFileNames(refs, ['index.d.ts', 'prefix-pipe.ts', 'app.ts']);\n+          assertTextSpans(refs, ['transform', 'prefixPipe']);\n+        });\n \n-      it('should find rename locations', () => {\n-        const renameLocations = getRenameLocationsAtPosition(file)!;\n-        expect(renameLocations.length).toBe(2);\n-        assertFileNames(renameLocations, ['prefix-pipe.ts', 'app.ts']);\n-        assertTextSpans(renameLocations, ['prefixPipe']);\n-      });\n+        it('should find rename locations', () => {\n+          const renameLocations = getRenameLocationsAtPosition(file)!;\n+          expect(renameLocations.length).toBe(2);\n+          assertFileNames(renameLocations, ['prefix-pipe.ts', 'app.ts']);\n+          assertTextSpans(renameLocations, ['prefixPipe']);\n+        });\n \n-      it('should get rename info', () => {\n-        const result = file.getRenameInfo() as ts.RenameInfoSuccess;\n-        expect(result.canRename).toEqual(true);\n-        expect(result.displayName).toEqual('prefixPipe');\n+        it('should get rename info', () => {\n+          const result = file.getRenameInfo() as ts.RenameInfoSuccess;\n+          expect(result.canRename).toEqual(true);\n+          expect(result.displayName).toEqual('prefixPipe');\n+        });\n       });\n-    });\n+    }\n \n     describe('when cursor is on pipe name expression', () => {\n       it('finds rename locations and rename info', () => {"
        },
        {
            "sha": "6922a944970da0850a8a90d020307b246ec65bd1",
            "filename": "packages/language-service/ivy/test/ts_utils_spec.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Flanguage-service%2Fivy%2Ftest%2Fts_utils_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Flanguage-service%2Fivy%2Ftest%2Fts_utils_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fts_utils_spec.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -1,3 +1,11 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n import {initMockFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n import * as ts from 'typescript';\n import {LanguageServiceTestEnv, OpenBuffer, Project} from '../testing';\n@@ -7,7 +15,7 @@ describe('ts utils', () => {\n   describe('collectMemberMethods', () => {\n     beforeEach(() => {\n       initMockFileSystem('Native');\n-    })\n+    });\n \n     it('gets only methods in class, not getters, setters, or properties', () => {\n       const files = {\n@@ -69,7 +77,7 @@ describe('ts utils', () => {\n     function getMemberMethodNames(project: Project, file: OpenBuffer): string[] {\n       const sf = project.getSourceFile('app.ts')!;\n       const node = findTightestNode(sf, file.cursor)!;\n-      expect(ts.isClassDeclaration(node.parent)).toBe(true)\n+      expect(ts.isClassDeclaration(node.parent)).toBe(true);\n       return collectMemberMethods(node.parent as ts.ClassDeclaration, project.getTypeChecker())\n           .map(m => m.name.getText())\n           .sort();"
        },
        {
            "sha": "a20c0d30d20dd7c31db51d5821ed3e83febe5fba",
            "filename": "packages/language-service/ivy/test/type_definitions_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Flanguage-service%2Fivy%2Ftest%2Ftype_definitions_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/459af57a313b4579a03f51865109ad0f5ccdeb16/packages%2Flanguage-service%2Fivy%2Ftest%2Ftype_definitions_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Ftype_definitions_spec.ts?ref=459af57a313b4579a03f51865109ad0f5ccdeb16",
            "patch": "@@ -8,7 +8,7 @@\n \n import {initMockFileSystem} from '@angular/compiler-cli/src/ngtsc/file_system/testing';\n \n-import {humanizeDocumentSpanLike, LanguageServiceTestEnv, Project} from '../testing';\n+import {assertFileNames, assertTextSpans, humanizeDocumentSpanLike, LanguageServiceTestEnv, Project} from '../testing';\n \n describe('type definitions', () => {\n   let env: LanguageServiceTestEnv;\n@@ -33,11 +33,10 @@ describe('type definitions', () => {\n     const project = env.addProject('test', files, {strictTemplates: false});\n     const definitions =\n         getTypeDefinitionsAndAssertBoundSpan(project, {templateOverride: '{{\"1/1/2020\" | dat¦e}}'});\n-    expect(definitions!.length).toEqual(1);\n+    expect(definitions!.length).toEqual(3);\n \n-    const [def] = definitions;\n-    expect(def.textSpan).toContain('DatePipe');\n-    expect(def.contextSpan).toContain('DatePipe');\n+    assertTextSpans(definitions, ['transform']);\n+    assertFileNames(definitions, ['index.d.ts']);\n   });\n \n   function getTypeDefinitionsAndAssertBoundSpan("
        }
    ],
    "stats": {
        "total": 214,
        "additions": 119,
        "deletions": 95
    }
}