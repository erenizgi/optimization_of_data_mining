{
    "author": "dgp1130",
    "message": "refactor(compiler-cli): add `defaultCategory` option (#44391)\n\nRefs #42966.\n\nThe `defaultCategory` option is used for any extended template diagnostics which do not have any specific category specified for them. It defaults to `warning`, since that is the most common behavior expected for users. This provides an easy way for users to promote all diagnostics to errors or suppress all diagnostics.\n\nPR Close #44391",
    "sha": "9e5ac51f69aefd8d268e186e2844b72263791d29",
    "files": [
        {
            "sha": "89f773eff89c29e484ddb9e6b03f6627d4ae8621",
            "filename": "goldens/public-api/compiler-cli/compiler_options.md",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/9e5ac51f69aefd8d268e186e2844b72263791d29/goldens%2Fpublic-api%2Fcompiler-cli%2Fcompiler_options.md",
            "raw_url": "https://github.com/angular/angular/raw/9e5ac51f69aefd8d268e186e2844b72263791d29/goldens%2Fpublic-api%2Fcompiler-cli%2Fcompiler_options.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fcompiler-cli%2Fcompiler_options.md?ref=9e5ac51f69aefd8d268e186e2844b72263791d29",
            "patch": "@@ -20,6 +20,7 @@ export enum DiagnosticCategoryLabel {\n // @public\n export interface DiagnosticOptions {\n     extendedDiagnostics?: {\n+        defaultCategory?: DiagnosticCategoryLabel;\n         checks?: {\n             [Name in ExtendedTemplateDiagnosticName]?: DiagnosticCategoryLabel;\n         };"
        },
        {
            "sha": "2075990831cf97fff8aefa4e7b631405d124aa7d",
            "filename": "packages/compiler-cli/src/ngtsc/core/api/src/public_options.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/9e5ac51f69aefd8d268e186e2844b72263791d29/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fapi%2Fsrc%2Fpublic_options.ts",
            "raw_url": "https://github.com/angular/angular/raw/9e5ac51f69aefd8d268e186e2844b72263791d29/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fapi%2Fsrc%2Fpublic_options.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fapi%2Fsrc%2Fpublic_options.ts?ref=9e5ac51f69aefd8d268e186e2844b72263791d29",
            "patch": "@@ -285,6 +285,12 @@ export enum DiagnosticCategoryLabel {\n export interface DiagnosticOptions {\n   /** Options which control how diagnostics are emitted from the compiler. */\n   extendedDiagnostics?: {\n+    /**\n+     * The category to use for configurable diagnostics which are not overridden by `checks`. Uses\n+     * `warning` by default.\n+     */\n+    defaultCategory?: DiagnosticCategoryLabel;\n+\n     /**\n      * A map of each extended template diagnostic's name to its category. This can be expanded in\n      * the future with more information for each check or for additional diagnostics not part of the"
        },
        {
            "sha": "281586da9c70fb471a4fbf1a12b9887e199a7140",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/extended/src/extended_template_checker.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/9e5ac51f69aefd8d268e186e2844b72263791d29/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Fextended_template_checker.ts",
            "raw_url": "https://github.com/angular/angular/raw/9e5ac51f69aefd8d268e186e2844b72263791d29/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Fextended_template_checker.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fextended%2Fsrc%2Fextended_template_checker.ts?ref=9e5ac51f69aefd8d268e186e2844b72263791d29",
            "patch": "@@ -29,7 +29,8 @@ export class ExtendedTemplateCheckerImpl implements ExtendedTemplateChecker {\n     for (const factory of templateCheckFactories) {\n       // Read the diagnostic category from compiler options.\n       const category = diagnosticLabelToCategory(\n-          options?.extendedDiagnostics?.checks?.[factory.name] ?? DiagnosticCategoryLabel.Warning);\n+          options?.extendedDiagnostics?.checks?.[factory.name] ??\n+          options?.extendedDiagnostics?.defaultCategory ?? DiagnosticCategoryLabel.Warning);\n \n       // Skip the diagnostic if suppressed via compiler options.\n       if (category === null) {"
        },
        {
            "sha": "8f76b915a57d93fd018f574df7ddd891b5d59f00",
            "filename": "packages/compiler-cli/test/ngtsc/extended_template_diagnostics_spec.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/9e5ac51f69aefd8d268e186e2844b72263791d29/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/9e5ac51f69aefd8d268e186e2844b72263791d29/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fextended_template_diagnostics_spec.ts?ref=9e5ac51f69aefd8d268e186e2844b72263791d29",
            "patch": "@@ -156,6 +156,25 @@ runInEachFileSystem(() => {\n         }));\n       });\n \n+      it('by emitting diagnostics with the default category', () => {\n+        env.tsconfig({\n+          strictTemplates: true,\n+          _extendedTemplateDiagnostics: true,\n+          extendedDiagnostics: {\n+            defaultCategory: 'error',\n+          },\n+        });\n+\n+        env.write('test.ts', warningComponent);\n+\n+        const diagnostics = env.driveDiagnostics(1 /* expectedExitCode */);\n+        expect(diagnostics.length).toBe(1);\n+        expect(diagnostics[0]).toEqual(jasmine.objectContaining({\n+          code: ngErrorCode(ErrorCode.INVALID_BANANA_IN_BOX),\n+          category: ts.DiagnosticCategory.Error,\n+        }));\n+      });\n+\n       it('by emitting diagnostics configured as `warning`', () => {\n         env.tsconfig({\n           strictTemplates: true,"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 28,
        "deletions": 1
    }
}