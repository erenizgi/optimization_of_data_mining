{
    "author": "AleksanderBodurri",
    "message": "refactor(devtools): use ResizeObserver for directive forest to handle reorienting split pane and toggling breadcrumb buttons",
    "sha": "fb4c8da4fc5db7ac9f2a074588f5786fb241469a",
    "files": [
        {
            "sha": "9124d16f1587bf655343c001758ca24d4ab1db34",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/devtools-tabs.component.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/fb4c8da4fc5db7ac9f2a074588f5786fb241469a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdevtools-tabs.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/fb4c8da4fc5db7ac9f2a074588f5786fb241469a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdevtools-tabs.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdevtools-tabs.component.ts?ref=fb4c8da4fc5db7ac9f2a074588f5786fb241469a",
            "patch": "@@ -1,3 +1,4 @@\n+/// <reference types=\"resize-observer-browser\" />\n import { AfterViewInit, Component, Input, OnDestroy, OnInit, ViewChild } from '@angular/core';\n import { Events, MessageBus } from 'protocol';\n import { DirectiveExplorerComponent } from './directive-explorer/directive-explorer.component';"
        },
        {
            "sha": "1457e7611f8c20736659e157f5f7a8c3aaa97eea",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/breadcrumbs/breadcrumbs.component.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/fb4c8da4fc5db7ac9f2a074588f5786fb241469a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fbreadcrumbs%2Fbreadcrumbs.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/fb4c8da4fc5db7ac9f2a074588f5786fb241469a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fbreadcrumbs%2Fbreadcrumbs.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fbreadcrumbs%2Fbreadcrumbs.component.ts?ref=fb4c8da4fc5db7ac9f2a074588f5786fb241469a",
            "patch": "@@ -33,7 +33,7 @@ export class BreadcrumbsComponent implements OnInit, AfterViewInit, OnChanges {\n   updateScrollButtonVisibility$ = new Subject<void>();\n \n   ngOnInit(): void {\n-    this.updateScrollButtonVisibility$.pipe(debounceTime(100)).subscribe(() => this._updateScrollButtonVisibility());\n+    this.updateScrollButtonVisibility$.pipe(debounceTime(100)).subscribe(() => this.updateScrollButtonVisibility());\n   }\n \n   ngAfterViewInit(): void {\n@@ -54,7 +54,7 @@ export class BreadcrumbsComponent implements OnInit, AfterViewInit, OnChanges {\n     this.updateScrollButtonVisibility$.next();\n   }\n \n-  private _updateScrollButtonVisibility(): void {\n+  updateScrollButtonVisibility(): void {\n     const { clientWidth, scrollWidth, scrollLeft } = this.breadcrumbsScrollContent.nativeElement;\n     this.showScrollLeftButton = scrollLeft > 0;\n     this.showScrollRightButton = scrollLeft + clientWidth < scrollWidth;"
        },
        {
            "sha": "9dd39a9148092994fa72383405d49787f96a2e59",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-explorer.component.html",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/fb4c8da4fc5db7ac9f2a074588f5786fb241469a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.component.html",
            "raw_url": "https://github.com/angular/angular/raw/fb4c8da4fc5db7ac9f2a074588f5786fb241469a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.component.html?ref=fb4c8da4fc5db7ac9f2a074588f5786fb241469a",
            "patch": "@@ -1,10 +1,5 @@\n-<as-split\n-  unit=\"percent\"\n-  [direction]=\"splitDirection\"\n-  [gutterSize]=\"9\"\n-  (dragEnd)=\"breadcrumbs.updateScrollButtonVisibility$.next()\"\n->\n-  <as-split-area size=\"60\">\n+<as-split unit=\"percent\" [direction]=\"splitDirection\" [gutterSize]=\"9\">\n+  <as-split-area #directiveForestSplitArea size=\"60\">\n     <as-split direction=\"vertical\" [gutterSize]=\"9\" unit=\"pixel\" [disabled]=\"true\">\n       <as-split-area size=\"*\">\n         <ng-directive-forest"
        },
        {
            "sha": "c7cf93849a8e747d46db8f63b26c4f62e42ac098",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-explorer.component.ts",
            "status": "modified",
            "additions": 43,
            "deletions": 26,
            "changes": 69,
            "blob_url": "https://github.com/angular/angular/blob/fb4c8da4fc5db7ac9f2a074588f5786fb241469a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/fb4c8da4fc5db7ac9f2a074588f5786fb241469a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.component.ts?ref=fb4c8da4fc5db7ac9f2a074588f5786fb241469a",
            "patch": "@@ -1,4 +1,14 @@\n-import { ChangeDetectorRef, Component, EventEmitter, HostListener, OnInit, Output, ViewChild } from '@angular/core';\n+import {\n+  ChangeDetectorRef,\n+  Component,\n+  ElementRef,\n+  EventEmitter,\n+  NgZone,\n+  OnDestroy,\n+  OnInit,\n+  Output,\n+  ViewChild,\n+} from '@angular/core';\n import {\n   MessageBus,\n   Events,\n@@ -12,14 +22,13 @@ import {\n } from 'protocol';\n import { IndexedNode } from './directive-forest/index-forest';\n import { ApplicationOperations } from '../../application-operations';\n-import { Subject } from 'rxjs';\n-import { throttleTime } from 'rxjs/operators';\n import { ElementPropertyResolver } from './property-resolver/element-property-resolver';\n import { FlatNode } from './directive-forest/component-data-source';\n import { FlatNode as PropertyFlatNode } from './property-resolver/element-property-resolver';\n import { DirectiveForestComponent } from './directive-forest/directive-forest.component';\n import { constructPathOfKeysToPropertyValue } from './property-resolver/directive-property-resolver';\n import { BreadcrumbsComponent } from './breadcrumbs/breadcrumbs.component';\n+import { SplitComponent } from '../../../lib/vendor/angular-split/public_api';\n \n const sameDirectives = (a: IndexedNode, b: IndexedNode) => {\n   if ((a.component && !b.component) || (!a.component && b.component)) {\n@@ -48,14 +57,32 @@ const sameDirectives = (a: IndexedNode, b: IndexedNode) => {\n     },\n   ],\n })\n-export class DirectiveExplorerComponent implements OnInit {\n+export class DirectiveExplorerComponent implements OnInit, OnDestroy {\n   @Output() toggleInspector = new EventEmitter<void>();\n \n   currentSelectedElement: IndexedNode | null = null;\n   forest: DevToolsNode[];\n-  splitDirection = 'horizontal';\n+  splitDirection: 'horizontal' | 'vertical' = 'horizontal';\n+\n+  @ViewChild(SplitComponent, { static: true, read: ElementRef }) splitElementRef: ElementRef;\n+  @ViewChild('directiveForestSplitArea', { static: true, read: ElementRef }) directiveForestSplitArea: ElementRef;\n+\n+  private _resizeObserver = new ResizeObserver((entries) =>\n+    this._ngZone.run(() => {\n+      const resizedEntry = entries[0];\n+\n+      if (resizedEntry.target === this.splitElementRef.nativeElement) {\n+        this.splitDirection = resizedEntry.contentRect.width <= 500 ? 'vertical' : 'horizontal';\n+      }\n+\n+      if (!this.breadcrumbs) {\n+        return;\n+      }\n+\n+      this.breadcrumbs.updateScrollButtonVisibility();\n+    })\n+  );\n \n-  private _changeSize = new Subject<Event>();\n   private _clickedElement: IndexedNode | null = null;\n   private _refreshRetryTimeout: any = null;\n \n@@ -68,17 +95,20 @@ export class DirectiveExplorerComponent implements OnInit {\n     private _appOperations: ApplicationOperations,\n     private _messageBus: MessageBus<Events>,\n     private _propResolver: ElementPropertyResolver,\n-    private _cdr: ChangeDetectorRef\n-  ) {\n-    this._changeSize\n-      .asObservable()\n-      .pipe(throttleTime(100))\n-      .subscribe((event) => this.handleResize(event));\n-  }\n+    private _cdr: ChangeDetectorRef,\n+    private _ngZone: NgZone\n+  ) {}\n \n   ngOnInit(): void {\n     this.subscribeToBackendEvents();\n     this.refresh();\n+    this._resizeObserver.observe(this.splitElementRef.nativeElement);\n+    this._resizeObserver.observe(this.directiveForestSplitArea.nativeElement);\n+  }\n+\n+  ngOnDestroy(): void {\n+    this._resizeObserver.unobserve(this.splitElementRef.nativeElement);\n+    this._resizeObserver.unobserve(this.directiveForestSplitArea.nativeElement);\n   }\n \n   handleNodeSelection(node: IndexedNode | null): void {\n@@ -184,19 +214,6 @@ export class DirectiveExplorerComponent implements OnInit {\n     this._messageBus.emit('removeHighlightOverlay');\n   }\n \n-  @HostListener('window:resize', ['$event'])\n-  onResize(event: Event): void {\n-    this._changeSize.next(event);\n-  }\n-\n-  handleResize(event: Event): void {\n-    if ((event.target as any).innerWidth <= 500) {\n-      this.splitDirection = 'vertical';\n-    } else {\n-      this.splitDirection = 'horizontal';\n-    }\n-  }\n-\n   handleSelect(node: FlatNode): void {\n     this.directiveForest.handleSelect(node);\n   }"
        },
        {
            "sha": "0e0d06a99a290ceffa032ebfba99a6c0fa70c051",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/directive-explorer/directive-explorer.spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/fb4c8da4fc5db7ac9f2a074588f5786fb241469a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/fb4c8da4fc5db7ac9f2a074588f5786fb241469a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fdirective-explorer%2Fdirective-explorer.spec.ts?ref=fb4c8da4fc5db7ac9f2a074588f5786fb241469a",
            "patch": "@@ -9,16 +9,19 @@ describe('DirectiveExplorerComponent', () => {\n   let comp: DirectiveExplorerComponent;\n   let applicationOperationsSpy: any;\n   let cdr: any;\n+  let ngZone: any;\n \n   beforeEach(() => {\n     applicationOperationsSpy = jasmine.createSpyObj('_appOperations', ['viewSource', 'selectDomElement']);\n     messageBusMock = jasmine.createSpyObj('messageBus', ['on', 'once', 'emit', 'destroy']);\n     cdr = jasmine.createSpyObj('_cdr', ['detectChanges']);\n+    ngZone = jasmine.createSpyObj('_ngZone', ['run']);\n     comp = new DirectiveExplorerComponent(\n       applicationOperationsSpy,\n       messageBusMock,\n       new ElementPropertyResolver(messageBusMock),\n-      cdr\n+      cdr,\n+      ngZone\n     );\n   });\n "
        },
        {
            "sha": "862559291c5f7f972e734827c6f40495594c72aa",
            "filename": "projects/ng-devtools/src/lib/devtools-tabs/profiler/recording/timeline/recording-visualizer/tree-map-visualizer/tree-map-visualizer.component.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/fb4c8da4fc5db7ac9f2a074588f5786fb241469a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Frecording-visualizer%2Ftree-map-visualizer%2Ftree-map-visualizer.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/fb4c8da4fc5db7ac9f2a074588f5786fb241469a/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Frecording-visualizer%2Ftree-map-visualizer%2Ftree-map-visualizer.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools%2Fsrc%2Flib%2Fdevtools-tabs%2Fprofiler%2Frecording%2Ftimeline%2Frecording-visualizer%2Ftree-map-visualizer%2Ftree-map-visualizer.component.ts?ref=fb4c8da4fc5db7ac9f2a074588f5786fb241469a",
            "patch": "@@ -1,4 +1,3 @@\n-/// <reference types=\"resize-observer-browser\" />\n import { Component, ElementRef, Input, NgZone, OnDestroy, OnInit, ViewChild } from '@angular/core';\n import * as treemap from 'webtreemap/build/webtreemap';\n import { TreeMapNode, TreeMapFormatter } from '../../record-formatter/tree-map-formatter';"
        }
    ],
    "stats": {
        "total": 89,
        "additions": 52,
        "deletions": 37
    }
}