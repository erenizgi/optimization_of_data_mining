{
    "author": "crisbeto",
    "message": "fix(core): error if CSS custom property in host binding has number in name (#38432)\n\nFixes an error if a CSS custom property, used inside a host binding, has a\nnumber in its name. The error is thrown because the styling parser only\nexpects characters from A to Z,dashes, underscores and a handful of other\ncharacters.\n\nFixes #37292.\n\nPR Close #38432",
    "sha": "a80f654af9d323e05f932069f1d7d63b162688b8",
    "files": [
        {
            "sha": "84074767435b42fafd04db79cb9c580c9835ed76",
            "filename": "packages/core/src/render3/styling/styling_parser.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/a80f654af9d323e05f932069f1d7d63b162688b8/packages%2Fcore%2Fsrc%2Frender3%2Fstyling%2Fstyling_parser.ts",
            "raw_url": "https://github.com/angular/angular/raw/a80f654af9d323e05f932069f1d7d63b162688b8/packages%2Fcore%2Fsrc%2Frender3%2Fstyling%2Fstyling_parser.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fstyling%2Fstyling_parser.ts?ref=a80f654af9d323e05f932069f1d7d63b162688b8",
            "patch": "@@ -210,7 +210,8 @@ export function consumeStyleKey(text: string, startIndex: number, endIndex: numb\n   let ch: number;\n   while (startIndex < endIndex &&\n          ((ch = text.charCodeAt(startIndex)) === CharCode.DASH || ch === CharCode.UNDERSCORE ||\n-          ((ch & CharCode.UPPER_CASE) >= CharCode.A && (ch & CharCode.UPPER_CASE) <= CharCode.Z))) {\n+          ((ch & CharCode.UPPER_CASE) >= CharCode.A && (ch & CharCode.UPPER_CASE) <= CharCode.Z) ||\n+          (ch >= CharCode.ZERO && ch <= CharCode.NINE))) {\n     startIndex++;\n   }\n   return startIndex;"
        },
        {
            "sha": "6680ebacad492e595786abb4cf4770d62d67381c",
            "filename": "packages/core/src/util/char_code.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/a80f654af9d323e05f932069f1d7d63b162688b8/packages%2Fcore%2Fsrc%2Futil%2Fchar_code.ts",
            "raw_url": "https://github.com/angular/angular/raw/a80f654af9d323e05f932069f1d7d63b162688b8/packages%2Fcore%2Fsrc%2Futil%2Fchar_code.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Futil%2Fchar_code.ts?ref=a80f654af9d323e05f932069f1d7d63b162688b8",
            "patch": "@@ -22,6 +22,8 @@ export const enum CharCode {\n   SEMI_COLON = 59,    // \";\"\n   BACK_SLASH = 92,    // \"\\\\\"\n   AT_SIGN = 64,       // \"@\"\n+  ZERO = 48,          // \"0\"\n+  NINE = 57,          // \"9\"\n   A = 65,             // \"A\"\n   U = 85,             // \"U\"\n   R = 82,             // \"R\""
        },
        {
            "sha": "bea42b397c72da884ec1b9109820aac72151eb04",
            "filename": "packages/core/test/acceptance/styling_spec.ts",
            "status": "modified",
            "additions": 31,
            "deletions": 8,
            "changes": 39,
            "blob_url": "https://github.com/angular/angular/blob/a80f654af9d323e05f932069f1d7d63b162688b8/packages%2Fcore%2Ftest%2Facceptance%2Fstyling_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/a80f654af9d323e05f932069f1d7d63b162688b8/packages%2Fcore%2Ftest%2Facceptance%2Fstyling_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Facceptance%2Fstyling_spec.ts?ref=a80f654af9d323e05f932069f1d7d63b162688b8",
            "patch": "@@ -214,28 +214,51 @@ describe('styling', () => {\n     });\n   });\n \n-  describe('css variables', () => {\n-    onlyInIvy('css variables').it('should support css variables', () => {\n+  onlyInIvy('CSS variables are only supported in Ivy').describe('css variables', () => {\n+    const supportsCssVariables = typeof getComputedStyle !== 'undefined' &&\n+        typeof CSS !== 'undefined' && typeof CSS.supports !== 'undefined' &&\n+        CSS.supports('color', 'var(--fake-var)');\n+\n+    it('should support css variables', () => {\n       // This test only works in browsers which support CSS variables.\n-      if (!(typeof getComputedStyle !== 'undefined' && typeof CSS !== 'undefined' &&\n-            typeof CSS.supports !== 'undefined' && CSS.supports('color', 'var(--fake-var)')))\n+      if (!supportsCssVariables) {\n         return;\n+      }\n+\n       @Component({\n         template: `\n-            <div [style.--my-var]=\" '100px' \">\n-              <span style=\"width: var(--my-var)\">CONTENT</span>\n-            </div>`\n+          <div [style.--my-var]=\"'100px'\">\n+            <span style=\"width: var(--my-var)\">CONTENT</span>\n+          </div>\n+        `\n       })\n       class Cmp {\n       }\n       TestBed.configureTestingModule({declarations: [Cmp]});\n       const fixture = TestBed.createComponent(Cmp);\n-      // document.body.appendChild(fixture.nativeElement);\n       fixture.detectChanges();\n \n       const span = fixture.nativeElement.querySelector('span') as HTMLElement;\n       expect(getComputedStyle(span).getPropertyValue('width')).toEqual('100px');\n     });\n+\n+    it('should support css variables with numbers in their name inside a host binding', () => {\n+      // This test only works in browsers which support CSS variables.\n+      if (!supportsCssVariables) {\n+        return;\n+      }\n+\n+      @Component({template: `<h1 style=\"width: var(--my-1337-var)\">Hello</h1>`})\n+      class Cmp {\n+        @HostBinding('style') style = '--my-1337-var: 100px;';\n+      }\n+      TestBed.configureTestingModule({declarations: [Cmp]});\n+      const fixture = TestBed.createComponent(Cmp);\n+      fixture.detectChanges();\n+\n+      const header = fixture.nativeElement.querySelector('h1') as HTMLElement;\n+      expect(getComputedStyle(header).getPropertyValue('width')).toEqual('100px');\n+    });\n   });\n \n   modifiedInIvy('shadow bindings include static portion')"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 35,
        "deletions": 9
    }
}