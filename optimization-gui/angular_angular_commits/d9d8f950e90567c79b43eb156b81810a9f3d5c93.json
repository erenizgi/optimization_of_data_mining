{
    "author": "iRealNirmal",
    "message": "feat(forms): allow disabling min/max validators dynamically (by setting the value to `null`) (#42978)\n\nThis commit updates the logic of the `min` and `max` validators to allow\ndisabling them dynamically in case `null` is provided as a value. For example: `<input\ntype=\"number\" [min]=\"minValue\">`, when `minValue` might be set to `null` in a\ncomponent class. This should allow `min` and `max` validators to be used for dynamic forms.\n\nNote: similar support was added to the `minLength` and `maxLength`\nvalidators earlier (see #42565).\n\nPR Close #42978",
    "sha": "d9d8f950e90567c79b43eb156b81810a9f3d5c93",
    "files": [
        {
            "sha": "2723e1ff85ff57882b3628f6db51533e823d890f",
            "filename": "goldens/public-api/forms/forms.md",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d9d8f950e90567c79b43eb156b81810a9f3d5c93/goldens%2Fpublic-api%2Fforms%2Fforms.md",
            "raw_url": "https://github.com/angular/angular/raw/d9d8f950e90567c79b43eb156b81810a9f3d5c93/goldens%2Fpublic-api%2Fforms%2Fforms.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fforms%2Fforms.md?ref=d9d8f950e90567c79b43eb156b81810a9f3d5c93",
            "patch": "@@ -415,7 +415,7 @@ export class MaxLengthValidator implements Validator, OnChanges {\n \n // @public\n export class MaxValidator extends AbstractValidatorDirective implements OnChanges {\n-    max: string | number;\n+    max: string | number | null;\n     ngOnChanges(changes: SimpleChanges): void;\n }\n \n@@ -432,7 +432,7 @@ export class MinLengthValidator implements Validator, OnChanges {\n \n // @public\n export class MinValidator extends AbstractValidatorDirective implements OnChanges {\n-    min: string | number;\n+    min: string | number | null;\n     ngOnChanges(changes: SimpleChanges): void;\n }\n "
        },
        {
            "sha": "b22dfec12960af8bf771ac19e2713317ddbdd62c",
            "filename": "packages/forms/src/directives/validators.ts",
            "status": "modified",
            "additions": 31,
            "deletions": 11,
            "changes": 42,
            "blob_url": "https://github.com/angular/angular/blob/d9d8f950e90567c79b43eb156b81810a9f3d5c93/packages%2Fforms%2Fsrc%2Fdirectives%2Fvalidators.ts",
            "raw_url": "https://github.com/angular/angular/raw/d9d8f950e90567c79b43eb156b81810a9f3d5c93/packages%2Fforms%2Fsrc%2Fdirectives%2Fvalidators.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Fsrc%2Fdirectives%2Fvalidators.ts?ref=d9d8f950e90567c79b43eb156b81810a9f3d5c93",
            "patch": "@@ -13,16 +13,24 @@ import {AbstractControl} from '../model';\n import {emailValidator, maxLengthValidator, maxValidator, minLengthValidator, minValidator, NG_VALIDATORS, nullValidator, patternValidator, requiredTrueValidator, requiredValidator} from '../validators';\n \n /**\n- * @description\n  * Method that updates string to integer if not alread a number\n  *\n  * @param value The value to convert to integer\n  * @returns value of parameter in number or integer.\n  */\n-function toNumber(value: string|number): number {\n+function toInteger(value: string|number): number {\n   return typeof value === 'number' ? value : parseInt(value, 10);\n }\n \n+/**\n+ * Method that ensures that provided value is a float (and converts it to float if needed).\n+ *\n+ * @param value The value to convert to float\n+ * @returns value of parameter in number or float.\n+ */\n+function toFloat(value: string|number): number {\n+  return typeof value === 'number' ? value : parseFloat(value);\n+}\n /**\n  * @description\n  * Defines the map of errors returned from failed validation checks.\n@@ -124,7 +132,7 @@ abstract class AbstractValidatorDirective implements Validator {\n   handleChanges(changes: SimpleChanges): void {\n     if (this.inputName in changes) {\n       const input = this.normalizeInput(changes[this.inputName].currentValue);\n-      this._validator = this.createValidator(input);\n+      this._validator = this.enabled() ? this.createValidator(input) : nullValidator;\n       if (this._onChange) {\n         this._onChange();\n       }\n@@ -140,6 +148,18 @@ abstract class AbstractValidatorDirective implements Validator {\n   registerOnValidatorChange(fn: () => void): void {\n     this._onChange = fn;\n   }\n+\n+  /**\n+   * @description\n+   * Determines whether this validator is active or not. Base class implementation\n+   * checks whether an input is defined (if the value is different from `null` and `undefined`).\n+   * Validator classes that extend this base class can override this function with the logic\n+   * specific to a particular validator directive.\n+   */\n+  enabled(): boolean {\n+    const inputValue = (this as unknown as {[key: string]: unknown})[this.inputName];\n+    return inputValue != null /* both `null` and `undefined` */;\n+  }\n }\n \n /**\n@@ -177,18 +197,18 @@ export const MAX_VALIDATOR: StaticProvider = {\n   selector:\n       'input[type=number][max][formControlName],input[type=number][max][formControl],input[type=number][max][ngModel]',\n   providers: [MAX_VALIDATOR],\n-  host: {'[attr.max]': 'max ?? null'}\n+  host: {'[attr.max]': 'enabled() ? max : null'}\n })\n export class MaxValidator extends AbstractValidatorDirective implements OnChanges {\n   /**\n    * @description\n    * Tracks changes to the max bound to this directive.\n    */\n-  @Input() max!: string|number;\n+  @Input() max!: string|number|null;\n   /** @internal */\n   override inputName = 'max';\n   /** @internal */\n-  override normalizeInput = (input: string): number => parseFloat(input);\n+  override normalizeInput = (input: string|number): number => toFloat(input);\n   /** @internal */\n   override createValidator = (max: number): ValidatorFn => maxValidator(max);\n   /**\n@@ -237,18 +257,18 @@ export const MIN_VALIDATOR: StaticProvider = {\n   selector:\n       'input[type=number][min][formControlName],input[type=number][min][formControl],input[type=number][min][ngModel]',\n   providers: [MIN_VALIDATOR],\n-  host: {'[attr.min]': 'min ?? null'}\n+  host: {'[attr.min]': 'enabled() ? min : null'}\n })\n export class MinValidator extends AbstractValidatorDirective implements OnChanges {\n   /**\n    * @description\n    * Tracks changes to the min bound to this directive.\n    */\n-  @Input() min!: string|number;\n+  @Input() min!: string|number|null;\n   /** @internal */\n   override inputName = 'min';\n   /** @internal */\n-  override normalizeInput = (input: string): number => parseFloat(input);\n+  override normalizeInput = (input: string|number): number => toFloat(input);\n   /** @internal */\n   override createValidator = (min: number): ValidatorFn => minValidator(min);\n   /**\n@@ -590,7 +610,7 @@ export class MinLengthValidator implements Validator, OnChanges {\n \n   private _createValidator(): void {\n     this._validator =\n-        this.enabled() ? minLengthValidator(toNumber(this.minlength!)) : nullValidator;\n+        this.enabled() ? minLengthValidator(toInteger(this.minlength!)) : nullValidator;\n   }\n \n   /** @nodoc */\n@@ -672,7 +692,7 @@ export class MaxLengthValidator implements Validator, OnChanges {\n \n   private _createValidator(): void {\n     this._validator =\n-        this.enabled() ? maxLengthValidator(toNumber(this.maxlength!)) : nullValidator;\n+        this.enabled() ? maxLengthValidator(toInteger(this.maxlength!)) : nullValidator;\n   }\n \n   /** @nodoc */"
        },
        {
            "sha": "cc5acf10e722e34f3636e13cb2b78e9b3cd22ba7",
            "filename": "packages/forms/test/reactive_integration_spec.ts",
            "status": "modified",
            "additions": 89,
            "deletions": 0,
            "changes": 89,
            "blob_url": "https://github.com/angular/angular/blob/d9d8f950e90567c79b43eb156b81810a9f3d5c93/packages%2Fforms%2Ftest%2Freactive_integration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d9d8f950e90567c79b43eb156b81810a9f3d5c93/packages%2Fforms%2Ftest%2Freactive_integration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Ftest%2Freactive_integration_spec.ts?ref=d9d8f950e90567c79b43eb156b81810a9f3d5c93",
            "patch": "@@ -2753,6 +2753,95 @@ const ValueAccessorB = createControlValueAccessor('[cva-b]');\n           verifyValidatorAttrValues({minlength: null, maxlength: null});\n           verifyFormState({isValid: true});\n         });\n+\n+        it('should not activate min and max validators if input is null', () => {\n+          @Component({\n+            selector: 'min-max-null',\n+            template: `\n+                <form [formGroup]=\"form\">\n+                  <input type=\"number\" [formControl]=\"control\" name=\"minmaxinput\" [min]=\"minlen\"Â [max]=\"maxlen\">\n+                </form> `\n+          })\n+          class MinMaxComponent {\n+            control: FormControl = new FormControl();\n+            form: FormGroup = new FormGroup({'control': this.control});\n+            minlen: number|null = null;\n+            maxlen: number|null = null;\n+          }\n+\n+          const fixture = initTest(MinMaxComponent);\n+          const control = fixture.componentInstance.control;\n+          fixture.detectChanges();\n+\n+          const form = fixture.componentInstance.form;\n+          const input = fixture.debugElement.query(By.css('input')).nativeElement;\n+\n+          interface minmax {\n+            min: number|null;\n+            max: number|null;\n+          }\n+\n+          interface state {\n+            isValid: boolean;\n+            failedValidator?: string;\n+          }\n+\n+          const setInputValue = (value: number) => {\n+            input.value = value;\n+            dispatchEvent(input, 'input');\n+            fixture.detectChanges();\n+          };\n+          const setValidatorValues = (values: minmax) => {\n+            fixture.componentInstance.minlen = values.min;\n+            fixture.componentInstance.maxlen = values.max;\n+            fixture.detectChanges();\n+          };\n+          const verifyValidatorAttrValues = (values: {min: any, max: any}) => {\n+            expect(input.getAttribute('min')).toBe(values.min);\n+            expect(input.getAttribute('max')).toBe(values.max);\n+          };\n+          const verifyFormState = (state: state) => {\n+            expect(form.valid).toBe(state.isValid);\n+            if (state.failedValidator) {\n+              expect(control!.hasError('min')).toEqual(state.failedValidator === 'min');\n+              expect(control!.hasError('max')).toEqual(state.failedValidator === 'max');\n+            }\n+          };\n+\n+          ////////// Actual test scenarios start below //////////\n+          // 1. Verify that validators are disabled when input is `null`.\n+          setValidatorValues({min: null, max: null});\n+          verifyValidatorAttrValues({min: null, max: null});\n+          verifyFormState({isValid: true});\n+\n+          // 2. Verify that setting validator inputs (to a value different from `null`) activate\n+          // validators.\n+          setInputValue(12345);\n+          setValidatorValues({min: 2, max: 4});\n+          verifyValidatorAttrValues({min: '2', max: '4'});\n+          verifyFormState({isValid: false, failedValidator: 'max'});\n+\n+          // 3. Changing value to the valid range should make the form valid.\n+          setInputValue(3);\n+          verifyFormState({isValid: true});\n+\n+          // 4. Changing value to trigger `minlength` validator.\n+          setInputValue(1);\n+          verifyFormState({isValid: false, failedValidator: 'min'});\n+\n+          // 5. Changing validator inputs to verify that attribute values are updated (and the form\n+          // is now valid).\n+          setInputValue(1);\n+          setValidatorValues({min: 1, max: 5});\n+          verifyValidatorAttrValues({min: '1', max: '5'});\n+          verifyFormState({isValid: true});\n+\n+          // 6. Reset validator inputs back to `null` should deactivate validators.\n+          setInputValue(123);\n+          setValidatorValues({min: null, max: null});\n+          verifyValidatorAttrValues({min: null, max: null});\n+          verifyFormState({isValid: true});\n+        });\n       });\n \n       describe('min and max validators', () => {"
        },
        {
            "sha": "7d348fca5ed643400c76e724387e3b279ef69701",
            "filename": "packages/forms/test/template_integration_spec.ts",
            "status": "modified",
            "additions": 86,
            "deletions": 0,
            "changes": 86,
            "blob_url": "https://github.com/angular/angular/blob/d9d8f950e90567c79b43eb156b81810a9f3d5c93/packages%2Fforms%2Ftest%2Ftemplate_integration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d9d8f950e90567c79b43eb156b81810a9f3d5c93/packages%2Fforms%2Ftest%2Ftemplate_integration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fforms%2Ftest%2Ftemplate_integration_spec.ts?ref=d9d8f950e90567c79b43eb156b81810a9f3d5c93",
            "patch": "@@ -2005,6 +2005,92 @@ import {NgModelCustomComp, NgModelCustomWrapper} from './value_accessor_integrat\n              verifyValidatorAttrValues({minlength: null, maxlength: null});\n              verifyFormState({isValid: true});\n            }));\n+\n+        it('should not include the min and max validators for null', fakeAsync(() => {\n+             @Component({\n+               template:\n+                   '<form><input type=\"number\" name=\"minmaxinput\" ngModel [min]=\"minlen\" [max]=\"maxlen\"></form>'\n+             })\n+             class MinLengthMaxLengthComponent {\n+               minlen: number|null = null;\n+               maxlen: number|null = null;\n+               control!: FormControl;\n+             }\n+\n+             const fixture = initTest(MinLengthMaxLengthComponent);\n+             fixture.detectChanges();\n+             tick();\n+             const input = fixture.debugElement.query(By.css('input')).nativeElement;\n+\n+             const form = fixture.debugElement.children[0].injector.get(NgForm);\n+             const control =\n+                 fixture.debugElement.children[0].injector.get(NgForm).control.get('minmaxinput')!;\n+\n+             interface minmax {\n+               min: number|null;\n+               max: number|null;\n+             }\n+\n+             interface state {\n+               isValid: boolean;\n+               failedValidator?: string;\n+             }\n+\n+             const setInputValue = (value: number) => {\n+               input.value = value;\n+               dispatchEvent(input, 'input');\n+               fixture.detectChanges();\n+             };\n+             const verifyValidatorAttrValues = (values: {min: any, max: any}) => {\n+               expect(input.getAttribute('min')).toBe(values.min);\n+               expect(input.getAttribute('max')).toBe(values.max);\n+             };\n+             const setValidatorValues = (values: minmax) => {\n+               fixture.componentInstance.minlen = values.min;\n+               fixture.componentInstance.maxlen = values.max;\n+               fixture.detectChanges();\n+             };\n+             const verifyFormState = (state: state) => {\n+               expect(form.valid).toBe(state.isValid);\n+               if (state.failedValidator) {\n+                 expect(control!.hasError('min')).toEqual(state.failedValidator === 'min');\n+                 expect(control!.hasError('max')).toEqual(state.failedValidator === 'max');\n+               }\n+             };\n+\n+             ////////// Actual test scenarios start below //////////\n+             // 1. Verify that validators are disabled when input is `null`.\n+             verifyValidatorAttrValues({min: null, max: null});\n+             verifyValidatorAttrValues({min: null, max: null});\n+\n+             // 2. Verify that setting validator inputs (to a value different from `null`) activate\n+             // validators.\n+             setInputValue(12345);\n+             setValidatorValues({min: 2, max: 4});\n+             verifyValidatorAttrValues({min: '2', max: '4'});\n+             verifyFormState({isValid: false, failedValidator: 'max'});\n+\n+             // 3. Changing value to the valid range should make the form valid.\n+             setInputValue(3);\n+             verifyFormState({isValid: true});\n+\n+             // 4. Changing value to trigger `minlength` validator.\n+             setInputValue(1);\n+             verifyFormState({isValid: false, failedValidator: 'min'});\n+\n+             // 5. Changing validator inputs to verify that attribute values are updated (and the\n+             // form is now valid).\n+             setInputValue(1);\n+             setValidatorValues({min: 1, max: 5});\n+             verifyValidatorAttrValues({min: '1', max: '5'});\n+             verifyFormState({isValid: true});\n+\n+             // 6. Reset validator inputs back to `null` should deactivate validators.\n+             setInputValue(123);\n+             setValidatorValues({min: null, max: null});\n+             verifyValidatorAttrValues({min: null, max: null});\n+             verifyFormState({isValid: true});\n+           }));\n       });\n \n       ['number', 'string'].forEach((inputType: string) => {"
        }
    ],
    "stats": {
        "total": 221,
        "additions": 208,
        "deletions": 13
    }
}