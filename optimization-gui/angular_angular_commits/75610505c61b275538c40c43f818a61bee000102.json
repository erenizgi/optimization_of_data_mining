{
    "author": "josephperrott",
    "message": "refactor(zone.js): remove usages of blacklist related to UNPATCHED_EVENTS (#38930)\n\nRemove usages of blacklist around UNPATCHED_EVENTS configuration\n\nPR Close #38930",
    "sha": "75610505c61b275538c40c43f818a61bee000102",
    "files": [
        {
            "sha": "81150e4e366386181c1dda31ccc4b1de042d5154",
            "filename": "packages/zone.js/STANDARD-APIS.md",
            "status": "modified",
            "additions": 17,
            "deletions": 17,
            "changes": 34,
            "blob_url": "https://github.com/angular/angular/blob/75610505c61b275538c40c43f818a61bee000102/packages%2Fzone.js%2FSTANDARD-APIS.md",
            "raw_url": "https://github.com/angular/angular/raw/75610505c61b275538c40c43f818a61bee000102/packages%2Fzone.js%2FSTANDARD-APIS.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2FSTANDARD-APIS.md?ref=75610505c61b275538c40c43f818a61bee000102",
            "patch": "@@ -1,11 +1,11 @@\n # Zone.js's support for standard apis\n \n Zone.js patched most standard APIs such as DOM event listeners, XMLHttpRequest in Browser, EventEmitter and fs API in Node.js so they can be in zone.\n-  \n-In this document, all patched API are listed. \n+\n+In this document, all patched API are listed.\n \n For non-standard APIs, please see [NON-STANDARD-APIS.md](NON-STANDARD-APIS.md)\n- \n+\n ## Patch Mechanisms\n \n There are several patch mechanisms\n@@ -15,18 +15,18 @@ There are several patch mechanisms\n   1. MacroTask\n   2. MicroTask\n   3. EventTask\n-  \n+\n Some APIs which should be treated as Tasks, but are currently still patched in the wrap way. These will be patched as Tasks soon.\n- \n-## Browser \n+\n+## Browser\n \n Web APIs\n \n | API | Patch Mechanism | Others |\n | --- | --- | --- |\n | setTimeout/clearTimeout | MacroTask | app can get handlerId, interval, args, isPeriodic(false) through task.data |\n | setImmediate/clearImmediate | MacroTask | same with setTimeout |\n-| setInterval/clearInterval | MacroTask | isPeriodic is true, so setInterval will not trigger onHasTask callback | \n+| setInterval/clearInterval | MacroTask | isPeriodic is true, so setInterval will not trigger onHasTask callback |\n | requestAnimationFrame/cancelAnimationFrame | MacroTask |  |\n | mozRequestAnimationFrame/mozCancelAnimationFrame | MacroTask |  |\n | webkitRequestAnimationFrame/webkitCancelAnimationFrame | MacroTask |  |\n@@ -56,7 +56,7 @@ EventTarget\n from EventTarget will also be patched.\n - For browsers that do not support EventTarget, Zone.js will patch the following APIs in the IDL\n  that inherit from EventTarget\n- \n+\n  |||||\n  |---|---|---|---|\n  |ApplicationCache|EventSource|FileReader|InputMethodContext|\n@@ -94,8 +94,8 @@ The following 'on' properties, such as onclick, onreadystatechange, are patched\n | --- | --- | --- |\n | setTimeout/clearTimeout | MacroTask | app can get handlerId, interval, args, isPeriodic(false) through task.data |\n | setImmediate/clearImmediate | MacroTask | same with setTimeout |\n-| setInterval/clearInterval | MacroTask | isPeriodic is true, so setInterval will not trigger onHasTask callback | \n-| process.nextTick | Microtask | isPeriodic is true, so setInterval will not trigger onHasTask callback | \n+| setInterval/clearInterval | MacroTask | isPeriodic is true, so setInterval will not trigger onHasTask callback |\n+| process.nextTick | Microtask | isPeriodic is true, so setInterval will not trigger onHasTask callback |\n | Promise | MicroTask |  |\n | EventEmitter | EventTask | All APIs inherit EventEmitter are patched as EventTask  |\n | crypto | MacroTask |  |\n@@ -104,9 +104,9 @@ The following 'on' properties, such as onclick, onreadystatechange, are patched\n EventEmitter, addEventListener, prependEventListener and 'on' will be patched once as EventTasks, and removeEventListener and\n removeAllListeners will remove those EventTasks\n \n-## Electron \n+## Electron\n \n-Zone.js does not patch the Electron API, although in Electron both browser APIs and node APIs are patched, so \n+Zone.js does not patch the Electron API, although in Electron both browser APIs and node APIs are patched, so\n if you want to include Zone.js in Electron, please use dist/zone-mix.js\n \n ## ZoneAwareError\n@@ -117,7 +117,7 @@ This type of issue would happen when creating an error without `new`: `this` wou\n non-strict mode. It could cause some very difficult to detect issues.\n \n ```javascript\n-  const error = Error(); \n+  const error = Error();\n ```\n \n ZoneAwareError makes sure that `this` is ZoneAwareError even without new.\n@@ -127,10 +127,10 @@ ZoneAwareError makes sure that `this` is ZoneAwareError even without new.\n ZoneAwarePromise wraps the global Promise and makes it run in zones as a MicroTask.\n It also passes promise A+ tests.\n \n-## BlackListEvents\n+## UnpatchedEvents\n \n-Sometimes we don't want some `event` to be patched by `zone.js`, we can blacklist events\n-by following settings.\n+Sometimes we don't want some `event` to be patched by `zone.js`, we can instruct zone.js to leave\n+these `event` to be unpatched by following settings.\n \n ```javascript\n     // disable on properties\n@@ -144,5 +144,5 @@ by following settings.\n     });\n \n     // disable addEventListener\n-    global['__zone_symbol__BLACK_LISTED_EVENTS'] = ['scroll'];\n+    global['__zone_symbol__UNPATCHED_EVENTS'] = ['scroll'];\n ```"
        },
        {
            "sha": "7d70918eca8a736b97481d8c1c14244bfe1f2823",
            "filename": "packages/zone.js/lib/common/events.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/75610505c61b275538c40c43f818a61bee000102/packages%2Fzone.js%2Flib%2Fcommon%2Fevents.ts",
            "raw_url": "https://github.com/angular/angular/raw/75610505c61b275538c40c43f818a61bee000102/packages%2Fzone.js%2Flib%2Fcommon%2Fevents.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Flib%2Fcommon%2Fevents.ts?ref=75610505c61b275538c40c43f818a61bee000102",
            "patch": "@@ -351,7 +351,7 @@ export function patchEventTarget(\n     const compare =\n         (patchOptions && patchOptions.diff) ? patchOptions.diff : compareTaskCallbackVsDelegate;\n \n-    const blackListedEvents: string[] = (Zone as any)[zoneSymbol('BLACK_LISTED_EVENTS')];\n+    const unpatchedEvents: string[] = (Zone as any)[zoneSymbol('UNPATCHED_EVENTS')];\n     const passiveEvents: string[] = _global[zoneSymbol('PASSIVE_EVENTS')];\n \n     const makeAddListener = function(\n@@ -391,10 +391,10 @@ export function patchEventTarget(\n             passiveSupported && !!passiveEvents && passiveEvents.indexOf(eventName) !== -1;\n         const options = buildEventListenerOptions(arguments[2], passive);\n \n-        if (blackListedEvents) {\n-          // check black list\n-          for (let i = 0; i < blackListedEvents.length; i++) {\n-            if (eventName === blackListedEvents[i]) {\n+        if (unpatchedEvents) {\n+          // check upatched list\n+          for (let i = 0; i < unpatchedEvents.length; i++) {\n+            if (eventName === unpatchedEvents[i]) {\n               if (passive) {\n                 return nativeListener.call(target, eventName, delegate, options);\n               } else {"
        },
        {
            "sha": "cba4176e383a06d821dd2c29ad0d9fcca99abb50",
            "filename": "packages/zone.js/test/browser/browser.spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/75610505c61b275538c40c43f818a61bee000102/packages%2Fzone.js%2Ftest%2Fbrowser%2Fbrowser.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/75610505c61b275538c40c43f818a61bee000102/packages%2Fzone.js%2Ftest%2Fbrowser%2Fbrowser.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Ftest%2Fbrowser%2Fbrowser.spec.ts?ref=75610505c61b275538c40c43f818a61bee000102",
            "patch": "@@ -1154,10 +1154,10 @@ describe('Zone', function() {\n         it('should not be passive with global variable defined with passive false option', () => {\n           testPassive('touchstart', 'defaultPrevented', {passive: false});\n         });\n-        it('should be passive with global variable defined and also blacklisted', () => {\n+        it('should be passive with global variable defined and also unpatched', () => {\n           testPassive('scroll', 'default will run', undefined);\n         });\n-        it('should not be passive without global variable defined and also blacklisted', () => {\n+        it('should not be passive without global variable defined and also unpatched', () => {\n           testPassive('wheel', 'defaultPrevented', undefined);\n         });\n       });\n@@ -1376,7 +1376,7 @@ describe('Zone', function() {\n            let hookSpy2 = jasmine.createSpy('spy2');\n            let hookSpy3 = jasmine.createSpy('spy3');\n            let logs: string[] = [];\n-           const isBlacklistedEvent = function(source: string) {\n+           const isUnpatchedEvent = function(source: string) {\n              return source.lastIndexOf('click') !== -1;\n            };\n            const zone1 = Zone.current.fork({\n@@ -1385,7 +1385,7 @@ describe('Zone', function() {\n                  parentZoneDelegate: ZoneDelegate, currentZone: Zone, targetZone: Zone, task: Task):\n                  any => {\n                    if ((task.type === 'eventTask' || task.type === 'macroTask') &&\n-                       isBlacklistedEvent(task.source)) {\n+                       isUnpatchedEvent(task.source)) {\n                      task.cancelScheduleRequest();\n \n                      return zone2.scheduleTask(task);"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 26,
        "deletions": 26
    }
}