{
    "author": "t-bowersox",
    "message": "docs: update async validators section (#44764)\n\n* Update the UniqueAlterEgoValidator code example\n* Add async-validator docregion to hero-form-reactive.component.2.ts\n* Fix typo under Implementing a custom async validator\n* Add h3 sections for adding async validators to reactive & template-driven forms\nPR Close #44764",
    "sha": "4098aac093f17fb58a358808b839d48cf1f091dc",
    "files": [
        {
            "sha": "871da936e17f5bcc3a03220be5da9b5b43f5a359",
            "filename": "aio/content/examples/form-validation/src/app/reactive/hero-form-reactive.component.2.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/4098aac093f17fb58a358808b839d48cf1f091dc/aio%2Fcontent%2Fexamples%2Fform-validation%2Fsrc%2Fapp%2Freactive%2Fhero-form-reactive.component.2.ts",
            "raw_url": "https://github.com/angular/angular/raw/4098aac093f17fb58a358808b839d48cf1f091dc/aio%2Fcontent%2Fexamples%2Fform-validation%2Fsrc%2Fapp%2Freactive%2Fhero-form-reactive.component.2.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fform-validation%2Fsrc%2Fapp%2Freactive%2Fhero-form-reactive.component.2.ts?ref=4098aac093f17fb58a358808b839d48cf1f091dc",
            "patch": "@@ -25,10 +25,12 @@ export class HeroFormReactiveComponent implements OnInit {\n         Validators.minLength(4),\n         forbiddenNameValidator(/bob/i)\n       ]),\n+      // #docregion async-validator\n       alterEgo: new FormControl(this.hero.alterEgo, {\n         asyncValidators: [this.alterEgoValidator.validate.bind(this.alterEgoValidator)],\n         updateOn: 'blur'\n       }),\n+      // #enddocregion async-validator\n       power: new FormControl(this.hero.power, Validators.required)\n     });\n   }"
        },
        {
            "sha": "0956a724b5ff3777082911b92867c6afbde2aee5",
            "filename": "aio/content/examples/form-validation/src/app/shared/alter-ego.directive.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 19,
            "changes": 31,
            "blob_url": "https://github.com/angular/angular/blob/4098aac093f17fb58a358808b839d48cf1f091dc/aio%2Fcontent%2Fexamples%2Fform-validation%2Fsrc%2Fapp%2Fshared%2Falter-ego.directive.ts",
            "raw_url": "https://github.com/angular/angular/raw/4098aac093f17fb58a358808b839d48cf1f091dc/aio%2Fcontent%2Fexamples%2Fform-validation%2Fsrc%2Fapp%2Fshared%2Falter-ego.directive.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fform-validation%2Fsrc%2Fapp%2Fshared%2Falter-ego.directive.ts?ref=4098aac093f17fb58a358808b839d48cf1f091dc",
            "patch": "@@ -10,21 +10,7 @@ import { HeroesService } from './heroes.service';\n import { Observable, of } from 'rxjs';\n \n // #docregion async-validator\n-@Injectable({ providedIn: 'root' })\n-export class UniqueAlterEgoValidator implements AsyncValidator {\n-  constructor(private heroesService: HeroesService) {}\n-\n-  validate(\n-    ctrl: AbstractControl\n-  ): Promise<ValidationErrors | null> | Observable<ValidationErrors | null> {\n-    return this.heroesService.isAlterEgoTaken(ctrl.value).pipe(\n-      map(isTaken => (isTaken ? { uniqueAlterEgo: true } : null)),\n-      catchError(() => of(null))\n-    );\n-  }\n-}\n-// #enddocregion async-validator\n-\n+// #docregion async-validator-directive\n @Directive({\n   selector: '[appUniqueAlterEgo]',\n   providers: [\n@@ -35,10 +21,17 @@ export class UniqueAlterEgoValidator implements AsyncValidator {\n     }\n   ]\n })\n-export class UniqueAlterEgoValidatorDirective {\n-  constructor(private validator: UniqueAlterEgoValidator) {}\n+// #enddocregion async-validator-directive\n+export class UniqueAlterEgoValidatorDirective implements AsyncValidator {\n+  constructor(private heroesService: HeroesService) {}\n \n-  validate(control: AbstractControl) {\n-    this.validator.validate(control);\n+  validate(\n+    ctrl: AbstractControl\n+  ): Promise<ValidationErrors | null> | Observable<ValidationErrors | null> {\n+    return this.heroesService.isAlterEgoTaken(ctrl.value).pipe(\n+      map(isTaken => (isTaken ? { uniqueAlterEgo: true } : null)),\n+      catchError(() => of(null))\n+    );\n   }\n }\n+// #enddocregion async-validator"
        },
        {
            "sha": "b3836ee4468ef855915391fa649220a1961e7c5f",
            "filename": "aio/content/examples/form-validation/src/app/template/hero-form-template.component.html",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/4098aac093f17fb58a358808b839d48cf1f091dc/aio%2Fcontent%2Fexamples%2Fform-validation%2Fsrc%2Fapp%2Ftemplate%2Fhero-form-template.component.html",
            "raw_url": "https://github.com/angular/angular/raw/4098aac093f17fb58a358808b839d48cf1f091dc/aio%2Fcontent%2Fexamples%2Fform-validation%2Fsrc%2Fapp%2Ftemplate%2Fhero-form-template.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fform-validation%2Fsrc%2Fapp%2Ftemplate%2Fhero-form-template.component.html?ref=4098aac093f17fb58a358808b839d48cf1f091dc",
            "patch": "@@ -35,14 +35,15 @@ <h2>Template-Driven Form</h2>\n \n         <div class=\"form-group\">\n           <label for=\"alterEgo\">Alter Ego</label>\n-          <input type=\"text\"\n+        <!-- #docregion alterEgo-input -->\n+        <input type=\"text\"\n                  id=\"alterEgo\"\n                  name=\"alterEgo\"\n                  #alterEgo=\"ngModel\"\n                  [(ngModel)]=\"hero.alterEgo\"\n                  [ngModelOptions]=\"{ updateOn: 'blur' }\"\n                  appUniqueAlterEgo>\n-\n+          <!-- #enddocregion alterEgo-input -->\n           <div *ngIf=\"alterEgo.pending\">Validating...</div>\n           <div *ngIf=\"alterEgo.invalid\" class=\"alert alter-ego-errors\">\n             <div *ngIf=\"alterEgo.errors?.['uniqueAlterEgo']\">"
        },
        {
            "sha": "a17052f61905d6ee3128d0219ee8522851c0e5e2",
            "filename": "aio/content/guide/form-validation.md",
            "status": "modified",
            "additions": 17,
            "deletions": 2,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/4098aac093f17fb58a358808b839d48cf1f091dc/aio%2Fcontent%2Fguide%2Fform-validation.md",
            "raw_url": "https://github.com/angular/angular/raw/4098aac093f17fb58a358808b839d48cf1f091dc/aio%2Fcontent%2Fguide%2Fform-validation.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fguide%2Fform-validation.md?ref=4098aac093f17fb58a358808b839d48cf1f091dc",
            "patch": "@@ -285,7 +285,6 @@ These are very similar to their synchronous counterparts, with the following dif\n * The `validate()` functions must return a Promise or an observable,\n * The observable returned must be finite, meaning it must complete at some point.\n To convert an infinite observable into a finite one, pipe the observable through a filtering operator such as `first`, `last`, `take`, or `takeUntil`.\n-* In template-driven forms, register your validator directive with the `NG_ASYNC_VALIDATORS` provider instead of `NG_VALIDATORS`.\n \n Asynchronous validation happens after the synchronous validation, and is performed only if the synchronous validation is successful.\n This check lets forms avoid potentially expensive async validation processes (such as an HTTP request) if the more basic validation methods have already found invalid input.\n@@ -305,7 +304,7 @@ In the following example, an async validator ensures that heroes pick an alter e\n New heroes are constantly enlisting and old heroes are leaving the service, so the list of available alter egos cannot be retrieved ahead of time.\n To validate the potential alter ego entry, the validator must initiate an asynchronous operation to consult a central database of all currently enlisted heroes.\n \n-The following code create the validator class, `UniqueAlterEgoValidator`, which implements the `AsyncValidator` interface.\n+The following code creates the validator class, `UniqueAlterEgoValidator`, which implements the `AsyncValidator` interface.\n \n <code-example path=\"form-validation/src/app/shared/alter-ego.directive.ts\" region=\"async-validator\"></code-example>\n \n@@ -334,6 +333,22 @@ You could handle the error differently and return the `ValidationError` object i\n After some time passes, the observable chain completes and the asynchronous validation is done.\n The `pending` flag is set to `false`, and the form validity is updated.\n \n+### Adding async validators to reactive forms\n+\n+In reactive forms, add an async validator by passing the function directly to the `FormControl`.\n+\n+<code-example path=\"form-validation/src/app/reactive/hero-form-reactive.component.2.ts\" region=\"async-validator\"></code-example>\n+\n+### Adding async validators to template-driven forms\n+\n+To use an async validator in template-driven forms, register it with the `NG_ASYNC_VALIDATORS` provider.\n+\n+<code-example path=\"form-validation/src/app/shared/alter-ego.directive.ts\" region=\"async-validator-directive\"></code-example>\n+\n+Then, as with synchronous validators, add the directive's selector to an input to activate it.\n+\n+<code-example path=\"form-validation/src/app/template/hero-form-template.component.html\" region=\"alterEgo-input\" header=\"template/hero-form-template.component.html (unique-alter-ego-input)\"></code-example>\n+\n ### Optimizing performance of async validators\n \n By default, all validators run after every form value change. With synchronous validators, this does not normally have a noticeable impact on application performance."
        }
    ],
    "stats": {
        "total": 57,
        "additions": 34,
        "deletions": 23
    }
}