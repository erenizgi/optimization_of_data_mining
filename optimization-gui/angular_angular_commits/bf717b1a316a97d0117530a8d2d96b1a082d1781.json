{
    "author": "CaerusKaru",
    "message": "fix(elements): detect matchesSelector prototype without IIFE (#37799)\n\nAlthough in SSR we patch the global prototypes with DOM globals\nlike Element and Node, this patch does not occur before the\nmatches function is called in Angular Elements. This is similar\nto the behavior in @angular/upgrade.\n\nFixes #24551\n\nPR Close #37799",
    "sha": "bf717b1a316a97d0117530a8d2d96b1a082d1781",
    "files": [
        {
            "sha": "9bddaa70dcadb85d23d85c1d660ba7eca1b3c2f6",
            "filename": "packages/elements/src/utils.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 8,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/bf717b1a316a97d0117530a8d2d96b1a082d1781/packages%2Felements%2Fsrc%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/bf717b1a316a97d0117530a8d2d96b1a082d1781/packages%2Felements%2Fsrc%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Felements%2Fsrc%2Futils.ts?ref=bf717b1a316a97d0117530a8d2d96b1a082d1781",
            "patch": "@@ -7,12 +7,6 @@\n  */\n import {ComponentFactoryResolver, Injector, Type} from '@angular/core';\n \n-const matches = (() => {\n-  const elProto = Element.prototype as any;\n-  return elProto.matches || elProto.matchesSelector || elProto.mozMatchesSelector ||\n-      elProto.msMatchesSelector || elProto.oMatchesSelector || elProto.webkitMatchesSelector;\n-})();\n-\n /**\n  * Provide methods for scheduling the execution of a callback.\n  */\n@@ -96,11 +90,20 @@ export function kebabToCamelCase(input: string): string {\n   return input.replace(/-([a-z\\d])/g, (_, char) => char.toUpperCase());\n }\n \n+let _matches: (this: any, selector: string) => boolean;\n+\n /**\n  * Check whether an `Element` matches a CSS selector.\n+ * NOTE: this is duplicated from @angular/upgrade, and can\n+ * be consolidated in the future\n  */\n-export function matchesSelector(element: Element, selector: string): boolean {\n-  return matches.call(element, selector);\n+export function matchesSelector(el: any, selector: string): boolean {\n+  if (!_matches) {\n+    const elProto = <any>Element.prototype;\n+    _matches = elProto.matches || elProto.matchesSelector || elProto.mozMatchesSelector ||\n+        elProto.msMatchesSelector || elProto.oMatchesSelector || elProto.webkitMatchesSelector;\n+  }\n+  return el.nodeType === Node.ELEMENT_NODE ? _matches.call(el, selector) : false;\n }\n \n /**"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 11,
        "deletions": 8
    }
}