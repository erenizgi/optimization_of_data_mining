{
    "author": "mgechev",
    "message": "fix(devtools): get all the property names including getters\n\nThis PR intentionally ignores `Symbol`s because their serialization and deserialization will include extra complexity.\n\nThe changes also improve the typings in the continuation function that's passed during serialization.",
    "sha": "a7f656215833df41c5637b1cca95abc495d6680d",
    "files": [
        {
            "sha": "f38977d87dda3920d1d6d900ad4642697a90b1cf",
            "filename": "projects/ng-devtools-backend/src/lib/component-tree.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/a7f656215833df41c5637b1cca95abc495d6680d/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fcomponent-tree.ts",
            "raw_url": "https://github.com/angular/angular/raw/a7f656215833df41c5637b1cca95abc495d6680d/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fcomponent-tree.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fcomponent-tree.ts?ref=a7f656215833df41c5637b1cca95abc495d6680d",
            "patch": "@@ -206,5 +206,9 @@ const mutateComponentOrDirective = (updatedStateData: UpdatedStateData, compOrDi\n     parentObjectOfValueToUpdate = parentObjectOfValueToUpdate[key];\n   });\n \n-  parentObjectOfValueToUpdate[valueKey] = updatedStateData.newValue;\n+  // When we try to set a property which only has a getter\n+  // the line below could throw an error.\n+  try {\n+    parentObjectOfValueToUpdate[valueKey] = updatedStateData.newValue;\n+  } catch {}\n };"
        },
        {
            "sha": "27923beaaae367a5b4366386a58179f9f17ad3f2",
            "filename": "projects/ng-devtools-backend/src/lib/state-serializer/object-utils.ts",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/a7f656215833df41c5637b1cca95abc495d6680d/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2Fobject-utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/a7f656215833df41c5637b1cca95abc495d6680d/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2Fobject-utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2Fobject-utils.ts?ref=a7f656215833df41c5637b1cca95abc495d6680d",
            "patch": "@@ -0,0 +1,12 @@\n+// Intentionally do not include the prototype because it contains\n+// inherited methods (hasOwnProperty, etc.). Also ignore symbols\n+// because it is tricky to pass a path to a symbol.\n+//\n+// We'd have to go through a serialization and deserialization logic\n+// which will add unnecessary complexity.\n+export const getKeys = (obj: {}): string[] => {\n+  if (!obj) {\n+    return [];\n+  }\n+  return Object.getOwnPropertyNames(obj);\n+};"
        },
        {
            "sha": "56e0cfde7764c3e8b3161f296b0b1c756da9d48e",
            "filename": "projects/ng-devtools-backend/src/lib/state-serializer/serialized-descriptor-factory.ts",
            "status": "modified",
            "additions": 71,
            "deletions": 24,
            "changes": 95,
            "blob_url": "https://github.com/angular/angular/blob/a7f656215833df41c5637b1cca95abc495d6680d/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2Fserialized-descriptor-factory.ts",
            "raw_url": "https://github.com/angular/angular/raw/a7f656215833df41c5637b1cca95abc495d6680d/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2Fserialized-descriptor-factory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2Fserialized-descriptor-factory.ts?ref=a7f656215833df41c5637b1cca95abc495d6680d",
            "patch": "@@ -1,5 +1,6 @@\n import { Descriptor, NestedProp, PropType } from 'protocol';\n import { METADATA_PROPERTY_NAME } from '../directive-forest';\n+import { getKeys } from './object-utils';\n \n export interface CompositeType {\n   type: Extract<PropType, PropType.Array | PropType.Object>;\n@@ -47,14 +48,15 @@ const typeToDescriptorPreview: Formatter<string> = {\n   [PropType.HTMLNode]: (prop: any) => prop.constructor.name,\n   [PropType.Null]: (_: any) => 'null',\n   [PropType.Number]: (prop: any) => parseInt(prop, 10).toString(),\n-  [PropType.Object]: (prop: any) => (Object.keys(prop).length > 0 ? '{...}' : '{}'),\n+  [PropType.Object]: (prop: any) => (getKeys(prop).length > 0 ? '{...}' : '{}'),\n   [PropType.Symbol]: (_: any) => 'Symbol()',\n   [PropType.Undefined]: (_: any) => 'undefined',\n   [PropType.Date]: (_: any) => 'Date()',\n   [PropType.Unknown]: (_: any) => 'unknown',\n };\n \n-const ignoreList = new Set([METADATA_PROPERTY_NAME, '__ngSimpleChanges__']);\n+type Key = string | number;\n+const ignoreList: Set<Key> = new Set([METADATA_PROPERTY_NAME, '__ngSimpleChanges__']);\n \n const shallowPropTypeToTreeMetaData = {\n   [PropType.String]: {\n@@ -103,14 +105,49 @@ const shallowPropTypeToTreeMetaData = {\n   },\n };\n \n-export const createShallowSerializedDescriptor = (propData: TerminalType): Descriptor => {\n+const isEditable = (instance: any, propName: string | number, propData: TerminalType) => {\n+  if (typeof propName === 'symbol') {\n+    return false;\n+  }\n+  const descriptor = Object.getOwnPropertyDescriptor(instance, propName as string);\n+  if (descriptor?.writable === false) {\n+    return false;\n+  }\n+  if (!descriptor?.set && descriptor && !('value' in descriptor)) {\n+    return false;\n+  }\n+  if (descriptor?.set && !descriptor?.get && !('value' in descriptor)) {\n+    return false;\n+  }\n+  return shallowPropTypeToTreeMetaData[propData.type].editable;\n+};\n+\n+const hasValue = (obj: {}, prop: string | number) => {\n+  const descriptor = Object.getOwnPropertyDescriptor(obj, prop);\n+  if (!descriptor?.get && typeof descriptor?.value === 'undefined') {\n+    return false;\n+  }\n+  return true;\n+};\n+\n+const getPreview = (instance: {}, propName: string | number, propData: TerminalType | CompositeType) => {\n+  return hasValue(instance, propName) ? typeToDescriptorPreview[propData.type](propData.prop) : SETTER_FIELD_PREVIEW;\n+};\n+\n+const SETTER_FIELD_PREVIEW = '[setter]';\n+\n+export const createShallowSerializedDescriptor = (\n+  instance: any,\n+  propName: string | number,\n+  propData: TerminalType\n+): Descriptor => {\n   const { type } = propData;\n \n   const shallowSerializedDescriptor: Descriptor = {\n     type,\n     expandable: shallowPropTypeToTreeMetaData[type].expandable,\n-    editable: shallowPropTypeToTreeMetaData[type].editable,\n-    preview: typeToDescriptorPreview[propData.type](propData.prop),\n+    editable: isEditable(instance, propName, propData),\n+    preview: getPreview(instance, propName, propData),\n   };\n \n   if (propData.prop !== undefined && serializable[type]) {\n@@ -121,17 +158,19 @@ export const createShallowSerializedDescriptor = (propData: TerminalType): Descr\n };\n \n export const createLevelSerializedDescriptor = (\n+  instance: {},\n+  propName: string | number,\n   propData: CompositeType,\n   levelOptions: LevelOptions,\n-  continuation: any\n+  continuation: (instance: any, propName: string | number, level?: number, max?: number) => void\n ): Descriptor => {\n   const { type, prop } = propData;\n \n   const levelSerializedDescriptor: Descriptor = {\n     type,\n     editable: false,\n-    expandable: Object.keys(prop).length > 0,\n-    preview: typeToDescriptorPreview[propData.type](propData.prop),\n+    expandable: getKeys(prop).length > 0,\n+    preview: getPreview(instance, propName, propData),\n   };\n \n   if (levelOptions.level !== undefined && levelOptions.currentLevel < levelOptions.level) {\n@@ -145,18 +184,20 @@ export const createLevelSerializedDescriptor = (\n };\n \n export const createNestedSerializedDescriptor = (\n+  instance: {},\n+  propName: string | number,\n   propData: CompositeType,\n   levelOptions: LevelOptions,\n   nodes: NestedProp[],\n-  nestedSerializer: any\n+  nestedSerializer: (instance: any, propName: string, nodes: NestedProp[], currentLevel: number, level?: number) => void\n ): Descriptor => {\n   const { type, prop } = propData;\n \n   const nestedSerializedDescriptor: Descriptor = {\n     type,\n     editable: false,\n-    expandable: Object.keys(prop).length > 0,\n-    preview: typeToDescriptorPreview[propData.type](propData.prop),\n+    expandable: getKeys(prop).length > 0,\n+    preview: getPreview(instance, propName, propData),\n   };\n \n   if (nodes && nodes.length) {\n@@ -172,39 +213,45 @@ const getNestedDescriptorValue = (\n   propData: CompositeType,\n   levelOptions: LevelOptions,\n   nodes: NestedProp[],\n-  nestedSerializer: any\n+  nestedSerializer: (\n+    instance: any,\n+    propName: string | number,\n+    nodes: NestedProp[],\n+    currentLevel: number,\n+    level?: number\n+  ) => void\n ) => {\n   const { type, prop } = propData;\n   const { currentLevel } = levelOptions;\n \n   switch (type) {\n     case PropType.Array:\n-      return nodes.map((nestedProp) => nestedSerializer(prop[nestedProp.name], nestedProp.children, currentLevel + 1));\n+      return nodes.map((nestedProp) => nestedSerializer(prop, nestedProp.name, nestedProp.children, currentLevel + 1));\n     case PropType.Object:\n       return nodes.reduce((accumulator, nestedProp) => {\n-        if (\n-          prop.hasOwnProperty(nestedProp.name) &&\n-          typeof nestedProp.name === 'string' &&\n-          !ignoreList.has(nestedProp.name)\n-        ) {\n-          accumulator[nestedProp.name] = nestedSerializer(prop[nestedProp.name], nestedProp.children, currentLevel + 1);\n+        if (prop.hasOwnProperty(nestedProp.name) && !ignoreList.has(nestedProp.name)) {\n+          accumulator[nestedProp.name] = nestedSerializer(prop, nestedProp.name, nestedProp.children, currentLevel + 1);\n         }\n         return accumulator;\n       }, {});\n   }\n };\n \n-const getLevelDescriptorValue = (propData: CompositeType, levelOptions: LevelOptions, continuation: any) => {\n+const getLevelDescriptorValue = (\n+  propData: CompositeType,\n+  levelOptions: LevelOptions,\n+  continuation: (instance: any, propName: string | number, level?: number, max?: number) => void\n+) => {\n   const { type, prop } = propData;\n   const { currentLevel, level } = levelOptions;\n \n   switch (type) {\n     case PropType.Array:\n-      return prop.map((nested: any, idx: number) => continuation(nested, idx, currentLevel + 1, level));\n+      return prop.map((_: any, idx: number) => continuation(prop, idx, currentLevel + 1, level));\n     case PropType.Object:\n-      return Object.keys(prop).reduce((accumulator, propName) => {\n-        if (typeof propName === 'string' && !ignoreList.has(propName)) {\n-          accumulator[propName] = continuation(prop[propName], propName, currentLevel + 1, level);\n+      return getKeys(prop).reduce((accumulator, propName) => {\n+        if (!ignoreList.has(propName)) {\n+          accumulator[propName] = continuation(prop, propName, currentLevel + 1, level);\n         }\n         return accumulator;\n       }, {});"
        },
        {
            "sha": "95dda329af9a11baef6e1118c005ba2d963f147c",
            "filename": "projects/ng-devtools-backend/src/lib/state-serializer/state-serializer.spec.ts",
            "status": "modified",
            "additions": 279,
            "deletions": 73,
            "changes": 352,
            "blob_url": "https://github.com/angular/angular/blob/a7f656215833df41c5637b1cca95abc495d6680d/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2Fstate-serializer.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/a7f656215833df41c5637b1cca95abc495d6680d/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2Fstate-serializer.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2Fstate-serializer.spec.ts?ref=a7f656215833df41c5637b1cca95abc495d6680d",
            "patch": "@@ -1,4 +1,5 @@\n-import { nestedSerializer } from './state-serializer';\n+import { deeplySerializeSelectedProperties } from './state-serializer';\n+import { PropType } from 'protocol';\n \n const QUERY_1_1 = [];\n \n@@ -16,7 +17,7 @@ const QUERY_1_2 = [\n                 name: 0,\n                 children: [\n                   {\n-                    name: 'nested',\n+                    name: 'two',\n                   },\n                 ],\n               },\n@@ -61,83 +62,88 @@ const dir2 = {\n   },\n };\n \n-describe('nestedSerializer', () => {\n+describe('deeplySerializeSelectedProperties', () => {\n   it('should work with empty queries', () => {\n-    const result = nestedSerializer(dir1, QUERY_1_1);\n+    const result = deeplySerializeSelectedProperties(dir1, QUERY_1_1);\n     expect(result).toEqual({\n-      type: 9,\n-      value: {\n-        one: {\n-          type: 0,\n-          value: 1,\n-          editable: true,\n-          expandable: false,\n-          preview: '1',\n-        },\n-        nested: {\n-          type: 9,\n-          editable: false,\n-          expandable: true,\n-          preview: '{...}',\n+      one: {\n+        type: PropType.Number,\n+        expandable: false,\n+        editable: true,\n+        preview: '1',\n+        value: 1,\n+      },\n+      nested: {\n+        type: PropType.Object,\n+        editable: false,\n+        expandable: true,\n+        preview: '{...}',\n+        value: {\n+          arr: {\n+            type: PropType.Array,\n+            expandable: true,\n+            editable: false,\n+            preview: 'Array(3)',\n+          },\n         },\n       },\n-      editable: false,\n-      expandable: true,\n-      preview: '{...}',\n     });\n   });\n \n   it('should collect not specified but existing props below level', () => {\n-    expect(nestedSerializer(dir1, QUERY_1_2)).toEqual({\n-      type: 9,\n-      value: {\n-        one: {\n-          type: 0,\n-          value: 1,\n-          editable: true,\n-          expandable: false,\n-          preview: '1',\n-        },\n-        nested: {\n-          type: 9,\n-          editable: false,\n-          expandable: true,\n-          preview: '{...}',\n-          value: {\n-            arr: {\n-              type: 11,\n-              editable: false,\n-              expandable: true,\n-              preview: 'Array(3)',\n-              value: [\n-                {\n-                  type: 11,\n-                  editable: false,\n-                  expandable: true,\n-                  preview: 'Array(1)',\n-                  value: [\n-                    {\n-                      type: 9,\n-                      editable: false,\n-                      expandable: true,\n-                      preview: '{...}',\n-                      value: {},\n+    const result = deeplySerializeSelectedProperties(dir1, QUERY_1_2);\n+    expect(result).toEqual({\n+      one: {\n+        type: PropType.Number,\n+        expandable: false,\n+        editable: true,\n+        preview: '1',\n+        value: 1,\n+      },\n+      nested: {\n+        type: PropType.Object,\n+        editable: false,\n+        expandable: true,\n+        preview: '{...}',\n+        value: {\n+          arr: {\n+            type: PropType.Array,\n+            editable: false,\n+            expandable: true,\n+            preview: 'Array(3)',\n+            value: [\n+              {\n+                type: PropType.Array,\n+                editable: false,\n+                expandable: true,\n+                preview: 'Array(1)',\n+                value: [\n+                  {\n+                    type: PropType.Object,\n+                    editable: false,\n+                    expandable: true,\n+                    preview: '{...}',\n+                    value: {\n+                      two: {\n+                        type: PropType.Number,\n+                        expandable: false,\n+                        editable: true,\n+                        preview: '1',\n+                        value: 1,\n+                      },\n                     },\n-                  ],\n-                },\n-              ],\n-            },\n+                  },\n+                ],\n+              },\n+            ],\n           },\n         },\n       },\n-      editable: false,\n-      expandable: true,\n-      preview: '{...}',\n     });\n   });\n \n   it('should handle deletions even of the query asks for such props', () => {\n-    const result = nestedSerializer(dir2, [\n+    const result = deeplySerializeSelectedProperties(dir2, [\n       {\n         name: 'one',\n         children: [],\n@@ -148,18 +154,218 @@ describe('nestedSerializer', () => {\n       },\n     ]);\n     expect(result).toEqual({\n-      type: 9,\n-      value: {\n-        nested: {\n-          type: 9,\n-          editable: false,\n-          expandable: true,\n-          preview: '{...}',\n+      nested: {\n+        type: PropType.Object,\n+        editable: false,\n+        expandable: true,\n+        preview: '{...}',\n+        value: {\n+          arr: {\n+            type: PropType.Array,\n+            editable: false,\n+            expandable: true,\n+            preview: 'Array(3)',\n+          },\n+        },\n+      },\n+    });\n+  });\n+\n+  it('should work with getters', () => {\n+    const result = deeplySerializeSelectedProperties(\n+      {\n+        get foo(): any {\n+          return {\n+            baz: {\n+              qux: 3,\n+            },\n+          };\n+        },\n+      },\n+      [\n+        {\n+          name: 'foo',\n+          children: [\n+            {\n+              name: 'baz',\n+              children: [],\n+            },\n+          ],\n+        },\n+      ]\n+    );\n+    expect(result).toEqual({\n+      foo: {\n+        type: PropType.Object,\n+        editable: false,\n+        expandable: true,\n+        preview: '{...}',\n+        value: {\n+          baz: {\n+            type: PropType.Object,\n+            editable: false,\n+            expandable: true,\n+            preview: '{...}',\n+          },\n         },\n       },\n-      editable: false,\n-      expandable: true,\n-      preview: '{...}',\n+    });\n+  });\n+\n+  it('should getters should be readonly', () => {\n+    const result = deeplySerializeSelectedProperties(\n+      {\n+        get foo(): number {\n+          return 42;\n+        },\n+        get bar(): number {\n+          return 42;\n+        },\n+        set bar(val: number) {},\n+      },\n+      []\n+    );\n+    expect(result).toEqual({\n+      foo: {\n+        type: PropType.Number,\n+        expandable: false,\n+        // Not editable because\n+        // we don't have a getter.\n+        editable: false,\n+        preview: '42',\n+        value: 42,\n+      },\n+      bar: {\n+        type: PropType.Number,\n+        expandable: false,\n+        editable: true,\n+        preview: '42',\n+        value: 42,\n+      },\n+    });\n+  });\n+\n+  it('should return the precise path requested', () => {\n+    const result = deeplySerializeSelectedProperties(\n+      {\n+        state: {\n+          nested: {\n+            props: {\n+              foo: 1,\n+              bar: 2,\n+            },\n+            [Symbol(3)](): number {\n+              return 1.618;\n+            },\n+            get foo(): number {\n+              return 42;\n+            },\n+          },\n+        },\n+      },\n+      [\n+        {\n+          name: 'state',\n+          children: [\n+            {\n+              name: 'nested',\n+              children: [\n+                {\n+                  name: 'props',\n+                  children: [\n+                    {\n+                      name: 'foo',\n+                      children: [],\n+                    },\n+                    {\n+                      name: 'bar',\n+                      children: [],\n+                    },\n+                  ],\n+                },\n+                {\n+                  name: 'foo',\n+                  children: [],\n+                },\n+              ],\n+            },\n+          ],\n+        },\n+      ]\n+    );\n+    expect(result).toEqual({\n+      state: {\n+        type: PropType.Object,\n+        editable: false,\n+        expandable: true,\n+        preview: '{...}',\n+        value: {\n+          nested: {\n+            type: PropType.Object,\n+            editable: false,\n+            expandable: true,\n+            preview: '{...}',\n+            value: {\n+              props: {\n+                type: PropType.Object,\n+                editable: false,\n+                expandable: true,\n+                preview: '{...}',\n+                value: {\n+                  foo: {\n+                    type: PropType.Number,\n+                    expandable: false,\n+                    editable: true,\n+                    preview: '1',\n+                    value: 1,\n+                  },\n+                  bar: {\n+                    type: PropType.Number,\n+                    expandable: false,\n+                    editable: true,\n+                    preview: '2',\n+                    value: 2,\n+                  },\n+                },\n+              },\n+              foo: {\n+                type: PropType.Number,\n+                expandable: false,\n+                editable: false,\n+                preview: '42',\n+                value: 42,\n+              },\n+            },\n+          },\n+        },\n+      },\n+    });\n+  });\n+\n+  it('should not show setters at all when associated getters or values are unavailable', () => {\n+    const result = deeplySerializeSelectedProperties(\n+      {\n+        set foo(_: any) {},\n+        get bar(): number {\n+          return 1;\n+        },\n+      },\n+      []\n+    );\n+    expect(result).toEqual({\n+      foo: {\n+        type: PropType.Undefined,\n+        editable: false,\n+        expandable: false,\n+        preview: '[setter]',\n+      },\n+      bar: {\n+        type: PropType.Number,\n+        editable: false,\n+        expandable: false,\n+        preview: '1',\n+        value: 1,\n+      },\n     });\n   });\n });"
        },
        {
            "sha": "98f8c934cce86067e8d9fe0906395f33810b499b",
            "filename": "projects/ng-devtools-backend/src/lib/state-serializer/state-serializer.ts",
            "status": "modified",
            "additions": 35,
            "deletions": 31,
            "changes": 66,
            "blob_url": "https://github.com/angular/angular/blob/a7f656215833df41c5637b1cca95abc495d6680d/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2Fstate-serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/a7f656215833df41c5637b1cca95abc495d6680d/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2Fstate-serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/projects%2Fng-devtools-backend%2Fsrc%2Flib%2Fstate-serializer%2Fstate-serializer.ts?ref=a7f656215833df41c5637b1cca95abc495d6680d",
            "patch": "@@ -6,6 +6,7 @@ import {\n   PropertyData,\n } from './serialized-descriptor-factory';\n import { METADATA_PROPERTY_NAME } from '../directive-forest';\n+import { getKeys } from './object-utils';\n \n const ignoreList = new Set([METADATA_PROPERTY_NAME, '__ngSimpleChanges__']);\n \n@@ -48,73 +49,76 @@ const getPropType = (prop: any): PropType => {\n   return PropType.Unknown;\n };\n \n-export const nestedSerializer = (\n-  serializableInstance: any,\n+const nestedSerializer = (\n+  instance: any,\n+  propName: string | number,\n   nodes: NestedProp[],\n   currentLevel = 0,\n   level = MAX_LEVEL\n ): Descriptor => {\n+  const serializableInstance = instance[propName];\n   const propData: PropertyData = { prop: serializableInstance, type: getPropType(serializableInstance) };\n-  const levelOptions = { level, currentLevel };\n \n   if (currentLevel < level) {\n-    return levelSerializer(\n-      serializableInstance,\n-      undefined,\n-      currentLevel,\n-      level,\n-      nestedSerializerContinuation(nodes, level)\n-    );\n+    return levelSerializer(instance, propName, currentLevel, level, nestedSerializerContinuation(nodes, level));\n   }\n \n   switch (propData.type) {\n     case PropType.Array:\n     case PropType.Object:\n-      return createNestedSerializedDescriptor(propData, levelOptions, nodes, nestedSerializer);\n+      return createNestedSerializedDescriptor(\n+        instance,\n+        propName,\n+        propData,\n+        { level, currentLevel },\n+        nodes,\n+        nestedSerializer\n+      );\n     default:\n-      return createShallowSerializedDescriptor(propData);\n+      return createShallowSerializedDescriptor(instance, propName, propData);\n   }\n };\n \n const nestedSerializerContinuation = (nodes: NestedProp[], level: number) => (\n-  nestedProp: any,\n-  propName: string | number | undefined,\n+  instance: any,\n+  propName: string,\n   nestedLevel: number\n ) => {\n   const idx = nodes.findIndex((v) => v.name === propName);\n   if (idx < 0) {\n     // The property is not specified in the query.\n-    return nestedSerializer(nestedProp, [], nestedLevel, level);\n+    return nestedSerializer(instance, propName, [], nestedLevel, level);\n   }\n-  return nestedSerializer(nestedProp, nodes[idx].children, nestedLevel, level);\n+  return nestedSerializer(instance, propName, nodes[idx].children, nestedLevel, level);\n };\n \n-export const levelSerializer = (\n-  serializableInstance: any,\n-  _: string | number | undefined = undefined,\n+const levelSerializer = (\n+  instance: any,\n+  propName: string | number,\n   currentLevel = 0,\n   level = MAX_LEVEL,\n   continuation = levelSerializer\n ): Descriptor => {\n+  const serializableInstance = instance[propName];\n   const propData: PropertyData = { prop: serializableInstance, type: getPropType(serializableInstance) };\n-  const levelOptions = { level, currentLevel };\n \n   switch (propData.type) {\n     case PropType.Array:\n     case PropType.Object:\n-      return createLevelSerializedDescriptor(propData, levelOptions, continuation);\n+      return createLevelSerializedDescriptor(instance, propName, propData, { level, currentLevel }, continuation);\n     default:\n-      return createShallowSerializedDescriptor(propData);\n+      return createShallowSerializedDescriptor(instance, propName, propData);\n   }\n };\n \n export const serializeDirectiveState = (instance: object, levels = MAX_LEVEL): { [key: string]: Descriptor } => {\n   const result = {};\n-  for (const prop in instance) {\n-    if (instance.hasOwnProperty(prop) && !ignoreList.has(prop)) {\n-      result[prop] = levelSerializer(instance[prop], null, 0, levels);\n+  getKeys(instance).forEach((prop) => {\n+    if (typeof prop === 'string' && ignoreList.has(prop)) {\n+      return;\n     }\n-  }\n+    result[prop] = levelSerializer(instance, prop, null, 0, levels);\n+  });\n   return result;\n };\n \n@@ -123,15 +127,15 @@ export const deeplySerializeSelectedProperties = (\n   props: NestedProp[]\n ): { [name: string]: Descriptor } => {\n   const result = {};\n-  Object.keys(instance).forEach((propName) => {\n-    if (ignoreList.has(propName)) {\n+  getKeys(instance).forEach((prop) => {\n+    if (ignoreList.has(prop)) {\n       return;\n     }\n-    const idx = props.findIndex((v) => v.name === propName);\n+    const idx = props.findIndex((v) => v.name === prop);\n     if (idx < 0) {\n-      result[propName] = levelSerializer(instance[propName]);\n+      result[prop] = levelSerializer(instance, prop);\n     } else {\n-      result[propName] = nestedSerializer(instance[propName], props[idx].children);\n+      result[prop] = nestedSerializer(instance, prop, props[idx].children);\n     }\n   });\n   return result;"
        },
        {
            "sha": "c382123a1e516d901f39e9f223dfaf38901973fb",
            "filename": "src/app/demo-app/heavy/heavy.component.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/a7f656215833df41c5637b1cca95abc495d6680d/src%2Fapp%2Fdemo-app%2Fheavy%2Fheavy.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/a7f656215833df41c5637b1cca95abc495d6680d/src%2Fapp%2Fdemo-app%2Fheavy%2Fheavy.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/src%2Fapp%2Fdemo-app%2Fheavy%2Fheavy.component.ts?ref=a7f656215833df41c5637b1cca95abc495d6680d",
            "patch": "@@ -1,4 +1,4 @@\n-import { Component } from '@angular/core';\n+import { Component, Input } from '@angular/core';\n \n const fib = (n: number) => {\n   if (n === 1 || n === 2) {\n@@ -13,12 +13,20 @@ const fib = (n: number) => {\n   styleUrls: ['./heavy.component.scss'],\n })\n export class HeavyComponent {\n+  @Input() set foo(_: any) {}\n+\n   state = {\n     nested: {\n       props: {\n         foo: 1,\n         bar: 2,\n       },\n+      [Symbol(3)](): number {\n+        return 1.618;\n+      },\n+      get foo(): number {\n+        return 42;\n+      },\n     },\n   };\n   calculate(): number {"
        }
    ],
    "stats": {
        "total": 541,
        "additions": 411,
        "deletions": 130
    }
}