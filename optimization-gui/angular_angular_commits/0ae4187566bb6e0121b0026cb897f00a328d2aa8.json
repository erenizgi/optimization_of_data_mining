{
    "author": "dario-piotrowicz",
    "message": "refactor(docs-infra): remove eslint directive comments from examples (#43831)\n\nLinting has recently been removed from the examples provided in angular.io\n(see PRs #43592 and #43746) such removal effects the downloadable and\nstackblitz examples but linting is still generally used in the examples\nin the aio project itself (they are being migrated from tslint to eslint in\nPR #43218) thus eslint directive comments are still necessary in the code itself.\n\nSo the comments need to be present but need not to be exposed to the users\n(not in the zips, stackblitzes nor docs themselves), these changes are\nremoving such comments during the examples' parsing phase (effectively\nremoving them from all three sources mentioned above).\n\nOriginal discussion: https://github.com/angular/angular/pull/43218#discussion_r697305494\n\nresolves #43788\n\nPR Close #43831",
    "sha": "0ae4187566bb6e0121b0026cb897f00a328d2aa8",
    "files": [
        {
            "sha": "cdbd2c2f46af5c4a6d4541288304a303c6fc757b",
            "filename": "aio/tools/transforms/examples-package/services/region-parser.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/0ae4187566bb6e0121b0026cb897f00a328d2aa8/aio%2Ftools%2Ftransforms%2Fexamples-package%2Fservices%2Fregion-parser.js",
            "raw_url": "https://github.com/angular/angular/raw/0ae4187566bb6e0121b0026cb897f00a328d2aa8/aio%2Ftools%2Ftransforms%2Fexamples-package%2Fservices%2Fregion-parser.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fexamples-package%2Fservices%2Fregion-parser.js?ref=0ae4187566bb6e0121b0026cb897f00a328d2aa8",
            "patch": "@@ -5,6 +5,7 @@ const inlineCOnly = require('./region-matchers/inline-c-only');\n const inlineHash = require('./region-matchers/inline-hash');\n const DEFAULT_PLASTER = '. . .';\n const {mapObject} = require('../../helpers/utils');\n+const removeEslintComments = require('./removeEslintComments');\n \n module.exports = function regionParser() {\n   regionParserImpl.regionMatchers = {\n@@ -40,7 +41,7 @@ module.exports = function regionParser() {\n \n     if (regionMatcher) {\n       let plaster = regionMatcher.createPlasterComment(DEFAULT_PLASTER);\n-      const lines = contents.split(/\\r?\\n/).filter((line, index) => {\n+      const lines = removeEslintComments(contents, fileType).split(/\\r?\\n/).filter((line, index) => {\n         const startRegion = line.match(regionMatcher.regionStartMatcher);\n         const endRegion = line.match(regionMatcher.regionEndMatcher);\n         const updatePlaster = line.match(regionMatcher.plasterMatcher);"
        },
        {
            "sha": "08b1efee0dfef44c2bab830b8e803bc5780cded1",
            "filename": "aio/tools/transforms/examples-package/services/removeEslintComments.js",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/0ae4187566bb6e0121b0026cb897f00a328d2aa8/aio%2Ftools%2Ftransforms%2Fexamples-package%2Fservices%2FremoveEslintComments.js",
            "raw_url": "https://github.com/angular/angular/raw/0ae4187566bb6e0121b0026cb897f00a328d2aa8/aio%2Ftools%2Ftransforms%2Fexamples-package%2Fservices%2FremoveEslintComments.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fexamples-package%2Fservices%2FremoveEslintComments.js?ref=0ae4187566bb6e0121b0026cb897f00a328d2aa8",
            "patch": "@@ -0,0 +1,32 @@\n+module.exports = function removeEslintComments(input, fileType) {\n+  const regexForFileType = regexesForFileTypes[fileType];\n+\n+  if (!input || !regexForFileType) {\n+    return input;\n+  }\n+\n+  return input.replace(regexForFileType, '');\n+};\n+\n+const jsRegexes = [\n+  /\\/\\/ *eslint-disable(?:-next-line)?(?: .*)?(?:\\n *|$)/,\n+  /\\n? *\\/\\/ *eslint-(?:disable-line|enable)(?: .*)?(?=\\n|$)/,\n+  /\\/\\*\\s*eslint-disable(?:-next-line)?(?: [\\s\\S]*?)?\\*\\/ *(?:\\n *)?/,\n+  /\\n? *\\/\\*\\s*eslint-(?:disable-line|enable)(?: [\\s\\S]*?)?\\*\\//,\n+];\n+\n+const htmlRegexes = [\n+  /<!--\\s*eslint-disable(?:-next-line)?(?: [\\s\\S]*?)?--> *(?:\\n *)?/,\n+  /\\n? *<!--\\s*eslint-(?:disable-line|enable)(?: [\\s\\S]*?)?-->/,\n+];\n+\n+const joinRegexes = regexes => new RegExp(regexes.map(regex => `(?:${regex.source})`).join('|'), 'g');\n+const htmlRegex = joinRegexes(htmlRegexes);\n+// Note: the js regex needs to also include the html ones to account for inline templates in @Components\n+const jsRegex = joinRegexes([...jsRegexes, ...htmlRegexes]);\n+\n+const regexesForFileTypes = {\n+  js: jsRegex,\n+  ts: jsRegex,\n+  html: htmlRegex,\n+};"
        },
        {
            "sha": "bc2cc899e51b9bd79c91702555fe61546a933108",
            "filename": "aio/tools/transforms/examples-package/services/removeEslintComments.spec.js",
            "status": "added",
            "additions": 322,
            "deletions": 0,
            "changes": 322,
            "blob_url": "https://github.com/angular/angular/blob/0ae4187566bb6e0121b0026cb897f00a328d2aa8/aio%2Ftools%2Ftransforms%2Fexamples-package%2Fservices%2FremoveEslintComments.spec.js",
            "raw_url": "https://github.com/angular/angular/raw/0ae4187566bb6e0121b0026cb897f00a328d2aa8/aio%2Ftools%2Ftransforms%2Fexamples-package%2Fservices%2FremoveEslintComments.spec.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Ftransforms%2Fexamples-package%2Fservices%2FremoveEslintComments.spec.js?ref=0ae4187566bb6e0121b0026cb897f00a328d2aa8",
            "patch": "@@ -0,0 +1,322 @@\n+/* eslint-disable jasmine/no-spec-dupes */\n+const removeEslintComments = require('./removeEslintComments');\n+\n+describe('removeEslintComments', () => {\n+\n+  it('should return the given input if that is null or undefined', () => {\n+    expect(removeEslintComments(null, 'ts')).toEqual(null);\n+    expect(removeEslintComments(undefined, 'html')).toEqual(undefined);\n+  });\n+\n+  it('should return the given input if the provided fileType is neither js, ts nor html', () => {\n+    const testText = `\n+      Simple text containing comments js comments like:\n+        /* eslint-disable */\n+      and html ones like:\n+        <!-- eslint-disable-line -->\n+    `;\n+    expect(removeEslintComments(testText)).toEqual(testText);\n+    expect(removeEslintComments(testText, 'css')).toEqual(testText);\n+    expect(removeEslintComments(testText, 'json')).toEqual(testText);\n+  });\n+\n+  describe('js and ts', () => {\n+    const rmv = source => removeEslintComments(source, 'ts');\n+\n+    it('should remove correctly eslint-disable comments', () => {\n+      let source = `/* eslint-disable @angular-eslint/no-input-rename,\n+      @angular-eslint/no-inputs-metadata-property,\n+      @angular-eslint/no-output-rename,\n+      @angular-eslint/no-outputs-metadata-property */\n+      import { Component, EventEmitter, Input, Output } from '@angular/core';\n+\n+      @Component({\n+      `;\n+      expect(rmv(source)).toMatch(\n+        createRegexForMatching(\n+        'import { Component, EventEmitter, Input, Output } from \\'@angular/core\\';\\n\\n {6}@Component({\\n {6}'\n+        )\n+      );\n+      source = `/* eslint-disable foo */\n+          var foo = 'foo';`;\n+      expect(rmv(source)).toEqual('var foo = \\'foo\\';');\n+      source = `/* eslint-disable foo, bar, baz */\n+          var fooBarBaz = 'foo, bar and baz';`;\n+      expect(rmv(source)).toEqual('var fooBarBaz = \\'foo, bar and baz\\';');\n+    });\n+\n+    it('should remove correctly eslint-enable and eslint-disable comments', () => {\n+      const source = `\n+        /* eslint-disable */\n+        import { test } from './test';\n+        if ( test != null ) {\n+        /* eslint-enable */\n+      `;\n+      expect(rmv(source)).toMatch(\n+        createRegexForMatching(\n+          '\\n {8}import { test } from \\'./test\\';\\n {8}if ( test != null ) {\\n {6}'\n+        )\n+      );\n+    });\n+\n+    it('should remove correctly eslint-disable-line comments', () => {\n+      let source = 'var i = 1; // eslint-disable-line no-var';\n+      expect(rmv(source)).toEqual('var i = 1;');\n+      source = 'const foo = \"foo\";// eslint-disable-line';\n+      expect(rmv(source)).toEqual('const foo = \"foo\";');\n+      source = 'const bar = 123; /* eslint-disable-line no-unused-vars */';\n+      expect(rmv(source)).toEqual('const bar = 123;');\n+      source = 'var baz = false; /* eslint-disable-line no-unused-vars, no-var */';\n+      expect(rmv(source)).toEqual('var baz = false;');\n+    });\n+\n+    it('should remove correctly eslint-disable-next-line comments', () => {\n+      let source = `// eslint-disable-next-line @typescript-eslint/quotes\n+      const string = \"string test\";`;\n+      expect(rmv(source)).toEqual('const string = \"string test\";');\n+      source = '// eslint-disable-next-line foo';\n+      expect(rmv(source)).toEqual('');\n+      source = `// eslint-disable-next-line no-console, quotes\n+      console.log(\"log test\");`;\n+      expect(rmv(source)).toEqual('console.log(\"log test\");');\n+    });\n+\n+    it('should remove correctly a mix of different types of eslint comments', () => {\n+      let source = `\n+      /* eslint-disable */\n+      var mixed1 = 'test';\n+      /* eslint-enable */\n+      mixed1 = \"test1\"; // eslint-disable-line semi, quotes\n+\n+      // eslint-disable-next-line eqeqeq\n+      return mixed1 == 'test';\n+      `;\n+      expect(rmv(source)).toMatch(\n+        createRegexForMatching(\n+          '\\n {6}var mixed1 = \\'test\\';\\n {6}mixed1 = \"test1\";\\n\\n {6}return mixed1 == \\'test\\';\\n {6}'\n+        )\n+      );\n+      source = `\n+      /* eslint-enable *//* eslint-disable */\n+      var mixed2 = \"test\"; // eslint-disable-line\n+      /* eslint-disable */\n+      // eslint-disable-next-line\n+      console.log(mixed2);\n+      /* eslint-enable */\n+      `;\n+      expect(rmv(source)).toMatch(\n+        createRegexForMatching('var mixed2 = \"test\";\\n {6}console.log(mixed2);\\n {6}')\n+      );\n+    });\n+\n+    it('should handle any number of spaces around the eslint directive', () => {\n+      let source = `// eslint-disable-next-line        no-vars\n+        var v1 = 123;\n+      `;\n+      expect(rmv(source)).toMatch(createRegexForMatching('var v1 = 123;\\n {6}'));\n+      source = 'var v2 = 234;//eslint-disable-line     ';\n+      expect(rmv(source)).toEqual('var v2 = 234;');\n+      source = 'var v3 = 345;//                 eslint-disable-line     no-vars';\n+      expect(rmv(source)).toEqual('var v3 = 345;');\n+      source = `     /*        eslint-disable no-vars              */\n+        var v4 = 456;\n+        /*eslint-enable no-vars*/\n+        `;\n+      expect(rmv(source)).toMatch(createRegexForMatching(' {5}var v4 = 456;\\n {8}'));\n+      source = `/*eslint-disable foo*/\n+        var v5 = 567;`;\n+      expect(rmv(source)).toEqual('var v5 = 567;');\n+    });\n+\n+    it('should ignore generic comments containing eslint terms', () => {\n+      let source = `\n+        /* this is not an eslint-disable comment */\n+        // and this is not an eslint-disable-line comment\n+        // this isn't an eslint comment at all\n+        `;\n+      expect(rmv(source)).toEqual(source);\n+    });\n+\n+    it('should ignore incorrect eslint comments', () => {\n+      const source = `\n+        /* eslint-disable-nonsense */\n+        // eslint-disable-next line\n+        // eslint-disable-next-line-nonsense\n+        // eslint-disable-line-nonsense\n+        // eslint-disable--next-line\n+        /* eslint disable */\n+        // eslint-enable-line\n+        // eslint-enable-next-line\n+      `;\n+      expect(rmv(source)).toEqual(source);\n+    });\n+\n+    it('should remove html eslint comments', () => {\n+      const source = `\n+        import { Component, OnInit, Input } from '@angular/core';\n+\n+        @Component({\n+          selector: 'app-test',\n+          template: \\`\n+            <!-- eslint-disable @angular-eslint/template/eqeqeq -->\n+            <p *ngIf=\"eslintTest != null\" (click)=\"eslintTest()\"> <!-- eslint-disable-line @angular-eslint/template/eqeqeq -->\n+              run eslint test\n+            </p>\n+          \\`,\n+          styles: []\n+        })\n+        export class TestComponent implements OnInit {\n+          @Input() eslintTest: () => {};\n+      `;\n+      expect(rmv(source)).toMatch(\n+        createRegexForMatching(\n+          '\\n {8}import { Component, OnInit, Input } from \\'@angular/core\\';\\n\\n {8}@Component({\\n' +\n+          ' {10}selector: \\'app-test\\',\\n {10}template: `\\n' +\n+          ' {12}<p *ngIf=\"eslintTest != null\" (click)=\"eslintTest()\">\\n' +\n+          ' {14}run eslint test\\n {12}</p>\\n {10}`,\\n {10}styles: []\\n {8}})\\n' +\n+          ' {8}export class TestComponent implements OnInit {\\n' +\n+          ' {10}@Input() eslintTest: () => {};\\n {6}'\n+        )\n+      );\n+    });\n+\n+    it('should remove correctly eslint directive comments containing descriptions', () => {\n+      let source = `// eslint-disable-next-line a-rule, another-rule -- those are buggy!!\n+      const aRule = \"another-rule\";`;\n+      expect(rmv(source)).toEqual('const aRule = \"another-rule\";');\n+      source = `/* eslint-disable max-len, no-var --\n+        Disabling the rule is necessary here because we have\n+        variables declared with var which contain very long strings\n+      */\n+\n+      export class Utils {`;\n+      expect(rmv(source)).toMatch(createRegexForMatching('\\n {6}export class Utils {'));\n+    });\n+\n+  });\n+\n+  describe('html', () => {\n+    const rmv = source => removeEslintComments(source, 'html');\n+\n+    it('should remove correctly eslint-disable comments', () => {\n+      const source = `<!-- eslint-disable @angular-eslint/template/eqeqeq,\n+                              @angular-eslint/template/accessibility-alt-text -->\n+                          <img *ngIf=\"src == null\" scr=\"test\" />`;\n+      expect(rmv(source)).toEqual('<img *ngIf=\"src == null\" scr=\"test\" />');\n+    });\n+\n+    it('should remove correctly eslint-enable and eslint-disable comments', () => {\n+      const source = `<!-- eslint-disable @angular-eslint/template/accessibility-alt-text -->\n+      <img scr=\"test1\" />\n+      <!-- eslint-enable @angular-eslint/template/accessibility-alt-text -->`;\n+      expect(rmv(source)).toEqual('<img scr=\"test1\" />');\n+    });\n+\n+    it('should remove correctly eslint-disable-line comments', () => {\n+      let source = '<span *ngIf=\"i == 8\">eight</span> <!-- eslint-disable-line @angular-eslint/template/eqeqeq -->';\n+      expect(rmv(source)).toEqual('<span *ngIf=\"i == 8\">eight</span>');\n+      source = '<span *ngIf=\"i == 9\">nine</span><!-- eslint-disable-line -->';\n+      expect(rmv(source)).toEqual('<span *ngIf=\"i == 9\">nine</span>');\n+      source = `<div *ngIf=\"i == 10\"> <!-- eslint-disable-line -->\n+        <label>Ten</label>\n+      </div>`;\n+      expect(rmv(source)).toMatch(createRegexForMatching('<div *ngIf=\"i == 10\">\\n {8}<label>Ten</label>\\n {6}</div>'));\n+    });\n+\n+    it('should remove correctly eslint-disable-next-line comments', () => {\n+      const source = `<!-- eslint-disable-next-line @angular-eslint/template/click-events-have-key-events -->\n+      <a (click)=\"onClick()\">disable-next-line link</a>`;\n+      expect(rmv(source)).toEqual('<a (click)=\"onClick()\">disable-next-line link</a>');\n+    });\n+\n+    it('should remove correctly a mix of different types of eslint comments', () => {\n+      let source = `\n+      <!-- eslint-disable -->\n+      <!-- eslint-disable-next-line @angular-eslint/template/click-events-have-key-events -->\n+      <a (click)=\"onClick()\"> mixed1 </a> <!-- eslint-disable-line -->\n+      <!-- eslint-enable -->\n+      `;\n+      expect(rmv(source)).toMatch(createRegexForMatching('\\n {6}<a (click)=\"onClick()\"> mixed1 </a>\\n {6}'));\n+      source = `\n+      <!-- eslint-disable --><!-- eslint-disable -->\n+      <a (click)=\"onClick()\"> mixed2 </a> <!-- eslint-disable-line -->\n+      `;\n+      expect(rmv(source)).toMatch(createRegexForMatching('\\n {6}<a (click)=\"onClick()\"> mixed2 </a>\\n {6}'));\n+    });\n+\n+    it('should handle any number of spaces around the eslint directive', () => {\n+      let source = '<label>label outside a form</label><!--eslint-disable-line-->';\n+      expect(rmv(source)).toEqual('<label>label outside a form</label>');\n+      source = `<!--   eslint-disable-next-line     @angular-eslint/template/click-events-have-key-events -->\n+      <div (click)=\"click()\" class=\"not-a-real-btn\">click me</div>`;\n+      expect(rmv(source)).toEqual('<div (click)=\"click()\" class=\"not-a-real-btn\">click me</div>');\n+      source = `<!--eslint-disable-next-line-->\n+      <label>another label outside a form</label>`;\n+      expect(rmv(source)).toEqual('<label>another label outside a form</label>');\n+    });\n+\n+    it('should ignore generic comments containing eslint terms', () => {\n+      let source = '<p *ngIf=\"text == null\">{{ text }}</p> <!-- this like could be disabled with an eslint-disable-line comment -->';\n+      expect(rmv(source)).toEqual(source);\n+      source = `<!-- eslint-disable -->\n+        <!-- eslint ignores this next line -->\n+        <label>this label is not in a form, eslint should complain</label>\n+      <!-- eslint-enable -->`;\n+      expect(rmv(source)).toMatch(\n+        createRegexForMatching(\n+        '<!-- eslint ignores this next line -->\\n {8}<label>this label is not in a form, eslint should complain</label>'\n+        )\n+      );\n+      source = `<!-- eslint-disable foo, bar, baz -->\n+        <p>Foo, Bar and Baz</p>\n+      <!-- eslint-enable -->`;\n+      expect(rmv(source)).toEqual('<p>Foo, Bar and Baz</p>');\n+    });\n+\n+    it('should ignore incorrect eslint comments', () => {\n+      const source = `\n+        <!-- eslint-disable-nonsense -->\n+        <!-- eslint-disable-next line -->\n+        <!-- eslint-disable-next-line-nonsense -->\n+        <!-- eslint-disable-line-nonsense -->\n+        <!-- eslint-disable--next-line -->\n+        <!-- eslint disable -->\n+        <!-- eslint-enable-line -->\n+        <!-- eslint-enable-next-line -->\n+      `;\n+      expect(rmv(source)).toEqual(source);\n+    });\n+\n+    it('should remove correctly eslint directive comments containing descriptions', () => {\n+      let source = `<!-- eslint-disable-next-line foo -- the following span needs to violate foo for business reasons -->\n+      <span>violating foo</span>`;\n+      expect(rmv(source)).toEqual('<span>violating foo</span>');\n+      source = `\n+      <!-- eslint-disable foo, bar, baz\n+        --\n+        This whole template does not respect rules foo, bar and baz,\n+        a task for refactoring it has been added to the backlog for\n+        now we just eslint-disable foo, bar and baz for the whole file\n+      -->\n+\n+      <main>`;\n+      expect(rmv(source)).toMatch(createRegexForMatching('\\n {6}\\n {6}<main>'));\n+    });\n+\n+  });\n+\n+});\n+\n+/**\n+ * Creates a regex based on a provided string, it performs a partial escape\n+ * of its special characters excluding curly braces surrounding a number so that it\n+ * converts a string such as \"if(test) {3}{ }\" to the regex /if\\(test\\) {3}\\{ \\}/,\n+ * it also surrounds the regex with ^ and $ (for stricter checkings)\n+ *\n+ * @param str input string\n+ * @returns output regex\n+ */\n+function createRegexForMatching(str) {\n+  const partiallyEscapedString = str.replace(/(?:[.?*+\\\\|^$()[\\]])|{(?!\\d+})|(?<!{\\d+)}/g, '\\\\$&');\n+  return new RegExp(`^${partiallyEscapedString}$`);\n+}"
        }
    ],
    "stats": {
        "total": 357,
        "additions": 356,
        "deletions": 1
    }
}