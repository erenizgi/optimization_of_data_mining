{
    "author": "mhevery",
    "message": "refactor(core): Remove the need for explicit static query instruction (#40091)\n\nBecause the query now has `flags` which specify the mode, the static query\ninstruction can now be remove. It is simply normal query with `static` flag.\n\nPR Close #40091",
    "sha": "d5161138032c54057d819a8fd52159ce5b75ac18",
    "files": [
        {
            "sha": "fc72d7ea21927ce9f8555eb54b0f478bd13cb27e",
            "filename": "packages/compiler-cli/ngcc/test/rendering/renderer_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Frenderer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Frenderer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Frenderer_spec.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -570,7 +570,7 @@ A.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: A, selectors: [[\"\", \"a\", \"\"]] });`\n UndecoratedBase.ɵfac = function UndecoratedBase_Factory(t) { return new (t || UndecoratedBase)(); };\n // TRANSPILED\n UndecoratedBase.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: UndecoratedBase, viewQuery: function UndecoratedBase_Query(rf, ctx) { if (rf & 1) {\n-        ɵngcc0.ɵɵstaticViewQuery(_c0, true);\n+        ɵngcc0.ɵɵviewQuery(_c0, 3);\n     } if (rf & 2) {\n         let _t;\n         ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.test = _t.first);"
        },
        {
            "sha": "c919901e243b5c134a627ed23a9b5ee5995c3b0c",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/static_content_query.js",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fstatic_content_query.js",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fstatic_content_query.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fstatic_content_query.js?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -3,8 +3,9 @@ ContentQueryComponent.ɵcmp = $r3$.ɵɵdefineComponent({\n   selectors: [[\"content-query-component\"]],\n   contentQueries: function ContentQueryComponent_ContentQueries(rf, ctx, dirIndex) {\n     if (rf & 1) {\n-    $r3$.ɵɵstaticContentQuery(dirIndex, SomeDirective, 3);\n-    $r3$.ɵɵcontentQuery(dirIndex, $ref0$, 1);\n+      $r3$.ɵɵcontentQuery(\n+          dirIndex, SomeDirective, __QueryFlags.isStatic__|__QueryFlags.descendants__);\n+      $r3$.ɵɵcontentQuery(dirIndex, $ref0$, 1);\n     }\n     if (rf & 2) {\n     let $tmp$;"
        },
        {
            "sha": "46c3646ff25e00e16c8c01a8f846c5673b08e5fb",
            "filename": "packages/compiler-cli/test/compliance/test_cases/r3_compiler_compliance/components_and_directives/queries/static_view_query.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fstatic_view_query.js",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fstatic_view_query.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_cases%2Fr3_compiler_compliance%2Fcomponents_and_directives%2Fqueries%2Fstatic_view_query.js?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -5,7 +5,7 @@ ViewQueryComponent.ɵcmp = $r3$.ɵɵdefineComponent({\n   selectors: [[\"view-query-component\"]],\n   viewQuery: function ViewQueryComponent_Query(rf, ctx) {\n     if (rf & 1) {\n-      $r3$.ɵɵstaticViewQuery(SomeDirective, 3);\n+      $r3$.ɵɵviewQuery(SomeDirective, __QueryFlags.isStatic__|__QueryFlags.descendants__);\n       $r3$.ɵɵviewQuery($refs$, 1);\n     }\n     if (rf & 2) {"
        },
        {
            "sha": "78234c85e36a3a9c413fec365d35f747c915789c",
            "filename": "packages/compiler-cli/test/compliance/test_helpers/expected_file_macros.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fexpected_file_macros.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fexpected_file_macros.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fexpected_file_macros.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n import {AttributeMarker, SelectorFlags} from '@angular/compiler/src/core';\n+import {QueryFlags} from '@angular/compiler/src/render3/view/compiler';\n import {i18nIcuMsg, i18nMsg, i18nMsgWithPostprocess, Placeholder} from './i18n_helpers';\n \n const EXPECTED_FILE_MACROS: [RegExp, (...args: string[]) => string][] = [\n@@ -35,6 +36,9 @@ const EXPECTED_FILE_MACROS: [RegExp, (...args: string[]) => string][] = [\n \n   // E.g. `__SelectorFlags.ELEMENT__`\n   flagUnion(/__SelectorFlags\\.([^_]+)__/, (_match, member) => getSelectorFlag(member)),\n+\n+  // E.g. `__QueryFlags.ELEMENT__`\n+  flagUnion(/__QueryFlags\\.([^_]+)__/, (_match, member) => getQueryFlag(member)),\n ];\n \n /**\n@@ -107,6 +111,21 @@ function getSelectorFlag(member: string): number {\n   return marker;\n }\n \n+const QueryFlagsMap: Record<string, QueryFlags> = {\n+  none: QueryFlags.none,\n+  descendants: QueryFlags.descendants,\n+  isStatic: QueryFlags.isStatic,\n+  emitDistinctChangesOnly: QueryFlags.emitDistinctChangesOnly,\n+};\n+\n+function getQueryFlag(member: string): number {\n+  const marker = QueryFlagsMap[member];\n+  if (typeof marker !== 'number') {\n+    throw new Error('Unknown SelectorFlag: ' + member);\n+  }\n+  return marker;\n+}\n+\n function stringParam() {\n   return /'([^']*?[^\\\\])'/;\n }"
        },
        {
            "sha": "d5a15fda76f8784c6668627b56376ca2463e2acb",
            "filename": "packages/compiler-cli/test/compliance_old/r3_compiler_compliance_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler-cli%2Ftest%2Fcompliance_old%2Fr3_compiler_compliance_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler-cli%2Ftest%2Fcompliance_old%2Fr3_compiler_compliance_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance_old%2Fr3_compiler_compliance_spec.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -1746,7 +1746,7 @@ describe('compiler compliance', () => {\n             selectors: [[\"view-query-component\"]],\n             viewQuery: function ViewQueryComponent_Query(rf, ctx) {\n               if (rf & 1) {\n-                $r3$.ɵɵstaticViewQuery(SomeDirective, 3);\n+                $r3$.ɵɵviewQuery(SomeDirective, 3);\n                 $r3$.ɵɵviewQuery($refs$, 1);\n               }\n               if (rf & 2) {\n@@ -1992,7 +1992,7 @@ describe('compiler compliance', () => {\n             selectors: [[\"content-query-component\"]],\n             contentQueries: function ContentQueryComponent_ContentQueries(rf, ctx, dirIndex) {\n               if (rf & 1) {\n-              $r3$.ɵɵstaticContentQuery(dirIndex, SomeDirective, 3);\n+              $r3$.ɵɵcontentQuery(dirIndex, SomeDirective, 3);\n               $r3$.ɵɵcontentQuery(dirIndex, $ref0$, 1);\n               }\n               if (rf & 2) {"
        },
        {
            "sha": "a588b901655018848dcc59effa0488b2862849e4",
            "filename": "packages/compiler/src/core.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler%2Fsrc%2Fcore.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler%2Fsrc%2Fcore.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcore.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -40,6 +40,7 @@ export interface Query {\n   isViewQuery: boolean;\n   selector: any;\n   static?: boolean;\n+  emitDistinctChangesOnly: boolean;\n }\n \n export const createContentChildren = makeMetadataFactory<Query>("
        },
        {
            "sha": "d3163693a8c6302f1b7037dbbae924eeab1f7bfe",
            "filename": "packages/compiler/src/render3/r3_identifiers.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_identifiers.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_identifiers.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_identifiers.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -297,8 +297,6 @@ export class Identifiers {\n \n   static queryRefresh: o.ExternalReference = {name: 'ɵɵqueryRefresh', moduleName: CORE};\n   static viewQuery: o.ExternalReference = {name: 'ɵɵviewQuery', moduleName: CORE};\n-  static staticViewQuery: o.ExternalReference = {name: 'ɵɵstaticViewQuery', moduleName: CORE};\n-  static staticContentQuery: o.ExternalReference = {name: 'ɵɵstaticContentQuery', moduleName: CORE};\n   static loadQuery: o.ExternalReference = {name: 'ɵɵloadQuery', moduleName: CORE};\n   static contentQuery: o.ExternalReference = {name: 'ɵɵcontentQuery', moduleName: CORE};\n "
        },
        {
            "sha": "20390fd70ba1b02f6fe0bacdd4e57efde2d1b9fb",
            "filename": "packages/compiler/src/render3/view/compiler.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 10,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fview%2Fcompiler.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -479,10 +479,9 @@ export const enum QueryFlags {\n  * @param query\n  */\n function toQueryFlags(query: R3QueryMetadata): number {\n-  // NOTE: Verify that changes here match\n-  return (query.descendants ? 1 /* TQueryFlags.descendants */ : 0) |\n-      (query.static ? 2 /* TQueryFlags.isStatic */ : 0) |\n-      (query.emitDistinctChangesOnly ? 4 /* TQueryFlags.emitDistinctChangesOnly */ : 0);\n+  return (query.descendants ? QueryFlags.descendants : QueryFlags.none) |\n+      (query.static ? QueryFlags.isStatic : QueryFlags.none) |\n+      (query.emitDistinctChangesOnly ? QueryFlags.emitDistinctChangesOnly : QueryFlags.none);\n }\n \n function convertAttributesToExpressions(attributes: {[name: string]: o.Expression}):\n@@ -503,11 +502,9 @@ function createContentQueriesFunction(\n   const tempAllocator = temporaryAllocator(updateStatements, TEMPORARY_NAME);\n \n   for (const query of queries) {\n-    const queryInstruction = query.static ? R3.staticContentQuery : R3.contentQuery;\n-\n     // creation, e.g. r3.contentQuery(dirIndex, somePredicate, true, null);\n     createStatements.push(\n-        o.importExpr(queryInstruction)\n+        o.importExpr(R3.contentQuery)\n             .callFn([o.variable('dirIndex'), ...prepareQueryParams(query, constantPool) as any])\n             .toStmt());\n \n@@ -587,11 +584,9 @@ function createViewQueriesFunction(\n   const tempAllocator = temporaryAllocator(updateStatements, TEMPORARY_NAME);\n \n   viewQueries.forEach((query: R3QueryMetadata) => {\n-    const queryInstruction = query.static ? R3.staticViewQuery : R3.viewQuery;\n-\n     // creation, e.g. r3.viewQuery(somePredicate, true);\n     const queryDefinition =\n-        o.importExpr(queryInstruction).callFn(prepareQueryParams(query, constantPool));\n+        o.importExpr(R3.viewQuery).callFn(prepareQueryParams(query, constantPool));\n     createStatements.push(queryDefinition.toStmt());\n \n     // update, e.g. (r3.queryRefresh(tmp = r3.loadQuery()) && (ctx.someDir = tmp));"
        },
        {
            "sha": "70975ee65cb6449ebb97bf0d5024a41dce60f900",
            "filename": "packages/core/src/core_render3_private_export.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcore_render3_private_export.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -206,8 +206,6 @@ export {\n \n   ɵɵsetComponentScope,\n   ɵɵsetNgModuleScope,\n-  ɵɵstaticContentQuery,\n-  ɵɵstaticViewQuery,\n   ɵɵstyleMap,\n   ɵɵstyleMapInterpolate1,\n   ɵɵstyleMapInterpolate2,"
        },
        {
            "sha": "c66ca022650391929a8116fb58a83a59369e8757",
            "filename": "packages/core/src/linker/element_ref.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Flinker%2Felement_ref.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Flinker%2Felement_ref.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Flinker%2Felement_ref.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -90,7 +90,6 @@ export class ElementRef<T = any> {\n /**\n  * Unwraps `ElementRef` and return the `nativeElement`.\n  *\n- * Conditionally unwrap the `ElementRef`.\n  * @param value value to unwrap\n  * @returns `nativeElement` if `ElementRef` otherwise returns value as is.\n  */"
        },
        {
            "sha": "c2bdada5babfa448f2ee2ba5d0b474a53fdacdba",
            "filename": "packages/core/src/linker/query_list.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Flinker%2Fquery_list.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Flinker%2Fquery_list.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Flinker%2Fquery_list.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -54,10 +54,6 @@ export class QueryList<T> implements Iterable<T> {\n \n   /**\n    * Returns `Observable` of `QueryList` notifying the subscriber of changes.\n-   *\n-   * NOTE: This currently points to `changesDeprecated` which incorrectly notifies of changes even\n-   * if no changes to `QueryList` have occurred. (It fires more often than it needs to.)\n-   * The implementation will change to point `changesStrict` starting with v12.\n    */\n   get changes(): Observable<any> {\n     return this._changes || (this._changes = new EventEmitter());\n@@ -151,10 +147,15 @@ export class QueryList<T> implements Iterable<T> {\n    * occurs.\n    *\n    * @param resultsTree The query results to store\n-   * @param identityAccessor Optional functions for extracting stable object identity from a value\n-   *     in the array.\n+   * @param identityAccessor Optional function for extracting stable object identity from a value\n+   *    in the array. This function is executed for each element of the query result list while\n+   *    comparing current query list with the new one (provided as a first argument of the `reset`\n+   *    function) to detect if the lists are different. If the function is not provided, elements\n+   *    are compared as is (without any pre-processing).\n    */\n   reset(resultsTree: Array<T|any[]>, identityAccessor?: (value: T) => unknown): void {\n+    // Cast to `QueryListInternal` so that we can mutate fields which are readonly for the usage of\n+    // QueryList (but not for QueryList itself.)\n     const self = this as QueryListInternal<T>;\n     (self as {dirty: boolean}).dirty = false;\n     const newResultFlat = flatten(resultsTree);\n@@ -170,7 +171,7 @@ export class QueryList<T> implements Iterable<T> {\n    * Triggers a change event by emitting on the `changes` {@link EventEmitter}.\n    */\n   notifyOnChanges(): void {\n-    if (this._changes && (this._emitDistinctChangesOnly ? this._changesDetected : true))\n+    if (this._changes && (this._changesDetected || !this._emitDistinctChangesOnly))\n       this._changes.emit(this);\n   }\n \n@@ -196,7 +197,7 @@ export class QueryList<T> implements Iterable<T> {\n /**\n  * Internal set of APIs used by the framework. (not to be made public)\n  */\n-export interface QueryListInternal<T> extends QueryList<T> {\n+interface QueryListInternal<T> extends QueryList<T> {\n   reset(a: any[]): void;\n   notifyOnChanges(): void;\n   length: number;"
        },
        {
            "sha": "182961bac6f7cbcc1f3a51e2cb967481542ce013",
            "filename": "packages/core/src/render3/index.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Frender3%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Frender3%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Findex.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -162,9 +162,6 @@ export {\n   ɵɵcontentQuery,\n   ɵɵloadQuery,\n   ɵɵqueryRefresh,\n-  ɵɵstaticContentQuery\n-,\n-  ɵɵstaticViewQuery,\n   ɵɵviewQuery} from './query';\n export {\n   ɵɵdisableBindings,"
        },
        {
            "sha": "289f1f6e1e9775c438a408278a8a768799cc2747",
            "filename": "packages/core/src/render3/jit/environment.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fenvironment.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fenvironment.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fenvironment.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -98,8 +98,6 @@ export const angularCoreEnv: {[name: string]: Function} =\n        'ɵɵpipe': r3.ɵɵpipe,\n        'ɵɵqueryRefresh': r3.ɵɵqueryRefresh,\n        'ɵɵviewQuery': r3.ɵɵviewQuery,\n-       'ɵɵstaticViewQuery': r3.ɵɵstaticViewQuery,\n-       'ɵɵstaticContentQuery': r3.ɵɵstaticContentQuery,\n        'ɵɵloadQuery': r3.ɵɵloadQuery,\n        'ɵɵcontentQuery': r3.ɵɵcontentQuery,\n        'ɵɵreference': r3.ɵɵreference,"
        },
        {
            "sha": "3cd7b47b2e246af3659f66a76b54fe3124fb1e64",
            "filename": "packages/core/src/render3/query.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 56,
            "changes": 68,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Frender3%2Fquery.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Frender3%2Fquery.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fquery.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -202,8 +202,8 @@ class TQuery_ implements TQuery {\n   }\n \n   private isApplyingToNode(tNode: TNode): boolean {\n-    const isDescend = (this.metadata.flags & QueryFlags.descendants) === QueryFlags.descendants;\n-    if (this._appliesToNextNode && !isDescend) {\n+    if (this._appliesToNextNode &&\n+        (this.metadata.flags & QueryFlags.descendants) !== QueryFlags.descendants) {\n       const declarationNodeIdx = this._declarationNodeIndex;\n       let parent = tNode.parent;\n       // Determine if a given TNode is a \"direct\" child of a node on which a content query was\n@@ -428,8 +428,9 @@ export function ɵɵqueryRefresh(queryList: QueryList<any>): boolean {\n   setCurrentQueryIndex(queryIndex + 1);\n \n   const tQuery = getTQuery(tView, queryIndex);\n-  const isStatic = (tQuery.metadata.flags & QueryFlags.isStatic) === QueryFlags.isStatic;\n-  if (queryList.dirty && (isCreationMode(lView) === isStatic)) {\n+  if (queryList.dirty &&\n+      (isCreationMode(lView) ===\n+       ((tQuery.metadata.flags & QueryFlags.isStatic) === QueryFlags.isStatic))) {\n     if (tQuery.matches === null) {\n       queryList.reset([]);\n     } else {\n@@ -445,21 +446,6 @@ export function ɵɵqueryRefresh(queryList: QueryList<any>): boolean {\n   return false;\n }\n \n-/**\n- * Creates new QueryList for a static view query.\n- *\n- * @param predicate The type for which the query will search\n- * @param flags Flags associated with the query\n- * @param read What to save in the query\n- *\n- * @codeGenApi\n- */\n-export function ɵɵstaticViewQuery<T>(\n-    predicate: Type<any>|InjectionToken<unknown>|string[], flags: QueryFlags, read?: any): void {\n-  ngDevMode && assertNumber(flags, 'Expecting flags');\n-  viewQueryInternal(getTView(), getLView(), predicate, flags | QueryFlags.isStatic, read);\n-}\n-\n /**\n  * Creates new QueryList, stores the reference in LView and returns QueryList.\n  *\n@@ -472,19 +458,14 @@ export function ɵɵstaticViewQuery<T>(\n export function ɵɵviewQuery<T>(\n     predicate: Type<any>|InjectionToken<unknown>|string[], flags: QueryFlags, read?: any): void {\n   ngDevMode && assertNumber(flags, 'Expecting flags');\n-  viewQueryInternal(getTView(), getLView(), predicate, flags, read);\n-}\n-\n-function viewQueryInternal<T>(\n-    tView: TView, lView: LView, predicate: Type<any>|InjectionToken<unknown>|string[],\n-    flags: QueryFlags, read: any): void {\n+  const tView = getTView();\n   if (tView.firstCreatePass) {\n     createTQuery(tView, new TQueryMetadata_(predicate, flags, read), -1);\n-    if (flags & QueryFlags.isStatic) {\n+    if ((flags & QueryFlags.isStatic) === QueryFlags.isStatic) {\n       tView.staticViewQueries = true;\n     }\n   }\n-  createLQuery<T>(tView, lView, flags);\n+  createLQuery<T>(tView, getLView(), flags);\n }\n \n /**\n@@ -503,42 +484,17 @@ export function ɵɵcontentQuery<T>(\n     directiveIndex: number, predicate: Type<any>|InjectionToken<unknown>|string[],\n     flags: QueryFlags, read?: any): void {\n   ngDevMode && assertNumber(flags, 'Expecting flags');\n-  contentQueryInternal(\n-      getTView(), getLView(), predicate, flags, read, false, getCurrentTNode()!, directiveIndex);\n-}\n-\n-/**\n- * Registers a QueryList, associated with a static content query, for later refresh\n- * (part of a view refresh).\n- *\n- * @param directiveIndex Current directive index\n- * @param predicate The type for which the query will search\n- * @param flags Flags associated with the query\n- * @param read What to save in the query\n- * @returns QueryList<T>\n- *\n- * @codeGenApi\n- */\n-export function ɵɵstaticContentQuery<T>(\n-    directiveIndex: number, predicate: Type<any>|InjectionToken<unknown>|string[],\n-    flags: QueryFlags, read?: any): void {\n-  ngDevMode && assertNumber(flags, 'Expecting flags');\n-  contentQueryInternal(\n-      getTView(), getLView(), predicate, flags, read, true, getCurrentTNode()!, directiveIndex);\n-}\n-\n-function contentQueryInternal<T>(\n-    tView: TView, lView: LView, predicate: Type<any>|InjectionToken<unknown>|string[],\n-    flags: QueryFlags, read: any, isStatic: boolean, tNode: TNode, directiveIndex: number): void {\n+  const tView = getTView();\n   if (tView.firstCreatePass) {\n+    const tNode = getCurrentTNode()!;\n     createTQuery(tView, new TQueryMetadata_(predicate, flags, read), tNode.index);\n     saveContentQueryAndDirectiveIndex(tView, directiveIndex);\n-    if (isStatic) {\n+    if ((flags & QueryFlags.isStatic) === QueryFlags.isStatic) {\n       tView.staticContentQueries = true;\n     }\n   }\n \n-  createLQuery<T>(tView, lView, flags);\n+  createLQuery<T>(tView, getLView(), flags);\n }\n \n /**"
        },
        {
            "sha": "747f476977d9623a92d6e3b7255dbd1929a648ca",
            "filename": "packages/core/src/util/array_utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Futil%2Farray_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Fsrc%2Futil%2Farray_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Futil%2Farray_utils.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -25,7 +25,7 @@ export function addAllToArray(items: any[], arr: any[]) {\n  *\n  * @param a first array\n  * @param b second array\n- * @param identityAccessor Optional functions for extracting stable object identity from a value in\n+ * @param identityAccessor Optional function for extracting stable object identity from a value in\n  *     the array.\n  */\n export function arrayEquals<T>(a: T[], b: T[], identityAccessor?: (value: T) => unknown): boolean {"
        },
        {
            "sha": "85cc90b21968c4b5c84cf49707b0b2c7d05fb452",
            "filename": "packages/core/test/render3/jit/declare_component_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_component_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_component_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_component_spec.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -128,14 +128,14 @@ describe('component declaration jit compilation', () => {\n \n     expectComponentDef(def, {\n       contentQueries: functionContaining([\n-        // \"byRef\" should use `contentQuery` with `0` (`QueryFlags.none`) for descendants flag\n+        // \"byRef\" should use `contentQuery` with `0` (`QueryFlags.none`) for query flag\n         // without a read token, and bind to the full query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n         /(?:contentQuery|anonymous)[^(]*\\(dirIndex,_c0,4\\)/,\n         '(ctx.byRef = _t)',\n \n         // \"byToken\" should use `staticContentQuery` with `3`\n-        // (`QueryFlags.descendants|QueryFlags.isStatic`) for descendants flag and `ElementRef` as\n+        // (`QueryFlags.descendants|QueryFlags.isStatic`) for query flag and `ElementRef` as\n         // read token, and bind to the first result in the query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n         /(?:contentQuery|anonymous)[^(]*\\(dirIndex,[^,]*String[^,]*,3,[^)]*ElementRef[^)]*\\)/,\n@@ -174,7 +174,7 @@ describe('component declaration jit compilation', () => {\n         '(ctx.byRef = _t)',\n \n         // \"byToken\" should use `viewQuery` with `3`\n-        // (`QueryFlags.descendants|QueryFlags.isStatic`) for descendants flag and `ElementRef` as\n+        // (`QueryFlags.descendants|QueryFlags.isStatic`) for query flag and `ElementRef` as\n         // read token, and bind to the first result in the query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n         /(?:viewQuery|anonymous)[^(]*\\([^,]*String[^,]*,3,[^)]*ElementRef[^)]*\\)/,"
        },
        {
            "sha": "9b85febbcb2aa9e885f47802c611c48649ded2ae",
            "filename": "packages/core/test/render3/jit/declare_directive_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_directive_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/d5161138032c54057d819a8fd52159ce5b75ac18/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_directive_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Frender3%2Fjit%2Fdeclare_directive_spec.ts?ref=d5161138032c54057d819a8fd52159ce5b75ac18",
            "patch": "@@ -103,13 +103,13 @@ describe('directive declaration jit compilation', () => {\n     expectDirectiveDef(def, {\n       contentQueries: functionContaining([\n         // \"byRef\" should use `contentQuery` with `0` (`QueryFlags.descendants|QueryFlags.isStatic`)\n-        // for descendants flag without a read token, and bind to the full query result.\n+        // for query flag without a read token, and bind to the full query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n         /(?:contentQuery|anonymous)[^(]*\\(dirIndex,_c0,4\\)/,\n         '(ctx.byRef = _t)',\n \n         // \"byToken\" should use `viewQuery` with `3` (`QueryFlags.static|QueryFlags.descendants`)\n-        // for descendants flag and `ElementRef` as read token, and bind to the first result in the\n+        // for query flag and `ElementRef` as read token, and bind to the first result in the\n         // query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n         /(?:contentQuery|anonymous)[^(]*\\([^,]*dirIndex,[^,]*String[^,]*,3,[^)]*ElementRef[^)]*\\)/,\n@@ -140,14 +140,14 @@ describe('directive declaration jit compilation', () => {\n \n     expectDirectiveDef(def, {\n       viewQuery: functionContaining([\n-        // \"byRef\" should use `viewQuery` with `false` for descendants flag without a read token,\n-        // and bind to the full query result.\n+        // \"byRef\" should use `viewQuery` with`0` (`QueryFlags.none`) for query flag without a read\n+        // token, and bind to the full query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n         /(?:viewQuery|anonymous)[^(]*\\(_c0,4\\)/,\n         '(ctx.byRef = _t)',\n \n         // \"byToken\" should use `viewQuery` with `3` (`QueryFlags.static|QueryFlags.descendants`)\n-        // for descendants flag and `ElementRef` as read token, and bind to the first result in the\n+        // for query flag and `ElementRef` as read token, and bind to the first result in the\n         // query result.\n         // NOTE: the `anonymous` match is to support IE11, as functions don't have a name there.\n         /(?:viewQuery|anonymous)[^(]*\\([^,]*String[^,]*,3,[^)]*ElementRef[^)]*\\)/,"
        }
    ],
    "stats": {
        "total": 161,
        "additions": 62,
        "deletions": 99
    }
}