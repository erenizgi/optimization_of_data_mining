{
    "author": "JiaLiPassion",
    "message": "fix(zone.js): defineProperty patch should not swallow error (#37582)\n\nClose #37432\n\nzone.js monkey patches the `Object.defineProperty` API long time ago\nangular/zone.js@383b479\nto resolve issues in very old version of Chrome web which override the\nproperty of `CustomElements`, and this is not an issue any longer, so\nwe want to remove this monkey patch, since it may swallow the errors when the user\nwant to define property on unconfigurable or frozen object properties.\nBut currently there are several apps and tests depends on this patch, since\nit also change the `configurable` property to `true` by default, so\nin this PR we update the logic to not to swallow error any longer unless the property\nis the callbacks of `document.registerElements`.\n\nBREAKING CHANGE:\n\nZoneJS no longer swallows errors produced by `Object.defineProperty` calls.\n\nPrior to this change, ZoneJS monkey patched `Object.defineProperty` and if there is an error\n(such as the property is not configurable or not writable) the patched logic swallowed it\nand only console.log was produced. This behavior used to hide real errors,\nso the logic is now updated to trigger original errors (if any). One exception\nwhere the patch remains in place is `document.registerElement`\n(to allow smooth transition for code/polyfills that rely on old behavior in legacy browsers).\nIf your code relies on the old behavior (where errors were not thrown before),\nyou may need to update the logic to handle the errors that are no longer masked by ZoneJS patch.\n\nPR Close #37582",
    "sha": "45a73dddfdf3f32ad4203c71c06b6a4be50f4a31",
    "files": [
        {
            "sha": "3fb59766529f39e87685869d5469ad56a51752c8",
            "filename": "packages/zone.js/lib/browser/define-property.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/45a73dddfdf3f32ad4203c71c06b6a4be50f4a31/packages%2Fzone.js%2Flib%2Fbrowser%2Fdefine-property.ts",
            "raw_url": "https://github.com/angular/angular/raw/45a73dddfdf3f32ad4203c71c06b6a4be50f4a31/packages%2Fzone.js%2Flib%2Fbrowser%2Fdefine-property.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Flib%2Fbrowser%2Fdefine-property.ts?ref=45a73dddfdf3f32ad4203c71c06b6a4be50f4a31",
            "patch": "@@ -16,6 +16,8 @@ let _defineProperty: any;\n let _getOwnPropertyDescriptor: any;\n let _create: any;\n let unconfigurablesKey: any;\n+const registerElementsCallbacks =\n+    ['createdCallback', 'attachedCallback', 'detachedCallback', 'attributeChangedCallback'];\n \n export function propertyPatch() {\n   zoneSymbol = Zone.__symbol__;\n@@ -102,6 +104,18 @@ function _tryDefineProperty(obj: any, prop: string, desc: any, originalConfigura\n       try {\n         return _defineProperty(obj, prop, desc);\n       } catch (error) {\n+        let swallowError = false;\n+        if (typeof document !== 'undefined' && obj === document &&\n+            registerElementsCallbacks.find(c => c === prop)) {\n+          // We only swallow the error in registerElement patch\n+          swallowError = true;\n+        }\n+        if (!swallowError) {\n+          throw error;\n+        }\n+        // TODO: @JiaLiPassion, Some application such as `registerElement` patch\n+        // still need to swallow the error, in the future after these applications\n+        // are updated, the following logic can be removed.\n         let descJson: string|null = null;\n         try {\n           descJson = JSON.stringify(desc);"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 14,
        "deletions": 0
    }
}