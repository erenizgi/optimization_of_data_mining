{
    "author": "devversion",
    "message": "build: update service-worker package to export worker script and schema (#43431)\n\nUpdates the service-worker package to export the worker script and\nschema, so that these files can be resolved and included by consumers.\n\nAdditionally, the CLI bundle is updated to be using ESM as it\ntransitively relies on the `core` entry-point of the package which\nalready uses ESM. Also this is required because the script is part\nof the the service-worker package which has `type: module` applied.\n\nPR Close #43431",
    "sha": "e60058c88ad9763f55a6ed416e81c3baf7aa3c62",
    "files": [
        {
            "sha": "0f8c275e4028c76fb3c9fef5a7299573fc3beff4",
            "filename": "packages/service-worker/cli/BUILD.bazel",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/e60058c88ad9763f55a6ed416e81c3baf7aa3c62/packages%2Fservice-worker%2Fcli%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/e60058c88ad9763f55a6ed416e81c3baf7aa3c62/packages%2Fservice-worker%2Fcli%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fcli%2FBUILD.bazel?ref=e60058c88ad9763f55a6ed416e81c3baf7aa3c62",
            "patch": "@@ -1,4 +1,5 @@\n-load(\"//tools:defaults.bzl\", \"ng_rollup_bundle\", \"ts_library\")\n+load(\"@npm//@bazel/esbuild:index.bzl\", \"esbuild\", \"esbuild_config\")\n+load(\"//tools:defaults.bzl\", \"ts_library\")\n \n package(default_visibility = [\"//visibility:public\"])\n \n@@ -14,9 +15,21 @@ ts_library(\n     ],\n )\n \n-ng_rollup_bundle(\n+esbuild_config(\n+    name = \"esbuild_config\",\n+    config_file = \"esbuild.config.js\",\n+)\n+\n+esbuild(\n     name = \"ngsw_config\",\n+    config = \":esbuild_config\",\n     entry_point = \":main.ts\",\n+    external = [\n+        \"@angular/service-worker\",\n+    ],\n+    format = \"esm\",\n+    platform = \"node\",\n+    target = \"node14\",\n     deps = [\n         \":cli\",\n     ],"
        },
        {
            "sha": "33dec5e1164c9f8efb5e6127d34b1acaa86bc780",
            "filename": "packages/service-worker/cli/esbuild.config.js",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/e60058c88ad9763f55a6ed416e81c3baf7aa3c62/packages%2Fservice-worker%2Fcli%2Fesbuild.config.js",
            "raw_url": "https://github.com/angular/angular/raw/e60058c88ad9763f55a6ed416e81c3baf7aa3c62/packages%2Fservice-worker%2Fcli%2Fesbuild.config.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fcli%2Fesbuild.config.js?ref=e60058c88ad9763f55a6ed416e81c3baf7aa3c62",
            "patch": "@@ -0,0 +1,21 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+module.exports = {\n+  resolveExtensions: ['.mjs'],\n+  // Note: `@bazel/esbuild` has a bug and does not pass-through the format from Starlark.\n+  format: 'esm',\n+  banner: {\n+    // Workaround for: https://github.com/evanw/esbuild/issues/946\n+    // TODO: Remove this workaround in the future once devmode is ESM as well.\n+    js: `\n+      import {createRequire as __cjsCompatRequire} from 'module';\n+      const require = __cjsCompatRequire(import.meta.url);\n+    `,\n+  },\n+};"
        },
        {
            "sha": "b553e9ef4970a5a04690edd92a565bc84e321cb6",
            "filename": "packages/service-worker/cli/filesystem.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/e60058c88ad9763f55a6ed416e81c3baf7aa3c62/packages%2Fservice-worker%2Fcli%2Ffilesystem.ts",
            "raw_url": "https://github.com/angular/angular/raw/e60058c88ad9763f55a6ed416e81c3baf7aa3c62/packages%2Fservice-worker%2Fcli%2Ffilesystem.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fcli%2Ffilesystem.ts?ref=e60058c88ad9763f55a6ed416e81c3baf7aa3c62",
            "patch": "@@ -7,12 +7,11 @@\n  */\n \n import {Filesystem} from '@angular/service-worker/config';\n+import * as fs from 'fs';\n+import * as path from 'path';\n \n import {sha1Binary} from './sha1';\n \n-const fs = require('fs');\n-const path = require('path');\n-\n export class NodeFilesystem implements Filesystem {\n   constructor(private base: string) {}\n "
        },
        {
            "sha": "67818bc3edefbd34c8c82910456bc4328a3cf6c1",
            "filename": "packages/service-worker/cli/main.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/e60058c88ad9763f55a6ed416e81c3baf7aa3c62/packages%2Fservice-worker%2Fcli%2Fmain.ts",
            "raw_url": "https://github.com/angular/angular/raw/e60058c88ad9763f55a6ed416e81c3baf7aa3c62/packages%2Fservice-worker%2Fcli%2Fmain.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fcli%2Fmain.ts?ref=e60058c88ad9763f55a6ed416e81c3baf7aa3c62",
            "patch": "@@ -6,11 +6,11 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-const {Generator} = require('@angular/service-worker/config');\n-const fs = require('fs');\n-const path = require('path');\n+import {Config, Generator} from '@angular/service-worker/config';\n+import * as fs from 'fs';\n+import * as path from 'path';\n+\n import {NodeFilesystem} from './filesystem';\n-import {Config} from '../config/src/in';\n \n \n const cwd = process.cwd();"
        },
        {
            "sha": "ed76bda5e26aaa295a227c64c9d3803774dd0129",
            "filename": "packages/service-worker/package.json",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/e60058c88ad9763f55a6ed416e81c3baf7aa3c62/packages%2Fservice-worker%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/e60058c88ad9763f55a6ed416e81c3baf7aa3c62/packages%2Fservice-worker%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fpackage.json?ref=e60058c88ad9763f55a6ed416e81c3baf7aa3c62",
            "patch": "@@ -7,6 +7,17 @@\n   \"engines\": {\n     \"node\": \"^12.14.1 || >=14.0.0\"\n   },\n+  \"exports\": {\n+    \"./ngsw-worker.js\": {\n+      \"default\": \"./ngsw-worker.js\"\n+    },\n+    \"./safety-worker.js\": {\n+      \"default\": \"./safety-worker.js\"\n+    },\n+    \"./config/schema.json\": {\n+      \"default\": \"./config/schema.json\"\n+    }\n+  },\n   \"dependencies\": {\n     \"tslib\": \"^2.3.0\"\n   },"
        }
    ],
    "stats": {
        "total": 62,
        "additions": 53,
        "deletions": 9
    }
}