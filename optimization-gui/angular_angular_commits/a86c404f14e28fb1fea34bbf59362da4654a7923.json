{
    "author": "gkalpak",
    "message": "refactor(service-worker): move mock event classes to their own file (#42736)\n\nIn the ServiceWorker tests, we use mock implementations of the various\nevents emitted during the ServiceWorker lifecycle. Previously, these\nmock implementations were defined in the `testing/scope.ts` file. This\nadded several extra classes to a file that already contains a few,\nmaking it harder to maintain.\n\nTherefore, this commit moves these mock event classes to a separate\n`testing/events.ts` file.\n\nPR Close #42736",
    "sha": "a86c404f14e28fb1fea34bbf59362da4654a7923",
    "files": [
        {
            "sha": "24cee1d23c2a1e176b17def60502aa0aad9a440c",
            "filename": "packages/service-worker/worker/test/prefetch_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/a86c404f14e28fb1fea34bbf59362da4654a7923/packages%2Fservice-worker%2Fworker%2Ftest%2Fprefetch_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/a86c404f14e28fb1fea34bbf59362da4654a7923/packages%2Fservice-worker%2Fworker%2Ftest%2Fprefetch_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Ftest%2Fprefetch_spec.ts?ref=a86c404f14e28fb1fea34bbf59362da4654a7923",
            "patch": "@@ -10,9 +10,10 @@ import {PrefetchAssetGroup} from '../src/assets';\n import {CacheDatabase} from '../src/db-cache';\n import {IdleScheduler} from '../src/idle';\n import {MockCache} from '../testing/cache';\n+import {MockExtendableEvent} from '../testing/events';\n import {MockRequest} from '../testing/fetch';\n import {MockFileSystemBuilder, MockServerStateBuilder, tmpHashTable, tmpManifestSingleAssetGroup} from '../testing/mock';\n-import {MockExtendableEvent, SwTestHarnessBuilder} from '../testing/scope';\n+import {SwTestHarnessBuilder} from '../testing/scope';\n import {envIsSupported} from '../testing/utils';\n \n (function() {"
        },
        {
            "sha": "f42c1698a0578014486bfaa59dc2fd63a5e2061e",
            "filename": "packages/service-worker/worker/testing/events.ts",
            "status": "added",
            "additions": 118,
            "deletions": 0,
            "changes": 118,
            "blob_url": "https://github.com/angular/angular/blob/a86c404f14e28fb1fea34bbf59362da4654a7923/packages%2Fservice-worker%2Fworker%2Ftesting%2Fevents.ts",
            "raw_url": "https://github.com/angular/angular/raw/a86c404f14e28fb1fea34bbf59362da4654a7923/packages%2Fservice-worker%2Fworker%2Ftesting%2Fevents.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Ftesting%2Fevents.ts?ref=a86c404f14e28fb1fea34bbf59362da4654a7923",
            "patch": "@@ -0,0 +1,118 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+export class MockEvent implements Event {\n+  readonly AT_TARGET = -1;\n+  readonly BUBBLING_PHASE = -1;\n+  readonly CAPTURING_PHASE = -1;\n+  readonly NONE = -1;\n+\n+  readonly bubbles = false;\n+  cancelBubble = false;\n+  readonly cancelable = false;\n+  readonly composed = false;\n+  readonly currentTarget = null;\n+  readonly defaultPrevented = false;\n+  readonly eventPhase = -1;\n+  readonly isTrusted = false;\n+  returnValue = false;\n+  readonly srcElement = null;\n+  readonly target = null;\n+  readonly timeStamp = Date.now();\n+\n+  constructor(readonly type: string) {}\n+\n+  composedPath(): EventTarget[] {\n+    this.notImplemented();\n+  }\n+  initEvent(type: string, bubbles?: boolean, cancelable?: boolean): void {\n+    this.notImplemented();\n+  }\n+  preventDefault(): void {\n+    this.notImplemented();\n+  }\n+  stopImmediatePropagation(): void {\n+    this.notImplemented();\n+  }\n+  stopPropagation(): void {\n+    this.notImplemented();\n+  }\n+\n+  private notImplemented(): never {\n+    throw new Error('Method not implemented in `MockEvent`.');\n+  }\n+}\n+\n+export class MockExtendableEvent extends MockEvent implements ExtendableEvent {\n+  private queue: Promise<void>[] = [];\n+\n+  get ready(): Promise<void> {\n+    return (async () => {\n+      while (this.queue.length > 0) {\n+        await this.queue.shift();\n+      }\n+    })();\n+  }\n+\n+  waitUntil(promise: Promise<void>): void {\n+    this.queue.push(promise);\n+  }\n+}\n+\n+export class MockActivateEvent extends MockExtendableEvent {\n+  constructor() {\n+    super('activate');\n+  }\n+}\n+\n+export class MockFetchEvent extends MockExtendableEvent {\n+  response: Promise<Response|undefined> = Promise.resolve(undefined);\n+\n+  constructor(\n+      readonly request: Request, readonly clientId: string, readonly resultingClientId: string) {\n+    super('fetch');\n+  }\n+\n+  respondWith(promise: Promise<Response>): Promise<Response> {\n+    this.response = promise;\n+    return promise;\n+  }\n+}\n+\n+export class MockInstallEvent extends MockExtendableEvent {\n+  constructor() {\n+    super('install');\n+  }\n+}\n+\n+export class MockMessageEvent extends MockExtendableEvent {\n+  constructor(readonly data: Object, readonly source: MockClient|null) {\n+    super('message');\n+  }\n+}\n+\n+export class MockNotificationEvent extends MockExtendableEvent {\n+  readonly notification = {\n+    ...this._notification,\n+    close: () => undefined,\n+  };\n+\n+  constructor(private _notification: any, readonly action?: string) {\n+    super('notification');\n+  }\n+}\n+\n+export class MockPushEvent extends MockExtendableEvent {\n+  data = {\n+    json: () => this._data,\n+  };\n+\n+  constructor(private _data: object) {\n+    super('push');\n+  }\n+}"
        },
        {
            "sha": "2619a8de948883dd7ed462f19e41d30ac9a2dd1b",
            "filename": "packages/service-worker/worker/testing/scope.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 106,
            "changes": 107,
            "blob_url": "https://github.com/angular/angular/blob/a86c404f14e28fb1fea34bbf59362da4654a7923/packages%2Fservice-worker%2Fworker%2Ftesting%2Fscope.ts",
            "raw_url": "https://github.com/angular/angular/raw/a86c404f14e28fb1fea34bbf59362da4654a7923/packages%2Fservice-worker%2Fworker%2Ftesting%2Fscope.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Ftesting%2Fscope.ts?ref=a86c404f14e28fb1fea34bbf59362da4654a7923",
            "patch": "@@ -13,6 +13,7 @@ import {AssetGroupConfig, Manifest} from '../src/manifest';\n import {sha1} from '../src/sha1';\n \n import {MockCacheStorage} from './cache';\n+import {MockActivateEvent, MockFetchEvent, MockInstallEvent, MockMessageEvent, MockNotificationEvent, MockPushEvent} from './events';\n import {MockHeaders, MockRequest, MockResponse} from './fetch';\n import {MockServerState, MockServerStateBuilder} from './mock';\n import {normalizeUrl, parseUrl} from './utils';\n@@ -356,109 +357,3 @@ export class ConfigBuilder {\n     };\n   }\n }\n-\n-class MockEvent implements Event {\n-  readonly AT_TARGET = -1;\n-  readonly BUBBLING_PHASE = -1;\n-  readonly CAPTURING_PHASE = -1;\n-  readonly NONE = -1;\n-\n-  readonly bubbles = false;\n-  cancelBubble = false;\n-  readonly cancelable = false;\n-  readonly composed = false;\n-  readonly currentTarget = null;\n-  readonly defaultPrevented = false;\n-  readonly eventPhase = -1;\n-  readonly isTrusted = false;\n-  returnValue = false;\n-  readonly srcElement = null;\n-  readonly target = null;\n-  readonly timeStamp = Date.now();\n-\n-  constructor(readonly type: string) {}\n-\n-  composedPath(): EventTarget[] {\n-    this.notImplemented();\n-  }\n-  initEvent(type: string, bubbles?: boolean, cancelable?: boolean): void {\n-    this.notImplemented();\n-  }\n-  preventDefault(): void {\n-    this.notImplemented();\n-  }\n-  stopImmediatePropagation(): void {\n-    this.notImplemented();\n-  }\n-  stopPropagation(): void {\n-    this.notImplemented();\n-  }\n-\n-  private notImplemented(): never {\n-    throw new Error('Method not implemented in `MockEvent`.');\n-  }\n-}\n-\n-export class MockExtendableEvent extends MockEvent implements ExtendableEvent {\n-  private queue: Promise<void>[] = [];\n-\n-  waitUntil(promise: Promise<void>): void {\n-    this.queue.push(promise);\n-  }\n-\n-  get ready(): Promise<void> {\n-    return (async () => {\n-      while (this.queue.length > 0) {\n-        await this.queue.shift();\n-      }\n-    })();\n-  }\n-}\n-\n-class MockFetchEvent extends MockExtendableEvent {\n-  response: Promise<Response|undefined> = Promise.resolve(undefined);\n-\n-  constructor(\n-      readonly request: Request, readonly clientId: string, readonly resultingClientId: string) {\n-    super('fetch');\n-  }\n-\n-  respondWith(promise: Promise<Response>): Promise<Response> {\n-    this.response = promise;\n-    return promise;\n-  }\n-}\n-\n-class MockMessageEvent extends MockExtendableEvent {\n-  constructor(readonly data: Object, readonly source: MockClient|null) {\n-    super('message');\n-  }\n-}\n-\n-class MockPushEvent extends MockExtendableEvent {\n-  constructor(private _data: Object) {\n-    super('push');\n-  }\n-  data = {\n-    json: () => this._data,\n-  };\n-}\n-\n-class MockNotificationEvent extends MockExtendableEvent {\n-  constructor(private _notification: any, readonly action?: string) {\n-    super('notification');\n-  }\n-  readonly notification = {...this._notification, close: () => undefined};\n-}\n-\n-class MockInstallEvent extends MockExtendableEvent {\n-  constructor() {\n-    super('install');\n-  }\n-}\n-\n-class MockActivateEvent extends MockExtendableEvent {\n-  constructor() {\n-    super('activate');\n-  }\n-}"
        }
    ],
    "stats": {
        "total": 228,
        "additions": 121,
        "deletions": 107
    }
}