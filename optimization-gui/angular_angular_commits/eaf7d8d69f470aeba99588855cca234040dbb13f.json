{
    "author": "gkalpak",
    "message": "test(docs-infra): ensure `deploy-to-firebase` tests pass locally (#39470)\n\nPreviously, the `deploy-to-firebase.js` script and the accompanying\n`deploy-to-firebase.spec.js` spec file were using the `origin` remote\nalias in certain commands. This works fine on CI, where `origin` points\nto the `angular/angular` GitHub repo, but might not work locally.\n\nThis commit ensures that the correct remote is used by explicitly\nspecifying it by the URL, thus ensuring that the tests will behave\nidentically on CI and locally.\n\nPR Close #39470",
    "sha": "eaf7d8d69f470aeba99588855cca234040dbb13f",
    "files": [
        {
            "sha": "e756462d5ee772386048bce0c68ccf02b2de2ccb",
            "filename": "aio/scripts/deploy-to-firebase.js",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/eaf7d8d69f470aeba99588855cca234040dbb13f/aio%2Fscripts%2Fdeploy-to-firebase.js",
            "raw_url": "https://github.com/angular/angular/raw/eaf7d8d69f470aeba99588855cca234040dbb13f/aio%2Fscripts%2Fdeploy-to-firebase.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Fdeploy-to-firebase.js?ref=eaf7d8d69f470aeba99588855cca234040dbb13f",
            "patch": "@@ -9,7 +9,7 @@ const {cd, cp, exec: _exec, set} = require('shelljs');\n set('-e');\n \n \n-// Arguments and environment variables\n+// Arguments, environment variables and constants.\n const args = process.argv.slice(2);\n const dryRun = args[0] === '--dry-run';\n \n@@ -24,9 +24,12 @@ const {\n   CI_STABLE_BRANCH,\n } = process.env;\n \n+const REPO_SLUG = 'angular/angular';\n+const NG_REMOTE_URL = `https://github.com/${REPO_SLUG}.git`;\n+\n // Do not deploy if we are running in a fork.\n-if (`${CI_REPO_OWNER}/${CI_REPO_NAME}` !== 'angular/angular') {\n-  console.log('Skipping deploy because this is not angular/angular.');\n+if (`${CI_REPO_OWNER}/${CI_REPO_NAME}` !== REPO_SLUG) {\n+  console.log(`Skipping deploy because this is not ${REPO_SLUG}.`);\n   process.exit(0);\n }\n \n@@ -37,7 +40,7 @@ if (CI_PULL_REQUEST !== 'false') {\n }\n \n // Do not deploy if the current commit is not the latest on its branch.\n-const latestCommit = exec(`git ls-remote origin ${CI_BRANCH}`).slice(0, 40);\n+const latestCommit = exec(`git ls-remote ${NG_REMOTE_URL} ${CI_BRANCH}`).slice(0, 40);\n if (CI_COMMIT !== latestCommit) {\n   console.log(`Skipping deploy because ${CI_COMMIT} is not the latest commit (${latestCommit}).`);\n   process.exit(0);\n@@ -89,7 +92,7 @@ if (CI_BRANCH === 'master') {\n   // Find the branch that has highest minor version for the given `currentBranchMajorVersion`.\n   const mostRecentMinorVersion =\n     // List the branches that start with the major version.\n-    exec(`git ls-remote origin refs/heads/${currentBranchMajorVersion}.*.x`).split('\\n')\n+    exec(`git ls-remote ${NG_REMOTE_URL} refs/heads/${currentBranchMajorVersion}.*.x`).split('\\n')\n         // Extract the version number.\n         .map(line => line.split('/')[2])\n         // Sort by the minor version."
        },
        {
            "sha": "6f32bd2ba8236fa212fe45ffeac9a619c7c0d5f9",
            "filename": "aio/scripts/deploy-to-firebase.spec.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/eaf7d8d69f470aeba99588855cca234040dbb13f/aio%2Fscripts%2Fdeploy-to-firebase.spec.js",
            "raw_url": "https://github.com/angular/angular/raw/eaf7d8d69f470aeba99588855cca234040dbb13f/aio%2Fscripts%2Fdeploy-to-firebase.spec.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fscripts%2Fdeploy-to-firebase.spec.js?ref=eaf7d8d69f470aeba99588855cca234040dbb13f",
            "patch": "@@ -6,12 +6,13 @@ const {execSync} = require('child_process');\n \n describe('deploy-to-firebase:', () => {\n   const deployToFirebaseCmd = `\"${process.execPath}\" \"${__dirname}/deploy-to-firebase\" --dry-run`;\n+  const ngRemoteUrl = 'https://github.com/angular/angular.git';\n \n   // Helpers\n   const deployToFirebaseDryRun =\n       env => execSync(deployToFirebaseCmd, {encoding: 'utf8', env}).toString().trim();\n   const getLatestCommitForBranch =\n-      branch => execSync(`git ls-remote origin ${branch}`).slice(0, 40);\n+      branch => execSync(`git ls-remote ${ngRemoteUrl} ${branch}`).slice(0, 40);\n \n   it('master - skip deploy - not angular', () => {\n     expect(deployToFirebaseDryRun({"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 10,
        "deletions": 6
    }
}