{
    "author": "gkalpak",
    "message": "feat(docs-infra): add shortcuts for the angular.io PWA (#40393)\n\nThis commits adds some shortcut definitions for the angular.io PWA. The\nuser agent can use them to assemble a context menu to be displayed by\nthe operating system when a user engages with the app's icon. (In\naddition, shortcuts provide an easy way for users to add links to\nspecific pages on their home screen.)\n\nSee [here][1] for more details on the `shortcuts` property of the PWA\nmanifest.\n\nThe choice of pages to create shortcuts to was influenced by the\nfollowing facts/criteria:\n- It seems that only the first 4 shortcuts are displayed by Chrome (at\n  least on my Android phone).\n- Since the PWA is mostly used on mobile, I omitted pages that are less\n  likely to be useful for mobile users (such as pages related to CLI).\n\n[1]: https://developer.mozilla.org/en-US/docs/Web/Manifest/shortcuts\n\nPR Close #40393",
    "sha": "96690ed3a41dd89aec87d82af31c94eb7b79c7c2",
    "files": [
        {
            "sha": "12f667f4837728e4fa67fb308a50dd1cb1a28707",
            "filename": "aio/src/pwa-manifest.json",
            "status": "modified",
            "additions": 27,
            "deletions": 1,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/96690ed3a41dd89aec87d82af31c94eb7b79c7c2/aio%2Fsrc%2Fpwa-manifest.json",
            "raw_url": "https://github.com/angular/angular/raw/96690ed3a41dd89aec87d82af31c94eb7b79c7c2/aio%2Fsrc%2Fpwa-manifest.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fpwa-manifest.json?ref=96690ed3a41dd89aec87d82af31c94eb7b79c7c2",
            "patch": "@@ -22,5 +22,31 @@\n       \"purpose\": \"maskable\"\n     }\n   ],\n-  \"start_url\": \"/?utm_source=homescreen\"\n+  \"start_url\": \"/?utm_source=homescreen\",\n+  \"shortcuts\": [\n+    {\n+      \"name\": \"Go to API Reference\",\n+      \"short_name\": \"API\",\n+      \"description\": \"Go to the Angular API reference page.\",\n+      \"url\": \"/api?utm_source=homescreen\"\n+    },\n+    {\n+      \"name\": \"Go to Glossary\",\n+      \"short_name\": \"Glossary\",\n+      \"description\": \"Go to the glossary page: A list of common Angular terms and their explanation.\",\n+      \"url\": \"/guide/glossary?utm_source=homescreen\"\n+    },\n+    {\n+      \"name\": \"Go to Resources\",\n+      \"short_name\": \"Resources\",\n+      \"description\": \"Go to the resources page: A list of Angular resouces, such as development tooling, UI libraries, books, courses, community publications, podcasts, etc.\",\n+      \"url\": \"/resources?utm_source=homescreen\"\n+    },\n+    {\n+      \"name\": \"Go to Tutorial: Tour of Heroes\",\n+      \"short_name\": \"Tutorial\",\n+      \"description\": \"Go to the \\\"Tour of Heroes\\\" tutorial page: Learn how to create your first Angular application.\",\n+      \"url\": \"/tutorial?utm_source=homescreen\"\n+    }\n+  ]\n }"
        },
        {
            "sha": "f10ab9fe6b9cc0bb91d58d59bd07497cc376b701",
            "filename": "aio/tests/e2e/src/app.po.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/96690ed3a41dd89aec87d82af31c94eb7b79c7c2/aio%2Ftests%2Fe2e%2Fsrc%2Fapp.po.ts",
            "raw_url": "https://github.com/angular/angular/raw/96690ed3a41dd89aec87d82af31c94eb7b79c7c2/aio%2Ftests%2Fe2e%2Fsrc%2Fapp.po.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftests%2Fe2e%2Fsrc%2Fapp.po.ts?ref=96690ed3a41dd89aec87d82af31c94eb7b79c7c2",
            "patch": "@@ -41,7 +41,7 @@ export class SitePage {\n \n   async navigateTo(pageUrl: string) {\n     // Navigate to the page, disable animations, and wait for Angular.\n-    await browser.get(`/${pageUrl}`);\n+    await browser.get(`/${pageUrl.replace(/^\\//, '')}`);\n     await browser.executeScript('document.body.classList.add(\\'no-animations\\')');\n     await browser.waitForAngular();\n   }"
        },
        {
            "sha": "6296c4a55f83f0424084e609ef8f52793e8d6602",
            "filename": "aio/tests/e2e/src/pwa-manifest.e2e-spec.ts",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/96690ed3a41dd89aec87d82af31c94eb7b79c7c2/aio%2Ftests%2Fe2e%2Fsrc%2Fpwa-manifest.e2e-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/96690ed3a41dd89aec87d82af31c94eb7b79c7c2/aio%2Ftests%2Fe2e%2Fsrc%2Fpwa-manifest.e2e-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftests%2Fe2e%2Fsrc%2Fpwa-manifest.e2e-spec.ts?ref=96690ed3a41dd89aec87d82af31c94eb7b79c7c2",
            "patch": "@@ -0,0 +1,29 @@\n+import { PwaManifestPage, PwaShortcutItem } from './pwa-manifest.po';\n+\n+\n+describe('PWA manifest', () => {\n+  const page = new PwaManifestPage();\n+\n+  describe('shortcuts', () => {\n+    let shortcuts: PwaShortcutItem[];\n+\n+    // Helpers\n+    const pageExists = async (url: string) => {\n+      await page.navigateTo(url);\n+      const content = await page.getDocViewerText();\n+      return !/page not found/i.test(content);\n+    };\n+\n+    beforeEach(async () => {\n+      shortcuts = await page.getPwaShortcuts();\n+    });\n+\n+    it('should exist', async () => {\n+      for (const {short_name, url} of shortcuts) {\n+        expect(await pageExists(url)).toBe(\n+            true,\n+            `Page for shortcut '${short_name}' (from '${page.pwaManifestUrl}') does not exist. (URL: ${url})`);\n+      }\n+    });\n+  });\n+});"
        },
        {
            "sha": "15040d9909ee447f1a58c67b054725f542352d43",
            "filename": "aio/tests/e2e/src/pwa-manifest.po.ts",
            "status": "added",
            "additions": 74,
            "deletions": 0,
            "changes": 74,
            "blob_url": "https://github.com/angular/angular/blob/96690ed3a41dd89aec87d82af31c94eb7b79c7c2/aio%2Ftests%2Fe2e%2Fsrc%2Fpwa-manifest.po.ts",
            "raw_url": "https://github.com/angular/angular/raw/96690ed3a41dd89aec87d82af31c94eb7b79c7c2/aio%2Ftests%2Fe2e%2Fsrc%2Fpwa-manifest.po.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftests%2Fe2e%2Fsrc%2Fpwa-manifest.po.ts?ref=96690ed3a41dd89aec87d82af31c94eb7b79c7c2",
            "patch": "@@ -0,0 +1,74 @@\n+import { get as httpGet } from 'http';\n+import { get as httpsGet } from 'https';\n+import { browser } from 'protractor';\n+import { SitePage } from './app.po';\n+\n+\n+export type Json = null | boolean | number | string | Json[] | { [key: string]: Json };\n+\n+/**\n+ * The shape of a PWA manifest.\n+ * For simplicity, we only define types for the properties we care about in tests.\n+ * @see https://developer.mozilla.org/en-US/docs/Web/Manifest\n+ */\n+export type PwaManifest = Json & {\n+  shortcuts?: PwaShortcutItem[],\n+};\n+\n+/**\n+ * The shape of an item in a PWA manifest's `shortcuts` list.\n+ * @see https://developer.mozilla.org/en-US/docs/Web/Manifest/shortcuts\n+ */\n+export type PwaShortcutItem = Json & {\n+  url: string,\n+  name: string,\n+  short_name?: string,\n+  description?: string,\n+  icons?: PwaImageResource[],\n+};\n+\n+/**\n+ * The shape of an item in a PWA manifest's icons list (such as the value of the top-level `icons` property or that of\n+ * the `icons` property of a shortcut item).\n+ * @see https://w3c.github.io/manifest/#manifestimageresource-and-its-members\n+ */\n+export type PwaImageResource = Json & {\n+  src: string,\n+  sizes?: string,\n+  type?: string,\n+  purpose?: string,\n+};\n+\n+\n+export class PwaManifestPage extends SitePage {\n+  /** The base URL with the trailing `/` stripped off (if any). */\n+  baseUrl = browser.baseUrl.replace(/\\/$/, '');\n+\n+  /** The URL to the app's PWA manifest. */\n+  pwaManifestUrl = `${this.baseUrl}/pwa-manifest.json`;\n+\n+  private pwaManifestText: string | null = null;\n+\n+  /** Get the app's PWA manifest as an object. */\n+  async getPwaManifest(): Promise<PwaManifest> {\n+    if (this.pwaManifestText === null) {\n+      const get = /^https:/.test(this.pwaManifestUrl) ? httpsGet : httpGet;\n+\n+      this.pwaManifestText = await new Promise<string>((resolve, reject) => {\n+        let responseText = '';\n+        get(this.pwaManifestUrl, res => res\n+            .on('data', chunk => responseText += chunk)\n+            .on('end', () => resolve(responseText))\n+            .on('error', reject));\n+      });\n+    }\n+\n+    return JSON.parse(this.pwaManifestText);\n+  }\n+\n+  /** Get a list of PWA shortcuts as extracted from the app's PWA manifest. */\n+  async getPwaShortcuts(): Promise<PwaShortcutItem[]> {\n+    const {shortcuts = []} = await this.getPwaManifest();\n+    return shortcuts;\n+  }\n+}"
        }
    ],
    "stats": {
        "total": 133,
        "additions": 131,
        "deletions": 2
    }
}