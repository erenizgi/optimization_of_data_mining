{
    "author": "JoostK",
    "message": "fix(ngcc): detect synthesized constructors that have been downleveled using TS 4.2 (#41305)\n\nTypeScript 4.2 has changed its emitted syntax for synthetic constructors\nwhen using `downlevelIteration`, which affects ES5 bundles that have\nbeen downleveled from ES2015 bundles. This is typically the case for UMD\nbundles in the APF spec, as they are generated by downleveling the\nESM2015 bundle into ES5. ngcc needs to detect the new syntax in order to\ncorrectly identify synthesized constructor functions in ES5 bundles.\n\nFixes #41298\n\nPR Close #41305",
    "sha": "8d3da56eda12070df1fb473c8609f3a94d77bfd6",
    "files": [
        {
            "sha": "9cd7c758a8eb65c84e343c9a65b08719910f490f",
            "filename": "packages/compiler-cli/ngcc/src/host/esm5_host.ts",
            "status": "modified",
            "additions": 94,
            "deletions": 23,
            "changes": 117,
            "blob_url": "https://github.com/angular/angular/blob/8d3da56eda12070df1fb473c8609f3a94d77bfd6/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fesm5_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d3da56eda12070df1fb473c8609f3a94d77bfd6/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fesm5_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fhost%2Fesm5_host.ts?ref=8d3da56eda12070df1fb473c8609f3a94d77bfd6",
            "patch": "@@ -382,6 +382,12 @@ export class Esm5ReflectionHost extends Esm2015ReflectionHost {\n    * return _super.apply(this, tslib.__spread(arguments)) || this;\n    * ```\n    *\n+   * or, since TypeScript 4.2 it would be\n+   *\n+   * ```\n+   * return _super.apply(this, tslib.__spreadArray([], tslib.__read(arguments))) || this;\n+   * ```\n+   *\n    * Such constructs can be still considered as synthetic delegate constructors as they are\n    * the product of a common TypeScript to ES5 synthetic constructor, just being downleveled\n    * to ES5 using `tsc`. See: https://github.com/angular/angular/issues/38453.\n@@ -413,7 +419,10 @@ export class Esm5ReflectionHost extends Esm2015ReflectionHost {\n    *   ```\n    *   var _this = _super.apply(this, tslib.__spread(arguments)) || this;\n    *   ```\n-   *\n+   *   or using the syntax emitted since TypeScript 4.2:\n+   *   ```\n+   *   return _super.apply(this, tslib.__spreadArray([], tslib.__read(arguments))) || this;\n+   *   ```\n    *\n    * @param statement a statement that may be a synthesized super call\n    * @returns true if the statement looks like a synthesized super call\n@@ -447,6 +456,10 @@ export class Esm5ReflectionHost extends Esm2015ReflectionHost {\n    *   ```\n    *   return _super.apply(this, tslib.__spread(arguments)) || this;\n    *   ```\n+   *   or using the syntax emitted since TypeScript 4.2:\n+   *   ```\n+   *   return _super.apply(this, tslib.__spreadArray([], tslib.__read(arguments))) || this;\n+   *   ```\n    *\n    * @param statement a statement that may be a synthesized super call\n    * @returns true if the statement looks like a synthesized super call\n@@ -473,6 +486,10 @@ export class Esm5ReflectionHost extends Esm2015ReflectionHost {\n    *   ```\n    *   _super.apply(this, tslib.__spread(arguments)) || this;\n    *   ```\n+   *   or using the syntax emitted since TypeScript 4.2:\n+   *   ```\n+   *   return _super.apply(this, tslib.__spreadArray([], tslib.__read(arguments))) || this;\n+   *   ```\n    *\n    * @param expression an expression that may represent a default super call\n    * @returns true if the expression corresponds with the above form\n@@ -500,7 +517,8 @@ export class Esm5ReflectionHost extends Esm2015ReflectionHost {\n    * This structure is generated by TypeScript when transforming ES2015 to ES5, see\n    * https://github.com/Microsoft/TypeScript/blob/v3.2.2/src/compiler/transformers/es2015.ts#L1148-L1163\n    *\n-   * Additionally, we also handle cases where `arguments` are wrapped by a TypeScript spread helper.\n+   * Additionally, we also handle cases where `arguments` are wrapped by a TypeScript spread\n+   * helper.\n    * This can happen if ES2015 class output contain auto-generated constructors due to class\n    * members. The ES2015 output will be using `super(...arguments)` to delegate to the superclass,\n    * but once downleveled to ES5, the spread operator will be persisted through a TypeScript spread\n@@ -510,6 +528,12 @@ export class Esm5ReflectionHost extends Esm2015ReflectionHost {\n    * _super.apply(this, __spread(arguments)) || this;\n    * ```\n    *\n+   * or, since TypeScript 4.2 it would be\n+   *\n+   * ```\n+   * _super.apply(this, tslib.__spreadArray([], tslib.__read(arguments))) || this;\n+   * ```\n+   *\n    * More details can be found in: https://github.com/angular/angular/issues/38453.\n    *\n    * @param expression an expression that may represent a default super call\n@@ -538,32 +562,79 @@ export class Esm5ReflectionHost extends Esm2015ReflectionHost {\n     // The other scenario we intend to detect: The `arguments` variable might be wrapped with the\n     // TypeScript spread helper (either through tslib or inlined). This can happen if an explicit\n     // delegate constructor uses `super(...arguments)` in ES2015 and is downleveled to ES5 using\n-    // `--downlevelIteration`. The output in such cases would not directly pass the function\n-    // `arguments` to the `super` call, but wrap it in a TS spread helper. The output would match\n-    // the following pattern: `super.apply(this, tslib.__spread(arguments))`. We check for such\n-    // constructs below, but perform the detection of the call expression definition as last as\n-    // that is the most expensive operation here.\n-    if (!ts.isCallExpression(argumentsExpr) || argumentsExpr.arguments.length !== 1 ||\n-        !isArgumentsIdentifier(argumentsExpr.arguments[0])) {\n+    // `--downlevelIteration`.\n+    return this.isSpreadArgumentsExpression(argumentsExpr);\n+  }\n+\n+  /**\n+   * Determines if the provided expression is one of the following call expressions:\n+   *\n+   * 1. `__spread(arguments)`\n+   * 2. `__spreadArray([], __read(arguments))`\n+   *\n+   * The tslib helpers may have been emitted inline as in the above example, or they may be read\n+   * from a namespace import.\n+   */\n+  private isSpreadArgumentsExpression(expression: ts.Expression): boolean {\n+    const call = this.extractKnownHelperCall(expression);\n+    if (call === null) {\n       return false;\n     }\n \n-    const argumentsCallExpr = argumentsExpr.expression;\n-    let argumentsCallDeclaration: Declaration|null = null;\n-\n-    // The `__spread` helper could be globally available, or accessed through a namespaced\n-    // import. Hence we support a property access here as long as it resolves to the actual\n-    // known TypeScript spread helper.\n-    if (ts.isIdentifier(argumentsCallExpr)) {\n-      argumentsCallDeclaration = this.getDeclarationOfIdentifier(argumentsCallExpr);\n-    } else if (\n-        ts.isPropertyAccessExpression(argumentsCallExpr) &&\n-        ts.isIdentifier(argumentsCallExpr.name)) {\n-      argumentsCallDeclaration = this.getDeclarationOfIdentifier(argumentsCallExpr.name);\n+    if (call.helper === KnownDeclaration.TsHelperSpread) {\n+      // `__spread(arguments)`\n+      return call.args.length === 1 && isArgumentsIdentifier(call.args[0]);\n+    } else if (call.helper === KnownDeclaration.TsHelperSpreadArray) {\n+      // `__spreadArray([], __read(arguments))`\n+      if (call.args.length !== 2) {\n+        return false;\n+      }\n+\n+      const firstArg = call.args[0];\n+      if (!ts.isArrayLiteralExpression(firstArg) || firstArg.elements.length !== 0) {\n+        return false;\n+      }\n+\n+      const secondArg = this.extractKnownHelperCall(call.args[1]);\n+      if (secondArg === null || secondArg.helper !== KnownDeclaration.TsHelperRead) {\n+        return false;\n+      }\n+\n+      return secondArg.args.length === 1 && isArgumentsIdentifier(secondArg.args[0]);\n+    } else {\n+      return false;\n+    }\n+  }\n+\n+  /**\n+   * Inspects the provided expression and determines if it corresponds with a known helper function\n+   * as receiver expression.\n+   */\n+  private extractKnownHelperCall(expression: ts.Expression):\n+      {helper: KnownDeclaration, args: ts.NodeArray<ts.Expression>}|null {\n+    if (!ts.isCallExpression(expression)) {\n+      return null;\n+    }\n+\n+    const receiverExpr = expression.expression;\n+\n+    // The helper could be globally available, or accessed through a namespaced import. Hence we\n+    // support a property access here as long as it resolves to the actual known TypeScript helper.\n+    let receiver: Declaration|null = null;\n+    if (ts.isIdentifier(receiverExpr)) {\n+      receiver = this.getDeclarationOfIdentifier(receiverExpr);\n+    } else if (ts.isPropertyAccessExpression(receiverExpr) && ts.isIdentifier(receiverExpr.name)) {\n+      receiver = this.getDeclarationOfIdentifier(receiverExpr.name);\n+    }\n+\n+    if (receiver === null || receiver.known === null) {\n+      return null;\n     }\n \n-    return argumentsCallDeclaration !== null &&\n-        argumentsCallDeclaration.known === KnownDeclaration.TsHelperSpread;\n+    return {\n+      helper: receiver.known,\n+      args: expression.arguments,\n+    };\n   }\n }\n "
        },
        {
            "sha": "3143a8b15d5c3cd198b6d6588f75449ef53ac3ee",
            "filename": "packages/compiler-cli/ngcc/test/host/commonjs_host_spec.ts",
            "status": "modified",
            "additions": 78,
            "deletions": 2,
            "changes": 80,
            "blob_url": "https://github.com/angular/angular/blob/8d3da56eda12070df1fb473c8609f3a94d77bfd6/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fcommonjs_host_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d3da56eda12070df1fb473c8609f3a94d77bfd6/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fcommonjs_host_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fcommonjs_host_spec.ts?ref=8d3da56eda12070df1fb473c8609f3a94d77bfd6",
            "patch": "@@ -1530,11 +1530,15 @@ exports.MissingClass2 = MissingClass2;\n               break;\n             case 'inlined':\n               fileHeader =\n-                  `var __spread = (this && this.__spread) || function (...args) { /* ... */ }`;\n+                  `var __spread = (this && this.__spread) || function (...args) { /* ... */ };\\n` +\n+                  `var __spreadArray = (this && this.__spreadArray) || function (...args) { /* ... */ };\\n` +\n+                  `var __read = (this && this.__read) || function (...args) { /* ... */ };\\n`;\n               break;\n             case 'inlined_with_suffix':\n               fileHeader =\n-                  `var __spread$1 = (this && this.__spread$1) || function (...args) { /* ... */ }`;\n+                  `var __spread$1 = (this && this.__spread$1) || function (...args) { /* ... */ };\\n` +\n+                  `var __spreadArray$1 = (this && this.__spreadArray$1) || function (...args) { /* ... */ };\\n` +\n+                  `var __read$2 = (this && this.__read$2) || function (...args) { /* ... */ };\\n`;\n               break;\n           }\n           const file = {\n@@ -1635,6 +1639,17 @@ exports.MissingClass2 = MissingClass2;\n             expect(parameters).toBeNull();\n           });\n \n+          it('recognizes delegate super call using inline spreadArray helper', () => {\n+            const parameters = getConstructorParameters(\n+                `\n+              function TestClass() {\n+                return _super.apply(this, __spreadArray([], __read(arguments))) || this;\n+              }`,\n+                'inlined');\n+\n+            expect(parameters).toBeNull();\n+          });\n+\n           it('recognizes delegate super call using inline spread helper with suffix', () => {\n             const parameters = getConstructorParameters(\n                 `\n@@ -1646,6 +1661,17 @@ exports.MissingClass2 = MissingClass2;\n             expect(parameters).toBeNull();\n           });\n \n+          it('recognizes delegate super call using inline spreadArray helper with suffix', () => {\n+            const parameters = getConstructorParameters(\n+                `\n+              function TestClass() {\n+                return _super.apply(this, __spreadArray$1([], __read$2(arguments))) || this;\n+              }`,\n+                'inlined_with_suffix');\n+\n+            expect(parameters).toBeNull();\n+          });\n+\n           it('recognizes delegate super call using imported spread helper', () => {\n             const parameters = getConstructorParameters(\n                 `\n@@ -1657,6 +1683,17 @@ exports.MissingClass2 = MissingClass2;\n             expect(parameters).toBeNull();\n           });\n \n+          it('recognizes delegate super call using imported spreadArray helper', () => {\n+            const parameters = getConstructorParameters(\n+                `\n+              function TestClass() {\n+                return _super.apply(this, tslib.__spreadArray([], tslib.__read(arguments))) || this;\n+              }`,\n+                'imported');\n+\n+            expect(parameters).toBeNull();\n+          });\n+\n           describe('with class member assignment', () => {\n             it('recognizes delegate super call using inline spread helper', () => {\n               const parameters = getConstructorParameters(\n@@ -1671,6 +1708,19 @@ exports.MissingClass2 = MissingClass2;\n               expect(parameters).toBeNull();\n             });\n \n+            it('recognizes delegate super call using inline spreadArray helper', () => {\n+              const parameters = getConstructorParameters(\n+                  `\n+                function TestClass() {\n+                  var _this = _super.apply(this, __spreadArray([], __read(arguments))) || this;\n+                  _this.synthesizedProperty = null;\n+                  return _this;\n+                }`,\n+                  'inlined');\n+\n+              expect(parameters).toBeNull();\n+            });\n+\n             it('recognizes delegate super call using inline spread helper with suffix', () => {\n               const parameters = getConstructorParameters(\n                   `\n@@ -1684,6 +1734,19 @@ exports.MissingClass2 = MissingClass2;\n               expect(parameters).toBeNull();\n             });\n \n+            it('recognizes delegate super call using inline spreadArray helper with suffix', () => {\n+              const parameters = getConstructorParameters(\n+                  `\n+                function TestClass() {\n+                  var _this = _super.apply(this, __spreadArray$1([], __read$2(arguments))) || this;\n+                  _this.synthesizedProperty = null;\n+                  return _this;\n+                }`,\n+                  'inlined_with_suffix');\n+\n+              expect(parameters).toBeNull();\n+            });\n+\n             it('recognizes delegate super call using imported spread helper', () => {\n               const parameters = getConstructorParameters(\n                   `\n@@ -1696,6 +1759,19 @@ exports.MissingClass2 = MissingClass2;\n \n               expect(parameters).toBeNull();\n             });\n+\n+            it('recognizes delegate super call using imported spreadArray helper', () => {\n+              const parameters = getConstructorParameters(\n+                  `\n+                function TestClass() {\n+                  var _this = _super.apply(this, tslib.__spreadArray([], tslib.__read(arguments))) || this;\n+                  _this.synthesizedProperty = null;\n+                  return _this;\n+                }`,\n+                  'imported');\n+\n+              expect(parameters).toBeNull();\n+            });\n           });\n \n           it('handles the case where a unique name was generated for _super or _this', () => {"
        },
        {
            "sha": "b6521969bf68ee15222362dd30584db1a58cdfdc",
            "filename": "packages/compiler-cli/ngcc/test/host/esm5_host_spec.ts",
            "status": "modified",
            "additions": 103,
            "deletions": 3,
            "changes": 106,
            "blob_url": "https://github.com/angular/angular/blob/8d3da56eda12070df1fb473c8609f3a94d77bfd6/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fesm5_host_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d3da56eda12070df1fb473c8609f3a94d77bfd6/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fesm5_host_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fesm5_host_spec.ts?ref=8d3da56eda12070df1fb473c8609f3a94d77bfd6",
            "patch": "@@ -1485,18 +1485,22 @@ runInEachFileSystem(() => {\n \n         switch (mode) {\n           case 'imported':\n-            fileHeader = `import {__spread} from 'tslib';`;\n+            fileHeader = `import {__spread, __spreadArray, __read} from 'tslib';`;\n             break;\n           case 'imported_namespace':\n             fileHeader = `import * as tslib from 'tslib';`;\n             break;\n           case 'inlined':\n             fileHeader =\n-                `var __spread = (this && this.__spread) || function (...args) { /* ... */ }`;\n+                `var __spread = (this && this.__spread) || function (...args) { /* ... */ };\\n` +\n+                `var __spreadArray = (this && this.__spreadArray) || function (...args) { /* ... */ };\\n` +\n+                `var __read = (this && this.__read) || function (...args) { /* ... */ };\\n`;\n             break;\n           case 'inlined_with_suffix':\n             fileHeader =\n-                `var __spread$1 = (this && this.__spread$1) || function (...args) { /* ... */ }`;\n+                `var __spread$1 = (this && this.__spread$1) || function (...args) { /* ... */ };\\n` +\n+                `var __spreadArray$1 = (this && this.__spreadArray$1) || function (...args) { /* ... */ };\\n` +\n+                `var __read$2 = (this && this.__read$2) || function (...args) { /* ... */ };\\n`;\n             break;\n         }\n \n@@ -1595,6 +1599,17 @@ runInEachFileSystem(() => {\n           expect(parameters).toBeNull();\n         });\n \n+        it('recognizes delegate super call using inline spreadArray helper', () => {\n+          const parameters = getConstructorParameters(\n+              `\n+            function TestClass() {\n+              return _super.apply(this, __spreadArray([], __read(arguments))) || this;\n+            }`,\n+              'inlined');\n+\n+          expect(parameters).toBeNull();\n+        });\n+\n         it('recognizes delegate super call using inline spread helper with suffix', () => {\n           const parameters = getConstructorParameters(\n               `\n@@ -1606,6 +1621,17 @@ runInEachFileSystem(() => {\n           expect(parameters).toBeNull();\n         });\n \n+        it('recognizes delegate super call using inline spreadArray helper with suffix', () => {\n+          const parameters = getConstructorParameters(\n+              `\n+            function TestClass() {\n+              return _super.apply(this, __spreadArray$1([], __read$2(arguments))) || this;\n+            }`,\n+              'inlined_with_suffix');\n+\n+          expect(parameters).toBeNull();\n+        });\n+\n         it('recognizes delegate super call using imported spread helper', () => {\n           const parameters = getConstructorParameters(\n               `\n@@ -1617,6 +1643,17 @@ runInEachFileSystem(() => {\n           expect(parameters).toBeNull();\n         });\n \n+        it('recognizes delegate super call using imported spreadArray helper', () => {\n+          const parameters = getConstructorParameters(\n+              `\n+            function TestClass() {\n+              return _super.apply(this, __spreadArray([], __read(arguments))) || this;\n+            }`,\n+              'imported');\n+\n+          expect(parameters).toBeNull();\n+        });\n+\n         it('recognizes delegate super call using namespace imported spread helper', () => {\n           const parameters = getConstructorParameters(\n               `\n@@ -1628,6 +1665,17 @@ runInEachFileSystem(() => {\n           expect(parameters).toBeNull();\n         });\n \n+        it('recognizes delegate super call using namespace imported spreadArray helper', () => {\n+          const parameters = getConstructorParameters(\n+              `\n+            function TestClass() {\n+              return _super.apply(this, tslib.__spreadArray([], tslib.__read(arguments))) || this;\n+            }`,\n+              'imported_namespace');\n+\n+          expect(parameters).toBeNull();\n+        });\n+\n         describe('with class member assignment', () => {\n           it('recognizes delegate super call using inline spread helper', () => {\n             const parameters = getConstructorParameters(\n@@ -1642,6 +1690,19 @@ runInEachFileSystem(() => {\n             expect(parameters).toBeNull();\n           });\n \n+          it('recognizes delegate super call using inline spreadArray helper', () => {\n+            const parameters = getConstructorParameters(\n+                `\n+              function TestClass() {\n+                var _this = _super.apply(this, __spreadArray([], __read(arguments))) || this;\n+                _this.synthesizedProperty = null;\n+                return _this;\n+              }`,\n+                'inlined');\n+\n+            expect(parameters).toBeNull();\n+          });\n+\n           it('recognizes delegate super call using inline spread helper with suffix', () => {\n             const parameters = getConstructorParameters(\n                 `\n@@ -1655,6 +1716,19 @@ runInEachFileSystem(() => {\n             expect(parameters).toBeNull();\n           });\n \n+          it('recognizes delegate super call using inline spreadArray helper with suffix', () => {\n+            const parameters = getConstructorParameters(\n+                `\n+              function TestClass() {\n+                var _this = _super.apply(this, __spreadArray$1([], __read$2(arguments))) || this;\n+                _this.synthesizedProperty = null;\n+                return _this;\n+              }`,\n+                'inlined_with_suffix');\n+\n+            expect(parameters).toBeNull();\n+          });\n+\n           it('recognizes delegate super call using imported spread helper', () => {\n             const parameters = getConstructorParameters(\n                 `\n@@ -1668,6 +1742,19 @@ runInEachFileSystem(() => {\n             expect(parameters).toBeNull();\n           });\n \n+          it('recognizes delegate super call using imported spreadArray helper', () => {\n+            const parameters = getConstructorParameters(\n+                `\n+              function TestClass() {\n+                var _this = _super.apply(this, __spreadArray([], __read(arguments))) || this;\n+                _this.synthesizedProperty = null;\n+                return _this;\n+              }`,\n+                'imported');\n+\n+            expect(parameters).toBeNull();\n+          });\n+\n           it('recognizes delegate super call using namespace imported spread helper', () => {\n             const parameters = getConstructorParameters(\n                 `\n@@ -1680,6 +1767,19 @@ runInEachFileSystem(() => {\n \n             expect(parameters).toBeNull();\n           });\n+\n+          it('recognizes delegate super call using namespace imported spreadArray helper', () => {\n+            const parameters = getConstructorParameters(\n+                `\n+              function TestClass() {\n+                var _this = _super.apply(this, tslib.__spreadArray([], tslib.__read(arguments))) || this;\n+                _this.synthesizedProperty = null;\n+                return _this;\n+              }`,\n+                'imported_namespace');\n+\n+            expect(parameters).toBeNull();\n+          });\n         });\n \n         it('handles the case where a unique name was generated for _super or _this', () => {"
        },
        {
            "sha": "b7114b3bc0631098aa238e0302a887db63dcc66c",
            "filename": "packages/compiler-cli/ngcc/test/host/umd_host_spec.ts",
            "status": "modified",
            "additions": 76,
            "deletions": 0,
            "changes": 76,
            "blob_url": "https://github.com/angular/angular/blob/8d3da56eda12070df1fb473c8609f3a94d77bfd6/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fumd_host_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d3da56eda12070df1fb473c8609f3a94d77bfd6/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fumd_host_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fhost%2Fumd_host_spec.ts?ref=8d3da56eda12070df1fb473c8609f3a94d77bfd6",
            "patch": "@@ -1784,6 +1784,8 @@ runInEachFileSystem(() => {\n                 }(this, (function (exports) { 'use strict';\n \n                   var __spread = (this && this.__spread) || function (...args) { /* ... */ }\n+                  var __spreadArray = (this && this.__spreadArray) || function (...args) { /* ... */ }\n+                  var __read = (this && this.__read) || function (...args) { /* ... */ }\n             `;\n               break;\n             case 'inlined_with_suffix':\n@@ -1795,6 +1797,8 @@ runInEachFileSystem(() => {\n                 }(this, (function (exports) { 'use strict';\n \n                   var __spread$1 = (this && this.__spread$1) || function (...args) { /* ... */ }\n+                  var __spreadArray$1 = (this && this.__spreadArray$1) || function (...args) { /* ... */ }\n+                  var __read$2 = (this && this.__read$2) || function (...args) { /* ... */ }\n               `;\n               break;\n           }\n@@ -1897,6 +1901,17 @@ runInEachFileSystem(() => {\n             expect(parameters).toBeNull();\n           });\n \n+          it('recognizes delegate super call using inline spreadArray helper', () => {\n+            const parameters = getConstructorParameters(\n+                `\n+            function TestClass() {\n+              return _super.apply(this, __spreadArray([], __read(arguments))) || this;\n+            }`,\n+                'inlined');\n+\n+            expect(parameters).toBeNull();\n+          });\n+\n           it('recognizes delegate super call using inline spread helper with suffix', () => {\n             const parameters = getConstructorParameters(\n                 `\n@@ -1908,6 +1923,17 @@ runInEachFileSystem(() => {\n             expect(parameters).toBeNull();\n           });\n \n+          it('recognizes delegate super call using inline spreadArray helper with suffix', () => {\n+            const parameters = getConstructorParameters(\n+                `\n+            function TestClass() {\n+              return _super.apply(this, __spreadArray$1([], __read$2(arguments))) || this;\n+            }`,\n+                'inlined_with_suffix');\n+\n+            expect(parameters).toBeNull();\n+          });\n+\n           it('recognizes delegate super call using imported spread helper', () => {\n             const parameters = getConstructorParameters(\n                 `\n@@ -1919,6 +1945,17 @@ runInEachFileSystem(() => {\n             expect(parameters).toBeNull();\n           });\n \n+          it('recognizes delegate super call using imported spreadArray helper', () => {\n+            const parameters = getConstructorParameters(\n+                `\n+            function TestClass() {\n+              return _super.apply(this, tslib_1.__spreadArray([], tslib.__read(arguments))) || this;\n+            }`,\n+                'imported');\n+\n+            expect(parameters).toBeNull();\n+          });\n+\n           describe('with class member assignment', () => {\n             it('recognizes delegate super call using inline spread helper', () => {\n               const parameters = getConstructorParameters(\n@@ -1933,6 +1970,19 @@ runInEachFileSystem(() => {\n               expect(parameters).toBeNull();\n             });\n \n+            it('recognizes delegate super call using inline spreadArray helper', () => {\n+              const parameters = getConstructorParameters(\n+                  `\n+              function TestClass() {\n+                var _this = _super.apply(this, __spreadArray([], __read(arguments))) || this;\n+                _this.synthesizedProperty = null;\n+                return _this;\n+              }`,\n+                  'inlined');\n+\n+              expect(parameters).toBeNull();\n+            });\n+\n             it('recognizes delegate super call using inline spread helper with suffix', () => {\n               const parameters = getConstructorParameters(\n                   `\n@@ -1946,6 +1996,19 @@ runInEachFileSystem(() => {\n               expect(parameters).toBeNull();\n             });\n \n+            it('recognizes delegate super call using inline spreadArray helper with suffix', () => {\n+              const parameters = getConstructorParameters(\n+                  `\n+              function TestClass() {\n+                var _this = _super.apply(this, __spreadArray$1([], __read$2(arguments))) || this;\n+                _this.synthesizedProperty = null;\n+                return _this;\n+              }`,\n+                  'inlined_with_suffix');\n+\n+              expect(parameters).toBeNull();\n+            });\n+\n             it('recognizes delegate super call using imported spread helper', () => {\n               const parameters = getConstructorParameters(\n                   `\n@@ -1958,6 +2021,19 @@ runInEachFileSystem(() => {\n \n               expect(parameters).toBeNull();\n             });\n+\n+            it('recognizes delegate super call using imported spreadArray helper', () => {\n+              const parameters = getConstructorParameters(\n+                  `\n+              function TestClass() {\n+                var _this = _super.apply(this, tslib_1.__spreadArray([], tslib.__read(arguments))) || this;\n+                _this.synthesizedProperty = null;\n+                return _this;\n+              }`,\n+                  'imported');\n+\n+              expect(parameters).toBeNull();\n+            });\n           });\n \n           it('handles the case where a unique name was generated for _super or _this', () => {"
        },
        {
            "sha": "be13353b9d90b601f2e9effdd1f9f264ce4838bd",
            "filename": "packages/compiler-cli/ngcc/test/integration/ngcc_spec.ts",
            "status": "modified",
            "additions": 78,
            "deletions": 0,
            "changes": 78,
            "blob_url": "https://github.com/angular/angular/blob/8d3da56eda12070df1fb473c8609f3a94d77bfd6/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8d3da56eda12070df1fb473c8609f3a94d77bfd6/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts?ref=8d3da56eda12070df1fb473c8609f3a94d77bfd6",
            "patch": "@@ -348,6 +348,84 @@ runInEachFileSystem(() => {\n          });\n     });\n \n+    it(`should be able to detect synthesized constructors in ES5 with downlevelIteration enabled (imported helpers)`,\n+       () => {\n+         setupAngularCoreEsm5();\n+         compileIntoApf(\n+             'test-package', {\n+               '/index.ts': `\n+                import {Injectable} from '@angular/core';\n+\n+                @Injectable()\n+                export class Base {}\n+\n+                @Injectable()\n+                export class SubClass extends Base {\n+                  constructor() {\n+                    // Note: mimic the situation where TS is first emitted into ES2015, resulting\n+                    // in the spread super call below, and then downleveled into ES5 using the\n+                    // \"downlevelIteration\" option.\n+                    super(...arguments);\n+                    this.foo = 'bar';\n+                  }\n+                }\n+              `,\n+             },\n+             {importHelpers: true, noEmitHelpers: true, downlevelIteration: true});\n+\n+         mainNgcc({\n+           basePath: '/node_modules',\n+           targetEntryPointPath: 'test-package',\n+           propertiesToConsider: ['esm5'],\n+         });\n+\n+         const jsContents = fs.readFile(_(`/node_modules/test-package/esm5/src/index.js`));\n+         // Verify that the ES5 bundle does contain the expected downleveling syntax.\n+         expect(jsContents).toContain('__spreadArray([], __read(arguments))');\n+         expect(jsContents)\n+             .toContain(\n+                 'var ɵSubClass_BaseFactory = /*@__PURE__*/ ɵngcc0.ɵɵgetInheritedFactory(SubClass);');\n+       });\n+\n+    it(`should be able to detect synthesized constructors in ES5 with downlevelIteration enabled (emitted helpers)`,\n+       () => {\n+         setupAngularCoreEsm5();\n+         compileIntoApf(\n+             'test-package', {\n+               '/index.ts': `\n+                import {Injectable} from '@angular/core';\n+\n+                @Injectable()\n+                export class Base {}\n+\n+                @Injectable()\n+                export class SubClass extends Base {\n+                  constructor() {\n+                    // Note: mimic the situation where TS is first emitted into ES2015, resulting\n+                    // in the spread super call below, and then downleveled into ES5 using the\n+                    // \"downlevelIteration\" option.\n+                    super(...arguments);\n+                    this.foo = 'bar';\n+                  }\n+                }\n+              `,\n+             },\n+             {importHelpers: false, noEmitHelpers: false, downlevelIteration: true});\n+\n+         mainNgcc({\n+           basePath: '/node_modules',\n+           targetEntryPointPath: 'test-package',\n+           propertiesToConsider: ['esm5'],\n+         });\n+\n+         const jsContents = fs.readFile(_(`/node_modules/test-package/esm5/src/index.js`));\n+         // Verify that the ES5 bundle does contain the expected downleveling syntax.\n+         expect(jsContents).toContain('__spreadArray([], __read(arguments))');\n+         expect(jsContents)\n+             .toContain(\n+                 'var ɵSubClass_BaseFactory = /*@__PURE__*/ ɵngcc0.ɵɵgetInheritedFactory(SubClass);');\n+       });\n+\n     it('should not add `const` in ES5 generated code', () => {\n       setupAngularCoreEsm5();\n       compileIntoFlatEs5Package('test-package', {"
        }
    ],
    "stats": {
        "total": 457,
        "additions": 429,
        "deletions": 28
    }
}