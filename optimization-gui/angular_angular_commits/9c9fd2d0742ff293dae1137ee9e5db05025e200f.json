{
    "author": "petebacondarwin",
    "message": "refactor(compiler): remove `injectFn` option from factory metadata (#41231)\n\nThe `injectFn` reference can be inferred unamiguously from the `target`\nproperty so it is not needed.\n\nPR Close #41231",
    "sha": "9c9fd2d0742ff293dae1137ee9e5db05025e200f",
    "files": [
        {
            "sha": "ad324a7e15fe3d05063f6ffce09b4fb67b5edbd5",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/component.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -853,7 +853,6 @@ export class ComponentDecoratorHandler implements\n       {expression: initializer, statements, type}: R3CompiledExpression): CompileResult[] {\n     const factoryRes = compileNgFactoryDefField({\n       ...analysis.meta,\n-      injectFn: Identifiers.directiveInject,\n       target: R3FactoryTarget.Component,\n     });\n     if (analysis.metadataStmt !== null) {"
        },
        {
            "sha": "1b60acf84f2bbc4fb482867b95572442f804641a",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/directive.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -318,7 +318,6 @@ export class DirectiveDecoratorHandler implements\n       {expression: initializer, statements, type}: R3CompiledExpression): CompileResult[] {\n     const factoryRes = compileNgFactoryDefField({\n       ...analysis.meta,\n-      injectFn: Identifiers.directiveInject,\n       target: R3FactoryTarget.Directive,\n     });\n     if (analysis.metadataStmt !== null) {"
        },
        {
            "sha": "e0255ffd1d7c65f2240b7dea33c1da5a05551233",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/injectable.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Finjectable.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Finjectable.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Finjectable.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -107,7 +107,6 @@ export class InjectableDecoratorHandler implements\n         internalType: meta.internalType,\n         typeArgumentCount: meta.typeArgumentCount,\n         deps: analysis.ctorDeps,\n-        injectFn: Identifiers.inject,\n         target: R3FactoryTarget.Injectable,\n       });\n       if (analysis.metadataStmt !== null) {"
        },
        {
            "sha": "37a7c54eab3865719250d7b0f5f7efa7481c927b",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/ng_module.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -351,7 +351,6 @@ export class NgModuleDecoratorHandler implements\n       typeArgumentCount: 0,\n       deps: getValidConstructorDependencies(\n           node, this.reflector, this.defaultImportRecorder, this.isCore),\n-      injectFn: R3.inject,\n       target: R3FactoryTarget.NgModule,\n     };\n "
        },
        {
            "sha": "edaf8913f2ec39839869416ecefa5c83e6759b7a",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/pipe.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fpipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fpipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fpipe.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -177,7 +177,6 @@ export class PipeDecoratorHandler implements\n   private compilePipe(analysis: Readonly<PipeHandlerData>, def: R3CompiledExpression) {\n     const factoryRes = compileNgFactoryDefField({\n       ...analysis.meta,\n-      injectFn: Identifiers.directiveInject,\n       target: R3FactoryTarget.Pipe,\n     });\n     if (analysis.metadataStmt !== null) {"
        },
        {
            "sha": "4424c416c64cbd8669478e117a08619d48c9f9d6",
            "filename": "packages/compiler/src/compiler_facade_interface.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler%2Fsrc%2Fcompiler_facade_interface.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler%2Fsrc%2Fcompiler_facade_interface.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fcompiler_facade_interface.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -229,7 +229,6 @@ export interface R3FactoryDefMetadataFacade {\n   type: any;\n   typeArgumentCount: number;\n   deps: R3DependencyMetadataFacade[]|null;\n-  injectFn: 'directiveInject'|'inject';\n   target: R3FactoryTarget;\n }\n "
        },
        {
            "sha": "4faa6ea87825bc2b0e4f6894fe9fb73cbec3a533",
            "filename": "packages/compiler/src/injectable_compiler_2.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler%2Fsrc%2Finjectable_compiler_2.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler%2Fsrc%2Finjectable_compiler_2.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Finjectable_compiler_2.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -40,7 +40,6 @@ export function compileInjectable(meta: R3InjectableMetadata): InjectableDef {\n     internalType: meta.internalType,\n     typeArgumentCount: meta.typeArgumentCount,\n     deps: [],\n-    injectFn: Identifiers.inject,\n     target: R3FactoryTarget.Injectable,\n   };\n "
        },
        {
            "sha": "d054dedede8b8711a8f4aeea99fbfa6acf004324",
            "filename": "packages/compiler/src/jit_compiler_facade.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fjit_compiler_facade.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -207,8 +207,6 @@ export class CompilerFacadeImpl implements CompilerFacade {\n       internalType: new WrappedNodeExpr(meta.type),\n       typeArgumentCount: meta.typeArgumentCount,\n       deps: convertR3DependencyMetadataArray(meta.deps),\n-      injectFn: meta.injectFn === 'directiveInject' ? Identifiers.directiveInject :\n-                                                      Identifiers.inject,\n       target: meta.target,\n     });\n     return this.jitExpression("
        },
        {
            "sha": "85e9f4490d7c4749f8ebd22717c281f05709a4a5",
            "filename": "packages/compiler/src/render3/r3_factory.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 16,
            "changes": 37,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Frender3%2Fr3_factory.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -56,12 +56,6 @@ export interface R3ConstructorFactoryMetadata {\n    */\n   deps: R3DependencyMetadata[]|'invalid'|null;\n \n-  /**\n-   * An expression for the function which will be used to inject dependencies. The API of this\n-   * function could be different, and other options control how it will be invoked.\n-   */\n-  injectFn: o.ExternalReference;\n-\n   /**\n    * Type of the target being created by the factory.\n    */\n@@ -190,9 +184,7 @@ export function compileFactoryFunction(meta: R3FactoryMetadata): R3CompiledExpre\n   if (meta.deps !== null) {\n     // There is a constructor (either explicitly or implicitly defined).\n     if (meta.deps !== 'invalid') {\n-      ctorExpr = new o.InstantiateExpr(\n-          typeForCtor,\n-          injectDependencies(meta.deps, meta.injectFn, meta.target === R3FactoryTarget.Pipe));\n+      ctorExpr = new o.InstantiateExpr(typeForCtor, injectDependencies(meta.deps, meta.target));\n \n       ctorDepsType = createCtorDepsType(meta.deps);\n     }\n@@ -230,8 +222,7 @@ export function compileFactoryFunction(meta: R3FactoryMetadata): R3CompiledExpre\n   if (isDelegatedMetadata(meta)) {\n     // This type is created with a delegated factory. If a type parameter is not specified, call\n     // the factory instead.\n-    const delegateArgs =\n-        injectDependencies(meta.delegateDeps, meta.injectFn, meta.target === R3FactoryTarget.Pipe);\n+    const delegateArgs = injectDependencies(meta.delegateDeps, meta.target);\n     // Either call `new delegate(...)` or `delegate(...)` depending on meta.delegateType.\n     const factoryExpr = new (\n         meta.delegateType === R3FactoryDelegateType.Class ?\n@@ -262,14 +253,14 @@ export function compileFactoryFunction(meta: R3FactoryMetadata): R3CompiledExpre\n   };\n }\n \n-function injectDependencies(\n-    deps: R3DependencyMetadata[], injectFn: o.ExternalReference, isPipe: boolean): o.Expression[] {\n-  return deps.map((dep, index) => compileInjectDependency(dep, injectFn, isPipe, index));\n+function injectDependencies(deps: R3DependencyMetadata[], target: R3FactoryTarget): o.Expression[] {\n+  return deps.map((dep, index) => compileInjectDependency(dep, target, index));\n }\n \n function compileInjectDependency(\n-    dep: R3DependencyMetadata, injectFn: o.ExternalReference, isPipe: boolean,\n-    index: number): o.Expression {\n+    dep: R3DependencyMetadata, target: R3FactoryTarget, index: number): o.Expression {\n+  const isPipe = target === R3FactoryTarget.Pipe;\n+\n   // Interpret the dependency according to its resolved type.\n   switch (dep.resolved) {\n     case R3ResolvedDependencyType.Token:\n@@ -295,6 +286,7 @@ function compileInjectDependency(\n       if (flagsParam) {\n         injectArgs.push(flagsParam);\n       }\n+      const injectFn = getInjectFn(target);\n       return o.importExpr(injectFn).callFn(injectArgs);\n     case R3ResolvedDependencyType.Attribute:\n       // In the case of attributes, the attribute name in question is given as the token.\n@@ -401,3 +393,16 @@ function isDelegatedMetadata(meta: R3FactoryMetadata): meta is R3DelegatedFnOrCl\n function isExpressionFactoryMetadata(meta: R3FactoryMetadata): meta is R3ExpressionFactoryMetadata {\n   return (meta as any).expression !== undefined;\n }\n+\n+function getInjectFn(target: R3FactoryTarget): o.ExternalReference {\n+  switch (target) {\n+    case R3FactoryTarget.Component:\n+    case R3FactoryTarget.Directive:\n+    case R3FactoryTarget.Pipe:\n+      return R3.directiveInject;\n+    case R3FactoryTarget.NgModule:\n+    case R3FactoryTarget.Injectable:\n+    default:\n+      return R3.inject;\n+  }\n+}"
        },
        {
            "sha": "5dcae0434da9c95b62eb8713787103b0dd8d817a",
            "filename": "packages/core/src/compiler/compiler_facade_interface.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcore%2Fsrc%2Fcompiler%2Fcompiler_facade_interface.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcore%2Fsrc%2Fcompiler%2Fcompiler_facade_interface.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fcompiler%2Fcompiler_facade_interface.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -229,7 +229,6 @@ export interface R3FactoryDefMetadataFacade {\n   type: any;\n   typeArgumentCount: number;\n   deps: R3DependencyMetadataFacade[]|null;\n-  injectFn: 'directiveInject'|'inject';\n   target: R3FactoryTarget;\n }\n "
        },
        {
            "sha": "f3e27ca4fc262fac48f42829af54a75fda36e9df",
            "filename": "packages/core/src/di/jit/injectable.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Finjectable.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Finjectable.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Fdi%2Fjit%2Finjectable.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -54,7 +54,6 @@ export function compileInjectable(type: Type<any>, srcMeta?: Injectable): void {\n             type: metadata.type,\n             typeArgumentCount: metadata.typeArgumentCount,\n             deps: reflectDependencies(type),\n-            injectFn: 'inject',\n             target: compiler.R3FactoryTarget.Injectable\n           });\n         }"
        },
        {
            "sha": "f2f3a714898a8ea250f46f8e8456ce8544c5d6fb",
            "filename": "packages/core/src/render3/jit/directive.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fdirective.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -210,11 +210,9 @@ function addDirectiveFactoryDef(type: Type<any>, metadata: Directive|Component)\n       if (ngFactoryDef === null) {\n         const meta = getDirectiveMetadata(type, metadata);\n         const compiler = getCompilerFacade();\n-        ngFactoryDef = compiler.compileFactory(angularCoreEnv, `ng:///${type.name}/ɵfac.js`, {\n-          ...meta.metadata,\n-          injectFn: 'directiveInject',\n-          target: compiler.R3FactoryTarget.Directive\n-        });\n+        ngFactoryDef = compiler.compileFactory(\n+            angularCoreEnv, `ng:///${type.name}/ɵfac.js`,\n+            {...meta.metadata, target: compiler.R3FactoryTarget.Directive});\n       }\n       return ngFactoryDef;\n     },"
        },
        {
            "sha": "97dc04402a497d12d096aa75e7ef6457a59521b9",
            "filename": "packages/core/src/render3/jit/module.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fmodule.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fmodule.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fmodule.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -149,7 +149,6 @@ export function compileNgModuleDefs(\n           name: moduleType.name,\n           type: moduleType,\n           deps: reflectDependencies(moduleType),\n-          injectFn: 'inject',\n           target: compiler.R3FactoryTarget.NgModule,\n           typeArgumentCount: 0,\n         });"
        },
        {
            "sha": "1d419b75eec6e752a45ec96f73e24feb4f00cd19",
            "filename": "packages/core/src/render3/jit/pipe.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fpipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/9c9fd2d0742ff293dae1137ee9e5db05025e200f/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fpipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fsrc%2Frender3%2Fjit%2Fpipe.ts?ref=9c9fd2d0742ff293dae1137ee9e5db05025e200f",
            "patch": "@@ -25,7 +25,7 @@ export function compilePipe(type: Type<any>, meta: Pipe): void {\n         const compiler = getCompilerFacade();\n         ngFactoryDef = compiler.compileFactory(\n             angularCoreEnv, `ng:///${metadata.name}/ɵfac.js`,\n-            {...metadata, injectFn: 'directiveInject', target: compiler.R3FactoryTarget.Pipe});\n+            {...metadata, target: compiler.R3FactoryTarget.Pipe});\n       }\n       return ngFactoryDef;\n     },"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 25,
        "deletions": 34
    }
}