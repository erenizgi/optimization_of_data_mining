{
    "author": "gkalpak",
    "message": "fix(docs-infra): improve accessibility by respecting `prefers-reduced-motion` (#43977)\n\nMake the app easier to use for people with motion sensitivities by\ndisabling several animations (esp. ones involving moving things around)\nwhen the user prefers reduced motion. The user's preference is detected\nusing the [prefers-reduced-motion][1] CSS media feature.\n\nDisabled animations include:\n- View fade in/out transitions.\n- Sidenav open/close animations.\n- Top-menu color and size changes.\n- Contributor cards flip animations.\n\nFor more details on using `prefers-reduced-motion` and disabling\nAngular animations see:\n- [Designing with reduced motion for motion sensitivities][2]\n- [Disabling Angular animations at runtime][3]\n\n[1]: https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion\n[2]: https://www.smashingmagazine.com/2020/09/design-reduced-motion-sensitivities/\n[3]: https://dev.to/this-is-angular/disabling-angular-animations-at-runtime-9a6\n\nPR Close #43977",
    "sha": "df5f7370817b306df6d0c5adb517fca26c2e8c5a",
    "files": [
        {
            "sha": "e566e538ac170f59110e9f16400c6a13b3e59187",
            "filename": "aio/src/app/app.component.html",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fapp%2Fapp.component.html",
            "raw_url": "https://github.com/angular/angular/raw/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fapp%2Fapp.component.html",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fapp.component.html?ref=df5f7370817b306df6d0c5adb517fca26c2e8c5a",
            "patch": "@@ -19,7 +19,7 @@\n     </aio-notification>\n   </mat-toolbar-row>\n   <mat-toolbar-row>\n-    <button mat-button class=\"hamburger\" [class.starting]=\"isStarting\" (click)=\"sidenav.toggle()\" title=\"Docs menu\">\n+    <button mat-button class=\"hamburger\" [class.no-animations]=\"disableAnimations\" (click)=\"sidenav.toggle()\" title=\"Docs menu\">\n       <mat-icon svgIcon=\"menu\"></mat-icon>\n     </button>\n     <a class=\"nav-link home\" href=\"/\" [ngSwitch]=\"showTopMenu\">\n@@ -45,7 +45,7 @@\n \n <aio-search-results #searchResultsView *ngIf=\"showSearchResults\" [searchResults]=\"searchResults | async\" (resultSelected)=\"hideSearchResults()\"></aio-search-results>\n \n-<mat-sidenav-container class=\"sidenav-container\" [class.starting]=\"isStarting\" [class.has-floating-toc]=\"hasFloatingToc\" role=\"main\">\n+<mat-sidenav-container class=\"sidenav-container\" [class.no-animations]=\"disableAnimations\" [class.has-floating-toc]=\"hasFloatingToc\" role=\"main\">\n \n   <mat-sidenav [ngClass]=\"{'collapsed': !dockSideNav}\" #sidenav class=\"sidenav\" [mode]=\"mode\" [opened]=\"isOpened\" (openedChange)=\"updateHostClasses()\">\n     <aio-nav-menu *ngIf=\"!showTopMenu\" [nodes]=\"topMenuNarrowNodes\" [currentNode]=\"currentNodes?.TopBarNarrow\" [isWide]=\"dockSideNav\"></aio-nav-menu>\n@@ -59,7 +59,7 @@\n   <main class=\"sidenav-content\" [id]=\"pageId\" role=\"main\">\n     <div id=\"main-content\" tabindex=\"-1\"></div>\n     <aio-mode-banner [mode]=\"deployment.mode\" [version]=\"versionInfo\"></aio-mode-banner>\n-    <aio-doc-viewer [class.no-animations]=\"isStarting\" [doc]=\"currentDocument\" (docReady)=\"onDocReady()\" (docRemoved)=\"onDocRemoved()\" (docInserted)=\"onDocInserted()\" (docRendered)=\"onDocRendered()\">\n+    <aio-doc-viewer [class.no-animations]=\"disableAnimations\" [doc]=\"currentDocument\" (docReady)=\"onDocReady()\" (docRemoved)=\"onDocRemoved()\" (docInserted)=\"onDocInserted()\" (docRendered)=\"onDocRendered()\">\n     </aio-doc-viewer>\n     <aio-dt *ngIf=\"dtOn\" [(doc)]=\"currentDocument\"></aio-dt>\n   </main>"
        },
        {
            "sha": "de13b7015d6c1d6454f0f97536d3e0cb2b41ed88",
            "filename": "aio/src/app/app.component.spec.ts",
            "status": "modified",
            "additions": 65,
            "deletions": 18,
            "changes": 83,
            "blob_url": "https://github.com/angular/angular/blob/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fapp%2Fapp.component.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fapp%2Fapp.component.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fapp.component.spec.ts?ref=df5f7370817b306df6d0c5adb517fca26c2e8c5a",
            "patch": "@@ -926,70 +926,79 @@ describe('AppComponent', () => {\n     });\n \n     describe('initial rendering', () => {\n-      beforeEach(jasmine.clock().install);\n-      afterEach(jasmine.clock().uninstall);\n+      const originialReducedMotion = AppComponent.reducedMotion;\n+\n+      beforeEach(() => {\n+        jasmine.clock().install();\n+        AppComponent.reducedMotion = false;\n+      });\n+\n+      afterEach(() => {\n+        jasmine.clock().uninstall();\n+        AppComponent.reducedMotion = originialReducedMotion;\n+      });\n \n       it('should initially disable Angular animations until a document is rendered', () => {\n         initializeTest(false);\n         jasmine.clock().tick(1);  // triggers the HTTP response for the document\n \n-        expect(component.isStarting).toBe(true);\n+        expect(component.disableAnimations).toBe(true);\n         expect(fixture.debugElement.properties['@.disabled']).toBe(true);\n \n         triggerDocViewerEvent('docInserted');\n         jasmine.clock().tick(startedDelay);\n         fixture.detectChanges();\n-        expect(component.isStarting).toBe(true);\n+        expect(component.disableAnimations).toBe(true);\n         expect(fixture.debugElement.properties['@.disabled']).toBe(true);\n \n         triggerDocViewerEvent('docRendered');\n         jasmine.clock().tick(startedDelay);\n         fixture.detectChanges();\n-        expect(component.isStarting).toBe(false);\n+        expect(component.disableAnimations).toBe(false);\n         expect(fixture.debugElement.properties['@.disabled']).toBe(false);\n       });\n \n-      it('should initially add the starting class until a document is rendered', () => {\n+      it('should initially add the `no-animations` class until a document is rendered', () => {\n         initializeTest(false);\n         jasmine.clock().tick(1);  // triggers the HTTP response for the document\n         const sidenavContainer = fixture.debugElement.query(By.css('mat-sidenav-container')).nativeElement;\n \n-        expect(component.isStarting).toBe(true);\n-        expect(hamburger.classList.contains('starting')).toBe(true);\n-        expect(sidenavContainer.classList.contains('starting')).toBe(true);\n+        expect(component.disableAnimations).toBe(true);\n+        expect(hamburger.classList.contains('no-animations')).toBe(true);\n+        expect(sidenavContainer.classList.contains('no-animations')).toBe(true);\n \n         triggerDocViewerEvent('docInserted');\n         jasmine.clock().tick(startedDelay);\n         fixture.detectChanges();\n-        expect(component.isStarting).toBe(true);\n-        expect(hamburger.classList.contains('starting')).toBe(true);\n-        expect(sidenavContainer.classList.contains('starting')).toBe(true);\n+        expect(component.disableAnimations).toBe(true);\n+        expect(hamburger.classList.contains('no-animations')).toBe(true);\n+        expect(sidenavContainer.classList.contains('no-animations')).toBe(true);\n \n         triggerDocViewerEvent('docRendered');\n         jasmine.clock().tick(startedDelay);\n         fixture.detectChanges();\n-        expect(component.isStarting).toBe(false);\n-        expect(hamburger.classList.contains('starting')).toBe(false);\n-        expect(sidenavContainer.classList.contains('starting')).toBe(false);\n+        expect(component.disableAnimations).toBe(false);\n+        expect(hamburger.classList.contains('no-animations')).toBe(false);\n+        expect(sidenavContainer.classList.contains('no-animations')).toBe(false);\n       });\n \n       it('should initially disable animations on the DocViewer for the first rendering', () => {\n         initializeTest(false);\n         jasmine.clock().tick(1);  // triggers the HTTP response for the document\n \n-        expect(component.isStarting).toBe(true);\n+        expect(component.disableAnimations).toBe(true);\n         expect(docViewer.classList.contains('no-animations')).toBe(true);\n \n         triggerDocViewerEvent('docInserted');\n         jasmine.clock().tick(startedDelay);\n         fixture.detectChanges();\n-        expect(component.isStarting).toBe(true);\n+        expect(component.disableAnimations).toBe(true);\n         expect(docViewer.classList.contains('no-animations')).toBe(true);\n \n         triggerDocViewerEvent('docRendered');\n         jasmine.clock().tick(startedDelay);\n         fixture.detectChanges();\n-        expect(component.isStarting).toBe(false);\n+        expect(component.disableAnimations).toBe(false);\n         expect(docViewer.classList.contains('no-animations')).toBe(false);\n       });\n     });\n@@ -1050,6 +1059,44 @@ describe('AppComponent', () => {\n       });\n     });\n \n+    describe('disableAnimations', () => {\n+      const originialReducedMotion = AppComponent.reducedMotion;\n+\n+      beforeEach(() => {\n+        jasmine.clock().install();\n+        AppComponent.reducedMotion = false;\n+      });\n+\n+      afterEach(() => {\n+        jasmine.clock().uninstall();\n+        AppComponent.reducedMotion = originialReducedMotion;\n+      });\n+\n+      it('should initially be true', () => {\n+        initializeTest(false);\n+        expect(component.disableAnimations).toBe(true);\n+      });\n+\n+      it('should become false after initial render', () => {\n+        initializeTest(false);\n+\n+        triggerDocViewerEvent('docRendered');\n+        jasmine.clock().tick(startedDelay);\n+\n+        expect(component.disableAnimations).toBe(false);\n+      });\n+\n+      it('should remain true (even after initial render) if user prefers reduced motion', () => {\n+        AppComponent.reducedMotion = true;\n+        initializeTest(false);\n+\n+        triggerDocViewerEvent('docRendered');\n+        jasmine.clock().tick(startedDelay);\n+\n+        expect(component.disableAnimations).toBe(true);\n+      });\n+    });\n+\n     describe('pageId', () => {\n       const navigateTo = (path: string) => {\n         locationService.go(path);"
        },
        {
            "sha": "926ad6fa317da15f6fbef508a6a8dd4fc7c2e05d",
            "filename": "aio/src/app/app.component.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fapp%2Fapp.component.ts",
            "raw_url": "https://github.com/angular/angular/raw/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fapp%2Fapp.component.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fapp.component.ts?ref=df5f7370817b306df6d0c5adb517fca26c2e8c5a",
            "patch": "@@ -34,6 +34,12 @@ export const showFloatingTocWidth = 800;\n })\n export class AppComponent implements OnInit {\n \n+  static reducedMotion = window.matchMedia('(prefers-reduced-motion)').matches;\n+\n+  // Disable all Angular animations if the user prefers reduced motion or for the initial render.\n+  @HostBinding('@.disabled')\n+  get disableAnimations(): boolean { return AppComponent.reducedMotion || this.isStarting; }\n+\n   currentDocument: DocumentContents;\n   currentDocVersion: NavigationNode;\n   currentNodes: CurrentNodes = {};\n@@ -65,9 +71,7 @@ export class AppComponent implements OnInit {\n   @HostBinding('class')\n   hostClasses = '';\n \n-  // Disable all Angular animations for the initial render.\n-  @HostBinding('@.disabled')\n-  isStarting = true;\n+  private isStarting = true;\n   isTransitioning = true;\n   isFetching = false;\n   showTopMenu = false;"
        },
        {
            "sha": "cbf60734c1c73a5c579770befa70d146ad66a911",
            "filename": "aio/src/app/app.module.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fapp%2Fapp.module.ts",
            "raw_url": "https://github.com/angular/angular/raw/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fapp%2Fapp.module.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fapp%2Fapp.module.ts?ref=df5f7370817b306df6d0c5adb517fca26c2e8c5a",
            "patch": "@@ -146,7 +146,7 @@ export const svgIconProviders = [\n @NgModule({\n   imports: [\n     BrowserModule,\n-    BrowserAnimationsModule,\n+    BrowserAnimationsModule.withConfig({disableAnimations: AppComponent.reducedMotion}),\n     CustomElementsModule,\n     HttpClientModule,\n     MatButtonModule,"
        },
        {
            "sha": "3678f041dd4c502f01b2b39ca1312cdb2ccd87ea",
            "filename": "aio/src/styles/1-layouts/sidenav/_sidenav.scss",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fstyles%2F1-layouts%2Fsidenav%2F_sidenav.scss",
            "raw_url": "https://github.com/angular/angular/raw/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fstyles%2F1-layouts%2Fsidenav%2F_sidenav.scss",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fstyles%2F1-layouts%2Fsidenav%2F_sidenav.scss?ref=df5f7370817b306df6d0c5adb517fca26c2e8c5a",
            "patch": "@@ -2,7 +2,7 @@\n @use '../../mixins';\n \n // Disable sidenav animations for the initial render.\n-.starting.mat-drawer-transition .mat-drawer-content {\n+.no-animations.mat-drawer-transition .mat-drawer-content {\n   transition: none;\n }\n "
        },
        {
            "sha": "dcf3289bedff1e652084228fa724832c40cd2074",
            "filename": "aio/src/styles/1-layouts/top-menu/_top-menu.scss",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fstyles%2F1-layouts%2Ftop-menu%2F_top-menu.scss",
            "raw_url": "https://github.com/angular/angular/raw/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fstyles%2F1-layouts%2Ftop-menu%2F_top-menu.scss",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fstyles%2F1-layouts%2Ftop-menu%2F_top-menu.scss?ref=df5f7370817b306df6d0c5adb517fca26c2e8c5a",
            "patch": "@@ -58,7 +58,7 @@ mat-toolbar.app-toolbar {\n       min-width: 15%;\n     }\n \n-    &:not(.starting) {\n+    &:not(.no-animations) {\n       transition-duration: 0.4s;\n       transition-property: color, margin;\n       transition-timing-function: cubic-bezier(0.25, 0.8, 0.25, 1);"
        },
        {
            "sha": "aed640cc68c463cf8cc6586561676060f2bcd6b5",
            "filename": "aio/src/styles/2-modules/contributor/_contributor.scss",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fstyles%2F2-modules%2Fcontributor%2F_contributor.scss",
            "raw_url": "https://github.com/angular/angular/raw/df5f7370817b306df6d0c5adb517fca26c2e8c5a/aio%2Fsrc%2Fstyles%2F2-modules%2Fcontributor%2F_contributor.scss",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fsrc%2Fstyles%2F2-modules%2Fcontributor%2F_contributor.scss?ref=df5f7370817b306df6d0c5adb517fca26c2e8c5a",
            "patch": "@@ -22,7 +22,10 @@ aio-contributor {\n   margin: 8px;\n   border-radius: 4px;\n   box-shadow: 0 2px 2px rgba(10, 16, 20, 0.24), 0 0 2px rgba(10, 16, 20, 0.12);\n-  transition: all .3s;\n+\n+  @media not all and (prefers-reduced-motion) {\n+    transition: all .3s;\n+  }\n \n   @media (hover) {\n     &:focus-within,\n@@ -102,7 +105,10 @@ aio-contributor {\n     max-width: 310px;\n     max-height: 340px;\n     transform-style:preserve-3d;\n-    transition:transform ease 500ms;\n+\n+    @media not all and (prefers-reduced-motion) {\n+      transition:transform ease 500ms;\n+    }\n \n     h3 {\n       margin: 0.8rem 0;\n@@ -162,7 +168,6 @@ aio-contributor {\n     background-size: cover;\n     background-position: center;\n     margin: 0.8rem auto;\n-    transition: all .2s ease-in-out;\n   }\n \n   p {"
        }
    ],
    "stats": {
        "total": 116,
        "additions": 86,
        "deletions": 30
    }
}