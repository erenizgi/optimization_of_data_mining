{
    "author": "josephperrott",
    "message": "build: rely on engines to prevent using npm for dependency install (#41477)\n\nRather than relying on a preinstall script, set `engine-strict` to `true` in a\nproject `.npmrc` file, relying on the `engines` having `npm` set to note that\nyarn should be used instead.\n\n---\n\nOutput from `npm install` changes from:\n```\n$ npm install\n\n> angular-srcs@12.0.0-next.7 preinstall /usr/local/account/js/angular\n> node tools/yarn/check-yarn.js\n\n/usr/local/account/js/angular/tools/yarn/check-yarn.js:12\n  throw new Error(\n  ^\n\nError: Please use Yarn instead of NPM to install dependencies. See: https://yarnpkg.com/lang/en/docs/install/\n    at Object.<anonymous> (/usr/local/account/js/angular/tools/yarn/check-yarn.js:12:9)\n    at Module._compile (internal/modules/cjs/loader.js:778:30)\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:789:10)\n    at Module.load (internal/modules/cjs/loader.js:653:32)\n    at tryModuleLoad (internal/modules/cjs/loader.js:593:12)\n    at Function.Module._load (internal/modules/cjs/loader.js:585:3)\n    at Function.Module.runMain (internal/modules/cjs/loader.js:831:12)\n    at startup (internal/bootstrap/node.js:283:19)\n    at bootstrapNodeJSCore (internal/bootstrap/node.js:623:3)\nnpm ERR! code ELIFECYCLE\nnpm ERR! errno 1\nnpm ERR! angular-srcs@12.0.0-next.7 preinstall: `node tools/yarn/check-yarn.js`\nnpm ERR! Exit status 1\nnpm ERR!\nnpm ERR! Failed at the angular-srcs@12.0.0-next.7 preinstall script.\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /usr/local/account/.npm/_logs/2021-04-06T22_54_02_292Z-debug.log\n```\nto\n```\n$ npm install\nnpm ERR! code ENOTSUP\nnpm ERR! notsup Unsupported engine for angular-srcs@12.0.0-next.7: wanted: {\"node\":\">=10.19.0 <13.0.0\",\"yarn\":\">=1.22.4 <2\",\"npm\":\"Plesae use yarn instead of NPM to install dependencies\"} (current: {\"node\":\"10.20.1\",\"npm\":\"6.14.4\"})\nnpm ERR! notsup Not compatible with your version of node/npm: angular-srcs@12.0.0-next.7\nnpm ERR! notsup Not compatible with your version of node/npm: angular-srcs@12.0.0-next.7\nnpm ERR! notsup Required: {\"node\":\">=10.19.0 <13.0.0\",\"yarn\":\">=1.22.4 <2\",\"npm\":\"Plesae use yarn instead of NPM to install dependencies\"}\nnpm ERR! notsup Actual:   {\"npm\":\"6.14.4\",\"node\":\"10.20.1\"}\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /usr/local/account/.npm/_logs/2021-04-06T22_53_23_912Z-debug.log\n```\n\nPR Close #41477",
    "sha": "c385e744541554ad69a9d664cec1b33d8c2a4138",
    "files": [
        {
            "sha": "c42da845b4490f8793a839b302915b4e54de71b4",
            "filename": ".npmrc",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/c385e744541554ad69a9d664cec1b33d8c2a4138/.npmrc",
            "raw_url": "https://github.com/angular/angular/raw/c385e744541554ad69a9d664cec1b33d8c2a4138/.npmrc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.npmrc?ref=c385e744541554ad69a9d664cec1b33d8c2a4138",
            "patch": "@@ -0,0 +1 @@\n+engine-strict = true"
        },
        {
            "sha": "c42da845b4490f8793a839b302915b4e54de71b4",
            "filename": "aio/.npmrc",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/c385e744541554ad69a9d664cec1b33d8c2a4138/aio%2F.npmrc",
            "raw_url": "https://github.com/angular/angular/raw/c385e744541554ad69a9d664cec1b33d8c2a4138/aio%2F.npmrc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2F.npmrc?ref=c385e744541554ad69a9d664cec1b33d8c2a4138",
            "patch": "@@ -0,0 +1 @@\n+engine-strict = true"
        },
        {
            "sha": "4bc0d0cae86e89cf7582959894f78870799eae18",
            "filename": "aio/package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/c385e744541554ad69a9d664cec1b33d8c2a4138/aio%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/c385e744541554ad69a9d664cec1b33d8c2a4138/aio%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fpackage.json?ref=c385e744541554ad69a9d664cec1b33d8c2a4138",
            "patch": "@@ -6,7 +6,6 @@\n   \"author\": \"Angular\",\n   \"license\": \"MIT\",\n   \"scripts\": {\n-    \"preinstall\": \"node ../tools/yarn/check-yarn.js\",\n     \"postinstall\": \"node tools/cli-patches/patch.js\",\n     \"aio-use-local\": \"node tools/ng-packages-installer overwrite . --debug --force --build-packages\",\n     \"aio-use-npm\": \"node tools/ng-packages-installer restore .\",\n@@ -86,7 +85,8 @@\n   \"//engines-comment\": \"Keep this in sync with /package.json and /aio/tools/examples/shared/package.json\",\n   \"engines\": {\n     \"node\": \">=10.19.0 <16.0.0\",\n-    \"yarn\": \">=1.22.4 <2\"\n+    \"yarn\": \">=1.22.4 <2\",\n+    \"npm\": \"Please use yarn instead of NPM to install dependencies\"\n   },\n   \"private\": true,\n   \"dependencies\": {"
        },
        {
            "sha": "c42da845b4490f8793a839b302915b4e54de71b4",
            "filename": "aio/tools/examples/shared/.npmrc",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/c385e744541554ad69a9d664cec1b33d8c2a4138/aio%2Ftools%2Fexamples%2Fshared%2F.npmrc",
            "raw_url": "https://github.com/angular/angular/raw/c385e744541554ad69a9d664cec1b33d8c2a4138/aio%2Ftools%2Fexamples%2Fshared%2F.npmrc",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2Fshared%2F.npmrc?ref=c385e744541554ad69a9d664cec1b33d8c2a4138",
            "patch": "@@ -0,0 +1 @@\n+engine-strict = true"
        },
        {
            "sha": "065258d56d38a991be029f49b72a04e13dd653da",
            "filename": "aio/tools/examples/shared/package.json",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/c385e744541554ad69a9d664cec1b33d8c2a4138/aio%2Ftools%2Fexamples%2Fshared%2Fpackage.json",
            "raw_url": "https://github.com/angular/angular/raw/c385e744541554ad69a9d664cec1b33d8c2a4138/aio%2Ftools%2Fexamples%2Fshared%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Ftools%2Fexamples%2Fshared%2Fpackage.json?ref=c385e744541554ad69a9d664cec1b33d8c2a4138",
            "patch": "@@ -7,14 +7,15 @@\n     \"http-server\": \"http-server\",\n     \"protractor\": \"protractor\",\n     \"webdriver:update\": \"node ../../../../scripts/webdriver-manager-update.js\",\n-    \"preinstall\": \"node ../../../../tools/yarn/check-yarn.js\",\n     \"postinstall\": \"yarn webdriver:update\",\n     \"sync-deps\": \"node sync-boilerplate-dependencies\"\n   },\n   \"//engines-comment\": \"Keep this in sync with /package.json and /aio/package.json\",\n   \"engines\": {\n     \"node\": \">=10.19.0 <16.0.0\",\n-    \"yarn\": \">=1.21.1 <2\"\n+    \"yarn\": \">=1.21.1 <2\",\n+    \"npm\": \"Please use yarn instead of NPM to install dependencies\"\n+\n   },\n   \"keywords\": [],\n   \"author\": \"\","
        },
        {
            "sha": "df836535d48bbf113e2c3792691f1b8a23c187e5",
            "filename": "package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/c385e744541554ad69a9d664cec1b33d8c2a4138/package.json",
            "raw_url": "https://github.com/angular/angular/raw/c385e744541554ad69a9d664cec1b33d8c2a4138/package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/package.json?ref=c385e744541554ad69a9d664cec1b33d8c2a4138",
            "patch": "@@ -9,7 +9,8 @@\n   \"//engines-comment\": \"Keep this in sync with /aio/package.json and /aio/tools/examples/shared/package.json\",\n   \"engines\": {\n     \"node\": \">=10.19.0 <16.0.0\",\n-    \"yarn\": \">=1.22.4 <2\"\n+    \"yarn\": \">=1.22.4 <2\",\n+    \"npm\": \"Please use yarn instead of NPM to install dependencies\"\n   },\n   \"repository\": {\n     \"type\": \"git\",\n@@ -31,7 +32,6 @@\n     \"// 2\": \"Find the usage you are looking for with:\",\n     \"// 3\": \"yarn ng-dev --help\",\n     \"/ \": \"\",\n-    \"preinstall\": \"node tools/yarn/check-yarn.js\",\n     \"postinstall\": \"node scripts/webdriver-manager-update.js && node --preserve-symlinks --preserve-symlinks-main ./tools/postinstall-patches.js\",\n     \"prepare\": \"husky install\",\n     \"test-ivy-aot\": \"bazelisk test --config=ivy --build_tag_filters=-no-ivy-aot,-fixme-ivy-aot --test_tag_filters=-no-ivy-aot,-fixme-ivy-aot\","
        },
        {
            "sha": "8fc301063902b6210a2a3bf90a1a105315919819",
            "filename": "tools/yarn/check-yarn.js",
            "status": "removed",
            "additions": 0,
            "deletions": 14,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/tools%2Fyarn%2Fcheck-yarn.js",
            "raw_url": "https://github.com/angular/angular/raw/ec27bd4ed1cc086d76d8142fadf87354b38aa61a/tools%2Fyarn%2Fcheck-yarn.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fyarn%2Fcheck-yarn.js?ref=ec27bd4ed1cc086d76d8142fadf87354b38aa61a",
            "patch": "@@ -1,14 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-'use strict';\n-\n-if (process.env.npm_execpath.indexOf('yarn') === -1) {\n-  throw new Error(\n-      'Please use Yarn instead of NPM to install dependencies. See: https://yarnpkg.com/lang/en/docs/install/');\n-}"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 10,
        "deletions": 20
    }
}