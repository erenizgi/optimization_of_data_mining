{
    "author": "devversion",
    "message": "build: remove `skydoc` and `rules_sass` from repository (#42760)\n\nSkydoc is no longer used as `@angular/bazel` is no longer a\npublic API. The Sass rules were only used in a single place\nin the repo where Sass is not really needed and has just been\nadded by accident most likely. We want to remove the Sass dependency\nin preparation for Rules NodeJS v4.x where the Sass rules currently\nstill use an older version of `@bazel/worker` that is incompatible.\n\nPR Close #42760",
    "sha": "12443ea7395c9ddc8e36314a8cc92253e2d07d26",
    "files": [
        {
            "sha": "91e3214cad7b81cc04f9ea1287ebfb152bb9c631",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/12443ea7395c9ddc8e36314a8cc92253e2d07d26/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/angular/angular/raw/12443ea7395c9ddc8e36314a8cc92253e2d07d26/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.circleci%2Fconfig.yml?ref=12443ea7395c9ddc8e36314a8cc92253e2d07d26",
            "patch": "@@ -24,14 +24,14 @@ version: 2.1\n # **NOTE 2 **: If you change the cache key prefix, also sync the cache_key_fallback to match.\n # **NOTE 3 **: Keep the static part of the cache key as prefix to enable correct fallbacks.\n # See https://circleci.com/docs/2.0/caching/#restoring-cache for how prefixes work in CircleCI.\n-var_3: &cache_key v4-angular-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}-{{ checksum \"packages/bazel/package.bzl\" }}-{{ checksum \"aio/yarn.lock\" }}\n+var_3: &cache_key v4-angular-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}-{{ checksum \"aio/yarn.lock\" }}\n # We invalidate the cache if the Bazel version changes because otherwise the `bazelisk` cache\n # folder will contain all previously used versions and ultimately cause the cache restoring to\n # be slower due to its growing size.\n var_4: &cache_key_fallback v4-angular-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n \n # Windows needs its own cache key because binaries in node_modules are different.\n-var_3_win: &cache_key_win v4-angular-win-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}-{{ checksum \"packages/bazel/package.bzl\" }}-{{ checksum \"aio/yarn.lock\" }}\n+var_3_win: &cache_key_win v4-angular-win-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}-{{ checksum \"yarn.lock\" }}-{{ checksum \"WORKSPACE\" }}-{{ checksum \"aio/yarn.lock\" }}\n var_4_win: &cache_key_win_fallback v4-angular-win-node-14-{{ checksum \"month.txt\" }}-{{ checksum \".bazelversion\" }}\n \n # Cache key for the `components-repo-unit-tests` job. **Note** when updating the SHA in the"
        },
        {
            "sha": "6c77e2d931022995ecb8c6fbc3c1daa8f6cb1669",
            "filename": "WORKSPACE",
            "status": "modified",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/12443ea7395c9ddc8e36314a8cc92253e2d07d26/WORKSPACE",
            "raw_url": "https://github.com/angular/angular/raw/12443ea7395c9ddc8e36314a8cc92253e2d07d26/WORKSPACE",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/WORKSPACE?ref=12443ea7395c9ddc8e36314a8cc92253e2d07d26",
            "patch": "@@ -34,11 +34,6 @@ yarn_install(\n     yarn_lock = \"//:yarn.lock\",\n )\n \n-# Load angular dependencies\n-load(\"//packages/bazel:package.bzl\", \"rules_angular_dev_dependencies\")\n-\n-rules_angular_dev_dependencies()\n-\n # Load protractor dependencies\n load(\"@npm//@bazel/protractor:package.bzl\", \"npm_bazel_protractor_dependencies\")\n \n@@ -52,13 +47,3 @@ web_test_repositories()\n load(\"//dev-infra/bazel/browsers:browser_repositories.bzl\", \"browser_repositories\")\n \n browser_repositories()\n-\n-# Setup the rules_sass toolchain\n-load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_repositories\")\n-\n-sass_repositories()\n-\n-# Setup the skydoc toolchain\n-load(\"@io_bazel_skydoc//skylark:skylark.bzl\", \"skydoc_repositories\")\n-\n-skydoc_repositories()"
        },
        {
            "sha": "45c2f809ab97aa186c4177f7bd05287c507aece6",
            "filename": "integration/bazel/src/hello-world/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/12443ea7395c9ddc8e36314a8cc92253e2d07d26/integration%2Fbazel%2Fsrc%2Fhello-world%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/12443ea7395c9ddc8e36314a8cc92253e2d07d26/integration%2Fbazel%2Fsrc%2Fhello-world%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/integration%2Fbazel%2Fsrc%2Fhello-world%2FBUILD.bazel?ref=12443ea7395c9ddc8e36314a8cc92253e2d07d26",
            "patch": "@@ -1,10 +1,10 @@\n-package(default_visibility = [\"//visibility:public\"])\n-\n load(\"@npm//@bazel/concatjs:index.bzl\", \"karma_web_test_suite\")\n load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n load(\"@npm//@angular/bazel:index.bzl\", \"ng_package\")\n load(\"//tools:ng_ts_library.bzl\", \"ng_ts_library\")\n \n+package(default_visibility = [\"//visibility:public\"])\n+\n sass_binary(\n     name = \"hello-world-styles\",\n     src = \"hello-world.component.scss\","
        },
        {
            "sha": "8d727306bd9560ef336ec7afaf1963fbaff1800f",
            "filename": "modules/benchmarks/src/class_bindings/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/12443ea7395c9ddc8e36314a8cc92253e2d07d26/modules%2Fbenchmarks%2Fsrc%2Fclass_bindings%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/12443ea7395c9ddc8e36314a8cc92253e2d07d26/modules%2Fbenchmarks%2Fsrc%2Fclass_bindings%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fclass_bindings%2FBUILD.bazel?ref=12443ea7395c9ddc8e36314a8cc92253e2d07d26",
            "patch": "@@ -1,12 +1,6 @@\n-package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n-\n-load(\"@io_bazel_rules_sass//:defs.bzl\", \"sass_binary\")\n load(\"//dev-infra/benchmark/component_benchmark:component_benchmark.bzl\", \"component_benchmark\")\n \n-sass_binary(\n-    name = \"class_bindings_styles\",\n-    src = \":styles.scss\",\n-)\n+package(default_visibility = [\"//modules/benchmarks:__subpackages__\"])\n \n component_benchmark(\n     name = \"benchmark\",\n@@ -28,5 +22,5 @@ component_benchmark(\n         exclude = [\"**/*.perf-spec.ts\"],\n     ),\n     prefix = \"\",\n-    styles = [\":class_bindings_styles\"],\n+    styles = [\"styles.css\"],\n )"
        },
        {
            "sha": "bf7b4b98575c085cf0d4ddce71dafb9b1905a564",
            "filename": "modules/benchmarks/src/class_bindings/styles.css",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/angular/angular/blob/12443ea7395c9ddc8e36314a8cc92253e2d07d26/modules%2Fbenchmarks%2Fsrc%2Fclass_bindings%2Fstyles.css",
            "raw_url": "https://github.com/angular/angular/raw/12443ea7395c9ddc8e36314a8cc92253e2d07d26/modules%2Fbenchmarks%2Fsrc%2Fclass_bindings%2Fstyles.css",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/modules%2Fbenchmarks%2Fsrc%2Fclass_bindings%2Fstyles.css?ref=12443ea7395c9ddc8e36314a8cc92253e2d07d26",
            "previous_filename": "modules/benchmarks/src/class_bindings/styles.scss"
        },
        {
            "sha": "64bad9c349ec896f2dbb0feb573aeab10000f2a0",
            "filename": "packages/bazel/package.bzl",
            "status": "removed",
            "additions": 0,
            "deletions": 51,
            "changes": 51,
            "blob_url": "https://github.com/angular/angular/blob/53b281ae1b0d12e0febc92d72e1ef2dd7fd9c580/packages%2Fbazel%2Fpackage.bzl",
            "raw_url": "https://github.com/angular/angular/raw/53b281ae1b0d12e0febc92d72e1ef2dd7fd9c580/packages%2Fbazel%2Fpackage.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fpackage.bzl?ref=53b281ae1b0d12e0febc92d72e1ef2dd7fd9c580",
            "patch": "@@ -1,51 +0,0 @@\n-# Copyright Google LLC All Rights Reserved.\n-#\n-# Use of this source code is governed by an MIT-style license that can be\n-# found in the LICENSE file at https://angular.io/license\n-\n-\"\"\"Package file which defines dependencies of Angular rules in skylark\n-\"\"\"\n-\n-load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\")\n-\n-def rules_angular_dependencies():\n-    print(\"\"\"DEPRECATION WARNING:\n-    rules_angular_dependencies is no longer needed, and will be removed in a future release.\n-    We assume you will fetch rules_nodejs in your WORKSPACE file, and no other dependencies remain here.\n-    Simply remove any calls to this function and the corresponding call to\n-      load(\"@angular//:package.bzl\", \"rules_angular_dependencies\")\n-    \"\"\")\n-\n-def rules_angular_dev_dependencies():\n-    \"\"\"\n-    Fetch dependencies needed for local development, but not needed by users.\n-\n-    These are in this file to keep version information in one place, and make the WORKSPACE\n-    shorter.\n-    \"\"\"\n-\n-    #############################################\n-    # Dependencies for generating documentation #\n-    #############################################\n-    _maybe(\n-        http_archive,\n-        name = \"io_bazel_rules_sass\",\n-        sha256 = \"596ab3616d370135e0ecc710e103422e0aa3719f1c970303a0886b70c81ee819\",\n-        strip_prefix = \"rules_sass-1.32.2\",\n-        urls = [\n-            \"https://github.com/bazelbuild/rules_sass/archive/1.32.2.zip\",\n-            \"https://mirror.bazel.build/github.com/bazelbuild/rules_sass/archive/1.32.2.zip\",\n-        ],\n-    )\n-\n-    http_archive(\n-        name = \"io_bazel_skydoc\",\n-        sha256 = \"f88058b43112e9bdc7fdb0abbdc17c5653268708c01194a159641119195e45c6\",\n-        strip_prefix = \"skydoc-a9550cb3ca3939cbabe3b589c57b6f531937fa99\",\n-        # TODO: switch to upstream when https://github.com/bazelbuild/skydoc/pull/103 is merged\n-        url = \"https://github.com/alexeagle/skydoc/archive/a9550cb3ca3939cbabe3b589c57b6f531937fa99.zip\",\n-    )\n-\n-def _maybe(repo_rule, name, **kwargs):\n-    if name not in native.existing_rules():\n-        repo_rule(name = name, **kwargs)"
        },
        {
            "sha": "5a5ec0b00930970e663e4a937463e0ac26643c6c",
            "filename": "packages/bazel/src/BUILD.bazel",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/12443ea7395c9ddc8e36314a8cc92253e2d07d26/packages%2Fbazel%2Fsrc%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/12443ea7395c9ddc8e36314a8cc92253e2d07d26/packages%2Fbazel%2Fsrc%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fsrc%2FBUILD.bazel?ref=12443ea7395c9ddc8e36314a8cc92253e2d07d26",
            "patch": "@@ -1,3 +1,5 @@\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\")\n+\n # BEGIN-DEV-ONLY\n package(default_visibility = [\"//packages/bazel:__subpackages__\"])\n \n@@ -6,11 +8,6 @@ filegroup(\n     srcs = glob([\"*\"]),\n )\n \n-# For generating skydoc\n-exports_files(glob([\"*.bzl\"]))\n-\n-load(\"@build_bazel_rules_nodejs//:index.bzl\", \"nodejs_binary\")\n-\n nodejs_binary(\n     name = \"modify_tsconfig\",\n     data = ["
        },
        {
            "sha": "c5a295f7be51729403255cf80f9e0e2a119c102e",
            "filename": "packages/bazel/src/ng_module.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 9,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/12443ea7395c9ddc8e36314a8cc92253e2d07d26/packages%2Fbazel%2Fsrc%2Fng_module.bzl",
            "raw_url": "https://github.com/angular/angular/raw/12443ea7395c9ddc8e36314a8cc92253e2d07d26/packages%2Fbazel%2Fsrc%2Fng_module.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fsrc%2Fng_module.bzl?ref=12443ea7395c9ddc8e36314a8cc92253e2d07d26",
            "patch": "@@ -693,19 +693,11 @@ def _ng_module_impl(ctx):\n \n     return ts_providers_dict_to_struct(ts_providers)\n \n-local_deps_aspects = [node_modules_aspect, _collect_summaries_aspect]\n-\n-# Workaround skydoc bug which assumes DEPS_ASPECTS is a str type\n-[local_deps_aspects.append(a) for a in DEPS_ASPECTS]\n-\n NG_MODULE_ATTRIBUTES = {\n     \"srcs\": attr.label_list(allow_files = [\".ts\"]),\n-\n-    # Note: DEPS_ASPECTS is already a list, we add the cast to workaround\n-    # https://github.com/bazelbuild/skydoc/issues/21\n     \"deps\": attr.label_list(\n         doc = \"Targets that are imported by this target\",\n-        aspects = local_deps_aspects,\n+        aspects = [node_modules_aspect, _collect_summaries_aspect] + DEPS_ASPECTS,\n     ),\n     \"assets\": attr.label_list(\n         doc = \".html and .css files needed by the Angular compiler\","
        },
        {
            "sha": "011cebcbd51a7907c79eea5306ae5a4c3c48cfec",
            "filename": "packages/bazel/src/ng_package/ng_package.bzl",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/12443ea7395c9ddc8e36314a8cc92253e2d07d26/packages%2Fbazel%2Fsrc%2Fng_package%2Fng_package.bzl",
            "raw_url": "https://github.com/angular/angular/raw/12443ea7395c9ddc8e36314a8cc92253e2d07d26/packages%2Fbazel%2Fsrc%2Fng_package%2Fng_package.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fsrc%2Fng_package%2Fng_package.bzl?ref=12443ea7395c9ddc8e36314a8cc92253e2d07d26",
            "patch": "@@ -125,10 +125,6 @@ WELL_KNOWN_GLOBALS = {p: _global_name(p) for p in [\n     \"rxjs/operators\",\n ]}\n \n-# skydoc fails with type(depset()) so using \"depset\" here instead\n-# TODO(gregmagolan): clean this up\n-_DEPSET_TYPE = \"depset\"\n-\n def _compute_node_modules_root(ctx):\n     \"\"\"Computes the node_modules root from the node_modules and deps attributes.\n \n@@ -282,7 +278,11 @@ def _flatten_paths(directory):\n # Optionally can filter out files that do not belong to a specified package path.\n def _filter_out_generated_files(files, extension, package_path = None):\n     result = []\n-    files_list = files.to_list() if type(files) == _DEPSET_TYPE else files\n+\n+    # If `files` is a depset, convert it to a list. Note that we do not compare the type\n+    # of files against a literal as per best practices within Bazel Starlark.\n+    # https://docs.bazel.build/versions/main/skylark/lib/globals.html#type.\n+    files_list = files.to_list() if type(files) == type(depset()) else files\n     for file in files_list:\n         # If the \"package_path\" parameter has been specified, filter out files\n         # that do not start with the specified package path.\n@@ -298,7 +298,7 @@ def _filter_out_generated_files(files, extension, package_path = None):\n     return depset(result)\n \n def _filter_js_inputs(all_inputs):\n-    all_inputs_list = all_inputs.to_list() if type(all_inputs) == _DEPSET_TYPE else all_inputs\n+    all_inputs_list = all_inputs.to_list() if type(all_inputs) == type(depset()) else all_inputs\n     return [\n         f\n         for f in all_inputs_list"
        }
    ],
    "stats": {
        "total": 113,
        "additions": 15,
        "deletions": 98
    }
}