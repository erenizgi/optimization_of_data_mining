{
    "author": "atscott",
    "message": "fix(language-service): fix autocomplete info display for some cases (#42472)\n\nBefore this commit, attribute completion display parts were retrieved\nbut not assigned. In addition, the switch case was non-exhaustive\nbecause it did not include `StructuralDirectiveAttribute`.\n\nPR Close #42472",
    "sha": "a493ea9bcb2a1d94481d30e41db8b0bdf235ab42",
    "files": [
        {
            "sha": "212e461c68451cf506fe82a25d34bd8c5cc52835",
            "filename": "packages/language-service/ivy/completions.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/a493ea9bcb2a1d94481d30e41db8b0bdf235ab42/packages%2Flanguage-service%2Fivy%2Fcompletions.ts",
            "raw_url": "https://github.com/angular/angular/raw/a493ea9bcb2a1d94481d30e41db8b0bdf235ab42/packages%2Flanguage-service%2Fivy%2Fcompletions.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Fcompletions.ts?ref=a493ea9bcb2a1d94481d30e41db8b0bdf235ab42",
            "patch": "@@ -579,18 +579,25 @@ export class CompletionBuilder<N extends TmplAstNode|AST> {\n         displayParts = info.displayParts;\n         documentation = info.documentation;\n         break;\n+      case AttributeCompletionKind.StructuralDirectiveAttribute:\n       case AttributeCompletionKind.DirectiveInput:\n       case AttributeCompletionKind.DirectiveOutput:\n         const propertySymbol = getAttributeCompletionSymbol(completion, this.typeChecker);\n         if (propertySymbol === null) {\n           return undefined;\n         }\n \n+        let kind: DisplayInfoKind;\n+        if (completion.kind === AttributeCompletionKind.DirectiveInput) {\n+          kind = DisplayInfoKind.PROPERTY;\n+        } else if (completion.kind === AttributeCompletionKind.DirectiveOutput) {\n+          kind = DisplayInfoKind.EVENT;\n+        } else {\n+          kind = DisplayInfoKind.DIRECTIVE;\n+        }\n+\n         info = getTsSymbolDisplayInfo(\n-            this.tsLS, this.typeChecker, propertySymbol,\n-            completion.kind === AttributeCompletionKind.DirectiveInput ? DisplayInfoKind.PROPERTY :\n-                                                                         DisplayInfoKind.EVENT,\n-            completion.directive.tsSymbol.name);\n+            this.tsLS, this.typeChecker, propertySymbol, kind, completion.directive.tsSymbol.name);\n         if (info === null) {\n           return undefined;\n         }\n@@ -602,7 +609,7 @@ export class CompletionBuilder<N extends TmplAstNode|AST> {\n       name: entryName,\n       kind: unsafeCastDisplayInfoKindToScriptElementKind(kind),\n       kindModifiers: ts.ScriptElementKindModifier.none,\n-      displayParts: [],\n+      displayParts,\n       documentation,\n     };\n   }"
        },
        {
            "sha": "f948286bd39e03e17c3f699609cc9d71ae93abc8",
            "filename": "packages/language-service/ivy/display_parts.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/a493ea9bcb2a1d94481d30e41db8b0bdf235ab42/packages%2Flanguage-service%2Fivy%2Fdisplay_parts.ts",
            "raw_url": "https://github.com/angular/angular/raw/a493ea9bcb2a1d94481d30e41db8b0bdf235ab42/packages%2Flanguage-service%2Fivy%2Fdisplay_parts.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Fdisplay_parts.ts?ref=a493ea9bcb2a1d94481d30e41db8b0bdf235ab42",
            "patch": "@@ -6,6 +6,7 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {isNamedClassDeclaration} from '@angular/compiler-cli/src/ngtsc/reflection';\n import {DirectiveInScope, ReferenceSymbol, ShimLocation, Symbol, SymbolKind, VariableSymbol} from '@angular/compiler-cli/src/ngtsc/typecheck/api';\n import * as ts from 'typescript';\n \n@@ -155,7 +156,9 @@ export function getTsSymbolDisplayInfo(\n     tsLS: ts.LanguageService, checker: ts.TypeChecker, symbol: ts.Symbol, kind: DisplayInfoKind,\n     ownerName: string|null): DisplayInfo|null {\n   const decl = symbol.valueDeclaration;\n-  if (decl === undefined || (!ts.isPropertyDeclaration(decl) && !ts.isMethodDeclaration(decl)) ||\n+  if (decl === undefined ||\n+      (!ts.isPropertyDeclaration(decl) && !ts.isMethodDeclaration(decl) &&\n+       !isNamedClassDeclaration(decl)) ||\n       !ts.isIdentifier(decl.name)) {\n     return null;\n   }"
        },
        {
            "sha": "f4cb8513b40f512ff21b2dbd254698b621ded387",
            "filename": "packages/language-service/ivy/test/completions_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/a493ea9bcb2a1d94481d30e41db8b0bdf235ab42/packages%2Flanguage-service%2Fivy%2Ftest%2Fcompletions_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/a493ea9bcb2a1d94481d30e41db8b0bdf235ab42/packages%2Flanguage-service%2Fivy%2Ftest%2Fcompletions_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fcompletions_spec.ts?ref=a493ea9bcb2a1d94481d30e41db8b0bdf235ab42",
            "patch": "@@ -586,6 +586,10 @@ describe('completions', () => {\n                  unsafeCastDisplayInfoKindToScriptElementKind(DisplayInfoKind.DIRECTIVE),\n                  ['ngFor']);\n              expectReplacementText(completions, templateFile.contents, 'ng');\n+             const details = templateFile.getCompletionEntryDetails(\n+                 'ngFor', /* formatOptions */ undefined,\n+                 /* preferences */ undefined)!;\n+             expect(toText(details.displayParts)).toEqual('(directive) NgFor.NgFor: NgFor');\n            });\n \n         it('should return structural directive completions for just the structural marker', () => {"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 20,
        "deletions": 6
    }
}