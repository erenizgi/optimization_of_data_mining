{
    "author": "JoostK",
    "message": "docs: explain foreign function/value constraints in Ivy compatibility examples (#36092)\n\nAddresses documentation gaps as reported in #35078. The documentation only\ncontained a single statement on foreign function/value compatibility\nwithout going into detail on what this means. This commit adds several\nexamples to the Ivy compatibility guide and explains why Ivy behaves differently\ncompared to VE.\n\nPR Close #36092",
    "sha": "3a6e7b5d2a54d011832191b96df5d8fd28a28740",
    "files": [
        {
            "sha": "ceda4cec5d2fe87d7fdf16c63e990e457f4db76d",
            "filename": "aio/content/guide/ivy-compatibility-examples.md",
            "status": "modified",
            "additions": 69,
            "deletions": 0,
            "changes": 69,
            "blob_url": "https://github.com/angular/angular/blob/3a6e7b5d2a54d011832191b96df5d8fd28a28740/aio%2Fcontent%2Fguide%2Fivy-compatibility-examples.md",
            "raw_url": "https://github.com/angular/angular/raw/3a6e7b5d2a54d011832191b96df5d8fd28a28740/aio%2Fcontent%2Fguide%2Fivy-compatibility-examples.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fguide%2Fivy-compatibility-examples.md?ref=3a6e7b5d2a54d011832191b96df5d8fd28a28740",
            "patch": "@@ -348,3 +348,72 @@ To fix this problem, we recommend either getting the information for the binding\n {{ myName }}\n <div myDir [name]=\"myName\"></div>\n ```\n+\n+{@a foreign-values}\n+## Foreign functions and foreign values aren't statically resolvable\n+\n+### Basic example of change \n+\n+Consider a library that defines and exports some selector string to be used in other libraries:\n+\n+```\n+export let mySelector = '[my-selector]';\n+```\n+\n+This selector is then imported in another library or an application:\n+\n+```\n+import {mySelector} from 'my-library';\n+\n+@Directive({selector: mySelector})\n+export class MyDirective {}\n+```\n+\n+Because the `mySelector` value is imported from an external library, it is part of a different compilation unit and therefore considered _foreign_.\n+\n+While this code would work correctly in the View Engine compiler, it would fail to compile in Ivy in AOT mode.\n+\n+### Background\n+\n+In View Engine, the compiler would capture the source code of a library in `metadata.json` files when bundling the library, so that external consumers could \"look inside\" the source code of an external library.\n+When AOT-compiling the application, the `metadata.json` files would be used to determine the value of `mySelector`.\n+In Ivy, the `metadata.json` files are no longer used. Instead, the compiler extracts metadata for external libraries from the `.d.ts` files that TypeScript creates.\n+This has several benefits such as better performance, much improved error reporting, and enables more build caching opportunities as there is no longer a dependency on library internals.\n+\n+Looking back at the previous example, the `mySelector` value would be represented in the `.d.ts` as follows:\n+\n+```\n+export declare let mySelector: string;\n+```\n+\n+Notice that the actual value of the selector is no longer present, so that the Ivy compiler is unable to use it during AOT compilations.\n+\n+### Example of error\n+\n+In the above example, a compilation error would occur when compiling `MyDirective`:\n+\n+```\n+error NG1010: selector must be a string\n+  Value is a reference to 'mySelector'.\n+\n+    1  export declare let mySelector: string;\n+                          ~~~~~~~~~~\n+    Reference is declared here.\n+\n+```\n+\n+### Recommended fix\n+\n+When exporting values from a library, ensure the actual value is present in the `.d.ts` file. This typically requires that the variable be declared as a constant:\n+\n+```\n+export const mySelector = '[my-selector]';\n+```\n+\n+In classes, a field should be declared using the `static readonly` modifiers:\n+\n+```\n+export class Selectors {\n+  static readonly mySelector = '[my-selector]';\n+}\n+```"
        }
    ],
    "stats": {
        "total": 69,
        "additions": 69,
        "deletions": 0
    }
}