{
    "author": "JiaLiPassion",
    "message": "refactor(zone.js): refactor zone rollup config (#40481)\n\nWhen migrating zone.js from gulp to bazel, some legacy build config files are still there,\nwe have `rollup-es5.config.js` and `rollup-es5_global-es2015.config.js`, since in gulp build\nsystem, build `es5` or `esm` files are set in the config file, but in the bazel world,\nthe output format is not config in the config.js file, but is required by the downstream\nbazel target. So we don't really need the two rollup config files any longer.\n\nAnother difference is in `rollup-es5.config.js`, the `external` and `global` libraries names\nare also config there, and these settings are also valid for `es2015` build, these settings\nare not in the `es2015.config.js` for some legacy reasons. So we don't need to keep this\ndifference either.\n\nPR Close #40481",
    "sha": "1f53301fd3bf37531be3b1084f66b4023a7c5fcd",
    "files": [
        {
            "sha": "6edfc81a3782d91b2256f828989b3e5ff0eb3184",
            "filename": "packages/zone.js/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/1f53301fd3bf37531be3b1084f66b4023a7c5fcd/packages%2Fzone.js%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/1f53301fd3bf37531be3b1084f66b4023a7c5fcd/packages%2Fzone.js%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2FBUILD.bazel?ref=1f53301fd3bf37531be3b1084f66b4023a7c5fcd",
            "patch": "@@ -6,8 +6,7 @@ package(default_visibility = [\"//visibility:public\"])\n \n exports_files([\n     \"tsconfig.json\",\n-    \"rollup-es5.config.js\",\n-    \"rollup-es5_global-es2015.config.js\",\n+    \"rollup.config.js\",\n ])\n \n genrule("
        },
        {
            "sha": "90fec738b9c04ff474b99c10715daf123e0a82fe",
            "filename": "packages/zone.js/bundles.bzl",
            "status": "modified",
            "additions": 0,
            "deletions": 34,
            "changes": 34,
            "blob_url": "https://github.com/angular/angular/blob/1f53301fd3bf37531be3b1084f66b4023a7c5fcd/packages%2Fzone.js%2Fbundles.bzl",
            "raw_url": "https://github.com/angular/angular/raw/1f53301fd3bf37531be3b1084f66b4023a7c5fcd/packages%2Fzone.js%2Fbundles.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Fbundles.bzl?ref=1f53301fd3bf37531be3b1084f66b4023a7c5fcd",
            "patch": "@@ -9,139 +9,105 @@ BUNDLES_ENTRY_POINTS = {\n     \"zone\": {\n         \"es5\": _DIR + \"browser/rollup-legacy-main\",\n         \"es2015\": _DIR + \"browser/rollup-main\",\n-        \"rollup\": \"global-es2015\",\n     },\n     \"zone-mix\": {\n         \"entrypoint\": _DIR + \"mix/rollup-mix\",\n-        \"rollup\": \"global-es2015\",\n     },\n     \"zone-node\": {\n         \"entrypoint\": _DIR + \"node/rollup-main\",\n-        \"rollup\": \"global-es2015\",\n     },\n     \"async-test\": {\n         \"entrypoint\": _DIR + \"testing/async-testing\",\n-        \"rollup\": \"es5\",\n     },\n     \"fake-async-test\": {\n         \"entrypoint\": _DIR + \"testing/fake-async\",\n-        \"rollup\": \"es5\",\n     },\n     \"long-stack-trace-zone\": {\n         \"entrypoint\": _DIR + \"zone-spec/long-stack-trace\",\n-        \"rollup\": \"es5\",\n     },\n     \"proxy\": {\n         \"entrypoint\": _DIR + \"zone-spec/proxy\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-patch-rxjs-fake-async\": {\n         \"entrypoint\": _DIR + \"zone-spec/proxy\",\n-        \"rollup\": \"es5\",\n     },\n     \"sync-test\": {\n         \"entrypoint\": _DIR + \"zone-spec/sync-test\",\n-        \"rollup\": \"es5\",\n     },\n     \"task-tracking\": {\n         \"entrypoint\": _DIR + \"zone-spec/task-tracking\",\n-        \"rollup\": \"es5\",\n     },\n     \"wtf\": {\n         \"entrypoint\": _DIR + \"zone-spec/wtf\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-error\": {\n         \"entrypoint\": _DIR + \"common/error-rewrite\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-legacy\": {\n         \"entrypoint\": _DIR + \"browser/browser-legacy\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-bluebird\": {\n         \"entrypoint\": _DIR + \"extra/bluebird\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-patch-canvas\": {\n         \"entrypoint\": _DIR + \"browser/canvas\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-patch-cordova\": {\n         \"entrypoint\": _DIR + \"extra/cordova\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-patch-electron\": {\n         \"entrypoint\": _DIR + \"extra/electron\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-patch-fetch\": {\n         \"entrypoint\": _DIR + \"common/fetch\",\n-        \"rollup\": \"es5\",\n     },\n     \"jasmine-patch\": {\n         \"entrypoint\": _DIR + \"jasmine/jasmine\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-patch-jsonp\": {\n         \"entrypoint\": _DIR + \"extra/jsonp\",\n-        \"rollup\": \"es5\",\n     },\n     \"webapis-media-query\": {\n         \"entrypoint\": _DIR + \"browser/webapis-media-query\",\n-        \"rollup\": \"es5\",\n     },\n     \"mocha-patch\": {\n         \"entrypoint\": _DIR + \"mocha/mocha\",\n-        \"rollup\": \"es5\",\n     },\n     \"webapis-notification\": {\n         \"entrypoint\": _DIR + \"browser/webapis-notification\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-patch-promise-test\": {\n         \"entrypoint\": _DIR + \"testing/promise-testing\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-patch-resize-observer\": {\n         \"entrypoint\": _DIR + \"browser/webapis-resize-observer\",\n-        \"rollup\": \"es5\",\n     },\n     \"webapis-rtc-peer-connection\": {\n         \"entrypoint\": _DIR + \"browser/webapis-rtc-peer-connection\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-patch-rxjs\": {\n         \"entrypoint\": _DIR + \"rxjs/rxjs\",\n-        \"rollup\": \"es5\",\n     },\n     \"webapis-shadydom\": {\n         \"entrypoint\": _DIR + \"browser/shadydom\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-patch-socket-io\": {\n         \"entrypoint\": _DIR + \"extra/socket-io\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-patch-message-port\": {\n         \"entrypoint\": _DIR + \"browser/message-port\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-patch-user-media\": {\n         \"entrypoint\": _DIR + \"browser/webapis-user-media\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-testing\": {\n         \"entrypoint\": _DIR + \"testing/zone-testing\",\n-        \"rollup\": \"es5\",\n     },\n     \"zone-testing-bundle\": {\n         \"es5\": _DIR + \"browser/rollup-legacy-test-main\",\n         \"es2015\": _DIR + \"browser/rollup-test-main\",\n-        \"rollup\": \"global-es2015\",\n     },\n     \"zone-testing-node-bundle\": {\n         \"entrypoint\": _DIR + \"node/rollup-test-main\",\n-        \"rollup\": \"global-es2015\",\n     },\n }"
        },
        {
            "sha": "583820b58be0c41132ecaaae7cd2f1e2eee9fdc0",
            "filename": "packages/zone.js/rollup-es5_global-es2015.config.js",
            "status": "removed",
            "additions": 0,
            "deletions": 40,
            "changes": 40,
            "blob_url": "https://github.com/angular/angular/blob/21bc16d4d889695b3562047980df1ff17a7ef868/packages%2Fzone.js%2Frollup-es5_global-es2015.config.js",
            "raw_url": "https://github.com/angular/angular/raw/21bc16d4d889695b3562047980df1ff17a7ef868/packages%2Fzone.js%2Frollup-es5_global-es2015.config.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Frollup-es5_global-es2015.config.js?ref=21bc16d4d889695b3562047980df1ff17a7ef868",
            "patch": "@@ -1,40 +0,0 @@\n-const node = require('rollup-plugin-node-resolve');\n-const commonjs = require('rollup-plugin-commonjs');\n-\n-// Parse the stamp file produced by Bazel from the version control system\n-let version = '<unknown>';\n-if (bazel_stamp_file) {\n-  const versionTag = require('fs')\n-                         .readFileSync(bazel_stamp_file, {encoding: 'utf-8'})\n-                         .split('\\n')\n-                         .find(s => s.startsWith('BUILD_SCM_VERSION'));\n-  // Don't assume BUILD_SCM_VERSION exists\n-  if (versionTag) {\n-    version = versionTag.split(' ')[1].trim();\n-  }\n-}\n-\n-// Add 'use strict' to the bundle, https://github.com/angular/angular/pull/40456\n-// When rollup build esm bundle of zone.js, there will be no 'use strict'\n-// since all esm bundles are `strict`, but when webpack load the esm bundle,\n-// because zone.js is a module without export and import, webpack is unable\n-// to determine the bundle is `esm` module or not, so it doesn't add the 'use strict'\n-// which webpack does to all other `esm` modules which has export or import.\n-// And it causes issues such as https://github.com/angular/angular/issues/40215\n-// `this` should be `undefined` but is assigned with `Window` instead.\n-const banner = `'use strict';\n-/**\n- * @license Angular v${version}\n- * (c) 2010-2020 Google LLC. https://angular.io/\n- * License: MIT\n-*/`;\n-\n-module.exports = {\n-  plugins: [\n-    node({\n-      mainFields: ['es2015', 'module', 'jsnext:main', 'main'],\n-    }),\n-    commonjs(),\n-  ],\n-  output: {name: 'Zone', banner},\n-}"
        },
        {
            "sha": "9e7ba9e80d941d78805113900aebc2938029e1db",
            "filename": "packages/zone.js/rollup.config.js",
            "status": "renamed",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/1f53301fd3bf37531be3b1084f66b4023a7c5fcd/packages%2Fzone.js%2Frollup.config.js",
            "raw_url": "https://github.com/angular/angular/raw/1f53301fd3bf37531be3b1084f66b4023a7c5fcd/packages%2Fzone.js%2Frollup.config.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Frollup.config.js?ref=1f53301fd3bf37531be3b1084f66b4023a7c5fcd",
            "patch": "@@ -27,7 +27,7 @@ const banner = `'use strict';\n  * @license Angular v${version}\n  * (c) 2010-2020 Google LLC. https://angular.io/\n  * License: MIT\n-*/`;\n+ */`;\n \n module.exports = {\n   plugins: [",
            "previous_filename": "packages/zone.js/rollup-es5.config.js"
        },
        {
            "sha": "3cee54a72c82aa4148203a6e9629503a3f7695de",
            "filename": "packages/zone.js/test/karma_test.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/1f53301fd3bf37531be3b1084f66b4023a7c5fcd/packages%2Fzone.js%2Ftest%2Fkarma_test.bzl",
            "raw_url": "https://github.com/angular/angular/raw/1f53301fd3bf37531be3b1084f66b4023a7c5fcd/packages%2Fzone.js%2Ftest%2Fkarma_test.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Ftest%2Fkarma_test.bzl?ref=1f53301fd3bf37531be3b1084f66b4023a7c5fcd",
            "patch": "@@ -32,7 +32,7 @@ def karma_test_prepare(name, env_srcs, env_deps, env_entry_point, test_srcs, tes\n         silent = True,\n         sourcemap = \"false\",\n         entry_point = test_entry_point,\n-        config_file = \"//packages/zone.js:rollup-es5.config.js\",\n+        config_file = \"//packages/zone.js:rollup.config.js\",\n         deps = [\n             \":\" + name + \"_test\",\n             \"@npm//rollup-plugin-commonjs\","
        },
        {
            "sha": "b46dd9ed9e01211d1048cc493e6c80b1742225fc",
            "filename": "packages/zone.js/tools.bzl",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/1f53301fd3bf37531be3b1084f66b4023a7c5fcd/packages%2Fzone.js%2Ftools.bzl",
            "raw_url": "https://github.com/angular/angular/raw/1f53301fd3bf37531be3b1084f66b4023a7c5fcd/packages%2Fzone.js%2Ftools.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fzone.js%2Ftools.bzl?ref=1f53301fd3bf37531be3b1084f66b4023a7c5fcd",
            "patch": "@@ -3,11 +3,7 @@\n load(\"//tools:defaults.bzl\", \"rollup_bundle\")\n \n def zone_rollup_bundle(module_name, entry_point, rollup_config):\n-    config_file = \"\"\n-    if rollup_config[\"rollup\"] == \"global-es2015\":\n-        config_file = \"//packages/zone.js:rollup-es5_global-es2015.config.js\"\n-    if rollup_config[\"rollup\"] == \"es5\":\n-        config_file = \"//packages/zone.js:rollup-es5.config.js\"\n+    config_file = \"//packages/zone.js:rollup.config.js\"\n     rollup_bundle(\n         name = module_name + \"-rollup\",\n         config_file = config_file,"
        }
    ],
    "stats": {
        "total": 87,
        "additions": 4,
        "deletions": 83
    }
}