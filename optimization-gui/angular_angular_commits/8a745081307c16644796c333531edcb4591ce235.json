{
    "author": "dimakuba",
    "message": "fix(http): avoid abort a request when fetch operation is completed (#37367)\n\n`abort` method is calling, even if fetch operation is completed\n\nFixes https://github.com/angular/angular/issues/36537\n\nPR Close #37367",
    "sha": "8a745081307c16644796c333531edcb4591ce235",
    "files": [
        {
            "sha": "11e0fd544e12f107dafdfd3171c41c51cb8e627a",
            "filename": "packages/common/http/src/xhr.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/8a745081307c16644796c333531edcb4591ce235/packages%2Fcommon%2Fhttp%2Fsrc%2Fxhr.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a745081307c16644796c333531edcb4591ce235/packages%2Fcommon%2Fhttp%2Fsrc%2Fxhr.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fhttp%2Fsrc%2Fxhr.ts?ref=8a745081307c16644796c333531edcb4591ce235",
            "patch": "@@ -339,7 +339,9 @@ export class HttpXhrBackend implements HttpBackend {\n         }\n \n         // Finally, abort the in-flight request.\n-        xhr.abort();\n+        if (xhr.readyState !== xhr.DONE) {\n+          xhr.abort();\n+        }\n       };\n     });\n   }"
        },
        {
            "sha": "ae37b9e5d47d8263b012e2c3610227ab8d84cf4e",
            "filename": "packages/common/http/test/xhr_spec.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/8a745081307c16644796c333531edcb4591ce235/packages%2Fcommon%2Fhttp%2Ftest%2Fxhr_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/8a745081307c16644796c333531edcb4591ce235/packages%2Fcommon%2Fhttp%2Ftest%2Fxhr_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcommon%2Fhttp%2Ftest%2Fxhr_spec.ts?ref=8a745081307c16644796c333531edcb4591ce235",
            "patch": "@@ -147,6 +147,17 @@ const XSSI_PREFIX = ')]}\\'\\n';\n       });\n       factory.mock.mockErrorEvent(new Error('blah'));\n     });\n+    it('avoids abort a request when fetch operation is completed', done => {\n+      const abort = jasmine.createSpy('abort');\n+\n+      backend.handle(TEST_POST).toPromise().then(() => {\n+        expect(abort).not.toHaveBeenCalled();\n+        done();\n+      });\n+\n+      factory.mock.abort = abort;\n+      factory.mock.mockFlush(200, 'OK', 'Done');\n+    });\n     describe('progress events', () => {\n       it('are emitted for download progress', done => {\n         backend.handle(TEST_POST.clone({reportProgress: true}))"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 14,
        "deletions": 1
    }
}