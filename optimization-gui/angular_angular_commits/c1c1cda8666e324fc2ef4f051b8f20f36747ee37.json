{
    "author": "AndrewKushnir",
    "message": "Revert \"refactor(dev-infra): add spawnSync to child process utils, normalize naming of child-process utils (#42394)\" (#42829)\n\nThis reverts commit 08444c6679e88034f021cc4ce8d1a0dd85ac4e46.\n\nPR Close #42829",
    "sha": "c1c1cda8666e324fc2ef4f051b8f20f36747ee37",
    "files": [
        {
            "sha": "5d8477e5e001a52135db932dd418059eff8dd1ab",
            "filename": "dev-infra/build-worker.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Fbuild-worker.js",
            "raw_url": "https://github.com/angular/angular/raw/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Fbuild-worker.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fbuild-worker.js?ref=c1c1cda8666e324fc2ef4f051b8f20f36747ee37",
            "patch": "@@ -144,7 +144,6 @@ var GitCommandError = /** @class */ (function (_super) {\n         // we sanitize the command that will be part of the error message.\n         _super.call(this, \"Command failed: git \" + client.sanitizeConsoleOutput(args.join(' '))) || this;\n         _this.args = args;\n-        Object.setPrototypeOf(_this, GitCommandError.prototype);\n         return _this;\n     }\n     return GitCommandError;"
        },
        {
            "sha": "4dcd9b108296d7900a079ad183259b4035bbea12",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 30,
            "deletions": 46,
            "changes": 76,
            "blob_url": "https://github.com/angular/angular/blob/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=c1c1cda8666e324fc2ef4f051b8f20f36747ee37",
            "patch": "@@ -316,7 +316,6 @@ var GitCommandError = /** @class */ (function (_super) {\n         // we sanitize the command that will be part of the error message.\n         _super.call(this, \"Command failed: git \" + client.sanitizeConsoleOutput(args.join(' '))) || this;\n         _this.args = args;\n-        Object.setPrototypeOf(_this, GitCommandError.prototype);\n         return _this;\n     }\n     return GitCommandError;\n@@ -3310,40 +3309,30 @@ function discoverNewConflictsForPr(newPrNumber, updatedAfter) {\n         info(`Retrieved ${allPendingPRs.length} total pending PRs`);\n         info(`Checking ${pendingPrs.length} PRs for conflicts after a merge of #${newPrNumber}`);\n         // Fetch and checkout the PR being checked.\n-        git.run(['fetch', '-q', requestedPr.headRef.repository.url, requestedPr.headRef.name]);\n-        git.run(['checkout', '-q', '-B', tempWorkingBranch, 'FETCH_HEAD']);\n+        exec(`git fetch ${requestedPr.headRef.repository.url} ${requestedPr.headRef.name}`);\n+        exec(`git checkout -B ${tempWorkingBranch} FETCH_HEAD`);\n         // Rebase the PR against the PRs target branch.\n-        git.run(['fetch', '-q', requestedPr.baseRef.repository.url, requestedPr.baseRef.name]);\n-        try {\n-            git.run(['rebase', 'FETCH_HEAD'], { stdio: 'ignore' });\n-        }\n-        catch (err) {\n-            if (err instanceof GitCommandError) {\n-                error('The requested PR currently has conflicts');\n-                git.checkout(previousBranchOrRevision, true);\n-                process.exit(1);\n-            }\n-            throw err;\n+        exec(`git fetch ${requestedPr.baseRef.repository.url} ${requestedPr.baseRef.name}`);\n+        const result = exec(`git rebase FETCH_HEAD`);\n+        if (result.code) {\n+            error('The requested PR currently has conflicts');\n+            cleanUpGitState(previousBranchOrRevision);\n+            process.exit(1);\n         }\n         // Start the progress bar\n         progressBar.start(pendingPrs.length, 0);\n         // Check each PR to determine if it can merge cleanly into the repo after the target PR.\n         for (const pr of pendingPrs) {\n             // Fetch and checkout the next PR\n-            git.run(['fetch', '-q', pr.headRef.repository.url, pr.headRef.name]);\n-            git.run(['checkout', '-q', '--detach', 'FETCH_HEAD']);\n+            exec(`git fetch ${pr.headRef.repository.url} ${pr.headRef.name}`);\n+            exec(`git checkout --detach FETCH_HEAD`);\n             // Check if the PR cleanly rebases into the repo after the target PR.\n-            try {\n-                git.run(['rebase', tempWorkingBranch], { stdio: 'ignore' });\n-            }\n-            catch (err) {\n-                if (err instanceof GitCommandError) {\n-                    conflicts.push(pr);\n-                }\n-                throw err;\n+            const result = exec(`git rebase ${tempWorkingBranch}`);\n+            if (result.code !== 0) {\n+                conflicts.push(pr);\n             }\n             // Abort any outstanding rebase attempt.\n-            git.runGraceful(['rebase', '--abort'], { stdio: 'ignore' });\n+            exec(`git rebase --abort`);\n             progressBar.increment(1);\n         }\n         // End the progress bar as all PRs have been processed.\n@@ -5835,7 +5824,7 @@ const ReleaseNotesCommandModule = {\n  *\n  * @returns a Promise resolving on success, and rejecting on command failure with the status code.\n  */\n-function spawnInteractive(command, args, options) {\n+function spawnInteractiveCommand(command, args, options) {\n     if (options === void 0) { options = {}; }\n     return new Promise(function (resolve, reject) {\n         var commandText = command + \" \" + args.join(' ');\n@@ -5850,9 +5839,9 @@ function spawnInteractive(command, args, options) {\n  * output mode, stdout/stderr output is also printed to the console, or only on error.\n  *\n  * @returns a Promise resolving with captured stdout and stderr on success. The promise\n- *   rejects on command failure\n+ *   rejects on command failure.\n  */\n-function spawn(command, args, options) {\n+function spawnWithDebugOutput(command, args, options) {\n     if (options === void 0) { options = {}; }\n     return new Promise(function (resolve, reject) {\n         var commandText = command + \" \" + args.join(' ');\n@@ -5882,27 +5871,22 @@ function spawn(command, args, options) {\n                 process.stderr.write(message);\n             }\n         });\n-        childProcess.on('exit', function (exitCode, signal) {\n-            var exitDescription = exitCode !== null ? \"exit code \\\"\" + exitCode + \"\\\"\" : \"signal \\\"\" + signal + \"\\\"\";\n+        childProcess.on('exit', function (status, signal) {\n+            var exitDescription = status !== null ? \"exit code \\\"\" + status + \"\\\"\" : \"signal \\\"\" + signal + \"\\\"\";\n             var printFn = outputMode === 'on-error' ? error : debug;\n-            var status = statusFromExitCodeAndSignal(exitCode, signal);\n             printFn(\"Command \\\"\" + commandText + \"\\\" completed with \" + exitDescription + \".\");\n             printFn(\"Process output: \\n\" + logOutput);\n             // On success, resolve the promise. Otherwise reject with the captured stderr\n             // and stdout log output if the output mode was set to `silent`.\n-            if (status === 0 || options.suppressErrorOnFailingExitCode) {\n-                resolve({ stdout: stdout, stderr: stderr, status: status });\n+            if (status === 0) {\n+                resolve({ stdout: stdout, stderr: stderr });\n             }\n             else {\n                 reject(outputMode === 'silent' ? logOutput : undefined);\n             }\n         });\n     });\n }\n-/** Convert the provided exitCode and signal to a single status code. */\n-function statusFromExitCodeAndSignal(exitCode, signal) {\n-    return exitCode !== null ? exitCode : signal !== null ? signal : -1;\n-}\n \n /**\n  * @license\n@@ -5922,7 +5906,7 @@ function runNpmPublish(packagePath, distTag, registryUrl) {\n         if (registryUrl !== undefined) {\n             args.push('--registry', registryUrl);\n         }\n-        yield spawn('npm', args, { cwd: packagePath, mode: 'silent' });\n+        yield spawnWithDebugOutput('npm', args, { cwd: packagePath, mode: 'silent' });\n     });\n }\n /**\n@@ -5936,7 +5920,7 @@ function setNpmTagForPackage(packageName, distTag, version, registryUrl) {\n         if (registryUrl !== undefined) {\n             args.push('--registry', registryUrl);\n         }\n-        yield spawn('npm', args, { mode: 'silent' });\n+        yield spawnWithDebugOutput('npm', args, { mode: 'silent' });\n     });\n }\n /**\n@@ -5951,7 +5935,7 @@ function npmIsLoggedIn(registryUrl) {\n             args.push('--registry', registryUrl);\n         }\n         try {\n-            yield spawn('npm', args, { mode: 'silent' });\n+            yield spawnWithDebugOutput('npm', args, { mode: 'silent' });\n         }\n         catch (e) {\n             return false;\n@@ -5974,7 +5958,7 @@ function npmLogin(registryUrl) {\n         }\n         // The login command prompts for username, password and other profile information. Hence\n         // the process needs to be interactive (i.e. respecting current TTYs stdin).\n-        yield spawnInteractive('npm', args);\n+        yield spawnInteractiveCommand('npm', args);\n     });\n }\n /**\n@@ -5991,7 +5975,7 @@ function npmLogout(registryUrl) {\n             args.splice(1, 0, '--registry', registryUrl);\n         }\n         try {\n-            yield spawn('npm', args, { mode: 'silent' });\n+            yield spawnWithDebugOutput('npm', args, { mode: 'silent' });\n         }\n         finally {\n             return npmIsLoggedIn(registryUrl);\n@@ -6113,7 +6097,7 @@ function invokeSetNpmDistCommand(npmDistTag, version) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n         try {\n             // Note: No progress indicator needed as that is the responsibility of the command.\n-            yield spawn('yarn', ['--silent', 'ng-dev', 'release', 'set-dist-tag', npmDistTag, version.format()]);\n+            yield spawnWithDebugOutput('yarn', ['--silent', 'ng-dev', 'release', 'set-dist-tag', npmDistTag, version.format()]);\n             info(green(`  ✓   Set \"${npmDistTag}\" NPM dist tag for all packages to v${version}.`));\n         }\n         catch (e) {\n@@ -6133,7 +6117,7 @@ function invokeReleaseBuildCommand() {\n         try {\n             // Since we expect JSON to be printed from the `ng-dev release build` command,\n             // we spawn the process in silent mode. We have set up an Ora progress spinner.\n-            const { stdout } = yield spawn('yarn', ['--silent', 'ng-dev', 'release', 'build', '--json'], { mode: 'silent' });\n+            const { stdout } = yield spawnWithDebugOutput('yarn', ['--silent', 'ng-dev', 'release', 'build', '--json'], { mode: 'silent' });\n             spinner.stop();\n             info(green('  ✓   Built release output for all packages.'));\n             // The `ng-dev release build` command prints a JSON array to stdout\n@@ -6157,7 +6141,7 @@ function invokeYarnInstallCommand(projectDir) {\n         try {\n             // Note: No progress indicator needed as that is the responsibility of the command.\n             // TODO: Consider using an Ora spinner instead to ensure minimal console output.\n-            yield spawn('yarn', ['install', '--frozen-lockfile', '--non-interactive'], { cwd: projectDir });\n+            yield spawnWithDebugOutput('yarn', ['install', '--frozen-lockfile', '--non-interactive'], { cwd: projectDir });\n             info(green('  ✓   Installed project dependencies.'));\n         }\n         catch (e) {\n@@ -7295,7 +7279,7 @@ class ReleaseTool {\n             try {\n                 // Note: We do not rely on `/usr/bin/env` but rather access the `env` binary directly as it\n                 // should be part of the shell's `$PATH`. This is necessary for compatibility with Windows.\n-                const pyVersion = yield spawn('env', ['python', '--version'], { mode: 'silent' });\n+                const pyVersion = yield spawnWithDebugOutput('env', ['python', '--version'], { mode: 'silent' });\n                 const version = pyVersion.stdout.trim() || pyVersion.stderr.trim();\n                 if (version.startsWith('Python 3.')) {\n                     debug(`Local python version: ${version}`);"
        },
        {
            "sha": "b164155566a33f626ef8efea27f92eada9961504",
            "filename": "dev-infra/pr/discover-new-conflicts/index.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 23,
            "changes": 38,
            "blob_url": "https://github.com/angular/angular/blob/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fdiscover-new-conflicts%2Findex.ts?ref=c1c1cda8666e324fc2ef4f051b8f20f36747ee37",
            "patch": "@@ -11,7 +11,7 @@ import {types as graphqlTypes} from 'typed-graphqlify';\n \n import {error, info} from '../../utils/console';\n import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n-import {GitCommandError} from '../../utils/git/git-client';\n+import {GitClient} from '../../utils/git/git-client';\n import {getPendingPrs} from '../../utils/github';\n import {exec} from '../../utils/shelljs';\n \n@@ -95,20 +95,16 @@ export async function discoverNewConflictsForPr(newPrNumber: number, updatedAfte\n   info(`Checking ${pendingPrs.length} PRs for conflicts after a merge of #${newPrNumber}`);\n \n   // Fetch and checkout the PR being checked.\n-  git.run(['fetch', '-q', requestedPr.headRef.repository.url, requestedPr.headRef.name]);\n-  git.run(['checkout', '-q', '-B', tempWorkingBranch, 'FETCH_HEAD']);\n+  exec(`git fetch ${requestedPr.headRef.repository.url} ${requestedPr.headRef.name}`);\n+  exec(`git checkout -B ${tempWorkingBranch} FETCH_HEAD`);\n \n   // Rebase the PR against the PRs target branch.\n-  git.run(['fetch', '-q', requestedPr.baseRef.repository.url, requestedPr.baseRef.name]);\n-  try {\n-    git.run(['rebase', 'FETCH_HEAD'], {stdio: 'ignore'});\n-  } catch (err) {\n-    if (err instanceof GitCommandError) {\n-      error('The requested PR currently has conflicts');\n-      git.checkout(previousBranchOrRevision, true);\n-      process.exit(1);\n-    }\n-    throw err;\n+  exec(`git fetch ${requestedPr.baseRef.repository.url} ${requestedPr.baseRef.name}`);\n+  const result = exec(`git rebase FETCH_HEAD`);\n+  if (result.code) {\n+    error('The requested PR currently has conflicts');\n+    cleanUpGitState(previousBranchOrRevision);\n+    process.exit(1);\n   }\n \n   // Start the progress bar\n@@ -117,19 +113,15 @@ export async function discoverNewConflictsForPr(newPrNumber: number, updatedAfte\n   // Check each PR to determine if it can merge cleanly into the repo after the target PR.\n   for (const pr of pendingPrs) {\n     // Fetch and checkout the next PR\n-    git.run(['fetch', '-q', pr.headRef.repository.url, pr.headRef.name]);\n-    git.run(['checkout', '-q', '--detach', 'FETCH_HEAD']);\n+    exec(`git fetch ${pr.headRef.repository.url} ${pr.headRef.name}`);\n+    exec(`git checkout --detach FETCH_HEAD`);\n     // Check if the PR cleanly rebases into the repo after the target PR.\n-    try {\n-      git.run(['rebase', tempWorkingBranch], {stdio: 'ignore'});\n-    } catch (err) {\n-      if (err instanceof GitCommandError) {\n-        conflicts.push(pr);\n-      }\n-      throw err;\n+    const result = exec(`git rebase ${tempWorkingBranch}`);\n+    if (result.code !== 0) {\n+      conflicts.push(pr);\n     }\n     // Abort any outstanding rebase attempt.\n-    git.runGraceful(['rebase', '--abort'], {stdio: 'ignore'});\n+    exec(`git rebase --abort`);\n \n     progressBar.increment(1);\n   }"
        },
        {
            "sha": "2683e3ce467c57966fef0084b2f0dcb707b8a3a6",
            "filename": "dev-infra/release/publish/external-commands.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Frelease%2Fpublish%2Fexternal-commands.ts",
            "raw_url": "https://github.com/angular/angular/raw/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Frelease%2Fpublish%2Fexternal-commands.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Fexternal-commands.ts?ref=c1c1cda8666e324fc2ef4f051b8f20f36747ee37",
            "patch": "@@ -9,7 +9,7 @@\n import * as ora from 'ora';\n import * as semver from 'semver';\n \n-import {spawn} from '../../utils/child-process';\n+import {spawnWithDebugOutput} from '../../utils/child-process';\n import {error, green, info, red} from '../../utils/console';\n import {BuiltPackage} from '../config/index';\n import {NpmDistTag} from '../versioning';\n@@ -40,7 +40,7 @@ import {FatalReleaseActionError} from './actions-error';\n export async function invokeSetNpmDistCommand(npmDistTag: NpmDistTag, version: semver.SemVer) {\n   try {\n     // Note: No progress indicator needed as that is the responsibility of the command.\n-    await spawn(\n+    await spawnWithDebugOutput(\n         'yarn', ['--silent', 'ng-dev', 'release', 'set-dist-tag', npmDistTag, version.format()]);\n     info(green(`  ✓   Set \"${npmDistTag}\" NPM dist tag for all packages to v${version}.`));\n   } catch (e) {\n@@ -59,8 +59,8 @@ export async function invokeReleaseBuildCommand(): Promise<BuiltPackage[]> {\n   try {\n     // Since we expect JSON to be printed from the `ng-dev release build` command,\n     // we spawn the process in silent mode. We have set up an Ora progress spinner.\n-    const {stdout} =\n-        await spawn('yarn', ['--silent', 'ng-dev', 'release', 'build', '--json'], {mode: 'silent'});\n+    const {stdout} = await spawnWithDebugOutput(\n+        'yarn', ['--silent', 'ng-dev', 'release', 'build', '--json'], {mode: 'silent'});\n     spinner.stop();\n     info(green('  ✓   Built release output for all packages.'));\n     // The `ng-dev release build` command prints a JSON array to stdout\n@@ -82,7 +82,8 @@ export async function invokeYarnInstallCommand(projectDir: string): Promise<void\n   try {\n     // Note: No progress indicator needed as that is the responsibility of the command.\n     // TODO: Consider using an Ora spinner instead to ensure minimal console output.\n-    await spawn('yarn', ['install', '--frozen-lockfile', '--non-interactive'], {cwd: projectDir});\n+    await spawnWithDebugOutput(\n+        'yarn', ['install', '--frozen-lockfile', '--non-interactive'], {cwd: projectDir});\n     info(green('  ✓   Installed project dependencies.'));\n   } catch (e) {\n     error(e);"
        },
        {
            "sha": "e3bc250a28b38ca4e7900f9371c25189c487c94a",
            "filename": "dev-infra/release/publish/index.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Frelease%2Fpublish%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Frelease%2Fpublish%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fpublish%2Findex.ts?ref=c1c1cda8666e324fc2ef4f051b8f20f36747ee37",
            "patch": "@@ -8,7 +8,7 @@\n \n import {ListChoiceOptions, prompt} from 'inquirer';\n \n-import {spawn} from '../../utils/child-process';\n+import {spawnWithDebugOutput} from '../../utils/child-process';\n import {GithubConfig} from '../../utils/config';\n import {debug, error, info, log, promptConfirm, red, yellow} from '../../utils/console';\n import {AuthenticatedGitClient} from '../../utils/git/authenticated-git-client';\n@@ -138,7 +138,8 @@ export class ReleaseTool {\n     try {\n       // Note: We do not rely on `/usr/bin/env` but rather access the `env` binary directly as it\n       // should be part of the shell's `$PATH`. This is necessary for compatibility with Windows.\n-      const pyVersion = await spawn('env', ['python', '--version'], {mode: 'silent'});\n+      const pyVersion =\n+          await spawnWithDebugOutput('env', ['python', '--version'], {mode: 'silent'});\n       const version = pyVersion.stdout.trim() || pyVersion.stderr.trim();\n       if (version.startsWith('Python 3.')) {\n         debug(`Local python version: ${version}`);"
        },
        {
            "sha": "1f31c268a5855b61852ba9b3458d6afa86a6aa10",
            "filename": "dev-infra/release/versioning/npm-publish.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 8,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Frelease%2Fversioning%2Fnpm-publish.ts",
            "raw_url": "https://github.com/angular/angular/raw/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Frelease%2Fversioning%2Fnpm-publish.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Frelease%2Fversioning%2Fnpm-publish.ts?ref=c1c1cda8666e324fc2ef4f051b8f20f36747ee37",
            "patch": "@@ -7,9 +7,7 @@\n  */\n \n import * as semver from 'semver';\n-\n-import {spawn, spawnInteractive} from '../../utils/child-process';\n-\n+import {spawnInteractiveCommand, spawnWithDebugOutput} from '../../utils/child-process';\n import {NpmDistTag} from './npm-registry';\n \n /**\n@@ -23,7 +21,7 @@ export async function runNpmPublish(\n   if (registryUrl !== undefined) {\n     args.push('--registry', registryUrl);\n   }\n-  await spawn('npm', args, {cwd: packagePath, mode: 'silent'});\n+  await spawnWithDebugOutput('npm', args, {cwd: packagePath, mode: 'silent'});\n }\n \n /**\n@@ -37,7 +35,7 @@ export async function setNpmTagForPackage(\n   if (registryUrl !== undefined) {\n     args.push('--registry', registryUrl);\n   }\n-  await spawn('npm', args, {mode: 'silent'});\n+  await spawnWithDebugOutput('npm', args, {mode: 'silent'});\n }\n \n /**\n@@ -51,7 +49,7 @@ export async function npmIsLoggedIn(registryUrl: string|undefined): Promise<bool\n     args.push('--registry', registryUrl);\n   }\n   try {\n-    await spawn('npm', args, {mode: 'silent'});\n+    await spawnWithDebugOutput('npm', args, {mode: 'silent'});\n   } catch (e) {\n     return false;\n   }\n@@ -72,7 +70,7 @@ export async function npmLogin(registryUrl: string|undefined) {\n   }\n   // The login command prompts for username, password and other profile information. Hence\n   // the process needs to be interactive (i.e. respecting current TTYs stdin).\n-  await spawnInteractive('npm', args);\n+  await spawnInteractiveCommand('npm', args);\n }\n \n /**\n@@ -88,7 +86,7 @@ export async function npmLogout(registryUrl: string|undefined): Promise<boolean>\n     args.splice(1, 0, '--registry', registryUrl);\n   }\n   try {\n-    await spawn('npm', args, {mode: 'silent'});\n+    await spawnWithDebugOutput('npm', args, {mode: 'silent'});\n   } finally {\n     return npmIsLoggedIn(registryUrl);\n   }"
        },
        {
            "sha": "1a1950f3d51f01d9d53cfc7b5fccebe9b0d32242",
            "filename": "dev-infra/utils/child-process.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 58,
            "changes": 73,
            "blob_url": "https://github.com/angular/angular/blob/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Futils%2Fchild-process.ts",
            "raw_url": "https://github.com/angular/angular/raw/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Futils%2Fchild-process.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fchild-process.ts?ref=c1c1cda8666e324fc2ef4f051b8f20f36747ee37",
            "patch": "@@ -6,34 +6,21 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {spawn as _spawn, SpawnOptions as _SpawnOptions, spawnSync as _spawnSync, SpawnSyncOptions as _SpawnSyncOptions} from 'child_process';\n+import {spawn, SpawnOptions} from 'child_process';\n import {debug, error} from './console';\n \n-\n-export interface SpawnSyncOptions extends Omit<_SpawnSyncOptions, 'shell'|'stdio'> {\n-  /** Whether to prevent exit codes being treated as failures. */\n-  suppressErrorOnFailingExitCode?: boolean;\n-}\n-\n /** Interface describing the options for spawning a process. */\n-export interface SpawnOptions extends Omit<_SpawnOptions, 'shell'|'stdio'> {\n+export interface SpawnedProcessOptions extends Omit<SpawnOptions, 'stdio'> {\n   /** Console output mode. Defaults to \"enabled\". */\n   mode?: 'enabled'|'silent'|'on-error';\n-  /** Whether to prevent exit codes being treated as failures. */\n-  suppressErrorOnFailingExitCode?: boolean;\n }\n \n-/** Interface describing the options for spawning an interactive process. */\n-export type SpawnInteractiveCommandOptions = Omit<_SpawnOptions, 'shell'|'stdio'>;\n-\n /** Interface describing the result of a spawned process. */\n-export interface SpawnResult {\n+export interface SpawnedProcessResult {\n   /** Captured stdout in string format. */\n   stdout: string;\n   /** Captured stderr in string format. */\n   stderr: string;\n-  /** The exit code or signal of the process. */\n-  status: number|NodeJS.Signals;\n }\n \n /**\n@@ -42,12 +29,12 @@ export interface SpawnResult {\n  *\n  * @returns a Promise resolving on success, and rejecting on command failure with the status code.\n  */\n-export function spawnInteractive(\n-    command: string, args: string[], options: SpawnInteractiveCommandOptions = {}) {\n+export function spawnInteractiveCommand(\n+    command: string, args: string[], options: Omit<SpawnOptions, 'stdio'> = {}) {\n   return new Promise<void>((resolve, reject) => {\n     const commandText = `${command} ${args.join(' ')}`;\n     debug(`Executing command: ${commandText}`);\n-    const childProcess = _spawn(command, args, {...options, shell: true, stdio: 'inherit'});\n+    const childProcess = spawn(command, args, {...options, shell: true, stdio: 'inherit'});\n     childProcess.on('exit', status => status === 0 ? resolve() : reject(status));\n   });\n }\n@@ -58,17 +45,18 @@ export function spawnInteractive(\n  * output mode, stdout/stderr output is also printed to the console, or only on error.\n  *\n  * @returns a Promise resolving with captured stdout and stderr on success. The promise\n- *   rejects on command failure\n+ *   rejects on command failure.\n  */\n-export function spawn(\n-    command: string, args: string[], options: SpawnOptions = {}): Promise<SpawnResult> {\n+export function spawnWithDebugOutput(\n+    command: string, args: string[],\n+    options: SpawnedProcessOptions = {}): Promise<SpawnedProcessResult> {\n   return new Promise((resolve, reject) => {\n     const commandText = `${command} ${args.join(' ')}`;\n     const outputMode = options.mode;\n \n     debug(`Executing command: ${commandText}`);\n \n-    const childProcess = _spawn(command, args, {...options, shell: true, stdio: 'pipe'});\n+    const childProcess = spawn(command, args, {...options, shell: true, stdio: 'pipe'});\n     let logOutput = '';\n     let stdout = '';\n     let stderr = '';\n@@ -95,51 +83,20 @@ export function spawn(\n       }\n     });\n \n-    childProcess.on('exit', (exitCode, signal) => {\n-      const exitDescription = exitCode !== null ? `exit code \"${exitCode}\"` : `signal \"${signal}\"`;\n+    childProcess.on('exit', (status, signal) => {\n+      const exitDescription = status !== null ? `exit code \"${status}\"` : `signal \"${signal}\"`;\n       const printFn = outputMode === 'on-error' ? error : debug;\n-      const status = statusFromExitCodeAndSignal(exitCode, signal);\n \n       printFn(`Command \"${commandText}\" completed with ${exitDescription}.`);\n       printFn(`Process output: \\n${logOutput}`);\n \n       // On success, resolve the promise. Otherwise reject with the captured stderr\n       // and stdout log output if the output mode was set to `silent`.\n-      if (status === 0 || options.suppressErrorOnFailingExitCode) {\n-        resolve({stdout, stderr, status});\n+      if (status === 0) {\n+        resolve({stdout, stderr});\n       } else {\n         reject(outputMode === 'silent' ? logOutput : undefined);\n       }\n     });\n   });\n }\n-\n-/**\n- * Spawns a given command with the specified arguments inside a shell syncronously.\n- *\n- * @returns The command's stdout and stderr.\n- */\n-export function spawnSync(\n-    command: string, args: string[], options: SpawnOptions = {}): SpawnResult {\n-  const commandText = `${command} ${args.join(' ')}`;\n-  debug(`Executing command: ${commandText}`);\n-\n-  const {status: exitCode, signal, stdout, stderr} =\n-      _spawnSync(command, args, {...options, encoding: 'utf8', shell: true, stdio: 'pipe'});\n-\n-  /** The status of the spawn result. */\n-  const status = statusFromExitCodeAndSignal(exitCode, signal);\n-\n-  if (status === 0 || options.suppressErrorOnFailingExitCode) {\n-    return {status, stdout, stderr};\n-  }\n-\n-  throw new Error(stderr);\n-}\n-\n-\n-\n-/** Convert the provided exitCode and signal to a single status code. */\n-function statusFromExitCodeAndSignal(exitCode: number|null, signal: NodeJS.Signals|null) {\n-  return exitCode !== null ? exitCode : signal !== null ? signal : -1;\n-}"
        },
        {
            "sha": "2faef8480531368e525d276416a8a1e2f557c4e4",
            "filename": "dev-infra/utils/git/git-client.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Futils%2Fgit%2Fgit-client.ts",
            "raw_url": "https://github.com/angular/angular/raw/c1c1cda8666e324fc2ef4f051b8f20f36747ee37/dev-infra%2Futils%2Fgit%2Fgit-client.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Futils%2Fgit%2Fgit-client.ts?ref=c1c1cda8666e324fc2ef4f051b8f20f36747ee37",
            "patch": "@@ -9,6 +9,7 @@\n import {spawnSync, SpawnSyncOptions, SpawnSyncReturns} from 'child_process';\n import {Options as SemVerOptions, parse, SemVer} from 'semver';\n \n+import {spawnWithDebugOutput} from '../child-process';\n import {getConfig, GithubConfig, NgDevConfig} from '../config';\n import {debug, info} from '../console';\n import {DryRunError, isDryRun} from '../dry-run';\n@@ -23,7 +24,6 @@ export class GitCommandError extends Error {\n     // accidentally leak the Github token that might be used in a command,\n     // we sanitize the command that will be part of the error message.\n     super(`Command failed: git ${client.sanitizeConsoleOutput(args.join(' '))}`);\n-    Object.setPrototypeOf(this, GitCommandError.prototype);\n   }\n }\n "
        }
    ],
    "stats": {
        "total": 220,
        "additions": 76,
        "deletions": 144
    }
}