{
    "author": "JoostK",
    "message": "refactor(compiler-cli): track a dependency on a default import on `WrappedNodeExpr` (#41557)\n\nPreviously, the `DefaultImportRecorder` interface was used as follows:\n\n1. During the analysis phase, the default import declaration of an\n   identifier was recorded.\n\n2. During the emit phase each emitted identifier would be recorded.\n   The information from step 1 would then be used to determine the\n   default import declaration of the identifier which would be\n   registered as used.\n\n3. A TypeScript transform would taint all default imports that were\n   registered as used in step 2 such that the imports are not elided\n   by TypeScript.\n\nIn incremental compilations, a file may have to be emitted even if its\nanalysis data has been reused from the prior compilation. This would\nmean that step 1 is not executed, resulting in a mismatch in step 2 and\nultimately in incorrectly eliding the default. This was mitigated by\nstoring the mapping from identifier to import declaration on the\n`ts.SourceFile` instead of a member of `DefaultImportTracker` such that\nit would also be visible to the `DefaultImportRecorder` of subsequent\ncompiles even if step 1 had not been executed.\n\nUltimately however, the information that is being recorded into the\n`DefaultImportRecorder` has a longer lifetime than a single\n`DefaultImportRecorder` instance, as that is only valid during a single\ncompilation whereas the identifier to import declaration mapping\noutlives a single compilation. This commit replaces the registration of\nthis mapping by attaching the default import declaration on the output\nAST node that captures the identifier. This enables the removal of\nall of the `DefaultImportRecorder` usages throughout the analysis phase\ntogether with the `DefaultImportRecorder` interface itself.\n\nPR Close #41557",
    "sha": "1381301afe861fdff0e69e595a68b6b50009678f",
    "files": [
        {
            "sha": "60ab38d4c8a327ac5d79876cbe05b879a71db4b4",
            "filename": "packages/compiler-cli/ngcc/src/analysis/decoration_analyzer.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 9,
            "changes": 17,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fdecoration_analyzer.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fdecoration_analyzer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fanalysis%2Fdecoration_analyzer.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -14,7 +14,7 @@ import {ComponentDecoratorHandler, DirectiveDecoratorHandler, InjectableDecorato\n import {CycleAnalyzer, CycleHandlingStrategy, ImportGraph} from '../../../src/ngtsc/cycles';\n import {isFatalDiagnosticError} from '../../../src/ngtsc/diagnostics';\n import {absoluteFromSourceFile, LogicalFileSystem, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n-import {AbsoluteModuleStrategy, LocalIdentifierStrategy, LogicalProjectStrategy, ModuleResolver, NOOP_DEFAULT_IMPORT_RECORDER, PrivateExportAliasingHost, Reexport, ReferenceEmitter} from '../../../src/ngtsc/imports';\n+import {AbsoluteModuleStrategy, LocalIdentifierStrategy, LogicalProjectStrategy, ModuleResolver, PrivateExportAliasingHost, Reexport, ReferenceEmitter} from '../../../src/ngtsc/imports';\n import {SemanticSymbol} from '../../../src/ngtsc/incremental/semantic_graph';\n import {CompoundMetadataReader, CompoundMetadataRegistry, DtsMetadataReader, InjectableClassRegistry, LocalMetadataRegistry, ResourceRegistry} from '../../../src/ngtsc/metadata';\n import {PartialEvaluator} from '../../../src/ngtsc/partial_evaluator';\n@@ -107,16 +107,16 @@ export class DecorationAnalyzer {\n         /* i18nUseExternalIds */ true, this.bundle.enableI18nLegacyMessageIdFormat,\n         /* usePoisonedData */ false,\n         /* i18nNormalizeLineEndingsInICUs */ false, this.moduleResolver, this.cycleAnalyzer,\n-        CycleHandlingStrategy.UseRemoteScoping, this.refEmitter, NOOP_DEFAULT_IMPORT_RECORDER,\n-        NOOP_DEPENDENCY_TRACKER, this.injectableRegistry,\n+        CycleHandlingStrategy.UseRemoteScoping, this.refEmitter, NOOP_DEPENDENCY_TRACKER,\n+        this.injectableRegistry,\n         /* semanticDepGraphUpdater */ null, !!this.compilerOptions.annotateForClosureCompiler,\n         NOOP_PERF_RECORDER),\n \n     // See the note in ngtsc about why this cast is needed.\n     // clang-format off\n     new DirectiveDecoratorHandler(\n         this.reflectionHost, this.evaluator, this.fullRegistry, this.scopeRegistry,\n-        this.fullMetaReader, NOOP_DEFAULT_IMPORT_RECORDER, this.injectableRegistry, this.isCore,\n+        this.fullMetaReader, this.injectableRegistry, this.isCore,\n         /* semanticDepGraphUpdater */ null,\n         !!this.compilerOptions.annotateForClosureCompiler,\n         // In ngcc we want to compile undecorated classes with Angular features. As of\n@@ -131,18 +131,17 @@ export class DecorationAnalyzer {\n     // before injectable factories (so injectable factories can delegate to them)\n     new PipeDecoratorHandler(\n         this.reflectionHost, this.evaluator, this.metaRegistry, this.scopeRegistry,\n-        NOOP_DEFAULT_IMPORT_RECORDER, this.injectableRegistry, this.isCore, NOOP_PERF_RECORDER),\n+        this.injectableRegistry, this.isCore, NOOP_PERF_RECORDER),\n     new InjectableDecoratorHandler(\n-        this.reflectionHost, NOOP_DEFAULT_IMPORT_RECORDER, this.isCore,\n+        this.reflectionHost, this.isCore,\n         /* strictCtorDeps */ false, this.injectableRegistry, NOOP_PERF_RECORDER,\n         /* errorOnDuplicateProv */ false),\n     new NgModuleDecoratorHandler(\n         this.reflectionHost, this.evaluator, this.fullMetaReader, this.fullRegistry,\n         this.scopeRegistry, this.referencesRegistry, this.isCore, /* routeAnalyzer */ null,\n         this.refEmitter,\n-        /* factoryTracker */ null, NOOP_DEFAULT_IMPORT_RECORDER,\n-        !!this.compilerOptions.annotateForClosureCompiler, this.injectableRegistry,\n-        NOOP_PERF_RECORDER),\n+        /* factoryTracker */ null, !!this.compilerOptions.annotateForClosureCompiler,\n+        this.injectableRegistry, NOOP_PERF_RECORDER),\n   ];\n   compiler = new NgccTraitCompiler(this.handlers, this.reflectionHost);\n   migrations: Migration[] = ["
        },
        {
            "sha": "ba723a1cd5806a61d749cc778d1d011121ea672d",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/component.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fcomponent.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -12,7 +12,7 @@ import * as ts from 'typescript';\n import {Cycle, CycleAnalyzer, CycleHandlingStrategy} from '../../cycles';\n import {ErrorCode, FatalDiagnosticError, makeDiagnostic, makeRelatedInformation} from '../../diagnostics';\n import {absoluteFrom, relative} from '../../file_system';\n-import {DefaultImportRecorder, ImportedFile, ModuleResolver, Reference, ReferenceEmitter} from '../../imports';\n+import {ImportedFile, ModuleResolver, Reference, ReferenceEmitter} from '../../imports';\n import {DependencyTracker} from '../../incremental/api';\n import {extractSemanticTypeParameters, isArrayEqual, isReferenceEqual, SemanticDepGraphUpdater, SemanticReference, SemanticSymbol} from '../../incremental/semantic_graph';\n import {IndexingContext} from '../../indexer';\n@@ -205,7 +205,6 @@ export class ComponentDecoratorHandler implements\n       private i18nNormalizeLineEndingsInICUs: boolean|undefined,\n       private moduleResolver: ModuleResolver, private cycleAnalyzer: CycleAnalyzer,\n       private cycleHandlingStrategy: CycleHandlingStrategy, private refEmitter: ReferenceEmitter,\n-      private defaultImportRecorder: DefaultImportRecorder,\n       private depTracker: DependencyTracker|null,\n       private injectableRegistry: InjectableClassRegistry,\n       private semanticDepGraphUpdater: SemanticDepGraphUpdater|null,\n@@ -326,8 +325,8 @@ export class ComponentDecoratorHandler implements\n     // @Component inherits @Directive, so begin by extracting the @Directive metadata and building\n     // on it.\n     const directiveResult = extractDirectiveMetadata(\n-        node, decorator, this.reflector, this.evaluator, this.defaultImportRecorder, this.isCore,\n-        flags, this.annotateForClosureCompiler,\n+        node, decorator, this.reflector, this.evaluator, this.isCore, flags,\n+        this.annotateForClosureCompiler,\n         this.elementSchemaRegistry.getDefaultComponentElementName());\n     if (directiveResult === undefined) {\n       // `extractDirectiveMetadata` returns undefined when the @Directive has `jit: true`. In this\n@@ -490,8 +489,7 @@ export class ComponentDecoratorHandler implements\n         },\n         typeCheckMeta: extractDirectiveTypeCheckMeta(node, inputs, this.reflector),\n         classMetadata: extractClassMetadata(\n-            node, this.reflector, this.defaultImportRecorder, this.isCore,\n-            this.annotateForClosureCompiler),\n+            node, this.reflector, this.isCore, this.annotateForClosureCompiler),\n         template,\n         providersRequiringFactory,\n         viewProvidersRequiringFactory,"
        },
        {
            "sha": "3893ad0725d5a3b4193522b7adb4c13497e8522f",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/directive.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 12,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fdirective.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -11,7 +11,7 @@ import {emitDistinctChangesOnlyDefaultValue} from '@angular/compiler/src/core';\n import * as ts from 'typescript';\n \n import {ErrorCode, FatalDiagnosticError} from '../../diagnostics';\n-import {DefaultImportRecorder, Reference} from '../../imports';\n+import {Reference} from '../../imports';\n import {areTypeParametersEqual, extractSemanticTypeParameters, isArrayEqual, isSetEqual, isSymbolEqual, SemanticDepGraphUpdater, SemanticSymbol, SemanticTypeParameter} from '../../incremental/semantic_graph';\n import {BindingPropertyName, ClassPropertyMapping, ClassPropertyName, DirectiveTypeCheckMeta, InjectableClassRegistry, MetadataReader, MetadataRegistry, TemplateGuardMeta} from '../../metadata';\n import {extractDirectiveTypeCheckMeta} from '../../metadata/src/util';\n@@ -177,9 +177,8 @@ export class DirectiveDecoratorHandler implements\n   constructor(\n       private reflector: ReflectionHost, private evaluator: PartialEvaluator,\n       private metaRegistry: MetadataRegistry, private scopeRegistry: LocalModuleScopeRegistry,\n-      private metaReader: MetadataReader, private defaultImportRecorder: DefaultImportRecorder,\n-      private injectableRegistry: InjectableClassRegistry, private isCore: boolean,\n-      private semanticDepGraphUpdater: SemanticDepGraphUpdater|null,\n+      private metaReader: MetadataReader, private injectableRegistry: InjectableClassRegistry,\n+      private isCore: boolean, private semanticDepGraphUpdater: SemanticDepGraphUpdater|null,\n       private annotateForClosureCompiler: boolean,\n       private compileUndecoratedClassesWithAngularFeatures: boolean, private perf: PerfRecorder) {}\n \n@@ -215,8 +214,8 @@ export class DirectiveDecoratorHandler implements\n     this.perf.eventCount(PerfEvent.AnalyzeDirective);\n \n     const directiveResult = extractDirectiveMetadata(\n-        node, decorator, this.reflector, this.evaluator, this.defaultImportRecorder, this.isCore,\n-        flags, this.annotateForClosureCompiler);\n+        node, decorator, this.reflector, this.evaluator, this.isCore, flags,\n+        this.annotateForClosureCompiler);\n     if (directiveResult === undefined) {\n       return {};\n     }\n@@ -234,8 +233,7 @@ export class DirectiveDecoratorHandler implements\n         outputs: directiveResult.outputs,\n         meta: analysis,\n         classMetadata: extractClassMetadata(\n-            node, this.reflector, this.defaultImportRecorder, this.isCore,\n-            this.annotateForClosureCompiler),\n+            node, this.reflector, this.isCore, this.annotateForClosureCompiler),\n         baseClass: readBaseClass(node, this.reflector, this.evaluator),\n         typeCheckMeta: extractDirectiveTypeCheckMeta(node, directiveResult.inputs, this.reflector),\n         providersRequiringFactory,\n@@ -351,9 +349,8 @@ export class DirectiveDecoratorHandler implements\n  */\n export function extractDirectiveMetadata(\n     clazz: ClassDeclaration, decorator: Readonly<Decorator|null>, reflector: ReflectionHost,\n-    evaluator: PartialEvaluator, defaultImportRecorder: DefaultImportRecorder, isCore: boolean,\n-    flags: HandlerFlags, annotateForClosureCompiler: boolean,\n-    defaultSelector: string|null = null): {\n+    evaluator: PartialEvaluator, isCore: boolean, flags: HandlerFlags,\n+    annotateForClosureCompiler: boolean, defaultSelector: string|null = null): {\n   decorator: Map<string, ts.Expression>,\n   metadata: R3DirectiveMetadata,\n   inputs: ClassPropertyMapping,\n@@ -473,7 +470,7 @@ export function extractDirectiveMetadata(\n     exportAs = resolved.split(',').map(part => part.trim());\n   }\n \n-  const rawCtorDeps = getConstructorDependencies(clazz, reflector, defaultImportRecorder, isCore);\n+  const rawCtorDeps = getConstructorDependencies(clazz, reflector, isCore);\n \n   // Non-abstract directives (those with a selector) require valid constructor dependencies, whereas\n   // abstract directives are allowed to have invalid dependencies, given that a subclass may call"
        },
        {
            "sha": "ee0ad85820dea4cf2f1b96317be5dc21d1041c20",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/injectable.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 13,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Finjectable.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Finjectable.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Finjectable.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -10,7 +10,6 @@ import {compileClassMetadata, CompileClassMetadataFn, compileDeclareClassMetadat\n import * as ts from 'typescript';\n \n import {ErrorCode, FatalDiagnosticError} from '../../diagnostics';\n-import {DefaultImportRecorder} from '../../imports';\n import {InjectableClassRegistry} from '../../metadata';\n import {PerfEvent, PerfRecorder} from '../../perf';\n import {ClassDeclaration, Decorator, ReflectionHost, reflectObjectLiteral} from '../../reflection';\n@@ -33,8 +32,7 @@ export interface InjectableHandlerData {\n export class InjectableDecoratorHandler implements\n     DecoratorHandler<Decorator, InjectableHandlerData, null, unknown> {\n   constructor(\n-      private reflector: ReflectionHost, private defaultImportRecorder: DefaultImportRecorder,\n-      private isCore: boolean, private strictCtorDeps: boolean,\n+      private reflector: ReflectionHost, private isCore: boolean, private strictCtorDeps: boolean,\n       private injectableRegistry: InjectableClassRegistry, private perf: PerfRecorder,\n       /**\n        * What to do if the injectable already contains a ɵprov property.\n@@ -74,10 +72,8 @@ export class InjectableDecoratorHandler implements\n       analysis: {\n         meta,\n         ctorDeps: extractInjectableCtorDeps(\n-            node, meta, decorator, this.reflector, this.defaultImportRecorder, this.isCore,\n-            this.strictCtorDeps),\n-        classMetadata:\n-            extractClassMetadata(node, this.reflector, this.defaultImportRecorder, this.isCore),\n+            node, meta, decorator, this.reflector, this.isCore, this.strictCtorDeps),\n+        classMetadata: extractClassMetadata(node, this.reflector, this.isCore),\n         // Avoid generating multiple factories if a class has\n         // more Angular decorators, apart from Injectable.\n         needsFactory: !decorators ||\n@@ -232,8 +228,7 @@ function getProviderExpression(\n \n function extractInjectableCtorDeps(\n     clazz: ClassDeclaration, meta: R3InjectableMetadata, decorator: Decorator,\n-    reflector: ReflectionHost, defaultImportRecorder: DefaultImportRecorder, isCore: boolean,\n-    strictCtorDeps: boolean) {\n+    reflector: ReflectionHost, isCore: boolean, strictCtorDeps: boolean) {\n   if (decorator.args === null) {\n     throw new FatalDiagnosticError(\n         ErrorCode.DECORATOR_NOT_CALLED, Decorator.nodeForError(decorator),\n@@ -252,15 +247,15 @@ function extractInjectableCtorDeps(\n     // constructor signature does not work for DI then a factory definition (ɵfac) that throws is\n     // generated.\n     if (strictCtorDeps) {\n-      ctorDeps = getValidConstructorDependencies(clazz, reflector, defaultImportRecorder, isCore);\n+      ctorDeps = getValidConstructorDependencies(clazz, reflector, isCore);\n     } else {\n-      ctorDeps = unwrapConstructorDependencies(\n-          getConstructorDependencies(clazz, reflector, defaultImportRecorder, isCore));\n+      ctorDeps =\n+          unwrapConstructorDependencies(getConstructorDependencies(clazz, reflector, isCore));\n     }\n \n     return ctorDeps;\n   } else if (decorator.args.length === 1) {\n-    const rawCtorDeps = getConstructorDependencies(clazz, reflector, defaultImportRecorder, isCore);\n+    const rawCtorDeps = getConstructorDependencies(clazz, reflector, isCore);\n \n     if (strictCtorDeps && meta.useValue === undefined && meta.useExisting === undefined &&\n         meta.useClass === undefined && meta.useFactory === undefined) {"
        },
        {
            "sha": "223a0ed16f64217c04f49a88a0f3f4e1df6d8706",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/metadata.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 9,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fmetadata.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fmetadata.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fmetadata.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -9,7 +9,6 @@\n import {Expression, FunctionExpr, LiteralArrayExpr, LiteralExpr, literalMap, R3ClassMetadata, ReturnStatement, WrappedNodeExpr} from '@angular/compiler';\n import * as ts from 'typescript';\n \n-import {DefaultImportRecorder} from '../../imports';\n import {CtorParameter, DeclarationNode, Decorator, ReflectionHost, TypeValueReferenceKind} from '../../reflection';\n \n import {valueReferenceToExpression, wrapFunctionExpressionsInParens} from './util';\n@@ -23,8 +22,7 @@ import {valueReferenceToExpression, wrapFunctionExpressionsInParens} from './uti\n  * as a `Statement` for inclusion along with the class.\n  */\n export function extractClassMetadata(\n-    clazz: DeclarationNode, reflection: ReflectionHost,\n-    defaultImportRecorder: DefaultImportRecorder, isCore: boolean,\n+    clazz: DeclarationNode, reflection: ReflectionHost, isCore: boolean,\n     annotateForClosureCompiler?: boolean): R3ClassMetadata|null {\n   if (!reflection.isClass(clazz)) {\n     return null;\n@@ -55,8 +53,7 @@ export function extractClassMetadata(\n   let metaCtorParameters: Expression|null = null;\n   const classCtorParameters = reflection.getConstructorParameters(clazz);\n   if (classCtorParameters !== null) {\n-    const ctorParameters = classCtorParameters.map(\n-        param => ctorParameterToMetadata(param, defaultImportRecorder, isCore));\n+    const ctorParameters = classCtorParameters.map(param => ctorParameterToMetadata(param, isCore));\n     metaCtorParameters = new FunctionExpr([], [\n       new ReturnStatement(new LiteralArrayExpr(ctorParameters)),\n     ]);\n@@ -93,13 +90,11 @@ export function extractClassMetadata(\n /**\n  * Convert a reflected constructor parameter to metadata.\n  */\n-function ctorParameterToMetadata(\n-    param: CtorParameter, defaultImportRecorder: DefaultImportRecorder,\n-    isCore: boolean): Expression {\n+function ctorParameterToMetadata(param: CtorParameter, isCore: boolean): Expression {\n   // Parameters sometimes have a type that can be referenced. If so, then use it, otherwise\n   // its type is undefined.\n   const type = param.typeValueReference.kind !== TypeValueReferenceKind.UNAVAILABLE ?\n-      valueReferenceToExpression(param.typeValueReference, defaultImportRecorder) :\n+      valueReferenceToExpression(param.typeValueReference) :\n       new LiteralExpr(undefined);\n \n   const mapEntries: {key: string, value: Expression, quoted: false}[] = ["
        },
        {
            "sha": "cb98a2fa786b767bc564b05d863066c2d8921ae9",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/ng_module.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 8,
            "changes": 12,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fng_module.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -10,7 +10,7 @@ import {compileClassMetadata, compileDeclareClassMetadata, compileDeclareInjecto\n import * as ts from 'typescript';\n \n import {ErrorCode, FatalDiagnosticError, makeDiagnostic, makeRelatedInformation} from '../../diagnostics';\n-import {DefaultImportRecorder, Reference, ReferenceEmitter} from '../../imports';\n+import {Reference, ReferenceEmitter} from '../../imports';\n import {isArrayEqual, isReferenceEqual, isSymbolEqual, SemanticReference, SemanticSymbol} from '../../incremental/semantic_graph';\n import {InjectableClassRegistry, MetadataReader, MetadataRegistry} from '../../metadata';\n import {PartialEvaluator, ResolvedValue} from '../../partial_evaluator';\n@@ -130,9 +130,7 @@ export class NgModuleDecoratorHandler implements\n       private scopeRegistry: LocalModuleScopeRegistry,\n       private referencesRegistry: ReferencesRegistry, private isCore: boolean,\n       private routeAnalyzer: NgModuleRouteAnalyzer|null, private refEmitter: ReferenceEmitter,\n-      private factoryTracker: FactoryTracker|null,\n-      private defaultImportRecorder: DefaultImportRecorder,\n-      private annotateForClosureCompiler: boolean,\n+      private factoryTracker: FactoryTracker|null, private annotateForClosureCompiler: boolean,\n       private injectableRegistry: InjectableClassRegistry, private perf: PerfRecorder,\n       private localeId?: string) {}\n \n@@ -350,8 +348,7 @@ export class NgModuleDecoratorHandler implements\n       type,\n       internalType,\n       typeArgumentCount: 0,\n-      deps: getValidConstructorDependencies(\n-          node, this.reflector, this.defaultImportRecorder, this.isCore),\n+      deps: getValidConstructorDependencies(node, this.reflector, this.isCore),\n       target: FactoryTarget.NgModule,\n     };\n \n@@ -371,8 +368,7 @@ export class NgModuleDecoratorHandler implements\n             resolveProvidersRequiringFactory(rawProviders, this.reflector, this.evaluator) :\n             null,\n         classMetadata: extractClassMetadata(\n-            node, this.reflector, this.defaultImportRecorder, this.isCore,\n-            this.annotateForClosureCompiler),\n+            node, this.reflector, this.isCore, this.annotateForClosureCompiler),\n         factorySymbolName: node.name.text,\n       },\n     };"
        },
        {
            "sha": "1dd0d4b9612713f687b0fe03516d4ec35bf9cf42",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/pipe.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fpipe.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fpipe.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Fpipe.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -10,7 +10,7 @@ import {compileClassMetadata, compileDeclareClassMetadata, compileDeclarePipeFro\n import * as ts from 'typescript';\n \n import {ErrorCode, FatalDiagnosticError} from '../../diagnostics';\n-import {DefaultImportRecorder, Reference} from '../../imports';\n+import {Reference} from '../../imports';\n import {SemanticSymbol} from '../../incremental/semantic_graph';\n import {InjectableClassRegistry, MetadataRegistry} from '../../metadata';\n import {PartialEvaluator} from '../../partial_evaluator';\n@@ -55,7 +55,6 @@ export class PipeDecoratorHandler implements\n   constructor(\n       private reflector: ReflectionHost, private evaluator: PartialEvaluator,\n       private metaRegistry: MetadataRegistry, private scopeRegistry: LocalModuleScopeRegistry,\n-      private defaultImportRecorder: DefaultImportRecorder,\n       private injectableRegistry: InjectableClassRegistry, private isCore: boolean,\n       private perf: PerfRecorder) {}\n \n@@ -131,12 +130,10 @@ export class PipeDecoratorHandler implements\n           internalType,\n           typeArgumentCount: this.reflector.getGenericArityOfClass(clazz) || 0,\n           pipeName,\n-          deps: getValidConstructorDependencies(\n-              clazz, this.reflector, this.defaultImportRecorder, this.isCore),\n+          deps: getValidConstructorDependencies(clazz, this.reflector, this.isCore),\n           pure,\n         },\n-        classMetadata:\n-            extractClassMetadata(clazz, this.reflector, this.defaultImportRecorder, this.isCore),\n+        classMetadata: extractClassMetadata(clazz, this.reflector, this.isCore),\n       },\n     };\n   }"
        },
        {
            "sha": "69d29dbd01ebc9845718da6e945d676f53fd44bf",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/src/util.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 19,
            "changes": 34,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Futil.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Futil.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Fsrc%2Futil.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -12,7 +12,8 @@ import {FactoryTarget} from '@angular/compiler/src/render3/partial/api';\n import * as ts from 'typescript';\n \n import {ErrorCode, FatalDiagnosticError, makeDiagnostic, makeRelatedInformation} from '../../diagnostics';\n-import {DefaultImportRecorder, ImportFlags, Reference, ReferenceEmitter} from '../../imports';\n+import {ImportFlags, Reference, ReferenceEmitter} from '../../imports';\n+import {attachDefaultImportDeclaration} from '../../imports/src/default';\n import {ForeignFunctionResolver, PartialEvaluator} from '../../partial_evaluator';\n import {ClassDeclaration, CtorParameter, Decorator, Import, ImportedTypeValueReference, isNamedClassDeclaration, LocalTypeValueReference, ReflectionHost, TypeValueReference, TypeValueReferenceKind, UnavailableValue, ValueUnavailableKind} from '../../reflection';\n import {DeclarationData} from '../../scope';\n@@ -32,8 +33,7 @@ export interface ConstructorDepError {\n }\n \n export function getConstructorDependencies(\n-    clazz: ClassDeclaration, reflector: ReflectionHost,\n-    defaultImportRecorder: DefaultImportRecorder, isCore: boolean): ConstructorDeps|null {\n+    clazz: ClassDeclaration, reflector: ReflectionHost, isCore: boolean): ConstructorDeps|null {\n   const deps: R3DependencyMetadata[] = [];\n   const errors: ConstructorDepError[] = [];\n   let ctorParams = reflector.getConstructorParameters(clazz);\n@@ -45,7 +45,7 @@ export function getConstructorDependencies(\n     }\n   }\n   ctorParams.forEach((param, idx) => {\n-    let token = valueReferenceToExpression(param.typeValueReference, defaultImportRecorder);\n+    let token = valueReferenceToExpression(param.typeValueReference);\n     let attributeNameType: Expression|null = null;\n     let optional = false, self = false, skipSelf = false, host = false;\n \n@@ -115,22 +115,18 @@ export function getConstructorDependencies(\n  * references are converted to an `ExternalExpr`. Note that this is only valid in the context of the\n  * file in which the `TypeValueReference` originated.\n  */\n-export function valueReferenceToExpression(\n-    valueRef: LocalTypeValueReference|ImportedTypeValueReference,\n-    defaultImportRecorder: DefaultImportRecorder): Expression;\n-export function valueReferenceToExpression(\n-    valueRef: TypeValueReference, defaultImportRecorder: DefaultImportRecorder): Expression|null;\n-export function valueReferenceToExpression(\n-    valueRef: TypeValueReference, defaultImportRecorder: DefaultImportRecorder): Expression|null {\n+export function valueReferenceToExpression(valueRef: LocalTypeValueReference|\n+                                           ImportedTypeValueReference): Expression;\n+export function valueReferenceToExpression(valueRef: TypeValueReference): Expression|null;\n+export function valueReferenceToExpression(valueRef: TypeValueReference): Expression|null {\n   if (valueRef.kind === TypeValueReferenceKind.UNAVAILABLE) {\n     return null;\n   } else if (valueRef.kind === TypeValueReferenceKind.LOCAL) {\n-    if (defaultImportRecorder !== null && valueRef.defaultImportStatement !== null &&\n-        ts.isIdentifier(valueRef.expression)) {\n-      defaultImportRecorder.recordImportedIdentifier(\n-          valueRef.expression, valueRef.defaultImportStatement);\n+    const expr = new WrappedNodeExpr(valueRef.expression);\n+    if (valueRef.defaultImportStatement !== null) {\n+      attachDefaultImportDeclaration(expr, valueRef.defaultImportStatement);\n     }\n-    return new WrappedNodeExpr(valueRef.expression);\n+    return expr;\n   } else {\n     let importExpr: Expression =\n         new ExternalExpr({moduleName: valueRef.moduleName, name: valueRef.importedName});\n@@ -163,10 +159,10 @@ export function unwrapConstructorDependencies(deps: ConstructorDeps|null): R3Dep\n }\n \n export function getValidConstructorDependencies(\n-    clazz: ClassDeclaration, reflector: ReflectionHost,\n-    defaultImportRecorder: DefaultImportRecorder, isCore: boolean): R3DependencyMetadata[]|null {\n+    clazz: ClassDeclaration, reflector: ReflectionHost, isCore: boolean): R3DependencyMetadata[]|\n+    null {\n   return validateConstructorDependencies(\n-      clazz, getConstructorDependencies(clazz, reflector, defaultImportRecorder, isCore));\n+      clazz, getConstructorDependencies(clazz, reflector, isCore));\n }\n \n /**"
        },
        {
            "sha": "8fcfca7eb697b646b4c9c86fd4cac6df898b4db1",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/test/component_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fcomponent_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fcomponent_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fcomponent_spec.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -13,7 +13,7 @@ import {CycleAnalyzer, CycleHandlingStrategy, ImportGraph} from '../../cycles';\n import {ErrorCode, FatalDiagnosticError} from '../../diagnostics';\n import {absoluteFrom} from '../../file_system';\n import {runInEachFileSystem} from '../../file_system/testing';\n-import {ModuleResolver, NOOP_DEFAULT_IMPORT_RECORDER, ReferenceEmitter} from '../../imports';\n+import {ModuleResolver, ReferenceEmitter} from '../../imports';\n import {CompoundMetadataReader, DtsMetadataReader, InjectableClassRegistry, LocalMetadataRegistry, ResourceRegistry} from '../../metadata';\n import {PartialEvaluator} from '../../partial_evaluator';\n import {NOOP_PERF_RECORDER} from '../../perf';\n@@ -81,7 +81,6 @@ function setup(program: ts.Program, options: ts.CompilerOptions, host: ts.Compil\n       cycleAnalyzer,\n       CycleHandlingStrategy.UseRemoteScoping,\n       refEmitter,\n-      NOOP_DEFAULT_IMPORT_RECORDER,\n       /* depTracker */ null,\n       injectableRegistry,\n       /* semanticDepGraphUpdater */ null,"
        },
        {
            "sha": "bfef378682c27b1ad6b0ccbd3f2fe500605bb125",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/test/directive_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fdirective_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fdirective_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fdirective_spec.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -10,7 +10,7 @@ import * as ts from 'typescript';\n \n import {absoluteFrom} from '../../file_system';\n import {runInEachFileSystem} from '../../file_system/testing';\n-import {NOOP_DEFAULT_IMPORT_RECORDER, ReferenceEmitter} from '../../imports';\n+import {ReferenceEmitter} from '../../imports';\n import {DtsMetadataReader, InjectableClassRegistry, LocalMetadataRegistry} from '../../metadata';\n import {PartialEvaluator} from '../../partial_evaluator';\n import {NOOP_PERF_RECORDER} from '../../perf';\n@@ -168,8 +168,8 @@ runInEachFileSystem(() => {\n         null);\n     const injectableRegistry = new InjectableClassRegistry(reflectionHost);\n     const handler = new DirectiveDecoratorHandler(\n-        reflectionHost, evaluator, scopeRegistry, scopeRegistry, metaReader,\n-        NOOP_DEFAULT_IMPORT_RECORDER, injectableRegistry, /*isCore*/ false,\n+        reflectionHost, evaluator, scopeRegistry, scopeRegistry, metaReader, injectableRegistry,\n+        /*isCore*/ false,\n         /*semanticDepGraphUpdater*/ null,\n         /*annotateForClosureCompiler*/ false,\n         /*detectUndecoratedClassesWithAngularFeatures*/ false, NOOP_PERF_RECORDER);"
        },
        {
            "sha": "901463b7e4a71054a632c07d15fa58cdc05ccfc3",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/test/injectable_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Finjectable_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Finjectable_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Finjectable_spec.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -8,7 +8,6 @@\n import {ErrorCode, FatalDiagnosticError, ngErrorCode} from '../../diagnostics';\n import {absoluteFrom} from '../../file_system';\n import {runInEachFileSystem} from '../../file_system/testing';\n-import {NOOP_DEFAULT_IMPORT_RECORDER} from '../../imports';\n import {InjectableClassRegistry} from '../../metadata';\n import {NOOP_PERF_RECORDER} from '../../perf';\n import {isNamedClassDeclaration, TypeScriptReflectionHost} from '../../reflection';\n@@ -70,7 +69,7 @@ function setupHandler(errorOnDuplicateProv: boolean) {\n   const reflectionHost = new TypeScriptReflectionHost(checker);\n   const injectableRegistry = new InjectableClassRegistry(reflectionHost);\n   const handler = new InjectableDecoratorHandler(\n-      reflectionHost, NOOP_DEFAULT_IMPORT_RECORDER, /* isCore */ false,\n+      reflectionHost, /* isCore */ false,\n       /* strictCtorDeps */ false, injectableRegistry, NOOP_PERF_RECORDER, errorOnDuplicateProv);\n   const TestClass = getDeclaration(program, ENTRY_FILE, 'TestClass', isNamedClassDeclaration);\n   const ɵprov = reflectionHost.getMembersOfClass(TestClass).find(member => member.name === 'ɵprov');"
        },
        {
            "sha": "180ccab12d0337823f8de6c6bed8a6a381559c6b",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/test/metadata_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fmetadata_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fmetadata_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fmetadata_spec.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -10,7 +10,7 @@ import * as ts from 'typescript';\n \n import {absoluteFrom, getSourceFileOrError} from '../../file_system';\n import {runInEachFileSystem, TestFile} from '../../file_system/testing';\n-import {NOOP_DEFAULT_IMPORT_RECORDER, NoopImportRewriter} from '../../imports';\n+import {NoopImportRewriter} from '../../imports';\n import {TypeScriptReflectionHost} from '../../reflection';\n import {getDeclaration, makeProgram} from '../../testing';\n import {ImportManager, translateStatement} from '../../translator';\n@@ -128,7 +128,7 @@ runInEachFileSystem(() => {\n         {target: ts.ScriptTarget.ES2015});\n     const host = new TypeScriptReflectionHost(program.getTypeChecker());\n     const target = getDeclaration(program, _('/index.ts'), 'Target', ts.isClassDeclaration);\n-    const call = extractClassMetadata(target, host, NOOP_DEFAULT_IMPORT_RECORDER, false);\n+    const call = extractClassMetadata(target, host, false);\n     if (call === null) {\n       return '';\n     }"
        },
        {
            "sha": "bd16ad693ee9b7d885adb973209bfc4c3d086fa8",
            "filename": "packages/compiler-cli/src/ngtsc/annotations/test/ng_module_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fng_module_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fng_module_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fannotations%2Ftest%2Fng_module_spec.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -11,7 +11,7 @@ import * as ts from 'typescript';\n \n import {absoluteFrom} from '../../file_system';\n import {runInEachFileSystem} from '../../file_system/testing';\n-import {LocalIdentifierStrategy, NOOP_DEFAULT_IMPORT_RECORDER, ReferenceEmitter} from '../../imports';\n+import {LocalIdentifierStrategy, ReferenceEmitter} from '../../imports';\n import {CompoundMetadataReader, DtsMetadataReader, InjectableClassRegistry, LocalMetadataRegistry} from '../../metadata';\n import {PartialEvaluator} from '../../partial_evaluator';\n import {NOOP_PERF_RECORDER} from '../../perf';\n@@ -72,8 +72,7 @@ runInEachFileSystem(() => {\n       const handler = new NgModuleDecoratorHandler(\n           reflectionHost, evaluator, metaReader, metaRegistry, scopeRegistry, referencesRegistry,\n           /* isCore */ false, /* routeAnalyzer */ null, refEmitter, /* factoryTracker */ null,\n-          NOOP_DEFAULT_IMPORT_RECORDER, /* annotateForClosureCompiler */ false, injectableRegistry,\n-          NOOP_PERF_RECORDER);\n+          /* annotateForClosureCompiler */ false, injectableRegistry, NOOP_PERF_RECORDER);\n       const TestModule =\n           getDeclaration(program, _('/entry.ts'), 'TestModule', isNamedClassDeclaration);\n       const detected ="
        },
        {
            "sha": "6a0ebb4a13ec2f2473776e12fa49af0c37f1c321",
            "filename": "packages/compiler-cli/src/ngtsc/core/src/compiler.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 18,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fcompiler.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -52,7 +52,6 @@ interface LazyCompilationState {\n   routeAnalyzer: NgModuleRouteAnalyzer;\n   dtsTransforms: DtsTransformRegistry;\n   mwpScanner: ModuleWithProvidersScanner;\n-  defaultImportTracker: DefaultImportTracker;\n   aliasingHost: AliasingHost|null;\n   refEmitter: ReferenceEmitter;\n   templateTypeChecker: TemplateTypeChecker;\n@@ -613,13 +612,14 @@ export class NgCompiler {\n       importRewriter = new NoopImportRewriter();\n     }\n \n+    const defaultImportTracker = new DefaultImportTracker();\n+\n     const before = [\n       ivyTransformFactory(\n-          compilation.traitCompiler, compilation.reflector, importRewriter,\n-          compilation.defaultImportTracker, this.delegatingPerfRecorder, compilation.isCore,\n-          this.closureCompilerEnabled),\n+          compilation.traitCompiler, compilation.reflector, importRewriter, defaultImportTracker,\n+          this.delegatingPerfRecorder, compilation.isCore, this.closureCompilerEnabled),\n       aliasTransformFactory(compilation.traitCompiler.exportStatements),\n-      compilation.defaultImportTracker.importPreservingTransformer(),\n+      defaultImportTracker.importPreservingTransformer(),\n     ];\n \n     const afterDeclarations: ts.TransformerFactory<ts.SourceFile>[] = [];\n@@ -971,7 +971,6 @@ export class NgCompiler {\n \n     const isCore = isAngularCorePackage(this.inputProgram);\n \n-    const defaultImportTracker = new DefaultImportTracker();\n     const resourceRegistry = new ResourceRegistry();\n \n     const compilationMode =\n@@ -993,33 +992,31 @@ export class NgCompiler {\n           this.options.i18nUseExternalIds !== false,\n           this.options.enableI18nLegacyMessageIdFormat !== false, this.usePoisonedData,\n           this.options.i18nNormalizeLineEndingsInICUs, this.moduleResolver, this.cycleAnalyzer,\n-          cycleHandlingStrategy, refEmitter, defaultImportTracker, this.incrementalDriver.depGraph,\n-          injectableRegistry, semanticDepGraphUpdater, this.closureCompilerEnabled,\n-          this.delegatingPerfRecorder),\n+          cycleHandlingStrategy, refEmitter, this.incrementalDriver.depGraph, injectableRegistry,\n+          semanticDepGraphUpdater, this.closureCompilerEnabled, this.delegatingPerfRecorder),\n \n       // TODO(alxhub): understand why the cast here is necessary (something to do with `null`\n       // not being assignable to `unknown` when wrapped in `Readonly`).\n       // clang-format off\n         new DirectiveDecoratorHandler(\n             reflector, evaluator, metaRegistry, scopeRegistry, metaReader,\n-            defaultImportTracker, injectableRegistry, isCore, semanticDepGraphUpdater,\n+            injectableRegistry, isCore, semanticDepGraphUpdater,\n           this.closureCompilerEnabled, compileUndecoratedClassesWithAngularFeatures,\n           this.delegatingPerfRecorder,\n         ) as Readonly<DecoratorHandler<unknown, unknown, SemanticSymbol | null,unknown>>,\n       // clang-format on\n       // Pipe handler must be before injectable handler in list so pipe factories are printed\n       // before injectable factories (so injectable factories can delegate to them)\n       new PipeDecoratorHandler(\n-          reflector, evaluator, metaRegistry, scopeRegistry, defaultImportTracker,\n-          injectableRegistry, isCore, this.delegatingPerfRecorder),\n+          reflector, evaluator, metaRegistry, scopeRegistry, injectableRegistry, isCore,\n+          this.delegatingPerfRecorder),\n       new InjectableDecoratorHandler(\n-          reflector, defaultImportTracker, isCore, this.options.strictInjectionParameters || false,\n-          injectableRegistry, this.delegatingPerfRecorder),\n+          reflector, isCore, this.options.strictInjectionParameters || false, injectableRegistry,\n+          this.delegatingPerfRecorder),\n       new NgModuleDecoratorHandler(\n           reflector, evaluator, metaReader, metaRegistry, scopeRegistry, referencesRegistry, isCore,\n-          routeAnalyzer, refEmitter, this.adapter.factoryTracker, defaultImportTracker,\n-          this.closureCompilerEnabled, injectableRegistry, this.delegatingPerfRecorder,\n-          this.options.i18nInLocale),\n+          routeAnalyzer, refEmitter, this.adapter.factoryTracker, this.closureCompilerEnabled,\n+          injectableRegistry, this.delegatingPerfRecorder, this.options.i18nInLocale),\n     ];\n \n     const traitCompiler = new TraitCompiler(\n@@ -1051,7 +1048,6 @@ export class NgCompiler {\n       mwpScanner,\n       metaReader,\n       typeCheckScopeRegistry,\n-      defaultImportTracker,\n       aliasingHost,\n       refEmitter,\n       templateTypeChecker,"
        },
        {
            "sha": "311228384723b7337189185b028b5035a23d29ca",
            "filename": "packages/compiler-cli/src/ngtsc/imports/README.md",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2FREADME.md?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -167,8 +167,6 @@ It consists of two mechanisms:\n \n 1. A `DefaultImportTracker`, which records information about both default imports encountered in the program as well as usages of those imports added during compilation.\n \n-A `DefaultImportRecorder` interface is used to allow for a noop implementation in cases (like ngcc) where this tracking isn't necessary.\n-\n 2. A TypeScript transformer which processes default import statements and can preserve those which are actually used.\n \n This is accessed via `DefaultImportTracker.importPreservingTransformer`."
        },
        {
            "sha": "523bdffe6ba77dc7ecd1fcd0bcc99934bb72236a",
            "filename": "packages/compiler-cli/src/ngtsc/imports/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Findex.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -8,7 +8,7 @@\n \n export {AliasingHost, AliasStrategy, PrivateExportAliasingHost, UnifiedModulesAliasingHost} from './src/alias';\n export {ImportRewriter, NoopImportRewriter, R3SymbolsImportRewriter, validateAndRewriteCoreSymbol} from './src/core';\n-export {DefaultImportRecorder, DefaultImportTracker, NOOP_DEFAULT_IMPORT_RECORDER} from './src/default';\n+export {DefaultImportTracker} from './src/default';\n export {AbsoluteModuleStrategy, EmittedReference, ImportedFile, ImportFlags, LocalIdentifierStrategy, LogicalProjectStrategy, ReferenceEmitStrategy, ReferenceEmitter, RelativePathStrategy, UnifiedModulesStrategy} from './src/emitter';\n export {Reexport} from './src/reexport';\n export {OwningModule, Reference} from './src/references';"
        },
        {
            "sha": "05bf46627eeb5dfa69b9293bdec510b9086cff61",
            "filename": "packages/compiler-cli/src/ngtsc/imports/src/default.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 58,
            "changes": 80,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Fdefault.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Fdefault.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Fsrc%2Fdefault.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -6,52 +6,33 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n+import {WrappedNodeExpr} from '@angular/compiler';\n import * as ts from 'typescript';\n \n import {getSourceFile} from '../../util/src/typescript';\n \n-/**\n- * Registers and records usages of `ts.Identifer`s that came from default import statements.\n- *\n- * See `DefaultImportTracker` for details.\n- */\n-export interface DefaultImportRecorder {\n-  /**\n-   * Record an association between a `ts.Identifier` which might be emitted and the\n-   * `ts.ImportDeclaration` from which it came.\n-   *\n-   * Alone, this method has no effect as the `ts.Identifier` might not be used in the output.\n-   * The identifier must later be marked as used with `recordUsedIdentifier` in order for its\n-   * import to be preserved.\n-   */\n-  recordImportedIdentifier(id: ts.Identifier, decl: ts.ImportDeclaration): void;\n+const DefaultImportDeclaration = Symbol('DefaultImportDeclaration');\n \n-  /**\n-   * Record the fact that the given `ts.Identifer` will be emitted, and thus its\n-   * `ts.ImportDeclaration`, if it was a previously registered default import, must be preserved.\n-   *\n-   * This method can be called safely for any `ts.Identifer`, regardless of its origin. It will only\n-   * have an effect if the identifier came from a `ts.ImportDeclaration` default import which was\n-   * previously registered with `recordImportedIdentifier`.\n-   */\n-  recordUsedIdentifier(id: ts.Identifier): void;\n+interface WithDefaultImportDeclaration {\n+  [DefaultImportDeclaration]?: ts.ImportDeclaration;\n }\n \n /**\n- * An implementation of `DefaultImportRecorder` which does nothing.\n- *\n- * This is useful when default import tracking isn't required, such as when emitting .d.ts code\n- * or for ngcc.\n+ * Attaches a default import declaration to `expr` to indicate the dependency of `expr` on the\n+ * default import.\n  */\n-export const NOOP_DEFAULT_IMPORT_RECORDER: DefaultImportRecorder = {\n-  recordImportedIdentifier: (id: ts.Identifier) => void{},\n-  recordUsedIdentifier: (id: ts.Identifier) => void{},\n-};\n-\n-const ImportDeclarationMapping = Symbol('ImportDeclarationMapping');\n+export function attachDefaultImportDeclaration(\n+    expr: WrappedNodeExpr<unknown>, importDecl: ts.ImportDeclaration): void {\n+  (expr as WithDefaultImportDeclaration)[DefaultImportDeclaration] = importDecl;\n+}\n \n-interface SourceFileWithImportDeclarationMapping extends ts.SourceFile {\n-  [ImportDeclarationMapping]?: Map<ts.Identifier, ts.ImportDeclaration>;\n+/**\n+ * Obtains the default import declaration that `expr` depends on, or `null` if there is no such\n+ * dependency.\n+ */\n+export function getDefaultImportDeclaration(expr: WrappedNodeExpr<unknown>): ts.ImportDeclaration|\n+    null {\n+  return (expr as WithDefaultImportDeclaration)[DefaultImportDeclaration] ?? null;\n }\n \n /**\n@@ -84,45 +65,28 @@ interface SourceFileWithImportDeclarationMapping extends ts.SourceFile {\n  * This problem does not exist for non-default imports as the compiler can easily insert\n  * \"import * as X\" style imports for those, and the \"X\" identifier survives transformation.\n  */\n-export class DefaultImportTracker implements DefaultImportRecorder {\n+export class DefaultImportTracker {\n   /**\n    * A `Map` which tracks the `Set` of `ts.ImportDeclaration`s for default imports that were used in\n    * a given `ts.SourceFile` and need to be preserved.\n    */\n   private sourceFileToUsedImports = new Map<ts.SourceFile, Set<ts.ImportDeclaration>>();\n-  recordImportedIdentifier(id: ts.Identifier, decl: ts.ImportDeclaration): void {\n-    const sf = getSourceFile(id) as SourceFileWithImportDeclarationMapping;\n-    if (sf[ImportDeclarationMapping] === undefined) {\n-      sf[ImportDeclarationMapping] = new Map<ts.Identifier, ts.ImportDeclaration>();\n-    }\n-    sf[ImportDeclarationMapping]!.set(id, decl);\n-  }\n \n-  recordUsedIdentifier(id: ts.Identifier): void {\n-    const sf = getSourceFile(id) as SourceFileWithImportDeclarationMapping;\n-    const identifierToDeclaration = sf[ImportDeclarationMapping];\n-    if (identifierToDeclaration === undefined) {\n-      // The identifier's source file has no registered default imports at all.\n-      return;\n-    }\n-    if (!identifierToDeclaration.has(id)) {\n-      // The identifier isn't from a registered default import.\n-      return;\n-    }\n-    const decl = identifierToDeclaration.get(id)!;\n+  recordUsedImport(importDecl: ts.ImportDeclaration): void {\n+    const sf = getSourceFile(importDecl);\n \n     // Add the default import declaration to the set of used import declarations for the file.\n     if (!this.sourceFileToUsedImports.has(sf)) {\n       this.sourceFileToUsedImports.set(sf, new Set<ts.ImportDeclaration>());\n     }\n-    this.sourceFileToUsedImports.get(sf)!.add(decl);\n+    this.sourceFileToUsedImports.get(sf)!.add(importDecl);\n   }\n \n   /**\n    * Get a `ts.TransformerFactory` which will preserve default imports that were previously marked\n    * as used.\n    *\n-   * This transformer must run after any other transformers which call `recordUsedIdentifier`.\n+   * This transformer must run after any other transformers which call `recordUsedImport`.\n    */\n   importPreservingTransformer(): ts.TransformerFactory<ts.SourceFile> {\n     return (context: ts.TransformationContext) => {"
        },
        {
            "sha": "307ecceda17d821d0780836a0399d55538af4957",
            "filename": "packages/compiler-cli/src/ngtsc/imports/test/default_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Ftest%2Fdefault_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Ftest%2Fdefault_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fimports%2Ftest%2Fdefault_spec.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -39,12 +39,10 @@ runInEachFileSystem(() => {\n             module: ts.ModuleKind.ES2015,\n           });\n       const fooClause = getDeclaration(program, _('/test.ts'), 'Foo', ts.isImportClause);\n-      const fooId = fooClause.name!;\n       const fooDecl = fooClause.parent;\n \n       const tracker = new DefaultImportTracker();\n-      tracker.recordImportedIdentifier(fooId, fooDecl);\n-      tracker.recordUsedIdentifier(fooId);\n+      tracker.recordUsedImport(fooDecl);\n       program.emit(undefined, undefined, undefined, undefined, {\n         before: [tracker.importPreservingTransformer()],\n       });\n@@ -73,8 +71,7 @@ runInEachFileSystem(() => {\n       const fooDecl = fooClause.parent;\n \n       const tracker = new DefaultImportTracker();\n-      tracker.recordImportedIdentifier(fooId, fooDecl);\n-      tracker.recordUsedIdentifier(fooId);\n+      tracker.recordUsedImport(fooDecl);\n       program.emit(undefined, undefined, undefined, undefined, {\n         before: [\n           addReferenceTransformer(fooId),"
        },
        {
            "sha": "7d29340e8ffadfd5f379a60c47260ee714c117cc",
            "filename": "packages/compiler-cli/src/ngtsc/transform/src/transform.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 15,
            "changes": 32,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Ftransform.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Ftransform.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftransform%2Fsrc%2Ftransform.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -9,10 +9,11 @@\n import {ConstantPool} from '@angular/compiler';\n import * as ts from 'typescript';\n \n-import {DefaultImportRecorder, ImportRewriter} from '../../imports';\n+import {DefaultImportTracker, ImportRewriter} from '../../imports';\n+import {getDefaultImportDeclaration} from '../../imports/src/default';\n import {PerfPhase, PerfRecorder} from '../../perf';\n import {Decorator, ReflectionHost} from '../../reflection';\n-import {ImportManager, RecordWrappedNodeExprFn, translateExpression, translateStatement, TranslatorOptions} from '../../translator';\n+import {ImportManager, RecordWrappedNodeFn, translateExpression, translateStatement, TranslatorOptions} from '../../translator';\n import {visit, VisitListEntryResult, Visitor} from '../../util/src/visitor';\n \n import {CompileResult} from './api';\n@@ -34,16 +35,16 @@ interface FileOverviewMeta {\n \n export function ivyTransformFactory(\n     compilation: TraitCompiler, reflector: ReflectionHost, importRewriter: ImportRewriter,\n-    defaultImportRecorder: DefaultImportRecorder, perf: PerfRecorder, isCore: boolean,\n+    defaultImportTracker: DefaultImportTracker, perf: PerfRecorder, isCore: boolean,\n     isClosureCompilerEnabled: boolean): ts.TransformerFactory<ts.SourceFile> {\n-  const recordWrappedNodeExpr = createRecorderFn(defaultImportRecorder);\n+  const recordWrappedNode = createRecorderFn(defaultImportTracker);\n   return (context: ts.TransformationContext): ts.Transformer<ts.SourceFile> => {\n     return (file: ts.SourceFile): ts.SourceFile => {\n       return perf.inPhase(\n           PerfPhase.Compile,\n           () => transformIvySourceFile(\n               compilation, context, reflector, importRewriter, file, isCore,\n-              isClosureCompilerEnabled, recordWrappedNodeExpr));\n+              isClosureCompilerEnabled, recordWrappedNode));\n     };\n   };\n }\n@@ -81,7 +82,7 @@ class IvyTransformationVisitor extends Visitor {\n       private compilation: TraitCompiler,\n       private classCompilationMap: Map<ts.ClassDeclaration, CompileResult[]>,\n       private reflector: ReflectionHost, private importManager: ImportManager,\n-      private recordWrappedNodeExpr: RecordWrappedNodeExprFn<ts.Expression>,\n+      private recordWrappedNodeExpr: RecordWrappedNodeFn<ts.Expression>,\n       private isClosureCompilerEnabled: boolean, private isCore: boolean) {\n     super();\n   }\n@@ -95,7 +96,7 @@ class IvyTransformationVisitor extends Visitor {\n     }\n \n     const translateOptions: TranslatorOptions<ts.Expression> = {\n-      recordWrappedNodeExpr: this.recordWrappedNodeExpr,\n+      recordWrappedNode: this.recordWrappedNodeExpr,\n       annotateForClosureCompiler: this.isClosureCompilerEnabled,\n     };\n \n@@ -252,7 +253,7 @@ function transformIvySourceFile(\n     compilation: TraitCompiler, context: ts.TransformationContext, reflector: ReflectionHost,\n     importRewriter: ImportRewriter, file: ts.SourceFile, isCore: boolean,\n     isClosureCompilerEnabled: boolean,\n-    recordWrappedNodeExpr: RecordWrappedNodeExprFn<ts.Expression>): ts.SourceFile {\n+    recordWrappedNode: RecordWrappedNodeFn<ts.Expression>): ts.SourceFile {\n   const constantPool = new ConstantPool(isClosureCompilerEnabled);\n   const importManager = new ImportManager(importRewriter);\n \n@@ -274,15 +275,15 @@ function transformIvySourceFile(\n   // results obtained at Step 1.\n   const transformationVisitor = new IvyTransformationVisitor(\n       compilation, compilationVisitor.classCompilationMap, reflector, importManager,\n-      recordWrappedNodeExpr, isClosureCompilerEnabled, isCore);\n+      recordWrappedNode, isClosureCompilerEnabled, isCore);\n   let sf = visit(file, transformationVisitor, context);\n \n   // Generate the constant statements first, as they may involve adding additional imports\n   // to the ImportManager.\n   const downlevelTranslatedCode = getLocalizeCompileTarget(context) < ts.ScriptTarget.ES2015;\n   const constants =\n       constantPool.statements.map(stmt => translateStatement(stmt, importManager, {\n-                                    recordWrappedNodeExpr,\n+                                    recordWrappedNode,\n                                     downlevelTaggedTemplates: downlevelTranslatedCode,\n                                     downlevelVariableDeclarations: downlevelTranslatedCode,\n                                     annotateForClosureCompiler: isClosureCompilerEnabled,\n@@ -370,11 +371,12 @@ function isFromAngularCore(decorator: Decorator): boolean {\n   return decorator.import !== null && decorator.import.from === '@angular/core';\n }\n \n-function createRecorderFn(defaultImportRecorder: DefaultImportRecorder):\n-    RecordWrappedNodeExprFn<ts.Expression> {\n-  return expr => {\n-    if (ts.isIdentifier(expr)) {\n-      defaultImportRecorder.recordUsedIdentifier(expr);\n+function createRecorderFn(defaultImportTracker: DefaultImportTracker):\n+    RecordWrappedNodeFn<ts.Expression> {\n+  return node => {\n+    const importDecl = getDefaultImportDeclaration(node);\n+    if (importDecl !== null) {\n+      defaultImportTracker.recordUsedImport(importDecl);\n     }\n   };\n }"
        },
        {
            "sha": "7fa09856f8f52199039e66c1a4e85f02b4cfac0b",
            "filename": "packages/compiler-cli/src/ngtsc/translator/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Findex.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -10,7 +10,7 @@ export {AstFactory, BinaryOperator, LeadingComment, ObjectLiteralProperty, Sourc\n export {ImportGenerator, NamedImport} from './src/api/import_generator';\n export {Context} from './src/context';\n export {Import, ImportManager} from './src/import_manager';\n-export {ExpressionTranslatorVisitor, RecordWrappedNodeExprFn, TranslatorOptions} from './src/translator';\n+export {ExpressionTranslatorVisitor, RecordWrappedNodeFn, TranslatorOptions} from './src/translator';\n export {translateType} from './src/type_translator';\n export {attachComments, createTemplateMiddle, createTemplateTail, TypeScriptAstFactory} from './src/typescript_ast_factory';\n export {translateExpression, translateStatement} from './src/typescript_translator';"
        },
        {
            "sha": "81a6377abfad64aaa5312e4bebf3633362ffbcd0",
            "filename": "packages/compiler-cli/src/ngtsc/translator/src/translator.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "raw_url": "https://github.com/angular/angular/raw/1381301afe861fdff0e69e595a68b6b50009678f/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftranslator%2Fsrc%2Ftranslator.ts?ref=1381301afe861fdff0e69e595a68b6b50009678f",
            "patch": "@@ -37,27 +37,27 @@ const BINARY_OPERATORS = new Map<o.BinaryOperator, BinaryOperator>([\n   [o.BinaryOperator.NullishCoalesce, '??'],\n ]);\n \n-export type RecordWrappedNodeExprFn<TExpression> = (expr: TExpression) => void;\n+export type RecordWrappedNodeFn<TExpression> = (node: o.WrappedNodeExpr<TExpression>) => void;\n \n export interface TranslatorOptions<TExpression> {\n   downlevelTaggedTemplates?: boolean;\n   downlevelVariableDeclarations?: boolean;\n-  recordWrappedNodeExpr?: RecordWrappedNodeExprFn<TExpression>;\n+  recordWrappedNode?: RecordWrappedNodeFn<TExpression>;\n   annotateForClosureCompiler?: boolean;\n }\n \n export class ExpressionTranslatorVisitor<TStatement, TExpression> implements o.ExpressionVisitor,\n                                                                              o.StatementVisitor {\n   private downlevelTaggedTemplates: boolean;\n   private downlevelVariableDeclarations: boolean;\n-  private recordWrappedNodeExpr: RecordWrappedNodeExprFn<TExpression>;\n+  private recordWrappedNode: RecordWrappedNodeFn<TExpression>;\n \n   constructor(\n       private factory: AstFactory<TStatement, TExpression>,\n       private imports: ImportGenerator<TExpression>, options: TranslatorOptions<TExpression>) {\n     this.downlevelTaggedTemplates = options.downlevelTaggedTemplates === true;\n     this.downlevelVariableDeclarations = options.downlevelVariableDeclarations === true;\n-    this.recordWrappedNodeExpr = options.recordWrappedNodeExpr || (() => {});\n+    this.recordWrappedNode = options.recordWrappedNode || (() => {});\n   }\n \n   visitDeclareVarStmt(stmt: o.DeclareVarStmt, context: Context): TStatement {\n@@ -382,7 +382,7 @@ export class ExpressionTranslatorVisitor<TStatement, TExpression> implements o.E\n   }\n \n   visitWrappedNodeExpr(ast: o.WrappedNodeExpr<any>, _context: Context): any {\n-    this.recordWrappedNodeExpr(ast.node);\n+    this.recordWrappedNode(ast);\n     return ast.node;\n   }\n "
        }
    ],
    "stats": {
        "total": 325,
        "additions": 126,
        "deletions": 199
    }
}