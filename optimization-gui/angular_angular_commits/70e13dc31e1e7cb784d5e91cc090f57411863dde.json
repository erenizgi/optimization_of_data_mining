{
    "author": "kyliau",
    "message": "fix(language-service): [Ivy] hybrid visitor should not locate let keyword (#39061)\n\nFixed a boolean logic error that prevented hybrid visitor from returning\nundefined when a variable does not have value and cursor is not in the\nkey span.\n\nPR Close #39061",
    "sha": "70e13dc31e1e7cb784d5e91cc090f57411863dde",
    "files": [
        {
            "sha": "c8e8c3a1520ce2d4eef65a04f84ed8a15a81da9a",
            "filename": "packages/language-service/ivy/hybrid_visitor.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/70e13dc31e1e7cb784d5e91cc090f57411863dde/packages%2Flanguage-service%2Fivy%2Fhybrid_visitor.ts",
            "raw_url": "https://github.com/angular/angular/raw/70e13dc31e1e7cb784d5e91cc090f57411863dde/packages%2Flanguage-service%2Fivy%2Fhybrid_visitor.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Fhybrid_visitor.ts?ref=70e13dc31e1e7cb784d5e91cc090f57411863dde",
            "patch": "@@ -27,9 +27,11 @@ export function findNodeAtPosition(ast: t.Node[], position: number): t.Node|e.AS\n   }\n   if (isTemplateNodeWithKeyAndValue(candidate)) {\n     const {keySpan, valueSpan} = candidate;\n-    // If cursor is within source span but not within key span or value span,\n-    // do not return the node.\n-    if (!isWithin(position, keySpan) && (valueSpan && !isWithin(position, valueSpan))) {\n+    const isWithinKeyValue =\n+        isWithin(position, keySpan) || (valueSpan && isWithin(position, valueSpan));\n+    if (!isWithinKeyValue) {\n+      // If cursor is within source span but not within key span or value span,\n+      // do not return the node.\n       return;\n     }\n   }"
        },
        {
            "sha": "556ac0a601ef3f3d21c3955863a086414beaac72",
            "filename": "packages/language-service/ivy/test/hybrid_visitor_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/70e13dc31e1e7cb784d5e91cc090f57411863dde/packages%2Flanguage-service%2Fivy%2Ftest%2Fhybrid_visitor_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/70e13dc31e1e7cb784d5e91cc090f57411863dde/packages%2Flanguage-service%2Fivy%2Ftest%2Fhybrid_visitor_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flanguage-service%2Fivy%2Ftest%2Fhybrid_visitor_spec.ts?ref=70e13dc31e1e7cb784d5e91cc090f57411863dde",
            "patch": "@@ -504,8 +504,7 @@ describe('findNodeAtPosition for microsyntax expression', () => {\n     const {errors, nodes, position} = parse(`<div *ngFor=\"lÂ¦et item of items\"></div>`);\n     expect(errors).toBe(null);\n     const node = findNodeAtPosition(nodes, position);\n-    // TODO: this is currently wrong because node is currently pointing to\n-    // \"item\". In this case, it should return undefined.\n+    expect(node).toBeUndefined();\n   });\n \n   it('should locate let variable', () => {"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 6,
        "deletions": 5
    }
}