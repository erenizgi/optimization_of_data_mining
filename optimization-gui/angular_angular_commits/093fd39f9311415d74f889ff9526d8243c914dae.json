{
    "author": "crisbeto",
    "message": "refactor(compiler): clean up workarounds for TypeScript 4.5 (#44477)\n\nCleans up some of the temporary workarounds that were necessary in order to land support for TypeScript 4.5 since they're no longer necessary.\n\nPR Close #44477",
    "sha": "093fd39f9311415d74f889ff9526d8243c914dae",
    "files": [
        {
            "sha": "b3df5e007bbf1de56bd365bb01f699ef19b1ff8d",
            "filename": "packages/compiler-cli/src/ngtsc/core/src/host.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fhost.ts",
            "raw_url": "https://github.com/angular/angular/raw/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fhost.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcore%2Fsrc%2Fhost.ts?ref=093fd39f9311415d74f889ff9526d8243c914dae",
            "patch": "@@ -67,10 +67,7 @@ export class DelegatingCompilerHost implements\n   trace = this.delegateMethod('trace');\n   useCaseSensitiveFileNames = this.delegateMethod('useCaseSensitiveFileNames');\n   writeFile = this.delegateMethod('writeFile');\n-\n-  // TODO(crisbeto): the cast to `any` is here since g3 is still on TS 4.4.\n-  // Should be cleaned up when g3 has been updated.\n-  getModuleResolutionCache = this.delegateMethod('getModuleResolutionCache' as any);\n+  getModuleResolutionCache = this.delegateMethod('getModuleResolutionCache');\n }\n \n /**"
        },
        {
            "sha": "67d79c4a276c93eecab099735f3f1a2b89ca82d7",
            "filename": "packages/compiler-cli/src/ngtsc/cycles/src/imports.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcycles%2Fsrc%2Fimports.ts",
            "raw_url": "https://github.com/angular/angular/raw/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcycles%2Fsrc%2Fimports.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fcycles%2Fsrc%2Fimports.ts?ref=093fd39f9311415d74f889ff9526d8243c914dae",
            "patch": "@@ -126,9 +126,7 @@ function isTypeOnlyImportClause(node: ts.ImportClause): boolean {\n \n   // All the specifiers in the cause are type-only (e.g. `import {type a, type b} from '...'`).\n   if (node.namedBindings !== undefined && ts.isNamedImports(node.namedBindings) &&\n-      // TODO(crisbeto): the cast to `any` is here since g3 is still on TS 4.4.\n-      // Should be cleaned up when g3 has been updated.\n-      node.namedBindings.elements.every(specifier => (specifier as any).isTypeOnly)) {\n+      node.namedBindings.elements.every(specifier => specifier.isTypeOnly)) {\n     return true;\n   }\n "
        },
        {
            "sha": "dfc87fa49caece3d16a0bd44bf00de9aa56bf6c1",
            "filename": "packages/compiler-cli/src/ngtsc/program_driver/src/ts_create_program_driver.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fprogram_driver%2Fsrc%2Fts_create_program_driver.ts",
            "raw_url": "https://github.com/angular/angular/raw/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fprogram_driver%2Fsrc%2Fts_create_program_driver.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fprogram_driver%2Fsrc%2Fts_create_program_driver.ts?ref=093fd39f9311415d74f889ff9526d8243c914dae",
            "patch": "@@ -51,10 +51,7 @@ export class DelegatingCompilerHost implements\n   resolveTypeReferenceDirectives = this.delegateMethod('resolveTypeReferenceDirectives');\n   trace = this.delegateMethod('trace');\n   useCaseSensitiveFileNames = this.delegateMethod('useCaseSensitiveFileNames');\n-\n-  // TODO(crisbeto): the cast to `any` is here since g3 is still on TS 4.4.\n-  // Should be cleaned up when g3 has been updated.\n-  getModuleResolutionCache = this.delegateMethod('getModuleResolutionCache' as any);\n+  getModuleResolutionCache = this.delegateMethod('getModuleResolutionCache');\n }\n \n /**"
        },
        {
            "sha": "4e230352bbd48fa39ddb768bd1ba78b082f93358",
            "filename": "packages/compiler-cli/src/ngtsc/reflection/src/type_to_value.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Ftype_to_value.ts",
            "raw_url": "https://github.com/angular/angular/raw/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Ftype_to_value.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Freflection%2Fsrc%2Ftype_to_value.ts?ref=093fd39f9311415d74f889ff9526d8243c914dae",
            "patch": "@@ -72,9 +72,7 @@ export function typeToValue(\n       // or\n       //   import {Foo as Bar} from 'foo';\n \n-      // TODO(crisbeto): the cast to `any` is here since g3 is still on TS 4.4.\n-      // Should be cleaned up when g3 has been updated.\n-      if ((firstDecl as any).isTypeOnly) {\n+      if (firstDecl.isTypeOnly) {\n         // The import specifier can't be type-only (e.g. `import {type Foo} from '...')`.\n         return typeOnlyImport(typeNode, firstDecl);\n       }"
        },
        {
            "sha": "c3013c325b8b7673da655539c6cbd57c3e906d7d",
            "filename": "packages/compiler-cli/src/ngtsc/resource/src/loader.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fresource%2Fsrc%2Floader.ts",
            "raw_url": "https://github.com/angular/angular/raw/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fresource%2Fsrc%2Floader.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fresource%2Fsrc%2Floader.ts?ref=093fd39f9311415d74f889ff9526d8243c914dae",
            "patch": "@@ -237,8 +237,6 @@ export class AdapterResourceLoader implements ResourceLoader {\n  */\n function createLookupResolutionHost(adapter: NgCompilerAdapter):\n     RequiredDelegations<ts.ModuleResolutionHost> {\n-  // TODO(crisbeto): the cast to `any` is here since g3 is still on TS 4.4.\n-  // Should be cleaned up when g3 has been updated.\n   return {\n     directoryExists(directoryName: string): boolean {\n       if (directoryName.includes(RESOURCE_MARKER)) {\n@@ -263,8 +261,8 @@ function createLookupResolutionHost(adapter: NgCompilerAdapter):\n     getDirectories: adapter.getDirectories?.bind(adapter),\n     realpath: adapter.realpath?.bind(adapter),\n     trace: adapter.trace?.bind(adapter),\n-    useCaseSensitiveFileNames: typeof (adapter as any).useCaseSensitiveFileNames === 'function' ?\n-        (adapter as any).useCaseSensitiveFileNames.bind(adapter) :\n-        (adapter as any).useCaseSensitiveFileNames\n-  } as any;\n+    useCaseSensitiveFileNames: typeof adapter.useCaseSensitiveFileNames === 'function' ?\n+        adapter.useCaseSensitiveFileNames.bind(adapter) :\n+        adapter.useCaseSensitiveFileNames\n+  };\n }"
        },
        {
            "sha": "37f39b3258f624b22dd18fc3ff3a3fa24af03a9f",
            "filename": "packages/compiler-cli/src/ngtsc/shims/src/factory_generator.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fshims%2Fsrc%2Ffactory_generator.ts",
            "raw_url": "https://github.com/angular/angular/raw/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fshims%2Fsrc%2Ffactory_generator.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fshims%2Fsrc%2Ffactory_generator.ts?ref=093fd39f9311415d74f889ff9526d8243c914dae",
            "patch": "@@ -159,9 +159,7 @@ function transformFactorySourceFile(\n       const rewrittenModuleSpecifier =\n           importRewriter.rewriteSpecifier('@angular/core', sourceFilePath);\n       if (rewrittenModuleSpecifier !== stmt.moduleSpecifier.text) {\n-        // TODO(crisbeto): the cast to `any` is here since g3 is still on TS 4.4.\n-        // Should be cleaned up when g3 has been updated.\n-        transformedStatements.push((ts.updateImportDeclaration as any)(\n+        transformedStatements.push(ts.updateImportDeclaration(\n             stmt, stmt.decorators, stmt.modifiers, stmt.importClause,\n             ts.createStringLiteral(rewrittenModuleSpecifier), undefined));\n "
        },
        {
            "sha": "7a9c0322d1f3ebeb7a6db3d4dc32fb8d5b394df1",
            "filename": "packages/compiler-cli/src/ngtsc/util/src/typescript.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 24,
            "changes": 28,
            "blob_url": "https://github.com/angular/angular/blob/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts",
            "raw_url": "https://github.com/angular/angular/raw/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Futil%2Fsrc%2Ftypescript.ts?ref=093fd39f9311415d74f889ff9526d8243c914dae",
            "patch": "@@ -213,28 +213,8 @@ export function toUnredirectedSourceFile(sf: ts.SourceFile): ts.SourceFile {\n export function createExportSpecifier(\n     propertyName: string|ts.Identifier|undefined, name: string|ts.Identifier,\n     isTypeOnly = false): ts.ExportSpecifier {\n-  return PARSED_TS_VERSION > 4.4 ?\n-      // TODO(crisbeto): the function is cast to `any` here since g3 is still on TS 4.4.\n-      // Should be cleaned up when g3 has been updated.\n-      (ts.createExportSpecifier as any)(isTypeOnly, propertyName, name) :\n-      // TODO(crisbeto): backwards-compatibility layer for TS 4.4.\n-      // Should be cleaned up when we drop support for it.\n-      (ts.createExportSpecifier as any)(propertyName, name);\n-}\n-\n-\n-/**\n- * Backwards-compatible version of `ts.createImportSpecifier`\n- * to handle a breaking change between 4.4 and 4.5.\n- */\n-export function createImportSpecifier(\n-    propertyName: string|ts.Identifier|undefined, name: string|ts.Identifier,\n-    isTypeOnly = false): ts.ImportSpecifier {\n-  return PARSED_TS_VERSION > 4.4 ?\n-      // TODO(crisbeto): the function is cast to `any` here since g3 is still on TS 4.4.\n-      // Should be cleaned up when g3 has been updated.\n-      (ts.createImportSpecifier as any)(isTypeOnly, propertyName, name) :\n-      // TODO(crisbeto): backwards-compatibility layer for TS 4.4.\n-      // Should be cleaned up when we drop support for it.\n-      (ts.createImportSpecifier as any)(propertyName, name);\n+  return PARSED_TS_VERSION > 4.4 ? ts.createExportSpecifier(isTypeOnly, propertyName, name) :\n+                                   // TODO(crisbeto): backwards-compatibility layer for TS 4.4.\n+                                   // Should be cleaned up when we drop support for it.\n+                                   (ts.createExportSpecifier as any)(propertyName, name);\n }"
        },
        {
            "sha": "ce076082197180fb92fe7d10d83e67ec91a7c122",
            "filename": "packages/core/schematics/utils/import_manager.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 9,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcore%2Fschematics%2Futils%2Fimport_manager.ts",
            "raw_url": "https://github.com/angular/angular/raw/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcore%2Fschematics%2Futils%2Fimport_manager.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Futils%2Fimport_manager.ts?ref=093fd39f9311415d74f889ff9526d8243c914dae",
            "patch": "@@ -265,14 +265,11 @@ export class ImportManager {\n  * Backwards-compatible version of `ts.createImportSpecifier`\n  * to handle a breaking change between 4.4 and 4.5.\n  */\n-export function createImportSpecifier(\n-    propertyName: string|ts.Identifier|undefined, name: string|ts.Identifier,\n+function createImportSpecifier(\n+    propertyName: ts.Identifier|undefined, name: ts.Identifier,\n     isTypeOnly = false): ts.ImportSpecifier {\n-  return PARSED_TS_VERSION > 4.4 ?\n-      // TODO(crisbeto): the function is cast to `any` here since g3 is still on TS 4.4.\n-      // Should be cleaned up when g3 has been updated.\n-      (ts.createImportSpecifier as any)(isTypeOnly, propertyName, name) :\n-      // TODO(crisbeto): backwards-compatibility layer for TS 4.4.\n-      // Should be cleaned up when we drop support for it.\n-      (ts.createImportSpecifier as any)(propertyName, name);\n+  return PARSED_TS_VERSION > 4.4 ? ts.createImportSpecifier(isTypeOnly, propertyName, name) :\n+                                   // TODO(crisbeto): backwards-compatibility layer for TS 4.4.\n+                                   // Should be cleaned up when we drop support for it.\n+                                   (ts.createImportSpecifier as any)(propertyName, name);\n }"
        },
        {
            "sha": "f8760b3e527810ac5014cadf6b9e3cc33df25c7e",
            "filename": "packages/core/schematics/utils/typescript/imports.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/angular/angular/blob/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcore%2Fschematics%2Futils%2Ftypescript%2Fimports.ts",
            "raw_url": "https://github.com/angular/angular/raw/093fd39f9311415d74f889ff9526d8243c914dae/packages%2Fcore%2Fschematics%2Futils%2Ftypescript%2Fimports.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Futils%2Ftypescript%2Fimports.ts?ref=093fd39f9311415d74f889ff9526d8243c914dae",
            "patch": "@@ -108,13 +108,10 @@ export function replaceImport(\n   return ts.updateNamedImports(node, [\n     ...node.elements.filter(current => current !== existingImportNode),\n     // Create a new import while trying to preserve the alias of the old one.\n-    PARSED_TS_VERSION > 4.4 ?\n-        // TODO(crisbeto): the function is cast to `any` here since g3 is still on TS 4.4.\n-        // Should be cleaned up when g3 has been updated.\n-        (ts.createImportSpecifier as any)(false, importPropertyName, importName) :\n-        // TODO(crisbeto): backwards-compatibility layer for TS 4.4.\n-        // Should be cleaned up when we drop support for it.\n-        (ts.createImportSpecifier as any)(importPropertyName, importName)\n+    PARSED_TS_VERSION > 4.4 ? ts.createImportSpecifier(false, importPropertyName, importName) :\n+                              // TODO(crisbeto): backwards-compatibility layer for TS 4.4.\n+                              // Should be cleaned up when we drop support for it.\n+                              (ts.createImportSpecifier as any)(importPropertyName, importName)\n   ]);\n }\n "
        }
    ],
    "stats": {
        "total": 86,
        "additions": 23,
        "deletions": 63
    }
}