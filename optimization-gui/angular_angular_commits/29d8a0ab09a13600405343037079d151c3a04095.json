{
    "author": "crisbeto",
    "message": "feat(animations): add support for disabling animations through BrowserAnimationsModule.withConfig (#40731)\n\nCurrently the only way to disable animations is by providing the `NoopAnimationsModule`\nwhich doesn't allow for it to be disabled based on runtime information. These changes\nadd support for disabling animations based on runtime information by using\n`BrowserAnimationsModule.withConfig({disableAnimations: true})`.\n\nPR Close #40731",
    "sha": "29d8a0ab09a13600405343037079d151c3a04095",
    "files": [
        {
            "sha": "e9e74509919375acbfcd6c87d2e3d859c910a25f",
            "filename": "goldens/public-api/platform-browser/animations/animations.d.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/29d8a0ab09a13600405343037079d151c3a04095/goldens%2Fpublic-api%2Fplatform-browser%2Fanimations%2Fanimations.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/29d8a0ab09a13600405343037079d151c3a04095/goldens%2Fpublic-api%2Fplatform-browser%2Fanimations%2Fanimations.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fpublic-api%2Fplatform-browser%2Fanimations%2Fanimations.d.ts?ref=29d8a0ab09a13600405343037079d151c3a04095",
            "patch": "@@ -1,6 +1,11 @@\n export declare const ANIMATION_MODULE_TYPE: InjectionToken<\"NoopAnimations\" | \"BrowserAnimations\">;\n \n export declare class BrowserAnimationsModule {\n+    static withConfig(config: BrowserAnimationsModuleConfig): ModuleWithProviders<BrowserAnimationsModule>;\n+}\n+\n+export declare interface BrowserAnimationsModuleConfig {\n+    disableAnimations?: boolean;\n }\n \n export declare class NoopAnimationsModule {"
        },
        {
            "sha": "cc1710aea66c837a84819ba1a52cb84577521ca3",
            "filename": "goldens/size-tracking/aio-payloads.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/29d8a0ab09a13600405343037079d151c3a04095/goldens%2Fsize-tracking%2Faio-payloads.json",
            "raw_url": "https://github.com/angular/angular/raw/29d8a0ab09a13600405343037079d151c3a04095/goldens%2Fsize-tracking%2Faio-payloads.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/goldens%2Fsize-tracking%2Faio-payloads.json?ref=29d8a0ab09a13600405343037079d151c3a04095",
            "patch": "@@ -12,7 +12,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 3033,\n-        \"main-es2015\": 447894,\n+        \"main-es2015\": 448055,\n         \"polyfills-es2015\": 52493\n       }\n     }\n@@ -21,7 +21,7 @@\n     \"master\": {\n       \"uncompressed\": {\n         \"runtime-es2015\": 3153,\n-        \"main-es2015\": 432647,\n+        \"main-es2015\": 433285,\n         \"polyfills-es2015\": 52493\n       }\n     }"
        },
        {
            "sha": "99338410d525a89fd34a2f3c58c0809e357c994f",
            "filename": "packages/core/test/animation/animation_integration_spec.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 4,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/29d8a0ab09a13600405343037079d151c3a04095/packages%2Fcore%2Ftest%2Fanimation%2Fanimation_integration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/29d8a0ab09a13600405343037079d151c3a04095/packages%2Fcore%2Ftest%2Fanimation%2Fanimation_integration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fanimation%2Fanimation_integration_spec.ts?ref=29d8a0ab09a13600405343037079d151c3a04095",
            "patch": "@@ -46,8 +46,7 @@ describe('animation tests', function() {\n           {declarations: [SharedAnimationCmp], imports: [BrowserAnimationsModule]});\n \n       const fixture = TestBed.createComponent(SharedAnimationCmp);\n-      const cmp = fixture.componentInstance;\n-      expect(cmp.animationType).toEqual('BrowserAnimations');\n+      expect(fixture.componentInstance.animationType).toEqual('BrowserAnimations');\n     });\n \n     it('should hint at NoopAnimationsModule being used', () => {\n@@ -56,9 +55,20 @@ describe('animation tests', function() {\n           {declarations: [SharedAnimationCmp], imports: [NoopAnimationsModule]});\n \n       const fixture = TestBed.createComponent(SharedAnimationCmp);\n-      const cmp = fixture.componentInstance;\n-      expect(cmp.animationType).toEqual('NoopAnimations');\n+      expect(fixture.componentInstance.animationType).toEqual('NoopAnimations');\n     });\n+\n+    it('should hint at NoopAnimationsModule being used when BrowserAnimationsModule is provided with disabled animations',\n+       () => {\n+         TestBed.resetTestingModule();\n+         TestBed.configureTestingModule({\n+           declarations: [SharedAnimationCmp],\n+           imports: [BrowserAnimationsModule.withConfig({disableAnimations: true})]\n+         });\n+\n+         const fixture = TestBed.createComponent(SharedAnimationCmp);\n+         expect(fixture.componentInstance.animationType).toEqual('NoopAnimations');\n+       });\n   });\n \n   @Component({template: '<p>template text</p>'})"
        },
        {
            "sha": "96b42f8ccdd072edac0b35a1838dba2e27cdcf13",
            "filename": "packages/platform-browser/animations/src/animations.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/29d8a0ab09a13600405343037079d151c3a04095/packages%2Fplatform-browser%2Fanimations%2Fsrc%2Fanimations.ts",
            "raw_url": "https://github.com/angular/angular/raw/29d8a0ab09a13600405343037079d151c3a04095/packages%2Fplatform-browser%2Fanimations%2Fsrc%2Fanimations.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Fanimations%2Fsrc%2Fanimations.ts?ref=29d8a0ab09a13600405343037079d151c3a04095",
            "patch": "@@ -11,7 +11,7 @@\n  * @description\n  * Entry point for all animation APIs of the animation browser package.\n  */\n-export {BrowserAnimationsModule, NoopAnimationsModule} from './module';\n+export {BrowserAnimationsModule, BrowserAnimationsModuleConfig, NoopAnimationsModule} from './module';\n \n export {ANIMATION_MODULE_TYPE} from './providers';\n "
        },
        {
            "sha": "bd854c35b4d5ea6a40cd46cff5e75d2e4c365a50",
            "filename": "packages/platform-browser/animations/src/module.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 1,
            "changes": 38,
            "blob_url": "https://github.com/angular/angular/blob/29d8a0ab09a13600405343037079d151c3a04095/packages%2Fplatform-browser%2Fanimations%2Fsrc%2Fmodule.ts",
            "raw_url": "https://github.com/angular/angular/raw/29d8a0ab09a13600405343037079d151c3a04095/packages%2Fplatform-browser%2Fanimations%2Fsrc%2Fmodule.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Fanimations%2Fsrc%2Fmodule.ts?ref=29d8a0ab09a13600405343037079d151c3a04095",
            "patch": "@@ -5,11 +5,23 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {NgModule} from '@angular/core';\n+import {ModuleWithProviders, NgModule} from '@angular/core';\n import {BrowserModule} from '@angular/platform-browser';\n \n import {BROWSER_ANIMATIONS_PROVIDERS, BROWSER_NOOP_ANIMATIONS_PROVIDERS} from './providers';\n \n+/**\n+ * Object used to configure the behavior of {@link BrowserAnimationsModule}\n+ * @publicApi\n+ */\n+export interface BrowserAnimationsModuleConfig {\n+  /**\n+   *  Whether animations should be disabled. Passing this is identical to providing the\n+   * `NoopAnimationsModule`, but it can be controlled based on a runtime value.\n+   */\n+  disableAnimations?: boolean;\n+}\n+\n /**\n  * Exports `BrowserModule` with additional [dependency-injection providers](guide/glossary#provider)\n  * for use with animations. See [Animations](guide/animations).\n@@ -20,6 +32,30 @@ import {BROWSER_ANIMATIONS_PROVIDERS, BROWSER_NOOP_ANIMATIONS_PROVIDERS} from '.\n   providers: BROWSER_ANIMATIONS_PROVIDERS,\n })\n export class BrowserAnimationsModule {\n+  /**\n+   * Configures the module based on the specified object.\n+   *\n+   * @param config Object used to configure the behavior of the `BrowserAnimationsModule`.\n+   * @see `BrowserAnimationsModuleConfig`\n+   *\n+   * @usageNotes\n+   * When registering the `BrowserAnimationsModule`, you can use the `withConfig`\n+   * function as follows:\n+   * ```\n+   * @NgModule({\n+   *   imports: [BrowserAnimationsModule.withConfig(config)]\n+   * })\n+   * class MyNgModule {}\n+   * ```\n+   */\n+  static withConfig(config: BrowserAnimationsModuleConfig):\n+      ModuleWithProviders<BrowserAnimationsModule> {\n+    return {\n+      ngModule: BrowserAnimationsModule,\n+      providers: config.disableAnimations ? BROWSER_NOOP_ANIMATIONS_PROVIDERS :\n+                                            BROWSER_ANIMATIONS_PROVIDERS\n+    };\n+  }\n }\n \n /**"
        },
        {
            "sha": "6c18d9bf519141de67cf91774f47c361bce080db",
            "filename": "packages/platform-browser/animations/test/noop_animations_module_spec.ts",
            "status": "modified",
            "additions": 103,
            "deletions": 79,
            "changes": 182,
            "blob_url": "https://github.com/angular/angular/blob/29d8a0ab09a13600405343037079d151c3a04095/packages%2Fplatform-browser%2Fanimations%2Ftest%2Fnoop_animations_module_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/29d8a0ab09a13600405343037079d151c3a04095/packages%2Fplatform-browser%2Fanimations%2Ftest%2Fnoop_animations_module_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fplatform-browser%2Fanimations%2Ftest%2Fnoop_animations_module_spec.ts?ref=29d8a0ab09a13600405343037079d151c3a04095",
            "patch": "@@ -9,97 +9,121 @@ import {animate, style, transition, trigger} from '@angular/animations';\n import {ɵAnimationEngine} from '@angular/animations/browser';\n import {Component} from '@angular/core';\n import {TestBed} from '@angular/core/testing';\n-import {NoopAnimationsModule} from '@angular/platform-browser/animations';\n+import {BrowserAnimationsModule, NoopAnimationsModule} from '@angular/platform-browser/animations';\n \n-{\n-  describe('NoopAnimationsModule', () => {\n-    beforeEach(() => {\n-      TestBed.configureTestingModule({imports: [NoopAnimationsModule]});\n-    });\n+describe('NoopAnimationsModule', () => {\n+  beforeEach(() => {\n+    TestBed.configureTestingModule({imports: [NoopAnimationsModule]});\n+  });\n+\n+  noopAnimationTests();\n+});\n+\n+describe('BrowserAnimationsModule with disableAnimations = true', () => {\n+  beforeEach(() => {\n+    TestBed.configureTestingModule(\n+        {imports: [BrowserAnimationsModule.withConfig({disableAnimations: true})]});\n+  });\n+\n+  noopAnimationTests();\n+});\n+\n+\n+function noopAnimationTests() {\n+  it('should flush and fire callbacks when the zone becomes stable', (async) => {\n+    // This test is only meant to be run inside the browser.\n+    if (isNode) {\n+      async();\n+      return;\n+    }\n \n-    it('should flush and fire callbacks when the zone becomes stable', (async) => {\n-      @Component({\n-        selector: 'my-cmp',\n-        template:\n-            '<div [@myAnimation]=\"exp\" (@myAnimation.start)=\"onStart($event)\" (@myAnimation.done)=\"onDone($event)\"></div>',\n-        animations: [trigger(\n-            'myAnimation',\n-            [transition(\n-                '* => state', [style({'opacity': '0'}), animate(500, style({'opacity': '1'}))])])],\n-      })\n-      class Cmp {\n-        exp: any;\n-        startEvent: any;\n-        doneEvent: any;\n-        onStart(event: any) {\n-          this.startEvent = event;\n-        }\n-        onDone(event: any) {\n-          this.doneEvent = event;\n-        }\n+    @Component({\n+      selector: 'my-cmp',\n+      template:\n+          '<div [@myAnimation]=\"exp\" (@myAnimation.start)=\"onStart($event)\" (@myAnimation.done)=\"onDone($event)\"></div>',\n+      animations: [trigger(\n+          'myAnimation',\n+          [transition(\n+              '* => state', [style({'opacity': '0'}), animate(500, style({'opacity': '1'}))])])],\n+    })\n+    class Cmp {\n+      exp: any;\n+      startEvent: any;\n+      doneEvent: any;\n+      onStart(event: any) {\n+        this.startEvent = event;\n       }\n+      onDone(event: any) {\n+        this.doneEvent = event;\n+      }\n+    }\n \n-      TestBed.configureTestingModule({declarations: [Cmp]});\n+    TestBed.configureTestingModule({declarations: [Cmp]});\n \n-      const fixture = TestBed.createComponent(Cmp);\n-      const cmp = fixture.componentInstance;\n-      cmp.exp = 'state';\n-      fixture.detectChanges();\n-      fixture.whenStable().then(() => {\n-        expect(cmp.startEvent.triggerName).toEqual('myAnimation');\n-        expect(cmp.startEvent.phaseName).toEqual('start');\n-        expect(cmp.doneEvent.triggerName).toEqual('myAnimation');\n-        expect(cmp.doneEvent.phaseName).toEqual('done');\n-        async();\n-      });\n+    const fixture = TestBed.createComponent(Cmp);\n+    const cmp = fixture.componentInstance;\n+    cmp.exp = 'state';\n+    fixture.detectChanges();\n+    fixture.whenStable().then(() => {\n+      expect(cmp.startEvent.triggerName).toEqual('myAnimation');\n+      expect(cmp.startEvent.phaseName).toEqual('start');\n+      expect(cmp.doneEvent.triggerName).toEqual('myAnimation');\n+      expect(cmp.doneEvent.phaseName).toEqual('done');\n+      async();\n     });\n+  });\n \n-    it('should handle leave animation callbacks even if the element is destroyed in the process',\n-       (async) => {\n-         @Component({\n-           selector: 'my-cmp',\n-           template:\n-               '<div *ngIf=\"exp\" @myAnimation (@myAnimation.start)=\"onStart($event)\" (@myAnimation.done)=\"onDone($event)\"></div>',\n-           animations: [trigger(\n-               'myAnimation',\n-               [transition(\n-                   ':leave', [style({'opacity': '0'}), animate(500, style({'opacity': '1'}))])])],\n-         })\n-         class Cmp {\n-           exp: any;\n-           startEvent: any;\n-           doneEvent: any;\n-           onStart(event: any) {\n-             this.startEvent = event;\n-           }\n-           onDone(event: any) {\n-             this.doneEvent = event;\n-           }\n+  it('should handle leave animation callbacks even if the element is destroyed in the process',\n+     (async) => {\n+       // This test is only meant to be run inside the browser.\n+       if (isNode) {\n+         async();\n+         return;\n+       }\n+\n+       @Component({\n+         selector: 'my-cmp',\n+         template:\n+             '<div *ngIf=\"exp\" @myAnimation (@myAnimation.start)=\"onStart($event)\" (@myAnimation.done)=\"onDone($event)\"></div>',\n+         animations: [trigger(\n+             'myAnimation',\n+             [transition(\n+                 ':leave', [style({'opacity': '0'}), animate(500, style({'opacity': '1'}))])])],\n+       })\n+       class Cmp {\n+         exp: any;\n+         startEvent: any;\n+         doneEvent: any;\n+         onStart(event: any) {\n+           this.startEvent = event;\n+         }\n+         onDone(event: any) {\n+           this.doneEvent = event;\n          }\n+       }\n \n-         TestBed.configureTestingModule({declarations: [Cmp]});\n-         const engine = TestBed.inject(ɵAnimationEngine);\n-         const fixture = TestBed.createComponent(Cmp);\n-         const cmp = fixture.componentInstance;\n+       TestBed.configureTestingModule({declarations: [Cmp]});\n+       const engine = TestBed.inject(ɵAnimationEngine);\n+       const fixture = TestBed.createComponent(Cmp);\n+       const cmp = fixture.componentInstance;\n \n-         cmp.exp = true;\n+       cmp.exp = true;\n+       fixture.detectChanges();\n+       fixture.whenStable().then(() => {\n+         cmp.startEvent = null;\n+         cmp.doneEvent = null;\n+\n+         cmp.exp = false;\n          fixture.detectChanges();\n          fixture.whenStable().then(() => {\n-           cmp.startEvent = null;\n-           cmp.doneEvent = null;\n-\n-           cmp.exp = false;\n-           fixture.detectChanges();\n-           fixture.whenStable().then(() => {\n-             expect(cmp.startEvent.triggerName).toEqual('myAnimation');\n-             expect(cmp.startEvent.phaseName).toEqual('start');\n-             expect(cmp.startEvent.toState).toEqual('void');\n-             expect(cmp.doneEvent.triggerName).toEqual('myAnimation');\n-             expect(cmp.doneEvent.phaseName).toEqual('done');\n-             expect(cmp.doneEvent.toState).toEqual('void');\n-             async();\n-           });\n+           expect(cmp.startEvent.triggerName).toEqual('myAnimation');\n+           expect(cmp.startEvent.phaseName).toEqual('start');\n+           expect(cmp.startEvent.toState).toEqual('void');\n+           expect(cmp.doneEvent.triggerName).toEqual('myAnimation');\n+           expect(cmp.doneEvent.phaseName).toEqual('done');\n+           expect(cmp.doneEvent.toState).toEqual('void');\n+           async();\n          });\n        });\n-  });\n+     });\n }"
        }
    ],
    "stats": {
        "total": 249,
        "additions": 162,
        "deletions": 87
    }
}