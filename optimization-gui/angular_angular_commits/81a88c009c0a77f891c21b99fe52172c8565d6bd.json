{
    "author": "josephperrott",
    "message": "fix(dev-infra): use all non-header content for checking commit body length (#41367)\n\nAs discovered in #41316, commit body length checks should consider all of the non-header\ncontent as the commit body rather than the conventional-commit-parser's current method\nof considering everything after an issue/PR reference to be the footer.\n\nPR Close #41367",
    "sha": "81a88c009c0a77f891c21b99fe52172c8565d6bd",
    "files": [
        {
            "sha": "98b877b212c76c52a8130a78da7bc1802ef1f425",
            "filename": "dev-infra/commit-message/validate.spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/81a88c009c0a77f891c21b99fe52172c8565d6bd/dev-infra%2Fcommit-message%2Fvalidate.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/81a88c009c0a77f891c21b99fe52172c8565d6bd/dev-infra%2Fcommit-message%2Fvalidate.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate.spec.ts?ref=81a88c009c0a77f891c21b99fe52172c8565d6bd",
            "patch": "@@ -253,6 +253,14 @@ describe('validate-commit-message.js', () => {\n         ]);\n       });\n \n+      it('should pass validation even if the total non-header content is longer than `minBodyLength`, even if the body contains a `#` reference usage',\n+         () => {\n+           expectValidationResult(\n+               validateCommitMessage(\n+                   'fix(core): something\\n\\n Explanation of how #123 motivated this change'),\n+               VALID);\n+         });\n+\n       it('should pass validation if the body is shorter than `minBodyLength` but the commit type is in the `minBodyLengthTypeExclusions` list',\n          () => {\n            expectValidationResult(validateCommitMessage('docs: just fixing a typo'), VALID);"
        },
        {
            "sha": "7f41c10c4ba0f988353eb44b2b6832cca9af6298",
            "filename": "dev-infra/commit-message/validate.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/81a88c009c0a77f891c21b99fe52172c8565d6bd/dev-infra%2Fcommit-message%2Fvalidate.ts",
            "raw_url": "https://github.com/angular/angular/raw/81a88c009c0a77f891c21b99fe52172c8565d6bd/dev-infra%2Fcommit-message%2Fvalidate.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fcommit-message%2Fvalidate.ts?ref=81a88c009c0a77f891c21b99fe52172c8565d6bd",
            "patch": "@@ -131,8 +131,14 @@ export function validateCommitMessage(\n     // Checking commit body //\n     //////////////////////////\n \n+    // Due to an issue in which conventional-commits-parser considers all parts of a commit after\n+    // a `#` reference to be the footer, we check the length of all of the commit content after the\n+    // header. In the future, we expect to be able to check only the body once the parser properly\n+    // handles this case.\n+    const allNonHeaderContent = `${commit.body.trim()}\\n${commit.footer.trim()}`;\n+\n     if (!config.minBodyLengthTypeExcludes?.includes(commit.type) &&\n-        commit.body.trim().length < config.minBodyLength) {\n+        allNonHeaderContent.length < config.minBodyLength) {\n       errors.push(`The commit message body does not meet the minimum length of ${\n           config.minBodyLength} characters`);\n       return false;"
        },
        {
            "sha": "79b4543d7d84c81c78498636a1777e98f0872e62",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/81a88c009c0a77f891c21b99fe52172c8565d6bd/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/81a88c009c0a77f891c21b99fe52172c8565d6bd/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=81a88c009c0a77f891c21b99fe52172c8565d6bd",
            "patch": "@@ -1881,8 +1881,13 @@ function validateCommitMessage(commitMsg, options = {}) {\n         //////////////////////////\n         // Checking commit body //\n         //////////////////////////\n+        // Due to an issue in which conventional-commits-parser considers all parts of a commit after\n+        // a `#` reference to be the footer, we check the length of all of the commit content after the\n+        // header. In the future, we expect to be able to check only the body once the parser properly\n+        // handles this case.\n+        const allNonHeaderContent = `${commit.body.trim()}\\n${commit.footer.trim()}`;\n         if (!((_a = config.minBodyLengthTypeExcludes) === null || _a === void 0 ? void 0 : _a.includes(commit.type)) &&\n-            commit.body.trim().length < config.minBodyLength) {\n+            allNonHeaderContent.length < config.minBodyLength) {\n             errors.push(`The commit message body does not meet the minimum length of ${config.minBodyLength} characters`);\n             return false;\n         }"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 21,
        "deletions": 2
    }
}