{
    "author": "gkalpak",
    "message": "fix(service-worker): ensure SW stays alive while notifying clients about unrecoverable state (#40234)\n\nPreviously, the `Driver#notifyClientsAboutUnrecoverableState()` method\nwould not wait for the completion of the promises created to notify the\nclients. Theoretically, this could result in the SW instance's getting\ndestroyed by the browser before all clients have been notified. This is\nextremely unlikely to happen in practice, since the async operations are\nvery quick, but it _is_ theoretically possible.\n\nThis commit ensures that the SW instance will remain alive while\nnotifying the clients by making `notifyClientsAboutUnrecoverableState()`\nawait the notification promises.\n\nPR Close #40234",
    "sha": "ad3329a78b48a485c8597bc332b55584600adfcf",
    "files": [
        {
            "sha": "30bc320f1729d240246550123669567785c335a9",
            "filename": "packages/service-worker/worker/src/driver.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/ad3329a78b48a485c8597bc332b55584600adfcf/packages%2Fservice-worker%2Fworker%2Fsrc%2Fdriver.ts",
            "raw_url": "https://github.com/angular/angular/raw/ad3329a78b48a485c8597bc332b55584600adfcf/packages%2Fservice-worker%2Fworker%2Fsrc%2Fdriver.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Fsrc%2Fdriver.ts?ref=ad3329a78b48a485c8597bc332b55584600adfcf",
            "patch": "@@ -1026,10 +1026,10 @@ export class Driver implements Debuggable, UpdateSource {\n                                 .filter(([clientId, hash]) => hash === brokenHash)\n                                 .map(([clientId]) => clientId);\n \n-    affectedClients.forEach(async clientId => {\n+    await Promise.all(affectedClients.map(async clientId => {\n       const client = await this.scope.clients.get(clientId);\n       client.postMessage({type: 'UNRECOVERABLE_STATE', reason});\n-    });\n+    }));\n   }\n \n   async notifyClientsAboutUpdate(next: AppVersion): Promise<void> {"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 2,
        "deletions": 2
    }
}