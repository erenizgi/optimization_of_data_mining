{
    "author": "gkalpak",
    "message": "refactor(docs-infra): minor refactoring of the `component-interaction` e2e tests (#39001)\n\nThis commit refactors the e2e tests of the `component-interaction` docs\nexample to improve readability and make them easier to maintain.\n\nChanges include:\n- Switch from `element.all().get(0)` to `element()` when there is only\n  one such element on the page.\n- Switch from `Promise#then()` to `async/await`.\n- Move `ElementFinder`s at the top of the test (instead of having them\n  interleaved with expectations).\n- Load the page before every test (i.e. in a `beforeEach()` instead of\n  `beforeAll()`) to prevent state from each test leaking into the\n  subsequent tests.\n- Order imports alphabetically.\n\nPR Close #39001",
    "sha": "2df39ee3380d56a645394622655ba9e6a824f106",
    "files": [
        {
            "sha": "ea6a9982855ac05fdcf9038c7ca509df4a355743",
            "filename": "aio/content/examples/component-interaction/e2e/src/app.e2e-spec.ts",
            "status": "modified",
            "additions": 77,
            "deletions": 76,
            "changes": 153,
            "blob_url": "https://github.com/angular/angular/blob/2df39ee3380d56a645394622655ba9e6a824f106/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fe2e%2Fsrc%2Fapp.e2e-spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2df39ee3380d56a645394622655ba9e6a824f106/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fe2e%2Fsrc%2Fapp.e2e-spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/aio%2Fcontent%2Fexamples%2Fcomponent-interaction%2Fe2e%2Fsrc%2Fapp.e2e-spec.ts?ref=2df39ee3380d56a645394622655ba9e6a824f106",
            "patch": "@@ -1,8 +1,8 @@\n-import { browser, element, by } from 'protractor';\n+import { browser, by, element } from 'protractor';\n \n describe('Component Communication Cookbook Tests', () => {\n \n-  beforeAll(() => browser.get(browser.baseUrl));\n+  beforeEach(() => browser.get(browser.baseUrl));\n \n   describe('Parent-to-child communication', () => {\n     // #docregion parent-to-child\n@@ -11,7 +11,7 @@ describe('Component Communication Cookbook Tests', () => {\n     const masterName = 'Master';\n \n     it('should pass properties to children properly', () => {\n-      const parent = element.all(by.tagName('app-hero-parent')).get(0);\n+      const parent = element(by.tagName('app-hero-parent'));\n       const heroes = parent.all(by.tagName('app-hero-child'));\n \n       for (let i = 0; i < heroNames.length; i++) {\n@@ -31,7 +31,7 @@ describe('Component Communication Cookbook Tests', () => {\n     it('should display trimmed, non-empty names', () => {\n       const nonEmptyNameIndex = 0;\n       const nonEmptyName = '\"Dr IQ\"';\n-      const parent = element.all(by.tagName('app-name-parent')).get(0);\n+      const parent = element(by.tagName('app-name-parent'));\n       const hero = parent.all(by.tagName('app-name-child')).get(nonEmptyNameIndex);\n \n       const displayName = hero.element(by.tagName('h3')).getText();\n@@ -41,7 +41,7 @@ describe('Component Communication Cookbook Tests', () => {\n     it('should replace empty name with default name', () => {\n       const emptyNameIndex = 1;\n       const defaultName = '\"<no name set>\"';\n-      const parent = element.all(by.tagName('app-name-parent')).get(0);\n+      const parent = element(by.tagName('app-name-parent'));\n       const hero = parent.all(by.tagName('app-name-child')).get(emptyNameIndex);\n \n       const displayName = hero.element(by.tagName('h3')).getText();\n@@ -66,38 +66,36 @@ describe('Component Communication Cookbook Tests', () => {\n       expect(actual.logs.get(0).getText()).toBe(initialLog);\n     });\n \n-    it('should set expected values after clicking \\'Minor\\' twice', () => {\n+    it('should set expected values after clicking \\'Minor\\' twice', async () => {\n       const repoTag = element(by.tagName('app-version-parent'));\n       const newMinorButton = repoTag.all(by.tagName('button')).get(0);\n \n-      newMinorButton.click().then(() => {\n-        newMinorButton.click().then(() => {\n-          const actual = getActual();\n+      await newMinorButton.click();\n+      await newMinorButton.click();\n \n-          const labelAfter2Minor = 'Version 1.25';\n-          const logAfter2Minor = 'minor changed from 24 to 25';\n+      const actual = getActual();\n+\n+      const labelAfter2Minor = 'Version 1.25';\n+      const logAfter2Minor = 'minor changed from 24 to 25';\n \n-          expect(actual.label).toBe(labelAfter2Minor);\n-          expect(actual.count).toBe(3);\n-          expect(actual.logs.get(2).getText()).toBe(logAfter2Minor);\n-        });\n-      });\n+      expect(actual.label).toBe(labelAfter2Minor);\n+      expect(actual.count).toBe(3);\n+      expect(actual.logs.get(2).getText()).toBe(logAfter2Minor);\n     });\n \n-    it('should set expected values after clicking \\'Major\\' once', () => {\n+    it('should set expected values after clicking \\'Major\\' once', async () => {\n       const repoTag = element(by.tagName('app-version-parent'));\n       const newMajorButton = repoTag.all(by.tagName('button')).get(1);\n \n-      newMajorButton.click().then(() => {\n-        const actual = getActual();\n+      await newMajorButton.click();\n+      const actual = getActual();\n \n-        const labelAfterMajor = 'Version 2.0';\n-        const logAfterMajor = 'major changed from 1 to 2, minor changed from 25 to 0';\n+      const labelAfterMajor = 'Version 2.0';\n+      const logAfterMajor = 'major changed from 1 to 2, minor changed from 23 to 0';\n \n-        expect(actual.label).toBe(labelAfterMajor);\n-        expect(actual.count).toBe(4);\n-        expect(actual.logs.get(3).getText()).toBe(logAfterMajor);\n-      });\n+      expect(actual.label).toBe(labelAfterMajor);\n+      expect(actual.count).toBe(2);\n+      expect(actual.logs.get(1).getText()).toBe(logAfterMajor);\n     });\n \n     function getActual() {\n@@ -114,36 +112,34 @@ describe('Component Communication Cookbook Tests', () => {\n     }\n     // ...\n     // #enddocregion parent-to-child-onchanges\n-\n   });\n \n   describe('Child-to-parent communication', () => {\n     // #docregion child-to-parent\n     // ...\n     it('should not emit the event initially', () => {\n-      const voteLabel = element(by.tagName('app-vote-taker'))\n-        .element(by.tagName('h3')).getText();\n-      expect(voteLabel).toBe('Agree: 0, Disagree: 0');\n+      const voteLabel = element(by.tagName('app-vote-taker')).element(by.tagName('h3'));\n+      expect(voteLabel.getText()).toBe('Agree: 0, Disagree: 0');\n     });\n \n-    it('should process Agree vote', () => {\n+    it('should process Agree vote', async () => {\n+      const voteLabel = element(by.tagName('app-vote-taker')).element(by.tagName('h3'));\n       const agreeButton1 = element.all(by.tagName('app-voter')).get(0)\n         .all(by.tagName('button')).get(0);\n-      agreeButton1.click().then(() => {\n-        const voteLabel = element(by.tagName('app-vote-taker'))\n-          .element(by.tagName('h3')).getText();\n-        expect(voteLabel).toBe('Agree: 1, Disagree: 0');\n-      });\n+\n+      await agreeButton1.click();\n+\n+      expect(voteLabel.getText()).toBe('Agree: 1, Disagree: 0');\n     });\n \n-    it('should process Disagree vote', () => {\n+    it('should process Disagree vote', async () => {\n+      const voteLabel = element(by.tagName('app-vote-taker')).element(by.tagName('h3'));\n       const agreeButton1 = element.all(by.tagName('app-voter')).get(1)\n         .all(by.tagName('button')).get(1);\n-      agreeButton1.click().then(() => {\n-        const voteLabel = element(by.tagName('app-vote-taker'))\n-          .element(by.tagName('h3')).getText();\n-        expect(voteLabel).toBe('Agree: 1, Disagree: 1');\n-      });\n+\n+      await agreeButton1.click();\n+\n+      expect(voteLabel.getText()).toBe('Agree: 0, Disagree: 1');\n     });\n     // ...\n     // #enddocregion child-to-parent\n@@ -162,66 +158,71 @@ describe('Component Communication Cookbook Tests', () => {\n   function countDownTimerTests(parentTag: string) {\n     // #docregion countdown-timer-tests\n     // ...\n-    it('timer and parent seconds should match', () => {\n+    it('timer and parent seconds should match', async () => {\n       const parent = element(by.tagName(parentTag));\n-      const startButton = parent.element(by.tagName('button')).get(0);\n-      const message = parent.element(by.tagName('app-countdown-timer')).getText();\n-\n-      startButton.click().then(() => {\n-        browser.sleep(10); // give `seconds` a chance to catchup with `message`\n-        const seconds = parent.element(by.className('seconds')).getText();\n-        expect(message).toContain(seconds);\n-      });\n+      const startButton = parent.element(by.buttonText('Start'));\n+      const seconds = parent.element(by.className('seconds'));\n+      const timer = parent.element(by.tagName('app-countdown-timer'));\n+\n+      await startButton.click();\n+      await browser.sleep(10); // give `seconds` a chance to catchup with `timer`\n+\n+      expect(await timer.getText()).toContain(await seconds.getText());\n     });\n \n-    it('should stop the countdown', () => {\n+    it('should stop the countdown', async () => {\n       const parent = element(by.tagName(parentTag));\n-      const stopButton = parent.all(by.tagName('button')).get(1);\n+      const startButton = parent.element(by.buttonText('Start'));\n+      const stopButton = parent.element(by.buttonText('Stop'));\n+      const timer = parent.element(by.tagName('app-countdown-timer'));\n+\n+      await startButton.click();\n+      expect(await timer.getText()).not.toContain('Holding');\n \n-      stopButton.click().then(() => {\n-        const message = parent.element(by.tagName('app-countdown-timer')).getText();\n-        expect(message).toContain('Holding');\n-      });\n+      await stopButton.click();\n+      expect(await timer.getText()).toContain('Holding');\n     });\n     // ...\n     // #enddocregion countdown-timer-tests\n   }\n \n-\n   describe('Parent and children communicate via a service', () => {\n     // #docregion bidirectional-service\n     // ...\n-    it('should announce a mission', () => {\n+    it('should announce a mission', async () => {\n       const missionControl = element(by.tagName('app-mission-control'));\n       const announceButton = missionControl.all(by.tagName('button')).get(0);\n-      announceButton.click().then(() => {\n-        const history = missionControl.all(by.tagName('li'));\n-        expect(history.count()).toBe(1);\n-        expect(history.get(0).getText()).toMatch(/Mission.* announced/);\n-      });\n+      const history = missionControl.all(by.tagName('li'));\n+\n+      await announceButton.click();\n+\n+      expect(history.count()).toBe(1);\n+      expect(history.get(0).getText()).toMatch(/Mission.* announced/);\n     });\n \n-    it('should confirm the mission by Lovell', () => {\n-      testConfirmMission(1, 2, 'Lovell');\n+    it('should confirm the mission by Lovell', async () => {\n+      await testConfirmMission(1, 'Lovell');\n     });\n \n-    it('should confirm the mission by Haise', () => {\n-      testConfirmMission(3, 3, 'Haise');\n+    it('should confirm the mission by Haise', async () => {\n+      await testConfirmMission(3, 'Haise');\n     });\n \n-    it('should confirm the mission by Swigert', () => {\n-      testConfirmMission(2, 4, 'Swigert');\n+    it('should confirm the mission by Swigert', async () => {\n+      await testConfirmMission(2, 'Swigert');\n     });\n \n-    function testConfirmMission(buttonIndex: number, expectedLogCount: number, astronaut: string) {\n-      const confirmedLog = ' confirmed the mission';\n+    async function testConfirmMission(buttonIndex: number, astronaut: string) {\n       const missionControl = element(by.tagName('app-mission-control'));\n+      const announceButton = missionControl.all(by.tagName('button')).get(0);\n       const confirmButton = missionControl.all(by.tagName('button')).get(buttonIndex);\n-      confirmButton.click().then(() => {\n-        const history = missionControl.all(by.tagName('li'));\n-        expect(history.count()).toBe(expectedLogCount);\n-        expect(history.get(expectedLogCount - 1).getText()).toBe(astronaut + confirmedLog);\n-      });\n+      const history = missionControl.all(by.tagName('li'));\n+\n+      await announceButton.click();\n+      await confirmButton.click();\n+\n+      expect(history.count()).toBe(2);\n+      expect(history.get(1).getText()).toBe(`${astronaut} confirmed the mission`);\n     }\n     // ...\n     // #enddocregion bidirectional-service"
        }
    ],
    "stats": {
        "total": 153,
        "additions": 77,
        "deletions": 76
    }
}