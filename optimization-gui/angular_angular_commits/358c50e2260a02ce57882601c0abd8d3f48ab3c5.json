{
    "author": "bjarkler",
    "message": "feat(compiler): add schema for Trusted Types sinks (#39554)\n\nCreate a schema with an associated function to classify Trusted Types\nsinks.\n\nPiggyback a typo fix.\n\nPR Close #39554",
    "sha": "358c50e2260a02ce57882601c0abd8d3f48ab3c5",
    "files": [
        {
            "sha": "7d1182d49ad2fcc537e9e27e58218ea7636565a9",
            "filename": "packages/compiler/src/schema/dom_security_schema.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/358c50e2260a02ce57882601c0abd8d3f48ab3c5/packages%2Fcompiler%2Fsrc%2Fschema%2Fdom_security_schema.ts",
            "raw_url": "https://github.com/angular/angular/raw/358c50e2260a02ce57882601c0abd8d3f48ab3c5/packages%2Fcompiler%2Fsrc%2Fschema%2Fdom_security_schema.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fschema%2Fdom_security_schema.ts?ref=358c50e2260a02ce57882601c0abd8d3f48ab3c5",
            "patch": "@@ -19,7 +19,7 @@ import {SecurityContext} from '../core';\n //\n // =================================================================================================\n \n-/** Map from tagName|propertyName SecurityContext. Properties applying to all tags use '*'. */\n+/** Map from tagName|propertyName to SecurityContext. Properties applying to all tags use '*'. */\n let _SECURITY_SCHEMA!: {[k: string]: SecurityContext};\n \n export function SECURITY_SCHEMA(): {[k: string]: SecurityContext} {"
        },
        {
            "sha": "6b8e4bc3cf481c691f3d62a3679656d5bc650066",
            "filename": "packages/compiler/src/schema/trusted_types_sinks.ts",
            "status": "added",
            "additions": 47,
            "deletions": 0,
            "changes": 47,
            "blob_url": "https://github.com/angular/angular/blob/358c50e2260a02ce57882601c0abd8d3f48ab3c5/packages%2Fcompiler%2Fsrc%2Fschema%2Ftrusted_types_sinks.ts",
            "raw_url": "https://github.com/angular/angular/raw/358c50e2260a02ce57882601c0abd8d3f48ab3c5/packages%2Fcompiler%2Fsrc%2Fschema%2Ftrusted_types_sinks.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Fsrc%2Fschema%2Ftrusted_types_sinks.ts?ref=358c50e2260a02ce57882601c0abd8d3f48ab3c5",
            "patch": "@@ -0,0 +1,47 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+/**\n+ * Set of tagName|propertyName corresponding to Trusted Types sinks. Properties applying to all\n+ * tags use '*'.\n+ *\n+ * Extracted from, and should be kept in sync with\n+ * https://w3c.github.io/webappsec-trusted-types/dist/spec/#integrations\n+ */\n+const TRUSTED_TYPES_SINKS = new Set<string>([\n+  // NOTE: All strings in this set *must* be lowercase!\n+\n+  // TrustedHTML\n+  'iframe|srcdoc',\n+  '*|innerhtml',\n+  '*|outerhtml',\n+\n+  // NB: no TrustedScript here, as the corresponding tags are stripped by the compiler.\n+\n+  // TrustedScriptURL\n+  'embed|src',\n+  'object|codebase',\n+  'object|data',\n+]);\n+\n+/**\n+ * isTrustedTypesSink returns true if the given property on the given DOM tag is a Trusted Types\n+ * sink. In that case, use `ElementSchemaRegistry.securityContext` to determine which particular\n+ * Trusted Type is required for values passed to the sink:\n+ * - SecurityContext.HTML corresponds to TrustedHTML\n+ * - SecurityContext.RESOURCE_URL corresponds to TrustedScriptURL\n+ */\n+export function isTrustedTypesSink(tagName: string, propName: string): boolean {\n+  // Make sure comparisons are case insensitive, so that case differences between attribute and\n+  // property names do not have a security impact.\n+  tagName = tagName.toLowerCase();\n+  propName = propName.toLowerCase();\n+\n+  return TRUSTED_TYPES_SINKS.has(tagName + '|' + propName) ||\n+      TRUSTED_TYPES_SINKS.has('*|' + propName);\n+}"
        },
        {
            "sha": "49023439a770620e6554802da313ed65bcf93985",
            "filename": "packages/compiler/test/schema/trusted_types_sinks_spec.ts",
            "status": "added",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/angular/angular/blob/358c50e2260a02ce57882601c0abd8d3f48ab3c5/packages%2Fcompiler%2Ftest%2Fschema%2Ftrusted_types_sinks_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/358c50e2260a02ce57882601c0abd8d3f48ab3c5/packages%2Fcompiler%2Ftest%2Fschema%2Ftrusted_types_sinks_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler%2Ftest%2Fschema%2Ftrusted_types_sinks_spec.ts?ref=358c50e2260a02ce57882601c0abd8d3f48ab3c5",
            "patch": "@@ -0,0 +1,34 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+import {isTrustedTypesSink} from '@angular/compiler/src/schema/trusted_types_sinks';\n+import {describe, expect, it} from '@angular/core/testing/src/testing_internal';\n+\n+{\n+  describe('isTrustedTypesSink', () => {\n+    it('should classify Trusted Types sinks', () => {\n+      expect(isTrustedTypesSink('iframe', 'srcdoc')).toBeTrue();\n+      expect(isTrustedTypesSink('p', 'innerHTML')).toBeTrue();\n+      expect(isTrustedTypesSink('embed', 'src')).toBeTrue();\n+      expect(isTrustedTypesSink('a', 'href')).toBeFalse();\n+      expect(isTrustedTypesSink('base', 'href')).toBeFalse();\n+      expect(isTrustedTypesSink('div', 'style')).toBeFalse();\n+    });\n+\n+    it('should classify Trusted Types sinks case insensitive', () => {\n+      expect(isTrustedTypesSink('p', 'iNnErHtMl')).toBeTrue();\n+      expect(isTrustedTypesSink('p', 'formaction')).toBeFalse();\n+      expect(isTrustedTypesSink('p', 'formAction')).toBeFalse();\n+    });\n+\n+    it('should classify attributes as Trusted Types sinks', () => {\n+      expect(isTrustedTypesSink('p', 'innerHtml')).toBeTrue();\n+      expect(isTrustedTypesSink('p', 'formaction')).toBeFalse();\n+    });\n+  });\n+}"
        }
    ],
    "stats": {
        "total": 83,
        "additions": 82,
        "deletions": 1
    }
}