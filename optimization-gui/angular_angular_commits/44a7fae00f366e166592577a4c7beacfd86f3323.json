{
    "author": "atscott",
    "message": "fix(router): handle new navigations from a NavigationEnd event (#41262)\n\nThis commit removes the line to set `currentNavigation` to `null` in the\nnavigation transitions subscription of the router. This logic is\nalready handled in the `finalize` stage of the transition pipe and has\nbeen found to cause issues if a new navigation is triggered from a\nsubscription to the `NavigationEnd` event.\n\nfixes #37460\n\nPR Close #41262",
    "sha": "44a7fae00f366e166592577a4c7beacfd86f3323",
    "files": [
        {
            "sha": "8fa4819b11f88162170b3a7377a3a8f1da97c1ef",
            "filename": "packages/router/src/router.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/44a7fae00f366e166592577a4c7beacfd86f3323/packages%2Frouter%2Fsrc%2Frouter.ts",
            "raw_url": "https://github.com/angular/angular/raw/44a7fae00f366e166592577a4c7beacfd86f3323/packages%2Frouter%2Fsrc%2Frouter.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Fsrc%2Frouter.ts?ref=44a7fae00f366e166592577a4c7beacfd86f3323",
            "patch": "@@ -1293,7 +1293,6 @@ export class Router {\n               .next(new NavigationEnd(\n                   t.id, this.serializeUrl(t.extractedUrl), this.serializeUrl(this.currentUrlTree)));\n           this.lastSuccessfulNavigation = this.currentNavigation;\n-          this.currentNavigation = null;\n           t.resolve(true);\n         },\n         e => {"
        },
        {
            "sha": "5abe19e4a7d7d5900391038313abe1be43e54101",
            "filename": "packages/router/test/bootstrap.spec.ts",
            "status": "modified",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/angular/angular/blob/44a7fae00f366e166592577a4c7beacfd86f3323/packages%2Frouter%2Ftest%2Fbootstrap.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/44a7fae00f366e166592577a4c7beacfd86f3323/packages%2Frouter%2Ftest%2Fbootstrap.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Frouter%2Ftest%2Fbootstrap.spec.ts?ref=44a7fae00f366e166592577a4c7beacfd86f3323",
            "patch": "@@ -18,6 +18,10 @@ describe('bootstrap', () => {\n   let log: any[] = [];\n   let testProviders: any[] = null!;\n \n+  @Component({template: 'simple'})\n+  class SimpleCmp {\n+  }\n+\n   @Component({selector: 'test-app', template: 'root <router-outlet></router-outlet>'})\n   class RootCmp {\n     constructor() {\n@@ -394,4 +398,36 @@ describe('bootstrap', () => {\n     expect(window.removeEventListener).toHaveBeenCalledWith('popstate', jasmine.any(Function));\n     expect(window.removeEventListener).toHaveBeenCalledWith('hashchange', jasmine.any(Function));\n   });\n+\n+  it('can schedule a navigation from the NavigationEnd event #37460', async (done) => {\n+    @NgModule({\n+      imports: [\n+        BrowserModule,\n+        RouterModule.forRoot(\n+            [\n+              {path: 'a', component: SimpleCmp},\n+              {path: 'b', component: SimpleCmp},\n+            ],\n+            )\n+      ],\n+      declarations: [RootCmp, SimpleCmp],\n+      bootstrap: [RootCmp],\n+      providers: [...testProviders],\n+    })\n+    class TestModule {\n+    }\n+\n+    const res = await platformBrowserDynamic([]).bootstrapModule(TestModule);\n+    const router = res.injector.get(Router);\n+    router.events.subscribe(() => {\n+      expect(router.getCurrentNavigation()?.id).toBeDefined();\n+    });\n+    router.events.subscribe(async (e) => {\n+      if (e instanceof NavigationEnd && e.url === '/b') {\n+        await router.navigate(['a']);\n+        done();\n+      }\n+    });\n+    await router.navigateByUrl('/b');\n+  });\n });"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 36,
        "deletions": 1
    }
}