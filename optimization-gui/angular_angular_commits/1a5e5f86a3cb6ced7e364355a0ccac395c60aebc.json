{
    "author": "atscott",
    "message": "refactor(compiler-cli): Include pipe `nameSpan` in TCB (#39768)\n\nIn order to map the pipe's `transform` method in the type check block\ndirectly back to the pipe name in the template source, we need to\ninclude the `BindingPipe`'s `nameSpan` with the `ts.methodAccess` for\nthe pipe's transform method.\n\nNote that this is specifically relevant to the Language Service's \"find\nreferences\" feature. As an example, with something like `-2.5 | number:'1.0-0'`,,\nwhen calling \"find references\" on the 'number' pipe we want the text\nspan of the reference to just be `number` rather than the entire binding\npipe's source `-2.5 | number:'1.0-0'`.\n\nPR Close #39768",
    "sha": "1a5e5f86a3cb6ced7e364355a0ccac395c60aebc",
    "files": [
        {
            "sha": "898133a63fa292ee3031b1f0a1e7af64b34ba6e2",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/src/type_check_block.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/1a5e5f86a3cb6ced7e364355a0ccac395c60aebc/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts",
            "raw_url": "https://github.com/angular/angular/raw/1a5e5f86a3cb6ced7e364355a0ccac395c60aebc/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Fsrc%2Ftype_check_block.ts?ref=1a5e5f86a3cb6ced7e364355a0ccac395c60aebc",
            "patch": "@@ -1618,7 +1618,12 @@ class TcbExpressionTranslator {\n         pipe = NULL_AS_ANY;\n       }\n       const args = ast.args.map(arg => this.translate(arg));\n-      const result = tsCallMethod(pipe, 'transform', [expr, ...args]);\n+      const methodAccess = ts.createPropertyAccess(pipe, 'transform');\n+      addParseSpanInfo(methodAccess, ast.nameSpan);\n+      const result = ts.createCall(\n+          /* expression */ methodAccess,\n+          /* typeArguments */ undefined,\n+          /* argumentsArray */[expr, ...args]);\n       addParseSpanInfo(result, ast.sourceSpan);\n       return result;\n     } else if ("
        },
        {
            "sha": "0f8267085d11a5d0841b4944c81e838d6fb25422",
            "filename": "packages/compiler-cli/src/ngtsc/typecheck/test/span_comments_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/1a5e5f86a3cb6ced7e364355a0ccac395c60aebc/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/1a5e5f86a3cb6ced7e364355a0ccac395c60aebc/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Ftypecheck%2Ftest%2Fspan_comments_spec.ts?ref=1a5e5f86a3cb6ced7e364355a0ccac395c60aebc",
            "patch": "@@ -147,7 +147,7 @@ describe('type check blocks diagnostics', () => {\n       }];\n       const block = tcbWithSpans(TEMPLATE, PIPES);\n       expect(block).toContain(\n-          '((null as TestPipe).transform(((ctx).a /*3,4*/) /*3,4*/, ((ctx).b /*12,13*/) /*12,13*/) /*3,13*/);');\n+          '((null as TestPipe).transform /*7,11*/(((ctx).a /*3,4*/) /*3,4*/, ((ctx).b /*12,13*/) /*12,13*/) /*3,13*/);');\n     });\n \n     describe('attaching multiple comments for multiple references', () => {"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 7,
        "deletions": 2
    }
}