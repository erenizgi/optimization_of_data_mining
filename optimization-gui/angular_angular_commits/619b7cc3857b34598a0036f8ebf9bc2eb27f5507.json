{
    "author": "alan-agius4",
    "message": "fix(elements): remove `ng-add` schematic (#43975)\n\nThis schematic is no longer needed since all the [browsers](https://angular.io/guide/browser-support) that Angular supports `CustomElementRegistry` APIs.\n\nSide note: `document-register-element` has been deprecated in favor of `@ungap/custom-element`\n\nPR Close #43975",
    "sha": "619b7cc3857b34598a0036f8ebf9bc2eb27f5507",
    "files": [
        {
            "sha": "6d5e8c041b0129fed0eb480bc861e896800aa234",
            "filename": "packages/elements/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/619b7cc3857b34598a0036f8ebf9bc2eb27f5507/packages%2Felements%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/619b7cc3857b34598a0036f8ebf9bc2eb27f5507/packages%2Felements%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Felements%2FBUILD.bazel?ref=619b7cc3857b34598a0036f8ebf9bc2eb27f5507",
            "patch": "@@ -20,9 +20,6 @@ ng_module(\n ng_package(\n     name = \"npm_package\",\n     srcs = [\"package.json\"],\n-    nested_packages = [\n-        \"//packages/elements/schematics:npm_package\",\n-    ],\n     tags = [\n         \"release-with-framework\",\n     ],"
        },
        {
            "sha": "45b9fa8c112e89a40ed616b20e1c0a0e8da1a25c",
            "filename": "packages/elements/schematics/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 26,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Felements%2Fschematics%2FBUILD.bazel?ref=9867a5d70476c19469dfd5cdf540991a4907e108",
            "patch": "@@ -1,26 +0,0 @@\n-load(\"//tools:defaults.bzl\", \"pkg_npm\")\n-\n-package(default_visibility = [\"//visibility:public\"])\n-\n-exports_files([\n-    \"package.json\",\n-    \"collection.json\",\n-])\n-\n-genrule(\n-    name = \"collection\",\n-    srcs = [\"collection.json\"],\n-    outs = [\"test-collection.json\"],\n-    cmd = \"cp $< $@\",\n-    output_to_bindir = 1,\n-)\n-\n-pkg_npm(\n-    name = \"npm_package\",\n-    srcs = [\n-        \"collection.json\",\n-    ],\n-    deps = [\n-        \"//packages/elements/schematics/ng-add\",\n-    ],\n-)"
        },
        {
            "sha": "66437dc93b40c5931b484abc2284d0f6611ba315",
            "filename": "packages/elements/schematics/collection.json",
            "status": "removed",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2Fcollection.json",
            "raw_url": "https://github.com/angular/angular/raw/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2Fcollection.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Felements%2Fschematics%2Fcollection.json?ref=9867a5d70476c19469dfd5cdf540991a4907e108",
            "patch": "@@ -1,10 +0,0 @@\n-{\n-  \"$schema\": \"../node_modules/@angular-devkit/schematics/collection-schema.json\",\n-  \"schematics\": {\n-    \"ng-add\": {\n-      \"description\": \"Adds the document-register-element polyfill.\",\n-      \"factory\": \"./ng-add\",\n-      \"schema\": \"ng-add/schema.json\"\n-    }\n-  }\n-}"
        },
        {
            "sha": "f5d26356268f6a2df40c5c07fd38d83d7b60b7de",
            "filename": "packages/elements/schematics/ng-add/BUILD.bazel",
            "status": "removed",
            "additions": 0,
            "deletions": 39,
            "changes": 39,
            "blob_url": "https://github.com/angular/angular/blob/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2Fng-add%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2Fng-add%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Felements%2Fschematics%2Fng-add%2FBUILD.bazel?ref=9867a5d70476c19469dfd5cdf540991a4907e108",
            "patch": "@@ -1,39 +0,0 @@\n-load(\"//tools:defaults.bzl\", \"jasmine_node_test\", \"ts_library\")\n-\n-package(default_visibility = [\"//visibility:public\"])\n-\n-ts_library(\n-    name = \"ng-add\",\n-    srcs = [\n-        \"index.ts\",\n-        \"schema.d.ts\",\n-    ],\n-    data = [\n-        \"schema.json\",\n-    ],\n-    deps = [\n-        \"@npm//@angular-devkit/schematics\",\n-        \"@npm//@schematics/angular\",\n-    ],\n-)\n-\n-ts_library(\n-    name = \"test_lib\",\n-    testonly = True,\n-    srcs = [\n-        \"index_spec.ts\",\n-    ],\n-    deps = [\n-        \":ng-add\",\n-        \"@npm//@angular-devkit/schematics\",\n-        \"@npm//@schematics/angular\",\n-    ],\n-)\n-\n-jasmine_node_test(\n-    name = \"test\",\n-    deps = [\n-        \":test_lib\",\n-        \"//packages/elements/schematics:collection\",\n-    ],\n-)"
        },
        {
            "sha": "0f59fc9cef7243142e24e26646ed25a5dbfd547b",
            "filename": "packages/elements/schematics/ng-add/index.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 78,
            "changes": 78,
            "blob_url": "https://github.com/angular/angular/blob/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2Fng-add%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2Fng-add%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Felements%2Fschematics%2Fng-add%2Findex.ts?ref=9867a5d70476c19469dfd5cdf540991a4907e108",
            "patch": "@@ -1,78 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {chain, noop, Rule, SchematicContext, SchematicsException, Tree} from '@angular-devkit/schematics';\n-import {NodePackageInstallTask} from '@angular-devkit/schematics/tasks';\n-import {addPackageJsonDependency, NodeDependencyType} from '@schematics/angular/utility/dependencies';\n-import {getWorkspace} from '@schematics/angular/utility/workspace';\n-\n-import {Schema} from './schema';\n-\n-export default function(options: Schema): Rule {\n-  return chain([\n-    options && options.skipPackageJson ? noop() : addPolyfillDependency(),\n-    addPolyfill(options),\n-  ]);\n-}\n-\n-/** Adds a package.json dependency for document-register-element */\n-function addPolyfillDependency(): Rule {\n-  return (host: Tree, context: SchematicContext) => {\n-    addPackageJsonDependency(host, {\n-      type: NodeDependencyType.Default,\n-      name: 'document-register-element',\n-      version: '^1.7.2',\n-    });\n-    context.logger.info('Added \"document-register-element\" as a dependency.');\n-\n-    // Install the dependency\n-    context.addTask(new NodePackageInstallTask());\n-  };\n-}\n-\n-/** Adds the document-register-element.js to the polyfills file. */\n-function addPolyfill(options: Schema): Rule {\n-  return async (host: Tree, context: SchematicContext) => {\n-    const projectName = options.project;\n-\n-    if (!projectName) {\n-      throw new SchematicsException('Option \"project\" is required.');\n-    }\n-\n-    const workspace = await getWorkspace(host);\n-    const project = workspace.projects.get(projectName);\n-\n-    if (!project) {\n-      throw new SchematicsException(`Project ${projectName} is not defined in this workspace.`);\n-    }\n-\n-    if (project.extensions['projectType'] !== 'application') {\n-      throw new SchematicsException(\n-          `@angular/elements requires a project type of \"application\" but ${projectName} isn't.`);\n-    }\n-\n-    const buildTarget = project.targets.get('build');\n-    if (!buildTarget || !buildTarget.options) {\n-      throw new SchematicsException(`Cannot find 'options' for ${projectName} build target.`);\n-    }\n-\n-    const {polyfills} = buildTarget.options;\n-    if (typeof polyfills !== 'string') {\n-      throw new SchematicsException(`polyfills for ${projectName} build target is not a string.`);\n-    }\n-\n-    const content = host.read(polyfills).toString();\n-    if (!content.includes('document-register-element')) {\n-      // Add string at the end of the file.\n-      const recorder = host.beginUpdate(polyfills);\n-      recorder.insertRight(content.length, `import 'document-register-element';\\n`);\n-      host.commitUpdate(recorder);\n-    }\n-\n-    context.logger.info('Added \"document-register-element\" to polyfills.');\n-  };\n-}"
        },
        {
            "sha": "844c524c78b84037431854d2fc6ba25aaac42bfc",
            "filename": "packages/elements/schematics/ng-add/index_spec.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 65,
            "changes": 65,
            "blob_url": "https://github.com/angular/angular/blob/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2Fng-add%2Findex_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2Fng-add%2Findex_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Felements%2Fschematics%2Fng-add%2Findex_spec.ts?ref=9867a5d70476c19469dfd5cdf540991a4907e108",
            "patch": "@@ -1,65 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-import {SchematicTestRunner, UnitTestTree} from '@angular-devkit/schematics/testing';\n-import * as path from 'path';\n-\n-import {Schema as ElementsOptions} from './schema';\n-\n-// tslint:disable:max-line-length\n-describe('Elements Schematics', () => {\n-  const schematicRunner = new SchematicTestRunner(\n-      '@angular/elements',\n-      path.join(__dirname, '../test-collection.json'),\n-  );\n-  const defaultOptions: ElementsOptions = {project: 'elements', skipPackageJson: false};\n-\n-  let appTree: UnitTestTree;\n-\n-  // tslint:disable-next-line:no-any\n-  const workspaceOptions: any = {\n-    name: 'workspace',\n-    newProjectRoot: 'projects',\n-    version: '6.0.0',\n-  };\n-\n-  // tslint:disable-next-line:no-any\n-  const appOptions: any = {\n-    name: 'elements',\n-    inlineStyle: false,\n-    inlineTemplate: false,\n-    routing: false,\n-    style: 'css',\n-    skipTests: false,\n-  };\n-\n-  beforeEach(async () => {\n-    appTree = await schematicRunner\n-                  .runExternalSchematicAsync('@schematics/angular', 'workspace', workspaceOptions)\n-                  .toPromise();\n-    appTree =\n-        await schematicRunner\n-            .runExternalSchematicAsync('@schematics/angular', 'application', appOptions, appTree)\n-            .toPromise();\n-  });\n-\n-  it('should run the ng-add schematic', async () => {\n-    const tree =\n-        await schematicRunner.runSchematicAsync('ng-add', defaultOptions, appTree).toPromise();\n-    expect(tree.readContent('/projects/elements/src/polyfills.ts'))\n-        .toContain(`import 'document-register-element';`);\n-  });\n-\n-  it('should add polyfill as a dependency in package.json', async () => {\n-    const tree =\n-        await schematicRunner.runSchematicAsync('ng-add', defaultOptions, appTree).toPromise();\n-    const pkgJsonText = tree.readContent('/package.json');\n-    const pkgJson = JSON.parse(pkgJsonText) as {dependencies: any};\n-    const {dependencies} = pkgJson;\n-    expect(dependencies['document-register-element']).toBeDefined();\n-  });\n-});"
        },
        {
            "sha": "5690d7da29a9e4b9f77f5b451e4986fc0157db37",
            "filename": "packages/elements/schematics/ng-add/schema.d.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 19,
            "changes": 19,
            "blob_url": "https://github.com/angular/angular/blob/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2Fng-add%2Fschema.d.ts",
            "raw_url": "https://github.com/angular/angular/raw/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2Fng-add%2Fschema.d.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Felements%2Fschematics%2Fng-add%2Fschema.d.ts?ref=9867a5d70476c19469dfd5cdf540991a4907e108",
            "patch": "@@ -1,19 +0,0 @@\n-/**\n- * @license\n- * Copyright Google LLC All Rights Reserved.\n- *\n- * Use of this source code is governed by an MIT-style license that can be\n- * found in the LICENSE file at https://angular.io/license\n- */\n-\n-export interface Schema {\n-  /**\n-   * Skip package.json install.\n-   */\n-  skipPackageJson: boolean;\n-\n-  /**\n-   * The project that needs the polyfill scripts\n-   */\n-  project: string;\n-}"
        },
        {
            "sha": "0debc51897cbce06e9a89cef8379b5c2375d32ee",
            "filename": "packages/elements/schematics/ng-add/schema.json",
            "status": "removed",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/angular/angular/blob/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2Fng-add%2Fschema.json",
            "raw_url": "https://github.com/angular/angular/raw/9867a5d70476c19469dfd5cdf540991a4907e108/packages%2Felements%2Fschematics%2Fng-add%2Fschema.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Felements%2Fschematics%2Fng-add%2Fschema.json?ref=9867a5d70476c19469dfd5cdf540991a4907e108",
            "patch": "@@ -1,22 +0,0 @@\n-{\n-  \"$schema\": \"http://json-schema.org/draft-07/schema\",\n-  \"$id\": \"SchematicsAngularElementsNgAdd\",\n-  \"title\": \"Angular Elements Ng Add Schema\",\n-  \"type\": \"object\",\n-  \"properties\": {\n-    \"project\": {\n-      \"type\": \"string\",\n-      \"description\": \"The name of the project.\",\n-      \"$default\": {\n-        \"$source\": \"projectName\"\n-      }\n-    },\n-    \"skipPackageJson\": {\n-      \"description\": \"When true, does not add dependencies to the \\\"package.json\\\" file.\",\n-      \"type\": \"boolean\",\n-      \"default\": false\n-    }\n-  },\n-  \"required\": [\n-  ]\n-}"
        }
    ],
    "stats": {
        "total": 262,
        "additions": 0,
        "deletions": 262
    }
}