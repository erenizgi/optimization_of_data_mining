{
    "author": "josephperrott",
    "message": "fix(compiler-cli): update type castings for JSON.parse usage (#40710)\n\nUpdate usages of JSON.parse to be cast as specific types.\n\nPR Close #40710",
    "sha": "b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
    "files": [
        {
            "sha": "74ee579f44f2b6868fbafc6a50dbf0cc4ccf4970",
            "filename": "packages/compiler-cli/ngcc/src/packages/entry_point.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -256,7 +256,7 @@ export function getEntryPointFormat(\n function loadPackageJson(\n     fs: ReadonlyFileSystem, packageJsonPath: AbsoluteFsPath): EntryPointPackageJson|null {\n   try {\n-    return JSON.parse(fs.readFile(packageJsonPath));\n+    return JSON.parse(fs.readFile(packageJsonPath)) as EntryPointPackageJson;\n   } catch {\n     return null;\n   }"
        },
        {
            "sha": "3c951dd5b5d9de153e427ad2fbf7bd302376052b",
            "filename": "packages/compiler-cli/ngcc/src/packages/entry_point_manifest.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point_manifest.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point_manifest.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fpackages%2Fentry_point_manifest.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -13,7 +13,7 @@ import {EntryPointWithDependencies} from '../dependencies/dependency_host';\n \n import {NGCC_VERSION} from './build_marker';\n import {NgccConfiguration} from './configuration';\n-import {getEntryPointInfo, isEntryPoint} from './entry_point';\n+import {getEntryPointInfo, isEntryPoint, PackageJsonFormatProperties} from './entry_point';\n \n /**\n  * Manages reading and writing a manifest file that contains a list of all the entry-points that\n@@ -197,3 +197,9 @@ export interface EntryPointManifestFile {\n   lockFileHash: string;\n   entryPointPaths: EntryPointPaths[];\n }\n+\n+\n+/** The JSON format of the entrypoint properties. */\n+export type NewEntryPointPropertiesMap = {\n+  [Property in PackageJsonFormatProperties as `${Property}_ivy_ngcc`]?: string;\n+};"
        },
        {
            "sha": "b7a778ee482b46fa1c9c825e7ec851f95049e45d",
            "filename": "packages/compiler-cli/ngcc/src/writing/cleaning/cleaning_strategies.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fcleaning%2Fcleaning_strategies.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fcleaning%2Fcleaning_strategies.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fcleaning%2Fcleaning_strategies.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -7,6 +7,7 @@\n  */\n import {absoluteFrom, AbsoluteFsPath, FileSystem, PathSegment} from '../../../../src/ngtsc/file_system';\n import {cleanPackageJson} from '../../packages/build_marker';\n+import {EntryPointPackageJson} from '../../packages/entry_point';\n import {NGCC_BACKUP_EXTENSION} from '../in_place_file_writer';\n import {NGCC_DIRECTORY} from '../new_entry_point_file_writer';\n \n@@ -30,7 +31,7 @@ export class PackageJsonCleaner implements CleaningStrategy {\n     return basename === 'package.json';\n   }\n   clean(path: AbsoluteFsPath, _basename: PathSegment): void {\n-    const packageJson = JSON.parse(this.fs.readFile(path));\n+    const packageJson = JSON.parse(this.fs.readFile(path)) as EntryPointPackageJson;\n     if (cleanPackageJson(packageJson)) {\n       this.fs.writeFile(path, `${JSON.stringify(packageJson, null, 2)}\\n`);\n     }"
        },
        {
            "sha": "114d2f72ea45cde9f5736ab65a9a2128f0752795",
            "filename": "packages/compiler-cli/ngcc/src/writing/new_entry_point_file_writer.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fnew_entry_point_file_writer.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fnew_entry_point_file_writer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fnew_entry_point_file_writer.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -103,11 +103,12 @@ export class NewEntryPointFileWriter extends InPlaceFileWriter {\n     const sourceMapPath = (originalSrcPath + '.map') as AbsoluteFsPath;\n     if (this.fs.exists(sourceMapPath)) {\n       try {\n-        const sourceMap = JSON.parse(this.fs.readFile(sourceMapPath));\n+        const sourceMap =\n+            JSON.parse(this.fs.readFile(sourceMapPath)) as {sourceRoot: string, [key: string]: any};\n         const newSourceMapPath = (newSrcPath + '.map') as AbsoluteFsPath;\n         const relativePath =\n             this.fs.relative(this.fs.dirname(newSourceMapPath), this.fs.dirname(sourceMapPath));\n-        sourceMap['sourceRoot'] = this.fs.join(relativePath, sourceMap['sourceRoot'] || '.');\n+        sourceMap.sourceRoot = this.fs.join(relativePath, sourceMap.sourceRoot || '.');\n         this.fs.ensureDir(this.fs.dirname(newSourceMapPath));\n         this.fs.writeFile(newSourceMapPath, JSON.stringify(sourceMap));\n       } catch (e) {"
        },
        {
            "sha": "b3388ce1029f0e3951f68730f7c9e58090507881",
            "filename": "packages/compiler-cli/ngcc/src/writing/package_json_updater.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fpackage_json_updater.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fpackage_json_updater.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Fsrc%2Fwriting%2Fpackage_json_updater.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -130,8 +130,9 @@ export class DirectPackageJsonUpdater implements PackageJsonUpdater {\n     // Read and parse the `package.json` content.\n     // NOTE: We are not using `preExistingParsedJson` (even if specified) to avoid corrupting the\n     //       content on disk in case `preExistingParsedJson` is outdated.\n-    const parsedJson =\n-        this.fs.exists(packageJsonPath) ? JSON.parse(this.fs.readFile(packageJsonPath)) : {};\n+    const parsedJson = this.fs.exists(packageJsonPath) ?\n+        JSON.parse(this.fs.readFile(packageJsonPath)) as JsonObject :\n+        {};\n \n     // Apply all changes to both the canonical representation (read from disk) and any pre-existing,\n     // in-memory representation."
        },
        {
            "sha": "650dcc5616d8b77133d15b04dc7fd943e41bb260",
            "filename": "packages/compiler-cli/ngcc/test/BUILD.bazel",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2FBUILD.bazel?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -22,6 +22,7 @@ ts_library(\n         \"//packages/compiler-cli/src/ngtsc/logging/testing\",\n         \"//packages/compiler-cli/src/ngtsc/partial_evaluator\",\n         \"//packages/compiler-cli/src/ngtsc/reflection\",\n+        \"//packages/compiler-cli/src/ngtsc/sourcemaps\",\n         \"//packages/compiler-cli/src/ngtsc/testing\",\n         \"//packages/compiler-cli/src/ngtsc/transform\",\n         \"//packages/compiler-cli/src/ngtsc/translator\","
        },
        {
            "sha": "2084962b951ed8394d30f83691c4604570e96028",
            "filename": "packages/compiler-cli/ngcc/test/entry_point_finder/directory_walker_entry_point_finder_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Fdirectory_walker_entry_point_finder_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Fdirectory_walker_entry_point_finder_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Fdirectory_walker_entry_point_finder_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -210,7 +210,7 @@ runInEachFileSystem(() => {\n \n         // Modify the manifest to prove that we use it to find the entry-points\n         const manifestPath = _Abs('/sub_entry_points/node_modules/__ngcc_entry_points__.json');\n-        const manifestFile: EntryPointManifestFile = JSON.parse(fs.readFile(manifestPath));\n+        const manifestFile = JSON.parse(fs.readFile(manifestPath)) as EntryPointManifestFile;\n         manifestFile.entryPointPaths.pop();\n         fs.writeFile(manifestPath, JSON.stringify(manifestFile));\n "
        },
        {
            "sha": "f4c231e44bf7f66fb9a11d9f65ece12a733ecaa9",
            "filename": "packages/compiler-cli/ngcc/test/entry_point_finder/targeted_entry_point_finder_spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Ftargeted_entry_point_finder_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Ftargeted_entry_point_finder_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fentry_point_finder%2Ftargeted_entry_point_finder_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -16,7 +16,7 @@ import {ModuleResolver} from '../../src/dependencies/module_resolver';\n import {TargetedEntryPointFinder} from '../../src/entry_point_finder/targeted_entry_point_finder';\n import {NGCC_VERSION} from '../../src/packages/build_marker';\n import {NgccConfiguration, ProcessedNgccPackageConfig} from '../../src/packages/configuration';\n-import {EntryPoint} from '../../src/packages/entry_point';\n+import {EntryPoint, EntryPointPackageJson} from '../../src/packages/entry_point';\n import {PathMappings} from '../../src/path_mappings';\n \n runInEachFileSystem(() => {\n@@ -555,7 +555,7 @@ runInEachFileSystem(() => {\n \n              // Add a build marker to the package.json\n              const packageJsonPath = _Abs(`${targetPath}/package.json`);\n-             const packageJson = JSON.parse(fs.readFile(packageJsonPath));\n+             const packageJson = JSON.parse(fs.readFile(packageJsonPath)) as EntryPointPackageJson;\n              packageJson.__processed_by_ivy_ngcc__ = {\n                esm5: NGCC_VERSION,\n              };\n@@ -579,7 +579,7 @@ runInEachFileSystem(() => {\n \n           // Add build markers to the package.json\n           const packageJsonPath = _Abs(`${targetPath}/package.json`);\n-          const packageJson = JSON.parse(fs.readFile(packageJsonPath));\n+          const packageJson = JSON.parse(fs.readFile(packageJsonPath)) as EntryPointPackageJson;\n           packageJson.__processed_by_ivy_ngcc__ = {\n             fesm2015: NGCC_VERSION,\n             esm5: NGCC_VERSION,\n@@ -625,7 +625,7 @@ runInEachFileSystem(() => {\n \n              // Add build markers to the package.json\n              const packageJsonPath = _Abs(`${targetPath}/package.json`);\n-             const packageJson = JSON.parse(fs.readFile(packageJsonPath));\n+             const packageJson = JSON.parse(fs.readFile(packageJsonPath)) as EntryPointPackageJson;\n              packageJson.__processed_by_ivy_ngcc__ = {\n                esm5: NGCC_VERSION,\n              };\n@@ -651,7 +651,7 @@ runInEachFileSystem(() => {\n \n              // Add build markers to the package.json\n              const packageJsonPath = _Abs(`${targetPath}/package.json`);\n-             const packageJson = JSON.parse(fs.readFile(packageJsonPath));\n+             const packageJson = JSON.parse(fs.readFile(packageJsonPath)) as EntryPointPackageJson;\n              packageJson.__processed_by_ivy_ngcc__ = {\n                fesm2015: NGCC_VERSION,\n              };"
        },
        {
            "sha": "5db0a7c398651a93520f52e945ebbc6aa93a4991",
            "filename": "packages/compiler-cli/ngcc/test/integration/ngcc_spec.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 7,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fintegration%2Fngcc_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -63,7 +63,7 @@ runInEachFileSystem(() => {\n     function setupAngularCoreEsm5() {\n       const pkgPath = _('/node_modules/@angular/core');\n       const pkgJsonPath = fs.join(pkgPath, 'package.json');\n-      const pkgJson = JSON.parse(fs.readFile(pkgJsonPath));\n+      const pkgJson = JSON.parse(fs.readFile(pkgJsonPath)) as EntryPointPackageJson;\n \n       fs.ensureDir(fs.join(pkgPath, 'fesm5'));\n       fs.writeFile(\n@@ -1390,12 +1390,13 @@ runInEachFileSystem(() => {\n             {basePath: '/node_modules', propertiesToConsider: ['main'], logger: new MockLogger()});\n         // Check that common/testing ES5 was processed\n         let commonTesting =\n-            JSON.parse(fs.readFile(_('/node_modules/@angular/common/testing/package.json')));\n+            JSON.parse(fs.readFile(_('/node_modules/@angular/common/testing/package.json'))) as\n+            EntryPointPackageJson;\n         expect(hasBeenProcessed(commonTesting, 'main')).toBe(true);\n         expect(hasBeenProcessed(commonTesting, 'esm2015')).toBe(false);\n         // Modify the manifest to test that is has no effect\n-        let manifest: EntryPointManifestFile =\n-            JSON.parse(fs.readFile(_('/node_modules/__ngcc_entry_points__.json')));\n+        let manifest = JSON.parse(fs.readFile(_('/node_modules/__ngcc_entry_points__.json'))) as\n+            EntryPointManifestFile;\n         manifest.entryPointPaths =\n             manifest.entryPointPaths.filter(paths => paths[1] !== '@angular/common/testing');\n         fs.writeFile(_('/node_modules/__ngcc_entry_points__.json'), JSON.stringify(manifest));\n@@ -1409,12 +1410,14 @@ runInEachFileSystem(() => {\n         });\n         // Check that common/testing ES2015 is now processed, despite the manifest not listing it\n         commonTesting =\n-            JSON.parse(fs.readFile(_('/node_modules/@angular/common/testing/package.json')));\n+            JSON.parse(fs.readFile(_('/node_modules/@angular/common/testing/package.json'))) as\n+            EntryPointPackageJson;\n         expect(hasBeenProcessed(commonTesting, 'main')).toBe(true);\n         expect(hasBeenProcessed(commonTesting, 'esm2015')).toBe(true);\n         // Check that the newly computed manifest has written to disk, containing the path that we\n         // had removed earlier.\n-        manifest = JSON.parse(fs.readFile(_('/node_modules/__ngcc_entry_points__.json')));\n+        manifest = JSON.parse(fs.readFile(_('/node_modules/__ngcc_entry_points__.json'))) as\n+            EntryPointManifestFile;\n         expect(manifest.entryPointPaths).toContain([\n           '@angular/common',\n           '@angular/common/testing',\n@@ -2248,7 +2251,8 @@ runInEachFileSystem(() => {\n \n     function loadPackage(\n         packageName: string, basePath: AbsoluteFsPath = _('/node_modules')): EntryPointPackageJson {\n-      return JSON.parse(fs.readFile(fs.resolve(basePath, packageName, 'package.json')));\n+      return JSON.parse(fs.readFile(fs.resolve(basePath, packageName, 'package.json'))) as\n+          EntryPointPackageJson;\n     }\n \n     function initMockFileSystem(fs: FileSystem, testFiles: Folder) {"
        },
        {
            "sha": "2d462e6bbeef406a2972108325d49461ddeab763",
            "filename": "packages/compiler-cli/ngcc/test/packages/build_marker_spec.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 36,
            "changes": 73,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fbuild_marker_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fbuild_marker_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fbuild_marker_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -85,56 +85,57 @@ runInEachFileSystem(() => {\n         const COMMON_PACKAGE_PATH = _('/node_modules/@angular/common/package.json');\n         const fs = getFileSystem();\n         const pkgUpdater = new DirectPackageJsonUpdater(fs);\n-        let pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH));\n+        // TODO: Determine the correct/best type for the `pkg` type.\n+        let pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH)) as EntryPointPackageJson;\n         expect(pkg.__processed_by_ivy_ngcc__).toBeUndefined();\n         expect(pkg.scripts).toBeUndefined();\n \n         markAsProcessed(pkgUpdater, pkg, COMMON_PACKAGE_PATH, ['fesm2015', 'fesm5']);\n-        pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH));\n-        expect(pkg.__processed_by_ivy_ngcc__.fesm2015).toBe('0.0.0-PLACEHOLDER');\n-        expect(pkg.__processed_by_ivy_ngcc__.fesm5).toBe('0.0.0-PLACEHOLDER');\n-        expect(pkg.__processed_by_ivy_ngcc__.esm2015).toBeUndefined();\n-        expect(pkg.__processed_by_ivy_ngcc__.esm5).toBeUndefined();\n-        expect(pkg.scripts.prepublishOnly).toBeDefined();\n+        pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH)) as EntryPointPackageJson;\n+        expect(pkg.__processed_by_ivy_ngcc__!.fesm2015).toBe('0.0.0-PLACEHOLDER');\n+        expect(pkg.__processed_by_ivy_ngcc__!.fesm5).toBe('0.0.0-PLACEHOLDER');\n+        expect(pkg.__processed_by_ivy_ngcc__!.esm2015).toBeUndefined();\n+        expect(pkg.__processed_by_ivy_ngcc__!.esm5).toBeUndefined();\n+        expect(pkg.scripts!.prepublishOnly).toBeDefined();\n \n         markAsProcessed(pkgUpdater, pkg, COMMON_PACKAGE_PATH, ['esm2015', 'esm5']);\n-        pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH));\n-        expect(pkg.__processed_by_ivy_ngcc__.fesm2015).toBe('0.0.0-PLACEHOLDER');\n-        expect(pkg.__processed_by_ivy_ngcc__.fesm5).toBe('0.0.0-PLACEHOLDER');\n-        expect(pkg.__processed_by_ivy_ngcc__.esm2015).toBe('0.0.0-PLACEHOLDER');\n-        expect(pkg.__processed_by_ivy_ngcc__.esm5).toBe('0.0.0-PLACEHOLDER');\n-        expect(pkg.scripts.prepublishOnly).toBeDefined();\n+        pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH)) as EntryPointPackageJson;\n+        expect(pkg.__processed_by_ivy_ngcc__!.fesm2015).toBe('0.0.0-PLACEHOLDER');\n+        expect(pkg.__processed_by_ivy_ngcc__!.fesm5).toBe('0.0.0-PLACEHOLDER');\n+        expect(pkg.__processed_by_ivy_ngcc__!.esm2015).toBe('0.0.0-PLACEHOLDER');\n+        expect(pkg.__processed_by_ivy_ngcc__!.esm5).toBe('0.0.0-PLACEHOLDER');\n+        expect(pkg.scripts!.prepublishOnly).toBeDefined();\n       });\n \n       it('should update the packageJson object in-place', () => {\n         const COMMON_PACKAGE_PATH = _('/node_modules/@angular/common/package.json');\n         const fs = getFileSystem();\n         const pkgUpdater = new DirectPackageJsonUpdater(fs);\n-        const pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH));\n+        const pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH)) as EntryPointPackageJson;\n         expect(pkg.__processed_by_ivy_ngcc__).toBeUndefined();\n         expect(pkg.scripts).toBeUndefined();\n \n         markAsProcessed(pkgUpdater, pkg, COMMON_PACKAGE_PATH, ['fesm2015', 'fesm5']);\n-        expect(pkg.__processed_by_ivy_ngcc__.fesm2015).toBe('0.0.0-PLACEHOLDER');\n-        expect(pkg.__processed_by_ivy_ngcc__.fesm5).toBe('0.0.0-PLACEHOLDER');\n-        expect(pkg.__processed_by_ivy_ngcc__.esm2015).toBeUndefined();\n-        expect(pkg.__processed_by_ivy_ngcc__.esm5).toBeUndefined();\n-        expect(pkg.scripts.prepublishOnly).toBeDefined();\n+        expect(pkg.__processed_by_ivy_ngcc__!.fesm2015).toBe('0.0.0-PLACEHOLDER');\n+        expect(pkg.__processed_by_ivy_ngcc__!.fesm5).toBe('0.0.0-PLACEHOLDER');\n+        expect(pkg.__processed_by_ivy_ngcc__!.esm2015).toBeUndefined();\n+        expect(pkg.__processed_by_ivy_ngcc__!.esm5).toBeUndefined();\n+        expect(pkg.scripts!.prepublishOnly).toBeDefined();\n \n         markAsProcessed(pkgUpdater, pkg, COMMON_PACKAGE_PATH, ['esm2015', 'esm5']);\n-        expect(pkg.__processed_by_ivy_ngcc__.fesm2015).toBe('0.0.0-PLACEHOLDER');\n-        expect(pkg.__processed_by_ivy_ngcc__.fesm5).toBe('0.0.0-PLACEHOLDER');\n-        expect(pkg.__processed_by_ivy_ngcc__.esm2015).toBe('0.0.0-PLACEHOLDER');\n-        expect(pkg.__processed_by_ivy_ngcc__.esm5).toBe('0.0.0-PLACEHOLDER');\n-        expect(pkg.scripts.prepublishOnly).toBeDefined();\n+        expect(pkg.__processed_by_ivy_ngcc__!.fesm2015).toBe('0.0.0-PLACEHOLDER');\n+        expect(pkg.__processed_by_ivy_ngcc__!.fesm5).toBe('0.0.0-PLACEHOLDER');\n+        expect(pkg.__processed_by_ivy_ngcc__!.esm2015).toBe('0.0.0-PLACEHOLDER');\n+        expect(pkg.__processed_by_ivy_ngcc__!.esm5).toBe('0.0.0-PLACEHOLDER');\n+        expect(pkg.scripts!.prepublishOnly).toBeDefined();\n       });\n \n       it('should one perform one write operation for all updated properties', () => {\n         const COMMON_PACKAGE_PATH = _('/node_modules/@angular/common/package.json');\n         const fs = getFileSystem();\n         const pkgUpdater = new DirectPackageJsonUpdater(fs);\n         const writeFileSpy = spyOn(fs, 'writeFile');\n-        let pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH));\n+        let pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH)) as EntryPointPackageJson;\n \n         markAsProcessed(\n             pkgUpdater, pkg, COMMON_PACKAGE_PATH, ['fesm2015', 'fesm5', 'esm2015', 'esm5']);\n@@ -146,34 +147,34 @@ runInEachFileSystem(() => {\n         const fs = getFileSystem();\n         const pkgUpdater = new DirectPackageJsonUpdater(fs);\n         const prepublishOnly = 'existing script';\n-        let pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH));\n+        let pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH)) as EntryPointPackageJson;\n         pkg.scripts = {prepublishOnly};\n \n         markAsProcessed(pkgUpdater, pkg, COMMON_PACKAGE_PATH, ['fesm2015']);\n-        pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH));\n-        expect(pkg.scripts.prepublishOnly).toContain('This is not allowed');\n-        expect(pkg.scripts.prepublishOnly__ivy_ngcc_bak).toBe(prepublishOnly);\n+        pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH)) as EntryPointPackageJson;\n+        expect(pkg.scripts!.prepublishOnly).toContain('This is not allowed');\n+        expect(pkg.scripts!.prepublishOnly__ivy_ngcc_bak).toBe(prepublishOnly);\n       });\n \n       it(`should not keep backup of overwritten 'prepublishOnly' script`, () => {\n         const COMMON_PACKAGE_PATH = _('/node_modules/@angular/common/package.json');\n         const fs = getFileSystem();\n         const pkgUpdater = new DirectPackageJsonUpdater(fs);\n-        let pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH));\n+        let pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH)) as EntryPointPackageJson;\n \n         markAsProcessed(pkgUpdater, pkg, COMMON_PACKAGE_PATH, ['fesm2015']);\n \n-        pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH));\n-        expect(pkg.scripts.prepublishOnly).toContain('This is not allowed');\n-        expect(pkg.scripts.prepublishOnly__ivy_ngcc_bak).toBeUndefined();\n+        pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH)) as EntryPointPackageJson;\n+        expect(pkg.scripts!.prepublishOnly).toContain('This is not allowed');\n+        expect(pkg.scripts!.prepublishOnly__ivy_ngcc_bak).toBeUndefined();\n \n         // Running again, now that there is `prepublishOnly` script (created by `ngcc`), it should\n         // still not back it up as `prepublishOnly__ivy_ngcc_bak`.\n         markAsProcessed(pkgUpdater, pkg, COMMON_PACKAGE_PATH, ['fesm2015']);\n \n-        pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH));\n-        expect(pkg.scripts.prepublishOnly).toContain('This is not allowed');\n-        expect(pkg.scripts.prepublishOnly__ivy_ngcc_bak).toBeUndefined();\n+        pkg = JSON.parse(fs.readFile(COMMON_PACKAGE_PATH)) as EntryPointPackageJson;\n+        expect(pkg.scripts!.prepublishOnly).toContain('This is not allowed');\n+        expect(pkg.scripts!.prepublishOnly__ivy_ngcc_bak).toBeUndefined();\n       });\n     });\n "
        },
        {
            "sha": "fe227ea6f39ab216a53c4ea5453a89325b7855d6",
            "filename": "packages/compiler-cli/ngcc/test/packages/configuration_spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fconfiguration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fconfiguration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fconfiguration_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -10,7 +10,7 @@ import {createHash} from 'crypto';\n import {absoluteFrom, getFileSystem, ReadonlyFileSystem} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem} from '../../../src/ngtsc/file_system/testing';\n import {loadTestFiles} from '../../../src/ngtsc/testing';\n-import {DEFAULT_NGCC_CONFIG, NgccConfiguration, ProcessLockingConfiguration} from '../../src/packages/configuration';\n+import {DEFAULT_NGCC_CONFIG, NgccConfiguration, NgccProjectConfig, ProcessLockingConfiguration, RawNgccPackageConfig} from '../../src/packages/configuration';\n \n \n runInEachFileSystem(() => {\n@@ -567,7 +567,9 @@ runInEachFileSystem(() => {\n             entryPoints: {'./default-level-entry-point': {}},\n           };\n         });\n-        afterEach(() => DEFAULT_NGCC_CONFIG.packages = JSON.parse(originalDefaultConfig));\n+        afterEach(\n+            () => DEFAULT_NGCC_CONFIG.packages =\n+                JSON.parse(originalDefaultConfig) as NgccProjectConfig['packages']);\n \n         it('should return configuration for a package found in the default config', () => {\n           const readFileSpy = spyOn(fs, 'readFile').and.callThrough();"
        },
        {
            "sha": "9a608c15f1007b85f1389f4c21a2ce7eb7255961",
            "filename": "packages/compiler-cli/ngcc/test/packages/entry_point_manifest_spec.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 10,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_manifest_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_manifest_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_manifest_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -265,34 +265,38 @@ runInEachFileSystem(() => {\n       it('should write the ngcc version', () => {\n         fs.writeFile(_Abs('/project/yarn.lock'), 'LOCK FILE CONTENTS');\n         manifest.writeEntryPointManifest(_Abs('/project/node_modules'), []);\n-        const file: EntryPointManifestFile =\n-            JSON.parse(fs.readFile(_Abs('/project/node_modules/__ngcc_entry_points__.json')));\n+        const file =\n+            JSON.parse(fs.readFile(_Abs('/project/node_modules/__ngcc_entry_points__.json'))) as\n+            EntryPointManifestFile;\n         expect(file.ngccVersion).toEqual(NGCC_VERSION);\n       });\n \n       it('should write a hash of the yarn.lock file', () => {\n         fs.writeFile(_Abs('/project/yarn.lock'), 'LOCK FILE CONTENTS');\n         manifest.writeEntryPointManifest(_Abs('/project/node_modules'), []);\n-        const file: EntryPointManifestFile =\n-            JSON.parse(fs.readFile(_Abs('/project/node_modules/__ngcc_entry_points__.json')));\n+        const file =\n+            JSON.parse(fs.readFile(_Abs('/project/node_modules/__ngcc_entry_points__.json'))) as\n+            EntryPointManifestFile;\n         expect(file.lockFileHash)\n             .toEqual(createHash('md5').update('LOCK FILE CONTENTS').digest('hex'));\n       });\n \n       it('should write a hash of the package-lock.json file', () => {\n         fs.writeFile(_Abs('/project/package-lock.json'), 'LOCK FILE CONTENTS');\n         manifest.writeEntryPointManifest(_Abs('/project/node_modules'), []);\n-        const file: EntryPointManifestFile =\n-            JSON.parse(fs.readFile(_Abs('/project/node_modules/__ngcc_entry_points__.json')));\n+        const file =\n+            JSON.parse(fs.readFile(_Abs('/project/node_modules/__ngcc_entry_points__.json'))) as\n+            EntryPointManifestFile;\n         expect(file.lockFileHash)\n             .toEqual(createHash('md5').update('LOCK FILE CONTENTS').digest('hex'));\n       });\n \n       it('should write a hash of the project config', () => {\n         fs.writeFile(_Abs('/project/package-lock.json'), 'LOCK FILE CONTENTS');\n         manifest.writeEntryPointManifest(_Abs('/project/node_modules'), []);\n-        const file: EntryPointManifestFile =\n-            JSON.parse(fs.readFile(_Abs('/project/node_modules/__ngcc_entry_points__.json')));\n+        const file =\n+            JSON.parse(fs.readFile(_Abs('/project/node_modules/__ngcc_entry_points__.json'))) as\n+            EntryPointManifestFile;\n         expect(file.configFileHash).toEqual(config.hash);\n       });\n \n@@ -329,8 +333,9 @@ runInEachFileSystem(() => {\n           }\n         };\n         manifest.writeEntryPointManifest(_Abs('/project/node_modules'), [entryPoint1, entryPoint2]);\n-        const file: EntryPointManifestFile =\n-            JSON.parse(fs.readFile(_Abs('/project/node_modules/__ngcc_entry_points__.json')));\n+        const file =\n+            JSON.parse(fs.readFile(_Abs('/project/node_modules/__ngcc_entry_points__.json'))) as\n+            EntryPointManifestFile;\n         expect(file.entryPointPaths).toEqual([\n           [\n             'package-1',"
        },
        {
            "sha": "db9ec15c247dbcdfc9a126071d6db551659e0641",
            "filename": "packages/compiler-cli/ngcc/test/packages/entry_point_spec.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 8,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fpackages%2Fentry_point_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -11,7 +11,7 @@ import {runInEachFileSystem} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n import {loadTestFiles} from '../../../src/ngtsc/testing';\n import {NgccConfiguration, ProcessedNgccPackageConfig} from '../../src/packages/configuration';\n-import {EntryPoint, EntryPointJsonProperty, getEntryPointFormat, getEntryPointInfo, IGNORED_ENTRY_POINT, INCOMPATIBLE_ENTRY_POINT, isEntryPoint, NO_ENTRY_POINT, SUPPORTED_FORMAT_PROPERTIES} from '../../src/packages/entry_point';\n+import {EntryPoint, EntryPointJsonProperty, EntryPointPackageJson, getEntryPointFormat, getEntryPointInfo, IGNORED_ENTRY_POINT, INCOMPATIBLE_ENTRY_POINT, isEntryPoint, NO_ENTRY_POINT, SUPPORTED_FORMAT_PROPERTIES} from '../../src/packages/entry_point';\n \n runInEachFileSystem(() => {\n   describe('getEntryPointInfo()', () => {\n@@ -116,8 +116,8 @@ runInEachFileSystem(() => {\n       ]);\n \n       const config = new NgccConfiguration(fs, _('/project'));\n-      const info: EntryPoint =\n-          getEntryPointInfo(fs, config, new MockLogger(), SOME_PACKAGE, entryPointPath) as any;\n+      const info = getEntryPointInfo(fs, config, new MockLogger(), SOME_PACKAGE, entryPointPath) as\n+          EntryPoint;\n \n       expect(info.packageJson).toEqual(jasmine.objectContaining({packageVersion: '1'}));\n     });\n@@ -159,8 +159,8 @@ runInEachFileSystem(() => {\n       ]);\n \n       const config = new NgccConfiguration(fs, _('/project'));\n-      const info: EntryPoint =\n-          getEntryPointInfo(fs, config, new MockLogger(), SOME_PACKAGE, entryPointPath) as any;\n+      const info = getEntryPointInfo(fs, config, new MockLogger(), SOME_PACKAGE, entryPointPath) as\n+          EntryPoint;\n \n       expect(info.packageJson).toEqual(jasmine.objectContaining({packageVersion: '3'}));\n     });\n@@ -233,7 +233,8 @@ runInEachFileSystem(() => {\n          ]);\n          const config = new NgccConfiguration(fs, _('/project'));\n          const override =\n-             JSON.parse(createPackageJson('missing_package_json', {excludes: ['name']}));\n+             JSON.parse(createPackageJson('missing_package_json', {excludes: ['name']})) as\n+             Partial<EntryPointPackageJson>;\n          spyOn(config, 'getPackageConfig')\n              .and.returnValue(new ProcessedNgccPackageConfig(\n                  fs, _('/project/node_modules/some_package/'),\n@@ -762,7 +763,7 @@ export function createPackageJson(\n       typingsIsArray?: boolean,\n       version?: string\n     } = {}): string {\n-  const packageJson: any = {\n+  const packageJson: EntryPointPackageJson = {\n     name: (entryPointName === '') ? 'some_package' : `some_package/${entryPointName}`,\n     version,\n     [typingsProp]: typingsIsArray ? [`./${entryPointName}.d.ts`] : `./${entryPointName}.d.ts`,\n@@ -782,5 +783,6 @@ export function createPackageJson(\n }\n \n export function loadPackageJson(fs: ReadonlyFileSystem, packagePath: string) {\n-  return JSON.parse(fs.readFile(fs.resolve(packagePath + '/package.json')));\n+  return JSON.parse(fs.readFile(fs.resolve(packagePath + '/package.json'))) as\n+      EntryPointPackageJson;\n }"
        },
        {
            "sha": "58654cebdf5792de59e8c874e6517ea450b618c9",
            "filename": "packages/compiler-cli/ngcc/test/rendering/renderer_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Frenderer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Frenderer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Frendering%2Frenderer_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -641,7 +641,8 @@ UndecoratedBase.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: UndecoratedBase, vie\n              expect(sourceFile.contents)\n                  .toEqual(RENDERED_CONTENTS + '\\n' + generateMapFileComment('file.js.map'));\n              expect(mapFile.path).toEqual(_('/node_modules/test-package/src/file.js.map'));\n-             expect(JSON.parse(mapFile.contents)).toEqual(MERGED_OUTPUT_PROGRAM_MAP.toObject());\n+             expect(JSON.parse(mapFile.contents) as any)\n+                 .toEqual(MERGED_OUTPUT_PROGRAM_MAP.toObject());\n            });\n \n "
        },
        {
            "sha": "8964593af58a1adb19df285b3320798206396e0a",
            "filename": "packages/compiler-cli/ngcc/test/writing/cleaning/cleaning_strategies_spec.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fcleaning%2Fcleaning_strategies_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fcleaning%2Fcleaning_strategies_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fcleaning%2Fcleaning_strategies_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -47,7 +47,7 @@ runInEachFileSystem(() => {\n           fs.ensureDir(fs.dirname(packageJsonPath));\n           fs.writeFile(packageJsonPath, JSON.stringify(packageJson));\n           strategy.clean(packageJsonPath, fs.basename(packageJsonPath));\n-          const newPackageJson: EntryPointPackageJson = JSON.parse(fs.readFile(packageJsonPath));\n+          const newPackageJson = JSON.parse(fs.readFile(packageJsonPath)) as EntryPointPackageJson;\n           expect(newPackageJson).toEqual({name: 'test-package'});\n         });\n \n@@ -60,7 +60,7 @@ runInEachFileSystem(() => {\n           fs.ensureDir(fs.dirname(packageJsonPath));\n           fs.writeFile(packageJsonPath, JSON.stringify(packageJson));\n           strategy.clean(packageJsonPath, fs.basename(packageJsonPath));\n-          const newPackageJson: EntryPointPackageJson = JSON.parse(fs.readFile(packageJsonPath));\n+          const newPackageJson = JSON.parse(fs.readFile(packageJsonPath)) as EntryPointPackageJson;\n           expect(newPackageJson).toEqual({name: 'test-package'});\n         });\n \n@@ -73,7 +73,7 @@ runInEachFileSystem(() => {\n           fs.ensureDir(fs.dirname(packageJsonPath));\n           fs.writeFile(packageJsonPath, JSON.stringify(packageJson));\n           strategy.clean(packageJsonPath, fs.basename(packageJsonPath));\n-          const newPackageJson: EntryPointPackageJson = JSON.parse(fs.readFile(packageJsonPath));\n+          const newPackageJson = JSON.parse(fs.readFile(packageJsonPath)) as EntryPointPackageJson;\n           expect(newPackageJson).toEqual({name: 'test-package'});\n         });\n \n@@ -87,7 +87,7 @@ runInEachFileSystem(() => {\n           fs.ensureDir(fs.dirname(packageJsonPath));\n           fs.writeFile(packageJsonPath, JSON.stringify(packageJson));\n           strategy.clean(packageJsonPath, fs.basename(packageJsonPath));\n-          const newPackageJson: EntryPointPackageJson = JSON.parse(fs.readFile(packageJsonPath));\n+          const newPackageJson = JSON.parse(fs.readFile(packageJsonPath)) as EntryPointPackageJson;\n           expect(newPackageJson).toEqual({\n             name: 'test-package',\n             scripts: {test: 'do testing'},\n@@ -109,7 +109,8 @@ runInEachFileSystem(() => {\n              fs.ensureDir(fs.dirname(packageJsonPath));\n              fs.writeFile(packageJsonPath, JSON.stringify(packageJson));\n              strategy.clean(packageJsonPath, fs.basename(packageJsonPath));\n-             const newPackageJson: EntryPointPackageJson = JSON.parse(fs.readFile(packageJsonPath));\n+             const newPackageJson =\n+                 JSON.parse(fs.readFile(packageJsonPath)) as EntryPointPackageJson;\n              expect(newPackageJson).toEqual({\n                name: 'test-package',\n                scripts: {prepublishOnly: 'original', test: 'do testing'},\n@@ -129,7 +130,7 @@ runInEachFileSystem(() => {\n           fs.ensureDir(fs.dirname(packageJsonPath));\n           fs.writeFile(packageJsonPath, JSON.stringify(packageJson));\n           strategy.clean(packageJsonPath, fs.basename(packageJsonPath));\n-          const newPackageJson: EntryPointPackageJson = JSON.parse(fs.readFile(packageJsonPath));\n+          const newPackageJson = JSON.parse(fs.readFile(packageJsonPath)) as EntryPointPackageJson;\n           expect(newPackageJson).toEqual({\n             name: 'test-package',\n             scripts: {"
        },
        {
            "sha": "3549d0c2faf665243e6955c9e3e96af8b5a6814f",
            "filename": "packages/compiler-cli/ngcc/test/writing/new_entry_point_file_writer_spec.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 4,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fnew_entry_point_file_writer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fnew_entry_point_file_writer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fnew_entry_point_file_writer_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -8,10 +8,12 @@\n import {absoluteFrom, FileSystem, getFileSystem} from '../../../src/ngtsc/file_system';\n import {runInEachFileSystem} from '../../../src/ngtsc/file_system/testing';\n import {MockLogger} from '../../../src/ngtsc/logging/testing';\n+import {RawSourceMap} from '../../../src/ngtsc/sourcemaps';\n import {loadTestFiles} from '../../../src/ngtsc/testing';\n import {NgccConfiguration} from '../../src/packages/configuration';\n import {EntryPoint, EntryPointFormat, EntryPointJsonProperty, getEntryPointInfo, isEntryPoint} from '../../src/packages/entry_point';\n import {EntryPointBundle, makeEntryPointBundle} from '../../src/packages/entry_point_bundle';\n+import {NewEntryPointPropertiesMap} from '../../src/packages/entry_point_manifest';\n import {createModuleResolutionCache, SharedFileCache} from '../../src/packages/source_file_cache';\n import {FileWriter} from '../../src/writing/file_writer';\n import {NewEntryPointFileWriter} from '../../src/writing/new_entry_point_file_writer';\n@@ -184,7 +186,9 @@ runInEachFileSystem(() => {\n            }];\n            fileWriter.writeBundle(esm2015bundle, modifiedFiles, ['es2015']);\n \n-           expect(JSON.parse(fs.readFile(_('/node_modules/test/__ivy_ngcc__/es2015/index.js.map'))))\n+           expect(\n+               JSON.parse(fs.readFile(_('/node_modules/test/__ivy_ngcc__/es2015/index.js.map'))) as\n+               Partial<RawSourceMap>)\n                .toEqual({...sourceMap, sourceRoot: '../../es2015'});\n          });\n \n@@ -213,7 +217,9 @@ runInEachFileSystem(() => {\n            }];\n            fileWriter.writeBundle(esm2015bundle, modifiedFiles, ['es2015']);\n \n-           expect(JSON.parse(fs.readFile(_('/node_modules/test/__ivy_ngcc__/es2015/index.js.map'))))\n+           expect(\n+               JSON.parse(fs.readFile(_('/node_modules/test/__ivy_ngcc__/es2015/index.js.map'))) as\n+               Partial<RawSourceMap>)\n                .toEqual({...sourceMap, sourceRoot: '../../src'});\n          });\n \n@@ -678,7 +684,8 @@ runInEachFileSystem(() => {\n               },\n             ],\n             ['fesm5', 'module']);\n-        const packageJsonFromFile1 = JSON.parse(fs.readFile(packageJsonPath));\n+        const packageJsonFromFile1 =\n+            JSON.parse(fs.readFile(packageJsonPath)) as NewEntryPointPropertiesMap;\n \n         expect(entryPoint.packageJson).toEqual(jasmine.objectContaining({\n           fesm5_ivy_ngcc: '__ivy_ngcc__/esm5.js',\n@@ -698,7 +705,8 @@ runInEachFileSystem(() => {\n             esm5bundle.entryPoint,\n             [_('/node_modules/test/index.d.ts'), _('/node_modules/test/index.d.ts.map')],\n             ['fesm5', 'module']);\n-        const packageJsonFromFile2 = JSON.parse(fs.readFile(packageJsonPath));\n+        const packageJsonFromFile2 =\n+            JSON.parse(fs.readFile(packageJsonPath)) as NewEntryPointPropertiesMap;\n \n         expect(entryPoint.packageJson).toEqual(jasmine.objectContaining({\n           fesm5: './esm5.js',"
        },
        {
            "sha": "2c7ff81879f99e7f33d01b797e323d9b8869d84a",
            "filename": "packages/compiler-cli/ngcc/test/writing/package_json_updater_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fpackage_json_updater_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fpackage_json_updater_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fngcc%2Ftest%2Fwriting%2Fpackage_json_updater_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -18,7 +18,7 @@ runInEachFileSystem(() => {\n     let updater: PackageJsonUpdater;\n \n     // Helpers\n-    const readJson = (path: AbsoluteFsPath) => JSON.parse(fs.readFile(path));\n+    const readJson = <T>(path: AbsoluteFsPath) => JSON.parse(fs.readFile(path)) as T;\n \n     beforeEach(() => {\n       _ = absoluteFrom;\n@@ -55,7 +55,7 @@ runInEachFileSystem(() => {\n         {name: jsonPath, contents: '{\"foo\": true, \"bar\": {\"baz\": \"OK\"}}'},\n       ]);\n \n-      const pkg = readJson(jsonPath);\n+      const pkg = readJson<{foo: boolean, bar: {baz: string | number}}>(jsonPath);\n       const update = updater.createUpdate().addChange(['foo'], false).addChange(['bar', 'baz'], 42);\n \n       // Not updated yet.\n@@ -95,7 +95,7 @@ runInEachFileSystem(() => {\n         {name: jsonPath, contents: '{\"foo\": {}}'},\n       ]);\n \n-      const pkg = readJson(jsonPath);\n+      const pkg = readJson<{foo: {bar: {baz: {qux: string}}}}>(jsonPath);\n       updater.createUpdate()\n           .addChange(['foo', 'bar', 'baz', 'qux'], 'updated')\n           .writeChanges(jsonPath, pkg);"
        },
        {
            "sha": "bb6721cc12c34a04f530eafa6297a7a61c6add76",
            "filename": "packages/compiler-cli/src/ngtsc/sourcemaps/src/source_file_loader.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file_loader.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file_loader.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Fngtsc%2Fsourcemaps%2Fsrc%2Fsource_file_loader.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -226,7 +226,7 @@ export class SourceFileLoader {\n    */\n   private readRawSourceMap(mapPath: AbsoluteFsPath): RawSourceMap {\n     this.trackPath(mapPath);\n-    return JSON.parse(this.fs.readFile(mapPath));\n+    return JSON.parse(this.fs.readFile(mapPath)) as RawSourceMap;\n   }\n \n   /**"
        },
        {
            "sha": "185f92aa51770d52ccd33a3118da4a90e6eb8bec",
            "filename": "packages/compiler-cli/src/transformers/compiler_host.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fsrc%2Ftransformers%2Fcompiler_host.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fsrc%2Ftransformers%2Fcompiler_host.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Ftransformers%2Fcompiler_host.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -584,13 +584,15 @@ export class TsCompilerAotCompilerTypeCheckHostAdapter implements ts.CompilerHos\n             if (this.originalFileExists(packageFile)) {\n               // Once we see a package.json file, assume false until it we find the bundle index.\n               result = false;\n-              const packageContent: any = JSON.parse(assert(this.context.readFile(packageFile)));\n+              const packageContent =\n+                  JSON.parse(assert(this.context.readFile(packageFile))) as {typings: string};\n               if (packageContent.typings) {\n                 const typings = path.normalize(path.join(directory, packageContent.typings));\n                 if (DTS.test(typings)) {\n                   const metadataFile = typings.replace(DTS, '.metadata.json');\n                   if (this.originalFileExists(metadataFile)) {\n-                    const metadata = JSON.parse(assert(this.context.readFile(metadataFile)));\n+                    const metadata = JSON.parse(assert(this.context.readFile(metadataFile))) as\n+                        {flatModuleIndexRedirect: string, importAs: string};\n                     if (metadata.flatModuleIndexRedirect) {\n                       this.flatModuleIndexRedirectNames.add(typings);\n                       // Note: don't set result = true,"
        },
        {
            "sha": "3acebdd71c2b3cfc8a3d6a0ba613abbb9e99ca0a",
            "filename": "packages/compiler-cli/src/transformers/metadata_reader.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fsrc%2Ftransformers%2Fmetadata_reader.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Fsrc%2Ftransformers%2Fmetadata_reader.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Fsrc%2Ftransformers%2Fmetadata_reader.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -70,8 +70,9 @@ function readMetadataFile(host: MetadataReaderHost, dtsFilePath: string): Module\n     return undefined;\n   }\n   try {\n-    const metadataOrMetadatas = JSON.parse(host.readFile(metadataPath));\n-    const metadatas: ModuleMetadata[] = metadataOrMetadatas ?\n+    const metadataOrMetadatas =\n+        JSON.parse(host.readFile(metadataPath)) as ModuleMetadata | ModuleMetadata[] | undefined;\n+    const metadatas = metadataOrMetadatas ?\n         (Array.isArray(metadataOrMetadatas) ? metadataOrMetadatas : [metadataOrMetadatas]) :\n         [];\n     if (metadatas.length) {"
        },
        {
            "sha": "503d3fc8bac37ca307fa173720b032b89615a7e0",
            "filename": "packages/compiler-cli/test/compliance/linked/linked_compile_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Flinked%2Flinked_compile_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Flinked%2Flinked_compile_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Flinked%2Flinked_compile_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -60,7 +60,7 @@ function linkPartials(fileSystem: FileSystem, test: ComplianceTest): CompileResu\n       const source = fileSystem.readFile(fileName);\n       const sourceMapPath = fileSystem.resolve(fileName + '.map');\n       const sourceMap = fileSystem.exists(sourceMapPath) ?\n-          JSON.parse(fileSystem.readFile(sourceMapPath)) :\n+          JSON.parse(fileSystem.readFile(sourceMapPath)) as RawSourceMap :\n           undefined;\n       const {linkedSource, linkedSourceMap} =\n           applyLinker(builtDirectory, fileName, source, sourceMap, linkerPlugin);"
        },
        {
            "sha": "e47479470632a8c8b5e927e0b59b8f4643a84a47",
            "filename": "packages/compiler-cli/test/compliance/test_helpers/get_compliance_tests.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 2,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fget_compliance_tests.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fget_compliance_tests.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fcompliance%2Ftest_helpers%2Fget_compliance_tests.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -55,9 +55,9 @@ export function* getComplianceTests(testConfigPath: string): Generator<Complianc\n }\n \n function loadTestCasesFile(\n-    fs: ReadonlyFileSystem, testCasesPath: AbsoluteFsPath, basePath: AbsoluteFsPath): any {\n+    fs: ReadonlyFileSystem, testCasesPath: AbsoluteFsPath, basePath: AbsoluteFsPath) {\n   try {\n-    return JSON.parse(fs.readFile(testCasesPath));\n+    return JSON.parse(fs.readFile(testCasesPath)) as {cases: TestCaseJson | TestCaseJson[]};\n   } catch (e) {\n     throw new Error(\n         `Failed to load test-cases at \"${fs.relative(basePath, testCasesPath)}\":\\n ${e.message}`);\n@@ -298,3 +298,24 @@ export type ExtraCheck = (string|[string, ...any]);\n  * Options to pass to configure the compiler.\n  */\n export type ConfigOptions = Record<string, string|boolean|null>;\n+\n+\n+\n+/**\n+ * Interface espressing the type for the json object found at ../test_cases/test_case_schema.json.\n+ */\n+export interface TestCaseJson {\n+  description: string;\n+  compilationModeFilter?: ('fulll compile'|'linked compile')[];\n+  inputFiles?: string[];\n+  expectations?: {\n+    failureMessage?: string;\n+    files?: ExpectedFile[] | string;\n+    expectedErrors?: {message: string, location?: string};\n+    extraChecks?: (string | string[])[];\n+  };\n+  compilerOptions?: ConfigOptions;\n+  angularCompilerOptions?: ConfigOptions;\n+  focusTest?: boolean;\n+  excludeTest?: boolean;\n+}"
        },
        {
            "sha": "d525205d16bb41297bdcc460157370bd5521bc04",
            "filename": "packages/compiler-cli/test/ngtsc/sourcemap_utils.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fsourcemap_utils.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fsourcemap_utils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Fngtsc%2Fsourcemap_utils.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -5,7 +5,7 @@\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-import {MappingItem, SourceMapConsumer} from 'source-map';\n+import {MappingItem, RawSourceMap, SourceMapConsumer} from 'source-map';\n import {NgtscTestEnvironment} from './env';\n \n class TestSourceFile {\n@@ -72,7 +72,7 @@ export function getMappedSegments(\n   const mappings: MappingItem[] = [];\n \n   const mapContents = env.getContents(sourceMapFileName);\n-  const sourceMapConsumer = new SourceMapConsumer(JSON.parse(mapContents));\n+  const sourceMapConsumer = new SourceMapConsumer(JSON.parse(mapContents) as RawSourceMap);\n   sourceMapConsumer.eachMapping(item => {\n     if (!sources.has(item.source)) {\n       sources.set(item.source, new TestSourceFile(item.source, env.getContents(item.source)));"
        },
        {
            "sha": "1d2f3033210d819578f0d68ea094cd01d50a6e06",
            "filename": "packages/compiler-cli/test/transformers/node_emitter_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Ftest%2Ftransformers%2Fnode_emitter_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/b75d7cb11f6e4dce8c6518a9961d7ad8e035605e/packages%2Fcompiler-cli%2Ftest%2Ftransformers%2Fnode_emitter_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcompiler-cli%2Ftest%2Ftransformers%2Fnode_emitter_spec.ts?ref=b75d7cb11f6e4dce8c6518a9961d7ad8e035605e",
            "patch": "@@ -518,7 +518,7 @@ describe('TypeScriptNodeEmitter', () => {\n       const sourceMapBase64 = sourceMapMatch![1];\n       const sourceMapBuffer = Buffer.from(sourceMapBase64, 'base64');\n       const sourceMapText = sourceMapBuffer.toString('utf8');\n-      const sourceMapParsed = JSON.parse(sourceMapText);\n+      const sourceMapParsed = JSON.parse(sourceMapText) as unknown;\n       const consumer = new sourceMap.SourceMapConsumer(sourceMapParsed);\n       const mappings: any[] = [];\n       consumer.eachMapping((mapping: any) => {"
        }
    ],
    "stats": {
        "total": 260,
        "additions": 159,
        "deletions": 101
    }
}