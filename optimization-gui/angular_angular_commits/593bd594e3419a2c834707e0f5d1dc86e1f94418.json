{
    "author": "josephperrott",
    "message": "build: create temporary script for symbol extractor tests (#38819)\n\nCreates a temporary script to running all symbol extractor tests.\n\nPR Close #38819",
    "sha": "593bd594e3419a2c834707e0f5d1dc86e1f94418",
    "files": [
        {
            "sha": "01e041a38e5714095f3032ef5a65bd79ec026ac0",
            "filename": "package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/593bd594e3419a2c834707e0f5d1dc86e1f94418/package.json",
            "raw_url": "https://github.com/angular/angular/raw/593bd594e3419a2c834707e0f5d1dc86e1f94418/package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/package.json?ref=593bd594e3419a2c834707e0f5d1dc86e1f94418",
            "patch": "@@ -35,6 +35,8 @@\n     \"tslint\": \"tsc -p tools/tsconfig.json && tslint -c tslint.json \\\"+(dev-infra|packages|modules|scripts|tools)/**/*.+(js|ts)\\\"\",\n     \"public-api:check\": \"node goldens/public-api/manage.js test\",\n     \"public-api:update\": \"node goldens/public-api/manage.js accept\",\n+    \"symbol-extractor:check\": \"node tools/symbol-extractor/run_all_symbols_extractor_tests.js test\",\n+    \"symbol-extractor:update\": \"node tools/symbol-extractor/run_all_symbols_extractor_tests.js accept\",\n     \"ts-circular-deps\": \"ts-node --transpile-only -- dev-infra/ts-circular-dependencies/index.ts --config ./packages/circular-deps-test.conf.js\",\n     \"ts-circular-deps:check\": \"yarn -s ts-circular-deps check\",\n     \"ts-circular-deps:approve\": \"yarn -s ts-circular-deps approve\","
        },
        {
            "sha": "025ca1ee10c23f44bf96966dbdffb2b7c61b312e",
            "filename": "packages/core/test/bundling/README.md",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/593bd594e3419a2c834707e0f5d1dc86e1f94418/packages%2Fcore%2Ftest%2Fbundling%2FREADME.md",
            "raw_url": "https://github.com/angular/angular/raw/593bd594e3419a2c834707e0f5d1dc86e1f94418/packages%2Fcore%2Ftest%2Fbundling%2FREADME.md",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftest%2Fbundling%2FREADME.md?ref=593bd594e3419a2c834707e0f5d1dc86e1f94418",
            "patch": "@@ -1,13 +1,21 @@\n # Bundle\n \n ## `js_expected_symbol_test`\n-This folder contains tests which assert that most of the code is tree shaken away. \n-This is asserted by keeping gold files of all symbols which are expected to be retained. \n+This folder contains tests which assert that most of the code is tree shaken away.\n+This is asserted by keeping gold files of all symbols which are expected to be retained.\n When doing renaming it is often necessary to update the gold files, to do so use these commands:\n \n ```\n yarn bazel run --config=ivy //packages/core/test/bundling/cyclic_import:symbol_test.accept\n yarn bazel run --config=ivy //packages/core/test/bundling/hello_world:symbol_test.accept\n yarn bazel run --config=ivy //packages/core/test/bundling/injection:symbol_test.accept\n yarn bazel run --config=ivy //packages/core/test/bundling/todo:symbol_test.accept\n-```\n\\ No newline at end of file\n+```\n+\n+## Running all symbol tests\n+To run all symbol tests with one command, you can use the following scripts:\n+\n+```\n+yarn run symbol-extractor:check\n+yarn run symbol-extractor:update\n+```"
        },
        {
            "sha": "dc53de825533d1ed2ee2991d4adab51720c35249",
            "filename": "tools/symbol-extractor/run_all_symbols_extractor_tests.js",
            "status": "added",
            "additions": 68,
            "deletions": 0,
            "changes": 68,
            "blob_url": "https://github.com/angular/angular/blob/593bd594e3419a2c834707e0f5d1dc86e1f94418/tools%2Fsymbol-extractor%2Frun_all_symbols_extractor_tests.js",
            "raw_url": "https://github.com/angular/angular/raw/593bd594e3419a2c834707e0f5d1dc86e1f94418/tools%2Fsymbol-extractor%2Frun_all_symbols_extractor_tests.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fsymbol-extractor%2Frun_all_symbols_extractor_tests.js?ref=593bd594e3419a2c834707e0f5d1dc86e1f94418",
            "patch": "@@ -0,0 +1,68 @@\n+/**\n+ * @license\n+ * Copyright Google LLC All Rights Reserved.\n+ *\n+ * Use of this source code is governed by an MIT-style license that can be\n+ * found in the LICENSE file at https://angular.io/license\n+ */\n+\n+// TODO(josephperrott): migrate golden testing to ng-dev toolset\n+const {spawnSync} = require('child_process');\n+const minimist = require('minimist');\n+const path = require('path');\n+\n+// Remove all command line flags from the arguments.\n+const argv = minimist(process.argv.slice(2));\n+// The command the user would like to run, either 'accept' or 'test'\n+const USER_COMMAND = argv._[0];\n+// The shell command to query for all tests.\n+// Bazel targets for testing goldens\n+process.stdout.write('Gathering all symbol extractor targets');\n+const ALL_TEST_TARGETS =\n+    spawnSync(\n+        'yarn',\n+        [\n+          '-s', 'bazel', 'query', '--output', 'label',\n+          `kind(nodejs_test, ...) intersect attr(\"tags\", \"symbol_extractor\", ...)`\n+        ],\n+        {encoding: 'utf8', shell: true, cwd: path.resolve(__dirname, '../..')})\n+        .stdout.trim()\n+        .split('\\n')\n+        .map(line => line.trim());\n+process.stdout.clearLine();\n+process.stdout.cursorTo(0);\n+// Bazel targets for generating goldens\n+const ALL_ACCEPT_TARGETS = ALL_TEST_TARGETS.map(test => `${test}.accept`);\n+\n+/** Run the provided bazel commands on each provided target individually. */\n+function runBazelCommandOnTargets(command, targets, present) {\n+  for (const target of targets) {\n+    process.stdout.write(`${present}: ${target}`);\n+    const commandResult =\n+        spawnSync('yarn', ['-s', 'bazel', command, '--config=ivy', target], {encoding: 'utf8'});\n+    process.stdout.clearLine();\n+    process.stdout.cursorTo(0);\n+    if (commandResult.status) {\n+      console.error(`Failed ${command}: ${target}`);\n+      console.group();\n+      console.error(commandResult.stdout || commandResult.stderr);\n+      console.groupEnd();\n+    } else {\n+      console.info(`Successful ${command}: ${target}`);\n+    }\n+  }\n+}\n+\n+switch (USER_COMMAND) {\n+  case 'accept':\n+    runBazelCommandOnTargets('run', ALL_ACCEPT_TARGETS, 'Running');\n+    break;\n+  case 'test':\n+    runBazelCommandOnTargets('test', ALL_TEST_TARGETS, 'Testing');\n+    break;\n+  default:\n+    console.warn('Invalid command provided.');\n+    console.warn();\n+    console.warn(`Run this script with either \"accept\" and \"test\"`);\n+    break;\n+}"
        }
    ],
    "stats": {
        "total": 84,
        "additions": 81,
        "deletions": 3
    }
}