{
    "author": "josephperrott",
    "message": "refactor(dev-infra): separate retrieving targeted branches from printing them (#39897)\n\nSeparate retrieving targeted branches from printing the branches to allow for\nother tools to better integrate with the results.\n\nPR Close #39897",
    "sha": "25e3dc594d4d8ba0325bbfdcd69b280c749df7b8",
    "files": [
        {
            "sha": "b1bb871c2670e35b9b5b878295ad07ecd73281e1",
            "filename": "dev-infra/ng-dev.js",
            "status": "modified",
            "additions": 11,
            "deletions": 14,
            "changes": 25,
            "blob_url": "https://github.com/angular/angular/blob/25e3dc594d4d8ba0325bbfdcd69b280c749df7b8/dev-infra%2Fng-dev.js",
            "raw_url": "https://github.com/angular/angular/raw/25e3dc594d4d8ba0325bbfdcd69b280c749df7b8/dev-infra%2Fng-dev.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fng-dev.js?ref=25e3dc594d4d8ba0325bbfdcd69b280c749df7b8",
            "patch": "@@ -2842,7 +2842,7 @@ function getBranchesFromTargetLabel(label, githubTargetBranch) {\n  * Use of this source code is governed by an MIT-style license that can be\n  * found in the LICENSE file at https://angular.io/license\n  */\n-function checkTargetBranchesForPr(prNumber, jsonOutput = false) {\n+function getTargetBranchesForPr(prNumber) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n         /** The ng-dev configuration. */\n         const config = getConfig();\n@@ -2869,10 +2869,13 @@ function checkTargetBranchesForPr(prNumber, jsonOutput = false) {\n             return;\n         }\n         /** The target branches based on the target label and branch targetted in the Github UI. */\n-        const targets = yield getBranchesFromTargetLabel(targetLabel, githubTargetBranch);\n-        // When requested, print a json output to stdout, rather than using standard ng-dev logging.\n-        if (jsonOutput) {\n-            process.stdout.write(JSON.stringify(targets));\n+        return yield getBranchesFromTargetLabel(targetLabel, githubTargetBranch);\n+    });\n+}\n+function printTargetBranchesForPr(prNumber) {\n+    return tslib.__awaiter(this, void 0, void 0, function* () {\n+        const targets = yield getTargetBranchesForPr(prNumber);\n+        if (targets === undefined) {\n             return;\n         }\n         info.group(`PR #${prNumber} will merge into:`);\n@@ -2890,22 +2893,16 @@ function checkTargetBranchesForPr(prNumber, jsonOutput = false) {\n  */\n /** Builds the command. */\n function builder$5(yargs) {\n-    return yargs\n-        .positional('pr', {\n+    return yargs.positional('pr', {\n         description: 'The pull request number',\n         type: 'number',\n         demandOption: true,\n-    })\n-        .option('json', {\n-        type: 'boolean',\n-        default: false,\n-        description: 'Print response as json',\n     });\n }\n /** Handles the command. */\n-function handler$5({ pr, json }) {\n+function handler$5({ pr }) {\n     return tslib.__awaiter(this, void 0, void 0, function* () {\n-        yield checkTargetBranchesForPr(pr, json);\n+        yield printTargetBranchesForPr(pr);\n     });\n }\n /** yargs command module describing the command.  */"
        },
        {
            "sha": "fd2fff7bbfa1d6028f2de0349761207a4457da89",
            "filename": "dev-infra/pr/check-target-branches/check-target-branches.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/angular/angular/blob/25e3dc594d4d8ba0325bbfdcd69b280c749df7b8/dev-infra%2Fpr%2Fcheck-target-branches%2Fcheck-target-branches.ts",
            "raw_url": "https://github.com/angular/angular/raw/25e3dc594d4d8ba0325bbfdcd69b280c749df7b8/dev-infra%2Fpr%2Fcheck-target-branches%2Fcheck-target-branches.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcheck-target-branches%2Fcheck-target-branches.ts?ref=25e3dc594d4d8ba0325bbfdcd69b280c749df7b8",
            "patch": "@@ -12,7 +12,7 @@ import {GitClient} from '../../utils/git/index';\n import {loadAndValidateConfig} from '../merge/config';\n import {getBranchesFromTargetLabel, getTargetLabelFromPullRequest} from '../merge/target-label';\n \n-export async function checkTargetBranchesForPr(prNumber: number, jsonOutput = false) {\n+export async function getTargetBranchesForPr(prNumber: number) {\n   /** The ng-dev configuration. */\n   const config = getConfig();\n   /** Repo owner and name for the github repository. */\n@@ -38,14 +38,15 @@ export async function checkTargetBranchesForPr(prNumber: number, jsonOutput = fa\n     return;\n   }\n   /** The target branches based on the target label and branch targetted in the Github UI. */\n-  const targets = await getBranchesFromTargetLabel(targetLabel, githubTargetBranch);\n+  return await getBranchesFromTargetLabel(targetLabel, githubTargetBranch);\n+}\n+\n \n-  // When requested, print a json output to stdout, rather than using standard ng-dev logging.\n-  if (jsonOutput) {\n-    process.stdout.write(JSON.stringify(targets));\n+export async function printTargetBranchesForPr(prNumber: number) {\n+  const targets = await getTargetBranchesForPr(prNumber);\n+  if (targets === undefined) {\n     return;\n   }\n-\n   info.group(`PR #${prNumber} will merge into:`);\n   targets.forEach(target => info(`- ${target}`));\n   info.groupEnd();"
        },
        {
            "sha": "a00300378cb9d9ab90b19863378b93011261a6f6",
            "filename": "dev-infra/pr/check-target-branches/cli.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 15,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/25e3dc594d4d8ba0325bbfdcd69b280c749df7b8/dev-infra%2Fpr%2Fcheck-target-branches%2Fcli.ts",
            "raw_url": "https://github.com/angular/angular/raw/25e3dc594d4d8ba0325bbfdcd69b280c749df7b8/dev-infra%2Fpr%2Fcheck-target-branches%2Fcli.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/dev-infra%2Fpr%2Fcheck-target-branches%2Fcli.ts?ref=25e3dc594d4d8ba0325bbfdcd69b280c749df7b8",
            "patch": "@@ -8,31 +8,24 @@\n \n import {Arguments, Argv, CommandModule} from 'yargs';\n \n-import {checkTargetBranchesForPr} from './check-target-branches';\n+import {printTargetBranchesForPr} from './check-target-branches';\n \n export interface CheckTargetBranchesOptions {\n   pr: number;\n-  json: boolean;\n }\n \n /** Builds the command. */\n function builder(yargs: Argv) {\n-  return yargs\n-      .positional('pr', {\n-        description: 'The pull request number',\n-        type: 'number',\n-        demandOption: true,\n-      })\n-      .option('json', {\n-        type: 'boolean',\n-        default: false,\n-        description: 'Print response as json',\n-      });\n+  return yargs.positional('pr', {\n+    description: 'The pull request number',\n+    type: 'number',\n+    demandOption: true,\n+  });\n }\n \n /** Handles the command. */\n-async function handler({pr, json}: Arguments<CheckTargetBranchesOptions>) {\n-  await checkTargetBranchesForPr(pr, json);\n+async function handler({pr}: Arguments<CheckTargetBranchesOptions>) {\n+  await printTargetBranchesForPr(pr);\n }\n \n /** yargs command module describing the command.  */"
        }
    ],
    "stats": {
        "total": 61,
        "additions": 26,
        "deletions": 35
    }
}