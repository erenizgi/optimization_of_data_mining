{
    "author": "gkalpak",
    "message": "refactor(service-worker): make `SwTestHarness.envIsSupported()` a standalone function (#42736)\n\nThis commit makes the `SwTestHarness.envIsSupported()` static method a\nstandalone function. This function is used to determine whether the\ncurrent environment provides the necessary APIs to run the SW tests and\nis independent of `SwTestHarness`, so is no need for it to be a static\nmethod of `SwTestHarness`.\n\nThis is in preparation of switching from our custom typings to the\nofficial TypeScript typings (`lib.webworker.d.ts`).\n\nPR Close #42736",
    "sha": "7df1fa54119bc544a19c6c5352bc843416c16194",
    "files": [
        {
            "sha": "505a0e855d83b3a35a44d9f23c9a36de7f091740",
            "filename": "packages/service-worker/test/integration_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Ftest%2Fintegration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Ftest%2Fintegration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Ftest%2Fintegration_spec.ts?ref=7df1fa54119bc544a19c6c5352bc843416c16194",
            "patch": "@@ -16,12 +16,13 @@ import {Manifest} from '@angular/service-worker/worker/src/manifest';\n import {MockRequest} from '@angular/service-worker/worker/testing/fetch';\n import {MockFileSystemBuilder, MockServerStateBuilder, tmpHashTableForFs} from '@angular/service-worker/worker/testing/mock';\n import {SwTestHarness, SwTestHarnessBuilder} from '@angular/service-worker/worker/testing/scope';\n+import {envIsSupported} from '@angular/service-worker/worker/testing/utils';\n import {Observable} from 'rxjs';\n import {take} from 'rxjs/operators';\n \n (function() {\n // Skip environments that don't support the minimum APIs needed to run the SW tests.\n-if (!SwTestHarness.envIsSupported()) {\n+if (!envIsSupported()) {\n   return;\n }\n "
        },
        {
            "sha": "fe5b04a8b6b8ac31a20ae8343395cbdd07d21e5b",
            "filename": "packages/service-worker/worker/test/data_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Fworker%2Ftest%2Fdata_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Fworker%2Ftest%2Fdata_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Ftest%2Fdata_spec.ts?ref=7df1fa54119bc544a19c6c5352bc843416c16194",
            "patch": "@@ -13,10 +13,11 @@ import {MockCache} from '../testing/cache';\n import {MockRequest} from '../testing/fetch';\n import {MockFileSystemBuilder, MockServerStateBuilder, tmpHashTableForFs} from '../testing/mock';\n import {SwTestHarness, SwTestHarnessBuilder} from '../testing/scope';\n+import {envIsSupported} from '../testing/utils';\n \n (function() {\n // Skip environments that don't support the minimum APIs needed to run the SW tests.\n-if (!SwTestHarness.envIsSupported()) {\n+if (!envIsSupported()) {\n   return;\n }\n "
        },
        {
            "sha": "0a9561dcf2f4b354b4634c31ea14416fc7d63adb",
            "filename": "packages/service-worker/worker/test/happy_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Fworker%2Ftest%2Fhappy_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Fworker%2Ftest%2Fhappy_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Ftest%2Fhappy_spec.ts?ref=7df1fa54119bc544a19c6c5352bc843416c16194",
            "patch": "@@ -15,10 +15,11 @@ import {clearAllCaches, MockCache} from '../testing/cache';\n import {MockRequest, MockResponse} from '../testing/fetch';\n import {MockFileSystem, MockFileSystemBuilder, MockServerState, MockServerStateBuilder, tmpHashTableForFs} from '../testing/mock';\n import {MockClient, SwTestHarness, SwTestHarnessBuilder, WindowClientImpl} from '../testing/scope';\n+import {envIsSupported} from '../testing/utils';\n \n (function() {\n // Skip environments that don't support the minimum APIs needed to run the SW tests.\n-if (!SwTestHarness.envIsSupported()) {\n+if (!envIsSupported()) {\n   return;\n }\n "
        },
        {
            "sha": "8575e20f3e74c28c1827a25c724c142fee54b8c6",
            "filename": "packages/service-worker/worker/test/idle_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/angular/angular/blob/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Fworker%2Ftest%2Fidle_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Fworker%2Ftest%2Fidle_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Ftest%2Fidle_spec.ts?ref=7df1fa54119bc544a19c6c5352bc843416c16194",
            "patch": "@@ -8,10 +8,11 @@\n \n import {IdleScheduler} from '../src/idle';\n import {SwTestHarness, SwTestHarnessBuilder} from '../testing/scope';\n+import {envIsSupported} from '../testing/utils';\n \n (function() {\n // Skip environments that don't support the minimum APIs needed to run the SW tests.\n-if (!SwTestHarness.envIsSupported()) {\n+if (!envIsSupported()) {\n   return;\n }\n "
        },
        {
            "sha": "4f3dc11be90ea857af2326b71aeed1ba02560c16",
            "filename": "packages/service-worker/worker/test/prefetch_spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/angular/angular/blob/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Fworker%2Ftest%2Fprefetch_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Fworker%2Ftest%2Fprefetch_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Ftest%2Fprefetch_spec.ts?ref=7df1fa54119bc544a19c6c5352bc843416c16194",
            "patch": "@@ -12,11 +12,12 @@ import {IdleScheduler} from '../src/idle';\n import {MockCache} from '../testing/cache';\n import {MockRequest} from '../testing/fetch';\n import {MockFileSystemBuilder, MockServerStateBuilder, tmpHashTable, tmpManifestSingleAssetGroup} from '../testing/mock';\n-import {MockExtendableEvent, SwTestHarness, SwTestHarnessBuilder} from '../testing/scope';\n+import {MockExtendableEvent, SwTestHarnessBuilder} from '../testing/scope';\n+import {envIsSupported} from '../testing/utils';\n \n (function() {\n // Skip environments that don't support the minimum APIs needed to run the SW tests.\n-if (!SwTestHarness.envIsSupported()) {\n+if (!envIsSupported()) {\n   return;\n }\n "
        },
        {
            "sha": "8c8b9602d3f2b5f7316ae81be25cf424101a345b",
            "filename": "packages/service-worker/worker/testing/scope.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/angular/angular/blob/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Fworker%2Ftesting%2Fscope.ts",
            "raw_url": "https://github.com/angular/angular/raw/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Fworker%2Ftesting%2Fscope.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Ftesting%2Fscope.ts?ref=7df1fa54119bc544a19c6c5352bc843416c16194",
            "patch": "@@ -132,22 +132,6 @@ export class SwTestHarness extends Adapter<MockCacheStorage> implements ServiceW\n         },\n   } as any;\n \n-  static envIsSupported(): boolean {\n-    if (typeof URL === 'function') {\n-      return true;\n-    }\n-\n-    // If we're in a browser that doesn't support URL at this point, don't go any further\n-    // since browser builds use requirejs which will fail on the `require` call below.\n-    if (typeof window !== 'undefined' && window) {\n-      return false;\n-    }\n-\n-    // In older Node.js versions, the `URL` global does not exist. We can use `url` instead.\n-    const url = (typeof require === 'function') && require('url');\n-    return url && (typeof url.parse === 'function') && (typeof url.resolve === 'function');\n-  }\n-\n   get time() {\n     return this.mockTime;\n   }"
        },
        {
            "sha": "787ab712eca60a076444e3c7025befbe89e0a7fc",
            "filename": "packages/service-worker/worker/testing/utils.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/angular/angular/blob/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Fworker%2Ftesting%2Futils.ts",
            "raw_url": "https://github.com/angular/angular/raw/7df1fa54119bc544a19c6c5352bc843416c16194/packages%2Fservice-worker%2Fworker%2Ftesting%2Futils.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fservice-worker%2Fworker%2Ftesting%2Futils.ts?ref=7df1fa54119bc544a19c6c5352bc843416c16194",
            "patch": "@@ -9,6 +9,27 @@\n import {NormalizedUrl} from '../src/api';\n \n \n+/**\n+ * Determine whether the current environment provides all necessary APIs to run ServiceWorker tests.\n+ *\n+ * @return Whether ServiceWorker tests can be run in the current environment.\n+ */\n+export function envIsSupported(): boolean {\n+  if (typeof URL === 'function') {\n+    return true;\n+  }\n+\n+  // If we're in a browser that doesn't support URL at this point, don't go any further\n+  // since browser builds use requirejs which will fail on the `require` call below.\n+  if (typeof window !== 'undefined' && window) {\n+    return false;\n+  }\n+\n+  // In older Node.js versions, the `URL` global does not exist. We can use `url` instead.\n+  const url = (typeof require === 'function') && require('url');\n+  return url && (typeof url.parse === 'function') && (typeof url.resolve === 'function');\n+}\n+\n /**\n  * Get a normalized representation of a URL relative to a provided base URL.\n  *"
        }
    ],
    "stats": {
        "total": 54,
        "additions": 32,
        "deletions": 22
    }
}