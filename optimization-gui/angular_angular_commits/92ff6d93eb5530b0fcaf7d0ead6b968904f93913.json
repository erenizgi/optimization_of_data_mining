{
    "author": "petebacondarwin",
    "message": "fix(localize): render location in XLIFF 2 even if there is no metadata (#38713)\n\nPreviously, the location of a translation message, in XLIFF 2, was only\nrendered if there were also notes for meaning or description. Now the\nlocation will be rendered even if the other metadata is not provided.\n\nFixes #38705\n\nPR Close #38713",
    "sha": "92ff6d93eb5530b0fcaf7d0ead6b968904f93913",
    "files": [
        {
            "sha": "6dafa6a5d5dc64d175f0562d2c2dbd05a7900136",
            "filename": "packages/localize/src/tools/src/extract/translation_files/xliff2_translation_serializer.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/92ff6d93eb5530b0fcaf7d0ead6b968904f93913/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "raw_url": "https://github.com/angular/angular/raw/92ff6d93eb5530b0fcaf7d0ead6b968904f93913/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Fsrc%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer.ts?ref=92ff6d93eb5530b0fcaf7d0ead6b968904f93913",
            "patch": "@@ -51,7 +51,7 @@ export class Xliff2TranslationSerializer implements TranslationSerializer {\n       }\n       ids.add(id);\n       xml.startTag('unit', {id});\n-      if (message.meaning || message.description) {\n+      if (message.meaning || message.description || message.location) {\n         xml.startTag('notes');\n         if (message.location) {\n           const {file, start, end} = message.location;"
        },
        {
            "sha": "07f89aa5c4540406d9016a613f9336a31009f3b3",
            "filename": "packages/localize/src/tools/test/extract/integration/main_spec.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/92ff6d93eb5530b0fcaf7d0ead6b968904f93913/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/92ff6d93eb5530b0fcaf7d0ead6b968904f93913/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Fintegration%2Fmain_spec.ts?ref=92ff6d93eb5530b0fcaf7d0ead6b968904f93913",
            "patch": "@@ -220,31 +220,49 @@ runInEachFileSystem(() => {\n             `<xliff version=\"2.0\" xmlns=\"urn:oasis:names:tc:xliff:document:2.0\" srcLang=\"en-AU\">`,\n             `  <file id=\"ngi18n\" original=\"ng.template\">`,\n             `    <unit id=\"3291030485717846467\">`,\n+            `      <notes>`,\n+            `        <note category=\"location\">test_files/test.js:2</note>`,\n+            `      </notes>`,\n             `      <segment>`,\n             `        <source>Hello, <ph id=\"0\" equiv=\"PH\" disp=\"name\"/>!</source>`,\n             `      </segment>`,\n             `    </unit>`,\n             `    <unit id=\"8669027859022295761\">`,\n+            `      <notes>`,\n+            `        <note category=\"location\">test_files/test.js:3</note>`,\n+            `      </notes>`,\n             `      <segment>`,\n             `        <source>try<ph id=\"0\" equiv=\"PH\" disp=\"40 + 2\"/>me</source>`,\n             `      </segment>`,\n             `    </unit>`,\n             `    <unit id=\"custom-id\">`,\n+            `      <notes>`,\n+            `        <note category=\"location\">test_files/test.js:4</note>`,\n+            `      </notes>`,\n             `      <segment>`,\n             `        <source>Custom id message</source>`,\n             `      </segment>`,\n             `    </unit>`,\n             `    <unit id=\"${useLegacyIds ? '12345678901234567890' : '273296103957933077'}\">`,\n+            `      <notes>`,\n+            `        <note category=\"location\">test_files/test.js:6</note>`,\n+            `      </notes>`,\n             `      <segment>`,\n             `        <source>Legacy id message</source>`,\n             `      </segment>`,\n             `    </unit>`,\n             `    <unit id=\"custom-id-2\">`,\n+            `      <notes>`,\n+            `        <note category=\"location\">test_files/test.js:8</note>`,\n+            `      </notes>`,\n             `      <segment>`,\n             `        <source>Custom and legacy message</source>`,\n             `      </segment>`,\n             `    </unit>`,\n             `    <unit id=\"2932901491976224757\">`,\n+            `      <notes>`,\n+            `        <note category=\"location\">test_files/test.js:9,10</note>`,\n+            `      </notes>`,\n             `      <segment>`,\n             `        <source>pre<pc id=\"0\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\" dispStart=\"&apos;&lt;span&gt;&apos;\" dispEnd=\"&apos;&lt;/span&gt;&apos;\">` +\n                 `inner-pre<pc id=\"1\" equivStart=\"START_BOLD_TEXT\" equivEnd=\"CLOSE_BOLD_TEXT\" dispStart=\"&apos;&lt;b&gt;&apos;\" dispEnd=\"&apos;&lt;/b&gt;&apos;\">bold</pc>` +"
        },
        {
            "sha": "4a9e8baa895943ae2557026cf02621d3f0968432",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xliff1_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/angular/angular/blob/92ff6d93eb5530b0fcaf7d0ead6b968904f93913/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/92ff6d93eb5530b0fcaf7d0ead6b968904f93913/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff1_translation_serializer_spec.ts?ref=92ff6d93eb5530b0fcaf7d0ead6b968904f93913",
            "patch": "@@ -49,6 +49,13 @@ runInEachFileSystem(() => {\n             mockMessage(\n                 '67890', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'],\n                 {description: 'some description'}),\n+            mockMessage('38705', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'], {\n+              location: {\n+                file: absoluteFrom('/project/file.ts'),\n+                start: {line: 2, column: 7},\n+                end: {line: 3, column: 2}\n+              }\n+            }),\n             mockMessage('13579', ['', 'b', ''], ['START_BOLD_TEXT', 'CLOSE_BOLD_TEXT'], {}),\n             mockMessage('24680', ['a'], [], {meaning: 'meaning', description: 'and description'}),\n             mockMessage('80808', ['multi\\nlines'], [], {}),\n@@ -91,6 +98,13 @@ runInEachFileSystem(() => {\n             `        <source>a<x id=\"START_TAG_SPAN\"/><x id=\"CLOSE_TAG_SPAN\"/>c</source>`,\n             `        <note priority=\"1\" from=\"description\">some description</note>`,\n             `      </trans-unit>`,\n+            `      <trans-unit id=\"38705\" datatype=\"html\">`,\n+            `        <source>a<x id=\"START_TAG_SPAN\"/><x id=\"CLOSE_TAG_SPAN\"/>c</source>`,\n+            `        <context-group purpose=\"location\">`,\n+            `          <context context-type=\"sourcefile\">file.ts</context>`,\n+            `          <context context-type=\"linenumber\">3,4</context>`,\n+            `        </context-group>`,\n+            `      </trans-unit>`,\n             `      <trans-unit id=\"13579\" datatype=\"html\">`,\n             `        <source><x id=\"START_BOLD_TEXT\"/>b<x id=\"CLOSE_BOLD_TEXT\"/></source>`,\n             `      </trans-unit>`,"
        },
        {
            "sha": "d01b6d0ca3f401d1e4a8e528c914452062413a07",
            "filename": "packages/localize/src/tools/test/extract/translation_files/xliff2_translation_serializer_spec.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/92ff6d93eb5530b0fcaf7d0ead6b968904f93913/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/92ff6d93eb5530b0fcaf7d0ead6b968904f93913/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Flocalize%2Fsrc%2Ftools%2Ftest%2Fextract%2Ftranslation_files%2Fxliff2_translation_serializer_spec.ts?ref=92ff6d93eb5530b0fcaf7d0ead6b968904f93913",
            "patch": "@@ -54,6 +54,13 @@ runInEachFileSystem(() => {\n                 end: {line: 3, column: 2}\n               }\n             }),\n+            mockMessage('location-only', ['a', '', 'c'], ['START_TAG_SPAN', 'CLOSE_TAG_SPAN'], {\n+              location: {\n+                file: absoluteFrom('/project/file.ts'),\n+                start: {line: 2, column: 7},\n+                end: {line: 3, column: 2}\n+              }\n+            }),\n             mockMessage('13579', ['', 'b', ''], ['START_BOLD_TEXT', 'CLOSE_BOLD_TEXT'], {}),\n             mockMessage('24680', ['a'], [], {meaning: 'meaning', description: 'and description'}),\n             mockMessage('80808', ['multi\\nlines'], [], {}),\n@@ -101,6 +108,14 @@ runInEachFileSystem(() => {\n             `        <source>a<pc id=\"0\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\"></pc>c</source>`,\n             `      </segment>`,\n             `    </unit>`,\n+            `    <unit id=\"location-only\">`,\n+            `      <notes>`,\n+            `        <note category=\"location\">file.ts:3,4</note>`,\n+            `      </notes>`,\n+            `      <segment>`,\n+            `        <source>a<pc id=\"0\" equivStart=\"START_TAG_SPAN\" equivEnd=\"CLOSE_TAG_SPAN\"></pc>c</source>`,\n+            `      </segment>`,\n+            `    </unit>`,\n             `    <unit id=\"13579\">`,\n             `      <segment>`,\n             `        <source><pc id=\"0\" equivStart=\"START_BOLD_TEXT\" equivEnd=\"CLOSE_BOLD_TEXT\">b</pc></source>`,"
        }
    ],
    "stats": {
        "total": 49,
        "additions": 48,
        "deletions": 1
    }
}