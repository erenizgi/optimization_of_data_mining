{
    "author": "devversion",
    "message": "build: build locale files for legacy saucelabs job (#42230)\n\nGiven that the locale files are now generated through\nBazel, the files are no longer checked-in and the\nlegacy TSC compilation fails due to imports resolving\nto non-existent files. We fix this for the legacy\nsaucelabs job by copying the generated TS files into\nthe sources (which is acceptable for the isolated CI job)\n\nPR Close #42230",
    "sha": "c42041b4198ac0660f64235bf2dc95d166e1962f",
    "files": [
        {
            "sha": "ed7427250311ec66a03593948918cb3a6ed7c142",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 17,
            "deletions": 6,
            "changes": 23,
            "blob_url": "https://github.com/angular/angular/blob/c42041b4198ac0660f64235bf2dc95d166e1962f/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/angular/angular/raw/c42041b4198ac0660f64235bf2dc95d166e1962f/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/.circleci%2Fconfig.yml?ref=c42041b4198ac0660f64235bf2dc95d166e1962f",
            "patch": "@@ -669,11 +669,6 @@ jobs:\n           name: Starting Saucelabs tunnel service\n           command: ./tools/saucelabs/sauce-service.sh run\n           background: true\n-      # add module umd tsc compile option so the test can work\n-      # properly in the legacy browsers\n-      - run: yarn tsc -p packages --module UMD\n-      - run: yarn tsc -p modules --module UMD\n-      - run: yarn bazel build //packages/zone.js:npm_package\n       # Build test fixtures for a test that rely on Bazel-generated fixtures. Note that disabling\n       # specific tests which are reliant on such generated fixtures is not an option as SystemJS\n       # in the Saucelabs legacy job always fetches referenced files, even if the imports would be\n@@ -682,10 +677,26 @@ jobs:\n       - run:\n           name: Preparing Bazel-generated fixtures required in legacy tests\n           command: |\n-            yarn bazel build //packages/core/test:downleveled_es5_fixture\n+            yarn bazel build \\\n+                //packages/core/test:downleveled_es5_fixture \\\n+                //packages/common/locales\n+\n             # Needed for the ES5 downlevel reflector test in `packages/core/test/reflection`.\n+            mkdir -p dist/all/@angular/core/test/reflection/\n             cp dist/bin/packages/core/test/reflection/es5_downleveled_inheritance_fixture.js \\\n               dist/all/@angular/core/test/reflection/es5_downleveled_inheritance_fixture.js\n+            # Locale files are needed for i18n tests running within Saucelabs. These are added\n+            # directly as sources so that the TypeScript compilation of `/packages/tsconfig.json`\n+            # can succeed. Note that the base locale and currencies files are checked-in, so\n+            # we do not need to re-generate those through Bazel.\n+            mkdir -p packages/common/locales/extra\n+            cp dist/bin/packages/common/locales/*.ts packages/common/locales\n+            cp dist/bin/packages/common/locales/extra/*.ts packages/common/locales/extra\n+      # add module umd tsc compile option so the test can work\n+      # properly in the legacy browsers\n+      - run: yarn tsc -p packages --module UMD\n+      - run: yarn tsc -p modules --module UMD\n+      - run: yarn bazel build //packages/zone.js:npm_package\n       - run:\n           # Waiting on ready ensures that we don't run tests too early without Saucelabs not being ready.\n           name: Waiting for Saucelabs tunnel to connect"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 17,
        "deletions": 6
    }
}