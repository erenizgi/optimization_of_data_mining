{
    "author": "AleksanderBodurri",
    "message": "refactor(devtools): migrate cypress tests to use bazel/cypress\n\nPreviously we ran cypress directly. Now we use the `cypress_web_test` rule from rules_nodejs to run cypress through bazel.\n\n//src:devapp is added to the `data` arg of `cypress_web_test`. This invalidates the bazel cache so that cypress tests rerun anytime our demo app (the app being e2e tested) changes.",
    "sha": "0028094192325910b9046d9b38d076e08eaaa4af",
    "files": [
        {
            "sha": "1a7d8b73ee990740c111ed65c41130ad181a002b",
            "filename": "WORKSPACE",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/angular/angular/blob/0028094192325910b9046d9b38d076e08eaaa4af/WORKSPACE",
            "raw_url": "https://github.com/angular/angular/raw/0028094192325910b9046d9b38d076e08eaaa4af/WORKSPACE",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/WORKSPACE?ref=0028094192325910b9046d9b38d076e08eaaa4af",
            "patch": "@@ -102,3 +102,9 @@ load(\n )\n \n _dev_infra_browser_repositories()\n+\n+\n+load(\"@build_bazel_rules_nodejs//toolchains/cypress:cypress_repositories.bzl\", \"cypress_repositories\")\n+\n+# The name you pass here names the external repository you can load cypress_web_test from\n+cypress_repositories(name = \"cypress\", version = \"8.7.0\")"
        },
        {
            "sha": "737ec89f7195e31800a545157f419f6978955125",
            "filename": "cypress/BUILD.bazel",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/angular/angular/blob/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/cypress%2FBUILD.bazel?ref=0028094192325910b9046d9b38d076e08eaaa4af",
            "patch": "@@ -0,0 +1,29 @@\n+load(\"@npm//@bazel/cypress:index.bzl\", \"cypress_web_test\")\n+load(\"@build_bazel_rules_nodejs//:index.bzl\", \"js_library\")\n+\n+js_library(\n+    name = \"devtools_e2e_specs\",\n+    testonly = 1,\n+    srcs = glob([\"**/*.e2e.js\"]),\n+)\n+\n+js_library(\n+    name = \"plugin_file\",\n+    testonly = 1,\n+    srcs = [\"plugin.js\"],\n+)\n+\n+cypress_web_test(\n+    name = \"devtools_e2e\",\n+    srcs = [\n+        \":devtools_e2e_specs\",\n+    ],\n+    config_file = \"//:cypress.json\",\n+    data = [\n+        # Place \"//src:devapp here to so that cache is invalidated\n+        # whenever the output of //src:devapp (the demo app that is being e2e tested)\n+        # changes.\n+        \"//src:devapp\",\n+    ],\n+    plugin_file = \":plugin_file\",\n+)"
        },
        {
            "sha": "4948f50a6222abf0b21505727cf361fd62240f87",
            "filename": "cypress/integration/base.e2e.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fintegration%2Fbase.e2e.js",
            "raw_url": "https://github.com/angular/angular/raw/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fintegration%2Fbase.e2e.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/cypress%2Fintegration%2Fbase.e2e.js?ref=0028094192325910b9046d9b38d076e08eaaa4af",
            "patch": "@@ -1,3 +1,5 @@\n+require('cypress-iframe');\n+\n describe('Testing the Todo app Demo', () => {\n   beforeEach(() => {\n     cy.visit('/');"
        },
        {
            "sha": "ff7d155b847876e9f77a303544b7091a01732739",
            "filename": "cypress/integration/item-tracking.e2e.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fintegration%2Fitem-tracking.e2e.js",
            "raw_url": "https://github.com/angular/angular/raw/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fintegration%2Fitem-tracking.e2e.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/cypress%2Fintegration%2Fitem-tracking.e2e.js?ref=0028094192325910b9046d9b38d076e08eaaa4af",
            "patch": "@@ -1,3 +1,5 @@\n+require('cypress-iframe');\n+\n describe('Tracking items from application to component tree', () => {\n   beforeEach(() => {\n     cy.visit('/');"
        },
        {
            "sha": "6b7053fe3be8a42de9b43b9f633410a93a787a9f",
            "filename": "cypress/integration/node-selection.e2e.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fintegration%2Fnode-selection.e2e.js",
            "raw_url": "https://github.com/angular/angular/raw/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fintegration%2Fnode-selection.e2e.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/cypress%2Fintegration%2Fnode-selection.e2e.js?ref=0028094192325910b9046d9b38d076e08eaaa4af",
            "patch": "@@ -1,3 +1,5 @@\n+require('cypress-iframe');\n+\n describe('node selection', () => {\n   beforeEach(() => {\n     cy.visit('/');"
        },
        {
            "sha": "77924e15679e936a7ba0da2422469742726dd926",
            "filename": "cypress/integration/property-edit.e2e.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fintegration%2Fproperty-edit.e2e.js",
            "raw_url": "https://github.com/angular/angular/raw/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fintegration%2Fproperty-edit.e2e.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/cypress%2Fintegration%2Fproperty-edit.e2e.js?ref=0028094192325910b9046d9b38d076e08eaaa4af",
            "patch": "@@ -1,3 +1,5 @@\n+require('cypress-iframe');\n+\n describe('edit properties of directive in the property view tab', () => {\n   beforeEach(() => {\n     cy.visit('/');"
        },
        {
            "sha": "319d801b63120ced109827930a1287fad404729c",
            "filename": "cypress/integration/property-update.e2e.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fintegration%2Fproperty-update.e2e.js",
            "raw_url": "https://github.com/angular/angular/raw/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fintegration%2Fproperty-update.e2e.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/cypress%2Fintegration%2Fproperty-update.e2e.js?ref=0028094192325910b9046d9b38d076e08eaaa4af",
            "patch": "@@ -1,3 +1,5 @@\n+require('cypress-iframe');\n+\n describe('change of the state should reflect in property update', () => {\n   beforeEach(() => {\n     cy.visit('/');"
        },
        {
            "sha": "58e2129320dc5a365be6929ce1c48618ba6f6a2a",
            "filename": "cypress/plugin.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/angular/angular/blob/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fplugin.js",
            "raw_url": "https://github.com/angular/angular/raw/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fplugin.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/cypress%2Fplugin.js?ref=0028094192325910b9046d9b38d076e08eaaa4af",
            "previous_filename": "cypress/plugins/index.js"
        },
        {
            "sha": "02ab5016c13064321a14fdbbf56960261f6b87ca",
            "filename": "cypress/plugins/cy-ts-preprocessor.js",
            "status": "removed",
            "additions": 0,
            "deletions": 26,
            "changes": 26,
            "blob_url": "https://github.com/angular/angular/blob/c8d0294e1ae300d9cb96e61bc44e8bc58f63a125/cypress%2Fplugins%2Fcy-ts-preprocessor.js",
            "raw_url": "https://github.com/angular/angular/raw/c8d0294e1ae300d9cb96e61bc44e8bc58f63a125/cypress%2Fplugins%2Fcy-ts-preprocessor.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/cypress%2Fplugins%2Fcy-ts-preprocessor.js?ref=c8d0294e1ae300d9cb96e61bc44e8bc58f63a125",
            "patch": "@@ -1,26 +0,0 @@\n-const wp = require('@cypress/webpack-preprocessor');\n-\n-const webpackOptions = {\n-  resolve: {\n-    extensions: ['.ts', '.js'],\n-  },\n-  module: {\n-    rules: [\n-      {\n-        test: /\\.ts$/,\n-        exclude: [/node_modules/],\n-        use: [\n-          {\n-            loader: 'ts-loader',\n-          },\n-        ],\n-      },\n-    ],\n-  },\n-};\n-\n-const options = {\n-  webpackOptions,\n-};\n-\n-module.exports = wp(options);"
        },
        {
            "sha": "ca4d256f3eb15dfabad1f5760c9b2d0ceb4c24b9",
            "filename": "cypress/support/commands.js",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fsupport%2Fcommands.js",
            "raw_url": "https://github.com/angular/angular/raw/0028094192325910b9046d9b38d076e08eaaa4af/cypress%2Fsupport%2Fcommands.js",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/cypress%2Fsupport%2Fcommands.js?ref=0028094192325910b9046d9b38d076e08eaaa4af",
            "patch": "@@ -23,5 +23,3 @@\n //\n // -- This will overwrite an existing command --\n // Cypress.Commands.overwrite(\"visit\", (originalFn, url, options) => { ... })\n-\n-require('cypress-iframe');"
        },
        {
            "sha": "fe7b7576799af81acd68dca3b01e2261e6ce0114",
            "filename": "package.json",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/angular/angular/blob/0028094192325910b9046d9b38d076e08eaaa4af/package.json",
            "raw_url": "https://github.com/angular/angular/raw/0028094192325910b9046d9b38d076e08eaaa4af/package.json",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/package.json?ref=0028094192325910b9046d9b38d076e08eaaa4af",
            "patch": "@@ -16,10 +16,10 @@\n     \"e2e\": \"yarn cy:run\",\n     \"cy:verify\": \"$(yarn bin)/cypress verify\",\n     \"cy:version\": \"$(yarn bin)/cypress version\",\n-    \"cy:run\": \"$(yarn bin)/cypress run\",\n-    \"cy:open\": \"$(yarn bin)/cypress open\",\n-    \"cy:ci\": \"start-server-and-test start-no-animations http-get://localhost:4200 cy:run\",\n-    \"cy:watch\": \"start-server-and-test start-no-animations http-get://localhost:4200 cy:open\",\n+    \"cy:run\": \"bazel test cypress:devtools_e2e\",\n+    \"cy:open\": \"bazel run cypress:devtools_e2e\",\n+    \"cy:ci\": \"start-server-and-test start http-get://localhost:4200 cy:run\",\n+    \"cy:watch\": \"start-server-and-test start http-get://localhost:4200 cy:open\",\n     \"test:ci\": \"bazel test ...\",\n     \"prettier\": \"prettier --write \\\"{,!(node_modules|dist|build|coverage)/**/}*.{js,jsx,ts,tsx,json}\\\"\",\n     \"prettier:fix\": \"pretty-quick --staged\"\n@@ -59,17 +59,18 @@\n     \"@angular-devkit/build-angular\": \"github:angular/angular-devkit-build-angular-builds#7c4c781be8e3666f14360d3fe5dac0d35a851227\",\n     \"@angular-devkit/build-ng-packagr\": \"~0.1002.0\",\n     \"@angular/bazel\": \"13.0.1\",\n-    \"@angular/dev-infra-private\": \"https://github.com/angular/dev-infra-private-builds.git#2cfe4b98a157927b319a3a00b467ff6233dc3337\",\n-    \"@angular/localize\": \"13.0.1\",\n     \"@angular/cli\": \"github:angular/cli-builds#858ee211470523d39a9ff16b57b676be740f77cc\",\n     \"@angular/compiler-cli\": \"github:angular/compiler-cli-builds#89c6b3464f3f46a9f46334825bbff3d784af4136\",\n+    \"@angular/dev-infra-private\": \"https://github.com/angular/dev-infra-private-builds.git#2cfe4b98a157927b319a3a00b467ff6233dc3337\",\n     \"@angular/elements\": \"github:angular/elements-builds#55c36f9d5381ffc06649a03bff3c2934b18ddd02\",\n     \"@angular/language-service\": \"github:angular/language-service-builds#e16ca91c029934dde01557efcf860e2465629655\",\n+    \"@angular/localize\": \"13.0.1\",\n     \"@angular/router\": \"github:angular/router-builds#5485647d9f68a01041285dfa0b92d841d7fa8c0f\",\n     \"@bazel/angular\": \"^4.4.2\",\n     \"@bazel/bazelisk\": \"^1.7.5\",\n     \"@bazel/buildifier\": \"4.2.3\",\n     \"@bazel/concatjs\": \"^3.7.0\",\n+    \"@bazel/cypress\": \"^4.4.5\",\n     \"@bazel/esbuild\": \"^4.4.2\",\n     \"@bazel/ibazel\": \"^0.15.10\",\n     \"@bazel/rollup\": \"^4.4.2\",\n@@ -86,7 +87,7 @@\n     \"@types/semver\": \"^7.1.0\",\n     \"codelyzer\": \"^6.0.0\",\n     \"cross-env\": \"^7.0.2\",\n-    \"cypress\": \"^8.0.0\",\n+    \"cypress\": \"8.7.0\",\n     \"cypress-iframe\": \"^1.0.1\",\n     \"document-register-element\": \"^1.7.2\",\n     \"history-server\": \"^1.3.1\","
        },
        {
            "sha": "2b57abdc40b1d33f64d4478217a53cc87c0352bf",
            "filename": "yarn.lock",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/angular/angular/blob/0028094192325910b9046d9b38d076e08eaaa4af/yarn.lock",
            "raw_url": "https://github.com/angular/angular/raw/0028094192325910b9046d9b38d076e08eaaa4af/yarn.lock",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/yarn.lock?ref=0028094192325910b9046d9b38d076e08eaaa4af",
            "patch": "@@ -1751,6 +1751,11 @@\n     source-map-support \"0.5.9\"\n     tsutils \"2.27.2\"\n \n+\"@bazel/cypress@^4.4.5\":\n+  version \"4.4.5\"\n+  resolved \"https://registry.yarnpkg.com/@bazel/cypress/-/cypress-4.4.5.tgz#a96dee8b303507065d09aaa733386ae55245a708\"\n+  integrity sha512-4rku+NZhmiOhLImVoeB9IS7jxDzHFI3hAam3ZgYU8Pv0SfJHW8Obay7shAwVXI6uTgwIBlEkcWdfJ719Ooeo9A==\n+\n \"@bazel/esbuild@4.4.2\", \"@bazel/esbuild@^4.4.2\":\n   version \"4.4.2\"\n   resolved \"https://registry.yarnpkg.com/@bazel/esbuild/-/esbuild-4.4.2.tgz#e1f35922cc9b63e96cc8c263a77b8e1b2938a445\"\n@@ -4752,7 +4757,7 @@ cypress-iframe@^1.0.1:\n   resolved \"https://registry.yarnpkg.com/cypress-iframe/-/cypress-iframe-1.0.1.tgz#2a286cfd47a240aa9af0ad9f339f4c6f942089f8\"\n   integrity sha512-Ne+xkZmWMhfq3x6wbfzK/SzsVTCrJru3R3cLXsoSAZyfUtJDamXyaIieHXeea3pQDXF4wE2w4iUuvCYHhoD31g==\n \n-cypress@^8.0.0:\n+cypress@8.7.0:\n   version \"8.7.0\"\n   resolved \"https://registry.yarnpkg.com/cypress/-/cypress-8.7.0.tgz#2ee371f383d8f233d3425b6cc26ddeec2668b6da\"\n   integrity sha512-b1bMC3VQydC6sXzBMFnSqcvwc9dTZMgcaOzT0vpSD+Gq1yFc+72JDWi55sfUK5eIeNLAtWOGy1NNb6UlhMvB+Q=="
        }
    ],
    "stats": {
        "total": 95,
        "additions": 59,
        "deletions": 36
    }
}