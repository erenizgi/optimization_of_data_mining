{
    "author": "alan-agius4",
    "message": "fix(migrations): migration failed finding tsconfig file (#43343)\n\nWith this change we change the logic to locate the tsconfig files. The public API to locate, read and parse the workspace configuration should be use instead of the custom implemented logic.\n\nThe custom implemented logic depended on methods which have long been deprecated and are not removed in version 13 of the Angular CLI. This was not caught during development/UT because this repo is using outdated Angular Tooling packages.\n\nThis change also updates a number of spec files which previously creating an invalid Angular workspace configuration file.\n\nCloses #43334\n\nPR Close #43343",
    "sha": "2efc18e6757157589004e23d8d22b7967de4387d",
    "files": [
        {
            "sha": "3291b5b45b03eadb25c543a947b56c9840d456eb",
            "filename": "packages/core/schematics/migrations/abstract-control-parent/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fabstract-control-parent%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fabstract-control-parent%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fabstract-control-parent%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -16,8 +16,8 @@ import {findParentAccesses} from './util';\n \n /** Migration that marks accesses of `AbstractControl.parent` as non-null. */\n export default function(): Rule {\n-  return (tree: Tree) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const allPaths = [...buildPaths, ...testPaths];\n "
        },
        {
            "sha": "29ef6f8fdc71afd4ee48e3ddb07b0615e896829d",
            "filename": "packages/core/schematics/migrations/activated-route-snapshot-fragment/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Factivated-route-snapshot-fragment%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Factivated-route-snapshot-fragment%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Factivated-route-snapshot-fragment%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -19,8 +19,8 @@ import {findFragmentAccesses, migrateActivatedRouteSnapshotFragment} from './uti\n  * Migration that marks accesses of `ActivatedRouteSnapshot.fragment` as non-null.\n  */\n export default function(): Rule {\n-  return (tree: Tree) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const allPaths = [...buildPaths, ...testPaths];\n "
        },
        {
            "sha": "ab6d8301898adc9485ef459ec76f40e5bc198b79",
            "filename": "packages/core/schematics/migrations/can-activate-with-redirect-to/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fcan-activate-with-redirect-to%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fcan-activate-with-redirect-to%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fcan-activate-with-redirect-to%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -17,8 +17,8 @@ import {findLiteralsToMigrate, migrateLiteral} from './util';\n \n /** Migration that removes `canActivate` property from routes that also have `redirectTo`. */\n export default function(): Rule {\n-  return (tree: Tree) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const allPaths = [...buildPaths, ...testPaths];\n "
        },
        {
            "sha": "5f9c51f0e6e47776445eed8009872c15bc0d04ec",
            "filename": "packages/core/schematics/migrations/dynamic-queries/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fdynamic-queries%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fdynamic-queries%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fdynamic-queries%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -20,8 +20,8 @@ import {identifyDynamicQueryNodes, removeOptionsParameter, removeStaticFlag} fro\n  * Runs the dynamic queries migration for all TypeScript projects in the current CLI workspace.\n  */\n export default function(): Rule {\n-  return (tree: Tree) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const allPaths = [...buildPaths, ...testPaths];\n "
        },
        {
            "sha": "90be6fb389fa116723097dc968b6600edf2ac430",
            "filename": "packages/core/schematics/migrations/initial-navigation/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Finitial-navigation%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -17,8 +17,8 @@ import {UpdateRecorder} from './update_recorder';\n \n /** Entry point for the v10 \"initialNavigation RouterModule options\" schematic. */\n export default function(): Rule {\n-  return (tree: Tree) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n \n     if (!buildPaths.length && !testPaths.length) {"
        },
        {
            "sha": "efead7fc0700b82871425e28b72089d97741825f",
            "filename": "packages/core/schematics/migrations/missing-injectable/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fmissing-injectable%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fmissing-injectable%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fmissing-injectable%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -17,8 +17,8 @@ import {UpdateRecorder} from './update_recorder';\n \n /** Entry point for the V9 \"missing @Injectable\" schematic. */\n export default function(): Rule {\n-  return (tree: Tree, ctx: SchematicContext) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree, ctx: SchematicContext) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const failures: string[] = [];\n "
        },
        {
            "sha": "aad14dd3c93701f8241f915c6f3334b87fc49964",
            "filename": "packages/core/schematics/migrations/module-with-providers/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fmodule-with-providers%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fmodule-with-providers%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fmodule-with-providers%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -21,8 +21,8 @@ import {AnalysisFailure, ModuleWithProvidersTransform} from './transform';\n  * Runs the ModuleWithProviders migration for all TypeScript projects in the current CLI workspace.\n  */\n export default function(): Rule {\n-  return (tree: Tree, ctx: SchematicContext) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree, ctx: SchematicContext) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const allPaths = [...buildPaths, ...testPaths];\n     const failures: string[] = [];"
        },
        {
            "sha": "9815576949db49adf0101ad7f97d831765f6f1d6",
            "filename": "packages/core/schematics/migrations/move-document/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fmove-document%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fmove-document%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fmove-document%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -19,8 +19,8 @@ import {addToImport, createImport, removeFromImport} from './move-import';\n \n /** Entry point for the V8 move-document migration. */\n export default function(): Rule {\n-  return (tree: Tree) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n \n     if (!buildPaths.length && !testPaths.length) {"
        },
        {
            "sha": "c0895057986435db2538c2242d367d0bba1ef3ef",
            "filename": "packages/core/schematics/migrations/native-view-encapsulation/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fnative-view-encapsulation%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fnative-view-encapsulation%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fnative-view-encapsulation%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -16,8 +16,8 @@ import {findNativeEncapsulationNodes} from './util';\n \n /** Migration that switches from `ViewEncapsulation.Native` to `ViewEncapsulation.ShadowDom`. */\n export default function(): Rule {\n-  return (tree: Tree) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const allPaths = [...buildPaths, ...testPaths];\n "
        },
        {
            "sha": "32b134ac0b532e03a81cbf077dec5e9d6156fe68",
            "filename": "packages/core/schematics/migrations/navigation-extras-omissions/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fnavigation-extras-omissions%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fnavigation-extras-omissions%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fnavigation-extras-omissions%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -17,8 +17,8 @@ import {findLiteralsToMigrate, migrateLiteral} from './util';\n \n /** Migration that switches `Router.navigateByUrl` and `Router.createUrlTree` to a new signature. */\n export default function(): Rule {\n-  return (tree: Tree) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const allPaths = [...buildPaths, ...testPaths];\n "
        },
        {
            "sha": "5b62dce311d487de2566f4c5e9f1073ca85ab48c",
            "filename": "packages/core/schematics/migrations/relative-link-resolution/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frelative-link-resolution%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -17,8 +17,8 @@ import {UpdateRecorder} from './update_recorder';\n \n /** Entry point for the v11 \"relativeLinkResolution RouterModule options\" schematic. */\n export default function(): Rule {\n-  return (tree: Tree) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n \n     if (!buildPaths.length && !testPaths.length) {"
        },
        {
            "sha": "92724b63fc18a792d317fe8e49bc30625321b34c",
            "filename": "packages/core/schematics/migrations/renderer-to-renderer2/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Frenderer-to-renderer2%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Frenderer-to-renderer2%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frenderer-to-renderer2%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -26,8 +26,8 @@ const MODULE_AUGMENTATION_FILENAME = 'ɵɵRENDERER_MIGRATION_CORE_AUGMENTATION.d\n  * https://hackmd.angular.io/UTzUZTnPRA-cSa_4mHyfYw\n  */\n export default function(): Rule {\n-  return (tree: Tree) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const allPaths = [...buildPaths, ...testPaths];\n "
        },
        {
            "sha": "7af21ab5607176ea71b7d929398c6285bca7ceb0",
            "filename": "packages/core/schematics/migrations/router-link-empty-expression/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Frouter-link-empty-expression%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Frouter-link-empty-expression%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frouter-link-empty-expression%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -30,8 +30,8 @@ interface FixedTemplate {\n \n /** Entry point for the RouterLink empty expression migration. */\n export default function(): Rule {\n-  return (tree: Tree, context: SchematicContext) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree, context: SchematicContext) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n \n     if (!buildPaths.length && !testPaths.length) {"
        },
        {
            "sha": "590524a4ca5e0548f55049a9b9b2ffd2ebf81515",
            "filename": "packages/core/schematics/migrations/router-preserve-query-params/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Frouter-preserve-query-params%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Frouter-preserve-query-params%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Frouter-preserve-query-params%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -20,8 +20,8 @@ import {findLiteralsToMigrate, migrateLiteral} from './util';\n  * `NavigationExtras`'s `queryParamsHandling` attribute.\n  */\n export default function(): Rule {\n-  return (tree: Tree) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const allPaths = [...buildPaths, ...testPaths];\n "
        },
        {
            "sha": "72c90c2925ba4ceef7ef019ea188cb2ea3b3540b",
            "filename": "packages/core/schematics/migrations/static-queries/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fstatic-queries%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fstatic-queries%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fstatic-queries%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -45,7 +45,7 @@ export default function(): Rule {\n \n /** Runs the V8 migration static-query migration for all determined TypeScript projects. */\n async function runMigration(tree: Tree, context: SchematicContext) {\n-  const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n   const basePath = process.cwd();\n   const logger = context.logger;\n "
        },
        {
            "sha": "cf00cc7cf7ec70da102e618dce4b22c2e4e22ea6",
            "filename": "packages/core/schematics/migrations/template-var-assignment/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Ftemplate-var-assignment%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Ftemplate-var-assignment%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Ftemplate-var-assignment%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -23,8 +23,8 @@ const FAILURE_MESSAGE = `Found assignment to template variable.`;\n \n /** Entry point for the V8 template variable assignment schematic. */\n export default function(): Rule {\n-  return (tree: Tree, context: SchematicContext) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree, context: SchematicContext) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n \n     if (!buildPaths.length && !testPaths.length) {"
        },
        {
            "sha": "3b1c6f82b9074082857c317e3b538071e5629402",
            "filename": "packages/core/schematics/migrations/undecorated-classes-with-decorated-fields/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fundecorated-classes-with-decorated-fields%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fundecorated-classes-with-decorated-fields%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fundecorated-classes-with-decorated-fields%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -21,8 +21,8 @@ import {UpdateRecorder} from './update_recorder';\n  * https://hackmd.io/vuQfavzfRG6KUCtU7oK_EA\n  */\n export default function(): Rule {\n-  return (tree: Tree, ctx: SchematicContext) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree, ctx: SchematicContext) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const allPaths = [...buildPaths, ...testPaths];\n     const failures: string[] = [];"
        },
        {
            "sha": "4a0ba73c2216c6f344819ab5d8369560c72cdceb",
            "filename": "packages/core/schematics/migrations/undecorated-classes-with-di/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fundecorated-classes-with-di%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fundecorated-classes-with-di%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fundecorated-classes-with-di%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -32,8 +32,8 @@ const MIGRATION_AOT_FAILURE = 'This migration uses the Angular compiler internal\n \n /** Entry point for the V9 \"undecorated-classes-with-di\" migration. */\n export default function(): Rule {\n-  return (tree: Tree, ctx: SchematicContext) => {\n-    const {buildPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree, ctx: SchematicContext) => {\n+    const {buildPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const failures: string[] = [];\n     let programError = false;"
        },
        {
            "sha": "da33a93ad6bd400ac3dc375cadea9bb13e5578fe",
            "filename": "packages/core/schematics/migrations/wait-for-async/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fwait-for-async%2Findex.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Fmigrations%2Fwait-for-async%2Findex.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Fmigrations%2Fwait-for-async%2Findex.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -21,8 +21,8 @@ const MODULE_AUGMENTATION_FILENAME = 'ɵɵASYNC_MIGRATION_CORE_AUGMENTATION.d.ts\n \n /** Migration that switches from `async` to `waitForAsync`. */\n export default function(): Rule {\n-  return (tree: Tree) => {\n-    const {buildPaths, testPaths} = getProjectTsConfigPaths(tree);\n+  return async (tree: Tree) => {\n+    const {buildPaths, testPaths} = await getProjectTsConfigPaths(tree);\n     const basePath = process.cwd();\n     const allPaths = [...buildPaths, ...testPaths];\n "
        },
        {
            "sha": "ad38b34117f341fc620fdf2ddd5c8c6b5d090053",
            "filename": "packages/core/schematics/test/abstract_control_parent_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fabstract_control_parent_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fabstract_control_parent_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fabstract_control_parent_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -28,6 +28,7 @@ describe('AbstractControl.parent migration', () => {\n       compilerOptions: {lib: ['es2015'], strictNullChecks: true},\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n     // We need to declare the Angular symbols we're testing for, otherwise type checking won't work."
        },
        {
            "sha": "4d95fd29aa890239d0da5b167963b59061e9a7eb",
            "filename": "packages/core/schematics/test/activated_route_snapshot_fragment_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Factivated_route_snapshot_fragment_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Factivated_route_snapshot_fragment_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Factivated_route_snapshot_fragment_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -28,6 +28,7 @@ describe('ActivatedRouteSnapshot.fragment migration', () => {\n       compilerOptions: {lib: ['es2015'], strictNullChecks: true},\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n     // We need to declare the Angular symbols we're testing for, otherwise type checking won't work."
        },
        {
            "sha": "460079ba22552bf3ff6632cc58b6c9ef87b572f0",
            "filename": "packages/core/schematics/test/all-migrations.spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fall-migrations.spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fall-migrations.spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fall-migrations.spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -29,6 +29,7 @@ describe('all migrations', () => {\n \n     writeFile('/node_modules/@angular/core/index.d.ts', `export const MODULE: any;`);\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n     writeFile('/tsconfig.json', `{}`);"
        },
        {
            "sha": "f8ba5581214adc66f86f34d522d94ef8f74c2f2a",
            "filename": "packages/core/schematics/test/can_activate_with_redirect_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fcan_activate_with_redirect_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fcan_activate_with_redirect_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fcan_activate_with_redirect_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -31,6 +31,7 @@ describe('canActivate removal with redirectTo', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n "
        },
        {
            "sha": "6950c35b96888dd5624211fc3dd4d821d43b4ad6",
            "filename": "packages/core/schematics/test/dynamic_queries_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fdynamic_queries_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fdynamic_queries_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fdynamic_queries_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -30,6 +30,7 @@ describe('dynamic queries migration', () => {\n       }\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n "
        },
        {
            "sha": "77d5c930e33a6326435bbe0615585abdfe26c43e",
            "filename": "packages/core/schematics/test/initial_navigation_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Finitial_navigation_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Finitial_navigation_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Finitial_navigation_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -30,6 +30,7 @@ describe('initial navigation migration', () => {\n       }\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n "
        },
        {
            "sha": "4624fca7ff34886755f4ca65b78f44546b8a72cc",
            "filename": "packages/core/schematics/test/missing_injectable_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fmissing_injectable_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fmissing_injectable_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fmissing_injectable_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -32,6 +32,7 @@ describe('Missing injectable migration', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n "
        },
        {
            "sha": "1ebbb6897898f13eacdd21b4c1c7efa390c68a63",
            "filename": "packages/core/schematics/test/module_with_providers_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fmodule_with_providers_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fmodule_with_providers_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fmodule_with_providers_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -30,6 +30,7 @@ describe('ModuleWithProviders migration', () => {\n       }\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n "
        },
        {
            "sha": "d07e5167a17e498a1c86c9e82ae6775436da0d99",
            "filename": "packages/core/schematics/test/move_document_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fmove_document_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fmove_document_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fmove_document_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -30,6 +30,7 @@ describe('move-document migration', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n "
        },
        {
            "sha": "d2c94daff1010170426e8186146a4a108e11ebd9",
            "filename": "packages/core/schematics/test/native_view_encapsulation_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fnative_view_encapsulation_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fnative_view_encapsulation_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fnative_view_encapsulation_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -31,6 +31,7 @@ describe('ViewEncapsulation.Native migration', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n "
        },
        {
            "sha": "f30cf78e37322ddc0c89725873c5ffb2c05c03c8",
            "filename": "packages/core/schematics/test/navigation_extras_omissions_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fnavigation_extras_omissions_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fnavigation_extras_omissions_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fnavigation_extras_omissions_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -31,6 +31,7 @@ describe('NavigationExtras omissions migration', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n     // We need to declare the Angular symbols we're testing for, otherwise type checking won't work."
        },
        {
            "sha": "e0f46e14a780a8fcb264938c08247c2fb92efc77",
            "filename": "packages/core/schematics/test/preserve_query_params_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fpreserve_query_params_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fpreserve_query_params_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fpreserve_query_params_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -31,6 +31,7 @@ describe('NavigationExtras preserveQueryParams migration', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n     // We need to declare the Angular symbols we're testing for, otherwise type checking won't work."
        },
        {
            "sha": "7fdda4de7e2b7f30bb2de729f29a07b6da65699a",
            "filename": "packages/core/schematics/test/project_tsconfig_paths_spec.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 18,
            "changes": 33,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fproject_tsconfig_paths_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fproject_tsconfig_paths_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fproject_tsconfig_paths_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -17,18 +17,20 @@ describe('project tsconfig paths', () => {\n     testTree = new UnitTestTree(new HostTree());\n   });\n \n-  it('should detect build tsconfig path inside of angular.json file', () => {\n+  it('should detect build tsconfig path inside of angular.json file', async () => {\n     testTree.create('/my-custom-config.json', '');\n     testTree.create('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {my_name: {architect: {build: {options: {tsConfig: './my-custom-config.json'}}}}}\n     }));\n \n-    expect(getProjectTsConfigPaths(testTree).buildPaths).toEqual(['my-custom-config.json']);\n+    expect((await getProjectTsConfigPaths(testTree)).buildPaths).toEqual(['my-custom-config.json']);\n   });\n \n-  it('should be able to read workspace configuration which is using JSON5 features', () => {\n+  it('should be able to read workspace configuration which is using JSON5 features', async () => {\n     testTree.create('/my-build-config.json', '');\n     testTree.create('/angular.json', `{\n+      version: 1,\n       // Comments, unquoted properties or trailing commas are only supported in JSON5.\n       projects: {\n         with_tests: {\n@@ -43,41 +45,36 @@ describe('project tsconfig paths', () => {\n       },\n     }`);\n \n-    expect(getProjectTsConfigPaths(testTree).buildPaths).toEqual(['my-build-config.json']);\n+    expect((await getProjectTsConfigPaths(testTree)).buildPaths).toEqual(['my-build-config.json']);\n   });\n \n-  it('should detect test tsconfig path inside of angular.json file', () => {\n+  it('should detect test tsconfig path inside of angular.json file', async () => {\n     testTree.create('/my-test-config.json', '');\n     testTree.create('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {my_name: {architect: {test: {options: {tsConfig: './my-test-config.json'}}}}}\n     }));\n \n-    expect(getProjectTsConfigPaths(testTree).testPaths).toEqual(['my-test-config.json']);\n+    expect((await getProjectTsConfigPaths(testTree)).testPaths).toEqual(['my-test-config.json']);\n   });\n \n-  it('should detect test tsconfig path inside of .angular.json file', () => {\n+  it('should detect test tsconfig path inside of .angular.json file', async () => {\n     testTree.create('/my-test-config.json', '');\n     testTree.create('/.angular.json', JSON.stringify({\n+      version: 1,\n       projects: {with_tests: {architect: {test: {options: {tsConfig: './my-test-config.json'}}}}}\n     }));\n \n-    expect(getProjectTsConfigPaths(testTree).testPaths).toEqual(['my-test-config.json']);\n+    expect((await getProjectTsConfigPaths(testTree)).testPaths).toEqual(['my-test-config.json']);\n   });\n \n-  it('should detect common tsconfigs if no workspace config could be found', () => {\n-    testTree.create('/src/tsconfig.app.json', '');\n-    testTree.create('/src/tsconfig.spec.json', '');\n-\n-    expect(getProjectTsConfigPaths(testTree).buildPaths).toEqual(['src/tsconfig.app.json']);\n-    expect(getProjectTsConfigPaths(testTree).testPaths).toEqual(['src/tsconfig.spec.json']);\n-  });\n-\n-  it('should not return duplicate tsconfig files', () => {\n+  it('should not return duplicate tsconfig files', async () => {\n     testTree.create('/tsconfig.json', '');\n     testTree.create('/.angular.json', JSON.stringify({\n+      version: 1,\n       projects: {app: {architect: {build: {options: {tsConfig: 'tsconfig.json'}}}}}\n     }));\n \n-    expect(getProjectTsConfigPaths(testTree).buildPaths).toEqual(['tsconfig.json']);\n+    expect((await getProjectTsConfigPaths(testTree)).buildPaths).toEqual(['tsconfig.json']);\n   });\n });"
        },
        {
            "sha": "1a51ec3d301ed79e4986d7bd39c374f858b3fc7d",
            "filename": "packages/core/schematics/test/relative_link_resolution_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Frelative_link_resolution_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Frelative_link_resolution_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Frelative_link_resolution_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -30,6 +30,7 @@ describe('initial navigation migration', () => {\n       }\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n "
        },
        {
            "sha": "3d3c2828c12c221caf92cc57a4e9e7e86f8c2c26",
            "filename": "packages/core/schematics/test/renderer_to_renderer2_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Frenderer_to_renderer2_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Frenderer_to_renderer2_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Frenderer_to_renderer2_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -31,6 +31,7 @@ describe('Renderer to Renderer2 migration', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n     // We need to declare the Angular symbols we're testing for, otherwise type checking won't work."
        },
        {
            "sha": "c35ced2a5eee2d6454748834410defb85e8f56b4",
            "filename": "packages/core/schematics/test/routerlink_empty_expr_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Frouterlink_empty_expr_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Frouterlink_empty_expr_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Frouterlink_empty_expr_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -31,6 +31,7 @@ describe('routerlink emptyExpr assignment migration', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n "
        },
        {
            "sha": "bdb4fbf8f9188a3b048a188859779c0462bccee6",
            "filename": "packages/core/schematics/test/static_queries_migration_template_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fstatic_queries_migration_template_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fstatic_queries_migration_template_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fstatic_queries_migration_template_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -33,6 +33,7 @@ describe('static-queries migration with template strategy', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n "
        },
        {
            "sha": "e11e602f58b54c7a14e742ee8613556f5c44172c",
            "filename": "packages/core/schematics/test/static_queries_migration_usage_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fstatic_queries_migration_usage_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fstatic_queries_migration_usage_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fstatic_queries_migration_usage_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -37,6 +37,7 @@ describe('static-queries migration with usage strategy', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n \n@@ -671,6 +672,7 @@ describe('static-queries migration with usage strategy', () => {\n       // recorded for TypeScript projects not at the schematic tree root.\n       host.sync.rename(normalize('/tsconfig.json'), normalize('/src/tsconfig.json'));\n       writeFile('/angular.json', JSON.stringify({\n+        version: 1,\n         projects: {t: {architect: {build: {options: {tsConfig: './src/tsconfig.json'}}}}}\n       }));\n "
        },
        {
            "sha": "3c5a5534d9447de5ebd2d39bf629337769ee7e05",
            "filename": "packages/core/schematics/test/template_var_assignment_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Ftemplate_var_assignment_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Ftemplate_var_assignment_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Ftemplate_var_assignment_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -31,6 +31,7 @@ describe('template variable assignment migration', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n "
        },
        {
            "sha": "7d4d7dd66fd4bed63cae4bd30f6485118a86382e",
            "filename": "packages/core/schematics/test/undecorated_classes_with_decorated_fields_migration_spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fundecorated_classes_with_decorated_fields_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fundecorated_classes_with_decorated_fields_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fundecorated_classes_with_decorated_fields_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -28,6 +28,7 @@ describe('Undecorated classes with decorated fields migration', () => {\n \n     writeFile('/tsconfig.json', JSON.stringify({compilerOptions: {lib: ['es2015']}}));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n \n@@ -294,6 +295,7 @@ describe('Undecorated classes with decorated fields migration', () => {\n \n   it('should not add multiple TODOs for ambiguous classes', async () => {\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {\n         test: {\n           architect: {"
        },
        {
            "sha": "82a9f9733514281a7a9f7ad5eea74b343634b83c",
            "filename": "packages/core/schematics/test/undecorated_classes_with_di_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fundecorated_classes_with_di_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fundecorated_classes_with_di_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fundecorated_classes_with_di_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -35,6 +35,7 @@ describe('Undecorated classes with DI migration', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n "
        },
        {
            "sha": "58ea9ba8ba45c25ea10fb5879bcde796c52b22da",
            "filename": "packages/core/schematics/test/wait_for_async_migration_spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fwait_for_async_migration_spec.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Ftest%2Fwait_for_async_migration_spec.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Ftest%2Fwait_for_async_migration_spec.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -31,6 +31,7 @@ describe('waitForAsync migration', () => {\n       },\n     }));\n     writeFile('/angular.json', JSON.stringify({\n+      version: 1,\n       projects: {t: {architect: {build: {options: {tsConfig: './tsconfig.json'}}}}}\n     }));\n     // We need to declare the Angular symbols we're testing for, otherwise type checking won't work."
        },
        {
            "sha": "9254b9673abb4a23ff54ff9a65d0fa2215277fcd",
            "filename": "packages/core/schematics/utils/BUILD.bazel",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Futils%2FBUILD.bazel",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Futils%2FBUILD.bazel",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Futils%2FBUILD.bazel?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -9,7 +9,6 @@ ts_library(\n         \"//packages/compiler\",\n         \"@npm//@angular-devkit/core\",\n         \"@npm//@angular-devkit/schematics\",\n-        \"@npm//@schematics/angular\",\n         \"@npm//@types/inquirer\",\n         \"@npm//@types/node\",\n         \"@npm//typescript\","
        },
        {
            "sha": "41f1a1ca9cdd391de8764d5d27404759bed4c524",
            "filename": "packages/core/schematics/utils/project_tsconfig_paths.ts",
            "status": "modified",
            "additions": 67,
            "deletions": 52,
            "changes": 119,
            "blob_url": "https://github.com/angular/angular/blob/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Futils%2Fproject_tsconfig_paths.ts",
            "raw_url": "https://github.com/angular/angular/raw/2efc18e6757157589004e23d8d22b7967de4387d/packages%2Fcore%2Fschematics%2Futils%2Fproject_tsconfig_paths.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Fschematics%2Futils%2Fproject_tsconfig_paths.ts?ref=2efc18e6757157589004e23d8d22b7967de4387d",
            "patch": "@@ -6,82 +6,97 @@\n  * found in the LICENSE file at https://angular.io/license\n  */\n \n-import {JsonParseMode, normalize, parseJson} from '@angular-devkit/core';\n+import {json, normalize, virtualFs, workspaces} from '@angular-devkit/core';\n import {Tree} from '@angular-devkit/schematics';\n-import {WorkspaceProject} from '@schematics/angular/utility/workspace-models';\n-\n-/** Name of the default Angular CLI workspace configuration files. */\n-const defaultWorkspaceConfigPaths = ['/angular.json', '/.angular.json'];\n \n /**\n  * Gets all tsconfig paths from a CLI project by reading the workspace configuration\n  * and looking for common tsconfig locations.\n  */\n-export function getProjectTsConfigPaths(tree: Tree): {buildPaths: string[], testPaths: string[]} {\n+export async function getProjectTsConfigPaths(tree: Tree):\n+    Promise<{buildPaths: string[]; testPaths: string[];}> {\n   // Start with some tsconfig paths that are generally used within CLI projects. Note\n   // that we are not interested in IDE-specific tsconfig files (e.g. /tsconfig.json)\n-  const buildPaths = new Set<string>(['src/tsconfig.app.json']);\n-  const testPaths = new Set<string>(['src/tsconfig.spec.json']);\n-\n-  // Add any tsconfig directly referenced in a build or test task of the angular.json workspace.\n-  const workspace = getWorkspaceConfigGracefully(tree);\n+  const buildPaths = new Set<string>();\n+  const testPaths = new Set<string>();\n \n-  if (workspace) {\n-    const projects = Object.keys(workspace.projects).map(name => workspace.projects[name]);\n-    for (const project of projects) {\n-      const buildPath = getTargetTsconfigPath(project, 'build');\n-      const testPath = getTargetTsconfigPath(project, 'test');\n-\n-      if (buildPath) {\n-        buildPaths.add(buildPath);\n+  const workspace = await getWorkspace(tree);\n+  for (const [, project] of workspace.projects) {\n+    for (const [name, target] of project.targets) {\n+      if (name !== 'build' && name !== 'test') {\n+        continue;\n       }\n \n-      if (testPath) {\n-        testPaths.add(testPath);\n+      for (const [, options] of allTargetOptions(target)) {\n+        const tsConfig = options.tsConfig;\n+        // Filter out tsconfig files that don't exist in the CLI project.\n+        if (typeof tsConfig !== 'string' || !tree.exists(tsConfig)) {\n+          continue;\n+        }\n+\n+        if (name === 'build') {\n+          buildPaths.add(normalize(tsConfig));\n+        } else {\n+          testPaths.add(normalize(tsConfig));\n+        }\n       }\n     }\n   }\n \n-  // Filter out tsconfig files that don't exist in the CLI project.\n   return {\n-    buildPaths: Array.from(buildPaths).filter(p => tree.exists(p)),\n-    testPaths: Array.from(testPaths).filter(p => tree.exists(p)),\n+    buildPaths: [...buildPaths],\n+    testPaths: [...testPaths],\n   };\n }\n \n-/** Gets the tsconfig path from the given target within the specified project. */\n-function getTargetTsconfigPath(project: WorkspaceProject, targetName: string): string|null {\n-  if (project.targets && project.targets[targetName] && project.targets[targetName].options &&\n-      project.targets[targetName].options.tsConfig) {\n-    return normalize(project.targets[targetName].options.tsConfig);\n+/** Get options for all configurations for the passed builder target. */\n+function*\n+    allTargetOptions(target: workspaces.TargetDefinition):\n+        Iterable<[string | undefined, Record<string, json.JsonValue|undefined>]> {\n+  if (target.options) {\n+    yield [undefined, target.options];\n   }\n \n-  if (project.architect && project.architect[targetName] && project.architect[targetName].options &&\n-      project.architect[targetName].options.tsConfig) {\n-    return normalize(project.architect[targetName].options.tsConfig);\n+  if (!target.configurations) {\n+    return;\n+  }\n+\n+  for (const [name, options] of Object.entries(target.configurations)) {\n+    if (options) {\n+      yield [name, options];\n+    }\n   }\n-  return null;\n }\n \n-/**\n- * Resolve the workspace configuration of the specified tree gracefully. We cannot use the utility\n- * functions from the default Angular schematics because those might not be present in older\n- * versions of the CLI. Also it's important to resolve the workspace gracefully because\n- * the CLI project could be still using `.angular-cli.json` instead of thew new config.\n- */\n-function getWorkspaceConfigGracefully(tree: Tree): any {\n-  const path = defaultWorkspaceConfigPaths.find(filePath => tree.exists(filePath));\n-  const configBuffer = tree.read(path!);\n+function createHost(tree: Tree): workspaces.WorkspaceHost {\n+  return {\n+    async readFile(path: string): Promise<string> {\n+      const data = tree.read(path);\n+      if (!data) {\n+        throw new Error('File not found.');\n+      }\n \n-  if (!path || !configBuffer) {\n-    return null;\n-  }\n+      return virtualFs.fileBufferToString(data);\n+    },\n+    async writeFile(path: string, data: string): Promise<void> {\n+      return tree.overwrite(path, data);\n+    },\n+    async isDirectory(path: string): Promise<boolean> {\n+      // Approximate a directory check.\n+      // We don't need to consider empty directories and hence this is a good enough approach.\n+      // This is also per documentation, see:\n+      // https://angular.io/guide/schematics-for-libraries#get-the-project-configuration\n+      return !tree.exists(path) && tree.getDir(path).subfiles.length > 0;\n+    },\n+    async isFile(path: string): Promise<boolean> {\n+      return tree.exists(path);\n+    },\n+  };\n+}\n \n-  try {\n-    // Parse the workspace file as JSON5 which is also supported for CLI\n-    // workspace configurations.\n-    return parseJson(configBuffer.toString(), JsonParseMode.Json5);\n-  } catch (e) {\n-    return null;\n-  }\n+async function getWorkspace(tree: Tree): Promise<workspaces.WorkspaceDefinition> {\n+  const host = createHost(tree);\n+  const {workspace} = await workspaces.readWorkspace('/', host);\n+\n+  return workspace;\n }"
        }
    ],
    "stats": {
        "total": 250,
        "additions": 142,
        "deletions": 108
    }
}