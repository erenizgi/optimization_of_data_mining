{
    "author": "JiaLiPassion",
    "message": "fix(core): fake_async_fallback should have the same logic with fake-async (#37680)\n\nPR https://github.com/angular/angular/pull/37523 failed when trying to use `rxjs delay` operator\ninside `fakeAsync`, and the reasons are:\n\n1. we need to import `rxjs-fake-async` patch to make the integration work.\n2. since in `angular` repo, the bazel target `/tools/testing:node` not using `zone-testing` bundle,\ninstead it load `zone-spec` packages seperately, so it causes one issue which is the `zone.js/testing/fake-async`\npackage is not loaded, we do have a fallback logic under `packages/core/testing` calles `fake_async_fallback`,\nbut the logic is out of date with `fake-async` under `zone.js` package.\n\nSo this PR, I updated the content of `fake_async_fallback` to make it consistent with\n`fake-async`. And I will make another PR to try to remove the `fallback` logic.\n\nPR Close #37680",
    "sha": "435a28e93745a3f7d4526e4cc8e279eaaacc3a96",
    "files": [
        {
            "sha": "6026708ecebbbe7188e43324be12070a61cd917c",
            "filename": "packages/core/testing/src/fake_async_fallback.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/435a28e93745a3f7d4526e4cc8e279eaaacc3a96/packages%2Fcore%2Ftesting%2Fsrc%2Ffake_async_fallback.ts",
            "raw_url": "https://github.com/angular/angular/raw/435a28e93745a3f7d4526e4cc8e279eaaacc3a96/packages%2Fcore%2Ftesting%2Fsrc%2Ffake_async_fallback.ts",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fcore%2Ftesting%2Fsrc%2Ffake_async_fallback.ts?ref=435a28e93745a3f7d4526e4cc8e279eaaacc3a96",
            "patch": "@@ -27,6 +27,9 @@ let _fakeAsyncTestZoneSpec: any = null;\n  * @publicApi\n  */\n export function resetFakeAsyncZoneFallback() {\n+  if (_fakeAsyncTestZoneSpec) {\n+    _fakeAsyncTestZoneSpec.unlockDatePatch();\n+  }\n   _fakeAsyncTestZoneSpec = null;\n   // in node.js testing we may not have ProxyZoneSpec in which case there is nothing to reset.\n   ProxyZoneSpec && ProxyZoneSpec.assertPresent().resetDelegate();\n@@ -73,6 +76,7 @@ export function fakeAsyncFallback(fn: Function): (...args: any[]) => any {\n       let res: any;\n       const lastProxyZoneSpec = proxyZoneSpec.getDelegate();\n       proxyZoneSpec.setDelegate(_fakeAsyncTestZoneSpec);\n+      _fakeAsyncTestZoneSpec.lockDatePatch();\n       try {\n         res = fn.apply(this, args);\n         flushMicrotasksFallback();"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 4,
        "deletions": 0
    }
}