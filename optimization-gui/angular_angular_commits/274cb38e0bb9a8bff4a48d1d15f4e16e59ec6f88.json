{
    "author": "devversion",
    "message": "feat(bazel): switch prodmode output to ES2020 (#43431)\n\nPreviously, the prodmode output was using ES2015 for `ng_module` and\n`ts_library` targets. This commit changes it to `ES2020`. This is\nnecessary as we want to ship es2020 output in APF v13.\n\nPR Close #43431",
    "sha": "274cb38e0bb9a8bff4a48d1d15f4e16e59ec6f88",
    "files": [
        {
            "sha": "3868d237909dabb1de9fcae98043c687215e5ebc",
            "filename": "packages/bazel/src/ng_module/ng_module.bzl",
            "status": "modified",
            "additions": 15,
            "deletions": 3,
            "changes": 18,
            "blob_url": "https://github.com/angular/angular/blob/274cb38e0bb9a8bff4a48d1d15f4e16e59ec6f88/packages%2Fbazel%2Fsrc%2Fng_module%2Fng_module.bzl",
            "raw_url": "https://github.com/angular/angular/raw/274cb38e0bb9a8bff4a48d1d15f4e16e59ec6f88/packages%2Fbazel%2Fsrc%2Fng_module%2Fng_module.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/packages%2Fbazel%2Fsrc%2Fng_module%2Fng_module.bzl?ref=274cb38e0bb9a8bff4a48d1d15f4e16e59ec6f88",
            "patch": "@@ -318,9 +318,10 @@ def _generate_ve_shims(ctx):\n def _ngc_tsconfig(ctx, files, srcs, **kwargs):\n     generate_ve_shims = _generate_ve_shims(ctx)\n     compilation_mode = _get_ivy_compilation_mode(ctx)\n+    is_devmode = \"devmode_manifest\" in kwargs\n     outs = _expected_outs(ctx)\n     is_legacy_ngc = _is_view_engine_enabled(ctx)\n-    if \"devmode_manifest\" in kwargs:\n+    if is_devmode:\n         expected_outs = outs.devmode_js + outs.declarations + outs.summaries + outs.metadata\n     else:\n         expected_outs = outs.closure_js\n@@ -379,7 +380,7 @@ def _ngc_tsconfig(ctx, files, srcs, **kwargs):\n     if is_perf_requested(ctx):\n         # In Ivy mode, set the `tracePerformance` Angular compiler option to enable performance\n         # metric output.\n-        if \"devmode_manifest\" in kwargs:\n+        if is_devmode:\n             perf_path = outs.dev_perf_files[0].path\n         else:\n             perf_path = outs.prod_perf_files[0].path\n@@ -392,10 +393,21 @@ def _ngc_tsconfig(ctx, files, srcs, **kwargs):\n             [ctx.workspace_name] + ctx.label.package.split(\"/\") + [ctx.label.name, \"\"],\n         )\n \n-    return dict(tsc_wrapped_tsconfig(ctx, files, srcs, **kwargs), **{\n+    tsconfig = dict(tsc_wrapped_tsconfig(ctx, files, srcs, **kwargs), **{\n         \"angularCompilerOptions\": angular_compiler_options,\n     })\n \n+    # For prodmode, the compilation target is set to `ES2020`. `@bazel/typecript`\n+    # using the `create_tsconfig` function sets `ES2015` by default.\n+    # https://github.com/bazelbuild/rules_nodejs/blob/901df3868e3ceda177d3ed181205e8456a5592ea/third_party/github.com/bazelbuild/rules_typescript/internal/common/tsconfig.bzl#L195\n+    # TODO(devversion): In the future, combine prodmode and devmode so we can get rid of the\n+    # ambiguous terminology and concept that can result in slow-down for development workflows.\n+    if not is_devmode:\n+        # Note: Keep in sync with the `prodmode_target` for `ts_library` in `tools/defaults.bzl`\n+        tsconfig[\"compilerOptions\"][\"target\"] = \"es2020\"\n+\n+    return tsconfig\n+\n def _has_target_angular_summaries(target):\n     return hasattr(target, \"angular\") and hasattr(target.angular, \"summaries\")\n "
        },
        {
            "sha": "68c000b6a39d4336a72faee1cacf5f826ee5498b",
            "filename": "tools/defaults.bzl",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/angular/angular/blob/274cb38e0bb9a8bff4a48d1d15f4e16e59ec6f88/tools%2Fdefaults.bzl",
            "raw_url": "https://github.com/angular/angular/raw/274cb38e0bb9a8bff4a48d1d15f4e16e59ec6f88/tools%2Fdefaults.bzl",
            "contents_url": "https://api.github.com/repos/angular/angular/contents/tools%2Fdefaults.bzl?ref=274cb38e0bb9a8bff4a48d1d15f4e16e59ec6f88",
            "patch": "@@ -120,6 +120,10 @@ def ts_library(name, tsconfig = None, testonly = False, deps = [], module_name =\n         tsconfig = tsconfig,\n         testonly = testonly,\n         deps = deps,\n+        # For prodmode, the target is set to `ES2020`. `@bazel/typecript` sets `ES2015` by\n+        # default. Note that this should be in sync with the `ng_module` tsconfig generation.\n+        # https://github.com/bazelbuild/rules_nodejs/blob/901df3868e3ceda177d3ed181205e8456a5592ea/third_party/github.com/bazelbuild/rules_typescript/internal/common/tsconfig.bzl#L195\n+        prodmode_target = \"es2020\",\n         # `module_name` is used for AMD module names within emitted JavaScript files.\n         module_name = module_name,\n         # `package_name` can be set to allow for the Bazel NodeJS linker to run. This"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 19,
        "deletions": 3
    }
}