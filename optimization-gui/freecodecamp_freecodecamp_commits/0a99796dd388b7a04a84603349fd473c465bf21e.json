{
    "author": "ojeytonwilliams",
    "message": "refactor: simplified and documented test helpers (#55493)",
    "sha": "0a99796dd388b7a04a84603349fd473c465bf21e",
    "files": [
        {
            "sha": "97b508f50da2aee540f2a3b8fa432c3ea8b51747",
            "filename": "api/jest.utils.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 7,
            "changes": 30,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0a99796dd388b7a04a84603349fd473c465bf21e/api%2Fjest.utils.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0a99796dd388b7a04a84603349fd473c465bf21e/api%2Fjest.utils.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fjest.utils.ts?ref=0a99796dd388b7a04a84603349fd473c465bf21e",
            "patch": "@@ -13,7 +13,7 @@ declare global {\n \n type Options = {\n   sendCSRFToken?: boolean;\n-} & Record<string, unknown>;\n+};\n \n const requests = {\n   GET: (resource: string) => request(fastifyTestInstance?.server).get(resource),\n@@ -41,16 +41,27 @@ export const getCookies = (setCookies: string[]): string => {\n   return setCookies.map(cookie => cookie.split(';')[0]).join('; ');\n };\n \n+/**\n+ * A wrapper around supertest that handles common setup for requests. Namely\n+ * setting the Origin header, cookies and CSRF token.\n+ *\n+ * @param resource - The URL of the resource to be requested\n+ * @param config - The configuration for the request\n+ * @param config.method - The HTTP method to be used\n+ * @param config.setCookies - The cookies to be set in the request\n+ * @param options - Additional options for the request\n+ * @param options.sendCSRFToken - Whether to send the CSRF token in the request (default: true)\n+ * @returns The request object\n+ */\n export function superRequest(\n   resource: string,\n   config: {\n     method: 'GET' | 'POST' | 'PUT' | 'DELETE';\n     setCookies?: string[];\n-    headers?: { referer: string };\n   },\n   options?: Options\n ): request.Test {\n-  const { method, setCookies, headers } = config;\n+  const { method, setCookies } = config;\n   const { sendCSRFToken = true } = options ?? {};\n \n   const req = requests[method](resource).set('Origin', ORIGIN);\n@@ -59,17 +70,22 @@ export function superRequest(\n     void req.set('Cookie', getCookies(setCookies));\n   }\n \n-  if (headers) {\n-    void req.set('Referer', headers.referer);\n-  }\n-\n   const csrfToken = (setCookies && getCsrfToken(setCookies)) ?? '';\n   if (sendCSRFToken) {\n     void req.set('CSRF-Token', csrfToken);\n   }\n   return req;\n }\n \n+/**\n+ * Factory function for 'superRequest' allows for the creation of a concise\n+ * request function with the desired method and setCookies baked in.\n+ *\n+ * @param config\n+ * @param config.method - HTTP method\n+ * @param config.setCookies - Cookies to be set in the request\n+ * @returns A superRequest function with the desired method and setCookies\n+ */\n export function createSuperRequest(config: {\n   method: 'GET' | 'POST' | 'PUT' | 'DELETE';\n   setCookies?: string[];"
        },
        {
            "sha": "12603ed0bd7aa8361f2ef3dd3a326533b7d369db",
            "filename": "api/src/routes/settings.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0a99796dd388b7a04a84603349fd473c465bf21e/api%2Fsrc%2Froutes%2Fsettings.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0a99796dd388b7a04a84603349fd473c465bf21e/api%2Fsrc%2Froutes%2Fsettings.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fsettings.test.ts?ref=0a99796dd388b7a04a84603349fd473c465bf21e",
            "patch": "@@ -1029,9 +1029,8 @@ Happy coding!\n     describe('/confirm-email', () => {\n       it('redirects to the HOME_LOCATION with flash message', async () => {\n         const res = await superRequest('/confirm-email', {\n-          method: 'GET',\n-          headers: { referer: 'https://who.knows/' }\n-        });\n+          method: 'GET'\n+        }).set('Referer', 'https://who.knows/');\n \n         expect(res.status).toBe(302);\n         expect(res.headers).toMatchObject({"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 25,
        "deletions": 10
    }
}