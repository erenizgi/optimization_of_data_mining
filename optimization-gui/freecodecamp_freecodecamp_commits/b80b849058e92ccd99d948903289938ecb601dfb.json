{
    "author": "ojeytonwilliams",
    "message": "fix: indentation error reporting (#62182)",
    "sha": "b80b849058e92ccd99d948903289938ecb601dfb",
    "files": [
        {
            "sha": "50ad7e4228f16d4fc89736a7882773f42150e5c0",
            "filename": "client/src/templates/Challenges/redux/execute-challenge-saga.js",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b80b849058e92ccd99d948903289938ecb601dfb/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fexecute-challenge-saga.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b80b849058e92ccd99d948903289938ecb601dfb/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fexecute-challenge-saga.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fexecute-challenge-saga.js?ref=b80b849058e92ccd99d948903289938ecb601dfb",
            "patch": "@@ -184,7 +184,7 @@ function* buildChallengeData(challengeData, options) {\n   }\n }\n \n-function* executeTests(testRunner, tests, testTimeout = 5000) {\n+export function* executeTests(testRunner, tests, testTimeout = 5000) {\n   const testStrings = tests.map(test => test.testString);\n   const rawResults = yield call(testRunner, testStrings, testTimeout);\n \n@@ -216,16 +216,18 @@ function* executeTests(testRunner, tests, testTimeout = 5000) {\n       if (err === 'timeout') {\n         newTest.err = 'Test timed out';\n         newTest.message = `${newTest.message} (${newTest.err})`;\n-      } else if (type === 'IndentationError' || type === 'SyntaxError') {\n+      } else {\n+        const { message, stack } = err;\n+        newTest.err = message + '\\n' + stack;\n+        newTest.stack = stack;\n+      }\n+\n+      if (type === 'IndentationError' || type === 'SyntaxError') {\n         const msgKey =\n           type === 'IndentationError'\n             ? 'learn.indentation-error'\n             : 'learn.syntax-error';\n         newTest.message = `<p>${i18next.t(msgKey)}</p>`;\n-      } else {\n-        const { message, stack } = err;\n-        newTest.err = message + '\\n' + stack;\n-        newTest.stack = stack;\n       }\n \n       const withIndex = newTest.message.replace(/<p>/, `<p>${i + 1}. `);"
        },
        {
            "sha": "ac60038aeded2dc2bc0ecdb5fa12243873a2c836",
            "filename": "client/src/templates/Challenges/redux/execute-challenge-saga.test.js",
            "status": "modified",
            "additions": 44,
            "deletions": 3,
            "changes": 47,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b80b849058e92ccd99d948903289938ecb601dfb/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fexecute-challenge-saga.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b80b849058e92ccd99d948903289938ecb601dfb/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fexecute-challenge-saga.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fexecute-challenge-saga.test.js?ref=b80b849058e92ccd99d948903289938ecb601dfb",
            "patch": "@@ -1,6 +1,8 @@\n import { expectSaga } from 'redux-saga-test-plan';\n import { describe, it, vi } from 'vitest';\n \n+import { previewChallengeSaga, executeTests } from './execute-challenge-saga';\n+\n vi.mock('redux-saga/effects', async importOriginal => {\n   const actual = await importOriginal();\n   return {\n@@ -9,6 +11,12 @@ vi.mock('redux-saga/effects', async importOriginal => {\n   };\n });\n \n+vi.mock('i18next', async () => ({\n+  default: {\n+    t: key => key\n+  }\n+}));\n+\n const initialState = {\n   challenge: { isBuildEnabled: true, isExecuting: false, challengeMeta: {} }\n };\n@@ -18,13 +26,11 @@ function reducer(state = initialState) {\n   return state;\n }\n \n-import { previewChallengeSaga } from './execute-challenge-saga';\n-\n const challengeMounted = { type: 'challenge.challengeMounted' };\n const previewMounted = { type: 'challenge.previewMounted' };\n const resetChallenge = { type: 'challenge.resetChallenge' };\n \n-describe('execute-challenge-saga', () => {\n+describe('previewChallengeSaga', () => {\n   it('flushes logs on challengeMounted', () => {\n     return expectSaga(previewChallengeSaga, challengeMounted)\n       .withReducer(reducer)\n@@ -46,3 +52,38 @@ describe('execute-challenge-saga', () => {\n       .silentRun();\n   });\n });\n+\n+describe('executeTests generator', () => {\n+  it('sets a special message for IndentationErrors', () => {\n+    const mockTestRunner = () => {\n+      return [\n+        {\n+          err: {\n+            type: 'IndentationError',\n+            message: 'Unexpected token',\n+            stack: '...'\n+          }\n+        }\n+      ];\n+    };\n+\n+    const tests = [{ testString: 'assert(true);', text: 'Test 1' }];\n+\n+    return expectSaga(executeTests, mockTestRunner, tests)\n+      .put({\n+        type: 'challenge.updateConsole',\n+        payload: '<p>1. learn.indentation-error</p>'\n+      })\n+      .returns([\n+        {\n+          err: 'Unexpected token\\n...',\n+          text: 'Test 1',\n+          testString: 'assert(true);',\n+          running: false,\n+          message: '<p>learn.indentation-error</p>',\n+          stack: '...'\n+        }\n+      ])\n+      .run();\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 61,
        "additions": 52,
        "deletions": 9
    }
}