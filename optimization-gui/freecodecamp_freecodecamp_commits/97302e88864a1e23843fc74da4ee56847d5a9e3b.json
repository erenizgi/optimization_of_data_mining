{
    "author": "raisedadead",
    "message": "fix(docker): consistently use DB everywhere (#62569)",
    "sha": "97302e88864a1e23843fc74da4ee56847d5a9e3b",
    "files": [
        {
            "sha": "6b772f45e36ea2d6fa701a629cbd4d4f9734589f",
            "filename": ".devcontainer/docker-compose.yml",
            "status": "modified",
            "additions": 32,
            "deletions": 16,
            "changes": 48,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/97302e88864a1e23843fc74da4ee56847d5a9e3b/.devcontainer%2Fdocker-compose.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/97302e88864a1e23843fc74da4ee56847d5a9e3b/.devcontainer%2Fdocker-compose.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.devcontainer%2Fdocker-compose.yml?ref=97302e88864a1e23843fc74da4ee56847d5a9e3b",
            "patch": "@@ -1,33 +1,49 @@\n services:\n   devcontainer:\n     depends_on:\n-      - mongo-db\n-      - mongo-setup\n+      - db\n+      - setup\n     image: mcr.microsoft.com/devcontainers/typescript-node:22\n     volumes:\n       - ../..:/workspaces:cached\n-    network_mode: service:mongo-db\n+    network_mode: service:db\n     command: sleep infinity\n \n-  mongo-db:\n-    image: mongo\n+  db:\n+    image: mongo:8.0\n+    container_name: mongodb\n     command: mongod --replSet rs0\n     restart: unless-stopped\n     hostname: mongodb\n     volumes:\n-      - mongodb-data:/data/db\n-  mongo-setup:\n-    image: mongo\n+      - db-data:/data/db\n+    healthcheck:\n+      test: ['CMD', 'mongosh', '--eval', \"db.adminCommand('ping')\"]\n+      interval: 2s\n+      retries: 5\n+\n+  setup:\n+    image: mongo:8.0\n     depends_on:\n-      - mongo-db\n+      db:\n+        condition: service_healthy\n     restart: on-failure\n-    entrypoint: [\n-        'bash',\n-        '-c',\n-        # This will try to initiate the replica set, until it succeeds twice (i.e. until the replica set is already initialized)\n-        'mongosh --host mongo-db:27017 --eval ''try {var cfg = { _id: \"rs0\", members: [{ _id: 0, host: \"mongodb:27017\" }] }; rs.initiate(cfg); } catch (err) { if(err.codeName !== \"AlreadyInitialized\") throw err };'''\n-      ]\n+    # This will try to initiate the replica set, until it succeeds twice (i.e. until the replica set is already initialized)\n+    command: >\n+      mongosh --host mongodb:27017 --eval '\n+        var cfg = {\n+          _id: \"rs0\",\n+          members: [\n+            { _id: 0, host: \"mongodb:27017\" }\n+          ]\n+        };\n+        try {\n+          rs.initiate(cfg);\n+        } catch (err) {\n+          if(err.codeName !== \"AlreadyInitialized\") throw err;\n+        }\n+      '\n \n volumes:\n-  mongodb-data:\n+  db-data:\n     driver: local"
        },
        {
            "sha": "5b529b09a3c12c8da8a2169d8959b5eb107c938c",
            "filename": ".github/workflows/e2e-third-party.yml",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/97302e88864a1e23843fc74da4ee56847d5a9e3b/.github%2Fworkflows%2Fe2e-third-party.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/97302e88864a1e23843fc74da4ee56847d5a9e3b/.github%2Fworkflows%2Fe2e-third-party.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fe2e-third-party.yml?ref=97302e88864a1e23843fc74da4ee56847d5a9e3b",
            "patch": "@@ -94,15 +94,6 @@ jobs:\n       matrix:\n         browsers: [chromium]\n         node-version: [22]\n-    services:\n-      mongodb:\n-        image: mongo:8.0\n-        ports:\n-          - 27017:27017\n-      mailpit:\n-        image: axllent/mailpit\n-        ports:\n-          - 1025:1025\n     steps:\n       - name: Set Action Environment Variables\n         run: |"
        },
        {
            "sha": "03677fd96721d3cbda78335060b597b36b119d71",
            "filename": ".github/workflows/node.js-tests.yml",
            "status": "modified",
            "additions": 2,
            "deletions": 10,
            "changes": 12,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/97302e88864a1e23843fc74da4ee56847d5a9e3b/.github%2Fworkflows%2Fnode.js-tests.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/97302e88864a1e23843fc74da4ee56847d5a9e3b/.github%2Fworkflows%2Fnode.js-tests.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fnode.js-tests.yml?ref=97302e88864a1e23843fc74da4ee56847d5a9e3b",
            "patch": "@@ -141,11 +141,7 @@ jobs:\n           cat .env\n \n       - name: Start MongoDB\n-        uses: supercharge/mongodb-github-action@b0a1493307c4e9b82ed61f3858d606c5ff190c64 # v1.10.0\n-        with:\n-          mongodb-version: 8.0\n-          mongodb-replica-set: test-rs\n-          mongodb-port: 27017\n+        run: docker compose -f docker/docker-compose.yml up -d\n \n       - name: Install Dependencies\n         run: |\n@@ -192,11 +188,7 @@ jobs:\n           cat .env\n \n       - name: Start MongoDB\n-        uses: supercharge/mongodb-github-action@b0a1493307c4e9b82ed61f3858d606c5ff190c64 # v1.10.0\n-        with:\n-          mongodb-version: 8.0\n-          mongodb-replica-set: test-rs\n-          mongodb-port: 27017\n+        run: docker compose -f docker/docker-compose.yml up -d\n \n       - name: Install Dependencies\n         run: |"
        },
        {
            "sha": "befe7a3e2f882ae03ec81e4640be0efd5f66d95b",
            "filename": "docker/docker-compose.e2e.yml",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/97302e88864a1e23843fc74da4ee56847d5a9e3b/docker%2Fdocker-compose.e2e.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/97302e88864a1e23843fc74da4ee56847d5a9e3b/docker%2Fdocker-compose.e2e.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/docker%2Fdocker-compose.e2e.yml?ref=97302e88864a1e23843fc74da4ee56847d5a9e3b",
            "patch": "@@ -12,8 +12,8 @@ services:\n     environment:\n       # The api cannot connect to mongodb or mailpit via localhost from inside the\n       # container, so we have to override these variables.\n-      - MONGOHQ_URL=mongodb://db:27017/freecodecamp?directConnection=true\n-      - MAILHOG_HOST=mailpit\n+      - MONGOHQ_URL=mongodb://mongodb:27017/freecodecamp?replicaSet=rs0\n+      - MAILPIT_HOST=mailpit\n       - HOST=0.0.0.0\n     ports:\n       - '3000:3000'"
        },
        {
            "sha": "b8cb6b104fb5f7d36dc31a6e5294f9a3ee8ffe18",
            "filename": "docker/docker-compose.yml",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/97302e88864a1e23843fc74da4ee56847d5a9e3b/docker%2Fdocker-compose.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/97302e88864a1e23843fc74da4ee56847d5a9e3b/docker%2Fdocker-compose.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/docker%2Fdocker-compose.yml?ref=97302e88864a1e23843fc74da4ee56847d5a9e3b",
            "patch": "@@ -1,6 +1,6 @@\n services:\n   db:\n-    image: mongo\n+    image: mongo:8.0\n     container_name: mongodb\n     command: mongod --replSet rs0\n     restart: unless-stopped\n@@ -15,14 +15,14 @@ services:\n       retries: 5\n \n   setup:\n-    image: mongo\n+    image: mongo:8.0\n     depends_on:\n       db:\n         condition: service_healthy\n     restart: on-failure\n     # This will try to initiate the replica set, until it succeeds twice (i.e. until the replica set is already initialized)\n     command: >\n-      mongosh --host db:27017 --eval '\n+      mongosh --host mongodb:27017 --eval '\n         var cfg = {\n           _id: \"rs0\",\n           members: ["
        }
    ],
    "stats": {
        "total": 79,
        "additions": 39,
        "deletions": 40
    }
}