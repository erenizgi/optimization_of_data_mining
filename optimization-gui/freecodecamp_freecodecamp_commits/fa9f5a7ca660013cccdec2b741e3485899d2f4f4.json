{
    "author": "ojeytonwilliams",
    "message": "fix(client): calculate streaks correctly (#59252)",
    "sha": "fa9f5a7ca660013cccdec2b741e3485899d2f4f4",
    "files": [
        {
            "sha": "3f3065ff2c1464be5be0eca8d329a2e687de1cd4",
            "filename": "client/src/components/profile/components/stats.test.tsx",
            "status": "modified",
            "additions": 24,
            "deletions": 5,
            "changes": 29,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/fa9f5a7ca660013cccdec2b741e3485899d2f4f4/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fstats.test.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/fa9f5a7ca660013cccdec2b741e3485899d2f4f4/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fstats.test.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fstats.test.tsx?ref=fa9f5a7ca660013cccdec2b741e3485899d2f4f4",
            "patch": "@@ -46,11 +46,23 @@ const twoStreakCalendar = {\n   '1736946000': 1 // 2025-01-15 13:00:00 UTC\n };\n \n+const multipleEntriesInOneDay = {\n+  // Two on Jan 13, 2025\n+  '1736755200': 1, // 2025-01-13 08:00:00 UTC\n+  '1736755500': 1, // 2025-01-13 08:05:00 UTC\n+  // Two on Jan 14, 2025\n+  '1736845200': 1, // 2025-01-14 09:00:00 UTC\n+  '1736845500': 1, // 2025-01-14 09:05:00 UTC\n+  // Two on Jan 15, 2025\n+  '1736946000': 1, // 2025-01-15 13:00:00 UTC\n+  '1736946300': 1 // 2025-01-15 13:05:00 UTC\n+};\n+\n jest.useFakeTimers();\n \n describe('calculateStreaks', () => {\n-  test('Should return a longest streak of 5 days when the user has not completed a challenge in a while', () => {\n-    jest.setSystemTime(new Date(2025, 0, 15));\n+  beforeEach(() => jest.setSystemTime(new Date(2025, 0, 15)));\n+  test('Should return 0 for the current streak if the user has not made progress today', () => {\n     const { longestStreak, currentStreak } =\n       calculateStreaks(oldStreakCalendar);\n \n@@ -77,10 +89,8 @@ describe('calculateStreaks', () => {\n   });\n \n   test('Should return a longest and current streaks of 1 day when the user has recently completed their first challenge', () => {\n-    const now = new Date(2025, 0, 15);\n-    jest.setSystemTime(now);\n     const calendar = {\n-      [now.valueOf() / 1000]: 1\n+      [Date.now() / 1000]: 1\n     };\n \n     const { longestStreak, currentStreak } = calculateStreaks(calendar);\n@@ -103,4 +113,13 @@ describe('calculateStreaks', () => {\n     expect(longestStreak).toBe(0);\n     expect(currentStreak).toBe(0);\n   });\n+\n+  test('Should handle multiple entries in one day', () => {\n+    const { longestStreak, currentStreak } = calculateStreaks(\n+      multipleEntriesInOneDay\n+    );\n+\n+    expect(longestStreak).toBe(3);\n+    expect(currentStreak).toBe(3);\n+  });\n });"
        },
        {
            "sha": "817783d6ea26a75a20eba81b1e8b74cfd31df96e",
            "filename": "client/src/components/profile/components/stats.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/fa9f5a7ca660013cccdec2b741e3485899d2f4f4/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fstats.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/fa9f5a7ca660013cccdec2b741e3485899d2f4f4/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fstats.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fstats.tsx?ref=fa9f5a7ca660013cccdec2b741e3485899d2f4f4",
            "patch": "@@ -3,7 +3,7 @@ import { startOfDay, addDays, isEqual } from 'date-fns';\n import { useTranslation } from 'react-i18next';\n import { Spacer } from '@freecodecamp/ui';\n import { last } from 'lodash-es';\n-import { uniq } from 'lodash';\n+import { uniqBy } from 'lodash';\n \n import { FullWidthRow } from '../../helpers';\n \n@@ -19,7 +19,10 @@ export const calculateStreaks = (calendar: Record<string, number>) => {\n   const timestamps = Object.keys(calendar).map(\n     stamp => Number.parseInt(stamp, 10) * 1000\n   );\n-  const days = uniq(timestamps.map(stamp => startOfDay(stamp)));\n+  const days = uniqBy(\n+    timestamps.map(stamp => startOfDay(stamp)),\n+    day => day.getTime()\n+  );\n \n   const { longestStreak, currentStreak } = days.reduce(\n     (acc, day) => {"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 29,
        "deletions": 7
    }
}