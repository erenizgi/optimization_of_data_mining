{
    "author": "Sembauke",
    "message": "feat(client): exam token UI (#55687)\n\nCo-authored-by: Shaun Hamilton <shauhami020@gmail.com>",
    "sha": "068c5a7db0775ef4d9a918f4bb7f5764c9b9673f",
    "files": [
        {
            "sha": "bbeeb51dd3e606443c30902b0a8a8e97fadfd905",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/068c5a7db0775ef4d9a918f4bb7f5764c9b9673f/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/068c5a7db0775ef4d9a918f4bb7f5764c9b9673f/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=068c5a7db0775ef4d9a918f4bb7f5764c9b9673f",
            "patch": "@@ -7,6 +7,7 @@\n     \"first-lesson\": \"Go to the first lesson\",\n     \"close\": \"Close\",\n     \"edit\": \"Edit\",\n+    \"copy\": \"Copy\",\n     \"view\": \"View\",\n     \"view-code\": \"View Code\",\n     \"view-project\": \"View Project\",\n@@ -1111,6 +1112,16 @@\n     \"no-thanks\": \"No thanks, I would like to keep my token\",\n     \"yes-please\": \"Yes please, I would like to delete my token\"\n   },\n+  \"exam-token\": {\n+    \"exam-token\": \"Exam Token\",\n+    \"note\": \"Your exam token is a secret key that allows you to access exams. Do not share this token with anyone.\",\n+    \"invalidation\": \"If you generate a new token, your old token will be invalidated.\",\n+    \"generate-exam-token\": \"Generate Exam Token\",\n+    \"error\": \"There was an error generating your token, please try again in a moment.\",\n+    \"your-exam-token\": \"Your Exam Token is: {{token}}\",\n+    \"copied\": \"Token copied to clipboard\",\n+    \"copy-error\": \"Error copying token to clipboard\"\n+  },\n   \"shortcuts\": {\n     \"title\": \"Keyboard shortcuts\",\n     \"table-header-action\": \"Action\","
        },
        {
            "sha": "616c3409dee8cbc0856557cbafe84432cd97f396",
            "filename": "client/src/client-only-routes/show-settings.tsx",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/068c5a7db0775ef4d9a918f4bb7f5764c9b9673f/client%2Fsrc%2Fclient-only-routes%2Fshow-settings.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/068c5a7db0775ef4d9a918f4bb7f5764c9b9673f/client%2Fsrc%2Fclient-only-routes%2Fshow-settings.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fclient-only-routes%2Fshow-settings.tsx?ref=068c5a7db0775ef4d9a918f4bb7f5764c9b9673f",
            "patch": "@@ -5,6 +5,7 @@ import { connect } from 'react-redux';\n import { createSelector } from 'reselect';\n \n import { Callout, Container } from '@freecodecamp/ui';\n+import { useFeatureIsOn } from '@growthbook/growthbook-react';\n \n import store from 'store';\n import envData from '../../config/env.json';\n@@ -18,6 +19,7 @@ import Honesty from '../components/settings/honesty';\n import Privacy from '../components/settings/privacy';\n import { type ThemeProps, Themes } from '../components/settings/theme';\n import UserToken from '../components/settings/user-token';\n+import ExamToken from '../components/settings/exam-token';\n import { hardGoTo as navigate } from '../redux/actions';\n import {\n   signInLoadingSelector,\n@@ -35,6 +37,7 @@ import {\n   updateMyKeyboardShortcuts,\n   verifyCert\n } from '../redux/settings/actions';\n+\n const { apiLocation } = envData;\n \n // TODO: update types for actions\n@@ -126,6 +129,8 @@ export function ShowSettings(props: ShowSettingsProps): JSX.Element {\n   } = props;\n   const isSignedInRef = useRef(isSignedIn);\n \n+  const examTokenFlag = useFeatureIsOn('exam-token-widget');\n+\n   if (showLoading) {\n     return <Loader fullScreen={true} />;\n   }\n@@ -172,6 +177,7 @@ export function ShowSettings(props: ShowSettingsProps): JSX.Element {\n           <Spacer size='medium' />\n           <Honesty isHonest={isHonest} updateIsHonest={updateIsHonest} />\n           <Spacer size='medium' />\n+          {examTokenFlag && <ExamToken />}\n           <Certification\n             completedChallenges={completedChallenges}\n             createFlashMessage={createFlashMessage}"
        },
        {
            "sha": "253d0312e820978e710e36d54b5d61cb2a57a58a",
            "filename": "client/src/components/settings/exam-token.tsx",
            "status": "added",
            "additions": 110,
            "deletions": 0,
            "changes": 110,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/068c5a7db0775ef4d9a918f4bb7f5764c9b9673f/client%2Fsrc%2Fcomponents%2Fsettings%2Fexam-token.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/068c5a7db0775ef4d9a918f4bb7f5764c9b9673f/client%2Fsrc%2Fcomponents%2Fsettings%2Fexam-token.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fsettings%2Fexam-token.tsx?ref=068c5a7db0775ef4d9a918f4bb7f5764c9b9673f",
            "patch": "@@ -0,0 +1,110 @@\n+import React, { useState } from 'react';\n+import { Button, Panel, Modal, Spacer } from '@freecodecamp/ui';\n+import { useTranslation } from 'react-i18next';\n+import { FullWidthRow } from '../helpers';\n+import { generateExamToken } from '../../utils/ajax';\n+\n+function ExamToken(): JSX.Element {\n+  const [examToken, setExamToken] = useState<string | null>(null);\n+  const [examTokenError, setExamTokenError] = useState<string | null>(null);\n+\n+  const [recentlyGenerated, setRecentlyGenerated] = useState(false);\n+\n+  const [copySuccess, setCopySuccess] = useState<string | null>(null);\n+  const [copyError, setCopyError] = useState<string | null>(null);\n+\n+  const { t } = useTranslation();\n+\n+  const getToken = async () => {\n+    try {\n+      const response = await generateExamToken();\n+\n+      const {\n+        data: {\n+          data: { examEnvironmentAuthorizationToken }\n+        }\n+      } = response;\n+      setExamToken(examEnvironmentAuthorizationToken);\n+      setExamTokenError('');\n+    } catch (e) {\n+      setExamTokenError(t('exam-token.error'));\n+    }\n+\n+    setRecentlyGenerated(true);\n+    setTimeout(() => setRecentlyGenerated(false), 10000);\n+  };\n+\n+  return (\n+    <FullWidthRow>\n+      <Modal\n+        open={!!examToken}\n+        onClose={() => {\n+          setExamToken(null);\n+          setCopySuccess(null);\n+          setCopyError(null);\n+        }}\n+      >\n+        <Modal.Header>{t('exam-token.exam-token')}</Modal.Header>\n+        <Modal.Body>\n+          {examToken && (\n+            <p style={{ wordBreak: 'break-word' }}>\n+              {t('exam-token.your-exam-token', {\n+                token: examToken\n+              })}\n+            </p>\n+          )}\n+          {examTokenError && <p style={{ color: 'red' }}>{examTokenError}</p>}\n+          {copySuccess && <p style={{ color: 'green' }}>{copySuccess}</p>}\n+          {copyError && <p style={{ color: 'red' }}>{copyError}</p>}\n+        </Modal.Body>\n+        <Modal.Footer>\n+          <Button\n+            onClick={() => {\n+              navigator.clipboard.writeText(examToken ?? '').then(\n+                () => {\n+                  setCopySuccess(t('exam-token.copied'));\n+                  setCopyError(null);\n+                },\n+                () => {\n+                  setCopyError(t('exam-token.copy-error'));\n+                  setCopySuccess(null);\n+                }\n+              );\n+            }}\n+          >\n+            {t('buttons.copy')}\n+          </Button>\n+          <Spacer size='s' />\n+          <Button\n+            onClick={() => {\n+              setExamToken(null);\n+              setCopySuccess(null);\n+              setCopyError(null);\n+            }}\n+          >\n+            {t('buttons.close')}\n+          </Button>\n+        </Modal.Footer>\n+      </Modal>\n+      <Panel variant='info' id='exam-environment-authorization-token'>\n+        <Panel.Heading>{t('exam-token.exam-token')}</Panel.Heading>\n+        <Panel.Body>\n+          <p>{t('exam-token.note')}</p>\n+          <strong>{t('exam-token.invalidation')}</strong>\n+          <Spacer size='s' />\n+          <Button\n+            block={true}\n+            disabled={recentlyGenerated}\n+            onClick={() => void getToken()}\n+          >\n+            {t('exam-token.generate-exam-token')}\n+          </Button>\n+        </Panel.Body>\n+      </Panel>\n+    </FullWidthRow>\n+  );\n+}\n+\n+ExamToken.displayName = 'ExamToken';\n+\n+export default ExamToken;"
        },
        {
            "sha": "ddf77dac79fe0656ed061d6d82bd3c241c75f2a8",
            "filename": "client/src/redux/prop-types.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/068c5a7db0775ef4d9a918f4bb7f5764c9b9673f/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/068c5a7db0775ef4d9a918f4bb7f5764c9b9673f/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fprop-types.ts?ref=068c5a7db0775ef4d9a918f4bb7f5764c9b9673f",
            "patch": "@@ -469,6 +469,11 @@ export interface GenerateExamResponseWithData {\n   data: GenerateExamResponse;\n }\n \n+export interface ExamTokenResponse {\n+  data: {\n+    examEnvironmentAuthorizationToken: string;\n+  };\n+}\n // User Exam (null until they answer the question)\n interface UserExamAnswer {\n   id: string | null;"
        },
        {
            "sha": "6e39591d7bc4b35139c2ae904dcc9ba2921c8731",
            "filename": "client/src/utils/ajax.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/068c5a7db0775ef4d9a918f4bb7f5764c9b9673f/client%2Fsrc%2Futils%2Fajax.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/068c5a7db0775ef4d9a918f4bb7f5764c9b9673f/client%2Fsrc%2Futils%2Fajax.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Fajax.ts?ref=068c5a7db0775ef4d9a918f4bb7f5764c9b9673f",
            "patch": "@@ -5,6 +5,7 @@ import type {\n   ChallengeFile,\n   ChallengeFiles,\n   CompletedChallenge,\n+  ExamTokenResponse,\n   GenerateExamResponseWithData,\n   SavedChallenge,\n   SavedChallengeFile,\n@@ -258,6 +259,12 @@ export function postChargeStripeCard(\n   return post('/donate/charge-stripe-card', body);\n }\n \n+export function generateExamToken(): Promise<\n+  ResponseWithData<ExamTokenResponse>\n+> {\n+  return post('/user/exam-environment/token', {});\n+}\n+\n type PaymentIntentResponse = Promise<\n   ResponseWithData<\n     | {"
        },
        {
            "sha": "46ca3665a0a16e294fbbecca86c33e84a6a62fd5",
            "filename": "e2e/exam-token.spec.ts",
            "status": "added",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/068c5a7db0775ef4d9a918f4bb7f5764c9b9673f/e2e%2Fexam-token.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/068c5a7db0775ef4d9a918f4bb7f5764c9b9673f/e2e%2Fexam-token.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fexam-token.spec.ts?ref=068c5a7db0775ef4d9a918f4bb7f5764c9b9673f",
            "patch": "@@ -0,0 +1,42 @@\n+// TO ENABLE THESE TESTS GROWTHBOOK HAS TO BE SET IN THE ENVIRONMENT VARIABLES`\n+// UNCOMMENT WHEN NEW API IS READY.\n+\n+// import { test, expect } from '@playwright/test';\n+\n+// test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+\n+// test.beforeEach(async ({ page }) => {\n+//   await page.goto('/settings');\n+// });\n+\n+// test.describe('Exam Token Widget', () => {\n+//   test('should tell you to not share the token with anyone', async ({\n+//     page\n+//   }) => {\n+//     await expect(\n+//       page.getByText(\n+//         'Your exam token is a secret key that allows you to access the exam. Do not share this token with anyone'\n+//       )\n+//     ).toBeVisible();\n+//     await expect(\n+//       page.getByText(\n+//         'If you generate a new token, your old token will be invalidated.'\n+//       )\n+//     ).toBeVisible();\n+\n+//     await expect(\n+//       page.getByRole('button', { name: 'Generate Exam Token' })\n+//     ).toBeVisible();\n+//   });\n+\n+//   test('should be able to generate a token', async ({ page }) => {\n+//     await page.getByRole('button', { name: 'Generate Exam Token' }).click();\n+//     await expect(page.getByText('Your Exam Token is:')).toBeVisible();\n+\n+//     await expect(page.getByRole('button', { name: 'Copy' })).toBeVisible();\n+\n+//     await expect(\n+//       page.getByRole('button', { name: 'Close' }).nth(1)\n+//     ).toBeVisible();\n+//   });\n+// });"
        }
    ],
    "stats": {
        "total": 181,
        "additions": 181,
        "deletions": 0
    }
}