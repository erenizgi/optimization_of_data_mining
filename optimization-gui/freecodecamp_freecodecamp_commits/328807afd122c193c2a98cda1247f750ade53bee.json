{
    "author": "Sembauke",
    "message": "feat: convert thirdparty donation tests to Playwright (#55043)",
    "sha": "328807afd122c193c2a98cda1247f750ade53bee",
    "files": [
        {
            "sha": "39c2e3e6273176fb3b83bbbdb02cfbdad7f65172",
            "filename": ".github/workflows/e2e-playwright.yml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/328807afd122c193c2a98cda1247f750ade53bee/.github%2Fworkflows%2Fe2e-playwright.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/328807afd122c193c2a98cda1247f750ade53bee/.github%2Fworkflows%2Fe2e-playwright.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fe2e-playwright.yml?ref=328807afd122c193c2a98cda1247f750ade53bee",
            "patch": "@@ -142,7 +142,7 @@ jobs:\n         run: |\n           pnpm run start-ci &\n           sleep 10\n-          npx playwright test --project=${{ matrix.browsers }}\n+          npx playwright test --project=${{ matrix.browsers }} --grep-invert 'third-party-donation.spec.ts'\n \n       - uses: actions/upload-artifact@v4\n         if: ${{ !cancelled() }}"
        },
        {
            "sha": "e7cdf151adcad6c2b5b97e8952e3eb164d40dab8",
            "filename": ".github/workflows/e2e-third-party.yml",
            "status": "modified",
            "additions": 21,
            "deletions": 20,
            "changes": 41,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/328807afd122c193c2a98cda1247f750ade53bee/.github%2Fworkflows%2Fe2e-third-party.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/328807afd122c193c2a98cda1247f750ade53bee/.github%2Fworkflows%2Fe2e-third-party.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fe2e-third-party.yml?ref=328807afd122c193c2a98cda1247f750ade53bee",
            "patch": "@@ -53,39 +53,40 @@ jobs:\n \n       - name: Set freeCodeCamp Environment Variables\n         run: |\n-          sed '/STRIPE/d; /PAYPAL/d;' sample.env > .env\n+          sed '/STRIPE/d; /PAYPAL/d; /PATREON/d;' sample.env > .env\n           echo 'STRIPE_PUBLIC_KEY=${{ secrets.STRIPE_PUBLIC_KEY }}' >> .env\n-          echo 'STRIPE_SECRET_KEY=${{ secrets.STRIPE_SECRET_KEY }}' >> .env\n           echo 'PAYPAL_CLIENT_ID=${{ secrets.PAYPAL_CLIENT_ID }}' >> .env\n+          echo 'PATREON_CLIENT_ID=${{ secrets.PATREON_CLIENT_ID }}' >> .env\n \n       - name: Install and Build\n         run: |\n           pnpm install\n-          pnpm run build\n-      - name: Seed Database\n-        run: pnpm run seed\n+          pnpm run create:shared\n+          pnpm run build:curriculum\n+          pnpm run build:server\n+\n+      - name: Seed Database with Certified User\n+        run: pnpm run seed:certified-user\n+\n       - name: Move serve.json to Public Folder\n         run: cp client-config/serve.json client/public/serve.json\n \n       # start-ci uses pm2, so it needs to be installed globally\n       - name: Install pm2\n         run: npm i -g pm2\n \n-        # In our cypress config, we default to the cypress/e2e/default directory.\n-        # We need to change this to cypress/e2e/ for the specific tests we are running\n-        # in this workflow.\n-        #\n-      - name: Adjust the Cypress Config\n+      - name: Install playwright dependencies\n+        run: npx playwright install --with-deps\n+\n+      - name: Run playwright tests\n         run: |\n-          sed -i 's#cypress/e2e/default/#cypress/e2e/#g' cypress.config.js\n+          pnpm run start-ci &\n+          sleep 10\n+          npx playwright test third-party-donation.spec.ts --project=${{ matrix.browsers }}\n \n-      - name: Cypress run\n-        uses: cypress-io/github-action@v6\n+      - uses: actions/upload-artifact@v4\n+        if: ${{ !cancelled() }}\n         with:\n-          record: ${{ env.CYPRESS_RECORD_KEY != 0 }}\n-          start: pnpm run start-ci\n-          wait-on: http://localhost:8000\n-          wait-on-timeout: 1200\n-          config: baseUrl=http://localhost:8000\n-          browser: chrome\n-          spec: 'cypress/e2e/third-party/donate-page.ts'\n+          name: playwright-report-${{ matrix.browsers }}\n+          path: playwright/reporter\n+          retention-days: 30"
        },
        {
            "sha": "69d2dffe9519bc03bc44d698956675cad76f71f0",
            "filename": "cypress/e2e/third-party/donate-page.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3bd73f7aa47db79a05076567dd7b28f3d5759608/cypress%2Fe2e%2Fthird-party%2Fdonate-page.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3bd73f7aa47db79a05076567dd7b28f3d5759608/cypress%2Fe2e%2Fthird-party%2Fdonate-page.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/cypress%2Fe2e%2Fthird-party%2Fdonate-page.ts?ref=3bd73f7aa47db79a05076567dd7b28f3d5759608",
            "patch": "@@ -1,18 +0,0 @@\n-describe('Donate page', () => {\n-  it('Donation ', () => {\n-    cy.task('seed', ['certified-user']);\n-    cy.login('certified-user');\n-    cy.visit('/donate');\n-    cy.get(\"[data-cy='donation-tier-selection-button']\").click();\n-\n-    cy.get('.donation-elements', { timeout: 10000 }).within(() => {\n-      cy.fillElementsInput('cardNumber', '4242424242424242');\n-      cy.fillElementsInput('cardExpiry', '1025');\n-    });\n-    cy.get(\"[data-cy='donation-confirmation-button']\").click();\n-    cy.contains('We are processing your donation.').should('be.visible');\n-    cy.contains('Thank You for Being a Supporter', { timeout: 10000 }).should(\n-      'be.visible'\n-    );\n-  });\n-});"
        },
        {
            "sha": "2fcf5636f4fe274a8c831d2819a6ee9ba1067d84",
            "filename": "e2e/fixtures/donation/stripe.json",
            "status": "added",
            "additions": 48,
            "deletions": 0,
            "changes": 48,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/328807afd122c193c2a98cda1247f750ade53bee/e2e%2Ffixtures%2Fdonation%2Fstripe.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/328807afd122c193c2a98cda1247f750ade53bee/e2e%2Ffixtures%2Fdonation%2Fstripe.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Ffixtures%2Fdonation%2Fstripe.json?ref=328807afd122c193c2a98cda1247f750ade53bee",
            "patch": "@@ -0,0 +1,48 @@\n+{\n+  \"id\": \"pm_1PRWUAFI1KEgscdTFyjUCbcd\",\n+  \"object\": \"payment_method\",\n+  \"allow_redisplay\": \"unspecified\",\n+  \"billing_details\": {\n+    \"address\": {\n+      \"city\": null,\n+      \"country\": null,\n+      \"line1\": null,\n+      \"line2\": null,\n+      \"postal_code\": null,\n+      \"state\": null\n+    },\n+    \"email\": null,\n+    \"name\": null,\n+    \"phone\": null\n+  },\n+  \"card\": {\n+    \"brand\": \"visa\",\n+    \"checks\": {\n+      \"address_line1_check\": null,\n+      \"address_postal_code_check\": null,\n+      \"cvc_check\": null\n+    },\n+    \"country\": \"US\",\n+    \"display_brand\": \"visa\",\n+    \"exp_month\": 10,\n+    \"exp_year\": 2025,\n+    \"funding\": \"credit\",\n+    \"generated_from\": null,\n+    \"last4\": \"4242\",\n+    \"networks\": {\n+      \"available\": [\n+        \"visa\"\n+      ],\n+      \"preferred\": null\n+    },\n+    \"three_d_secure_usage\": {\n+      \"supported\": true\n+    },\n+    \"wallet\": null\n+  },\n+  \"created\": 1718357514,\n+  \"customer\": null,\n+  \"livemode\": false,\n+  \"radar_options\": {},\n+  \"type\": \"card\"\n+}"
        },
        {
            "sha": "7167a92fd611d4e70e404d6c12b9664696507d8e",
            "filename": "e2e/third-party-donation.spec.ts",
            "status": "added",
            "additions": 75,
            "deletions": 0,
            "changes": 75,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/328807afd122c193c2a98cda1247f750ade53bee/e2e%2Fthird-party-donation.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/328807afd122c193c2a98cda1247f750ade53bee/e2e%2Fthird-party-donation.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fthird-party-donation.spec.ts?ref=328807afd122c193c2a98cda1247f750ade53bee",
            "patch": "@@ -0,0 +1,75 @@\n+import { test, expect } from '@playwright/test';\n+\n+import stripeJson from './fixtures/donation/stripe.json';\n+\n+test.describe('third-party donation tests', () => {\n+  test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+  test.beforeEach(async ({ page }) => {\n+    await page.goto('/donate');\n+  });\n+\n+  test('All elements are present in the widget', async ({ page }) => {\n+    await page.getByRole('button', { name: 'Donate', exact: true }).click();\n+\n+    // Paypal button should be present\n+\n+    const paypalButtonIframe = page.frameLocator('.component-frame');\n+    const paypalButton = paypalButtonIframe.getByRole('link');\n+    await expect(paypalButton).toBeVisible();\n+    await expect(paypalButton).toHaveAttribute('aria-label', 'PayPal');\n+\n+    // Patreon button should be present\n+\n+    const patreonButton = page.locator('.patreon-button');\n+    await expect(patreonButton).toBeVisible();\n+\n+    // \"Or dontate with card\" button should be present\n+\n+    await expect(page.getByText('Or donate with card')).toBeVisible();\n+  });\n+\n+  test('It is possible to donate with a card', async ({ page }) => {\n+    await page.getByRole('button', { name: 'Donate', exact: true }).click();\n+\n+    const cardNumberIframe = page\n+      .frameLocator('iframe[src*=\"elements-inner-card\"]')\n+      .nth(0);\n+\n+    const cardExpiryIframe = page\n+      .frameLocator('iframe[src*=\"elements-inner-card\"]')\n+      .nth(1);\n+\n+    await cardNumberIframe\n+      .locator('input[data-elements-stable-field-name=\"cardNumber\"]')\n+      .fill('4242424242424242');\n+\n+    await cardExpiryIframe\n+      .locator('input[data-elements-stable-field-name=\"cardExpiry\"]')\n+      .fill('1025');\n+\n+    await page.getByRole('button', { name: 'Donate', exact: true }).click();\n+\n+    await page.route(\n+      'https://api.stripe.com/v1/payment_methods',\n+      async route => {\n+        await route.fulfill({ json: stripeJson });\n+      }\n+    );\n+\n+    await page.route(\n+      'http://localhost:3000/donate/charge-stripe-card',\n+      async route => {\n+        await route.fulfill({ json: { isDonating: true } });\n+      }\n+    );\n+\n+    await expect(page.getByRole('alert')).toBeVisible();\n+\n+    await expect(page.getByRole('alert')).toContainText(\n+      'Your donations will support free technology education for people all over the world.'\n+    );\n+    await expect(page.getByRole('alert')).toContainText(\n+      'Visit supporters page to learn about your supporter benefits.'\n+    );\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 184,
        "additions": 145,
        "deletions": 39
    }
}