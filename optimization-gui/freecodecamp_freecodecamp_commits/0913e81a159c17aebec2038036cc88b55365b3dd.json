{
    "author": "ojeytonwilliams",
    "message": "refactor: convert codeally show.tsx to function (#57387)",
    "sha": "0913e81a159c17aebec2038036cc88b55365b3dd",
    "files": [
        {
            "sha": "32561743837d2ded31012d30c2fac5628d0be520",
            "filename": "client/src/templates/Challenges/codeally/show.tsx",
            "status": "modified",
            "additions": 216,
            "deletions": 225,
            "changes": 441,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0913e81a159c17aebec2038036cc88b55365b3dd/client%2Fsrc%2Ftemplates%2FChallenges%2Fcodeally%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0913e81a159c17aebec2038036cc88b55365b3dd/client%2Fsrc%2Ftemplates%2FChallenges%2Fcodeally%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcodeally%2Fshow.tsx?ref=0913e81a159c17aebec2038036cc88b55365b3dd",
            "patch": "@@ -1,6 +1,6 @@\n // Package Utilities\n import { graphql } from 'gatsby';\n-import React, { Component } from 'react';\n+import React, { useEffect, useRef } from 'react';\n import Helmet from 'react-helmet';\n import type { TFunction } from 'i18next';\n import { Trans, withTranslation } from 'react-i18next';\n@@ -108,11 +108,50 @@ interface ShowCodeAllyProps {\n   userToken: string | null;\n }\n \n-class ShowCodeAlly extends Component<ShowCodeAllyProps> {\n-  static displayName: string;\n-  private container: React.RefObject<HTMLElement> = React.createRef();\n+function ShowCodeAlly(props: ShowCodeAllyProps) {\n+  const container = useRef<HTMLElement>(null);\n \n-  componentDidMount(): void {\n+  const {\n+    completedChallenges,\n+    data: {\n+      challengeNode: {\n+        challenge: {\n+          block,\n+          challengeType,\n+          description,\n+          id: challengeId,\n+          instructions,\n+          notes,\n+          superBlock,\n+          title,\n+          translationPending\n+        }\n+      }\n+    },\n+    isChallengeCompleted,\n+    isSignedIn,\n+    pageContext: {\n+      challengeMeta: { nextChallengePath, prevChallengePath }\n+    },\n+    partiallyCompletedChallenges,\n+    t,\n+    updateSolutionFormValues\n+  } = props;\n+\n+  const blockNameTitle = `${t(\n+    `intro:${superBlock}.blocks.${block}.title`\n+  )}: ${title}`;\n+  const windowTitle = `${blockNameTitle} | freeCodeCamp.org`;\n+\n+  const isPartiallyCompleted = partiallyCompletedChallenges.some(\n+    challenge => challenge.id === challengeId\n+  );\n+\n+  const isCompleted = completedChallenges.some(\n+    challenge => challenge.id === challengeId\n+  );\n+\n+  useEffect(() => {\n     const {\n       challengeMounted,\n       data: {\n@@ -128,7 +167,7 @@ class ShowCodeAlly extends Component<ShowCodeAllyProps> {\n       pageContext: { challengeMeta },\n       initTests,\n       updateChallengeMeta\n-    } = this.props;\n+    } = props;\n     initTests(tests);\n     updateChallengeMeta({\n       ...challengeMeta,\n@@ -137,52 +176,17 @@ class ShowCodeAlly extends Component<ShowCodeAllyProps> {\n       helpCategory\n     });\n     challengeMounted(challengeMeta.id);\n-    this.container.current?.focus();\n-  }\n+    container.current?.focus();\n+  }, [props]); // TODO: split props, so that it doesn't rerender on every prop change\n \n-  handleSubmit = ({\n-    showCompletionModal\n-  }: {\n-    showCompletionModal: boolean;\n-  }) => {\n-    const {\n-      completedChallenges,\n-      createFlashMessage,\n-      data: {\n-        challengeNode: {\n-          challenge: { id: challengeId }\n-        }\n-      },\n-      openCompletionModal,\n-      partiallyCompletedChallenges\n-    } = this.props;\n-\n-    const isPartiallyCompleted = partiallyCompletedChallenges.some(\n-      challenge => challenge.id === challengeId\n-    );\n-\n-    const isCompleted = completedChallenges.some(\n-      challenge => challenge.id === challengeId\n-    );\n-\n-    if (!isPartiallyCompleted && !isCompleted) {\n-      createFlashMessage({\n-        type: 'danger',\n-        message: FlashMessages.CompleteProjectFirst\n-      });\n-    } else if (showCompletionModal) {\n-      openCompletionModal();\n-    }\n-  };\n-\n-  openGitpod = (userToken?: string) => {\n+  const openGitpod = (userToken?: string) => {\n     const {\n       data: {\n         challengeNode: {\n           challenge: { url }\n         }\n       }\n-    } = this.props;\n+    } = props;\n \n     const repoUrl = `https://github.com/${url}`;\n     const coderoadTutorial = encodeURIComponent(\n@@ -195,61 +199,45 @@ class ShowCodeAlly extends Component<ShowCodeAllyProps> {\n     window.open(gitpodUrl, '_blank');\n   };\n \n-  startCourse = async () => {\n-    const { isSignedIn, userToken, updateUserToken } = this.props;\n+  const startCourse = async () => {\n+    const { isSignedIn, userToken, updateUserToken } = props;\n \n     if (!isSignedIn) {\n-      this.openGitpod();\n+      openGitpod();\n     } else if (!userToken) {\n       const createUserTokenResponse = await postUserToken();\n       const { data = { userToken: null } } = createUserTokenResponse;\n \n       if (data?.userToken) {\n         updateUserToken(data.userToken);\n-        this.openGitpod(data.userToken);\n+        openGitpod(data.userToken);\n       } else {\n         createFlashMessage({\n           type: 'danger',\n           message: FlashMessages.StartProjectErr\n         });\n       }\n     } else {\n-      this.openGitpod(userToken);\n+      openGitpod(userToken);\n     }\n   };\n \n-  render() {\n+  const handleSubmit = ({\n+    showCompletionModal\n+  }: {\n+    showCompletionModal: boolean;\n+  }) => {\n     const {\n       completedChallenges,\n+      createFlashMessage,\n       data: {\n         challengeNode: {\n-          challenge: {\n-            block,\n-            challengeType,\n-            description,\n-            id: challengeId,\n-            instructions,\n-            notes,\n-            superBlock,\n-            title,\n-            translationPending\n-          }\n+          challenge: { id: challengeId }\n         }\n       },\n-      isChallengeCompleted,\n-      isSignedIn,\n-      pageContext: {\n-        challengeMeta: { nextChallengePath, prevChallengePath }\n-      },\n-      partiallyCompletedChallenges,\n-      t,\n-      updateSolutionFormValues\n-    } = this.props;\n-\n-    const blockNameTitle = `${t(\n-      `intro:${superBlock}.blocks.${block}.title`\n-    )}: ${title}`;\n-    const windowTitle = `${blockNameTitle} | freeCodeCamp.org`;\n+      openCompletionModal,\n+      partiallyCompletedChallenges\n+    } = props;\n \n     const isPartiallyCompleted = partiallyCompletedChallenges.some(\n       challenge => challenge.id === challengeId\n@@ -259,164 +247,167 @@ class ShowCodeAlly extends Component<ShowCodeAllyProps> {\n       challenge => challenge.id === challengeId\n     );\n \n-    return (\n-      <Hotkeys\n-        containerRef={this.container}\n-        nextChallengePath={nextChallengePath}\n-        prevChallengePath={prevChallengePath}\n-      >\n-        <LearnLayout>\n-          <Helmet title={windowTitle} />\n-          <Container>\n-            <Row>\n-              <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n-                <Spacer size='m' />\n-                {superBlock === SuperBlocks.RelationalDb && <CodeAllyDown />}\n-                <Spacer size='m' />\n-                <ChallengeTitle\n-                  isCompleted={isChallengeCompleted}\n-                  translationPending={translationPending}\n-                >\n-                  {title}\n-                </ChallengeTitle>\n-                <Spacer size='m' />\n-                <PrismFormatted text={description} />\n-                <Spacer size='m' />\n-                <div className='ca-description'>\n-                  <p>{t('learn.gitpod.intro')}</p>\n+    if (!isPartiallyCompleted && !isCompleted) {\n+      createFlashMessage({\n+        type: 'danger',\n+        message: FlashMessages.CompleteProjectFirst\n+      });\n+    } else if (showCompletionModal) {\n+      openCompletionModal();\n+    }\n+  };\n \n-                  <ol>\n-                    <li>\n-                      <Trans i18nKey='learn.gitpod.step-1'>\n-                        <a\n-                          href='https://github.com/join'\n-                          rel='noopener noreferrer'\n-                          target='_blank'\n-                          title={t('learn.source-code-link')}\n-                        >\n-                          placeholder\n-                        </a>\n-                      </Trans>\n-                    </li>\n+  return (\n+    <Hotkeys\n+      containerRef={container}\n+      nextChallengePath={nextChallengePath}\n+      prevChallengePath={prevChallengePath}\n+    >\n+      <LearnLayout>\n+        <Helmet title={windowTitle} />\n+        <Container>\n+          <Row>\n+            <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n+              <Spacer size='m' />\n+              {superBlock === SuperBlocks.RelationalDb && <CodeAllyDown />}\n+              <Spacer size='m' />\n+              <ChallengeTitle\n+                isCompleted={isChallengeCompleted}\n+                translationPending={translationPending}\n+              >\n+                {title}\n+              </ChallengeTitle>\n+              <Spacer size='m' />\n+              <PrismFormatted text={description} />\n+              <Spacer size='m' />\n+              <div className='ca-description'>\n+                <p>{t('learn.gitpod.intro')}</p>\n \n-                    <li>{t('learn.gitpod.step-2')}</li>\n-                    <li>{t('learn.gitpod.step-3')}</li>\n-                    <li>\n-                      {t('learn.gitpod.step-4')}\n-                      <ul>\n-                        <li>{t('learn.gitpod.step-5')}</li>\n-                        <li>{t('learn.gitpod.step-6')}</li>\n-                        <li>{t('learn.gitpod.step-7')}</li>\n-                        <li>{t('learn.gitpod.step-8')}</li>\n-                      </ul>\n-                    </li>\n+                <ol>\n+                  <li>\n+                    <Trans i18nKey='learn.gitpod.step-1'>\n+                      <a\n+                        href='https://github.com/join'\n+                        rel='noopener noreferrer'\n+                        target='_blank'\n+                        title={t('learn.source-code-link')}\n+                      >\n+                        placeholder\n+                      </a>\n+                    </Trans>\n+                  </li>\n \n-                    <li>{t('learn.gitpod.step-9')}</li>\n-                  </ol>\n-                </div>\n+                  <li>{t('learn.gitpod.step-2')}</li>\n+                  <li>{t('learn.gitpod.step-3')}</li>\n+                  <li>\n+                    {t('learn.gitpod.step-4')}\n+                    <ul>\n+                      <li>{t('learn.gitpod.step-5')}</li>\n+                      <li>{t('learn.gitpod.step-6')}</li>\n+                      <li>{t('learn.gitpod.step-7')}</li>\n+                      <li>{t('learn.gitpod.step-8')}</li>\n+                    </ul>\n+                  </li>\n \n+                  <li>{t('learn.gitpod.step-9')}</li>\n+                </ol>\n+              </div>\n+\n+              <Spacer size='m' />\n+              {isSignedIn && challengeType === challengeTypes.codeAllyCert && (\n+                <>\n+                  <div className='ca-description'>\n+                    {t('learn.complete-both-steps')}\n+                  </div>\n+                  <hr />\n+                  <Spacer size='m' />\n+                  <ChallengeHeading\n+                    heading={t('learn.step-1')}\n+                    isCompleted={isPartiallyCompleted || isCompleted}\n+                  />\n+                  <Spacer size='m' />\n+                  <div className='ca-description'>{t('learn.runs-in-vm')}</div>\n+                  <Spacer size='m' />\n+                  <PrismFormatted text={instructions} />\n+                  <Spacer size='m' />\n+                </>\n+              )}\n+              <Alert variant='info'>\n+                <Trans\n+                  values={{ course: title }}\n+                  i18nKey='learn.gitpod.continue-project'\n+                >\n+                  <a\n+                    href='https://gitpod.io/workspaces'\n+                    rel='noopener noreferrer'\n+                    target='_blank'\n+                  >\n+                    placeholder\n+                  </a>\n+                </Trans>\n                 <Spacer size='m' />\n-                {isSignedIn &&\n-                  challengeType === challengeTypes.codeAllyCert && (\n-                    <>\n-                      <div className='ca-description'>\n-                        {t('learn.complete-both-steps')}\n-                      </div>\n-                      <hr />\n-                      <Spacer size='m' />\n-                      <ChallengeHeading\n-                        heading={t('learn.step-1')}\n-                        isCompleted={isPartiallyCompleted || isCompleted}\n-                      />\n-                      <Spacer size='m' />\n-                      <div className='ca-description'>\n-                        {t('learn.runs-in-vm')}\n-                      </div>\n-                      <Spacer size='m' />\n-                      <PrismFormatted text={instructions} />\n-                      <Spacer size='m' />\n-                    </>\n-                  )}\n-                <Alert variant='info'>\n-                  <Trans\n-                    values={{ course: title }}\n-                    i18nKey='learn.gitpod.continue-project'\n+                <Trans i18nKey='learn.gitpod.learn-more'>\n+                  <a\n+                    href='https://forum.freecodecamp.org/t/using-gitpod-in-the-curriculum/668669'\n+                    rel='noopener noreferrer'\n+                    target='_blank'\n                   >\n-                    <a\n-                      href='https://gitpod.io/workspaces'\n-                      rel='noopener noreferrer'\n-                      target='_blank'\n-                    >\n-                      placeholder\n-                    </a>\n-                  </Trans>\n-                  <Spacer size='m' />\n-                  <Trans i18nKey='learn.gitpod.learn-more'>\n-                    <a\n-                      href='https://forum.freecodecamp.org/t/using-gitpod-in-the-curriculum/668669'\n-                      rel='noopener noreferrer'\n-                      target='_blank'\n-                    >\n-                      placeholder\n-                    </a>\n-                  </Trans>\n+                    placeholder\n+                  </a>\n+                </Trans>\n+              </Alert>\n+              {isSignedIn && (\n+                <Alert variant='danger'>\n+                  {t('learn.gitpod.logout-warning', { course: title })}\n                 </Alert>\n-                {isSignedIn && (\n-                  <Alert variant='danger'>\n-                    {t('learn.gitpod.logout-warning', { course: title })}\n-                  </Alert>\n-                )}\n-                <CodeAllyButton\n-                  text={\n-                    challengeType === challengeTypes.codeAllyCert\n-                      ? t('buttons.click-start-project')\n-                      : t('buttons.click-start-course')\n-                  }\n-                  // `this.startCourse` being an async callback is acceptable\n-                  //eslint-disable-next-line @typescript-eslint/no-misused-promises\n-                  onClick={this.startCourse}\n-                />\n-                {isSignedIn &&\n-                  challengeType === challengeTypes.codeAllyCert && (\n-                    <>\n-                      <hr />\n-                      <Spacer size='m' />\n-                      <ChallengeHeading\n-                        heading={t('learn.step-2')}\n-                        isCompleted={isCompleted}\n-                      />\n-                      <Spacer size='m' />\n-                      <div className='ca-description'>\n-                        {t('learn.submit-public-url')}\n-                      </div>\n-                      <Spacer size='m' />\n-                      <PrismFormatted text={notes} />\n-                      <Spacer size='m' />\n-                      <SolutionForm\n-                        challengeType={challengeType}\n-                        description={description}\n-                        onSubmit={this.handleSubmit}\n-                        updateSolutionForm={updateSolutionFormValues}\n-                      />\n-                    </>\n-                  )}\n-                <Spacer size='xxs' />\n-                <ProjectToolPanel />\n-                <br />\n-                <Spacer size='m' />\n-              </Col>\n-              <CompletionModal />\n-              <HelpModal challengeTitle={title} challengeBlock={block} />\n-            </Row>\n-          </Container>\n-        </LearnLayout>\n-      </Hotkeys>\n-    );\n-  }\n+              )}\n+              <CodeAllyButton\n+                text={\n+                  challengeType === challengeTypes.codeAllyCert\n+                    ? t('buttons.click-start-project')\n+                    : t('buttons.click-start-course')\n+                }\n+                // `this.startCourse` being an async callback is acceptable\n+                //eslint-disable-next-line @typescript-eslint/no-misused-promises\n+                onClick={startCourse}\n+              />\n+              {isSignedIn && challengeType === challengeTypes.codeAllyCert && (\n+                <>\n+                  <hr />\n+                  <Spacer size='m' />\n+                  <ChallengeHeading\n+                    heading={t('learn.step-2')}\n+                    isCompleted={isCompleted}\n+                  />\n+                  <Spacer size='m' />\n+                  <div className='ca-description'>\n+                    {t('learn.submit-public-url')}\n+                  </div>\n+                  <Spacer size='m' />\n+                  <PrismFormatted text={notes} />\n+                  <Spacer size='m' />\n+                  <SolutionForm\n+                    challengeType={challengeType}\n+                    description={description}\n+                    onSubmit={handleSubmit}\n+                    updateSolutionForm={updateSolutionFormValues}\n+                  />\n+                </>\n+              )}\n+              <Spacer size='xxs' />\n+              <ProjectToolPanel />\n+              <br />\n+              <Spacer size='m' />\n+            </Col>\n+            <CompletionModal />\n+            <HelpModal challengeTitle={title} challengeBlock={block} />\n+          </Row>\n+        </Container>\n+      </LearnLayout>\n+    </Hotkeys>\n+  );\n }\n \n-ShowCodeAlly.displayName = 'ShowCodeAlly';\n-\n export default connect(\n   mapStateToProps,\n   mapDispatchToProps"
        }
    ],
    "stats": {
        "total": 441,
        "additions": 216,
        "deletions": 225
    }
}