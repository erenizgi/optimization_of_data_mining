{
    "author": "huyenltnguyen",
    "message": "fix(a11y): improve the second part of the donation modal (#55273)",
    "sha": "8ff3193636c898314ecf81d625d562e2db090b05",
    "files": [
        {
            "sha": "9a89e757d91b67baba9220e1908d96688644f839",
            "filename": "client/src/components/Donation/donation-modal-body.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8ff3193636c898314ecf81d625d562e2db090b05/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation-modal-body.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8ff3193636c898314ecf81d625d562e2db090b05/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation-modal-body.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation-modal-body.tsx?ref=8ff3193636c898314ecf81d625d562e2db090b05",
            "patch": "@@ -16,6 +16,7 @@ type DonationModalBodyProps = {\n   activeDonors?: number;\n   closeDonationModal: typeof closeDonationModal;\n   recentlyClaimedBlock: RecentlyClaimedBlock;\n+  setCanClose: (canClose: boolean) => void;\n };\n \n const Illustration = () => {\n@@ -217,7 +218,8 @@ const BecomeASupporterConfirmation = ({\n \n function DonationModalBody({\n   closeDonationModal,\n-  recentlyClaimedBlock\n+  recentlyClaimedBlock,\n+  setCanClose\n }: DonationModalBodyProps): JSX.Element {\n   const [donationAttempted, setDonationAttempted] = useState(false);\n   const [showHeaderAndFooter, setShowHeaderAndFooter] = useState(true);\n@@ -245,6 +247,12 @@ function DonationModalBody({\n     return () => clearInterval(interval);\n   }, []);\n \n+  useEffect(() => {\n+    if (secondsRemaining === 0) {\n+      setCanClose(true);\n+    }\n+  }, [secondsRemaining, setCanClose]);\n+\n   return (\n     <Modal.Body borderless alignment='start'>\n       <div aria-live='polite' className='donation-modal'>\n@@ -268,5 +276,6 @@ function DonationModalBody({\n }\n \n DonationModalBody.displayName = 'DonationModalBody';\n+Benefits.displayName = 'DonationModalBenefits';\n \n export default DonationModalBody;"
        },
        {
            "sha": "82aa8b1591f20a51be660048a22062d9d736a479",
            "filename": "client/src/components/Donation/donation-modal.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8ff3193636c898314ecf81d625d562e2db090b05/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation-modal.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8ff3193636c898314ecf81d625d562e2db090b05/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation-modal.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation-modal.tsx?ref=8ff3193636c898314ecf81d625d562e2db090b05",
            "patch": "@@ -1,10 +1,11 @@\n import { WindowLocation } from '@reach/router';\n-import React, { useEffect } from 'react';\n+import React, { useEffect, useState } from 'react';\n import { connect } from 'react-redux';\n import { goToAnchor } from 'react-scrollable-anchor';\n import { bindActionCreators, Dispatch, AnyAction } from 'redux';\n import { createSelector } from 'reselect';\n import { Modal } from '@freecodecamp/ui';\n+import { useFeature } from '@growthbook/growthbook-react';\n \n import { closeDonationModal } from '../../redux/actions';\n import {\n@@ -44,6 +45,9 @@ function DonateModal({\n   location,\n   recentlyClaimedBlock\n }: DonateModalProps): JSX.Element {\n+  const [canClose, setCanClose] = useState(false);\n+  const isA11yFeatureEnabled = useFeature('a11y-donation-modal').on;\n+\n   useEffect(() => {\n     if (show) {\n       void playTone('donation');\n@@ -62,13 +66,18 @@ function DonateModal({\n     if (isLocationSuperBlock(location)) {\n       goToAnchor('claim-cert-block');\n     }\n+\n+    if (isA11yFeatureEnabled && canClose) {\n+      closeDonationModal();\n+    }\n   };\n \n   return (\n     <Modal size='large' onClose={handleModalHide} open={show}>\n       <DonationModalBody\n         closeDonationModal={closeDonationModal}\n         recentlyClaimedBlock={recentlyClaimedBlock}\n+        setCanClose={setCanClose}\n       />\n     </Modal>\n   );"
        },
        {
            "sha": "010f52c326666447cf85531a5b21f0d89547e67e",
            "filename": "client/src/components/Donation/donation-text-components.tsx",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8ff3193636c898314ecf81d625d562e2db090b05/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation-text-components.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8ff3193636c898314ecf81d625d562e2db090b05/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation-text-components.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation-text-components.tsx?ref=8ff3193636c898314ecf81d625d562e2db090b05",
            "patch": "@@ -1,5 +1,7 @@\n import React, { useState } from 'react';\n import { useTranslation, Trans } from 'react-i18next';\n+import { useFeature } from '@growthbook/growthbook-react';\n+\n import Caret from '../../assets/icons/caret';\n import { Spacer } from '../helpers';\n import GreenPass from '../../assets/icons/green-pass';\n@@ -318,8 +320,11 @@ export const GetSupporterBenefitsText = ({\n \n export const ModalBenefitList = () => {\n   const { t } = useTranslation();\n+  const isA11yFeatureEnabled = useFeature('a11y-donation-modal').on;\n+\n   return (\n-    <ul>\n+    // Set the initial focus to this list as it appears first in the second modal.\n+    <ul {...(isA11yFeatureEnabled && { tabIndex: -1 })}>\n       <li>\n         <GreenPass aria-hidden={true} />\n         {t('donate.help-us-more-certifications')}"
        },
        {
            "sha": "2d427305d7bd22dc21309773762c9aa28fd99690",
            "filename": "client/src/components/Donation/donation.css",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8ff3193636c898314ecf81d625d562e2db090b05/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation.css",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8ff3193636c898314ecf81d625d562e2db090b05/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation.css",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation.css?ref=8ff3193636c898314ecf81d625d562e2db090b05",
            "patch": "@@ -462,13 +462,6 @@ button.confirm-donation-btn {\n   display: inline-flex;\n   align-items: center;\n }\n-button.confirm-donation-btn:focus,\n-button.confirm-donation-btn:active,\n-button.confirm-donation-btn:active:focus {\n-  background-color: var(--quaternary-background);\n-  border-color: var(--secondary-color);\n-  color: var(--secondary-color);\n-}\n button.confirm-donation-btn:hover {\n   color: black;\n   background-color: #f2ba38;"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 26,
        "deletions": 10
    }
}