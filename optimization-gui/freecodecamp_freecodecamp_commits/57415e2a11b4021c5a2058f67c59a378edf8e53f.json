{
    "author": "ojeytonwilliams",
    "message": "fix: skip upcoming superblocks in normal builds (#62263)",
    "sha": "57415e2a11b4021c5a2058f67c59a378edf8e53f",
    "files": [
        {
            "sha": "9cafeb4f7647e850c8d4062f1ce446c65f1ce07a",
            "filename": "curriculum/build-curriculum.js",
            "status": "modified",
            "additions": 14,
            "deletions": 3,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/57415e2a11b4021c5a2058f67c59a378edf8e53f/curriculum%2Fbuild-curriculum.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/57415e2a11b4021c5a2058f67c59a378edf8e53f/curriculum%2Fbuild-curriculum.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fbuild-curriculum.js?ref=57415e2a11b4021c5a2058f67c59a378edf8e53f",
            "patch": "@@ -1,7 +1,7 @@\n const fs = require('fs');\n const path = require('path');\n \n-const { isEmpty } = require('lodash');\n+const { isEmpty, isUndefined } = require('lodash');\n const debug = require('debug')('fcc:build-curriculum');\n \n const {\n@@ -11,7 +11,7 @@ const {\n } = require('./build-superblock');\n \n const { buildCertification } = require('./build-certification');\n-const { applyFilters, closestFilters } = require('./utils');\n+const { applyFilters, closestFilters, getSuperOrder } = require('./utils');\n const {\n   getContentDir,\n   getLanguageConfig,\n@@ -330,7 +330,18 @@ async function buildCurriculum(lang, filters) {\n \n   const fullCurriculum = { certifications: { blocks: {} } };\n \n-  for (const superblock of fullSuperblockList) {\n+  const liveSuperblocks = fullSuperblockList.filter(({ name }) => {\n+    const superOrder = getSuperOrder(name);\n+    const upcomingSuperOrder = getSuperOrder(name, true);\n+\n+    // If a superblock is not in either order list it should not exist.\n+    if (isUndefined(superOrder) && isUndefined(upcomingSuperOrder)) {\n+      throw Error(`Invalid superBlock: ${name}`);\n+    }\n+    return !isUndefined(superOrder);\n+  });\n+\n+  for (const superblock of liveSuperblocks) {\n     fullCurriculum[superblock.name] =\n       await builder.processSuperblock(superblock);\n   }"
        },
        {
            "sha": "1d900de1addf9079508d4d48036546879e220a23",
            "filename": "curriculum/utils.js",
            "status": "modified",
            "additions": 11,
            "deletions": 26,
            "changes": 37,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/57415e2a11b4021c5a2058f67c59a378edf8e53f/curriculum%2Futils.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/57415e2a11b4021c5a2058f67c59a378edf8e53f/curriculum%2Futils.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Futils.js?ref=57415e2a11b4021c5a2058f67c59a378edf8e53f",
            "patch": "@@ -2,10 +2,7 @@ const path = require('path');\n \n const comparison = require('string-similarity');\n \n-const {\n-  SuperBlocks,\n-  generateSuperBlockList\n-} = require('../shared-dist/config/curriculum');\n+const { generateSuperBlockList } = require('../shared-dist/config/curriculum');\n \n require('dotenv').config({ path: path.resolve(__dirname, '../.env') });\n \n@@ -27,15 +24,6 @@ exports.testedLang = function testedLang() {\n };\n \n function createSuperOrder(superBlocks) {\n-  if (!Array.isArray(superBlocks)) {\n-    throw Error(`superBlocks must be an Array`);\n-  }\n-  superBlocks.forEach(superBlock => {\n-    if (!Object.values(SuperBlocks).includes(superBlock)) {\n-      throw Error(`Invalid superBlock: ${superBlock}`);\n-    }\n-  });\n-\n   const superOrder = {};\n \n   superBlocks.forEach((superBlock, i) => {\n@@ -45,19 +33,16 @@ function createSuperOrder(superBlocks) {\n   return superOrder;\n }\n \n-const flatSuperBlockMap = generateSuperBlockList({\n-  showUpcomingChanges: process.env.SHOW_UPCOMING_CHANGES === 'true'\n-});\n-const superOrder = createSuperOrder(flatSuperBlockMap);\n-\n-// gets the superOrder of a superBlock from the object created above\n-function getSuperOrder(superblock) {\n-  if (typeof superblock !== 'string')\n-    throw Error(`superblock ${JSON.stringify(superblock)} must be a string`);\n-  const order = superOrder[superblock];\n-  if (typeof order === 'undefined')\n-    throw Error(`${superblock} is not a valid superblock`);\n-  return order;\n+function getSuperOrder(\n+  superblock,\n+  showUpcomingChanges = process.env.SHOW_UPCOMING_CHANGES === 'true'\n+) {\n+  const flatSuperBlockMap = generateSuperBlockList({\n+    showUpcomingChanges\n+  });\n+\n+  const superOrder = createSuperOrder(flatSuperBlockMap);\n+  return superOrder[superblock];\n }\n \n /**"
        },
        {
            "sha": "282335dbbf37fa3f1a8bbc9a75c4f190bbe322db",
            "filename": "curriculum/utils.test.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 42,
            "changes": 63,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/57415e2a11b4021c5a2058f67c59a378edf8e53f/curriculum%2Futils.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/57415e2a11b4021c5a2058f67c59a378edf8e53f/curriculum%2Futils.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Futils.test.ts?ref=57415e2a11b4021c5a2058f67c59a378edf8e53f",
            "patch": "@@ -67,62 +67,41 @@ describe('createSuperOrder', () => {\n   });\n \n   it('throws when not given an array of SuperBlocks', () => {\n-    expect.assertions(4);\n-    expect(() => getSuperOrder()).toThrow();\n-    expect(() => getSuperOrder(null)).toThrow();\n-    expect(() => getSuperOrder('')).toThrow();\n-    expect(() => getSuperOrder(['respansive-wib-desoin'])).toThrow();\n+    expect(() => createSuperOrder()).toThrow();\n+    expect(() => createSuperOrder(null)).toThrow();\n+    expect(() => createSuperOrder('')).toThrow();\n   });\n });\n \n describe('getSuperOrder', () => {\n   it('returns a number for valid curriculum', () => {\n-    expect.assertions(1);\n     expect(typeof getSuperOrder('responsive-web-design')).toBe('number');\n   });\n \n-  it('throws for unknown curriculum', () => {\n-    expect.assertions(4);\n-    expect(() => getSuperOrder()).toThrow();\n-    expect(() => getSuperOrder(null)).toThrow();\n-    expect(() => getSuperOrder('')).toThrow();\n-    expect(() => getSuperOrder('respansive-wib-desoin')).toThrow();\n+  it('returns undefined for unknown curriculum', () => {\n+    expect(getSuperOrder()).toBeUndefined();\n+    expect(getSuperOrder(null)).toBeUndefined();\n+    expect(getSuperOrder('')).toBeUndefined();\n+    expect(getSuperOrder('respansive-wib-desoin')).toBeUndefined();\n+    expect(getSuperOrder('certifications')).toBeUndefined();\n   });\n \n-  it('throws for \"certifications\"', () => {\n-    expect.assertions(1);\n-    expect(() => getSuperOrder('certifications')).toThrow();\n+  it('returns numbers for all current curriculum', () => {\n+    const superBlocks = Object.values(SuperBlocks);\n+\n+    const superOrderValues = superBlocks.map(sb => getSuperOrder(sb, true));\n+    const definedValues = superOrderValues.filter(v => typeof v === 'number');\n+\n+    expect(definedValues.length).toBe(superBlocks.length);\n   });\n \n-  it.skip('returns unique numbers for all current curriculum', () => {\n-    if (process.env.SHOW_UPCOMING_CHANGES !== 'true') {\n-      expect.assertions(17);\n-    } else {\n-      expect.assertions(19);\n-    }\n+  it('returns unique numbers for all current curriculum', () => {\n+    const superBlocks = Object.values(SuperBlocks);\n \n-    expect(getSuperOrder(SuperBlocks.RespWebDesignNew)).toBe(0);\n-    expect(getSuperOrder(SuperBlocks.JsAlgoDataStructNew)).toBe(1);\n-    expect(getSuperOrder(SuperBlocks.FrontEndDevLibs)).toBe(2);\n-    expect(getSuperOrder(SuperBlocks.DataVis)).toBe(3);\n-    expect(getSuperOrder(SuperBlocks.RelationalDb)).toBe(4);\n-    expect(getSuperOrder(SuperBlocks.BackEndDevApis)).toBe(5);\n-    expect(getSuperOrder(SuperBlocks.QualityAssurance)).toBe(6);\n-    expect(getSuperOrder(SuperBlocks.SciCompPy)).toBe(7);\n-    expect(getSuperOrder(SuperBlocks.DataAnalysisPy)).toBe(8);\n-    expect(getSuperOrder(SuperBlocks.InfoSec)).toBe(9);\n-    expect(getSuperOrder(SuperBlocks.MachineLearningPy)).toBe(10);\n-    expect(getSuperOrder(SuperBlocks.CollegeAlgebraPy)).toBe(11);\n-    expect(getSuperOrder(SuperBlocks.FoundationalCSharp)).toBe(12);\n-    expect(getSuperOrder(SuperBlocks.CodingInterviewPrep)).toBe(13);\n-    expect(getSuperOrder(SuperBlocks.ProjectEuler)).toBe(14);\n-    expect(getSuperOrder(SuperBlocks.RespWebDesign)).toBe(15);\n-    expect(getSuperOrder(SuperBlocks.JsAlgoDataStruct)).toBe(16);\n+    const superOrderValues = superBlocks.map(sb => getSuperOrder(sb, true));\n+    const uniqueValues = Array.from(new Set(superOrderValues));\n \n-    if (process.env.SHOW_UPCOMING_CHANGES === 'true') {\n-      expect(getSuperOrder(SuperBlocks.TheOdinProject)).toBe(17);\n-      expect(getSuperOrder(SuperBlocks.FullStackDeveloper)).toBe(18);\n-    }\n+    expect(uniqueValues.length).toBe(superBlocks.length);\n   });\n });\n "
        }
    ],
    "stats": {
        "total": 117,
        "additions": 46,
        "deletions": 71
    }
}