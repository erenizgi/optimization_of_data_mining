{
    "author": "ahmaxed",
    "message": "feat: move session related challenge data to sessionStorage (#55918)\n\nCo-authored-by: sembauke <semboot699@gmail.com>\r\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "0ee8097a16c937d53c39800bf54705355a5c61fc",
    "files": [
        {
            "sha": "ecf2cd649e467a7711ae743152323b1a3efb8e07",
            "filename": "client/src/redux/action-types.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Faction-types.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Faction-types.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Faction-types.js?ref=0ee8097a16c937d53c39800bf54705355a5c61fc",
            "patch": "@@ -9,7 +9,6 @@ export const actionTypes = createTypes(\n     'allowBlockDonationRequests',\n     'setRenderStartTime',\n     'preventBlockDonationRequests',\n-    'setCompletionCountWhenShownProgressModal',\n     'setShowMultipleProgressModals',\n     'openDonationModal',\n     'closeDonationModal',"
        },
        {
            "sha": "78188582dc52b7fde3bcb929741e7a8989e85699",
            "filename": "client/src/redux/actions.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Factions.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Factions.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Factions.js?ref=0ee8097a16c937d53c39800bf54705355a5c61fc",
            "patch": "@@ -17,9 +17,7 @@ export const openDonationModal = createAction(actionTypes.openDonationModal);\n export const preventBlockDonationRequests = createAction(\n   actionTypes.preventBlockDonationRequests\n );\n-export const setCompletionCountWhenShownProgressModal = createAction(\n-  actionTypes.setCompletionCountWhenShownProgressModal\n-);\n+\n export const setShowMultipleProgressModals = createAction(\n   actionTypes.setShowMultipleProgressModals\n );"
        },
        {
            "sha": "6b227ab44e256db2c8190b12e986bf33ae30edd1",
            "filename": "client/src/redux/donation-saga.js",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Fdonation-saga.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Fdonation-saga.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fdonation-saga.js?ref=0ee8097a16c937d53c39800bf54705355a5c61fc",
            "patch": "@@ -18,14 +18,17 @@ import {\n import { stringifyDonationEvents } from '../utils/analytics-strings';\n import { stripe } from '../utils/stripe';\n import { PaymentProvider } from '../../../shared/config/donation-settings';\n+import {\n+  getSessionChallengeData,\n+  saveCurrentCount\n+} from '../utils/session-storage';\n import { actionTypes as appTypes } from './action-types';\n import {\n   openDonationModal,\n   postChargeComplete,\n   postChargeProcessing,\n   postChargeError,\n   preventBlockDonationRequests,\n-  setCompletionCountWhenShownProgressModal,\n   updateCardError,\n   updateCardRedirecting\n } from './actions';\n@@ -34,7 +37,6 @@ import {\n   recentlyClaimedBlockSelector,\n   shouldRequestDonationSelector,\n   isSignedInSelector,\n-  completionCountSelector,\n   completedChallengesSelector\n } from './selectors';\n \n@@ -56,7 +58,7 @@ function* showDonateModalSaga() {\n     if (recentlyClaimedBlock) {\n       yield put(preventBlockDonationRequests());\n     } else {\n-      yield put(setCompletionCountWhenShownProgressModal());\n+      yield call(saveCurrentCount);\n     }\n   }\n }\n@@ -124,9 +126,8 @@ export function* postChargeSaga({\n       });\n     } else {\n       const completedChallenges = yield select(completedChallengesSelector);\n-      const completedChallengesInSession = yield select(\n-        completionCountSelector\n-      );\n+      const sessionChallengeData = yield call(getSessionChallengeData);\n+      const completedChallengesInSession = sessionChallengeData.currentCount;\n       yield call(callGA, {\n         event: 'donation',\n         action: stringifyDonationEvents(paymentContext, paymentProvider),"
        },
        {
            "sha": "3bb437107e10b9d99e90ae821eee641c3c13c923",
            "filename": "client/src/redux/donation-saga.test.js",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Fdonation-saga.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Fdonation-saga.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fdonation-saga.test.js?ref=0ee8097a16c937d53c39800bf54705355a5c61fc",
            "patch": "@@ -50,7 +50,6 @@ const analyticsDataMock = {\n const signedInStoreMock = {\n   app: {\n     appUsername: 'devuser',\n-    completionCount: 2,\n     user: {\n       devuser: {\n         completedChallenges: [\n@@ -83,7 +82,6 @@ const signedInStoreMock = {\n const signedOutStoreMock = {\n   app: {\n     appUsername: '',\n-    completionCount: 0,\n     user: {\n       '': {\n         completedChallenges: []\n@@ -94,6 +92,9 @@ const signedOutStoreMock = {\n \n describe('donation-saga', () => {\n   it('calls postChargeStrip for Stripe', () => {\n+    // The number of completed challenges per session is stored in the session storage\n+    sessionStorage.setItem('session-completed-challenges', '2');\n+\n     return expectSaga(postChargeSaga, postChargeDataMock)\n       .withState(signedInStoreMock)\n       .put(postChargeProcessing())\n@@ -149,6 +150,8 @@ describe('donation-saga', () => {\n       payload: { ...postChargeDataMock.payload, paymentProvider: 'paypal' }\n     };\n \n+    sessionStorage.setItem('session-completed-challenges', '0');\n+\n     const paypalAnalyticsDataMock = {\n       ...analyticsDataMock,\n       action: 'Donate Page Paypal Payment Submission',\n@@ -160,7 +163,6 @@ describe('donation-saga', () => {\n     const signedOutStoreMock = {\n       app: {\n         appUsername: '',\n-        completionCount: 0,\n         user: {\n           '': {\n             completedChallenges: []"
        },
        {
            "sha": "a5290c55eb70778d93d5beb9c746bcd2a25d1bfa",
            "filename": "client/src/redux/index.js",
            "status": "modified",
            "additions": 4,
            "deletions": 13,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Findex.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Findex.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Findex.js?ref=0ee8097a16c937d53c39800bf54705355a5c61fc",
            "patch": "@@ -15,13 +15,14 @@ import { createFetchUserSaga } from './fetch-user-saga';\n import hardGoToEpic from './hard-go-to-epic';\n import { createReportUserSaga } from './report-user-saga';\n import { createSaveChallengeSaga } from './save-challenge-saga';\n-import { completionCountSelector, savedChallengesSelector } from './selectors';\n+import { savedChallengesSelector } from './selectors';\n import { actionTypes as settingsTypes } from './settings/action-types';\n import { createShowCertSaga } from './show-cert-saga';\n import updateCompleteEpic from './update-complete-epic';\n import { createUserTokenSaga } from './user-token-saga';\n import { createMsUsernameSaga } from './ms-username-saga';\n import { createSurveySaga } from './survey-saga';\n+import { createSessionCompletedChallengesSaga } from './session-completed-challenges';\n \n const defaultFetchState = {\n   pending: true,\n@@ -51,9 +52,6 @@ const initialState = {\n   appUsername: '',\n   showMultipleProgressModals: false,\n   recentlyClaimedBlock: null,\n-  completionCountWhenShownProgressModal: 0,\n-  progressDonationModalShown: false,\n-  completionCount: 0,\n   currentChallengeId: store.get(CURRENT_CHALLENGE_KEY),\n   examInProgress: false,\n   isProcessing: false,\n@@ -97,7 +95,8 @@ export const sagas = [\n   ...createUserTokenSaga(actionTypes),\n   ...createSaveChallengeSaga(actionTypes),\n   ...createMsUsernameSaga(actionTypes),\n-  ...createSurveySaga(actionTypes)\n+  ...createSurveySaga(actionTypes),\n+  ...createSessionCompletedChallengesSaga(actionTypes)\n ];\n \n function spreadThePayloadOnUser(state, payload) {\n@@ -274,13 +273,6 @@ export const reducer = handleActions(\n       ...state,\n       recentlyClaimedBlock: null\n     }),\n-    [actionTypes.setCompletionCountWhenShownProgressModal]: state => ({\n-      ...state,\n-      progressDonationModalShown: true,\n-      completionCountWhenShownProgressModal: completionCountSelector({\n-        [MainApp]: state\n-      })\n-    }),\n     [actionTypes.setShowMultipleProgressModals]: (state, { payload }) => ({\n       ...state,\n       showMultipleProgressModals: payload\n@@ -346,7 +338,6 @@ export const reducer = handleActions(\n           }\n         : {\n             ...state,\n-            completionCount: state.completionCount + 1,\n             user: {\n               ...state.user,\n               [appUsername]: {"
        },
        {
            "sha": "c8a56981a693631b309989ef1820ef3be678e813",
            "filename": "client/src/redux/selectors.js",
            "status": "modified",
            "additions": 11,
            "deletions": 16,
            "changes": 27,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Fselectors.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Fselectors.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fselectors.js?ref=0ee8097a16c937d53c39800bf54705355a5c61fc",
            "patch": "@@ -1,4 +1,5 @@\n import { Certification } from '../../../shared/config/certification-settings';\n+import { getSessionChallengeData } from '../utils/session-storage';\n import { ns as MainApp } from './action-types';\n \n export const savedChallengesSelector = state =>\n@@ -13,10 +14,6 @@ export const currentChallengeIdSelector = state =>\n export const completionCountSelector = state => state[MainApp].completionCount;\n export const showMultipleProgressModalsSelector = state =>\n   state[MainApp].showMultipleProgressModals;\n-export const completionCountWhenShownProgressModalSelector = state =>\n-  state[MainApp].completionCountWhenShownProgressModal;\n-export const progressDonationModalShownSelector = state =>\n-  state[MainApp].progressDonationModalShown;\n export const isDonatingSelector = state => userSelector(state).isDonating;\n export const isOnlineSelector = state => state[MainApp].isOnline;\n export const isServerOnlineSelector = state => state[MainApp].isServerOnline;\n@@ -36,11 +33,7 @@ export const showCertSelector = state => state[MainApp].showCert;\n export const showCertFetchStateSelector = state =>\n   state[MainApp].showCertFetchState;\n export const shouldRequestDonationSelector = state => {\n-  const completedChallengesLength = completedChallengesSelector(state).length;\n-  const completionCount = completionCountSelector(state);\n-  const lastCompletionCount =\n-    completionCountWhenShownProgressModalSelector(state);\n-  const progressDonationModalShown = progressDonationModalShownSelector(state);\n+  const completedChallengeCount = completedChallengesSelector(state).length;\n   const isDonating = isDonatingSelector(state);\n   const recentlyClaimedBlock = recentlyClaimedBlockSelector(state);\n \n@@ -50,22 +43,24 @@ export const shouldRequestDonationSelector = state => {\n   // a block has been completed\n   if (recentlyClaimedBlock) return true;\n \n+  const sessionChallengeData = getSessionChallengeData();\n   /*\n     Different intervals need to be tested for optimization.\n    */\n-  if (progressDonationModalShown && completionCount - lastCompletionCount >= 20)\n-    return true;\n-\n-  // a donation has already been requested\n-  if (progressDonationModalShown) return false;\n+  // the assumption is that we save the count when we request donations\n+  if (sessionChallengeData.isSaved) {\n+    // only request if sufficient challenges have been completed since last\n+    // request\n+    return sessionChallengeData.countSinceSave >= 20;\n+  }\n \n   // donations only appear after the user has completed ten challenges (i.e.\n   // not before the 11th challenge has mounted)\n-  if (completedChallengesLength < 10) return false;\n+  if (completedChallengeCount < 10) return false;\n \n   // this will mean we have completed 3 or more challenges this browser session\n   // and enough challenges overall to not be new\n-  return completionCount >= 3;\n+  return sessionChallengeData.currentCount >= 3;\n };\n \n export const userTokenSelector = state => {"
        },
        {
            "sha": "8cbe111d39eaba3dd1d9a63b9b90494b8746e86e",
            "filename": "client/src/redux/session-completed-challenges.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Fsession-completed-challenges.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Fsession-completed-challenges.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fsession-completed-challenges.js?ref=0ee8097a16c937d53c39800bf54705355a5c61fc",
            "patch": "@@ -0,0 +1,11 @@\n+import { takeEvery, call } from 'redux-saga/effects';\n+\n+import { incrementCurrentCount } from '../utils/session-storage';\n+\n+function* SessionCompletedChallengesSaga() {\n+  yield call(incrementCurrentCount);\n+}\n+\n+export function createSessionCompletedChallengesSaga(types) {\n+  return [takeEvery(types.submitComplete, SessionCompletedChallengesSaga)];\n+}"
        },
        {
            "sha": "67475a3c4ecf9e0cab5c87ebdb734fe8b45b0058",
            "filename": "client/src/redux/types.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Ftypes.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Fredux%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Ftypes.ts?ref=0ee8097a16c937d53c39800bf54705355a5c61fc",
            "patch": "@@ -14,9 +14,7 @@ export interface State {\n   [MainApp]: {\n     appUsername: string;\n     recentlyClaimedBlock: null | string;\n-    completionCountWhenShownProgressModal: number | null;\n     showMultipleProgressModals: boolean;\n-    completionCount: number;\n     currentChallengId: string;\n     showCert: Record<string, unknown>;\n     showCertFetchState: DefaultFetchState;"
        },
        {
            "sha": "ad3c4b2283c7b07e96a63bca9a2cc690d2194bfa",
            "filename": "client/src/utils/session-storage.test.ts",
            "status": "added",
            "additions": 134,
            "deletions": 0,
            "changes": 134,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Futils%2Fsession-storage.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Futils%2Fsession-storage.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Fsession-storage.test.ts?ref=0ee8097a16c937d53c39800bf54705355a5c61fc",
            "patch": "@@ -0,0 +1,134 @@\n+/* eslint-disable @typescript-eslint/unbound-method */\n+import {\n+  CURRENT_COUNT_KEY,\n+  SAVED_COUNT_KEY,\n+  getSessionChallengeData,\n+  incrementCurrentCount,\n+  saveCurrentCount\n+} from './session-storage';\n+\n+describe('Session Storage', () => {\n+  let sessionStorageMock: Storage;\n+\n+  beforeEach(() => {\n+    sessionStorageMock = (() => {\n+      let store: { [key: string]: string } = {};\n+\n+      const mockStorage: Storage = {\n+        length: 0,\n+\n+        clear: jest.fn(() => {\n+          store = {};\n+        }),\n+\n+        getItem: jest.fn((key: string) => {\n+          return store[key] || null;\n+        }),\n+\n+        key: jest.fn((index: number) => {\n+          const keys = Object.keys(store);\n+          return keys[index] || null;\n+        }),\n+\n+        removeItem: jest.fn((key: string) => {\n+          delete store[key];\n+        }),\n+\n+        setItem: jest.fn((key: string, value: string) => {\n+          store[key] = value;\n+        })\n+      };\n+\n+      Object.defineProperty(mockStorage, 'length', {\n+        get: () => Object.keys(store).length\n+      });\n+\n+      return mockStorage;\n+    })();\n+\n+    Object.defineProperty(window, 'sessionStorage', {\n+      value: sessionStorageMock,\n+      configurable: true\n+    });\n+  });\n+\n+  afterEach(() => {\n+    sessionStorage.clear();\n+    jest.clearAllMocks();\n+  });\n+\n+  describe('getSessionChallengeData', () => {\n+    describe('countSinceSave', () => {\n+      it('is not included if nothing has been saved', () => {\n+        expect(getSessionChallengeData()).not.toHaveProperty('countSinceSave');\n+      });\n+\n+      it('is included if the count has been saved', () => {\n+        sessionStorage.setItem(SAVED_COUNT_KEY, '7');\n+        sessionStorage.setItem(CURRENT_COUNT_KEY, '10');\n+        expect(getSessionChallengeData()).toMatchObject({\n+          countSinceSave: 3\n+        });\n+      });\n+    });\n+\n+    describe('currentCount', () => {\n+      it('defaults to 0 if no challenges have been completed', () => {\n+        expect(getSessionChallengeData()).toMatchObject({\n+          currentCount: 0\n+        });\n+      });\n+\n+      it('returns the stored number if it exists', () => {\n+        sessionStorage.setItem(CURRENT_COUNT_KEY, '5');\n+        expect(getSessionChallengeData()).toMatchObject({\n+          currentCount: 5\n+        });\n+      });\n+    });\n+\n+    describe('isSaved', () => {\n+      it('is false if we haved saved the count', () => {\n+        expect(getSessionChallengeData()).toMatchObject({\n+          isSaved: false\n+        });\n+      });\n+\n+      it('is true if we have saved something', () => {\n+        sessionStorage.setItem(SAVED_COUNT_KEY, '7');\n+        expect(getSessionChallengeData()).toMatchObject({\n+          isSaved: true\n+        });\n+      });\n+    });\n+  });\n+\n+  describe('incrementCurrentCount', () => {\n+    test('increments the completed challenge count', () => {\n+      sessionStorage.setItem(CURRENT_COUNT_KEY, '5');\n+      incrementCurrentCount();\n+      expect(sessionStorage.setItem).toHaveBeenCalledWith(\n+        CURRENT_COUNT_KEY,\n+        '6'\n+      );\n+      expect(getSessionChallengeData()).toMatchObject({ currentCount: 6 });\n+    });\n+\n+    test('sets the count to 1 if no previous value exists', () => {\n+      incrementCurrentCount();\n+      expect(sessionStorage.setItem).toHaveBeenCalledWith(\n+        CURRENT_COUNT_KEY,\n+        '1'\n+      );\n+      expect(getSessionChallengeData()).toMatchObject({ currentCount: 1 });\n+    });\n+  });\n+\n+  describe('saveCurrentCount', () => {\n+    test('sets correct value in sessionStorage', () => {\n+      sessionStorage.setItem(CURRENT_COUNT_KEY, '5');\n+      saveCurrentCount();\n+      expect(sessionStorage.setItem).toHaveBeenCalledWith(SAVED_COUNT_KEY, '5');\n+    });\n+  });\n+});"
        },
        {
            "sha": "c441d8a52760316453120bdf8ee84119a36e1d3f",
            "filename": "client/src/utils/session-storage.ts",
            "status": "added",
            "additions": 52,
            "deletions": 0,
            "changes": 52,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Futils%2Fsession-storage.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0ee8097a16c937d53c39800bf54705355a5c61fc/client%2Fsrc%2Futils%2Fsession-storage.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Fsession-storage.ts?ref=0ee8097a16c937d53c39800bf54705355a5c61fc",
            "patch": "@@ -0,0 +1,52 @@\n+const parseCount = (rawCount: string | null) =>\n+  rawCount == null ? 0 : parseInt(rawCount, 10);\n+\n+export const CURRENT_COUNT_KEY = 'session-completed-challenges';\n+export const SAVED_COUNT_KEY = 'saved-session-completed-challenges';\n+\n+const getCurrentCount = () =>\n+  parseCount(sessionStorage.getItem(CURRENT_COUNT_KEY));\n+\n+const getSavedCount = () => parseCount(sessionStorage.getItem(SAVED_COUNT_KEY));\n+\n+export const incrementCurrentCount = () => {\n+  const newCount = getCurrentCount() + 1;\n+  sessionStorage.setItem(CURRENT_COUNT_KEY, newCount.toString());\n+};\n+\n+/**\n+ * Saves the current count so we can compare it later.\n+ */\n+export const saveCurrentCount = () => {\n+  sessionStorage.setItem(SAVED_COUNT_KEY, getCurrentCount().toString());\n+};\n+\n+const isSaved = () => sessionStorage.getItem(SAVED_COUNT_KEY) !== null;\n+\n+type AfterSave = {\n+  isSaved: true;\n+  currentCount: number;\n+  countSinceSave: number;\n+};\n+\n+type BeforeSave = {\n+  isSaved: false;\n+  currentCount: number;\n+};\n+\n+type SessionChallengeData = AfterSave | BeforeSave;\n+\n+export const getSessionChallengeData = (): SessionChallengeData => {\n+  if (isSaved()) {\n+    return {\n+      isSaved: true,\n+      currentCount: getCurrentCount(),\n+      countSinceSave: getCurrentCount() - getSavedCount()\n+    };\n+  } else {\n+    return {\n+      isSaved: false,\n+      currentCount: getCurrentCount()\n+    };\n+  }\n+};"
        }
    ],
    "stats": {
        "total": 269,
        "additions": 225,
        "deletions": 44
    }
}