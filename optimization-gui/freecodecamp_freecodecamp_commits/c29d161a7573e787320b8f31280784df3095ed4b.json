{
    "author": "huyenltnguyen",
    "message": "fix(client): source super block structure in graphql and store in redux (#62613)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "c29d161a7573e787320b8f31280784df3095ed4b",
    "files": [
        {
            "sha": "0507500e4ac29502fb6ef16e5326bd621a7626dd",
            "filename": "client/src/components/Progress/progress.tsx",
            "status": "modified",
            "additions": 64,
            "deletions": 10,
            "changes": 74,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Fcomponents%2FProgress%2Fprogress.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Fcomponents%2FProgress%2Fprogress.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FProgress%2Fprogress.tsx?ref=c29d161a7573e787320b8f31280784df3095ed4b",
            "patch": "@@ -13,7 +13,15 @@ import {\n } from '../../templates/Challenges/redux/selectors';\n import { liveCerts } from '../../../config/cert-and-project-map';\n import { updateAllChallengesInfo } from '../../redux/actions';\n-import { CertificateNode, ChallengeNode } from '../../redux/prop-types';\n+import type {\n+  CertificateNode,\n+  ChallengeNode,\n+  SuperBlockStructure\n+} from '../../redux/prop-types';\n+import {\n+  updateSuperBlockStructures,\n+  superBlockStructuresSelector\n+} from '../../templates/Introduction/redux';\n import { getIsDailyCodingChallenge } from '../../../../shared-dist/config/challenge-types';\n import {\n   isValidDateString,\n@@ -26,6 +34,7 @@ const mapStateToProps = createSelector(\n   challengeMetaSelector,\n   completedChallengesInBlockSelector,\n   completedPercentageSelector,\n+  superBlockStructuresSelector,\n   (\n     currentBlockIds: string[],\n     {\n@@ -40,19 +49,24 @@ const mapStateToProps = createSelector(\n       superBlock: string;\n     },\n     completedChallengesInBlock: number,\n-    completedPercent: number\n+    completedPercent: number,\n+    superBlockStructures: Record<string, SuperBlockStructure>\n   ) => ({\n     currentBlockIds,\n     challengeType,\n     id,\n     block,\n     superBlock,\n     completedChallengesInBlock,\n-    completedPercent\n+    completedPercent,\n+    superBlockStructures\n   })\n );\n \n-const mapDispatchToProps = { updateAllChallengesInfo };\n+const mapDispatchToProps = {\n+  updateAllChallengesInfo,\n+  updateSuperBlockStructures\n+};\n \n type PropsFromRedux = ConnectedProps<typeof connector>;\n \n@@ -68,7 +82,9 @@ function Progress({\n   completedChallengesInBlock,\n   completedPercent,\n   t,\n-  updateAllChallengesInfo\n+  updateAllChallengesInfo,\n+  updateSuperBlockStructures,\n+  superBlockStructures: superBlockStructuresFromStore\n }: ProgressProps): JSX.Element {\n   let blockTitle = t(`intro:${superBlock}.blocks.${block}.title`);\n   // Always false for legacy full stack, since it has no projects.\n@@ -86,10 +102,31 @@ function Progress({\n     }\n   }\n \n-  const { challengeNodes, certificateNodes } = useGetAllBlockIds();\n+  const { challengeNodes, certificateNodes, superBlockStructureNodes } =\n+    useGetAllChallengeData();\n+\n   useEffect(() => {\n     updateAllChallengesInfo({ challengeNodes, certificateNodes });\n-  }, [challengeNodes, certificateNodes, updateAllChallengesInfo]);\n+\n+    const structuresMap: Record<string, SuperBlockStructure> = {};\n+\n+    // The super block structures are pretty static, so we only want to\n+    // update them if we don't already have them in the store.\n+    if (Object.keys(superBlockStructuresFromStore).length === 0) {\n+      superBlockStructureNodes.forEach((node: SuperBlockStructure) => {\n+        structuresMap[node.superBlock] = node;\n+      });\n+\n+      updateSuperBlockStructures(structuresMap);\n+    }\n+  }, [\n+    challengeNodes,\n+    certificateNodes,\n+    superBlockStructureNodes,\n+    updateAllChallengesInfo,\n+    updateSuperBlockStructures,\n+    superBlockStructuresFromStore\n+  ]);\n \n   const totalChallengesInBlock = currentBlockIds?.length ?? 0;\n   const meta =\n@@ -119,13 +156,15 @@ function Progress({\n // and in completion-modal). Then we don't have to pass the data into redux.\n // This would mean that we have to memoize any complex calculations in the hook.\n // Otherwise, this will undo all the recent performance improvements.\n-const useGetAllBlockIds = () => {\n+const useGetAllChallengeData = () => {\n   const {\n     allChallengeNode: { nodes: challengeNodes },\n-    allCertificateNode: { nodes: certificateNodes }\n+    allCertificateNode: { nodes: certificateNodes },\n+    allSuperBlockStructure: { nodes: superBlockStructureNodes }\n   }: {\n     allChallengeNode: { nodes: ChallengeNode[] };\n     allCertificateNode: { nodes: CertificateNode[] };\n+    allSuperBlockStructure: { nodes: SuperBlockStructure[] };\n   } = useStaticQuery(graphql`\n     query getBlockNode {\n       allChallengeNode(\n@@ -154,10 +193,25 @@ const useGetAllBlockIds = () => {\n           }\n         }\n       }\n+      allSuperBlockStructure {\n+        nodes {\n+          superBlock\n+          chapters {\n+            dashedName\n+            comingSoon\n+            modules {\n+              dashedName\n+              comingSoon\n+              moduleType\n+              blocks\n+            }\n+          }\n+        }\n+      }\n     }\n   `);\n \n-  return { challengeNodes, certificateNodes };\n+  return { challengeNodes, certificateNodes, superBlockStructureNodes };\n };\n \n Progress.displayName = 'Progress';"
        },
        {
            "sha": "1ec1a8ed6d5527b6227c6b236d62f4a9704bfdd8",
            "filename": "client/src/redux/prop-types.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fprop-types.ts?ref=c29d161a7573e787320b8f31280784df3095ed4b",
            "patch": "@@ -1,5 +1,6 @@\n import { HandlerProps } from 'react-reflex';\n import { SuperBlocks } from '../../../shared-dist/config/curriculum';\n+import type { Chapter } from '../../../shared-dist/config/chapters';\n import { BlockLayouts, BlockTypes } from '../../../shared-dist/config/blocks';\n import type { ChallengeFile, Ext } from '../../../shared-dist/utils/polyvinyl';\n import { type CertTitle } from '../../config/cert-and-project-map';\n@@ -347,6 +348,20 @@ export type AllChallengesInfo = {\n   certificateNodes: CertificateNode[];\n };\n \n+export type ChapterBasedSuperBlockStructure = {\n+  superBlock: SuperBlocks;\n+  chapters: Chapter[];\n+};\n+\n+export type BlockBasedSuperBlockStructure = {\n+  superBlock: SuperBlocks;\n+  blocks: string[];\n+};\n+\n+export type SuperBlockStructure =\n+  | ChapterBasedSuperBlockStructure\n+  | BlockBasedSuperBlockStructure;\n+\n export type AllChallengeNode = {\n   edges: [\n     {"
        },
        {
            "sha": "0b2fdf5ac263f9ea2a4a3854fe5ba1e592ceff51",
            "filename": "client/src/redux/selectors.js",
            "status": "modified",
            "additions": 19,
            "deletions": 6,
            "changes": 25,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Fredux%2Fselectors.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Fredux%2Fselectors.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fselectors.js?ref=c29d161a7573e787320b8f31280784df3095ed4b",
            "patch": "@@ -1,10 +1,8 @@\n import { createSelector } from 'reselect';\n \n-// TODO: source the superblock structure via a GQL query, rather than directly\n-// from the curriculum\n-import superBlockStructure from '../../../curriculum/structure/superblocks/full-stack-developer.json';\n import { randomBetween } from '../utils/random-between';\n import { getSessionChallengeData } from '../utils/session-storage';\n+import { superBlockStructuresSelector } from '../templates/Introduction/redux';\n import { ns as MainApp } from './action-types';\n \n export const savedChallengesSelector = state =>\n@@ -121,6 +119,8 @@ export const createUserByNameSelector = username => state => {\n export const userFetchStateSelector = state => state[MainApp].userFetchState;\n export const allChallengesInfoSelector = state =>\n   state[MainApp].allChallengesInfo;\n+export const getSuperBlockStructure = (state, superBlock) =>\n+  superBlockStructuresSelector(state)[superBlock];\n \n export const completedChallengesIdsSelector = createSelector(\n   completedChallengesSelector,\n@@ -133,11 +133,24 @@ export const completedDailyCodingChallengesIdsSelector = createSelector(\n );\n \n export const completionStateSelector = createSelector(\n-  [allChallengesInfoSelector, completedChallengesIdsSelector],\n-  (allChallengesInfo, completedChallengesIds) => {\n-    const chapters = superBlockStructure.chapters;\n+  [\n+    allChallengesInfoSelector,\n+    completedChallengesIdsSelector,\n+    superBlockStructuresSelector,\n+    state => state.challenge.challengeMeta\n+  ],\n+  (\n+    allChallengesInfo,\n+    completedChallengesIds,\n+    superBlockStructures,\n+    challengeMeta\n+  ) => {\n     const { challengeNodes } = allChallengesInfo;\n \n+    const structure = superBlockStructures[challengeMeta.superBlock];\n+\n+    const chapters = structure.chapters ?? [];\n+\n     const getCompletionState = ({\n       chapters,\n       challenges,"
        },
        {
            "sha": "221e2906e9eac1c1253410ba67c2200ee988673b",
            "filename": "client/src/templates/Challenges/redux/completion-epic.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fcompletion-epic.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fcompletion-epic.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fcompletion-epic.js?ref=c29d161a7573e787320b8f31280784df3095ed4b",
            "patch": "@@ -35,7 +35,7 @@ import { isSignedInSelector, userSelector } from '../../../redux/selectors';\n import { mapFilesToChallengeFiles } from '../../../utils/ajax';\n import { standardizeRequestBody } from '../../../utils/challenge-request-helpers';\n import postUpdate$ from '../utils/post-update';\n-import { SuperBlocks } from '../../../../../shared-dist/config/curriculum';\n+import { chapterBasedSuperBlocks } from '../../../../../shared-dist/config/curriculum';\n import { actionTypes } from './action-types';\n import {\n   closeModal,\n@@ -295,11 +295,11 @@ export default function completionEpic(action$, state$) {\n         if (action.type !== submitActionTypes.submitComplete) return null;\n \n         const donationData =\n-          superBlock === SuperBlocks.FullStackDeveloper &&\n+          chapterBasedSuperBlocks.includes(superBlock) &&\n           blockType !== 'review' &&\n           isModuleNewlyCompletedSelector(state)\n             ? { module, superBlock }\n-            : superBlock !== SuperBlocks.FullStackDeveloper &&\n+            : !chapterBasedSuperBlocks.includes(superBlock) &&\n                 isBlockNewlyCompletedSelector(state)\n               ? { block, superBlock }\n               : null;"
        },
        {
            "sha": "d38db25a43fbb8fdd674de328dcad145dc7abda6",
            "filename": "client/src/templates/Introduction/components/super-block-accordion.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 40,
            "changes": 44,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fsuper-block-accordion.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fsuper-block-accordion.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fsuper-block-accordion.tsx?ref=c29d161a7573e787320b8f31280784df3095ed4b",
            "patch": "@@ -5,18 +5,7 @@ import { Disclosure } from '@headlessui/react';\n \n import { SuperBlocks } from '../../../../../shared-dist/config/curriculum';\n import DropDown from '../../../assets/icons/dropdown';\n-// TODO: source the superblock structure via a GQL query, rather than directly\n-// from the curriculum\n-import fullStackCert from '../../../../../curriculum/structure/superblocks/full-stack-developer.json';\n-import fullStackOpen from '../../../../../curriculum/structure/superblocks/full-stack-open.json';\n-import a1Spanish from '../../../../../curriculum/structure/superblocks/a1-professional-spanish.json';\n-import respWebDesignV9 from '../../../../../curriculum/structure/superblocks/responsive-web-design-v9.json';\n-import javascriptV9 from '../../../../../curriculum/structure/superblocks/javascript-v9.json';\n-import frontEndDevLibsV9 from '../../../../../curriculum/structure/superblocks/front-end-development-libraries-v9.json';\n-import pythonV9 from '../../../../../curriculum/structure/superblocks/python-v9.json';\n-import relationalDbV9 from '../../../../../curriculum/structure/superblocks/relational-databases-v9.json';\n-import backEndDevApisV9 from '../../../../../curriculum/structure/superblocks/back-end-development-and-apis-v9.json';\n-\n+import type { ChapterBasedSuperBlockStructure } from '../../../redux/prop-types';\n import { ChapterIcon } from '../../../assets/chapter-icon';\n import { type Chapter } from '../../../../../shared-dist/config/chapters';\n import {\n@@ -67,6 +56,7 @@ interface Challenge {\n interface SuperBlockAccordionProps {\n   challenges: Challenge[];\n   superBlock: SuperBlocks;\n+  structure: ChapterBasedSuperBlockStructure;\n   chosenBlock: string;\n   completedChallengeIds: string[];\n }\n@@ -182,37 +172,11 @@ const LinkBlock = ({\n export const SuperBlockAccordion = ({\n   challenges,\n   superBlock,\n+  structure,\n   chosenBlock,\n   completedChallengeIds\n }: SuperBlockAccordionProps) => {\n-  function getSuperblockStructure(superBlock: SuperBlocks): {\n-    chapters: Chapter[];\n-  } {\n-    switch (superBlock) {\n-      case SuperBlocks.FullStackOpen:\n-        return fullStackOpen;\n-      case SuperBlocks.FullStackDeveloper:\n-        return fullStackCert;\n-      case SuperBlocks.A1Spanish:\n-        return a1Spanish;\n-      case SuperBlocks.RespWebDesignV9:\n-        return respWebDesignV9;\n-      case SuperBlocks.JsV9:\n-        return javascriptV9;\n-      case SuperBlocks.FrontEndDevLibsV9:\n-        return frontEndDevLibsV9;\n-      case SuperBlocks.PythonV9:\n-        return pythonV9;\n-      case SuperBlocks.RelationalDbV9:\n-        return relationalDbV9;\n-      case SuperBlocks.BackEndDevApisV9:\n-        return backEndDevApisV9;\n-      default:\n-        throw new Error(\"The SuperBlock structure hasn't been imported.\");\n-    }\n-  }\n-\n-  const superBlockStructure = getSuperblockStructure(superBlock);\n+  const superBlockStructure = structure;\n \n   const modules = superBlockStructure.chapters.flatMap<Module>(\n     ({ modules }) => modules"
        },
        {
            "sha": "e0aa26f544ff1cb557e87294690ae4f0e867df2f",
            "filename": "client/src/templates/Introduction/redux/index.js",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Ftemplates%2FIntroduction%2Fredux%2Findex.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Ftemplates%2FIntroduction%2Fredux%2Findex.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FIntroduction%2Fredux%2Findex.js?ref=c29d161a7573e787320b8f31280784df3095ed4b",
            "patch": "@@ -7,16 +7,25 @@ export const ns = 'curriculumMap';\n const initialState = {\n   expandedState: {\n     block: {}\n-  }\n+  },\n+  superBlockStructures: {}\n };\n \n-const types = createTypes(['resetExpansion', 'toggleBlock'], ns);\n+const types = createTypes(\n+  ['resetExpansion', 'toggleBlock', 'updateSuperBlockStructures'],\n+  ns\n+);\n \n export const resetExpansion = createAction(types.resetExpansion);\n export const toggleBlock = createAction(types.toggleBlock);\n+export const updateSuperBlockStructures = createAction(\n+  types.updateSuperBlockStructures\n+);\n \n export const makeExpandedBlockSelector = block => state =>\n   !!state[ns].expandedState.block[block];\n+export const superBlockStructuresSelector = state =>\n+  state[ns].superBlockStructures || {};\n \n export const reducer = handleActions(\n   {\n@@ -35,6 +44,10 @@ export const reducer = handleActions(\n           [payload]: !state.expandedState.block[payload]\n         }\n       }\n+    }),\n+    [types.updateSuperBlockStructures]: (state, { payload }) => ({\n+      ...state,\n+      superBlockStructures: { ...payload }\n     })\n   },\n   initialState"
        },
        {
            "sha": "05242dfa464dab35227422a82d1352d8aa4dbd7a",
            "filename": "client/src/templates/Introduction/super-block-intro.tsx",
            "status": "modified",
            "additions": 30,
            "deletions": 2,
            "changes": 32,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Ftemplates%2FIntroduction%2Fsuper-block-intro.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c29d161a7573e787320b8f31280784df3095ed4b/client%2Fsrc%2Ftemplates%2FIntroduction%2Fsuper-block-intro.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FIntroduction%2Fsuper-block-intro.tsx?ref=c29d161a7573e787320b8f31280784df3095ed4b",
            "patch": "@@ -27,7 +27,11 @@ import {\n   userFetchStateSelector,\n   signInLoadingSelector\n } from '../../redux/selectors';\n-import type { User } from '../../redux/prop-types';\n+import type {\n+  SuperBlockStructure,\n+  User,\n+  ChapterBasedSuperBlockStructure\n+} from '../../redux/prop-types';\n import { CertTitle, liveCerts } from '../../../config/cert-and-project-map';\n import { superBlockToCertMap } from '../../../../shared-dist/config/certification-settings';\n import {\n@@ -71,6 +75,7 @@ type SuperBlockProps = {\n   currentChallengeId: string;\n   data: {\n     allChallengeNode: { nodes: ChallengeNode[] };\n+    allSuperBlockStructure: { nodes: SuperBlockStructure[] };\n   };\n   expandedState: {\n     [key: string]: boolean;\n@@ -143,7 +148,8 @@ const SuperBlockIntroductionPage = (props: SuperBlockProps) => {\n \n   const {\n     data: {\n-      allChallengeNode: { nodes }\n+      allChallengeNode: { nodes },\n+      allSuperBlockStructure\n     },\n     isSignedIn,\n     currentChallengeId,\n@@ -173,6 +179,10 @@ const SuperBlockIntroductionPage = (props: SuperBlockProps) => {\n \n   const i18nTitle = i18next.t(`intro:${superBlock}.title`);\n \n+  const currentSuperBlockStructure = allSuperBlockStructure.nodes.find(\n+    node => node.superBlock === superBlock\n+  );\n+\n   const showCertification = liveCerts.some(\n     cert => superBlockToCertMap[superBlock] === cert.certSlug\n   );\n@@ -265,6 +275,9 @@ const SuperBlockIntroductionPage = (props: SuperBlockProps) => {\n                 <SuperBlockAccordion\n                   challenges={superBlockChallenges}\n                   superBlock={superBlock}\n+                  structure={\n+                    currentSuperBlockStructure as ChapterBasedSuperBlockStructure\n+                  }\n                   chosenBlock={initialExpandedBlock}\n                   completedChallengeIds={completedChallenges.map(c => c.id)}\n                 />\n@@ -359,5 +372,20 @@ export const query = graphql`\n         }\n       }\n     }\n+    allSuperBlockStructure {\n+      nodes {\n+        superBlock\n+        chapters {\n+          dashedName\n+          comingSoon\n+          modules {\n+            dashedName\n+            comingSoon\n+            moduleType\n+            blocks\n+          }\n+        }\n+      }\n+    }\n   }\n `;"
        },
        {
            "sha": "cccf3c1b87ebffde1c491d885906067a5635cd38",
            "filename": "tools/client-plugins/gatsby-source-challenges/gatsby-node.js",
            "status": "modified",
            "additions": 54,
            "deletions": 4,
            "changes": 58,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c29d161a7573e787320b8f31280784df3095ed4b/tools%2Fclient-plugins%2Fgatsby-source-challenges%2Fgatsby-node.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c29d161a7573e787320b8f31280784df3095ed4b/tools%2Fclient-plugins%2Fgatsby-source-challenges%2Fgatsby-node.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fclient-plugins%2Fgatsby-source-challenges%2Fgatsby-node.js?ref=c29d161a7573e787320b8f31280784df3095ed4b",
            "patch": "@@ -1,9 +1,11 @@\n+const path = require('path');\n const chokidar = require('chokidar');\n+const { getSuperblockStructure } = require('../../../curriculum/file-handler');\n \n const { createChallengeNode } = require('./create-challenge-nodes');\n \n exports.sourceNodes = function sourceChallengesSourceNodes(\n-  { actions, reporter },\n+  { actions, reporter, createNodeId, createContentDigest },\n   pluginOptions\n ) {\n   const { source, onSourceChange, curriculumPath } = pluginOptions;\n@@ -67,9 +69,13 @@ exports.sourceNodes = function sourceChallengesSourceNodes(\n   function sourceAndCreateNodes() {\n     return source()\n       .then(challenges => Promise.all(challenges))\n-      .then(challenges =>\n-        challenges.map(challenge => createVisibleChallenge(challenge))\n-      )\n+      .then(challenges => {\n+        // create challenge nodes\n+        challenges.forEach(challenge => createVisibleChallenge(challenge));\n+        // create superblock structure nodes\n+        createSuperBlockStructureNodes();\n+        return Promise.resolve();\n+      })\n       .catch(e => {\n         console.log(e);\n         reporter.panic(`fcc-source-challenges\n@@ -84,6 +90,50 @@ exports.sourceNodes = function sourceChallengesSourceNodes(\n     createNode(createChallengeNode(challenge, reporter, options));\n   }\n \n+  function createSuperBlockStructureNodes() {\n+    const buildCurriculumPath = path.resolve(\n+      curriculumPath,\n+      '..',\n+      '..',\n+      'build-curriculum'\n+    );\n+    const buildCurriculum = require(buildCurriculumPath);\n+    const superBlockToFilename = buildCurriculum.superBlockToFilename;\n+\n+    if (!superBlockToFilename) {\n+      reporter.panic(\n+        'superBlockToFilename is missing from build-curriculum. This map is required.'\n+      );\n+    }\n+\n+    Object.keys(superBlockToFilename).forEach(superBlock => {\n+      const filename = superBlockToFilename[superBlock] || superBlock;\n+      try {\n+        const structure = getSuperblockStructure(filename);\n+\n+        const nodeId = createNodeId(`SuperBlockStructure-${superBlock}`);\n+        const nodeContent = JSON.stringify(structure);\n+\n+        createNode({\n+          ...structure,\n+          superBlock,\n+          id: nodeId,\n+          parent: null,\n+          children: [],\n+          internal: {\n+            type: 'SuperBlockStructure',\n+            content: nodeContent,\n+            contentDigest: createContentDigest(structure)\n+          }\n+        });\n+      } catch (err) {\n+        reporter.warn(\n+          `Could not load structure for ${superBlock} (${filename}): ${err.message}`\n+        );\n+      }\n+    });\n+  }\n+\n   return new Promise((resolve, reject) => {\n     watcher.on('ready', () => sourceAndCreateNodes().then(resolve, reject));\n   });"
        }
    ],
    "stats": {
        "total": 271,
        "additions": 204,
        "deletions": 67
    }
}