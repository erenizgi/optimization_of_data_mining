{
    "author": "huyenltnguyen",
    "message": "test(client): add unit tests for theme initialization logic (#63212)",
    "sha": "3b0a6a022b33423e9b2b5a19b0ec0eb037c4933b",
    "files": [
        {
            "sha": "5df2edd85891ead0740771fd8db01435926ac902",
            "filename": "client/src/redux/theme-saga.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3b0a6a022b33423e9b2b5a19b0ec0eb037c4933b/client%2Fsrc%2Fredux%2Ftheme-saga.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3b0a6a022b33423e9b2b5a19b0ec0eb037c4933b/client%2Fsrc%2Fredux%2Ftheme-saga.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Ftheme-saga.js?ref=3b0a6a022b33423e9b2b5a19b0ec0eb037c4933b",
            "patch": "@@ -13,7 +13,7 @@ function* toggleThemeSaga() {\n   yield put(createFlashMessage({ ...data }));\n }\n \n-function* initializeThemeSaga() {\n+export function* initializeThemeSaga() {\n   // Wait for the fetch userComplete action\n   yield take(actionTypes.fetchUserComplete);\n "
        },
        {
            "sha": "225dbf3c4a0891d3e3e0c7cefba1daadb9037cfc",
            "filename": "client/src/redux/theme-saga.test.js",
            "status": "added",
            "additions": 119,
            "deletions": 0,
            "changes": 119,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3b0a6a022b33423e9b2b5a19b0ec0eb037c4933b/client%2Fsrc%2Fredux%2Ftheme-saga.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3b0a6a022b33423e9b2b5a19b0ec0eb037c4933b/client%2Fsrc%2Fredux%2Ftheme-saga.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Ftheme-saga.test.js?ref=3b0a6a022b33423e9b2b5a19b0ec0eb037c4933b",
            "patch": "@@ -0,0 +1,119 @@\n+// @vitest-environment jsdom\n+import { expectSaga } from 'redux-saga-test-plan';\n+import { describe, it, vi, beforeEach, afterEach, expect } from 'vitest';\n+import { select, take } from 'redux-saga/effects';\n+import { initializeThemeSaga } from './theme-saga.js';\n+import { setTheme } from './actions';\n+import { actionTypes } from './action-types';\n+import { userThemeSelector } from './selectors';\n+\n+describe('initializeThemeSaga', () => {\n+  let localStorageMock;\n+  let matchMediaMock;\n+\n+  beforeEach(() => {\n+    localStorageMock = {\n+      getItem: vi.fn(),\n+      setItem: vi.fn()\n+    };\n+    Object.defineProperty(window, 'localStorage', {\n+      value: localStorageMock,\n+      writable: true\n+    });\n+\n+    matchMediaMock = vi.fn();\n+    Object.defineProperty(window, 'matchMedia', {\n+      value: matchMediaMock,\n+      writable: true\n+    });\n+  });\n+\n+  afterEach(() => {\n+    vi.clearAllMocks();\n+  });\n+\n+  it('should wait for fetchUserComplete action before initializing', async () => {\n+    localStorageMock.getItem.mockReturnValue('dark');\n+    matchMediaMock.mockReturnValue({ matches: false });\n+\n+    // Without the fetchUserComplete action\n+    await expectSaga(initializeThemeSaga)\n+      .provide([[select(userThemeSelector), null]])\n+      .not.put(setTheme('dark'))\n+      .run({ silenceTimeout: true });\n+\n+    expect(localStorageMock.setItem).not.toHaveBeenCalled();\n+\n+    // With the fetchUserComplete action\n+    await expectSaga(initializeThemeSaga)\n+      .provide([\n+        [take(actionTypes.fetchUserComplete), undefined],\n+        [select(userThemeSelector), null]\n+      ])\n+      .take(actionTypes.fetchUserComplete)\n+      .put(setTheme('dark'))\n+      .run();\n+\n+    expect(localStorageMock.setItem).toHaveBeenCalledWith('theme', 'dark');\n+  });\n+\n+  it('should use localStorage theme regardless of user preference', async () => {\n+    localStorageMock.getItem.mockReturnValue('dark');\n+    matchMediaMock.mockReturnValue({ matches: false });\n+\n+    await expectSaga(initializeThemeSaga)\n+      .provide([\n+        [take(actionTypes.fetchUserComplete), undefined],\n+        [select(userThemeSelector), 'day']\n+      ])\n+      .put(setTheme('dark'))\n+      .run();\n+\n+    expect(localStorageMock.setItem).toHaveBeenCalledWith('theme', 'dark');\n+  });\n+\n+  it('should use user preference when localStorage is empty regardless of system preference', async () => {\n+    localStorageMock.getItem.mockReturnValue(null);\n+    matchMediaMock.mockReturnValue({ matches: false });\n+\n+    await expectSaga(initializeThemeSaga)\n+      .provide([\n+        [take(actionTypes.fetchUserComplete), undefined],\n+        [select(userThemeSelector), 'night']\n+      ])\n+      .put(setTheme('dark'))\n+      .run();\n+\n+    expect(localStorageMock.setItem).toHaveBeenCalledWith('theme', 'dark');\n+  });\n+\n+  it('should use system preference when localStorage and user preference are empty', async () => {\n+    localStorageMock.getItem.mockReturnValue(null);\n+    matchMediaMock.mockReturnValue({ matches: true });\n+\n+    await expectSaga(initializeThemeSaga)\n+      .provide([\n+        [take(actionTypes.fetchUserComplete), undefined],\n+        [select(userThemeSelector), null]\n+      ])\n+      .put(setTheme('dark'))\n+      .run();\n+\n+    expect(localStorageMock.setItem).toHaveBeenCalledWith('theme', 'dark');\n+  });\n+\n+  it('should default to light theme when all preferences are empty', async () => {\n+    localStorageMock.getItem.mockReturnValue(null);\n+    matchMediaMock.mockReturnValue({ matches: false });\n+\n+    await expectSaga(initializeThemeSaga)\n+      .provide([\n+        [take(actionTypes.fetchUserComplete), undefined],\n+        [select(userThemeSelector), null]\n+      ])\n+      .put(setTheme('light'))\n+      .run();\n+\n+    expect(localStorageMock.setItem).toHaveBeenCalledWith('theme', 'light');\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 121,
        "additions": 120,
        "deletions": 1
    }
}