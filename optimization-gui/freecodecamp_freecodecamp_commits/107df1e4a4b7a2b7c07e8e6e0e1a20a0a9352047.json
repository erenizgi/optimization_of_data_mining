{
    "author": "raisedadead",
    "message": "fix(GHA): fix formatting and expansion",
    "sha": "107df1e4a4b7a2b7c07e8e6e0e1a20a0a9352047",
    "files": [
        {
            "sha": "6fc1f56b1bc66bd4cd668b81c6e1ad08ec516914",
            "filename": ".github/workflows/deploy.yml",
            "status": "modified",
            "additions": 26,
            "deletions": 27,
            "changes": 53,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/107df1e4a4b7a2b7c07e8e6e0e1a20a0a9352047/.github%2Fworkflows%2Fdeploy.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/107df1e4a4b7a2b7c07e8e6e0e1a20a0a9352047/.github%2Fworkflows%2Fdeploy.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fdeploy.yml?ref=107df1e4a4b7a2b7c07e8e6e0e1a20a0a9352047",
            "patch": "@@ -96,38 +96,37 @@ jobs:\n         run: |\n           REMOTE_SCRIPT=\"\n           set -e\n-            echo -e '\\nLOG:Deploying API to $TS_MACHINE_NAME...'\n-            cd /home/${TS_USERNAME}/docker-swarm-config/stacks/api || { echo \"Error: Failed to change directory\"; exit 1; }\n-            which age > /dev/null || { echo \"Error: age not installed\"; exit 1; }\n+          echo -e '\\nLOG:Deploying API to \\$TS_MACHINE_NAME...'\n+          cd /home/\\${TS_USERNAME}/docker-swarm-config/stacks/api || { echo \\\"Error: Failed to change directory\\\"; exit 1; }\n+          which age > /dev/null || { echo \\\"Error: age not installed\\\"; exit 1; }\n \n-            echo -e '\\nLOG:Decrypting secrets...'\n-            echo \"${AGE_ENCRYPTED_ASC_SECRETS}\" > secrets.age.asc\n-            echo \"${AGE_SECRET_KEY}\" > age.key && chmod 600 age.key\n-            age --identity age.key --decrypt secrets.age.asc > .env\n-            rm -f age.key secrets.age.asc\n+          echo -e '\\nLOG:Decrypting secrets...'\n+          echo \\\"\\${AGE_ENCRYPTED_ASC_SECRETS}\\\" > secrets.age.asc\n+          echo \\\"\\${AGE_SECRET_KEY}\\\" > age.key && chmod 600 age.key\n+          age --identity age.key --decrypt secrets.age.asc > .env\n+          rm -f age.key secrets.age.asc\n \n-            echo -e '\\nLOG:Adding deployment variables...'\n-            {\n-              echo \"DEPLOYMENT_VERSION=${DEPLOYMENT_VERSION}\"\n-              echo \"FCC_API_LOG_LEVEL=${FCC_API_LOG_LEVEL}\"\n-            } >> .env\n+          echo -e '\\nLOG:Adding deployment variables...'\n+          {\n+            echo \\\"DEPLOYMENT_VERSION=\\${DEPLOYMENT_VERSION}\\\"\n+            echo \\\"FCC_API_LOG_LEVEL=\\${FCC_API_LOG_LEVEL}\\\"\n+          } >> .env\n \n-            echo -e '\\nLOG:Exporting environment variables...'\n-            while IFS='=' read -r key value; do\n-              if [[ -n \\$key && ! \\$key =~ ^# ]]; then\n-                export \"\\${key}=\\${value}\"\n-              fi\n-            done < .env\n-            rm -f .env\n+          echo -e '\\nLOG:Exporting environment variables...'\n+          while IFS='=' read -r key value; do\n+            if [[ -n \\$key && ! \\$key =~ ^# ]]; then\n+              export \\\"\\${key}=\\${value}\\\"\n+            fi\n+          done < .env\n+          rm -f .env\n \n-            echo -e '\\nLOG:Validating environment and config...'\n-            env | grep -E 'DOMAIN|DEPLOYMENT' || { echo \"Error: Required environment variables not found\"; exit 1; }\n-            docker stack config -c stack-api.yml > /dev/null || { echo \"Error: Invalid stack configuration\"; exit 1; }\n+          echo -e '\\nLOG:Validating environment and config...'\n+          env | grep -E 'DOMAIN|DEPLOYMENT' || { echo \\\"Error: Required environment variables not found\\\"; exit 1; }\n+          docker stack config -c stack-api.yml > /dev/null || { echo \\\"Error: Invalid stack configuration\\\"; exit 1; }\n \n-            echo -e '\\nLOG:Deploying stack...'\n-            docker stack deploy -c stack-api.yml --prune --with-registry-auth --detach=false ${STACK_NAME}\n-            echo -e '\\nLOG:Finished deployment.'\n+          echo -e '\\nLOG:Deploying stack...'\n+          docker stack deploy -c stack-api.yml --prune --with-registry-auth --detach=false \\${STACK_NAME}\n+          echo -e '\\nLOG:Finished deployment.'\n           \"\n           MACHINE_IP=$(tailscale ip -4 $TS_MACHINE_NAME)\n           ssh $TS_USERNAME@$MACHINE_IP \"$REMOTE_SCRIPT\"\n-        shell: bash"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 26,
        "deletions": 27
    }
}