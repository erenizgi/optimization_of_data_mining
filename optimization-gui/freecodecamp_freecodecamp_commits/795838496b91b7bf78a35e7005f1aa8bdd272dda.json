{
    "author": "ojeytonwilliams",
    "message": "fix(client): make search bar only highlight footer when it is selectd. (#58506)",
    "sha": "795838496b91b7bf78a35e7005f1aa8bdd272dda",
    "files": [
        {
            "sha": "190c663564ac9de9e54893ccbb96e7d56ddaf1ed",
            "filename": "client/src/components/search/searchBar/search-bar-footer.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/795838496b91b7bf78a35e7005f1aa8bdd272dda/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-bar-footer.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/795838496b91b7bf78a35e7005f1aa8bdd272dda/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-bar-footer.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-bar-footer.tsx?ref=795838496b91b7bf78a35e7005f1aa8bdd272dda",
            "patch": "@@ -6,15 +6,15 @@ import NoHitsSuggestion from './no-hits-suggestion';\n interface SearchBarFooterProps {\n   hasHits: boolean;\n   query?: string;\n-  selectedIndex: number;\n+  isSelected: boolean;\n   onMouseEnter: (e: React.SyntheticEvent<HTMLElement, Event>) => void;\n   onMouseLeave: (e: React.SyntheticEvent<HTMLElement, Event>) => void;\n }\n \n const SearchBarFooter = ({\n   hasHits,\n   query,\n-  selectedIndex,\n+  isSelected,\n   onMouseEnter,\n   onMouseLeave\n }: SearchBarFooterProps) => {\n@@ -27,7 +27,7 @@ const SearchBarFooter = ({\n \n   return hasHits ? (\n     <li\n-      className={`ais-Hits-item ${selectedIndex === 5 ? 'selected' : ''}`}\n+      className={`ais-Hits-item ${isSelected ? 'selected' : ''}`}\n       onMouseEnter={onMouseEnter}\n       onMouseLeave={onMouseLeave}\n     >"
        },
        {
            "sha": "83161e695604a297c4c2e166d9a36050fd2ebaff",
            "filename": "client/src/components/search/searchBar/search-bar-optimized.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/795838496b91b7bf78a35e7005f1aa8bdd272dda/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-bar-optimized.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/795838496b91b7bf78a35e7005f1aa8bdd272dda/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-bar-optimized.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-bar-optimized.tsx?ref=795838496b91b7bf78a35e7005f1aa8bdd272dda",
            "patch": "@@ -3,11 +3,12 @@ import { useTranslation } from 'react-i18next';\n import Magnifier from '../../../assets/icons/magnifier';\n import InputReset from '../../../assets/icons/input-reset';\n import { searchPageUrl } from '../../../utils/algolia-locale-setup';\n-import type { SearchBarProps } from './search-bar';\n \n const SearchBarOptimized = ({\n   innerRef\n-}: Pick<SearchBarProps, 'innerRef'>): JSX.Element => {\n+}: {\n+  innerRef: React.RefObject<HTMLDivElement>;\n+}): JSX.Element => {\n   const { t } = useTranslation();\n   // TODO: Refactor this fallback when all translation files are synced\n   const searchPlaceholder = t('search-bar:placeholder').startsWith("
        },
        {
            "sha": "f973ceb84c147f3e625540ae02637a3af9ef562d",
            "filename": "client/src/components/search/searchBar/search-bar.tsx",
            "status": "modified",
            "additions": 104,
            "deletions": 141,
            "changes": 245,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/795838496b91b7bf78a35e7005f1aa8bdd272dda/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-bar.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/795838496b91b7bf78a35e7005f1aa8bdd272dda/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-bar.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-bar.tsx?ref=795838496b91b7bf78a35e7005f1aa8bdd272dda",
            "patch": "@@ -1,8 +1,7 @@\n import { isEqual } from 'lodash-es';\n-import React, { Component } from 'react';\n+import React, { useCallback, useEffect, useRef, useState } from 'react';\n import { HotKeys, ObserveKeys } from 'react-hotkeys';\n-import type { TFunction } from 'i18next';\n-import { withTranslation } from 'react-i18next';\n+import { useTranslation, withTranslation } from 'react-i18next';\n import { SearchBox } from 'react-instantsearch';\n import { connect } from 'react-redux';\n import { AnyAction, bindActionCreators, Dispatch } from 'redux';\n@@ -35,82 +34,71 @@ const mapStateToProps = createSelector(\n const mapDispatchToProps = (dispatch: Dispatch<AnyAction>) =>\n   bindActionCreators({ toggleSearchDropdown, toggleSearchFocused }, dispatch);\n \n-export type SearchBarProps = {\n+type SearchBarProps = {\n   innerRef?: React.RefObject<HTMLDivElement>;\n   toggleSearchDropdown: typeof toggleSearchDropdown;\n   toggleSearchFocused: typeof toggleSearchFocused;\n   isDropdownEnabled?: boolean;\n   isSearchFocused?: boolean;\n-  t: TFunction;\n };\n-type SearchBarState = {\n-  index: number;\n-  hits: Array<Hit>;\n-};\n-\n-export class SearchBar extends Component<SearchBarProps, SearchBarState> {\n-  static displayName: string;\n-  constructor(props: SearchBarProps) {\n-    super(props);\n-\n-    this.handleChange = this.handleChange.bind(this);\n-    this.handleSearch = this.handleSearch.bind(this);\n-    this.handleMouseEnter = this.handleMouseEnter.bind(this);\n-    this.handleMouseLeave = this.handleMouseLeave.bind(this);\n-    this.handleFocus = this.handleFocus.bind(this);\n-    this.handleHits = this.handleHits.bind(this);\n-    this.state = {\n-      index: -1,\n-      hits: []\n-    };\n-  }\n-\n-  componentDidMount(): void {\n-    const { t } = this.props;\n \n-    document.addEventListener('click', this.handleFocus);\n-\n-    const searchInput = document.querySelector('.ais-SearchBox-input');\n-    if (searchInput) {\n-      searchInput.setAttribute('aria-label', t('search.label'));\n-    }\n-  }\n-\n-  componentWillUnmount(): void {\n-    document.removeEventListener('click', this.handleFocus);\n-  }\n+const keyMap = {\n+  indexUp: ['up'],\n+  indexDown: ['down']\n+};\n \n-  handleChange = (): void => {\n-    const { isSearchFocused, toggleSearchFocused } = this.props;\n+export function SearchBar({\n+  isDropdownEnabled,\n+  isSearchFocused,\n+  innerRef,\n+  toggleSearchDropdown,\n+  toggleSearchFocused\n+}: SearchBarProps): JSX.Element {\n+  const { t } = useTranslation();\n+  const [index, setIndex] = useState(-1);\n+  const [hits, setHits] = useState<Array<Hit>>([]);\n+  // We need a ref because we have to get the current value of hits in handlers\n+  const hitsRef = useRef(hits);\n+\n+  const handleChange = (): void => {\n     if (!isSearchFocused) {\n       toggleSearchFocused(true);\n     }\n \n-    this.setState({\n-      index: -1\n-    });\n+    setIndex(-1);\n   };\n \n-  handleFocus = (e: React.FocusEvent<Node> | Event): AnyAction | void => {\n-    const { toggleSearchFocused } = this.props;\n-    const isSearchFocused = this.props.innerRef?.current?.contains(\n-      e.target as HTMLElement\n-    );\n-    if (!isSearchFocused) {\n-      // Reset if user clicks outside of\n-      // search bar / closes dropdown\n-      this.setState({ index: -1 });\n+  const handleFocus = useCallback(\n+    (e: React.FocusEvent<Node> | Event): AnyAction | void => {\n+      const isSearchFocused = innerRef?.current?.contains(\n+        e.target as HTMLElement\n+      );\n+      if (!isSearchFocused) {\n+        // Reset if user clicks outside of\n+        // search bar / closes dropdown\n+        setIndex(-1);\n+      }\n+      return toggleSearchFocused(isSearchFocused);\n+    },\n+    [innerRef, toggleSearchFocused]\n+  );\n+\n+  useEffect(() => {\n+    document.addEventListener('click', handleFocus);\n+    const searchInput = document.querySelector('.ais-SearchBox-input');\n+    if (searchInput) {\n+      searchInput.setAttribute('aria-label', t('search.label'));\n     }\n-    return toggleSearchFocused(isSearchFocused);\n-  };\n+    return () => {\n+      document.removeEventListener('click', handleFocus);\n+    };\n+  }, [handleFocus, t]);\n \n-  handleSearch = (\n+  const handleSearch = (\n     e: React.SyntheticEvent<HTMLFormElement, Event>,\n     query?: string\n   ): boolean | void => {\n     e.preventDefault();\n-    const { toggleSearchDropdown } = this.props;\n-    const { index, hits } = this.state;\n     const selectedHit = hits[index];\n \n     // Disable the search dropdown\n@@ -142,108 +130,83 @@ export class SearchBar extends Component<SearchBarProps, SearchBarState> {\n       : false;\n   };\n \n-  handleMouseEnter = (e: React.SyntheticEvent<HTMLElement, Event>): void => {\n+  const handleMouseEnter = (\n+    e: React.SyntheticEvent<HTMLElement, Event>\n+  ): void => {\n     e.persist();\n \n-    this.setState(({ hits }) => {\n+    if (e.target instanceof HTMLElement) {\n       const hitsTitles = hits.map(hit => hit.title);\n+      const targetText = e.target.textContent;\n+      const hoveredIndex = targetText ? hitsTitles.indexOf(targetText) : -1;\n \n-      if (e.target instanceof HTMLElement) {\n-        const targetText = e.target.textContent;\n-        const hoveredIndex = targetText ? hitsTitles.indexOf(targetText) : -1;\n-\n-        return { index: hoveredIndex };\n-      }\n-\n-      return { index: -1 };\n-    });\n+      setIndex(hoveredIndex);\n+    }\n+    setIndex(-1);\n   };\n \n-  handleMouseLeave = (): void => {\n-    this.setState({\n-      index: -1\n-    });\n+  const handleMouseLeave = () => {\n+    setIndex(-1);\n   };\n \n-  handleHits = (currHits: Array<Hit>): void => {\n-    const { hits } = this.state;\n-\n+  const handleHits = (currHits: Array<Hit>): void => {\n     if (!isEqual(hits, currHits)) {\n-      this.setState({\n-        index: -1,\n-        hits: currHits\n-      });\n+      setIndex(-1);\n+      hitsRef.current = currHits;\n+      setHits(currHits);\n     }\n   };\n \n-  keyMap = {\n-    indexUp: ['up'],\n-    indexDown: ['down']\n-  };\n-\n-  keyHandlers = {\n+  const keyHandlers = {\n     indexUp: (e: KeyboardEvent | undefined): void => {\n       e?.preventDefault();\n-      this.setState(({ index, hits }) => ({\n-        index: index === -1 ? hits.length : index - 1\n-      }));\n+      setIndex(index => (index === -1 ? hitsRef.current.length : index - 1));\n     },\n     indexDown: (e: KeyboardEvent | undefined): void => {\n       e?.preventDefault();\n-      this.setState(({ index, hits }) => ({\n-        index: index === hits.length ? -1 : index + 1\n-      }));\n+      setIndex(index => (index === hitsRef.current.length ? -1 : index + 1));\n     }\n   };\n \n-  render(): JSX.Element {\n-    const { isDropdownEnabled, isSearchFocused, innerRef, t } = this.props;\n-    const { index } = this.state;\n-    // TODO: Refactor this fallback when all translation files are synced\n-    const searchPlaceholder = t('search-bar:placeholder').startsWith(\n-      'search.placeholder.'\n-    )\n-      ? t('search.placeholder')\n-      : t('search-bar:placeholder');\n-\n-    return (\n-      <WithInstantSearch>\n-        <div\n-          className='fcc_searchBar'\n-          data-testid='fcc_searchBar'\n-          ref={innerRef}\n-        >\n-          <HotKeys handlers={this.keyHandlers} keyMap={this.keyMap}>\n-            <div className='fcc_search_wrapper'>\n-              <ObserveKeys except={['Space']}>\n-                <SearchBox\n-                  data-playwright-test-label='header-search'\n-                  onSubmit={e => {\n-                    this.handleSearch(e);\n-                  }}\n-                  onInput={this.handleChange}\n-                  translations={{\n-                    submitButtonTitle: t('icons.input-search'),\n-                    resetButtonTitle: t('icons.input-reset')\n-                  }}\n-                  placeholder={searchPlaceholder}\n-                  onFocus={this.handleFocus}\n-                />\n-              </ObserveKeys>\n-              {isDropdownEnabled && isSearchFocused && (\n-                <SearchHits\n-                  handleMouseEnter={this.handleMouseEnter}\n-                  handleMouseLeave={this.handleMouseLeave}\n-                  handleHits={this.handleHits}\n-                  selectedIndex={index}\n-                />\n-              )}\n-            </div>\n-          </HotKeys>\n-        </div>\n-      </WithInstantSearch>\n-    );\n-  }\n+  const searchPlaceholder = t('search-bar:placeholder').startsWith(\n+    'search.placeholder.'\n+  )\n+    ? t('search.placeholder')\n+    : t('search-bar:placeholder');\n+\n+  return (\n+    <WithInstantSearch>\n+      <div className='fcc_searchBar' data-testid='fcc_searchBar' ref={innerRef}>\n+        <HotKeys handlers={keyHandlers} keyMap={keyMap}>\n+          <div className='fcc_search_wrapper'>\n+            <ObserveKeys except={['Space']}>\n+              <SearchBox\n+                data-playwright-test-label='header-search'\n+                onSubmit={e => {\n+                  handleSearch(e);\n+                }}\n+                onInput={handleChange}\n+                translations={{\n+                  submitButtonTitle: t('icons.input-search'),\n+                  resetButtonTitle: t('icons.input-reset')\n+                }}\n+                placeholder={searchPlaceholder}\n+                onFocus={handleFocus}\n+              />\n+            </ObserveKeys>\n+            {isDropdownEnabled && isSearchFocused && (\n+              <SearchHits\n+                handleMouseEnter={handleMouseEnter}\n+                handleMouseLeave={handleMouseLeave}\n+                handleHits={handleHits}\n+                selectedIndex={index}\n+              />\n+            )}\n+          </div>\n+        </HotKeys>\n+      </div>\n+    </WithInstantSearch>\n+  );\n }\n \n SearchBar.displayName = 'SearchBar';"
        },
        {
            "sha": "cf84fc5118f3e43f4344c8db0f3817d85a3525b0",
            "filename": "client/src/components/search/searchBar/search-hits.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/795838496b91b7bf78a35e7005f1aa8bdd272dda/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-hits.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/795838496b91b7bf78a35e7005f1aa8bdd272dda/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-hits.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-hits.tsx?ref=795838496b91b7bf78a35e7005f1aa8bdd272dda",
            "patch": "@@ -55,7 +55,7 @@ function SearchHits({\n         <SearchBarFooter\n           hasHits={!noHits}\n           query={results?.query}\n-          selectedIndex={selectedIndex}\n+          isSelected={selectedIndex === allHits.length}\n           onMouseEnter={handleMouseEnter}\n           onMouseLeave={handleMouseLeave}\n         />"
        }
    ],
    "stats": {
        "total": 258,
        "additions": 111,
        "deletions": 147
    }
}