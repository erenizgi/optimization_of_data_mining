{
    "author": "ojeytonwilliams",
    "message": "chore(api): add user's id to errors sent to Sentry (#60725)",
    "sha": "a9dc3bdeef781da2a7c3dbbb367eb46eba27306b",
    "files": [
        {
            "sha": "0212c9e220d4c5bfeeb97e08159e416e3f12764f",
            "filename": "api/src/plugins/auth.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a9dc3bdeef781da2a7c3dbbb367eb46eba27306b/api%2Fsrc%2Fplugins%2Fauth.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a9dc3bdeef781da2a7c3dbbb367eb46eba27306b/api%2Fsrc%2Fplugins%2Fauth.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fauth.ts?ref=a9dc3bdeef781da2a7c3dbbb367eb46eba27306b",
            "patch": "@@ -67,6 +67,11 @@ const auth: FastifyPluginCallback = (fastify, _options, done) => {\n     };\n \n     if (isExpired(accessToken)) return setAccessDenied(req, TOKEN_EXPIRED);\n+    // We're using token.userId since it's possible for the user record to be\n+    // malformed and for prisma to throw while trying to find the user.\n+    fastify.Sentry?.setUser({\n+      id: accessToken.userId\n+    });\n \n     const user = await fastify.prisma.user.findUnique({\n       where: { id: accessToken.userId }\n@@ -142,6 +147,12 @@ const auth: FastifyPluginCallback = (fastify, _options, done) => {\n         message: 'Token not found'\n       };\n     }\n+    // We're using token.userId since it's possible for the user record to be\n+    // malformed and for prisma to throw while trying to find the user.\n+\n+    fastify.Sentry?.setUser({\n+      id: token.userId\n+    });\n \n     const user = await fastify.prisma.user.findUnique({\n       where: { id: token.userId }"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}