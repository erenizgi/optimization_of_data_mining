{
    "author": "Othniel01",
    "message": "fix(UI): Script displayed in preview when using specific css (#56570)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "51161b677bcb1ca4c5de6b84844e2b3255c52992",
    "files": [
        {
            "sha": "f3b0303203511b70e9b8bef5453f7f342485648c",
            "filename": "client/src/templates/Challenges/utils/frame.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/51161b677bcb1ca4c5de6b84844e2b3255c52992/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fframe.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/51161b677bcb1ca4c5de6b84844e2b3255c52992/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fframe.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fframe.ts?ref=51161b677bcb1ca4c5de6b84844e2b3255c52992",
            "patch": "@@ -86,8 +86,17 @@ const DOCUMENT_NOT_FOUND_ERROR = 'misc.document-notfound';\n // of the frame.  React dom errors already appear in the console, so onerror\n // does not need to pass them on to the default error handler.\n \n-export const createHeader = (id = mainPreviewId) => `\n+// The \"fcc-hide-header\" class on line 95 is added to ensure that the CSSHelper class ignores this style element\n+// during tests, preventing CSS-related test failures.\n+\n+export const createHeader = (id = mainPreviewId) =>\n+  `\n   <base href='' />\n+  <style class=\"fcc-hide-header\">\n+    head *, title, meta, link, script {\n+      display: none !important;\n+    }\n+  </style>\n   <script>\n     window.__frameId = '${id}';\n     window.onerror = function(msg) {"
        },
        {
            "sha": "ee8996afec66fb1392b4be3e1d4cbf0e5d9f4a05",
            "filename": "curriculum/challenges/english/01-responsive-web-design/applied-visual-design/adjust-the-height-of-an-element-using-the-height-property.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/51161b677bcb1ca4c5de6b84844e2b3255c52992/curriculum%2Fchallenges%2Fenglish%2F01-responsive-web-design%2Fapplied-visual-design%2Fadjust-the-height-of-an-element-using-the-height-property.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/51161b677bcb1ca4c5de6b84844e2b3255c52992/curriculum%2Fchallenges%2Fenglish%2F01-responsive-web-design%2Fapplied-visual-design%2Fadjust-the-height-of-an-element-using-the-height-property.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fchallenges%2Fenglish%2F01-responsive-web-design%2Fapplied-visual-design%2Fadjust-the-height-of-an-element-using-the-height-property.md?ref=51161b677bcb1ca4c5de6b84844e2b3255c52992",
            "patch": "@@ -28,7 +28,7 @@ Add a `height` property to the `h4` tag and set it to 25px.\n Your code should change the `h4` `height` property to a value of 25 pixels.\n \n ```js\n-const spaceFreeText = document.querySelector(\"style\")?.textContent?.replace(/\\s/g, ''); \n+const spaceFreeText = document.querySelector(\"style:not(.fcc-hide-header)\")?.textContent?.replace(/\\s/g, ''); \n const h4Element = document.querySelector('h4');\n assert.equal(Math.round(h4Element?.getBoundingClientRect()?.height),25);\n assert.match(spaceFreeText,/h4{\\S*height:25px(;\\S*}|})/);"
        },
        {
            "sha": "6a4e54eea9504f3eda5e5733a47b60b6634f280d",
            "filename": "curriculum/challenges/english/01-responsive-web-design/applied-visual-design/decrease-the-opacity-of-an-element.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/51161b677bcb1ca4c5de6b84844e2b3255c52992/curriculum%2Fchallenges%2Fenglish%2F01-responsive-web-design%2Fapplied-visual-design%2Fdecrease-the-opacity-of-an-element.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/51161b677bcb1ca4c5de6b84844e2b3255c52992/curriculum%2Fchallenges%2Fenglish%2F01-responsive-web-design%2Fapplied-visual-design%2Fdecrease-the-opacity-of-an-element.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fchallenges%2Fenglish%2F01-responsive-web-design%2Fapplied-visual-design%2Fdecrease-the-opacity-of-an-element.md?ref=51161b677bcb1ca4c5de6b84844e2b3255c52992",
            "patch": "@@ -25,7 +25,7 @@ Your code should set the `opacity` property to 0.7 on the anchor tags by selecti\n \n ```js\n assert.match(\n-  document.querySelector('style')?.textContent,\n+  document.querySelector(\"style:not(.fcc-hide-header)\")?.textContent,\n   /\\.links\\s*{([\\s\\S]*?;)*\\s*opacity\\s*:\\s*0*\\.70*\\s*(;[\\s\\S]*?|\\s*)}/\n   );\n ```"
        },
        {
            "sha": "df4f0ddcec6c6af5bbed85135901808003e08656",
            "filename": "curriculum/challenges/english/14-responsive-web-design-22/learn-basic-css-by-building-a-cafe-menu/5f3477ae9675db8bb7655b30.md",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/51161b677bcb1ca4c5de6b84844e2b3255c52992/curriculum%2Fchallenges%2Fenglish%2F14-responsive-web-design-22%2Flearn-basic-css-by-building-a-cafe-menu%2F5f3477ae9675db8bb7655b30.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/51161b677bcb1ca4c5de6b84844e2b3255c52992/curriculum%2Fchallenges%2Fenglish%2F14-responsive-web-design-22%2Flearn-basic-css-by-building-a-cafe-menu%2F5f3477ae9675db8bb7655b30.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fchallenges%2Fenglish%2F14-responsive-web-design-22%2Flearn-basic-css-by-building-a-cafe-menu%2F5f3477ae9675db8bb7655b30.md?ref=51161b677bcb1ca4c5de6b84844e2b3255c52992",
            "patch": "@@ -21,8 +21,7 @@ assert(hasH1);\n You should not add a new `style` tag. Add the new CSS rules to the existing `style` tag.\n \n ```js\n-const hasManyStyleTags = document.querySelectorAll('style').length > 1;\n-assert(!hasManyStyleTags);\n+assert.isAtMost(document.querySelectorAll('style').length, 2);\n ```\n \n You should add a new `h2` selector."
        },
        {
            "sha": "7a6b2fbfff601c8eb6cd2a7dbb334ad39de6e100",
            "filename": "curriculum/challenges/english/14-responsive-web-design-22/learn-html-by-building-a-cat-photo-app/5dc174fcf86c76b9248c6eb2.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/51161b677bcb1ca4c5de6b84844e2b3255c52992/curriculum%2Fchallenges%2Fenglish%2F14-responsive-web-design-22%2Flearn-html-by-building-a-cat-photo-app%2F5dc174fcf86c76b9248c6eb2.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/51161b677bcb1ca4c5de6b84844e2b3255c52992/curriculum%2Fchallenges%2Fenglish%2F14-responsive-web-design-22%2Flearn-html-by-building-a-cat-photo-app%2F5dc174fcf86c76b9248c6eb2.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fchallenges%2Fenglish%2F14-responsive-web-design-22%2Flearn-html-by-building-a-cat-photo-app%2F5dc174fcf86c76b9248c6eb2.md?ref=51161b677bcb1ca4c5de6b84844e2b3255c52992",
            "patch": "@@ -63,7 +63,7 @@ You appear to be using a browser extension that is modifying the page. Be sure t\n \n ```js\n assert.isAtMost(document.querySelectorAll('script').length, 2);\n-assert.equal(document.querySelectorAll('style').length, 0);\n+assert.equal(document.querySelectorAll('style').length, 1);\n assert.equal(document.querySelectorAll('link').length, 0);\n ```\n "
        },
        {
            "sha": "df4f0ddcec6c6af5bbed85135901808003e08656",
            "filename": "curriculum/challenges/english/25-front-end-development/workshop-cafe-menu/5f3477ae9675db8bb7655b30.md",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/51161b677bcb1ca4c5de6b84844e2b3255c52992/curriculum%2Fchallenges%2Fenglish%2F25-front-end-development%2Fworkshop-cafe-menu%2F5f3477ae9675db8bb7655b30.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/51161b677bcb1ca4c5de6b84844e2b3255c52992/curriculum%2Fchallenges%2Fenglish%2F25-front-end-development%2Fworkshop-cafe-menu%2F5f3477ae9675db8bb7655b30.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fchallenges%2Fenglish%2F25-front-end-development%2Fworkshop-cafe-menu%2F5f3477ae9675db8bb7655b30.md?ref=51161b677bcb1ca4c5de6b84844e2b3255c52992",
            "patch": "@@ -21,8 +21,7 @@ assert(hasH1);\n You should not add a new `style` tag. Add the new CSS rules to the existing `style` tag.\n \n ```js\n-const hasManyStyleTags = document.querySelectorAll('style').length > 1;\n-assert(!hasManyStyleTags);\n+assert.isAtMost(document.querySelectorAll('style').length, 2);\n ```\n \n You should add a new `h2` selector."
        },
        {
            "sha": "a6f7e1c1fb21088a8f1e50e7592db98a60fc2fd8",
            "filename": "curriculum/challenges/english/25-front-end-development/workshop-cat-photo-app/5dc174fcf86c76b9248c6eb2.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/51161b677bcb1ca4c5de6b84844e2b3255c52992/curriculum%2Fchallenges%2Fenglish%2F25-front-end-development%2Fworkshop-cat-photo-app%2F5dc174fcf86c76b9248c6eb2.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/51161b677bcb1ca4c5de6b84844e2b3255c52992/curriculum%2Fchallenges%2Fenglish%2F25-front-end-development%2Fworkshop-cat-photo-app%2F5dc174fcf86c76b9248c6eb2.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fchallenges%2Fenglish%2F25-front-end-development%2Fworkshop-cat-photo-app%2F5dc174fcf86c76b9248c6eb2.md?ref=51161b677bcb1ca4c5de6b84844e2b3255c52992",
            "patch": "@@ -51,7 +51,7 @@ You appear to be using a browser extension that is modifying the page. Be sure t\n \n ```js\n assert.isAtMost(document.querySelectorAll('script').length, 2);\n-assert.equal(document.querySelectorAll('style').length, 0);\n+assert.equal(document.querySelectorAll('style').length, 1);\n assert.equal(document.querySelectorAll('link').length, 0);\n ```\n "
        },
        {
            "sha": "0970f3c739a0223e3458c47ac792c6041e8b194c",
            "filename": "e2e/iframe-script.spec.ts",
            "status": "added",
            "additions": 43,
            "deletions": 0,
            "changes": 43,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/51161b677bcb1ca4c5de6b84844e2b3255c52992/e2e%2Fiframe-script.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/51161b677bcb1ca4c5de6b84844e2b3255c52992/e2e%2Fiframe-script.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fiframe-script.spec.ts?ref=51161b677bcb1ca4c5de6b84844e2b3255c52992",
            "patch": "@@ -0,0 +1,43 @@\n+import { expect, test } from '@playwright/test';\n+import translations from '../client/i18n/locales/english/translations.json';\n+import { focusEditor } from './utils/editor';\n+\n+test.beforeEach(async ({ page }) => {\n+  await page.goto(\n+    '/learn/javascript-algorithms-and-data-structures-v8/build-a-cash-register-project/build-a-cash-register'\n+  );\n+});\n+\n+test.describe('Preventing Script From Displaying in Preview', () => {\n+  // this test is for inserting problematic <style> tag and checking if the preview is empty\n+\n+  test('should render an empty preview after inserting CSS', async ({\n+    page,\n+    isMobile\n+  }) => {\n+    await focusEditor({ page, isMobile });\n+\n+    //  the pain in the butt <style> tag with display: block rule into the editor\n+    const styleTag = `\n+  <style>\n+  * {\n+    margin: 0;\n+    padding: 0;\n+    display: block;\n+  }\n+  </style>`;\n+    await page.keyboard.insertText(styleTag);\n+\n+    if (isMobile) {\n+      await page\n+        .getByRole('tab', { name: translations.learn['editor-tabs'].preview })\n+        .click();\n+    }\n+\n+    // Checks that the iframe preview is empty\n+    const frame = page.frameLocator('#fcc-main-frame').first();\n+\n+    // Make sure there are no visible elements inside the iframe's body\n+    await expect(frame.locator('body')).toBeEmpty();\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 68,
        "additions": 59,
        "deletions": 9
    }
}