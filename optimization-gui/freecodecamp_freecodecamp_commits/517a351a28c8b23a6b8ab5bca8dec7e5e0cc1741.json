{
    "author": "ojeytonwilliams",
    "message": "feat(api): send errors to Sentry (#55208)\n\nCo-authored-by: Shaun Hamilton <shauhami020@gmail.com>",
    "sha": "517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
    "files": [
        {
            "sha": "afdfac5f84d526e3525e268db71e0ac0dbd65ede",
            "filename": "api/src/app.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fapp.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fapp.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fapp.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -110,7 +110,7 @@ export const build = async (\n     dsn: SENTRY_DSN,\n     // No need to initialize if DSN is not provided (e.g. in development and\n     // test environments)\n-    skipInit: !!SENTRY_DSN,\n+    skipInit: !SENTRY_DSN,\n     errorResponse: (error, _request, reply) => {\n       if (reply.statusCode === 500) {\n         void reply.send({"
        },
        {
            "sha": "5e9a5f98c505ad386627026da3a6b1da9dc35a7e",
            "filename": "api/src/routes/certificate.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Froutes%2Fcertificate.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Froutes%2Fcertificate.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fcertificate.test.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -229,7 +229,7 @@ describe('certificate routes', () => {\n         });\n \n         expect(response.body).toStrictEqual({\n-          message: 'flash.went-wrong',\n+          message: 'flash.generic-error',\n           type: 'danger'\n         });\n         expect(response.status).toBe(500);"
        },
        {
            "sha": "ee98119a5b9dec6dc79178447b7171cd4469be46",
            "filename": "api/src/routes/certificate.ts",
            "status": "modified",
            "additions": 311,
            "deletions": 329,
            "changes": 640,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Froutes%2Fcertificate.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Froutes%2Fcertificate.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fcertificate.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -101,170 +101,162 @@ export const protectedCertificateRoutes: FastifyPluginCallbackTypebox = (\n       const certType = certSlugTypeMap[certSlug];\n       const certName = certTypeTitleMap[certType];\n \n-      try {\n-        const user = await fastify.prisma.user.findUnique({\n-          where: { id: req.user?.id }\n-        });\n+      const user = await fastify.prisma.user.findUnique({\n+        where: { id: req.user?.id }\n+      });\n \n-        if (!user) {\n-          void reply.code(500);\n-          return {\n-            type: 'danger',\n-            // message: 'User not found'\n-            message: 'flash.went-wrong'\n-          } as const;\n-        }\n-        const { completedChallenges } = user;\n-        const isCertMap = getUserIsCertMap(removeNulls(user));\n-\n-        // TODO: Discuss if this is a requirement still\n-        if (!user.name) {\n-          void reply.code(400);\n-          return {\n-            response: {\n-              type: 'info',\n-              message: 'flash.name-needed'\n-            },\n-            isCertMap,\n-            completedChallenges: normalizeChallenges(completedChallenges)\n-          } as const;\n-        }\n-\n-        if (user[certType]) {\n-          void reply.code(200);\n-          return {\n-            response: {\n-              type: 'info',\n-              message: 'flash.already-claimed',\n-              variables: {\n-                name: certName\n-              }\n-            },\n-            isCertMap,\n-            completedChallenges: normalizeChallenges(completedChallenges)\n-          } as const;\n-        }\n-\n-        const { id, tests, challengeType } = certTypeIds[certType];\n-        const hasCompletedTestRequirements = hasCompletedTests(\n-          tests,\n-          user.completedChallenges\n-        );\n+      if (!user) {\n+        void reply.code(500);\n+        fastify.log.error('User not found');\n+        fastify.Sentry.captureException(Error('User not found'));\n+        return {\n+          type: 'danger',\n+          // message: 'User not found'\n+          message: 'flash.went-wrong'\n+        } as const;\n+      }\n+      const { completedChallenges } = user;\n+      const isCertMap = getUserIsCertMap(removeNulls(user));\n \n-        if (!hasCompletedTestRequirements) {\n-          void reply.code(400);\n-          return {\n-            response: {\n-              type: 'info',\n-              message: 'flash.incomplete-steps',\n-              variables: {\n-                name: certName\n-              }\n-            },\n-            isCertMap,\n-            completedChallenges: normalizeChallenges(completedChallenges)\n-          } as const;\n-        }\n+      // TODO: Discuss if this is a requirement still\n+      if (!user.name) {\n+        void reply.code(400);\n+        return {\n+          response: {\n+            type: 'info',\n+            message: 'flash.name-needed'\n+          },\n+          isCertMap,\n+          completedChallenges: normalizeChallenges(completedChallenges)\n+        } as const;\n+      }\n \n-        const updatedUser = await fastify.prisma.user.update({\n-          where: { id: user.id },\n-          data: {\n-            [certType]: true,\n-            completedChallenges: {\n-              push: {\n-                id,\n-                completedDate: Date.now(),\n-                challengeType\n-              }\n+      if (user[certType]) {\n+        void reply.code(200);\n+        return {\n+          response: {\n+            type: 'info',\n+            message: 'flash.already-claimed',\n+            variables: {\n+              name: certName\n             }\n           },\n-          select: {\n-            username: true,\n-            email: true,\n-            name: true,\n-            completedChallenges: true,\n-            is2018DataVisCert: true,\n-            is2018FullStackCert: true,\n-            isApisMicroservicesCert: true,\n-            isBackEndCert: true,\n-            isDataVisCert: true,\n-            isCollegeAlgebraPyCertV8: true,\n-            isDataAnalysisPyCertV7: true,\n-            isFoundationalCSharpCertV8: true,\n-            isFrontEndCert: true,\n-            isFrontEndLibsCert: true,\n-            isFullStackCert: true,\n-            isInfosecCertV7: true,\n-            isInfosecQaCert: true,\n-            isJsAlgoDataStructCert: true,\n-            isJsAlgoDataStructCertV8: true,\n-            isMachineLearningPyCertV7: true,\n-            isQaCertV7: true,\n-            isRelationalDatabaseCertV8: true,\n-            isRespWebDesignCert: true,\n-            isSciCompPyCertV7: true,\n-            isUpcomingPythonCertV8: true\n-          }\n-        });\n+          isCertMap,\n+          completedChallenges: normalizeChallenges(completedChallenges)\n+        } as const;\n+      }\n \n-        const updatedUserSansNull = removeNulls(updatedUser);\n-\n-        const updatedIsCertMap = getUserIsCertMap(updatedUserSansNull);\n-\n-        // TODO(POST-MVP): Consider sending email based on `user.isEmailVerified` as well\n-        const hasCompletedAllCerts = currentCertifications\n-          .map(x => certSlugTypeMap[x])\n-          .every(certType => updatedIsCertMap[certType]);\n-        const shouldSendCertifiedEmailToCamper =\n-          isEmail(updatedUser.email) && hasCompletedAllCerts;\n-\n-        if (shouldSendCertifiedEmailToCamper) {\n-          const notifyUser = {\n-            to: updatedUser.email,\n-            from: 'quincy@freecodecamp.org',\n-            subject:\n-              'Congratulations on completing all of the freeCodeCamp certifications!',\n-            text: renderCertifiedEmail({\n-              username: updatedUser.username,\n-              // Safety: `user.name` is required to exist earlier. TODO: Assert\n-              name: updatedUser.name as string\n-            })\n-          };\n-\n-          // Failed email should not prevent successful response.\n-          try {\n-            // TODO(POST-MVP): Ensure Camper knows they **have** claimed the cert, but the email failed to send.\n-            await fastify.sendEmail(notifyUser);\n-          } catch (e) {\n-            fastify.log.error(e);\n-            // TODO: Log to Sentry\n-          }\n-        }\n+      const { id, tests, challengeType } = certTypeIds[certType];\n+      const hasCompletedTestRequirements = hasCompletedTests(\n+        tests,\n+        user.completedChallenges\n+      );\n \n-        void reply.code(200);\n+      if (!hasCompletedTestRequirements) {\n+        void reply.code(400);\n         return {\n           response: {\n-            type: 'success',\n-            message: 'flash.cert-claim-success',\n+            type: 'info',\n+            message: 'flash.incomplete-steps',\n             variables: {\n-              username: updatedUser.username,\n               name: certName\n             }\n           },\n-          isCertMap: updatedIsCertMap,\n-          completedChallenges: normalizeChallenges(\n-            updatedUserSansNull.completedChallenges\n-          )\n-        } as const;\n-      } catch (e) {\n-        fastify.log.error(e);\n-        void reply.code(500);\n-        throw {\n-          type: 'danger',\n-          // message: 'Oops! Something went wrong. Please try again in a moment or contact\n-          message: 'flash.went-wrong'\n+          isCertMap,\n+          completedChallenges: normalizeChallenges(completedChallenges)\n         } as const;\n       }\n+\n+      const updatedUser = await fastify.prisma.user.update({\n+        where: { id: user.id },\n+        data: {\n+          [certType]: true,\n+          completedChallenges: {\n+            push: {\n+              id,\n+              completedDate: Date.now(),\n+              challengeType\n+            }\n+          }\n+        },\n+        select: {\n+          username: true,\n+          email: true,\n+          name: true,\n+          completedChallenges: true,\n+          is2018DataVisCert: true,\n+          is2018FullStackCert: true,\n+          isApisMicroservicesCert: true,\n+          isBackEndCert: true,\n+          isDataVisCert: true,\n+          isCollegeAlgebraPyCertV8: true,\n+          isDataAnalysisPyCertV7: true,\n+          isFoundationalCSharpCertV8: true,\n+          isFrontEndCert: true,\n+          isFrontEndLibsCert: true,\n+          isFullStackCert: true,\n+          isInfosecCertV7: true,\n+          isInfosecQaCert: true,\n+          isJsAlgoDataStructCert: true,\n+          isJsAlgoDataStructCertV8: true,\n+          isMachineLearningPyCertV7: true,\n+          isQaCertV7: true,\n+          isRelationalDatabaseCertV8: true,\n+          isRespWebDesignCert: true,\n+          isSciCompPyCertV7: true,\n+          isUpcomingPythonCertV8: true\n+        }\n+      });\n+\n+      const updatedUserSansNull = removeNulls(updatedUser);\n+\n+      const updatedIsCertMap = getUserIsCertMap(updatedUserSansNull);\n+\n+      // TODO(POST-MVP): Consider sending email based on `user.isEmailVerified` as well\n+      const hasCompletedAllCerts = currentCertifications\n+        .map(x => certSlugTypeMap[x])\n+        .every(certType => updatedIsCertMap[certType]);\n+      const shouldSendCertifiedEmailToCamper =\n+        isEmail(updatedUser.email) && hasCompletedAllCerts;\n+\n+      if (shouldSendCertifiedEmailToCamper) {\n+        const notifyUser = {\n+          to: updatedUser.email,\n+          from: 'quincy@freecodecamp.org',\n+          subject:\n+            'Congratulations on completing all of the freeCodeCamp certifications!',\n+          text: renderCertifiedEmail({\n+            username: updatedUser.username,\n+            // Safety: `user.name` is required to exist earlier. TODO: Assert\n+            name: updatedUser.name as string\n+          })\n+        };\n+\n+        // Failed email should not prevent successful response.\n+        try {\n+          // TODO(POST-MVP): Ensure Camper knows they **have** claimed the cert, but the email failed to send.\n+          await fastify.sendEmail(notifyUser);\n+        } catch (e) {\n+          fastify.log.error(e);\n+          // TODO: Log to Sentry\n+        }\n+      }\n+\n+      void reply.code(200);\n+      return {\n+        response: {\n+          type: 'success',\n+          message: 'flash.cert-claim-success',\n+          variables: {\n+            username: updatedUser.username,\n+            name: certName\n+          }\n+        },\n+        isCertMap: updatedIsCertMap,\n+        completedChallenges: normalizeChallenges(\n+          updatedUserSansNull.completedChallenges\n+        )\n+      } as const;\n     }\n   );\n \n@@ -289,215 +281,205 @@ export const unprotectedCertificateRoutes: FastifyPluginCallbackTypebox = (\n       schema: schemas.certSlug\n     },\n     async (req, reply) => {\n-      try {\n-        const username = req.params.username.toLowerCase();\n-        const certSlug = req.params.certSlug;\n-\n-        fastify.log.info(`certSlug: ${certSlug}`);\n-\n-        if (!isKnownCertSlug(certSlug)) {\n-          void reply.code(404);\n-          return reply.send({\n-            messages: [\n-              {\n-                type: 'info',\n-                message: 'flash.cert-not-found',\n-                variables: { certSlug }\n-              }\n-            ]\n-          });\n-        }\n+      const username = req.params.username.toLowerCase();\n+      const certSlug = req.params.certSlug;\n \n-        const certType = certSlugTypeMap[certSlug];\n-        const certId = certTypeIdMap[certType];\n-        const certTitle = certTypeTitleMap[certType];\n-        const completionTime = completionHours[certType] || 300;\n-        const user = await fastify.prisma.user.findFirst({\n-          where: { username },\n-          select: {\n-            isBanned: true,\n-            isCheater: true,\n-            isFrontEndCert: true,\n-            isBackEndCert: true,\n-            isFullStackCert: true,\n-            isRespWebDesignCert: true,\n-            isFrontEndLibsCert: true,\n-            isJsAlgoDataStructCert: true,\n-            isJsAlgoDataStructCertV8: true,\n-            isDataVisCert: true,\n-            is2018DataVisCert: true,\n-            isApisMicroservicesCert: true,\n-            isInfosecQaCert: true,\n-            isQaCertV7: true,\n-            isInfosecCertV7: true,\n-            isSciCompPyCertV7: true,\n-            isDataAnalysisPyCertV7: true,\n-            isMachineLearningPyCertV7: true,\n-            isRelationalDatabaseCertV8: true,\n-            isCollegeAlgebraPyCertV8: true,\n-            isFoundationalCSharpCertV8: true,\n-            isUpcomingPythonCertV8: true,\n-            isHonest: true,\n-            username: true,\n-            name: true,\n-            completedChallenges: true,\n-            profileUI: true\n-          }\n+      fastify.log.info(`certSlug: ${certSlug}`);\n+\n+      if (!isKnownCertSlug(certSlug)) {\n+        void reply.code(404);\n+        return reply.send({\n+          messages: [\n+            {\n+              type: 'info',\n+              message: 'flash.cert-not-found',\n+              variables: { certSlug }\n+            }\n+          ]\n         });\n+      }\n \n-        if (user === null) {\n-          return reply.send({\n-            messages: [\n-              {\n-                type: 'info',\n-                message: 'flash.username-not-found',\n-                variables: { username }\n-              }\n-            ]\n-          });\n+      const certType = certSlugTypeMap[certSlug];\n+      const certId = certTypeIdMap[certType];\n+      const certTitle = certTypeTitleMap[certType];\n+      const completionTime = completionHours[certType] || 300;\n+      const user = await fastify.prisma.user.findFirst({\n+        where: { username },\n+        select: {\n+          isBanned: true,\n+          isCheater: true,\n+          isFrontEndCert: true,\n+          isBackEndCert: true,\n+          isFullStackCert: true,\n+          isRespWebDesignCert: true,\n+          isFrontEndLibsCert: true,\n+          isJsAlgoDataStructCert: true,\n+          isJsAlgoDataStructCertV8: true,\n+          isDataVisCert: true,\n+          is2018DataVisCert: true,\n+          isApisMicroservicesCert: true,\n+          isInfosecQaCert: true,\n+          isQaCertV7: true,\n+          isInfosecCertV7: true,\n+          isSciCompPyCertV7: true,\n+          isDataAnalysisPyCertV7: true,\n+          isMachineLearningPyCertV7: true,\n+          isRelationalDatabaseCertV8: true,\n+          isCollegeAlgebraPyCertV8: true,\n+          isFoundationalCSharpCertV8: true,\n+          isUpcomingPythonCertV8: true,\n+          isHonest: true,\n+          username: true,\n+          name: true,\n+          completedChallenges: true,\n+          profileUI: true\n         }\n+      });\n \n-        if (user.isCheater || user.isBanned) {\n-          return reply.send({\n-            messages: [\n-              {\n-                type: 'info',\n-                message: 'flash.not-eligible'\n-              }\n-            ]\n-          });\n-        }\n+      if (user === null) {\n+        return reply.send({\n+          messages: [\n+            {\n+              type: 'info',\n+              message: 'flash.username-not-found',\n+              variables: { username }\n+            }\n+          ]\n+        });\n+      }\n \n-        if (!user.isHonest) {\n-          return reply.send({\n-            messages: [\n-              {\n-                type: 'info',\n-                message: 'flash.not-honest',\n-                variables: { username }\n-              }\n-            ]\n-          });\n-        }\n+      if (user.isCheater || user.isBanned) {\n+        return reply.send({\n+          messages: [\n+            {\n+              type: 'info',\n+              message: 'flash.not-eligible'\n+            }\n+          ]\n+        });\n+      }\n \n-        if (user.profileUI?.isLocked) {\n-          return reply.send({\n-            messages: [\n-              {\n-                type: 'info',\n-                message: 'flash.profile-private',\n-                variables: { username }\n-              }\n-            ]\n-          });\n-        }\n+      if (!user.isHonest) {\n+        return reply.send({\n+          messages: [\n+            {\n+              type: 'info',\n+              message: 'flash.not-honest',\n+              variables: { username }\n+            }\n+          ]\n+        });\n+      }\n \n-        if (!user.name) {\n-          return reply.send({\n-            messages: [\n-              {\n-                type: 'info',\n-                message: 'flash.add-name'\n-              }\n-            ]\n-          });\n-        }\n+      if (user.profileUI?.isLocked) {\n+        return reply.send({\n+          messages: [\n+            {\n+              type: 'info',\n+              message: 'flash.profile-private',\n+              variables: { username }\n+            }\n+          ]\n+        });\n+      }\n \n-        if (!user.profileUI?.showCerts) {\n-          return reply.send({\n-            messages: [\n-              {\n-                type: 'info',\n-                message: 'flash.certs-private',\n-                variables: { username }\n-              }\n-            ]\n-          });\n-        }\n+      if (!user.name) {\n+        return reply.send({\n+          messages: [\n+            {\n+              type: 'info',\n+              message: 'flash.add-name'\n+            }\n+          ]\n+        });\n+      }\n \n-        if (!user.profileUI?.showTimeLine) {\n-          return reply.send({\n-            messages: [\n-              {\n-                type: 'info',\n-                message: 'flash.timeline-private',\n-                variables: { username }\n-              }\n-            ]\n-          });\n-        }\n+      if (!user.profileUI?.showCerts) {\n+        return reply.send({\n+          messages: [\n+            {\n+              type: 'info',\n+              message: 'flash.certs-private',\n+              variables: { username }\n+            }\n+          ]\n+        });\n+      }\n \n-        if (!user[certType]) {\n-          return reply.send({\n-            messages: [\n-              {\n-                type: 'info',\n-                message: 'flash.user-not-certified',\n-                variables: { username, cert: certTypeTitleMap[certType] }\n-              }\n-            ]\n-          });\n-        }\n+      if (!user.profileUI?.showTimeLine) {\n+        return reply.send({\n+          messages: [\n+            {\n+              type: 'info',\n+              message: 'flash.timeline-private',\n+              variables: { username }\n+            }\n+          ]\n+        });\n+      }\n \n-        const { completedChallenges } = user;\n-        const certChallenge = find(\n-          completedChallenges,\n-          ({ id }) => certId === id\n-        );\n+      if (!user[certType]) {\n+        return reply.send({\n+          messages: [\n+            {\n+              type: 'info',\n+              message: 'flash.user-not-certified',\n+              variables: { username, cert: certTypeTitleMap[certType] }\n+            }\n+          ]\n+        });\n+      }\n \n-        let { completedDate = Date.now() } = certChallenge || {};\n+      const { completedChallenges } = user;\n+      const certChallenge = find(\n+        completedChallenges,\n+        ({ id }) => certId === id\n+      );\n \n-        // the challenge id has been rotated for isDataVisCert\n-        if (certType === 'isDataVisCert' && !certChallenge) {\n-          const oldDataVisIdChall = find(\n-            completedChallenges,\n-            ({ id }) => oldDataVizId === id\n-          );\n+      let { completedDate = Date.now() } = certChallenge || {};\n \n-          if (oldDataVisIdChall) {\n-            completedDate = oldDataVisIdChall.completedDate || completedDate;\n-          }\n-        }\n+      // the challenge id has been rotated for isDataVisCert\n+      if (certType === 'isDataVisCert' && !certChallenge) {\n+        const oldDataVisIdChall = find(\n+          completedChallenges,\n+          ({ id }) => oldDataVizId === id\n+        );\n \n-        // if fullcert is not found, return the latest completedDate\n-        if (certType === 'isFullStackCert' && !certChallenge) {\n-          completedDate = getFallbackFullStackDate(\n-            completedChallenges,\n-            completedDate\n-          );\n+        if (oldDataVisIdChall) {\n+          completedDate = oldDataVisIdChall.completedDate || completedDate;\n         }\n+      }\n \n-        const { name } = user;\n+      // if fullcert is not found, return the latest completedDate\n+      if (certType === 'isFullStackCert' && !certChallenge) {\n+        completedDate = getFallbackFullStackDate(\n+          completedChallenges,\n+          completedDate\n+        );\n+      }\n \n-        if (!user.profileUI.showName) {\n-          void reply.code(200);\n-          return reply.send({\n-            certSlug,\n-            certTitle,\n-            username,\n-            date: completedDate,\n-            completionTime\n-          });\n-        }\n+      const { name } = user;\n \n+      if (!user.profileUI.showName) {\n         void reply.code(200);\n         return reply.send({\n           certSlug,\n           certTitle,\n           username,\n-          name,\n           date: completedDate,\n           completionTime\n         });\n-      } catch (err) {\n-        fastify.log.error(err);\n-        void reply.code(500);\n-        return reply.send({\n-          message:\n-            'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.',\n-          type: 'danger'\n-        });\n       }\n+\n+      void reply.code(200);\n+      return reply.send({\n+        certSlug,\n+        certTitle,\n+        username,\n+        name,\n+        date: completedDate,\n+        completionTime\n+      });\n     }\n   );\n "
        },
        {
            "sha": "3ad7a31c0bb79e7d405e1198aecf7319933cac94",
            "filename": "api/src/routes/challenge.ts",
            "status": "modified",
            "additions": 188,
            "deletions": 233,
            "changes": 421,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Froutes%2Fchallenge.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Froutes%2Fchallenge.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fchallenge.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -166,6 +166,7 @@ export const challengeRoutes: FastifyPluginCallbackTypebox = (\n           });\n         }\n       } catch {\n+        // TODO(Post-MVP): don't catch, just let Sentry handle this.\n         void reply.code(400);\n         return {\n           type: 'error',\n@@ -215,74 +216,62 @@ export const challengeRoutes: FastifyPluginCallbackTypebox = (\n         });\n       }\n \n-      try {\n-        const user = await fastify.prisma.user.findUniqueOrThrow({\n-          where: { id: userId },\n-          select: {\n-            completedChallenges: true,\n-            partiallyCompletedChallenges: true,\n-            progressTimestamps: true\n-          }\n-        });\n-\n-        if (\n-          challengeType === challengeTypes.codeAllyCert &&\n-          !canSubmitCodeRoadCertProject(projectId, user)\n-        ) {\n-          void reply.code(403);\n-          return {\n-            type: 'error',\n-            message:\n-              'You have to complete the project before you can submit a URL.'\n-          } as const;\n+      const user = await fastify.prisma.user.findUniqueOrThrow({\n+        where: { id: userId },\n+        select: {\n+          completedChallenges: true,\n+          partiallyCompletedChallenges: true,\n+          progressTimestamps: true\n         }\n+      });\n \n-        const completedDate = Date.now();\n-        const oldChallenge = user.completedChallenges?.find(\n-          ({ id }) => id === projectId\n-        );\n-\n-        const updatedChallenge = {\n-          challengeType,\n-          solution,\n-          githubLink\n-        };\n-        const newChallenge = {\n-          ...updatedChallenge,\n-          id: projectId,\n-          completedDate\n-        };\n-        const alreadyCompleted = !!oldChallenge;\n-        const progressTimestamps =\n-          user.progressTimestamps as ProgressTimestamp[];\n-        const points = getPoints(progressTimestamps);\n-\n-        const data = alreadyCompleted\n-          ? updateProject(projectId, updatedChallenge)\n-          : createProject(projectId, newChallenge, progressTimestamps);\n-\n-        await fastify.prisma.user.update({\n-          where: { id: userId },\n-          data\n-        });\n-\n-        return {\n-          alreadyCompleted,\n-          // TODO(Post-MVP): audit the client and remove this if the client does\n-          // not use it.\n-          completedDate,\n-          points: alreadyCompleted ? points : points + 1\n-        };\n-      } catch (err) {\n-        // TODO: send to Sentry\n-        fastify.log.error(err);\n-        void reply.code(500);\n+      if (\n+        challengeType === challengeTypes.codeAllyCert &&\n+        !canSubmitCodeRoadCertProject(projectId, user)\n+      ) {\n+        void reply.code(403);\n         return {\n+          type: 'error',\n           message:\n-            'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.',\n-          type: 'danger'\n+            'You have to complete the project before you can submit a URL.'\n         } as const;\n       }\n+\n+      const completedDate = Date.now();\n+      const oldChallenge = user.completedChallenges?.find(\n+        ({ id }) => id === projectId\n+      );\n+\n+      const updatedChallenge = {\n+        challengeType,\n+        solution,\n+        githubLink\n+      };\n+      const newChallenge = {\n+        ...updatedChallenge,\n+        id: projectId,\n+        completedDate\n+      };\n+      const alreadyCompleted = !!oldChallenge;\n+      const progressTimestamps = user.progressTimestamps as ProgressTimestamp[];\n+      const points = getPoints(progressTimestamps);\n+\n+      const data = alreadyCompleted\n+        ? updateProject(projectId, updatedChallenge)\n+        : createProject(projectId, newChallenge, progressTimestamps);\n+\n+      await fastify.prisma.user.update({\n+        where: { id: userId },\n+        data\n+      });\n+\n+      return {\n+        alreadyCompleted,\n+        // TODO(Post-MVP): audit the client and remove this if the client does\n+        // not use it.\n+        completedDate,\n+        points: alreadyCompleted ? points : points + 1\n+      };\n     }\n   );\n \n@@ -299,42 +288,32 @@ export const challengeRoutes: FastifyPluginCallbackTypebox = (\n         }\n       }\n     },\n-    async (req, reply) => {\n-      try {\n-        const user = await fastify.prisma.user.findUniqueOrThrow({\n-          where: { id: req.user?.id }\n-        });\n-        const progressTimestamps = user.progressTimestamps as\n-          | ProgressTimestamp[]\n-          | null;\n-        const points = getPoints(progressTimestamps);\n-\n-        const completedChallenge = {\n-          completedDate: Date.now(),\n-          ...req.body\n-        };\n-\n-        const { alreadyCompleted } = await updateUserChallengeData(\n-          fastify,\n-          user,\n-          req.body.id,\n-          completedChallenge\n-        );\n+    async req => {\n+      const user = await fastify.prisma.user.findUniqueOrThrow({\n+        where: { id: req.user?.id }\n+      });\n+      const progressTimestamps = user.progressTimestamps as\n+        | ProgressTimestamp[]\n+        | null;\n+      const points = getPoints(progressTimestamps);\n+\n+      const completedChallenge = {\n+        completedDate: Date.now(),\n+        ...req.body\n+      };\n+\n+      const { alreadyCompleted } = await updateUserChallengeData(\n+        fastify,\n+        user,\n+        req.body.id,\n+        completedChallenge\n+      );\n \n-        return {\n-          alreadyCompleted,\n-          points: alreadyCompleted ? points : points + 1,\n-          completedDate: completedChallenge.completedDate\n-        };\n-      } catch (error) {\n-        fastify.log.error(error);\n-        void reply.code(500);\n-        return {\n-          message:\n-            'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.',\n-          type: 'danger'\n-        } as const;\n-      }\n+      return {\n+        alreadyCompleted,\n+        points: alreadyCompleted ? points : points + 1,\n+        completedDate: completedChallenge.completedDate\n+      };\n     }\n   );\n \n@@ -351,55 +330,45 @@ export const challengeRoutes: FastifyPluginCallbackTypebox = (\n         }\n       }\n     },\n-    async (req, reply) => {\n-      try {\n-        const { id, files, challengeType } = req.body;\n-\n-        const user = await fastify.prisma.user.findUniqueOrThrow({\n-          where: { id: req.user?.id }\n-        });\n-        const RawProgressTimestamp = user.progressTimestamps as\n-          | ProgressTimestamp[]\n-          | null;\n-        const points = getPoints(RawProgressTimestamp);\n+    async req => {\n+      const { id, files, challengeType } = req.body;\n \n-        const completedChallenge: CompletedChallenge = {\n-          id,\n-          files,\n-          completedDate: Date.now()\n-        };\n-\n-        if (challengeType === challengeTypes.multifileCertProject) {\n-          completedChallenge.isManuallyApproved = false;\n-          user.needsModeration = true;\n-        }\n+      const user = await fastify.prisma.user.findUniqueOrThrow({\n+        where: { id: req.user?.id }\n+      });\n+      const RawProgressTimestamp = user.progressTimestamps as\n+        | ProgressTimestamp[]\n+        | null;\n+      const points = getPoints(RawProgressTimestamp);\n+\n+      const completedChallenge: CompletedChallenge = {\n+        id,\n+        files,\n+        completedDate: Date.now()\n+      };\n+\n+      if (challengeType === challengeTypes.multifileCertProject) {\n+        completedChallenge.isManuallyApproved = false;\n+        user.needsModeration = true;\n+      }\n \n-        if (\n-          jsCertProjectIds.includes(id) ||\n-          multifileCertProjectIds.includes(id) ||\n-          multifilePythonCertProjectIds.includes(id)\n-        ) {\n-          completedChallenge.challengeType = challengeType;\n-        }\n+      if (\n+        jsCertProjectIds.includes(id) ||\n+        multifileCertProjectIds.includes(id) ||\n+        multifilePythonCertProjectIds.includes(id)\n+      ) {\n+        completedChallenge.challengeType = challengeType;\n+      }\n \n-        const { alreadyCompleted, userSavedChallenges: savedChallenges } =\n-          await updateUserChallengeData(fastify, user, id, completedChallenge);\n+      const { alreadyCompleted, userSavedChallenges: savedChallenges } =\n+        await updateUserChallengeData(fastify, user, id, completedChallenge);\n \n-        return {\n-          alreadyCompleted,\n-          points: alreadyCompleted ? points : points + 1,\n-          completedDate: completedChallenge.completedDate,\n-          savedChallenges\n-        };\n-      } catch (error) {\n-        fastify.log.error(error);\n-        void reply.code(500);\n-        return {\n-          message:\n-            'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.',\n-          type: 'danger'\n-        } as const;\n-      }\n+      return {\n+        alreadyCompleted,\n+        points: alreadyCompleted ? points : points + 1,\n+        completedDate: completedChallenge.completedDate,\n+        savedChallenges\n+      };\n     }\n   );\n \n@@ -417,47 +386,37 @@ export const challengeRoutes: FastifyPluginCallbackTypebox = (\n       }\n     },\n     async (req, reply) => {\n-      try {\n-        const { files, id: challengeId } = req.body;\n-        const user = await fastify.prisma.user.findUniqueOrThrow({\n-          where: { id: req.user?.id }\n-        });\n-        const challenge = {\n-          id: challengeId,\n-          files\n-        };\n-\n-        if (\n-          !multifileCertProjectIds.includes(challengeId) &&\n-          !multifilePythonCertProjectIds.includes(challengeId)\n-        ) {\n-          void reply.code(403);\n-          return 'That challenge type is not saveable.';\n-        }\n+      const { files, id: challengeId } = req.body;\n+      const user = await fastify.prisma.user.findUniqueOrThrow({\n+        where: { id: req.user?.id }\n+      });\n+      const challenge = {\n+        id: challengeId,\n+        files\n+      };\n+\n+      if (\n+        !multifileCertProjectIds.includes(challengeId) &&\n+        !multifilePythonCertProjectIds.includes(challengeId)\n+      ) {\n+        void reply.code(403);\n+        return 'That challenge type is not saveable.';\n+      }\n \n-        const userSavedChallenges = saveUserChallengeData(\n-          challengeId,\n-          user.savedChallenges,\n-          challenge\n-        );\n+      const userSavedChallenges = saveUserChallengeData(\n+        challengeId,\n+        user.savedChallenges,\n+        challenge\n+      );\n \n-        await fastify.prisma.user.update({\n-          where: { id: user.id },\n-          data: {\n-            savedChallenges: userSavedChallenges\n-          }\n-        });\n+      await fastify.prisma.user.update({\n+        where: { id: user.id },\n+        data: {\n+          savedChallenges: userSavedChallenges\n+        }\n+      });\n \n-        return { savedChallenges: userSavedChallenges };\n-      } catch (error) {\n-        fastify.log.error(error);\n-        void reply.code(500);\n-        return {\n-          message:\n-            'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.',\n-          type: 'danger'\n-        } as const;\n-      }\n+      return { savedChallenges: userSavedChallenges };\n     }\n   );\n \n@@ -475,72 +434,66 @@ export const challengeRoutes: FastifyPluginCallbackTypebox = (\n       }\n     },\n     async (req, reply) => {\n-      try {\n-        const { id } = req.params;\n-\n-        const { completedChallenges } =\n-          await fastify.prisma.user.findUniqueOrThrow({\n-            where: { id: req.user?.id },\n-            select: { completedChallenges: true }\n-          });\n+      const { id } = req.params;\n \n-        const examFromDb = await fastify.prisma.exam.findUnique({\n-          where: { id }\n+      const { completedChallenges } =\n+        await fastify.prisma.user.findUniqueOrThrow({\n+          where: { id: req.user?.id },\n+          select: { completedChallenges: true }\n         });\n \n-        if (!examFromDb) {\n-          void reply.code(500);\n-          return {\n-            error: 'An error occurred trying to get the exam from the database.'\n-          };\n-        }\n-\n-        const validExamFromDbSchema = validateExamFromDbSchema(examFromDb);\n-\n-        if ('error' in validExamFromDbSchema) {\n-          void reply.code(500);\n-          return {\n-            error:\n-              'An error occurred validating the exam information from the database.'\n-          };\n-        }\n+      const examFromDb = await fastify.prisma.exam.findUnique({\n+        where: { id }\n+      });\n \n-        const { prerequisites, numberOfQuestionsInExam, title } = examFromDb;\n+      if (!examFromDb) {\n+        void reply.code(500);\n+        return {\n+          error: 'An error occurred trying to get the exam from the database.'\n+        };\n+      }\n \n-        // Validate User has completed prerequisite challenges\n-        const prerequisiteIds = prerequisites.map(p => p.id);\n-        const completedPrerequisites = completedChallenges.filter(c =>\n-          prerequisiteIds.includes(c.id)\n-        );\n+      const validExamFromDbSchema = validateExamFromDbSchema(examFromDb);\n \n-        if (completedPrerequisites.length !== prerequisiteIds.length) {\n-          void reply.code(403);\n-          return {\n-            error: `You have not completed the required challenges to start the '${title}'.`\n-          };\n-        }\n+      if ('error' in validExamFromDbSchema) {\n+        void reply.code(500);\n+        return {\n+          error:\n+            'An error occurred validating the exam information from the database.'\n+        };\n+      }\n \n-        const randomizedExam = generateRandomExam(examFromDb);\n-        const validGeneratedExamSchema = validateGeneratedExamSchema(\n-          randomizedExam,\n-          numberOfQuestionsInExam\n-        );\n+      const { prerequisites, numberOfQuestionsInExam, title } = examFromDb;\n \n-        if ('error' in validGeneratedExamSchema) {\n-          void reply.code(500);\n-          return { error: 'An error occurred trying to randomize the exam.' };\n-        }\n+      // Validate User has completed prerequisite challenges\n+      const prerequisiteIds = prerequisites.map(p => p.id);\n+      const completedPrerequisites = completedChallenges.filter(c =>\n+        prerequisiteIds.includes(c.id)\n+      );\n \n+      if (completedPrerequisites.length !== prerequisiteIds.length) {\n+        void reply.code(403);\n         return {\n-          generatedExam: randomizedExam\n+          error: `You have not completed the required challenges to start the '${title}'.`\n         };\n-      } catch (error) {\n-        fastify.log.error(error);\n+      }\n+\n+      const randomizedExam = generateRandomExam(examFromDb);\n+      const validGeneratedExamSchema = validateGeneratedExamSchema(\n+        randomizedExam,\n+        numberOfQuestionsInExam\n+      );\n+\n+      if (validGeneratedExamSchema.error) {\n+        fastify.log.error(validGeneratedExamSchema.error);\n+        fastify.Sentry.captureException(validGeneratedExamSchema.error);\n         void reply.code(500);\n-        return {\n-          error: 'Something went wrong trying to generate your exam.'\n-        };\n+        return { error: 'An error occurred trying to randomize the exam.' };\n       }\n+\n+      return {\n+        generatedExam: randomizedExam\n+      };\n     }\n   );\n \n@@ -634,6 +587,7 @@ export const challengeRoutes: FastifyPluginCallbackTypebox = (\n         };\n       } catch (error) {\n         fastify.log.error(error);\n+        fastify.Sentry.captureException(error);\n         void reply.code(500);\n         return {\n           type: 'error',\n@@ -830,6 +784,7 @@ export const challengeRoutes: FastifyPluginCallbackTypebox = (\n         };\n       } catch (error) {\n         fastify.log.error(error);\n+        fastify.Sentry.captureException(error);\n         void reply.code(500);\n         return {\n           error: 'An error occurred trying to submit your exam.'"
        },
        {
            "sha": "1b734f86339acc16283482b0d2f6a5e9eb8da65d",
            "filename": "api/src/routes/email-subscription.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Froutes%2Femail-subscription.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Froutes%2Femail-subscription.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Femail-subscription.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -68,6 +68,7 @@ export const emailSubscribtionRoutes: FastifyPluginCallbackTypebox = (\n         );\n       } catch (error) {\n         fastify.log.error(error);\n+        fastify.Sentry.captureException(error);\n         void reply.code(302);\n         return reply.redirectWithMessage(origin, {\n           type: 'danger',\n@@ -125,6 +126,7 @@ export const emailSubscribtionRoutes: FastifyPluginCallbackTypebox = (\n         });\n       } catch (error) {\n         fastify.log.error(error);\n+        fastify.Sentry.captureException(error);\n         void reply.code(302);\n         return reply.redirectWithMessage(origin, {\n           type: 'danger',"
        },
        {
            "sha": "07a7ebcb1e6c7f3755537faf13d65e99dd35eeb0",
            "filename": "api/src/routes/settings.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Froutes%2Fsettings.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Froutes%2Fsettings.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fsettings.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -147,8 +147,8 @@ export const settingRoutes: FastifyPluginCallbackTypebox = (\n           type: 'success'\n         } as const;\n       } catch (err) {\n-        // TODO: send to Sentry\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         return { message: 'flash.wrong-updating', type: 'danger' } as const;\n       }\n@@ -288,6 +288,7 @@ ${isLinkSentWithinLimitTTL}`\n         });\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         await reply.send({ message: 'flash.wrong-updating', type: 'danger' });\n       }\n@@ -315,6 +316,7 @@ ${isLinkSentWithinLimitTTL}`\n         } as const;\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         return { message: 'flash.wrong-updating', type: 'danger' } as const;\n       }\n@@ -345,6 +347,7 @@ ${isLinkSentWithinLimitTTL}`\n         } as const;\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         return { message: 'flash.wrong-updating', type: 'danger' } as const;\n       }\n@@ -430,6 +433,7 @@ ${isLinkSentWithinLimitTTL}`\n         });\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         await reply.send({ message: 'flash.wrong-updating', type: 'danger' });\n       }\n@@ -460,6 +464,7 @@ ${isLinkSentWithinLimitTTL}`\n         } as const;\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         return { message: 'flash.wrong-updating', type: 'danger' } as const;\n       }\n@@ -487,6 +492,7 @@ ${isLinkSentWithinLimitTTL}`\n         } as const;\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         return { message: 'flash.wrong-updating', type: 'danger' } as const;\n       }\n@@ -514,6 +520,7 @@ ${isLinkSentWithinLimitTTL}`\n         } as const;\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         return { message: 'flash.wrong-updating', type: 'danger' } as const;\n       }\n@@ -541,6 +548,7 @@ ${isLinkSentWithinLimitTTL}`\n         } as const;\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         return { message: 'flash.wrong-updating', type: 'danger' } as const;\n       }\n@@ -569,6 +577,7 @@ ${isLinkSentWithinLimitTTL}`\n         } as const;\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         return { message: 'flash.wrong-updating', type: 'danger' } as const;\n       }\n@@ -607,6 +616,7 @@ ${isLinkSentWithinLimitTTL}`\n         } as const;\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         return { message: 'flash.wrong-updating', type: 'danger' } as const;\n       }\n@@ -643,6 +653,7 @@ ${isLinkSentWithinLimitTTL}`\n         } as const;\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(403);\n         return { message: 'flash.wrong-updating', type: 'danger' } as const;\n       }"
        },
        {
            "sha": "c77d77d8a18e23fef52f7184947e7156879b15a6",
            "filename": "api/src/routes/user.ts",
            "status": "modified",
            "additions": 64,
            "deletions": 101,
            "changes": 165,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Froutes%2Fuser.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Froutes%2Fuser.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fuser.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -107,32 +107,22 @@ export const userRoutes: FastifyPluginCallbackTypebox = (\n       schema: schemas.deleteMyAccount\n     },\n     async (req, reply) => {\n-      try {\n-        await fastify.prisma.userToken.deleteMany({\n-          where: { userId: req.user!.id }\n-        });\n-        await fastify.prisma.msUsername.deleteMany({\n-          where: { userId: req.user!.id }\n-        });\n-        await fastify.prisma.survey.deleteMany({\n-          where: { userId: req.user!.id }\n-        });\n-        await fastify.prisma.user.delete({\n-          where: { id: req.user!.id }\n-        });\n-        await req.session.destroy();\n-        void reply.clearCookie('sessionId');\n+      await fastify.prisma.userToken.deleteMany({\n+        where: { userId: req.user!.id }\n+      });\n+      await fastify.prisma.msUsername.deleteMany({\n+        where: { userId: req.user!.id }\n+      });\n+      await fastify.prisma.survey.deleteMany({\n+        where: { userId: req.user!.id }\n+      });\n+      await fastify.prisma.user.delete({\n+        where: { id: req.user!.id }\n+      });\n+      await req.session.destroy();\n+      void reply.clearCookie('sessionId');\n \n-        return {};\n-      } catch (err) {\n-        fastify.log.error(err);\n-        void reply.code(500);\n-        return {\n-          message:\n-            'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.',\n-          type: 'danger'\n-        };\n-      }\n+      return {};\n     }\n   );\n \n@@ -141,32 +131,22 @@ export const userRoutes: FastifyPluginCallbackTypebox = (\n     {\n       schema: schemas.resetMyProgress\n     },\n-    async (req, reply) => {\n-      try {\n-        await fastify.prisma.userToken.deleteMany({\n-          where: { userId: req.user!.id }\n-        });\n-        await fastify.prisma.msUsername.deleteMany({\n-          where: { userId: req.user!.id }\n-        });\n-        await fastify.prisma.survey.deleteMany({\n-          where: { userId: req.user!.id }\n-        });\n-        await fastify.prisma.user.update({\n-          where: { id: req.user!.id },\n-          data: createResetProperties()\n-        });\n+    async req => {\n+      await fastify.prisma.userToken.deleteMany({\n+        where: { userId: req.user!.id }\n+      });\n+      await fastify.prisma.msUsername.deleteMany({\n+        where: { userId: req.user!.id }\n+      });\n+      await fastify.prisma.survey.deleteMany({\n+        where: { userId: req.user!.id }\n+      });\n+      await fastify.prisma.user.update({\n+        where: { id: req.user!.id },\n+        data: createResetProperties()\n+      });\n \n-        return {};\n-      } catch (err) {\n-        fastify.log.error(err);\n-        void reply.code(500);\n-        return {\n-          message:\n-            'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.',\n-          type: 'danger'\n-        };\n-      }\n+      return {};\n     }\n   );\n   // TODO(Post-MVP): POST -> PUT\n@@ -196,28 +176,18 @@ export const userRoutes: FastifyPluginCallbackTypebox = (\n       schema: schemas.deleteUserToken\n     },\n     async (req, reply) => {\n-      try {\n-        const { count } = await fastify.prisma.userToken.deleteMany({\n-          where: { userId: req.user?.id }\n-        });\n+      const { count } = await fastify.prisma.userToken.deleteMany({\n+        where: { userId: req.user?.id }\n+      });\n \n-        if (count === 0) {\n-          void reply.code(404);\n-          return {\n-            message: 'userToken not found',\n-            type: 'info'\n-          } as const;\n-        }\n-        return { userToken: null };\n-      } catch (err) {\n-        fastify.log.error(err);\n-        void reply.code(500);\n+      if (count === 0) {\n+        void reply.code(404);\n         return {\n-          type: 'danger',\n-          message:\n-            'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.'\n+          message: 'userToken not found',\n+          type: 'info'\n         } as const;\n       }\n+      return { userToken: null };\n     }\n   );\n \n@@ -231,44 +201,33 @@ export const userRoutes: FastifyPluginCallbackTypebox = (\n       }\n     },\n     async (req, reply) => {\n-      try {\n-        const user = await fastify.prisma.user.findUniqueOrThrow({\n-          where: { id: req.user?.id }\n-        });\n-        const { username, reportDescription: report } = req.body;\n-\n-        if (!username || !report || report === '') {\n-          // NOTE: Do we want to log these instances?\n-          void reply.code(400);\n-          return {\n-            type: 'danger',\n-            message: 'flash.provide-username'\n-          } as const;\n-        }\n-\n-        await fastify.sendEmail({\n-          from: 'team@freecodecamp.org',\n-          to: 'support@freecodecamp.org',\n-          cc: user.email,\n-          subject: `Abuse Report : Reporting ${username}'s profile.`,\n-          text: generateReportEmail(user, username, report)\n-        });\n+      const user = await fastify.prisma.user.findUniqueOrThrow({\n+        where: { id: req.user?.id }\n+      });\n+      const { username, reportDescription: report } = req.body;\n \n-        return {\n-          type: 'info',\n-          message: 'flash.report-sent',\n-          variables: { email: user.email }\n-        } as const;\n-      } catch (err) {\n-        fastify.log.error(err);\n-        // TODO: redirect to the reported user's profile if there's an error\n-        void reply.code(500);\n+      if (!username || !report) {\n+        // NOTE: Do we want to log these instances?\n+        void reply.code(400);\n         return {\n           type: 'danger',\n-          message:\n-            'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.'\n+          message: 'flash.provide-username'\n         } as const;\n       }\n+\n+      await fastify.sendEmail({\n+        from: 'team@freecodecamp.org',\n+        to: 'support@freecodecamp.org',\n+        cc: user.email,\n+        subject: `Abuse Report : Reporting ${username}'s profile.`,\n+        text: generateReportEmail(user, username, report)\n+      });\n+\n+      return {\n+        type: 'info',\n+        message: 'flash.report-sent',\n+        variables: { email: user.email }\n+      } as const;\n     }\n   );\n \n@@ -287,6 +246,7 @@ export const userRoutes: FastifyPluginCallbackTypebox = (\n         return { msUsername: null };\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         void reply.send({\n           message: 'flash.ms.transcript.unlink-err',\n@@ -374,6 +334,7 @@ export const userRoutes: FastifyPluginCallbackTypebox = (\n         return { msUsername: userName };\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         return reply.code(500).send({\n           type: 'error',\n           message: 'flash.ms.transcript.link-err-6'\n@@ -434,6 +395,7 @@ export const userRoutes: FastifyPluginCallbackTypebox = (\n         } as const;\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void reply.code(500);\n         return {\n           type: 'error',\n@@ -605,6 +567,7 @@ export const userGetRoutes: FastifyPluginCallbackTypebox = (\n         });\n       } catch (err) {\n         fastify.log.error(err);\n+        fastify.Sentry.captureException(err);\n         void res.code(500);\n         return { user: {}, result: '' };\n       }"
        },
        {
            "sha": "425834994ac9c0158ea4f2c57bf660f7a7316ac3",
            "filename": "api/src/schemas/certificate/cert-slug.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fcertificate%2Fcert-slug.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fcertificate%2Fcert-slug.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fcertificate%2Fcert-slug.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -1,5 +1,6 @@\n import { Type } from '@fastify/type-provider-typebox';\n import { Certification } from '../../../../shared/config/certification-settings';\n+import { generic500 } from '../types';\n \n export const certSlug = {\n   params: Type.Object({\n@@ -119,11 +120,6 @@ export const certSlug = {\n         })\n       )\n     }),\n-    500: Type.Object({\n-      type: Type.Literal('danger'),\n-      message: Type.Literal(\n-        'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.'\n-      )\n-    })\n+    500: generic500\n   }\n };"
        },
        {
            "sha": "a790154ea6dcfedf24e23595695819b70799fee2",
            "filename": "api/src/schemas/certificate/certificate-verify.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fcertificate%2Fcertificate-verify.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fcertificate%2Fcertificate-verify.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fcertificate%2Fcertificate-verify.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -1,5 +1,5 @@\n import { Type } from '@fastify/type-provider-typebox';\n-import { isCertMap } from '../types';\n+import { generic500, isCertMap } from '../types';\n \n export const certificateVerify = {\n   // TODO(POST_MVP): Remove partial validation from route for schema validation\n@@ -121,9 +121,12 @@ export const certificateVerify = {\n         )\n       })\n     ]),\n-    500: Type.Object({\n-      type: Type.Literal('danger'),\n-      message: Type.Literal('flash.went-wrong')\n-    })\n+    500: Type.Union([\n+      Type.Object({\n+        type: Type.Literal('danger'),\n+        message: Type.Literal('flash.went-wrong')\n+      }),\n+      generic500\n+    ])\n   }\n };"
        },
        {
            "sha": "e42149be78b0eebbb2d8d68ec2ab0296f65f9a55",
            "filename": "api/src/schemas/challenge/backend-challenge-completed.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fchallenge%2Fbackend-challenge-completed.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fchallenge%2Fbackend-challenge-completed.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fchallenge%2Fbackend-challenge-completed.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -1,4 +1,5 @@\n import { Type } from '@fastify/type-provider-typebox';\n+import { generic500 } from '../types';\n \n export const backendChallengeCompleted = {\n   body: Type.Object({\n@@ -16,11 +17,6 @@ export const backendChallengeCompleted = {\n         'That does not appear to be a valid challenge submission.'\n       )\n     }),\n-    500: Type.Object({\n-      type: Type.Literal('danger'),\n-      message: Type.Literal(\n-        'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.'\n-      )\n-    })\n+    500: generic500\n   }\n };"
        },
        {
            "sha": "8bdf5ee0c9121675c678c26174d3980a3742a606",
            "filename": "api/src/schemas/challenge/coderoad-challenge-completed.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fchallenge%2Fcoderoad-challenge-completed.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fchallenge%2Fcoderoad-challenge-completed.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fchallenge%2Fcoderoad-challenge-completed.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -1,4 +1,5 @@\n import { Type } from '@fastify/type-provider-typebox';\n+import { generic500 } from '../types';\n \n export const coderoadChallengeCompleted = {\n   body: Type.Object({\n@@ -14,9 +15,6 @@ export const coderoadChallengeCompleted = {\n       type: Type.Literal('error'),\n       msg: Type.String()\n     }),\n-    500: Type.Object({\n-      type: Type.Literal('danger'),\n-      msg: Type.String()\n-    })\n+    500: generic500\n   }\n };"
        },
        {
            "sha": "5e71d9575dc62e5251cacd35acb442482d9cab2d",
            "filename": "api/src/schemas/challenge/modern-challenge-completed.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fchallenge%2Fmodern-challenge-completed.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fchallenge%2Fmodern-challenge-completed.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fchallenge%2Fmodern-challenge-completed.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -1,5 +1,5 @@\n import { Type } from '@fastify/type-provider-typebox';\n-import { savedChallenge } from '../types';\n+import { generic500, savedChallenge } from '../types';\n \n export const modernChallengeCompleted = {\n   body: Type.Object({\n@@ -30,11 +30,6 @@ export const modernChallengeCompleted = {\n         'That does not appear to be a valid challenge submission.'\n       )\n     }),\n-    500: Type.Object({\n-      type: Type.Literal('danger'),\n-      message: Type.Literal(\n-        'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.'\n-      )\n-    })\n+    500: generic500\n   }\n };"
        },
        {
            "sha": "60969db825da36a497f99b8fcdb22cb6cba84936",
            "filename": "api/src/schemas/challenge/project-completed.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fchallenge%2Fproject-completed.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fchallenge%2Fproject-completed.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fchallenge%2Fproject-completed.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -1,4 +1,5 @@\n import { Type } from '@fastify/type-provider-typebox';\n+import { generic500 } from '../types';\n \n export const projectCompleted = {\n   body: Type.Object({\n@@ -36,11 +37,6 @@ export const projectCompleted = {\n         Type.Literal('That does not appear to be a valid challenge submission.')\n       ])\n     }),\n-    500: Type.Object({\n-      message: Type.Literal(\n-        'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.'\n-      ),\n-      type: Type.Literal('danger')\n-    })\n+    500: generic500\n   }\n };"
        },
        {
            "sha": "24b987a398eed3dccccaa1d2dbfd42e6b2d9dc07",
            "filename": "api/src/schemas/challenge/save-challenge.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fchallenge%2Fsave-challenge.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fchallenge%2Fsave-challenge.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fchallenge%2Fsave-challenge.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -1,5 +1,5 @@\n import { Type } from '@fastify/type-provider-typebox';\n-import { file, savedChallenge } from '../types';\n+import { file, generic500, savedChallenge } from '../types';\n \n export const saveChallenge = {\n   body: Type.Object({\n@@ -15,11 +15,6 @@ export const saveChallenge = {\n       savedChallenges: Type.Array(savedChallenge)\n     }),\n     403: Type.Literal('That challenge type is not saveable.'),\n-    500: Type.Object({\n-      type: Type.Literal('danger'),\n-      message: Type.Literal(\n-        'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.'\n-      )\n-    })\n+    500: generic500\n   }\n };"
        },
        {
            "sha": "5dc45a7048c79b20fc5011d0a47698e1486809b6",
            "filename": "api/src/schemas/types.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Ftypes.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Ftypes.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -1,9 +1,7 @@\n import { Type } from '@fastify/type-provider-typebox';\n \n export const generic500 = Type.Object({\n-  message: Type.Literal(\n-    'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.'\n-  ),\n+  message: Type.Literal('flash.generic-error'),\n   type: Type.Literal('danger')\n });\n "
        },
        {
            "sha": "3012ed56c00c4e7f3f833871732d383e4e05fe0e",
            "filename": "api/src/schemas/user/delete-user-token.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fuser%2Fdelete-user-token.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741/api%2Fsrc%2Fschemas%2Fuser%2Fdelete-user-token.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fuser%2Fdelete-user-token.ts?ref=517a351a28c8b23a6b8ab5bca8dec7e5e0cc1741",
            "patch": "@@ -1,4 +1,5 @@\n import { Type } from '@fastify/type-provider-typebox';\n+import { generic500 } from '../types';\n \n export const deleteUserToken = {\n   response: {\n@@ -9,11 +10,6 @@ export const deleteUserToken = {\n       message: Type.Literal('userToken not found'),\n       type: Type.Literal('info')\n     }),\n-    500: Type.Object({\n-      message: Type.Literal(\n-        'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.'\n-      ),\n-      type: Type.Literal('danger')\n-    })\n+    500: generic500\n   }\n };"
        }
    ],
    "stats": {
        "total": 1318,
        "additions": 602,
        "deletions": 716
    }
}