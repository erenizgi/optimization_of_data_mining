{
    "author": "ojeytonwilliams",
    "message": "test: minor fix to how cookies are passed around (#55259)",
    "sha": "fd1bf0dd5a4f6bc9f437902e1c6ea48c3aa0e794",
    "files": [
        {
            "sha": "bd72b1a9c0da5e070c05b20d0bd72a9337deea2e",
            "filename": "api/jest.utils.test.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 1,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/fd1bf0dd5a4f6bc9f437902e1c6ea48c3aa0e794/api%2Fjest.utils.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/fd1bf0dd5a4f6bc9f437902e1c6ea48c3aa0e794/api%2Fjest.utils.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fjest.utils.test.ts?ref=fd1bf0dd5a4f6bc9f437902e1c6ea48c3aa0e794",
            "patch": "@@ -1,4 +1,4 @@\n-import { getCsrfToken } from './jest.utils';\n+import { getCsrfToken, getCookies } from './jest.utils';\n \n const fakeCookies = [\n   '_csrf=123; Path=/; HttpOnly; SameSite=Strict',\n@@ -17,3 +17,18 @@ describe('getCsrfToken', () => {\n     ).toBeUndefined();\n   });\n });\n+\n+describe('setCookiesToCookies', () => {\n+  test('returns a string of cookies', () => {\n+    expect(getCookies(fakeCookies)).toEqual(\n+      '_csrf=123; csrf_token=abc-123; sessionId=CV-abc.123'\n+    );\n+  });\n+  test('handles bare cookies', () => {\n+    expect(getCookies(['_csrf=123'])).toEqual('_csrf=123');\n+  });\n+\n+  test('throws an error if the cookies are malformed', () => {\n+    expect(() => getCookies(['_csrf'])).toThrow();\n+  });\n+});"
        },
        {
            "sha": "29f9a90b1ceca5dc86319a09fbefc9ac6692ad31",
            "filename": "api/jest.utils.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/fd1bf0dd5a4f6bc9f437902e1c6ea48c3aa0e794/api%2Fjest.utils.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/fd1bf0dd5a4f6bc9f437902e1c6ea48c3aa0e794/api%2Fjest.utils.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fjest.utils.ts?ref=fd1bf0dd5a4f6bc9f437902e1c6ea48c3aa0e794",
            "patch": "@@ -34,6 +34,13 @@ export const getCsrfToken = (setCookies: string[]): string | undefined => {\n \n export const ORIGIN = 'https://www.freecodecamp.org';\n \n+export const getCookies = (setCookies: string[]): string => {\n+  for (const cookie of setCookies) {\n+    expect(cookie).toMatch(/.*=.*/);\n+  }\n+  return setCookies.map(cookie => cookie.split(';')[0]).join('; ');\n+};\n+\n export function superRequest(\n   resource: string,\n   config: {\n@@ -48,7 +55,7 @@ export function superRequest(\n   const req = requests[method](resource).set('Origin', ORIGIN);\n \n   if (setCookies) {\n-    void req.set('Cookie', setCookies);\n+    void req.set('Cookie', getCookies(setCookies));\n   }\n \n   const csrfToken = (setCookies && getCsrfToken(setCookies)) ?? '';"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 24,
        "deletions": 2
    }
}