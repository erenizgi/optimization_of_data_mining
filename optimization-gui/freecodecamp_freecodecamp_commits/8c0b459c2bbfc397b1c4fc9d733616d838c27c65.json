{
    "author": "ojeytonwilliams",
    "message": "refactor(client): replace Map's static query with page queries (#55792)",
    "sha": "8c0b459c2bbfc397b1c4fc9d733616d838c27c65",
    "files": [
        {
            "sha": "17ca474afee4074a6070326e50ea4e4fe2971ad0",
            "filename": "client/src/components/Map/index.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 28,
            "changes": 35,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8c0b459c2bbfc397b1c4fc9d733616d838c27c65/client%2Fsrc%2Fcomponents%2FMap%2Findex.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8c0b459c2bbfc397b1c4fc9d733616d838c27c65/client%2Fsrc%2Fcomponents%2FMap%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FMap%2Findex.tsx?ref=8c0b459c2bbfc397b1c4fc9d733616d838c27c65",
            "patch": "@@ -1,5 +1,4 @@\n import React, { Fragment } from 'react';\n-import { graphql, useStaticQuery } from 'gatsby';\n import { useTranslation } from 'react-i18next';\n import { connect } from 'react-redux';\n import { createSelector } from 'reselect';\n@@ -27,11 +26,7 @@ import {\n \n import { RibbonIcon } from '../../assets/icons/completion-ribbon';\n \n-import {\n-  CurrentCert,\n-  ClaimedCertifications,\n-  AllChallengeNode\n-} from '../../redux/prop-types';\n+import { CurrentCert, ClaimedCertifications } from '../../redux/prop-types';\n import {\n   certSlugTypeMap,\n   superBlockCertTypeMap\n@@ -44,6 +39,10 @@ interface MapProps {\n   currentCerts: CurrentCert[];\n   claimedCertifications?: ClaimedCertifications;\n   completedChallengeIds: string[];\n+  allChallenges: {\n+    id: string;\n+    superBlock: SuperBlocks;\n+  }[];\n }\n \n const linkSpacingStyle = {\n@@ -131,29 +130,9 @@ function Map({\n   forLanding = false,\n   isSignedIn,\n   currentCerts,\n-  completedChallengeIds\n+  completedChallengeIds,\n+  allChallenges\n }: MapProps): React.ReactElement {\n-  const {\n-    allChallengeNode: { edges }\n-  }: {\n-    allChallengeNode: AllChallengeNode;\n-  } = useStaticQuery(graphql`\n-    query allChallenges {\n-      allChallengeNode {\n-        edges {\n-          node {\n-            challenge {\n-              id\n-              superBlock\n-            }\n-          }\n-        }\n-      }\n-    }\n-  `);\n-\n-  const allChallenges = edges.map(edge => edge.node.challenge);\n-\n   const { t } = useTranslation();\n \n   const allSuperblockChallengesCompleted = (superblock: SuperBlocks) => {"
        },
        {
            "sha": "ca4c2170a57fb7a3b4ed3f6f763f5e14d9558752",
            "filename": "client/src/components/landing/components/certifications.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8c0b459c2bbfc397b1c4fc9d733616d838c27c65/client%2Fsrc%2Fcomponents%2Flanding%2Fcomponents%2Fcertifications.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8c0b459c2bbfc397b1c4fc9d733616d838c27c65/client%2Fsrc%2Fcomponents%2Flanding%2Fcomponents%2Fcertifications.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Flanding%2Fcomponents%2Fcertifications.tsx?ref=8c0b459c2bbfc397b1c4fc9d733616d838c27c65",
            "patch": "@@ -3,9 +3,17 @@ import { Col } from '@freecodecamp/ui';\n \n import Map from '../../Map/index';\n import { Spacer } from '../../helpers';\n+import { type SuperBlocks } from '../../../../../shared/config/curriculum';\n import BigCallToAction from './big-call-to-action';\n \n-const Certifications = (): JSX.Element => {\n+const Certifications = ({\n+  allChallenges\n+}: {\n+  allChallenges: {\n+    id: string;\n+    superBlock: SuperBlocks;\n+  }[];\n+}): JSX.Element => {\n   return (\n     <Col\n       className='certification-section'\n@@ -15,7 +23,7 @@ const Certifications = (): JSX.Element => {\n       smOffset={1}\n       xs={12}\n     >\n-      <Map forLanding={true} />\n+      <Map allChallenges={allChallenges} forLanding={true} />\n       <Spacer size='medium' />\n       <BigCallToAction />\n       <Spacer size='medium' />"
        },
        {
            "sha": "573809ff4d5b960b0aeaebc08ea422ca0d31ca8f",
            "filename": "client/src/components/landing/index.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 59,
            "changes": 59,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/73459899179b6659407904cf09c3f0f999b4c4e7/client%2Fsrc%2Fcomponents%2Flanding%2Findex.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/73459899179b6659407904cf09c3f0f999b4c4e7/client%2Fsrc%2Fcomponents%2Flanding%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Flanding%2Findex.tsx?ref=73459899179b6659407904cf09c3f0f999b4c4e7",
            "patch": "@@ -1,59 +0,0 @@\n-import React, { ReactElement } from 'react';\n-import { useTranslation } from 'react-i18next';\n-import { useGrowthBook } from '@growthbook/growthbook-react';\n-import SEO from '../seo';\n-import { Loader } from '../helpers';\n-import AsSeenIn from './components/as-seen-in';\n-import Certifications from './components/certifications';\n-import LandingTop from './components/landing-top';\n-import LandingTopB from './components/landing-top-b';\n-import Testimonials from './components/testimonials';\n-import Faq from './components/faq';\n-\n-import './landing.css';\n-\n-const LandingA = () => (\n-  <main className='landing-page'>\n-    <LandingTop />\n-    <AsSeenIn />\n-    <Testimonials />\n-    <Certifications />\n-    <Faq />\n-  </main>\n-);\n-\n-const LandingB = () => (\n-  <main className='landing-page landing-page-b'>\n-    <LandingTopB />\n-    <Testimonials />\n-    <Certifications />\n-    <Faq />\n-  </main>\n-);\n-\n-function Landing(): ReactElement {\n-  const { t } = useTranslation();\n-  const growthbook = useGrowthBook();\n-  if (growthbook && growthbook.ready) {\n-    const showLandingPageRedesign = growthbook.getFeatureValue(\n-      'landing-page-redesign',\n-      false\n-    );\n-    return (\n-      <>\n-        <SEO title={t('metaTags:title')} />\n-        {showLandingPageRedesign === true ? <LandingB /> : <LandingA />}\n-      </>\n-    );\n-  } else {\n-    return (\n-      <>\n-        <SEO title={t('metaTags:title')} />\n-        <Loader fullScreen={true} />\n-      </>\n-    );\n-  }\n-}\n-\n-Landing.displayName = 'Landing';\n-export default Landing;"
        },
        {
            "sha": "e34c7a11b986327af5d29f435c10fb54c7448aa1",
            "filename": "client/src/components/landing/landing.test.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/73459899179b6659407904cf09c3f0f999b4c4e7/client%2Fsrc%2Fcomponents%2Flanding%2Flanding.test.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/73459899179b6659407904cf09c3f0f999b4c4e7/client%2Fsrc%2Fcomponents%2Flanding%2Flanding.test.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Flanding%2Flanding.test.tsx?ref=73459899179b6659407904cf09c3f0f999b4c4e7",
            "patch": "@@ -1,30 +0,0 @@\n-import React from 'react';\n-import { createRenderer } from 'react-test-renderer/shallow';\n-\n-import mockChallengeNodes from '../../__mocks__/challenge-nodes';\n-import IndexPage from '../../pages';\n-\n-jest.mock('../../analytics');\n-\n-describe('<Landing />', () => {\n-  it('renders when visiting index page and logged out', () => {\n-    const utils = createRenderer();\n-    // @ts-expect-error Type definition mismatch\n-    utils.render(<IndexPage {...loggedOutProps} />);\n-    const view = utils.getRenderOutput();\n-    // @ts-expect-error Type definition mismatch\n-    expect(view.type.displayName === 'Landing').toBeTruthy();\n-  });\n-});\n-\n-const loggedOutProps = {\n-  data: { allChallengeNode: { edges: mockChallengeNodes } },\n-  fetchState: {\n-    complete: true,\n-    error: null,\n-    errored: false,\n-    pending: false\n-  },\n-  isSignedIn: false,\n-  user: {}\n-};"
        },
        {
            "sha": "3c78f9f0d43aa44c4f4df1fc2864652dc73c0c46",
            "filename": "client/src/pages/index.tsx",
            "status": "modified",
            "additions": 95,
            "deletions": 3,
            "changes": 98,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8c0b459c2bbfc397b1c4fc9d733616d838c27c65/client%2Fsrc%2Fpages%2Findex.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8c0b459c2bbfc397b1c4fc9d733616d838c27c65/client%2Fsrc%2Fpages%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fpages%2Findex.tsx?ref=8c0b459c2bbfc397b1c4fc9d733616d838c27c65",
            "patch": "@@ -1,11 +1,103 @@\n import React from 'react';\n+import { graphql } from 'gatsby';\n+import { useTranslation } from 'react-i18next';\n+import { useGrowthBook } from '@growthbook/growthbook-react';\n \n-import Landing from '../components/landing';\n+import { SuperBlocks } from '../../../shared/config/curriculum';\n+import SEO from '../components/seo';\n+import { Loader } from '../components/helpers';\n+import LandingTop from '../components/landing/components/landing-top';\n+import LandingTopB from '../components/landing/components/landing-top-b';\n+import AsSeenIn from '../components/landing/components/as-seen-in';\n+import Testimonials from '../components/landing/components/testimonials';\n+import Certifications from '../components/landing/components/certifications';\n+import Faq from '../components/landing/components/faq';\n+import '../components/landing/landing.css';\n \n-function IndexPage(): JSX.Element {\n-  return <Landing />;\n+type Challenge = {\n+  id: string;\n+  superBlock: SuperBlocks;\n+};\n+\n+type Props = {\n+  data: {\n+    allChallengeNode: {\n+      nodes: {\n+        challenge: Challenge;\n+      }[];\n+    };\n+  };\n+};\n+\n+type LandingProps = {\n+  allChallenges: Challenge[];\n+};\n+\n+const LandingA = ({ allChallenges }: LandingProps) => (\n+  <main className='landing-page'>\n+    <LandingTop />\n+    <AsSeenIn />\n+    <Testimonials />\n+    <Certifications allChallenges={allChallenges} />\n+    <Faq />\n+  </main>\n+);\n+\n+const LandingB = ({ allChallenges }: LandingProps) => (\n+  <main className='landing-page landing-page-b'>\n+    <LandingTopB />\n+    <Testimonials />\n+    <Certifications allChallenges={allChallenges} />\n+    <Faq />\n+  </main>\n+);\n+\n+function IndexPage({\n+  data: {\n+    allChallengeNode: { nodes: challengeNodes }\n+  }\n+}: Props): JSX.Element {\n+  const { t } = useTranslation();\n+  const growthbook = useGrowthBook();\n+  const allChallenges = challengeNodes.map(node => node.challenge);\n+  if (growthbook && growthbook.ready) {\n+    const showLandingPageRedesign = growthbook.getFeatureValue(\n+      'landing-page-redesign',\n+      false\n+    );\n+    return (\n+      <>\n+        <SEO title={t('metaTags:title')} />\n+        {showLandingPageRedesign === true ? (\n+          <LandingB allChallenges={allChallenges} />\n+        ) : (\n+          <LandingA allChallenges={allChallenges} />\n+        )}\n+      </>\n+    );\n+  } else {\n+    return (\n+      <>\n+        <SEO title={t('metaTags:title')} />\n+        <Loader fullScreen={true} />\n+      </>\n+    );\n+  }\n }\n \n IndexPage.displayName = 'IndexPage';\n \n export default IndexPage;\n+\n+export const query = graphql`\n+  query AllChallengeNode {\n+    allChallengeNode {\n+      nodes {\n+        challenge {\n+          id\n+          superBlock\n+        }\n+      }\n+    }\n+  }\n+`;"
        },
        {
            "sha": "b782acccf0d8c4c3c3f58471f5dc470afb08e1a1",
            "filename": "client/src/pages/learn.tsx",
            "status": "modified",
            "additions": 21,
            "deletions": 3,
            "changes": 24,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8c0b459c2bbfc397b1c4fc9d733616d838c27c65/client%2Fsrc%2Fpages%2Flearn.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8c0b459c2bbfc397b1c4fc9d733616d838c27c65/client%2Fsrc%2Fpages%2Flearn.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fpages%2Flearn.tsx?ref=8c0b459c2bbfc397b1c4fc9d733616d838c27c65",
            "patch": "@@ -17,6 +17,7 @@ import {\n } from '../redux/selectors';\n \n import callGA from '../analytics/call-ga';\n+import { SuperBlocks } from '../../../shared/config/curriculum';\n \n interface FetchState {\n   pending: boolean;\n@@ -57,6 +58,14 @@ interface LearnPageProps {\n         fields: Slug;\n       };\n     };\n+    allChallengeNode: {\n+      nodes: {\n+        challenge: {\n+          id: string;\n+          superBlock: SuperBlocks;\n+        };\n+      }[];\n+    };\n   };\n }\n \n@@ -69,7 +78,8 @@ function LearnPage({\n       challenge: {\n         fields: { slug }\n       }\n-    }\n+    },\n+    allChallengeNode: { nodes: challengeNodes }\n   }\n }: LearnPageProps) {\n   const { t } = useTranslation();\n@@ -96,7 +106,7 @@ function LearnPage({\n               onLearnDonationAlertClick={onLearnDonationAlertClick}\n               isDonating={isDonating}\n             />\n-            <Map />\n+            <Map allChallenges={challengeNodes.map(node => node.challenge)} />\n             <Spacer size='large' />\n           </Col>\n         </Row>\n@@ -110,7 +120,7 @@ LearnPage.displayName = 'LearnPage';\n export default connect(mapStateToProps)(LearnPage);\n \n export const query = graphql`\n-  query FirstChallenge {\n+  query LearnPageQuery {\n     challengeNode(\n       challenge: {\n         superOrder: { eq: 0 }\n@@ -124,5 +134,13 @@ export const query = graphql`\n         }\n       }\n     }\n+    allChallengeNode {\n+      nodes {\n+        challenge {\n+          id\n+          superBlock\n+        }\n+      }\n+    }\n   }\n `;"
        },
        {
            "sha": "fa51b35a3e69842deea28636f5e7d128a17b65eb",
            "filename": "client/src/templates/Introduction/super-block-intro.tsx",
            "status": "modified",
            "additions": 15,
            "deletions": 17,
            "changes": 32,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8c0b459c2bbfc397b1c4fc9d733616d838c27c65/client%2Fsrc%2Ftemplates%2FIntroduction%2Fsuper-block-intro.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8c0b459c2bbfc397b1c4fc9d733616d838c27c65/client%2Fsrc%2Ftemplates%2FIntroduction%2Fsuper-block-intro.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FIntroduction%2Fsuper-block-intro.tsx?ref=8c0b459c2bbfc397b1c4fc9d733616d838c27c65",
            "patch": "@@ -25,7 +25,8 @@ import {\n   userFetchStateSelector,\n   signInLoadingSelector\n } from '../../redux/selectors';\n-import { MarkdownRemark, AllChallengeNode, User } from '../../redux/prop-types';\n+import type { AllChallengeNode, User } from '../../redux/prop-types';\n+import { CertTitle } from '../../../config/cert-and-project-map';\n import Block from './components/block';\n import CertChallenge from './components/cert-challenge';\n import LegacyLinks from './components/legacy-links';\n@@ -44,7 +45,6 @@ type FetchState = {\n type SuperBlockProp = {\n   currentChallengeId: string;\n   data: {\n-    markdownRemark: MarkdownRemark;\n     allChallengeNode: AllChallengeNode;\n   };\n   expandedState: {\n@@ -54,6 +54,11 @@ type SuperBlockProp = {\n   isSignedIn: boolean;\n   signInLoading: boolean;\n   location: WindowLocation<{ breadcrumbBlockClick: string }>;\n+  pageContext: {\n+    superBlock: SuperBlocks;\n+    title: CertTitle;\n+    certification: string;\n+  };\n   resetExpansion: () => void;\n   toggleBlock: (arg0: string) => void;\n   tryToShowDonationModal: () => void;\n@@ -164,17 +169,18 @@ const SuperBlockIntroductionPage = (props: SuperBlockProp) => {\n \n   const {\n     data: {\n-      markdownRemark: {\n-        frontmatter: { superBlock, title, certification }\n-      },\n       allChallengeNode: { edges }\n     },\n     isSignedIn,\n     signInLoading,\n-    user\n+    user,\n+    pageContext: { superBlock, title, certification }\n   } = props;\n \n-  const nodesForSuperBlock = edges.map(({ node }) => node);\n+  const allChallenges = edges.map(({ node }) => node.challenge);\n+  const nodesForSuperBlock = edges\n+    .filter(edge => edge.node.challenge.superBlock === superBlock)\n+    .map(({ node }) => node);\n   const blockDashedNames = uniq(\n     nodesForSuperBlock.map(({ challenge: { block } }) => block)\n   );\n@@ -257,7 +263,7 @@ const SuperBlockIntroductionPage = (props: SuperBlockProp) => {\n                 {t(`intro:misc-text.browse-other`)}\n               </h3>\n               <Spacer size='medium' />\n-              <Map />\n+              <Map allChallenges={allChallenges} />\n               <Spacer size='large' />\n             </Col>\n           </Row>\n@@ -276,14 +282,7 @@ export default connect(\n )(withTranslation()(memo(SuperBlockIntroductionPage)));\n \n export const query = graphql`\n-  query SuperBlockIntroPageBySlug($id: String!, $superBlock: String!) {\n-    markdownRemark(id: { eq: $id }) {\n-      frontmatter {\n-        certification\n-        superBlock\n-        title\n-      }\n-    }\n+  query SuperBlockIntroPageQuery {\n     allChallengeNode(\n       sort: {\n         fields: [\n@@ -292,7 +291,6 @@ export const query = graphql`\n           challenge___challengeOrder\n         ]\n       }\n-      filter: { challenge: { superBlock: { eq: $superBlock } } }\n     ) {\n       edges {\n         node {"
        },
        {
            "sha": "7c1b8a99bed0e76a8da2518002c18c3caac169b5",
            "filename": "client/utils/gatsby/challenge-page-creator.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8c0b459c2bbfc397b1c4fc9d733616d838c27c65/client%2Futils%2Fgatsby%2Fchallenge-page-creator.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8c0b459c2bbfc397b1c4fc9d733616d838c27c65/client%2Futils%2Fgatsby%2Fchallenge-page-creator.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Futils%2Fgatsby%2Fchallenge-page-creator.js?ref=8c0b459c2bbfc397b1c4fc9d733616d838c27c65",
            "patch": "@@ -198,8 +198,7 @@ exports.createSuperBlockIntroPages = function (createPage) {\n   return function (edge) {\n     const {\n       fields: { slug },\n-      frontmatter: { superBlock, certification },\n-      id\n+      frontmatter: { superBlock, certification, title }\n     } = edge.node;\n \n     if (!certification) {\n@@ -215,8 +214,9 @@ exports.createSuperBlockIntroPages = function (createPage) {\n       path: slug,\n       component: superBlockIntro,\n       context: {\n-        id,\n-        superBlock\n+        certification,\n+        superBlock,\n+        title\n       }\n     });\n   };"
        }
    ],
    "stats": {
        "total": 298,
        "additions": 152,
        "deletions": 146
    }
}