{
    "author": "ShaunSHamilton",
    "message": "feat(client): flash when can claim cert (#62594)",
    "sha": "ce109e5dff86d71ff62c43ec69445f12abbf164b",
    "files": [
        {
            "sha": "d0473bb08bce1872937b4dcce75ce0e5e88e447a",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=ce109e5dff86d71ff62c43ec69445f12abbf164b",
            "patch": "@@ -1007,6 +1007,7 @@\n     \"not-eligible\": \"This user is not eligible for freeCodeCamp.org certifications at this time.\",\n     \"profile-private\": \"{{username}} has chosen to make their profile private. They will need to make their profile public in order for others to be able to view their certification.\",\n     \"certs-private\": \"{{username}} has chosen to make their certifications private. They will need to make their certifications public in order for others to be able to view them.\",\n+    \"certs-claimable\": \"You can now claim the {{certName}} certification! Visit your settings page to claim your certification.\",\n     \"not-honest\": \"{{username}} has not yet agreed to our Academic Honesty Pledge.\",\n     \"user-not-certified\": \"It looks like user {{username}} is not {{cert}} certified\",\n     \"invalid-challenge\": \"That does not appear to be a valid challenge submission\","
        },
        {
            "sha": "71c350c099fea0d480d985e53390f0b01644000f",
            "filename": "client/src/components/Flash/redux/flash-messages.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fsrc%2Fcomponents%2FFlash%2Fredux%2Fflash-messages.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fsrc%2Fcomponents%2FFlash%2Fredux%2Fflash-messages.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FFlash%2Fredux%2Fflash-messages.ts?ref=ce109e5dff86d71ff62c43ec69445f12abbf164b",
            "patch": "@@ -5,6 +5,7 @@ export enum FlashMessages {\n   CertClaimSuccess = 'flash.cert-claim-success',\n   CertificateMissing = 'flash.certificate-missing',\n   CertsPrivate = 'flash.certs-private',\n+  CertsClaimable = 'flash.certs-claimable',\n   ChallengeSaveTooBig = 'flash.challenge-save-too-big',\n   ChallengeSubmitTooBig = 'flash.challenge-submit-too-big',\n   CodeSaved = 'flash.code-saved',"
        },
        {
            "sha": "cfce0787cc44e25874d6ebd8f3584cc13492d041",
            "filename": "client/src/components/helpers/use-claimable-certs-notification.tsx",
            "status": "added",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fsrc%2Fcomponents%2Fhelpers%2Fuse-claimable-certs-notification.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fsrc%2Fcomponents%2Fhelpers%2Fuse-claimable-certs-notification.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fhelpers%2Fuse-claimable-certs-notification.tsx?ref=ce109e5dff86d71ff62c43ec69445f12abbf164b",
            "patch": "@@ -0,0 +1,36 @@\n+import { useEffect, useRef } from 'react';\n+import { useSelector, useDispatch } from 'react-redux';\n+import {\n+  claimableCertsSelector,\n+  userFetchStateSelector\n+} from '../../redux/selectors';\n+import { createFlashMessage } from '../Flash/redux';\n+import { FlashMessages } from '../Flash/redux/flash-messages';\n+\n+export function useClaimableCertsNotification() {\n+  const dispatch = useDispatch();\n+  const claimableCerts = useSelector<unknown, { certTitle: string }[]>(\n+    claimableCertsSelector\n+  );\n+  // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n+  const { complete } = useSelector(userFetchStateSelector);\n+  const hasShownNotification = useRef(false);\n+\n+  useEffect(() => {\n+    if (!complete || hasShownNotification.current) return;\n+    if (claimableCerts.length === 0) return;\n+\n+    hasShownNotification.current = true;\n+\n+    // Only one cert is shown as claimable at a time\n+    const certName = claimableCerts.at(0)!.certTitle;\n+\n+    dispatch(\n+      createFlashMessage({\n+        type: 'info',\n+        message: FlashMessages.CertsClaimable,\n+        variables: { certName }\n+      })\n+    );\n+  }, [claimableCerts, complete, dispatch]);\n+}"
        },
        {
            "sha": "c09be5c01422cc1de5532c0e835f89bdb795ac2e",
            "filename": "client/src/pages/index.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fsrc%2Fpages%2Findex.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fsrc%2Fpages%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fpages%2Findex.tsx?ref=ce109e5dff86d71ff62c43ec69445f12abbf164b",
            "patch": "@@ -8,6 +8,8 @@ import Testimonials from '../components/landing/components/testimonials';\n import Certifications from '../components/landing/components/certifications';\n import Faq from '../components/landing/components/faq';\n import Benefits from '../components/landing/components/benefits';\n+import { useClaimableCertsNotification } from '../components/helpers/use-claimable-certs-notification';\n+\n import '../components/landing/landing.css';\n \n const Landing = () => (\n@@ -27,6 +29,8 @@ const Landing = () => (\n function IndexPage(): JSX.Element {\n   const { t } = useTranslation();\n   const growthbook = useGrowthBook();\n+  useClaimableCertsNotification();\n+\n   if (growthbook && growthbook.ready) {\n     growthbook.getFeatureValue('landing-aa-test', false);\n     return ("
        },
        {
            "sha": "6847c4465f66f400d57343a76322818f5607b501",
            "filename": "client/src/pages/learn.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fsrc%2Fpages%2Flearn.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fsrc%2Fpages%2Flearn.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fpages%2Flearn.tsx?ref=ce109e5dff86d71ff62c43ec69445f12abbf164b",
            "patch": "@@ -16,6 +16,7 @@ import {\n } from '../redux/selectors';\n \n import callGA from '../analytics/call-ga';\n+import { useClaimableCertsNotification } from '../components/helpers/use-claimable-certs-notification';\n \n interface FetchState {\n   pending: boolean;\n@@ -70,6 +71,7 @@ function LearnPage({\n   const { name, completedChallengeCount, isDonating } = user ?? EMPTY_USER;\n \n   const { t } = useTranslation();\n+  useClaimableCertsNotification();\n \n   const slug = challengeNode?.challenge?.fields?.slug || '';\n "
        },
        {
            "sha": "8e249a2c4e7e7048cc903fbf5c3dbedd0dfec323",
            "filename": "client/src/redux/selectors.js",
            "status": "modified",
            "additions": 51,
            "deletions": 0,
            "changes": 51,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fsrc%2Fredux%2Fselectors.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fsrc%2Fredux%2Fselectors.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fselectors.js?ref=ce109e5dff86d71ff62c43ec69445f12abbf164b",
            "patch": "@@ -1,4 +1,9 @@\n import { createSelector } from 'reselect';\n+import { liveCerts } from '../../config/cert-and-project-map';\n+import {\n+  certTypeIdMap,\n+  certTypeTitleMap\n+} from '../../../shared-dist/config/certification-settings.js';\n \n import { randomBetween } from '../utils/random-between';\n import { getSessionChallengeData } from '../utils/session-storage';\n@@ -218,3 +223,49 @@ export const userSelector = state => state[MainApp].user.sessionUser;\n export const otherUserSelector = state => state[MainApp].user.otherUser;\n \n export const renderStartTimeSelector = state => state[MainApp].renderStartTime;\n+\n+export const claimableCertsSelector = createSelector([userSelector], user => {\n+  if (!user) return [];\n+\n+  const completedChallengeIds = (user.completedChallenges || []).map(\n+    ({ id }) => id\n+  );\n+\n+  const isClaimedById = Object.entries(certTypeIdMap).reduce(\n+    (acc, [userFlag, certId]) => {\n+      acc[certId] = Boolean(user[userFlag]);\n+      return acc;\n+    },\n+    {}\n+  );\n+  // Invert certTypeIdMap ({[userFlag]: certId}  => {[certId]: userFlag}) to get certType from id\n+  const invertedCertTypeIdMap = Object.entries(certTypeIdMap).reduce(\n+    (acc, [userFlag, certId]) => {\n+      acc[certId] = userFlag;\n+      return acc;\n+    },\n+    {}\n+  );\n+\n+  const claimable = [];\n+\n+  for (const { id, projects } of liveCerts) {\n+    if (!projects) continue;\n+    if (isClaimedById[id]) continue;\n+\n+    const projectIds = projects.map(p => p.id);\n+    const allProjectsComplete = projectIds.every(id =>\n+      completedChallengeIds.includes(id)\n+    );\n+\n+    const certType = invertedCertTypeIdMap[id];\n+    const certTitle = certTypeTitleMap[certType];\n+    if (allProjectsComplete) {\n+      claimable.push({\n+        certTitle\n+      });\n+    }\n+  }\n+\n+  return claimable;\n+});"
        },
        {
            "sha": "2ebaa615fe60ce441a4c954ce5c9021205c505e2",
            "filename": "client/src/utils/tone/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fsrc%2Futils%2Ftone%2Findex.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ce109e5dff86d71ff62c43ec69445f12abbf164b/client%2Fsrc%2Futils%2Ftone%2Findex.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Ftone%2Findex.ts?ref=ce109e5dff86d71ff62c43ec69445f12abbf164b",
            "patch": "@@ -18,6 +18,7 @@ const toneUrls = {\n   [FlashMessages.CertClaimSuccess]:\n     'https://campfire-mode.freecodecamp.org/cert.mp3',\n   [FlashMessages.CertificateMissing]: TRY_AGAIN,\n+  [FlashMessages.CertsClaimable]: CHAL_COMP,\n   [FlashMessages.CertsPrivate]: TRY_AGAIN,\n   [FlashMessages.ChallengeSaveTooBig]: TRY_AGAIN,\n   [FlashMessages.ChallengeSubmitTooBig]: TRY_AGAIN,"
        }
    ],
    "stats": {
        "total": 96,
        "additions": 96,
        "deletions": 0
    }
}