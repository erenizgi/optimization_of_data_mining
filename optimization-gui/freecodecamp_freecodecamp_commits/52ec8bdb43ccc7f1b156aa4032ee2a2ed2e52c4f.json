{
    "author": "ojeytonwilliams",
    "message": "chore(ci): consolidate api e2e testing (#59420)",
    "sha": "52ec8bdb43ccc7f1b156aa4032ee2a2ed2e52c4f",
    "files": [
        {
            "sha": "71988af629aae5e56fd04093ffba9c477405c88d",
            "filename": ".github/workflows/e2e-playwright.yml",
            "status": "modified",
            "additions": 102,
            "deletions": 3,
            "changes": 105,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/52ec8bdb43ccc7f1b156aa4032ee2a2ed2e52c4f/.github%2Fworkflows%2Fe2e-playwright.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/52ec8bdb43ccc7f1b156aa4032ee2a2ed2e52c4f/.github%2Fworkflows%2Fe2e-playwright.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fe2e-playwright.yml?ref=52ec8bdb43ccc7f1b156aa4032ee2a2ed2e52c4f",
            "patch": "@@ -75,7 +75,32 @@ jobs:\n           name: webpack-stats\n           path: client/public/stats.json\n \n-  playwright-run:\n+  build-new-api:\n+    name: Build New Api (Container)\n+    runs-on: ubuntu-22.04\n+\n+    steps:\n+      - name: Checkout Source Files\n+        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n+        with:\n+          submodules: 'recursive'\n+\n+      - name: Create Image\n+        run: |\n+          docker build \\\n+            -t fcc-api \\\n+            -f docker/api/Dockerfile .\n+\n+      - name: Save Image\n+        run: docker save fcc-api > api-artifact.tar\n+\n+      - name: Upload Api Artifact\n+        uses: actions/upload-artifact@5d5d22a31266ced268874388b861e4b58bb5c2f3 # v4.3.1\n+        with:\n+          name: api-artifact\n+          path: api-artifact.tar\n+\n+  playwright-run-old-api:\n     name: E2E Test\n     runs-on: ubuntu-22.04\n     needs: build-client\n@@ -156,13 +181,87 @@ jobs:\n       - uses: actions/upload-artifact@v4\n         if: ${{ !cancelled() }}\n         with:\n-          name: playwright-report-${{ matrix.browsers }}\n+          name: playwright-report-old-api-${{ matrix.browsers }}\n           path: playwright/reporter\n           retention-days: 30\n       - name: Upload screenshots\n         if: failure()\n         uses: actions/upload-artifact@v4\n         with:\n-          name: screenshots-${{ matrix.browsers }}\n+          name: screenshots-old-api-${{ matrix.browsers }}\n           path: playwright/test-results\n           retention-days: 14\n+\n+  playwright-run-new-api:\n+    name: Run Playwright Tests (with new Api)\n+    runs-on: ubuntu-22.04\n+    needs: [build-client, build-new-api]\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        # Extend this to include firefox and webkit once chromium is working.\n+        browsers: [chromium]\n+        node-version: [20]\n+\n+    steps:\n+      - name: Set Action Environment Variables\n+        run: |\n+          echo \"GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}\" >> $GITHUB_ENV\n+\n+      - name: Checkout Source Files\n+        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n+\n+      - uses: actions/download-artifact@c850b930e6ba138125429b7e5c93fc707a7f8427 # v4.1.4\n+\n+      - name: Unpack Client Artifact\n+        run: |\n+          tar -xf client-artifact/client-artifact.tar\n+          rm client-artifact/client-artifact.tar\n+\n+      - name: Load Api Image\n+        run: |\n+          docker load < api-artifact/api-artifact.tar\n+          rm api-artifact/api-artifact.tar\n+\n+      - name: Setup pnpm\n+        uses: pnpm/action-setup@a3252b78c470c02df07e9d59298aecedc3ccdd6d #v3.0.0\n+\n+      - name: Use Node.js ${{ matrix.node-version }}\n+        uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8 # v4.0.2\n+        with:\n+          node-version: ${{ matrix.node-version }}\n+\n+      - name: Install Dependencies\n+        run: pnpm install\n+\n+      - name: Set freeCodeCamp Environment Variables (needed by api)\n+        run: |\n+          cp sample.env .env\n+\n+      - name: Install playwright dependencies\n+        run: npx playwright install --with-deps\n+\n+      - name: Install and Build\n+        run: |\n+          pnpm install\n+          pnpm run create:shared\n+          pnpm run build:curriculum\n+\n+      - name: Start apps\n+        run: |\n+          docker compose up -d\n+          pnpm run serve:client-ci &\n+          sleep 10\n+\n+      - name: Seed Database with Certified User\n+        run: pnpm run seed:certified-user\n+\n+      - name: Run playwright tests\n+        run: npx playwright test --project=${{ matrix.browsers }} --grep-invert 'third-party-donation.spec.ts'\n+\n+      - uses: actions/upload-artifact@v4\n+        if: ${{ !cancelled() }}\n+        with:\n+          name: playwright-report-${{ matrix.browsers }}\n+          path: playwright/reporter\n+          retention-days: 30"
        },
        {
            "sha": "c62b8ae23a8456ee9369df06205438e66b15c497",
            "filename": ".github/workflows/e2e-with-new-api.yml",
            "status": "removed",
            "additions": 0,
            "deletions": 174,
            "changes": 174,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e411c1eea6cd1f08e0ad6c2a1d786b7f566e0a37/.github%2Fworkflows%2Fe2e-with-new-api.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e411c1eea6cd1f08e0ad6c2a1d786b7f566e0a37/.github%2Fworkflows%2Fe2e-with-new-api.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fe2e-with-new-api.yml?ref=e411c1eea6cd1f08e0ad6c2a1d786b7f566e0a37",
            "patch": "@@ -1,174 +0,0 @@\n-name: CI - E2E - Containers\n-on:\n-  workflow_dispatch:\n-  workflow_run:\n-    workflows: ['CI - Node.js']\n-    types:\n-      - completed\n-  pull_request:\n-    paths-ignore:\n-      - 'docs/**'\n-    branches:\n-      - 'main'\n-      - 'next-**'\n-      - 'e2e-**'\n-\n-concurrency:\n-  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}\n-  cancel-in-progress: true\n-\n-jobs:\n-  build-client:\n-    name: Build Client\n-    runs-on: ubuntu-22.04\n-    strategy:\n-      matrix:\n-        node-version: [20]\n-\n-    steps:\n-      - name: Checkout Source Files\n-        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n-        with:\n-          submodules: 'recursive'\n-\n-      - name: Checkout client-config\n-        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n-        with:\n-          repository: freeCodeCamp/client-config\n-          path: client-config\n-\n-      - name: Setup pnpm\n-        uses: pnpm/action-setup@a3252b78c470c02df07e9d59298aecedc3ccdd6d #v3.0.0\n-\n-      - name: Use Node.js ${{ matrix.node-version }}\n-        uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8 # v4.0.2\n-        with:\n-          node-version: ${{ matrix.node-version }}\n-          cache: pnpm\n-\n-      - name: Set freeCodeCamp Environment Variables\n-        run: cp sample.env .env\n-\n-      - name: Install and Build\n-        run: |\n-          pnpm install\n-          pnpm run build\n-\n-      - name: Move serve.json to Public Folder\n-        run: cp client-config/serve.json client/public/serve.json\n-\n-      # We tar them for performance reasons - uploading a lot of files is slow.\n-      - name: Tar Files\n-        run: tar -cf client-artifact.tar client/public\n-\n-      - name: Upload Client Artifact\n-        uses: actions/upload-artifact@5d5d22a31266ced268874388b861e4b58bb5c2f3 # v4.3.1\n-        with:\n-          name: client-artifact\n-          path: client-artifact.tar\n-\n-      - name: Upload Webpack Stats\n-        uses: actions/upload-artifact@5d5d22a31266ced268874388b861e4b58bb5c2f3 # v4.3.1\n-        with:\n-          name: webpack-stats\n-          path: client/public/stats.json\n-\n-  build-new-api:\n-    name: Build New Api (Container)\n-    runs-on: ubuntu-22.04\n-\n-    steps:\n-      - name: Checkout Source Files\n-        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n-        with:\n-          submodules: 'recursive'\n-\n-      - name: Create Image\n-        run: |\n-          docker build \\\n-            -t fcc-api \\\n-            -f docker/api/Dockerfile .\n-\n-      - name: Save Image\n-        run: docker save fcc-api > api-artifact.tar\n-\n-      - name: Upload Api Artifact\n-        uses: actions/upload-artifact@5d5d22a31266ced268874388b861e4b58bb5c2f3 # v4.3.1\n-        with:\n-          name: api-artifact\n-          path: api-artifact.tar\n-\n-  playwright-run:\n-    name: Run Playwright Tests (with new Api)\n-    runs-on: ubuntu-22.04\n-    needs: [build-client, build-new-api]\n-    strategy:\n-      fail-fast: false\n-      matrix:\n-        # Extend this to include firefox and webkit once chromium is working.\n-        browsers: [chromium]\n-        node-version: [20]\n-\n-    steps:\n-      - name: Set Action Environment Variables\n-        run: |\n-          echo \"GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}\" >> $GITHUB_ENV\n-\n-      - name: Checkout Source Files\n-        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n-\n-      - uses: actions/download-artifact@c850b930e6ba138125429b7e5c93fc707a7f8427 # v4.1.4\n-\n-      - name: Unpack Client Artifact\n-        run: |\n-          tar -xf client-artifact/client-artifact.tar\n-          rm client-artifact/client-artifact.tar\n-\n-      - name: Load Api Image\n-        run: |\n-          docker load < api-artifact/api-artifact.tar\n-          rm api-artifact/api-artifact.tar\n-\n-      # Cypress calls some pnpm scripts, so we need to install pnpm.\n-      - name: Setup pnpm\n-        uses: pnpm/action-setup@a3252b78c470c02df07e9d59298aecedc3ccdd6d #v3.0.0\n-\n-      - name: Use Node.js ${{ matrix.node-version }}\n-        uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8 # v4.0.2\n-        with:\n-          node-version: ${{ matrix.node-version }}\n-\n-      - name: Install Dependencies\n-        run: pnpm install\n-\n-      - name: Set freeCodeCamp Environment Variables (needed by api)\n-        run: |\n-          cp sample.env .env\n-\n-      - name: Install playwright dependencies\n-        run: npx playwright install --with-deps\n-\n-      - name: Install and Build\n-        run: |\n-          pnpm install\n-          pnpm run create:shared\n-          pnpm run build:curriculum\n-\n-      - name: Start apps\n-        run: |\n-          docker compose up -d\n-          pnpm run serve:client-ci &\n-          sleep 10\n-\n-      - name: Seed Database with Certified User\n-        run: pnpm run seed:certified-user\n-\n-      - name: Run playwright tests\n-        run: npx playwright test --project=${{ matrix.browsers }} --grep-invert 'third-party-donation.spec.ts'\n-\n-      - uses: actions/upload-artifact@v4\n-        if: ${{ !cancelled() }}\n-        with:\n-          name: playwright-report-${{ matrix.browsers }}\n-          path: playwright/reporter\n-          retention-days: 30"
        }
    ],
    "stats": {
        "total": 279,
        "additions": 102,
        "deletions": 177
    }
}