{
    "author": "raisedadead",
    "message": "feat: versioned endpoints on client (#63441)",
    "sha": "c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093",
    "files": [
        {
            "sha": "a9324dd199fee201a7912f45b6961d8d38761494",
            "filename": ".github/workflows/deploy-client.yml",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/.github%2Fworkflows%2Fdeploy-client.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/.github%2Fworkflows%2Fdeploy-client.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fdeploy-client.yml?ref=c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093",
            "patch": "@@ -198,6 +198,13 @@ jobs:\n           echo \"CLIENT_LOCALE=${{ matrix.lang-name-full }}\" >> $GITHUB_ENV\n           echo \"CURRICULUM_LOCALE=${{ matrix.lang-name-full }}\" >> $GITHUB_ENV\n \n+      - name: Create deployment version\n+        id: deployment-version\n+        run: |\n+          DEPLOYMENT_VERSION=$(git rev-parse --short HEAD)-$(date +%Y%m%d)-$(date +%H%M)\n+          echo \"DEPLOYMENT_VERSION=$DEPLOYMENT_VERSION\" >> $GITHUB_ENV\n+          echo \"DEPLOYMENT_VERSION=$DEPLOYMENT_VERSION\" >> $GITHUB_OUTPUT\n+\n       - name: Install and Build\n         env:\n           API_LOCATION: 'https://api.freecodecamp.${{ needs.setup-jobs.outputs.site_tld }}'"
        },
        {
            "sha": "68c08b843c850aa4343d58765997ff3b5d9e5bfc",
            "filename": "client/src/pages/status/version.test.tsx",
            "status": "added",
            "additions": 109,
            "deletions": 0,
            "changes": 109,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Fsrc%2Fpages%2Fstatus%2Fversion.test.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Fsrc%2Fpages%2Fstatus%2Fversion.test.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fpages%2Fstatus%2Fversion.test.tsx?ref=c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093",
            "patch": "@@ -0,0 +1,109 @@\n+import { render, screen } from '@testing-library/react';\n+import React from 'react';\n+import { describe, it, expect, beforeEach, vi } from 'vitest';\n+\n+import VersionEndpoint from './version';\n+\n+interface VersionData {\n+  client: {\n+    version: string;\n+  };\n+  api: {\n+    version: string;\n+    error?: string;\n+  };\n+}\n+\n+// Mock the version utility\n+vi.mock('../../utils/version', () => ({\n+  getVersionObject: vi.fn(() => ({ version: 'client-1.0.0' }))\n+}));\n+\n+// Mock the env config\n+vi.mock('../../../config/env.json', () => ({\n+  default: {\n+    apiLocation: 'http://localhost:3000',\n+    deploymentVersion: 'client-1.0.0'\n+  }\n+}));\n+\n+// Mock fetch\n+global.fetch = vi.fn();\n+\n+describe('VersionEndpoint', () => {\n+  beforeEach(() => {\n+    vi.clearAllMocks();\n+  });\n+\n+  it('should render plain JSON output without HTML wrapper', async () => {\n+    const mockApiResponse = { version: '1.2.3' };\n+\n+    (global.fetch as ReturnType<typeof vi.fn>).mockResolvedValueOnce({\n+      ok: true,\n+      json: () => mockApiResponse\n+    });\n+\n+    render(<VersionEndpoint />);\n+\n+    // Wait for async data to load\n+    await vi.waitFor(() => {\n+      expect(screen.getByText(/\"client\"/)).toBeInTheDocument();\n+    });\n+\n+    // Should only contain a pre element with JSON\n+    const preElement = screen.getByText(/\"client\"/);\n+    expect(preElement).toBeInTheDocument();\n+\n+    // Should not contain any layout elements\n+    expect(screen.queryByRole('banner')).not.toBeInTheDocument();\n+    expect(screen.queryByRole('contentinfo')).not.toBeInTheDocument();\n+    expect(screen.queryByRole('navigation')).not.toBeInTheDocument();\n+\n+    // The pre element should contain valid JSON\n+    const jsonText = preElement?.textContent;\n+    expect(jsonText).toBeTruthy();\n+\n+    const parsed = JSON.parse(jsonText!) as VersionData;\n+    expect(parsed).toHaveProperty('client');\n+    expect(parsed).toHaveProperty('api');\n+    expect(parsed.client).toHaveProperty('version');\n+    expect(parsed.api).toHaveProperty('version');\n+  });\n+\n+  it('should include API error in JSON when fetch fails', async () => {\n+    (global.fetch as ReturnType<typeof vi.fn>).mockRejectedValueOnce(\n+      new Error('Network error')\n+    );\n+\n+    render(<VersionEndpoint />);\n+\n+    await vi.waitFor(() => {\n+      expect(screen.getByText(/\"client\"/)).toBeInTheDocument();\n+    });\n+\n+    const preElement = screen.getByText(/\"client\"/);\n+    const jsonText = preElement?.textContent;\n+    const parsed = JSON.parse(jsonText!) as VersionData;\n+\n+    expect(parsed.api.error).toBe('Network error');\n+  });\n+\n+  it('should include HTTP status error when API returns non-OK status', async () => {\n+    (global.fetch as ReturnType<typeof vi.fn>).mockResolvedValueOnce({\n+      ok: false,\n+      status: 500\n+    });\n+\n+    render(<VersionEndpoint />);\n+\n+    await vi.waitFor(() => {\n+      expect(screen.getByText(/\"client\"/)).toBeInTheDocument();\n+    });\n+\n+    const preElement = screen.getByText(/\"client\"/);\n+    const jsonText = preElement?.textContent;\n+    const parsed = JSON.parse(jsonText!) as VersionData;\n+\n+    expect(parsed.api.error).toBe('HTTP 500');\n+  });\n+});"
        },
        {
            "sha": "d8bdc0891bc031b06eaff5757bb8d8775d5e0eb5",
            "filename": "client/src/pages/status/version.tsx",
            "status": "added",
            "additions": 55,
            "deletions": 0,
            "changes": 55,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Fsrc%2Fpages%2Fstatus%2Fversion.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Fsrc%2Fpages%2Fstatus%2Fversion.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fpages%2Fstatus%2Fversion.tsx?ref=c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093",
            "patch": "@@ -0,0 +1,55 @@\n+import React, { useEffect, useState } from 'react';\n+import { getVersionObject } from '../../utils/version';\n+import envData from '../../../config/env.json';\n+\n+interface VersionData {\n+  client: {\n+    version: string;\n+  };\n+  api: {\n+    version: string;\n+    error?: string;\n+  };\n+}\n+\n+const VersionEndpoint = () => {\n+  const [versionData, setVersionData] = useState<VersionData | null>(null);\n+\n+  useEffect(() => {\n+    const fetchVersions = async () => {\n+      const clientVersion = getVersionObject();\n+\n+      let apiVersion = { version: 'unknown', error: '' };\n+      try {\n+        const response = await fetch(`${envData.apiLocation}/status/version`);\n+        if (response.ok) {\n+          apiVersion = (await response.json()) as {\n+            version: string;\n+            error: string;\n+          };\n+        } else {\n+          apiVersion.error = `HTTP ${response.status}`;\n+        }\n+      } catch (error) {\n+        apiVersion.error =\n+          error instanceof Error ? error.message : 'Failed to fetch';\n+      }\n+\n+      setVersionData({\n+        client: clientVersion,\n+        api: apiVersion\n+      });\n+    };\n+\n+    void fetchVersions();\n+  }, []);\n+\n+  // Return plain JSON\n+  if (!versionData) {\n+    return null;\n+  }\n+\n+  return <pre>{JSON.stringify(versionData, null, 2)}</pre>;\n+};\n+\n+export default VersionEndpoint;"
        },
        {
            "sha": "ecd3565e263380c81ce6552582bb8c6d0db5331b",
            "filename": "client/src/utils/version.test.ts",
            "status": "added",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Fsrc%2Futils%2Fversion.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Fsrc%2Futils%2Fversion.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Fversion.test.ts?ref=c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093",
            "patch": "@@ -0,0 +1,38 @@\n+import { describe, it, expect } from 'vitest';\n+import envData from '../../config/env.json';\n+import { getVersion, getVersionObject } from './version';\n+\n+describe('version utility', () => {\n+  it('should return version string', () => {\n+    const version = getVersion();\n+    expect(typeof version).toBe('string');\n+    expect(version).toBe(envData.deploymentVersion);\n+  });\n+\n+  it('should return version object with correct shape', () => {\n+    const result = getVersionObject();\n+    expect(result).toHaveProperty('version');\n+    expect(typeof result.version).toBe('string');\n+    expect(result.version).toBe(envData.deploymentVersion);\n+  });\n+\n+  it('should return consistent version between getVersion() and getVersionObject()', () => {\n+    const versionString = getVersion();\n+    const versionObject = getVersionObject();\n+    expect(versionObject.version).toBe(versionString);\n+  });\n+\n+  it('should match format from env.json', () => {\n+    const version = getVersion();\n+    // Version should either be a valid string or the default \"unknown\"\n+    expect(version).toBeTruthy();\n+    expect(version.length).toBeGreaterThan(0);\n+  });\n+\n+  it('should return version object in API-compatible format', () => {\n+    const result = getVersionObject();\n+    // Should match the API's /status/version response format\n+    expect(Object.keys(result)).toEqual(['version']);\n+    expect(typeof result.version).toBe('string');\n+  });\n+});"
        },
        {
            "sha": "90d302ca288ff923b7e6a2b504da6539bda29627",
            "filename": "client/src/utils/version.ts",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Fsrc%2Futils%2Fversion.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Fsrc%2Futils%2Fversion.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Fversion.ts?ref=c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093",
            "patch": "@@ -0,0 +1,28 @@\n+/**\n+ * Version information object matching API's /status/version format\n+ */\n+export interface VersionInfo {\n+  version: string;\n+}\n+\n+import envData from '../../config/env.json';\n+\n+/**\n+ * Get the client deployment version as a string\n+ *\n+ * @returns The deployment version or \"unknown\" if not set\n+ *\n+ */\n+export function getVersion(): string {\n+  return envData.deploymentVersion;\n+}\n+\n+/**\n+ * Get the client deployment version as an object matching API format\n+ *\n+ * @returns Object with version field\n+ *\n+ */\n+export function getVersionObject(): VersionInfo {\n+  return { version: getVersion() };\n+}"
        },
        {
            "sha": "42acfe3a899b66a154e8e1d5cd2a960672b95f51",
            "filename": "client/tools/create-env.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Ftools%2Fcreate-env.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Ftools%2Fcreate-env.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Ftools%2Fcreate-env.ts?ref=c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093",
            "patch": "@@ -63,6 +63,7 @@ if (FREECODECAMP_NODE_ENV !== 'development') {\n     'clientLocale',\n     'curriculumLocale',\n     'deploymentEnv',\n+    'deploymentVersion',\n     'environment',\n     'showUpcomingChanges'\n   ];"
        },
        {
            "sha": "239e45ce8b958aaa406751adaef718197fa3e05f",
            "filename": "client/tools/read-env.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Ftools%2Fread-env.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Ftools%2Fread-env.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Ftools%2Fread-env.ts?ref=c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093",
            "patch": "@@ -32,7 +32,8 @@ const {\n   PATREON_CLIENT_ID: patreonClientId,\n   DEPLOYMENT_ENV: deploymentEnv,\n   SHOW_UPCOMING_CHANGES: showUpcomingChanges,\n-  GROWTHBOOK_URI: growthbookUri\n+  GROWTHBOOK_URI: growthbookUri,\n+  DEPLOYMENT_VERSION: deploymentVersion\n } = process.env;\n \n const locations = {\n@@ -74,5 +75,6 @@ export default Object.assign(locations, {\n   growthbookUri:\n     !growthbookUri || growthbookUri === 'api_URI_from_Growthbook_dashboard'\n       ? null\n-      : growthbookUri\n+      : growthbookUri,\n+  deploymentVersion: deploymentVersion || 'unknown'\n });"
        },
        {
            "sha": "6e272b0c7615774bbd94e29f6e6afa7e4707374f",
            "filename": "client/utils/gatsby/layout-selector.test.tsx",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Futils%2Fgatsby%2Flayout-selector.test.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Futils%2Fgatsby%2Flayout-selector.test.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Futils%2Fgatsby%2Flayout-selector.test.tsx?ref=c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093",
            "patch": "@@ -119,4 +119,24 @@ describe('Layout selector', () => {\n     const componentObj = getComponentNameAndProps(Certification, challengePath);\n     expect(componentObj.name).toEqual('CertificationLayout');\n   });\n+\n+  test('Status paths should return raw element without layout', () => {\n+    const TestComponent = () => <div>Test</div>;\n+    const statusPath = '/status/version';\n+\n+    const result = layoutSelector({\n+      element: { type: TestComponent, props: {}, key: '' },\n+      props: {\n+        data: {},\n+        location: {\n+          pathname: statusPath\n+        },\n+        params: { '*': '' },\n+        path: ''\n+      }\n+    });\n+\n+    // The result should be the element directly, not wrapped in a layout\n+    expect(result.type).toBe(TestComponent);\n+  });\n });"
        },
        {
            "sha": "b2c02dc325ce1e3c33a1775c9766635b900cf082",
            "filename": "client/utils/gatsby/layout-selector.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Futils%2Fgatsby%2Flayout-selector.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093/client%2Futils%2Fgatsby%2Flayout-selector.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Futils%2Fgatsby%2Flayout-selector.tsx?ref=c801dcdbcb9a4fb5e1107f588b6d77e5bd10a093",
            "patch": "@@ -27,6 +27,11 @@ export default function layoutSelector({\n \n   const isChallenge = !!props.pageContext?.challengeMeta || isDailyChallenge;\n \n+  // Return raw element for status endpoints without any layout\n+  if (/^\\/status\\//.test(pathname)) {\n+    return element;\n+  }\n+\n   if (element.type === FourOhFourPage) {\n     return (\n       <DefaultLayout pathname={pathname} showFooter={true}>"
        }
    ],
    "stats": {
        "total": 269,
        "additions": 267,
        "deletions": 2
    }
}