{
    "author": "raisedadead",
    "message": "chore(api-server): bye-bye you served us well (#60520)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "16e461385e385f7740a0874aa122bac7275b2f66",
    "files": [
        {
            "sha": "3dd43e316acfa84208147319c4308151753a2616",
            "filename": ".github/labeler.yml",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/.github%2Flabeler.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/.github%2Flabeler.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Flabeler.yml?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -1,14 +1,10 @@\n-'scope: docs':\n-  - docs/**/*\n-\n 'scope: curriculum':\n   - curriculum/challenges/**/*\n \n 'platform: learn':\n   - client/**/*\n \n 'platform: api':\n-  - api-server/**/*\n   - api/**/*\n \n 'scope: tools/scripts':\n@@ -18,8 +14,6 @@\n   - e2e/**/*\n \n 'scope: i18n':\n-  - any: ['curriculum/challenges/**/*', '!curriculum/challenges/english/**/*']\n-  - docs/i18n/**/*\n   - client/i18n/**/*\n   - config/crowdin/**/*\n   - shared/config/i18n/**/*"
        },
        {
            "sha": "0fe872fd1a3864e616f945711fa1dd986abf26eb",
            "filename": ".github/workflows/deploy-legacy.yml",
            "status": "modified",
            "additions": 2,
            "deletions": 91,
            "changes": 93,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/.github%2Fworkflows%2Fdeploy-legacy.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/.github%2Fworkflows%2Fdeploy-legacy.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fdeploy-legacy.yml?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -1,4 +1,4 @@\n-name: CD - Deploy API (Legacy) & Clients\n+name: CD - Deploy - Clients\n \n on:\n   workflow_dispatch:\n@@ -33,98 +33,9 @@ jobs:\n               ;;\n           esac\n \n-  api:\n-    name: API (Legacy) - [${{ needs.setup-jobs.outputs.tgt_env_short }}]\n-    needs: [setup-jobs]\n-    runs-on: ubuntu-22.04\n-    permissions:\n-      deployments: write\n-      contents: read\n-    environment:\n-      name: ${{ needs.setup-jobs.outputs.tgt_env_short }}-api-legacy\n-    env:\n-      TS_USERNAME: ${{ secrets.TS_USERNAME }}\n-      TS_MACHINE_NAME_PREFIX: ${{ secrets.TS_MACHINE_NAME_PREFIX }}\n-    steps:\n-      - name: Setup and connect to Tailscale network\n-        uses: tailscale/github-action@v3\n-        with:\n-          oauth-client-id: ${{ secrets.TS_OAUTH_CLIENT_ID }}\n-          oauth-secret: ${{ secrets.TS_OAUTH_SECRET }}\n-          hostname: gha-${{needs.setup-jobs.outputs.tgt_env_short}}-api-legacy-ci-${{ github.run_id }}\n-          tags: tag:ci\n-          version: latest\n-\n-      - name: Configure SSH & Check Connection\n-        run: |\n-          mkdir -p ~/.ssh\n-          echo \"Host *\n-            UserKnownHostsFile=/dev/null\n-            StrictHostKeyChecking no\" > ~/.ssh/config\n-          chmod 644 ~/.ssh/config\n-          sleep 10\n-          for i in {1..3}; do\n-            TS_MACHINE_NAME=${TS_MACHINE_NAME_PREFIX}-api-${i}\n-            tailscale status | grep -q \"$TS_MACHINE_NAME\" || { echo \"Machine not found\"; exit 1; }\n-            sleep 1\n-            MACHINE_IP=$(tailscale ip -4 $TS_MACHINE_NAME)\n-            ssh $TS_USERNAME@$MACHINE_IP \"uptime\"\n-          done\n-\n-      - name: Deploy API\n-        # [NOTE] Use backslashes for expansion on remote machine, example: \\$NVM_DIR, etc.\n-        run: |\n-          GIT_SOURCE_BRANCH=${{ needs.setup-jobs.outputs.tgt_env_branch }}\n-          for i in {1..3}; do\n-            TS_MACHINE_NAME=${TS_MACHINE_NAME_PREFIX}-api-${i}\n-            REMOTE_SCRIPT=\"\n-              set -e\n-              echo -e '\\nLOG:Deploying API (Legacy) to $TS_MACHINE_NAME...'\n-\n-              echo -e '\\nLOG:Environment setup...'\n-              cd /home/$TS_USERNAME/freeCodeCamp\n-              export NVM_DIR=\\$HOME/.nvm && [ -s \"\\$NVM_DIR/nvm.sh\" ] && source \"\\$NVM_DIR/nvm.sh\"\n-              echo -e '\\nLOG:Checking available Node.js versions...'\n-              nvm ls | grep 'default'\n-              echo -e '\\nLOG:Checking Node.js version...'\n-              node --version\n-\n-              echo -e '\\nLOG:Stopping all PM2 services...'\n-              pm2 stop all\n-\n-              echo -e '\\nLOG:Git operations...'\n-              git status\n-              git clean -f\n-              git fetch --all --prune\n-              git checkout -f $GIT_SOURCE_BRANCH\n-              git reset --hard origin/$GIT_SOURCE_BRANCH\n-              git status\n-\n-              echo -e '\\nLOG:Building...'\n-              npm i -g pnpm@10\n-              pnpm clean:packages\n-              pnpm clean:server\n-              pnpm install\n-              pnpm prebuild\n-              pnpm build:curriculum\n-              pnpm build:server\n-              echo -e '\\nLOG:Build completed.'\n-\n-              echo -e '\\nLOG:Starting PM2 reload...'\n-              pm2 reload './api-server/ecosystem.config.js'\n-              echo -e '\\nLOG:PM2 reload completed.'\n-\n-              pm2 ls\n-              pm2 save\n-              echo -e '\\nLOG:Finished deployment.'\n-            \"\n-            MACHINE_IP=$(tailscale ip -4 $TS_MACHINE_NAME)\n-            ssh $TS_USERNAME@$MACHINE_IP \"$REMOTE_SCRIPT\"\n-          done\n-\n   client:\n     name: Clients - [${{ needs.setup-jobs.outputs.tgt_env_short }}] [${{ matrix.lang-name-short }}]\n-    needs: [setup-jobs, api]\n+    needs: [setup-jobs]\n     runs-on: ubuntu-22.04\n     strategy:\n       fail-fast: false"
        },
        {
            "sha": "7af30c7718d2aa43710fc6fdee7ec44cdbd482b8",
            "filename": ".github/workflows/e2e-playwright.yml",
            "status": "modified",
            "additions": 8,
            "deletions": 100,
            "changes": 108,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/.github%2Fworkflows%2Fe2e-playwright.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/.github%2Fworkflows%2Fe2e-playwright.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fe2e-playwright.yml?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -72,8 +72,8 @@ jobs:\n           name: webpack-stats\n           path: client/public/stats.json\n \n-  build-new-api:\n-    name: Build New Api (Container)\n+  build-api:\n+    name: Build API (Container)\n     runs-on: ubuntu-22.04\n \n     steps:\n@@ -91,108 +91,16 @@ jobs:\n       - name: Save Image\n         run: docker save fcc-api > api-artifact.tar\n \n-      - name: Upload Api Artifact\n+      - name: Upload API Artifact\n         uses: actions/upload-artifact@5d5d22a31266ced268874388b861e4b58bb5c2f3 # v4.3.1\n         with:\n           name: api-artifact\n           path: api-artifact.tar\n \n-  playwright-run-old-api:\n-    name: E2E Test\n+  playwright-run-api:\n+    name: Run Playwright Tests\n     runs-on: ubuntu-22.04\n-    needs: build-client\n-    strategy:\n-      fail-fast: false\n-      matrix:\n-        # Not Mobile Safari until we can get it working. Webkit and Mobile\n-        # Chrome both work, so hopefully there are no Mobile Safari specific\n-        # bugs.\n-        browsers: [chromium, firefox, webkit, Mobile Chrome]\n-        node-version: [20]\n-\n-    services:\n-      mongodb:\n-        image: mongo:8.0\n-        ports:\n-          - 27017:27017\n-      # We need mailhog to catch any emails the api tries to send.\n-      mailhog:\n-        image: mailhog/mailhog\n-        ports:\n-          - 1025:1025 # SMTP server (listens for emails)\n-          - 8025:8025 # HTTP server (so we can make requests to the api)\n-\n-    steps:\n-      - name: Set Action Environment Variables\n-        run: |\n-          echo \"GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}\" >> $GITHUB_ENV\n-\n-      - name: Checkout Source Files\n-        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n-        with:\n-          submodules: 'recursive'\n-\n-      - uses: actions/download-artifact@c850b930e6ba138125429b7e5c93fc707a7f8427 # v4.1.4\n-        with:\n-          name: client-artifact\n-\n-      - name: Unpack Client Artifact\n-        run: |\n-          tar -xf client-artifact.tar\n-          rm client-artifact.tar\n-\n-      - name: Setup pnpm\n-        uses: pnpm/action-setup@a3252b78c470c02df07e9d59298aecedc3ccdd6d #v3.0.0\n-\n-      - name: Use Node.js ${{ matrix.node-version }}\n-        uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8 # v4.0.2\n-        with:\n-          node-version: ${{ matrix.node-version }}\n-\n-      - name: Set freeCodeCamp Environment Variables\n-        run: |\n-          cp sample.env .env\n-\n-      - name: Install and Build\n-        run: |\n-          pnpm install\n-          pnpm run create:shared\n-          pnpm run build:curriculum\n-          pnpm run build:server\n-\n-      - name: Seed Database with Certified User\n-        run: pnpm run seed:certified-user\n-\n-      # start-ci uses pm2, so it needs to be installed globally\n-      - name: Install pm2\n-        run: npm i -g pm2\n-\n-      - name: Install playwright dependencies\n-        run: npx playwright install --with-deps\n-\n-      - name: Run playwright tests\n-        run: |\n-          pnpm run start-ci &\n-          sleep 10\n-          npx playwright test --project=\"${{ matrix.browsers }}\" --grep-invert 'third-party-donation.spec.ts'\n-      - uses: actions/upload-artifact@v4\n-        if: ${{ !cancelled() }}\n-        with:\n-          name: playwright-report-old-api-${{ matrix.browsers }}\n-          path: playwright/reporter\n-          retention-days: 30\n-      - name: Upload screenshots\n-        if: failure()\n-        uses: actions/upload-artifact@v4\n-        with:\n-          name: screenshots-old-api-${{ matrix.browsers }}\n-          path: playwright/test-results\n-          retention-days: 14\n-\n-  playwright-run-new-api:\n-    name: Run Playwright Tests (with new Api)\n-    runs-on: ubuntu-22.04\n-    needs: [build-client, build-new-api]\n+    needs: [build-client, build-api]\n     strategy:\n       fail-fast: false\n       matrix:\n@@ -215,7 +123,7 @@ jobs:\n           tar -xf client-artifact/client-artifact.tar\n           rm client-artifact/client-artifact.tar\n \n-      - name: Load Api Image\n+      - name: Load API Image\n         run: |\n           docker load < api-artifact/api-artifact.tar\n           rm api-artifact/api-artifact.tar\n@@ -261,4 +169,4 @@ jobs:\n         with:\n           name: playwright-report-${{ matrix.browsers }}\n           path: playwright/reporter\n-          retention-days: 30\n+          retention-days: 7"
        },
        {
            "sha": "c21da94ff7c10c486449cb3f68146d279bf2661a",
            "filename": ".github/workflows/e2e-third-party.yml",
            "status": "modified",
            "additions": 108,
            "deletions": 28,
            "changes": 136,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/.github%2Fworkflows%2Fe2e-third-party.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/.github%2Fworkflows%2Fe2e-third-party.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fe2e-third-party.yml?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -11,23 +11,12 @@ concurrency:\n   cancel-in-progress: ${{ !contains(github.ref, 'main') && !contains(github.ref, 'prod-') }}\n \n jobs:\n-  do-everything:\n-    name: Build & Test\n+  build-client:\n+    name: Build Client\n     runs-on: ubuntu-22.04\n     strategy:\n       matrix:\n         node-version: [20]\n-    services:\n-      mongodb:\n-        image: mongo:8.0\n-        ports:\n-          - 27017:27017\n-      # We need mailhog to catch any emails the api tries to send.\n-      mailhog:\n-        image: mailhog/mailhog\n-        ports:\n-          - 1025:1025\n-\n     steps:\n       - name: Checkout Source Files\n         uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n@@ -47,8 +36,7 @@ jobs:\n         uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8 # v4.0.2\n         with:\n           node-version: ${{ matrix.node-version }}\n-          # cypress-io/github-action caches the store, so we should not cache it\n-          # here.\n+          cache: pnpm\n \n       - name: Set freeCodeCamp Environment Variables\n         run: |\n@@ -60,32 +48,124 @@ jobs:\n       - name: Install and Build\n         run: |\n           pnpm install\n-          pnpm run create:shared\n-          pnpm run build:curriculum\n-          pnpm run build:server\n-\n-      - name: Seed Database with Certified User\n-        run: pnpm run seed:certified-user\n+          pnpm run build\n \n       - name: Move serve.json to Public Folder\n         run: cp client-config/serve.json client/public/serve.json\n \n-      # start-ci uses pm2, so it needs to be installed globally\n-      - name: Install pm2\n-        run: npm i -g pm2\n+      - name: Tar Files\n+        run: tar -cf client-artifact.tar client/public\n+\n+      - name: Upload Client Artifact\n+        uses: actions/upload-artifact@5d5d22a31266ced268874388b861e4b58bb5c2f3 # v4.3.1\n+        with:\n+          name: client-artifact\n+          path: client-artifact.tar\n+\n+  build-api:\n+    name: Build API (Container)\n+    runs-on: ubuntu-22.04\n+    steps:\n+      - name: Checkout Source Files\n+        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n+        with:\n+          submodules: 'recursive'\n+\n+      - name: Create Image\n+        run: |\n+          docker build \\\n+            -t fcc-api \\\n+            -f docker/api/Dockerfile .\n+\n+      - name: Save Image\n+        run: docker save fcc-api > api-artifact.tar\n+\n+      - name: Upload API Artifact\n+        uses: actions/upload-artifact@5d5d22a31266ced268874388b861e4b58bb5c2f3 # v4.3.1\n+        with:\n+          name: api-artifact\n+          path: api-artifact.tar\n+\n+  playwright-run-api:\n+    name: Run Playwright 3rd Party Donation Tests\n+    runs-on: ubuntu-22.04\n+    needs: [build-client, build-api]\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        browsers: [chromium]\n+        node-version: [20]\n+    services:\n+      mongodb:\n+        image: mongo:8.0\n+        ports:\n+          - 27017:27017\n+      mailhog:\n+        image: mailhog/mailhog\n+        ports:\n+          - 1025:1025\n+    steps:\n+      - name: Set Action Environment Variables\n+        run: |\n+          echo \"GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}\" >> $GITHUB_ENV\n+\n+      - name: Checkout Source Files\n+        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1\n+\n+      - uses: actions/download-artifact@c850b930e6ba138125429b7e5c93fc707a7f8427 # v4.1.4\n+\n+      - name: Unpack Client Artifact\n+        run: |\n+          tar -xf client-artifact/client-artifact.tar\n+          rm client-artifact/client-artifact.tar\n+\n+      - name: Load API Image\n+        run: |\n+          docker load < api-artifact/api-artifact.tar\n+          rm api-artifact/api-artifact.tar\n+\n+      - name: Setup pnpm\n+        uses: pnpm/action-setup@a3252b78c470c02df07e9d59298aecedc3ccdd6d #v3.0.0\n+\n+      - name: Use Node.js ${{ matrix.node-version }}\n+        uses: actions/setup-node@60edb5dd545a775178f52524783378180af0d1f8 # v4.0.2\n+        with:\n+          node-version: ${{ matrix.node-version }}\n+\n+      - name: Install Dependencies\n+        run: pnpm install\n+\n+      - name: Set freeCodeCamp Environment Variables (needed by api)\n+        run: |\n+          sed '/STRIPE/d; /PAYPAL/d; /PATREON/d;' sample.env > .env\n+          echo 'STRIPE_PUBLIC_KEY=${{ secrets.STRIPE_PUBLIC_KEY }}' >> .env\n+          echo 'PAYPAL_CLIENT_ID=${{ secrets.PAYPAL_CLIENT_ID }}' >> .env\n+          echo 'PATREON_CLIENT_ID=${{ secrets.PATREON_CLIENT_ID }}' >> .env\n \n       - name: Install playwright dependencies\n         run: npx playwright install --with-deps\n \n-      - name: Run playwright tests\n+      - name: Install and Build\n         run: |\n-          pnpm run start-ci &\n+          pnpm install\n+          pnpm run create:shared\n+          pnpm run build:curriculum\n+\n+      - name: Start apps\n+        run: |\n+          docker compose up -d\n+          pnpm run serve:client-ci &\n           sleep 10\n-          npx playwright test third-party-donation.spec.ts --project=${{ matrix.browsers }}\n+\n+      - name: Seed Database with Certified User\n+        run: pnpm run seed:certified-user\n+\n+      - name: Run playwright tests\n+        run: npx playwright test third-party-donation.spec.ts --project=${{ matrix.browsers }}\n \n       - uses: actions/upload-artifact@v4\n         if: ${{ !cancelled() }}\n         with:\n           name: playwright-report-${{ matrix.browsers }}\n           path: playwright/reporter\n-          retention-days: 30\n+          retention-days: 7"
        },
        {
            "sha": "b600541d6a394e8de7785bb180733e9df2f91186",
            "filename": ".gitignore",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/.gitignore",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/.gitignore",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.gitignore?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -63,7 +63,6 @@ $RECYCLE.BIN/\n # Icon must end with two \\r\n Icon\n \n-\n # Thumbnails\n ._*\n \n@@ -172,7 +171,7 @@ utils/slugs.test.js\n ### vim ###\n # Swap\n [._]*.s[a-v][a-z]\n-!*.svg  # comment out if you don't need vector files\n+!*.svg # comment out if you don't need vector files\n [._]*.sw[a-p]\n [._]s[a-rt-v][a-z]\n [._]ss[a-gi-z]\n@@ -198,7 +197,6 @@ tags\n curriculum/curricula.json\n \n ### Additional Folders ###\n-api-server/lib/*\n curriculum/dist\n curriculum/build\n "
        },
        {
            "sha": "b940bf181fd89046d375fcf4355598adbbe239cf",
            "filename": ".prettierignore",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/.prettierignore",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/.prettierignore",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.prettierignore?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -1,6 +1,5 @@\n **/.cache\n **/*fixtures*\n-api-server/lib\n client/**/trending.json\n client/**/search-bar.json\n client/config/*.json"
        },
        {
            "sha": "1e7ee63b3b2611a127a953839b9f8f8ad79cd31e",
            "filename": "api-server/.babelrc",
            "status": "removed",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2F.babelrc",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2F.babelrc",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2F.babelrc?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,16 +0,0 @@\n-{\n-  \"presets\": [\n-    [\n-      \"@babel/preset-env\",\n-      {\n-        \"targets\": {\n-          \"node\": 10\n-        }\n-      }\n-    ]\n-  ],\n-  \"plugins\": [\n-    \"@babel/plugin-proposal-object-rest-spread\",\n-    \"@babel/plugin-proposal-optional-chaining\"\n-  ]\n-}"
        },
        {
            "sha": "ed39e1d9f877fcffb444a98efe8c4ae8666bd6a0",
            "filename": "api-server/.gitignore",
            "status": "removed",
            "additions": 0,
            "deletions": 51,
            "changes": 51,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2F.gitignore",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2F.gitignore",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2F.gitignore?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,51 +0,0 @@\n-lib-cov\n-*~\n-*.seed\n-*.log\n-*.csv\n-*.dat\n-*.out\n-*.pid\n-*.gz\n-*.swp\n-.floo\n-.flooignore\n-builtAssets/\n-pm2.js\n-*.env\n-pids\n-logs\n-results\n-tmp\n-.ds_store\n-.vscode\n-\n-npm-debug.log\n-node_modules\n-compiled\n-.idea\n-*.iml\n-.DS_Store\n-Thumbs.db\n-bower_components\n-main.css\n-bundle.js\n-coverage\n-.remote-sync.json\n-.tern-project\n-\n-server/*.bundle.js\n-public/js/bundle*\n-seed/unpacked\n-\n-*.map\n-\n-// revision manifest\n-server/rev-manifest.json\n-server/manifests/*\n-!server/manifests/README.md\n-\n-webpack-bundle-stats.html\n-server/rev-manifest.json\n-google-credentials.json\n-.vs/*"
        },
        {
            "sha": "aeb15aba4579a97ae86afd719238cfd878cefc9c",
            "filename": "api-server/config/cors-settings.js",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fconfig%2Fcors-settings.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fconfig%2Fcors-settings.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fconfig%2Fcors-settings.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,8 +0,0 @@\n-exports.allowedOrigins = [\n-  'https://www.freecodecamp.dev',\n-  'https://www.freecodecamp.org',\n-  'https://beta.freecodecamp.dev',\n-  'https://beta.freecodecamp.org',\n-  'https://chinese.freecodecamp.dev',\n-  'https://chinese.freecodecamp.org'\n-];"
        },
        {
            "sha": "2f7c1df1bf61940e79679f6d6c18afb15ef65646",
            "filename": "api-server/config/secrets.js",
            "status": "removed",
            "additions": 0,
            "deletions": 96,
            "changes": 96,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fconfig%2Fsecrets.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fconfig%2Fsecrets.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fconfig%2Fsecrets.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,96 +0,0 @@\n-const {\n-  MONGODB,\n-  MONGOHQ_URL,\n-\n-  SESSION_SECRET,\n-  COOKIE_SECRET,\n-  JWT_SECRET,\n-\n-  AUTH0_CLIENT_ID,\n-  AUTH0_CLIENT_SECRET,\n-  AUTH0_DOMAIN,\n-\n-  FACEBOOK_ID,\n-  FACEBOOK_SECRET,\n-\n-  GITHUB_ID,\n-  GITHUB_SECRET,\n-\n-  GOOGLE_ID,\n-  GOOGLE_SECRET,\n-\n-  LINKEDIN_ID,\n-  LINKEDIN_SECRET,\n-\n-  TWITTER_KEY,\n-  TWITTER_SECRET,\n-  TWITTER_TOKEN,\n-  TWITTER_TOKEN_SECRET,\n-\n-  SENTRY_DSN,\n-\n-  STRIPE_PUBLIC_KEY,\n-  STRIPE_SECRET_KEY\n-} = process.env;\n-\n-module.exports = {\n-  db: MONGODB || MONGOHQ_URL,\n-\n-  cookieSecret: COOKIE_SECRET,\n-  jwtSecret: JWT_SECRET,\n-  sessionSecret: SESSION_SECRET,\n-\n-  auth0: {\n-    clientID: AUTH0_CLIENT_ID,\n-    clientSecret: AUTH0_CLIENT_SECRET,\n-    domain: AUTH0_DOMAIN\n-  },\n-\n-  facebook: {\n-    clientID: FACEBOOK_ID,\n-    clientSecret: FACEBOOK_SECRET,\n-    callbackURL: '/auth/facebook/callback',\n-    passReqToCallback: true\n-  },\n-\n-  github: {\n-    clientID: GITHUB_ID,\n-    clientSecret: GITHUB_SECRET,\n-    callbackURL: '/auth/github/callback',\n-    passReqToCallback: true\n-  },\n-\n-  twitter: {\n-    consumerKey: TWITTER_KEY,\n-    consumerSecret: TWITTER_SECRET,\n-    token: TWITTER_TOKEN,\n-    tokenSecret: TWITTER_TOKEN_SECRET,\n-    callbackURL: '/auth/twitter/callback',\n-    passReqToCallback: true\n-  },\n-\n-  google: {\n-    clientID: GOOGLE_ID,\n-    clientSecret: GOOGLE_SECRET,\n-    callbackURL: '/auth/google/callback',\n-    passReqToCallback: true\n-  },\n-\n-  linkedin: {\n-    clientID: LINKEDIN_ID,\n-    clientSecret: LINKEDIN_SECRET,\n-    callbackURL: '/auth/linkedin/callback',\n-    profileFields: ['public-profile-url'],\n-    scope: ['r_basicprofile', 'r_emailaddress'],\n-    passReqToCallback: true\n-  },\n-\n-  sentry: {\n-    dsn: SENTRY_DSN\n-  },\n-\n-  stripe: {\n-    public: STRIPE_PUBLIC_KEY,\n-    secret: STRIPE_SECRET_KEY\n-  }\n-};"
        },
        {
            "sha": "592d95cbbcb49ef96a7d0c70944df23b5e18cdcf",
            "filename": "api-server/ecosystem.config.js",
            "status": "removed",
            "additions": 0,
            "deletions": 35,
            "changes": 35,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fecosystem.config.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fecosystem.config.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fecosystem.config.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,35 +0,0 @@\n-const fs = require('fs');\n-const path = require('path');\n-\n-const dotenv = require('dotenv');\n-\n-const filePath = path.resolve(__dirname, '..', '.env');\n-let env = {};\n-try {\n-  env = dotenv.parse(fs.readFileSync(filePath));\n-} catch (e) {\n-  console.log(\n-    \"If you're setting the env vars in the shell, it should be fine (you can probably ignore the error).\"\n-  );\n-  console.log(e);\n-}\n-// without this, loopback cannot find strong-error-handler. Node can, so we know\n-// there's no _real_ issue, but loopback is not able to find it.\n-const loopbackModuleResolutionHack = path.resolve(\n-  __dirname,\n-  '../node_modules/.pnpm/node_modules'\n-);\n-\n-module.exports = {\n-  apps: [\n-    {\n-      script: `./lib/production-start.js`,\n-      cwd: __dirname,\n-      env: { ...env, NODE_PATH: loopbackModuleResolutionHack },\n-      max_memory_restart: '600M',\n-      instances: 'max',\n-      exec_mode: 'cluster',\n-      name: env.DEPLOYMENT_ENV === 'staging' ? 'dev' : 'org'\n-    }\n-  ]\n-};"
        },
        {
            "sha": "1edcb6800d8701d32c756716b1592c747ad8217a",
            "filename": "api-server/package.json",
            "status": "removed",
            "additions": 0,
            "deletions": 89,
            "changes": 89,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fpackage.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fpackage.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,89 +0,0 @@\n-{\n-  \"name\": \"@freecodecamp/api-server\",\n-  \"version\": \"0.0.1\",\n-  \"description\": \"The freeCodeCamp.org open-source codebase and curriculum\",\n-  \"license\": \"BSD-3-Clause\",\n-  \"private\": true,\n-  \"engines\": {\n-    \"node\": \">=16\",\n-    \"pnpm\": \">=10\"\n-  },\n-  \"repository\": {\n-    \"type\": \"git\",\n-    \"url\": \"git+https://github.com/freeCodeCamp/freeCodeCamp.git\"\n-  },\n-  \"bugs\": {\n-    \"url\": \"https://github.com/freeCodeCamp/freeCodeCamp/issues\"\n-  },\n-  \"homepage\": \"https://github.com/freeCodeCamp/freeCodeCamp#readme\",\n-  \"author\": \"freeCodeCamp <team@freecodecamp.org>\",\n-  \"main\": \"none\",\n-  \"scripts\": {\n-    \"babel-dev-server\": \"babel-node --inspect=0.0.0.0 ./src/server/index.js\",\n-    \"prebuild\": \"pnpm common-setup\",\n-    \"build\": \"babel src --out-dir lib --ignore '/**/*.test.js' --copy-files --no-copy-ignored\",\n-    \"common-setup\": \"pnpm -w run create:shared\",\n-    \"predevelop\": \"pnpm common-setup\",\n-    \"develop\": \"node src/development-start.js\",\n-    \"start\": \"DEBUG=fcc* node lib/production-start.js\"\n-  },\n-  \"dependencies\": {\n-    \"@freecodecamp/loopback-component-passport\": \"1.2.0\",\n-    \"@sentry/node\": \"7.37.1\",\n-    \"@sentry/tracing\": \"7.37.1\",\n-    \"accepts\": \"1.3.8\",\n-    \"body-parser\": \"1.20.0\",\n-    \"compression\": \"1.7.4\",\n-    \"connect-mongo\": \"3.2.0\",\n-    \"cookie-parser\": \"1.4.6\",\n-    \"cors\": \"2.8.5\",\n-    \"csurf\": \"1.11.0\",\n-    \"date-fns\": \"1.30.1\",\n-    \"debug\": \"2.2.0\",\n-    \"dedent\": \"0.7.0\",\n-    \"dotenv\": \"6.2.0\",\n-    \"express-flash\": \"0.0.2\",\n-    \"express-rate-limit\": \"^6.7.0\",\n-    \"express-session\": \"1.17.3\",\n-    \"express-validator\": \"6.14.1\",\n-    \"helmet\": \"3.23.3\",\n-    \"helmet-csp\": \"2.10.0\",\n-    \"joi\": \"17.9.2\",\n-    \"joi-objectid\": \"3.0.1\",\n-    \"jsonwebtoken\": \"8.5.1\",\n-    \"lodash\": \"4.17.21\",\n-    \"loopback\": \"3.28.0\",\n-    \"loopback-boot\": \"2.28.0\",\n-    \"loopback-connector-mongodb\": \"5.6.0\",\n-    \"method-override\": \"3.0.0\",\n-    \"moment\": \"2.29.3\",\n-    \"moment-timezone\": \"0.5.33\",\n-    \"mongodb\": \"3.6.9\",\n-    \"morgan\": \"1.10.0\",\n-    \"nanoid\": \"3.3.4\",\n-    \"no-profanity\": \"^1.4.2\",\n-    \"node-fetch\": \"^2.6.7\",\n-    \"nodemailer-ses-transport\": \"1.5.1\",\n-    \"passport\": \"0.4.1\",\n-    \"passport-auth0\": \"1.4.2\",\n-    \"passport-local\": \"1.0.0\",\n-    \"passport-mock-strategy\": \"2.0.0\",\n-    \"query-string\": \"6.14.0\",\n-    \"rate-limit-mongo\": \"^2.3.2\",\n-    \"rx\": \"4.1.0\",\n-    \"stripe\": \"8.205.0\",\n-    \"strong-error-handler\": \"3.5.0\",\n-    \"uuid\": \"3.4.0\",\n-    \"validator\": \"13.7.0\"\n-  },\n-  \"devDependencies\": {\n-    \"@babel/cli\": \"7.17.10\",\n-    \"@babel/core\": \"7.18.0\",\n-    \"@babel/node\": \"7.17.10\",\n-    \"@babel/plugin-proposal-object-rest-spread\": \"7.18.0\",\n-    \"@babel/plugin-proposal-optional-chaining\": \"7.17.12\",\n-    \"@babel/preset-env\": \"7.18.0\",\n-    \"loopback-component-explorer\": \"6.4.0\",\n-    \"nodemon\": \"2.0.16\"\n-  }\n-}"
        },
        {
            "sha": "fa435086c24e0357071b988b24bf943dd8ba1081",
            "filename": "api-server/src/common/config.global.js",
            "status": "removed",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fconfig.global.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fconfig.global.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Fconfig.global.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,7 +0,0 @@\n-// The path where to mount the REST API app\n-exports.restApiRoot = '/api';\n-//\n-// The URL where the browser client can access the REST API is available\n-// Replace with a full url (including hostname) if your client is being\n-// served from a different server than your REST API.\n-exports.restApiUrl = exports.restApiRoot;"
        },
        {
            "sha": "7b49f5ac06e441ac8c4b0db9910bf4f30a20a844",
            "filename": "api-server/src/common/index.less",
            "status": "removed",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Findex.less",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Findex.less",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Findex.less?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,3 +0,0 @@\n-& {\n-  @import './app/index.less';\n-}"
        },
        {
            "sha": "1e5688d5e0a330fee58c880e0d5bd6fe068b0d66",
            "filename": "api-server/src/common/models/User-Credential.js",
            "status": "removed",
            "additions": 0,
            "deletions": 94,
            "changes": 94,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Credential.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Credential.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Credential.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,94 +0,0 @@\n-import debug from 'debug';\n-import { Observable } from 'rx';\n-\n-import {\n-  createUserUpdatesFromProfile,\n-  getSocialProvider\n-} from '../../server/utils/auth';\n-import { observeMethod, observeQuery } from '../../server/utils/rx';\n-\n-const log = debug('fcc:models:UserCredential');\n-module.exports = function (UserCredential) {\n-  UserCredential.link = function (\n-    userId,\n-    _provider,\n-    authScheme,\n-    profile,\n-    credentials,\n-    options = {},\n-    cb\n-  ) {\n-    if (typeof options === 'function' && !cb) {\n-      cb = options;\n-      options = {};\n-    }\n-    const User = UserCredential.app.models.User;\n-    const findCred = observeMethod(UserCredential, 'findOne');\n-    const createCred = observeMethod(UserCredential, 'create');\n-\n-    const provider = getSocialProvider(_provider);\n-    const query = {\n-      where: {\n-        provider: provider,\n-        externalId: profile.id\n-      }\n-    };\n-\n-    // find createCred if they exist\n-    // if not create it\n-    // if yes, update credentials\n-    // also if github\n-    //  update profile\n-    //  update username\n-    //  update picture\n-    log('link query', query);\n-    return findCred(query)\n-      .flatMap(_credentials => {\n-        const modified = new Date();\n-        const updateUser = new Promise((resolve, reject) => {\n-          User.find({ id: userId }, (err, user) => {\n-            if (err) {\n-              return reject(err);\n-            }\n-            return user.updateAttributes(\n-              createUserUpdatesFromProfile(provider, profile),\n-              updateErr => {\n-                if (updateErr) {\n-                  return reject(updateErr);\n-                }\n-                return resolve();\n-              }\n-            );\n-          });\n-        });\n-        let updateCredentials;\n-        if (!_credentials) {\n-          updateCredentials = createCred({\n-            provider,\n-            externalId: profile.id,\n-            authScheme,\n-            // we no longer want to keep the profile\n-            // this is information we do not need or use\n-            profile: null,\n-            credentials,\n-            userId,\n-            created: modified,\n-            modified\n-          });\n-        } else {\n-          _credentials.credentials = credentials;\n-          updateCredentials = observeQuery(_credentials, 'updateAttributes', {\n-            profile: null,\n-            credentials,\n-            modified\n-          });\n-        }\n-        return Observable.combineLatest(\n-          Observable.fromPromise(updateUser),\n-          updateCredentials,\n-          (_, credentials) => credentials\n-        );\n-      })\n-      .subscribe(credentials => cb(null, credentials), cb);\n-  };\n-};"
        },
        {
            "sha": "b3ed7d7e48da611afc72527659bb157166631ed3",
            "filename": "api-server/src/common/models/User-Credential.json",
            "status": "removed",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Credential.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Credential.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Credential.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,16 +0,0 @@\n-{\n-  \"name\": \"userCredential\",\n-  \"plural\": \"userCredentials\",\n-  \"base\": \"UserCredential\",\n-  \"properties\": {},\n-  \"validations\": [],\n-  \"relations\": {\n-    \"user\": {\n-      \"type\": \"belongsTo\",\n-      \"model\": \"user\",\n-      \"foreignKey\": \"userId\"\n-    }\n-  },\n-  \"acls\": [],\n-  \"methods\": {}\n-}"
        },
        {
            "sha": "8905c2edb69dcb821b86b0c3eae1b33db916c6a2",
            "filename": "api-server/src/common/models/User-Identity.js",
            "status": "removed",
            "additions": 0,
            "deletions": 158,
            "changes": 158,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Identity.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Identity.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Identity.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,158 +0,0 @@\n-import dedent from 'dedent';\n-import { Observable } from 'rx';\n-// import debug from 'debug';\n-import { isEmail } from 'validator';\n-\n-import { wrapHandledError } from '../../server/utils/create-handled-error.js';\n-import { observeMethod, observeQuery } from '../../server/utils/rx';\n-\n-// const log = debug('fcc:models:userIdent');\n-\n-export function ensureLowerCaseEmail(profile) {\n-  return typeof profile?.emails?.[0]?.value === 'string'\n-    ? profile.emails[0].value.toLowerCase()\n-    : '';\n-}\n-\n-export default function initializeUserIdent(UserIdent) {\n-  UserIdent.on('dataSourceAttached', () => {\n-    UserIdent.findOne$ = observeMethod(UserIdent, 'findOne');\n-  });\n-\n-  UserIdent.login = function (\n-    _provider,\n-    authScheme,\n-    profile,\n-    credentials,\n-    options,\n-    cb\n-  ) {\n-    const User = UserIdent.app.models.User;\n-    const AccessToken = UserIdent.app.models.AccessToken;\n-    options = options || {};\n-    if (typeof options === 'function' && !cb) {\n-      cb = options;\n-      options = {};\n-    }\n-\n-    // get the social provider data and the external id from auth0\n-    profile.id = profile.id || profile.openid;\n-    const auth0IdString = '' + profile.id;\n-    const [provider, socialExtId] = auth0IdString.split('|');\n-    const query = {\n-      where: {\n-        provider: provider,\n-        externalId: socialExtId\n-      },\n-      include: 'user'\n-    };\n-    // get the email from the auth0 (its expected from social providers)\n-    const email = ensureLowerCaseEmail(profile);\n-\n-    if (!isEmail('' + email)) {\n-      throw wrapHandledError(\n-        new Error('invalid or empty email received from auth0'),\n-        {\n-          message: dedent`\n-    ${provider} did not return a valid email address.\n-    Please try again with a different account that has an\n-    email associated with it your update your settings on ${provider}, for us to be able to retrieve your email.\n-          `,\n-          type: 'info',\n-          redirectTo: '/'\n-        }\n-      );\n-    }\n-\n-    if (provider === 'email') {\n-      return User.findOne$({ where: { email } })\n-        .flatMap(user => {\n-          return user\n-            ? Observable.of(user)\n-            : User.create$({ email }).toPromise();\n-        })\n-        .flatMap(user => {\n-          if (!user) {\n-            throw wrapHandledError(\n-              new Error('could not find or create a user'),\n-              {\n-                message: dedent`\n-    We could not find or create a user with that email address.\n-                `,\n-                type: 'info',\n-                redirectTo: '/'\n-              }\n-            );\n-          }\n-          const createToken = observeQuery(AccessToken, 'create', {\n-            userId: user.id,\n-            created: new Date(),\n-            ttl: user.constructor.settings.ttl\n-          });\n-          const updateUserPromise = new Promise((resolve, reject) =>\n-            user.updateAttributes(\n-              {\n-                emailVerified: true,\n-                emailAuthLinkTTL: null,\n-                emailVerifyTTL: null\n-              },\n-              err => {\n-                if (err) {\n-                  return reject(err);\n-                }\n-                return resolve();\n-              }\n-            )\n-          );\n-          return Observable.combineLatest(\n-            Observable.of(user),\n-            createToken,\n-            Observable.fromPromise(updateUserPromise),\n-            (user, token) => ({ user, token })\n-          );\n-        })\n-        .subscribe(({ user, token }) => cb(null, user, null, token), cb);\n-    } else {\n-      return UserIdent.findOne$(query)\n-        .flatMap(identity => {\n-          return identity\n-            ? Observable.of(identity.user())\n-            : User.findOne$({ where: { email } }).flatMap(user => {\n-                return user\n-                  ? Observable.of(user)\n-                  : User.create$({ email }).toPromise();\n-              });\n-        })\n-        .flatMap(user => {\n-          const createToken = observeQuery(AccessToken, 'create', {\n-            userId: user.id,\n-            created: new Date(),\n-            ttl: user.constructor.settings.ttl\n-          });\n-          const updateUser = new Promise((resolve, reject) =>\n-            user.updateAttributes(\n-              {\n-                email: email,\n-                emailVerified: true,\n-                emailAuthLinkTTL: null,\n-                emailVerifyTTL: null\n-              },\n-              err => {\n-                if (err) {\n-                  return reject(err);\n-                }\n-                return resolve();\n-              }\n-            )\n-          );\n-          return Observable.combineLatest(\n-            Observable.of(user),\n-            createToken,\n-            Observable.fromPromise(updateUser),\n-            (user, token) => ({ user, token })\n-          );\n-        })\n-        .subscribe(({ user, token }) => cb(null, user, null, token), cb);\n-    }\n-  };\n-}"
        },
        {
            "sha": "3288b92b8108ad468466a95636a2a606264aa27c",
            "filename": "api-server/src/common/models/User-Identity.json",
            "status": "removed",
            "additions": 0,
            "deletions": 23,
            "changes": 23,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Identity.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Identity.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Identity.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,23 +0,0 @@\n-{\n-  \"name\": \"userIdentity\",\n-  \"plural\": \"userIdentities\",\n-  \"base\": \"UserIdentity\",\n-  \"properties\": {},\n-  \"validations\": [],\n-  \"relations\": {\n-    \"user\": {\n-      \"type\": \"belongsTo\",\n-      \"model\": \"user\",\n-      \"foreignKey\": \"userId\"\n-    }\n-  },\n-  \"acls\": [\n-    {\n-      \"accessType\": \"*\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"DENY\"\n-    }\n-  ],\n-  \"methods\": {}\n-}"
        },
        {
            "sha": "7c5b66a0c4298fc295b77418ce95d567fe8e29e2",
            "filename": "api-server/src/common/models/User-Identity.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 29,
            "changes": 29,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Identity.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Identity.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Fmodels%2FUser-Identity.test.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,29 +0,0 @@\n-import { ensureLowerCaseEmail } from './User-Identity';\n-\n-test('returns lowercase email when one exists', () => {\n-  const profile = {\n-    id: 2,\n-    emails: [{ value: 'Example@Mail.com', name: 'John Doe' }]\n-  };\n-  expect(ensureLowerCaseEmail(profile)).toBe('example@mail.com');\n-});\n-\n-test('returns empty string when value is undefined', () => {\n-  const profile = {\n-    id: 4,\n-    emails: []\n-  };\n-  expect(ensureLowerCaseEmail(profile)).toBe('');\n-});\n-\n-test('returns empty string when emails is undefined', () => {\n-  const profile = {\n-    id: 5\n-  };\n-  expect(ensureLowerCaseEmail(profile)).toBe('');\n-});\n-\n-test('returns empty string when profile is undefined', () => {\n-  let profile;\n-  expect(ensureLowerCaseEmail(profile)).toBe('');\n-});"
        },
        {
            "sha": "f168fa5da0fff1dde2dc0e34f30db222a5c4fff2",
            "filename": "api-server/src/common/models/block.js",
            "status": "removed",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2Fblock.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2Fblock.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Fmodels%2Fblock.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,9 +0,0 @@\n-import { Observable } from 'rx';\n-\n-export default function initializeBlock(Block) {\n-  Block.on('dataSourceAttached', () => {\n-    Block.findOne$ = Observable.fromNodeCallback(Block.findOne, Block);\n-    Block.findById$ = Observable.fromNodeCallback(Block.findById, Block);\n-    Block.find$ = Observable.fromNodeCallback(Block.find, Block);\n-  });\n-}"
        },
        {
            "sha": "94e94c4a05ad8126b582bd827b83f6f3b1491688",
            "filename": "api-server/src/common/models/block.json",
            "status": "removed",
            "additions": 0,
            "deletions": 53,
            "changes": 53,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2Fblock.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2Fblock.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Fmodels%2Fblock.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,53 +0,0 @@\n-{\n-  \"name\": \"block\",\n-  \"base\": \"PersistedModel\",\n-  \"idInjection\": true,\n-  \"options\": {\n-    \"validateUpsert\": true\n-  },\n-  \"properties\": {\n-    \"superBlock\": {\n-      \"type\": \"string\",\n-      \"required\": true,\n-      \"description\": \"The super block that this block belongs to\"\n-    },\n-    \"order\": {\n-      \"type\": \"number\",\n-      \"required\": true,\n-      \"description\": \"The order in which this block appears\"\n-    },\n-    \"name\": {\n-      \"type\": \"string\",\n-      \"required\": true,\n-      \"description\": \"The name of this block derived from the title, suitable for regex search\"\n-    },\n-    \"superOrder\": {\n-      \"type\": \"number\",\n-      \"required\": true\n-    },\n-    \"dashedName\": {\n-      \"type\": \"string\",\n-      \"required\": true,\n-      \"description\": \"Generated from the title to be URL friendly\"\n-    },\n-    \"title\": {\n-      \"type\": \"string\",\n-      \"required\": true,\n-      \"description\": \"The title of this block, suitable for display\"\n-    },\n-    \"time\": {\n-      \"type\": \"string\",\n-      \"required\": false\n-    }\n-  },\n-  \"validations\": [],\n-  \"relations\": {\n-    \"challenges\": {\n-      \"type\": \"hasMany\",\n-      \"model\": \"challenge\",\n-      \"foreignKey\": \"blockId\"\n-    }\n-  },\n-  \"acls\": [],\n-  \"methods\": {}\n-}"
        },
        {
            "sha": "753d4adfceace2e12ffc14800f72979fda762a9e",
            "filename": "api-server/src/common/models/challenge.json",
            "status": "removed",
            "additions": 0,
            "deletions": 135,
            "changes": 135,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2Fchallenge.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2Fchallenge.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Fmodels%2Fchallenge.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,135 +0,0 @@\n-{\n-  \"name\": \"challenge\",\n-  \"base\": \"PersistedModel\",\n-  \"idInjection\": true,\n-  \"trackChanges\": false,\n-  \"properties\": {\n-    \"id\": {\n-      \"type\": \"string\",\n-      \"id\": true\n-    },\n-    \"name\": {\n-      \"type\": \"string\",\n-      \"index\": {\n-        \"mongodb\": {\n-          \"unique\": true,\n-          \"background\": true\n-        }\n-      }\n-    },\n-    \"title\": {\n-      \"type\": \"string\"\n-    },\n-    \"order\": {\n-      \"type\": \"number\"\n-    },\n-    \"suborder\": {\n-      \"type\": \"number\"\n-    },\n-    \"checksum\": {\n-      \"type\": \"number\"\n-    },\n-    \"isComingSoon\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Challenge shows in production, but is unreachable and disabled. Is reachable in beta/dev only if isBeta flag is set\"\n-    },\n-    \"dashedName\": {\n-      \"type\": \"string\"\n-    },\n-    \"superBlock\": {\n-      \"type\": \"string\",\n-      \"description\": \"Used for ordering challenge blocks in map\"\n-    },\n-    \"superOrder\": {\n-      \"type\": \"number\",\n-      \"description\": \"Used to determine super block order, set by prepending two digit number to super block folder name\"\n-    },\n-    \"block\": {\n-      \"type\": \"string\"\n-    },\n-    \"difficulty\": {\n-      \"type\": \"string\"\n-    },\n-    \"description\": {\n-      \"type\": \"string\"\n-    },\n-    \"tests\": {\n-      \"type\": \"array\"\n-    },\n-    \"head\": {\n-      \"type\": \"string\",\n-      \"description\": \"Appended to user code\",\n-      \"default\": \"\"\n-    },\n-    \"tail\": {\n-      \"type\": \"string\",\n-      \"description\": \"Prepended to user code\",\n-      \"default\": \"\"\n-    },\n-    \"helpRoom\": {\n-      \"type\": \"string\",\n-      \"description\": \"Gitter help chatroom this challenge belongs too. Must be PascalCase\",\n-      \"default\": \"Help\"\n-    },\n-    \"fileName\": {\n-      \"type\": \"string\",\n-      \"description\": \"Filename challenge comes from. Used in dev mode\"\n-    },\n-    \"challengeSeed\": {\n-      \"type\": \"array\"\n-    },\n-    \"challengeType\": {\n-      \"type\": \"number\"\n-    },\n-    \"solutions\": {\n-      \"type\": \"array\",\n-      \"default\": []\n-    },\n-    \"guideUrl\": {\n-      \"type\": \"string\",\n-      \"description\": \"Used to link to an article in the FCC guide\"\n-    },\n-    \"required\": {\n-      \"type\": [\n-        {\n-          \"type\": {\n-            \"link\": {\n-              \"type\": \"string\",\n-              \"description\": \"Used for css files\"\n-            },\n-            \"src\": {\n-              \"type\": \"string\",\n-              \"description\": \"Used for script files\"\n-            },\n-            \"crossDomain\": {\n-              \"type\": \"boolean\",\n-              \"description\": \"Files coming from freeCodeCamp must mark this true\"\n-            }\n-          }\n-        }\n-      ],\n-      \"default\": []\n-    },\n-    \"template\": {\n-      \"type\": \"string\",\n-      \"description\": \"A template to render the compiled challenge source into. This template uses template literal delimiter, i.e. ${ foo }\"\n-    }\n-  },\n-  \"validations\": [],\n-  \"relations\": {},\n-  \"acls\": [\n-    {\n-      \"accessType\": \"*\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"DENY\"\n-    },\n-    {\n-      \"accessType\": \"READ\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"ALLOW\"\n-    }\n-  ],\n-  \"methods\": {}\n-}"
        },
        {
            "sha": "56e67ab78ad9f7f92f6e13f2092e945872bc66e1",
            "filename": "api-server/src/common/models/user.js",
            "status": "removed",
            "additions": 0,
            "deletions": 937,
            "changes": 937,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2Fuser.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2Fuser.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Fmodels%2Fuser.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,937 +0,0 @@\n-/**\n- *\n- * Any ref to fixCompletedChallengesItem should be removed post\n- * a db migration to fix all completedChallenges\n- *\n- */\n-\n-import debugFactory from 'debug';\n-import dedent from 'dedent';\n-import _ from 'lodash';\n-import moment from 'moment';\n-import { customAlphabet } from 'nanoid';\n-import { Observable } from 'rx';\n-import uuid from 'uuid/v4';\n-import { isEmail } from 'validator';\n-\n-import { isProfane } from 'no-profanity';\n-import { blocklistedUsernames } from '../../../../shared/config/constants';\n-\n-import { wrapHandledError } from '../../server/utils/create-handled-error.js';\n-import {\n-  setAccessTokenToResponse,\n-  removeCookies\n-} from '../../server/utils/getSetAccessToken';\n-import { saveUser, observeMethod } from '../../server/utils/rx.js';\n-import { getEmailSender } from '../../server/utils/url-utils';\n-import {\n-  fixCompletedChallengeItem,\n-  getEncodedEmail,\n-  getWaitMessage,\n-  renderEmailChangeEmail,\n-  renderSignUpEmail,\n-  renderSignInEmail\n-} from '../utils';\n-\n-const log = debugFactory('fcc:models:user');\n-const BROWNIEPOINTS_TIMEOUT = [1, 'hour'];\n-const nanoidCharSet =\n-  '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n-const nanoid = customAlphabet(nanoidCharSet, 21);\n-\n-const createEmailError = redirectTo =>\n-  wrapHandledError(new Error('email format is invalid'), {\n-    type: 'info',\n-    message: 'Please check to make sure the email is a valid email address.',\n-    redirectTo\n-  });\n-\n-function destroyAll(id, Model) {\n-  return Observable.fromNodeCallback(Model.destroyAll, Model)({ userId: id });\n-}\n-\n-export function ensureLowerCaseString(maybeString) {\n-  return (maybeString && maybeString.toLowerCase()) || '';\n-}\n-\n-function buildCompletedChallengesUpdate(completedChallenges, project) {\n-  const key = Object.keys(project)[0];\n-  const solutions = project[key];\n-  const solutionKeys = Object.keys(solutions);\n-  const currentCompletedChallenges = [\n-    ...completedChallenges.map(fixCompletedChallengeItem)\n-  ];\n-  const currentCompletedProjects = currentCompletedChallenges.filter(({ id }) =>\n-    solutionKeys.includes(id)\n-  );\n-  const now = Date.now();\n-  const update = solutionKeys.reduce((update, currentId) => {\n-    const indexOfCurrentId = _.findIndex(update, ({ id }) => id === currentId);\n-    const isCurrentlyCompleted = indexOfCurrentId !== -1;\n-    if (isCurrentlyCompleted) {\n-      update[indexOfCurrentId] = {\n-        ..._.find(update, ({ id }) => id === currentId),\n-        solution: solutions[currentId]\n-      };\n-    }\n-    if (!isCurrentlyCompleted) {\n-      return [\n-        ...update,\n-        {\n-          id: currentId,\n-          solution: solutions[currentId],\n-          challengeType: 3,\n-          completedDate: now\n-        }\n-      ];\n-    }\n-    return update;\n-  }, currentCompletedProjects);\n-  const updatedExisting = _.uniqBy(\n-    [...update, ...currentCompletedChallenges],\n-    'id'\n-  );\n-  return {\n-    updated: updatedExisting,\n-    isNewCompletionCount: updatedExisting.length - completedChallenges.length\n-  };\n-}\n-\n-function isTheSame(val1, val2) {\n-  return val1 === val2;\n-}\n-\n-function getAboutProfile({\n-  username,\n-  usernameDisplay,\n-  githubProfile: github,\n-  progressTimestamps = [],\n-  bio\n-}) {\n-  return {\n-    username: usernameDisplay || username,\n-    github,\n-    browniePoints: progressTimestamps.length,\n-    bio\n-  };\n-}\n-\n-function nextTick(fn) {\n-  return process.nextTick(fn);\n-}\n-\n-const getRandomNumber = () => Math.random();\n-\n-function populateRequiredFields(user) {\n-  user.usernameDisplay = user.username.trim();\n-  user.username = user.usernameDisplay.toLowerCase();\n-  user.email =\n-    typeof user.email === 'string'\n-      ? user.email.trim().toLowerCase()\n-      : user.email;\n-\n-  if (!user.progressTimestamps) {\n-    user.progressTimestamps = [];\n-  }\n-\n-  if (user.progressTimestamps.length === 0) {\n-    user.progressTimestamps.push(Date.now());\n-  }\n-\n-  if (!user.externalId) {\n-    user.externalId = uuid();\n-  }\n-\n-  if (!user.unsubscribeId) {\n-    user.unsubscribeId = nanoid();\n-  }\n-  return;\n-}\n-\n-export default function initializeUser(User) {\n-  // set salt factor for passwords\n-  User.settings.saltWorkFactor = 5;\n-  // set user.rand to random number\n-  User.definition.rawProperties.rand.default = getRandomNumber;\n-  User.definition.properties.rand.default = getRandomNumber;\n-  // increase user accessToken ttl to 900 days\n-  User.settings.ttl = 900 * 24 * 60 * 60 * 1000;\n-  // Sets ttl to 900 days for mobile login created access tokens\n-  User.settings.maxTTL = 900 * 24 * 60 * 60 * 1000;\n-\n-  // username should not be in blocklist\n-  User.validatesExclusionOf('username', {\n-    in: blocklistedUsernames,\n-    message: 'is not available'\n-  });\n-\n-  // username should be unique\n-  User.validatesUniquenessOf('username');\n-  User.settings.emailVerificationRequired = false;\n-\n-  User.on('dataSourceAttached', () => {\n-    User.findOne$ = Observable.fromNodeCallback(User.findOne, User);\n-    User.count$ = Observable.fromNodeCallback(User.count, User);\n-    User.create$ = Observable.fromNodeCallback(User.create.bind(User));\n-    User.prototype.createAccessToken$ = Observable.fromNodeCallback(\n-      User.prototype.createAccessToken\n-    );\n-  });\n-\n-  User.observe('before save', function (ctx) {\n-    const beforeCreate = Observable.of(ctx)\n-      .filter(({ isNewInstance }) => isNewInstance)\n-      // User.create\n-      .map(({ instance }) => instance)\n-      .flatMap(user => {\n-        // note(berks): we now require all new users to supply an email\n-        // this was not always the case\n-        if (typeof user.email !== 'string' || !isEmail(user.email)) {\n-          throw createEmailError();\n-        }\n-        // assign random username to new users\n-        user.username = 'fcc' + uuid();\n-        populateRequiredFields(user);\n-        return Observable.fromPromise(User.doesExist(null, user.email)).do(\n-          exists => {\n-            if (exists) {\n-              throw wrapHandledError(new Error('user already exists'), {\n-                redirectTo: `${process.env.API_LOCATION}/signin`,\n-                message: dedent`\n-        The ${user.email} email address is already associated with an account.\n-        Try signing in with it here instead.\n-                  `\n-              });\n-            }\n-          }\n-        );\n-      })\n-      .ignoreElements();\n-\n-    const updateOrSave = Observable.of(ctx)\n-      // not new\n-      .filter(({ isNewInstance }) => !isNewInstance)\n-      .map(({ instance }) => instance)\n-      // is update or save user\n-      .filter(Boolean)\n-      .do(user => {\n-        // Some old accounts will not have emails associated with them\n-        // we verify only if the email field is populated\n-        if (user.email && !isEmail(user.email)) {\n-          throw createEmailError();\n-        }\n-        populateRequiredFields(user);\n-      })\n-      .ignoreElements();\n-    return Observable.merge(beforeCreate, updateOrSave).toPromise();\n-  });\n-\n-  // remove lingering user identities before deleting user\n-  User.observe('before delete', function (ctx, next) {\n-    const UserIdentity = User.app.models.UserIdentity;\n-    const UserCredential = User.app.models.UserCredential;\n-    log('removing user', ctx.where);\n-    var id = ctx.where && ctx.where.id ? ctx.where.id : null;\n-    if (!id) {\n-      return next();\n-    }\n-    return Observable.combineLatest(\n-      destroyAll(id, UserIdentity),\n-      destroyAll(id, UserCredential),\n-      function (identData, credData) {\n-        return {\n-          identData: identData,\n-          credData: credData\n-        };\n-      }\n-    ).subscribe(\n-      function (data) {\n-        log('deleted', data);\n-      },\n-      function (err) {\n-        log('error deleting user %s stuff', id, err);\n-        next(err);\n-      },\n-      function () {\n-        log('user stuff deleted for user %s', id);\n-        next();\n-      }\n-    );\n-  });\n-\n-  log('setting up user hooks');\n-  // overwrite lb confirm\n-  User.confirm = function (uid, token, redirectTo) {\n-    return this.findById(uid).then(user => {\n-      if (!user) {\n-        throw wrapHandledError(new Error(`User not found: ${uid}`), {\n-          // standard oops\n-          type: 'info',\n-          redirectTo\n-        });\n-      }\n-      if (user.verificationToken !== token) {\n-        throw wrapHandledError(new Error(`Invalid token: ${token}`), {\n-          type: 'info',\n-          message: dedent`\n-                Looks like you have clicked an invalid link.\n-                Please sign in and request a fresh one.\n-              `,\n-          redirectTo\n-        });\n-      }\n-      return new Promise((resolve, reject) =>\n-        user.updateAttributes(\n-          {\n-            email: user.newEmail,\n-            emailVerified: true,\n-            emailVerifyTTL: null,\n-            newEmail: null,\n-            verificationToken: null\n-          },\n-          err => {\n-            if (err) {\n-              return reject(err);\n-            }\n-            return resolve();\n-          }\n-        )\n-      );\n-    });\n-  };\n-\n-  User.prototype.loginByRequest = function loginByRequest(req, res) {\n-    const {\n-      query: { emailChange }\n-    } = req;\n-    const createToken = this.createAccessToken$().do(accessToken => {\n-      if (accessToken && accessToken.id) {\n-        setAccessTokenToResponse({ accessToken }, req, res);\n-      }\n-    });\n-    let data = {\n-      emailVerified: true,\n-      emailAuthLinkTTL: null,\n-      emailVerifyTTL: null\n-    };\n-    if (emailChange && this.newEmail) {\n-      data = {\n-        ...data,\n-        email: this.newEmail,\n-        newEmail: null\n-      };\n-    }\n-    const updateUser = new Promise((resolve, reject) =>\n-      this.updateAttributes(data, err => {\n-        if (err) {\n-          return reject(err);\n-        }\n-        return resolve();\n-      })\n-    );\n-    return Observable.combineLatest(\n-      createToken,\n-      Observable.fromPromise(updateUser),\n-      req.logIn(this),\n-      accessToken => accessToken\n-    );\n-  };\n-\n-  User.prototype.mobileLoginByRequest = function mobileLoginByRequest(\n-    req,\n-    res\n-  ) {\n-    return new Promise((resolve, reject) =>\n-      this.createAccessToken({}, (err, accessToken) => {\n-        if (err) {\n-          return reject(err);\n-        }\n-        setAccessTokenToResponse({ accessToken }, req, res);\n-        return resolve(accessToken);\n-      })\n-    );\n-  };\n-\n-  User.afterRemote('logout', function ({ req, res }, result, next) {\n-    removeCookies(req, res);\n-    next();\n-  });\n-\n-  User.doesExist = function doesExist(username, email) {\n-    if (!username && (!email || !isEmail(email))) {\n-      return Promise.resolve(false);\n-    }\n-    log('check if username is available');\n-    // check to see if username is on blocklist\n-\n-    if (\n-      username &&\n-      (blocklistedUsernames.includes(username) || isProfane(username))\n-    ) {\n-      return Promise.resolve(true);\n-    }\n-\n-    var where = {};\n-    if (username) {\n-      where.username = username.toLowerCase();\n-    } else {\n-      where.email = email ? email.toLowerCase() : email;\n-    }\n-    log('where', where);\n-    return User.count(where).then(count => count > 0);\n-  };\n-\n-  User.about = function about(username, cb) {\n-    if (!username) {\n-      // Zalgo!!\n-      return nextTick(() => {\n-        cb(null, {});\n-      });\n-    }\n-    return User.findOne({ where: { username } }, (err, user) => {\n-      if (err) {\n-        return cb(err);\n-      }\n-      if (!user || user.username !== username) {\n-        return cb(null, {});\n-      }\n-      const aboutUser = getAboutProfile(user);\n-      return cb(null, aboutUser);\n-    });\n-  };\n-\n-  User.remoteMethod('about', {\n-    description: 'get public info about user',\n-    accepts: [\n-      {\n-        arg: 'username',\n-        type: 'string'\n-      }\n-    ],\n-    returns: [\n-      {\n-        arg: 'about',\n-        type: 'object'\n-      }\n-    ],\n-    http: {\n-      path: '/about',\n-      verb: 'get'\n-    }\n-  });\n-\n-  User.prototype.createAuthToken = function createAuthToken({ ttl } = {}) {\n-    return Observable.fromNodeCallback(\n-      this.authTokens.create.bind(this.authTokens)\n-    )({ ttl });\n-  };\n-\n-  User.prototype.createDonation = function createDonation(donation = {}) {\n-    return Observable.fromNodeCallback(\n-      this.donations.create.bind(this.donations)\n-    )(donation).do(() =>\n-      this.updateAttributes({\n-        isDonating: true,\n-        donationEmails: [...(this.donationEmails || []), donation.email]\n-      })\n-    );\n-  };\n-\n-  function requestCompletedChallenges() {\n-    return this.getCompletedChallenges$();\n-  }\n-\n-  User.prototype.requestCompletedChallenges = requestCompletedChallenges;\n-\n-  function requestAuthEmail(isSignUp, newEmail) {\n-    return Observable.defer(() => {\n-      const messageOrNull = getWaitMessage(this.emailAuthLinkTTL);\n-      if (messageOrNull) {\n-        throw wrapHandledError(new Error('request is throttled'), {\n-          type: 'info',\n-          message: messageOrNull\n-        });\n-      }\n-\n-      // create a temporary access token with ttl for 15 minutes\n-      return this.createAuthToken({ ttl: 15 * 60 * 1000 });\n-    })\n-      .flatMap(token => {\n-        let renderAuthEmail = renderSignInEmail;\n-        let subject = 'Your sign in link for freeCodeCamp.org';\n-        if (isSignUp) {\n-          renderAuthEmail = renderSignUpEmail;\n-          subject = 'Your sign in link for your new freeCodeCamp.org account';\n-        }\n-        if (newEmail) {\n-          renderAuthEmail = renderEmailChangeEmail;\n-          subject = dedent`\n-            Please confirm your updated email address for freeCodeCamp.org\n-          `;\n-        }\n-        const { id: loginToken, created: emailAuthLinkTTL } = token;\n-        const loginEmail = getEncodedEmail(newEmail ? newEmail : null);\n-        const host = process.env.API_LOCATION;\n-        const mailOptions = {\n-          type: 'email',\n-          to: newEmail ? newEmail : this.email,\n-          from: getEmailSender(),\n-          subject,\n-          text: renderAuthEmail({\n-            host,\n-            loginEmail,\n-            loginToken,\n-            emailChange: !!newEmail\n-          })\n-        };\n-        const userUpdate = new Promise((resolve, reject) =>\n-          this.updateAttributes({ emailAuthLinkTTL }, err => {\n-            if (err) {\n-              return reject(err);\n-            }\n-            return resolve();\n-          })\n-        );\n-        return Observable.forkJoin(\n-          User.email.send$(mailOptions),\n-          Observable.fromPromise(userUpdate)\n-        );\n-      })\n-      .map({\n-        type: 'info',\n-        message: dedent`Check your email and click the link we sent you to confirm your new email address.`\n-      });\n-  }\n-\n-  User.prototype.requestAuthEmail = requestAuthEmail;\n-\n-  /**\n-   * @param {String} requestedEmail\n-   */\n-  function requestUpdateEmail(requestedEmail) {\n-    const newEmail = ensureLowerCaseString(requestedEmail);\n-    const currentEmail = ensureLowerCaseString(this.email);\n-    const isOwnEmail = isTheSame(newEmail, currentEmail);\n-    const isResendUpdateToSameEmail = isTheSame(\n-      newEmail,\n-      ensureLowerCaseString(this.newEmail)\n-    );\n-    const isLinkSentWithinLimit = getWaitMessage(this.emailVerifyTTL);\n-    const isVerifiedEmail = this.emailVerified;\n-\n-    if (isOwnEmail && isVerifiedEmail) {\n-      // email is already associated and verified with this account\n-      throw wrapHandledError(new Error('email is already verified'), {\n-        type: 'info',\n-        message: `\n-            ${newEmail} is already associated with this account.\n-            You can update a new email address instead.`\n-      });\n-    }\n-    if (isResendUpdateToSameEmail && isLinkSentWithinLimit) {\n-      // trying to update with the same newEmail and\n-      // confirmation email is still valid\n-      throw wrapHandledError(new Error(), {\n-        type: 'info',\n-        message: dedent`\n-          We have already sent an email confirmation request to ${newEmail}.\n-          ${isLinkSentWithinLimit}`\n-      });\n-    }\n-    if (!isEmail('' + newEmail)) {\n-      throw createEmailError();\n-    }\n-\n-    // newEmail is not associated with this user, and\n-    // this attempt to change email is the first or\n-    // previous attempts have expired\n-    if (\n-      !isOwnEmail ||\n-      (isOwnEmail && !isVerifiedEmail) ||\n-      (isResendUpdateToSameEmail && !isLinkSentWithinLimit)\n-    ) {\n-      const updateConfig = {\n-        newEmail,\n-        emailVerified: false,\n-        emailVerifyTTL: new Date()\n-      };\n-\n-      // defer prevents the promise from firing prematurely (before subscribe)\n-      return Observable.defer(() => User.doesExist(null, newEmail))\n-        .do(exists => {\n-          if (exists && !isOwnEmail) {\n-            // newEmail is not associated with this account,\n-            // but is associated with different account\n-            throw wrapHandledError(new Error('email already in use'), {\n-              type: 'info',\n-              message: `${newEmail} is already associated with another account.`\n-            });\n-          }\n-        })\n-        .flatMap(() => {\n-          const updatePromise = new Promise((resolve, reject) =>\n-            this.updateAttributes(updateConfig, err => {\n-              if (err) {\n-                return reject(err);\n-              }\n-              return resolve();\n-            })\n-          );\n-          return Observable.forkJoin(\n-            Observable.fromPromise(updatePromise),\n-            this.requestAuthEmail(false, newEmail),\n-            (_, message) => message\n-          );\n-        });\n-    } else {\n-      return 'Something unexpected happened while updating your email.';\n-    }\n-  }\n-\n-  User.prototype.requestUpdateEmail = requestUpdateEmail;\n-\n-  User.prototype.requestUpdateFlags = async function requestUpdateFlags(\n-    values\n-  ) {\n-    const flagsToCheck = Object.keys(values);\n-    const valuesToCheck = _.pick({ ...this }, flagsToCheck);\n-    const flagsToUpdate = flagsToCheck.filter(\n-      flag => !isTheSame(values[flag], valuesToCheck[flag])\n-    );\n-    if (!flagsToUpdate.length) {\n-      return Observable.of(\n-        dedent`\n-        No property in\n-        ${JSON.stringify(flagsToCheck, null, 2)}\n-        will introduce a change in this user.\n-        `\n-      ).map(() => dedent`Your settings have not been updated.`);\n-    }\n-    const userUpdateData = flagsToUpdate.reduce((data, currentFlag) => {\n-      data[currentFlag] = values[currentFlag];\n-      return data;\n-    }, {});\n-    log(userUpdateData);\n-    const userUpdate = new Promise((resolve, reject) =>\n-      this.updateAttributes(userUpdateData, err => {\n-        if (err) {\n-          return reject(err);\n-        }\n-        return resolve();\n-      })\n-    );\n-    return Observable.fromPromise(userUpdate).map(\n-      () => dedent`\n-        We have successfully updated your account.\n-      `\n-    );\n-  };\n-\n-  User.prototype.updateMyPortfolio = function updateMyPortfolio(\n-    portfolioItem,\n-    deleteRequest\n-  ) {\n-    const currentPortfolio = this.portfolio.slice(0);\n-    const pIndex = _.findIndex(\n-      currentPortfolio,\n-      p => p.id === portfolioItem.id\n-    );\n-    let updatedPortfolio = [];\n-    if (deleteRequest) {\n-      updatedPortfolio = currentPortfolio.filter(\n-        p => p.id !== portfolioItem.id\n-      );\n-    } else if (pIndex === -1) {\n-      updatedPortfolio = currentPortfolio.concat([portfolioItem]);\n-    } else {\n-      updatedPortfolio = [...currentPortfolio];\n-      updatedPortfolio[pIndex] = { ...portfolioItem };\n-    }\n-    const userUpdate = new Promise((resolve, reject) =>\n-      this.updateAttribute('portfolio', updatedPortfolio, err => {\n-        if (err) {\n-          return reject(err);\n-        }\n-        return resolve();\n-      })\n-    );\n-    return Observable.fromPromise(userUpdate).map(\n-      () => dedent`\n-          Your portfolio has been updated.\n-        `\n-    );\n-  };\n-\n-  User.prototype.updateMyProjects = function updateMyProjects(project) {\n-    const updateData = { $set: {} };\n-    return this.getCompletedChallenges$()\n-      .flatMap(() => {\n-        const { updated, isNewCompletionCount } =\n-          buildCompletedChallengesUpdate(this.completedChallenges, project);\n-        updateData.$set.completedChallenges = updated;\n-        if (isNewCompletionCount) {\n-          let points = [];\n-          // give points a length of isNewCompletionCount\n-          points[isNewCompletionCount - 1] = true;\n-          updateData.$push = {};\n-          updateData.$push.progressTimestamps = {\n-            $each: points.map(() => Date.now())\n-          };\n-        }\n-        const updatePromise = new Promise((resolve, reject) =>\n-          this.updateAttributes(updateData, err => {\n-            if (err) {\n-              return reject(err);\n-            }\n-            return resolve();\n-          })\n-        );\n-        return Observable.fromPromise(updatePromise);\n-      })\n-      .map(\n-        () => dedent`\n-        Your projects have been updated.\n-      `\n-      );\n-  };\n-\n-  User.prototype.updateMyProfileUI = function updateMyProfileUI(profileUI) {\n-    const newProfileUI = {\n-      ...this.profileUI,\n-      ...profileUI\n-    };\n-    const profileUIUpdate = new Promise((resolve, reject) =>\n-      this.updateAttribute('profileUI', newProfileUI, err => {\n-        if (err) {\n-          return reject(err);\n-        }\n-        return resolve();\n-      })\n-    );\n-    return Observable.fromPromise(profileUIUpdate).map(\n-      () => dedent`\n-        Your privacy settings have been updated.\n-      `\n-    );\n-  };\n-\n-  User.giveBrowniePoints = function giveBrowniePoints(\n-    receiver,\n-    giver,\n-    data = {},\n-    dev = false,\n-    cb\n-  ) {\n-    const findUser = observeMethod(User, 'findOne');\n-    if (!receiver) {\n-      return nextTick(() => {\n-        cb(new TypeError(`receiver should be a string but got ${receiver}`));\n-      });\n-    }\n-    if (!giver) {\n-      return nextTick(() => {\n-        cb(new TypeError(`giver should be a string but got ${giver}`));\n-      });\n-    }\n-    let temp = moment();\n-    const browniePoints = temp.subtract\n-      .apply(temp, BROWNIEPOINTS_TIMEOUT)\n-      .valueOf();\n-    const user$ = findUser({ where: { username: receiver } });\n-\n-    return (\n-      user$\n-        .tapOnNext(user => {\n-          if (!user) {\n-            throw new Error(`could not find receiver for ${receiver}`);\n-          }\n-        })\n-        .flatMap(({ progressTimestamps = [] }) => {\n-          return Observable.from(progressTimestamps);\n-        })\n-        // filter out non objects\n-        .filter(timestamp => !!timestamp || typeof timestamp === 'object')\n-        // filter out timestamps older than one hour\n-        .filter(({ timestamp = 0 }) => {\n-          return timestamp >= browniePoints;\n-        })\n-        // filter out brownie points given by giver\n-        .filter(browniePoint => {\n-          return browniePoint.giver === giver;\n-        })\n-        // no results means this is the first brownie point given by giver\n-        // so return -1 to indicate receiver should receive point\n-        .first({ defaultValue: -1 })\n-        .flatMap(browniePointsFromGiver => {\n-          if (browniePointsFromGiver === -1) {\n-            return user$.flatMap(user => {\n-              user.progressTimestamps.push({\n-                giver,\n-                timestamp: Date.now(),\n-                ...data\n-              });\n-              return saveUser(user);\n-            });\n-          }\n-          return Observable.throw(\n-            new Error(`${giver} already gave ${receiver} points`)\n-          );\n-        })\n-        .subscribe(\n-          user => {\n-            return cb(\n-              null,\n-              getAboutProfile(user),\n-              dev ? { giver, receiver, data } : null\n-            );\n-          },\n-          e => cb(e, null, dev ? { giver, receiver, data } : null),\n-          () => {\n-            log('brownie points assigned completed');\n-          }\n-        )\n-    );\n-  };\n-\n-  User.remoteMethod('giveBrowniePoints', {\n-    description: 'Give this user brownie points',\n-    accepts: [\n-      {\n-        arg: 'receiver',\n-        type: 'string',\n-        required: true\n-      },\n-      {\n-        arg: 'giver',\n-        type: 'string',\n-        required: true\n-      },\n-      {\n-        arg: 'data',\n-        type: 'object'\n-      },\n-      {\n-        arg: 'debug',\n-        type: 'boolean'\n-      }\n-    ],\n-    returns: [\n-      {\n-        arg: 'about',\n-        type: 'object'\n-      },\n-      {\n-        arg: 'debug',\n-        type: 'object'\n-      }\n-    ],\n-    http: {\n-      path: '/give-brownie-points',\n-      verb: 'POST'\n-    }\n-  });\n-\n-  User.prototype.getPoints$ = function getPoints$() {\n-    if (\n-      Array.isArray(this.progressTimestamps) &&\n-      this.progressTimestamps.length\n-    ) {\n-      return Observable.of(this.progressTimestamps);\n-    }\n-    const id = this.getId();\n-    const filter = {\n-      where: { id },\n-      fields: { progressTimestamps: true }\n-    };\n-    return this.constructor.findOne$(filter).map(user => {\n-      this.progressTimestamps = user.progressTimestamps;\n-      return user.progressTimestamps;\n-    });\n-  };\n-  User.prototype.getCompletedChallenges$ = function getCompletedChallenges$() {\n-    if (\n-      Array.isArray(this.completedChallenges) &&\n-      this.completedChallenges.length\n-    ) {\n-      return Observable.of(this.completedChallenges);\n-    }\n-    const id = this.getId();\n-    const filter = {\n-      where: { id },\n-      fields: { completedChallenges: true }\n-    };\n-    return this.constructor.findOne$(filter).map(user => {\n-      this.completedChallenges = user.completedChallenges;\n-      return user.completedChallenges;\n-    });\n-  };\n-  User.prototype.getSavedChallenges$ = function getSavedChallenges$() {\n-    if (Array.isArray(this.savedChallenges) && this.savedChallenges.length) {\n-      return Observable.of(this.savedChallenges);\n-    }\n-    const id = this.getId();\n-    const filter = {\n-      where: { id },\n-      fields: { savedChallenges: true }\n-    };\n-    return this.constructor.findOne$(filter).map(user => {\n-      this.savedChallenges = user.savedChallenges;\n-      return user.savedChallenges;\n-    });\n-  };\n-\n-  User.prototype.getPartiallyCompletedChallenges$ =\n-    function getPartiallyCompletedChallenges$() {\n-      if (\n-        Array.isArray(this.partiallyCompletedChallenges) &&\n-        this.partiallyCompletedChallenges.length\n-      ) {\n-        return Observable.of(this.partiallyCompletedChallenges);\n-      }\n-      const id = this.getId();\n-      const filter = {\n-        where: { id },\n-        fields: { partiallyCompletedChallenges: true }\n-      };\n-      return this.constructor.findOne$(filter).map(user => {\n-        this.partiallyCompletedChallenges = user.partiallyCompletedChallenges;\n-        return user.partiallyCompletedChallenges;\n-      });\n-    };\n-\n-  User.prototype.getCompletedExams$ = function getCompletedExams$() {\n-    if (Array.isArray(this.completedExams) && this.completedExams.length) {\n-      return Observable.of(this.completedExams);\n-    }\n-    const id = this.getId();\n-    const filter = {\n-      where: { id },\n-      fields: { completedExams: true }\n-    };\n-    return this.constructor.findOne$(filter).map(user => {\n-      this.completedExams = user.completedExams;\n-      return user.completedExams;\n-    });\n-  };\n-\n-  User.getMessages = messages => Promise.resolve(messages);\n-\n-  User.remoteMethod('getMessages', {\n-    http: {\n-      verb: 'get',\n-      path: '/get-messages'\n-    },\n-    accepts: {\n-      arg: 'messages',\n-      type: 'object',\n-      http: ctx => ctx.req.flash()\n-    },\n-    returns: [\n-      {\n-        arg: 'messages',\n-        type: 'object',\n-        root: true\n-      }\n-    ]\n-  });\n-}"
        },
        {
            "sha": "28c766686570a185ca3631ebe27c9aa545600b4d",
            "filename": "api-server/src/common/models/user.json",
            "status": "removed",
            "additions": 0,
            "deletions": 520,
            "changes": 520,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2Fuser.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Fmodels%2Fuser.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Fmodels%2Fuser.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,520 +0,0 @@\n-{\n-  \"name\": \"user\",\n-  \"base\": \"User\",\n-  \"strict\": \"filter\",\n-  \"idInjection\": true,\n-  \"emailVerificationRequired\": false,\n-  \"trackChanges\": false,\n-  \"properties\": {\n-    \"email\": {\n-      \"type\": \"string\",\n-      \"index\": {\n-        \"mongodb\": {\n-          \"unique\": true,\n-          \"background\": true,\n-          \"sparse\": true\n-        }\n-      }\n-    },\n-    \"newEmail\": {\n-      \"type\": \"string\"\n-    },\n-    \"emailVerifyTTL\": {\n-      \"type\": \"date\"\n-    },\n-    \"emailVerified\": {\n-      \"type\": \"boolean\",\n-      \"default\": false\n-    },\n-    \"emailAuthLinkTTL\": {\n-      \"type\": \"date\"\n-    },\n-    \"externalId\": {\n-      \"type\": \"string\",\n-      \"description\": \"A uuid/v4 used to identify user accounts\"\n-    },\n-    \"unsubscribeId\": {\n-      \"type\": \"string\",\n-      \"description\": \"An ObjectId used to unsubscribe users from the mailing list(s)\"\n-    },\n-    \"password\": {\n-      \"type\": \"string\",\n-      \"description\": \"No longer used for new accounts\"\n-    },\n-    \"progressTimestamps\": {\n-      \"type\": \"array\",\n-      \"default\": []\n-    },\n-    \"isBanned\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"User is banned from posting to camper news\",\n-      \"default\": false\n-    },\n-    \"isCheater\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Users who are confirmed to have broken academic honesty policy are marked as cheaters\",\n-      \"default\": false\n-    },\n-    \"githubProfile\": {\n-      \"type\": \"string\"\n-    },\n-    \"website\": {\n-      \"type\": \"string\"\n-    },\n-    \"_csrf\": {\n-      \"type\": \"string\"\n-    },\n-    \"username\": {\n-      \"type\": \"string\",\n-      \"index\": {\n-        \"mongodb\": {\n-          \"unique\": true,\n-          \"background\": true\n-        }\n-      },\n-      \"require\": true\n-    },\n-    \"usernameDisplay\": {\n-      \"type\": \"string\"\n-    },\n-    \"about\": {\n-      \"type\": \"string\",\n-      \"default\": \"\"\n-    },\n-    \"name\": {\n-      \"type\": \"string\",\n-      \"default\": \"\"\n-    },\n-    \"location\": {\n-      \"type\": \"string\",\n-      \"default\": \"\"\n-    },\n-    \"picture\": {\n-      \"type\": \"string\",\n-      \"default\": \"\"\n-    },\n-    \"linkedin\": {\n-      \"type\": \"string\"\n-    },\n-    \"codepen\": {\n-      \"type\": \"string\"\n-    },\n-    \"twitter\": {\n-      \"type\": \"string\"\n-    },\n-    \"acceptedPrivacyTerms\": {\n-      \"type\": \"boolean\",\n-      \"default\": false\n-    },\n-    \"sendQuincyEmail\": {\n-      \"type\": \"boolean\",\n-      \"default\": false\n-    },\n-    \"isClassroomAccount\": {\n-      \"type\": \"boolean\",\n-      \"default\": false\n-    },\n-    \"currentChallengeId\": {\n-      \"type\": \"string\",\n-      \"description\": \"The challenge last visited by the user\",\n-      \"default\": \"\"\n-    },\n-    \"isHonest\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper has signed academic honesty policy\",\n-      \"default\": false\n-    },\n-    \"needsModeration\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper has challenges needing to be moderated\",\n-      \"default\": false,\n-      \"index\": {\n-        \"mongodb\": {\n-          \"unique\": true,\n-          \"background\": true\n-        }\n-      }\n-    },\n-    \"isFrontEndCert\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is front end certified\",\n-      \"default\": false\n-    },\n-    \"isDataVisCert\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is data visualization certified\",\n-      \"default\": false\n-    },\n-    \"isBackEndCert\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Campers is back end certified\",\n-      \"default\": false\n-    },\n-    \"isFullStackCert\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Campers is full stack certified\",\n-      \"default\": false\n-    },\n-    \"isRespWebDesignCert\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is responsive web design certified\",\n-      \"default\": false\n-    },\n-    \"is2018DataVisCert\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is data visualization certified (2018)\",\n-      \"default\": false\n-    },\n-    \"isFrontEndLibsCert\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is front end libraries certified\",\n-      \"default\": false\n-    },\n-    \"isJsAlgoDataStructCert\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is javascript algorithms and data structures certified\",\n-      \"default\": false\n-    },\n-    \"isApisMicroservicesCert\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is apis and microservices certified\",\n-      \"default\": false\n-    },\n-    \"isInfosecQaCert\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is information security and quality assurance certified\",\n-      \"default\": false\n-    },\n-    \"isQaCertV7\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is quality assurance certified\",\n-      \"default\": false\n-    },\n-    \"isInfosecCertV7\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is information security certified\",\n-      \"default\": false\n-    },\n-    \"is2018FullStackCert\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is full stack certified (2018)\",\n-      \"default\": false\n-    },\n-    \"isSciCompPyCertV7\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is scientific computing with Python certified\",\n-      \"default\": false\n-    },\n-    \"isDataAnalysisPyCertV7\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is data analysis with Python certified\",\n-      \"default\": false\n-    },\n-    \"isMachineLearningPyCertV7\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is machine learning with Python certified\",\n-      \"default\": false\n-    },\n-    \"isRelationalDatabaseCertV8\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is relational database certified\",\n-      \"default\": false\n-    },\n-    \"isCollegeAlgebraPyCertV8\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is college algebra with Python certified\",\n-      \"default\": false\n-    },\n-    \"isFoundationalCSharpCertV8\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is foundational C# certified\",\n-      \"default\": false\n-    },\n-    \"isJsAlgoDataStructCertV8\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Camper is javascript algorithms and data structures certified (2023)\",\n-      \"default\": false\n-    },\n-    \"completedChallenges\": {\n-      \"type\": [\n-        {\n-          \"completedDate\": \"number\",\n-          \"id\": \"string\",\n-          \"solution\": \"string\",\n-          \"githubLink\": \"string\",\n-          \"challengeType\": \"number\",\n-          \"isManuallyApproved\": \"boolean\",\n-          \"files\": {\n-            \"type\": [\n-              {\n-                \"contents\": {\n-                  \"type\": \"string\",\n-                  \"default\": \"\"\n-                },\n-                \"ext\": {\n-                  \"type\": \"string\"\n-                },\n-                \"path\": {\n-                  \"type\": \"string\"\n-                },\n-                \"name\": {\n-                  \"type\": \"string\"\n-                },\n-                \"key\": {\n-                  \"type\": \"string\"\n-                }\n-              }\n-            ],\n-            \"default\": []\n-          }\n-        }\n-      ],\n-      \"default\": []\n-    },\n-    \"partiallyCompletedChallenges\": {\n-      \"type\": [\n-        {\n-          \"completedDate\": \"number\",\n-          \"id\": \"string\"\n-        }\n-      ],\n-      \"default\": []\n-    },\n-    \"savedChallenges\": {\n-      \"type\": [\n-        {\n-          \"lastSavedDate\": \"number\",\n-          \"id\": \"string\",\n-          \"challengeType\": \"number\",\n-          \"files\": {\n-            \"type\": [\n-              {\n-                \"contents\": {\n-                  \"type\": \"string\",\n-                  \"default\": \"\"\n-                },\n-                \"ext\": {\n-                  \"type\": \"string\"\n-                },\n-                \"path\": {\n-                  \"type\": \"string\"\n-                },\n-                \"name\": {\n-                  \"type\": \"string\"\n-                },\n-                \"key\": {\n-                  \"type\": \"string\"\n-                }\n-              }\n-            ],\n-            \"default\": []\n-          }\n-        }\n-      ],\n-      \"default\": []\n-    },\n-    \"completedExams\": {\n-      \"type\": [\n-        {\n-          \"completedDate\": \"number\",\n-          \"id\": \"string\",\n-          \"challengeType\": \"number\",\n-          \"examResults\": {\n-            \"type\": {\n-              \"numberOfCorrectAnswers\": \"number\",\n-              \"numberOfQuestionsInExam\": \"number\",\n-              \"percentCorrect\": \"number\",\n-              \"passingPercent\": \"number\",\n-              \"passed\": \"boolean\",\n-              \"examTimeInSeconds\": \"number\"\n-            }\n-          }\n-        }\n-      ],\n-      \"default\": []\n-    },\n-    \"portfolio\": {\n-      \"type\": \"array\",\n-      \"default\": []\n-    },\n-    \"yearsTopContributor\": {\n-      \"type\": \"array\",\n-      \"default\": []\n-    },\n-    \"rand\": {\n-      \"type\": \"number\",\n-      \"index\": true\n-    },\n-    \"timezone\": {\n-      \"type\": \"string\"\n-    },\n-    \"theme\": {\n-      \"type\": \"string\",\n-      \"default\": \"default\"\n-    },\n-    \"keyboardShortcuts\": {\n-      \"type\": \"boolean\",\n-      \"default\": false\n-    },\n-    \"profileUI\": {\n-      \"type\": \"object\",\n-      \"default\": {\n-        \"isLocked\": true,\n-        \"showAbout\": false,\n-        \"showCerts\": false,\n-        \"showDonation\": false,\n-        \"showHeatMap\": false,\n-        \"showLocation\": false,\n-        \"showName\": false,\n-        \"showPoints\": false,\n-        \"showPortfolio\": false,\n-        \"showTimeLine\": false\n-      }\n-    },\n-    \"badges\": {\n-      \"type\": {\n-        \"coreTeam\": {\n-          \"type\": \"array\",\n-          \"default\": []\n-        }\n-      },\n-      \"default\": {}\n-    },\n-    \"donationEmails\": {\n-      \"type\": [\"string\"]\n-    },\n-    \"isDonating\": {\n-      \"type\": \"boolean\",\n-      \"description\": \"Does the camper have an active donation\",\n-      \"default\": false\n-    }\n-  },\n-  \"validations\": [],\n-  \"relations\": {\n-    \"donations\": {\n-      \"type\": \"hasMany\",\n-      \"foreignKey\": \"\",\n-      \"modal\": \"donation\"\n-    },\n-    \"credentials\": {\n-      \"type\": \"hasMany\",\n-      \"model\": \"userCredential\",\n-      \"foreignKey\": \"\"\n-    },\n-    \"identities\": {\n-      \"type\": \"hasMany\",\n-      \"model\": \"userIdentity\",\n-      \"foreignKey\": \"\"\n-    },\n-    \"pledge\": {\n-      \"type\": \"hasOne\",\n-      \"model\": \"pledge\",\n-      \"foreignKey\": \"\"\n-    },\n-    \"authTokens\": {\n-      \"type\": \"hasMany\",\n-      \"model\": \"AuthToken\",\n-      \"foreignKey\": \"userId\",\n-      \"options\": {\n-        \"disableInclude\": true\n-      }\n-    },\n-    \"articles\": {\n-      \"type\": \"hasMany\",\n-      \"model\": \"article\",\n-      \"foreignKey\": \"externalId\"\n-    },\n-    \"userTokens\": {\n-      \"type\": \"hasMany\",\n-      \"model\": \"UserToken\",\n-      \"foreignKey\": \"userId\"\n-    },\n-    \"msUsernames\": {\n-      \"type\": \"hasMany\",\n-      \"model\": \"MsUsername\",\n-      \"foreignKey\": \"userId\"\n-    },\n-    \"surveys\": {\n-      \"type\": \"hasMany\",\n-      \"model\": \"Survey\",\n-      \"foreignKey\": \"userId\"\n-    }\n-  },\n-  \"acls\": [\n-    {\n-      \"accessType\": \"*\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"DENY\"\n-    },\n-    {\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"DENY\",\n-      \"property\": \"create\"\n-    },\n-    {\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"DENY\",\n-      \"property\": \"login\"\n-    },\n-    {\n-      \"accessType\": \"EXECUTE\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"DENY\",\n-      \"property\": \"verify\"\n-    },\n-    {\n-      \"accessType\": \"EXECUTE\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"DENY\",\n-      \"property\": \"resetPassword\"\n-    },\n-    {\n-      \"accessType\": \"EXECUTE\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"ALLOW\",\n-      \"property\": \"doesExist\"\n-    },\n-    {\n-      \"accessType\": \"EXECUTE\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"ALLOW\",\n-      \"property\": \"about\"\n-    },\n-    {\n-      \"accessType\": \"EXECUTE\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"ALLOW\",\n-      \"property\": \"getPublicProfile\"\n-    },\n-    {\n-      \"accessType\": \"EXECUTE\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"ALLOW\",\n-      \"property\": \"giveBrowniePoints\"\n-    },\n-    {\n-      \"accessType\": \"EXECUTE\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$owner\",\n-      \"permission\": \"ALLOW\",\n-      \"property\": \"updateTheme\"\n-    },\n-    {\n-      \"accessType\": \"EXECUTE\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"ALLOW\",\n-      \"property\": \"getMessages\"\n-    }\n-  ],\n-  \"methods\": {}\n-}"
        },
        {
            "sha": "666a8e699c1ec7371fc572bff0a13e76c1d4763e",
            "filename": "api-server/src/common/utils/auth.js",
            "status": "removed",
            "additions": 0,
            "deletions": 80,
            "changes": 80,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Futils%2Fauth.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Futils%2Fauth.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Futils%2Fauth.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,80 +0,0 @@\n-import path from 'path';\n-\n-import dedent from 'dedent';\n-import loopback from 'loopback';\n-import moment from 'moment';\n-\n-export const renderSignUpEmail = loopback.template(\n-  path.join(\n-    __dirname,\n-    '..',\n-    '..',\n-    'server',\n-    'views',\n-    'emails',\n-    'user-request-sign-up.ejs'\n-  )\n-);\n-\n-export const renderSignInEmail = loopback.template(\n-  path.join(\n-    __dirname,\n-    '..',\n-    '..',\n-    'server',\n-    'views',\n-    'emails',\n-    'user-request-sign-in.ejs'\n-  )\n-);\n-\n-export const renderEmailChangeEmail = loopback.template(\n-  path.join(\n-    __dirname,\n-    '..',\n-    '..',\n-    'server',\n-    'views',\n-    'emails',\n-    'user-request-update-email.ejs'\n-  )\n-);\n-\n-export function getWaitPeriod(ttl) {\n-  const fiveMinutesAgo = moment().subtract(5, 'minutes');\n-  const lastEmailSentAt = moment(new Date(ttl || null));\n-  const isWaitPeriodOver = ttl\n-    ? lastEmailSentAt.isBefore(fiveMinutesAgo)\n-    : true;\n-\n-  if (!isWaitPeriodOver) {\n-    const minutesLeft = 5 - (moment().minutes() - lastEmailSentAt.minutes());\n-    return minutesLeft;\n-  }\n-\n-  return 0;\n-}\n-\n-export function getWaitMessage(ttl) {\n-  const minutesLeft = getWaitPeriod(ttl);\n-  if (minutesLeft <= 0) {\n-    return null;\n-  }\n-\n-  const timeToWait = minutesLeft\n-    ? `${minutesLeft} minute${minutesLeft > 1 ? 's' : ''}`\n-    : 'a few seconds';\n-\n-  return dedent`\n-    Please wait ${timeToWait} to resend an authentication link.\n-  `;\n-}\n-\n-export function getEncodedEmail(email) {\n-  if (!email) {\n-    return null;\n-  }\n-  return Buffer.from(email).toString('base64');\n-}\n-\n-export const decodeEmail = email => Buffer.from(email, 'base64').toString();"
        },
        {
            "sha": "195890ccffa24bb190076fd874cfeb4a6ee800b0",
            "filename": "api-server/src/common/utils/constantStrings.json",
            "status": "removed",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Futils%2FconstantStrings.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Futils%2FconstantStrings.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Futils%2FconstantStrings.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,9 +0,0 @@\n-{\n-  \"aboutUrl\": \"https://www.freecodecamp.org/about\",\n-  \"defaultProfileImage\": \"https://cdn.freecodecamp.org/platform/universal/camper-image-placeholder.png\",\n-  \"donateUrl\": \"https://www.freecodecamp.org/donate\",\n-  \"forumUrl\": \"https://forum.freecodecamp.org\",\n-  \"githubUrl\": \"https://github.com/freecodecamp/freecodecamp\",\n-  \"RSA\": \"https://forum.freecodecamp.org/t/the-read-search-ask-methodology-for-getting-unstuck/137307\",\n-  \"homeURL\": \"https://www.freecodecamp.org\"\n-}"
        },
        {
            "sha": "517ecba917f834ef511732b5b6d2794c84fa091b",
            "filename": "api-server/src/common/utils/empty-protector.js",
            "status": "removed",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Futils%2Fempty-protector.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Futils%2Fempty-protector.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Futils%2Fempty-protector.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,13 +0,0 @@\n-const emptyProtector = {\n-  blocks: [],\n-  challenges: []\n-};\n-// protect against malformed map data\n-// protect(block: { challenges: [], block: [] }|Void) => block|emptyProtector\n-export default function protect(block) {\n-  // if no block or block has no challenges or blocks\n-  if (!block || !(block.challenges || block.blocks)) {\n-    return emptyProtector;\n-  }\n-  return block;\n-}"
        },
        {
            "sha": "b1ece41452a8ad19a0b16468ce23209bda4526ca",
            "filename": "api-server/src/common/utils/flash.js",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Futils%2Fflash.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Futils%2Fflash.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Futils%2Fflash.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,8 +0,0 @@\n-import _ from 'lodash';\n-\n-export const alertTypes = _.keyBy(\n-  ['success', 'info', 'warning', 'danger'],\n-  _.identity\n-);\n-\n-export const normalizeAlertType = alertType => alertTypes[alertType] || 'info';"
        },
        {
            "sha": "cfc64be92670db0e7c786335c83bd11250daae9f",
            "filename": "api-server/src/common/utils/index.js",
            "status": "removed",
            "additions": 0,
            "deletions": 34,
            "changes": 34,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Futils%2Findex.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fcommon%2Futils%2Findex.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Futils%2Findex.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,34 +0,0 @@\n-import { pick } from 'lodash';\n-\n-export {\n-  getEncodedEmail,\n-  decodeEmail,\n-  getWaitMessage,\n-  getWaitPeriod,\n-  renderEmailChangeEmail,\n-  renderSignUpEmail,\n-  renderSignInEmail\n-} from './auth';\n-\n-export const fixCompletedChallengeItem = obj =>\n-  pick(obj, [\n-    'id',\n-    'completedDate',\n-    'solution',\n-    'githubLink',\n-    'challengeType',\n-    'files',\n-    'isManuallyApproved',\n-    'examResults'\n-  ]);\n-\n-export const fixSavedChallengeItem = obj =>\n-  pick(obj, ['id', 'lastSavedDate', 'files']);\n-\n-export const fixPartiallyCompletedChallengeItem = obj =>\n-  pick(obj, ['id', 'completedDate']);\n-\n-export const fixCompletedExamItem = obj =>\n-  pick(obj, ['id', 'completedDate', 'challengeType', 'examResults']);\n-\n-export const fixCompletedSurveyItem = obj => pick(obj, ['title', 'responses']);"
        },
        {
            "sha": "f1317cbbfe90e1442f33ab13c4822982d38cb50f",
            "filename": "api-server/src/development-start.js",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fdevelopment-start.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fdevelopment-start.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fdevelopment-start.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,21 +0,0 @@\n-const path = require('path');\n-require('dotenv').config({ path: path.resolve(__dirname, '../../.env') });\n-\n-const createDebugger = require('debug');\n-const nodemon = require('nodemon');\n-const log = createDebugger('fcc:start:development');\n-\n-nodemon({\n-  ext: 'js json',\n-  // --silent squashes an ELIFECYCLE error when the server exits\n-  exec: 'pnpm run --silent babel-dev-server',\n-  watch: path.resolve(__dirname, './server'),\n-  spawn: true,\n-  env: {\n-    DEBUG: `fcc*,${process.env.DEBUG}`\n-  }\n-});\n-\n-nodemon.on('restart', function nodemonRestart(files) {\n-  log('App restarted due to: ', files);\n-});"
        },
        {
            "sha": "ac389b26355142cf88ef7b3f4a016812983e6d8c",
            "filename": "api-server/src/production-start.js",
            "status": "removed",
            "additions": 0,
            "deletions": 31,
            "changes": 31,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fproduction-start.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fproduction-start.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fproduction-start.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,31 +0,0 @@\n-// this ensures node understands the future\n-const createDebugger = require('debug');\n-const _ = require('lodash');\n-\n-const log = createDebugger('fcc:server:production-start');\n-const startTime = Date.now();\n-// force logger to always output\n-// this may be brittle\n-log.enabled = true;\n-// this is where server starts booting up\n-const app = require('./server');\n-\n-let timeoutHandler;\n-let killTime = 15;\n-\n-const onConnect = _.once(() => {\n-  log('db connected in: %s', Date.now() - startTime);\n-  if (timeoutHandler) {\n-    clearTimeout(timeoutHandler);\n-  }\n-  app.start();\n-});\n-\n-timeoutHandler = setTimeout(() => {\n-  const message = `db did not connect after ${killTime}s -- crashing hard`;\n-  // purposely shutdown server\n-  // pm2 should restart this in production\n-  throw new Error(message);\n-}, killTime * 1000);\n-\n-app.dataSources.db.on('connected', onConnect);"
        },
        {
            "sha": "3466a9a8135f84c077d851765670378eae878ea0",
            "filename": "api-server/src/server/boot/a-extend-built-ins.js",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fa-extend-built-ins.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fa-extend-built-ins.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fa-extend-built-ins.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,15 +0,0 @@\n-import { Observable } from 'rx';\n-\n-export default function extendEmail(app) {\n-  const { AccessToken, Email } = app.models;\n-  Email.send$ = Observable.fromNodeCallback(Email.send, Email);\n-  AccessToken.findOne$ = Observable.fromNodeCallback(\n-    AccessToken.findOne.bind(AccessToken)\n-  );\n-  AccessToken.prototype.validate$ = Observable.fromNodeCallback(\n-    AccessToken.prototype.validate\n-  );\n-  AccessToken.prototype.destroy$ = Observable.fromNodeCallback(\n-    AccessToken.prototype.destroy\n-  );\n-}"
        },
        {
            "sha": "edcf3eb05deb1804bdc94930e337182d70495f26",
            "filename": "api-server/src/server/boot/a-increase-listeners.js",
            "status": "removed",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fa-increase-listeners.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fa-increase-listeners.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fa-increase-listeners.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,5 +0,0 @@\n-module.exports = function increaseListers(app) {\n-  // increase loopback database ODM max listeners\n-  // this is a EventEmitter method\n-  app.dataSources.db.setMaxListeners(32);\n-};"
        },
        {
            "sha": "c78c3b0fd454b7373044efb118b57e248b81f353",
            "filename": "api-server/src/server/boot/authentication.js",
            "status": "removed",
            "additions": 0,
            "deletions": 246,
            "changes": 246,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fauthentication.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fauthentication.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fauthentication.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,246 +0,0 @@\n-import dedent from 'dedent';\n-import { check } from 'express-validator';\n-import jwt from 'jsonwebtoken';\n-import passport from 'passport';\n-import fetch from 'node-fetch';\n-import { isEmail } from 'validator';\n-import { jwtSecret } from '../../../config/secrets';\n-import { decodeEmail } from '../../common/utils';\n-import {\n-  createPassportCallbackAuthenticator,\n-  devSaveResponseAuthCookies,\n-  devLoginRedirect\n-} from '../component-passport';\n-import { wrapHandledError } from '../utils/create-handled-error.js';\n-import { removeCookies } from '../utils/getSetAccessToken';\n-import {\n-  ifUserRedirectTo,\n-  ifNoUserRedirectHome,\n-  ifNotMobileRedirect\n-} from '../utils/middleware';\n-import { getRedirectParams } from '../utils/redirection';\n-import { createDeleteUserToken } from '../middlewares/user-token';\n-\n-const passwordlessGetValidators = [\n-  check('email')\n-    .isBase64()\n-    .withMessage('Email should be a base64 encoded string.'),\n-  check('token')\n-    .exists()\n-    .withMessage('Token should exist.')\n-    // based on strongloop/loopback/common/models/access-token.js#L15\n-    .isLength({ min: 64, max: 64 })\n-    .withMessage('Token is not the right length.')\n-];\n-\n-module.exports = function enableAuthentication(app) {\n-  // enable loopback access control authentication. see:\n-  // loopback.io/doc/en/lb2/Authentication-authorization-and-permissions.html\n-  app.enableAuth();\n-  const ifNotMobile = ifNotMobileRedirect();\n-  const ifUserRedirect = ifUserRedirectTo();\n-  const ifNoUserRedirect = ifNoUserRedirectHome();\n-  const devSaveAuthCookies = devSaveResponseAuthCookies();\n-  const devLoginSuccessRedirect = devLoginRedirect();\n-  const api = app.loopback.Router();\n-  const deleteUserToken = createDeleteUserToken(app);\n-\n-  // Use a local mock strategy for signing in if we are in dev mode.\n-  // Otherwise we use auth0 login. We use a string for 'true' because values\n-  // set in the env file will always be strings and never boolean.\n-  if (process.env.LOCAL_MOCK_AUTH === 'true') {\n-    api.get(\n-      '/signin',\n-      passport.authenticate('devlogin'),\n-      devSaveAuthCookies,\n-      devLoginSuccessRedirect\n-    );\n-  } else {\n-    api.get('/signin', ifUserRedirect, (req, res, next) => {\n-      const { returnTo, origin, pathPrefix } = getRedirectParams(req);\n-      const state = jwt.sign({ returnTo, origin, pathPrefix }, jwtSecret);\n-      return passport.authenticate('auth0-login', { state })(req, res, next);\n-    });\n-\n-    api.get(\n-      '/auth/auth0/callback',\n-      createPassportCallbackAuthenticator('auth0-login', { provider: 'auth0' })\n-    );\n-  }\n-\n-  api.get('/signout', deleteUserToken, (req, res) => {\n-    const { origin, returnTo } = getRedirectParams(req);\n-    req.logout();\n-    req.session.destroy(err => {\n-      if (err) {\n-        throw wrapHandledError(new Error('could not destroy session'), {\n-          type: 'info',\n-          message: 'We could not log you out, please try again in a moment.',\n-          redirectTo: origin\n-        });\n-      }\n-      removeCookies(req, res);\n-      res.redirect(returnTo);\n-    });\n-  });\n-\n-  api.get(\n-    '/confirm-email',\n-    ifNoUserRedirect,\n-    passwordlessGetValidators,\n-    createGetPasswordlessAuth(app)\n-  );\n-\n-  api.get('/mobile-login', ifNotMobile, ifUserRedirect, mobileLogin(app));\n-\n-  app.use(api);\n-};\n-\n-const defaultErrorMsg = dedent`\n-    Oops, something is not right,\n-    please request a fresh link to sign in / sign up.\n-  `;\n-\n-function createGetPasswordlessAuth(app) {\n-  const {\n-    models: { AuthToken, User }\n-  } = app;\n-  return function getPasswordlessAuth(req, res, next) {\n-    const {\n-      query: { email: encodedEmail, token: authTokenId, emailChange } = {}\n-    } = req;\n-    const { origin } = getRedirectParams(req);\n-    const email = decodeEmail(encodedEmail);\n-    if (!isEmail(email)) {\n-      return next(\n-        wrapHandledError(new TypeError('decoded email is invalid'), {\n-          type: 'info',\n-          message: 'The email encoded in the link is incorrectly formatted',\n-          redirectTo: `${origin}/signin`\n-        })\n-      );\n-    }\n-    // first find\n-    return (\n-      AuthToken.findOne$({ where: { id: authTokenId } })\n-        .flatMap(authToken => {\n-          if (!authToken) {\n-            throw wrapHandledError(\n-              new Error(`no token found for id: ${authTokenId}`),\n-              {\n-                type: 'info',\n-                message: defaultErrorMsg,\n-                redirectTo: `${origin}/signin`\n-              }\n-            );\n-          }\n-          // find user then validate and destroy email validation token\n-          // finally return user instance\n-          return User.findOne$({ where: { id: authToken.userId } }).flatMap(\n-            user => {\n-              if (!user) {\n-                throw wrapHandledError(\n-                  new Error(`no user found for token: ${authTokenId}`),\n-                  {\n-                    type: 'info',\n-                    message: defaultErrorMsg,\n-                    redirectTo: `${origin}/signin`\n-                  }\n-                );\n-              }\n-              if (user.email !== email) {\n-                if (!emailChange || (emailChange && user.newEmail !== email)) {\n-                  throw wrapHandledError(\n-                    new Error('user email does not match'),\n-                    {\n-                      type: 'info',\n-                      message: defaultErrorMsg,\n-                      redirectTo: `${origin}/signin`\n-                    }\n-                  );\n-                }\n-              }\n-              return authToken\n-                .validate$()\n-                .map(isValid => {\n-                  if (!isValid) {\n-                    throw wrapHandledError(new Error('token is invalid'), {\n-                      type: 'info',\n-                      message: `\n-                        Looks like the link you clicked has expired,\n-                        please request a fresh link, to sign in.\n-                      `,\n-                      redirectTo: `${origin}/signin`\n-                    });\n-                  }\n-                  return authToken.destroy$();\n-                })\n-                .map(() => user);\n-            }\n-          );\n-        })\n-        // at this point token has been validated and destroyed\n-        // update user and log them in\n-        .map(user => user.loginByRequest(req, res))\n-        .do(() => {\n-          if (emailChange) {\n-            req.flash('success', 'flash.email-valid');\n-          } else {\n-            req.flash('success', 'flash.signin-success');\n-          }\n-          return res.redirectWithFlash(`${origin}/learn`);\n-        })\n-        .subscribe(() => {}, next)\n-    );\n-  };\n-}\n-\n-function mobileLogin(app) {\n-  const {\n-    models: { User }\n-  } = app;\n-  return async function getPasswordlessAuth(req, res, next) {\n-    try {\n-      const auth0Res = await fetch(\n-        `https://${process.env.AUTH0_DOMAIN}/userinfo`,\n-        {\n-          headers: { Authorization: req.headers.authorization }\n-        }\n-      );\n-\n-      if (!auth0Res.ok) {\n-        return next(\n-          wrapHandledError(new Error('Invalid Auth0 token'), {\n-            type: 'danger',\n-            message: 'We could not log you in, please try again in a moment.',\n-            status: auth0Res.status\n-          })\n-        );\n-      }\n-\n-      const { email } = await auth0Res.json();\n-\n-      if (typeof email !== 'string' || !isEmail(email)) {\n-        return next(\n-          wrapHandledError(new TypeError('decoded email is invalid'), {\n-            type: 'danger',\n-            message: 'The email is incorrectly formatted',\n-            status: 400\n-          })\n-        );\n-      }\n-\n-      User.findOne$({ where: { email } })\n-        .do(async user => {\n-          if (!user) {\n-            user = await User.create({ email });\n-          }\n-          await user.mobileLoginByRequest(req, res);\n-          res.end();\n-        })\n-        .subscribe(() => {}, next);\n-    } catch (err) {\n-      next(err);\n-    }\n-  };\n-}"
        },
        {
            "sha": "b7cd6127795a75b1070fa496e2041c91d77847e3",
            "filename": "api-server/src/server/boot/certificate.js",
            "status": "removed",
            "additions": 0,
            "deletions": 569,
            "changes": 569,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fcertificate.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fcertificate.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fcertificate.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,569 +0,0 @@\n-import path from 'path';\n-import debug from 'debug';\n-import dedent from 'dedent';\n-import _ from 'lodash';\n-import loopback from 'loopback';\n-import { Observable } from 'rx';\n-import { isEmail } from 'validator';\n-import {\n-  completionHours,\n-  certTypes,\n-  certSlugTypeMap,\n-  certTypeTitleMap,\n-  certTypeIdMap,\n-  certIds,\n-  oldDataVizId,\n-  currentCertifications,\n-  upcomingCertifications,\n-  legacyCertifications,\n-  legacyFullStackCertification\n-} from '../../../../shared/config/certification-settings';\n-import { reportError } from '../middlewares/sentry-error-handler.js';\n-\n-import { deprecatedEndpoint } from '../utils/disabled-endpoints';\n-import { getChallenges } from '../utils/get-curriculum';\n-import { ifNoUser401 } from '../utils/middleware';\n-import { observeQuery } from '../utils/rx';\n-\n-const {\n-  legacyFrontEndChallengeId,\n-  legacyBackEndChallengeId,\n-  legacyDataVisId,\n-  legacyInfosecQaId,\n-  legacyFullStackId,\n-  respWebDesignId,\n-  frontEndDevLibsId,\n-  jsAlgoDataStructId,\n-  dataVis2018Id,\n-  apisMicroservicesId,\n-  qaV7Id,\n-  infosecV7Id,\n-  sciCompPyV7Id,\n-  dataAnalysisPyV7Id,\n-  machineLearningPyV7Id,\n-  relationalDatabaseV8Id,\n-  collegeAlgebraPyV8Id,\n-  foundationalCSharpV8Id,\n-  jsAlgoDataStructV8Id\n-} = certIds;\n-\n-const log = debug('fcc:certification');\n-\n-export default function bootCertificate(app) {\n-  const api = app.loopback.Router();\n-  // TODO: rather than getting all the challenges, then grabbing the certs,\n-  // consider just getting the certs.\n-  const certTypeIds = createCertTypeIds(getChallenges());\n-  const showCert = createShowCert(app);\n-  const verifyCert = createVerifyCert(certTypeIds, app);\n-\n-  api.put('/certificate/verify', ifNoUser401, ifNoCertification404, verifyCert);\n-  api.get('/certificate/showCert/:username/:certSlug', showCert);\n-  api.get('/certificate/verify-can-claim-cert', deprecatedEndpoint);\n-  app.use(api);\n-}\n-\n-export function getFallbackFullStackDate(completedChallenges, completedDate) {\n-  var chalIds = [\n-    respWebDesignId,\n-    jsAlgoDataStructId,\n-    frontEndDevLibsId,\n-    dataVis2018Id,\n-    apisMicroservicesId,\n-    legacyInfosecQaId\n-  ];\n-\n-  const latestCertDate = completedChallenges\n-    .filter(chal => chalIds.includes(chal.id))\n-    .sort((a, b) => b.completedDate - a.completedDate)[0]?.completedDate;\n-\n-  return latestCertDate ? latestCertDate : completedDate;\n-}\n-\n-export function ifNoCertification404(req, res, next) {\n-  const { certSlug } = req.body;\n-  if (!certSlug) return res.status(404).end();\n-  if (\n-    currentCertifications.includes(certSlug) ||\n-    legacyCertifications.includes(certSlug) ||\n-    legacyFullStackCertification.includes(certSlug)\n-  )\n-    return next();\n-  if (\n-    process.env.SHOW_UPCOMING_CHANGES === 'true' &&\n-    upcomingCertifications.includes(certSlug)\n-  ) {\n-    return next();\n-  }\n-  res.status(404).end();\n-}\n-\n-const renderCertifiedEmail = loopback.template(\n-  path.join(__dirname, '..', 'views', 'emails', 'certified.ejs')\n-);\n-\n-function createCertTypeIds(allChallenges) {\n-  return {\n-    // legacy\n-    [certTypes.frontEnd]: getCertById(legacyFrontEndChallengeId, allChallenges),\n-    [certTypes.jsAlgoDataStruct]: getCertById(\n-      jsAlgoDataStructId,\n-      allChallenges\n-    ),\n-    [certTypes.backEnd]: getCertById(legacyBackEndChallengeId, allChallenges),\n-    [certTypes.dataVis]: getCertById(legacyDataVisId, allChallenges),\n-    [certTypes.infosecQa]: getCertById(legacyInfosecQaId, allChallenges),\n-    [certTypes.fullStack]: getCertById(legacyFullStackId, allChallenges),\n-\n-    // modern\n-    [certTypes.respWebDesign]: getCertById(respWebDesignId, allChallenges),\n-    [certTypes.jsAlgoDataStructV8]: getCertById(\n-      jsAlgoDataStructV8Id,\n-      allChallenges\n-    ),\n-    [certTypes.frontEndDevLibs]: getCertById(frontEndDevLibsId, allChallenges),\n-    [certTypes.dataVis2018]: getCertById(dataVis2018Id, allChallenges),\n-    [certTypes.apisMicroservices]: getCertById(\n-      apisMicroservicesId,\n-      allChallenges\n-    ),\n-    [certTypes.qaV7]: getCertById(qaV7Id, allChallenges),\n-    [certTypes.infosecV7]: getCertById(infosecV7Id, allChallenges),\n-    [certTypes.sciCompPyV7]: getCertById(sciCompPyV7Id, allChallenges),\n-    [certTypes.dataAnalysisPyV7]: getCertById(\n-      dataAnalysisPyV7Id,\n-      allChallenges\n-    ),\n-    [certTypes.machineLearningPyV7]: getCertById(\n-      machineLearningPyV7Id,\n-      allChallenges\n-    ),\n-    [certTypes.relationalDatabaseV8]: getCertById(\n-      relationalDatabaseV8Id,\n-      allChallenges\n-    ),\n-    [certTypes.collegeAlgebraPyV8]: getCertById(\n-      collegeAlgebraPyV8Id,\n-      allChallenges\n-    ),\n-    [certTypes.foundationalCSharpV8]: getCertById(\n-      foundationalCSharpV8Id,\n-      allChallenges\n-    )\n-  };\n-}\n-\n-function hasCompletedTests(ids, completedChallenges = []) {\n-  return _.every(ids, ({ id }) =>\n-    _.find(completedChallenges, ({ id: completedId }) => completedId === id)\n-  );\n-}\n-\n-function getCertById(anId, allChallenges) {\n-  return allChallenges\n-    .filter(({ id }) => id === anId)\n-    .map(({ id, tests, name, challengeType }) => ({\n-      id,\n-      tests,\n-      name,\n-      challengeType\n-    }))[0];\n-}\n-\n-function sendCertifiedEmail(\n-  {\n-    email = '',\n-    name,\n-    username,\n-    isRespWebDesignCert,\n-    isJsAlgoDataStructCertV8,\n-    isFrontEndLibsCert,\n-    isDataVisCert,\n-    isApisMicroservicesCert,\n-    isQaCertV7,\n-    isInfosecCertV7,\n-    isSciCompPyCertV7,\n-    isDataAnalysisPyCertV7,\n-    isMachineLearningPyCertV7,\n-    isRelationalDatabaseCertV8,\n-    isCollegeAlgebraPyCertV8,\n-    isFoundationalCSharpCertV8\n-  },\n-  send$\n-) {\n-  if (\n-    !isEmail(email) ||\n-    !isRespWebDesignCert ||\n-    !isJsAlgoDataStructCertV8 ||\n-    !isFrontEndLibsCert ||\n-    !isDataVisCert ||\n-    !isApisMicroservicesCert ||\n-    !isQaCertV7 ||\n-    !isInfosecCertV7 ||\n-    !isSciCompPyCertV7 ||\n-    !isDataAnalysisPyCertV7 ||\n-    !isMachineLearningPyCertV7 ||\n-    !isRelationalDatabaseCertV8 ||\n-    !isCollegeAlgebraPyCertV8 ||\n-    !isFoundationalCSharpCertV8\n-  ) {\n-    return Observable.just(false);\n-  }\n-  const notifyUser = {\n-    type: 'email',\n-    to: email,\n-    from: 'quincy@freecodecamp.org',\n-    subject: dedent`\n-      Congratulations on completing all of the\n-      freeCodeCamp certifications!\n-    `,\n-    text: renderCertifiedEmail({\n-      username,\n-      name\n-    })\n-  };\n-  return send$(notifyUser).map(() => true);\n-}\n-\n-function getUserIsCertMap(user) {\n-  const {\n-    isRespWebDesignCert = false,\n-    isJsAlgoDataStructCert = false,\n-    isJsAlgoDataStructCertV8 = false,\n-    isFrontEndLibsCert = false,\n-    is2018DataVisCert = false,\n-    isApisMicroservicesCert = false,\n-    isInfosecQaCert = false,\n-    isQaCertV7 = false,\n-    isInfosecCertV7 = false,\n-    isFrontEndCert = false,\n-    isBackEndCert = false,\n-    isDataVisCert = false,\n-    isFullStackCert = false,\n-    isSciCompPyCertV7 = false,\n-    isDataAnalysisPyCertV7 = false,\n-    isMachineLearningPyCertV7 = false,\n-    isRelationalDatabaseCertV8 = false,\n-    isCollegeAlgebraPyCertV8 = false,\n-    isFoundationalCSharpCertV8 = false\n-  } = user;\n-\n-  return {\n-    isRespWebDesignCert,\n-    isJsAlgoDataStructCert,\n-    isJsAlgoDataStructCertV8,\n-    isFrontEndLibsCert,\n-    is2018DataVisCert,\n-    isApisMicroservicesCert,\n-    isInfosecQaCert,\n-    isQaCertV7,\n-    isInfosecCertV7,\n-    isFrontEndCert,\n-    isBackEndCert,\n-    isDataVisCert,\n-    isFullStackCert,\n-    isSciCompPyCertV7,\n-    isDataAnalysisPyCertV7,\n-    isMachineLearningPyCertV7,\n-    isRelationalDatabaseCertV8,\n-    isCollegeAlgebraPyCertV8,\n-    isFoundationalCSharpCertV8\n-  };\n-}\n-\n-function createVerifyCert(certTypeIds, app) {\n-  const { Email } = app.models;\n-  return function verifyCert(req, res, next) {\n-    const {\n-      body: { certSlug },\n-      user\n-    } = req;\n-    log(certSlug);\n-    let certType = certSlugTypeMap[certSlug];\n-    log(certType);\n-    return Observable.of(certTypeIds[certType])\n-      .flatMap(challenge => {\n-        const certName = certTypeTitleMap[certType];\n-        if (user[certType]) {\n-          return Observable.just({\n-            type: 'info',\n-            message: 'flash.already-claimed',\n-            variables: { name: certName }\n-          });\n-        }\n-\n-        // certificate doesn't exist or\n-        // connection error\n-        if (!challenge) {\n-          reportError(`Error claiming ${certName}`);\n-          return Observable.just({\n-            type: 'danger',\n-            message: 'flash.wrong-name',\n-            variables: { name: certName }\n-          });\n-        }\n-\n-        const { id, tests, challengeType } = challenge;\n-        if (!hasCompletedTests(tests, user.completedChallenges)) {\n-          return Observable.just({\n-            type: 'info',\n-            message: 'flash.incomplete-steps',\n-            variables: { name: certName }\n-          });\n-        }\n-\n-        const updateData = {\n-          [certType]: true,\n-          completedChallenges: [\n-            ...user.completedChallenges,\n-            {\n-              id,\n-              completedDate: new Date(),\n-              challengeType\n-            }\n-          ]\n-        };\n-\n-        if (!user.name) {\n-          return Observable.just({\n-            type: 'info',\n-            message: 'flash.name-needed'\n-          });\n-        }\n-        // set here so sendCertifiedEmail works properly\n-        // not used otherwise\n-        user[certType] = true;\n-        const updatePromise = new Promise((resolve, reject) =>\n-          user.updateAttributes(updateData, err => {\n-            if (err) {\n-              return reject(err);\n-            }\n-            return resolve();\n-          })\n-        );\n-        return Observable.combineLatest(\n-          // update user data\n-          Observable.fromPromise(updatePromise),\n-          // sends notification email is user has all 6 certs\n-          // if not it noop\n-          sendCertifiedEmail(user, Email.send$),\n-          (_, pledgeOrMessage) => ({ pledgeOrMessage })\n-        ).map(({ pledgeOrMessage }) => {\n-          if (typeof pledgeOrMessage === 'string') {\n-            log(pledgeOrMessage);\n-          }\n-          log('Certificates updated');\n-          return {\n-            type: 'success',\n-            message: 'flash.cert-claim-success',\n-            variables: {\n-              username: user.username,\n-              name: certName\n-            }\n-          };\n-        });\n-      })\n-      .subscribe(message => {\n-        return res.status(200).json({\n-          response: message,\n-          isCertMap: getUserIsCertMap(user),\n-          // send back the completed challenges\n-          // NOTE: we could just send back the latest challenge, but this\n-          // ensures the challenges are synced.\n-          completedChallenges: user.completedChallenges\n-        });\n-      }, next);\n-  };\n-}\n-\n-function createShowCert(app) {\n-  const { User } = app.models;\n-\n-  function findUserByUsername$(username, fields) {\n-    return observeQuery(User, 'findOne', {\n-      where: { username },\n-      fields\n-    });\n-  }\n-\n-  return function showCert(req, res, next) {\n-    let { username, certSlug } = req.params;\n-    username = username.toLowerCase();\n-    const certType = certSlugTypeMap[certSlug];\n-    const certId = certTypeIdMap[certType];\n-    const certTitle = certTypeTitleMap[certType];\n-    const completionTime = completionHours[certType] || 300;\n-    return findUserByUsername$(username, {\n-      isBanned: true,\n-      isCheater: true,\n-      isFrontEndCert: true,\n-      isBackEndCert: true,\n-      isFullStackCert: true,\n-      isRespWebDesignCert: true,\n-      isFrontEndLibsCert: true,\n-      isJsAlgoDataStructCert: true,\n-      isJsAlgoDataStructCertV8: true,\n-      isDataVisCert: true,\n-      is2018DataVisCert: true,\n-      isApisMicroservicesCert: true,\n-      isInfosecQaCert: true,\n-      isQaCertV7: true,\n-      isInfosecCertV7: true,\n-      isSciCompPyCertV7: true,\n-      isDataAnalysisPyCertV7: true,\n-      isMachineLearningPyCertV7: true,\n-      isRelationalDatabaseCertV8: true,\n-      isCollegeAlgebraPyCertV8: true,\n-      isFoundationalCSharpCertV8: true,\n-      isHonest: true,\n-      username: true,\n-      name: true,\n-      completedChallenges: true,\n-      profileUI: true\n-    }).subscribe(user => {\n-      if (!user) {\n-        return res.json({\n-          messages: [\n-            {\n-              type: 'info',\n-              message: 'flash.username-not-found',\n-              variables: { username: username }\n-            }\n-          ]\n-        });\n-      }\n-      const { isLocked, showCerts, showName, showTimeLine } = user.profileUI;\n-\n-      if (user.isCheater || user.isBanned) {\n-        return res.json({\n-          messages: [\n-            {\n-              type: 'info',\n-              message: 'flash.not-eligible'\n-            }\n-          ]\n-        });\n-      }\n-\n-      if (!user.isHonest) {\n-        return res.json({\n-          messages: [\n-            {\n-              type: 'info',\n-              message: 'flash.not-honest',\n-              variables: { username: username }\n-            }\n-          ]\n-        });\n-      }\n-\n-      if (isLocked) {\n-        return res.json({\n-          messages: [\n-            {\n-              type: 'info',\n-              message: 'flash.profile-private',\n-              variables: { username: username }\n-            }\n-          ]\n-        });\n-      }\n-\n-      // If the user does not have a name, and have set their name to public,\n-      // warn them. Otherwise, fallback to username\n-      if (!user.name && user.showName) {\n-        return res.json({\n-          messages: [\n-            {\n-              type: 'info',\n-              message: 'flash.add-name'\n-            }\n-          ]\n-        });\n-      }\n-\n-      if (!showCerts) {\n-        return res.json({\n-          messages: [\n-            {\n-              type: 'info',\n-              message: 'flash.certs-private',\n-              variables: { username: username }\n-            }\n-          ]\n-        });\n-      }\n-\n-      if (!showTimeLine) {\n-        return res.json({\n-          messages: [\n-            {\n-              type: 'info',\n-              message: 'flash.timeline-private',\n-              variables: { username: username }\n-            }\n-          ]\n-        });\n-      }\n-\n-      if (user[certType]) {\n-        const { completedChallenges = [] } = user;\n-        const certChallenge = _.find(\n-          completedChallenges,\n-          ({ id }) => certId === id\n-        );\n-        let { completedDate = new Date() } = certChallenge || {};\n-\n-        // the challenge id has been rotated for isDataVisCert\n-        if (certType === 'isDataVisCert' && !certChallenge) {\n-          let oldDataVisIdChall = _.find(\n-            completedChallenges,\n-            ({ id }) => oldDataVizId === id\n-          );\n-\n-          if (oldDataVisIdChall) {\n-            completedDate = oldDataVisIdChall.completedDate || completedDate;\n-          }\n-        }\n-\n-        // if fullcert is not found, return the latest completedDate\n-        if (certType === 'isFullStackCert' && !certChallenge) {\n-          completedDate = getFallbackFullStackDate(\n-            completedChallenges,\n-            completedDate\n-          );\n-        }\n-\n-        const { username, name } = user;\n-\n-        if (!showName) {\n-          return res.json({\n-            certSlug,\n-            certTitle,\n-            username,\n-            date: completedDate,\n-            completionTime\n-          });\n-        }\n-\n-        return res.json({\n-          certSlug,\n-          certTitle,\n-          username,\n-          name,\n-          date: completedDate,\n-          completionTime\n-        });\n-      }\n-      return res.json({\n-        messages: [\n-          {\n-            type: 'info',\n-            message: 'flash.user-not-certified',\n-            variables: { username: username, cert: certTypeTitleMap[certType] }\n-          }\n-        ]\n-      });\n-    }, next);\n-  };\n-}"
        },
        {
            "sha": "3a0996e2e5ae0785da4886bd36be851a5eed1a3b",
            "filename": "api-server/src/server/boot/challenge.js",
            "status": "removed",
            "additions": 0,
            "deletions": 1031,
            "changes": 1031,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fchallenge.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fchallenge.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fchallenge.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,1031 +0,0 @@\n-/**\n- *\n- * Any ref to fixCompletedChallengesItem should be removed post\n- * a db migration to fix all completedChallenges\n- *\n- * NOTE: it's been 4 years, so any active users will have been migrated. We\n- * should still try to migrate the rest at some point.\n- *\n- */\n-import debug from 'debug';\n-import dedent from 'dedent';\n-import { isEmpty, pick, omit, uniqBy } from 'lodash';\n-import { ObjectID } from 'mongodb';\n-import isNumeric from 'validator/lib/isNumeric';\n-import isURL from 'validator/lib/isURL';\n-import fetch from 'node-fetch';\n-import jwt from 'jsonwebtoken';\n-\n-import { jwtSecret } from '../../../config/secrets';\n-import { challengeTypes } from '../../../../shared/config/challenge-types';\n-\n-import {\n-  fixPartiallyCompletedChallengeItem,\n-  fixCompletedExamItem\n-} from '../../common/utils';\n-import { getChallenges } from '../utils/get-curriculum';\n-import { ifNoUserSend } from '../utils/middleware';\n-import {\n-  getRedirectParams,\n-  normalizeParams,\n-  getPrefixedLandingPath\n-} from '../utils/redirection';\n-import { generateRandomExam, createExamResults } from '../utils/exam';\n-import {\n-  validateExamFromDbSchema,\n-  validateExamResultsSchema,\n-  validateGeneratedExamSchema,\n-  validateUserCompletedExamSchema\n-} from '../utils/exam-schemas';\n-\n-const log = debug('fcc:boot:challenges');\n-\n-export default async function bootChallenge(app, done) {\n-  const send200toNonUser = ifNoUserSend(true);\n-  const api = app.loopback.Router();\n-  const router = app.loopback.Router();\n-  const challengeUrlResolver =\n-    await createChallengeUrlResolver(getChallenges());\n-  const redirectToCurrentChallenge = createRedirectToCurrentChallenge(\n-    challengeUrlResolver,\n-    normalizeParams,\n-    getRedirectParams\n-  );\n-\n-  api.post(\n-    '/modern-challenge-completed',\n-    send200toNonUser,\n-    isValidChallengeCompletion,\n-    modernChallengeCompleted\n-  );\n-\n-  api.post(\n-    '/project-completed',\n-    send200toNonUser,\n-    isValidChallengeCompletion,\n-    projectCompleted\n-  );\n-\n-  api.post(\n-    '/backend-challenge-completed',\n-    send200toNonUser,\n-    isValidChallengeCompletion,\n-    backendChallengeCompleted\n-  );\n-\n-  const generateExam = createGenerateExam(app);\n-\n-  api.get('/exam/:id', send200toNonUser, generateExam);\n-\n-  const examChallengeCompleted = createExamChallengeCompleted(app);\n-\n-  api.post(\n-    '/exam-challenge-completed',\n-    send200toNonUser,\n-    examChallengeCompleted\n-  );\n-\n-  api.post(\n-    '/save-challenge',\n-    send200toNonUser,\n-    isValidChallengeCompletion,\n-    saveChallenge\n-  );\n-\n-  router.get('/challenges/current-challenge', redirectToCurrentChallenge);\n-\n-  const coderoadChallengeCompleted = createCoderoadChallengeCompleted(app);\n-\n-  api.post('/coderoad-challenge-completed', coderoadChallengeCompleted);\n-\n-  const msTrophyChallengeCompleted = createMsTrophyChallengeCompleted(app);\n-\n-  api.post(\n-    '/ms-trophy-challenge-completed',\n-    send200toNonUser,\n-    msTrophyChallengeCompleted\n-  );\n-\n-  app.use(api);\n-  app.use(router);\n-  done();\n-}\n-\n-const jsCertProjectIds = [\n-  'aaa48de84e1ecc7c742e1124',\n-  'a7f4d8f2483413a6ce226cac',\n-  '56533eb9ac21ba0edf2244e2',\n-  'aff0395860f5d3034dc0bfc9',\n-  'aa2e6f85cab2ab736c9a9b24'\n-];\n-\n-const multifileCertProjectIds = getChallenges()\n-  .filter(\n-    challenge => challenge.challengeType === challengeTypes.multifileCertProject\n-  )\n-  .map(challenge => challenge.id);\n-\n-const multifilePythonCertProjectIds = getChallenges()\n-  .filter(\n-    challenge =>\n-      challenge.challengeType === challengeTypes.multifilePythonCertProject\n-  )\n-  .map(challenge => challenge.id);\n-\n-const savableChallenges = getChallenges()\n-  .filter(challenge => {\n-    return (\n-      challenge.challengeType === challengeTypes.multifileCertProject ||\n-      challenge.challengeType === challengeTypes.multifilePythonCertProject\n-    );\n-  })\n-  .map(challenge => challenge.id);\n-\n-const msTrophyChallenges = getChallenges()\n-  .filter(challenge => challenge.challengeType === challengeTypes.msTrophy)\n-  .map(({ id, msTrophyId }) => ({ id, msTrophyId }));\n-\n-export function buildUserUpdate(\n-  user,\n-  challengeId,\n-  _completedChallenge,\n-  timezone\n-) {\n-  const { files, completedDate = Date.now() } = _completedChallenge;\n-  let completedChallenge = {};\n-  if (\n-    jsCertProjectIds.includes(challengeId) ||\n-    multifileCertProjectIds.includes(challengeId) ||\n-    multifilePythonCertProjectIds.includes(challengeId)\n-  ) {\n-    completedChallenge = {\n-      ..._completedChallenge,\n-      files: files?.map(file =>\n-        pick(file, ['contents', 'key', 'index', 'name', 'path', 'ext'])\n-      )\n-    };\n-  } else {\n-    completedChallenge = omit(_completedChallenge, ['files']);\n-  }\n-  let finalChallenge;\n-  const $push = {},\n-    $set = {},\n-    $pull = {};\n-  const {\n-    timezone: userTimezone,\n-    completedChallenges = [],\n-    needsModeration = false,\n-    savedChallenges = []\n-  } = user;\n-\n-  const oldIndex = completedChallenges.findIndex(\n-    ({ id }) => challengeId === id\n-  );\n-\n-  const alreadyCompleted = oldIndex !== -1;\n-  const oldChallenge = alreadyCompleted ? completedChallenges[oldIndex] : null;\n-\n-  if (alreadyCompleted) {\n-    finalChallenge = {\n-      ...completedChallenge,\n-      completedDate: oldChallenge.completedDate\n-    };\n-    $set[`completedChallenges.${oldIndex}`] = finalChallenge;\n-  } else {\n-    finalChallenge = {\n-      ...completedChallenge\n-    };\n-    $push.progressTimestamps = completedDate;\n-    $push.completedChallenges = finalChallenge;\n-  }\n-\n-  if (savableChallenges.includes(challengeId)) {\n-    const challengeToSave = {\n-      id: challengeId,\n-      lastSavedDate: completedDate,\n-      files: files?.map(file =>\n-        pick(file, ['contents', 'key', 'name', 'ext', 'history'])\n-      )\n-    };\n-\n-    const savedIndex = savedChallenges.findIndex(\n-      ({ id }) => challengeId === id\n-    );\n-\n-    if (savedIndex >= 0) {\n-      $set[`savedChallenges.${savedIndex}`] = challengeToSave;\n-      savedChallenges[savedIndex] = challengeToSave;\n-    } else {\n-      $push.savedChallenges = challengeToSave;\n-      savedChallenges.push(challengeToSave);\n-    }\n-  }\n-\n-  // remove from partiallyCompleted on submit\n-  $pull.partiallyCompletedChallenges = { id: challengeId };\n-\n-  if (\n-    timezone &&\n-    timezone !== 'UTC' &&\n-    (!userTimezone || userTimezone === 'UTC')\n-  ) {\n-    $set.timezone = userTimezone;\n-  }\n-\n-  if (needsModeration) $set.needsModeration = true;\n-\n-  const updateData = {};\n-  if (!isEmpty($set)) updateData.$set = $set;\n-  if (!isEmpty($push)) updateData.$push = $push;\n-  if (!isEmpty($pull)) updateData.$pull = $pull;\n-\n-  return {\n-    alreadyCompleted,\n-    updateData,\n-    completedDate: finalChallenge.completedDate,\n-    savedChallenges\n-  };\n-}\n-\n-export function buildExamUserUpdate(user, _completedChallenge) {\n-  const {\n-    id,\n-    challengeType,\n-    completedDate = Date.now(),\n-    examResults\n-  } = _completedChallenge;\n-\n-  let finalChallenge = { id, challengeType, completedDate, examResults };\n-\n-  const { completedChallenges = [] } = user;\n-  const $push = {},\n-    $set = {};\n-\n-  // Always push to completedExams[] to keep a record of all submissions, it may come in handy.\n-  $push.completedExams = fixCompletedExamItem(_completedChallenge);\n-\n-  let alreadyCompleted = false;\n-  let addPoint = false;\n-\n-  // completedChallenges[] should have their best exam\n-  if (examResults.passed) {\n-    const alreadyCompletedIndex = completedChallenges.findIndex(\n-      challenge => challenge.id === id\n-    );\n-\n-    alreadyCompleted = alreadyCompletedIndex !== -1;\n-\n-    if (alreadyCompleted) {\n-      const { percentCorrect } = examResults;\n-      const oldChallenge = completedChallenges[alreadyCompletedIndex];\n-      const oldResults = oldChallenge.examResults;\n-\n-      // only update if it's a better result\n-      if (percentCorrect > oldResults.percentCorrect) {\n-        finalChallenge.completedDate = oldChallenge.completedDate;\n-        $set[`completedChallenges.${alreadyCompletedIndex}`] = finalChallenge;\n-      }\n-    } else {\n-      addPoint = true;\n-      $push.completedChallenges = finalChallenge;\n-    }\n-  }\n-\n-  const updateData = {};\n-  if (!isEmpty($set)) updateData.$set = $set;\n-  if (!isEmpty($push)) updateData.$push = $push;\n-\n-  return {\n-    alreadyCompleted,\n-    addPoint,\n-    updateData,\n-    completedDate: finalChallenge.completedDate\n-  };\n-}\n-\n-export function buildChallengeUrl(challenge) {\n-  const { superBlock, block, dashedName } = challenge;\n-  return `/learn/${superBlock}/${block}/${dashedName}`;\n-}\n-\n-// this is only called once during boot, so it can be slow.\n-export function getFirstChallenge(allChallenges) {\n-  const first = allChallenges.find(\n-    ({ challengeOrder, superOrder, order }) =>\n-      challengeOrder === 0 && superOrder === 0 && order === 0\n-  );\n-\n-  return first ? buildChallengeUrl(first) : '/learn';\n-}\n-\n-function getChallengeById(allChallenges, targetId) {\n-  return allChallenges.find(({ id }) => id === targetId);\n-}\n-\n-export async function createChallengeUrlResolver(\n-  allChallenges,\n-  { _getFirstChallenge = getFirstChallenge } = {}\n-) {\n-  const cache = new Map();\n-  const firstChallenge = _getFirstChallenge(allChallenges);\n-\n-  return function resolveChallengeUrl(id) {\n-    if (isEmpty(id)) {\n-      return Promise.resolve(firstChallenge);\n-    } else {\n-      return new Promise(resolve => {\n-        if (cache.has(id)) {\n-          resolve(cache.get(id));\n-        }\n-\n-        const challenge = getChallengeById(allChallenges, id);\n-        if (isEmpty(challenge)) {\n-          resolve(firstChallenge);\n-        } else {\n-          const challengeUrl = buildChallengeUrl(challenge);\n-          cache.set(id, challengeUrl);\n-          resolve(challengeUrl);\n-        }\n-      });\n-    }\n-  };\n-}\n-\n-export function isValidChallengeCompletion(req, res, next) {\n-  const {\n-    body: { id, challengeType, solution, githubLink }\n-  } = req;\n-\n-  // ToDO: Validate other things (challengeFiles, etc)\n-  const isValidChallengeCompletionErrorMsg = {\n-    type: 'error',\n-    message: 'That does not appear to be a valid challenge submission.'\n-  };\n-\n-  if (!ObjectID.isValid(id)) {\n-    log('isObjectId', id, ObjectID.isValid(id));\n-    return res.status(403).json(isValidChallengeCompletionErrorMsg);\n-  }\n-  if ('challengeType' in req.body && !isNumeric(String(challengeType))) {\n-    log('challengeType', challengeType, isNumeric(challengeType));\n-    return res.status(403).json(isValidChallengeCompletionErrorMsg);\n-  }\n-  // If `backEndProject`:\n-  // - `solution` needs to exist, but does not have to be valid URL\n-  // - `githubLink` needs to exist and be valid URL\n-  if (challengeType === challengeTypes.backEndProject) {\n-    if (!solution || !isURL(githubLink + '')) {\n-      log('isObjectId', id, ObjectID.isValid(id));\n-      return res.status(403).json(isValidChallengeCompletionErrorMsg);\n-    }\n-  } else if ('solution' in req.body && !isURL(solution)) {\n-    log('isObjectId', id, ObjectID.isValid(id));\n-    return res.status(403).json(isValidChallengeCompletionErrorMsg);\n-  }\n-  return next();\n-}\n-\n-export async function modernChallengeCompleted(req, res, next) {\n-  const user = req.user;\n-\n-  try {\n-    // This is an ugly way to update `user.completedChallenges`\n-    await user.getCompletedChallenges$().toPromise();\n-  } catch (e) {\n-    return next(e);\n-  }\n-\n-  const completedDate = Date.now();\n-  const { id, files, challengeType } = req.body;\n-\n-  const completedChallenge = {\n-    id,\n-    files,\n-    completedDate\n-  };\n-\n-  // if multifile cert project\n-  if (challengeType === 14) {\n-    completedChallenge.isManuallyApproved = false;\n-    user.needsModeration = true;\n-  }\n-\n-  // We only need to know the challenge type if it's a project. If it's a\n-  // step or normal challenge we can avoid storing in the database.\n-  if (\n-    jsCertProjectIds.includes(id) ||\n-    multifileCertProjectIds.includes(id) ||\n-    multifilePythonCertProjectIds.includes(id)\n-  ) {\n-    completedChallenge.challengeType = challengeType;\n-  }\n-\n-  const { alreadyCompleted, savedChallenges, updateData } = buildUserUpdate(\n-    user,\n-    id,\n-    completedChallenge\n-  );\n-\n-  const points = alreadyCompleted ? user.points : user.points + 1;\n-\n-  user.updateAttributes(updateData, err => {\n-    if (err) {\n-      return next(err);\n-    }\n-\n-    return res.json({\n-      points,\n-      alreadyCompleted,\n-      completedDate,\n-      savedChallenges\n-    });\n-  });\n-}\n-\n-async function projectCompleted(req, res, next) {\n-  const { user, body = {} } = req;\n-\n-  const completedChallenge = pick(body, [\n-    'id',\n-    'solution',\n-    'githubLink',\n-    'challengeType',\n-    'files'\n-  ]);\n-  completedChallenge.completedDate = Date.now();\n-\n-  if (\n-    !completedChallenge.solution ||\n-    (completedChallenge.challengeType === challengeTypes.backEndProject &&\n-      !completedChallenge.githubLink)\n-  ) {\n-    return res.status(403).json({\n-      type: 'error',\n-      message:\n-        'You have not provided the valid links for us to inspect your work.'\n-    });\n-  }\n-\n-  // CodeRoad cert project\n-  if (completedChallenge.challengeType === 13) {\n-    const { partiallyCompletedChallenges = [], completedChallenges = [] } =\n-      user;\n-\n-    const isPartiallyCompleted = partiallyCompletedChallenges.some(\n-      challenge => challenge.id === completedChallenge.id\n-    );\n-\n-    const isCompleted = completedChallenges.some(\n-      challenge => challenge.id === completedChallenge.id\n-    );\n-\n-    if (!isPartiallyCompleted && !isCompleted) {\n-      return res.status(403).json({\n-        type: 'error',\n-        message: 'You have to complete the project before you can submit a URL.'\n-      });\n-    }\n-  }\n-\n-  try {\n-    // This is an ugly hack to update `user.completedChallenges`\n-    await user.getCompletedChallenges$().toPromise();\n-  } catch (e) {\n-    return next(e);\n-  }\n-\n-  const { alreadyCompleted, updateData } = buildUserUpdate(\n-    user,\n-    completedChallenge.id,\n-    completedChallenge\n-  );\n-\n-  user.updateAttributes(updateData, err => {\n-    if (err) {\n-      return next(err);\n-    }\n-\n-    return res.json({\n-      alreadyCompleted,\n-      points: alreadyCompleted ? user.points : user.points + 1,\n-      completedDate: completedChallenge.completedDate\n-    });\n-  });\n-}\n-\n-async function backendChallengeCompleted(req, res, next) {\n-  const { user, body = {} } = req;\n-\n-  const completedChallenge = pick(body, ['id', 'solution']);\n-  completedChallenge.completedDate = Date.now();\n-\n-  try {\n-    await user.getCompletedChallenges$().toPromise();\n-  } catch (e) {\n-    return next(e);\n-  }\n-\n-  const { alreadyCompleted, updateData } = buildUserUpdate(\n-    user,\n-    completedChallenge.id,\n-    completedChallenge\n-  );\n-\n-  user.updateAttributes(updateData, err => {\n-    if (err) {\n-      return next(err);\n-    }\n-\n-    return res.json({\n-      alreadyCompleted,\n-      points: alreadyCompleted ? user.points : user.points + 1,\n-      completedDate: completedChallenge.completedDate\n-    });\n-  });\n-}\n-\n-// TODO: send flash message keys to client so they can be i18n\n-function createGenerateExam(app) {\n-  const { Exam } = app.models;\n-\n-  return async function generateExam(req, res, next) {\n-    const {\n-      user,\n-      params: { id }\n-    } = req;\n-\n-    try {\n-      await user.getCompletedChallenges$().toPromise();\n-    } catch (e) {\n-      return next(e);\n-    }\n-\n-    try {\n-      const examFromDb = await Exam.findById(id);\n-      if (!examFromDb) {\n-        res.status(500);\n-        throw new Error(\n-          `An error occurred trying to get the exam from the database.`\n-        );\n-      }\n-\n-      // This is cause there was struggles validating the exam directly from the db/loopback\n-      const examJson = JSON.parse(JSON.stringify(examFromDb));\n-\n-      const validExamFromDbSchema = validateExamFromDbSchema(examJson);\n-\n-      if (validExamFromDbSchema.error) {\n-        res.status(500);\n-        log(validExamFromDbSchema.error);\n-        throw new Error(\n-          `An error occurred validating the exam information from the database.`\n-        );\n-      }\n-\n-      const { prerequisites, numberOfQuestionsInExam, title } = examJson;\n-\n-      // Validate User has completed prerequisite challenges\n-      prerequisites?.forEach(prerequisite => {\n-        const prerequisiteCompleted = user.completedChallenges.find(\n-          challenge => challenge.id === prerequisite.id\n-        );\n-\n-        if (!prerequisiteCompleted) {\n-          res.status(403);\n-          throw new Error(\n-            `You have not completed the required challenges to start the '${title}'.`\n-          );\n-        }\n-      });\n-\n-      const randomizedExam = generateRandomExam(examJson);\n-\n-      const validGeneratedExamSchema = validateGeneratedExamSchema(\n-        randomizedExam,\n-        numberOfQuestionsInExam\n-      );\n-\n-      if (validGeneratedExamSchema.error) {\n-        res.status(500);\n-        log(validGeneratedExamSchema.error);\n-        throw new Error(`An error occurred trying to randomize the exam.`);\n-      }\n-\n-      return res.send({ generatedExam: randomizedExam });\n-    } catch (err) {\n-      log(err);\n-      return res.send({ error: err.message });\n-    }\n-  };\n-}\n-\n-function createExamChallengeCompleted(app) {\n-  const { Exam } = app.models;\n-\n-  return async function examChallengeCompleted(req, res, next) {\n-    const { body = {}, user } = req;\n-\n-    try {\n-      await user.getCompletedChallenges$().toPromise();\n-    } catch (e) {\n-      return next(e);\n-    }\n-\n-    const { userCompletedExam = [], id } = body;\n-\n-    try {\n-      const examFromDb = await Exam.findById(id);\n-      if (!examFromDb) {\n-        res.status(500);\n-        throw new Error(\n-          `An error occurred tryng to get the exam from the database.`\n-        );\n-      }\n-\n-      // This is cause there was struggles validating the exam directly from the db/loopback\n-      const examJson = JSON.parse(JSON.stringify(examFromDb));\n-\n-      const validExamFromDbSchema = validateExamFromDbSchema(examJson);\n-      if (validExamFromDbSchema.error) {\n-        res.status(500);\n-        log(validExamFromDbSchema.error);\n-        throw new Error(\n-          `An error occurred validating the exam information from the database.`\n-        );\n-      }\n-\n-      const { prerequisites, numberOfQuestionsInExam, title } = examJson;\n-\n-      // Validate User has completed prerequisite challenges\n-      prerequisites?.forEach(prerequisite => {\n-        const prerequisiteCompleted = user.completedChallenges.find(\n-          challenge => challenge.id === prerequisite.id\n-        );\n-\n-        if (!prerequisiteCompleted) {\n-          res.status(403);\n-          throw new Error(\n-            `You have not completed the required challenges to start the '${title}'.`\n-          );\n-        }\n-      });\n-\n-      // Validate user completed exam\n-      const validUserCompletedExam = validateUserCompletedExamSchema(\n-        userCompletedExam,\n-        numberOfQuestionsInExam\n-      );\n-      if (validUserCompletedExam.error) {\n-        res.status(400);\n-        log(validUserCompletedExam.error);\n-        throw new Error(`An error occurred validating the submitted exam.`);\n-      }\n-\n-      const examResults = createExamResults(userCompletedExam, examJson);\n-\n-      const validExamResults = validateExamResultsSchema(examResults);\n-      if (validExamResults.error) {\n-        res.status(500);\n-        log(validExamResults.error);\n-        throw new Error(`An error occurred validating the submitted exam.`);\n-      }\n-\n-      const completedChallenge = pick(body, ['id', 'challengeType']);\n-      completedChallenge.completedDate = Date.now();\n-      completedChallenge.examResults = examResults;\n-\n-      const { addPoint, alreadyCompleted, updateData, completedDate } =\n-        buildExamUserUpdate(user, completedChallenge);\n-\n-      user.updateAttributes(updateData, err => {\n-        if (err) {\n-          return next(err);\n-        }\n-\n-        const points = addPoint ? user.points + 1 : user.points;\n-\n-        return res.json({\n-          alreadyCompleted,\n-          points,\n-          completedDate,\n-          examResults\n-        });\n-      });\n-    } catch (err) {\n-      log(err);\n-      return res.send({ error: err.message });\n-    }\n-  };\n-}\n-\n-function createMsTrophyChallengeCompleted(app) {\n-  const { MsUsername } = app.models;\n-\n-  return async function msTrophyChallengeCompleted(req, res, next) {\n-    const { user, body = {} } = req;\n-    const { id = '' } = body;\n-\n-    try {\n-      const msUser = await MsUsername.findOne({\n-        where: { userId: user.id }\n-      });\n-\n-      if (!msUser || !msUser.msUsername) {\n-        return res\n-          .status(403)\n-          .json({ type: 'error', message: 'flash.ms.trophy.err-1' });\n-      }\n-\n-      const { msUsername } = msUser;\n-\n-      const challenge = msTrophyChallenges.find(\n-        challenge => challenge.id === id\n-      );\n-\n-      if (!challenge) {\n-        return res\n-          .status(400)\n-          .json({ type: 'error', message: 'flash.ms.trophy.err-2' });\n-      }\n-\n-      const { msTrophyId = '' } = challenge;\n-\n-      const msProfileApi = `https://learn.microsoft.com/api/profiles/${msUsername}`;\n-      const msProfileApiRes = await fetch(msProfileApi);\n-      const msProfileJson = await msProfileApiRes.json();\n-\n-      if (!msProfileApiRes.ok || !msProfileJson.userId) {\n-        return res.status(403).json({\n-          type: 'error',\n-          message: 'flash.ms.profile.err',\n-          variables: {\n-            msUsername\n-          }\n-        });\n-      }\n-\n-      const { userId } = msProfileJson;\n-\n-      const msUserAchievementsApi = `https://learn.microsoft.com/api/achievements/user/${userId}`;\n-      const msUserAchievementsApiRes = await fetch(msUserAchievementsApi);\n-      const msUserAchievementsJson = await msUserAchievementsApiRes.json();\n-\n-      if (!msUserAchievementsApiRes.ok) {\n-        return res.status(403).json({\n-          type: 'error',\n-          message: 'flash.ms.trophy.err-3'\n-        });\n-      }\n-\n-      if (msUserAchievementsJson.achievements?.length === 0) {\n-        return res.status(403).json({\n-          type: 'error',\n-          message: 'flash.ms.trophy.err-6'\n-        });\n-      }\n-\n-      const hasEarnedTrophy = msUserAchievementsJson.achievements?.some(\n-        a => a.typeId === msTrophyId\n-      );\n-\n-      if (!hasEarnedTrophy) {\n-        return res.status(403).json({\n-          type: 'error',\n-          message: 'flash.ms.trophy.err-4',\n-          variables: {\n-            msUsername\n-          }\n-        });\n-      }\n-\n-      const completedChallenge = pick(body, ['id']);\n-\n-      completedChallenge.solution = msUserAchievementsApi;\n-      completedChallenge.completedDate = Date.now();\n-\n-      try {\n-        await user.getCompletedChallenges$().toPromise();\n-      } catch (e) {\n-        return next(e);\n-      }\n-\n-      const { alreadyCompleted, updateData } = buildUserUpdate(\n-        user,\n-        completedChallenge.id,\n-        completedChallenge\n-      );\n-\n-      user.updateAttributes(updateData, err => {\n-        if (err) {\n-          return next(err);\n-        }\n-\n-        return res.json({\n-          alreadyCompleted,\n-          points: alreadyCompleted ? user.points : user.points + 1,\n-          completedDate: completedChallenge.completedDate\n-        });\n-      });\n-    } catch (e) {\n-      log(e);\n-      return res.status(500).json({\n-        type: 'error',\n-        message: 'flash.ms.trophy.err-5'\n-      });\n-    }\n-  };\n-}\n-\n-async function saveChallenge(req, res, next) {\n-  const user = req.user;\n-  const { savedChallenges = [] } = user;\n-  const { id: challengeId, files = [] } = req.body;\n-\n-  if (!savableChallenges.includes(challengeId)) {\n-    return res.status(403).send('That challenge type is not savable');\n-  }\n-\n-  const challengeToSave = {\n-    id: challengeId,\n-    lastSavedDate: Date.now(),\n-    files: files?.map(file =>\n-      pick(file, ['contents', 'key', 'name', 'ext', 'history'])\n-    )\n-  };\n-\n-  try {\n-    await user.getSavedChallenges$().toPromise();\n-  } catch (e) {\n-    return next(e);\n-  }\n-\n-  const savedIndex = savedChallenges.findIndex(({ id }) => challengeId === id);\n-  const $push = {},\n-    $set = {};\n-\n-  if (savedIndex >= 0) {\n-    $set[`savedChallenges.${savedIndex}`] = challengeToSave;\n-    savedChallenges[savedIndex] = challengeToSave;\n-  } else {\n-    $push.savedChallenges = challengeToSave;\n-    savedChallenges.push(challengeToSave);\n-  }\n-\n-  const updateData = {};\n-  if (!isEmpty($set)) updateData.$set = $set;\n-  if (!isEmpty($push)) updateData.$push = $push;\n-\n-  user.updateAttributes(updateData, err => {\n-    if (err) {\n-      return next(err);\n-    }\n-\n-    return res.json({\n-      savedChallenges\n-    });\n-  });\n-}\n-\n-const codeRoadChallenges = getChallenges().filter(\n-  ({ challengeType }) => challengeType === 12 || challengeType === 13\n-);\n-\n-function createCoderoadChallengeCompleted(app) {\n-  /* Example request coming from CodeRoad:\n-   * req.body: { tutorialId: 'freeCodeCamp/learn-bash-by-building-a-boilerplate:v1.0.0' }\n-   * req.headers: { coderoad-user-token: '8kFIlZiwMioY6hqqt...' }\n-   */\n-\n-  const { UserToken, User } = app.models;\n-\n-  return async function coderoadChallengeCompleted(req, res) {\n-    const { 'coderoad-user-token': encodedUserToken } = req.headers;\n-    const { tutorialId } = req.body;\n-\n-    if (!tutorialId) return res.send(`'tutorialId' not found in request body`);\n-\n-    if (!encodedUserToken)\n-      return res.send(`'coderoad-user-token' not found in request headers`);\n-\n-    let userToken;\n-\n-    try {\n-      userToken = jwt.verify(encodedUserToken, jwtSecret)?.userToken;\n-    } catch {\n-      return res.send(`invalid user token`);\n-    }\n-\n-    const tutorialRepo = tutorialId?.split(':')[0];\n-    const tutorialOrg = tutorialRepo?.split('/')?.[0];\n-\n-    if (tutorialOrg !== 'freeCodeCamp')\n-      return res.send('Tutorial not hosted on freeCodeCamp GitHub account');\n-\n-    // validate tutorial name is in codeRoadChallenges object\n-    const challenge = codeRoadChallenges.find(challenge =>\n-      challenge.url?.endsWith(tutorialRepo)\n-    );\n-\n-    if (!challenge) return res.send('Tutorial name is not valid');\n-\n-    const { id: challengeId, challengeType } = challenge;\n-\n-    try {\n-      // check if user token is in database\n-      const tokenInfo = await UserToken.findOne({\n-        where: { id: userToken }\n-      });\n-\n-      if (!tokenInfo) return res.send('User token not found');\n-\n-      const { userId } = tokenInfo;\n-\n-      // check if user exists for user token\n-      const user = await User.findOne({\n-        where: { id: userId }\n-      });\n-\n-      if (!user) return res.send('User for user token not found');\n-\n-      // submit challenge\n-      const completedDate = Date.now();\n-      const { completedChallenges = [], partiallyCompletedChallenges = [] } =\n-        user;\n-\n-      let userUpdateInfo = {};\n-\n-      const isCompleted = completedChallenges.some(\n-        challenge => challenge.id === challengeId\n-      );\n-\n-      // if CodeRoad cert project and not in completedChallenges,\n-      // add to partiallyCompletedChallenges\n-      if (challengeType === 13 && !isCompleted) {\n-        const finalChallenge = {\n-          id: challengeId,\n-          completedDate\n-        };\n-\n-        userUpdateInfo.updateData = {};\n-        userUpdateInfo.updateData.$set = {\n-          partiallyCompletedChallenges: uniqBy(\n-            [\n-              finalChallenge,\n-              ...partiallyCompletedChallenges.map(\n-                fixPartiallyCompletedChallengeItem\n-              )\n-            ],\n-            'id'\n-          )\n-        };\n-\n-        // else, add to or update completedChallenges\n-      } else {\n-        userUpdateInfo = buildUserUpdate(user, challengeId, {\n-          id: challengeId,\n-          completedDate\n-        });\n-      }\n-      const updatedUser = await user.updateAttributes(\n-        userUpdateInfo?.updateData\n-      );\n-\n-      if (!updatedUser)\n-        return res.send('An error occurred trying to submit the challenge');\n-    } catch (e) {\n-      return res.send('An error occurred trying to submit the challenge');\n-    }\n-\n-    return res.send('Successfully submitted challenge');\n-  };\n-}\n-\n-// TODO: extend tests to cover www.freecodecamp.org/language and\n-// chinese.freecodecamp.org\n-export function createRedirectToCurrentChallenge(\n-  challengeUrlResolver,\n-  normalizeParams,\n-  getRedirectParams\n-) {\n-  return async function redirectToCurrentChallenge(req, res, next) {\n-    const { user } = req;\n-    const { origin, pathPrefix } = getRedirectParams(req, normalizeParams);\n-\n-    const redirectBase = getPrefixedLandingPath(origin, pathPrefix);\n-    if (!user) {\n-      return res.redirect(redirectBase + '/learn');\n-    }\n-\n-    const challengeId = user && user.currentChallengeId;\n-    const challengeUrl = await challengeUrlResolver(challengeId).catch(next);\n-    if (challengeUrl === '/learn') {\n-      // this should normally not be hit if database is properly seeded\n-      throw new Error(dedent`\n-        Attempted to find the url for ${challengeId || 'Unknown ID'}'\n-        but came up empty.\n-        db may not be properly seeded.\n-      `);\n-    }\n-    return res.redirect(`${redirectBase}${challengeUrl}`);\n-  };\n-}"
        },
        {
            "sha": "05aee1ac93e62afa228ee5cb76672382f5b30673",
            "filename": "api-server/src/server/boot/donate.js",
            "status": "removed",
            "additions": 0,
            "deletions": 189,
            "changes": 189,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fdonate.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fdonate.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fdonate.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,189 +0,0 @@\n-import debug from 'debug';\n-import Stripe from 'stripe';\n-\n-import {\n-  donationSubscriptionConfig,\n-  allStripeProductIdsArray\n-} from '../../../../shared/config/donation-settings';\n-import keys from '../../../config/secrets';\n-import {\n-  createStripeCardDonation,\n-  handleStripeCardUpdateSession,\n-  inLastFiveMinutes\n-} from '../utils/donation';\n-import { validStripeForm } from '../utils/stripeHelpers';\n-\n-const log = debug('fcc:boot:donate');\n-\n-export default function donateBoot(app, done) {\n-  let stripe = false;\n-  const { User } = app.models;\n-  const api = app.loopback.Router();\n-  const hooks = app.loopback.Router();\n-  const donateRouter = app.loopback.Router();\n-\n-  function connectToStripe() {\n-    return new Promise(function () {\n-      // connect to stripe API\n-      stripe = Stripe(keys.stripe.secret);\n-    });\n-  }\n-\n-  async function handleStripeCardDonation(req, res) {\n-    return createStripeCardDonation(req, res, stripe, app).catch(err => {\n-      if (\n-        err.type === 'AlreadyDonatingError' ||\n-        err.type === 'UserActionRequired' ||\n-        err.type === 'PaymentMethodRequired'\n-      ) {\n-        return res.status(402).send({ error: err });\n-      }\n-      if (err.type === 'InvalidRequest')\n-        return res.status(400).send({ error: err });\n-      return res.status(500).send({\n-        error: 'Donation failed due to a server error.'\n-      });\n-    });\n-  }\n-\n-  async function createStripeDonation(req, res) {\n-    const { body } = req;\n-    const { amount, duration, email, subscriptionId } = body;\n-    try {\n-      const subscription = await stripe.subscriptions.retrieve(subscriptionId);\n-      const isSubscriptionActive = subscription.status === 'active';\n-      const productId = subscription.items.data[0].plan.product;\n-      const isStartedRecently = inLastFiveMinutes(\n-        subscription.current_period_start\n-      );\n-      const isProductIdValid = allStripeProductIdsArray.includes(productId);\n-\n-      if (isSubscriptionActive && isProductIdValid && isStartedRecently) {\n-        const [donatingUser] = await User.findOrCreate(\n-          { where: { email } },\n-          { email }\n-        );\n-        const donation = {\n-          email,\n-          amount,\n-          duration,\n-          provider: 'stripe',\n-          subscriptionId,\n-          customerId: subscription.customer,\n-          startDate: new Date().toISOString()\n-        };\n-        await donatingUser.createDonation(donation);\n-        return res.status(200).send({ isDonating: true });\n-      } else {\n-        throw new Error('Donation failed due to a server error.');\n-      }\n-    } catch (err) {\n-      return res\n-        .status(500)\n-        .send({ error: 'Donation failed due to a server error.' });\n-    }\n-  }\n-\n-  async function createStripePaymentIntent(req, res) {\n-    const { body } = req;\n-    const { amount, duration, email, name } = body;\n-\n-    if (!validStripeForm(amount, duration, email)) {\n-      return res.status(400).send({\n-        error: 'The donation form had invalid values for this submission.'\n-      });\n-    }\n-\n-    try {\n-      const stripeCustomer = await stripe.customers.create({\n-        email,\n-        name\n-      });\n-\n-      const stripeSubscription = await stripe.subscriptions.create({\n-        customer: stripeCustomer.id,\n-        items: [\n-          {\n-            plan: `${donationSubscriptionConfig.duration[duration]}-donation-${amount}`\n-          }\n-        ],\n-        payment_behavior: 'default_incomplete',\n-        payment_settings: { save_default_payment_method: 'on_subscription' },\n-        expand: ['latest_invoice.payment_intent']\n-      });\n-\n-      res.status(200).send({\n-        subscriptionId: stripeSubscription.id,\n-        clientSecret:\n-          stripeSubscription.latest_invoice.payment_intent.client_secret\n-      });\n-    } catch (err) {\n-      return res\n-        .status(500)\n-        .send({ error: 'Donation failed due to a server error.' });\n-    }\n-  }\n-\n-  function addDonation(req, res) {\n-    const { user, body } = req;\n-    if (!user || !body) {\n-      return res\n-        .status(500)\n-        .json({ error: 'User must be signed in for this request.' });\n-    }\n-    return Promise.resolve(req)\n-      .then(\n-        user.updateAttributes({\n-          isDonating: true\n-        })\n-      )\n-      .then(() => res.status(200).json({ isDonating: true }))\n-      .catch(err => {\n-        log(err.message);\n-        return res.status(500).json({\n-          type: 'danger',\n-          message: 'Something went wrong.'\n-        });\n-      });\n-  }\n-\n-  async function handleStripeCardUpdate(req, res, next) {\n-    try {\n-      const sessionIdObj = await handleStripeCardUpdateSession(\n-        req,\n-        app,\n-        stripe\n-      );\n-      return res.status(200).json(sessionIdObj);\n-    } catch (err) {\n-      return next(err);\n-    }\n-  }\n-\n-  const stripeKey = keys.stripe.public;\n-  const secKey = keys.stripe.secret;\n-  const stripeSecretInvalid = !secKey || secKey === 'sk_from_stripe_dashboard';\n-  const stripPublicInvalid =\n-    !stripeKey || stripeKey === 'pk_from_stripe_dashboard';\n-\n-  const stripeInvalid = stripeSecretInvalid || stripPublicInvalid;\n-\n-  if (stripeInvalid) {\n-    if (process.env.FREECODECAMP_NODE_ENV === 'production') {\n-      throw new Error('Donation API keys are required to boot the server!');\n-    }\n-    log('Donation disabled in development unless ALL test keys are provided');\n-    done();\n-  } else {\n-    api.post('/charge-stripe', createStripeDonation);\n-    api.post('/charge-stripe-card', handleStripeCardDonation);\n-    api.post('/create-stripe-payment-intent', createStripePaymentIntent);\n-    api.put('/update-stripe-card', handleStripeCardUpdate);\n-    api.post('/add-donation', addDonation);\n-    donateRouter.use('/donate', api);\n-    donateRouter.use('/hooks', hooks);\n-    app.use(donateRouter);\n-    connectToStripe(stripe).then(done);\n-    done();\n-  }\n-}"
        },
        {
            "sha": "8de921c416ed7c09924eab6a0024af01496d24d5",
            "filename": "api-server/src/server/boot/explorer.js",
            "status": "removed",
            "additions": 0,
            "deletions": 33,
            "changes": 33,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fexplorer.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fexplorer.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fexplorer.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,33 +0,0 @@\n-const createDebugger = require('debug');\n-\n-const log = createDebugger('fcc:boot:explorer');\n-\n-module.exports = function mountLoopBackExplorer(app) {\n-  if (process.env.FREECODECAMP_NODE_ENV === 'production') {\n-    return;\n-  }\n-  let explorer;\n-  try {\n-    explorer = require('loopback-component-explorer');\n-  } catch (err) {\n-    // Print the message only when the app was started via `app.listen()`.\n-    // Do not print any message when the project is used as a component.\n-    app.once('started', function () {\n-      log(\n-        'Run `pnpm add loopback-component-explorer` to enable ' +\n-          'the LoopBack explorer'\n-      );\n-    });\n-    return;\n-  }\n-\n-  const restApiRoot = app.get('restApiRoot');\n-  const mountPath = '/explorer';\n-\n-  explorer(app, { basePath: restApiRoot, mountPath });\n-  app.once('started', function () {\n-    const baseUrl = app.get('url').replace(/\\/$/, '');\n-\n-    log('Browse your REST API at %s%s', baseUrl, mountPath);\n-  });\n-};"
        },
        {
            "sha": "a8c22e60f51afcfa7c9ab0d9e528ad10accbdce5",
            "filename": "api-server/src/server/boot/news.js",
            "status": "removed",
            "additions": 0,
            "deletions": 41,
            "changes": 41,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fnews.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fnews.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fnews.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,41 +0,0 @@\n-import debug from 'debug';\n-\n-const log = debug('fcc:boot:news');\n-\n-export default function newsBoot(app) {\n-  const router = app.loopback.Router();\n-\n-  router.get('/n', (req, res) => res.redirect('/news'));\n-  router.get('/n/:shortId', createShortLinkHandler(app));\n-}\n-\n-function createShortLinkHandler(app) {\n-  const { Article } = app.models;\n-\n-  return function shortLinkHandler(req, res, next) {\n-    const { shortId } = req.params;\n-\n-    if (!shortId) {\n-      return res.redirect('/news');\n-    }\n-    log('shortId', shortId);\n-    return Article.findOne(\n-      {\n-        where: {\n-          or: [{ shortId }, { slugPart: shortId }]\n-        }\n-      },\n-      (err, article) => {\n-        if (err) {\n-          next(err);\n-        }\n-        if (!article) {\n-          return res.redirect('/news');\n-        }\n-        const { slugPart } = article;\n-        const slug = `/news/${slugPart}`;\n-        return res.redirect(slug);\n-      }\n-    );\n-  };\n-}"
        },
        {
            "sha": "4d238796304baf25e89cc1aabdf8ca09c95984bd",
            "filename": "api-server/src/server/boot/randomAPIs.js",
            "status": "removed",
            "additions": 0,
            "deletions": 242,
            "changes": 242,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2FrandomAPIs.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2FrandomAPIs.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2FrandomAPIs.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,242 +0,0 @@\n-import { pick } from 'lodash';\n-import { getRedirectParams } from '../utils/redirection';\n-import { deprecatedEndpoint } from '../utils/disabled-endpoints';\n-import {\n-  getProgress,\n-  normaliseUserFields,\n-  publicUserProps\n-} from '../utils/publicUserProps';\n-\n-module.exports = function (app) {\n-  const router = app.loopback.Router();\n-  const User = app.models.User;\n-\n-  router.get('/api/github', deprecatedEndpoint);\n-  router.get('/u/:email', unsubscribeDeprecated);\n-  router.get('/unsubscribe/:email', unsubscribeDeprecated);\n-  router.get('/ue/:unsubscribeId', unsubscribeById);\n-  router.get('/resubscribe/:unsubscribeId', resubscribe);\n-  router.get('/users/get-public-profile', blockUserAgent, getPublicProfile);\n-  const getUserExists = createGetUserExists(app);\n-  router.get('/users/exists', getUserExists);\n-\n-  app.use(router);\n-\n-  function unsubscribeDeprecated(req, res) {\n-    req.flash(\n-      'info',\n-      'We are no longer able to process this unsubscription request. ' +\n-        'Please go to your settings to update your email preferences'\n-    );\n-    const { origin } = getRedirectParams(req);\n-    res.redirectWithFlash(origin);\n-  }\n-\n-  function unsubscribeById(req, res, next) {\n-    const { origin } = getRedirectParams(req);\n-    const { unsubscribeId } = req.params;\n-    if (!unsubscribeId) {\n-      req.flash('info', 'We could not find an account to unsubscribe');\n-      return res.redirectWithFlash(origin);\n-    }\n-    return User.find({ where: { unsubscribeId } }, (err, users) => {\n-      if (err || !users.length) {\n-        req.flash('info', 'We could not find an account to unsubscribe');\n-        return res.redirectWithFlash(origin);\n-      }\n-      const updates = users.map(user => {\n-        return new Promise((resolve, reject) =>\n-          user.updateAttributes(\n-            {\n-              sendQuincyEmail: false\n-            },\n-            err => {\n-              if (err) {\n-                reject(err);\n-              } else {\n-                resolve();\n-              }\n-            }\n-          )\n-        );\n-      });\n-      return Promise.all(updates)\n-        .then(() => {\n-          req.flash(\n-            'success',\n-            \"We've successfully updated your email preferences.\"\n-          );\n-          return res.redirectWithFlash(\n-            `${origin}/unsubscribed/${unsubscribeId}`\n-          );\n-        })\n-        .catch(next);\n-    });\n-  }\n-\n-  function resubscribe(req, res, next) {\n-    const { unsubscribeId } = req.params;\n-    const { origin } = getRedirectParams(req);\n-    if (!unsubscribeId) {\n-      req.flash(\n-        'info',\n-        'We were unable to process this request, please check and try again'\n-      );\n-      res.redirect(origin);\n-    }\n-    return User.find({ where: { unsubscribeId } }, (err, users) => {\n-      if (err || !users.length) {\n-        req.flash('info', 'We could not find an account to resubscribe');\n-        return res.redirectWithFlash(origin);\n-      }\n-      const [user] = users;\n-      return new Promise((resolve, reject) =>\n-        user.updateAttributes(\n-          {\n-            sendQuincyEmail: true\n-          },\n-          err => {\n-            if (err) {\n-              reject(err);\n-            } else {\n-              resolve();\n-            }\n-          }\n-        )\n-      )\n-        .then(() => {\n-          req.flash(\n-            'success',\n-            \"We've successfully updated your email preferences. Thank you for resubscribing.\"\n-          );\n-          return res.redirectWithFlash(origin);\n-        })\n-        .catch(next);\n-    });\n-  }\n-\n-  const blockedUserAgentParts = ['python', 'google-apps-script', 'curl'];\n-\n-  function blockUserAgent(req, res, next) {\n-    const userAgent = req.headers['user-agent'];\n-\n-    if (\n-      !userAgent ||\n-      blockedUserAgentParts.some(ua => userAgent.toLowerCase().includes(ua))\n-    ) {\n-      return res\n-        .status(400)\n-        .send(\n-          'This endpoint is no longer available outside of the freeCodeCamp ecosystem'\n-        );\n-    }\n-\n-    return next();\n-  }\n-\n-  async function getPublicProfile(req, res) {\n-    const { username } = req.query;\n-    if (!username) {\n-      return res.status(400).json({ error: 'No username provided' });\n-    }\n-\n-    const user = await User.findOne({ where: { username } });\n-\n-    if (!user) {\n-      return res.status(404).json({ error: 'User not found' });\n-    }\n-\n-    const { completedChallenges, progressTimestamps, profileUI } = user;\n-    const allUser = {\n-      ...pick(user, publicUserProps),\n-      points: progressTimestamps.length,\n-      completedChallenges,\n-      ...getProgress(progressTimestamps),\n-      ...normaliseUserFields(user),\n-      joinDate: user.id.getTimestamp()\n-    };\n-\n-    const publicUser = prepUserForPublish(allUser, profileUI);\n-\n-    return res.json({\n-      entities: {\n-        user: {\n-          [user.username]: {\n-            ...publicUser\n-          }\n-        }\n-      },\n-      result: user.username\n-    });\n-  }\n-\n-  function createGetUserExists(app) {\n-    const User = app.models.User;\n-    return function getUserExists(req, res) {\n-      const username = req.query.username.toLowerCase();\n-\n-      User.doesExist(username, null).then(exists => {\n-        res.send({ exists });\n-      });\n-    };\n-  }\n-\n-  function prepUserForPublish(user, profileUI) {\n-    const {\n-      about,\n-      calendar,\n-      completedChallenges,\n-      isDonating,\n-      joinDate,\n-      location,\n-      name,\n-      points,\n-      portfolio,\n-      username,\n-      yearsTopContributor\n-    } = user;\n-    const {\n-      isLocked = true,\n-      showAbout = false,\n-      showCerts = false,\n-      showDonation = false,\n-      showHeatMap = false,\n-      showLocation = false,\n-      showName = false,\n-      showPoints = false,\n-      showPortfolio = false,\n-      showTimeLine = false\n-    } = profileUI;\n-\n-    if (isLocked) {\n-      return {\n-        isLocked,\n-        profileUI,\n-        username\n-      };\n-    }\n-    return {\n-      ...user,\n-      about: showAbout ? about : '',\n-      calendar: showHeatMap ? calendar : {},\n-      completedChallenges: (function () {\n-        if (showTimeLine) {\n-          return showCerts\n-            ? completedChallenges\n-            : completedChallenges.filter(\n-                ({ challengeType }) => challengeType !== 7\n-              );\n-        } else {\n-          return [];\n-        }\n-      })(),\n-      isDonating: showDonation ? isDonating : null,\n-      joinDate: showAbout ? joinDate : '',\n-      location: showLocation ? location : '',\n-      name: showName ? name : '',\n-      points: showPoints ? points : null,\n-      portfolio: showPortfolio ? portfolio : [],\n-      yearsTopContributor: yearsTopContributor\n-    };\n-  }\n-};"
        },
        {
            "sha": "73656db713a446daab0f64e8c131c794cc1322ac",
            "filename": "api-server/src/server/boot/restApi.js",
            "status": "removed",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2FrestApi.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2FrestApi.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2FrestApi.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,5 +0,0 @@\n-module.exports = function mountRestApi(app) {\n-  const restApi = app.loopback.rest();\n-  const restApiRoot = app.get('restApiRoot');\n-  app.use(restApiRoot, restApi);\n-};"
        },
        {
            "sha": "fa8660276cea65842fbcf0661fbf9bc2b22e819f",
            "filename": "api-server/src/server/boot/settings.js",
            "status": "removed",
            "additions": 0,
            "deletions": 373,
            "changes": 373,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fsettings.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fsettings.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fsettings.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,373 +0,0 @@\n-import debug from 'debug';\n-import { check } from 'express-validator';\n-import _ from 'lodash';\n-import isURL from 'validator/lib/isURL';\n-\n-import { isValidUsername } from '../../../../shared/utils/validate';\n-import { alertTypes } from '../../common/utils/flash.js';\n-import {\n-  deprecatedEndpoint,\n-  temporarilyDisabledEndpoint\n-} from '../utils/disabled-endpoints';\n-import { ifNoUser401, createValidatorErrorHandler } from '../utils/middleware';\n-\n-const log = debug('fcc:boot:settings');\n-\n-export default function settingsController(app) {\n-  const api = app.loopback.Router();\n-\n-  const updateMyUsername = createUpdateMyUsername(app);\n-\n-  api.put('/update-privacy-terms', ifNoUser401, updatePrivacyTerms);\n-\n-  api.post('/refetch-user-completed-challenges', deprecatedEndpoint);\n-  // Re-enable once we can handle the traffic\n-  // api.post(\n-  //   '/update-my-current-challenge',\n-  //   ifNoUser401,\n-  //   updateMyCurrentChallengeValidators,\n-  //   createValidatorErrorHandler(alertTypes.danger),\n-  //   updateMyCurrentChallenge\n-  // );\n-  api.post('/update-my-current-challenge', temporarilyDisabledEndpoint);\n-  api.put('/update-my-portfolio', ifNoUser401, updateMyPortfolio);\n-  api.put('/update-my-theme', ifNoUser401, updateMyTheme);\n-  api.put('/update-my-about', ifNoUser401, updateMyAbout);\n-  api.put(\n-    '/update-my-email',\n-    ifNoUser401,\n-    updateMyEmailValidators,\n-    createValidatorErrorHandler(alertTypes.danger),\n-    updateMyEmail\n-  );\n-  api.put('/update-my-profileui', ifNoUser401, updateMyProfileUI);\n-  api.put('/update-my-username', ifNoUser401, updateMyUsername);\n-  api.put('/update-user-flag', ifNoUser401, updateUserFlag);\n-  api.put('/update-my-socials', ifNoUser401, updateMySocials);\n-  api.put(\n-    '/update-my-keyboard-shortcuts',\n-    ifNoUser401,\n-    updateMyKeyboardShortcuts\n-  );\n-  api.put('/update-my-honesty', ifNoUser401, updateMyHonesty);\n-  api.put('/update-my-quincy-email', ifNoUser401, updateMyQuincyEmail);\n-  api.put('/update-my-classroom-mode', ifNoUser401, updateMyClassroomMode);\n-\n-  app.use(api);\n-}\n-\n-const standardErrorMessage = {\n-  type: 'danger',\n-  message: 'flash.wrong-updating'\n-};\n-\n-const createStandardHandler = (req, res, next, alertMessage) => err => {\n-  if (err) {\n-    res.status(500).json(standardErrorMessage);\n-    return next(err);\n-  }\n-  return res.status(200).json({ type: 'success', message: alertMessage });\n-};\n-\n-const createUpdateUserProperties = (buildUpdate, validate, successMessage) => {\n-  return (req, res, next) => {\n-    const { user, body } = req;\n-    const update = buildUpdate(body);\n-    if (validate(update)) {\n-      user.updateAttributes(\n-        update,\n-        createStandardHandler(req, res, next, successMessage)\n-      );\n-    } else {\n-      handleInvalidUpdate(res);\n-    }\n-  };\n-};\n-\n-const updateMyEmailValidators = [\n-  check('email').isEmail().withMessage('Email format is invalid.')\n-];\n-\n-function updateMyEmail(req, res, next) {\n-  const {\n-    user,\n-    body: { email }\n-  } = req;\n-  return user\n-    .requestUpdateEmail(email)\n-    .subscribe(\n-      message => res.json({ type: message.type, message: message.message }),\n-      next\n-    );\n-}\n-\n-// Re-enable once we can handle the traffic\n-// const updateMyCurrentChallengeValidators = [\n-//   check('currentChallengeId')\n-//     .isMongoId()\n-//     .withMessage('currentChallengeId is not a valid challenge ID')\n-// ];\n-\n-// Re-enable once we can handle the traffic\n-// function updateMyCurrentChallenge(req, res, next) {\n-//   const {\n-//     user,\n-//     body: { currentChallengeId }\n-//   } = req;\n-//   return user.updateAttribute(\n-//     'currentChallengeId',\n-//     currentChallengeId,\n-//     (err, updatedUser) => {\n-//       if (err) {\n-//         return next(err);\n-//       }\n-//       const { currentChallengeId } = updatedUser;\n-//       return res.status(200).json(currentChallengeId);\n-//     }\n-//   );\n-// }\n-\n-function updateMyPortfolio(...args) {\n-  const portfolioKeys = ['id', 'title', 'description', 'url', 'image'];\n-  const buildUpdate = body => {\n-    const portfolio = body?.portfolio?.map(elem => _.pick(elem, portfolioKeys));\n-    return { portfolio };\n-  };\n-  const validate = ({ portfolio }) => portfolio?.every(isPortfolioElement);\n-  const isPortfolioElement = elem =>\n-    Object.values(elem).every(val => typeof val == 'string');\n-  createUpdateUserProperties(\n-    buildUpdate,\n-    validate,\n-    'flash.portfolio-item-updated'\n-  )(...args);\n-}\n-\n-// This API is responsible for what campers decide to make public in their profile, and what is private.\n-function updateMyProfileUI(req, res, next) {\n-  const {\n-    user,\n-    body: { profileUI }\n-  } = req;\n-\n-  const update = {\n-    isLocked: !!profileUI.isLocked,\n-    showAbout: !!profileUI.showAbout,\n-    showCerts: !!profileUI.showCerts,\n-    showDonation: !!profileUI.showDonation,\n-    showHeatMap: !!profileUI.showHeatMap,\n-    showLocation: !!profileUI.showLocation,\n-    showName: !!profileUI.showName,\n-    showPoints: !!profileUI.showPoints,\n-    showPortfolio: !!profileUI.showPortfolio,\n-    showTimeLine: !!profileUI.showTimeLine\n-  };\n-\n-  user.updateAttribute(\n-    'profileUI',\n-    update,\n-    createStandardHandler(req, res, next, 'flash.privacy-updated')\n-  );\n-}\n-\n-export function updateMyAbout(req, res, next) {\n-  const {\n-    user,\n-    body: { name, location, about, picture }\n-  } = req;\n-  log(name, location, picture, about);\n-  // prevent dataurls from being stored\n-  const update = isURL(picture, { require_protocol: true })\n-    ? { name, location, about, picture }\n-    : { name, location, about, picture: '' };\n-  return user.updateAttributes(\n-    update,\n-    createStandardHandler(req, res, next, 'flash.updated-about-me')\n-  );\n-}\n-\n-function createUpdateMyUsername(app) {\n-  const { User } = app.models;\n-  return async function updateMyUsername(req, res, next) {\n-    const { user, body } = req;\n-    const usernameDisplay = body.username.trim();\n-    const username = usernameDisplay.toLowerCase();\n-    if (\n-      username === user.username &&\n-      user.usernameDisplay &&\n-      usernameDisplay === user.usernameDisplay\n-    ) {\n-      return res.json({\n-        type: 'info',\n-        message: 'flash.username-used'\n-      });\n-    }\n-    const validation = isValidUsername(username);\n-\n-    if (!validation.valid) {\n-      return res.json({\n-        type: 'info',\n-        message: `Username ${username} ${validation.error}`\n-      });\n-    }\n-\n-    const exists =\n-      username === user.username ? false : await User.doesExist(username);\n-\n-    if (exists) {\n-      return res.json({\n-        type: 'info',\n-        message: 'flash.username-taken'\n-      });\n-    }\n-\n-    return user.updateAttributes({ username, usernameDisplay }, err => {\n-      if (err) {\n-        res.status(500).json(standardErrorMessage);\n-        return next(err);\n-      }\n-\n-      return res.status(200).json({\n-        type: 'success',\n-        message: `flash.username-updated`,\n-        variables: { username: usernameDisplay }\n-      });\n-    });\n-  };\n-}\n-\n-const updatePrivacyTerms = (req, res, next) => {\n-  const {\n-    user,\n-    body: { quincyEmails }\n-  } = req;\n-  const update = {\n-    acceptedPrivacyTerms: true,\n-    sendQuincyEmail: !!quincyEmails\n-  };\n-  return user.updateAttributes(\n-    update,\n-    createStandardHandler(req, res, next, 'flash.privacy-updated')\n-  );\n-};\n-\n-const allowedSocialsAndDomains = {\n-  githubProfile: 'github.com',\n-  linkedin: 'linkedin.com',\n-  twitter: ['twitter.com', 'x.com'],\n-  website: ''\n-};\n-\n-const socialVals = Object.keys(allowedSocialsAndDomains);\n-\n-export function updateMySocials(...args) {\n-  const buildUpdate = body => _.pick(body, socialVals);\n-  const validate = update => {\n-    // Socials should point to their respective domains\n-    // or be empty strings\n-    return Object.keys(update).every(key => {\n-      const val = update[key];\n-      if (val === '') {\n-        return true;\n-      }\n-      if (key === 'website') {\n-        return isURL(val, { require_protocol: true });\n-      }\n-\n-      const domain = allowedSocialsAndDomains[key];\n-\n-      try {\n-        const url = new URL(val);\n-        const topDomain = url.hostname.split('.').slice(-2);\n-        if (topDomain.length === 2) {\n-          return Array.isArray(domain)\n-            ? domain.some(d => topDomain.join('.') === d)\n-            : topDomain.join('.') === domain;\n-        }\n-        return false;\n-      } catch (e) {\n-        return false;\n-      }\n-    });\n-  };\n-  createUpdateUserProperties(\n-    buildUpdate,\n-    validate,\n-    'flash.updated-socials'\n-  )(...args);\n-}\n-\n-function updateMyTheme(...args) {\n-  const buildUpdate = body => _.pick(body, 'theme');\n-  const validate = ({ theme }) => theme == 'default' || theme == 'night';\n-  createUpdateUserProperties(\n-    buildUpdate,\n-    validate,\n-    'flash.updated-themes'\n-  )(...args);\n-}\n-\n-function updateMyKeyboardShortcuts(...args) {\n-  const buildUpdate = body => _.pick(body, 'keyboardShortcuts');\n-  const validate = ({ keyboardShortcuts }) =>\n-    typeof keyboardShortcuts === 'boolean';\n-  createUpdateUserProperties(\n-    buildUpdate,\n-    validate,\n-    'flash.keyboard-shortcut-updated'\n-  )(...args);\n-}\n-\n-function updateMyHonesty(...args) {\n-  const buildUpdate = body => _.pick(body, 'isHonest');\n-  const validate = ({ isHonest }) => isHonest === true;\n-  createUpdateUserProperties(\n-    buildUpdate,\n-    validate,\n-    'buttons.accepted-honesty'\n-  )(...args);\n-}\n-\n-function updateMyQuincyEmail(...args) {\n-  const buildUpdate = body => _.pick(body, 'sendQuincyEmail');\n-  const validate = ({ sendQuincyEmail }) =>\n-    typeof sendQuincyEmail === 'boolean';\n-  createUpdateUserProperties(\n-    buildUpdate,\n-    validate,\n-    'flash.subscribe-to-quincy-updated'\n-  )(...args);\n-}\n-\n-export function updateMyClassroomMode(...args) {\n-  const buildUpdate = body => _.pick(body, 'isClassroomAccount');\n-  const validate = ({ isClassroomAccount }) =>\n-    typeof isClassroomAccount === 'boolean';\n-  createUpdateUserProperties(\n-    buildUpdate,\n-    validate,\n-    'flash.classroom-mode-updated'\n-  )(...args);\n-}\n-\n-function handleInvalidUpdate(res) {\n-  res.status(403).json({\n-    type: 'danger',\n-    message: 'flash.wrong-updating'\n-  });\n-}\n-\n-function updateUserFlag(req, res, next) {\n-  const { user, body: update } = req;\n-  const allowedKeys = ['githubProfile', 'linkedin', 'twitter', 'website'];\n-  if (Object.keys(update).every(key => allowedKeys.includes(key))) {\n-    return user.updateAttributes(\n-      update,\n-      createStandardHandler(req, res, next, 'flash.updated-socials')\n-    );\n-  }\n-  return res.status(403).json({\n-    type: 'danger',\n-    message: 'flash.invalid-update-flag'\n-  });\n-}"
        },
        {
            "sha": "6ac058c6213cb932a0f7a8580100701506bcf7a5",
            "filename": "api-server/src/server/boot/status.js",
            "status": "removed",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fstatus.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fstatus.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fstatus.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,6 +0,0 @@\n-export default function bootStatus(app) {\n-  const api = app.loopback.Router();\n-\n-  api.get('/status/ping', (req, res) => res.json({ msg: 'pong' }));\n-  app.use(api);\n-}"
        },
        {
            "sha": "b559b47759b7c991b6a33cf8bcc37d69b36cdcaa",
            "filename": "api-server/src/server/boot/t-wiki.js",
            "status": "removed",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Ft-wiki.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Ft-wiki.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Ft-wiki.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,10 +0,0 @@\n-module.exports = function (app) {\n-  var router = app.loopback.Router();\n-  router.get('/wiki/*', showForum);\n-\n-  app.use(router);\n-\n-  function showForum(req, res) {\n-    res.redirect('http://forum.freecodecamp.org/');\n-  }\n-};"
        },
        {
            "sha": "70288aae5539b3e8f64644c92a047001724f5768",
            "filename": "api-server/src/server/boot/user.js",
            "status": "removed",
            "additions": 0,
            "deletions": 535,
            "changes": 535,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fuser.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fuser.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fuser.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,535 +0,0 @@\n-import debugFactory from 'debug';\n-import dedent from 'dedent';\n-import { body } from 'express-validator';\n-import { pick } from 'lodash';\n-import fetch from 'node-fetch';\n-\n-import {\n-  fixCompletedChallengeItem,\n-  fixCompletedExamItem,\n-  fixCompletedSurveyItem,\n-  fixPartiallyCompletedChallengeItem,\n-  fixSavedChallengeItem\n-} from '../../common/utils';\n-import { removeCookies } from '../utils/getSetAccessToken';\n-import { ifNoUser401, ifNoUserRedirectHome } from '../utils/middleware';\n-import {\n-  getProgress,\n-  normaliseUserFields,\n-  userPropsForSession\n-} from '../utils/publicUserProps';\n-import { getRedirectParams } from '../utils/redirection';\n-import { trimTags } from '../utils/validators';\n-import {\n-  createDeleteUserToken,\n-  encodeUserToken\n-} from '../middlewares/user-token';\n-import { createDeleteMsUsername } from '../middlewares/ms-username';\n-import { validateSurvey, createDeleteUserSurveys } from '../middlewares/survey';\n-import { deprecatedEndpoint } from '../utils/disabled-endpoints';\n-\n-const log = debugFactory('fcc:boot:user');\n-const sendNonUserToHome = ifNoUserRedirectHome();\n-\n-function bootUser(app) {\n-  const api = app.loopback.Router();\n-\n-  const getSessionUser = createReadSessionUser(app);\n-  const postReportUserProfile = createPostReportUserProfile(app);\n-  const postDeleteAccount = createPostDeleteAccount(app);\n-  const postUserToken = createPostUserToken(app);\n-  const deleteUserToken = createDeleteUserToken(app);\n-  const postMsUsername = createPostMsUsername(app);\n-  const deleteMsUsername = createDeleteMsUsername(app);\n-  const postSubmitSurvey = createPostSubmitSurvey(app);\n-  const deleteUserSurveys = createDeleteUserSurveys(app);\n-  api.get('/account', sendNonUserToHome, deprecatedEndpoint);\n-  api.get('/account/unlink/:social', sendNonUserToHome, getUnlinkSocial);\n-  api.get('/user/get-session-user', getSessionUser);\n-  api.post(\n-    '/account/delete',\n-    ifNoUser401,\n-    deleteUserToken,\n-    deleteMsUsername,\n-    deleteUserSurveys,\n-    postDeleteAccount\n-  );\n-  api.post(\n-    '/account/reset-progress',\n-    ifNoUser401,\n-    deleteUserToken,\n-    deleteMsUsername,\n-    deleteUserSurveys,\n-    postResetProgress\n-  );\n-  api.post(\n-    '/user/report-user/',\n-    ifNoUser401,\n-    body('reportDescription').customSanitizer(trimTags),\n-    postReportUserProfile\n-  );\n-\n-  api.post('/user/user-token', ifNoUser401, postUserToken);\n-  api.delete(\n-    '/user/user-token',\n-    ifNoUser401,\n-    deleteUserToken,\n-    deleteUserTokenResponse\n-  );\n-\n-  api.post('/user/ms-username', ifNoUser401, postMsUsername);\n-  api.delete(\n-    '/user/ms-username',\n-    ifNoUser401,\n-    deleteMsUsername,\n-    deleteMsUsernameResponse\n-  );\n-\n-  api.post(\n-    '/user/submit-survey',\n-    ifNoUser401,\n-    validateSurvey,\n-    postSubmitSurvey\n-  );\n-\n-  app.use(api);\n-}\n-\n-function createPostUserToken(app) {\n-  const { UserToken } = app.models;\n-\n-  return async function postUserToken(req, res) {\n-    const ttl = 900 * 24 * 60 * 60 * 1000;\n-    let encodedUserToken;\n-\n-    try {\n-      await UserToken.destroyAll({ userId: req.user.id });\n-      const newUserToken = await UserToken.create({ ttl, userId: req.user.id });\n-\n-      if (!newUserToken?.id) throw new Error();\n-      encodedUserToken = encodeUserToken(newUserToken.id);\n-    } catch (e) {\n-      return res.status(500).send('Error starting project');\n-    }\n-\n-    return res.json({ userToken: encodedUserToken });\n-  };\n-}\n-\n-function deleteUserTokenResponse(req, res) {\n-  if (!req.userTokenDeleted) {\n-    return res.status(500).send('Error deleting user token');\n-  }\n-\n-  return res.send({ userToken: null });\n-}\n-\n-export const getMsTranscriptApiUrl = msTranscript => {\n-  // example msTranscriptUrl: https://learn.microsoft.com/en-us/users/mot01/transcript/8u6awert43q1plo\n-  const url = new URL(msTranscript);\n-\n-  const transcriptUrlRegex = /\\/transcript\\/([^/]+)\\/?/;\n-  const id = transcriptUrlRegex.exec(url.pathname)?.[1];\n-  return `https://learn.microsoft.com/api/profiles/transcript/share/${\n-    id ?? ''\n-  }`;\n-};\n-\n-function createPostMsUsername(app) {\n-  const { MsUsername } = app.models;\n-\n-  return async function postMsUsername(req, res) {\n-    // example msTranscriptUrl: https://learn.microsoft.com/en-us/users/mot01/transcript/8u6awert43q1plo\n-    // the last part is the transcript ID\n-    // the username is irrelevant, and retrieved from the MS API response\n-\n-    const { msTranscriptUrl } = req.body;\n-\n-    if (!msTranscriptUrl) {\n-      return res.status(400).json({\n-        type: 'error',\n-        message: 'flash.ms.transcript.link-err-1'\n-      });\n-    }\n-\n-    const msTranscriptApiUrl = getMsTranscriptApiUrl(msTranscriptUrl);\n-\n-    try {\n-      const msApiRes = await fetch(msTranscriptApiUrl);\n-\n-      if (!msApiRes.ok) {\n-        return res\n-          .status(404)\n-          .json({ type: 'error', message: 'flash.ms.transcript.link-err-2' });\n-      }\n-\n-      const { userName } = await msApiRes.json();\n-\n-      if (!userName) {\n-        return res\n-          .status(500)\n-          .json({ type: 'error', message: 'flash.ms.transcript.link-err-3' });\n-      }\n-\n-      // Don't create if username is used by another fCC account\n-      const usernameUsed = await MsUsername.findOne({\n-        where: { msUsername: userName }\n-      });\n-\n-      if (usernameUsed) {\n-        return res\n-          .status(403)\n-          .json({ type: 'error', message: 'flash.ms.transcript.link-err-4' });\n-      }\n-\n-      await MsUsername.destroyAll({ userId: req.user.id });\n-\n-      const ttl = 900 * 24 * 60 * 60 * 1000;\n-      const newMsUsername = await MsUsername.create({\n-        ttl,\n-        userId: req.user.id,\n-        msUsername: userName\n-      });\n-\n-      if (!newMsUsername?.id) {\n-        return res\n-          .status(500)\n-          .json({ type: 'error', message: 'flash.ms.transcript.link-err-5' });\n-      }\n-\n-      return res.json({ msUsername: userName });\n-    } catch (e) {\n-      log(e);\n-      return res\n-        .status(500)\n-        .json({ type: 'error', message: 'flash.ms.transcript.link-err-6' });\n-    }\n-  };\n-}\n-\n-function deleteMsUsernameResponse(req, res) {\n-  if (!req.msUsernameDeleted) {\n-    return res.status(500).json({\n-      type: 'error',\n-      message: 'flash.ms.transcript.unlink-err'\n-    });\n-  }\n-\n-  return res.send({ msUsername: null });\n-}\n-\n-function createPostSubmitSurvey(app) {\n-  const { Survey } = app.models;\n-\n-  return async function postSubmitSurvey(req, res) {\n-    const { user, body } = req;\n-    const { surveyResults } = body;\n-    const { id: userId } = user;\n-    const { title } = surveyResults;\n-\n-    const completedSurveys = await Survey.find({\n-      where: { userId }\n-    });\n-\n-    const surveyAlreadyTaken = completedSurveys.some(s => s.title === title);\n-    if (surveyAlreadyTaken) {\n-      return res.status(400).json({\n-        type: 'error',\n-        message: 'flash.survey.err-2'\n-      });\n-    }\n-\n-    try {\n-      const newSurvey = {\n-        ...surveyResults,\n-        userId: user.id\n-      };\n-\n-      const createdSurvey = await Survey.create(newSurvey);\n-      if (!createdSurvey) {\n-        throw new Error('Error creating survey');\n-      }\n-\n-      return res.json({\n-        type: 'success',\n-        message: 'flash.survey.success'\n-      });\n-    } catch (e) {\n-      log(e);\n-      return res.status(500).json({\n-        type: 'error',\n-        message: 'flash.survey.err-3'\n-      });\n-    }\n-  };\n-}\n-\n-function createReadSessionUser(app) {\n-  const { MsUsername, Survey, UserToken } = app.models;\n-\n-  return async function getSessionUser(req, res, next) {\n-    const queryUser = req.user;\n-\n-    let encodedUserToken;\n-    try {\n-      const userId = queryUser?.id;\n-      const userToken = userId\n-        ? await UserToken.findOne({\n-            where: { userId }\n-          })\n-        : null;\n-\n-      encodedUserToken = userToken ? encodeUserToken(userToken.id) : undefined;\n-    } catch (e) {\n-      return next(e);\n-    }\n-\n-    let msUsername;\n-    try {\n-      const userId = queryUser?.id;\n-      const msUser = userId\n-        ? await MsUsername.findOne({\n-            where: { userId }\n-          })\n-        : null;\n-\n-      msUsername = msUser ? msUser.msUsername : undefined;\n-    } catch (e) {\n-      return next(e);\n-    }\n-\n-    let completedSurveys;\n-    try {\n-      const userId = queryUser?.id;\n-      completedSurveys = userId\n-        ? await Survey.find({\n-            where: { userId }\n-          })\n-        : [];\n-    } catch (e) {\n-      return next(e);\n-    }\n-\n-    if (!queryUser || !queryUser.toJSON().username) {\n-      // TODO: This should return an error status\n-      return res.json({ user: {}, result: '' });\n-    }\n-\n-    try {\n-      const [\n-        completedChallenges,\n-        completedExams,\n-        partiallyCompletedChallenges,\n-        progressTimestamps,\n-        savedChallenges\n-      ] = await Promise.all(\n-        [\n-          queryUser.getCompletedChallenges$(),\n-          queryUser.getCompletedExams$(),\n-          queryUser.getPartiallyCompletedChallenges$(),\n-          queryUser.getPoints$(),\n-          queryUser.getSavedChallenges$()\n-        ].map(obs => obs.toPromise())\n-      );\n-\n-      const { calendar } = getProgress(progressTimestamps);\n-      const user = {\n-        ...queryUser.toJSON(),\n-        calendar,\n-        completedChallenges: completedChallenges.map(fixCompletedChallengeItem),\n-        completedExams: completedExams.map(fixCompletedExamItem),\n-        partiallyCompletedChallenges: partiallyCompletedChallenges.map(\n-          fixPartiallyCompletedChallengeItem\n-        ),\n-        savedChallenges: savedChallenges.map(fixSavedChallengeItem)\n-      };\n-      const response = {\n-        user: {\n-          [user.username]: {\n-            ...pick(user, userPropsForSession),\n-            username: user.usernameDisplay || user.username,\n-            isEmailVerified: !!user.emailVerified,\n-            ...normaliseUserFields(user),\n-            joinDate: user.id.getTimestamp(),\n-            userToken: encodedUserToken,\n-            msUsername,\n-            completedSurveys: completedSurveys.map(fixCompletedSurveyItem)\n-          }\n-        },\n-        result: user.username\n-      };\n-      return res.json(response);\n-    } catch (e) {\n-      // TODO: This should return an error status\n-      return res.json({ user: {}, result: '' });\n-    }\n-  };\n-}\n-\n-function getUnlinkSocial(req, res, next) {\n-  const { user } = req;\n-  const { username } = user;\n-  const { origin } = getRedirectParams(req);\n-  let social = req.params.social;\n-  if (!social) {\n-    req.flash('danger', 'No social account found');\n-    return res.redirect('/' + username);\n-  }\n-\n-  social = social.toLowerCase();\n-  const validSocialAccounts = ['twitter', 'linkedin'];\n-  if (validSocialAccounts.indexOf(social) === -1) {\n-    req.flash('danger', 'Invalid social account');\n-    return res.redirect('/' + username);\n-  }\n-\n-  if (!user[social]) {\n-    req.flash('danger', `No ${social} account associated`);\n-    return res.redirect('/' + username);\n-  }\n-\n-  const query = {\n-    where: {\n-      provider: social\n-    }\n-  };\n-\n-  return user.identities(query, function (err, identities) {\n-    if (err) {\n-      return next(err);\n-    }\n-\n-    // assumed user identity is unique by provider\n-    let identity = identities.shift();\n-    if (!identity) {\n-      req.flash('danger', 'No social account found');\n-      return res.redirect('/' + username);\n-    }\n-\n-    return identity.destroy(function (err) {\n-      if (err) {\n-        return next(err);\n-      }\n-\n-      const updateData = { [social]: null };\n-\n-      return user.updateAttributes(updateData, err => {\n-        if (err) {\n-          return next(err);\n-        }\n-        log(`${social} has been unlinked successfully`);\n-\n-        req.flash('info', `You've successfully unlinked your ${social}.`);\n-        return res.redirectWithFlash(`${origin}/${username}`);\n-      });\n-    });\n-  });\n-}\n-\n-function postResetProgress(req, res, next) {\n-  const { user } = req;\n-  return user.updateAttributes(\n-    {\n-      progressTimestamps: [Date.now()],\n-      currentChallengeId: '',\n-      isRespWebDesignCert: false,\n-      is2018DataVisCert: false,\n-      isFrontEndLibsCert: false,\n-      isJsAlgoDataStructCert: false,\n-      isApisMicroservicesCert: false,\n-      isInfosecQaCert: false,\n-      isQaCertV7: false,\n-      isInfosecCertV7: false,\n-      is2018FullStackCert: false,\n-      isFrontEndCert: false,\n-      isBackEndCert: false,\n-      isDataVisCert: false,\n-      isFullStackCert: false,\n-      isSciCompPyCertV7: false,\n-      isDataAnalysisPyCertV7: false,\n-      isMachineLearningPyCertV7: false,\n-      isRelationalDatabaseCertV8: false,\n-      isCollegeAlgebraPyCertV8: false,\n-      isFoundationalCSharpCertV8: false,\n-      isJsAlgoDataStructCertV8: false,\n-      completedChallenges: [],\n-      completedExams: [],\n-      savedChallenges: [],\n-      partiallyCompletedChallenges: [],\n-      needsModeration: false\n-    },\n-    function (err) {\n-      if (err) {\n-        return next(err);\n-      }\n-      return res.status(200).json({});\n-    }\n-  );\n-}\n-\n-function createPostDeleteAccount(app) {\n-  const { User } = app.models;\n-  return async function postDeleteAccount(req, res, next) {\n-    return User.destroyById(req.user.id, function (err) {\n-      if (err) {\n-        return next(err);\n-      }\n-      req.logout();\n-      removeCookies(req, res);\n-      return res.status(200).json({});\n-    });\n-  };\n-}\n-\n-function createPostReportUserProfile(app) {\n-  const { Email } = app.models;\n-  return function postReportUserProfile(req, res, next) {\n-    const { user } = req;\n-    const { username, reportDescription: report } = req.body;\n-    const { origin } = getRedirectParams(req);\n-    log(username);\n-    log(report);\n-\n-    if (!username || !report || report === '') {\n-      return res.json({\n-        type: 'danger',\n-        message: 'flash.provide-username'\n-      });\n-    }\n-    return Email.send$(\n-      {\n-        type: 'email',\n-        to: 'support@freecodecamp.org',\n-        cc: user.email,\n-        from: 'team@freecodecamp.org',\n-        subject: `Abuse Report : Reporting ${username}'s profile.`,\n-        text: dedent(`\n-        Hello Team,\\n\n-        This is to report the profile of ${username}.\\n\n-        Report Details:\\n\n-        ${report}\\n\\n\n-        Reported by:\n-        Username: ${user.username}\n-        Name: ${user.name}\n-        Email: ${user.email}\\n\n-        Thanks and regards,\n-        ${user.name}\n-      `)\n-      },\n-      err => {\n-        if (err) {\n-          err.redirectTo = `${origin}/${username}`;\n-          return next(err);\n-        }\n-\n-        return res.json({\n-          type: 'info',\n-          message: 'flash.report-sent',\n-          variables: { email: user.email }\n-        });\n-      }\n-    );\n-  };\n-}\n-\n-export default bootUser;"
        },
        {
            "sha": "1c84138388fba409276357afbdfc0149c71e3651",
            "filename": "api-server/src/server/boot/z-not-found.js",
            "status": "removed",
            "additions": 0,
            "deletions": 19,
            "changes": 19,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fz-not-found.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot%2Fz-not-found.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fz-not-found.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,19 +0,0 @@\n-import accepts from 'accepts';\n-import { getRedirectParams } from '../utils/redirection';\n-\n-export default function fourOhFour(app) {\n-  app.all('*', function (req, res) {\n-    const accept = accepts(req);\n-    // prioritise returning json\n-    const type = accept.type('json', 'html', 'text');\n-    const { path } = req;\n-    const { origin } = getRedirectParams(req);\n-\n-    if (type === 'json') {\n-      return res.status('404').json({ error: 'path not found' });\n-    } else {\n-      req.flash('danger', `We couldn't find path ${path}`);\n-      return res.redirectWithFlash(`${origin}/404`);\n-    }\n-  });\n-}"
        },
        {
            "sha": "618b1130997df0ff736a8087136d530699355153",
            "filename": "api-server/src/server/boot_tests/README.md",
            "status": "removed",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot_tests%2FREADME.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot_tests%2FREADME.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot_tests%2FREADME.md?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,3 +0,0 @@\n-## Test scripts for the boot directory\n-\n-These files cannot be co-located with the files under test due to the auto-discovery the loopback-boot employs."
        },
        {
            "sha": "556696be76c593dda79e30aebc78993ae1ef0a70",
            "filename": "api-server/src/server/boot_tests/certificate.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 94,
            "changes": 94,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot_tests%2Fcertificate.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot_tests%2Fcertificate.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot_tests%2Fcertificate.test.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,94 +0,0 @@\n-import {\n-  getFallbackFullStackDate,\n-  ifNoCertification404\n-} from '../boot/certificate';\n-import { fullStackChallenges } from './fixtures';\n-\n-export const mockReq = opts => {\n-  const req = {};\n-  return { ...req, ...opts };\n-};\n-\n-export const mockRes = opts => {\n-  const res = {};\n-  res.status = jest.fn().mockReturnValue(res);\n-  res.end = jest.fn().mockReturnValue(res);\n-  res.json = jest.fn().mockReturnValue(res);\n-  res.redirect = jest.fn().mockReturnValue(res);\n-  res.set = jest.fn().mockReturnValue(res);\n-  res.clearCookie = jest.fn().mockReturnValue(res);\n-  res.cookie = jest.fn().mockReturnValue(res);\n-  return { ...res, ...opts };\n-};\n-\n-describe('boot/certificate', () => {\n-  describe('getFallbackFullStackDate', () => {\n-    it('should return the date of the latest completed challenge', () => {\n-      expect(getFallbackFullStackDate(fullStackChallenges)).toBe(1685210952511);\n-    });\n-  });\n-\n-  describe('ifNoCertification404', () => {\n-    it('declares a 404 when there is no certSlug in the body', () => {\n-      const req = mockReq({\n-        body: {}\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-\n-      ifNoCertification404(req, res, next);\n-\n-      expect(res.status).toHaveBeenCalledWith(404);\n-      expect(next).not.toHaveBeenCalled();\n-    });\n-\n-    it('declares a 404 for an invalid certSlug in the body', () => {\n-      const req = mockReq({\n-        body: { certSlug: 'not-a-real-certSlug' }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-\n-      ifNoCertification404(req, res, next);\n-\n-      expect(res.status).toHaveBeenCalledWith(404);\n-      expect(next).not.toHaveBeenCalled();\n-    });\n-\n-    it('calls next for a valid certSlug of a current certification', () => {\n-      const req = mockReq({\n-        body: { certSlug: 'responsive-web-design' }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-\n-      ifNoCertification404(req, res, next);\n-\n-      expect(next).toHaveBeenCalled();\n-    });\n-\n-    it('calls next for a valid certSlug of a legacy certification', () => {\n-      const req = mockReq({\n-        body: { certSlug: 'legacy-front-end' }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-\n-      ifNoCertification404(req, res, next);\n-\n-      expect(next).toHaveBeenCalled();\n-    });\n-\n-    it('calls next for a valid certSlug of the legacy full stack certification', () => {\n-      const req = mockReq({\n-        body: { certSlug: 'full-stack' }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-\n-      ifNoCertification404(req, res, next);\n-\n-      expect(next).toHaveBeenCalled();\n-    });\n-  });\n-});"
        },
        {
            "sha": "16afd62b50c04fb3eaea2137132083910deff0ae",
            "filename": "api-server/src/server/boot_tests/challenge.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 447,
            "changes": 447,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot_tests%2Fchallenge.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot_tests%2Fchallenge.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot_tests%2Fchallenge.test.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,447 +0,0 @@\n-import { find } from 'lodash';\n-\n-import {\n-  buildUserUpdate,\n-  buildExamUserUpdate,\n-  buildChallengeUrl,\n-  createChallengeUrlResolver,\n-  createRedirectToCurrentChallenge,\n-  getFirstChallenge,\n-  isValidChallengeCompletion\n-} from '../boot/challenge';\n-\n-import {\n-  firstChallengeUrl,\n-  requestedChallengeUrl,\n-  mockAllChallenges,\n-  mockChallenge,\n-  mockUser,\n-  mockUser2,\n-  mockGetFirstChallenge,\n-  mockCompletedChallenge,\n-  mockCompletedChallengeNoFiles,\n-  mockCompletedChallenges,\n-  mockFailingExamChallenge,\n-  mockPassingExamChallenge,\n-  mockBetterPassingExamChallenge,\n-  mockWorsePassingExamChallenge\n-} from './fixtures';\n-\n-export const mockReq = opts => {\n-  const req = {};\n-  return { ...req, ...opts };\n-};\n-\n-export const mockRes = opts => {\n-  const res = {};\n-  res.status = jest.fn().mockReturnValue(res);\n-  res.json = jest.fn().mockReturnValue(res);\n-  res.redirect = jest.fn().mockReturnValue(res);\n-  res.set = jest.fn().mockReturnValue(res);\n-  res.clearCookie = jest.fn().mockReturnValue(res);\n-  res.cookie = jest.fn().mockReturnValue(res);\n-  return { ...res, ...opts };\n-};\n-\n-describe('boot/challenge', () => {\n-  xdescribe('backendChallengeCompleted', () => {});\n-\n-  describe('buildUserUpdate', () => {\n-    it('returns an Object with a nested \"completedChallenges\" property', () => {\n-      const result = buildUserUpdate(\n-        mockUser,\n-        '123abc',\n-        mockCompletedChallenge,\n-        'UTC'\n-      );\n-      expect(result).toHaveProperty('updateData.$push.completedChallenges');\n-    });\n-\n-    it('preserves file contents if the completed challenge is a JS Project', () => {\n-      const jsChallengeId = 'aa2e6f85cab2ab736c9a9b24';\n-      const completedChallenge = {\n-        ...mockCompletedChallenge,\n-        completedDate: Date.now(),\n-        id: jsChallengeId\n-      };\n-      const result = buildUserUpdate(\n-        mockUser,\n-        jsChallengeId,\n-        completedChallenge,\n-        'UTC'\n-      );\n-      const newCompletedChallenge = result.updateData.$push.completedChallenges;\n-\n-      expect(newCompletedChallenge).toEqual(completedChallenge);\n-    });\n-\n-    it('preserves the original completed date of a challenge', () => {\n-      const completedChallengeId = 'aaa48de84e1ecc7c742e1124';\n-      const completedChallenge = {\n-        ...mockCompletedChallenge,\n-        completedDate: Date.now(),\n-        id: completedChallengeId\n-      };\n-      const originalCompletion = find(\n-        mockCompletedChallenges,\n-        x => x.id === completedChallengeId\n-      ).completedDate;\n-      const result = buildUserUpdate(\n-        mockUser,\n-        completedChallengeId,\n-        completedChallenge,\n-        'UTC'\n-      );\n-\n-      const updatedCompletedChallenge =\n-        result.updateData.$set['completedChallenges.2'];\n-\n-      expect(updatedCompletedChallenge.completedDate).toEqual(\n-        originalCompletion\n-      );\n-    });\n-\n-    it('does not attempt to update progressTimestamps for a previously completed challenge', () => {\n-      const completedChallengeId = 'aaa48de84e1ecc7c742e1124';\n-      const completedChallenge = {\n-        ...mockCompletedChallenge,\n-        completedDate: Date.now(),\n-        id: completedChallengeId\n-      };\n-      const { updateData } = buildUserUpdate(\n-        mockUser,\n-        completedChallengeId,\n-        completedChallenge,\n-        'UTC'\n-      );\n-\n-      const hasProgressTimestamps =\n-        '$push' in updateData && 'progressTimestamps' in updateData.$push;\n-      expect(hasProgressTimestamps).toBe(false);\n-    });\n-\n-    it('provides a progressTimestamps update for new challenge completion', () => {\n-      expect.assertions(2);\n-      const { updateData } = buildUserUpdate(\n-        mockUser,\n-        '123abc',\n-        mockCompletedChallenge,\n-        'UTC'\n-      );\n-      expect(updateData).toHaveProperty('$push');\n-      expect(updateData.$push).toHaveProperty('progressTimestamps');\n-    });\n-\n-    it('will $push newly completed challenges to the completedChallenges array', () => {\n-      const {\n-        updateData: {\n-          $push: { completedChallenges }\n-        }\n-      } = buildUserUpdate(\n-        mockUser,\n-        '123abc',\n-        mockCompletedChallengeNoFiles,\n-        'UTC'\n-      );\n-\n-      expect(completedChallenges).toEqual(mockCompletedChallengeNoFiles);\n-    });\n-  });\n-\n-  describe('buildExamUserUpdate', () => {\n-    it('should $push exam results to completedExams[]', () => {\n-      const {\n-        updateData: {\n-          $push: { completedExams }\n-        }\n-      } = buildExamUserUpdate(mockUser, mockFailingExamChallenge);\n-      expect(completedExams).toEqual(mockFailingExamChallenge);\n-    });\n-\n-    it('should not add failing exams to completedChallenges[]', () => {\n-      const { alreadyCompleted, addPoint, updateData } = buildExamUserUpdate(\n-        mockUser,\n-        mockFailingExamChallenge\n-      );\n-\n-      expect(updateData).not.toHaveProperty('$push.completedChallenges');\n-      expect(updateData).not.toHaveProperty('$set.completedChallenges');\n-      expect(addPoint).toBe(false);\n-      expect(alreadyCompleted).toBe(false);\n-    });\n-\n-    it('should $push newly passed exams to completedChallenge[]', () => {\n-      const {\n-        alreadyCompleted,\n-        addPoint,\n-        updateData: {\n-          $push: { completedChallenges }\n-        }\n-      } = buildExamUserUpdate(mockUser, mockPassingExamChallenge);\n-\n-      expect(completedChallenges).toEqual(mockPassingExamChallenge);\n-      expect(addPoint).toBe(true);\n-      expect(alreadyCompleted).toBe(false);\n-    });\n-\n-    it('should not update passed exams with worse results in completedChallenge[]', () => {\n-      const { alreadyCompleted, addPoint, updateData } = buildExamUserUpdate(\n-        mockUser2,\n-        mockWorsePassingExamChallenge\n-      );\n-\n-      expect(updateData).not.toHaveProperty('$push.completedChallenges');\n-      expect(updateData).not.toHaveProperty('$set.completedChallenges');\n-      expect(addPoint).toBe(false);\n-      expect(alreadyCompleted).toBe(true);\n-    });\n-\n-    it('should update passed exams with better results in completedChallenge[]', () => {\n-      const {\n-        alreadyCompleted,\n-        addPoint,\n-        completedDate,\n-        updateData: { $set }\n-      } = buildExamUserUpdate(mockUser2, mockBetterPassingExamChallenge);\n-\n-      expect($set['completedChallenges.4'].examResults).toEqual(\n-        mockBetterPassingExamChallenge.examResults\n-      );\n-      expect(addPoint).toBe(false);\n-      expect(alreadyCompleted).toBe(true);\n-      expect(completedDate).toBe(1538052380328);\n-    });\n-  });\n-\n-  describe('buildChallengeUrl', () => {\n-    it('resolves the correct Url for the provided challenge', () => {\n-      const result = buildChallengeUrl(mockChallenge);\n-\n-      expect(result).toEqual(requestedChallengeUrl);\n-    });\n-  });\n-\n-  describe('challengeUrlResolver', () => {\n-    it('resolves to the first challenge url by default', async () => {\n-      const challengeUrlResolver = await createChallengeUrlResolver(\n-        mockAllChallenges,\n-        {\n-          _getFirstChallenge: mockGetFirstChallenge\n-        }\n-      );\n-\n-      return challengeUrlResolver().then(url => {\n-        expect(url).toEqual(firstChallengeUrl);\n-      });\n-    }, 10000);\n-\n-    it('returns the first challenge url if the provided id does not relate to a challenge', async () => {\n-      const challengeUrlResolver = await createChallengeUrlResolver(\n-        mockAllChallenges,\n-        {\n-          _getFirstChallenge: mockGetFirstChallenge\n-        }\n-      );\n-\n-      return challengeUrlResolver('not-a-real-challenge').then(url => {\n-        expect(url).toEqual(firstChallengeUrl);\n-      });\n-    });\n-\n-    it('resolves the correct url for the requested challenge', async () => {\n-      const challengeUrlResolver = await createChallengeUrlResolver(\n-        mockAllChallenges,\n-        {\n-          _getFirstChallenge: mockGetFirstChallenge\n-        }\n-      );\n-\n-      return challengeUrlResolver('123abc').then(url => {\n-        expect(url).toEqual(requestedChallengeUrl);\n-      });\n-    });\n-  });\n-\n-  describe('getFirstChallenge', () => {\n-    it('returns the correct challenge url from the model', async () => {\n-      const result = await getFirstChallenge(mockAllChallenges);\n-\n-      expect(result).toEqual(firstChallengeUrl);\n-    });\n-\n-    it('returns the learn base if no challenges found', async () => {\n-      const result = await getFirstChallenge([]);\n-\n-      expect(result).toEqual('/learn');\n-    });\n-  });\n-\n-  describe('isValidChallengeCompletion', () => {\n-    const validObjectId = '5c716d1801013c3ce3aa23e6';\n-\n-    it('declares a 403 for an invalid id in the body', () => {\n-      expect.assertions(2);\n-      const req = mockReq({\n-        body: { id: 'not-a-real-id' }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-\n-      isValidChallengeCompletion(req, res, next);\n-\n-      expect(res.status).toHaveBeenCalledWith(403);\n-      expect(next).not.toHaveBeenCalled();\n-    });\n-\n-    it('declares a 403 for an invalid challengeType in the body', () => {\n-      expect.assertions(2);\n-      const req = mockReq({\n-        body: { id: validObjectId, challengeType: 'ponyfoo' }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-\n-      isValidChallengeCompletion(req, res, next);\n-\n-      expect(res.status).toHaveBeenCalledWith(403);\n-      expect(next).not.toHaveBeenCalled();\n-    });\n-\n-    it('declares a 403 for an invalid solution in the body', () => {\n-      expect.assertions(2);\n-      const req = mockReq({\n-        body: {\n-          id: validObjectId,\n-          challengeType: '1',\n-          solution: 'https://not-a-url'\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-\n-      isValidChallengeCompletion(req, res, next);\n-\n-      expect(res.status).toHaveBeenCalledWith(403);\n-      expect(next).not.toHaveBeenCalled();\n-    });\n-\n-    it('calls next if the body is valid', () => {\n-      const req = mockReq({\n-        body: {\n-          id: validObjectId,\n-          challengeType: '1',\n-          solution: 'https://www.freecodecamp.org'\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-\n-      isValidChallengeCompletion(req, res, next);\n-\n-      expect(next).toHaveBeenCalled();\n-    });\n-\n-    it('calls next if only the id is provided', () => {\n-      const req = mockReq({\n-        body: {\n-          id: validObjectId\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-\n-      isValidChallengeCompletion(req, res, next);\n-\n-      expect(next).toHaveBeenCalled();\n-    });\n-\n-    it('can handle an \"int\" challengeType', () => {\n-      const req = mockReq({\n-        body: {\n-          id: validObjectId,\n-          challengeType: 1\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-\n-      isValidChallengeCompletion(req, res, next);\n-\n-      expect(next).toHaveBeenCalled();\n-    });\n-  });\n-\n-  xdescribe('modernChallengeCompleted', () => {});\n-\n-  xdescribe('projectCompleted', () => {});\n-\n-  describe('redirectToCurrentChallenge', () => {\n-    const mockHomeLocation = 'https://www.example.com';\n-    const mockLearnUrl = `${mockHomeLocation}/learn`;\n-    const mockgetParamsFromReq = () => ({\n-      returnTo: mockLearnUrl,\n-      origin: mockHomeLocation,\n-      pathPrefix: ''\n-    });\n-    const mockNormalizeParams = params => params;\n-\n-    it('redirects to the learn base url for non-users', async () => {\n-      const redirectToCurrentChallenge = createRedirectToCurrentChallenge(\n-        () => {},\n-        mockNormalizeParams,\n-        mockgetParamsFromReq\n-      );\n-      const req = mockReq();\n-      const res = mockRes();\n-      const next = jest.fn();\n-      await redirectToCurrentChallenge(req, res, next);\n-\n-      expect(res.redirect).toHaveBeenCalledWith(mockLearnUrl);\n-    });\n-\n-    it('redirects to the url provided by the challengeUrlResolver', async () => {\n-      const challengeUrlResolver = await createChallengeUrlResolver(\n-        mockAllChallenges,\n-        {\n-          _getFirstChallenge: mockGetFirstChallenge\n-        }\n-      );\n-      const expectedUrl = `${mockHomeLocation}${requestedChallengeUrl}`;\n-      const redirectToCurrentChallenge = createRedirectToCurrentChallenge(\n-        challengeUrlResolver,\n-        mockNormalizeParams,\n-        mockgetParamsFromReq\n-      );\n-      const req = mockReq({\n-        user: mockUser\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-      await redirectToCurrentChallenge(req, res, next);\n-\n-      expect(res.redirect).toHaveBeenCalledWith(expectedUrl);\n-    });\n-\n-    it('redirects to the first challenge for users without a currentChallengeId', async () => {\n-      const challengeUrlResolver = await createChallengeUrlResolver(\n-        mockAllChallenges,\n-        {\n-          _getFirstChallenge: mockGetFirstChallenge\n-        }\n-      );\n-      const redirectToCurrentChallenge = createRedirectToCurrentChallenge(\n-        challengeUrlResolver,\n-        mockNormalizeParams,\n-        mockgetParamsFromReq\n-      );\n-      const req = mockReq({\n-        user: { ...mockUser, currentChallengeId: '' }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-      await redirectToCurrentChallenge(req, res, next);\n-      const expectedUrl = `${mockHomeLocation}${firstChallengeUrl}`;\n-      expect(res.redirect).toHaveBeenCalledWith(expectedUrl);\n-    });\n-  });\n-});"
        },
        {
            "sha": "07f85c3f242d93d382498a8cb511c3df9901178c",
            "filename": "api-server/src/server/boot_tests/fixtures.js",
            "status": "removed",
            "additions": 0,
            "deletions": 266,
            "changes": 266,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot_tests%2Ffixtures.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot_tests%2Ffixtures.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot_tests%2Ffixtures.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,266 +0,0 @@\n-import { isEqual } from 'lodash';\n-import { isEmail } from 'validator';\n-\n-export const firstChallengeUrl = '/learn/the/first/challenge';\n-export const requestedChallengeUrl = '/learn/my/actual/challenge';\n-\n-export const mockChallenge = {\n-  id: '123abc',\n-  block: 'actual',\n-  superBlock: 'my',\n-  dashedName: 'challenge'\n-};\n-\n-export const mockFirstChallenge = {\n-  id: '456def',\n-  block: 'first',\n-  superBlock: 'the',\n-  dashedName: 'challenge',\n-  challengeOrder: 0,\n-  superOrder: 0,\n-  order: 0\n-};\n-\n-export const mockCompletedChallenge = {\n-  id: '890xyz',\n-  challengeType: 0,\n-  files: [\n-    {\n-      contents: 'file contents',\n-      key: 'indexfile',\n-      name: 'index',\n-      path: 'index.file',\n-      ext: 'file'\n-    }\n-  ],\n-  completedDate: Date.now()\n-};\n-\n-export const mockCompletedChallengeNoFiles = {\n-  id: '123abc456def',\n-  challengeType: 0,\n-  completedDate: Date.now()\n-};\n-\n-export const mockFailingExamChallenge = {\n-  id: '647e22d18acb466c97ccbef8',\n-  challengeType: 17,\n-  completedDate: Date.now(),\n-  examResults: {\n-    \"numberOfCorrectAnswers\" : 5,\n-    \"numberOfQuestionsInExam\" : 10,\n-    \"percentCorrect\" : 50,\n-    \"passingPercent\" : 70,\n-    \"passed\" : false,\n-    \"examTimeInSeconds\" : 1200\n-  }\n-}\n-\n-export const mockPassingExamChallenge = {\n-  id: '647e22d18acb466c97ccbef8',\n-  challengeType: 17,\n-  completedDate: 1538052380328,\n-  examResults: {\n-    \"numberOfCorrectAnswers\" : 9,\n-    \"numberOfQuestionsInExam\" : 10,\n-    \"percentCorrect\" : 90,\n-    \"passingPercent\" : 70,\n-    \"passed\" : true,\n-    \"examTimeInSeconds\" : 1200\n-  }\n-}\n-\n-export const mockBetterPassingExamChallenge = {\n-  id: '647e22d18acb466c97ccbef8',\n-  challengeType: 17,\n-  completedDate: Date.now(),\n-  examResults: {\n-    \"numberOfCorrectAnswers\" : 10,\n-    \"numberOfQuestionsInExam\" : 10,\n-    \"percentCorrect\" : 100,\n-    \"passingPercent\" : 70,\n-    \"passed\" : true,\n-    \"examTimeInSeconds\" : 1200\n-  }\n-}\n-\n-export const mockWorsePassingExamChallenge = {\n-  id: '647e22d18acb466c97ccbef8',\n-  challengeType: 17,\n-  completedDate: Date.now(),\n-  examResults: {\n-    \"numberOfCorrectAnswers\" : 8,\n-    \"numberOfQuestionsInExam\" : 10,\n-    \"percentCorrect\" : 80,\n-    \"passingPercent\" : 70,\n-    \"passed\" : true,\n-    \"examTimeInSeconds\" : 1200\n-  }\n-}\n-\n-export const mockCompletedChallenges = [\n-  {\n-    id: 'bd7123c8c441eddfaeb5bdef',\n-    completedDate: 1538052380328.0\n-  },\n-  {\n-    id: '587d7dbd367417b2b2512bb4',\n-    completedDate: 1547472893032.0,\n-    files: []\n-  },\n-  {\n-    id: 'aaa48de84e1ecc7c742e1124',\n-    completedDate: 1541678430790.0,\n-    files: [\n-      {\n-        contents: \"function palindrome(str) {\\n  const clean = str.replace(/[\\\\W_]/g, '').toLowerCase()\\n  const revStr = clean.split('').reverse().join('');\\n  return clean === revStr;\\n}\\n\\n\\n\\npalindrome(\\\"eye\\\");\\n\",\n-        ext: 'js',\n-        path: 'index.js',\n-        name: 'index',\n-        key: 'indexjs'\n-      }\n-    ]\n-  },\n-  {\n-    id: '5a24c314108439a4d4036164',\n-    completedDate: 1543845124143.0,\n-    files: []\n-  }\n-];\n-export const mockUserID = '5c7d892aff9777c8b1c1a95e';\n-\n-export const createUserMockFn = jest.fn();\n-export const createDonationMockFn = jest.fn();\n-export const updateDonationAttr = jest.fn();\n-export const updateUserAttr = jest.fn();\n-export const mockUser = {\n-  id: mockUserID,\n-  username: 'camperbot',\n-  currentChallengeId: '123abc',\n-  email: 'donor@freecodecamp.com',\n-  timezone: 'UTC',\n-  completedChallenges: mockCompletedChallenges,\n-  progressTimestamps: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],\n-  isDonating: true,\n-  donationEmails: ['donor@freecodecamp.com', 'donor@freecodecamp.com'],\n-  createDonation: donation => {\n-    createDonationMockFn(donation);\n-    return mockObservable;\n-  },\n-  updateAttributes: updateUserAttr\n-};\n-\n-export const mockUser2 = JSON.parse(JSON.stringify(mockUser));\n-mockUser2.completedChallenges.push(mockPassingExamChallenge);\n-\n-const mockObservable = {\n-  toPromise: () => Promise.resolve('result')\n-};\n-\n-export const mockDonation = {\n-  id: '5e5f8eda5ed7be2b54e18718',\n-  email: 'donor@freecodecamp.com',\n-  provider: 'paypal',\n-  amount: 500,\n-  duration: 'month',\n-  startDate: {\n-    _when: '2018-11-01T00:00:00.000Z',\n-    _date: '2018-11-01T00:00:00.000Z'\n-  },\n-  subscriptionId: 'I-BA1ATBNF8T3P',\n-  userId: mockUserID,\n-  updateAttributes: updateDonationAttr\n-};\n-\n-export function createNewUserFromEmail(email) {\n-  const newMockUser = mockUser;\n-  newMockUser.email = email;\n-  newMockUser.username = 'camberbot2';\n-  newMockUser.ID = '5c7d892aff9888c8b1c1a95e';\n-  return newMockUser;\n-}\n-\n-export const mockApp = {\n-  models: {\n-    Donation: {\n-      findOne(query, cb) {\n-        return isEqual(query, matchSubscriptionIdQuery)\n-          ? cb(null, mockDonation)\n-          : cb(Error('No Donation'));\n-      }\n-    },\n-    User: {\n-      findById(id, cb) {\n-        if (id === mockUser.id) {\n-          return cb(null, mockUser);\n-        }\n-        return cb(Error('No user'));\n-      },\n-      findOne(query, cb) {\n-        if (isEqual(query, matchEmailQuery) || isEqual(query, matchUserIdQuery))\n-          return cb(null, mockUser);\n-        return cb(null, null);\n-      },\n-      create(query, cb) {\n-        if (!isEmail(query.email)) return cb(new Error('email not valid'));\n-        else if (query.email === mockUser.email)\n-          return cb(new Error('user exist'));\n-        createUserMockFn();\n-        return Promise.resolve(createNewUserFromEmail(query.email));\n-      }\n-    }\n-  }\n-};\n-\n-export const mockAllChallenges = [mockFirstChallenge, mockChallenge];\n-\n-export const mockGetFirstChallenge = () => firstChallengeUrl;\n-\n-export const matchEmailQuery = {\n-  where: { email: mockUser.email }\n-};\n-export const matchSubscriptionIdQuery = {\n-  where: { subscriptionId: mockDonation.subscriptionId }\n-};\n-export const matchUserIdQuery = {\n-  where: { id: mockUser.id }\n-};\n-\n-export const fullStackChallenges = [\n-  {\n-    completedDate: 1585210952511,\n-    id: '5a553ca864b52e1d8bceea14',\n-    challengeType: 7,\n-    files: []\n-  },\n-  {\n-    completedDate: 1585210952511,\n-    id: '561add10cb82ac38a17513bc',\n-    challengeType: 7,\n-    files: []\n-  },\n-  {\n-    completedDate: 1588665778679,\n-    id: '561acd10cb82ac38a17513bc',\n-    challengeType: 7,\n-    files: []\n-  },\n-  {\n-    completedDate: 1685210952511,\n-    id: '561abd10cb81ac38a17513bc',\n-    challengeType: 7,\n-    files: []\n-  },\n-  {\n-    completedDate: 1585210952511,\n-    id: '561add10cb82ac38a17523bc',\n-    challengeType: 7,\n-    files: []\n-  },\n-  {\n-    completedDate: 1588665778679,\n-    id: '561add10cb82ac38a17213bc',\n-    challengeType: 7,\n-    files: []\n-  }\n-];"
        },
        {
            "sha": "4e2cf80c612baa6826900a17aec603e999d79cc3",
            "filename": "api-server/src/server/boot_tests/settings.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 175,
            "changes": 175,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot_tests%2Fsettings.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fboot_tests%2Fsettings.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot_tests%2Fsettings.test.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,175 +0,0 @@\n-import {\n-  updateMyAbout,\n-  updateMySocials,\n-  updateMyClassroomMode\n-} from '../boot/settings';\n-\n-export const mockReq = opts => {\n-  const req = {};\n-  return { ...req, ...opts };\n-};\n-\n-export const mockRes = opts => {\n-  const res = {};\n-  res.status = jest.fn().mockReturnValue(res);\n-  res.json = jest.fn().mockReturnValue(res);\n-  res.redirect = jest.fn().mockReturnValue(res);\n-  res.set = jest.fn().mockReturnValue(res);\n-  res.clearCookie = jest.fn().mockReturnValue(res);\n-  res.cookie = jest.fn().mockReturnValue(res);\n-  return { ...res, ...opts };\n-};\n-\n-describe('boot/settings', () => {\n-  describe('updateMyAbout', () => {\n-    it('allows empty string in any field', () => {\n-      let updateData;\n-      const req = mockReq({\n-        user: {\n-          updateAttributes: (update, cb) => {\n-            updateData = update;\n-            cb();\n-          }\n-        },\n-        body: {\n-          name: '',\n-          location: '',\n-          about: '',\n-          picture: ''\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-      updateMyAbout(req, res, next);\n-      expect(res.status).toHaveBeenCalledWith(200);\n-      expect(updateData).toStrictEqual({\n-        name: '',\n-        location: '',\n-        about: '',\n-        picture: ''\n-      });\n-    });\n-  });\n-\n-  describe('updateMySocials', () => {\n-    it('does not allow non-github domain in GitHub social', () => {\n-      const req = mockReq({\n-        user: {},\n-        body: {\n-          githubProfile: 'https://www.almost-github.com'\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-      updateMySocials(req, res, next);\n-      expect(res.status).toHaveBeenCalledWith(403);\n-    });\n-\n-    it('does not allow non-linkedin domain in LinkedIn social', () => {\n-      const req = mockReq({\n-        user: {},\n-        body: {\n-          linkedin: 'https://www.freecodecamp.org'\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-      updateMySocials(req, res, next);\n-      expect(res.status).toHaveBeenCalledWith(403);\n-    });\n-\n-    it('does not allow non-twitter domain in Twitter social', () => {\n-      const req = mockReq({\n-        user: {},\n-        body: {\n-          twitter: 'https://www.freecodecamp.org'\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-      updateMySocials(req, res, next);\n-      expect(res.status).toHaveBeenCalledWith(403);\n-    });\n-\n-    it('allows empty string in any social', () => {\n-      const req = mockReq({\n-        user: {\n-          updateAttributes: (_, cb) => cb()\n-        },\n-        body: {\n-          twitter: '',\n-          linkedin: '',\n-          githubProfile: '',\n-          website: ''\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-      updateMySocials(req, res, next);\n-      expect(res.status).toHaveBeenCalledWith(200);\n-    });\n-\n-    it('allows any valid link in website social', () => {\n-      const req = mockReq({\n-        user: {\n-          updateAttributes: (_, cb) => cb()\n-        },\n-        body: {\n-          website: 'https://www.freecodecamp.org'\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-      updateMySocials(req, res, next);\n-      expect(res.status).toHaveBeenCalledWith(200);\n-    });\n-\n-    it('allows valid links with sub-domains to pass', () => {\n-      const req = mockReq({\n-        user: {\n-          updateAttributes: (_, cb) => cb()\n-        },\n-        body: {\n-          githubProfile: 'https://www.gist.github.com',\n-          linkedin: 'https://www.linkedin.com/freecodecamp',\n-          twitter: 'https://www.twitter.com/freecodecamp',\n-          website: 'https://www.example.freecodecamp.org'\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-      updateMySocials(req, res, next);\n-      expect(res.status).toHaveBeenCalledWith(200);\n-    });\n-  });\n-\n-  describe('updateMyClassroomMode', () => {\n-    it('does not allow invalid classroomMode', () => {\n-      const req = mockReq({\n-        user: {},\n-        body: {\n-          isClassroomAccount: 'invalid'\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-      updateMyClassroomMode(req, res, next);\n-      expect(res.status).toHaveBeenCalledWith(403);\n-    });\n-\n-    it('allows valid classroomMode', () => {\n-      const req = mockReq({\n-        user: {\n-          updateAttributes: (_, cb) => cb()\n-        },\n-        body: {\n-          isClassroomAccount: true\n-        }\n-      });\n-      const res = mockRes();\n-      const next = jest.fn();\n-      updateMyClassroomMode(req, res, next);\n-      expect(res.status).toHaveBeenCalledWith(200);\n-    });\n-  });\n-});"
        },
        {
            "sha": "3a8f38de97167b13a9ef38cf6973052c6d95f581",
            "filename": "api-server/src/server/component-passport.js",
            "status": "removed",
            "additions": 0,
            "deletions": 180,
            "changes": 180,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fcomponent-passport.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fcomponent-passport.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fcomponent-passport.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,180 +0,0 @@\n-import { PassportConfigurator } from '@freecodecamp/loopback-component-passport';\n-import dedent from 'dedent';\n-import passport from 'passport';\n-\n-import { availableLangs } from '../../../shared/config/i18n';\n-import { jwtSecret } from '../../config/secrets';\n-import passportProviders from './passport-providers';\n-import { setAccessTokenToResponse } from './utils/getSetAccessToken';\n-import {\n-  getReturnTo,\n-  getPrefixedLandingPath,\n-  getRedirectParams,\n-  haveSamePath\n-} from './utils/redirection';\n-import { getUserById } from './utils/user-stats';\n-\n-const passportOptions = {\n-  emailOptional: true,\n-  profileToUser: null\n-};\n-\n-PassportConfigurator.prototype.init = function passportInit(noSession) {\n-  this.app.middleware('session:after', passport.initialize());\n-\n-  if (noSession) {\n-    return;\n-  }\n-\n-  this.app.middleware('session:after', passport.session());\n-\n-  // Serialization and deserialization is only required if passport session is\n-  // enabled\n-\n-  passport.serializeUser((user, done) => done(null, user.id));\n-\n-  passport.deserializeUser(async (id, done) => {\n-    const user = await getUserById(id).catch(done);\n-    return done(null, user);\n-  });\n-};\n-\n-export function setupPassport(app) {\n-  const configurator = new PassportConfigurator(app);\n-\n-  configurator.setupModels({\n-    userModel: app.models.user,\n-    userIdentityModel: app.models.userIdentity,\n-    userCredentialModel: app.models.userCredential\n-  });\n-\n-  configurator.init();\n-\n-  Object.keys(passportProviders).map(function (strategy) {\n-    let config = passportProviders[strategy];\n-    config.session = config.session !== false;\n-\n-    config.customCallback = !config.useCustomCallback\n-      ? null\n-      : createPassportCallbackAuthenticator(strategy, config);\n-\n-    configurator.configureProvider(strategy, {\n-      ...config,\n-      ...passportOptions\n-    });\n-  });\n-}\n-\n-export const devSaveResponseAuthCookies = () => {\n-  return (req, res, next) => {\n-    const user = req.user;\n-\n-    if (!user) {\n-      return res.redirect('/signin');\n-    }\n-\n-    const { accessToken } = user;\n-\n-    setAccessTokenToResponse({ accessToken }, req, res);\n-    return next();\n-  };\n-};\n-\n-export const devLoginRedirect = () => {\n-  return (req, res) => {\n-    // this mirrors the production approach, but only validates the prefix\n-    let { returnTo, origin, pathPrefix } = getRedirectParams(\n-      req,\n-      ({ returnTo, origin, pathPrefix }) => {\n-        pathPrefix = availableLangs.client.includes(pathPrefix)\n-          ? pathPrefix\n-          : '';\n-        return {\n-          returnTo,\n-          origin,\n-          pathPrefix\n-        };\n-      }\n-    );\n-\n-    // if returnTo has a trailing slash, we need to remove it before comparing\n-    // it to the prefixed landing path\n-    if (returnTo.slice(-1) === '/') {\n-      returnTo = returnTo.slice(0, -1);\n-    }\n-    const redirectBase = getPrefixedLandingPath(origin, pathPrefix);\n-    returnTo += haveSamePath(redirectBase, returnTo) ? '/learn' : '';\n-    return res.redirect(returnTo);\n-  };\n-};\n-\n-export const createPassportCallbackAuthenticator =\n-  (strategy, config) => (req, res, next) => {\n-    return passport.authenticate(\n-      strategy,\n-      { session: false },\n-      (err, user, userInfo) => {\n-        if (err) {\n-          return next(err);\n-        }\n-\n-        const state = req && req.query && req.query.state;\n-        // returnTo, origin and pathPrefix are audited by getReturnTo\n-        let { returnTo, origin, pathPrefix } = getReturnTo(state, jwtSecret);\n-        const redirectBase = getPrefixedLandingPath(origin, pathPrefix);\n-\n-        const { error, error_description } = req.query;\n-        if (error === 'access_denied') {\n-          const blockedByLaw =\n-            error_description === 'Access denied from your location';\n-\n-          // Do not show any error message, instead redirect to the blocked page, with details.\n-          if (blockedByLaw) {\n-            return res.redirectWithFlash(`${redirectBase}/blocked`);\n-          }\n-\n-          req.flash('info', dedent`${error_description}.`);\n-          return res.redirectWithFlash(`${redirectBase}/learn`);\n-        }\n-\n-        if (!user || !userInfo) {\n-          return res.redirect('/signin');\n-        }\n-\n-        const { accessToken } = userInfo;\n-        const { provider } = config;\n-        if (accessToken && accessToken.id) {\n-          if (provider === 'auth0') {\n-            req.flash('success', 'flash.signin-success');\n-          } else if (user.email) {\n-            req.flash(\n-              'info',\n-              dedent`\n-We are moving away from social authentication for privacy reasons. Next time\n-we recommend using your email address: ${user.email} to sign in instead.\n-            `\n-            );\n-          }\n-          setAccessTokenToResponse({ accessToken }, req, res);\n-          req.login(user);\n-        }\n-\n-        // TODO: getReturnTo could return a success flag to show a flash message,\n-        // but currently it immediately gets overwritten by a second message. We\n-        // should either change the message if the flag is present or allow\n-        // multiple messages to appear at once.\n-\n-        if (user.acceptedPrivacyTerms) {\n-          // if returnTo has a trailing slash, we need to remove it before comparing\n-          // it to the prefixed landing path\n-          if (returnTo.slice(-1) === '/') {\n-            returnTo = returnTo.slice(0, -1);\n-          }\n-          returnTo += haveSamePath(redirectBase, returnTo) ? '/learn' : '';\n-          return res.redirectWithFlash(returnTo);\n-        } else {\n-          return res.redirectWithFlash(`${redirectBase}/email-sign-up`);\n-        }\n-      }\n-    )(req, res, next);\n-  };"
        },
        {
            "sha": "5d197a8a1f1cc358430c1820e24c652689c8e0c3",
            "filename": "api-server/src/server/config.development.js",
            "status": "removed",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fconfig.development.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fconfig.development.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fconfig.development.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,9 +0,0 @@\n-module.exports = {\n-  host: '127.0.0.1',\n-  sessionSecret: process.env.SESSION_SECRET,\n-\n-  github: {\n-    clientID: process.env.GITHUB_ID,\n-    clientSecret: process.env.GITHUB_SECRET\n-  }\n-};"
        },
        {
            "sha": "a98fd60bdf35727b37e1fa467f158456b75b8231",
            "filename": "api-server/src/server/config.json",
            "status": "removed",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fconfig.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fconfig.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fconfig.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,22 +0,0 @@\n-{\n-  \"restApiRoot\": \"/api\",\n-  \"host\": \"127.0.0.1\",\n-  \"port\": 3000,\n-  \"legacyExplorer\": false,\n-  \"remoting\": {\n-    \"rest\": {\n-      \"handleErrors\": false,\n-      \"normalizeHttpPath\": false,\n-      \"xml\": false\n-    },\n-    \"json\": {\n-      \"strict\": false,\n-      \"limit\": \"100kb\"\n-    },\n-    \"urlencoded\": {\n-      \"extended\": true,\n-      \"limit\": \"100kb\"\n-    },\n-    \"cors\": false\n-  }\n-}"
        },
        {
            "sha": "3a5a95a441f2683d7dcb95755418d3b2169b6a1e",
            "filename": "api-server/src/server/config.local.js",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fconfig.local.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fconfig.local.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fconfig.local.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,11 +0,0 @@\n-var globalConfig = require('../common/config.global');\n-\n-module.exports = {\n-  restApiRoot: globalConfig.restApi,\n-  sessionSecret: process.env.SESSION_SECRET,\n-\n-  github: {\n-    clientID: process.env.GITHUB_ID,\n-    clientSecret: process.env.GITHUB_SECRET\n-  }\n-};"
        },
        {
            "sha": "585b30e3b13c7bd604d5c1c0baee21820d6fabee",
            "filename": "api-server/src/server/config.production.js",
            "status": "removed",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fconfig.production.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fconfig.production.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fconfig.production.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,3 +0,0 @@\n-module.exports = {\n-  host: process.env.HOST || 'localhost'\n-};"
        },
        {
            "sha": "1c52e784b8aeb1907c608c4b7d517c20bfd57287",
            "filename": "api-server/src/server/datasources.development.js",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fdatasources.development.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fdatasources.development.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fdatasources.development.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,30 +0,0 @@\n-const debug = require('debug')('fcc:server:datasources');\n-const dsLocal = require('./datasources.production.js');\n-\n-const ds = {\n-  ...dsLocal\n-};\n-// use [MailHog](https://github.com/mailhog/MailHog) if no SES keys are found\n-if (!process.env.SES_ID) {\n-  ds.mail = {\n-    connector: 'mail',\n-    transport: {\n-      type: 'smtp',\n-      host: process.env.MAILHOG_HOST || 'localhost',\n-      secure: false,\n-      port: 1025,\n-      tls: {\n-        rejectUnauthorized: false\n-      }\n-    },\n-    auth: {\n-      user: 'test',\n-      pass: 'test'\n-    }\n-  };\n-  debug(`using MailHog server on port ${ds.mail.transport.port}`);\n-} else {\n-  debug('using AWS SES to deliver emails');\n-}\n-\n-module.exports = ds;"
        },
        {
            "sha": "b3e3ac9cbb1c96b0082c793a26979db4bfc8b499",
            "filename": "api-server/src/server/datasources.json",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fdatasources.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fdatasources.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fdatasources.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,11 +0,0 @@\n-{\n-  \"db\": {\n-    \"name\": \"db\",\n-    \"connector\": \"mongodb\",\n-    \"allowExtendedOperators\": true\n-  },\n-  \"mail\": {\n-    \"name\": \"mail\",\n-    \"connector\": \"mail\"\n-  }\n-}"
        },
        {
            "sha": "8b49365ab007c44f70f601d5af156e7f2ef9c48d",
            "filename": "api-server/src/server/datasources.production.js",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fdatasources.production.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fdatasources.production.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fdatasources.production.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,21 +0,0 @@\n-var secrets = require('../../config/secrets');\n-\n-module.exports = {\n-  db: {\n-    connector: 'mongodb',\n-    protocol: 'mongodb+srv',\n-    connectionTimeout: 10000,\n-    url: secrets.db,\n-    useNewUrlParser: true,\n-    useUnifiedTopology: true,\n-    allowExtendedOperators: true\n-  },\n-  mail: {\n-    connector: 'mail',\n-    transport: {\n-      type: 'ses',\n-      accessKeyId: process.env.SES_ID,\n-      secretAccessKey: process.env.SES_SECRET\n-    }\n-  }\n-};"
        },
        {
            "sha": "73d83b4e8156e6ac6ab7beecbc9e294e0ad85e13",
            "filename": "api-server/src/server/index.js",
            "status": "removed",
            "additions": 0,
            "deletions": 116,
            "changes": 116,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Findex.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Findex.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Findex.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,116 +0,0 @@\n-const path = require('path');\n-require('dotenv').config({ path: path.resolve(__dirname, '../../../.env') });\n-\n-const Sentry = require('@sentry/node');\n-// const Tracing = require('@sentry/tracing');\n-const createDebugger = require('debug');\n-const _ = require('lodash');\n-const loopback = require('loopback');\n-const boot = require('loopback-boot');\n-const morgan = require('morgan');\n-\n-const { sentry } = require('../../config/secrets');\n-const { setupPassport } = require('./component-passport');\n-const { getRedirectParams } = require('./utils/redirection.js');\n-\n-const log = createDebugger('fcc:server');\n-const reqLogFormat = ':date[iso] :status :method :response-time ms - :url';\n-\n-const app = loopback();\n-\n-app.set('state namespace', '__fcc__');\n-app.set('port', process.env.API_PORT || 3000);\n-app.set('views', path.join(__dirname, 'views'));\n-app.use(loopback.token());\n-app.use(\n-  morgan(reqLogFormat, { stream: { write: msg => log(_.split(msg, '\\n')[0]) } })\n-);\n-app.disable('x-powered-by');\n-\n-const createLogOnce = () => {\n-  let called = false;\n-  return str => {\n-    if (called) {\n-      return null;\n-    }\n-    called = true;\n-    return log(str);\n-  };\n-};\n-const logOnce = createLogOnce();\n-\n-boot(app, __dirname, err => {\n-  if (err) {\n-    // rethrowing the error here because any error thrown in the boot stage\n-    // is silent\n-    logOnce('The below error was thrown in the boot stage');\n-    throw err;\n-  }\n-});\n-\n-setupPassport(app);\n-\n-const { db } = app.datasources;\n-db.on(\n-  'connected',\n-  _.once(() => log('db connected'))\n-);\n-\n-app.start = _.once(function () {\n-  const server = app.listen(app.get('port'), function () {\n-    app.emit('started');\n-    log(\n-      'freeCodeCamp server listening on port %d in %s',\n-      app.get('port'),\n-      app.get('env')\n-    );\n-    log(`connecting to db at ${db.settings.url}`);\n-  });\n-\n-  process.on('SIGINT', () => {\n-    log('Shutting down server');\n-    server.close(() => {\n-      log('Server is closed');\n-    });\n-    log('closing db connection');\n-    db.disconnect().then(() => {\n-      log('DB connection closed');\n-      // exit process\n-      // this may close kept alive sockets\n-      process.exit(0);\n-    });\n-  });\n-});\n-\n-if (process.env.FREECODECAMP_NODE_ENV === 'development') {\n-  app.get('/', (req, res) => {\n-    log('Mounting dev root redirect...');\n-    const { origin } = getRedirectParams(req);\n-    res.redirect(origin);\n-  });\n-}\n-\n-if (sentry.dsn === 'dsn_from_sentry_dashboard') {\n-  log('Sentry reporting disabled unless DSN is provided.');\n-} else {\n-  Sentry.init({\n-    dsn: sentry.dsn\n-    // integrations: [\n-    //   new Sentry.Integrations.Http({ tracing: true }),\n-    //   new Tracing.Integrations.Express({\n-    //     app\n-    //   })\n-    // ],\n-    // // Capture 20% of transactions to avoid\n-    // // overwhelming Sentry and remain within\n-    // // the usage quota\n-    // tracesSampleRate: 0.2\n-  });\n-  log('Sentry initialized');\n-}\n-\n-module.exports = app;\n-\n-if (require.main === module) {\n-  app.start();\n-}"
        },
        {
            "sha": "7c8d7a802cfa3c743c81474c1ce83488f9292c97",
            "filename": "api-server/src/server/manifests/README.md",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmanifests%2FREADME.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmanifests%2FREADME.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmanifests%2FREADME.md?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,8 +0,0 @@\n-This folder contains a list of json files representing the name\n-of revisioned client files. It is empty due to the fact that the\n-files are generated at runtime and their content is determined by\n-the content of the files they are derived from.\n-\n-Since the build process is not exactly the same on every machine,\n-these files are not tracked in github otherwise conflicts arise when\n-building on our servers."
        },
        {
            "sha": "df8d4ae9ff8b911cf5001f93eca9cdb629412c1d",
            "filename": "api-server/src/server/middleware.json",
            "status": "removed",
            "additions": 0,
            "deletions": 59,
            "changes": 59,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddleware.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddleware.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddleware.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,59 +0,0 @@\n-{\n-  \"initial:before\": {\n-    \"./middlewares/sentry-request-handler\": {}\n-  },\n-  \"initial\": {\n-    \"compression\": {},\n-    \"cors\": {\n-      \"params\": {\n-        \"origin\": true,\n-        \"credentials\": true,\n-        \"maxAge\": 86400\n-      }\n-    }\n-  },\n-  \"session\": {\n-    \"./middlewares/sessions.js\": {}\n-  },\n-  \"auth:before\": {\n-    \"express-flash\": {},\n-    \"./middlewares/express-extensions\": {},\n-    \"./middlewares/cookie-parser\": {},\n-    \"./middlewares/request-authorization\": {}\n-  },\n-  \"parse\": {\n-    \"body-parser#json\": {},\n-    \"body-parser#urlencoded\": {\n-      \"params\": {\n-        \"extended\": true\n-      }\n-    },\n-    \"method-override\": {}\n-  },\n-  \"routes:before\": {\n-    \"helmet#xssFilter\": {},\n-    \"helmet#noSniff\": {},\n-    \"helmet#frameguard\": {},\n-    \"./middlewares/csurf\": {},\n-    \"./middlewares/csurf-set-cookie\": {},\n-    \"./middlewares/constant-headers\": {},\n-    \"./middlewares/csp\": {},\n-    \"./middlewares/flash-cheaters\": {},\n-    \"./middlewares/passport-login\": {},\n-    \"./middlewares/rate-limit\": {\n-      \"paths\": [\"/mobile-login\"]\n-    }\n-  },\n-  \"files\": {},\n-  \"final:after\": {\n-    \"./middlewares/sentry-error-handler\": {},\n-    \"./middlewares/csurf-error-handler\": {},\n-    \"./middlewares/error-handlers\": {},\n-    \"strong-error-handler\": {\n-      \"params\": {\n-        \"debug\": false,\n-        \"log\": true\n-      }\n-    }\n-  }\n-}"
        },
        {
            "sha": "0579ec03a4b83bc9d9d3dea0a142229a5052da29",
            "filename": "api-server/src/server/middlewares/constant-headers.js",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fconstant-headers.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fconstant-headers.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fconstant-headers.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,21 +0,0 @@\n-import { allowedOrigins } from '../../../config/cors-settings';\n-\n-export default function constantHeaders() {\n-  return function (req, res, next) {\n-    if (\n-      req.headers &&\n-      req.headers.origin &&\n-      allowedOrigins.includes(req.headers.origin)\n-    ) {\n-      res.header('Access-Control-Allow-Origin', req.headers.origin);\n-    } else {\n-      res.header('Access-Control-Allow-Origin', process.env.HOME_LOCATION);\n-    }\n-    res.header('Access-Control-Allow-Credentials', true);\n-    res.header(\n-      'Access-Control-Allow-Headers',\n-      'Origin, X-Requested-With, Content-Type, Accept'\n-    );\n-    next();\n-  };\n-}"
        },
        {
            "sha": "4bcb0cde79cc6ce22fdec18702a0117f3a05e059",
            "filename": "api-server/src/server/middlewares/cookie-parser.js",
            "status": "removed",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcookie-parser.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcookie-parser.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcookie-parser.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,4 +0,0 @@\n-import cookieParser from 'cookie-parser';\n-\n-const cookieSecret = process.env.COOKIE_SECRET;\n-export default cookieParser.bind(cookieParser, cookieSecret);"
        },
        {
            "sha": "4490368b970c8e809cb3201b4c3a407188e67497",
            "filename": "api-server/src/server/middlewares/csp.js",
            "status": "removed",
            "additions": 0,
            "deletions": 93,
            "changes": 93,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcsp.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcsp.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcsp.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,93 +0,0 @@\n-import helmet from 'helmet';\n-\n-let trusted = [\n-  \"'self'\",\n-  'https://search.freecodecamp.org',\n-  process.env.HOME_LOCATION,\n-  'https://' + process.env.AUTH0_DOMAIN\n-];\n-\n-const host = process.env.HOST || 'localhost';\n-const port = process.env.SYNC_PORT || '3000';\n-\n-if (process.env.FREECODECAMP_NODE_ENV !== 'production') {\n-  trusted = trusted.concat([`ws://${host}:${port}`, 'http://localhost:8000']);\n-}\n-\n-export default function csp() {\n-  return helmet.contentSecurityPolicy({\n-    directives: {\n-      defaultSrc: trusted.concat([\n-        'https://*.cloudflare.com',\n-        '*.cloudflare.com'\n-      ]),\n-      connectSrc: trusted.concat([\n-        'https://glitch.com',\n-        'https://*.glitch.com',\n-        'https://*.glitch.me',\n-        'https://*.cloudflare.com',\n-        'https://*.algolia.net'\n-      ]),\n-      scriptSrc: [\n-        \"'unsafe-eval'\",\n-        \"'unsafe-inline'\",\n-        '*.google-analytics.com',\n-        '*.gstatic.com',\n-        'https://*.cloudflare.com',\n-        '*.cloudflare.com',\n-        'https://*.gitter.im',\n-        'https://*.cdnjs.com',\n-        '*.cdnjs.com',\n-        'https://*.jsdelivr.com',\n-        '*.jsdelivr.com',\n-        '*.twimg.com',\n-        'https://*.twimg.com',\n-        '*.youtube.com',\n-        '*.ytimg.com'\n-      ].concat(trusted),\n-      styleSrc: [\n-        \"'unsafe-inline'\",\n-        '*.gstatic.com',\n-        '*.googleapis.com',\n-        '*.bootstrapcdn.com',\n-        'https://*.bootstrapcdn.com',\n-        '*.cloudflare.com',\n-        'https://*.cloudflare.com',\n-        'https://use.fontawesome.com'\n-      ].concat(trusted),\n-      fontSrc: [\n-        '*.cloudflare.com',\n-        'https://*.cloudflare.com',\n-        '*.bootstrapcdn.com',\n-        '*.googleapis.com',\n-        '*.gstatic.com',\n-        'https://*.bootstrapcdn.com',\n-        'https://use.fontawesome.com'\n-      ].concat(trusted),\n-      imgSrc: [\n-        // allow all input since we have user submitted images for\n-        // public profile\n-        '*',\n-        'data:'\n-      ],\n-      mediaSrc: ['*.bitly.com', '*.amazonaws.com', '*.twitter.com'].concat(\n-        trusted\n-      ),\n-      frameSrc: [\n-        '*.gitter.im',\n-        '*.gitter.im https:',\n-        '*.youtube.com',\n-        '*.twitter.com',\n-        '*.ghbtns.com',\n-        '*.freecatphotoapp.com',\n-        'freecodecamp.github.io'\n-      ].concat(trusted)\n-    },\n-    // set to true if you only want to report errors\n-    reportOnly: false,\n-    // set to true if you want to set all headers\n-    setAllHeaders: false,\n-    // set to true if you want to force buggy CSP in Safari 5\n-    safari5: false\n-  });\n-}"
        },
        {
            "sha": "2237d5227c44c3ead30cad41d3fe3c3f58c2c64b",
            "filename": "api-server/src/server/middlewares/csurf-error-handler.js",
            "status": "removed",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcsurf-error-handler.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcsurf-error-handler.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcsurf-error-handler.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,12 +0,0 @@\n-import { csrfOptions } from './csurf.js';\n-\n-export default function csrfErrorHandler() {\n-  return function (err, req, res, next) {\n-    if (err.code === 'EBADCSRFTOKEN' && req.csrfToken) {\n-      // use the middleware to generate a token. The client sends this back via\n-      // a header\n-      res.cookie('csrf_token', req.csrfToken(), csrfOptions);\n-    }\n-    next(err);\n-  };\n-}"
        },
        {
            "sha": "2e79ef82087f8ca66e9a961cb185873f030edaf0",
            "filename": "api-server/src/server/middlewares/csurf-set-cookie.js",
            "status": "removed",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcsurf-set-cookie.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcsurf-set-cookie.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcsurf-set-cookie.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,13 +0,0 @@\n-import { csrfOptions } from './csurf.js';\n-\n-export default function setCSRFCookie() {\n-  return function (req, res, next) {\n-    // not all paths require a CSRF token, so the function may not be available.\n-    if (req.csrfToken && !req.cookies.csrf_token) {\n-      // use the middleware to generate a token. The client sends this back via\n-      // a header\n-      res.cookie('csrf_token', req.csrfToken(), csrfOptions);\n-    }\n-    next();\n-  };\n-}"
        },
        {
            "sha": "9dcc96841725e7df91a63211cf66f5ff094176a1",
            "filename": "api-server/src/server/middlewares/csurf.js",
            "status": "removed",
            "additions": 0,
            "deletions": 26,
            "changes": 26,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcsurf.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcsurf.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fcsurf.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,26 +0,0 @@\n-import csurf from 'csurf';\n-\n-export const csrfOptions = {\n-  domain: process.env.COOKIE_DOMAIN,\n-  sameSite: 'strict',\n-  secure: process.env.FREECODECAMP_NODE_ENV === 'production'\n-};\n-\n-export default function getCsurf() {\n-  const protection = csurf({\n-    cookie: { ...csrfOptions, httpOnly: true }\n-  });\n-  return function csrf(req, res, next) {\n-    const { path } = req;\n-    if (\n-      /^\\/donate\\/charge-stripe$|^\\/donate\\/create-stripe-payment-intent$|^\\/coderoad-challenge-completed$/.test(\n-        path\n-      )\n-    ) {\n-      next();\n-    } else {\n-      // add the middleware\n-      protection(req, res, next);\n-    }\n-  };\n-}"
        },
        {
            "sha": "1ca01eaf14e99f9792d5f08a67ed59cc60b71297",
            "filename": "api-server/src/server/middlewares/error-handlers.js",
            "status": "removed",
            "additions": 0,
            "deletions": 68,
            "changes": 68,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Ferror-handlers.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Ferror-handlers.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Ferror-handlers.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,68 +0,0 @@\n-// import { inspect } from 'util';\n-// import _ from 'lodash/fp';\n-import accepts from 'accepts';\n-\n-import { unwrapHandledError } from '../utils/create-handled-error.js';\n-import { getRedirectParams } from '../utils/redirection';\n-\n-const errTemplate = (error, req) => {\n-  const { message, stack } = error;\n-  return `\n-Error: ${message}\n-Is authenticated user: ${!!req.user}\n-Headers: ${JSON.stringify(req.headers, null, 2)}\n-Original request: ${req.originalMethod} ${req.originalUrl}\n-Stack: ${stack}\n-\n-// raw\n-${JSON.stringify(error, null, 2)}\n-\n-`;\n-};\n-\n-const isDev = process.env.FREECODECAMP_NODE_ENV !== 'production';\n-\n-export default function prodErrorHandler() {\n-  // error handling in production.\n-  return function (err, req, res, _next) {\n-    // response for when req.body is bigger than body-parser's size limit\n-    if (err?.type === 'entity.too.large') {\n-      return res.status('413').send('Request payload is too large');\n-    }\n-\n-    const { origin } = getRedirectParams(req);\n-    const handled = unwrapHandledError(err);\n-    // respect handled error status\n-    let status = handled.status || err.status || res.statusCode;\n-    if (!handled.status && status < 400) {\n-      status = 500;\n-    }\n-    res.status(status);\n-\n-    // parse res type\n-    const accept = accepts(req);\n-    // prioritise returning json\n-    const type = accept.type('json', 'html', 'text');\n-\n-    const redirectTo = handled.redirectTo || `${origin}/`;\n-    const message =\n-      handled.message ||\n-      'Oops! Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.';\n-\n-    if (isDev) {\n-      console.error(errTemplate(err, req));\n-    }\n-\n-    if (type === 'json') {\n-      return res.json({\n-        type: handled.type || 'danger',\n-        message\n-      });\n-    } else {\n-      if (typeof req.flash === 'function') {\n-        req.flash(handled.type || 'danger', message);\n-      }\n-      return res.redirectWithFlash(redirectTo);\n-    }\n-  };\n-}"
        },
        {
            "sha": "f506665b6845dad4b7b014d0981b6459d3d88f49",
            "filename": "api-server/src/server/middlewares/express-extensions.js",
            "status": "removed",
            "additions": 0,
            "deletions": 23,
            "changes": 23,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fexpress-extensions.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fexpress-extensions.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fexpress-extensions.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,23 +0,0 @@\n-import qs from 'query-string';\n-\n-// add rx methods to express\n-export default function getExpressExtensions() {\n-  return function expressExtensions(req, res, next) {\n-    res.redirectWithFlash = uri => {\n-      const flash = req.flash();\n-      res.redirect(\n-        `${uri}?${qs.stringify(\n-          { messages: qs.stringify(flash, { arrayFormat: 'index' }) },\n-          { arrayFormat: 'index' }\n-        )}`\n-      );\n-    };\n-    res.sendFlash = (type, message) => {\n-      if (type && message) {\n-        req.flash(type, message);\n-      }\n-      return res.json(req.flash());\n-    };\n-    next();\n-  };\n-}"
        },
        {
            "sha": "710092c9a4e8e4069afe86362fb26c86d0d28faa",
            "filename": "api-server/src/server/middlewares/flash-cheaters.js",
            "status": "removed",
            "additions": 0,
            "deletions": 32,
            "changes": 32,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fflash-cheaters.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fflash-cheaters.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fflash-cheaters.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,32 +0,0 @@\n-import dedent from 'dedent';\n-\n-const ALLOWED_METHODS = ['GET'];\n-const EXCLUDED_PATHS = [\n-  '/api/flyers/findOne',\n-  '/challenges/current-challenge',\n-  '/challenges/next-challenge',\n-  '/map-aside',\n-  '/signout'\n-];\n-\n-export default function flashCheaters() {\n-  return function (req, res, next) {\n-    if (\n-      ALLOWED_METHODS.indexOf(req.method) !== -1 &&\n-      EXCLUDED_PATHS.indexOf(req.path) === -1 &&\n-      req.user &&\n-      req.url !== '/' &&\n-      req.user.isCheater\n-    ) {\n-      req.flash(\n-        'danger',\n-        dedent`\n-          Upon review, this account has been flagged for academic\n-          dishonesty. If youre the owner of this account contact\n-          team@freecodecamp.org for details.\n-        `\n-      );\n-    }\n-    return next();\n-  };\n-}"
        },
        {
            "sha": "710bf187e32e3774b865772dd77858519c4744c4",
            "filename": "api-server/src/server/middlewares/ms-username.js",
            "status": "removed",
            "additions": 0,
            "deletions": 20,
            "changes": 20,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fms-username.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fms-username.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fms-username.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,20 +0,0 @@\n-import debugFactory from 'debug';\n-const log = debugFactory('fcc:boot:user');\n-\n-export function createDeleteMsUsername(app) {\n-  const { MsUsername } = app.models;\n-\n-  return async function deleteMsUsername(req, res, next) {\n-    try {\n-      await MsUsername.destroyAll({ userId: req.user.id });\n-      req.msUsernameDeleted = true;\n-    } catch (e) {\n-      req.msUsernameDeleted = false;\n-      log(\n-        `An error occurred deleting Microsoft username for user with id ${req.user.id}`\n-      );\n-    }\n-\n-    next();\n-  };\n-}"
        },
        {
            "sha": "d58b8df13aa9e6bc8614d1719d2ad58f1976a89b",
            "filename": "api-server/src/server/middlewares/passport-login.js",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fpassport-login.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fpassport-login.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fpassport-login.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,21 +0,0 @@\n-import _ from 'lodash';\n-import { login } from 'passport/lib/http/request';\n-import { Observable } from 'rx';\n-\n-// make login polymorphic\n-// if supplied callback it works as normal\n-// if called without callback it returns an observable\n-// login(user, options?, cb?) => Void|Observable\n-function login$(...args) {\n-  if (_.isFunction(_.last(args))) {\n-    return login.apply(this, args);\n-  }\n-  return Observable.fromNodeCallback(login).apply(this, args);\n-}\n-\n-export default function passportLogin() {\n-  return (req, res, next) => {\n-    req.login = req.logIn = login$;\n-    next();\n-  };\n-}"
        },
        {
            "sha": "b461039a12c58be8453172999e8cc8c9eb6b7e71",
            "filename": "api-server/src/server/middlewares/rate-limit.js",
            "status": "removed",
            "additions": 0,
            "deletions": 23,
            "changes": 23,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Frate-limit.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Frate-limit.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Frate-limit.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,23 +0,0 @@\n-import rateLimit from 'express-rate-limit';\n-import MongoStore from 'rate-limit-mongo';\n-\n-const url = process.env.MONGODB || process.env.MONGOHQ_URL;\n-\n-// Rate limit for mobile login\n-// 10 requests per 15 minute windows\n-export default function rateLimitMiddleware() {\n-  return rateLimit({\n-    windowMs: 15 * 60 * 1000,\n-    max: 10,\n-    standardHeaders: true,\n-    legacyHeaders: false,\n-    keyGenerator: req => {\n-      return req.headers['x-forwarded-for'] || 'localhost';\n-    },\n-    store: new MongoStore({\n-      collectionName: 'UserRateLimit',\n-      uri: url,\n-      expireTimeMs: 15 * 60 * 1000\n-    })\n-  });\n-}"
        },
        {
            "sha": "11c296199f113eb7abd9e37a983a119640859191",
            "filename": "api-server/src/server/middlewares/request-authorization.js",
            "status": "removed",
            "additions": 0,
            "deletions": 106,
            "changes": 106,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Frequest-authorization.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Frequest-authorization.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Frequest-authorization.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,106 +0,0 @@\n-import { isEmpty } from 'lodash';\n-\n-import { jwtSecret as _jwtSecret } from '../../../config/secrets';\n-\n-import { wrapHandledError } from '../utils/create-handled-error';\n-import {\n-  getAccessTokenFromRequest,\n-  errorTypes\n-} from '../utils/getSetAccessToken';\n-import { getRedirectParams } from '../utils/redirection';\n-import { getUserById as _getUserById } from '../utils/user-stats';\n-\n-const authRE = /^\\/auth\\//;\n-const confirmEmailRE = /^\\/confirm-email$/;\n-const newsShortLinksRE = /^\\/n\\/|^\\/p\\//;\n-const publicUserRE = /^\\/users\\/get-public-profile$/;\n-const publicUsernameRE = /^\\/users\\/exists$/;\n-const resubscribeRE = /^\\/resubscribe\\//;\n-const showCertRE = /^\\/certificate\\/showCert\\//;\n-// note: signin may not have a trailing slash\n-const signinRE = /^\\/signin/;\n-const statusRE = /^\\/status\\/ping$/;\n-const unsubscribedRE = /^\\/unsubscribed\\//;\n-const unsubscribeRE = /^\\/u\\/|^\\/unsubscribe\\/|^\\/ue\\//;\n-// note: this would be replaced by webhooks later\n-const donateRE = /^\\/donate\\/charge-stripe$/;\n-const paymentIntentRE = /^\\/donate\\/create-stripe-payment-intent$/;\n-const submitCoderoadChallengeRE = /^\\/coderoad-challenge-completed$/;\n-const mobileLoginRE = /^\\/mobile-login\\/?$/;\n-\n-const _pathsAllowedREs = [\n-  authRE,\n-  confirmEmailRE,\n-  newsShortLinksRE,\n-  publicUserRE,\n-  publicUsernameRE,\n-  resubscribeRE,\n-  showCertRE,\n-  signinRE,\n-  statusRE,\n-  unsubscribedRE,\n-  unsubscribeRE,\n-  donateRE,\n-  paymentIntentRE,\n-  submitCoderoadChallengeRE,\n-  mobileLoginRE\n-];\n-\n-export function isAllowedPath(path, pathsAllowedREs = _pathsAllowedREs) {\n-  return pathsAllowedREs.some(re => re.test(path));\n-}\n-\n-export default function getRequestAuthorisation({\n-  jwtSecret = _jwtSecret,\n-  getUserById = _getUserById\n-} = {}) {\n-  return function requestAuthorisation(req, res, next) {\n-    const { origin } = getRedirectParams(req);\n-    const { path } = req;\n-    if (!isAllowedPath(path)) {\n-      const { accessToken, error } = getAccessTokenFromRequest(req, jwtSecret);\n-      if (!accessToken && error === errorTypes.noTokenFound) {\n-        throw wrapHandledError(\n-          new Error('Access token is required for this request'),\n-          {\n-            type: 'info',\n-            redirect: `${origin}/signin`,\n-            message: 'Access token is required for this request',\n-            status: 403\n-          }\n-        );\n-      }\n-      if (!accessToken && error === errorTypes.invalidToken) {\n-        throw wrapHandledError(new Error('Access token is invalid'), {\n-          type: 'info',\n-          redirect: `${origin}/signin`,\n-          message: 'Your access token is invalid',\n-          status: 403\n-        });\n-      }\n-      if (!accessToken && error === errorTypes.expiredToken) {\n-        throw wrapHandledError(new Error('Access token is no longer valid'), {\n-          type: 'info',\n-          redirect: `${origin}/signin`,\n-          message: 'Access token is no longer valid',\n-          status: 403\n-        });\n-      }\n-      if (isEmpty(req.user)) {\n-        const { userId } = accessToken;\n-        return getUserById(userId)\n-          .then(user => {\n-            if (user) {\n-              req.user = user;\n-            }\n-            return;\n-          })\n-          .then(next)\n-          .catch(next);\n-      } else {\n-        return Promise.resolve(next());\n-      }\n-    }\n-    return Promise.resolve(next());\n-  };\n-}"
        },
        {
            "sha": "86ca46d08a7c581b4ff283c2f650a94fef72209d",
            "filename": "api-server/src/server/middlewares/request-authorization.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 180,
            "changes": 180,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Frequest-authorization.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Frequest-authorization.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Frequest-authorization.test.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,180 +0,0 @@\n-import path from 'path';\n-import jwt from 'jsonwebtoken';\n-import { config } from 'dotenv';\n-\n-import { mockReq as mockRequest, mockRes } from '../boot_tests/challenge.test';\n-import createRequestAuthorization, {\n-  isAllowedPath\n-} from './request-authorization';\n-\n-config({ path: path.resolve(__dirname, '../../../../.env') });\n-\n-const validJWTSecret = 'this is a super secret string';\n-const invalidJWTSecret = 'This is not correct secret';\n-const now = new Date(Date.now());\n-const theBeginningOfTime = new Date(0);\n-const accessToken = {\n-  id: '123abc',\n-  userId: '456def',\n-  ttl: 60000,\n-  created: now\n-};\n-const users = {\n-  '456def': {\n-    username: 'camperbot',\n-    progressTimestamps: [1, 2, 3, 4]\n-  }\n-};\n-const mockGetUserById = id =>\n-  id in users ? Promise.resolve(users[id]) : Promise.reject('No user found');\n-\n-const mockReq = args => {\n-  const mock = mockRequest(args);\n-  mock.header = () => process.env.HOME_LOCATION;\n-  return mock;\n-};\n-\n-describe('request-authorization', () => {\n-  describe('isAllowedPath', () => {\n-    const authRE = /^\\/auth\\//;\n-    const confirmEmailRE = /^\\/confirm-email$/;\n-    const newsShortLinksRE = /^\\/n\\/|^\\/p\\//;\n-    const publicUserRE = /^\\/users\\/get-public-profile$/;\n-    const publicUsernameRE = /^\\/users\\/exists$/;\n-    const resubscribeRE = /^\\/resubscribe\\//;\n-    const showCertRE = /^\\/certificate\\/showCert\\//;\n-    // note: signin may not have a trailing slash\n-    const signinRE = /^\\/signin/;\n-    const statusRE = /^\\/status\\/ping$/;\n-    const unsubscribedRE = /^\\/unsubscribed\\//;\n-    const unsubscribeRE = /^\\/u\\/|^\\/unsubscribe\\/|^\\/ue\\//;\n-\n-    const allowedPathsList = [\n-      authRE,\n-      confirmEmailRE,\n-      newsShortLinksRE,\n-      publicUserRE,\n-      publicUsernameRE,\n-      resubscribeRE,\n-      showCertRE,\n-      signinRE,\n-      statusRE,\n-      unsubscribedRE,\n-      unsubscribeRE\n-    ];\n-\n-    it('returns a boolean', () => {\n-      const result = isAllowedPath();\n-      expect(typeof result).toBe('boolean');\n-    });\n-\n-    it('returns true for a white listed path', () => {\n-      const resultA = isAllowedPath(\n-        '/auth/auth0/callback?code=yF_mGjswLsef-_RLo',\n-        allowedPathsList\n-      );\n-      const resultB = isAllowedPath(\n-        '/ue/WmjInLerysPrcon6fMb/',\n-        allowedPathsList\n-      );\n-      expect(resultA).toBe(true);\n-      expect(resultB).toBe(true);\n-    });\n-\n-    it('returns false for a non-white-listed path', () => {\n-      const resultA = isAllowedPath('/hax0r-42/no-go', allowedPathsList);\n-      const resultB = isAllowedPath(\n-        '/update-current-challenge',\n-        allowedPathsList\n-      );\n-      expect(resultA).toBe(false);\n-      expect(resultB).toBe(false);\n-    });\n-  });\n-\n-  describe('createRequestAuthorization', () => {\n-    const requestAuthorization = createRequestAuthorization({\n-      jwtSecret: validJWTSecret,\n-      getUserById: mockGetUserById\n-    });\n-\n-    it('is a function', () => {\n-      expect(typeof requestAuthorization).toEqual('function');\n-    });\n-\n-    describe('cookies', () => {\n-      it('throws when no access token is present', () => {\n-        expect.assertions(2);\n-        const req = mockReq({ path: '/some-path/that-needs/auth' });\n-        const res = mockRes();\n-        const next = jest.fn();\n-        expect(() => requestAuthorization(req, res, next)).toThrowError(\n-          'Access token is required for this request'\n-        );\n-        expect(next).not.toHaveBeenCalled();\n-      });\n-\n-      it('throws when the access token is invalid', () => {\n-        expect.assertions(2);\n-        const invalidJWT = jwt.sign({ accessToken }, invalidJWTSecret);\n-        const req = mockReq({\n-          path: '/some-path/that-needs/auth',\n-          // eslint-disable-next-line camelcase\n-          cookie: { jwt_access_token: invalidJWT }\n-        });\n-        const res = mockRes();\n-        const next = jest.fn();\n-\n-        expect(() => requestAuthorization(req, res, next)).toThrowError(\n-          'Access token is invalid'\n-        );\n-        expect(next).not.toHaveBeenCalled();\n-      });\n-\n-      it('throws when the access token has expired', () => {\n-        expect.assertions(2);\n-        const invalidJWT = jwt.sign(\n-          { accessToken: { ...accessToken, created: theBeginningOfTime } },\n-          validJWTSecret\n-        );\n-        const req = mockReq({\n-          path: '/some-path/that-needs/auth',\n-          // eslint-disable-next-line camelcase\n-          cookie: { jwt_access_token: invalidJWT }\n-        });\n-        const res = mockRes();\n-        const next = jest.fn();\n-\n-        expect(() => requestAuthorization(req, res, next)).toThrowError(\n-          'Access token is no longer valid'\n-        );\n-        expect(next).not.toHaveBeenCalled();\n-      });\n-\n-      it('adds the user to the request object', async () => {\n-        expect.assertions(3);\n-        const validJWT = jwt.sign({ accessToken }, validJWTSecret);\n-        const req = mockReq({\n-          path: '/some-path/that-needs/auth',\n-          // eslint-disable-next-line camelcase\n-          cookie: { jwt_access_token: validJWT }\n-        });\n-        const res = mockRes();\n-        const next = jest.fn();\n-        await requestAuthorization(req, res, next);\n-        expect(next).toHaveBeenCalled();\n-        expect(req).toHaveProperty('user');\n-        expect(req.user).toEqual(users['456def']);\n-      });\n-\n-      it('calls next if request does not require authorization', async () => {\n-        // currently /unsubscribe does not require authorization\n-        const req = mockReq({ path: '/unsubscribe/another/route' });\n-        const res = mockRes();\n-        const next = jest.fn();\n-        await requestAuthorization(req, res, next);\n-        expect(next).toHaveBeenCalled();\n-      });\n-    });\n-  });\n-});"
        },
        {
            "sha": "c795ff270933e6424eb3a9bea9aac409f5b0decd",
            "filename": "api-server/src/server/middlewares/sentry-error-handler.js",
            "status": "removed",
            "additions": 0,
            "deletions": 23,
            "changes": 23,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsentry-error-handler.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsentry-error-handler.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsentry-error-handler.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,23 +0,0 @@\n-import { Handlers, captureException } from '@sentry/node';\n-import { sentry } from '../../../config/secrets';\n-import { isHandledError } from '../utils/create-handled-error';\n-\n-// sends directly to Sentry\n-export function reportError(err) {\n-  return sentry.dsn === 'dsn_from_sentry_dashboard'\n-    ? console.error(err)\n-    : captureException(err);\n-}\n-\n-// determines which errors should be reported\n-export default function sentryErrorHandler() {\n-  return sentry.dsn === 'dsn_from_sentry_dashboard'\n-    ? (req, res, next) => next()\n-    : Handlers.errorHandler({\n-        shouldHandleError(err) {\n-          // CSRF errors have status 403, consider ignoring them once csurf is\n-          // no longer rejecting people incorrectly.\n-          return !isHandledError(err) && (!err.status || err.status >= 500);\n-        }\n-      });\n-}"
        },
        {
            "sha": "d1b999655ebe22a939f4408a379f4b4126d228fd",
            "filename": "api-server/src/server/middlewares/sentry-request-handler.js",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsentry-request-handler.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsentry-request-handler.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsentry-request-handler.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,8 +0,0 @@\n-import { Handlers } from '@sentry/node';\n-import { sentry } from '../../../config/secrets';\n-\n-export default function sentryRequestHandler() {\n-  return sentry.dsn === 'dsn_from_sentry_dashboard'\n-    ? (req, res, next) => next()\n-    : Handlers.requestHandler();\n-}"
        },
        {
            "sha": "bae04bd2f53aa7f180a95a35755e3019b0559f5f",
            "filename": "api-server/src/server/middlewares/sentry-tracing-handler.js",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsentry-tracing-handler.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsentry-tracing-handler.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsentry-tracing-handler.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,8 +0,0 @@\n-import { Handlers } from '@sentry/node';\n-import { sentry } from '../../../config/secrets';\n-\n-export default function sentryRequestHandler() {\n-  return sentry.dsn === 'dsn_from_sentry_dashboard'\n-    ? (req, res, next) => next()\n-    : Handlers.tracingHandler();\n-}"
        },
        {
            "sha": "219ed97724a5b8db5feac2e3f964a53c004678f0",
            "filename": "api-server/src/server/middlewares/sessions.js",
            "status": "removed",
            "additions": 0,
            "deletions": 20,
            "changes": 20,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsessions.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsessions.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsessions.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,20 +0,0 @@\n-import MongoStoreFactory from 'connect-mongo';\n-import session from 'express-session';\n-\n-const MongoStore = MongoStoreFactory(session);\n-const sessionSecret = process.env.SESSION_SECRET;\n-const url = process.env.MONGODB || process.env.MONGOHQ_URL;\n-\n-export default function sessionsMiddleware() {\n-  return session({\n-    // 900 day session cookie\n-    cookie: { maxAge: 900 * 24 * 60 * 60 * 1000 },\n-    // resave forces session to be resaved\n-    // regardless of whether it was modified\n-    // this causes race conditions during parallel req\n-    resave: false,\n-    saveUninitialized: true,\n-    secret: sessionSecret,\n-    store: new MongoStore({ url })\n-  });\n-}"
        },
        {
            "sha": "082c91f9d03abe6f8ea719d8ecb8351619d3ceb2",
            "filename": "api-server/src/server/middlewares/survey.js",
            "status": "removed",
            "additions": 0,
            "deletions": 42,
            "changes": 42,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsurvey.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsurvey.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fsurvey.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,42 +0,0 @@\n-import debugFactory from 'debug';\n-const log = debugFactory('fcc:boot:user');\n-\n-const allowedTitles = ['Foundational C# with Microsoft Survey'];\n-\n-export function validateSurvey(req, res, next) {\n-  const { title, responses } = req.body.surveyResults || {\n-    title: '',\n-    responses: []\n-  };\n-\n-  if (\n-    !allowedTitles.includes(title) ||\n-    !Array.isArray(responses) ||\n-    !responses.every(\n-      r => typeof r.question === 'string' && typeof r.response === 'string'\n-    )\n-  ) {\n-    return res.status(400).json({\n-      type: 'error',\n-      message: 'flash.survey.err-1'\n-    });\n-  }\n-\n-  next();\n-}\n-\n-export function createDeleteUserSurveys(app) {\n-  const { Survey } = app.models;\n-\n-  return async function deleteUserSurveys(req, res, next) {\n-    try {\n-      await Survey.destroyAll({ userId: req.user.id });\n-      req.userSurveysDeleted = true;\n-    } catch (e) {\n-      req.userSurveysDeleted = false;\n-      log(`An error occurred deleting Surveys for user with id ${req.user.id}`);\n-    }\n-\n-    next();\n-  };\n-}"
        },
        {
            "sha": "2ba32871662afc5e5968ef834b633146e17d97a2",
            "filename": "api-server/src/server/middlewares/user-token.js",
            "status": "removed",
            "additions": 0,
            "deletions": 31,
            "changes": 31,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fuser-token.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fuser-token.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmiddlewares%2Fuser-token.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,31 +0,0 @@\n-import debugFactory from 'debug';\n-const log = debugFactory('fcc:boot:user');\n-import jwt from 'jsonwebtoken';\n-import { jwtSecret } from '../../../config/secrets';\n-\n-/*\n- * User tokens for submitting external curriculum are deleted when they sign\n- * out, reset their account, or delete their account\n- */\n-\n-export function createDeleteUserToken(app) {\n-  const { UserToken } = app.models;\n-\n-  return async function deleteUserToken(req, res, next) {\n-    try {\n-      await UserToken.destroyAll({ userId: req.user.id });\n-      req.userTokenDeleted = true;\n-    } catch (e) {\n-      req.userTokenDeleted = false;\n-      log(\n-        `An error occurred deleting user token for user with id ${req.user.id}`\n-      );\n-    }\n-\n-    next();\n-  };\n-}\n-\n-export function encodeUserToken(userToken) {\n-  return jwt.sign({ userToken }, jwtSecret);\n-}"
        },
        {
            "sha": "788dcfcba41b75f76c397389ba1924376fbe78c2",
            "filename": "api-server/src/server/model-config.json",
            "status": "removed",
            "additions": 0,
            "deletions": 78,
            "changes": 78,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodel-config.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodel-config.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmodel-config.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,78 +0,0 @@\n-{\n-  \"_meta\": {\n-    \"sources\": [\n-      \"loopback/common/models\",\n-      \"loopback/server/models\",\n-      \"../common/models\",\n-      \"./models\"\n-    ]\n-  },\n-  \"AuthToken\": {\n-    \"dataSource\": \"db\",\n-    \"public\": false\n-  },\n-  \"AccessToken\": {\n-    \"dataSource\": \"db\",\n-    \"public\": false\n-  },\n-  \"ACL\": {\n-    \"dataSource\": \"db\",\n-    \"public\": false\n-  },\n-  \"block\": {\n-    \"dataSource\": \"db\",\n-    \"public\": true\n-  },\n-  \"challenge\": {\n-    \"dataSource\": \"db\",\n-    \"public\": true\n-  },\n-  \"Donation\": {\n-    \"dataSource\": \"db\",\n-    \"public\": false\n-  },\n-  \"Email\": {\n-    \"dataSource\": \"mail\",\n-    \"public\": false\n-  },\n-  \"Exam\": {\n-    \"dataSource\": \"db\",\n-    \"public\": false\n-  },\n-  \"Role\": {\n-    \"dataSource\": \"db\",\n-    \"public\": false\n-  },\n-  \"MsUsername\": {\n-    \"dataSource\": \"db\",\n-    \"public\": false\n-  },\n-  \"Survey\": {\n-    \"dataSource\": \"db\",\n-    \"public\": false\n-  },\n-  \"RoleMapping\": {\n-    \"dataSource\": \"db\",\n-    \"public\": false\n-  },\n-  \"userCredential\": {\n-    \"dataSource\": \"db\",\n-    \"public\": true\n-  },\n-  \"userIdentity\": {\n-    \"dataSource\": \"db\",\n-    \"public\": true\n-  },\n-  \"user\": {\n-    \"dataSource\": \"db\",\n-    \"public\": true\n-  },\n-  \"User\": {\n-    \"dataSource\": \"db\",\n-    \"public\": false\n-  },\n-  \"UserToken\": {\n-    \"dataSource\": \"db\",\n-    \"public\": false\n-  }\n-}"
        },
        {
            "sha": "8feb042662b8519fe43adbe9328eccfebb956b83",
            "filename": "api-server/src/server/models/auth-token.js",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fauth-token.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fauth-token.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmodels%2Fauth-token.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,15 +0,0 @@\n-import { Observable } from 'rx';\n-\n-export default function initializeAuthToken(AuthToken) {\n-  AuthToken.on('dataSourceAttached', () => {\n-    AuthToken.findOne$ = Observable.fromNodeCallback(\n-      AuthToken.findOne.bind(AuthToken)\n-    );\n-    AuthToken.prototype.validate$ = Observable.fromNodeCallback(\n-      AuthToken.prototype.validate\n-    );\n-    AuthToken.prototype.destroy$ = Observable.fromNodeCallback(\n-      AuthToken.prototype.destroy\n-    );\n-  });\n-}"
        },
        {
            "sha": "be263f39320354450169c75bb068b69851a6361f",
            "filename": "api-server/src/server/models/auth-token.json",
            "status": "removed",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fauth-token.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fauth-token.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmodels%2Fauth-token.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,13 +0,0 @@\n-{\n-  \"name\": \"AuthToken\",\n-  \"base\": \"AccessToken\",\n-  \"idInjection\": true,\n-  \"options\": {\n-    \"validateUpsert\": true\n-  },\n-  \"properties\": {},\n-  \"validations\": [],\n-  \"relations\": {},\n-  \"acls\": [],\n-  \"methods\": {}\n-}"
        },
        {
            "sha": "6282c9a8772055e4e0e35ef7aff4e982b58a6d89",
            "filename": "api-server/src/server/models/donation.js",
            "status": "removed",
            "additions": 0,
            "deletions": 71,
            "changes": 71,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fdonation.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fdonation.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmodels%2Fdonation.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,71 +0,0 @@\n-import debug from 'debug';\n-import { Observable } from 'rx';\n-\n-import { reportError } from '../middlewares/sentry-error-handler.js';\n-import InMemoryCache from '../utils/in-memory-cache';\n-\n-const log = debug('fcc:boot:donate');\n-const fiveMinutes = 1000 * 60 * 5;\n-\n-export default function initializeDonation(Donation) {\n-  let activeDonationUpdateInterval = null;\n-  const activeDonationCountCacheTTL = fiveMinutes;\n-  const activeDonationCountCache = InMemoryCache(0, reportError);\n-  const activeDonationsQuery$ = () =>\n-    Donation.find$({\n-      // eslint-disable-next-line no-undefined\n-      where: { endDate: undefined }\n-    }).map(instances => instances.length);\n-  function cleanUp() {\n-    if (activeDonationUpdateInterval) {\n-      clearInterval(activeDonationUpdateInterval);\n-    }\n-    return;\n-  }\n-\n-  process.on('exit', cleanUp);\n-\n-  Donation.on('dataSourceAttached', () => {\n-    Donation.find$ = Observable.fromNodeCallback(Donation.find.bind(Donation));\n-    Donation.findOne$ = Observable.fromNodeCallback(\n-      Donation.findOne.bind(Donation)\n-    );\n-\n-    seedTheCache()\n-      .then(setupCacheUpdateInterval)\n-      .catch(err => {\n-        const errMsg = `Error caught seeding the cache: ${err.message}`;\n-        err.message = errMsg;\n-        reportError(err);\n-      });\n-  });\n-\n-  function seedTheCache() {\n-    return new Promise((resolve, reject) =>\n-      Observable.defer(activeDonationsQuery$).subscribe(count => {\n-        log('activeDonor count: %d', count);\n-        activeDonationCountCache.update(() => count);\n-        return resolve();\n-      }, reject)\n-    );\n-  }\n-\n-  function setupCacheUpdateInterval() {\n-    activeDonationUpdateInterval = setInterval(\n-      () =>\n-        Observable.defer(activeDonationsQuery$).subscribe(\n-          count => {\n-            log('activeDonor count: %d', count);\n-            return activeDonationCountCache.update(() => count);\n-          },\n-          err => {\n-            const errMsg = `Error caught updating the cache: ${err.message}`;\n-            err.message = errMsg;\n-            reportError(err);\n-          }\n-        ),\n-      activeDonationCountCacheTTL\n-    );\n-    return null;\n-  }\n-}"
        },
        {
            "sha": "c1280e8db3460be7e7f48afffae1106ab8b60cf3",
            "filename": "api-server/src/server/models/donation.json",
            "status": "removed",
            "additions": 0,
            "deletions": 71,
            "changes": 71,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fdonation.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fdonation.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmodels%2Fdonation.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,71 +0,0 @@\n-{\n-  \"name\": \"Donation\",\n-  \"description\": \"A representation of a donation to freeCodeCamp\",\n-  \"plural\": \"donations\",\n-  \"base\": \"PersistedModel\",\n-  \"idInjection\": true,\n-  \"scopes\": {},\n-  \"indexes\": {},\n-  \"options\": {\n-    \"validateUpsert\": true\n-  },\n-  \"hidden\": [],\n-  \"remoting\": {},\n-  \"http\": {},\n-  \"properties\": {\n-    \"email\": {\n-      \"type\": \"string\",\n-      \"required\": true,\n-      \"description\": \"The email used to create the donation\"\n-    },\n-    \"provider\": {\n-      \"type\": \"string\",\n-      \"required\": true,\n-      \"description\": \"The payment handler, paypal/stripe etc...\"\n-    },\n-    \"amount\": {\n-      \"type\": \"number\",\n-      \"required\": true,\n-      \"description\": \"The donation amount in cents\"\n-    },\n-    \"duration\": {\n-      \"type\": \"string\"\n-    },\n-    \"startDate\": {\n-      \"type\": \"DateString\",\n-      \"required\": true\n-    },\n-    \"endDate\": {\n-      \"type\": \"DateString\"\n-    },\n-    \"subscriptionId\": {\n-      \"type\": \"string\",\n-      \"required\": true,\n-      \"description\": \"The donation subscription id returned from the provider\"\n-    },\n-    \"customerId\": {\n-      \"type\": \"string\",\n-      \"required\": true,\n-      \"description\": \"The providers reference for the donor\"\n-    }\n-  },\n-  \"validations\": [\n-    {\n-      \"amount\": {\n-        \"type\": \"number\",\n-        \"description\": \"Amount should be >= $1 (100c)\",\n-        \"min\": 100\n-      },\n-      \"facetName\": \"server\"\n-    }\n-  ],\n-  \"relations\": {\n-    \"user\": {\n-      \"type\": \"belongsTo\",\n-      \"model\": \"user\",\n-      \"foreignKey\": \"userId\"\n-    }\n-  },\n-  \"acls\": [],\n-  \"methods\": {}\n-}"
        },
        {
            "sha": "cb0792e168b17f7652391b50ab649261dc29bb0b",
            "filename": "api-server/src/server/models/exam.json",
            "status": "removed",
            "additions": 0,
            "deletions": 70,
            "changes": 70,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fexam.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fexam.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmodels%2Fexam.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,70 +0,0 @@\n-{\n-  \"name\": \"Exam\",\n-  \"description\": \"Exam questions for exam style challenges\",\n-  \"base\": \"PersistedModel\",\n-  \"idInjection\": true,\n-  \"options\": {\n-    \"strict\": true\n-  },\n-  \"properties\": {\n-    \"numberOfQuestionsInExam\": {\n-      \"type\": \"number\",\n-      \"required\": true\n-    },\n-    \"passingPercent\": {\n-      \"type\": \"number\",\n-      \"required\": true\n-    },\n-    \"prerequisites\": {\n-      \"type\": [\n-        {\n-          \"id\": \"string\",\n-          \"title\": \"string\"\n-        }\n-      ]\n-    },\n-    \"questions\": {\n-      \"type\": [\n-        {\n-          \"id\": \"string\",\n-          \"question\": \"string\",\n-          \"wrongAnswers\": {\n-            \"type\": [\n-              {\n-                \"id\": \"string\",\n-                \"answer\": \"string\"\n-              }\n-            ],\n-            \"required\": true\n-          },\n-          \"correctAnswers\": {\n-            \"type\": [\n-              {\n-                \"id\": \"string\",\n-                \"answer\": \"string\"\n-              }\n-            ],\n-            \"required\": true\n-          }\n-        }\n-      ],\n-      \"required\": true,\n-      \"itemType\": \"Question\"\n-    },\n-    \"title\": {\n-      \"type\": \"string\",\n-      \"required\": true\n-    }\n-  },\n-  \"validations\": [],\n-  \"relations\": {},\n-  \"acls\": [\n-    {\n-      \"accessType\": \"*\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"DENY\"\n-    }\n-  ],\n-  \"methods\": {}\n-}"
        },
        {
            "sha": "4c3cc583a707d0a3f9912270e2bc0dfc007a85eb",
            "filename": "api-server/src/server/models/ms-username.json",
            "status": "removed",
            "additions": 0,
            "deletions": 20,
            "changes": 20,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fms-username.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fms-username.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmodels%2Fms-username.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,20 +0,0 @@\n-{\n-  \"name\": \"MsUsername\",\n-  \"description\": \"Microsoft account usernames\",\n-  \"base\": \"PersistedModel\",\n-  \"idInjection\": true,\n-  \"options\": {\n-    \"validateUpsert\": true\n-  },\n-  \"properties\": {},\n-  \"validations\": [],\n-  \"relations\": {\n-    \"user\": {\n-      \"type\": \"belongsTo\",\n-      \"model\": \"user\",\n-      \"foreignKey\": \"userId\"\n-    }\n-  },\n-  \"acls\": [],\n-  \"methods\": {}\n-}"
        },
        {
            "sha": "ff3f98338622bbe6eefc3e77cab7d4aeee2cad2b",
            "filename": "api-server/src/server/models/survey.json",
            "status": "removed",
            "additions": 0,
            "deletions": 41,
            "changes": 41,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fsurvey.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fsurvey.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmodels%2Fsurvey.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,41 +0,0 @@\n-{\n-  \"name\": \"Survey\",\n-  \"description\": \"Survey responses from campers\",\n-  \"base\": \"PersistedModel\",\n-  \"idInjection\": true,\n-  \"options\": {\n-    \"strict\": true\n-  },\n-  \"properties\": {\n-    \"title\": {\n-      \"type\": \"string\",\n-      \"required\": true\n-    },\n-    \"responses\": {\n-      \"type\": [\n-        {\n-          \"question\": \"string\",\n-          \"response\": \"string\"\n-        }\n-      ],\n-      \"required\": true\n-    }\n-  },\n-  \"validations\": [],\n-  \"relations\": {\n-    \"user\": {\n-      \"type\": \"belongsTo\",\n-      \"model\": \"user\",\n-      \"foreignKey\": \"userId\"\n-    }\n-  },\n-  \"acls\": [\n-    {\n-      \"accessType\": \"*\",\n-      \"principalType\": \"ROLE\",\n-      \"principalId\": \"$everyone\",\n-      \"permission\": \"DENY\"\n-    }\n-  ],\n-  \"methods\": {}\n-}"
        },
        {
            "sha": "8fcf782505a0e1198d846969a33dc43377c64755",
            "filename": "api-server/src/server/models/user-token.json",
            "status": "removed",
            "additions": 0,
            "deletions": 20,
            "changes": 20,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fuser-token.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fmodels%2Fuser-token.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fmodels%2Fuser-token.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,20 +0,0 @@\n-{\n-  \"name\": \"UserToken\",\n-  \"description\": \"Tokens for submitting curricula through CodeRoad\",\n-  \"base\": \"AccessToken\",\n-  \"idInjection\": true,\n-  \"options\": {\n-    \"validateUpsert\": true\n-  },\n-  \"properties\": {},\n-  \"validations\": [],\n-  \"relations\": {\n-    \"user\": {\n-      \"type\": \"belongsTo\",\n-      \"model\": \"user\",\n-      \"foreignKey\": \"userId\"\n-    }\n-  },\n-  \"acls\": [],\n-  \"methods\": {}\n-}"
        },
        {
            "sha": "dc82d4b20698f47449045fe30acded00a84ebcc6",
            "filename": "api-server/src/server/passport-providers.js",
            "status": "removed",
            "additions": 0,
            "deletions": 48,
            "changes": 48,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fpassport-providers.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fpassport-providers.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fpassport-providers.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,48 +0,0 @@\n-import { auth0 } from '../../config/secrets';\n-\n-const { clientID, clientSecret, domain } = auth0;\n-\n-// These don't seem to be used, can they go?\n-const successRedirect = `${process.env.HOME_LOCATION}/learn`;\n-const failureRedirect = `${process.env.HOME_LOCATION}/signin`;\n-\n-// TODO: can we remove passport-mock-strategy entirely in prod? That would let\n-// us make passport-mock-strategy a dev dep, as it should be.\n-const passportProviders = {\n-  devlogin: {\n-    authScheme: 'mock',\n-    provider: 'dev',\n-    module: 'passport-mock-strategy'\n-  },\n-  local: {\n-    provider: 'local',\n-    module: 'passport-local',\n-    usernameField: 'email',\n-    passwordField: 'password',\n-    authPath: '/auth/local',\n-    successRedirect: successRedirect,\n-    failureRedirect: failureRedirect,\n-    session: true,\n-    failureFlash: true\n-  },\n-  'auth0-login': {\n-    provider: 'auth0',\n-    module: 'passport-auth0',\n-    clientID,\n-    clientSecret,\n-    domain,\n-    cookieDomain: process.env.COOKIE_DOMAIN || 'localhost',\n-    callbackURL: `${process.env.API_LOCATION}/auth/auth0/callback`,\n-    authPath: '/auth/auth0',\n-    callbackPath: '/auth/auth0/callback',\n-    useCustomCallback: true,\n-    passReqToCallback: true,\n-    state: false,\n-    successRedirect: successRedirect,\n-    failureRedirect: failureRedirect,\n-    scope: ['openid profile email'],\n-    failureFlash: true\n-  }\n-};\n-\n-export default passportProviders;"
        },
        {
            "sha": "c6f59b74feac823e0553457ea4dc35f9a022924c",
            "filename": "api-server/src/server/rss/index.js",
            "status": "removed",
            "additions": 0,
            "deletions": 78,
            "changes": 78,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Frss%2Findex.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Frss%2Findex.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Frss%2Findex.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,78 +0,0 @@\n-import compareDesc from 'date-fns/compare_desc';\n-import debug from 'debug';\n-import _ from 'lodash';\n-\n-import { getLybsynFeed } from './lybsyn';\n-\n-const log = debug('fcc:rss:news-feed');\n-\n-const fiveMinutes = 1000 * 60 * 5;\n-\n-class NewsFeed {\n-  constructor() {\n-    this.state = {\n-      readyState: false,\n-      lybsynFeed: [],\n-      combinedFeed: []\n-    };\n-    this.refreshFeeds();\n-\n-    setInterval(this.refreshFeeds, fiveMinutes);\n-  }\n-\n-  setState = stateUpdater => {\n-    const newState = stateUpdater(this.state);\n-    this.state = _.merge({}, this.state, newState);\n-    return;\n-  };\n-\n-  refreshFeeds = () => {\n-    const currentFeed = this.state.combinedFeed.slice(0);\n-    log('grabbing feeds');\n-    return Promise.all([getLybsynFeed()])\n-      .then(([lybsynFeed]) =>\n-        this.setState(state => ({\n-          ...state,\n-          lybsynFeed\n-        }))\n-      )\n-      .then(() => {\n-        log('crossing the streams');\n-        const { lybsynFeed } = this.state;\n-        const combinedFeed = [...lybsynFeed].sort((a, b) => {\n-          return compareDesc(a.isoDate, b.isoDate);\n-        });\n-        this.setState(state => ({\n-          ...state,\n-          combinedFeed,\n-          readyState: true\n-        }));\n-      })\n-      .catch(err => {\n-        console.log(err);\n-        this.setState(state => ({\n-          ...state,\n-          combinedFeed: currentFeed\n-        }));\n-      });\n-  };\n-\n-  getFeed = () =>\n-    new Promise(resolve => {\n-      let notReadyCount = 0;\n-\n-      function waitForReady() {\n-        log('notReadyCount', notReadyCount);\n-        notReadyCount++;\n-        return this.state.readyState || notReadyCount === 5\n-          ? resolve(this.state.combinedFeed)\n-          : setTimeout(waitForReady, 100);\n-      }\n-      log('are we ready?', this.state.readyState);\n-      return this.state.readyState\n-        ? resolve(this.state.combinedFeed)\n-        : setTimeout(waitForReady, 100);\n-    });\n-}\n-\n-export default NewsFeed;"
        },
        {
            "sha": "a94e92ae57e9e7f57512ca2efb6709c05746aa68",
            "filename": "api-server/src/server/rss/lybsyn.js",
            "status": "removed",
            "additions": 0,
            "deletions": 48,
            "changes": 48,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Frss%2Flybsyn.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Frss%2Flybsyn.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Frss%2Flybsyn.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,48 +0,0 @@\n-import http from 'http';\n-import _ from 'lodash';\n-\n-const lybsynFeed = 'http://freecodecamp.libsyn.com/render-type/json';\n-\n-export function getLybsynFeed() {\n-  return new Promise((resolve, reject) => {\n-    http.get(lybsynFeed, res => {\n-      let raw = '';\n-\n-      res.on('data', chunk => {\n-        raw += chunk;\n-      });\n-\n-      res.on('error', err => reject(err));\n-\n-      res.on('end', () => {\n-        let feed = [];\n-\n-        try {\n-          feed = JSON.parse(raw);\n-        } catch (err) {\n-          return reject(err);\n-        }\n-        const items = feed\n-          .map(item =>\n-            _.pick(item, [\n-              'full_item_url',\n-              'item_title',\n-              'release_date',\n-              'item_body_short'\n-            ])\n-          )\n-          /* eslint-disable camelcase */\n-          .map(\n-            ({ full_item_url, item_title, release_date, item_body_short }) => ({\n-              title: item_title,\n-              extract: item_body_short,\n-              isoDate: new Date(release_date).toISOString(),\n-              link: full_item_url\n-            })\n-          );\n-        /* eslint-enable camelcase */\n-        return resolve(items);\n-      });\n-    });\n-  });\n-}"
        },
        {
            "sha": "13c524a6a44fb945090a1fd73a64e1496e4a14da",
            "filename": "api-server/src/server/utils/__mocks__/exam.js",
            "status": "removed",
            "additions": 0,
            "deletions": 91,
            "changes": 91,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2F__mocks__%2Fexam.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2F__mocks__%2Fexam.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2F__mocks__%2Fexam.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,91 +0,0 @@\n-export const examJson = {\n-  id: 1,\n-  numberOfQuestionsInExam: 1,\n-  passingPercent: 70,\n-  questions: [\n-    {\n-      id: '3bbl2mx2mq',\n-      question: 'Question 1?',\n-      wrongAnswers: [\n-        { id: 'ex7hii9zup', answer: 'Q1: Wrong Answer 1' },\n-        { id: 'lmr1ew7m67', answer: 'Q1: Wrong Answer 2' },\n-        { id: 'qh5sz9qdiq', answer: 'Q1: Wrong Answer 3' },\n-        { id: 'g489kbwn6a', answer: 'Q1: Wrong Answer 4' },\n-        { id: '7vu84wl4lc', answer: 'Q1: Wrong Answer 5' },\n-        { id: 'em59kw6avu', answer: 'Q1: Wrong Answer 6' }\n-      ],\n-      correctAnswers: [\n-        { id: 'dzlokqdc73', answer: 'Q1: Correct Answer 1' },\n-        { id: 'f5gk39ske9', answer: 'Q1: Correct Answer 2' }\n-      ]\n-    },\n-    {\n-      id: 'oqis5gzs0h',\n-      question: 'Question 2?',\n-      wrongAnswers: [\n-        { id: 'ojhnoxh5r5', answer: 'Q2: Wrong Answer 1' },\n-        { id: 'onx06if0uh', answer: 'Q2: Wrong Answer 2' },\n-        { id: 'zbxnsko712', answer: 'Q2: Wrong Answer 3' },\n-        { id: 'bqv5y68jyp', answer: 'Q2: Wrong Answer 4' },\n-        { id: 'i5xipitiss', answer: 'Q2: Wrong Answer 5' },\n-        { id: 'wycrnloajd', answer: 'Q2: Wrong Answer 6' }\n-      ],\n-      correctAnswers: [\n-        { id: 't9ezcsupdl', answer: 'Q1: Correct Answer 1' },\n-        { id: 'agert35dk0', answer: 'Q1: Correct Answer 2' }\n-      ]\n-    }\n-  ]\n-};\n-\n-// failed\n-export const userExam1 = {\n-  userExamQuestions: [\n-    {\n-      id: '3bbl2mx2mq',\n-      question: 'Question 1?',\n-      answer: { id: 'dzlokqdc73', answer: 'Q1: Correct Answer 1' }\n-    },\n-    {\n-      id: 'oqis5gzs0h',\n-      question: 'Question 2?',\n-      answer: { id: 'i5xipitiss', answer: 'Q2: Wrong Answer 5' }\n-    }\n-  ],\n-  examTimeInSeconds: 20\n-};\n-\n-// passed\n-export const userExam2 = {\n-  userExamQuestions: [\n-    {\n-      id: '3bbl2mx2mq',\n-      question: 'Question 1?',\n-      answer: { id: 'dzlokqdc73', answer: 'Q1: Correct Answer 1' }\n-    },\n-    {\n-      id: 'oqis5gzs0h',\n-      question: 'Question 2?',\n-      answer: { id: 't9ezcsupdl', answer: 'Q1: Correct Answer 1' }\n-    }\n-  ],\n-  examTimeInSeconds: 20\n-};\n-\n-export const mockResults1 = {\n-  numberOfCorrectAnswers: 1,\n-  numberOfQuestionsInExam: 2,\n-  percentCorrect: 50,\n-  passingPercent: 70,\n-  passed: false,\n-  examTimeInSeconds: 20\n-};\n-\n-export const mockResults2 = {\n-  numberOfCorrectAnswers: 2,\n-  numberOfQuestionsInExam: 2,\n-  percentCorrect: 100,\n-  passingPercent: 70,\n-  passed: true,\n-  examTimeInSeconds: 20\n-};"
        },
        {
            "sha": "dd6d9aad0ee410617c508f6de95f7c084aad6cfc",
            "filename": "api-server/src/server/utils/auth.js",
            "status": "removed",
            "additions": 0,
            "deletions": 50,
            "changes": 50,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fauth.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fauth.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fauth.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,50 +0,0 @@\n-const githubRegex = /github/i;\n-const providerHash = {\n-  facebook: ({ id }) => id,\n-  github: ({ username }) => username,\n-  twitter: ({ username }) => username,\n-  linkedin({ _json }) {\n-    return (_json && _json.publicProfileUrl) || null;\n-  },\n-  google: ({ id }) => id\n-};\n-\n-export function getUsernameFromProvider(provider, profile) {\n-  return typeof providerHash[provider] === 'function'\n-    ? providerHash[provider](profile)\n-    : null;\n-}\n-\n-// createProfileAttributes(provider: String, profile: {}) => Object\n-export function createUserUpdatesFromProfile(provider, profile) {\n-  if (githubRegex.test(provider)) {\n-    return createProfileAttributesFromGithub(profile);\n-  }\n-  return {\n-    [getSocialProvider(provider)]: getUsernameFromProvider(\n-      getSocialProvider(provider),\n-      profile\n-    )\n-  };\n-}\n-// createProfileAttributes(profile) => profileUpdate\n-function createProfileAttributesFromGithub(profile) {\n-  const {\n-    profileUrl: githubProfile,\n-    username,\n-    _json: { avatar_url: picture, blog: website, location, bio, name } = {}\n-  } = profile;\n-  return {\n-    name,\n-    username: username.toLowerCase(),\n-    location,\n-    bio,\n-    website,\n-    picture,\n-    githubProfile\n-  };\n-}\n-\n-export function getSocialProvider(provider) {\n-  return provider.split('-')[0];\n-}"
        },
        {
            "sha": "46e0e6063b6ad4886183827c22ca45fe8576c654",
            "filename": "api-server/src/server/utils/cast-to-observable.js",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fcast-to-observable.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fcast-to-observable.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fcast-to-observable.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,11 +0,0 @@\n-import { Observable, helpers } from 'rx';\n-\n-export default function castToObservable(maybe) {\n-  if (Observable.isObservable(maybe)) {\n-    return maybe;\n-  }\n-  if (helpers.isPromise(maybe)) {\n-    return Observable.fromPromise(maybe);\n-  }\n-  return Observable.of(maybe);\n-}"
        },
        {
            "sha": "38bcd9aa84ce3e3cea7034034f088840f1894000",
            "filename": "api-server/src/server/utils/certTypes.json",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2FcertTypes.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2FcertTypes.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2FcertTypes.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,21 +0,0 @@\n-{\n-  \"frontEnd\": \"isFrontEndCert\",\n-  \"backEnd\": \"isBackEndCert\",\n-  \"dataVis\": \"isDataVisCert\",\n-  \"respWebDesign\": \"isRespWebDesignCert\",\n-  \"frontEndLibs\": \"isFrontEndLibsCert\",\n-  \"dataVis2018\": \"is2018DataVisCert\",\n-  \"jsAlgoDataStruct\": \"isJsAlgoDataStructCert\",\n-  \"apisMicroservices\": \"isApisMicroservicesCert\",\n-  \"infosecQa\": \"isInfosecQaCert\",\n-  \"qaV7\": \"isQaCertV7\",\n-  \"infosecV7\": \"isInfosecCertV7\",\n-  \"sciCompPyV7\": \"isSciCompPyCertV7\",\n-  \"dataAnalysisPyV7\": \"isDataAnalysisPyCertV7\",\n-  \"machineLearningPyV7\": \"isMachineLearningPyCertV7\",\n-  \"fullStack\": \"isFullStackCert\",\n-  \"relationalDatabaseV8\": \"isRelationalDatabaseV8\",\n-  \"collegeAlgebraPyV8\": \"isCollegeAlgebraPyCertV8\",\n-  \"foundationalCSharpV8\": \"isFoundationalCSharpCertV8\",\n-  \"isJsAlgoDataStructCertV8\": \"isJsAlgoDataStructCertV8\"\n-}"
        },
        {
            "sha": "fbb12e7d5fa2583740bb33e4055efda5f79dfe6c",
            "filename": "api-server/src/server/utils/cookieConfig.js",
            "status": "removed",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2FcookieConfig.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2FcookieConfig.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2FcookieConfig.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,6 +0,0 @@\n-export function createCookieConfig(req) {\n-  return {\n-    signed: !!req.signedCookies,\n-    domain: process.env.COOKIE_DOMAIN || 'localhost'\n-  };\n-}"
        },
        {
            "sha": "6b10d2a0ef641363310551cbf8711675089159bc",
            "filename": "api-server/src/server/utils/create-handled-error.js",
            "status": "removed",
            "additions": 0,
            "deletions": 29,
            "changes": 29,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fcreate-handled-error.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fcreate-handled-error.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fcreate-handled-error.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,29 +0,0 @@\n-const _handledError = Symbol('handledError');\n-\n-export function isHandledError(err) {\n-  return !!err[_handledError];\n-}\n-\n-export function unwrapHandledError(err) {\n-  return err[_handledError] || {};\n-}\n-\n-export function wrapHandledError(\n-  err,\n-  { type, message, redirectTo, status = 200 }\n-) {\n-  err[_handledError] = { type, message, redirectTo, status };\n-  return err;\n-}\n-\n-// for use with express-validator error formatter\n-export const createValidatorErrorFormatter =\n-  (type, redirectTo) =>\n-  ({ msg }) =>\n-    wrapHandledError(new Error(msg), {\n-      type,\n-      message: msg,\n-      redirectTo,\n-      // we default to 400 as these are malformed requests\n-      status: 400\n-    });"
        },
        {
            "sha": "f9e1187610814cdaac55137fcd06b156d234b76b",
            "filename": "api-server/src/server/utils/date-utils.js",
            "status": "removed",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fdate-utils.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fdate-utils.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fdate-utils.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,12 +0,0 @@\n-import moment from 'moment-timezone';\n-\n-// day count between two epochs (inclusive)\n-export function dayCount([head, tail], timezone = 'UTC') {\n-  return Math.ceil(\n-    moment(moment(head).tz(timezone).endOf('day')).diff(\n-      moment(tail).tz(timezone).startOf('day'),\n-      'days',\n-      true\n-    )\n-  );\n-}"
        },
        {
            "sha": "62b83d00b1b081c6d5e165db99981b29fcc0f26e",
            "filename": "api-server/src/server/utils/date-utils.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 87,
            "changes": 87,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fdate-utils.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fdate-utils.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fdate-utils.test.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,87 +0,0 @@\n-import moment from 'moment-timezone';\n-\n-import { dayCount } from './date-utils';\n-\n-const PST = 'America/Los_Angeles';\n-\n-describe('date utils', () => {\n-  describe('dayCount', () => {\n-    it('should return 1 day given epochs of the same day', () => {\n-      expect(\n-        dayCount([\n-          moment.utc('8/3/2015 3:00', 'M/D/YYYY H:mm').valueOf(),\n-          moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf()\n-        ])\n-      ).toEqual(1);\n-    });\n-\n-    it('should return 1 day given same epochs', () => {\n-      expect(\n-        dayCount([\n-          moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-          moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf()\n-        ])\n-      ).toEqual(1);\n-    });\n-\n-    it('should return 2 days when there is a 24 hours difference', () => {\n-      expect(\n-        dayCount([\n-          moment.utc('8/4/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-          moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf()\n-        ])\n-      ).toEqual(2);\n-    });\n-\n-    it(\n-      'should return 2 days when the diff is less than 24h but ' +\n-        'different in UTC',\n-      () => {\n-        expect(\n-          dayCount([\n-            moment.utc('8/4/2015 1:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('8/3/2015 23:00', 'M/D/YYYY H:mm').valueOf()\n-          ])\n-        ).toEqual(2);\n-      }\n-    );\n-\n-    it(\n-      'should return 1 day when the diff is less than 24h ' +\n-        'and days are different in UTC, but given PST',\n-      () => {\n-        expect(\n-          dayCount(\n-            [\n-              moment.utc('8/4/2015 1:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('8/3/2015 23:00', 'M/D/YYYY H:mm').valueOf()\n-            ],\n-            PST\n-          )\n-        ).toEqual(1);\n-      }\n-    );\n-\n-    it('should return correct count when there is very big period', () => {\n-      expect(\n-        dayCount([\n-          moment.utc('10/27/2015 1:00', 'M/D/YYYY H:mm').valueOf(),\n-          moment.utc('5/12/1982 1:00', 'M/D/YYYY H:mm').valueOf()\n-        ])\n-      ).toEqual(12222);\n-    });\n-\n-    it(\n-      'should return 2 days when there is a 24 hours difference ' +\n-        'between dates given `undefined` timezone',\n-      () => {\n-        expect(\n-          dayCount([\n-            moment.utc('8/4/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf()\n-          ])\n-        ).toEqual(2);\n-      }\n-    );\n-  });\n-});"
        },
        {
            "sha": "c63f10cb20d03ba4221dfdd2fa756133dc946fbe",
            "filename": "api-server/src/server/utils/disabled-endpoints.js",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fdisabled-endpoints.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fdisabled-endpoints.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fdisabled-endpoints.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,17 +0,0 @@\n-export function deprecatedEndpoint(_, res) {\n-  return res.status(410).json({\n-    message: {\n-      type: 'info',\n-      message: 'Please reload the app, this feature is no longer available.'\n-    }\n-  });\n-}\n-\n-export function temporarilyDisabledEndpoint(_, res) {\n-  return res.status(404).json({\n-    message: {\n-      type: 'info',\n-      message: 'Please reload the app, this feature is no longer available.'\n-    }\n-  });\n-}"
        },
        {
            "sha": "a8d9208ffe1691db3ec7e712b4bd91afdf67187f",
            "filename": "api-server/src/server/utils/donation.js",
            "status": "removed",
            "additions": 0,
            "deletions": 181,
            "changes": 181,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fdonation.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fdonation.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fdonation.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,181 +0,0 @@\n-/* eslint-disable camelcase */\n-import debug from 'debug';\n-import { donationSubscriptionConfig } from '../../../../shared/config/donation-settings';\n-\n-const log = debug('fcc:boot:donate');\n-\n-export function capitalizeKeys(object) {\n-  Object.keys(object).forEach(function (key) {\n-    object[key.toUpperCase()] = object[key];\n-  });\n-}\n-\n-export const createAsyncUserDonation = (user, donation) => {\n-  log(`Creating donation:${donation.subscriptionId}`);\n-  // log user donation\n-  user\n-    .createDonation(donation)\n-    .toPromise()\n-    .catch(err => {\n-      throw new Error(err);\n-    });\n-};\n-\n-export async function createStripeCardDonation(req, res, stripe) {\n-  const {\n-    body: { paymentMethodId, amount, duration },\n-    user: { name, id: userId, email },\n-    user\n-  } = req;\n-\n-  if (!paymentMethodId || !amount || !duration || !userId || !email) {\n-    throw {\n-      message: 'Request is not valid',\n-      type: 'InvalidRequest'\n-    };\n-  }\n-\n-  /*\n-   * if user is already donating and the donation isn't one time only,\n-   * throw error\n-   */\n-\n-  if (user.isDonating && duration !== 'one-time') {\n-    throw {\n-      message: `User already has active recurring donation(s).`,\n-      type: 'AlreadyDonatingError'\n-    };\n-  }\n-\n-  /*\n-   * card donations is blocked for new users\n-   */\n-\n-  const threeChallengesCompleted = user.completedChallenges.length >= 3;\n-  if (!threeChallengesCompleted) {\n-    throw {\n-      message: `Donate using another method`,\n-      type: 'MethodRestrictionError'\n-    };\n-  }\n-\n-  let customerId;\n-  try {\n-    const customer = await stripe.customers.create({\n-      email,\n-      payment_method: paymentMethodId,\n-      invoice_settings: { default_payment_method: paymentMethodId },\n-      ...(name && { name })\n-    });\n-    customerId = customer?.id;\n-  } catch {\n-    throw {\n-      type: 'customerCreationFailed',\n-      message: 'Failed to create stripe customer'\n-    };\n-  }\n-  log(`Stripe customer with id ${customerId} created`);\n-\n-  let subscriptionId;\n-  try {\n-    const {\n-      id: subscription_id,\n-      latest_invoice: {\n-        payment_intent: { client_secret, status: intent_status }\n-      }\n-    } = await stripe.subscriptions.create({\n-      // create Stripe subscription\n-      customer: customerId,\n-      payment_behavior: 'allow_incomplete',\n-      items: [\n-        {\n-          plan: `${donationSubscriptionConfig.duration[\n-            duration\n-          ].toLowerCase()}-donation-${amount}`\n-        }\n-      ],\n-      expand: ['latest_invoice.payment_intent']\n-    });\n-\n-    if (intent_status === 'requires_source_action')\n-      throw {\n-        type: 'UserActionRequired',\n-        message: 'Payment requires user action',\n-        client_secret\n-      };\n-    else if (intent_status === 'requires_source')\n-      throw {\n-        type: 'PaymentMethodRequired',\n-        message: 'Card has been declined'\n-      };\n-    subscriptionId = subscription_id;\n-  } catch (err) {\n-    if (\n-      err.type === 'UserActionRequired' ||\n-      err.type === 'PaymentMethodRequired'\n-    )\n-      throw err;\n-    else\n-      throw {\n-        type: 'SubscriptionCreationFailed',\n-        message: 'Failed to create stripe subscription'\n-      };\n-  }\n-  log(`Stripe subscription with id ${subscriptionId} created`);\n-\n-  // save Donation\n-  let donation = {\n-    email,\n-    amount,\n-    duration,\n-    provider: 'stripe',\n-    subscriptionId,\n-    customerId,\n-    startDate: new Date().toISOString()\n-  };\n-  await createAsyncUserDonation(user, donation);\n-  return res.status(200).json({ isDonating: true });\n-}\n-\n-export async function handleStripeCardUpdateSession(req, app, stripe) {\n-  const {\n-    user: { id }\n-  } = req;\n-\n-  const { Donation } = app.models;\n-  log('Updating stripe card for user: ', id);\n-\n-  // multiple donations support should be added\n-  const donation = await Donation.findOne({\n-    where: { userId: id, provider: 'stripe' }\n-  });\n-\n-  if (!donation) throw Error('Stripe donation record not found');\n-\n-  const { customerId, subscriptionId } = donation;\n-\n-  log(subscriptionId);\n-\n-  // Create a Stripe checkout session\n-  // updating customer payment method is handled by webhook handler\n-  const session = await stripe.checkout.sessions.create({\n-    payment_method_types: ['card'],\n-    mode: 'setup',\n-    customer: customerId,\n-    setup_intent_data: {\n-      metadata: {\n-        customer_id: customerId,\n-        subscription_id: subscriptionId\n-      }\n-    },\n-    success_url: `${process.env.HOME_LOCATION}/update-stripe-card?session_id={CHECKOUT_SESSION_ID}`,\n-    cancel_url: `${process.env.HOME_LOCATION}/update-stripe-card`\n-  });\n-  return { sessionId: session.id };\n-}\n-\n-export function inLastFiveMinutes(unixTimestamp) {\n-  const currentTimestamp = Math.floor(Date.now() / 1000);\n-  const timeDifference = currentTimestamp - unixTimestamp;\n-  return timeDifference <= 300; // 300 seconds is 5 minutes\n-}"
        },
        {
            "sha": "174299aa1663eff052f5f3f1a5cdb29b8f3971f7",
            "filename": "api-server/src/server/utils/donation.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 59,
            "changes": 59,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fdonation.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fdonation.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fdonation.test.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,59 +0,0 @@\n-/* eslint-disable camelcase */\n-import stripe from 'stripe';\n-import { ObjectId } from 'mongodb';\n-import { handleStripeCardUpdateSession } from './donation';\n-\n-jest.mock('stripe', () => ({\n-  checkout: {\n-    sessions: {\n-      create: jest.fn()\n-    }\n-  }\n-}));\n-\n-describe('donation', () => {\n-  describe('handleStripeCardUpdateSession', () => {\n-    const mockUserId = ObjectId('507f1f77bcf86cd799439011');\n-    const mockDonation = {\n-      customerId: 'customer_123',\n-      subscriptionId: 'sub_123'\n-    };\n-    const req = { user: { id: mockUserId } };\n-    const app = {\n-      models: {\n-        Donation: { findOne: jest.fn().mockResolvedValue(mockDonation) }\n-      }\n-    };\n-\n-    stripe.checkout.sessions.create.mockResolvedValue({ id: 'session_123' });\n-\n-    it('creates a session successfully', async () => {\n-      const result = await handleStripeCardUpdateSession(req, app, stripe);\n-      expect(app.models.Donation.findOne).toHaveBeenCalledWith({\n-        where: { userId: mockUserId, provider: 'stripe' }\n-      });\n-      expect(stripe.checkout.sessions.create).toHaveBeenCalled();\n-      expect(result).toEqual({ sessionId: 'session_123' });\n-    });\n-\n-    it('throws an error when donation not found', async () => {\n-      const app = {\n-        models: { Donation: { findOne: jest.fn().mockResolvedValue(null) } }\n-      };\n-\n-      await expect(\n-        handleStripeCardUpdateSession(req, app, stripe)\n-      ).rejects.toThrow('Stripe donation record not found');\n-    });\n-\n-    it('handles stripe session creation failure', async () => {\n-      stripe.checkout.sessions.create.mockRejectedValue(\n-        new Error('Stripe error')\n-      );\n-\n-      await expect(\n-        handleStripeCardUpdateSession(req, app, stripe)\n-      ).rejects.toThrow('Stripe error');\n-    });\n-  });\n-});"
        },
        {
            "sha": "eb67f3d1c999733415046d67873c2595fe32ee37",
            "filename": "api-server/src/server/utils/exam-schemas.js",
            "status": "removed",
            "additions": 0,
            "deletions": 160,
            "changes": 160,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fexam-schemas.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fexam-schemas.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fexam-schemas.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,160 +0,0 @@\n-import Joi from 'joi';\n-import JoiObjectId from 'joi-objectid';\n-\n-Joi.objectId = JoiObjectId(Joi);\n-\n-const nanoIdRE = new RegExp('[a-z0-9]{10}');\n-\n-// Exam from database schema\n-const DbPrerequisitesJoi = Joi.object().keys({\n-  id: Joi.objectId().required(),\n-  title: Joi.string()\n-});\n-\n-const DbAnswerJoi = Joi.object().keys({\n-  id: Joi.string().regex(nanoIdRE).required(),\n-  deprecated: Joi.bool(),\n-  answer: Joi.string().required()\n-});\n-\n-const DbQuestionJoi = Joi.object().keys({\n-  id: Joi.string().regex(nanoIdRE).required(),\n-  question: Joi.string().required(),\n-  deprecated: Joi.bool(),\n-  wrongAnswers: Joi.array()\n-    .items(DbAnswerJoi)\n-    .required()\n-    .custom((value, helpers) => {\n-      const nonDeprecatedCount = value.reduce(\n-        (count, answer) => (answer.deprecated ? count : count + 1),\n-        0\n-      );\n-      const minimumAnswers = 4;\n-\n-      if (nonDeprecatedCount < minimumAnswers) {\n-        return helpers.message(\n-          `'wrongAnswers' must have at least ${minimumAnswers} non-deprecated answers.`\n-        );\n-      }\n-\n-      return value;\n-    }),\n-  correctAnswers: Joi.array()\n-    .items(DbAnswerJoi)\n-    .required()\n-    .custom((value, helpers) => {\n-      const nonDeprecatedCount = value.reduce(\n-        (count, answer) => (answer.deprecated ? count : count + 1),\n-        0\n-      );\n-      const minimumAnswers = 1;\n-\n-      if (nonDeprecatedCount < minimumAnswers) {\n-        return helpers.message(\n-          `'correctAnswers' must have at least ${minimumAnswers} non-deprecated answer.`\n-        );\n-      }\n-\n-      return value;\n-    })\n-});\n-\n-const examFromDbSchema = Joi.object().keys({\n-  // TODO: make sure _id and title match what's in the challenge markdown file\n-  id: Joi.objectId().required(),\n-  title: Joi.string().required(),\n-  numberOfQuestionsInExam: Joi.number()\n-    .min(1)\n-    .max(\n-      Joi.ref('questions', {\n-        adjust: questions => {\n-          const nonDeprecatedCount = questions.reduce(\n-            (count, question) => (question.deprecated ? count : count + 1),\n-            0\n-          );\n-          return nonDeprecatedCount;\n-        }\n-      })\n-    )\n-    .required(),\n-  passingPercent: Joi.number().min(0).max(100).required(),\n-  prerequisites: Joi.array().items(DbPrerequisitesJoi),\n-  questions: Joi.array().items(DbQuestionJoi).min(1).required()\n-});\n-\n-export const validateExamFromDbSchema = exam => {\n-  return examFromDbSchema.validate(exam);\n-};\n-\n-// Generated Exam Schema\n-const GeneratedAnswerJoi = Joi.object().keys({\n-  id: Joi.string().regex(nanoIdRE).required(),\n-  answer: Joi.string().required()\n-});\n-\n-const GeneratedQuestionJoi = Joi.object().keys({\n-  id: Joi.string().regex(nanoIdRE).required(),\n-  question: Joi.string().required(),\n-  answers: Joi.array().items(GeneratedAnswerJoi).min(5).required()\n-});\n-\n-const generatedExamSchema = Joi.array()\n-  .items(GeneratedQuestionJoi)\n-  .min(1)\n-  .required();\n-\n-export const validateGeneratedExamSchema = (exam, numberOfQuestionsInExam) => {\n-  if (!exam.length === numberOfQuestionsInExam) {\n-    throw new Error(\n-      'The number of exam questions generated does not match the number of questions required.'\n-    );\n-  }\n-\n-  return generatedExamSchema.validate(exam);\n-};\n-\n-// User Completed Exam Schema\n-const UserCompletedQuestionJoi = Joi.object().keys({\n-  id: Joi.string().regex(nanoIdRE).required(),\n-  question: Joi.string().required(),\n-  answer: Joi.object().keys({\n-    id: Joi.string().regex(nanoIdRE).required(),\n-    answer: Joi.string().required()\n-  })\n-});\n-\n-const userCompletedExamSchema = Joi.object().keys({\n-  userExamQuestions: Joi.array()\n-    .items(UserCompletedQuestionJoi)\n-    .min(1)\n-    .required(),\n-  examTimeInSeconds: Joi.number().min(0)\n-});\n-\n-export const validateUserCompletedExamSchema = (\n-  exam,\n-  numberOfQuestionsInExam\n-) => {\n-  // TODO: Validate that the properties exist\n-  if (!exam.length === numberOfQuestionsInExam) {\n-    throw new Error(\n-      'The number of exam questions answered does not match the number of questions required.'\n-    );\n-  }\n-\n-  return userCompletedExamSchema.validate(exam);\n-};\n-\n-// Exam Results Schema\n-const examResultsSchema = Joi.object().keys({\n-  numberOfCorrectAnswers: Joi.number().min(0),\n-  numberOfQuestionsInExam: Joi.number().min(0),\n-  percentCorrect: Joi.number().min(0),\n-  passingPercent: Joi.number().min(0).max(100),\n-  passed: Joi.bool(),\n-  examTimeInSeconds: Joi.number().min(0)\n-});\n-\n-export const validateExamResultsSchema = examResults => {\n-  return examResultsSchema.validate(examResults);\n-};"
        },
        {
            "sha": "61c92323cd4e96fc88752a9570038c0d11312c0c",
            "filename": "api-server/src/server/utils/exam.js",
            "status": "removed",
            "additions": 0,
            "deletions": 89,
            "changes": 89,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fexam.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fexam.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fexam.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,89 +0,0 @@\n-import { shuffleArray } from '../../../../shared/utils/shuffle-array';\n-\n-function filterDeprecated(arr) {\n-  return arr.filter(i => !i.deprecated);\n-}\n-\n-function getRandomElement(arr) {\n-  const id = Math.floor(Math.random() * arr.length);\n-  return arr[id];\n-}\n-\n-// Used to generate a random exam\n-export function generateRandomExam(examJson) {\n-  const { numberOfQuestionsInExam, questions } = examJson;\n-  const numberOfAnswersPerQuestion = 5;\n-\n-  const availableQuestions = shuffleArray(filterDeprecated(questions));\n-  const examQuestions = availableQuestions.slice(0, numberOfQuestionsInExam);\n-\n-  const randomizedExam = examQuestions.map(question => {\n-    const { correctAnswers, wrongAnswers } = question;\n-    const availableCorrectAnswers = filterDeprecated(correctAnswers);\n-    const availableWrongAnswers = shuffleArray(filterDeprecated(wrongAnswers));\n-    const correctAnswer = getRandomElement(availableCorrectAnswers);\n-    const answers = shuffleArray([\n-      correctAnswer,\n-      ...availableWrongAnswers.slice(0, numberOfAnswersPerQuestion - 1)\n-    ]);\n-    return {\n-      id: question.id,\n-      question: question.question,\n-      answers\n-    };\n-  });\n-\n-  return randomizedExam;\n-}\n-\n-// Used to evaluate user completed exams\n-export function createExamResults(userExam, originalExam) {\n-  const { userExamQuestions, examTimeInSeconds } = userExam;\n-  /**\n-   * Potential Bug:\n-   *  numberOfQuestionsInExam and passingPercent come from the exam in the database.\n-   *  If either changes between the time a camper starts and submits, it could skew\n-   *  the scores. The alternative is to send those to the client and then get them\n-   *  back from the client - but then they could be manipulated to cheat. So I think\n-   *  this is the way to go. They are unlikely to change, as that would be unfair. We\n-   *  could get numberOfQuestionsInExam from userExamQuestions.length - so only the\n-   *  passingPercent would come from the database. Maybe that would be better.\n-   */\n-  const {\n-    questions: originalQuestions,\n-    numberOfQuestionsInExam,\n-    passingPercent\n-  } = originalExam;\n-\n-  const numberOfCorrectAnswers = userExamQuestions.reduce(\n-    (count, userQuestion) => {\n-      const originalQuestion = originalQuestions.find(\n-        examQuestion => examQuestion.id === userQuestion.id\n-      );\n-\n-      if (!originalQuestion) {\n-        throw new Error('An error occurred. Could not find exam question.');\n-      }\n-\n-      const isCorrect = originalQuestion.correctAnswers.find(\n-        examAnswer => examAnswer.id === userQuestion.answer.id\n-      );\n-      return isCorrect ? count + 1 : count;\n-    },\n-    0\n-  );\n-\n-  // Percent rounded to one decimal place\n-  const percent = (numberOfCorrectAnswers / numberOfQuestionsInExam) * 100;\n-  const percentCorrect = Math.round(percent * 10) / 10;\n-  const passed = percentCorrect >= passingPercent;\n-\n-  return {\n-    numberOfCorrectAnswers,\n-    numberOfQuestionsInExam,\n-    percentCorrect,\n-    passingPercent,\n-    passed,\n-    examTimeInSeconds\n-  };\n-}"
        },
        {
            "sha": "d810734f6201cabaa8f0d6c376597c525c06bfb2",
            "filename": "api-server/src/server/utils/exam.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 54,
            "changes": 54,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fexam.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fexam.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fexam.test.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,54 +0,0 @@\n-import { generateRandomExam, createExamResults } from './exam';\n-\n-import {\n-  examJson,\n-  userExam1,\n-  userExam2,\n-  mockResults1,\n-  mockResults2\n-} from './__mocks__/exam';\n-\n-describe('Exam helpers', () => {\n-  describe('generateRandomExam()', () => {\n-    const randomizedExam = generateRandomExam(examJson);\n-\n-    it('should have one question', () => {\n-      expect(randomizedExam.length).toBe(1);\n-    });\n-\n-    it('should have five answers', () => {\n-      const firstQuestion = randomizedExam[0];\n-      expect(firstQuestion.answers.length).toBe(5);\n-    });\n-\n-    it('should have exactly one correct answer', () => {\n-      const question = randomizedExam[0];\n-      const questionId = question.id;\n-      const originalQuestion = examJson.questions.find(\n-        q => q.id === questionId\n-      );\n-      const originalCorrectAnswer = originalQuestion.correctAnswers;\n-      const correctIds = originalCorrectAnswer.map(a => a.id);\n-\n-      const numberOfCorrectAnswers = question.answers.filter(a =>\n-        correctIds.includes(a.id)\n-      );\n-\n-      expect(numberOfCorrectAnswers).toHaveLength(1);\n-    });\n-  });\n-\n-  describe('createExamResults()', () => {\n-    examJson.numberOfQuestionsInExam = 2;\n-    const examResults1 = createExamResults(userExam1, examJson);\n-    const examResults2 = createExamResults(userExam2, examJson);\n-\n-    it('failing exam should return correct results', () => {\n-      expect(examResults1).toEqual(mockResults1);\n-    });\n-\n-    it('passing exam should return correct results', () => {\n-      expect(examResults2).toEqual(mockResults2);\n-    });\n-  });\n-});"
        },
        {
            "sha": "576933898ef8d026ed2169be6d947bd7c85ed250",
            "filename": "api-server/src/server/utils/get-curriculum.js",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fget-curriculum.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fget-curriculum.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fget-curriculum.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,21 +0,0 @@\n-import { flatten } from 'lodash';\n-\n-// TODO: keeping curriculum in memory is handy if we want to field requests that\n-// need to 'query' the curriculum, but if we force the client to handle\n-// redirectToCurrentChallenge and, instead, only report the current challenge id\n-// via the user object, then we should *not* store this so it can be garbage\n-// collected.\n-\n-// eslint-disable-next-line import/no-unresolved\n-import curriculum from '../../../../shared/config/curriculum.json';\n-\n-export function getChallenges() {\n-  return Object.keys(curriculum)\n-    .map(key => curriculum[key].blocks)\n-    .reduce((challengeArray, superBlock) => {\n-      const challengesForBlock = Object.keys(superBlock).map(\n-        key => superBlock[key].challenges\n-      );\n-      return [...challengeArray, ...flatten(challengesForBlock)];\n-    }, []);\n-}"
        },
        {
            "sha": "552122a988d89ebdb85b64e336b709fb7ec7c3b0",
            "filename": "api-server/src/server/utils/getSetAccessToken.js",
            "status": "removed",
            "additions": 0,
            "deletions": 73,
            "changes": 73,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2FgetSetAccessToken.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2FgetSetAccessToken.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2FgetSetAccessToken.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,73 +0,0 @@\n-import { isBefore } from 'date-fns';\n-import jwt from 'jsonwebtoken';\n-\n-import { jwtSecret as _jwtSecret } from '../../../config/secrets';\n-\n-export const jwtCookieNS = 'jwt_access_token';\n-\n-export function createCookieConfig(req) {\n-  return {\n-    signed: !!req.signedCookies,\n-    domain: process.env.COOKIE_DOMAIN\n-  };\n-}\n-\n-export function setAccessTokenToResponse(\n-  { accessToken },\n-  req,\n-  res,\n-  jwtSecret = _jwtSecret\n-) {\n-  const cookieConfig = {\n-    ...createCookieConfig(req),\n-    maxAge: accessToken.ttl || 77760000000\n-  };\n-  const jwtAccess = jwt.sign({ accessToken }, jwtSecret);\n-  res.cookie(jwtCookieNS, jwtAccess, cookieConfig);\n-  return;\n-}\n-\n-export function getAccessTokenFromRequest(req, jwtSecret = _jwtSecret) {\n-  const maybeToken =\n-    (req.signedCookies && req.signedCookies[jwtCookieNS]) ||\n-    (req.cookie && req.cookie[jwtCookieNS]);\n-  if (!maybeToken) {\n-    return {\n-      accessToken: null,\n-      error: errorTypes.noTokenFound\n-    };\n-  }\n-  let token;\n-  try {\n-    token = jwt.verify(maybeToken, jwtSecret);\n-  } catch (err) {\n-    return { accessToken: null, error: errorTypes.invalidToken };\n-  }\n-\n-  const { accessToken } = token;\n-  const { created, ttl } = accessToken;\n-  const valid = isBefore(Date.now(), Date.parse(created) + ttl);\n-  if (!valid) {\n-    return {\n-      accessToken: null,\n-      error: errorTypes.expiredToken\n-    };\n-  }\n-  return { accessToken, error: '' };\n-}\n-\n-export function removeCookies(req, res) {\n-  const config = createCookieConfig(req);\n-  res.clearCookie(jwtCookieNS, config);\n-  res.clearCookie('access_token', config);\n-  res.clearCookie('userId', config);\n-  res.clearCookie('_csrf', config);\n-  res.clearCookie('csrf_token', config);\n-  return;\n-}\n-\n-export const errorTypes = {\n-  noTokenFound: 'No token found',\n-  invalidToken: 'Invalid token',\n-  expiredToken: 'Token timed out'\n-};"
        },
        {
            "sha": "f8d2dde7fe67b0195aa057e78c1d5bb2901d5c19",
            "filename": "api-server/src/server/utils/getSetAccessToken.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 126,
            "changes": 126,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2FgetSetAccessToken.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2FgetSetAccessToken.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2FgetSetAccessToken.test.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,126 +0,0 @@\n-import jwt from 'jsonwebtoken';\n-import { mockReq, mockRes } from '../boot_tests/challenge.test';\n-import {\n-  getAccessTokenFromRequest,\n-  errorTypes,\n-  setAccessTokenToResponse,\n-  removeCookies\n-} from './getSetAccessToken';\n-\n-describe('getSetAccessToken', () => {\n-  const validJWTSecret = 'this is a super secret string';\n-  const invalidJWTSecret = 'This is not correct secret';\n-  const now = new Date(Date.now());\n-  const theBeginningOfTime = new Date(0);\n-  const domain = 'www.example.com';\n-  const accessToken = {\n-    id: '123abc',\n-    userId: '456def',\n-    ttl: 60000,\n-    created: now\n-  };\n-\n-  // https://stackoverflow.com/questions/48033841/test-process-env-with-jest\n-  const OLD_ENV = process.env;\n-\n-  beforeEach(() => {\n-    jest.resetModules(); // process is implicitly cached by Jest, so hence the reset\n-    process.env = { ...OLD_ENV }; // Shallow clone that we can modify\n-    process.env.COOKIE_DOMAIN = domain;\n-  });\n-\n-  afterAll(() => {\n-    process.env = OLD_ENV;\n-  });\n-\n-  describe('getAccessTokenFromRequest', () => {\n-    it('return `no token` error if no token is found', () => {\n-      const req = mockReq({ headers: {}, cookie: {} });\n-      const result = getAccessTokenFromRequest(req, validJWTSecret);\n-      expect(result.error).toEqual(errorTypes.noTokenFound);\n-    });\n-\n-    describe('cookies', () => {\n-      it('returns `invalid token` error for malformed tokens', () => {\n-        const invalidJWT = jwt.sign({ accessToken }, invalidJWTSecret);\n-\n-        const req = mockReq({ cookie: { jwt_access_token: invalidJWT } });\n-        const result = getAccessTokenFromRequest(req, validJWTSecret);\n-\n-        expect(result.error).toEqual(errorTypes.invalidToken);\n-      });\n-\n-      it('returns `expired token` error for expired tokens', () => {\n-        const invalidJWT = jwt.sign(\n-          { accessToken: { ...accessToken, created: theBeginningOfTime } },\n-          validJWTSecret\n-        );\n-\n-        const req = mockReq({ cookie: { jwt_access_token: invalidJWT } });\n-        const result = getAccessTokenFromRequest(req, validJWTSecret);\n-\n-        expect(result.error).toEqual(errorTypes.expiredToken);\n-      });\n-\n-      it('returns a valid access token with no errors ', () => {\n-        expect.assertions(2);\n-        const validJWT = jwt.sign({ accessToken }, validJWTSecret);\n-\n-        const req = mockReq({ cookie: { jwt_access_token: validJWT } });\n-        const result = getAccessTokenFromRequest(req, validJWTSecret);\n-\n-        expect(result.error).toBeFalsy();\n-        expect(result.accessToken).toEqual({\n-          ...accessToken,\n-          created: accessToken.created.toISOString()\n-        });\n-      });\n-    });\n-  });\n-\n-  describe('setAccessTokenToResponse', () => {\n-    it('sets a jwt access token cookie in the response', () => {\n-      const req = mockReq();\n-      const res = mockRes();\n-\n-      const expectedJWT = jwt.sign({ accessToken }, validJWTSecret);\n-\n-      setAccessTokenToResponse({ accessToken }, req, res, validJWTSecret);\n-\n-      expect(res.cookie).toHaveBeenNthCalledWith(\n-        1,\n-        'jwt_access_token',\n-        expectedJWT,\n-        {\n-          signed: false,\n-          domain,\n-          maxAge: accessToken.ttl\n-        }\n-      );\n-    });\n-  });\n-\n-  describe('removeCookies', () => {\n-    it('removes four cookies set in the lifetime of an authenticated session', () => {\n-      // expect.assertions(4);\n-      const req = mockReq();\n-      const res = mockRes();\n-      const jwtOptions = { signed: false, domain };\n-\n-      removeCookies(req, res);\n-\n-      expect(res.clearCookie).toHaveBeenNthCalledWith(\n-        1,\n-        'jwt_access_token',\n-        jwtOptions\n-      );\n-      expect(res.clearCookie).toHaveBeenNthCalledWith(\n-        2,\n-        'access_token',\n-        jwtOptions\n-      );\n-      expect(res.clearCookie).toHaveBeenNthCalledWith(3, 'userId', jwtOptions);\n-      expect(res.clearCookie).toHaveBeenNthCalledWith(4, '_csrf', jwtOptions);\n-    });\n-  });\n-});"
        },
        {
            "sha": "d80a33814b5e0ec81c89f85776481a500e83e1d1",
            "filename": "api-server/src/server/utils/in-memory-cache.js",
            "status": "removed",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fin-memory-cache.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fin-memory-cache.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fin-memory-cache.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,43 +0,0 @@\n-function isPromiseLike(thing) {\n-  return !!thing && typeof thing.then === 'function';\n-}\n-\n-function InMemoryCache(initialValue, reportError) {\n-  if (typeof reportError !== 'function') {\n-    throw new Error(\n-      'No reportError function specified for this in-memory-cache'\n-    );\n-  }\n-  const cacheKey = Symbol('cacheKey');\n-  const cache = new Map();\n-  cache.set(cacheKey, initialValue);\n-\n-  return {\n-    get() {\n-      const value = cache.get(cacheKey);\n-      return typeof value !== 'undefined' ? value : null;\n-    },\n-\n-    update(fn) {\n-      try {\n-        const value = fn();\n-        if (isPromiseLike(value)) {\n-          return value.then(value => cache.set(cacheKey, value));\n-        } else {\n-          cache.set(cacheKey, value);\n-        }\n-      } catch (e) {\n-        const errMsg = `InMemoryCache > update > caught: ${e.message}`;\n-        e.message = errMsg;\n-        reportError(e);\n-      }\n-      return null;\n-    },\n-\n-    clear() {\n-      return cache.delete(cacheKey);\n-    }\n-  };\n-}\n-\n-export default InMemoryCache;"
        },
        {
            "sha": "eeb2544117ed6e994e55e60e3e2a4501c04b695a",
            "filename": "api-server/src/server/utils/in-memory-cache.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 65,
            "changes": 65,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fin-memory-cache.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fin-memory-cache.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fin-memory-cache.test.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,65 +0,0 @@\n-import inMemoryCache from './in-memory-cache';\n-\n-describe('InMemoryCache', () => {\n-  let reportErrorStub;\n-  const theAnswer = 42;\n-  const before = 'before';\n-  const after = 'after';\n-  const emptyCacheValue = null;\n-\n-  beforeEach(() => {\n-    reportErrorStub = jest.fn();\n-  });\n-\n-  it('throws if no report function is passed as a second argument', () => {\n-    expect(() => inMemoryCache(null)).toThrowError(\n-      'No reportError function specified for this in-memory-cache'\n-    );\n-  });\n-\n-  describe('get', () => {\n-    it('returns an initial value', () => {\n-      const cache = inMemoryCache(theAnswer, reportErrorStub);\n-      expect(cache.get()).toBe(theAnswer);\n-    });\n-  });\n-\n-  describe('update', () => {\n-    it('updates the cached value', () => {\n-      const cache = inMemoryCache(before, reportErrorStub);\n-      cache.update(() => after);\n-      expect(cache.get()).toBe(after);\n-    });\n-\n-    it('can handle promises correctly', done => {\n-      const cache = inMemoryCache(before, reportErrorStub);\n-      const promisedUpdate = () => new Promise(resolve => resolve(after));\n-      cache.update(promisedUpdate).then(() => {\n-        expect(cache.get()).toBe(after);\n-        done();\n-      });\n-    });\n-\n-    it('reports errors thrown from the update function', () => {\n-      const cache = inMemoryCache(before, reportErrorStub);\n-\n-      const updateError = new Error('An update error');\n-      const updateThatThrows = () => {\n-        throw updateError;\n-      };\n-\n-      cache.update(updateThatThrows);\n-      expect(reportErrorStub).toHaveBeenCalledWith(updateError);\n-    });\n-  });\n-\n-  describe('clear', () => {\n-    it('clears the  cache', () => {\n-      expect.assertions(2);\n-      const cache = inMemoryCache(theAnswer, reportErrorStub);\n-      expect(cache.get()).toBe(theAnswer);\n-      cache.clear();\n-      expect(cache.get()).toBe(emptyCacheValue);\n-    });\n-  });\n-});"
        },
        {
            "sha": "3938aa479d3a79296cf7b81714dc753634b24b5e",
            "filename": "api-server/src/server/utils/lang-passthrough-urls.js",
            "status": "removed",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Flang-passthrough-urls.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Flang-passthrough-urls.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Flang-passthrough-urls.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,4 +0,0 @@\n-export default ['auth', 'services', 'link'].reduce((throughs, route) => {\n-  throughs[route] = true;\n-  return throughs;\n-}, {});"
        },
        {
            "sha": "61144fae64b2bebdd57cd19ca8dde954950dd1f2",
            "filename": "api-server/src/server/utils/middleware.js",
            "status": "removed",
            "additions": 0,
            "deletions": 108,
            "changes": 108,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fmiddleware.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fmiddleware.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fmiddleware.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,108 +0,0 @@\n-import dedent from 'dedent';\n-import { validationResult } from 'express-validator';\n-\n-import { createValidatorErrorFormatter } from './create-handled-error.js';\n-\n-import {\n-  getAccessTokenFromRequest,\n-  removeCookies\n-} from './getSetAccessToken.js';\n-import { getRedirectParams } from './redirection';\n-\n-export function ifNoUserRedirectHome(message, type = 'errors') {\n-  return function (req, res, next) {\n-    const { path } = req;\n-    if (req.user) {\n-      return next();\n-    }\n-\n-    const { origin } = getRedirectParams(req);\n-    req.flash(type, message || `You must be signed in to access ${path}`);\n-\n-    return res.redirect(origin);\n-  };\n-}\n-\n-export function ifNoUserSend(sendThis) {\n-  return function (req, res, next) {\n-    if (req.user) {\n-      return next();\n-    }\n-    return res.status(200).send(sendThis);\n-  };\n-}\n-\n-export function ifNoUser401(req, res, next) {\n-  if (req.user) {\n-    return next();\n-  }\n-  return res.status(401).end();\n-}\n-\n-export function ifNotVerifiedRedirectToUpdateEmail(req, res, next) {\n-  const { user } = req;\n-  if (!user) {\n-    return next();\n-  }\n-  if (!user.emailVerified) {\n-    req.flash(\n-      'danger',\n-      dedent`\n-        We do not have your verified email address on record,\n-        please add it in the settings to continue with your request.\n-      `\n-    );\n-    return res.redirect('/settings');\n-  }\n-  return next();\n-}\n-\n-export function ifUserRedirectTo(status) {\n-  status = status === 301 ? 301 : 302;\n-  return (req, res, next) => {\n-    const { accessToken } = getAccessTokenFromRequest(req);\n-    const { returnTo } = getRedirectParams(req);\n-    if (req.user && accessToken) {\n-      return res.status(status).redirect(returnTo);\n-    }\n-    if (req.user && !accessToken) {\n-      // This request has an active auth session\n-      // but there is no accessToken attached to the request\n-      // perhaps the user cleared cookies?\n-      // we need to remove the zombie auth session\n-      removeCookies(req, res);\n-      delete req.session.passport;\n-    }\n-    return next();\n-  };\n-}\n-\n-export function ifNotMobileRedirect() {\n-  return (req, res, next) => {\n-    //\n-    // Todo: Use the below check once we have done more research on usage\n-    //\n-    // const isMobile = /(iPhone|iPad|Android)/.test(req.headers['user-agent']);\n-    // if (!isMobile) {\n-    //  res.json({ error: 'not from mobile' });\n-    // } else {\n-    //  next();\n-    // }\n-    next();\n-  };\n-}\n-// for use with express-validator error formatter\n-export const createValidatorErrorHandler =\n-  (...args) =>\n-  (req, res, next) => {\n-    const validation = validationResult(req).formatWith(\n-      createValidatorErrorFormatter(...args)\n-    );\n-\n-    if (!validation.isEmpty()) {\n-      const errors = validation.array();\n-      return next(errors.pop());\n-    }\n-\n-    return next();\n-  };"
        },
        {
            "sha": "8fb35d36fea83a0fe088bfb33e113c35cc70c75c",
            "filename": "api-server/src/server/utils/publicUserProps.js",
            "status": "removed",
            "additions": 0,
            "deletions": 79,
            "changes": 79,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2FpublicUserProps.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2FpublicUserProps.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2FpublicUserProps.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,79 +0,0 @@\n-import { isURL } from 'validator';\n-\n-export const publicUserProps = [\n-  'about',\n-  'calendar',\n-  'completedChallenges',\n-  'completedExams',\n-  'completedSurveys',\n-  'githubProfile',\n-  'isApisMicroservicesCert',\n-  'isBackEndCert',\n-  'isCheater',\n-  'isDonating',\n-  'is2018DataVisCert',\n-  'isDataVisCert',\n-  'isFrontEndCert',\n-  'isFullStackCert',\n-  'isFrontEndLibsCert',\n-  'isHonest',\n-  'isInfosecQaCert',\n-  'isQaCertV7',\n-  'isInfosecCertV7',\n-  'isJsAlgoDataStructCert',\n-  'isRelationalDatabaseCertV8',\n-  'isRespWebDesignCert',\n-  'isSciCompPyCertV7',\n-  'isDataAnalysisPyCertV7',\n-  'isMachineLearningPyCertV7',\n-  'isCollegeAlgebraPyCertV8',\n-  'isFoundationalCSharpCertV8',\n-  'isJsAlgoDataStructCertV8',\n-  'linkedin',\n-  'location',\n-  'name',\n-  'partiallyCompletedChallenges',\n-  'points',\n-  'portfolio',\n-  'profileUI',\n-  'projects',\n-  'savedChallenges',\n-  'twitter',\n-  'username',\n-  'website',\n-  'yearsTopContributor'\n-];\n-\n-export const userPropsForSession = [\n-  ...publicUserProps,\n-  'currentChallengeId',\n-  'email',\n-  'emailVerified',\n-  'id',\n-  'sendQuincyEmail',\n-  'theme',\n-  'keyboardShortcuts',\n-  'completedChallengeCount',\n-  'acceptedPrivacyTerms'\n-];\n-\n-export function normaliseUserFields(user) {\n-  const about = user.bio && !user.about ? user.bio : user.about;\n-  const picture = user.picture || '';\n-  const twitter =\n-    user.twitter && isURL(user.twitter)\n-      ? user.twitter\n-      : user.twitter &&\n-        `https://www.twitter.com/${user.twitter.replace(/^@/, '')}`;\n-  return { about, picture, twitter };\n-}\n-\n-export function getProgress(progressTimestamps) {\n-  const calendar = progressTimestamps\n-    .filter(Boolean)\n-    .reduce((data, timestamp) => {\n-      data[Math.floor(timestamp / 1000)] = 1;\n-      return data;\n-    }, {});\n-  return { calendar };\n-}"
        },
        {
            "sha": "83492c9ddbeeee496b6067dda612285315659863",
            "filename": "api-server/src/server/utils/react.js",
            "status": "removed",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Freact.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Freact.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Freact.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,6 +0,0 @@\n-export const errorThrowerMiddleware = () => next => action => {\n-  if (action.error) {\n-    throw action.payload;\n-  }\n-  return next(action);\n-};"
        },
        {
            "sha": "93cb37cdfc34c42fbb762df0fd24ef0873925268",
            "filename": "api-server/src/server/utils/redirection.js",
            "status": "removed",
            "additions": 0,
            "deletions": 83,
            "changes": 83,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fredirection.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fredirection.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fredirection.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,83 +0,0 @@\n-const jwt = require('jsonwebtoken');\n-const { allowedOrigins } = require('../../../config/cors-settings');\n-// process.env.HOME_LOCATION is being used as a fallback here. If the one\n-// provided by the client is invalid we default to this.\n-const { availableLangs } = require('../../../../shared/config/i18n');\n-\n-function getReturnTo(\n-  encryptedParams,\n-  secret,\n-  _homeLocation = process.env.HOME_LOCATION\n-) {\n-  let params;\n-  try {\n-    params = jwt.verify(encryptedParams, secret);\n-  } catch (e) {\n-    // TODO: report to Sentry? Probably not. Remove entirely?\n-    console.log(e);\n-    // something went wrong, use default params\n-    params = {\n-      returnTo: `${_homeLocation}/learn`,\n-      origin: _homeLocation,\n-      pathPrefix: ''\n-    };\n-  }\n-\n-  return normalizeParams(params, _homeLocation);\n-}\n-\n-function normalizeParams(\n-  { returnTo, origin, pathPrefix },\n-  _homeLocation = process.env.HOME_LOCATION\n-) {\n-  // coerce to strings, just in case something weird and nefarious is happening\n-  returnTo = '' + returnTo;\n-  origin = '' + origin;\n-  pathPrefix = '' + pathPrefix;\n-  // we add the '/' to prevent returns to\n-  // www.freecodecamp.org.somewhere.else.com\n-  if (\n-    !returnTo ||\n-    !allowedOrigins.some(allowed => returnTo.startsWith(allowed + '/'))\n-  ) {\n-    returnTo = `${_homeLocation}/learn`;\n-    origin = _homeLocation;\n-    pathPrefix = '';\n-  }\n-  if (!origin || !allowedOrigins.includes(origin)) {\n-    returnTo = `${_homeLocation}/learn`;\n-    origin = _homeLocation;\n-    pathPrefix = '';\n-  }\n-  pathPrefix = availableLangs.client.includes(pathPrefix) ? pathPrefix : '';\n-  return { returnTo, origin, pathPrefix };\n-}\n-\n-function getPrefixedLandingPath(origin, pathPrefix) {\n-  const redirectPathSegment = pathPrefix ? `/${pathPrefix}` : '';\n-  return `${origin}${redirectPathSegment}`;\n-}\n-\n-function getRedirectParams(req, _normalizeParams = normalizeParams) {\n-  const url = req.header('Referer');\n-  // since we do not always redirect the user back to the page they were on\n-  // we need client locale and origin to construct the redirect url.\n-  const returnUrl = new URL(url ? url : process.env.HOME_LOCATION);\n-  const origin = returnUrl.origin;\n-  // if this is not one of the client languages, validation will convert\n-  // this to '' before it is used.\n-  const pathPrefix = returnUrl.pathname.split('/')[1];\n-  return _normalizeParams({ returnTo: returnUrl.href, origin, pathPrefix });\n-}\n-\n-function haveSamePath(redirectBase, returnUrl) {\n-  const base = new URL(redirectBase);\n-  const url = new URL(returnUrl);\n-  return base.pathname === url.pathname;\n-}\n-\n-module.exports.getReturnTo = getReturnTo;\n-module.exports.getPrefixedLandingPath = getPrefixedLandingPath;\n-module.exports.normalizeParams = normalizeParams;\n-module.exports.getRedirectParams = getRedirectParams;\n-module.exports.haveSamePath = haveSamePath;"
        },
        {
            "sha": "ce21db70806ccf5be0f2d161923e8fc262a3ebb4",
            "filename": "api-server/src/server/utils/redirection.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 121,
            "changes": 121,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fredirection.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fredirection.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fredirection.test.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,121 +0,0 @@\n-const jwt = require('jsonwebtoken');\n-\n-const { getReturnTo, normalizeParams } = require('./redirection');\n-\n-const validJWTSecret = 'this is a super secret string';\n-const invalidJWTSecret = 'This is not correct secret';\n-const validReturnTo = 'https://www.freecodecamp.org/settings';\n-const invalidReturnTo = 'https://www.freecodecamp.org.fake/settings';\n-const defaultReturnTo = 'https://www.freecodecamp.org/learn';\n-const defaultOrigin = 'https://www.freecodecamp.org';\n-const defaultPrefix = '';\n-\n-const defaultObject = {\n-  returnTo: defaultReturnTo,\n-  origin: defaultOrigin,\n-  pathPrefix: defaultPrefix\n-};\n-\n-describe('redirection', () => {\n-  describe('getReturnTo', () => {\n-    it('should extract returnTo from a jwt', () => {\n-      expect.assertions(1);\n-\n-      const encryptedReturnTo = jwt.sign(\n-        { returnTo: validReturnTo, origin: defaultOrigin },\n-        validJWTSecret\n-      );\n-      expect(\n-        getReturnTo(encryptedReturnTo, validJWTSecret, defaultOrigin)\n-      ).toStrictEqual({\n-        ...defaultObject,\n-        returnTo: validReturnTo\n-      });\n-    });\n-\n-    it('should return a default url if the secrets do not match', () => {\n-      const oldLog = console.log;\n-      expect.assertions(2);\n-      console.log = jest.fn();\n-      const encryptedReturnTo = jwt.sign(\n-        { returnTo: validReturnTo },\n-        invalidJWTSecret\n-      );\n-      expect(\n-        getReturnTo(encryptedReturnTo, validJWTSecret, defaultOrigin)\n-      ).toStrictEqual(defaultObject);\n-      expect(console.log).toHaveBeenCalled();\n-      console.log = oldLog;\n-    });\n-\n-    it('should return a default url for unknown origins', () => {\n-      expect.assertions(1);\n-      const encryptedReturnTo = jwt.sign(\n-        { returnTo: invalidReturnTo },\n-        validJWTSecret\n-      );\n-      expect(\n-        getReturnTo(encryptedReturnTo, validJWTSecret, defaultOrigin)\n-      ).toStrictEqual(defaultObject);\n-    });\n-  });\n-  describe('normalizeParams', () => {\n-    it('should return a {returnTo, origin, pathPrefix} object', () => {\n-      expect.assertions(2);\n-      const keys = Object.keys(normalizeParams({}));\n-      const expectedKeys = ['returnTo', 'origin', 'pathPrefix'];\n-      expect(keys.length).toBe(3);\n-      expect(keys).toEqual(expect.arrayContaining(expectedKeys));\n-    });\n-    it('should default to process.env.HOME_LOCATION', () => {\n-      expect.assertions(1);\n-      expect(normalizeParams({}, defaultOrigin)).toEqual(defaultObject);\n-    });\n-    it('should convert an unknown pathPrefix to \"\"', () => {\n-      expect.assertions(1);\n-      const brokenPrefix = {\n-        ...defaultObject,\n-        pathPrefix: 'not-really-a-name'\n-      };\n-      expect(normalizeParams(brokenPrefix, defaultOrigin)).toEqual(\n-        defaultObject\n-      );\n-    });\n-    it('should not change a known pathPrefix', () => {\n-      expect.assertions(1);\n-      const spanishPrefix = {\n-        ...defaultObject,\n-        pathPrefix: 'espanol'\n-      };\n-      expect(normalizeParams(spanishPrefix, defaultOrigin)).toEqual(\n-        spanishPrefix\n-      );\n-    });\n-    // we *could*, in principle, grab the path and send them to\n-    // process.env.HOME_LOCATION/path, but if the origin is wrong something unexpected is\n-    // going on. In that case it's probably best to just send them to\n-    // process.env.HOME_LOCATION/learn.\n-    it('should return default parameters if the origin is unknown', () => {\n-      expect.assertions(1);\n-      const exampleOrigin = {\n-        ...defaultObject,\n-        origin: 'http://example.com',\n-        pathPrefix: 'espanol'\n-      };\n-      expect(normalizeParams(exampleOrigin, defaultOrigin)).toEqual(\n-        defaultObject\n-      );\n-    });\n-    it('should return default parameters if the returnTo is unknown', () => {\n-      expect.assertions(1);\n-      const exampleReturnTo = {\n-        ...defaultObject,\n-        returnTo: 'http://example.com/path',\n-        pathPrefix: 'espanol'\n-      };\n-      expect(normalizeParams(exampleReturnTo, defaultOrigin)).toEqual(\n-        defaultObject\n-      );\n-    });\n-  });\n-});"
        },
        {
            "sha": "de1cd7d40bf142efa70b2c9ef7d5e179583f3288",
            "filename": "api-server/src/server/utils/rx.js",
            "status": "removed",
            "additions": 0,
            "deletions": 58,
            "changes": 58,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Frx.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Frx.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Frx.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,58 +0,0 @@\n-import debugFactory from 'debug';\n-import moment from 'moment';\n-import Rx, { AsyncSubject, Observable } from 'rx';\n-\n-const debug = debugFactory('fcc:rxUtils');\n-\n-export function saveInstance(instance) {\n-  return new Rx.Observable.create(function (observer) {\n-    if (!instance || typeof instance.save !== 'function') {\n-      debug('no instance or save method');\n-      observer.onNext();\n-      return observer.onCompleted();\n-    }\n-    return instance.save(function (err, savedInstance) {\n-      if (err) {\n-        return observer.onError(err);\n-      }\n-      debug('instance saved');\n-      observer.onNext(savedInstance);\n-      return observer.onCompleted();\n-    });\n-  });\n-}\n-\n-// alias saveInstance\n-export const saveUser = saveInstance;\n-\n-// observeQuery(Model: Object, methodName: String, query: Any) => Observable\n-export function observeQuery(Model, methodName, query) {\n-  return Rx.Observable.fromNodeCallback(Model[methodName], Model)(query);\n-}\n-\n-// observeMethod(\n-//   context: Object, methodName: String\n-// ) => (query: Any) => Observable\n-export function observeMethod(context, methodName) {\n-  return Rx.Observable.fromNodeCallback(context[methodName], context);\n-}\n-\n-// must be bound to an observable instance\n-// timeCache(amount: Number, unit: String) => Observable\n-export function timeCache(time, unit) {\n-  const source = this;\n-  let cache;\n-  let expireCacheAt;\n-  return Observable.create(observable => {\n-    // if there is no expire time set\n-    // or if expireCacheAt is smaller than now,\n-    // set new expire time in MS and create new subscription to source\n-    if (!expireCacheAt || expireCacheAt < Date.now()) {\n-      // set expire in ms;\n-      expireCacheAt = moment().add(time, unit).valueOf();\n-      cache = new AsyncSubject();\n-      source.subscribe(cache);\n-    }\n-    return cache.subscribe(observable);\n-  });\n-}"
        },
        {
            "sha": "4c5f30889b1e9e2185cfa1e92d64eae78788f901",
            "filename": "api-server/src/server/utils/stripeHelpers.js",
            "status": "removed",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2FstripeHelpers.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2FstripeHelpers.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2FstripeHelpers.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,10 +0,0 @@\n-import { isEmail, isNumeric } from 'validator';\n-import { donationSubscriptionConfig } from '../../../../shared/config/donation-settings';\n-\n-export function validStripeForm(amount, duration, email) {\n-  return (\n-    isEmail('' + email) &&\n-    isNumeric('' + amount) &&\n-    donationSubscriptionConfig.plans[duration].includes(amount)\n-  );\n-}"
        },
        {
            "sha": "8e2ffb338824ce8e2dd69aa756be409ab8c21d27",
            "filename": "api-server/src/server/utils/url-utils.js",
            "status": "removed",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Furl-utils.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Furl-utils.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Furl-utils.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,3 +0,0 @@\n-export function getEmailSender() {\n-  return process.env.SES_MAIL_FROM || 'team@freecodecamp.org';\n-}"
        },
        {
            "sha": "3570bfdf2bca66cdf1d42994b56b175dcef5a5a6",
            "filename": "api-server/src/server/utils/user-stats.js",
            "status": "removed",
            "additions": 0,
            "deletions": 109,
            "changes": 109,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fuser-stats.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fuser-stats.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fuser-stats.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,109 +0,0 @@\n-import { isEmpty } from 'lodash';\n-import compose from 'lodash/fp/compose';\n-import forEachRight from 'lodash/fp/forEachRight';\n-import last from 'lodash/fp/last';\n-import map from 'lodash/fp/map';\n-import sortBy from 'lodash/fp/sortBy';\n-import trans from 'lodash/fp/transform';\n-import loopback from 'loopback';\n-import moment from 'moment-timezone';\n-\n-import { dayCount } from '../utils/date-utils';\n-\n-const transform = trans.convert({ cap: false });\n-\n-const hoursBetween = 24;\n-const hoursDay = 24;\n-\n-export function prepUniqueDaysByHours(cals, tz = 'UTC') {\n-  let prev = null;\n-\n-  // compose goes bottom to top (map > sortBy > transform)\n-  return compose(\n-    transform((data, cur, i) => {\n-      if (i < 1) {\n-        data.push(cur);\n-        prev = cur;\n-      } else if (\n-        moment(cur).tz(tz).diff(moment(prev).tz(tz).startOf('day'), 'hours') >=\n-        hoursDay\n-      ) {\n-        data.push(cur);\n-        prev = cur;\n-      }\n-    }, []),\n-    sortBy(e => e),\n-    map(ts => moment(ts).tz(tz).startOf('hours').valueOf())\n-  )(cals);\n-}\n-\n-export function calcCurrentStreak(cals, tz = 'UTC') {\n-  let prev = last(cals);\n-  if (\n-    moment().tz(tz).startOf('day').diff(moment(prev).tz(tz), 'hours') >\n-    hoursBetween\n-  ) {\n-    return 0;\n-  }\n-  let currentStreak = 0;\n-  let streakContinues = true;\n-  forEachRight(cur => {\n-    if (\n-      moment(prev).tz(tz).startOf('day').diff(moment(cur).tz(tz), 'hours') <=\n-      hoursBetween\n-    ) {\n-      prev = cur;\n-      currentStreak++;\n-    } else {\n-      // current streak found\n-      streakContinues = false;\n-    }\n-    return streakContinues;\n-  })(cals);\n-\n-  return currentStreak;\n-}\n-\n-export function calcLongestStreak(cals, tz = 'UTC') {\n-  let tail = cals[0];\n-  const longest = cals.reduce(\n-    (longest, head, index) => {\n-      const last = cals[index === 0 ? 0 : index - 1];\n-      // is streak broken\n-      if (\n-        moment(head).tz(tz).startOf('day').diff(moment(last).tz(tz), 'hours') >\n-        hoursBetween\n-      ) {\n-        tail = head;\n-      }\n-      if (dayCount(longest, tz) < dayCount([head, tail], tz)) {\n-        return [head, tail];\n-      }\n-      return longest;\n-    },\n-    [cals[0], cals[0]]\n-  );\n-\n-  return dayCount(longest, tz);\n-}\n-\n-export function getUserById(id, User = loopback.getModelByType('User')) {\n-  return new Promise((resolve, reject) =>\n-    User.findById(id, (err, instance) => {\n-      if (err || isEmpty(instance)) {\n-        return reject(err || 'No user instance found');\n-      }\n-\n-      let completedChallengeCount = 0;\n-      if ('completedChallenges' in instance) {\n-        completedChallengeCount = instance.completedChallenges.length;\n-      }\n-\n-      instance.completedChallengeCount = completedChallengeCount;\n-      instance.points =\n-        (instance.progressTimestamps && instance.progressTimestamps.length) ||\n-        1;\n-      return resolve(instance);\n-    })\n-  );\n-}"
        },
        {
            "sha": "9f404be2d0f7a5b4edc8e49183c8e9e3c6ef6cf7",
            "filename": "api-server/src/server/utils/user-stats.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 623,
            "changes": 623,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fuser-stats.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fuser-stats.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fuser-stats.test.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,623 +0,0 @@\n-import moment from 'moment-timezone';\n-\n-import { mockUserID, mockApp, mockUser } from '../boot_tests/fixtures';\n-import {\n-  prepUniqueDaysByHours,\n-  calcCurrentStreak,\n-  calcLongestStreak,\n-  getUserById\n-} from './user-stats';\n-\n-jest.useFakeTimers('modern');\n-const PST = 'America/Los_Angeles';\n-\n-describe('user stats', () => {\n-  beforeEach(() => {\n-    // setting now to 2016-02-03T11:00:00 (PST)\n-    jest.setSystemTime(1454526000000);\n-  });\n-\n-  describe('prepUniqueDaysByHours', () => {\n-    it(\n-      'should return correct epoch when all entries fall into ' +\n-        'one day in UTC',\n-      () => {\n-        expect(\n-          prepUniqueDaysByHours([\n-            moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('8/3/2015 14:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('8/3/2015 20:00', 'M/D/YYYY H:mm').valueOf()\n-          ])\n-        ).toEqual([1438567200000]);\n-      }\n-    );\n-\n-    it('should return correct epoch when given two identical dates', () => {\n-      expect(\n-        prepUniqueDaysByHours([\n-          moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-          moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf()\n-        ])\n-      ).toEqual([1438567200000]);\n-    });\n-\n-    it('should return 2 epochs when dates fall into two days in PST', () => {\n-      expect(\n-        prepUniqueDaysByHours(\n-          [\n-            // 8/2/2015 in America/Los_Angeles\n-            moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('8/3/2015 14:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('8/3/2015 20:00', 'M/D/YYYY H:mm').valueOf()\n-          ],\n-          PST\n-        )\n-      ).toEqual([1438567200000, 1438610400000]);\n-    });\n-\n-    it('should return 3 epochs when dates fall into three days', () => {\n-      expect(\n-        prepUniqueDaysByHours([\n-          moment.utc('8/1/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-          moment.utc('3/3/2015 14:00', 'M/D/YYYY H:mm').valueOf(),\n-          moment.utc('9/30/2014 20:00', 'M/D/YYYY H:mm').valueOf()\n-        ])\n-      ).toEqual([1412107200000, 1425391200000, 1438394400000]);\n-    });\n-\n-    it(\n-      'should return same but sorted array if all input dates are ' +\n-        'start of day',\n-      () => {\n-        expect(\n-          prepUniqueDaysByHours([1438387200000, 1425340800000, 1412035200000])\n-        ).toEqual([1412035200000, 1425340800000, 1438387200000]);\n-      }\n-    );\n-  });\n-\n-  describe('calcCurrentStreak', function () {\n-    it('should return 1 day when today one challenge was completed', () => {\n-      expect(\n-        calcCurrentStreak(\n-          prepUniqueDaysByHours([\n-            moment.utc(moment.utc().subtract(1, 'hours')).valueOf()\n-          ])\n-        )\n-      ).toEqual(1);\n-    });\n-\n-    it(\n-      'should return 1 day when today more than one challenge ' +\n-        'was completed',\n-      () => {\n-        expect(\n-          calcCurrentStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc(moment.utc().subtract(1, 'hours')).valueOf(),\n-              moment.utc(moment.utc().subtract(1, 'hours')).valueOf()\n-            ])\n-          )\n-        ).toEqual(1);\n-      }\n-    );\n-\n-    it('should return 0 days when today 0 challenges were completed', () => {\n-      expect(\n-        calcCurrentStreak(\n-          prepUniqueDaysByHours([\n-            moment.utc('9/11/2015 4:00', 'M/D/YYYY H:mm').valueOf()\n-          ])\n-        )\n-      ).toEqual(0);\n-    });\n-\n-    it(\n-      'should return 2 days when today and yesterday challenges were ' +\n-        'completed',\n-      () => {\n-        expect(\n-          calcCurrentStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc(moment.utc().subtract(1, 'days')).valueOf(),\n-              moment.utc(moment.utc().subtract(1, 'hours')).valueOf()\n-            ])\n-          )\n-        ).toEqual(2);\n-      }\n-    );\n-\n-    it(\n-      'should return 3 when today and for two days before user was ' + 'active',\n-      () => {\n-        expect(\n-          calcCurrentStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/11/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/12/2015 1:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/12/2015 1:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/12/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/12/2015 3:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/13/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/14/2015 5:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc(moment.utc().subtract(2, 'days')).valueOf(),\n-              moment.utc(moment.utc().subtract(1, 'days')).valueOf(),\n-              moment.utc(moment.utc().subtract(1, 'hours')).valueOf()\n-            ])\n-          )\n-        ).toEqual(3);\n-      }\n-    );\n-\n-    it(\n-      'should return 1 when there is a 1.5 day long break and ' +\n-        'dates fall into two days separated by third',\n-      () => {\n-        expect(\n-          calcCurrentStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc(moment.utc().subtract(47, 'hours')).valueOf(),\n-              moment.utc(moment.utc().subtract(11, 'hours')).valueOf()\n-            ])\n-          )\n-        ).toEqual(1);\n-      }\n-    );\n-\n-    it(\n-      'should return 2 when the break is more than 1.5 days ' +\n-        'but dates fall into two consecutive days',\n-      () => {\n-        expect(\n-          calcCurrentStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc(moment.utc().subtract(40, 'hours')).valueOf(),\n-              moment.utc(moment.utc().subtract(1, 'hours')).valueOf()\n-            ])\n-          )\n-        ).toEqual(2);\n-      }\n-    );\n-\n-    it(\n-      'should return correct count in default timezone UTC ' +\n-        'given `undefined` timezone',\n-      () => {\n-        expect(\n-          calcCurrentStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc(moment.utc().subtract(1, 'hours')).valueOf(),\n-              moment.utc(moment.utc().subtract(1, 'hours')).valueOf()\n-            ])\n-          )\n-        ).toEqual(1);\n-      }\n-    );\n-\n-    it(\n-      'should return 2 days when today and yesterday ' +\n-        'challenges were completed given PST',\n-      () => {\n-        expect(\n-          calcCurrentStreak(\n-            prepUniqueDaysByHours(\n-              [\n-                moment.utc(moment.utc().subtract(1, 'days')).valueOf(),\n-                moment.utc(moment.utc().subtract(1, 'hours')).valueOf()\n-              ],\n-              PST\n-            ),\n-            PST\n-          )\n-        ).toEqual(2);\n-      }\n-    );\n-\n-    it(\n-      'should return 17 when there is no break in given timezone ' +\n-        '(but would be the break if in UTC)',\n-      () => {\n-        expect(\n-          calcCurrentStreak(\n-            prepUniqueDaysByHours(\n-              [\n-                1453174506164,\n-                1453175436725,\n-                1453252466853,\n-                1453294968225,\n-                1453383782844,\n-                1453431903117,\n-                1453471373080,\n-                1453594733026,\n-                1453645014058,\n-                1453746762747,\n-                1453747659197,\n-                1453748029416,\n-                1453818029213,\n-                1453951796007,\n-                1453988570615,\n-                1454069704441,\n-                1454203673979,\n-                1454294055498,\n-                1454333545125,\n-                1454415163903,\n-                1454519128123,\n-                moment.tz(PST).valueOf()\n-              ],\n-              PST\n-            ),\n-            PST\n-          )\n-        ).toEqual(17);\n-      }\n-    );\n-\n-    it(\n-      'should return 4 when there is a break in UTC ' +\n-        '(but would be no break in PST)',\n-      () => {\n-        expect(\n-          calcCurrentStreak(\n-            prepUniqueDaysByHours([\n-              1453174506164,\n-              1453175436725,\n-              1453252466853,\n-              1453294968225,\n-              1453383782844,\n-              1453431903117,\n-              1453471373080,\n-              1453594733026,\n-              1453645014058,\n-              1453746762747,\n-              1453747659197,\n-              1453748029416,\n-              1453818029213,\n-              1453951796007,\n-              1453988570615,\n-              1454069704441,\n-              1454203673979,\n-              1454294055498,\n-              1454333545125,\n-              1454415163903,\n-              1454519128123,\n-              moment.utc().valueOf()\n-            ])\n-          )\n-        ).toEqual(4);\n-      }\n-    );\n-  });\n-\n-  describe('calcLongestStreak', function () {\n-    it(\n-      'should return 1 when there is the only one one-day-long ' +\n-        'streak available',\n-      () => {\n-        expect(\n-          calcLongestStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc('9/12/2015 4:00', 'M/D/YYYY H:mm').valueOf()\n-            ])\n-          )\n-        ).toEqual(1);\n-      }\n-    );\n-\n-    it(\n-      'should return 4 when there is the only one ' +\n-        'more-than-one-days-long streak available',\n-      () => {\n-        expect(\n-          calcLongestStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc('9/11/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/12/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/13/2015 3:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/14/2015 1:00', 'M/D/YYYY H:mm').valueOf()\n-            ])\n-          )\n-        ).toEqual(4);\n-      }\n-    );\n-\n-    it(\n-      'should return 1 when there is only one one-day-long streak ' +\n-        'and it is today',\n-      () => {\n-        expect(\n-          calcLongestStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc(moment.utc().subtract(1, 'hours')).valueOf()\n-            ])\n-          )\n-        ).toEqual(1);\n-      }\n-    );\n-\n-    it('should return 2 when yesterday and today makes longest streak', () => {\n-      expect(\n-        calcLongestStreak(\n-          prepUniqueDaysByHours([\n-            moment.utc(moment.utc().subtract(1, 'days')).valueOf(),\n-            moment.utc(moment.utc().subtract(1, 'hours')).valueOf()\n-          ])\n-        )\n-      ).toEqual(2);\n-    });\n-\n-    it('should return 4 when there is a month long break', () => {\n-      expect(\n-        calcLongestStreak(\n-          prepUniqueDaysByHours([\n-            moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('9/11/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('9/12/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('10/4/2015 1:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('10/5/2015 5:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('10/6/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('10/7/2015 5:00', 'M/D/YYYY H:mm').valueOf(),\n-            moment.utc('11/3/2015 2:00', 'M/D/YYYY H:mm').valueOf()\n-          ])\n-        )\n-      ).toEqual(4);\n-    });\n-\n-    it(\n-      'should return 2 when there is a more than 1.5 days ' +\n-        'long break of (36 hours)',\n-      () => {\n-        expect(\n-          calcLongestStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/11/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/12/2015 15:30', 'M/D/YYYY H:mm').valueOf(),\n-              moment\n-                .utc(\n-                  moment\n-                    .utc('9/12/2015 15:30', 'M/D/YYYY H:mm')\n-                    .add(37, 'hours')\n-                )\n-                .valueOf(),\n-              moment.utc('9/14/2015 22:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/15/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('10/3/2015 2:00', 'M/D/YYYY H:mm').valueOf()\n-            ])\n-          )\n-        ).toEqual(2);\n-      }\n-    );\n-\n-    it(\n-      'should return 4 when the longest streak consist of ' +\n-        'several same day timestamps',\n-      () => {\n-        expect(\n-          calcLongestStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/11/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/12/2015 1:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/12/2015 1:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/12/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/12/2015 3:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/13/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/14/2015 5:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc(moment.utc().subtract(2, 'days')).valueOf(),\n-              moment.utc(moment.utc().subtract(1, 'days')).valueOf(),\n-              moment.utc().valueOf()\n-            ])\n-          )\n-        ).toEqual(4);\n-      }\n-    );\n-\n-    it(\n-      'should return 4 when there are several longest streaks ' +\n-        '(same length)',\n-      () => {\n-        expect(\n-          calcLongestStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc('8/3/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/11/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/12/2015 1:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/13/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/14/2015 5:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('10/11/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('10/12/2015 1:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('10/13/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('10/14/2015 5:00', 'M/D/YYYY H:mm').valueOf()\n-            ])\n-          )\n-        ).toEqual(4);\n-      }\n-    );\n-\n-    it(\n-      'should return correct longest streak when there is a very ' +\n-        'long period',\n-      () => {\n-        let cals = [];\n-        const n = 100;\n-        for (let i = 0; i < n; i++) {\n-          cals.push(moment.utc(moment.utc().subtract(i, 'days')).valueOf());\n-        }\n-\n-        expect(calcLongestStreak(prepUniqueDaysByHours(cals))).toEqual(n);\n-      }\n-    );\n-\n-    it(\n-      'should return correct longest streak in default timezone ' +\n-        'UTC given `undefined` timezone',\n-      () => {\n-        expect(\n-          calcLongestStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc(moment.utc().subtract(1, 'days')).valueOf(),\n-              moment.utc(moment.utc().subtract(1, 'hours')).valueOf()\n-            ])\n-          )\n-        ).toEqual(2);\n-      }\n-    );\n-\n-    it(\n-      'should return 4 when there is the only one more-than-one-days-long ' +\n-        'streak available given PST',\n-      () => {\n-        expect(\n-          calcLongestStreak(\n-            prepUniqueDaysByHours([\n-              moment.utc('9/11/2015 4:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/12/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/13/2015 3:00', 'M/D/YYYY H:mm').valueOf(),\n-              moment.utc('9/14/2015 1:00', 'M/D/YYYY H:mm').valueOf()\n-            ]),\n-            PST\n-          )\n-        ).toEqual(4);\n-      }\n-    );\n-\n-    it(\n-      'should return 3 when longest streak is 3 in PST ' +\n-        '(but would be different in default timezone UTC)',\n-      () => {\n-        expect(\n-          calcLongestStreak(\n-            prepUniqueDaysByHours(\n-              [\n-                moment.utc('9/11/2015 23:00', 'M/D/YYYY H:mm').valueOf(),\n-                moment.utc('9/12/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-                moment.utc('9/13/2015 2:00', 'M/D/YYYY H:mm').valueOf(),\n-                moment.utc('9/14/2015 6:00', 'M/D/YYYY H:mm').valueOf()\n-              ],\n-              PST\n-            ),\n-            PST\n-          )\n-        ).toEqual(3);\n-      }\n-    );\n-\n-    it(\n-      'should return 17 when there is no break in PST ' +\n-        '(but would be break in UTC) and it is current',\n-      () => {\n-        expect(\n-          calcLongestStreak(\n-            prepUniqueDaysByHours(\n-              [\n-                1453174506164,\n-                1453175436725,\n-                1453252466853,\n-                1453294968225,\n-                1453383782844,\n-                1453431903117,\n-                1453471373080,\n-                1453594733026,\n-                1453645014058,\n-                1453746762747,\n-                1453747659197,\n-                1453748029416,\n-                1453818029213,\n-                1453951796007,\n-                1453988570615,\n-                1454069704441,\n-                1454203673979,\n-                1454294055498,\n-                1454333545125,\n-                1454415163903,\n-                1454519128123,\n-                moment.tz(PST).valueOf()\n-              ],\n-              PST\n-            ),\n-            PST\n-          )\n-        ).toEqual(17);\n-      }\n-    );\n-\n-    it(\n-      'should return a streak of 4 when there is a break in UTC ' +\n-        '(but no break in PST)',\n-      () => {\n-        expect(\n-          calcLongestStreak(\n-            prepUniqueDaysByHours([\n-              1453174506164,\n-              1453175436725,\n-              1453252466853,\n-              1453294968225,\n-              1453383782844,\n-              1453431903117,\n-              1453471373080,\n-              1453594733026,\n-              1453645014058,\n-              1453746762747,\n-              1453747659197,\n-              1453748029416,\n-              1453818029213,\n-              1453951796007,\n-              1453988570615,\n-              1454069704441,\n-              1454203673979,\n-              1454294055498,\n-              1454333545125,\n-              1454415163903,\n-              1454519128123,\n-              moment.utc().valueOf()\n-            ])\n-          )\n-        ).toEqual(4);\n-      }\n-    );\n-  });\n-\n-  describe('getUserById', () => {\n-    const stubUser = {\n-      findById(id, cb) {\n-        cb(null, { id: 123 });\n-      }\n-    };\n-    it('returns a promise', () => {\n-      expect.assertions(3);\n-      expect(typeof getUserById('123', stubUser).then).toEqual('function');\n-      expect(typeof getUserById('123', stubUser).catch).toEqual('function');\n-      expect(typeof getUserById('123', stubUser).finally).toEqual('function');\n-    });\n-\n-    it('resolves a user for a given id', done => {\n-      expect.assertions(4);\n-      getUserById(mockUserID, mockApp.models.User)\n-        .then(user => {\n-          expect(user).toEqual(mockUser);\n-\n-          expect(user).toHaveProperty('progressTimestamps');\n-          expect(user).toHaveProperty('completedChallengeCount');\n-          expect(user).toHaveProperty('completedChallenges');\n-        })\n-        .then(done)\n-        .catch(done);\n-    });\n-\n-    it('throws when no user is found', done => {\n-      const noUserError = new Error('No user found');\n-      const throwyUserModel = {\n-        findById(_, cb) {\n-          cb(noUserError);\n-        }\n-      };\n-      expect(\n-        getUserById('not-a-real-id', throwyUserModel).catch(error => {\n-          expect(error).toEqual(noUserError);\n-          done();\n-        })\n-      );\n-    });\n-  });\n-});"
        },
        {
            "sha": "7532e8d5ac1f43be5abf304011ea5e4d24713736",
            "filename": "api-server/src/server/utils/validators.js",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fvalidators.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Futils%2Fvalidators.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Futils%2Fvalidators.js?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,30 +0,0 @@\n-// Refer : http://stackoverflow.com/a/430240/1932901\n-function trimTags(value) {\n-  const tagBody = '(?:[^\"\\'>]|\"[^\"]*\"|\\'[^\\']*\\')*';\n-  const tagOrComment = new RegExp(\n-    '<(?:' +\n-      // Comment body.\n-      '!--(?:(?:-*[^->])*--+|-?)' +\n-      // Special \"raw text\" elements whose content should be elided.\n-      '|script\\\\b' +\n-      tagBody +\n-      '>[\\\\s\\\\S]*?</script\\\\s*' +\n-      '|style\\\\b' +\n-      tagBody +\n-      '>[\\\\s\\\\S]*?</style\\\\s*' +\n-      // Regular name\n-      '|/?[a-z]' +\n-      tagBody +\n-      ')>',\n-    'gi'\n-  );\n-  let rawValue;\n-  do {\n-    rawValue = value;\n-    value = value.replace(tagOrComment, '');\n-  } while (value !== rawValue);\n-\n-  return value.replace(/</g, '&lt;');\n-}\n-\n-export { trimTags };"
        },
        {
            "sha": "c851133c28de0644600cf1a67ef188bec2c81bf3",
            "filename": "api-server/src/server/views/emails/a-new-user.ejs",
            "status": "removed",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fa-new-user.ejs",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fa-new-user.ejs",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fa-new-user.ejs?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,9 +0,0 @@\n-Camper <%= username %> has completed all six certifications! Completed\n-Responsive Web Design Certification on <%= responsiveWebDesignDate %>. Completed\n-Front End Development Libraries Certification on <%= frontEndLibrariesDate %>.\n-Completed JavaScript Algorithms and Data Structures Certification on <%=\n-javascriptAlgorithmsDataStructuresDate %>. Completed Data Visualization\n-Certification on <%= dataVisualizationDate %>. Completed API's and microservices\n-Certification on <%= apisMicroservicesDate %>. Completed Information Security\n-and Quality Assurance Certification on <%= infosecQADate %>.\n-https://www.freecodecamp.org/<%= username %>"
        },
        {
            "sha": "fad385ea3d43fc19386a91ab54914a9ca56fa259",
            "filename": "api-server/src/server/views/emails/certified.ejs",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fcertified.ejs",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fcertified.ejs",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fcertified.ejs?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,15 +0,0 @@\n-Hi <%= name || username %>,\n-\n-Congratulations on completing all of the freeCodeCamp certifications!\n-\n-All of your certifications are now live at at: https://www.freecodecamp.org/<%= username %>\n-\n-Please tell me a bit more about you and your near-term goals.\n-\n-Are you interested in contributing to our open source projects used by nonprofits?\n-\n-Also, check out https://contribute.freecodecamp.org/ for some fun and convenient ways you can contribute to the community.\n-\n-Happy coding,\n-\n-- Quincy Larson, teacher at freeCodeCamp"
        },
        {
            "sha": "71c9f87870c0d56a6d80840d2aa5c94df01d95ef",
            "filename": "api-server/src/server/views/emails/user-request-sign-in.ejs",
            "status": "removed",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fuser-request-sign-in.ejs",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fuser-request-sign-in.ejs",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fuser-request-sign-in.ejs?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,9 +0,0 @@\n-Here's your sign in link. It will instantly sign you into freeCodeCamp.org - no password necessary:\n-\n-<%= host %>/passwordless-auth/?email=<%= loginEmail %>&token=<%= loginToken %>\n-\n-Note: this sign in link will expire after 15 minutes. If you need a new sign in link, go to https://www.freecodecamp.org/signin\n-\n-See you soon!\n-\n-- The freeCodeCamp.org Team"
        },
        {
            "sha": "42f3b140edb1ea8700c5585aa29f7fe09ab27c49",
            "filename": "api-server/src/server/views/emails/user-request-sign-up.ejs",
            "status": "removed",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fuser-request-sign-up.ejs",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fuser-request-sign-up.ejs",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fuser-request-sign-up.ejs?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,13 +0,0 @@\n-Welcome to the freeCodeCamp community!\n-\n-We have created a new account for you.\n-\n-Here's your sign in link. It will instantly sign you into freeCodeCamp.org - no password necessary:\n-\n-<%= host %>/passwordless-auth/?email=<%= loginEmail %>&token=<%= loginToken %>\n-\n-Note: this sign in link will expire after 15 minutes. If you need a new sign in link, go to https://www.freecodecamp.org/signin\n-\n-See you soon!\n-\n-- The freeCodeCamp.org Team"
        },
        {
            "sha": "383237169010b2fa3bb83f7bff39a077f3bce351",
            "filename": "api-server/src/server/views/emails/user-request-update-email.ejs",
            "status": "removed",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fuser-request-update-email.ejs",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fuser-request-update-email.ejs",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fviews%2Femails%2Fuser-request-update-email.ejs?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -1,7 +0,0 @@\n-Please confirm this email address for freeCodeCamp.org:\n-\n-<%= host %>/confirm-email?email=<%= loginEmail %>&token=<%= loginToken %>&emailChange=<%= emailChange %>\n-\n-Happy coding!\n-\n-- The freeCodeCamp.org Team"
        },
        {
            "sha": "7a3893ea64b126ae0946882376d16f3b4671fc62",
            "filename": "api/package.json",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/api%2Fpackage.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/api%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fpackage.json?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -69,7 +69,6 @@\n   \"scripts\": {\n     \"build\": \"tsc -p tsconfig.build.json\",\n     \"clean\": \"rm -rf dist\",\n-    \"dev\": \"pnpm develop\",\n     \"develop\": \"tsx watch --clear-screen=false src/server.ts\",\n     \"start\": \"FREECODECAMP_NODE_ENV=production node dist/server.js\",\n     \"test\": \"jest --force-exit\","
        },
        {
            "sha": "682ff094010dc395cda8482d2076855b4f739150",
            "filename": "babel.config.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/babel.config.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/babel.config.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/babel.config.js?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -1,3 +1,3 @@\n module.exports = {\n-  babelrcRoots: ['./api-server', './client']\n+  babelrcRoots: ['./client']\n };"
        },
        {
            "sha": "7d46d91462188a55afd42e48f9ce40d8a30633ba",
            "filename": "eslint.config.mjs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/eslint.config.mjs",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/eslint.config.mjs",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/eslint.config.mjs?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -32,7 +32,6 @@ export default tseslint.config(\n       'client/static/**/*',\n       'client/.cache/**/*',\n       'client/public/**/*',\n-      'api-server/**/*',\n       'shared/**/*.js',\n       'docs/**/*.md',\n       '**/playwright*.config.ts',"
        },
        {
            "sha": "7cef17b8799d7eed2bcfca0967ac6636c3e24944",
            "filename": "jest.config.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/jest.config.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/jest.config.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/jest.config.js?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -18,7 +18,7 @@ module.exports = {\n   transform: {\n     '^.+\\\\.[jt]sx?$': '<rootDir>/jest.transform.js'\n   },\n-  roots: ['.', './client', './api-server'],\n+  roots: ['.', './client'],\n   transformIgnorePatterns: ['node_modules/.pnpm/(?!(nanoid|uuid)@)'],\n   setupFilesAfterEnv: ['./jest.setup.js'],\n   testEnvironment: 'jsdom',"
        },
        {
            "sha": "0ae08f87490888855c02dc735028fe03b48648fc",
            "filename": "knip.jsonc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/knip.jsonc",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/knip.jsonc",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/knip.jsonc?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -1,7 +1,6 @@\n {\n   \"$schema\": \"https://cdn.jsdelivr.net/npm/knip@5/schema.json\",\n   \"ignoreBinaries\": [\"create:shared\", \"install-puppeteer\", \"pm2\"],\n-  \"ignoreWorkspaces\": [\"api-server\"], // Ignored based on https://github.com/freeCodeCamp/freeCodeCamp/pull/52330#issuecomment-1807917235\n   \"workspaces\": {\n     \".\": {\n       \"playwright\": [\"playwright.config.ts\"],"
        },
        {
            "sha": "adc46dc788bf009b14aa4d0af171c0c1ee7e4f7a",
            "filename": "package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/package.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/package.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/package.json?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -26,7 +26,7 @@\n     \"build-workers\": \"cd ./client && pnpm run prebuild\",\n     \"build:client\": \"cd ./client && pnpm run build\",\n     \"build:curriculum\": \"cd ./curriculum && pnpm run build\",\n-    \"build:server\": \"cd ./api-server && pnpm run build\",\n+    \"build:api\": \"cd ./api && pnpm run build\",\n     \"challenge-editor\": \"npm-run-all -p challenge-editor:*\",\n     \"challenge-editor:client\": \"cd ./tools/challenge-editor/client && pnpm start\",\n     \"challenge-editor:server\": \"cd ./tools/challenge-editor/api && pnpm start\",\n@@ -36,14 +36,13 @@\n     \"clean:client\": \"cd ./client && pnpm run clean\",\n     \"clean:curriculum\": \"rm -rf ./shared/config/curriculum.json\",\n     \"clean:packages\": \"find . -name 'node_modules' -type d -prune -exec rm -rf '{}' +\",\n-    \"clean:server\": \"rm -rf ./api-server/lib\",\n     \"create:shared\": \"tsc -p shared\",\n     \"create-new-project\": \"cd ./tools/challenge-helper-scripts/ && pnpm run create-project\",\n     \"create-new-quiz\": \"cd ./tools/challenge-helper-scripts/ && pnpm run create-quiz\",\n     \"predevelop\": \"npm-run-all -p create:shared -s build:curriculum\",\n     \"develop\": \"npm-run-all -p develop:*\",\n     \"develop:client\": \"cd ./client && pnpm run develop\",\n-    \"develop:server\": \"cd ./api-server && pnpm run develop\",\n+    \"develop:api\": \"cd ./api && pnpm run develop\",\n     \"format\": \"run-s format:eslint format:prettier\",\n     \"format:eslint\": \"eslint . --fix\",\n     \"format:prettier\": \"prettier --write .\",\n@@ -69,8 +68,6 @@\n     \"serve:client\": \"cd ./client && pnpm run serve\",\n     \"serve:client-ci\": \"cd ./client && pnpm run serve-ci\",\n     \"start\": \"npm-run-all create:shared -p develop:server serve:client\",\n-    \"start-ci\": \"npm-run-all create:shared -p start:server serve:client-ci\",\n-    \"start:server\": \"pm2 start api-server/ecosystem.config.js\",\n     \"test\": \"NODE_OPTIONS='--max-old-space-size=7168' run-s create:shared build:curriculum build-workers test:*\",\n     \"test:source\": \"jest\",\n     \"test:api\": \"cd api && jest --force-exit\",\n@@ -79,7 +76,6 @@\n     \"test-client\": \"jest client\",\n     \"test-config\": \"jest config\",\n     \"test-curriculum-js\": \"jest curriculum\",\n-    \"test-server\": \"jest api-server\",\n     \"test-tools\": \"jest tools\",\n     \"test-utils\": \"jest utils\",\n     \"prepare\": \"husky\","
        },
        {
            "sha": "e621a49c88f59c8336b75a98406e11b82832d1c3",
            "filename": "pnpm-lock.yaml",
            "status": "modified",
            "additions": 23,
            "deletions": 3182,
            "changes": 3205,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/pnpm-lock.yaml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/pnpm-lock.yaml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/pnpm-lock.yaml?ref=16e461385e385f7740a0874aa122bac7275b2f66"
        },
        {
            "sha": "989a1c773c37d2f64b89f0343e903a85ea21214d",
            "filename": "pnpm-workspace.yaml",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/pnpm-workspace.yaml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/pnpm-workspace.yaml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/pnpm-workspace.yaml?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -1,6 +1,5 @@\n packages:\n   - 'api'\n-  - 'api-server'\n   - 'client'\n   - 'curriculum'\n   - 'shared'"
        },
        {
            "sha": "382786796e1acd67cc19f595375d4295099419ef",
            "filename": "tools/scripts/lint/validate-keys.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 9,
            "changes": 15,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/16e461385e385f7740a0874aa122bac7275b2f66/tools%2Fscripts%2Flint%2Fvalidate-keys.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/16e461385e385f7740a0874aa122bac7275b2f66/tools%2Fscripts%2Flint%2Fvalidate-keys.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscripts%2Flint%2Fvalidate-keys.ts?ref=16e461385e385f7740a0874aa122bac7275b2f66",
            "patch": "@@ -70,37 +70,34 @@ const readComponentCode = (filePath: string): string => {\n const clientCodebase: string = readComponentCode(\n   path.join(process.cwd() + '/src')\n );\n-const serverCodebase: string = readComponentCode(\n-  path.join(process.cwd() + '/../api-server/src/server')\n-);\n \n for (const key of translationKeys) {\n-  if (!clientCodebase.includes(key) && !serverCodebase.includes(key)) {\n+  if (!clientCodebase.includes(key)) {\n     console.warn(`The translation key '${key}' appears to be unused.`);\n   }\n }\n for (const key of motivationKeys) {\n-  if (!clientCodebase.includes(key) && !serverCodebase.includes(key)) {\n+  if (!clientCodebase.includes(key)) {\n     console.warn(`The motivation key '${key}' appears to be unused.`);\n   }\n }\n for (const key of metaKeys) {\n-  if (!clientCodebase.includes(key) && !serverCodebase.includes(key)) {\n+  if (!clientCodebase.includes(key)) {\n     console.warn(`The meta key '${key}' appears to be unused.`);\n   }\n }\n for (const key of introKeys) {\n-  if (!clientCodebase.includes(key) && !serverCodebase.includes(key)) {\n+  if (!clientCodebase.includes(key)) {\n     console.warn(`The intro key '${key}' appears to be unused.`);\n   }\n }\n for (const key of trendingKeys) {\n-  if (!clientCodebase.includes(key) && !serverCodebase.includes(key)) {\n+  if (!clientCodebase.includes(key)) {\n     console.warn(`The trending key '${key}' appears to be unused.`);\n   }\n }\n for (const key of linksKeys) {\n-  if (!clientCodebase.includes(key) && !serverCodebase.includes(key)) {\n+  if (!clientCodebase.includes(key)) {\n     console.warn(`The links key '${key}' appears to be unused.`);\n   }\n }"
        }
    ],
    "stats": {
        "total": 14662,
        "additions": 152,
        "deletions": 14510
    }
}