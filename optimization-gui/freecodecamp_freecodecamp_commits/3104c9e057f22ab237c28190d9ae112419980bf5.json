{
    "author": "a2937",
    "message": "feat: test page structure (#59113)\n\nCo-authored-by: Naomi <accounts+github@nhcarrigan.com>\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "3104c9e057f22ab237c28190d9ae112419980bf5",
    "files": [
        {
            "sha": "0b982110cbdf0c0127ce0447b56364958b3551f8",
            "filename": "tools/challenge-parser/parser/__fixtures__/with-subsection.md",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3104c9e057f22ab237c28190d9ae112419980bf5/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-subsection.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3104c9e057f22ab237c28190d9ae112419980bf5/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-subsection.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-subsection.md?ref=3104c9e057f22ab237c28190d9ae112419980bf5",
            "patch": "@@ -0,0 +1,19 @@\n+# --description--\n+\n+Paragraph 1\n+\n+```html\n+code example\n+```\n+\n+## --not-allowed--\n+\n+should not be allowed\n+\n+# --instructions--\n+\n+Paragraph 0\n+\n+```html\n+code example 0\n+```"
        },
        {
            "sha": "d9bcc4c48f3395bf2d3871c5735564d8c13e5aa5",
            "filename": "tools/challenge-parser/parser/plugins/add-text.js",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3104c9e057f22ab237c28190d9ae112419980bf5/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-text.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3104c9e057f22ab237c28190d9ae112419980bf5/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-text.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-text.js?ref=3104c9e057f22ab237c28190d9ae112419980bf5",
            "patch": "@@ -1,5 +1,7 @@\n const { isEmpty } = require('lodash');\n-const { getSection } = require('./utils/get-section');\n+const find = require('unist-util-find');\n+const { root } = require('mdast-builder');\n+const { getSection, isMarker } = require('./utils/get-section');\n const mdastToHTML = require('./utils/mdast-to-html');\n \n function addText(sectionIds) {\n@@ -9,6 +11,13 @@ function addText(sectionIds) {\n   function transformer(tree, file) {\n     for (const sectionId of sectionIds) {\n       const textNodes = getSection(tree, `--${sectionId}--`);\n+      const subSection = find(root(textNodes), isMarker);\n+      if (subSection) {\n+        throw Error(\n+          `The --${sectionId}-- section should not have any subsections. Found subsection ${subSection.children[0].value}`\n+        );\n+      }\n+\n       const sectionText = mdastToHTML(textNodes);\n \n       if (!isEmpty(sectionText)) {"
        },
        {
            "sha": "804c2309859287d5033e7afcbb31ded80544c47b",
            "filename": "tools/challenge-parser/parser/plugins/add-text.test.js",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3104c9e057f22ab237c28190d9ae112419980bf5/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-text.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3104c9e057f22ab237c28190d9ae112419980bf5/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-text.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-text.test.js?ref=3104c9e057f22ab237c28190d9ae112419980bf5",
            "patch": "@@ -2,7 +2,7 @@ const parseFixture = require('../__fixtures__/parse-fixture');\n const addText = require('./add-text');\n \n describe('add-text', () => {\n-  let realisticAST, mockAST;\n+  let realisticAST, mockAST, withSubSectionAST;\n   const descriptionId = 'description';\n   const instructionsId = 'instructions';\n   const missingId = 'missing';\n@@ -11,6 +11,7 @@ describe('add-text', () => {\n   beforeAll(async () => {\n     realisticAST = await parseFixture('realistic.md');\n     mockAST = await parseFixture('simple.md');\n+    withSubSectionAST = await parseFixture('with-subsection.md');\n   });\n \n   beforeEach(() => {\n@@ -43,6 +44,16 @@ describe('add-text', () => {\n     }).toThrow(expectedError);\n   });\n \n+  it('throws when there is a sub-section in one of the sections', () => {\n+    const plugin = addText([instructionsId, descriptionId]);\n+\n+    expect(() => {\n+      plugin(withSubSectionAST, file);\n+    }).toThrow(\n+      'The --description-- section should not have any subsections. Found subsection --not-allowed--'\n+    );\n+  });\n+\n   it('should add a string relating to the section id to `file.data`', () => {\n     const plugin = addText([descriptionId]);\n     plugin(mockAST, file);"
        },
        {
            "sha": "326afbc5564d6a9a846f0534be28c8fdc53c05a9",
            "filename": "tools/challenge-parser/parser/plugins/utils/get-section.js",
            "status": "modified",
            "additions": 15,
            "deletions": 17,
            "changes": 32,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3104c9e057f22ab237c28190d9ae112419980bf5/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Fget-section.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3104c9e057f22ab237c28190d9ae112419980bf5/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Fget-section.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Fget-section.js?ref=3104c9e057f22ab237c28190d9ae112419980bf5",
            "patch": "@@ -4,27 +4,25 @@ const findAllAfter = require('unist-util-find-all-after');\n const between = require('unist-util-find-all-between');\n const { findAll } = require('./find-all');\n \n+const isMarker = node => {\n+  if (node.children && node.children[0]) {\n+    const child = node.children[0];\n+    return (\n+      child.type === 'text' &&\n+      child.value.startsWith('--') &&\n+      child.value.endsWith('--') &&\n+      node.type === 'heading'\n+    );\n+  }\n+  return false;\n+};\n+\n function _getSection(tree) {\n   return start => {\n     if (!start) return [];\n \n     const isEnd = node => {\n-      return (\n-        node.type === 'heading' && node.depth <= start.depth && isMarker(node)\n-      );\n-    };\n-\n-    const isMarker = node => {\n-      if (node.children && node.children[0]) {\n-        const child = node.children[0];\n-        return (\n-          child.type === 'text' &&\n-          child.value.startsWith('--') &&\n-          child.value.endsWith('--')\n-        );\n-      } else {\n-        return false;\n-      }\n+      return node.depth <= start.depth && isMarker(node);\n     };\n \n     const end = findAfter(tree, start, isEnd);\n@@ -56,4 +54,4 @@ function getAllSections(tree, marker) {\n   return starts.map(_getSection(tree));\n }\n \n-module.exports = { getSection, getAllSections };\n+module.exports = { getSection, getAllSections, isMarker };"
        }
    ],
    "stats": {
        "total": 75,
        "additions": 56,
        "deletions": 19
    }
}