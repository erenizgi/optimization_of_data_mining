{
    "author": "a2937",
    "message": "fix(tools): make create-challenge-helper prioritize full stack curriculum (#59644)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "392f7f805eb48f44ab6bb995a2363f47c6395336",
    "files": [
        {
            "sha": "fc91c428e67c1a91bdd68d09504dae2c67492a3b",
            "filename": "tools/challenge-helper-scripts/create-project.ts",
            "status": "modified",
            "additions": 223,
            "deletions": 31,
            "changes": 254,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/392f7f805eb48f44ab6bb995a2363f47c6395336/tools%2Fchallenge-helper-scripts%2Fcreate-project.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/392f7f805eb48f44ab6bb995a2363f47c6395336/tools%2Fchallenge-helper-scripts%2Fcreate-project.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-helper-scripts%2Fcreate-project.ts?ref=392f7f805eb48f44ab6bb995a2363f47c6395336",
            "patch": "@@ -1,19 +1,25 @@\n+import { existsSync } from 'fs';\n import fs from 'fs/promises';\n import path from 'path';\n import { prompt } from 'inquirer';\n import { format } from 'prettier';\n import ObjectID from 'bson-objectid';\n \n+import fullStackData from '../../curriculum/structure/superblocks/full-stack-developer.json';\n import { SuperBlocks } from '../../shared/config/curriculum';\n+import { BlockLayouts, BlockTypes } from '../../shared/config/blocks';\n import {\n   getContentConfig,\n   writeBlockStructure\n } from '../../curriculum/file-handler';\n import { superBlockToFilename } from '../../curriculum/build-curriculum';\n-import { createStepFile, validateBlockName } from './utils';\n+import { createQuizFile, createStepFile, validateBlockName } from './utils';\n import { getBaseMeta } from './helpers/get-base-meta';\n import { createIntroMD } from './helpers/create-intro';\n-import { updateSimpleSuperblockStructure } from './helpers/create-project';\n+import {\n+  updateChapterModuleSuperblockStructure,\n+  updateSimpleSuperblockStructure\n+} from './helpers/create-project';\n \n const helpCategories = [\n   'HTML-CSS',\n@@ -41,34 +47,103 @@ interface CreateProjectArgs {\n   superBlock: SuperBlocks;\n   block: string;\n   helpCategory: string;\n-  order: number;\n+  blockType?: string;\n+  blockLayout?: string;\n+  questionCount?: number;\n+  order?: number;\n+  chapter?: string;\n+  position?: number;\n+  module?: string;\n   title?: string;\n }\n \n-async function createProject(\n-  superBlock: SuperBlocks,\n-  block: string,\n-  helpCategory: string,\n-  order: number,\n-  title?: string\n-) {\n-  if (!title) {\n-    title = block;\n+async function createProject(projectArgs: CreateProjectArgs) {\n+  if (!projectArgs.title) {\n+    projectArgs.title = projectArgs.block;\n   }\n-  void updateIntroJson(superBlock, block, title);\n \n-  const challengeId = await createFirstChallenge(superBlock, block);\n-  void createMetaJson(block, title, helpCategory, challengeId);\n+  const order = projectArgs.order;\n+  const chapter = projectArgs.chapter;\n+  const module = projectArgs.module;\n+  const position = projectArgs.position;\n+\n   const superblockFilename = (\n     superBlockToFilename as Record<SuperBlocks, string>\n-  )[superBlock];\n-  // TODO: handle full-stack-developer (createProjects needs calling with a\n-  // chapter and module name as well)\n-  if (superBlock !== SuperBlocks.FullStackDeveloper) {\n-    void updateSimpleSuperblockStructure(block, { order }, superblockFilename);\n+  )[projectArgs.superBlock];\n+\n+  if (projectArgs.superBlock === SuperBlocks.FullStackDeveloper) {\n+    if (!chapter || !module || typeof position == 'undefined') {\n+      throw Error(\n+        'Missing one of the following arguments: chapter, module, position'\n+      );\n+    }\n+    void updateChapterModuleSuperblockStructure(\n+      projectArgs.block,\n+      { order: position, chapter, module },\n+      superblockFilename\n+    );\n+  } else {\n+    if (typeof order == 'undefined') {\n+      throw Error('Missing argument: order');\n+    }\n+    void updateSimpleSuperblockStructure(\n+      projectArgs.block,\n+      { order },\n+      superblockFilename\n+    );\n+  }\n+\n+  void updateIntroJson(\n+    projectArgs.superBlock,\n+    projectArgs.block,\n+    projectArgs.title\n+  );\n+\n+  if (projectArgs.blockType === BlockTypes.quiz) {\n+    if (projectArgs.questionCount == null) {\n+      throw new Error(\n+        'Property `questionCount` is null when creating new Quiz Challenge'\n+      );\n+    }\n+    const challengeId = await createQuizChallenge(\n+      projectArgs.block,\n+      projectArgs.title,\n+      projectArgs.questionCount\n+    );\n+    void createMetaJson(\n+      projectArgs.superBlock,\n+      projectArgs.block,\n+      projectArgs.title,\n+      projectArgs.helpCategory,\n+      challengeId\n+    );\n+  } else {\n+    const challengeId = await createFirstChallenge(projectArgs.block);\n+    void createMetaJson(\n+      projectArgs.superBlock,\n+      projectArgs.block,\n+      projectArgs.title,\n+      projectArgs.helpCategory,\n+      challengeId,\n+      projectArgs.order,\n+      projectArgs.blockType,\n+      projectArgs.blockLayout\n+    );\n+    // TODO: remove once we stop relying on markdown in the client.\n   }\n-  // TODO: remove once we stop relying on markdown in the client.\n-  void createIntroMD(superBlock, block, title);\n+\n+  if (\n+    (projectArgs.superBlock === SuperBlocks.FullStackDeveloper &&\n+      projectArgs.blockType) == null\n+  ) {\n+    throw new Error('Missing argument: blockType when updating intro markdown');\n+  }\n+\n+  void createIntroMD(\n+    projectArgs.superBlock,\n+    projectArgs.block,\n+    projectArgs.title\n+  );\n }\n \n async function updateIntroJson(\n@@ -83,7 +158,7 @@ async function updateIntroJson(\n   const newIntro = await parseJson<IntroJson>(introJsonPath);\n   newIntro[superBlock].blocks[block] = {\n     title,\n-    intro: ['', '']\n+    intro: [title, '']\n   };\n   void withTrace(\n     fs.writeFile,\n@@ -93,12 +168,24 @@ async function updateIntroJson(\n }\n \n async function createMetaJson(\n+  superBlock: SuperBlocks,\n   block: string,\n   title: string,\n   helpCategory: string,\n-  challengeId: ObjectID\n+  challengeId: ObjectID,\n+  order?: number,\n+  blockType?: string,\n+  blockLayout?: string\n ) {\n-  const newMeta = getBaseMeta('Step');\n+  let newMeta;\n+  if (superBlock === SuperBlocks.FullStackDeveloper) {\n+    newMeta = getBaseMeta('FullStack');\n+    newMeta.blockType = blockType;\n+    newMeta.blockLayout = blockLayout;\n+  } else {\n+    newMeta = getBaseMeta('Step');\n+    newMeta.order = order;\n+  }\n   newMeta.name = title;\n   newMeta.dashedName = block;\n   newMeta.helpCategory = helpCategory;\n@@ -108,10 +195,7 @@ async function createMetaJson(\n   await writeBlockStructure(block, newMeta);\n }\n \n-async function createFirstChallenge(\n-  superBlock: SuperBlocks,\n-  block: string\n-): Promise<ObjectID> {\n+async function createFirstChallenge(block: string): Promise<ObjectID> {\n   const { blockContentDir } = getContentConfig('english') as {\n     blockContentDir: string;\n   };\n@@ -138,6 +222,26 @@ async function createFirstChallenge(\n   });\n }\n \n+async function createQuizChallenge(\n+  block: string,\n+  title: string,\n+  questionCount: number\n+): Promise<ObjectID> {\n+  const newChallengeDir = path.resolve(\n+    __dirname,\n+    `../../curriculum/challenges/english/${block}`\n+  );\n+  if (!existsSync(newChallengeDir)) {\n+    await withTrace(fs.mkdir, newChallengeDir);\n+  }\n+  return createQuizFile({\n+    projectPath: newChallengeDir + '/',\n+    title: title,\n+    dashedName: block,\n+    questionCount: questionCount\n+  });\n+}\n+\n function parseJson<JsonSchema>(filePath: string) {\n   return withTrace(fs.readFile, filePath, 'utf8').then(\n     // unfortunately, withTrace does not correctly infer that the third argument\n@@ -162,7 +266,7 @@ void prompt([\n   {\n     name: 'superBlock',\n     message: 'Which certification does this belong to?',\n-    default: SuperBlocks.RespWebDesign,\n+    default: SuperBlocks.FullStackDeveloper,\n     type: 'list',\n     choices: Object.values(SuperBlocks)\n   },\n@@ -185,6 +289,74 @@ void prompt([\n     type: 'list',\n     choices: helpCategories\n   },\n+  {\n+    name: 'blockType',\n+    message: 'Choose a block type',\n+    default: BlockTypes.lab,\n+    type: 'list',\n+    choices: Object.values(BlockTypes),\n+    when: (answers: CreateProjectArgs) =>\n+      answers.superBlock === SuperBlocks.FullStackDeveloper\n+  },\n+  {\n+    name: 'blockLayout',\n+    message: 'Choose a block layout',\n+\n+    default: (answers: { blockType: BlockTypes }) =>\n+      answers.blockType == BlockTypes.quiz\n+        ? BlockLayouts.Link\n+        : BlockLayouts.ChallengeList,\n+    type: 'list',\n+    choices: Object.values(BlockLayouts),\n+    when: (answers: CreateProjectArgs) =>\n+      answers.superBlock === SuperBlocks.FullStackDeveloper\n+  },\n+  {\n+    name: 'questionCount',\n+    message: 'Choose a question count',\n+    default: 20,\n+    type: 'list',\n+    choices: [10, 20],\n+    when: (answers: CreateProjectArgs) => answers.blockType === BlockTypes.quiz\n+  },\n+  {\n+    name: 'chapter',\n+    message:\n+      'What chapter in full-stack.json should this full stack project go in?',\n+    default: 'html',\n+    type: 'list',\n+    choices: fullStackData.chapters.map(x => x.dashedName),\n+    when: (answers: CreateProjectArgs) =>\n+      answers.superBlock === SuperBlocks.FullStackDeveloper\n+  },\n+  {\n+    name: 'module',\n+    message:\n+      'What module in full-stack.json should this full stack project go in?',\n+    default: 'html',\n+    type: 'list',\n+    choices: (answers: CreateProjectArgs) =>\n+      fullStackData.chapters\n+        .find(x => x.dashedName === answers.chapter)\n+        ?.modules.map(x => x.dashedName),\n+    when: (answers: CreateProjectArgs) =>\n+      answers.superBlock === SuperBlocks.FullStackDeveloper\n+  },\n+  {\n+    name: 'position',\n+    message: 'At which position does this appear in the module?',\n+    default: 1,\n+    validate: (position: string) => {\n+      return parseInt(position, 10) > 0\n+        ? true\n+        : 'Position must be an number greater than zero.';\n+    },\n+    when: (answers: CreateProjectArgs) =>\n+      answers.superBlock === SuperBlocks.FullStackDeveloper,\n+    filter: (position: string) => {\n+      return parseInt(position, 10);\n+    }\n+  },\n   {\n     name: 'order',\n     message: 'Which position does this appear in the certificate?',\n@@ -194,6 +366,8 @@ void prompt([\n         ? true\n         : 'Order must be an number greater than zero.';\n     },\n+    when: (answers: CreateProjectArgs) =>\n+      answers.superBlock !== SuperBlocks.FullStackDeveloper,\n     filter: (order: string) => {\n       return parseInt(order, 10);\n     }\n@@ -205,9 +379,27 @@ void prompt([\n       block,\n       title,\n       helpCategory,\n+      blockType,\n+      blockLayout,\n+      questionCount,\n+      chapter,\n+      module,\n+      position,\n       order\n     }: CreateProjectArgs) =>\n-      await createProject(superBlock, block, helpCategory, order, title)\n+      await createProject({\n+        superBlock,\n+        block,\n+        helpCategory,\n+        blockType,\n+        blockLayout,\n+        questionCount,\n+        title,\n+        chapter,\n+        module,\n+        position,\n+        order\n+      })\n   )\n   .then(() =>\n     console.log("
        },
        {
            "sha": "3270acde620a4dc3f3e25cefe6f77e672b170fac",
            "filename": "tools/challenge-helper-scripts/helpers/get-base-meta.ts",
            "status": "modified",
            "additions": 31,
            "deletions": 2,
            "changes": 33,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/392f7f805eb48f44ab6bb995a2363f47c6395336/tools%2Fchallenge-helper-scripts%2Fhelpers%2Fget-base-meta.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/392f7f805eb48f44ab6bb995a2363f47c6395336/tools%2Fchallenge-helper-scripts%2Fhelpers%2Fget-base-meta.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-helper-scripts%2Fhelpers%2Fget-base-meta.ts?ref=392f7f805eb48f44ab6bb995a2363f47c6395336",
            "patch": "@@ -1,5 +1,23 @@\n-const baseMeta = {\n+interface Meta {\n+  name: string;\n+  isUpcomingChange: boolean;\n+  dashedName: string;\n+  superBlock: string;\n+  helpCategory: string;\n+  challengeOrder: Array<{\n+    id: string;\n+    title: string;\n+  }>;\n+  usesMultifileEditor?: boolean;\n+  hasEditableBoundaries?: boolean;\n+  blockType?: string;\n+  blockLayout?: string;\n+  order?: number;\n+}\n+\n+const baseMeta: Meta = {\n   name: '',\n+  superBlock: '',\n   isUpcomingChange: true,\n   dashedName: '',\n   helpCategory: '',\n@@ -18,6 +36,13 @@ const stepMeta = {\n   hasEditableBoundaries: true\n };\n \n+const fullStackStepMeta = {\n+  ...baseMeta,\n+  blockType: '',\n+  blockLayout: '',\n+  usesMultifileEditor: true\n+};\n+\n const quizMeta = {\n   ...baseMeta,\n   blockType: 'quiz',\n@@ -29,12 +54,16 @@ const languageMeta = {\n   blockLayout: 'dialogue-grid'\n };\n \n-export const getBaseMeta = (projectType: 'Step' | 'Quiz' | 'Language') => {\n+export const getBaseMeta = (\n+  projectType: 'Step' | 'Quiz' | 'Language' | 'FullStack'\n+): Meta => {\n   switch (projectType) {\n     case 'Step':\n       return stepMeta;\n     case 'Quiz':\n       return quizMeta;\n+    case 'FullStack':\n+      return fullStackStepMeta;\n     case 'Language':\n       return languageMeta;\n     default:"
        },
        {
            "sha": "41e8fb7b5d978b826e758d3c4a14976bbb3e2bf5",
            "filename": "tools/challenge-helper-scripts/helpers/project-metadata.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/392f7f805eb48f44ab6bb995a2363f47c6395336/tools%2Fchallenge-helper-scripts%2Fhelpers%2Fproject-metadata.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/392f7f805eb48f44ab6bb995a2363f47c6395336/tools%2Fchallenge-helper-scripts%2Fhelpers%2Fproject-metadata.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-helper-scripts%2Fhelpers%2Fproject-metadata.ts?ref=392f7f805eb48f44ab6bb995a2363f47c6395336",
            "patch": "@@ -1,5 +1,4 @@\n import path from 'path';\n-\n import {\n   getBlockStructure,\n   writeBlockStructure"
        }
    ],
    "stats": {
        "total": 288,
        "additions": 254,
        "deletions": 34
    }
}