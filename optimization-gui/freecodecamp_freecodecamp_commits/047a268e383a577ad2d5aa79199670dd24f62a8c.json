{
    "author": "ojeytonwilliams",
    "message": "fix(client): fake sign in after donating (#61710)",
    "sha": "047a268e383a577ad2d5aa79199670dd24f62a8c",
    "files": [
        {
            "sha": "a0fa1675fed4991fdd93582259aad3812c77861c",
            "filename": "client/src/components/growth-book/growth-book-wrapper.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/047a268e383a577ad2d5aa79199670dd24f62a8c/client%2Fsrc%2Fcomponents%2Fgrowth-book%2Fgrowth-book-wrapper.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/047a268e383a577ad2d5aa79199670dd24f62a8c/client%2Fsrc%2Fcomponents%2Fgrowth-book%2Fgrowth-book-wrapper.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fgrowth-book%2Fgrowth-book-wrapper.tsx?ref=047a268e383a577ad2d5aa79199670dd24f62a8c",
            "patch": "@@ -126,11 +126,7 @@ const GrowthBookWrapper = ({\n         clientLocal: clientLocale\n       };\n \n-      // Needs more checks as the user object is not empty but user is not signed in\n-      const isSignedIn =\n-        user && user.completedChallenges && user.email && user.joinDate;\n-\n-      if (isSignedIn) {\n+      if (user) {\n         userAttributes = {\n           ...userAttributes,\n           staff: user.email.includes('@freecodecamp'),"
        },
        {
            "sha": "3a34991639abebe1f072828dc8d728069bbd25d8",
            "filename": "client/src/redux/donation-saga.js",
            "status": "modified",
            "additions": 9,
            "deletions": 12,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/047a268e383a577ad2d5aa79199670dd24f62a8c/client%2Fsrc%2Fredux%2Fdonation-saga.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/047a268e383a577ad2d5aa79199670dd24f62a8c/client%2Fsrc%2Fredux%2Fdonation-saga.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fdonation-saga.js?ref=047a268e383a577ad2d5aa79199670dd24f62a8c",
            "patch": "@@ -179,17 +179,14 @@ function* stripeCardErrorHandler(\n   }\n }\n \n-export function* setDonationCookie() {\n-  if (document?.cookie) {\n-    const isDonating = yield select(isDonatingSelector);\n-    const isDonorCookieSet = document.cookie\n-      .split(';')\n-      .some(item => item.trim().startsWith('isDonor=true'));\n-    if (isDonating) {\n-      if (!isDonorCookieSet) {\n-        document.cookie = 'isDonor=true';\n-      }\n-    }\n+export function* setDonationCookieIfDonating() {\n+  const isDonating = yield select(isDonatingSelector);\n+  if (isDonating) setDonationCookie();\n+}\n+\n+export function setDonationCookie() {\n+  if (document) {\n+    document.cookie = 'isDonor=true';\n   }\n }\n \n@@ -211,7 +208,7 @@ export function createDonationSaga(types) {\n   return [\n     takeEvery(types.tryToShowDonationModal, showDonateModalSaga),\n     takeLeading(types.postCharge, postChargeSaga),\n-    takeEvery(types.fetchUserComplete, setDonationCookie),\n+    takeEvery(types.fetchUserComplete, setDonationCookieIfDonating),\n     takeLeading(types.updateCard, updateCardSaga)\n   ];\n }"
        },
        {
            "sha": "e061abd5bb8fe80f06211815803a97363df35893",
            "filename": "client/src/redux/index.js",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/047a268e383a577ad2d5aa79199670dd24f62a8c/client%2Fsrc%2Fredux%2Findex.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/047a268e383a577ad2d5aa79199670dd24f62a8c/client%2Fsrc%2Fredux%2Findex.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Findex.js?ref=047a268e383a577ad2d5aa79199670dd24f62a8c",
            "patch": "@@ -152,16 +152,15 @@ export const reducer = handleActions(\n       donationFormState: { ...defaultDonationFormState, processing: true }\n     }),\n     [actionTypes.postChargeComplete]: state => {\n+      const sessionUser = state.user.sessionUser\n+        ? { ...state.user.sessionUser, isDonating: true }\n+        : null;\n       return {\n         ...state,\n         user: {\n           ...state.user,\n-          sessionUser: {\n-            ...state.user.sessionUser,\n-            isDonating: true\n-          }\n+          sessionUser\n         },\n-\n         donationFormState: { ...defaultDonationFormState, success: true }\n       };\n     },"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 14,
        "deletions": 22
    }
}