{
    "author": "ojeytonwilliams",
    "message": "fix(client): compute step number from challenge order (#57209)",
    "sha": "594ee9af58d684789fccc8b19670aab52e1ff724",
    "files": [
        {
            "sha": "1befe4290d4cf5992885107da036dcd348f465bb",
            "filename": "client/src/redux/prop-types.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/594ee9af58d684789fccc8b19670aab52e1ff724/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/594ee9af58d684789fccc8b19670aab52e1ff724/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fprop-types.ts?ref=594ee9af58d684789fccc8b19670aab52e1ff724",
            "patch": "@@ -152,7 +152,7 @@ export interface PrerequisiteChallenge {\n   slug?: string;\n }\n \n-export type ChallengeWithCompletedNode = {\n+export type ExtendedChallenge = {\n   block: string;\n   challengeType: number;\n   dashedName: string;\n@@ -163,6 +163,7 @@ export type ChallengeWithCompletedNode = {\n   isCompleted: boolean;\n   order: number;\n   superBlock: SuperBlocks;\n+  stepNumber: number;\n   title: string;\n };\n "
        },
        {
            "sha": "2bf2c85e1f0c6759b3ff8090b7d8768598cd0575",
            "filename": "client/src/templates/Introduction/components/block.tsx",
            "status": "modified",
            "additions": 22,
            "deletions": 14,
            "changes": 36,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/594ee9af58d684789fccc8b19670aab52e1ff724/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fblock.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/594ee9af58d684789fccc8b19670aab52e1ff724/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fblock.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fblock.tsx?ref=594ee9af58d684789fccc8b19670aab52e1ff724",
            "patch": "@@ -7,6 +7,7 @@ import { bindActionCreators, Dispatch } from 'redux';\n import { createSelector } from 'reselect';\n import { Spacer } from '@freecodecamp/ui';\n \n+import { challengeTypes } from '../../../../../shared/config/challenge-types';\n import { SuperBlocks } from '../../../../../shared/config/curriculum';\n import envData from '../../../../config/env.json';\n import { isAuditedSuperBlock } from '../../../../../shared/utils/is-audited';\n@@ -83,16 +84,23 @@ class Block extends Component<BlockProps> {\n     } = this.props;\n \n     let completedCount = 0;\n+    let stepNumber = 0;\n \n-    const challengesWithCompleted = challenges.map(challenge => {\n+    const extendedChallenges = challenges.map(challenge => {\n       const { id } = challenge;\n       const isCompleted = completedChallengeIds.some(\n         (completedChallengeId: string) => completedChallengeId === id\n       );\n       if (isCompleted) {\n         completedCount++;\n       }\n-      return { ...challenge, isCompleted };\n+      // Dialogues are interwoven with other challenges in the curriculum, but\n+      // are not considered to be steps.\n+      if (challenge.challengeType !== challengeTypes.dialogue) {\n+        stepNumber++;\n+      }\n+\n+      return { ...challenge, isCompleted, stepNumber };\n     });\n \n     const isProjectBlock = challenges.some(challenge => {\n@@ -118,17 +126,17 @@ class Block extends Component<BlockProps> {\n     const expandText = t('intro:misc-text.expand');\n     const collapseText = t('intro:misc-text.collapse');\n \n-    const isBlockCompleted = completedCount === challengesWithCompleted.length;\n+    const isBlockCompleted = completedCount === extendedChallenges.length;\n \n     const percentageCompleted = Math.floor(\n-      (completedCount / challengesWithCompleted.length) * 100\n+      (completedCount / extendedChallenges.length) * 100\n     );\n \n     const courseCompletionStatus = () => {\n       if (completedCount === 0) {\n         return t('learn.not-started');\n       }\n-      if (completedCount === challengesWithCompleted.length) {\n+      if (completedCount === extendedChallenges.length) {\n         return t('learn.completed');\n       }\n       return `${percentageCompleted}% ${t('learn.completed')}`;\n@@ -174,19 +182,19 @@ class Block extends Component<BlockProps> {\n               <span\n                 aria-hidden='true'\n                 className='map-completed-count'\n-              >{`${completedCount}/${challengesWithCompleted.length}`}</span>\n+              >{`${completedCount}/${extendedChallenges.length}`}</span>\n               <span className='sr-only'>\n                 ,{' '}\n                 {t('learn.challenges-completed', {\n                   completedCount,\n-                  totalChallenges: challengesWithCompleted.length\n+                  totalChallenges: extendedChallenges.length\n                 })}\n               </span>\n             </div>\n           </button>\n           {isExpanded && (\n             <Challenges\n-              challengesWithCompleted={challengesWithCompleted}\n+              challenges={extendedChallenges}\n               isProjectBlock={isProjectBlock}\n             />\n           )}\n@@ -218,7 +226,7 @@ class Block extends Component<BlockProps> {\n           </div>\n           <BlockIntros intros={blockIntroArr} />\n           <Challenges\n-            challengesWithCompleted={challengesWithCompleted}\n+            challenges={extendedChallenges}\n             isProjectBlock={isProjectBlock}\n           />\n         </div>\n@@ -258,7 +266,7 @@ class Block extends Component<BlockProps> {\n             <div id={`${block}-panel`}>\n               <BlockIntros intros={blockIntroArr} />\n               <Challenges\n-                challengesWithCompleted={challengesWithCompleted}\n+                challenges={extendedChallenges}\n                 isProjectBlock={isProjectBlock}\n                 isGridMap={true}\n                 blockTitle={blockTitle}\n@@ -301,7 +309,7 @@ class Block extends Component<BlockProps> {\n                 onClick={() => {\n                   this.handleBlockClick();\n                 }}\n-                to={challengesWithCompleted[0].fields.slug}\n+                to={extendedChallenges[0].fields.slug}\n               >\n                 <CheckMark isCompleted={isBlockCompleted} />\n                 {blockTitle}{' '}\n@@ -351,7 +359,7 @@ class Block extends Component<BlockProps> {\n           {isExpanded && (\n             <div id={`${block}-panel`}>\n               <Challenges\n-                challengesWithCompleted={challengesWithCompleted}\n+                challenges={extendedChallenges}\n                 isProjectBlock={isProjectBlock}\n               />\n             </div>\n@@ -386,7 +394,7 @@ class Block extends Component<BlockProps> {\n                 onClick={() => {\n                   this.handleBlockClick();\n                 }}\n-                to={challengesWithCompleted[0].fields.slug}\n+                to={extendedChallenges[0].fields.slug}\n               >\n                 <CheckMark isCompleted={isBlockCompleted} />\n                 {blockType && <BlockLabel blockType={blockType} />}\n@@ -433,7 +441,7 @@ class Block extends Component<BlockProps> {\n           {isExpanded && (\n             <div id={`${block}-panel`} className='challenge-grid-block-panel'>\n               <Challenges\n-                challengesWithCompleted={challengesWithCompleted}\n+                challenges={extendedChallenges}\n                 isProjectBlock={isProjectBlock}\n                 isGridMap={true}\n                 blockTitle={blockTitle}"
        },
        {
            "sha": "696e30eb8009c2de6b59a0cf6a6a4ae90662a5f9",
            "filename": "client/src/templates/Introduction/components/challenges.tsx",
            "status": "modified",
            "additions": 11,
            "deletions": 21,
            "changes": 32,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/594ee9af58d684789fccc8b19670aab52e1ff724/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fchallenges.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/594ee9af58d684789fccc8b19670aab52e1ff724/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fchallenges.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fchallenges.tsx?ref=594ee9af58d684789fccc8b19670aab52e1ff724",
            "patch": "@@ -3,20 +3,14 @@ import { withTranslation, useTranslation } from 'react-i18next';\n \n import GreenNotCompleted from '../../../assets/icons/green-not-completed';\n import GreenPass from '../../../assets/icons/green-pass';\n-import { ChallengeWithCompletedNode } from '../../../redux/prop-types';\n+import { ExtendedChallenge } from '../../../redux/prop-types';\n import { SuperBlocks } from '../../../../../shared/config/curriculum';\n import { challengeTypes } from '../../../../../shared/config/challenge-types';\n import { Link } from '../../../components/helpers';\n import { ButtonLink } from '../../../components/helpers/button-link';\n \n-const getStepNumber = (dashedName: string) => {\n-  // dashedName should be in the format 'step-1' or 'task-1'\n-  const match = dashedName.match(/-(\\d+)/);\n-  return match ? match[1] : '';\n-};\n-\n interface Challenges {\n-  challengesWithCompleted: ChallengeWithCompletedNode[];\n+  challenges: ExtendedChallenge[];\n   isProjectBlock: boolean;\n   isGridMap?: boolean;\n   blockTitle?: string | null;\n@@ -25,11 +19,7 @@ interface Challenges {\n const CheckMark = ({ isCompleted }: { isCompleted: boolean }) =>\n   isCompleted ? <GreenPass /> : <GreenNotCompleted />;\n \n-const Challenge = ({\n-  challenge\n-}: {\n-  challenge: ChallengeWithCompletedNode;\n-}) => (\n+const Challenge = ({ challenge }: { challenge: ExtendedChallenge }) => (\n   <Link to={challenge.fields.slug}>\n     <span className='map-badge'>\n       <CheckMark isCompleted={challenge.isCompleted} />\n@@ -38,7 +28,7 @@ const Challenge = ({\n   </Link>\n );\n \n-const Project = ({ challenge }: { challenge: ChallengeWithCompletedNode }) => (\n+const Project = ({ challenge }: { challenge: ExtendedChallenge }) => (\n   <Link to={challenge.fields.slug}>\n     {challenge.title}\n     <span className='map-badge map-project-checkmark'>\n@@ -48,18 +38,18 @@ const Project = ({ challenge }: { challenge: ChallengeWithCompletedNode }) => (\n );\n \n function Challenges({\n-  challengesWithCompleted,\n+  challenges,\n   isProjectBlock,\n   isGridMap = false,\n   blockTitle\n }: Challenges): JSX.Element {\n   const { t } = useTranslation();\n \n-  const firstIncompleteChallenge = challengesWithCompleted.find(\n+  const firstIncompleteChallenge = challenges.find(\n     challenge => !challenge.isCompleted\n   );\n \n-  const isChallengeStarted = !!challengesWithCompleted.find(\n+  const isChallengeStarted = !!challenges.find(\n     challenge => challenge.isCompleted\n   );\n \n@@ -78,14 +68,14 @@ function Challenges({\n       <nav\n         aria-label={\n           blockTitle\n-            ? challengesWithCompleted[0].superBlock === SuperBlocks.A2English\n+            ? challenges[0].superBlock === SuperBlocks.A2English\n               ? t('aria.dialogues-and-tasks-for', { blockTitle })\n               : t('aria.steps-for', { blockTitle })\n             : t('aria.steps')\n         }\n       >\n         <ul className={`map-challenges-ul map-challenges-grid `}>\n-          {challengesWithCompleted.map(challenge => (\n+          {challenges.map(challenge => (\n             <li\n               className={`map-challenge-title map-challenge-title-grid ${\n                 isProjectBlock\n@@ -111,7 +101,7 @@ function Challenges({\n                       ? t('aria.task')\n                       : t('aria.step')}\n                   </span>\n-                  <span>{getStepNumber(challenge.dashedName)}</span>\n+                  <span>{challenge.stepNumber}</span>\n                   <span className='sr-only'>\n                     {challenge.isCompleted\n                       ? t('icons.passed')\n@@ -130,7 +120,7 @@ function Challenges({\n     </>\n   ) : (\n     <ul className={`map-challenges-ul`}>\n-      {challengesWithCompleted.map(challenge => (\n+      {challenges.map(challenge => (\n         <li\n           className={`map-challenge-title ${\n             isProjectBlock ? 'map-project-wrap' : 'map-challenge-wrap'"
        }
    ],
    "stats": {
        "total": 71,
        "additions": 35,
        "deletions": 36
    }
}