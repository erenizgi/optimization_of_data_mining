{
    "author": "ahmaxed",
    "message": "fix: reduce premature skipping of donation animation (#54817)\n\nCo-authored-by: Naomi <accounts+github@nhcarrigan.com>",
    "sha": "72e10e59b592671be2546b5acdacd68f88937bee",
    "files": [
        {
            "sha": "d7cad27a064b8237bc02fc17c27bbf8d95ad6406",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/72e10e59b592671be2546b5acdacd68f88937bee/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/72e10e59b592671be2546b5acdacd68f88937bee/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=72e10e59b592671be2546b5acdacd68f88937bee",
            "patch": "@@ -100,7 +100,6 @@\n     \"update-card\": \"Update your card\",\n     \"donate-now\": \"Donate Now\",\n     \"confirm-amount\": \"Confirm amount\",\n-    \"skip-advertisement\": \"Skip Advertisement\",\n     \"play-scene\": \"Press Play\"\n   },\n   \"landing\": {\n@@ -645,7 +644,8 @@\n     \"help-millions-learn\": \"Help millions of people learn\",\n     \"reach-goals-faster\": \"Reach your goals faster\",\n     \"remove-distractions\": \"Remove distractions\",\n-    \"animation-description\": \"This is a 20 second animated advertisement to encourage campers to become supporters of freeCodeCamp. The animation starts with a teddy bear who becomes a supporter. As a result, distracting pop-ups disappear and the bear gets to complete all of its goals. Then, it graduates and becomes an education super hero helping people around the world.\"\n+    \"animation-description\": \"This is a 20 second animated advertisement to encourage campers to become supporters of freeCodeCamp. The animation starts with a teddy bear who becomes a supporter. As a result, distracting pop-ups disappear and the bear gets to complete all of its goals. Then, it graduates and becomes an education super hero helping people around the world.\",\n+    \"animation-countdown\": \"This animation will stop after {{secondsRemaining}} seconds.\"\n   },\n   \"report\": {\n     \"sign-in\": \"You need to be signed in to report a user\","
        },
        {
            "sha": "6026952747cb427d1418377c098685d2b08581f8",
            "filename": "client/src/components/Donation/donation-modal-body.tsx",
            "status": "modified",
            "additions": 25,
            "deletions": 18,
            "changes": 43,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/72e10e59b592671be2546b5acdacd68f88937bee/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation-modal-body.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/72e10e59b592671be2546b5acdacd68f88937bee/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation-modal-body.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FDonation%2Fdonation-modal-body.tsx?ref=72e10e59b592671be2546b5acdacd68f88937bee",
            "patch": "@@ -124,16 +124,20 @@ const Benefits = ({ setShowForm }: { setShowForm: (arg: boolean) => void }) => {\n };\n \n const AnimationContainer = ({\n-  setIsAnimationVisible\n+  secondsRemaining\n }: {\n-  setIsAnimationVisible: (arg: boolean) => void;\n+  secondsRemaining: number;\n }) => {\n   const { t } = useTranslation();\n   return (\n     <>\n-      <p style={{ opacity: 0, position: 'absolute' }}>\n-        {t('donate.animation-description')}{' '}\n-      </p>\n+      <div style={{ opacity: 0, position: 'absolute' }}>\n+        <p>{t('donate.animation-description')}</p>\n+        <span aria-live='polite'>\n+          {t('donate.animation-countdown', { secondsRemaining })}\n+        </span>\n+      </div>\n+\n       <div className='donation-animation-container' aria-hidden='true'>\n         <div className='donation-animation-bullet-points'>\n           <p className='donation-animation-bullet-1'>\n@@ -150,19 +154,13 @@ const AnimationContainer = ({\n           </p>\n         </div>\n         <img\n+          key={Date.now()}\n           alt=''\n           src={donationAnimation}\n           id={'donation-animation'}\n           data-playwright-test-label='not-found-image'\n         />\n       </div>\n-      <button\n-        style={{ opacity: 0, position: 'absolute' }}\n-        className={'sr-only'}\n-        onClick={() => setIsAnimationVisible(false)}\n-      >\n-        {t('buttons.skip-advertisement')}\n-      </button>\n     </>\n   );\n };\n@@ -226,24 +224,33 @@ function DonationModalBody({\n   const [showHeaderAndFooter, setShowHeaderAndFooter] = useState(true);\n   const [isAnimationVisible, setIsAnimationVisible] = useState(true);\n   const [showForm, setShowForm] = useState(false);\n+  const [secondsRemaining, setSecondsRemaining] = useState(20);\n+\n   const handleProcessing = () => {\n     setDonationAttempted(true);\n   };\n \n   useEffect(() => {\n-    const timer = setTimeout(() => {\n-      setIsAnimationVisible(false);\n-    }, 20000); // 20000 milliseconds = 20 seconds\n+    const interval = setInterval(() => {\n+      setSecondsRemaining(prevSeconds => {\n+        if (prevSeconds > 0) {\n+          return prevSeconds - 1;\n+        } else {\n+          setIsAnimationVisible(false);\n+          clearInterval(interval);\n+          return 0;\n+        }\n+      });\n+    }, 1000);\n \n-    // Clear the timer if the component unmounts\n-    return () => clearTimeout(timer);\n+    return () => clearInterval(interval);\n   }, []);\n \n   return (\n     <Modal.Body borderless alignment='start'>\n       <div aria-live='polite' className='donation-modal'>\n         {isAnimationVisible ? (\n-          <AnimationContainer setIsAnimationVisible={setIsAnimationVisible} />\n+          <AnimationContainer secondsRemaining={secondsRemaining} />\n         ) : (\n           <BecomeASupporterConfirmation\n             recentlyClaimedBlock={recentlyClaimedBlock}"
        },
        {
            "sha": "2361324e2f3977d20167ea184d3275e90ab7d676",
            "filename": "client/src/redux/donation-saga.js",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/72e10e59b592671be2546b5acdacd68f88937bee/client%2Fsrc%2Fredux%2Fdonation-saga.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/72e10e59b592671be2546b5acdacd68f88937bee/client%2Fsrc%2Fredux%2Fdonation-saga.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fdonation-saga.js?ref=72e10e59b592671be2546b5acdacd68f88937bee",
            "patch": "@@ -43,10 +43,15 @@ const updateCardErrorMessage = i18next.t('donate.error-3');\n \n function* showDonateModalSaga() {\n   let shouldRequestDonation = yield select(shouldRequestDonationSelector);\n-  if (shouldRequestDonation) {\n+  const MODAL_SHOWN_KEY = 'modalShownTimestamp';\n+  const modalShownTimestamp = sessionStorage.getItem(MODAL_SHOWN_KEY);\n+  const isModalRecentlyShown = Date.now() - modalShownTimestamp < 20000;\n+\n+  if (shouldRequestDonation || isModalRecentlyShown) {\n     yield delay(200);\n     const recentlyClaimedBlock = yield select(recentlyClaimedBlockSelector);\n     yield put(openDonationModal());\n+    sessionStorage.setItem(MODAL_SHOWN_KEY, Date.now());\n     yield take(appTypes.closeDonationModal);\n     if (recentlyClaimedBlock) {\n       yield put(preventBlockDonationRequests());"
        }
    ],
    "stats": {
        "total": 54,
        "additions": 33,
        "deletions": 21
    }
}