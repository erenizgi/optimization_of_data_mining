{
    "author": "ojeytonwilliams",
    "message": "refactor: simplify test-evaluator (#59037)",
    "sha": "44c43e3c0a6f02018792686732c0fd1edd3ccbc0",
    "files": [
        {
            "sha": "3dd42108cc3792f816b3332f407064eec219283b",
            "filename": "tools/client-plugins/browser-scripts/test-evaluator.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 15,
            "changes": 33,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/44c43e3c0a6f02018792686732c0fd1edd3ccbc0/tools%2Fclient-plugins%2Fbrowser-scripts%2Ftest-evaluator.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/44c43e3c0a6f02018792686732c0fd1edd3ccbc0/tools%2Fclient-plugins%2Fbrowser-scripts%2Ftest-evaluator.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fclient-plugins%2Fbrowser-scripts%2Ftest-evaluator.ts?ref=44c43e3c0a6f02018792686732c0fd1edd3ccbc0",
            "patch": "@@ -1,6 +1,6 @@\n import chai from 'chai';\n import { toString as __toString } from 'lodash-es';\n-import * as helpers from '@freecodecamp/curriculum-helpers';\n+import * as curriculumHelpers from '@freecodecamp/curriculum-helpers';\n import { format as __format } from './utils/format';\n \n const ctx: Worker & typeof globalThis = self as unknown as Worker &\n@@ -80,10 +80,23 @@ const __utils = (() => {\n   };\n })();\n \n-// We freeze these two to prevent learners from getting the tester into a weird\n-// state.\n+// Fake Deep Equal dependency\n+// eslint-disable-next-line @typescript-eslint/no-unused-vars\n+const DeepEqual = (a: unknown, b: unknown) =>\n+  JSON.stringify(a) === JSON.stringify(b);\n+\n+// We can't simply import these because of how webpack names them when building\n+// the bundle. Since both assert and __helpers have to exist in the global\n+// scope, we have to declare them.\n+const assert = chai.assert;\n+const __helpers = curriculumHelpers;\n+\n+// We freeze to prevent learners from getting the tester into a weird\n+// state by modifying these objects.\n Object.freeze(self);\n Object.freeze(__utils);\n+Object.freeze(assert);\n+Object.freeze(__helpers);\n \n interface TestEvaluatorEvent extends MessageEvent {\n   data: {\n@@ -104,18 +117,8 @@ interface TestEvaluatorEvent extends MessageEvent {\n /* Run the test if there is one.  If not just evaluate the user code */\n ctx.onmessage = async (e: TestEvaluatorEvent) => {\n   /* eslint-disable @typescript-eslint/no-unused-vars */\n-  const code = (e.data?.code?.contents || '').slice();\n-  const editableContents = (e.data?.code?.editableContents || '').slice();\n-\n-  const assert = chai.assert;\n-  const __helpers = helpers;\n-  // Similarly to self and __utils, if the learner tries to modify these, weird\n-  // behavior may result. Freezing them means they get an error instead.\n-  Object.freeze(assert);\n-  Object.freeze(__helpers);\n-  // Fake Deep Equal dependency\n-  const DeepEqual = (a: unknown, b: unknown) =>\n-    JSON.stringify(a) === JSON.stringify(b);\n+  const code = e.data?.code?.contents || '';\n+  const editableContents = e.data?.code?.editableContents || '';\n \n   // Build errors should be reported, but only once:\n   __utils.toggleProxyLogger(e.data.firstTest);"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 18,
        "deletions": 15
    }
}