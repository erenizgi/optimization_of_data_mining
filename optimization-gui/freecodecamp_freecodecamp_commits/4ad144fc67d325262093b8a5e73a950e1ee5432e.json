{
    "author": "niyati34",
    "message": "fix(dev): preserve step order during hot reload by reloading all chalâ€¦ (#62048)",
    "sha": "4ad144fc67d325262093b8a5e73a950e1ee5432e",
    "files": [
        {
            "sha": "207330f7782d88e289ccd82f6047b33dd9493f53",
            "filename": "client/utils/build-challenges.js",
            "status": "modified",
            "additions": 43,
            "deletions": 17,
            "changes": 60,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4ad144fc67d325262093b8a5e73a950e1ee5432e/client%2Futils%2Fbuild-challenges.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4ad144fc67d325262093b8a5e73a950e1ee5432e/client%2Futils%2Fbuild-challenges.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Futils%2Fbuild-challenges.js?ref=4ad144fc67d325262093b8a5e73a950e1ee5432e",
            "patch": "@@ -2,43 +2,69 @@ const path = require('path');\n \n const _ = require('lodash');\n \n-const envData = require('../config/env.json');\n const { getChallengesForLang } = require('../../curriculum/get-challenges');\n \n const {\n   getContentDir,\n-  getBlockCreator\n+  getBlockCreator,\n+  getSuperblocks,\n+  superBlockToFilename\n } = require('../../curriculum/build-curriculum');\n-const { getBlockStructure } = require('../../curriculum/file-handler');\n-const { getSuperblocks } = require('../../curriculum/build-curriculum');\n+const {\n+  getBlockStructure,\n+  getSuperblockStructure\n+} = require('../../curriculum/file-handler');\n+const { transformSuperBlock } = require('../../curriculum/build-superblock');\n+const { getSuperOrder } = require('../../curriculum/utils');\n \n-const { curriculumLocale } = envData;\n+const curriculumLocale = process.env.CURRICULUM_LOCALE || 'english';\n \n exports.localeChallengesRootDir = getContentDir(curriculumLocale);\n \n const blockCreator = getBlockCreator(curriculumLocale);\n \n+function getBlockMetadata(block, superBlock) {\n+  // Compute metadata for the given block in the specified superblock\n+  const sbFilename = superBlockToFilename[superBlock];\n+  const sbData = getSuperblockStructure(sbFilename);\n+  const blocks = transformSuperBlock(sbData, {\n+    showComingSoon: process.env.SHOW_UPCOMING_CHANGES === 'true'\n+  });\n+\n+  const order = blocks.findIndex(b => b.dashedName === block);\n+  const superOrder = getSuperOrder(superBlock);\n+\n+  if (order === -1) {\n+    throw new Error(`Block ${block} not found in superblock ${superBlock}`);\n+  }\n+\n+  return { order, superOrder };\n+}\n+\n exports.replaceChallengeNodes = () => {\n   return async function replaceChallengeNodes(filePath) {\n     const parentDir = path.dirname(filePath);\n     const block = path.basename(parentDir);\n     const filename = path.basename(filePath);\n \n-    console.log(`Replacing challenge node for ${filePath}`);\n+    console.log(`Replacing challenge nodes for ${filePath}`);\n     const meta = getBlockStructure(block);\n     const superblocks = getSuperblocks(block);\n \n-    const challenge = await blockCreator.createChallenge({\n-      filename,\n-      block,\n-      meta,\n-      isAudited: true\n-    });\n-\n-    return superblocks.map(superBlock => ({\n-      ...challenge,\n-      superBlock\n-    }));\n+    // Create a challenge for each superblock containing this block\n+    const challenges = await Promise.all(\n+      superblocks.map(async superBlock => {\n+        const { order, superOrder } = getBlockMetadata(block, superBlock);\n+        return blockCreator.createChallenge({\n+          filename,\n+          block,\n+          meta: { ...meta, superBlock, order, superOrder },\n+          isAudited: true\n+        });\n+      })\n+    );\n+\n+    return challenges;\n   };\n };\n "
        },
        {
            "sha": "a646bfe2f2338e3f30c9877c16955738933b1f08",
            "filename": "tools/client-plugins/gatsby-source-challenges/gatsby-node.js",
            "status": "modified",
            "additions": 24,
            "deletions": 60,
            "changes": 84,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4ad144fc67d325262093b8a5e73a950e1ee5432e/tools%2Fclient-plugins%2Fgatsby-source-challenges%2Fgatsby-node.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4ad144fc67d325262093b8a5e73a950e1ee5432e/tools%2Fclient-plugins%2Fgatsby-source-challenges%2Fgatsby-node.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fclient-plugins%2Fgatsby-source-challenges%2Fgatsby-node.js?ref=4ad144fc67d325262093b8a5e73a950e1ee5432e",
            "patch": "@@ -1,6 +1,4 @@\n-const path = require('path');\n const chokidar = require('chokidar');\n-const readdirp = require('readdirp');\n \n const { createChallengeNode } = require('./create-challenge-nodes');\n \n@@ -36,68 +34,34 @@ exports.sourceNodes = function sourceChallengesSourceNodes(\n     cwd: curriculumPath\n   });\n \n-  watcher.on('change', filePath =>\n-    /\\.md?$/.test(filePath)\n-      ? onSourceChange(filePath)\n-          .then(challenges => {\n-            reporter.info(\n-              `\n-File changed at ${filePath}, replacing challengeNodes with ids ${challenges.map(({ id }) => id).join(', ')}\n-              `\n-            );\n-            challenges.forEach(challenge =>\n-              createVisibleChallenge(challenge, { isReloading: true })\n-            );\n-          })\n-          .catch(e =>\n-            reporter.error(`fcc-replace-challenge\n-  attempting to replace ${filePath}\n-\n-  ${e.message}\n-  ${e.stack}\n+  function handleChallengeUpdate(filePath, action = 'changed') {\n+    return onSourceChange(filePath)\n+      .then(challenges => {\n+        const actionText = action === 'added' ? 'creating' : 'replacing';\n+        reporter.info(\n+          `Challenge file ${action}: ${filePath}, ${actionText} challengeNodes with ids ${challenges.map(({ id }) => id).join(', ')}`\n+        );\n+        challenges.forEach(challenge =>\n+          createVisibleChallenge(challenge, { isReloading: true })\n+        );\n+      })\n+      .catch(e =>\n+        reporter.error(\n+          `fcc-replace-challenge\\nattempting to replace ${filePath}\\n\\n${e.message}\\n${e.stack ? `  ${e.stack}` : ''}`\n+        )\n+      );\n+  }\n \n-  `)\n-          )\n-      : null\n+  // On file change, replace only the changed challenge. The key is ensuring\n+  // onSourceChange returns a challenge with complete metadata.\n+  watcher.on('change', filePath =>\n+    /\\.md?$/.test(filePath) ? handleChallengeUpdate(filePath, 'changed') : null\n   );\n \n-  // if a file is added, that might change the order of the challenges in the\n-  // containing block, so we recreate them all\n+  // On file add, replace just the new challenge.\n   watcher.on('add', filePath => {\n-    if (/\\.md?$/.test(filePath)) {\n-      const blockPath = path.dirname(filePath);\n-      const fullBlockPath = path.join(\n-        __dirname,\n-        '../../../curriculum/challenges/english/',\n-        blockPath\n-      );\n-      readdirp(fullBlockPath, { fileFilter: '*.md' })\n-        .on('data', entry => {\n-          const { path: siblingPath } = entry;\n-          const relativePath = path.join(blockPath, siblingPath);\n-          onSourceChange(relativePath)\n-            .then(challenges => {\n-              reporter.info(\n-                `\n-File changed at ${relativePath}, replacing challengeNodes with ids ${challenges.map(({ id }) => id).join(', ')}\n-            `\n-              );\n-              challenges.forEach(challenge =>\n-                createVisibleChallenge(challenge)\n-              );\n-            })\n-            .catch(e =>\n-              reporter.error(`fcc-replace-challenge\n-attempting to replace ${relativePath}\n-\n-${e.message}\n-\n-`)\n-            );\n-        })\n-        .on('warn', error => console.error('non-fatal error', error))\n-        .on('error', error => console.error('fatal error', error));\n-    }\n+    if (!/\\.md?$/.test(filePath)) return;\n+    handleChallengeUpdate(filePath, 'added');\n   });\n \n   function sourceAndCreateNodes() {"
        }
    ],
    "stats": {
        "total": 144,
        "additions": 67,
        "deletions": 77
    }
}