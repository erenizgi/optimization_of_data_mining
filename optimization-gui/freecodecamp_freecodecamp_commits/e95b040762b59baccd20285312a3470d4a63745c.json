{
    "author": "ojeytonwilliams",
    "message": "refactor: create and use all-section parser (#56282)",
    "sha": "e95b040762b59baccd20285312a3470d4a63745c",
    "files": [
        {
            "sha": "1c826fc7c090e998de2db34fd3dc9b2d30290dfd",
            "filename": "tools/challenge-parser/parser/plugins/add-assignment.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-assignment.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-assignment.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-assignment.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -1,4 +1,4 @@\n-const getSection = require('./utils/get-section');\n+const { getSection } = require('./utils/get-section');\n \n const mdastToHtml = require('./utils/mdast-to-html');\n const { splitOnThematicBreak } = require('./utils/split-on-thematic-break');"
        },
        {
            "sha": "5647c26a6b777f122f139f9c162e2c4469364ad8",
            "filename": "tools/challenge-parser/parser/plugins/add-fill-in-the-blank.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-fill-in-the-blank.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-fill-in-the-blank.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-fill-in-the-blank.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -1,7 +1,7 @@\n const { root } = require('mdast-builder');\n const find = require('unist-util-find');\n const visit = require('unist-util-visit');\n-const getSection = require('./utils/get-section');\n+const { getSection } = require('./utils/get-section');\n const getAllBefore = require('./utils/before-heading');\n const mdastToHtml = require('./utils/mdast-to-html');\n "
        },
        {
            "sha": "468b6af72ee02bb4c90f8d775ac57f3cee2dc1ff",
            "filename": "tools/challenge-parser/parser/plugins/add-quizzes.js",
            "status": "modified",
            "additions": 8,
            "deletions": 19,
            "changes": 27,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-quizzes.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-quizzes.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-quizzes.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -1,5 +1,5 @@\n const { root } = require('mdast-builder');\n-const getSection = require('./utils/get-section');\n+const { getSection, getAllSections } = require('./utils/get-section');\n const mdastToHtml = require('./utils/mdast-to-html');\n \n const { splitOnThematicBreak } = require('./utils/split-on-thematic-break');\n@@ -10,27 +10,16 @@ function plugin() {\n     const quizzesNodes = getSection(tree, `--quizzes--`);\n \n     if (quizzesNodes.length > 0) {\n-      const quizzes = [];\n-      const quizTrees = [];\n-\n-      quizzesNodes.forEach(quizNode => {\n-        const isStartOfQuiz = quizNode.children?.[0]?.value === '--quiz--';\n-        if (isStartOfQuiz) {\n-          quizTrees.push([quizNode]);\n-        } else {\n-          quizTrees[quizTrees.length - 1].push(quizNode);\n-        }\n-      });\n+      const compiledQuizzes = [];\n+      const quizSections = getAllSections(root(quizzesNodes), `--quiz--`);\n \n-      if (quizTrees.length === 0) {\n+      if (quizSections.length === 0) {\n         throw Error(\n           'The --quizzes-- section should contain at least one quiz.'\n         );\n       }\n \n-      quizTrees.forEach(allQuizNodes => {\n-        const quizTree = root(allQuizNodes);\n-        const quizNodes = getSection(quizTree, `--quiz--`);\n+      quizSections.forEach(quizNodes => {\n         const quizQuestions = [];\n         const questionTrees = [];\n \n@@ -62,11 +51,11 @@ function plugin() {\n           );\n         });\n \n-        quizzes.push({ questions: quizQuestions });\n+        compiledQuizzes.push({ questions: quizQuestions });\n       });\n \n-      if (quizzes.length > 0) {\n-        file.data.quizzes = quizzes;\n+      if (compiledQuizzes.length > 0) {\n+        file.data.quizzes = compiledQuizzes;\n       }\n     }\n   }"
        },
        {
            "sha": "dc1251b0375b1bcc9a108e16e1f3a9f7b4251a9e",
            "filename": "tools/challenge-parser/parser/plugins/add-scene.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-scene.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-scene.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-scene.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -1,4 +1,4 @@\n-const getSection = require('./utils/get-section');\n+const { getSection } = require('./utils/get-section');\n \n function plugin() {\n   return transformer;"
        },
        {
            "sha": "0a7869c839e027409ea995f4a366f7abbd04304f",
            "filename": "tools/challenge-parser/parser/plugins/add-seed.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-seed.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-seed.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-seed.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -1,7 +1,7 @@\n const { isEmpty } = require('lodash');\n const { root } = require('mdast-builder');\n const visitChildren = require('unist-util-visit-children');\n-const getSection = require('./utils/get-section');\n+const { getSection } = require('./utils/get-section');\n const { getFileVisitor } = require('./utils/get-file-visitor');\n \n const editableRegionMarker = '--fcc-editable-region--';"
        },
        {
            "sha": "4d7e82ba0cecb4cf067e9ae857ff6f4c379e03a7",
            "filename": "tools/challenge-parser/parser/plugins/add-solution.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-solution.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-solution.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-solution.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -3,7 +3,7 @@ const { root } = require('mdast-builder');\n const visitChildren = require('unist-util-visit-children');\n \n const { editableRegionMarker } = require('./add-seed');\n-const getSection = require('./utils/get-section');\n+const { getSection } = require('./utils/get-section');\n const { getFileVisitor } = require('./utils/get-file-visitor');\n const { splitOnThematicBreak } = require('./utils/split-on-thematic-break');\n "
        },
        {
            "sha": "2776e2b0189b852bbddd973a7c85c1686b9bb95a",
            "filename": "tools/challenge-parser/parser/plugins/add-tests.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-tests.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-tests.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-tests.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -1,5 +1,5 @@\n const chunk = require('lodash/chunk');\n-const getSection = require('./utils/get-section');\n+const { getSection } = require('./utils/get-section');\n const mdastToHtml = require('./utils/mdast-to-html');\n \n function plugin() {"
        },
        {
            "sha": "07922b4dca60da7d3612d5637fb3a0bee66ce230",
            "filename": "tools/challenge-parser/parser/plugins/add-text.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-text.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-text.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-text.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -1,5 +1,5 @@\n const { isEmpty } = require('lodash');\n-const getSection = require('./utils/get-section');\n+const { getSection } = require('./utils/get-section');\n const mdastToHTML = require('./utils/mdast-to-html');\n \n function addText(sectionIds) {"
        },
        {
            "sha": "edf971bb54428d36d69ccd5992a6512eb5780413",
            "filename": "tools/challenge-parser/parser/plugins/add-video-question.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-video-question.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-video-question.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-video-question.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -1,6 +1,6 @@\n const { root } = require('mdast-builder');\n const find = require('unist-util-find');\n-const getSection = require('./utils/get-section');\n+const { getSection } = require('./utils/get-section');\n const getAllBefore = require('./utils/before-heading');\n const mdastToHtml = require('./utils/mdast-to-html');\n "
        },
        {
            "sha": "870055e8776db4c941d7af235c3696d25aef45eb",
            "filename": "tools/challenge-parser/parser/plugins/utils/find-all.js",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Ffind-all.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Ffind-all.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Ffind-all.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -0,0 +1,27 @@\n+const visit = require('unist-util-visit');\n+const _ = require('lodash');\n+\n+/**\n+ * Finds all nodes in a tree that match a given condition. This is a trivial\n+ * extension of `unist-util-find` that returns all matching nodes.\n+ *\n+ * @param {Object} tree - The unist tree to search through.\n+ * @param {Function|Object} condition - The condition to match nodes\n+ * against. This can be a function that accepts a single node argument or an object to match.\n+ * @returns {Array} An array of nodes that match the condition.\n+ */\n+function findAll(tree, condition) {\n+  const predicate = _.iteratee(condition);\n+  const results = [];\n+  visit(tree, node => {\n+    if (predicate(node)) {\n+      results.push(node);\n+    }\n+\n+    return visit.CONTINUE;\n+  });\n+\n+  return results;\n+}\n+\n+module.exports.findAll = findAll;"
        },
        {
            "sha": "19b34fdd4a10ba19378036e6685be588d2c71432",
            "filename": "tools/challenge-parser/parser/plugins/utils/find-all.test.js",
            "status": "added",
            "additions": 39,
            "deletions": 0,
            "changes": 39,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Ffind-all.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Ffind-all.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Ffind-all.test.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -0,0 +1,39 @@\n+const { findAll } = require('./find-all');\n+\n+const testTree = {\n+  type: 'root',\n+  children: [\n+    {\n+      type: 'heading',\n+      depth: 1,\n+      children: [{ type: 'text', value: 'test', testId: 1 }]\n+    },\n+    {\n+      type: 'paragraph',\n+      children: [{ type: 'text', value: 'different', testId: 2 }]\n+    },\n+    {\n+      type: 'heading',\n+      depth: 2,\n+      children: [{ type: 'text', value: 'test', testId: 3 }]\n+    },\n+    {\n+      type: 'heading',\n+      depth: 1,\n+      children: [{ type: 'text', value: 'test', testId: 4 }]\n+    }\n+  ]\n+};\n+\n+describe('findAll', () => {\n+  it('should return an array', () => {\n+    expect(findAll(testTree, _node => false)).toEqual([]);\n+  });\n+  it('should return an array of nodes that match the test', () => {\n+    expect(findAll(testTree, { type: 'text', value: 'test' })).toEqual([\n+      { type: 'text', value: 'test', testId: 1 },\n+      { type: 'text', value: 'test', testId: 3 },\n+      { type: 'text', value: 'test', testId: 4 }\n+    ]);\n+  });\n+});"
        },
        {
            "sha": "faf0414b6047347040439855ada7870d0fcba380",
            "filename": "tools/challenge-parser/parser/plugins/utils/get-section.js",
            "status": "modified",
            "additions": 44,
            "deletions": 31,
            "changes": 75,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Fget-section.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Fget-section.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Fget-section.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -2,45 +2,58 @@ const find = require('unist-util-find');\n const findAfter = require('unist-util-find-after');\n const findAllAfter = require('unist-util-find-all-after');\n const between = require('unist-util-find-all-between');\n+const { findAll } = require('./find-all');\n \n-function getSection(tree, marker) {\n-  const start = find(tree, {\n-    type: 'heading',\n-    children: [\n-      {\n-        type: 'text',\n-        value: marker\n+function _getSection(tree) {\n+  return start => {\n+    if (!start) return [];\n+\n+    const isEnd = node => {\n+      return (\n+        node.type === 'heading' && node.depth <= start.depth && isMarker(node)\n+      );\n+    };\n+\n+    const isMarker = node => {\n+      if (node.children && node.children[0]) {\n+        const child = node.children[0];\n+        return (\n+          child.type === 'text' &&\n+          child.value.startsWith('--') &&\n+          child.value.endsWith('--')\n+        );\n+      } else {\n+        return false;\n       }\n-    ]\n-  });\n+    };\n \n-  if (!start) return [];\n+    const end = findAfter(tree, start, isEnd);\n \n-  const isEnd = node => {\n-    return (\n-      node.type === 'heading' && node.depth <= start.depth && isMarker(node)\n-    );\n+    const targetNodes = end\n+      ? between(tree, start, end)\n+      : findAllAfter(tree, start);\n+    return targetNodes;\n   };\n+}\n \n-  const isMarker = node => {\n-    if (node.children && node.children[0]) {\n-      const child = node.children[0];\n-      return (\n-        child.type === 'text' &&\n-        child.value.startsWith('--') &&\n-        child.value.endsWith('--')\n-      );\n-    } else {\n-      return false;\n+const startNode = marker => ({\n+  type: 'heading',\n+  children: [\n+    {\n+      type: 'text',\n+      value: marker\n     }\n-  };\n+  ]\n+});\n \n-  const end = findAfter(tree, start, isEnd);\n+function getSection(tree, marker) {\n+  const start = find(tree, startNode(marker));\n+  return _getSection(tree)(start);\n+}\n \n-  const targetNodes = end\n-    ? between(tree, start, end)\n-    : findAllAfter(tree, start);\n-  return targetNodes;\n+function getAllSections(tree, marker) {\n+  const starts = findAll(tree, startNode(marker));\n+  return starts.map(_getSection(tree));\n }\n \n-module.exports = getSection;\n+module.exports = { getSection, getAllSections };"
        },
        {
            "sha": "40984203ba875217f222319fa613eafc3a2847f8",
            "filename": "tools/challenge-parser/parser/plugins/utils/get-section.test.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Fget-section.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e95b040762b59baccd20285312a3470d4a63745c/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Fget-section.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Futils%2Fget-section.test.js?ref=e95b040762b59baccd20285312a3470d4a63745c",
            "patch": "@@ -3,7 +3,7 @@ const { root } = require('mdast-builder');\n const find = require('unist-util-find');\n \n const parseFixture = require('../../__fixtures__/parse-fixture');\n-const getSection = require('./get-section');\n+const { getSection } = require('./get-section');\n \n describe('getSection', () => {\n   let simpleAst, extraHeadingAst;"
        }
    ],
    "stats": {
        "total": 186,
        "additions": 127,
        "deletions": 59
    }
}