{
    "author": "Sembauke",
    "message": "feat: convert c-sharp exam tests to Playwright (#54946)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "6d7ccc9b1f479965489213aa6966ccc015777cb7",
    "files": [
        {
            "sha": "a1c69826baf6c09351ad76d4e0f78d120a31d17d",
            "filename": "client/src/templates/Challenges/exam/components/foundational-c-sharp-survey-alert.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6d7ccc9b1f479965489213aa6966ccc015777cb7/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam%2Fcomponents%2Ffoundational-c-sharp-survey-alert.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6d7ccc9b1f479965489213aa6966ccc015777cb7/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam%2Fcomponents%2Ffoundational-c-sharp-survey-alert.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam%2Fcomponents%2Ffoundational-c-sharp-survey-alert.tsx?ref=6d7ccc9b1f479965489213aa6966ccc015777cb7",
            "patch": "@@ -25,7 +25,7 @@ function FoundationalCSharpSurveyAlert({\n   const { t } = useTranslation();\n \n   return (\n-    <Panel variant='info' data-cy='c-sharp-survey-alert'>\n+    <Panel variant='info' data-playwright-test-label='c-sharp-survey-alert'>\n       <Panel.Heading>{t('survey.foundational-c-sharp.title')}</Panel.Heading>\n       <Panel.Body className='text-center'>\n         <p>{t('survey.misc.two-questions')}</p>"
        },
        {
            "sha": "f90dd23e97f5ce040fa51908032f5e6055265dd1",
            "filename": "cypress/e2e/default/learn/challenges/c-sharp-exam.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 65,
            "changes": 65,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/10fae3d41be65b97169576ea1b12839becdf0983/cypress%2Fe2e%2Fdefault%2Flearn%2Fchallenges%2Fc-sharp-exam.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/10fae3d41be65b97169576ea1b12839becdf0983/cypress%2Fe2e%2Fdefault%2Flearn%2Fchallenges%2Fc-sharp-exam.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/cypress%2Fe2e%2Fdefault%2Flearn%2Fchallenges%2Fc-sharp-exam.ts?ref=10fae3d41be65b97169576ea1b12839becdf0983",
            "patch": "@@ -1,65 +0,0 @@\n-const examUrl =\n-  '/learn/foundational-c-sharp-with-microsoft/foundational-c-sharp-with-microsoft-certification-exam/foundational-c-sharp-with-microsoft-certification-exam';\n-\n-const el = {\n-  qualifiedAlert: \"[data-cy='qualified-for-exam-alert']\",\n-  surveyAlert: \"[data-cy='c-sharp-survey-alert']\",\n-  startSurveyBtn: \"[data-cy='start-csharp-survey-btn']\",\n-  submitSurveyBtn: \"[data-cy='submit-csharp-survey-btn']\",\n-  startExamBtn: \"[data-cy='start-exam-btn']\",\n-  examTime: \"[data-cy='exam-time']\",\n-  examInput: '.exam-answer-input-visible',\n-  prevQuestionBtn: \"[data-cy='previous-exam-question-btn']\",\n-  nextQuestionBtn: \"[data-cy='next-exam-question-btn']\",\n-  exitExamBtn: \"[data-cy='exit-exam-btn']\",\n-  finishExamBtn: \"[data-cy='finish-exam-btn']\"\n-};\n-\n-describe('C# Exam Challenge', () => {\n-  describe('Before completing prerequisite challenges', () => {\n-    before(() => {\n-      cy.task('seed');\n-      cy.login();\n-    });\n-\n-    it('Should show prerequisites alert and have \"start exam\" button disabled', () => {\n-      cy.visit(examUrl);\n-      cy.get(el.qualifiedAlert).should('not.exist');\n-      cy.contains(\n-        'You have not met the requirements to be eligible for the exam. To qualify, please complete the following challenges:'\n-      ).should('be.visible');\n-      cy.contains('Trophy - Write Your First Code Using C#').should(\n-        'be.visible'\n-      );\n-      cy.get(el.surveyAlert).should('not.exist');\n-      cy.get(el.startExamBtn).should('have.attr', 'aria-disabled');\n-    });\n-  });\n-\n-  describe('After completing prerequisite challenges', () => {\n-    before(() => {\n-      cy.task('seed', ['--seed-trophy-challenges']);\n-      cy.task('deleteSurveys');\n-      cy.login('trophy-user');\n-      cy.visit(examUrl);\n-    });\n-\n-    it('Should show the survey alert and be able to complete the survey', () => {\n-      cy.contains('Trophy - Write Your First Code Using C#').should(\n-        'not.exist'\n-      );\n-      cy.get(el.qualifiedAlert).should('not.exist');\n-      cy.contains(\n-        'You have not met the requirements to be eligible for the exam. To qualify, please complete the following challenges:'\n-      ).should('not.exist');\n-      cy.get(el.surveyAlert).should('be.visible');\n-      cy.get(el.startExamBtn).should('have.attr', 'aria-disabled');\n-      cy.get(el.startSurveyBtn).click();\n-      cy.contains('Foundational C# with Microsoft Survey').should('be.visible');\n-      cy.get(el.submitSurveyBtn).should('have.attr', 'aria-disabled');\n-      cy.contains('Student developer').click();\n-      cy.contains('Novice (no prior experience').click();\n-      cy.get(el.submitSurveyBtn).should('be.enabled');\n-    });\n-  });\n-});"
        },
        {
            "sha": "da010610fdd1cc409fcad70cc47551ebaa7275ae",
            "filename": "e2e/exam-survey.spec.ts",
            "status": "added",
            "additions": 39,
            "deletions": 0,
            "changes": 39,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6d7ccc9b1f479965489213aa6966ccc015777cb7/e2e%2Fexam-survey.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6d7ccc9b1f479965489213aa6966ccc015777cb7/e2e%2Fexam-survey.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fexam-survey.spec.ts?ref=6d7ccc9b1f479965489213aa6966ccc015777cb7",
            "patch": "@@ -0,0 +1,39 @@\n+import { execSync } from 'child_process';\n+import { test, expect } from '@playwright/test';\n+const url =\n+  '/learn/foundational-c-sharp-with-microsoft/foundational-c-sharp-with-microsoft-certification-exam/foundational-c-sharp-with-microsoft-certification-exam';\n+test.describe('Exam Survey', () => {\n+  test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+  test.beforeAll(() => {\n+    execSync('node ./tools/scripts/seed/seed-demo-user certified-user');\n+    execSync('node tools/scripts/seed/seed-surveys.js delete-only');\n+  });\n+\n+  test('Should show the survey alert and be able to complete the survey', async ({\n+    page\n+  }) => {\n+    await page.goto(url);\n+\n+    await expect(page.getByTestId('c-sharp-survey-alert')).toBeVisible();\n+    await page.getByRole('button', { name: 'Take the survey' }).click();\n+    await expect(page.getByRole('dialog')).toBeVisible();\n+    await expect(\n+      page.getByRole('heading', {\n+        name: 'Foundational C# with Microsoft Survey'\n+      })\n+    ).toBeVisible();\n+\n+    await page.getByText('Student developer').click();\n+    await expect(\n+      page.getByRole('button', { name: 'Submit the survey' })\n+    ).toBeDisabled();\n+\n+    await page.getByText('Novice (no prior experience)').click();\n+\n+    await page.getByRole('button', { name: 'Submit the survey' }).click();\n+\n+    await expect(page.getByTestId('flash-message')).toContainText(\n+      /Thank you. Your survey was submitted./\n+    );\n+  });\n+});"
        },
        {
            "sha": "75a82a70b8394ade11c9c5bbaed736e93c42fd07",
            "filename": "tools/scripts/seed/seed-demo-user.js",
            "status": "modified",
            "additions": 4,
            "deletions": 9,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6d7ccc9b1f479965489213aa6966ccc015777cb7/tools%2Fscripts%2Fseed%2Fseed-demo-user.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6d7ccc9b1f479965489213aa6966ccc015777cb7/tools%2Fscripts%2Fseed%2Fseed-demo-user.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscripts%2Fseed%2Fseed-demo-user.js?ref=6d7ccc9b1f479965489213aa6966ccc015777cb7",
            "patch": "@@ -1,12 +1,14 @@\n const path = require('path');\n const debug = require('debug');\n+const { MongoClient } = require('mongodb');\n+\n require('dotenv').config({ path: path.resolve(__dirname, '../../../.env') });\n-const { MongoClient, ObjectId } = require('mongodb');\n const {\n   demoUser,\n   blankUser,\n   publicUser,\n-  fullyCertifiedUser\n+  fullyCertifiedUser,\n+  userIds\n } = require('./user-data');\n \n const args = process.argv.slice(2);\n@@ -104,13 +106,6 @@ const client = new MongoClient(MONGOHQ_URL, { useNewUrlParser: true });\n const db = client.db('freecodecamp');\n const user = db.collection('user');\n \n-const userIds = [\n-  new ObjectId('5fa2db00a25c1c1fa49ce067'),\n-  new ObjectId('5bd30e0f1caf6ac3ddddddb5'),\n-  new ObjectId('5bd30e0f1caf6ac3ddddddb9'),\n-  new ObjectId('663b839b24a8b29f57728b13')\n-];\n-\n const dropUserTokens = async function () {\n   await db.collection('UserToken').deleteMany({\n     userId: {"
        },
        {
            "sha": "f9258d9626833837a5a9cd75c0297f40433f32e1",
            "filename": "tools/scripts/seed/seed-surveys.js",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6d7ccc9b1f479965489213aa6966ccc015777cb7/tools%2Fscripts%2Fseed%2Fseed-surveys.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6d7ccc9b1f479965489213aa6966ccc015777cb7/tools%2Fscripts%2Fseed%2Fseed-surveys.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscripts%2Fseed%2Fseed-surveys.js?ref=6d7ccc9b1f479965489213aa6966ccc015777cb7",
            "patch": "@@ -1,8 +1,10 @@\n const path = require('path');\n const debug = require('debug');\n-require('dotenv').config({ path: path.resolve(__dirname, '../../../.env') });\n const { MongoClient, ObjectId } = require('mongodb');\n \n+const { userIds } = require('./user-data');\n+require('dotenv').config({ path: path.resolve(__dirname, '../../../.env') });\n+\n const args = process.argv.slice(2);\n \n const allowedArgs = ['delete-only'];\n@@ -81,11 +83,7 @@ const run = async () => {\n   const db = client.db('freecodecamp');\n   const survey = db.collection('Survey');\n \n-  await survey.deleteMany({\n-    _id: {\n-      $in: surveyIds\n-    }\n-  });\n+  await survey.deleteMany({ userId: { $in: userIds } });\n   log('Survey info deleted');\n \n   if (!args.includes('delete-only')) {"
        },
        {
            "sha": "ccca8cd4b7738da1735a5685afded8f5afa29281",
            "filename": "tools/scripts/seed/user-data.js",
            "status": "modified",
            "additions": 13,
            "deletions": 6,
            "changes": 19,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6d7ccc9b1f479965489213aa6966ccc015777cb7/tools%2Fscripts%2Fseed%2Fuser-data.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6d7ccc9b1f479965489213aa6966ccc015777cb7/tools%2Fscripts%2Fseed%2Fuser-data.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscripts%2Fseed%2Fuser-data.js?ref=6d7ccc9b1f479965489213aa6966ccc015777cb7",
            "patch": "@@ -1,9 +1,16 @@\n /* eslint-disable max-len */\n const { ObjectId } = require('mongodb');\n \n+const blankUserId = new ObjectId('5bd30e0f1caf6ac3ddddddb9');\n+const publicUserId = new ObjectId('663b839b24a8b29f57728b13');\n+const demoUserId = new ObjectId('5bd30e0f1caf6ac3ddddddb5');\n+const fullyCertifiedUserId = new ObjectId('5fa2db00a25c1c1fa49ce067');\n+\n+const userIds = [blankUserId, publicUserId, demoUserId, fullyCertifiedUserId];\n+\n module.exports = {\n   blankUser: {\n-    _id: new ObjectId('5bd30e0f1caf6ac3ddddddb9'),\n+    _id: blankUserId,\n     email: 'bar@bar.com',\n     emailVerified: true,\n     progressTimestamps: [],\n@@ -64,7 +71,7 @@ module.exports = {\n     unsubscribeId: 'ecJxUi7OM49f24hTpauP8'\n   },\n   publicUser: {\n-    _id: new ObjectId('663b839b24a8b29f57728b13'),\n+    _id: publicUserId,\n     email: 'bar@bars.com',\n     emailVerified: true,\n     progressTimestamps: [],\n@@ -125,7 +132,7 @@ module.exports = {\n     unsubscribeId: 'ecJxUi7OM49f24hTpauP8'\n   },\n   demoUser: {\n-    _id: new ObjectId('5bd30e0f1caf6ac3ddddddb5'),\n+    _id: demoUserId,\n     email: 'foo@bar.com',\n     emailVerified: true,\n     progressTimestamps: [],\n@@ -187,9 +194,8 @@ module.exports = {\n     externalId: '',\n     unsubscribeId: 'ecJxUi7OM49f24hTpauP8'\n   },\n-\n   fullyCertifiedUser: {\n-    _id: new ObjectId('5fa2db00a25c1c1fa49ce067'),\n+    _id: fullyCertifiedUserId,\n     email: 'foo@bar.com',\n     emailVerified: true,\n     progressTimestamps: [],\n@@ -12253,5 +12259,6 @@ module.exports = {\n     emailVerifyTTL: null,\n     externalId: '',\n     unsubscribeId: 'tBX8stC5jiustPBteF2mV'\n-  }\n+  },\n+  userIds\n };"
        }
    ],
    "stats": {
        "total": 148,
        "additions": 61,
        "deletions": 87
    }
}