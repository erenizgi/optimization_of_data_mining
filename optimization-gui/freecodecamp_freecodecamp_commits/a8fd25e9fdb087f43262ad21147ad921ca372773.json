{
    "author": "ojeytonwilliams",
    "message": "feat(api): logging protected certificate routes (#58933)",
    "sha": "a8fd25e9fdb087f43262ad21147ad921ca372773",
    "files": [
        {
            "sha": "de20494dcb8824e27274c52faadbbd4e16857ffe",
            "filename": "api/src/routes/protected/certificate.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8fd25e9fdb087f43262ad21147ad921ca372773/api%2Fsrc%2Froutes%2Fprotected%2Fcertificate.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8fd25e9fdb087f43262ad21147ad921ca372773/api%2Fsrc%2Froutes%2Fprotected%2Fcertificate.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fprotected%2Fcertificate.ts?ref=a8fd25e9fdb087f43262ad21147ad921ca372773",
            "patch": "@@ -266,9 +266,11 @@ export const protectedCertificateRoutes: FastifyPluginCallbackTypebox = (\n       }\n     },\n     async (req, reply) => {\n+      const logger = fastify.log.child({ req });\n       const { certSlug } = req.body;\n \n       if (!isKnownCertSlug(certSlug) || !isCertAllowed(certSlug)) {\n+        logger.warn(`Unknown certificate slug \"${certSlug}\"`);\n         void reply.code(400);\n         return {\n           response: {\n@@ -289,7 +291,7 @@ export const protectedCertificateRoutes: FastifyPluginCallbackTypebox = (\n \n       if (!user) {\n         void reply.code(500);\n-        fastify.log.error('User not found');\n+        logger.error(`User with id ${req.user?.id} not found`);\n         fastify.Sentry.captureException(Error('User not found'));\n         return {\n           type: 'danger',\n@@ -302,6 +304,7 @@ export const protectedCertificateRoutes: FastifyPluginCallbackTypebox = (\n \n       // TODO: Discuss if this is a requirement still\n       if (!user.name) {\n+        logger.warn(`${user.id} does not have a name property`);\n         void reply.code(400);\n         return {\n           response: {\n@@ -314,6 +317,7 @@ export const protectedCertificateRoutes: FastifyPluginCallbackTypebox = (\n       }\n \n       if (user[certType]) {\n+        logger.info(`${user.id} has already claimed ${certName}`);\n         void reply.code(200);\n         return {\n           response: {\n@@ -335,6 +339,7 @@ export const protectedCertificateRoutes: FastifyPluginCallbackTypebox = (\n       );\n \n       if (!hasCompletedTestRequirements) {\n+        logger.info(`${user.id} has not completed the tests for ${certName}`);\n         void reply.code(400);\n         return {\n           response: {\n@@ -415,14 +420,16 @@ export const protectedCertificateRoutes: FastifyPluginCallbackTypebox = (\n \n         // Failed email should not prevent successful response.\n         try {\n+          logger.info(`Sending congratulations email to ${user.id}`);\n           // TODO(POST-MVP): Ensure Camper knows they **have** claimed the cert, but the email failed to send.\n           await fastify.sendEmail(notifyUser);\n         } catch (e) {\n-          fastify.log.error(e);\n+          logger.error(e);\n           fastify.Sentry.captureException(e);\n         }\n       }\n \n+      logger.info(`${user.id} has claimed ${certName}`);\n       void reply.code(200);\n       return {\n         response: {"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 9,
        "deletions": 2
    }
}