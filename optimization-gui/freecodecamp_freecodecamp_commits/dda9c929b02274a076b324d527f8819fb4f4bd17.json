{
    "author": "ojeytonwilliams",
    "message": "fix(api): clear cookies on account/delete (#55260)",
    "sha": "dda9c929b02274a076b324d527f8819fb4f4bd17",
    "files": [
        {
            "sha": "9b9bc8596aed47dbb955da2aafa7dd6db8b58281",
            "filename": "api/src/routes/user.test.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dda9c929b02274a076b324d527f8819fb4f4bd17/api%2Fsrc%2Froutes%2Fuser.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dda9c929b02274a076b324d527f8819fb4f4bd17/api%2Fsrc%2Froutes%2Fuser.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fuser.test.ts?ref=dda9c929b02274a076b324d527f8819fb4f4bd17",
            "patch": "@@ -362,6 +362,20 @@ describe('userRoutes', () => {\n         expect(userTokens).toHaveLength(1);\n         expect(userTokens[0]?.userId).toBe(otherUserId);\n       });\n+\n+      test(\"POST deletes all the user's cookies\", async () => {\n+        const res = await superPost('/account/delete');\n+\n+        const setCookie = res.headers['set-cookie'];\n+        expect(setCookie).toEqual(\n+          expect.arrayContaining([\n+            'jwt_access_token=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT',\n+            '_csrf=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT',\n+            'csrf_token=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT'\n+          ])\n+        );\n+        expect(setCookie).toHaveLength(3);\n+      });\n     });\n \n     describe('/account/reset-progress', () => {"
        },
        {
            "sha": "86bc7fc3e3da01bfb349bb486b123000775c3650",
            "filename": "api/src/routes/user.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dda9c929b02274a076b324d527f8819fb4f4bd17/api%2Fsrc%2Froutes%2Fuser.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dda9c929b02274a076b324d527f8819fb4f4bd17/api%2Fsrc%2Froutes%2Fuser.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fuser.ts?ref=dda9c929b02274a076b324d527f8819fb4f4bd17",
            "patch": "@@ -119,7 +119,9 @@ export const userRoutes: FastifyPluginCallbackTypebox = (\n       await fastify.prisma.user.delete({\n         where: { id: req.user!.id }\n       });\n-      void reply.clearCookie('sessionId');\n+      void reply.clearCookie('jwt_access_token');\n+      void reply.clearCookie('_csrf');\n+      void reply.clearCookie('csrf_token');\n \n       return {};\n     }"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 17,
        "deletions": 1
    }
}