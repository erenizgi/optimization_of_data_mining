{
    "author": "huyenltnguyen",
    "message": "fix(client): navigate campers to the correct page when exiting quiz (#59369)",
    "sha": "1287bf22655ebea9f055a7c2f7fcaa380d2b0f25",
    "files": [
        {
            "sha": "4f97706434f085aa74cbb0884fc2be1b0c44f319",
            "filename": "client/src/templates/Challenges/hooks/use-page-leave.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/1287bf22655ebea9f055a7c2f7fcaa380d2b0f25/client%2Fsrc%2Ftemplates%2FChallenges%2Fhooks%2Fuse-page-leave.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/1287bf22655ebea9f055a7c2f7fcaa380d2b0f25/client%2Fsrc%2Ftemplates%2FChallenges%2Fhooks%2Fuse-page-leave.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fhooks%2Fuse-page-leave.ts?ref=1287bf22655ebea9f055a7c2f7fcaa380d2b0f25",
            "patch": "@@ -3,7 +3,7 @@ import { useLocation, globalHistory } from '@gatsbyjs/reach-router';\n \n interface Props {\n   onWindowClose: (event: BeforeUnloadEvent) => void;\n-  onHistoryChange: () => void;\n+  onHistoryChange: (targetPathname: string) => void;\n }\n \n export const usePageLeave = ({ onWindowClose, onHistoryChange }: Props) => {\n@@ -20,7 +20,7 @@ export const usePageLeave = ({ onWindowClose, onHistoryChange }: Props) => {\n         action === 'PUSH' && location.pathname !== curLocation.pathname;\n \n       if (isBack || isRouteChanged) {\n-        onHistoryChange();\n+        onHistoryChange(location.pathname);\n       }\n     });\n "
        },
        {
            "sha": "0674302ad94fa201c9dbe2ef5e4fefeb593636d1",
            "filename": "client/src/templates/Challenges/quiz/show.tsx",
            "status": "modified",
            "additions": 33,
            "deletions": 15,
            "changes": 48,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/1287bf22655ebea9f055a7c2f7fcaa380d2b0f25/client%2Fsrc%2Ftemplates%2FChallenges%2Fquiz%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/1287bf22655ebea9f055a7c2f7fcaa380d2b0f25/client%2Fsrc%2Ftemplates%2FChallenges%2Fquiz%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fquiz%2Fshow.tsx?ref=1287bf22655ebea9f055a7c2f7fcaa380d2b0f25",
            "patch": "@@ -128,6 +128,8 @@ const ShowQuiz = ({\n \n   const [exitConfirmed, setExitConfirmed] = useState(false);\n \n+  const [exitPathname, setExitPathname] = useState(blockHashSlug);\n+\n   const blockNameTitle = `${t(\n     `intro:${superBlock}.blocks.${block}.title`\n   )} - ${title}`;\n@@ -231,7 +233,7 @@ const ShowQuiz = ({\n \n   const handleExitQuizModalBtnClick = () => {\n     setExitConfirmed(true);\n-    void navigate(blockHashSlug);\n+    void navigate(exitPathname);\n     closeExitQuizModal();\n   };\n \n@@ -243,21 +245,37 @@ const ShowQuiz = ({\n     [t]\n   );\n \n-  const onHistoryChange = useCallback(() => {\n-    // We don't block navigation in the following cases.\n-    // - When campers have submitted the quiz:\n-    //   - If they don't pass, the Finish Quiz button is disabled, there isn't anything for them to do other than leaving the page\n-    //   - If they pass, the Submit-and-go button shows up, and campers should be allowed to leave the page\n-    // - When they have clicked the exit button on the exit modal\n-    if (hasSubmitted || exitConfirmed) {\n-      return;\n-    }\n+  const onHistoryChange = useCallback(\n+    (targetPathname: string) => {\n+      // We don't block navigation in the following cases.\n+      // - When campers have submitted the quiz:\n+      //   - If they don't pass, the Finish Quiz button is disabled, there isn't anything for them to do other than leaving the page\n+      //   - If they pass, the Submit-and-go button shows up, and campers should be allowed to leave the page\n+      // - When they have clicked the exit button on the exit modal\n+      if (hasSubmitted || exitConfirmed) {\n+        return;\n+      }\n \n-    // We need to use Reach Router, because the pathname is already prefixed\n-    // with the language and Gatsby's navigate will prefix it again.\n-    void reachNavigate(`${curLocation.pathname}`);\n-    openExitQuizModal();\n-  }, [curLocation.pathname, hasSubmitted, exitConfirmed, openExitQuizModal]);\n+      const newPathname = targetPathname.startsWith('/learn')\n+        ? blockHashSlug\n+        : targetPathname;\n+\n+      // Save the pathname of the page the user wants to navigate to before we block the navigation.\n+      setExitPathname(newPathname);\n+\n+      // We need to use Reach Router, because the pathname is already prefixed\n+      // with the language and Gatsby's navigate will prefix it again.\n+      void reachNavigate(`${curLocation.pathname}`);\n+      openExitQuizModal();\n+    },\n+    [\n+      curLocation.pathname,\n+      hasSubmitted,\n+      exitConfirmed,\n+      openExitQuizModal,\n+      blockHashSlug\n+    ]\n+  );\n \n   usePageLeave({\n     onWindowClose,"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 35,
        "deletions": 17
    }
}