{
    "author": "ojeytonwilliams",
    "message": "feat: simplify code transformation (#57155)",
    "sha": "6b1eeae775c383f2f79326f757d864af44860aea",
    "files": [
        {
            "sha": "914145b5e44403c742a67d341feebf7aa530669c",
            "filename": "client/src/templates/Challenges/rechallenge/transformers.js",
            "status": "modified",
            "additions": 37,
            "deletions": 51,
            "changes": 88,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6b1eeae775c383f2f79326f757d864af44860aea/client%2Fsrc%2Ftemplates%2FChallenges%2Frechallenge%2Ftransformers.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6b1eeae775c383f2f79326f757d864af44860aea/client%2Fsrc%2Ftemplates%2FChallenges%2Frechallenge%2Ftransformers.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Frechallenge%2Ftransformers.js?ref=6b1eeae775c383f2f79326f757d864af44860aea",
            "patch": "@@ -113,50 +113,42 @@ const replaceNBSP = cond([\n   [stubTrue, identity]\n ]);\n \n-const babelTransformer = loopProtectOptions => {\n+const getJSTranspiler = loopProtectOptions => async challengeFile => {\n+  await loadBabel();\n+  await loadPresetEnv();\n+  const babelOptions = getBabelOptions(presetsJS, loopProtectOptions);\n+  return transformHeadTailAndContents(\n+    babelTransformCode(babelOptions),\n+    challengeFile\n+  );\n+};\n+\n+const getJSXTranspiler = loopProtectOptions => async challengeFile => {\n+  await loadBabel();\n+  await loadPresetReact();\n+  const babelOptions = getBabelOptions(presetsJSX, loopProtectOptions);\n+  return flow(\n+    partial(transformHeadTailAndContents, babelTransformCode(babelOptions)),\n+    partial(setExt, 'js')\n+  )(challengeFile);\n+};\n+\n+const getTSTranspiler = loopProtectOptions => async challengeFile => {\n+  await loadBabel();\n+  await checkTSServiceIsReady();\n+  const babelOptions = getBabelOptions(presetsJS, loopProtectOptions);\n+  return flow(\n+    partial(transformHeadTailAndContents, compileTypeScriptCode),\n+    partial(transformHeadTailAndContents, babelTransformCode(babelOptions))\n+  )(challengeFile);\n+};\n+\n+const createTranspiler = loopProtectOptions => {\n   return cond([\n-    [\n-      testJS,\n-      async challengeFile => {\n-        await loadBabel();\n-        await loadPresetEnv();\n-        const babelOptions = getBabelOptions(presetsJS, loopProtectOptions);\n-        return transformHeadTailAndContents(\n-          babelTransformCode(babelOptions),\n-          challengeFile\n-        );\n-      }\n-    ],\n-    [\n-      testJSX,\n-      async challengeFile => {\n-        await loadBabel();\n-        await loadPresetReact();\n-        const babelOptions = getBabelOptions(presetsJSX, loopProtectOptions);\n-        return flow(\n-          partial(\n-            transformHeadTailAndContents,\n-            babelTransformCode(babelOptions)\n-          ),\n-          partial(setExt, 'js')\n-        )(challengeFile);\n-      }\n-    ],\n-    [\n-      testTypeScript,\n-      async challengeFile => {\n-        await loadBabel();\n-        await checkTSServiceIsReady();\n-        const babelOptions = getBabelOptions(presetsJS, loopProtectOptions);\n-        return flow(\n-          partial(transformHeadTailAndContents, compileTypeScriptCode),\n-          partial(\n-            transformHeadTailAndContents,\n-            babelTransformCode(babelOptions)\n-          )\n-        )(challengeFile);\n-      }\n-    ],\n+    [testJS, getJSTranspiler(loopProtectOptions)],\n+    [testJSX, getJSXTranspiler(loopProtectOptions)],\n+    [testTypeScript, getTSTranspiler(loopProtectOptions)],\n+    [testHTML, transformHtml],\n     [stubTrue, identity]\n   ]);\n };\n@@ -302,17 +294,11 @@ const transformHtml = async function (file) {\n   return transformContents(() => contents, file);\n };\n \n-const htmlTransformer = cond([\n-  [testHTML, flow(transformHtml)],\n-  [stubTrue, identity]\n-]);\n-\n export const getTransformers = loopProtectOptions => [\n   createSource,\n   replaceNBSP,\n-  babelTransformer(loopProtectOptions),\n-  partial(compileHeadTail, ''),\n-  htmlTransformer\n+  createTranspiler(loopProtectOptions),\n+  partial(compileHeadTail, '')\n ];\n \n export const getPythonTransformers = () => ["
        }
    ],
    "stats": {
        "total": 88,
        "additions": 37,
        "deletions": 51
    }
}