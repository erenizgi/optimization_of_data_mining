{
    "author": "ojeytonwilliams",
    "message": "fix: only log if the request has an Origin header (#59920)",
    "sha": "db07c718b92e03d579577fe111b538c2a9a963dd",
    "files": [
        {
            "sha": "e599d4744ed5a107ea3ce5e91c6c84bc51f64d35",
            "filename": "api/src/plugins/cors.test.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/db07c718b92e03d579577fe111b538c2a9a963dd/api%2Fsrc%2Fplugins%2Fcors.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/db07c718b92e03d579577fe111b538c2a9a963dd/api%2Fsrc%2Fplugins%2Fcors.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fcors.test.ts?ref=db07c718b92e03d579577fe111b538c2a9a963dd",
            "patch": "@@ -32,4 +32,16 @@ describe('cors', () => {\n       expect(spy).not.toHaveBeenCalled();\n     });\n   });\n+\n+  it('should not log if the origin is undefined', async () => {\n+    const logger = fastify.log.child({ req: { url: '/api/some-endpoint' } });\n+    const spies = LOG_LEVELS.map(level => jest.spyOn(logger, level));\n+    await fastify.inject({\n+      url: '/api/some-endpoint'\n+    });\n+\n+    spies.forEach(spy => {\n+      expect(spy).not.toHaveBeenCalled();\n+    });\n+  });\n });"
        },
        {
            "sha": "c41a155f5a73f53c96c8b3e000cbe2b736ae45d8",
            "filename": "api/src/plugins/cors.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/db07c718b92e03d579577fe111b538c2a9a963dd/api%2Fsrc%2Fplugins%2Fcors.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/db07c718b92e03d579577fe111b538c2a9a963dd/api%2Fsrc%2Fplugins%2Fcors.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fcors.ts?ref=db07c718b92e03d579577fe111b538c2a9a963dd",
            "patch": "@@ -22,7 +22,7 @@ const cors: FastifyPluginCallback = (fastify, _options, done) => {\n       // @fastify/cors instead.\n       void reply.header('Access-Control-Allow-Origin', HOME_LOCATION);\n \n-      if (!req.url?.startsWith('/status/')) {\n+      if (origin && !req.url?.startsWith('/status/')) {\n         logger.info(`Received request from disallowed origin: ${origin}`);\n       }\n     }"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 13,
        "deletions": 1
    }
}