{
    "author": "moT01",
    "message": "feat(curriculum): add i18n-curriculum submodule (#55341)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "4a506f6e063a3b755630b0fca8d9abd5750ede33",
    "files": [
        {
            "sha": "513eae4a9a732e4ecf9b5852e41b0100d1183df3",
            "filename": ".gitmodules",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4a506f6e063a3b755630b0fca8d9abd5750ede33/.gitmodules",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4a506f6e063a3b755630b0fca8d9abd5750ede33/.gitmodules",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.gitmodules?ref=4a506f6e063a3b755630b0fca8d9abd5750ede33",
            "patch": "@@ -0,0 +1,4 @@\n+[submodule \"curriculum/i18n-curriculum\"]\n+  path = curriculum/i18n-curriculum\n+  url = https://github.com/freeCodeCamp/i18n-curriculum.git\n+  ignore = dirty"
        },
        {
            "sha": "6df479c2047b8a8066263b26024bfcf48e60b5ad",
            "filename": "client/utils/build-challenges.js",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4a506f6e063a3b755630b0fca8d9abd5750ede33/client%2Futils%2Fbuild-challenges.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4a506f6e063a3b755630b0fca8d9abd5750ede33/client%2Futils%2Fbuild-challenges.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Futils%2Fbuild-challenges.js?ref=4a506f6e063a3b755630b0fca8d9abd5750ede33",
            "patch": "@@ -6,8 +6,9 @@ const envData = require('../config/env.json');\n const {\n   getChallengesForLang,\n   generateChallengeCreator,\n-  CHALLENGES_DIR,\n+  ENGLISH_CHALLENGES_DIR,\n   META_DIR,\n+  CHALLENGES_DIR,\n   getChallengesDirForLang\n } = require('../../curriculum/get-challenges');\n \n@@ -24,7 +25,11 @@ exports.replaceChallengeNode = () => {\n     const metaPath = path.resolve(META_DIR, `${blockName}/meta.json`);\n     delete require.cache[require.resolve(metaPath)];\n     const meta = require(metaPath);\n-    const englishPath = path.resolve(CHALLENGES_DIR, 'english', filePath);\n+    const englishPath = path.resolve(\n+      ENGLISH_CHALLENGES_DIR,\n+      'english',\n+      filePath\n+    );\n     const i18nPath = path.resolve(CHALLENGES_DIR, curriculumLocale, filePath);\n     // TODO: reimplement hot-reloading of certifications\n     const createChallenge = generateChallengeCreator("
        },
        {
            "sha": "3a39ab939f4294df52c6991493f56c3c2805496a",
            "filename": "curriculum/get-challenges.js",
            "status": "modified",
            "additions": 37,
            "deletions": 11,
            "changes": 48,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4a506f6e063a3b755630b0fca8d9abd5750ede33/curriculum%2Fget-challenges.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4a506f6e063a3b755630b0fca8d9abd5750ede33/curriculum%2Fget-challenges.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fget-challenges.js?ref=4a506f6e063a3b755630b0fca8d9abd5750ede33",
            "patch": "@@ -21,17 +21,34 @@ const { metaSchemaValidator } = require('./schema/meta-schema');\n \n const access = util.promisify(fs.access);\n \n-const CHALLENGES_DIR = path.resolve(__dirname, 'challenges');\n-const META_DIR = path.resolve(CHALLENGES_DIR, '_meta');\n-exports.CHALLENGES_DIR = CHALLENGES_DIR;\n+const ENGLISH_CHALLENGES_DIR = path.resolve(__dirname, 'challenges');\n+const ENGLISH_DICTIONARIES_DIR = path.resolve(__dirname, 'dictionaries');\n+const META_DIR = path.resolve(ENGLISH_CHALLENGES_DIR, '_meta');\n+\n+const CURRICULUM_DIR = path.resolve(\n+  __dirname,\n+  process.env.BUILD_WITH_SUBMODULE === 'true'\n+    ? 'i18n-curriculum/curriculum'\n+    : '.'\n+);\n+\n+const CHALLENGES_DIR = path.resolve(CURRICULUM_DIR, 'challenges');\n+const DICTIONARIES_DIR = path.resolve(CURRICULUM_DIR, 'dictionaries');\n+\n+exports.ENGLISH_CHALLENGES_DIR = ENGLISH_CHALLENGES_DIR;\n exports.META_DIR = META_DIR;\n+exports.CHALLENGES_DIR = CHALLENGES_DIR;\n \n const COMMENT_TRANSLATIONS = createCommentMap(\n-  path.resolve(__dirname, 'dictionaries')\n+  DICTIONARIES_DIR,\n+  ENGLISH_DICTIONARIES_DIR\n );\n \n-function createCommentMap(dictionariesDir) {\n-  // get all the languages for which there are dictionaries.\n+function createCommentMap(dictionariesDir, englishDictionariesDir) {\n+  // get all the languages for which there are dictionaries. Note: this has to\n+  // include the english dictionaries since translateCommentsInChallenge treats\n+  // all languages equally and will simply remove comments if there is no entry\n+  // in the comment map.\n   const languages = fs.readdirSync(dictionariesDir);\n \n   // get all their dictionaries\n@@ -45,11 +62,15 @@ function createCommentMap(dictionariesDir) {\n \n   // get the english dicts\n   const COMMENTS_TO_TRANSLATE = require(\n-    path.resolve(dictionariesDir, 'english', 'comments.json')\n+    path.resolve(englishDictionariesDir, 'english', 'comments.json')\n   );\n \n   const COMMENTS_TO_NOT_TRANSLATE = require(\n-    path.resolve(dictionariesDir, 'english', 'comments-to-not-translate')\n+    path.resolve(\n+      englishDictionariesDir,\n+      'english',\n+      'comments-to-not-translate.json'\n+    )\n   );\n \n   // map from english comment text to translations\n@@ -98,7 +119,11 @@ function getTranslationEntry(dicts, { engId, text }) {\n }\n \n function getChallengesDirForLang(lang) {\n-  return path.resolve(CHALLENGES_DIR, `${lang}`);\n+  if (lang === 'english') {\n+    return path.resolve(ENGLISH_CHALLENGES_DIR, `${lang}`);\n+  } else {\n+    return path.resolve(CHALLENGES_DIR, `${lang}`);\n+  }\n }\n \n function getMetaForBlock(block) {\n@@ -221,7 +246,7 @@ async function buildChallenges({ path: filePath }, curriculum, lang) {\n   const isCert = path.extname(filePath) === '.yml';\n   const englishPath = path.resolve(\n     __dirname,\n-    CHALLENGES_DIR,\n+    ENGLISH_CHALLENGES_DIR,\n     'english',\n     filePath\n   );\n@@ -336,7 +361,8 @@ function challengeFilesToPolys(files) {\n \n async function assertHasEnglishSource(filePath, lang, englishPath) {\n   const missingEnglish =\n-    lang !== 'english' && !(await hasEnglishSource(CHALLENGES_DIR, filePath));\n+    lang !== 'english' &&\n+    !(await hasEnglishSource(ENGLISH_CHALLENGES_DIR, filePath));\n   if (missingEnglish)\n     throw Error(`Missing English challenge for\n ${filePath}"
        },
        {
            "sha": "5d35db2c0fcfe87b6a11f65e2b4d4529b50ae734",
            "filename": "curriculum/get-challenges.test.js",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4a506f6e063a3b755630b0fca8d9abd5750ede33/curriculum%2Fget-challenges.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4a506f6e063a3b755630b0fca8d9abd5750ede33/curriculum%2Fget-challenges.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fget-challenges.test.js?ref=4a506f6e063a3b755630b0fca8d9abd5750ede33",
            "patch": "@@ -56,12 +56,14 @@ describe('create non-English challenge', () => {\n     );\n \n     it('returns an object', () => {\n-      expect(typeof createCommentMap(dictionaryDir)).toBe('object');\n+      expect(typeof createCommentMap(dictionaryDir, dictionaryDir)).toBe(\n+        'object'\n+      );\n     });\n \n     it('fallback to the untranslated string', () => {\n       expect.assertions(2);\n-      const commentMap = createCommentMap(incompleteDictDir);\n+      const commentMap = createCommentMap(incompleteDictDir, incompleteDictDir);\n       expect(commentMap['To be translated one'].spanish).toEqual(\n         'Spanish translation one'\n       );\n@@ -78,7 +80,7 @@ describe('create non-English challenge', () => {\n         'Not translated one',\n         'Not translated two'\n       ];\n-      const map = createCommentMap(dictionaryDir);\n+      const map = createCommentMap(dictionaryDir, dictionaryDir);\n       expect(Object.keys(map)).toEqual(expect.arrayContaining(expectedIds));\n \n       const mapValue = map['To be translated one'];\n@@ -98,7 +100,7 @@ describe('create non-English challenge', () => {\n         'Not translated one',\n         'Not translated two'\n       ];\n-      const map = createCommentMap(dictionaryDir);\n+      const map = createCommentMap(dictionaryDir, dictionaryDir);\n       expect(Object.keys(map)).toEqual(expect.arrayContaining(expectedIds));\n \n       const translatedOne = map['To be translated one'];"
        },
        {
            "sha": "531d189f02b4b13e81f18a4b3558bb4482048473",
            "filename": "curriculum/i18n-curriculum",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": null,
            "raw_url": null,
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fi18n-curriculum?ref=4a506f6e063a3b755630b0fca8d9abd5750ede33",
            "patch": "@@ -0,0 +1 @@\n+Subproject commit 531d189f02b4b13e81f18a4b3558bb4482048473"
        },
        {
            "sha": "b455708a190313f8659ace243e2b46c4031949b2",
            "filename": "sample.env",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4a506f6e063a3b755630b0fca8d9abd5750ede33/sample.env",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4a506f6e063a3b755630b0fca8d9abd5750ede33/sample.env",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/sample.env?ref=4a506f6e063a3b755630b0fca8d9abd5750ede33",
            "patch": "@@ -51,6 +51,9 @@ FREECODECAMP_NODE_ENV=development\n CLIENT_LOCALE=english\n CURRICULUM_LOCALE=english\n \n+# Build using submodule - remove this once the workflow has been entirely moved to use the submodule\n+BUILD_WITH_SUBMODULE=false\n+\n # Show or hide WIP in progress challenges\n SHOW_UPCOMING_CHANGES=false\n SHOW_NEW_CURRICULUM=true"
        }
    ],
    "stats": {
        "total": 75,
        "additions": 58,
        "deletions": 17
    }
}