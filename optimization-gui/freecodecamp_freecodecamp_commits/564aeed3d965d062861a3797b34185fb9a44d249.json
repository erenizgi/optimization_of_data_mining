{
    "author": "gikf",
    "message": "test(api/client): empty string in about settings (#55700)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "564aeed3d965d062861a3797b34185fb9a44d249",
    "files": [
        {
            "sha": "fa8660276cea65842fbcf0661fbf9bc2b22e819f",
            "filename": "api-server/src/server/boot/settings.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/564aeed3d965d062861a3797b34185fb9a44d249/api-server%2Fsrc%2Fserver%2Fboot%2Fsettings.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/564aeed3d965d062861a3797b34185fb9a44d249/api-server%2Fsrc%2Fserver%2Fboot%2Fsettings.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2Fsettings.js?ref=564aeed3d965d062861a3797b34185fb9a44d249",
            "patch": "@@ -170,7 +170,7 @@ function updateMyProfileUI(req, res, next) {\n   );\n }\n \n-function updateMyAbout(req, res, next) {\n+export function updateMyAbout(req, res, next) {\n   const {\n     user,\n     body: { name, location, about, picture }"
        },
        {
            "sha": "4e2cf80c612baa6826900a17aec603e999d79cc3",
            "filename": "api-server/src/server/boot_tests/settings.test.js",
            "status": "modified",
            "additions": 35,
            "deletions": 1,
            "changes": 36,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/564aeed3d965d062861a3797b34185fb9a44d249/api-server%2Fsrc%2Fserver%2Fboot_tests%2Fsettings.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/564aeed3d965d062861a3797b34185fb9a44d249/api-server%2Fsrc%2Fserver%2Fboot_tests%2Fsettings.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot_tests%2Fsettings.test.js?ref=564aeed3d965d062861a3797b34185fb9a44d249",
            "patch": "@@ -1,4 +1,8 @@\n-import { updateMySocials, updateMyClassroomMode } from '../boot/settings';\n+import {\n+  updateMyAbout,\n+  updateMySocials,\n+  updateMyClassroomMode\n+} from '../boot/settings';\n \n export const mockReq = opts => {\n   const req = {};\n@@ -17,6 +21,36 @@ export const mockRes = opts => {\n };\n \n describe('boot/settings', () => {\n+  describe('updateMyAbout', () => {\n+    it('allows empty string in any field', () => {\n+      let updateData;\n+      const req = mockReq({\n+        user: {\n+          updateAttributes: (update, cb) => {\n+            updateData = update;\n+            cb();\n+          }\n+        },\n+        body: {\n+          name: '',\n+          location: '',\n+          about: '',\n+          picture: ''\n+        }\n+      });\n+      const res = mockRes();\n+      const next = jest.fn();\n+      updateMyAbout(req, res, next);\n+      expect(res.status).toHaveBeenCalledWith(200);\n+      expect(updateData).toStrictEqual({\n+        name: '',\n+        location: '',\n+        about: '',\n+        picture: ''\n+      });\n+    });\n+  });\n+\n   describe('updateMySocials', () => {\n     it('does not allow non-github domain in GitHub social', () => {\n       const req = mockReq({"
        },
        {
            "sha": "2eafedebc8f752bbe09aad4de0bfb6bdd68b0ea9",
            "filename": "api/src/routes/settings.test.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/564aeed3d965d062861a3797b34185fb9a44d249/api%2Fsrc%2Froutes%2Fsettings.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/564aeed3d965d062861a3797b34185fb9a44d249/api%2Fsrc%2Froutes%2Fsettings.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fsettings.test.ts?ref=564aeed3d965d062861a3797b34185fb9a44d249",
            "patch": "@@ -922,6 +922,43 @@ Happy coding!\n         });\n         expect(response.statusCode).toEqual(200);\n       });\n+\n+      test('PUT with empty strings clears the values in about settings ', async () => {\n+        const initialResponse = await superPut('/update-my-about').send({\n+          about: 'Teacher at freeCodeCamp',\n+          name: 'Quincy Larson',\n+          location: 'USA',\n+          picture:\n+            'https://cdn.freecodecamp.org/platform/english/images/quincy-larson-signature.svg'\n+        });\n+\n+        expect(initialResponse.body).toEqual({\n+          message: 'flash.updated-about-me',\n+          type: 'success'\n+        });\n+        expect(initialResponse.statusCode).toEqual(200);\n+\n+        const response = await superPut('/update-my-about').send({\n+          about: '',\n+          name: '',\n+          location: '',\n+          picture: ''\n+        });\n+\n+        expect(response.body).toEqual({\n+          message: 'flash.updated-about-me',\n+          type: 'success'\n+        });\n+        expect(response.statusCode).toEqual(200);\n+\n+        const user = await fastifyTestInstance?.prisma.user.findFirst({\n+          where: { email: 'foo@bar.com' }\n+        });\n+        expect(user?.about).toEqual('');\n+        expect(user?.name).toEqual('');\n+        expect(user?.location).toEqual('');\n+        expect(user?.picture).toEqual('');\n+      });\n     });\n \n     describe('/update-my-honesty', () => {"
        },
        {
            "sha": "07704de39babf22a2287b705a07d04c84ed2fc53",
            "filename": "e2e/settings.spec.ts",
            "status": "modified",
            "additions": 48,
            "deletions": 0,
            "changes": 48,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/564aeed3d965d062861a3797b34185fb9a44d249/e2e%2Fsettings.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/564aeed3d965d062861a3797b34185fb9a44d249/e2e%2Fsettings.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fsettings.spec.ts?ref=564aeed3d965d062861a3797b34185fb9a44d249",
            "patch": "@@ -300,4 +300,52 @@ test.describe('Settings', () => {\n       })\n     ).toBeVisible();\n   });\n+\n+  test('Should allow empty string in any field in about settings', async ({\n+    page\n+  }) => {\n+    const saveButton = page.getByRole('button', {\n+      name: translations.settings.headings['personal-info']\n+    });\n+\n+    const nameInput = page.getByLabel(translations.settings.labels.name, {\n+      exact: true\n+    });\n+    const locationInput = page.getByLabel(\n+      translations.settings.labels.location\n+    );\n+    const pictureInput = page.getByLabel(translations.settings.labels.picture);\n+    const aboutInput = page.getByLabel(translations.settings.labels.about);\n+\n+    await nameInput.fill('Quincy Larson');\n+    await locationInput.fill('USA');\n+    await pictureInput.fill(\n+      'https://cdn.freecodecamp.org/platform/english/images/quincy-larson-signature.svg'\n+    );\n+    await aboutInput.fill('Teacher at freeCodeCamp');\n+\n+    await expect(saveButton).not.toBeDisabled();\n+    await saveButton.click();\n+    await expect(\n+      page.getByText(translations.flash['updated-about-me'])\n+    ).toBeVisible();\n+\n+    await nameInput.fill('');\n+    await locationInput.fill('');\n+    await pictureInput.fill('');\n+    await aboutInput.fill('');\n+\n+    await expect(saveButton).not.toBeDisabled();\n+    await saveButton.click();\n+    await expect(\n+      page.getByText(translations.flash['updated-about-me'])\n+    ).toBeVisible();\n+\n+    await page.reload();\n+\n+    await expect(nameInput).toHaveValue('');\n+    await expect(locationInput).toHaveValue('');\n+    await expect(pictureInput).toHaveValue('');\n+    await expect(aboutInput).toHaveValue('');\n+  });\n });"
        }
    ],
    "stats": {
        "total": 123,
        "additions": 121,
        "deletions": 2
    }
}