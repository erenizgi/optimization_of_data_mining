{
    "author": "huyenltnguyen",
    "message": "fix(external curricula): use strings for superblock stages (#60813)",
    "sha": "66bc604bd759d45830690ce898a4c1ca42ff022d",
    "files": [
        {
            "sha": "0154bc582e905eb57f86dd8c44517b66b2a5477b",
            "filename": "tools/scripts/build/build-external-curricula-data-v2.test.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 11,
            "changes": 48,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/66bc604bd759d45830690ce898a4c1ca42ff022d/tools%2Fscripts%2Fbuild%2Fbuild-external-curricula-data-v2.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/66bc604bd759d45830690ce898a4c1ca42ff022d/tools%2Fscripts%2Fbuild%2Fbuild-external-curricula-data-v2.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscripts%2Fbuild%2Fbuild-external-curricula-data-v2.test.ts?ref=66bc604bd759d45830690ce898a4c1ca42ff022d",
            "patch": "@@ -20,7 +20,8 @@ import {\n   type GeneratedBlockBasedCurriculumProps,\n   type GeneratedChapterBasedCurriculumProps,\n   type ChapterBasedCurriculumIntros,\n-  orderedSuperBlockInfo\n+  orderedSuperBlockInfo,\n+  OrderedSuperBlocks\n } from './build-external-curricula-data-v2';\n \n const VERSION = 'v2';\n@@ -55,16 +56,29 @@ describe('external curriculum data build', () => {\n   });\n \n   test('the available-superblocks file should have the correct structure', async () => {\n+    const filteredSuperBlockStages: string[] = Object.keys(SuperBlockStage)\n+      .filter(key => isNaN(Number(key))) // Filter out numeric keys to get only the names\n+      .filter(name => name !== 'Upcoming' && name !== 'Next') // Filter out 'Upcoming' and 'Next'\n+      .map(name => name.toLowerCase());\n+\n     const validateAvailableSuperBlocks = availableSuperBlocksValidator();\n-    const availableSuperblocks: unknown = JSON.parse(\n+    const availableSuperblocks = JSON.parse(\n       await fs.promises.readFile(\n         `${clientStaticPath}/curriculum-data/${VERSION}/available-superblocks.json`,\n         'utf-8'\n       )\n-    );\n+    ) as { superblocks: OrderedSuperBlocks };\n \n     const result = validateAvailableSuperBlocks(availableSuperblocks);\n \n+    expect(Object.keys(availableSuperblocks.superblocks)).toHaveLength(\n+      filteredSuperBlockStages.length\n+    );\n+\n+    expect(Object.keys(availableSuperblocks.superblocks)).toEqual(\n+      expect.arrayContaining(filteredSuperBlockStages)\n+    );\n+\n     if (result.error) {\n       throw Error(\n         `file: available-superblocks.json\n@@ -263,23 +277,35 @@ ${result.error.message}`);\n   });\n \n   test('All public SuperBlocks should be present in the SuperBlock object', () => {\n-    const stages = Object.keys(orderedSuperBlockInfo).map(\n-      key => Number(key) as SuperBlockStage\n-    );\n-\n-    expect(stages).not.toContain(SuperBlockStage.Next);\n-    expect(stages).not.toContain(SuperBlockStage.Upcoming);\n+    // Create a mapping from string to shared/config SuperBlockStage enum value\n+    // so we can look up the enum value by string.\n+    const superBlockStageStringMap: Record<string, SuperBlockStage> = {\n+      core: SuperBlockStage.Core,\n+      english: SuperBlockStage.English,\n+      professional: SuperBlockStage.Professional,\n+      extra: SuperBlockStage.Extra,\n+      legacy: SuperBlockStage.Legacy,\n+      upcoming: SuperBlockStage.Upcoming,\n+      next: SuperBlockStage.Next\n+    };\n+\n+    const stages = Object.keys(orderedSuperBlockInfo);\n+\n+    expect(stages).not.toContain('next');\n+    expect(stages).not.toContain('upcoming');\n \n     for (const stage of stages) {\n       const superBlockDashedNames = orderedSuperBlockInfo[stage].map(\n         superBlock => superBlock.dashedName\n       );\n \n+      const stageValueInNum = superBlockStageStringMap[stage];\n+\n       expect(superBlockDashedNames).toEqual(\n-        expect.arrayContaining(superBlockStages[stage])\n+        expect.arrayContaining(superBlockStages[stageValueInNum])\n       );\n       expect(superBlockDashedNames).toHaveLength(\n-        superBlockStages[stage].length\n+        superBlockStages[stageValueInNum].length\n       );\n     }\n   });"
        },
        {
            "sha": "dd98c7699ef2c003af18ec553b1d0dc6f57f9aef",
            "filename": "tools/scripts/build/build-external-curricula-data-v2.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 8,
            "changes": 25,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/66bc604bd759d45830690ce898a4c1ca42ff022d/tools%2Fscripts%2Fbuild%2Fbuild-external-curricula-data-v2.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/66bc604bd759d45830690ce898a4c1ca42ff022d/tools%2Fscripts%2Fbuild%2Fbuild-external-curricula-data-v2.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscripts%2Fbuild%2Fbuild-external-curricula-data-v2.ts?ref=66bc604bd759d45830690ce898a4c1ca42ff022d",
            "patch": "@@ -2,10 +2,7 @@ import { mkdirSync, writeFileSync, readFileSync } from 'fs';\n import { resolve, dirname } from 'path';\n import { submitTypes } from '../../../shared/config/challenge-types';\n import { type ChallengeNode } from '../../../client/src/redux/prop-types';\n-import {\n-  SuperBlocks,\n-  SuperBlockStage\n-} from '../../../shared/config/curriculum';\n+import { SuperBlocks } from '../../../shared/config/curriculum';\n import fullStackSuperBlockStructure from '../../../curriculum/superblock-structure/full-stack.json';\n import type { Chapter } from '../../../shared/config/chapters';\n \n@@ -85,6 +82,21 @@ interface GeneratedBlock {\n   meta: Record<string, unknown>;\n }\n \n+// This enum is based on the `SuperBlockStage` enum in shared/config,\n+// but with string value instead of number.\n+enum SuperBlockStage {\n+  Core = 'core',\n+  English = 'english',\n+  Professional = 'professional',\n+  Extra = 'extra',\n+  Legacy = 'legacy'\n+}\n+\n+export type OrderedSuperBlocks = Record<\n+  string,\n+  Array<{ dashedName: SuperBlocks; public: boolean; title: string }>\n+>;\n+\n const ver = 'v2';\n \n const staticFolderPath = resolve(__dirname, '../../../client/static');\n@@ -97,10 +109,7 @@ const intros = JSON.parse(\n   readFileSync(blockIntroPath, 'utf-8')\n ) as CurriculumIntros;\n \n-export const orderedSuperBlockInfo: Record<\n-  string,\n-  Array<{ dashedName: SuperBlocks; public: boolean; title: string }>\n-> = {\n+export const orderedSuperBlockInfo: OrderedSuperBlocks = {\n   [SuperBlockStage.Core]: [\n     {\n       dashedName: SuperBlocks.FullStackDeveloper,"
        }
    ],
    "stats": {
        "total": 73,
        "additions": 54,
        "deletions": 19
    }
}