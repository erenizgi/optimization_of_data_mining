{
    "author": "ojeytonwilliams",
    "message": "refactor(client): use generic messengers in awaitResponse (#59272)",
    "sha": "556a00198ea12ca77b0c2bca21b218432f2565e8",
    "files": [
        {
            "sha": "e8d51321a64a9bddff44c988d6fa253082ef2c80",
            "filename": "client/src/templates/Challenges/utils/awaitable-messenger.ts",
            "status": "renamed",
            "additions": 20,
            "deletions": 13,
            "changes": 33,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/556a00198ea12ca77b0c2bca21b218432f2565e8/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fawaitable-messenger.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/556a00198ea12ca77b0c2bca21b218432f2565e8/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fawaitable-messenger.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fawaitable-messenger.ts?ref=556a00198ea12ca77b0c2bca21b218432f2565e8",
            "patch": "@@ -1,30 +1,34 @@\n+export type Messenger<Message> = {\n+  postMessage: (message: Message, options: WindowPostMessageOptions) => void;\n+};\n+\n /**\n- * Sends a message to a web worker and awaits a response.\n+ * Sends a message via a messenger (an object containing postMessage) and awaits a response.\n  *\n- * @template MessageOut - The type of the message being sent to the worker.\n- * @template MessageIn - The type of the message expected from the worker. Must include a `type` and `value` property.\n+ * @template MessageOut - The type of the message being sent.\n+ * @template MessageIn - The type of the message expected to be returned. Must include a `type` and `value` property.\n  * @template Value - The type of the value expected in the response message.\n  *\n  * @param {Object} params - The parameters for the function.\n- * @param {Worker} params.worker - The web worker to send the message to.\n- * @param {MessageOut} params.message - The message to send to the worker.\n- * @param {Function} params.onMessage - A callback function to handle the response from the worker.\n- * @param {MessageIn} params.onMessage.response - The response message from the worker.\n- * @param {Function} params.onMessage.resolve - A function to resolve the promise with the response value.\n- * @param {Function} params.onMessage.reject - A function to reject the promise with an error message.\n+ * @param {Message} params.messenger - An object cabable of sending messages via postMessage.\n+ * @param {MessageOut} params.message - The message to send .\n+ * @param {Function} params.onMessage - A callback function to handle the response.\n+ * @param {MessageIn} params.onMessage.response - The response message.\n+ * @param {Function} params.onMessage.resolve - A function which, when called, resolves the promise with its argument.\n+ * @param {Function} params.onMessage.reject - A function which, when called, rejects the promise with its argument.\n  *\n- * @returns {Promise<Value>} A promise that resolves with the response value from the worker or rejects with an error message.\n+ * @returns {Promise<Value>} A promise that resolves with the response value or rejects with an error message.\n  */\n export function awaitResponse<\n   MessageOut,\n   MessageIn extends { type: string; value: Value; error: string },\n   Value\n >({\n-  worker,\n+  messenger,\n   message,\n   onMessage\n }: {\n-  worker: Worker;\n+  messenger: Messenger<MessageOut>;\n   message: MessageOut;\n   onMessage: (\n     response: MessageIn,\n@@ -48,7 +52,10 @@ export function awaitResponse<\n         onMessage(event.data, resolve, reject);\n       };\n \n-      worker.postMessage(message, [channel.port2]);\n+      messenger.postMessage(message, {\n+        targetOrigin: '*',\n+        transfer: [channel.port2]\n+      });\n     }\n   );\n }",
            "previous_filename": "client/src/templates/Challenges/utils/worker-messenger.ts"
        },
        {
            "sha": "8c550f31c73ee087d1ff47a937b188bde8231cd7",
            "filename": "client/src/templates/Challenges/utils/typescript-worker-handler.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/556a00198ea12ca77b0c2bca21b218432f2565e8/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Ftypescript-worker-handler.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/556a00198ea12ca77b0c2bca21b218432f2565e8/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Ftypescript-worker-handler.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Ftypescript-worker-handler.ts?ref=556a00198ea12ca77b0c2bca21b218432f2565e8",
            "patch": "@@ -1,5 +1,5 @@\n import typeScriptWorkerData from '../../../../config/browser-scripts/typescript-worker.json';\n-import { awaitResponse } from './worker-messenger';\n+import { awaitResponse } from './awaitable-messenger';\n \n const typeScriptWorkerSrc = `/js/${typeScriptWorkerData.filename}.js`;\n \n@@ -14,7 +14,7 @@ function getTypeScriptWorker(): Worker {\n \n export function compileTypeScriptCode(code: string): Promise<string> {\n   return awaitResponse({\n-    worker: getTypeScriptWorker(),\n+    messenger: getTypeScriptWorker(),\n     message: { type: 'compile', code },\n     onMessage: (data, onSuccess, onFailure) => {\n       if (data.type === 'compiled') {\n@@ -32,7 +32,7 @@ export function compileTypeScriptCode(code: string): Promise<string> {\n \n export function checkTSServiceIsReady(): Promise<boolean> {\n   return awaitResponse({\n-    worker: getTypeScriptWorker(),\n+    messenger: getTypeScriptWorker(),\n     message: { type: 'check-is-ready' },\n     onMessage: (data, onSuccess) => {\n       if (data.type === 'ready') {"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 23,
        "deletions": 16
    }
}