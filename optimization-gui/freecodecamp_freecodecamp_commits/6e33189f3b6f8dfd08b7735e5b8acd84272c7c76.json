{
    "author": "huyenltnguyen",
    "message": "test(e2e): add tests for interactive editor toggle (#63043)",
    "sha": "6e33189f3b6f8dfd08b7735e5b8acd84272c7c76",
    "files": [
        {
            "sha": "fdca6a1e1bd1c1f99544ccb1e7f97e804afbea9a",
            "filename": "client/src/templates/Challenges/components/interactive-editor.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6e33189f3b6f8dfd08b7735e5b8acd84272c7c76/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Finteractive-editor.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6e33189f3b6f8dfd08b7735e5b8acd84272c7c76/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Finteractive-editor.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Finteractive-editor.tsx?ref=6e33189f3b6f8dfd08b7735e5b8acd84272c7c76",
            "patch": "@@ -53,7 +53,10 @@ const InteractiveEditor = ({ files }: Props) => {\n   };\n \n   return (\n-    <div className='interactive-editor-wrapper'>\n+    <div\n+      className='interactive-editor-wrapper'\n+      data-playwright-test-label='sp-interactive-editor'\n+    >\n       <Sandpack\n         template={\n           got('tsx')"
        },
        {
            "sha": "0e3e09e276a992dcf43b49fb990fa3b072dde999",
            "filename": "client/src/templates/Challenges/generic/show.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6e33189f3b6f8dfd08b7735e5b8acd84272c7c76/client%2Fsrc%2Ftemplates%2FChallenges%2Fgeneric%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6e33189f3b6f8dfd08b7735e5b8acd84272c7c76/client%2Fsrc%2Ftemplates%2FChallenges%2Fgeneric%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fgeneric%2Fshow.tsx?ref=6e33189f3b6f8dfd08b7735e5b8acd84272c7c76",
            "patch": "@@ -242,10 +242,7 @@ const ShowGeneric = ({\n         <Helmet\n           title={`${blockNameTitle} | ${t('learn.learn')} | freeCodeCamp.org`}\n         />\n-        <Container\n-          fluid\n-          className={`generic-challenge-container${hasInteractiveEditor ? ' has-action-row' : ''}`}\n-        >\n+        <Container fluid>\n           {hasInteractiveEditor && (\n             <ActionRow\n               hasInteractiveEditor={hasInteractiveEditor}"
        },
        {
            "sha": "95a4d57e1ae7f0790a45e7a56a74a04ade5e43a3",
            "filename": "e2e/interactive-editor.spec.ts",
            "status": "added",
            "additions": 181,
            "deletions": 0,
            "changes": 181,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6e33189f3b6f8dfd08b7735e5b8acd84272c7c76/e2e%2Finteractive-editor.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6e33189f3b6f8dfd08b7735e5b8acd84272c7c76/e2e%2Finteractive-editor.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Finteractive-editor.spec.ts?ref=6e33189f3b6f8dfd08b7735e5b8acd84272c7c76",
            "patch": "@@ -0,0 +1,181 @@\n+import { test, expect } from '@playwright/test';\n+\n+interface InteractiveFile {\n+  contents: string;\n+  ext: string;\n+  name: string;\n+  contentsHtml: string;\n+}\n+\n+interface Nodule {\n+  type: 'paragraph' | 'interactiveEditor';\n+  data: string | InteractiveFile[];\n+}\n+\n+interface PageData {\n+  result: {\n+    data: {\n+      challengeNode: {\n+        challenge: {\n+          title: string;\n+          nodules: Nodule[];\n+        };\n+      };\n+    };\n+  };\n+}\n+\n+const challengePath =\n+  '/learn/full-stack-developer/lecture-what-is-css/what-are-some-default-browser-styles-applied-to-html';\n+\n+const challengeTitle = 'Test Challenge Title';\n+\n+test.describe('Interactive Editor', () => {\n+  test('should render paragraph nodules as text and not show the interactive editor toggle', async ({\n+    page\n+  }) => {\n+    await page.route(\n+      `**/page-data${challengePath}/page-data.json`,\n+      async route => {\n+        const response = await route.fetch();\n+        const body = await response.text();\n+        const pageData = JSON.parse(body) as PageData;\n+\n+        pageData.result.data.challengeNode.challenge.title = challengeTitle;\n+        pageData.result.data.challengeNode.challenge.nodules = [\n+          {\n+            type: 'paragraph',\n+            data: '<p>This is a plain text paragraph.</p>'\n+          },\n+          {\n+            type: 'paragraph',\n+            data: '<p>Another paragraph with <code>code</code> in it.</p>'\n+          }\n+        ];\n+\n+        await route.fulfill({\n+          contentType: 'application/json',\n+          body: JSON.stringify(pageData)\n+        });\n+      }\n+    );\n+\n+    await page.goto(challengePath);\n+\n+    await expect(\n+      page.getByRole('heading', { name: challengeTitle })\n+    ).toBeVisible();\n+\n+    await expect(\n+      page.getByText('This is a plain text paragraph.')\n+    ).toBeVisible();\n+    await expect(\n+      page.getByText('Another paragraph with code in it.')\n+    ).toBeVisible();\n+\n+    await expect(\n+      page.getByRole('button', { name: /interactive editor/i })\n+    ).not.toBeVisible();\n+  });\n+\n+  test('should toggle between interactive editor and static code view when Interactive Editor button is clicked', async ({\n+    page\n+  }) => {\n+    await page.route(\n+      `**/page-data${challengePath}/page-data.json`,\n+      async route => {\n+        const response = await route.fetch();\n+        const body = await response.text();\n+        const pageData = JSON.parse(body) as PageData;\n+\n+        pageData.result.data.challengeNode.challenge.title = challengeTitle;\n+        pageData.result.data.challengeNode.challenge.nodules = [\n+          {\n+            type: 'paragraph',\n+            data: '<p>Introduction paragraph.</p>'\n+          },\n+          {\n+            type: 'interactiveEditor',\n+            data: [\n+              {\n+                contents: 'console.log(\"Toggle test\");',\n+                ext: 'js',\n+                name: 'script-1',\n+                contentsHtml:\n+                  '<pre><code class=\"language-javascript\">console.log(\"Toggle test\");</code></pre>'\n+              },\n+              {\n+                contents: '<div>HTML content</div>',\n+                ext: 'html',\n+                name: 'index-1',\n+                contentsHtml:\n+                  '<pre><code class=\"language-html\">&lt;div&gt;HTML content&lt;/div&gt;</code></pre>'\n+              }\n+            ]\n+          },\n+          {\n+            type: 'paragraph',\n+            data: '<p>Final paragraph.</p>'\n+          }\n+        ];\n+\n+        await route.fulfill({\n+          contentType: 'application/json',\n+          body: JSON.stringify(pageData)\n+        });\n+      }\n+    );\n+\n+    await page.goto(challengePath);\n+\n+    await expect(\n+      page.getByRole('heading', { name: challengeTitle })\n+    ).toBeVisible();\n+    await expect(page.getByText('Introduction paragraph.')).toBeVisible();\n+    await expect(page.getByText('Final paragraph.')).toBeVisible();\n+\n+    // Initially, interactive editor should be hidden, static code view should be visible\n+    await expect(page.getByTestId('sp-interactive-editor')).not.toBeVisible();\n+    await expect(\n+      page\n+        .locator('pre code')\n+        .filter({ hasText: 'console.log(\"Toggle test\");' })\n+    ).toHaveCount(1);\n+    await expect(\n+      page.locator('pre code').filter({ hasText: '<div>HTML content</div>' })\n+    ).toHaveCount(1);\n+    await expect(\n+      page.evaluate(() => localStorage.getItem('showInteractiveEditor'))\n+    ).resolves.toBe(null);\n+\n+    // Click the toggle button\n+    const toggleButton = page.getByRole('button', {\n+      name: /interactive editor/i\n+    });\n+    await toggleButton.click();\n+\n+    // Interactive editor should be visible, static code view hidden\n+    await expect(page.getByTestId('sp-interactive-editor')).toBeVisible();\n+    await expect(page.locator('pre code')).not.toBeVisible();\n+    await expect(\n+      page.evaluate(() => localStorage.getItem('showInteractiveEditor'))\n+    ).resolves.toBe('true');\n+\n+    // Click the toggle button again\n+    await toggleButton.click();\n+\n+    // Interactive editor should be hidden, static code view visible again\n+    await expect(page.getByTestId('sp-interactive-editor')).not.toBeVisible();\n+    await expect(\n+      page\n+        .locator('pre code')\n+        .filter({ hasText: 'console.log(\"Toggle test\");' })\n+    ).toBeVisible();\n+    await expect(\n+      page.locator('pre code').filter({ hasText: '<div>HTML content</div>' })\n+    ).toBeVisible();\n+    await expect(\n+      page.evaluate(() => localStorage.getItem('showInteractiveEditor'))\n+    ).resolves.toBe('false');\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 191,
        "additions": 186,
        "deletions": 5
    }
}