{
    "author": "huyenltnguyen",
    "message": "feat(client): add pinyin tone input to fill-in-the-blank challenge (#64085)",
    "sha": "73ad631dfd8128554622a94082c3d01029bf6c1c",
    "files": [
        {
            "sha": "3981b73989e2303643c52ddbf604bc73a699f28d",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/73ad631dfd8128554622a94082c3d01029bf6c1c/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/73ad631dfd8128554622a94082c3d01029bf6c1c/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=73ad631dfd8128554622a94082c3d01029bf6c1c",
            "patch": "@@ -965,7 +965,8 @@\n     \"terminal-output\": \"Terminal output\",\n     \"not-available\": \"Not available\",\n     \"interactive-editor-desc\": \"Turn static code examples into interactive editors. This allows you to edit and run the code directly on the page.\",\n-    \"pinyin-to-hanzi-input-desc\": \"This task uses Pinyin-to-Hanzi inputs. Type pinyin with tone numbers (1 to 5). When you enter a correct syllable, it will turn into a Chinese character. If you press backspace after a Chinese character, it will change back to pinyin and remove the last thing you typed: if it's a tone number, the tone is removed; if it's a letter, the letter is removed.\"\n+    \"pinyin-to-hanzi-input-desc\": \"This task uses Pinyin-to-Hanzi inputs. Type pinyin with tone numbers (1 to 5). When you enter a correct syllable, it will turn into a Chinese character. If you press backspace after a Chinese character, it will change back to pinyin and remove the last thing you typed: if it's a tone number, the tone is removed; if it's a letter, the letter is removed.\",\n+    \"pinyin-tone-input-desc\": \"This task uses Pinyin Tone inputs. Type pinyin with tone numbers (1 to 5). When you enter a tone number, it will be converted to a tone mark. If you press backspace, the last thing you typed is removed: if it's a tone number, the tone is removed; if it's a letter, the letter is removed.\"\n   },\n   \"flash\": {\n     \"no-email-in-userinfo\": \"We could not retrieve an email from your chosen provider. Please try another provider or use the 'Continue with Email' option.\","
        },
        {
            "sha": "ee315d9dd312b981c05a22fb66d810390c565b34",
            "filename": "client/src/templates/Challenges/components/fill-in-the-blanks.tsx",
            "status": "modified",
            "additions": 19,
            "deletions": 2,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/73ad631dfd8128554622a94082c3d01029bf6c1c/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Ffill-in-the-blanks.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/73ad631dfd8128554622a94082c3d01029bf6c1c/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Ffill-in-the-blanks.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Ffill-in-the-blanks.tsx?ref=73ad631dfd8128554622a94082c3d01029bf6c1c",
            "patch": "@@ -7,6 +7,7 @@ import PrismFormatted from '../components/prism-formatted';\n import { FillInTheBlank } from '../../../redux/prop-types';\n import ChallengeHeading from './challenge-heading';\n import PinyinToHanziInput from './pinyin-to-hanzi-input';\n+import PinyinToneInput from './pinyin-tone-input';\n \n type FillInTheBlankProps = {\n   fillInTheBlank: FillInTheBlank;\n@@ -72,6 +73,18 @@ const BlankInput = ({\n         ariaLabel={ariaLabel}\n       />\n     );\n+  } else if (inputType === 'pinyin-tone' && typeof parsedAnswer === 'string') {\n+    return (\n+      <PinyinToneInput\n+        index={blankIndex}\n+        isCorrect={isCorrect}\n+        onChange={onChange}\n+        className={className}\n+        maxLength={answerLength + 3}\n+        size={answerLength}\n+        ariaLabel={ariaLabel}\n+      />\n+    );\n   }\n \n   // Default text input\n@@ -113,13 +126,17 @@ function FillInTheBlanks({\n   const blankAnswers = blanks.map(b => b.answer);\n \n   const ariaInputDescription =\n-    inputType === 'pinyin-to-hanzi' ? t('aria.pinyin-to-hanzi-input-desc') : '';\n+    inputType === 'pinyin-to-hanzi'\n+      ? t('aria.pinyin-to-hanzi-input-desc')\n+      : inputType === 'pinyin-tone'\n+        ? t('aria.pinyin-tone-input-desc')\n+        : '';\n \n   return (\n     <>\n       <ChallengeHeading heading={t('learn.fill-in-the-blank.heading')} />\n       <Spacer size='xs' />\n-      <p className='sr-only'>{t(ariaInputDescription)}</p>\n+      <p className='sr-only'>{ariaInputDescription}</p>\n       <div className='fill-in-the-blank-wrap'>\n         {paragraphs.map((p, i) => (\n           // both keys, i and j, are stable between renders, since"
        },
        {
            "sha": "c220bc4d60cf22f1f0991f4320e18831d69b45ed",
            "filename": "client/src/templates/Challenges/components/pinyin-to-hanzi-input.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/73ad631dfd8128554622a94082c3d01029bf6c1c/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fpinyin-to-hanzi-input.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/73ad631dfd8128554622a94082c3d01029bf6c1c/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fpinyin-to-hanzi-input.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fpinyin-to-hanzi-input.tsx?ref=73ad631dfd8128554622a94082c3d01029bf6c1c",
            "patch": "@@ -226,7 +226,6 @@ function PinyinToHanziInput({\n       size={size}\n       autoComplete='off'\n       aria-label={ariaLabel}\n-      aria-describedby={`pinyin-description-${index}`}\n       {...(isCorrect === false ? { 'aria-invalid': 'true' } : {})}\n     />\n   );"
        },
        {
            "sha": "989bbd7836b368fba382d496e6f18c6b3305be83",
            "filename": "client/src/templates/Challenges/components/pinyin-tone-input.test.tsx",
            "status": "added",
            "additions": 284,
            "deletions": 0,
            "changes": 284,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/73ad631dfd8128554622a94082c3d01029bf6c1c/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fpinyin-tone-input.test.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/73ad631dfd8128554622a94082c3d01029bf6c1c/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fpinyin-tone-input.test.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fpinyin-tone-input.test.tsx?ref=73ad631dfd8128554622a94082c3d01029bf6c1c",
            "patch": "@@ -0,0 +1,284 @@\n+import React from 'react';\n+import { describe, test, expect, vi } from 'vitest';\n+import { render, screen } from '@testing-library/react';\n+import userEvent from '@testing-library/user-event';\n+\n+import PinyinToneInput, { convertToPinyinWithTones } from './pinyin-tone-input';\n+\n+describe('convertToPinyinWithTones', () => {\n+  test('should convert single syllable with tone number to pinyin with tone mark', () => {\n+    expect(convertToPinyinWithTones('ni3')).toBe('nǐ');\n+    expect(convertToPinyinWithTones('hao3')).toBe('hǎo');\n+  });\n+\n+  test('should handle all five tones correctly', () => {\n+    expect(convertToPinyinWithTones('ma1')).toBe('mā');\n+    expect(convertToPinyinWithTones('ma2')).toBe('má');\n+    expect(convertToPinyinWithTones('ma3')).toBe('mǎ');\n+    expect(convertToPinyinWithTones('ma4')).toBe('mà');\n+    expect(convertToPinyinWithTones('ma5')).toBe('ma');\n+\n+    expect(convertToPinyinWithTones('v1')).toBe('ǖ');\n+    expect(convertToPinyinWithTones('v2')).toBe('ǘ');\n+    expect(convertToPinyinWithTones('v3')).toBe('ǚ');\n+    expect(convertToPinyinWithTones('v4')).toBe('ǜ');\n+    expect(convertToPinyinWithTones('v5')).toBe('ü');\n+  });\n+\n+  test('should convert tone number before final letter', () => {\n+    expect(convertToPinyinWithTones('she2n')).toBe('shén');\n+  });\n+\n+  test('should convert tone number after final letter', () => {\n+    expect(convertToPinyinWithTones('shen2')).toBe('shén');\n+    expect(convertToPinyinWithTones('dian3')).toBe('diǎn');\n+  });\n+\n+  test('should chain multiple syllables without spaces', () => {\n+    expect(convertToPinyinWithTones('qing3wen4ni3jiao4shen2me5ming2zi5')).toBe(\n+      'qǐngwènnǐjiàoshénmemíngzi'\n+    );\n+  });\n+\n+  test('should preserve spaces between syllables', () => {\n+    expect(\n+      convertToPinyinWithTones('qing3 wen4 ni3 jiao4 shen2 me5 ming2 zi5')\n+    ).toBe('qǐng wèn nǐ jiào shén me míng zi');\n+    expect(convertToPinyinWithTones('ni3    hao3')).toBe('nǐ    hǎo');\n+  });\n+\n+  test('should handle uppercase input case-insensitively', () => {\n+    expect(convertToPinyinWithTones('NI3HAO3')).toBe('nǐhǎo');\n+    expect(convertToPinyinWithTones('Ni3hAO3')).toBe('nǐhǎo');\n+  });\n+\n+  test('should handle incomplete syllables without tone numbers', () => {\n+    expect(convertToPinyinWithTones('ni')).toBe('ni');\n+    expect(convertToPinyinWithTones('niha')).toBe('niha');\n+  });\n+\n+  test('should handle mixed complete and incomplete syllables', () => {\n+    expect(convertToPinyinWithTones('ni3ha')).toBe('nǐha');\n+    expect(convertToPinyinWithTones('ni3hao')).toBe('nǐhao');\n+  });\n+});\n+\n+describe('PinyinToneInput component', () => {\n+  test('should convert syllable when tone number is typed', async () => {\n+    const mockOnChange = vi.fn();\n+\n+    render(\n+      <PinyinToneInput\n+        index={0}\n+        isCorrect={null}\n+        onChange={mockOnChange}\n+        maxLength={100}\n+        size={20}\n+        ariaLabel='blank'\n+      />\n+    );\n+\n+    const input = screen.getByLabelText<HTMLInputElement>('blank');\n+\n+    await userEvent.type(input, 'ni3');\n+    expect(input.value).toBe('nǐ');\n+  });\n+\n+  test('should chain multiple syllables without spaces', async () => {\n+    const mockOnChange = vi.fn();\n+\n+    render(\n+      <PinyinToneInput\n+        index={0}\n+        isCorrect={null}\n+        onChange={mockOnChange}\n+        maxLength={100}\n+        size={20}\n+        ariaLabel='blank'\n+      />\n+    );\n+\n+    const input = screen.getByLabelText<HTMLInputElement>('blank');\n+\n+    await userEvent.type(input, 'ni3hao3');\n+    expect(input.value).toBe('nǐhǎo');\n+  });\n+\n+  test('should convert syllables with spaces', async () => {\n+    const mockOnChange = vi.fn();\n+\n+    render(\n+      <PinyinToneInput\n+        index={0}\n+        isCorrect={null}\n+        onChange={mockOnChange}\n+        maxLength={100}\n+        size={20}\n+        ariaLabel='blank'\n+      />\n+    );\n+\n+    const input = screen.getByLabelText<HTMLInputElement>('blank');\n+\n+    await userEvent.type(input, 'ni3 hao3');\n+    expect(input.value).toBe('nǐ hǎo');\n+  });\n+\n+  test('should allow changing the tone digit for a syllable', async () => {\n+    const mockOnChange = vi.fn();\n+\n+    render(\n+      <PinyinToneInput\n+        index={0}\n+        isCorrect={null}\n+        onChange={mockOnChange}\n+        maxLength={100}\n+        size={20}\n+        ariaLabel='blank'\n+      />\n+    );\n+\n+    const input = screen.getByLabelText<HTMLInputElement>('blank');\n+\n+    await userEvent.type(input, 'ni3');\n+    expect(input.value).toBe('nǐ');\n+\n+    // Replace tone 3 with tone 4\n+    await userEvent.type(input, '4');\n+    expect(input.value).toBe('nì');\n+  });\n+\n+  test('should clear the input when selecting all and pressing backspace', async () => {\n+    const mockOnChange = vi.fn();\n+\n+    render(\n+      <PinyinToneInput\n+        index={0}\n+        isCorrect={null}\n+        onChange={mockOnChange}\n+        maxLength={100}\n+        size={20}\n+        ariaLabel='blank'\n+      />\n+    );\n+\n+    const input = screen.getByLabelText<HTMLInputElement>('blank');\n+\n+    await userEvent.type(input, 'ni3hao3');\n+    expect(input.value).toBe('nǐhǎo');\n+\n+    await userEvent.clear(input);\n+    expect(input.value).toBe('');\n+  });\n+\n+  test('should handle tone number before final letter', async () => {\n+    const mockOnChange = vi.fn();\n+\n+    render(\n+      <PinyinToneInput\n+        index={0}\n+        isCorrect={null}\n+        onChange={mockOnChange}\n+        maxLength={100}\n+        size={20}\n+        ariaLabel='blank'\n+      />\n+    );\n+\n+    const input = screen.getByLabelText<HTMLInputElement>('blank');\n+\n+    await userEvent.type(input, 'she2n');\n+    expect(input.value).toBe('shén');\n+  });\n+\n+  test('should remove tone mark when backspacing', async () => {\n+    const mockOnChange = vi.fn();\n+    const expectedMap: Record<string, string> = {\n+      ni3hao: 'nǐhao',\n+      ni3ha: 'nǐha',\n+      ni3h: 'nǐh',\n+      ni3: 'nǐ',\n+      ni: 'ni',\n+      n: 'n'\n+    };\n+\n+    render(\n+      <PinyinToneInput\n+        index={0}\n+        isCorrect={null}\n+        onChange={mockOnChange}\n+        maxLength={100}\n+        size={20}\n+        ariaLabel='blank'\n+      />\n+    );\n+\n+    const input = screen.getByLabelText<HTMLInputElement>('blank');\n+\n+    await userEvent.type(input, 'ni3hao3');\n+    expect(input.value).toBe('nǐhǎo');\n+\n+    const rawSteps = ['ni3hao', 'ni3ha', 'ni3h', 'ni3', 'ni', 'n'];\n+    for (const step of rawSteps) {\n+      await userEvent.type(input, '{Backspace}');\n+      expect(input.value).toBe(expectedMap[step]);\n+    }\n+  });\n+\n+  test('should remove final letter before tone mark when backspacing syllables with tone before final letter', async () => {\n+    const mockOnChange = vi.fn();\n+\n+    render(\n+      <PinyinToneInput\n+        index={0}\n+        isCorrect={null}\n+        onChange={mockOnChange}\n+        maxLength={100}\n+        size={20}\n+        ariaLabel='blank'\n+      />\n+    );\n+\n+    const input = screen.getByLabelText<HTMLInputElement>('blank');\n+\n+    // Type 'she2n' - tone digit before final letter\n+    await userEvent.type(input, 'she2n');\n+    expect(input.value).toBe('shén');\n+\n+    // First backspace removes the final letter 'n'\n+    await userEvent.type(input, '{Backspace}');\n+    expect(input.value).toBe('shé');\n+\n+    // Second backspace removes the tone mark\n+    await userEvent.type(input, '{Backspace}');\n+    expect(input.value).toBe('she');\n+  });\n+\n+  test('should allow inserting mid-string', async () => {\n+    const mockOnChange = vi.fn();\n+\n+    render(\n+      <PinyinToneInput\n+        index={0}\n+        isCorrect={null}\n+        onChange={mockOnChange}\n+        maxLength={100}\n+        size={20}\n+        ariaLabel='blank'\n+      />\n+    );\n+\n+    const input = screen.getByLabelText<HTMLInputElement>('blank');\n+\n+    await userEvent.type(input, 'ni3hao3');\n+    expect(input.value).toBe('nǐhǎo');\n+\n+    // Simulate mid-string edit: insert 'x' between the syllables\n+    await userEvent.type(input, 'x', {\n+      initialSelectionStart: 1,\n+      initialSelectionEnd: 1\n+    });\n+\n+    expect(input.value).toBe('nxǐhǎo');\n+  });\n+});"
        },
        {
            "sha": "1847445c72af87275ce3b044a6f31732504c1ba9",
            "filename": "client/src/templates/Challenges/components/pinyin-tone-input.tsx",
            "status": "added",
            "additions": 133,
            "deletions": 0,
            "changes": 133,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/73ad631dfd8128554622a94082c3d01029bf6c1c/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fpinyin-tone-input.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/73ad631dfd8128554622a94082c3d01029bf6c1c/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fpinyin-tone-input.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fpinyin-tone-input.tsx?ref=73ad631dfd8128554622a94082c3d01029bf6c1c",
            "patch": "@@ -0,0 +1,133 @@\n+import React, { useState } from 'react';\n+import { convertUnspacedPinyin } from 'pinyin-tone/v2';\n+\n+/**\n+ * Converts raw pinyin input (with tone numbers) to pinyin with tone marks.\n+ *\n+ * Key behaviors:\n+ * 1. When a tone digit (1-5) is encountered -> convert syllable to toned pinyin\n+ * 2. Spaces are preserved in the output\n+ * 3. Incomplete syllables (without tone numbers) remain as-is\n+ */\n+export function convertToPinyinWithTones(raw: string): string {\n+  if (!raw.trim()) return raw;\n+\n+  let displayOutput = '';\n+  let currentSyllable = '';\n+\n+  // Process each character in the raw input\n+  for (const character of raw) {\n+    // Handle spaces: flush current syllable and preserve space\n+    if (character === ' ') {\n+      displayOutput += currentSyllable + ' ';\n+      currentSyllable = '';\n+      continue;\n+    }\n+\n+    // Add character to current syllable\n+    currentSyllable += character;\n+\n+    // When a tone digit is encountered, convert the syllable\n+    if (/[1-5]/.test(character)) {\n+      // Normalize to lowercase for conversion\n+      const normalizedSyllable = currentSyllable.toLowerCase();\n+      const convertedPinyin = convertUnspacedPinyin(normalizedSyllable);\n+\n+      displayOutput += convertedPinyin;\n+      currentSyllable = '';\n+    }\n+  }\n+\n+  // Append any unfinished syllable at the end\n+  return displayOutput + currentSyllable;\n+}\n+\n+interface PinyinToneInputProps {\n+  index: number;\n+  isCorrect: boolean | null;\n+  onChange: (index: number, value: string) => void;\n+  className?: string;\n+  maxLength: number;\n+  size: number;\n+  ariaLabel: string;\n+}\n+\n+function PinyinToneInput({\n+  index,\n+  isCorrect,\n+  onChange,\n+  className,\n+  maxLength,\n+  size,\n+  ariaLabel\n+}: PinyinToneInputProps): JSX.Element {\n+  const [rawInput, setRawInput] = useState('');\n+  const [displayValue, setDisplayValue] = useState('');\n+\n+  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n+    const inputValue = e.target.value;\n+    const prevLength = displayValue.length;\n+    const inputLength = inputValue.length;\n+\n+    const isAppendingAtEnd =\n+      inputLength > prevLength && inputValue.startsWith(displayValue);\n+    const isDeletingFromEnd =\n+      inputLength < prevLength && displayValue.startsWith(inputValue);\n+\n+    let newRawInput: string;\n+\n+    if (isAppendingAtEnd) {\n+      const added = inputValue.substring(prevLength);\n+\n+      // Handle tone digit replacement\n+      if (\n+        added.length === 1 &&\n+        /[1-5]/.test(added) &&\n+        /[1-5]$/.test(rawInput)\n+      ) {\n+        newRawInput = rawInput.slice(0, -1) + added;\n+      } else {\n+        newRawInput = rawInput + added;\n+      }\n+    } else if (isDeletingFromEnd) {\n+      if (inputLength === 0) {\n+        // When clearing the entire input:\n+        // - If the previous display was a single character,\n+        //   assume the user wants to remove the last character from raw input\n+        //   (e.g., undo the tone digit that converted it, like 'ni3' -> 'ni').\n+        // - Otherwise, fully clear raw input to an empty string.\n+        newRawInput = prevLength === 1 ? rawInput.slice(0, -1) : '';\n+      } else {\n+        // Remove characters from raw input\n+        const charsToRemove = prevLength - inputLength;\n+        newRawInput = rawInput.slice(0, -charsToRemove);\n+      }\n+    } else {\n+      // Mid-string edit - update new raw input directly\n+      newRawInput = inputValue;\n+    }\n+\n+    setRawInput(newRawInput);\n+    const newDisplayValue = convertToPinyinWithTones(newRawInput);\n+    setDisplayValue(newDisplayValue);\n+    onChange(index, newDisplayValue);\n+  };\n+\n+  return (\n+    <input\n+      type='text'\n+      value={displayValue}\n+      onChange={handleChange}\n+      className={className}\n+      maxLength={maxLength}\n+      size={size}\n+      autoComplete='off'\n+      aria-label={ariaLabel}\n+      {...(isCorrect === false ? { 'aria-invalid': 'true' } : {})}\n+    />\n+  );\n+}\n+\n+PinyinToneInput.displayName = 'PinyinToneInput';\n+\n+export default PinyinToneInput;"
        },
        {
            "sha": "f761487ebe292188d97ce9a8e9e31ff181808557",
            "filename": "client/src/templates/Challenges/fill-in-the-blank/show.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/73ad631dfd8128554622a94082c3d01029bf6c1c/client%2Fsrc%2Ftemplates%2FChallenges%2Ffill-in-the-blank%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/73ad631dfd8128554622a94082c3d01029bf6c1c/client%2Fsrc%2Ftemplates%2FChallenges%2Ffill-in-the-blank%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Ffill-in-the-blank%2Fshow.tsx?ref=73ad631dfd8128554622a94082c3d01029bf6c1c",
            "patch": "@@ -187,6 +187,13 @@ const ShowFillInTheBlank = ({\n             hanzi.replace(/\\s+/g, '')\n           );\n         }\n+      } else if (fillInTheBlank.inputType === 'pinyin-tone') {\n+        // Ignore spaces to allow both syllable formats:\n+        // spaced (e.g., 'nǐ hǎo') and unspaced (e.g., 'nǐhǎo').\n+        return (\n+          normalizedUserAnswer.replace(/\\s+/g, '') ===\n+          answer.toLowerCase().replace(/\\s+/g, '')\n+        );\n       }\n \n       return normalizedUserAnswer === answer.toLowerCase();"
        }
    ],
    "stats": {
        "total": 449,
        "additions": 445,
        "deletions": 4
    }
}