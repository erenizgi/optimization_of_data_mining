{
    "author": "Sembauke",
    "message": "feat: convert universal navigation test to Playwright (#54873)\n\nCo-authored-by: Naomi <accounts+github@nhcarrigan.com>",
    "sha": "1e83bed32139a718da70a9fa75fd8f8d4b8b88c6",
    "files": [
        {
            "sha": "b5584d1f1fc31bead01e38c1feb9413e0c3cf5c7",
            "filename": "cypress/e2e/default/learn/header/universal-navigation.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 114,
            "changes": 114,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/414c4d78954e9eff64c5ab21beebb242cef91b78/cypress%2Fe2e%2Fdefault%2Flearn%2Fheader%2Funiversal-navigation.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/414c4d78954e9eff64c5ab21beebb242cef91b78/cypress%2Fe2e%2Fdefault%2Flearn%2Fheader%2Funiversal-navigation.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/cypress%2Fe2e%2Fdefault%2Flearn%2Fheader%2Funiversal-navigation.ts?ref=414c4d78954e9eff64c5ab21beebb242cef91b78",
            "patch": "@@ -1,114 +0,0 @@\n-const navigationItems: { [key: string]: string } = {\n-  'navigation-list': '.nav-list',\n-  'toggle-button': '#toggle-button-nav',\n-  'sign-in-button': \"[data-test-label='landing-small-cta']\",\n-  'avatar-link': '.avatar-nav-link',\n-  'avatar-container': '.avatar-container',\n-  'sign-out-button': \"[data-value='sign-out-button']\",\n-  signout: \"[data-test-label='signout']\",\n-  'cancel-signout': \"[data-test-label='cancel-signout']\"\n-};\n-\n-const navigationLinks: { [key: string]: string } = {\n-  'sign-in': '/signin',\n-  donate: '/donate',\n-  curriculum: '/learn',\n-  forum: 'https://forum.freecodecamp.org/',\n-  news: 'https://freecodecamp.org/news/',\n-  radio: 'https://coderadio.freecodecamp.org',\n-  'avatar-link': '/developmentuser',\n-  settings: '/settings'\n-};\n-\n-describe('Default Navigation Menu', () => {\n-  it('should close the menu and focus on the Menu button when the Esc key is pressed while the navigation menu is expanded and an item in the menu is focused', () => {\n-    cy.visit('/learn');\n-    cy.get(navigationItems['toggle-button']).should('be.visible').click();\n-    cy.get(navigationItems['navigation-list']).contains('Curriculum').focus();\n-    cy.focused().type('{esc}');\n-    cy.get(navigationItems['navigation-list']).should('not.be.visible');\n-    cy.get(navigationItems['toggle-button']).should('be.focused');\n-  });\n-});\n-\n-describe('Authenticated Navigation Menu', () => {\n-  before(() => {\n-    cy.task('seed');\n-    cy.login();\n-    cy.visit('/');\n-    cy.get(navigationItems['toggle-button']).should('be.visible').click();\n-  });\n-  it('should show default avatar.', () => {\n-    testLink('Settings');\n-    cy.get(navigationItems['sign-in-button']).should('not.exist');\n-    cy.get(navigationItems['avatar-link'])\n-      .should('have.attr', 'href')\n-      .and('contain', navigationLinks['avatar-link']);\n-    cy.get(navigationItems['avatar-container']).should(\n-      'have.class',\n-      'default-border'\n-    );\n-    cy.get(navigationItems['navigation-list']).contains('Night Mode').click();\n-    cy.get('body').should('have.class', 'dark-palette');\n-  });\n-});\n-\n-describe('Authenticated User Sign Out', () => {\n-  before(() => {\n-    cy.task('seed');\n-  });\n-  beforeEach(() => {\n-    cy.login();\n-    cy.visit('/');\n-    cy.get(navigationItems['toggle-button']).should('be.visible').click();\n-  });\n-  it('should sign out user', () => {\n-    cy.get(navigationItems['sign-out-button']).click();\n-    cy.get(navigationItems['signout']).click();\n-    cy.get(navigationItems['sign-in-button']).should('be.visible');\n-    cy.get(navigationItems['sign-out-button']).should('not.exist');\n-    cy.get(navigationItems['avatar-link']).should('not.exist');\n-    cy.get(navigationItems['avatar-container']).should('not.exist');\n-  });\n-  it('should cancel the sign out', () => {\n-    cy.get(navigationItems['sign-out-button']).click();\n-    cy.get(navigationItems['cancel-signout']).click();\n-    cy.get(navigationItems['sign-in-button']).should('not.exist');\n-    cy.get(navigationItems['avatar-link']).should('be.visible');\n-    cy.get(navigationItems['avatar-container']).should('be.visible');\n-  });\n-});\n-\n-describe('Donor Navigation Menu', () => {\n-  before(() => {\n-    cy.task('seed', ['--donor']);\n-  });\n-  it('should show donor avatar border and thank you message.', () => {\n-    cy.login();\n-    cy.visit('/donate');\n-    cy.get(navigationItems['avatar-container']).should(\n-      'have.class',\n-      'gold-border'\n-    );\n-    cy.get(navigationItems['navigation-list']).contains('Supporters');\n-  });\n-});\n-\n-const testLink = (\n-  item: string,\n-  selector = 'navigation-list',\n-  checkParent = false\n-) => {\n-  if (checkParent) {\n-    return cy\n-      .get(navigationItems[selector])\n-      .should('contain.text', item)\n-      .should('have.attr', 'href')\n-      .and('contain', navigationLinks[item.replace(/\\s+/g, '-').toLowerCase()]);\n-  }\n-  return cy\n-    .get(navigationItems[selector])\n-    .contains(item)\n-    .should('have.attr', 'href')\n-    .and('contain', navigationLinks[item.replace(/\\s+/g, '-').toLowerCase()]);\n-};"
        },
        {
            "sha": "68270e3b68aa58a4e4096ab5994ed5e7b83b9ff5",
            "filename": "e2e/header.spec.ts",
            "status": "modified",
            "additions": 84,
            "deletions": 16,
            "changes": 100,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/1e83bed32139a718da70a9fa75fd8f8d4b8b88c6/e2e%2Fheader.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/1e83bed32139a718da70a9fa75fd8f8d4b8b88c6/e2e%2Fheader.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fheader.spec.ts?ref=1e83bed32139a718da70a9fa75fd8f8d4b8b88c6",
            "patch": "@@ -44,22 +44,6 @@ test('Renders universal nav by default', async ({ page }) => {\n   await expect(universalNavigationLogo).toHaveAttribute('href', '/learn');\n });\n \n-test('Renders exam nav for Foundational C# with Microsoft exam', async ({\n-  page\n-}) => {\n-  await page.goto(examUrl);\n-  await page\n-    .getByRole('button', {\n-      name: translations.buttons['click-start-exam']\n-    })\n-    .click();\n-  await expect(page).toHaveURL(examUrl);\n-  await expect(page.getByTestId(headerComponentElements.examNav)).toBeVisible();\n-  await expect(\n-    page.getByTestId(headerComponentElements.examNavLogo)\n-  ).toBeVisible();\n-});\n-\n test('Should display search in header on desktop and in menu on mobile', async ({\n   page,\n   isMobile\n@@ -120,6 +104,24 @@ test('Clicking the menu button should open the menu', async ({ page }) => {\n   await expect(menu).toBeVisible();\n });\n \n+test('Focusing on a menu item, and pressing Esc should close the menu and focus on the menu button', async ({\n+  page\n+}) => {\n+  const menuButton = page.getByTestId(headerComponentElements.menuButton);\n+  const menu = page.getByTestId(headerComponentElements.menu);\n+\n+  await expect(menuButton).toBeVisible();\n+  await menuButton.click();\n+\n+  const link = menu.getByRole('link', { name: translations.buttons.donate });\n+  await link.focus();\n+\n+  await page.keyboard.press('Escape');\n+  await expect(menu).toBeHidden();\n+\n+  await expect(menuButton).toBeFocused();\n+});\n+\n test('The menu should contain links to: donate, curriculum, forum, news, radio, contribute, and podcast', async ({\n   page\n }) => {\n@@ -167,6 +169,56 @@ test('The menu should contain links to: donate, curriculum, forum, news, radio,\n   }\n });\n \n+test('The menu should be able to change the theme', async ({ page }) => {\n+  const menuButton = page.getByTestId(headerComponentElements.menuButton);\n+  const menu = page.getByTestId(headerComponentElements.menu);\n+  await menuButton.click();\n+  await expect(menu).toBeVisible();\n+\n+  const themeButton = menu.getByRole('button', {\n+    name: 'Night Mode'\n+  });\n+  await themeButton.click();\n+\n+  await expect(page.locator('body')).toHaveClass('dark-palette');\n+\n+  await expect(page.getByTestId('flash-message')).toContainText(\n+    /We have updated your theme/\n+  );\n+  await expect(menu).toBeHidden();\n+\n+  await menuButton.click();\n+  await expect(menu).toBeVisible();\n+\n+  await themeButton.click();\n+  await expect(page.locator('body')).toHaveClass('light-palette');\n+});\n+\n+test('The header should contain an avatar', async ({ page }) => {\n+  const avatarLink = page.locator('.avatar-nav-link');\n+  await expect(avatarLink).toBeVisible();\n+  await expect(avatarLink).toHaveAttribute('href', '/certifieduser');\n+\n+  const avatarContainer = page.locator('.avatar-container');\n+  await expect(avatarContainer).toHaveClass('avatar-container blue-border');\n+});\n+\n+test('Renders exam nav for Foundational C# with Microsoft exam', async ({\n+  page\n+}) => {\n+  await page.goto(examUrl);\n+  await page\n+    .getByRole('button', {\n+      name: translations.buttons['click-start-exam']\n+    })\n+    .click();\n+  await expect(page).toHaveURL(examUrl);\n+  await expect(page.getByTestId(headerComponentElements.examNav)).toBeVisible();\n+  await expect(\n+    page.getByTestId(headerComponentElements.examNavLogo)\n+  ).toBeVisible();\n+});\n+\n test('The Sign In button should redirect to api/signin', async ({\n   browser\n }) => {\n@@ -185,3 +237,19 @@ test('The Sign In button should redirect to api/signin', async ({\n \n   await expect(signInButton).toHaveAttribute('href', `${apiLocation}/signin`);\n });\n+\n+test('When the user is signed out, only certain elements should be visible', async ({\n+  browser\n+}) => {\n+  const context = await browser.newContext({\n+    storageState: { cookies: [], origins: [] }\n+  });\n+  const page = await context.newPage();\n+  await page.goto('/');\n+  const signInButton = page\n+    .getByTestId(headerComponentElements.signInButton)\n+    .nth(0);\n+  await expect(signInButton).toBeVisible();\n+  await expect(page.locator('.avatar-nav-link')).toBeHidden();\n+  await expect(page.locator('.avatar-container')).toBeHidden();\n+});"
        }
    ],
    "stats": {
        "total": 214,
        "additions": 84,
        "deletions": 130
    }
}