{
    "author": "ojeytonwilliams",
    "message": "fix(api): more informative auth errors (#61607)",
    "sha": "55fbe40152a368b6a7d507a3459ee18f585c09ea",
    "files": [
        {
            "sha": "6051aa018d1797d8efcf46541796ef58af608f9d",
            "filename": "api/src/plugins/auth0.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/55fbe40152a368b6a7d507a3459ee18f585c09ea/api%2Fsrc%2Fplugins%2Fauth0.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/55fbe40152a368b6a7d507a3459ee18f585c09ea/api%2Fsrc%2Fplugins%2Fauth0.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fauth0.ts?ref=55fbe40152a368b6a7d507a3459ee18f585c09ea",
            "patch": "@@ -4,6 +4,7 @@ import { Type } from '@sinclair/typebox';\n import { Value } from '@sinclair/typebox/value';\n import fp from 'fastify-plugin';\n \n+import { isError } from 'lodash';\n import {\n   API_LOCATION,\n   AUTH0_CLIENT_ID,\n@@ -151,7 +152,14 @@ export const auth0Client: FastifyPluginCallbackTypebox = fp(\n         }\n       } catch (error) {\n         logger.error(error, 'Failed to get userinfo from Auth0');\n-        fastify.Sentry.captureException(error);\n+        if (isError(error) && 'innerError' in error) {\n+          // This is a specific error from the @fastify/oauth2 plugin.\n+          const innerError = error.innerError as Error;\n+          innerError.message = `Auth0 userinfo error: ${innerError.message}`;\n+          fastify.Sentry.captureException(error.innerError);\n+        } else {\n+          fastify.Sentry.captureException(error);\n+        }\n         return reply.redirectWithMessage(returnTo, {\n           type: 'danger',\n           content: 'flash.generic-error'"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 9,
        "deletions": 1
    }
}