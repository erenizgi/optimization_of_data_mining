{
    "author": "ShaunSHamilton",
    "message": "chore(api): add exam-env test script (#60445)",
    "sha": "a90e2757ac26d5753e22557de31df05aab443013",
    "files": [
        {
            "sha": "c0e31d88c901e44ac1f3b53c8fcb5b83cd38ce29",
            "filename": "api/README.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api%2FREADME.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api%2FREADME.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2FREADME.md?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -42,5 +42,5 @@ During development and testing, the api exposes the endpoint GET auth/dev-callba\n ## Generating Exams\n \n ```bash\n-pnpm run generate-exams <ENV_EXAM_ID> <NUMBER_OF_EXAMS_TO_GENERATE>\n+pnpm run exam-env:generate <ENV_EXAM_ID> <NUMBER_OF_EXAMS_TO_GENERATE>\n ```"
        },
        {
            "sha": "998dd8034cae57e497d8de7a6a8ddcdb01a0ae5f",
            "filename": "api/package.json",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api%2Fpackage.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fpackage.json?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -76,10 +76,11 @@\n     \"test-with-logging\": \"FCC_ENABLE_TEST_LOGGING=true pnpm run test\",\n     \"prisma\": \"dotenv -e ../.env prisma\",\n     \"postinstall\": \"prisma generate\",\n-    \"generate-exams\": \"tsx tools/exam-environment/generate/index.ts\",\n-    \"deprecate-exam\": \"tsx tools/exam-environment/generate/deprecate.ts\",\n-    \"insert-exam\": \"tsx tools/exam-environment/generate/insert.ts\",\n-    \"seed:env-exam\": \"tsx tools/exam-environment/seed/index.ts\"\n+    \"exam-env:generate\": \"tsx tools/exam-environment/generate/index.ts\",\n+    \"exam-env:generate:deprecate\": \"tsx tools/exam-environment/generate/deprecate.ts\",\n+    \"exam-env:generate:insert\": \"tsx tools/exam-environment/generate/insert.ts\",\n+    \"exam-env:seed\": \"tsx tools/exam-environment/seed/index.ts\",\n+    \"exam-env:test\": \"tsx tools/exam-environment/test/index.ts\"\n   },\n   \"version\": \"0.0.1\"\n }"
        },
        {
            "sha": "40b79d7ea899481ae0a305539d9fca171a5afac0",
            "filename": "api/tools/exam-environment/test/index.ts",
            "status": "added",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a90e2757ac26d5753e22557de31df05aab443013/api%2Ftools%2Fexam-environment%2Ftest%2Findex.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a90e2757ac26d5753e22557de31df05aab443013/api%2Ftools%2Fexam-environment%2Ftest%2Findex.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Ftools%2Fexam-environment%2Ftest%2Findex.ts?ref=a90e2757ac26d5753e22557de31df05aab443013",
            "patch": "@@ -0,0 +1,37 @@\n+//! Check the records on the database matches the Prisma schema\n+//!\n+//! This script should be run, before any deployments with Exam schema changes.\n+//! WARNING: This script queries every single record in the `Env<>` collections.\n+import { PrismaClient } from '@prisma/client';\n+import { PrismaClientKnownRequestError } from '@prisma/client/runtime/library';\n+import { MONGOHQ_URL } from '../../../src/utils/env';\n+\n+const prisma = new PrismaClient({\n+  datasources: {\n+    db: {\n+      url: MONGOHQ_URL\n+    }\n+  }\n+});\n+\n+async function main() {\n+  await prisma.$connect();\n+  try {\n+    const envExam = await prisma.envExam.findMany();\n+    const envGeneratedExam = await prisma.envGeneratedExam.findMany();\n+    const envExamAttempt = await prisma.envExamAttempt.findMany();\n+\n+    console.log('Number of exams:', envExam.length);\n+    console.log('Number of generated exams:', envGeneratedExam.length);\n+    console.log('Number of exam attempts:', envExamAttempt.length);\n+    // NOTE: This is not strictly true. E.g. If a `Boolean` becomes an `Int`, Prisma converts it instead of throwing.\n+    console.log('\\nSUCCESS! The database schema matches the Prisma schema.');\n+  } catch (error) {\n+    if (error instanceof PrismaClientKnownRequestError) {\n+      console.log(error.message);\n+      console.info('\\nCHECK DATABASE SCHEMA!');\n+    }\n+  }\n+}\n+\n+void main();"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 43,
        "deletions": 5
    }
}