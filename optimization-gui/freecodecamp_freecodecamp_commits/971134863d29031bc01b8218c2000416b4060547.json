{
    "author": "ShaunSHamilton",
    "message": "fix(client): retry failed rtk queries (#63976)",
    "sha": "971134863d29031bc01b8218c2000416b4060547",
    "files": [
        {
            "sha": "4f927660305276498cca732462b60dd256b0ff1c",
            "filename": "client/src/utils/ajax.ts",
            "status": "modified",
            "additions": 25,
            "deletions": 15,
            "changes": 40,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/971134863d29031bc01b8218c2000416b4060547/client%2Fsrc%2Futils%2Fajax.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/971134863d29031bc01b8218c2000416b4060547/client%2Fsrc%2Futils%2Fajax.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Fajax.ts?ref=971134863d29031bc01b8218c2000416b4060547",
            "patch": "@@ -1,5 +1,5 @@\n import cookies from 'browser-cookies';\n-import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react';\n+import { createApi, fetchBaseQuery, retry } from '@reduxjs/toolkit/query/react';\n \n import envData from '../../config/env.json';\n import type {\n@@ -453,13 +453,18 @@ export type GetExamsResponse = Array<{\n \n export const examAttempts = createApi({\n   reducerPath: 'exam-attempts',\n-  baseQuery: fetchBaseQuery({\n-    baseUrl: apiLocation,\n-    headers: {\n-      'CSRF-Token': getCSRFToken()\n-    },\n-    credentials: 'include'\n-  }),\n+  baseQuery: retry(\n+    fetchBaseQuery({\n+      baseUrl: apiLocation,\n+      prepareHeaders(headers) {\n+        headers.set('CSRF-Token', getCSRFToken());\n+        return headers;\n+      },\n+      credentials: 'include'\n+    }),\n+    // Retry in the case this is the initial request - csrf is not set yet, and initial returns 403\n+    { maxRetries: 2 }\n+  ),\n   endpoints: build => ({\n     getExamAttemptsByExamId: build.mutation<Attempt[], string>({\n       query: examId => `/user/exam-environment/exams/${examId}/attempts`\n@@ -476,13 +481,18 @@ export const examAttempts = createApi({\n \n export const examEnvironmentAuthorizationTokenApi = createApi({\n   reducerPath: 'exam-environment-authorization-token',\n-  baseQuery: fetchBaseQuery({\n-    baseUrl: apiLocation,\n-    headers: {\n-      'CSRF-Token': getCSRFToken()\n-    },\n-    credentials: 'include'\n-  }),\n+  baseQuery: retry(\n+    fetchBaseQuery({\n+      baseUrl: apiLocation,\n+      prepareHeaders(headers) {\n+        headers.set('CSRF-Token', getCSRFToken());\n+        return headers;\n+      },\n+      credentials: 'include'\n+    }),\n+    // Retry in the case this is the initial request - csrf is not set yet, and initial returns 403\n+    { maxRetries: 2 }\n+  ),\n   endpoints: build => ({\n     postGenerateExamEnvironmentAuthorizationToken: build.mutation<\n       ExamTokenResponse,"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 25,
        "deletions": 15
    }
}