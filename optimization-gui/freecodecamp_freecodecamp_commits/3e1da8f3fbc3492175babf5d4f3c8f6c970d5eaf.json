{
    "author": "ojeytonwilliams",
    "message": "refactor(client): store session user in dedicated key (#59954)",
    "sha": "3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
    "files": [
        {
            "sha": "d2cd6c7dc91ec11c5c22155efced1125376c95bc",
            "filename": "client/src/client-only-routes/show-certification.tsx",
            "status": "modified",
            "additions": 28,
            "deletions": 25,
            "changes": 53,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fclient-only-routes%2Fshow-certification.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fclient-only-routes%2Fshow-certification.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fclient-only-routes%2Fshow-certification.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -21,10 +21,11 @@ import {\n   showCertFetchStateSelector,\n   userFetchStateSelector,\n   isDonatingSelector,\n-  userByNameSelector,\n-  usernameSelector\n+  usernameSelector,\n+  createUserByNameSelector,\n+  isSignedInSelector\n } from '../redux/selectors';\n-import { UserFetchState, User } from '../redux/prop-types';\n+import type { UserFetchState, User } from '../redux/prop-types';\n import { liveCerts } from '../../config/cert-and-project-map';\n import {\n   certificateMissingErrorMessage,\n@@ -67,6 +68,7 @@ interface ShowCertificationProps {\n   };\n   isDonating: boolean;\n   isValidCert: boolean;\n+  isSignedIn: boolean;\n   location: {\n     pathname: string;\n   };\n@@ -78,41 +80,48 @@ interface ShowCertificationProps {\n     certSlug: string;\n   }) => void;\n   signedInUserName: string;\n-  user: User;\n+  user: User | null;\n   userFetchState: UserFetchState;\n   userFullName: string;\n   username: string;\n }\n \n-const requestedUserSelector = (state: unknown, { username = '' }) =>\n-  userByNameSelector(username.toLowerCase())(state) as User;\n-\n const mapStateToProps = (state: unknown, props: ShowCertificationProps) => {\n   const isValidCert = liveCerts.some(\n     ({ certSlug }) => String(certSlug) === props.certSlug\n   );\n+\n+  const { username } = props;\n+\n+  const userByNameSelector = createUserByNameSelector(username) as (\n+    state: unknown\n+  ) => User | null;\n+\n   return createSelector(\n     showCertSelector,\n     showCertFetchStateSelector,\n     usernameSelector,\n+    userByNameSelector,\n     userFetchStateSelector,\n     isDonatingSelector,\n-    requestedUserSelector,\n+    isSignedInSelector,\n     (\n       cert: Cert,\n       fetchState: ShowCertificationProps['fetchState'],\n       signedInUserName: string,\n+      user: User | null,\n       userFetchState: UserFetchState,\n       isDonating: boolean,\n-      user: User\n+      isSignedIn: boolean\n     ) => ({\n       cert,\n       fetchState,\n       isValidCert,\n       signedInUserName,\n+      user,\n       userFetchState,\n       isDonating,\n-      user\n+      isSignedIn\n     })\n   );\n };\n@@ -293,24 +302,19 @@ const ShowCertification = (props: ShowCertificationProps): JSX.Element => {\n       userFetchState: { complete: userComplete },\n       signedInUserName,\n       isDonating,\n+      isSignedIn,\n       cert: { username = '' },\n       fetchProfileForUser,\n       user\n     } = props;\n \n-    if (!signedInUserName || signedInUserName !== username) {\n-      if (isEmpty(user) && username) {\n-        fetchProfileForUser(username);\n-      }\n+    const isSessionUser = isSignedIn && signedInUserName === username;\n+\n+    if (isEmpty(user) && username) {\n+      fetchProfileForUser(username);\n     }\n \n-    if (\n-      !isDonationDisplayed &&\n-      userComplete &&\n-      signedInUserName &&\n-      signedInUserName === username &&\n-      !isDonating\n-    ) {\n+    if (!isDonationDisplayed && userComplete && isSessionUser && !isDonating) {\n       setIsDonationDisplayed(true);\n       callGA({\n         event: 'donation_view',\n@@ -341,7 +345,8 @@ const ShowCertification = (props: ShowCertificationProps): JSX.Element => {\n     isValidCert,\n     createFlashMessage,\n     signedInUserName,\n-    location: { pathname }\n+    location: { pathname },\n+    user\n   } = props;\n   const { pending, complete, errored } = fetchState;\n \n@@ -359,7 +364,7 @@ const ShowCertification = (props: ShowCertificationProps): JSX.Element => {\n     return <RedirectHome />;\n   }\n \n-  if (pending) {\n+  if (pending || !user) {\n     return <Loader fullScreen={true} />;\n   }\n \n@@ -376,8 +381,6 @@ const ShowCertification = (props: ShowCertificationProps): JSX.Element => {\n     completionTime\n   } = cert;\n \n-  const { user } = props;\n-\n   const displayName = userFullName ?? username;\n \n   const certDate = new Date(date);"
        },
        {
            "sha": "528c7dab2915ed11636e47803356fd817f402601",
            "filename": "client/src/client-only-routes/show-profile-or-four-oh-four.tsx",
            "status": "modified",
            "additions": 23,
            "deletions": 32,
            "changes": 55,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fclient-only-routes%2Fshow-profile-or-four-oh-four.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fclient-only-routes%2Fshow-profile-or-four-oh-four.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fclient-only-routes%2Fshow-profile-or-four-oh-four.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -8,50 +8,43 @@ import Loader from '../components/helpers/loader';\n import Profile from '../components/profile/profile';\n import { fetchProfileForUser } from '../redux/actions';\n import {\n-  usernameSelector,\n-  userByNameSelector,\n-  userProfileFetchStateSelector\n+  userSelector,\n+  userProfileFetchStateSelector,\n+  createUserByNameSelector\n } from '../redux/selectors';\n-import { User } from '../redux/prop-types';\n+import type { User } from '../redux/prop-types';\n import { Socials } from '../components/profile/components/internet';\n \n interface ShowProfileOrFourOhFourProps {\n   fetchProfileForUser: (username: string) => void;\n   updateMyPortfolio: () => void;\n   submitNewAbout: () => void;\n   updateMySocials: (formValues: Socials) => void;\n-  fetchState: {\n-    pending: boolean;\n-    complete: boolean;\n-    errored: boolean;\n-  };\n   isSessionUser: boolean;\n   maybeUser?: string;\n-  requestedUser: User;\n+  requestedUser: User | null;\n   showLoading: boolean;\n }\n \n-const createRequestedUserSelector =\n-  () =>\n-  (state: unknown, { maybeUser = '' }) =>\n-    userByNameSelector(maybeUser.toLowerCase())(state) as User;\n-const createIsSessionUserSelector =\n+const makeMapStateToProps =\n   () =>\n-  (state: unknown, { maybeUser = '' }) =>\n-    maybeUser.toLowerCase() === usernameSelector(state);\n+  (state: unknown, { maybeUser = '' }) => {\n+    const username = maybeUser.toLowerCase();\n+    const requestedUser = (\n+      createUserByNameSelector as (\n+        maybeUser: string\n+      ) => (state: unknown) => User | null\n+    )(username)(state);\n+    const sessionUser = userSelector(state) as User | null;\n+    const isSessionUser = username === sessionUser?.username;\n+    const fetchState = userProfileFetchStateSelector(state) as {\n+      pending: boolean;\n+    };\n \n-const makeMapStateToProps =\n-  () => (state: unknown, props: ShowProfileOrFourOhFourProps) => {\n-    const requestedUserSelector = createRequestedUserSelector();\n-    const isSessionUserSelector = createIsSessionUserSelector();\n-    const fetchState = userProfileFetchStateSelector(\n-      state\n-    ) as ShowProfileOrFourOhFourProps['fetchState'];\n     return {\n-      requestedUser: requestedUserSelector(state, props),\n-      isSessionUser: isSessionUserSelector(state, props),\n-      showLoading: fetchState.pending,\n-      fetchState\n+      requestedUser,\n+      isSessionUser,\n+      showLoading: fetchState.pending\n     };\n   };\n \n@@ -70,10 +63,8 @@ function ShowProfileOrFourOhFour({\n }: ShowProfileOrFourOhFourProps) {\n   useEffect(() => {\n     // If the user is not already in the store, fetch it\n-    if (isEmpty(requestedUser)) {\n-      if (maybeUser) {\n-        fetchProfileForUser(maybeUser);\n-      }\n+    if (isEmpty(requestedUser) && maybeUser) {\n+      fetchProfileForUser(maybeUser);\n     }\n     // eslint-disable-next-line react-hooks/exhaustive-deps\n   }, []);"
        },
        {
            "sha": "92919a5364f70e70dc2dc007ec618e736913c390",
            "filename": "client/src/client-only-routes/show-settings.tsx",
            "status": "modified",
            "additions": 41,
            "deletions": 32,
            "changes": 73,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fclient-only-routes%2Fshow-settings.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fclient-only-routes%2Fshow-settings.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fclient-only-routes%2Fshow-settings.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -26,7 +26,7 @@ import {\n   isSignedInSelector,\n   userTokenSelector\n } from '../redux/selectors';\n-import { User } from '../redux/prop-types';\n+import type { User } from '../redux/prop-types';\n import {\n   submitNewAbout,\n   updateMyHonesty,\n@@ -50,7 +50,7 @@ type ShowSettingsProps = {\n   toggleKeyboardShortcuts: (keyboardShortcuts: boolean) => void;\n   updateIsHonest: () => void;\n   updateQuincyEmail: (isSendQuincyEmail: boolean) => void;\n-  user: User;\n+  user: User | null;\n   verifyCert: typeof verifyCert;\n   path?: string;\n   userToken: string | null;\n@@ -61,7 +61,12 @@ const mapStateToProps = createSelector(\n   userSelector,\n   isSignedInSelector,\n   userTokenSelector,\n-  (showLoading: boolean, user: User, isSignedIn, userToken: string | null) => ({\n+  (\n+    showLoading: boolean,\n+    user: User | null,\n+    isSignedIn,\n+    userToken: string | null\n+  ) => ({\n     showLoading,\n     user,\n     isSignedIn,\n@@ -91,53 +96,57 @@ export function ShowSettings(props: ShowSettingsProps): JSX.Element {\n     toggleSoundMode,\n     toggleKeyboardShortcuts,\n     resetEditorLayout,\n-    user: {\n-      completedChallenges,\n-      email,\n-      is2018DataVisCert,\n-      isApisMicroservicesCert,\n-      isJsAlgoDataStructCert,\n-      isBackEndCert,\n-      isDataVisCert,\n-      isFrontEndCert,\n-      isInfosecQaCert,\n-      isQaCertV7,\n-      isInfosecCertV7,\n-      isFrontEndLibsCert,\n-      isFullStackCert,\n-      isRespWebDesignCert,\n-      isSciCompPyCertV7,\n-      isDataAnalysisPyCertV7,\n-      isMachineLearningPyCertV7,\n-      isRelationalDatabaseCertV8,\n-      isCollegeAlgebraPyCertV8,\n-      isFoundationalCSharpCertV8,\n-      isJsAlgoDataStructCertV8,\n-      isEmailVerified,\n-      isHonest,\n-      sendQuincyEmail,\n-      username,\n-      keyboardShortcuts\n-    },\n+    user,\n     navigate,\n     showLoading,\n     updateQuincyEmail,\n     updateIsHonest,\n     verifyCert,\n     userToken\n   } = props;\n+\n   const isSignedInRef = useRef(isSignedIn);\n \n   const examTokenFlag = useFeatureIsOn('exam-token-widget');\n \n-  if (showLoading) {\n+  if (showLoading || !user) {\n     return <Loader fullScreen={true} />;\n   }\n \n   if (!isSignedInRef.current) {\n     navigate(`${apiLocation}/signin`);\n     return <Loader fullScreen={true} />;\n   }\n+\n+  const {\n+    completedChallenges,\n+    email,\n+    is2018DataVisCert,\n+    isApisMicroservicesCert,\n+    isJsAlgoDataStructCert,\n+    isBackEndCert,\n+    isDataVisCert,\n+    isFrontEndCert,\n+    isInfosecQaCert,\n+    isQaCertV7,\n+    isInfosecCertV7,\n+    isFrontEndLibsCert,\n+    isFullStackCert,\n+    isRespWebDesignCert,\n+    isSciCompPyCertV7,\n+    isDataAnalysisPyCertV7,\n+    isMachineLearningPyCertV7,\n+    isRelationalDatabaseCertV8,\n+    isCollegeAlgebraPyCertV8,\n+    isFoundationalCSharpCertV8,\n+    isJsAlgoDataStructCertV8,\n+    isEmailVerified,\n+    isHonest,\n+    sendQuincyEmail,\n+    username,\n+    keyboardShortcuts\n+  } = user;\n+\n   const sound = (store.get('fcc-sound') as boolean) ?? false;\n   const editorLayout = (store.get('challenge-layout') as boolean) ?? false;\n   return ("
        },
        {
            "sha": "bbb58f7650e4d6da6b7635015aaf44ef3d04ec58",
            "filename": "client/src/client-only-routes/show-update-email.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fclient-only-routes%2Fshow-update-email.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fclient-only-routes%2Fshow-update-email.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fclient-only-routes%2Fshow-update-email.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -27,6 +27,7 @@ import { isSignedInSelector, userSelector } from '../redux/selectors';\n import { hardGoTo as navigate } from '../redux/actions';\n import { updateMyEmail } from '../redux/settings/actions';\n import { maybeEmailRE } from '../utils';\n+import type { User } from '../redux/prop-types';\n \n const { apiLocation } = envData;\n \n@@ -41,11 +42,8 @@ interface ShowUpdateEmailProps {\n const mapStateToProps = createSelector(\n   userSelector,\n   isSignedInSelector,\n-  (\n-    { email, emailVerified }: { email: string; emailVerified: boolean },\n-    isSignedIn\n-  ) => ({\n-    isNewEmail: !email || emailVerified,\n+  (user: User | null, isSignedIn) => ({\n+    isNewEmail: !user?.email || user.emailVerified,\n     isSignedIn\n   })\n );"
        },
        {
            "sha": "77452921d3ea2a2eab326170622c5d176c27cd4d",
            "filename": "client/src/components/Donation/donate-form.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2FDonation%2Fdonate-form.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2FDonation%2Fdonate-form.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FDonation%2Fdonate-form.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -25,7 +25,7 @@ import {\n   themeSelector\n } from '../../redux/selectors';\n import { LocalStorageThemes, DonateFormState } from '../../redux/types';\n-import type { CompletedChallenge } from '../../redux/prop-types';\n+import type { CompletedChallenge, User } from '../../redux/prop-types';\n import { CENTS_IN_DOLLAR, formattedAmountLabel } from './utils';\n import DonateCompletion from './donate-completion';\n import PatreonButton from './patreon-button';\n@@ -62,7 +62,7 @@ type PostCharge = (data: {\n type DonateFormProps = {\n   postCharge: PostCharge;\n   defaultTheme?: LocalStorageThemes;\n-  email: string;\n+  email?: string;\n   handleProcessing?: () => void;\n   editAmount?: () => void;\n   selectedDonationAmount?: DonationAmount;\n@@ -91,15 +91,15 @@ const mapStateToProps = createSelector(\n     isSignedIn: DonateFormProps['isSignedIn'],\n     isDonating: DonateFormProps['isDonating'],\n     donationFormState: DonateFormState,\n-    { email }: { email: string },\n+    user: User | null,\n     completedChallenges: CompletedChallenge[],\n     theme: LocalStorageThemes\n   ) => ({\n     isSignedIn,\n     isDonating,\n     showLoading,\n     donationFormState,\n-    email,\n+    email: user?.email,\n     completedChallenges,\n     theme\n   })"
        },
        {
            "sha": "8b876d092e50e4c66d85d9e02d4fee31c8a40e8d",
            "filename": "client/src/components/Donation/paypal-button.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2FDonation%2Fpaypal-button.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2FDonation%2Fpaypal-button.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FDonation%2Fpaypal-button.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -13,6 +13,7 @@ import {\n import envData from '../../../config/env.json';\n import { userSelector, signInLoadingSelector } from '../../redux/selectors';\n import { LocalStorageThemes } from '../../redux/types';\n+import type { User } from '../../redux/prop-types';\n import { DonationApprovalData, PostPayment } from './types';\n import PayPalButtonScriptLoader from './paypal-button-script-loader';\n \n@@ -177,8 +178,8 @@ class PaypalButton extends Component<PaypalButtonProps, PaypalButtonState> {\n const mapStateToProps = createSelector(\n   userSelector,\n   signInLoadingSelector,\n-  ({ isDonating }: { isDonating: boolean }, showLoading: boolean) => ({\n-    isDonating,\n+  (user: User | null, showLoading: boolean) => ({\n+    isDonating: !!user?.isDonating,\n     showLoading\n   })\n );"
        },
        {
            "sha": "6b850240a7e64e9ba8c932e8791bfca9b7021ec5",
            "filename": "client/src/components/Intro/index.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2FIntro%2Findex.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2FIntro%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FIntro%2Findex.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -10,7 +10,7 @@ import LearnAlert from './learn-alert';\n \n interface IntroProps {\n   complete?: boolean;\n-  completedChallengeCount?: number;\n+  completedChallengeCount: number;\n   isSignedIn?: boolean;\n   name?: string;\n   pending?: boolean;"
        },
        {
            "sha": "702a5c0e50faec7a6ad9cab5c05537a09343b4a7",
            "filename": "client/src/components/Intro/intro.test.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2FIntro%2Fintro.test.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2FIntro%2Fintro.test.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FIntro%2Fintro.test.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -27,6 +27,7 @@ describe('<Intro />', () => {\n \n const loggedInProps = {\n   complete: true,\n+  completedChallengeCount: 0,\n   isSignedIn: true,\n   name: 'Development User',\n   navigate: () => jest.fn(),\n@@ -39,6 +40,7 @@ const loggedInProps = {\n \n const loggedOutProps = {\n   complete: true,\n+  completedChallengeCount: 0,\n   isSignedIn: false,\n   name: '',\n   navigate: () => jest.fn(),"
        },
        {
            "sha": "729af3474321d507fe1085600d997726268b8354",
            "filename": "client/src/components/Map/index.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 21,
            "changes": 22,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2FMap%2Findex.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2FMap%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FMap%2Findex.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -1,8 +1,6 @@\n import i18next from 'i18next';\n-import { connect } from 'react-redux';\n import React, { Fragment } from 'react';\n import { Spacer } from '@freecodecamp/ui';\n-import { createSelector } from 'reselect';\n import { useTranslation } from 'react-i18next';\n \n import {\n@@ -17,13 +15,6 @@ import { ButtonLink } from '../helpers';\n import { showUpcomingChanges } from '../../../config/env.json';\n \n import './map.css';\n-\n-import {\n-  isSignedInSelector,\n-  currentCertsSelector,\n-  completedChallengesIdsSelector\n-} from '../../redux/selectors';\n-\n interface MapProps {\n   forLanding?: boolean;\n }\n@@ -46,17 +37,6 @@ const superBlockHeadings: { [key in SuperBlockStage]: string } = {\n   [SuperBlockStage.Catalog]: 'landing.catalog-heading'\n };\n \n-const mapStateToProps = createSelector(\n-  isSignedInSelector,\n-  currentCertsSelector,\n-  completedChallengesIdsSelector,\n-  (isSignedIn: boolean, currentCerts, completedChallengeIds: string[]) => ({\n-    isSignedIn,\n-    currentCerts,\n-    completedChallengeIds\n-  })\n-);\n-\n function MapLi({\n   superBlock,\n   landing = false\n@@ -124,4 +104,4 @@ function Map({ forLanding = false }: MapProps) {\n \n Map.displayName = 'Map';\n \n-export default connect(mapStateToProps)(Map);\n+export default Map;"
        },
        {
            "sha": "6fb7c393931d861074edd1ec57f8eed44c540c39",
            "filename": "client/src/components/growth-book/growth-book-wrapper.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 12,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2Fgrowth-book%2Fgrowth-book-wrapper.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2Fgrowth-book%2Fgrowth-book-wrapper.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fgrowth-book%2Fgrowth-book-wrapper.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -6,14 +6,10 @@ import {\n } from '@growthbook/growthbook-react';\n import { connect } from 'react-redux';\n import { createSelector } from 'reselect';\n-import {\n-  isSignedInSelector,\n-  userSelector,\n-  userFetchStateSelector\n-} from '../../redux/selectors';\n+import { userSelector, userFetchStateSelector } from '../../redux/selectors';\n import envData from '../../../config/env.json';\n import defaultGrowthBookFeatures from '../../../config/growthbook-features-default.json';\n-import { User, UserFetchState } from '../../redux/prop-types';\n+import type { User, UserFetchState } from '../../redux/prop-types';\n import { getUUID } from '../../utils/growthbook-cookie';\n import callGA from '../../analytics/call-ga';\n import GrowthBookReduxConnector from './growth-book-redux-connector';\n@@ -30,11 +26,9 @@ declare global {\n }\n \n const mapStateToProps = createSelector(\n-  isSignedInSelector,\n   userSelector,\n   userFetchStateSelector,\n-  (isSignedIn, user: User, userFetchState: UserFetchState) => ({\n-    isSignedIn,\n+  (user: User | null, userFetchState: UserFetchState) => ({\n     user,\n     userFetchState\n   })\n@@ -56,7 +50,6 @@ interface UserAttributes {\n \n const GrowthBookWrapper = ({\n   children,\n-  isSignedIn,\n   user,\n   userFetchState\n }: GrowthBookWrapper) => {\n@@ -105,7 +98,7 @@ const GrowthBookWrapper = ({\n         clientLocal: clientLocale\n       };\n \n-      if (isSignedIn) {\n+      if (user) {\n         userAttributes = {\n           ...userAttributes,\n           staff: user.email.includes('@freecodecamp'),\n@@ -116,7 +109,7 @@ const GrowthBookWrapper = ({\n       }\n       growthbook.setAttributes(userAttributes);\n     }\n-  }, [isSignedIn, user, userFetchState, growthbook]);\n+  }, [user, userFetchState, growthbook]);\n \n   return (\n     <GrowthBookProvider growthbook={growthbook}>"
        },
        {
            "sha": "8fce62fb974bef67f853c9550ec4fa9c38b7b1b2",
            "filename": "client/src/components/profile/components/certifications.tsx",
            "status": "modified",
            "additions": 11,
            "deletions": 39,
            "changes": 50,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fcertifications.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fcertifications.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fcertifications.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -1,42 +1,15 @@\n import React from 'react';\n import { useTranslation } from 'react-i18next';\n-import { connect } from 'react-redux';\n-import { createSelector } from 'reselect';\n import { Spacer } from '@freecodecamp/ui';\n \n-import { certificatesByNameSelector } from '../../../redux/selectors';\n-import type { CurrentCert } from '../../../redux/prop-types';\n+import type { CurrentCert, User } from '../../../redux/prop-types';\n import { FullWidthRow, ButtonLink } from '../../helpers';\n-import './certifications.css';\n+import { getCertifications } from './utils/certification';\n \n-const mapStateToProps = (\n-  state: Record<string, unknown>,\n-  props: CertificationProps\n-) =>\n-  createSelector(\n-    certificatesByNameSelector(props.username.toLowerCase()),\n-    ({\n-      hasModernCert,\n-      hasLegacyCert,\n-      currentCerts,\n-      legacyCerts\n-    }: Pick<\n-      CertificationProps,\n-      'hasModernCert' | 'hasLegacyCert' | 'currentCerts' | 'legacyCerts'\n-    >) => ({\n-      hasModernCert,\n-      hasLegacyCert,\n-      currentCerts,\n-      legacyCerts\n-    })\n-  )(state);\n+import './certifications.css';\n \n interface CertificationProps {\n-  currentCerts?: CurrentCert[];\n-  hasLegacyCert?: boolean;\n-  hasModernCert?: boolean;\n-  legacyCerts?: CurrentCert[];\n-  username: string;\n+  user: User;\n }\n \n interface CertButtonProps {\n@@ -62,13 +35,12 @@ function CertButton({ username, cert }: CertButtonProps): JSX.Element {\n   );\n }\n \n-function Certificates({\n-  currentCerts,\n-  legacyCerts,\n-  hasLegacyCert,\n-  hasModernCert,\n-  username\n-}: CertificationProps): JSX.Element {\n+function Certificates({ user }: CertificationProps): JSX.Element {\n+  const { username } = user;\n+\n+  const { currentCerts, legacyCerts, hasLegacyCert, hasModernCert } =\n+    getCertifications(user);\n+\n   const { t } = useTranslation();\n   return (\n     <FullWidthRow className='profile-certifications'>\n@@ -122,4 +94,4 @@ function Certificates({\n \n Certificates.displayName = 'Certifications';\n \n-export default connect(mapStateToProps)(Certificates);\n+export default Certificates;"
        },
        {
            "sha": "d0857cd1c029f6f44262ba840fce2f68d4fd3159",
            "filename": "client/src/components/profile/components/utils/certification.ts",
            "status": "added",
            "additions": 152,
            "deletions": 0,
            "changes": 152,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Futils%2Fcertification.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Futils%2Fcertification.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Futils%2Fcertification.ts?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -0,0 +1,152 @@\n+import { Certification } from '../../../../../../shared/config/certification-settings';\n+import { User } from '../../../../redux/prop-types';\n+\n+export const getCertifications = (user: User) => {\n+  const {\n+    isRespWebDesignCert,\n+    is2018DataVisCert,\n+    isFrontEndLibsCert,\n+    isJsAlgoDataStructCert,\n+    isApisMicroservicesCert,\n+    isInfosecQaCert,\n+    isQaCertV7,\n+    isInfosecCertV7,\n+    isFrontEndCert,\n+    isBackEndCert,\n+    isDataVisCert,\n+    isFullStackCert,\n+    isSciCompPyCertV7,\n+    isDataAnalysisPyCertV7,\n+    isMachineLearningPyCertV7,\n+    isRelationalDatabaseCertV8,\n+    isCollegeAlgebraPyCertV8,\n+    isFoundationalCSharpCertV8,\n+    isJsAlgoDataStructCertV8\n+  } = user;\n+\n+  return {\n+    hasModernCert:\n+      isRespWebDesignCert ||\n+      is2018DataVisCert ||\n+      isFrontEndLibsCert ||\n+      isApisMicroservicesCert ||\n+      isQaCertV7 ||\n+      isInfosecCertV7 ||\n+      isFullStackCert ||\n+      isSciCompPyCertV7 ||\n+      isDataAnalysisPyCertV7 ||\n+      isMachineLearningPyCertV7 ||\n+      isRelationalDatabaseCertV8 ||\n+      isCollegeAlgebraPyCertV8 ||\n+      isFoundationalCSharpCertV8 ||\n+      isJsAlgoDataStructCertV8,\n+    hasLegacyCert:\n+      isFrontEndCert ||\n+      isJsAlgoDataStructCert ||\n+      isBackEndCert ||\n+      isDataVisCert ||\n+      isInfosecQaCert,\n+    isFullStackCert,\n+    currentCerts: [\n+      {\n+        show: isRespWebDesignCert,\n+        title: 'Responsive Web Design Certification',\n+        certSlug: Certification.RespWebDesign\n+      },\n+      {\n+        show: isJsAlgoDataStructCertV8,\n+        title: 'JavaScript Algorithms and Data Structures Certification',\n+        certSlug: Certification.JsAlgoDataStructNew\n+      },\n+      {\n+        show: isFrontEndLibsCert,\n+        title: 'Front End Development Libraries Certification',\n+        certSlug: Certification.FrontEndDevLibs\n+      },\n+      {\n+        show: is2018DataVisCert,\n+        title: 'Data Visualization Certification',\n+        certSlug: Certification.DataVis\n+      },\n+      {\n+        show: isRelationalDatabaseCertV8,\n+        title: 'Relational Database Certification',\n+        certSlug: Certification.RelationalDb\n+      },\n+      {\n+        show: isApisMicroservicesCert,\n+        title: 'Back End Development and APIs Certification',\n+        certSlug: Certification.BackEndDevApis\n+      },\n+      {\n+        show: isQaCertV7,\n+        title: 'Quality Assurance Certification',\n+        certSlug: Certification.QualityAssurance\n+      },\n+      {\n+        show: isSciCompPyCertV7,\n+        title: 'Scientific Computing with Python Certification',\n+        certSlug: Certification.SciCompPy\n+      },\n+      {\n+        show: isDataAnalysisPyCertV7,\n+        title: 'Data Analysis with Python Certification',\n+        certSlug: Certification.DataAnalysisPy\n+      },\n+      {\n+        show: isInfosecCertV7,\n+        title: 'Information Security Certification',\n+        certSlug: Certification.InfoSec\n+      },\n+      {\n+        show: isMachineLearningPyCertV7,\n+        title: 'Machine Learning with Python Certification',\n+        certSlug: Certification.MachineLearningPy\n+      },\n+      {\n+        show: isCollegeAlgebraPyCertV8,\n+        title: 'College Algebra with Python Certification',\n+        certSlug: Certification.CollegeAlgebraPy\n+      },\n+      {\n+        show: isFoundationalCSharpCertV8,\n+        title: 'Foundational C# with Microsoft Certification',\n+        certSlug: Certification.FoundationalCSharp\n+      }\n+    ],\n+    legacyCerts: [\n+      {\n+        show: isFrontEndCert,\n+        title: 'Front End Certification',\n+        certSlug: Certification.LegacyFrontEnd\n+      },\n+      {\n+        show: isJsAlgoDataStructCert,\n+        title: 'Legacy JavaScript Algorithms and Data Structures Certification',\n+        certSlug: Certification.JsAlgoDataStruct\n+      },\n+      {\n+        show: isBackEndCert,\n+        title: 'Back End Certification',\n+        certSlug: Certification.LegacyBackEnd\n+      },\n+      {\n+        show: isDataVisCert,\n+        title: 'Data Visualization Certification',\n+        certSlug: Certification.LegacyDataVis\n+      },\n+      {\n+        show: isInfosecQaCert,\n+        title: 'Information Security and Quality Assurance Certification',\n+        // Keep the current public profile cert slug\n+        certSlug: Certification.LegacyInfoSecQa\n+      },\n+      {\n+        show: isFullStackCert,\n+        title: 'Full Stack Certification',\n+        // Keep the current public profile cert slug\n+        certSlug: Certification.LegacyFullStack\n+      }\n+    ]\n+  };\n+};"
        },
        {
            "sha": "5516736212506eb196d6aa24da9f32c732563c3d",
            "filename": "client/src/components/profile/profile.test.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2Fprofile%2Fprofile.test.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2Fprofile%2Fprofile.test.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fprofile%2Fprofile.test.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -81,7 +81,7 @@ const notMyProfileProps = {\n };\n function reducer() {\n   return {\n-    app: { appUsername: 'vasili', user: { vasili: userProps.user } }\n+    app: { user: { sessionUser: userProps.user } }\n   };\n }\n function renderWithRedux(ui: JSX.Element) {"
        },
        {
            "sha": "6d492f4229ec02fdecc97846e24a7e660fa70e6f",
            "filename": "client/src/components/profile/profile.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2Fprofile%2Fprofile.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fcomponents%2Fprofile%2Fprofile.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fprofile%2Fprofile.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -122,7 +122,7 @@ function UserProfile({ user, isSessionUser }: ProfileProps): JSX.Element {\n       {showPortfolio ? (\n         <PortfolioProjects portfolioProjects={portfolio} />\n       ) : null}\n-      {showCerts ? <Certifications username={username} /> : null}\n+      {showCerts ? <Certifications user={user} /> : null}\n       {showTimeLine ? (\n         <Timeline completedMap={completedChallenges} username={username} />\n       ) : null}"
        },
        {
            "sha": "c5774ff76fe43716b67bbe1935448538ca28eed5",
            "filename": "client/src/pages/email-sign-up.tsx",
            "status": "modified",
            "additions": 6,
            "deletions": 12,
            "changes": 18,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fpages%2Femail-sign-up.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fpages%2Femail-sign-up.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fpages%2Femail-sign-up.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -17,32 +17,26 @@ import {\n   userSelector,\n   isSignedInSelector\n } from '../redux/selectors';\n+import type { User } from '../redux/prop-types';\n \n import './email-sign-up.css';\n interface AcceptPrivacyTermsProps {\n   acceptTerms: (accept: boolean | null) => void;\n   acceptedPrivacyTerms: boolean;\n   isSignedIn: boolean;\n   showLoading: boolean;\n-  completedChallengeCount?: number;\n+  completedChallengeCount: number;\n }\n \n const mapStateToProps = createSelector(\n   userSelector,\n   isSignedInSelector,\n   signInLoadingSelector,\n-  (\n-    {\n-      acceptedPrivacyTerms,\n-      completedChallengeCount\n-    }: { acceptedPrivacyTerms: boolean; completedChallengeCount: number },\n-    isSignedIn: boolean,\n-    showLoading: boolean\n-  ) => ({\n-    acceptedPrivacyTerms,\n+  (user: User | null, isSignedIn: boolean, showLoading: boolean) => ({\n+    acceptedPrivacyTerms: !!user?.acceptedPrivacyTerms,\n     isSignedIn,\n     showLoading,\n-    completedChallengeCount\n+    completedChallengeCount: user?.completedChallengeCount ?? 0\n   })\n );\n const mapDispatchToProps = (dispatch: Dispatch) =>\n@@ -109,7 +103,7 @@ function AcceptPrivacyTerms({\n   acceptedPrivacyTerms,\n   isSignedIn,\n   showLoading,\n-  completedChallengeCount = 0\n+  completedChallengeCount\n }: AcceptPrivacyTermsProps) {\n   const { t } = useTranslation();\n   const acceptedPrivacyRef = useRef(acceptedPrivacyTerms);"
        },
        {
            "sha": "fdc1af4ad97e815452780a429a392c9d7736cdc3",
            "filename": "client/src/pages/learn.tsx",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fpages%2Flearn.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fpages%2Flearn.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fpages%2Flearn.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -23,18 +23,18 @@ interface FetchState {\n   errored: boolean;\n }\n \n-interface User {\n+type MaybeUser = {\n   name: string;\n   username: string;\n   completedChallengeCount: number;\n   isDonating: boolean;\n-}\n+} | null;\n \n const mapStateToProps = createSelector(\n   userFetchStateSelector,\n   isSignedInSelector,\n   userSelector,\n-  (fetchState: FetchState, isSignedIn: boolean, user: User) => ({\n+  (fetchState: FetchState, isSignedIn: boolean, user: MaybeUser) => ({\n     fetchState,\n     isSignedIn,\n     user\n@@ -49,7 +49,7 @@ interface LearnPageProps {\n   isSignedIn: boolean;\n   fetchState: FetchState;\n   state: Record<string, unknown>;\n-  user: User;\n+  user: MaybeUser;\n   data: {\n     challengeNode: {\n       challenge: {\n@@ -59,10 +59,12 @@ interface LearnPageProps {\n   };\n }\n \n+const EMPTY_USER = { name: '', completedChallengeCount: 0, isDonating: false };\n+\n function LearnPage({\n   isSignedIn,\n   fetchState: { pending, complete },\n-  user: { name = '', completedChallengeCount = 0, isDonating = false },\n+  user,\n   data: {\n     challengeNode: {\n       challenge: {\n@@ -71,6 +73,8 @@ function LearnPage({\n     }\n   }\n }: LearnPageProps) {\n+  const { name, completedChallengeCount, isDonating } = user ?? EMPTY_USER;\n+\n   const { t } = useTranslation();\n \n   const onLearnDonationAlertClick = () => {"
        },
        {
            "sha": "cea7966eae48bb9b8bea846fba3edf2cfc0ee339",
            "filename": "client/src/redux/donation-saga.test.js",
            "status": "modified",
            "additions": 3,
            "deletions": 10,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Fdonation-saga.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Fdonation-saga.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fdonation-saga.test.js?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -49,9 +49,8 @@ const analyticsDataMock = {\n \n const signedInStoreMock = {\n   app: {\n-    appUsername: 'devuser',\n     user: {\n-      devuser: {\n+      sessionUser: {\n         completedChallenges: [\n           {\n             id: 'bd7123c8c441eddfaeb5bdef',\n@@ -81,11 +80,8 @@ const signedInStoreMock = {\n \n const signedOutStoreMock = {\n   app: {\n-    appUsername: '',\n     user: {\n-      '': {\n-        completedChallenges: []\n-      }\n+      sessionUser: null\n     }\n   }\n };\n@@ -162,11 +158,8 @@ describe('donation-saga', () => {\n \n     const signedOutStoreMock = {\n       app: {\n-        appUsername: '',\n         user: {\n-          '': {\n-            completedChallenges: []\n-          }\n+          sessionUser: null\n         }\n       }\n     };"
        },
        {
            "sha": "d3e3bc3bd262a87699813f3ce5afb2941ca0d441",
            "filename": "client/src/redux/failed-updates-epic.test.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Ffailed-updates-epic.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Ffailed-updates-epic.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Ffailed-updates-epic.test.js?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -28,7 +28,7 @@ const initialState = {\n   app: {\n     isOnline: true,\n     isServerOnline: true,\n-    appUsername: 'developmentuser'\n+    user: { sessionUser: {} }\n   }\n };\n "
        },
        {
            "sha": "6a2d8835be6bed760b6aa28c7c90454b3b4f269c",
            "filename": "client/src/redux/fetch-user-saga.js",
            "status": "modified",
            "additions": 4,
            "deletions": 12,
            "changes": 16,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Ffetch-user-saga.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Ffetch-user-saga.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Ffetch-user-saga.js?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -9,12 +9,9 @@ import {\n \n function* fetchSessionUser() {\n   try {\n-    const {\n-      data: { user = {}, result = '' }\n-    } = yield call(getSessionUser);\n-    const appUser = user[result] || {};\n+    const { data: user } = yield call(getSessionUser);\n \n-    yield put(fetchUserComplete({ user: appUser, username: result }));\n+    yield put(fetchUserComplete({ user }));\n   } catch (e) {\n     console.log('failed to fetch user', e);\n     yield put(fetchUserError(e));\n@@ -25,13 +22,8 @@ function* fetchOtherUser({ payload: maybeUser = '' }) {\n   try {\n     const maybeUserLC = maybeUser.toLowerCase();\n \n-    const {\n-      data: { entities: { user = {} } = {}, result = '' }\n-    } = yield call(getUserProfile, maybeUserLC);\n-    const otherUser = user[result] || {};\n-    yield put(\n-      fetchProfileForUserComplete({ user: otherUser, username: result })\n-    );\n+    const { data: otherUser } = yield call(getUserProfile, maybeUserLC);\n+    yield put(fetchProfileForUserComplete({ user: otherUser }));\n   } catch (e) {\n     yield put(fetchProfileForUserError(e));\n   }"
        },
        {
            "sha": "24fa99db37bdf4aeab06f026a769139285d6f883",
            "filename": "client/src/redux/index.js",
            "status": "modified",
            "additions": 36,
            "deletions": 53,
            "changes": 89,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Findex.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Findex.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Findex.js?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -50,7 +50,6 @@ export const defaultDonationFormState = {\n };\n \n const initialState = {\n-  appUsername: '',\n   isRandomCompletionThreshold: false,\n   donatableSectionRecentlyCompleted: null,\n   currentChallengeId: store.get(CURRENT_CHALLENGE_KEY),\n@@ -61,7 +60,7 @@ const initialState = {\n   showCertFetchState: {\n     ...defaultFetchState\n   },\n-  user: {},\n+  user: { sessionUser: null, otherUser: null },\n   userFetchState: {\n     ...defaultFetchState\n   },\n@@ -107,8 +106,8 @@ function spreadThePayloadOnUser(state, payload) {\n     ...state,\n     user: {\n       ...state.user,\n-      [state.appUsername]: {\n-        ...state.user[state.appUsername],\n+      sessionUser: {\n+        ...state.user.sessionUser,\n         ...payload\n       }\n     }\n@@ -118,21 +117,20 @@ function spreadThePayloadOnUser(state, payload) {\n export const reducer = handleActions(\n   {\n     [actionTypes.acceptTermsComplete]: (state, { payload }) => {\n-      const { appUsername } = state;\n       return {\n         ...state,\n         user: {\n           ...state.user,\n-          [appUsername]: {\n-            ...state.user[appUsername],\n+          sessionUser: {\n+            ...state.user.sessionUser,\n             // TODO: the user accepts the privacy terms in practice during auth\n             // however, it's currently being used to track if they've accepted\n             // or rejected the newsletter. Ideally this should be migrated,\n             // since they can't sign up without accepting the terms.\n             acceptedPrivacyTerms: true,\n             sendQuincyEmail:\n               payload === null\n-                ? state.user[appUsername].sendQuincyEmail\n+                ? state.user.sessionUser.sendQuincyEmail\n                 : payload\n           }\n         }\n@@ -175,13 +173,12 @@ export const reducer = handleActions(\n       donationFormState: { ...defaultDonationFormState, processing: true }\n     }),\n     [actionTypes.postChargeComplete]: state => {\n-      const { appUsername } = state;\n       return {\n         ...state,\n         user: {\n           ...state.user,\n-          [appUsername]: {\n-            ...state.user[appUsername],\n+          sessionUser: {\n+            ...state.user.sessionUser,\n             isDonating: true\n           }\n         },\n@@ -205,18 +202,14 @@ export const reducer = handleActions(\n       ...state,\n       userProfileFetchState: { ...defaultFetchState }\n     }),\n-    [actionTypes.fetchUserComplete]: (\n-      state,\n-      { payload: { user, username } }\n-    ) => ({\n+    [actionTypes.fetchUserComplete]: (state, { payload: { user } }) => ({\n       ...state,\n       user: {\n         ...state.user,\n-        [username]: { ...user, sessionUser: true }\n+        sessionUser: user\n       },\n-      appUsername: username,\n       currentChallengeId:\n-        user.currentChallengeId || store.get(CURRENT_CHALLENGE_KEY),\n+        user?.currentChallengeId || store.get(CURRENT_CHALLENGE_KEY),\n       userFetchState: {\n         pending: false,\n         complete: true,\n@@ -235,15 +228,13 @@ export const reducer = handleActions(\n     }),\n     [actionTypes.fetchProfileForUserComplete]: (\n       state,\n-      { payload: { user, username } }\n+      { payload: { user } }\n     ) => {\n-      const previousUserObject =\n-        username in state.user ? state.user[username] : {};\n       return {\n         ...state,\n         user: {\n           ...state.user,\n-          [username]: { ...previousUserObject, ...user }\n+          otherUser: user\n         },\n         userProfileFetchState: {\n           ...defaultFetchState,\n@@ -291,8 +282,7 @@ export const reducer = handleActions(\n     }),\n     [actionTypes.resetUserData]: state => ({\n       ...state,\n-      appUsername: '',\n-      user: {}\n+      user: { ...state.user, sessionUser: null }\n     }),\n     [actionTypes.openSignoutModal]: state => ({\n       ...state,\n@@ -335,15 +325,14 @@ export const reducer = handleActions(\n       let submittedchallenges = [\n         { ...submittedChallenge, completedDate: Date.now() }\n       ];\n-      const { appUsername } = state;\n \n       return examResults && !examResults.passed\n         ? {\n             ...state,\n             user: {\n               ...state.user,\n-              [appUsername]: {\n-                ...state.user[appUsername],\n+              sessionUser: {\n+                ...state.user.sessionUser,\n                 examResults\n               }\n             }\n@@ -352,12 +341,12 @@ export const reducer = handleActions(\n             ...state,\n             user: {\n               ...state.user,\n-              [appUsername]: {\n-                ...state.user[appUsername],\n+              sessionUser: {\n+                ...state.user.sessionUser,\n                 completedChallenges: uniqBy(\n                   [\n                     ...submittedchallenges,\n-                    ...state.user[appUsername].completedChallenges\n+                    ...state.user.sessionUser.completedChallenges\n                   ],\n                   'id'\n                 ),\n@@ -369,13 +358,12 @@ export const reducer = handleActions(\n           };\n     },\n     [actionTypes.setMsUsername]: (state, { payload }) => {\n-      const { appUsername } = state;\n       return {\n         ...state,\n         user: {\n           ...state.user,\n-          [appUsername]: {\n-            ...state.user[appUsername],\n+          sessionUser: {\n+            ...state.user.sessionUser,\n             msUsername: payload\n           }\n         }\n@@ -388,26 +376,24 @@ export const reducer = handleActions(\n       };\n     },\n     [actionTypes.updateUserToken]: (state, { payload }) => {\n-      const { appUsername } = state;\n       return {\n         ...state,\n         user: {\n           ...state.user,\n-          [appUsername]: {\n-            ...state.user[appUsername],\n+          sessionUser: {\n+            ...state.user.sessionUser,\n             userToken: payload\n           }\n         }\n       };\n     },\n     [actionTypes.deleteUserTokenComplete]: state => {\n-      const { appUsername } = state;\n       return {\n         ...state,\n         user: {\n           ...state.user,\n-          [appUsername]: {\n-            ...state.user[appUsername],\n+          sessionUser: {\n+            ...state.user.sessionUser,\n             userToken: null\n           }\n         }\n@@ -426,13 +412,12 @@ export const reducer = handleActions(\n       };\n     },\n     [actionTypes.clearExamResults]: state => {\n-      const { appUsername } = state;\n       return {\n         ...state,\n         user: {\n           ...state.user,\n-          [appUsername]: {\n-            ...state.user[appUsername],\n+          sessionUser: {\n+            ...state.user.sessionUser,\n             examResults: null\n           }\n         }\n@@ -442,14 +427,13 @@ export const reducer = handleActions(\n       state,\n       { payload: { surveyResults } }\n     ) => {\n-      const { appUsername } = state;\n-      const { completedSurveys = [] } = state.user[appUsername];\n+      const { completedSurveys = [] } = state.user.sessionUser;\n       return {\n         ...state,\n         user: {\n           ...state.user,\n-          [appUsername]: {\n-            ...state.user[appUsername],\n+          sessionUser: {\n+            ...state.user.sessionUser,\n             completedSurveys: [...completedSurveys, surveyResults]\n           }\n         }\n@@ -460,13 +444,12 @@ export const reducer = handleActions(\n       currentChallengeId: payload\n     }),\n     [actionTypes.saveChallengeComplete]: (state, { payload }) => {\n-      const { appUsername } = state;\n       return {\n         ...state,\n         user: {\n           ...state.user,\n-          [appUsername]: {\n-            ...state.user[appUsername],\n+          sessionUser: {\n+            ...state.user.sessionUser,\n             savedChallenges: payload\n           }\n         }\n@@ -478,8 +461,8 @@ export const reducer = handleActions(\n             ...state,\n             user: {\n               ...state.user,\n-              [state.appUsername]: {\n-                ...state.user[state.appUsername],\n+              sessionUser: {\n+                ...state.user.sessionUser,\n                 username: payload\n               }\n             }\n@@ -511,8 +494,8 @@ export const reducer = handleActions(\n             ...state,\n             user: {\n               ...state.user,\n-              [state.appUsername]: {\n-                ...state.user[state.appUsername],\n+              sessionUser: {\n+                ...state.user.sessionUser,\n                 profileUI: { ...payload }\n               }\n             }"
        },
        {
            "sha": "f0b5f14ac76f1eaf8a36751263eb9f58f46cc231",
            "filename": "client/src/redux/prop-types.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fprop-types.ts?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -308,6 +308,7 @@ export type User = {\n   about: string;\n   acceptedPrivacyTerms: boolean;\n   completedChallenges: CompletedChallenge[];\n+  completedChallengeCount: number;\n   completedSurveys: SurveyResults[];\n   currentChallengeId: string;\n   email: string;"
        },
        {
            "sha": "e80a857a2502b445dba900b0a8cbd6a464369777",
            "filename": "client/src/redux/selectors.js",
            "status": "modified",
            "additions": 22,
            "deletions": 184,
            "changes": 206,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Fselectors.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Fselectors.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fselectors.js?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -1,26 +1,25 @@\n import { createSelector } from 'reselect';\n \n-import { Certification } from '../../../shared/config/certification-settings';\n import superBlockStructure from '../../../curriculum/superblock-structure/full-stack.json';\n import { randomBetween } from '../utils/random-between';\n import { getSessionChallengeData } from '../utils/session-storage';\n import { ns as MainApp } from './action-types';\n \n export const savedChallengesSelector = state =>\n-  userSelector(state).savedChallenges || [];\n+  userSelector(state)?.savedChallenges || [];\n export const completedChallengesSelector = state =>\n-  userSelector(state).completedChallenges || [];\n-export const userIdSelector = state => userSelector(state).id;\n+  userSelector(state)?.completedChallenges || [];\n+export const userIdSelector = state => userSelector(state)?.id;\n export const partiallyCompletedChallengesSelector = state =>\n-  userSelector(state).partiallyCompletedChallenges || [];\n+  userSelector(state)?.partiallyCompletedChallenges || [];\n export const currentChallengeIdSelector = state =>\n   state[MainApp].currentChallengeId;\n export const isRandomCompletionThresholdSelector = state =>\n   state[MainApp].isRandomCompletionThreshold;\n-export const isDonatingSelector = state => userSelector(state).isDonating;\n+export const isDonatingSelector = state => userSelector(state)?.isDonating;\n export const isOnlineSelector = state => state[MainApp].isOnline;\n export const isServerOnlineSelector = state => state[MainApp].isServerOnline;\n-export const isSignedInSelector = state => !!state[MainApp].appUsername;\n+export const isSignedInSelector = state => !!userSelector(state);\n export const isDonationModalOpenSelector = state =>\n   state[MainApp].showDonationModal;\n export const isSignoutModalOpenSelector = state =>\n@@ -88,185 +87,28 @@ export const shouldRequestDonationSelector = state => {\n   }\n };\n \n-export const userTokenSelector = state => {\n-  return userSelector(state).userToken;\n-};\n+export const userTokenSelector = state => userSelector(state)?.userToken;\n \n-export const examInProgressSelector = state => {\n-  return state[MainApp].examInProgress;\n-};\n+export const examInProgressSelector = state => state[MainApp].examInProgress;\n \n-export const examResultsSelector = state => userSelector(state).examResults;\n+export const examResultsSelector = state => userSelector(state)?.examResults;\n \n-export const msUsernameSelector = state => {\n-  return userSelector(state).msUsername;\n-};\n+export const msUsernameSelector = state => userSelector(state)?.msUsername;\n \n export const completedSurveysSelector = state =>\n-  userSelector(state).completedSurveys || [];\n+  userSelector(state)?.completedSurveys || [];\n \n export const isProcessingSelector = state => {\n   return state[MainApp].isProcessing;\n };\n \n-export const userByNameSelector = username => state => {\n-  const { user } = state[MainApp];\n-  // return initial state empty user empty object instead of empty\n-  // object literal to prevent components from re-rendering unnecessarily\n-  // TODO: confirm if \"initialState\" can be moved here or action-types.js\n-  return user[username] ?? {};\n-};\n-\n-export const currentCertsSelector = state =>\n-  certificatesByNameSelector(state[MainApp]?.appUsername)(state)?.currentCerts;\n-\n-export const certificatesByNameSelector = username => state => {\n-  const {\n-    isRespWebDesignCert,\n-    is2018DataVisCert,\n-    isFrontEndLibsCert,\n-    isJsAlgoDataStructCert,\n-    isApisMicroservicesCert,\n-    isInfosecQaCert,\n-    isQaCertV7,\n-    isInfosecCertV7,\n-    isFrontEndCert,\n-    isBackEndCert,\n-    isDataVisCert,\n-    isFullStackCert,\n-    isSciCompPyCertV7,\n-    isDataAnalysisPyCertV7,\n-    isMachineLearningPyCertV7,\n-    isRelationalDatabaseCertV8,\n-    isCollegeAlgebraPyCertV8,\n-    isFoundationalCSharpCertV8,\n-    isJsAlgoDataStructCertV8\n-  } = userByNameSelector(username)(state);\n-  return {\n-    hasModernCert:\n-      isRespWebDesignCert ||\n-      is2018DataVisCert ||\n-      isFrontEndLibsCert ||\n-      isApisMicroservicesCert ||\n-      isQaCertV7 ||\n-      isInfosecCertV7 ||\n-      isFullStackCert ||\n-      isSciCompPyCertV7 ||\n-      isDataAnalysisPyCertV7 ||\n-      isMachineLearningPyCertV7 ||\n-      isRelationalDatabaseCertV8 ||\n-      isCollegeAlgebraPyCertV8 ||\n-      isFoundationalCSharpCertV8 ||\n-      isJsAlgoDataStructCertV8,\n-    hasLegacyCert:\n-      isFrontEndCert ||\n-      isJsAlgoDataStructCert ||\n-      isBackEndCert ||\n-      isDataVisCert ||\n-      isInfosecQaCert,\n-    isFullStackCert,\n-    currentCerts: [\n-      {\n-        show: isRespWebDesignCert,\n-        title: 'Responsive Web Design Certification',\n-        certSlug: Certification.RespWebDesign\n-      },\n-      {\n-        show: isJsAlgoDataStructCertV8,\n-        title: 'JavaScript Algorithms and Data Structures Certification',\n-        certSlug: Certification.JsAlgoDataStructNew\n-      },\n-      {\n-        show: isFrontEndLibsCert,\n-        title: 'Front End Development Libraries Certification',\n-        certSlug: Certification.FrontEndDevLibs\n-      },\n-      {\n-        show: is2018DataVisCert,\n-        title: 'Data Visualization Certification',\n-        certSlug: Certification.DataVis\n-      },\n-      {\n-        show: isRelationalDatabaseCertV8,\n-        title: 'Relational Database Certification',\n-        certSlug: Certification.RelationalDb\n-      },\n-      {\n-        show: isApisMicroservicesCert,\n-        title: 'Back End Development and APIs Certification',\n-        certSlug: Certification.BackEndDevApis\n-      },\n-      {\n-        show: isQaCertV7,\n-        title: 'Quality Assurance Certification',\n-        certSlug: Certification.QualityAssurance\n-      },\n-      {\n-        show: isSciCompPyCertV7,\n-        title: 'Scientific Computing with Python Certification',\n-        certSlug: Certification.SciCompPy\n-      },\n-      {\n-        show: isDataAnalysisPyCertV7,\n-        title: 'Data Analysis with Python Certification',\n-        certSlug: Certification.DataAnalysisPy\n-      },\n-      {\n-        show: isInfosecCertV7,\n-        title: 'Information Security Certification',\n-        certSlug: Certification.InfoSec\n-      },\n-      {\n-        show: isMachineLearningPyCertV7,\n-        title: 'Machine Learning with Python Certification',\n-        certSlug: Certification.MachineLearningPy\n-      },\n-      {\n-        show: isCollegeAlgebraPyCertV8,\n-        title: 'College Algebra with Python Certification',\n-        certSlug: Certification.CollegeAlgebraPy\n-      },\n-      {\n-        show: isFoundationalCSharpCertV8,\n-        title: 'Foundational C# with Microsoft Certification',\n-        certSlug: Certification.FoundationalCSharp\n-      }\n-    ],\n-    legacyCerts: [\n-      {\n-        show: isFrontEndCert,\n-        title: 'Front End Certification',\n-        certSlug: Certification.LegacyFrontEnd\n-      },\n-      {\n-        show: isJsAlgoDataStructCert,\n-        title: 'Legacy JavaScript Algorithms and Data Structures Certification',\n-        certSlug: Certification.JsAlgoDataStruct\n-      },\n-      {\n-        show: isBackEndCert,\n-        title: 'Back End Certification',\n-        certSlug: Certification.LegacyBackEnd\n-      },\n-      {\n-        show: isDataVisCert,\n-        title: 'Data Visualization Certification',\n-        certSlug: Certification.LegacyDataVis\n-      },\n-      {\n-        show: isInfosecQaCert,\n-        title: 'Information Security and Quality Assurance Certification',\n-        // Keep the current public profile cert slug\n-        certSlug: Certification.LegacyInfoSecQa\n-      },\n-      {\n-        show: isFullStackCert,\n-        title: 'Full Stack Certification',\n-        // Keep the current public profile cert slug\n-        certSlug: Certification.LegacyFullStack\n-      }\n-    ]\n-  };\n+export const createUserByNameSelector = username => state => {\n+  const sessionUser = userSelector(state);\n+  const otherUser = otherUserSelector(state);\n+  const isSessionUser = sessionUser?.username === username;\n+  const isOtherUser = otherUser?.username === username;\n+  const user = isSessionUser ? sessionUser : isOtherUser ? otherUser : null;\n+  return user;\n };\n \n export const userFetchStateSelector = state => state[MainApp].userFetchState;\n@@ -343,15 +185,11 @@ export const completionStateSelector = createSelector(\n );\n export const userProfileFetchStateSelector = state =>\n   state[MainApp].userProfileFetchState;\n-export const usernameSelector = state => state[MainApp].appUsername;\n+export const usernameSelector = state => userSelector(state)?.username ?? '';\n export const themeSelector = state => state[MainApp].theme;\n-export const userThemeSelector = state => {\n-  return userSelector(state).theme;\n-};\n-export const userSelector = state => {\n-  const username = usernameSelector(state);\n+export const userThemeSelector = state => userSelector(state)?.theme;\n \n-  return state[MainApp].user[username] || {};\n-};\n+export const userSelector = state => state[MainApp].user.sessionUser;\n+export const otherUserSelector = state => state[MainApp].user.otherUser;\n \n export const renderStartTimeSelector = state => state[MainApp].renderStartTime;"
        },
        {
            "sha": "1b778ab2845bdaa84b8df0013aa3eb70fcbb161d",
            "filename": "client/src/redux/settings/settings-sagas.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Fsettings%2Fsettings-sagas.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Fsettings%2Fsettings-sagas.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fsettings%2Fsettings-sagas.js?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -8,6 +8,7 @@ import {\n   takeLatest\n } from 'redux-saga/effects';\n import store from 'store';\n+import { navigate } from 'gatsby';\n \n import {\n   certTypeIdMap,\n@@ -69,6 +70,8 @@ function* submitNewUsernameSaga({ payload: username }) {\n   try {\n     const { data } = yield call(putUpdateMyUsername, username);\n     yield put(submitNewUsernameComplete({ ...data, username }));\n+    // When the username is updated, the user would otherwise still be on their old profile:\n+    navigate(`/${username}`);\n     yield put(createFlashMessage(data));\n   } catch (e) {\n     yield put(submitNewUsernameError(e));"
        },
        {
            "sha": "1e56de54090b4825fec7ebdcafd9692f52e273db",
            "filename": "client/src/redux/types.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Ftypes.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Fredux%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Ftypes.ts?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -12,7 +12,6 @@ export type FlashMessageArg = {\n export interface State {\n   [FlashApp]: FlashState;\n   [MainApp]: {\n-    appUsername: string;\n     recentlyClaimedBlock: null | string;\n     showMultipleProgressModals: boolean;\n     currentChallengId: string;"
        },
        {
            "sha": "21688a7a44e67a2adc85f89f2d9140974e42f56b",
            "filename": "client/src/templates/Challenges/components/hotkeys.tsx",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fhotkeys.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fhotkeys.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fhotkeys.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -7,8 +7,8 @@ import { createSelector } from 'reselect';\n import type {\n   ChallengeFiles,\n   Test,\n-  User,\n-  ChallengeMeta\n+  ChallengeMeta,\n+  User\n } from '../../../redux/prop-types';\n import { userSelector } from '../../../redux/selectors';\n import {\n@@ -49,7 +49,7 @@ const mapStateToProps = createSelector(\n     canFocusEditor: boolean,\n     challengeFiles: ChallengeFiles,\n     tests: Test[],\n-    user: User,\n+    user: User | null,\n     { nextChallengePath, prevChallengePath }: ChallengeMeta\n   ) => ({\n     isHelpModalOpen,\n@@ -59,7 +59,7 @@ const mapStateToProps = createSelector(\n     canFocusEditor,\n     challengeFiles,\n     tests,\n-    user,\n+    keyboardShortcuts: !!user?.keyboardShortcuts,\n     nextChallengePath,\n     prevChallengePath\n   })\n@@ -101,7 +101,7 @@ export type HotkeysProps = Pick<\n     setIsAdvancing: (arg0: boolean) => void;\n     openShortcutsModal: () => void;\n     playScene?: () => void;\n-    user: User;\n+    keyboardShortcuts: boolean;\n   };\n \n function Hotkeys({\n@@ -121,7 +121,7 @@ function Hotkeys({\n   usesMultifileEditor,\n   openShortcutsModal,\n   playScene,\n-  user: { keyboardShortcuts },\n+  keyboardShortcuts,\n   isHelpModalOpen,\n   isResetModalOpen,\n   isShortcutsModalOpen,"
        },
        {
            "sha": "e7121906bf51d25701493ba6b037d7b00463e3fc",
            "filename": "client/src/templates/Challenges/components/shortcuts-modal.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fshortcuts-modal.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fshortcuts-modal.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fshortcuts-modal.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -9,7 +9,7 @@ import { closeModal } from '../redux/actions';\n import { isShortcutsModalOpenSelector } from '../redux/selectors';\n import { updateMyKeyboardShortcuts } from '../../../redux/settings/actions';\n import { userSelector } from '../../../redux/selectors';\n-import { User } from '../../../redux/prop-types';\n+import type { User } from '../../../redux/prop-types';\n import KeyboardShortcutsSettings from '../../../components/settings/keyboard-shortcuts';\n \n import './shortcuts-modal.css';\n@@ -19,13 +19,16 @@ interface ShortcutsModalProps {\n   toggleKeyboardShortcuts: (keyboardShortcuts: boolean) => void;\n   isOpen: boolean;\n   t: (text: string) => string;\n-  user: User;\n+  keyboardShortcuts: boolean;\n }\n \n const mapStateToProps = createSelector(\n   isShortcutsModalOpenSelector,\n   userSelector,\n-  (isOpen: boolean, user: User) => ({ isOpen, user })\n+  (isOpen: boolean, user: User | null) => ({\n+    isOpen,\n+    keyboardShortcuts: !!user?.keyboardShortcuts\n+  })\n );\n const mapDispatchToProps = (dispatch: Dispatch) =>\n   bindActionCreators(\n@@ -42,7 +45,7 @@ function ShortcutsModal({\n   toggleKeyboardShortcuts,\n   isOpen,\n   t,\n-  user: { keyboardShortcuts }\n+  keyboardShortcuts\n }: ShortcutsModalProps): JSX.Element {\n   return (\n     <Modal onClose={closeShortcutsModal} open={isOpen}>"
        },
        {
            "sha": "36bdfdeb2b5f7bc46ee570705c2a398e32307b7f",
            "filename": "client/src/templates/Introduction/components/cert-challenge.tsx",
            "status": "modified",
            "additions": 8,
            "deletions": 13,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fcert-challenge.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fcert-challenge.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fcert-challenge.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -12,14 +12,14 @@ import { SuperBlocks } from '../../../../../shared/config/curriculum';\n \n import {\n   isSignedInSelector,\n-  userFetchStateSelector,\n-  currentCertsSelector\n+  userFetchStateSelector\n } from '../../../redux/selectors';\n-import { User, Steps } from '../../../redux/prop-types';\n+import { User } from '../../../redux/prop-types';\n import {\n   type CertTitle,\n   liveCerts\n } from '../../../../config/cert-and-project-map';\n+import { getCertifications } from '../../../components/profile/components/utils/certification';\n \n interface CertChallengeProps {\n   // TODO: create enum/reuse SuperBlocks enum somehow\n@@ -31,41 +31,36 @@ interface CertChallengeProps {\n     error: null | string;\n   };\n   isSignedIn: boolean;\n-  currentCerts: Steps['currentCerts'];\n   superBlock: SuperBlocks;\n   title: CertTitle;\n   user: User;\n }\n \n const mapStateToProps = (state: unknown) => {\n   return createSelector(\n-    currentCertsSelector,\n     userFetchStateSelector,\n     isSignedInSelector,\n-    (\n-      currentCerts,\n-      fetchState: CertChallengeProps['fetchState'],\n-      isSignedIn\n-    ) => ({\n-      currentCerts,\n+    (fetchState: CertChallengeProps['fetchState'], isSignedIn) => ({\n       fetchState,\n       isSignedIn\n     })\n   )(state as Record<string, unknown>);\n };\n \n const CertChallenge = ({\n-  currentCerts,\n   superBlock,\n   title,\n   fetchState,\n   isSignedIn,\n-  user: { username }\n+  user\n }: CertChallengeProps): JSX.Element => {\n   const { t } = useTranslation();\n   const [isCertified, setIsCertified] = useState(false);\n   const [userLoaded, setUserLoaded] = useState(false);\n \n+  const { currentCerts } = getCertifications(user);\n+  const { username } = user;\n+\n   const cert = liveCerts.find(x => x.title === title);\n   if (!cert) throw Error(`Certification ${title} not found`);\n   const certSlug = cert.certSlug;"
        },
        {
            "sha": "51dced682950cf7dbe65b87d9dee3608502a3912",
            "filename": "client/src/templates/Introduction/super-block-intro.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Ftemplates%2FIntroduction%2Fsuper-block-intro.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Ftemplates%2FIntroduction%2Fsuper-block-intro.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FIntroduction%2Fsuper-block-intro.tsx?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -84,7 +84,7 @@ type SuperBlockProps = {\n   resetExpansion: () => void;\n   toggleBlock: (arg0: string) => void;\n   tryToShowDonationModal: () => void;\n-  user: User;\n+  user: User | null;\n };\n \n configureAnchors({ offset: -40, scrollDuration: 0 });\n@@ -101,7 +101,7 @@ const mapStateToProps = (state: Record<string, unknown>) => {\n       isSignedIn,\n       signInLoading: boolean,\n       fetchState: FetchState,\n-      user: User\n+      user: User | null\n     ) => ({\n       currentChallengeId,\n       isSignedIn,\n@@ -147,8 +147,7 @@ const SuperBlockIntroductionPage = (props: SuperBlockProps) => {\n     signInLoading,\n     user,\n     pageContext: { superBlock, title, certification },\n-    location,\n-    user: { completedChallenges: allCompletedChallenges }\n+    location\n   } = props;\n \n   const allChallenges = useMemo(\n@@ -163,10 +162,10 @@ const SuperBlockIntroductionPage = (props: SuperBlockProps) => {\n \n   const completedChallenges = useMemo(\n     () =>\n-      allCompletedChallenges.filter(completedChallenge =>\n+      (user?.completedChallenges ?? []).filter(completedChallenge =>\n         superBlockChallenges.some(c => c.id === completedChallenge.id)\n       ),\n-    [superBlockChallenges, allCompletedChallenges]\n+    [superBlockChallenges, user?.completedChallenges]\n   );\n \n   const i18nTitle = i18next.t(`intro:${superBlock}.title`);\n@@ -251,7 +250,7 @@ const SuperBlockIntroductionPage = (props: SuperBlockProps) => {\n                 onCertificationDonationAlertClick={\n                   onCertificationDonationAlertClick\n                 }\n-                isDonating={user.isDonating}\n+                isDonating={user?.isDonating ?? false}\n               />\n               <HelpTranslate superBlock={superBlock} />\n               <Spacer size='l' />\n@@ -284,7 +283,7 @@ const SuperBlockIntroductionPage = (props: SuperBlockProps) => {\n                       />\n                     );\n                   })}\n-                  {showCertification && (\n+                  {showCertification && !!user && (\n                     <CertChallenge\n                       certification={certification}\n                       superBlock={superBlock}"
        },
        {
            "sha": "0602355822792929624e52b549fc709095092827",
            "filename": "client/src/utils/ajax.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 42,
            "changes": 64,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Futils%2Fajax.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/client%2Fsrc%2Futils%2Fajax.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Fajax.ts?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -93,10 +93,6 @@ async function request<T>(\n \n /** GET **/\n \n-interface SessionUser {\n-  user?: { [username: string]: User };\n-}\n-\n type CompleteChallengeFromApi = {\n   files: Array<Omit<ChallengeFile, 'fileKey'> & { key: string }>;\n } & Omit<CompletedChallenge, 'challengeFiles'>;\n@@ -105,26 +101,19 @@ type SavedChallengeFromApi = {\n   files: Array<Omit<SavedChallengeFile, 'fileKey'> & { key: string }>;\n } & Omit<SavedChallenge, 'challengeFiles'>;\n \n-type ApiSessionResponse = Omit<SessionUser, 'user'>;\n-type ApiUser = {\n+type ApiUser = Omit<User, 'completedChallenges' & 'savedChallenges'> & {\n+  completedChallenges?: CompleteChallengeFromApi[];\n+  savedChallenges?: SavedChallengeFromApi[];\n+};\n+\n+type ApiUserResponse = {\n   user: {\n-    [username: string]: Omit<\n-      User,\n-      'completedChallenges' & 'savedChallenges'\n-    > & {\n-      completedChallenges?: CompleteChallengeFromApi[];\n-      savedChallenges?: SavedChallengeFromApi[];\n-    };\n+    [username: string]: ApiUser;\n   };\n   result?: string;\n };\n \n-type UserResponse = {\n-  user: { [username: string]: User } | Record<string, never>;\n-  result: string | undefined;\n-};\n-\n-function parseApiResponseToClientUser(data: ApiUser): UserResponse {\n+function parseApiResponseToClientUser(data: ApiUserResponse): User | null {\n   const userData = data.user?.[data?.result ?? ''];\n   let completedChallenges: CompletedChallenge[] = [];\n   let savedChallenges: SavedChallenge[] = [];\n@@ -134,12 +123,9 @@ function parseApiResponseToClientUser(data: ApiUser): UserResponse {\n     );\n     savedChallenges = mapFilesToChallengeFiles(userData.savedChallenges);\n   }\n-  return {\n-    user: {\n-      [data.result ?? '']: { ...userData, completedChallenges, savedChallenges }\n-    },\n-    result: data.result\n-  };\n+  return data.result\n+    ? { ...userData, completedChallenges, savedChallenges }\n+    : null;\n }\n \n // TODO: this at least needs a few aliases so it's human readable\n@@ -158,44 +144,38 @@ function mapKeyToFileKey<K>(\n   return files.map(({ key, ...rest }) => ({ ...rest, fileKey: key }));\n }\n \n-export function getSessionUser(): Promise<ResponseWithData<SessionUser>> {\n-  const responseWithData: Promise<\n-    ResponseWithData<ApiUser & ApiSessionResponse>\n-  > = get('/user/get-session-user');\n+export function getSessionUser(): Promise<ResponseWithData<User | null>> {\n+  const responseWithData: Promise<ResponseWithData<ApiUserResponse>> = get(\n+    '/user/get-session-user'\n+  );\n   // TODO: Once DB is migrated, no longer need to parse `files` -> `challengeFiles` etc.\n   return responseWithData.then(({ response, data }) => {\n-    const { result, user } = parseApiResponseToClientUser(data);\n+    const user = parseApiResponseToClientUser(data);\n     return {\n       response,\n-      data: {\n-        result,\n-        user\n-      }\n+      data: user\n     };\n   });\n }\n \n type UserProfileResponse = {\n-  entities: Omit<UserResponse, 'result'>;\n+  entities: Omit<ApiUserResponse, 'result'>;\n   result: string | undefined;\n };\n export function getUserProfile(\n   username: string\n-): Promise<ResponseWithData<UserProfileResponse>> {\n-  const responseWithData = get<{ entities?: ApiUser; result?: string }>(\n+): Promise<ResponseWithData<User | null>> {\n+  const responseWithData = get<UserProfileResponse>(\n     `/users/get-public-profile?username=${username}`\n   );\n   return responseWithData.then(({ response, data }) => {\n-    const { result, user } = parseApiResponseToClientUser({\n+    const user = parseApiResponseToClientUser({\n       user: data.entities?.user ?? {},\n       result: data.result\n     });\n     return {\n       response,\n-      data: {\n-        entities: { user },\n-        result\n-      }\n+      data: user\n     };\n   });\n }"
        },
        {
            "sha": "b70385eeeb1ead79de1332958899f95b68181e11",
            "filename": "e2e/username-change.spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/e2e%2Fusername-change.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf/e2e%2Fusername-change.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fusername-change.spec.ts?ref=3e1da8f3fbc3492175babf5d4f3c8f6c970d5eaf",
            "patch": "@@ -112,6 +112,7 @@ test.describe('Username Settings Validation', () => {\n     await expect(\n       page.getByRole('alert').filter({ hasText: flashText }).first()\n     ).toBeVisible();\n+    await expect(page).toHaveURL(`/${settingsObject.usernameAvailable}`);\n   });\n \n   test('should update username in lowercase and reflect in the UI', async ({"
        }
    ],
    "stats": {
        "total": 938,
        "additions": 412,
        "deletions": 526
    }
}