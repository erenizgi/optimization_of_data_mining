{
    "author": "ojeytonwilliams",
    "message": "fix(tests): remove hard-coding + wait for responses (#56728)\n\nCo-authored-by: Shaun Hamilton <shauhami020@gmail.com>",
    "sha": "4f2d879cd12df691d238bb88b98f7dbe5fe4b861",
    "files": [
        {
            "sha": "f7fa4286fda7835031ef8c292f2375408a392cbc",
            "filename": ".gitpod.yml",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4f2d879cd12df691d238bb88b98f7dbe5fe4b861/.gitpod.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4f2d879cd12df691d238bb88b98f7dbe5fe4b861/.gitpod.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.gitpod.yml?ref=4f2d879cd12df691d238bb88b98f7dbe5fe4b861",
            "patch": "@@ -30,7 +30,7 @@ ports:\n tasks:\n   - before: |\n       echo '\n-      export COOKIE_DOMAIN=gitpod.io\n+      export COOKIE_DOMAIN=.gitpod.io\n       export HOME_LOCATION=$(gp url 8000)\n       export API_LOCATION=$(gp url 3000)\n       export CHALLENGE_EDITOR_API_LOCATION=$(gp url 3200)\n@@ -45,7 +45,7 @@ tasks:\n       docker compose up -d\n \n   - name: server\n-    before: export COOKIE_DOMAIN=gitpod.io && export HOME_LOCATION=$(gp url 8000) && export API_LOCATION=$(gp url 3000)\n+    before: export COOKIE_DOMAIN=.gitpod.io && export HOME_LOCATION=$(gp url 8000) && export API_LOCATION=$(gp url 3000)\n     # init is not executed for prebuilt workspaces and restarts,\n     # so we should put all the heavy initialization here\n     init: >"
        },
        {
            "sha": "ae189198734a6916b036e2148dd8640eb128e0df",
            "filename": "e2e/failed-updates.spec.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 4,
            "changes": 19,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4f2d879cd12df691d238bb88b98f7dbe5fe4b861/e2e%2Ffailed-updates.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4f2d879cd12df691d238bb88b98f7dbe5fe4b861/e2e%2Ffailed-updates.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Ffailed-updates.spec.ts?ref=4f2d879cd12df691d238bb88b98f7dbe5fe4b861",
            "patch": "@@ -36,7 +36,7 @@ test.describe('failed update flushing', () => {\n   }) => {\n     // Initially, the user has no completed challenges.\n     const userRes = await request.get(\n-      'http://localhost:3000/user/get-session-user'\n+      new URL('/user/get-session-user', process.env.API_LOCATION).toString()\n     );\n     const completedChallenges = (await userRes.json()).user.developmentuser\n       .completedChallenges;\n@@ -55,16 +55,27 @@ test.describe('failed update flushing', () => {\n \n     // The update epic sends two requests and this lets us wait for both.\n     const submitRes = page\n-      .waitForResponse('http://localhost:3000/modern-challenge-completed')\n+      .waitForResponse(\n+        new URL(\n+          '/modern-challenge-completed',\n+          process.env.API_LOCATION\n+        ).toString()\n+      )\n+\n       .then(() =>\n-        page.waitForResponse('http://localhost:3000/modern-challenge-completed')\n+        page.waitForResponse(\n+          new URL(\n+            '/modern-challenge-completed',\n+            process.env.API_LOCATION\n+          ).toString()\n+        )\n       );\n \n     await page.reload();\n     await submitRes;\n \n     const updatedUserRes = await request.get(\n-      'http://localhost:3000/user/get-session-user'\n+      new URL('/user/get-session-user', process.env.API_LOCATION).toString()\n     );\n \n     // Now the user should have both completed challenges."
        },
        {
            "sha": "5c7173d994b071cc6480ce33fd2dc50494e6ff73",
            "filename": "e2e/projects.spec.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4f2d879cd12df691d238bb88b98f7dbe5fe4b861/e2e%2Fprojects.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4f2d879cd12df691d238bb88b98f7dbe5fe4b861/e2e%2Fprojects.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fprojects.spec.ts?ref=4f2d879cd12df691d238bb88b98f7dbe5fe4b861",
            "patch": "@@ -1,13 +1,15 @@\n import { execSync } from 'child_process';\n import { test, expect, Page } from '@playwright/test';\n import { SuperBlocks } from '../shared/config/curriculum';\n+import translations from '../client/i18n/locales/english/translations.json';\n import tributePageHtml from './fixtures/tribute-page-html.json';\n import tributePageCss from './fixtures/tribute-page-css.json';\n import curriculum from './fixtures/js-ads-projects.json';\n import { authedRequest } from './utils/request';\n \n import { focusEditor, getEditors, clearEditor } from './utils/editor';\n import { isMacOS } from './utils/user-agent';\n+import { alertToBeVisible } from './utils/alerts';\n \n interface Meta {\n   challengeOrder: { id: string; title: string }[];\n@@ -201,7 +203,7 @@ test.describe('JavaScript projects can be submitted and then viewed in /settings\n       });\n       await expect(solutionModal).toBeVisible();\n       await solutionModal\n-        .getByRole('button', { name: 'Close' })\n+        .getByRole('button', { name: translations.buttons['close'] })\n         .first()\n         .click();\n       // Wait for the modal to disappear before continue\n@@ -210,16 +212,23 @@ test.describe('JavaScript projects can be submitted and then viewed in /settings\n \n     await page\n       .getByRole('button', {\n-        name: \"I agree to freeCodeCamp's Academic Honesty Policy.\"\n+        name: translations.buttons['agree-honesty']\n       })\n       .click();\n \n+    await alertToBeVisible(page, translations.buttons['accepted-honesty']);\n+\n     await page\n       .getByRole('button', {\n         name: 'Claim Certification Legacy JavaScript Algorithms and Data Structures'\n       })\n       .click();\n \n+    await alertToBeVisible(\n+      page,\n+      '@developmentuser, you have successfully claimed the Legacy JavaScript Algorithms and Data Structures Certification! Congratulations on behalf of the freeCodeCamp.org team!'\n+    );\n+\n     const showCertLink = page.getByRole('link', {\n       name: 'Show Certification Legacy JavaScript Algorithms and Data Structures'\n     });"
        },
        {
            "sha": "9e6cd1ad2843885903a31bcd6dcd361b5d1c0e77",
            "filename": "e2e/third-party-donation.spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4f2d879cd12df691d238bb88b98f7dbe5fe4b861/e2e%2Fthird-party-donation.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4f2d879cd12df691d238bb88b98f7dbe5fe4b861/e2e%2Fthird-party-donation.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fthird-party-donation.spec.ts?ref=4f2d879cd12df691d238bb88b98f7dbe5fe4b861",
            "patch": "@@ -59,7 +59,7 @@ test.describe('third-party donation tests', () => {\n     );\n \n     await page.route(\n-      'http://localhost:3000/donate/charge-stripe-card',\n+      new URL('donate/charge-stripe-card', process.env.API_LOCATION).toString(),\n       async route => {\n         await route.fulfill({ json: { isDonating: true } });\n       }"
        },
        {
            "sha": "6209f64710f6a4284a27447cd03564a72374c5be",
            "filename": "e2e/utils/add-growthbook-cookie.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4f2d879cd12df691d238bb88b98f7dbe5fe4b861/e2e%2Futils%2Fadd-growthbook-cookie.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4f2d879cd12df691d238bb88b98f7dbe5fe4b861/e2e%2Futils%2Fadd-growthbook-cookie.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Futils%2Fadd-growthbook-cookie.ts?ref=4f2d879cd12df691d238bb88b98f7dbe5fe4b861",
            "patch": "@@ -11,7 +11,9 @@ export async function addGrowthbookCookie({\n     {\n       name: 'gbuuid',\n       value: variation,\n-      domain: 'localhost',\n+      // Weirdly, it seems necessary to prefix the domain with a dot. This seems\n+      // to be a peculiarity of Playwright.\n+      domain: process.env.COOKIE_DOMAIN || 'localhost',\n       path: '/',\n       expires: Math.floor(Date.now() / 1000) + 400 * 24 * 60 * 60 // 400 days from now\n     }"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 32,
        "deletions": 10
    }
}