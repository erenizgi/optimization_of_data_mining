{
    "author": "qxrein",
    "message": "fix(docker): mongod healthcheck before replica initialization (#56789)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>\r\nCo-authored-by: Shaun Hamilton <shauhami020@gmail.com>",
    "sha": "5a9cb9d4545812de70c6607503e4dd364e3da18f",
    "files": [
        {
            "sha": "750bdbe8bdbdea8111c027a21b446707fcadff25",
            "filename": "api/tools/docker-compose.yml",
            "status": "modified",
            "additions": 16,
            "deletions": 7,
            "changes": 23,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5a9cb9d4545812de70c6607503e4dd364e3da18f/api%2Ftools%2Fdocker-compose.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5a9cb9d4545812de70c6607503e4dd364e3da18f/api%2Ftools%2Fdocker-compose.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Ftools%2Fdocker-compose.yml?ref=5a9cb9d4545812de70c6607503e4dd364e3da18f",
            "patch": "@@ -9,17 +9,26 @@ services:\n       - 27017:27017\n     volumes:\n       - db-data:/data\n+    healthcheck:\n+      test: ['CMD', 'mongosh', '--eval', \"db.adminCommand('ping')\"]\n+      interval: 2s\n+      retries: 5\n+\n   setup:\n     image: mongo\n     depends_on:\n-      - db\n+      db:\n+        condition: service_healthy\n     restart: on-failure\n-    entrypoint: [\n-        'bash',\n-        '-c',\n-        # This will try to initiate the replica set, until it succeeds twice (i.e. until the replica set is already initialized)\n-        'mongosh --host db:27017 --eval ''try {rs.initiate();} catch (err) { if(err.codeName !== \"AlreadyInitialized\") throw err };'''\n-      ]\n+    # This will try to initiate the replica set, until it succeeds twice (i.e. until the replica set is already initialized)\n+    command: >\n+      mongosh --host db:27017 --eval '\n+        try {\n+          rs.initiate();\n+        } catch (err) {\n+          if(err.codeName !== \"AlreadyInitialized\") throw err;\n+        }\n+      '\n \n volumes:\n   db-data:"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 16,
        "deletions": 7
    }
}