{
    "author": "gikf",
    "message": "fix(curriculum): improve Bookmark Manager tests (#57636)\n\nCo-authored-by: Dario-DC <105294544+Dario-DC@users.noreply.github.com>\nCo-authored-by: Naomi <accounts+github@nhcarrigan.com>",
    "sha": "ef0eda4cd647c803bbb8e452ccc3a506f338d8ba",
    "files": [
        {
            "sha": "8de355f89758045f888e8bf1e01a7bfcf55d5691",
            "filename": "curriculum/challenges/english/25-front-end-development/lab-bookmark-manager-app/66def5467aee701733aaf8cc.md",
            "status": "modified",
            "additions": 101,
            "deletions": 15,
            "changes": 116,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ef0eda4cd647c803bbb8e452ccc3a506f338d8ba/curriculum%2Fchallenges%2Fenglish%2F25-front-end-development%2Flab-bookmark-manager-app%2F66def5467aee701733aaf8cc.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ef0eda4cd647c803bbb8e452ccc3a506f338d8ba/curriculum%2Fchallenges%2Fenglish%2F25-front-end-development%2Flab-bookmark-manager-app%2F66def5467aee701733aaf8cc.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fchallenges%2Fenglish%2F25-front-end-development%2Flab-bookmark-manager-app%2F66def5467aee701733aaf8cc.md?ref=ef0eda4cd647c803bbb8e452ccc3a506f338d8ba",
            "patch": "@@ -14,7 +14,7 @@ Fulfill the user stories below and get all the tests to pass to complete the lab\n \n **User Stories:**\n \n-1. You should have a `getBookmarks` function that returns the `bookmarks` array stored in the local storage. If the `bookmarks` key has not been set yet, the `getBookmarks` function should return an empty array.\n+1. You should have a `getBookmarks` function that returns the `bookmarks` array stored in the local storage. If the `bookmarks` key has not been set yet, or it doesn't contain a valid array with bookmarks, the `getBookmarks` function should return an empty array.\n 1. The `bookmarks` key stored in the local storage should be an array of bookmark objects. Each bookmark object should have three keys: `name`, `category`, and `url`.\n 1. You should have a function named `displayOrCloseForm` that toggles the `hidden` class on `#main-section` and `#form-section`.\n 1. When you click `#add-bookmark-button`, you should update the inner text of `.category-name` to be the value of the selected option from `#category-dropdown` and call `displayOrCloseForm` to display the form section and hide the main section.\n@@ -24,10 +24,10 @@ Fulfill the user stories below and get all the tests to pass to complete the lab\n 1. You should have a function named `displayOrHideCategory` that toggles the `hidden` class on `#main-section` and `#bookmark-list-section`.\n 1. When you click `#view-category-button`, you should update the inner text of `.category-name` to be the value of the selected option from `#category-dropdown`, modify the inner HTML of `#category-list` according to the user stories below, and call the `displayOrHideCategory` function.\n 1. If none of the bookmarks in local storage have the category, you should set the inner HTML of the `#category-list` to a `p` element with the text `No Bookmarks Found`.\n-1. If one or more bookmarks in local storage have the selected category you should add a radio button with `id` and `value` attributes set to the bookmark name to the `#category-list`'s inner HTML for each of those bookmarks.\n+1. If one or more bookmarks in local storage have the selected category, you should add a radio button with `id` and `value` attributes, and set to the bookmark name to the `#category-list`'s inner HTML for each of those bookmarks. Additionally, each radio button should have the same `name` attribute.\n 1. Each radio button should have a corresponding label containing an anchor element with the bookmark name and the `href` attribute set to the bookmark URL.\n-1. When you click `#close-list-button`, you should run your function to hide the `#bookmark-list-section` and display the main section.\n-1. When you click `#delete-bookmark-button`, you should delete the bookmark corresponding to the selected radio button from the local storage and update the displayed bookmark list.\n+1. When you click the `#close-list-button`, you should run your function to hide the `#bookmark-list-section` and display the main section.\n+1. When you click the `#delete-bookmark-button`, you should delete the bookmark corresponding to the selected radio button and appropriate category from the local storage and update the displayed bookmark list.\n \n # --hints--\n \n@@ -69,6 +69,24 @@ try {\n }\n ```\n \n+When the `bookmarks` key in the `localStorage` does not contain a valid array of bookmark objects, the `getBookmarks` function should return an empty array.\n+\n+```js\n+try {\n+  localStorage.setItem(\"bookmarks\", 'invalid');\n+  const arrayFromInvalidValue = getBookmarks();\n+  assert.isArray(arrayFromInvalidValue);\n+  assert.isEmpty(arrayFromInvalidValue);\n+\n+  localStorage.setItem(\"bookmarks\", JSON.stringify([{name: \"example1\", category: \"news\", notUrl: \"example1.com\"}]));\n+  const arrayFromInvalidArray = getBookmarks();\n+  assert.isArray(arrayFromInvalidArray)\n+  assert.isEmpty(arrayFromInvalidArray)\n+} finally {\n+  resetLocalStorage();\n+}\n+```\n+\n You should have a function named `displayOrCloseForm`.\n \n ```js\n@@ -201,7 +219,7 @@ try {\n }\n ```\n \n-When you click `#view-category-button`, you should modify `#category-list`'s inner HTML by adding a radio button having the `id` and `value` attributes set to the bookmark name for each bookmark in the selected category.\n+When you click the `#view-category-button`, you should modify the `#category-list` element's inner HTML by adding a radio button. The radio button should have the `id` and `value` attributes set to the bookmark name for each bookmark in the selected category. Additionally, each radio button should have the same `name` attribute.\n \n ```js\n try {\n@@ -214,6 +232,8 @@ try {\n   assert.strictEqual(bookmarksDisplayed[0].value, \"example1\");\n   assert.strictEqual(bookmarksDisplayed[1].id, \"example4\");\n   assert.strictEqual(bookmarksDisplayed[1].value, \"example4\");\n+  assert.isOk(bookmarksDisplayed[0].name)\n+  assert.strictEqual(bookmarksDisplayed[0].name, bookmarksDisplayed[1].name);\n } finally {\n   resetLocalStorage();\n }\n@@ -262,7 +282,49 @@ closeListButtonTest.dispatchEvent(new Event(\"click\"));\n assert.strictEqual(getHidden(\"bookmark list\"), \"bookmark list\");\n ```\n \n-When you click `#delete-bookmark-button`, you should delete the bookmark corresponding to the selected radio button from the local storage and update the displayed bookmark list.\n+When you click the `#close-list-button` and then open any category, the `#category-list` should contain only data relevant for the selected category, without duplicating entries.\n+\n+```js\n+setLocalStorage();\n+try {\n+  categoryDropdownTest.value = \"miscellaneous\";\n+  viewCategoryButtonTest.dispatchEvent(new Event(\"click\"));\n+  const categoryList = document.getElementById(\"category-list\").innerHTML;\n+  assert.strictEqual(categoryList, \"<p>No Bookmarks Found</p>\");\n+\n+  closeListButtonTest.dispatchEvent(new Event(\"click\"));\n+  categoryDropdownTest.value = \"news\";\n+  viewCategoryButtonTest.dispatchEvent(new Event(\"click\"));\n+\n+  const newsBookmarks = document.querySelectorAll('#category-list input[type=\"radio\"]');\n+  assert.lengthOf(newsBookmarks, 2);\n+  assert.strictEqual(newsBookmarks[0].id, \"example1\");\n+  assert.strictEqual(newsBookmarks[0].value, \"example1\");\n+  assert.strictEqual(newsBookmarks[1].id, \"example4\");\n+  assert.strictEqual(newsBookmarks[1].value, \"example4\");\n+\n+  closeListButtonTest.dispatchEvent(new Event(\"click\"));\n+  categoryDropdownTest.value = \"work\";\n+  viewCategoryButtonTest.dispatchEvent(new Event(\"click\"));\n+\n+  const workBookmarks = document.querySelectorAll('#category-list input[type=\"radio\"]');\n+  assert.lengthOf(workBookmarks, 1);\n+  assert.strictEqual(workBookmarks[0].id, \"example3\");\n+  assert.strictEqual(workBookmarks[0].value, \"example3\");\n+\n+  categoryDropdownTest.value = \"miscellaneous\";\n+  viewCategoryButtonTest.dispatchEvent(new Event(\"click\"));\n+\n+  const paragraphs = document.querySelectorAll(\"#category-list p\");\n+  assert.lengthOf(paragraphs, 1);\n+  assert.strictEqual(paragraphs[0].innerText, \"No Bookmarks Found\");\n+} finally {\n+  resetLocalStorage();\n+  clearCategoryList();\n+}\n+```\n+\n+When you click the `#delete-bookmark-button`, you should delete the bookmark corresponding to the selected radio button and appropriate category from the local storage and update the displayed bookmark list.\n \n ```js\n setLocalStorage();\n@@ -281,7 +343,17 @@ try {\n   assert.strictEqual(bookmarkLabelsDisplayed[0].htmlFor, \"example4\");\n   const expected = [{name: \"example2\", category: \"entertainment\", url: \"example2.com\"}, {name: \"example3\", category: \"work\", url: \"example3.com\"}, {name: \"example4\", category: \"news\", url: \"example4.com\"}];\n   assert.deepEqual(getBookmarks(), expected);\n-  \n+\n+  localStorage.setItem(\"bookmarks\", JSON.stringify([{name: \"duplicated-name\", category: \"news\", url: \"example1.com\"}, {name: \"duplicated-name\", category: \"entertainment\", url: \"example2.com\"}]));\n+\n+  categoryDropdownTest.value = \"entertainment\";\n+  viewCategoryButtonTest.dispatchEvent(new Event(\"click\"));\n+  const radioForDuplicate = document.querySelector('#category-list input[type=\"radio\"]');\n+  radioForDuplicate.checked = true;\n+\n+  deleteBookmarkButtonTest.dispatchEvent(new Event(\"click\"));\n+\n+  assert.deepEqual(getBookmarks(), [{name: \"duplicated-name\", category: \"news\", url: \"example1.com\"}])\n } finally {\n   resetLocalStorage();\n }\n@@ -529,7 +601,26 @@ const addBookmarkButtonForm = document.getElementById(\"add-bookmark-button-form\"\n const categoryList = document.getElementById(\"category-list\");\n const closeListButton = document.getElementById(\"close-list-button\");\n const deleteBookmarkButton = document.getElementById(\"delete-bookmark-button\");\n-const getBookmarks = () => JSON.parse(localStorage.getItem(\"bookmarks\")) || [];\n+\n+const getBookmarks = () => {\n+  try {\n+    const parsed = JSON.parse(localStorage.getItem(\"bookmarks\"));\n+    if (\n+      Array.isArray(parsed) &&\n+      parsed.every(\n+        (item) =>\n+          item.hasOwnProperty(\"category\") &&\n+          item.hasOwnProperty(\"name\") &&\n+          item.hasOwnProperty(\"url\"),\n+      )\n+    ) {\n+      return parsed;\n+    }\n+    return [];\n+  } catch {\n+    return [];\n+  }\n+};\n \n const displayOrCloseForm = () => {\n     mainSection.classList.toggle(\"hidden\");\n@@ -570,12 +661,7 @@ const displayOrHideCategory = () => {\n const fillBookmarkList = () => {\n     categoryHeading[1].innerText = categoryDropdown.value.charAt(0).toUpperCase()\n         + categoryDropdown.value.slice(1);\n-    const bookmarksToDisplay = getBookmarks().filter((i) => {\n-        if (i.category === categoryDropdown.value) {\n-            return true\n-        }\n-        return false\n-    });\n+    const bookmarksToDisplay = getBookmarks().filter((i) => i.category === categoryDropdown.value);\n     if (bookmarksToDisplay.length) {\n         categoryList.innerHTML = '';\n         for (const bookmark of bookmarksToDisplay) {\n@@ -604,7 +690,7 @@ const deleteBookmark = () => {\n     for (const radioBookmark of radioBookmarks) {\n         if (radioBookmark.checked) {\n             const bookmarks = getBookmarks();\n-            const indexToRemove = bookmarks.findIndex(i => i.name == radioBookmark.value);\n+            const indexToRemove = bookmarks.findIndex(i => i.name == radioBookmark.value && i.category === categoryDropdown.value);\n             bookmarks.splice(indexToRemove, 1);\n             localStorage.setItem(\"bookmarks\", JSON.stringify(bookmarks));\n             return"
        }
    ],
    "stats": {
        "total": 116,
        "additions": 101,
        "deletions": 15
    }
}