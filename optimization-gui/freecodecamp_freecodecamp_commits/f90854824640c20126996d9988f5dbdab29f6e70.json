{
    "author": "moT01",
    "message": "feat(api): add endpoint for submitting daily coding challenges (#59465)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>\nCo-authored-by: Shaun Hamilton <shauhami020@gmail.com>",
    "sha": "f90854824640c20126996d9988f5dbdab29f6e70",
    "files": [
        {
            "sha": "93c9ab81ae3e63f14c29d279d55f44c165d9b221",
            "filename": "api/prisma/schema.prisma",
            "status": "modified",
            "additions": 79,
            "deletions": 65,
            "changes": 144,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fprisma%2Fschema.prisma",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fprisma%2Fschema.prisma",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fprisma%2Fschema.prisma?ref=f90854824640c20126996d9988f5dbdab29f6e70",
            "patch": "@@ -29,6 +29,19 @@ type CompletedChallenge {\n   examResults        ExamResults? // Undefined\n }\n \n+enum DailyCodingChallengeLanguage {\n+  javascript\n+  python\n+}\n+\n+type CompletedDailyCodingChallenge {\n+  id            String                         @db.ObjectId\n+  /// Date in milliseconds since epoch\n+  /// This is not a DateTime, because DateTime does not serialize directly to JSON\n+  completedDate Int\n+  languages     DailyCodingChallengeLanguage[]\n+}\n+\n type PartiallyCompletedChallenge {\n   id            String\n   completedDate Float\n@@ -77,77 +90,78 @@ type QuizAttempt {\n \n /// Corresponds to the `user` collection.\n model user {\n-  id                           String                        @id @default(auto()) @map(\"_id\") @db.ObjectId\n-  about                        String\n-  acceptedPrivacyTerms         Boolean\n-  completedChallenges          CompletedChallenge[]\n-  completedExams               CompletedExam[] // Undefined\n-  quizAttempts                 QuizAttempt[] // Undefined\n-  currentChallengeId           String?\n-  donationEmails               String[] // Undefined | String[] (only possible for built in Types like String)\n-  email                        String\n-  emailAuthLinkTTL             DateTime? // Null | Undefined\n-  emailVerified                Boolean\n-  emailVerifyTTL               DateTime? // Null | Undefined\n-  externalId                   String\n-  githubProfile                String? // Undefined\n-  isApisMicroservicesCert      Boolean? // Undefined\n-  isBackEndCert                Boolean? // Undefined\n-  isBanned                     Boolean? // Undefined\n-  isCheater                    Boolean? // Undefined\n-  isDataAnalysisPyCertV7       Boolean? // Undefined\n-  isDataVisCert                Boolean? // Undefined\n-  isDonating                   Boolean\n-  isFoundationalCSharpCertV8   Boolean? // Undefined\n-  isFrontEndCert               Boolean? // Undefined\n-  isFrontEndLibsCert           Boolean? // Undefined\n-  isFullStackCert              Boolean? // Undefined\n-  isHonest                     Boolean?\n-  isInfosecCertV7              Boolean? // Undefined\n-  isInfosecQaCert              Boolean? // Undefined\n-  isJsAlgoDataStructCert       Boolean? // Undefined\n-  isJsAlgoDataStructCertV8     Boolean? // Undefined\n-  isMachineLearningPyCertV7    Boolean? // Undefined\n-  isQaCertV7                   Boolean? // Undefined\n-  isRelationalDatabaseCertV8   Boolean? // Undefined\n-  isRespWebDesignCert          Boolean? // Undefined\n-  isSciCompPyCertV7            Boolean? // Undefined\n-  is2018DataVisCert            Boolean? // Undefined\n-  is2018FullStackCert          Boolean? // Undefined\n-  isCollegeAlgebraPyCertV8     Boolean? // Undefined\n-  // isUpcomingPythonCertV8    Boolean? // Undefined. It is in the db but has never been used.\n-  keyboardShortcuts            Boolean? // Undefined\n-  linkedin                     String? // Null | Undefined\n-  location                     String? // Null\n-  name                         String? // Null\n-  needsModeration              Boolean? // Undefined\n-  newEmail                     String? // Null | Undefined\n-  partiallyCompletedChallenges PartiallyCompletedChallenge[] // Undefined | PartiallyCompletedChallenge[]\n-  password                     String? // Undefined\n-  picture                      String\n-  portfolio                    Portfolio[]\n-  profileUI                    ProfileUI? // Undefined\n-  progressTimestamps           Json? // ProgressTimestamp[] | Null[] | Int64[] | Double[] - TODO: NORMALIZE\n+  id                             String                          @id @default(auto()) @map(\"_id\") @db.ObjectId\n+  about                          String\n+  acceptedPrivacyTerms           Boolean\n+  completedChallenges            CompletedChallenge[]\n+  completedDailyCodingChallenges CompletedDailyCodingChallenge[]\n+  completedExams                 CompletedExam[] // Undefined\n+  quizAttempts                   QuizAttempt[] // Undefined\n+  currentChallengeId             String?\n+  donationEmails                 String[] // Undefined | String[] (only possible for built in Types like String)\n+  email                          String\n+  emailAuthLinkTTL               DateTime? // Null | Undefined\n+  emailVerified                  Boolean\n+  emailVerifyTTL                 DateTime? // Null | Undefined\n+  externalId                     String\n+  githubProfile                  String? // Undefined\n+  isApisMicroservicesCert        Boolean? // Undefined\n+  isBackEndCert                  Boolean? // Undefined\n+  isBanned                       Boolean? // Undefined\n+  isCheater                      Boolean? // Undefined\n+  isDataAnalysisPyCertV7         Boolean? // Undefined\n+  isDataVisCert                  Boolean? // Undefined\n+  isDonating                     Boolean\n+  isFoundationalCSharpCertV8     Boolean? // Undefined\n+  isFrontEndCert                 Boolean? // Undefined\n+  isFrontEndLibsCert             Boolean? // Undefined\n+  isFullStackCert                Boolean? // Undefined\n+  isHonest                       Boolean?\n+  isInfosecCertV7                Boolean? // Undefined\n+  isInfosecQaCert                Boolean? // Undefined\n+  isJsAlgoDataStructCert         Boolean? // Undefined\n+  isJsAlgoDataStructCertV8       Boolean? // Undefined\n+  isMachineLearningPyCertV7      Boolean? // Undefined\n+  isQaCertV7                     Boolean? // Undefined\n+  isRelationalDatabaseCertV8     Boolean? // Undefined\n+  isRespWebDesignCert            Boolean? // Undefined\n+  isSciCompPyCertV7              Boolean? // Undefined\n+  is2018DataVisCert              Boolean? // Undefined\n+  is2018FullStackCert            Boolean? // Undefined\n+  isCollegeAlgebraPyCertV8       Boolean? // Undefined\n+  // isUpcomingPythonCertV8         Boolean? // Undefined. It is in the db but has never been used.\n+  keyboardShortcuts              Boolean? // Undefined\n+  linkedin                       String? // Null | Undefined\n+  location                       String? // Null\n+  name                           String? // Null\n+  needsModeration                Boolean? // Undefined\n+  newEmail                       String? // Null | Undefined\n+  partiallyCompletedChallenges   PartiallyCompletedChallenge[] // Undefined | PartiallyCompletedChallenge[]\n+  password                       String? // Undefined\n+  picture                        String\n+  portfolio                      Portfolio[]\n+  profileUI                      ProfileUI? // Undefined\n+  progressTimestamps             Json? // ProgressTimestamp[] | Null[] | Int64[] | Double[] - TODO: NORMALIZE\n   /// A random number between 0 and 1.\n   ///\n   /// Valuable for selectively performing random logic.\n-  rand                         Float?\n-  savedChallenges              SavedChallenge[] // Undefined | SavedChallenge[]\n-  sendQuincyEmail              Boolean\n-  theme                        String? // Undefined\n-  timezone                     String? // Undefined\n-  twitter                      String? // Null | Undefined\n-  unsubscribeId                String\n+  rand                           Float?\n+  savedChallenges                SavedChallenge[] // Undefined | SavedChallenge[]\n+  sendQuincyEmail                Boolean\n+  theme                          String? // Undefined\n+  timezone                       String? // Undefined\n+  twitter                        String? // Null | Undefined\n+  unsubscribeId                  String\n   /// Used to track the number of times the user's record was written to.\n   ///\n   /// This has the main benefit of allowing concurrent ops to check for race conditions.\n-  updateCount                  Int?                          @default(0)\n-  username                     String // TODO(Post-MVP): make this unique\n-  usernameDisplay              String? // Undefined\n-  verificationToken            String? // Undefined\n-  website                      String? // Undefined\n-  yearsTopContributor          String[] // Undefined | String[]\n-  isClassroomAccount           Boolean? // Undefined\n+  updateCount                    Int?                            @default(0)\n+  username                       String // TODO(Post-MVP): make this unique\n+  usernameDisplay                String? // Undefined\n+  verificationToken              String? // Undefined\n+  website                        String? // Undefined\n+  yearsTopContributor            String[] // Undefined | String[]\n+  isClassroomAccount             Boolean? // Undefined\n \n   // Relations\n   examAttempts                      EnvExamAttempt[]"
        },
        {
            "sha": "512e3d1364b89ae24eb80a88904ed763d19797c5",
            "filename": "api/src/plugins/__fixtures__/user.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Fplugins%2F__fixtures__%2Fuser.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Fplugins%2F__fixtures__%2Fuser.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2F__fixtures__%2Fuser.ts?ref=f90854824640c20126996d9988f5dbdab29f6e70",
            "patch": "@@ -11,6 +11,7 @@ export const newUser = (email: string) => ({\n   about: '',\n   acceptedPrivacyTerms: false,\n   completedChallenges: [],\n+  completedDailyCodingChallenges: [],\n   completedExams: [],\n   quizAttempts: [],\n   currentChallengeId: '',"
        },
        {
            "sha": "3b6e36ab60c80ae9a8059b68fdb0fdf4e93640e8",
            "filename": "api/src/routes/protected/challenge.test.ts",
            "status": "modified",
            "additions": 206,
            "deletions": 0,
            "changes": 206,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Froutes%2Fprotected%2Fchallenge.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Froutes%2Fprotected%2Fchallenge.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fprotected%2Fchallenge.test.ts?ref=f90854824640c20126996d9988f5dbdab29f6e70",
            "patch": "@@ -5,6 +5,7 @@ const mockVerifyTrophyWithMicrosoft = jest.fn();\n /* eslint-disable @typescript-eslint/no-unsafe-assignment */\n import { omit } from 'lodash';\n import { Static } from '@fastify/type-provider-typebox';\n+import { DailyCodingChallengeLanguage } from '@prisma/client';\n \n import { challengeTypes } from '../../../../shared/config/challenge-types';\n import {\n@@ -146,6 +147,12 @@ const updatedMultiFileCertProjectBody = {\n   ]\n };\n \n+const dailyCodingChallengeId = '5900f36e1000cf542c50fe80';\n+const dailyCodingChallengeBody = {\n+  id: dailyCodingChallengeId,\n+  language: DailyCodingChallengeLanguage.javascript\n+};\n+\n describe('challengeRoutes', () => {\n   setupServer();\n   describe('Authenticated user', () => {\n@@ -912,6 +919,204 @@ describe('challengeRoutes', () => {\n       });\n     });\n \n+    describe('/daily-coding-challenge-completed', () => {\n+      describe('validation', () => {\n+        test('POST rejects requests without an id', async () => {\n+          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n+          const { id, ...noIdReqBody } = dailyCodingChallengeBody;\n+          const response = await superPost(\n+            '/daily-coding-challenge-completed'\n+          ).send(noIdReqBody);\n+\n+          expect(response.body).toStrictEqual(\n+            isValidChallengeCompletionErrorMsg\n+          );\n+          expect(response.statusCode).toBe(400);\n+        });\n+\n+        test('POST rejects requests without a language', async () => {\n+          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n+          const { language, ...noLanguageReqBody } = dailyCodingChallengeBody;\n+          const response = await superPost(\n+            '/daily-coding-challenge-completed'\n+          ).send(noLanguageReqBody);\n+\n+          expect(response.body).toStrictEqual(\n+            isValidChallengeCompletionErrorMsg\n+          );\n+          expect(response.statusCode).toBe(400);\n+        });\n+\n+        test('POST rejects requests without valid ObjectIDs', async () => {\n+          const response = await superPost(\n+            '/daily-coding-challenge-completed'\n+          ).send({\n+            ...dailyCodingChallengeBody,\n+            id: 'not-a-valid-id'\n+          });\n+\n+          expect(response.body).toStrictEqual(\n+            isValidChallengeCompletionErrorMsg\n+          );\n+          expect(response.statusCode).toBe(400);\n+        });\n+\n+        test('POST rejects requests without valid coding language', async () => {\n+          const response = await superPost(\n+            '/daily-coding-challenge-completed'\n+          ).send({\n+            ...dailyCodingChallengeBody,\n+            language: 'not-a-valid-language'\n+          });\n+\n+          expect(response.body).toStrictEqual(\n+            isValidChallengeCompletionErrorMsg\n+          );\n+          expect(response.statusCode).toBe(400);\n+        });\n+      });\n+\n+      describe('handling', () => {\n+        afterEach(async () => {\n+          await fastifyTestInstance.prisma.user.updateMany({\n+            where: { email: 'foo@bar.com' },\n+            data: {\n+              completedDailyCodingChallenges: [],\n+              progressTimestamps: []\n+            }\n+          });\n+        });\n+\n+        test('POST correctly handles multiple requests', async () => {\n+          const now = Date.now();\n+\n+          const res1 = await superPost(\n+            '/daily-coding-challenge-completed'\n+          ).send(dailyCodingChallengeBody);\n+\n+          const user1 = await fastifyTestInstance.prisma.user.findFirstOrThrow({\n+            where: { email: 'foo@bar.com' }\n+          });\n+\n+          const completedDate =\n+            user1.completedDailyCodingChallenges[0]?.completedDate;\n+\n+          // should have correct completedDate\n+          expect(completedDate).toBeGreaterThanOrEqual(now);\n+          expect(completedDate).toBeLessThanOrEqual(now + 1000);\n+\n+          expect(user1).toMatchObject({\n+            // should add completedDailyCodingChallenge to database with correct info\n+            completedDailyCodingChallenges: [\n+              {\n+                id: dailyCodingChallengeId,\n+                completedDate,\n+                languages: [DailyCodingChallengeLanguage.javascript]\n+              }\n+            ],\n+            // should add to progressTimestamps\n+            progressTimestamps: [completedDate]\n+          });\n+\n+          // should have correct response\n+          expect(res1.statusCode).toBe(200);\n+          expect(res1.body).toStrictEqual({\n+            alreadyCompleted: false,\n+            points: 1,\n+            completedDate,\n+            completedDailyCodingChallenges: [\n+              {\n+                id: dailyCodingChallengeId,\n+                completedDate,\n+                languages: [DailyCodingChallengeLanguage.javascript]\n+              }\n+            ]\n+          });\n+\n+          const res2 = await superPost(\n+            '/daily-coding-challenge-completed'\n+          ).send(dailyCodingChallengeBody);\n+\n+          const user2 = await fastifyTestInstance.prisma.user.findFirstOrThrow({\n+            where: { email: 'foo@bar.com' }\n+          });\n+\n+          // should not add 'javascript' again, should not update completedDate\n+          expect(user2).toMatchObject({\n+            completedDailyCodingChallenges: [\n+              {\n+                id: dailyCodingChallengeId,\n+                completedDate,\n+                languages: [DailyCodingChallengeLanguage.javascript]\n+              }\n+            ],\n+            // should not add to progressTimestamps\n+            progressTimestamps: [completedDate]\n+          });\n+\n+          // should have correct response\n+          expect(res2.statusCode).toBe(200);\n+          expect(res2.body).toStrictEqual({\n+            alreadyCompleted: true,\n+            points: 1,\n+            completedDate,\n+            completedDailyCodingChallenges: [\n+              {\n+                id: dailyCodingChallengeId,\n+                completedDate,\n+                languages: [DailyCodingChallengeLanguage.javascript]\n+              }\n+            ]\n+          });\n+\n+          const res3 = await superPost(\n+            '/daily-coding-challenge-completed'\n+          ).send({\n+            ...dailyCodingChallengeBody,\n+            language: 'python'\n+          });\n+\n+          const user3 = await fastifyTestInstance.prisma.user.findFirstOrThrow({\n+            where: { email: 'foo@bar.com' }\n+          });\n+\n+          // should add 'python' to languages + should not update completedDate\n+          expect(user3).toMatchObject({\n+            completedDailyCodingChallenges: [\n+              {\n+                id: dailyCodingChallengeId,\n+                completedDate,\n+                languages: [\n+                  DailyCodingChallengeLanguage.javascript,\n+                  DailyCodingChallengeLanguage.python\n+                ]\n+              }\n+            ],\n+            // should not add to progressTimestamps\n+            progressTimestamps: [completedDate]\n+          });\n+\n+          // should have correct response\n+          expect(res3.statusCode).toBe(200);\n+          expect(res3.body).toStrictEqual({\n+            alreadyCompleted: true,\n+            points: 1,\n+            completedDate,\n+            completedDailyCodingChallenges: [\n+              {\n+                id: dailyCodingChallengeId,\n+                completedDate,\n+                languages: [\n+                  DailyCodingChallengeLanguage.javascript,\n+                  DailyCodingChallengeLanguage.python\n+                ]\n+              }\n+            ]\n+          });\n+        });\n+      });\n+    });\n+\n     describe('POST /save-challenge', () => {\n       describe('validation', () => {\n         test('returns 400 status for unsavable challenges', async () => {\n@@ -1848,6 +2053,7 @@ describe('challengeRoutes', () => {\n       { path: '/project-completed', method: 'POST' },\n       { path: '/backend-challenge-completed', method: 'POST' },\n       { path: '/modern-challenge-completed', method: 'POST' },\n+      { path: '/daily-coding-challenge-completed', method: 'POST' },\n       { path: '/save-challenge', method: 'POST' },\n       { path: '/exam/647e22d18acb466c97ccbef8', method: 'GET' },\n       { path: '/ms-trophy-challenge-completed', method: 'POST' },"
        },
        {
            "sha": "b4e17d4c5490ce6c82f4ce9d91adedb832759927",
            "filename": "api/src/routes/protected/challenge.ts",
            "status": "modified",
            "additions": 122,
            "deletions": 0,
            "changes": 122,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Froutes%2Fprotected%2Fchallenge.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Froutes%2Fprotected%2Fchallenge.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fprotected%2Fchallenge.ts?ref=f90854824640c20126996d9988f5dbdab29f6e70",
            "patch": "@@ -3,6 +3,7 @@ import jwt from 'jsonwebtoken';\n import { uniqBy, matches } from 'lodash';\n import { CompletedExam, ExamResults } from '@prisma/client';\n import isURL from 'validator/lib/isURL';\n+import type { FastifyInstance, FastifyReply } from 'fastify';\n \n import { challengeTypes } from '../../../../shared/config/challenge-types';\n import * as schemas from '../../schemas';\n@@ -33,6 +34,7 @@ import {\n   canSubmitCodeRoadCertProject,\n   verifyTrophyWithMicrosoft\n } from '../helpers/challenge-helpers';\n+import { UpdateReqType } from '../../utils';\n \n interface JwtPayload {\n   userToken: string;\n@@ -415,6 +417,26 @@ export const challengeRoutes: FastifyPluginCallbackTypebox = (\n     }\n   );\n \n+  fastify.post(\n+    '/daily-coding-challenge-completed',\n+    {\n+      schema: schemas.dailyCodingChallengeCompleted,\n+      errorHandler(error, req, reply) {\n+        const logger = fastify.log.child({ req });\n+        if (error.validation) {\n+          logger.warn({ validationError: error.validation });\n+          void reply.code(400);\n+          void reply.send({\n+            type: 'error',\n+            message: 'That does not appear to be a valid challenge submission.'\n+          });\n+          fastify.errorHandler(error, req, reply);\n+        }\n+      }\n+    },\n+    postDailyCodingChallengeCompleted\n+  );\n+\n   fastify.post(\n     '/save-challenge',\n     {\n@@ -949,3 +971,103 @@ export const challengeRoutes: FastifyPluginCallbackTypebox = (\n \n   done();\n };\n+\n+async function postDailyCodingChallengeCompleted(\n+  this: FastifyInstance,\n+  req: UpdateReqType<typeof schemas.dailyCodingChallengeCompleted>,\n+  reply: FastifyReply\n+) {\n+  const logger = this.log.child({ req });\n+  logger.info(`User ${req.user?.id} submitted a daily coding challenge`);\n+\n+  const { id, language } = req.body;\n+\n+  const user = await this.prisma.user.findUniqueOrThrow({\n+    where: { id: req.user?.id },\n+    select: {\n+      completedDailyCodingChallenges: true,\n+      progressTimestamps: true\n+    }\n+  });\n+\n+  const { completedDailyCodingChallenges, progressTimestamps = [] } = user;\n+\n+  const points = getPoints(progressTimestamps as ProgressTimestamp[]);\n+  const oldCompletedChallenge = completedDailyCodingChallenges.find(\n+    c => c.id === id\n+  );\n+\n+  const alreadyCompleted = !!oldCompletedChallenge;\n+  const languageAlreadyCompleted =\n+    oldCompletedChallenge?.languages.includes(language);\n+\n+  if (alreadyCompleted) {\n+    const { completedDate, languages } = oldCompletedChallenge;\n+\n+    if (languageAlreadyCompleted) {\n+      // alreadyCompleted && languageAlreadyCompleted, no need to change anything in the database\n+      return reply.send({\n+        alreadyCompleted,\n+        points,\n+        completedDate,\n+        completedDailyCodingChallenges\n+      });\n+    } else {\n+      // alreadyCompleted && !languageAlreadyCompleted, add the language to the record\n+      const { completedDailyCodingChallenges } = await this.prisma.user.update({\n+        where: { id: req.user?.id },\n+        select: {\n+          completedDailyCodingChallenges: true\n+        },\n+        data: {\n+          completedDailyCodingChallenges: {\n+            updateMany: {\n+              where: { id },\n+              data: {\n+                languages: [...new Set([...languages, language])]\n+              }\n+            }\n+          }\n+        }\n+      });\n+      return reply.send({\n+        alreadyCompleted,\n+        points,\n+        completedDate,\n+        completedDailyCodingChallenges\n+      });\n+    }\n+  } else {\n+    // !alreadyCompleted, add new record for completed challenge\n+    const newCompletedDate = Date.now();\n+\n+    const newCompletedChallenge = {\n+      id,\n+      completedDate: newCompletedDate,\n+      languages: [language]\n+    };\n+\n+    const newCompletedChallenges = [\n+      ...completedDailyCodingChallenges,\n+      newCompletedChallenge\n+    ];\n+\n+    const newProgressTimestamps = Array.isArray(progressTimestamps)\n+      ? [...progressTimestamps, newCompletedDate]\n+      : [newCompletedDate];\n+\n+    await this.prisma.user.update({\n+      where: { id: req.user?.id },\n+      data: {\n+        completedDailyCodingChallenges: newCompletedChallenges,\n+        progressTimestamps: newProgressTimestamps\n+      }\n+    });\n+    return reply.send({\n+      alreadyCompleted,\n+      points: points + 1,\n+      completedDate: newCompletedDate,\n+      completedDailyCodingChallenges: newCompletedChallenges\n+    });\n+  }\n+}"
        },
        {
            "sha": "2fe1c792256b82c6284715b41c9fedebcc5bc641",
            "filename": "api/src/routes/protected/user.test.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 1,
            "changes": 24,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Froutes%2Fprotected%2Fuser.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Froutes%2Fprotected%2Fuser.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fprotected%2Fuser.test.ts?ref=f90854824640c20126996d9988f5dbdab29f6e70",
            "patch": "@@ -2,7 +2,7 @@\n /* eslint-disable @typescript-eslint/no-unsafe-argument */\n /* eslint-disable @typescript-eslint/no-unsafe-assignment */\n import jwt, { JwtPayload } from 'jsonwebtoken';\n-import type { Prisma } from '@prisma/client';\n+import { DailyCodingChallengeLanguage, type Prisma } from '@prisma/client';\n import { ObjectId } from 'mongodb';\n import _ from 'lodash';\n \n@@ -78,6 +78,16 @@ const testUserData: Prisma.userCreateInput = {\n       }\n     }\n   ],\n+  completedDailyCodingChallenges: [\n+    {\n+      id: '5900f36e1000cf542c50fe80',\n+      completedDate: 1742941672524,\n+      languages: [\n+        DailyCodingChallengeLanguage.python,\n+        DailyCodingChallengeLanguage.javascript\n+      ]\n+    }\n+  ],\n   partiallyCompletedChallenges: [{ id: '123', completedDate: 123 }],\n   completedExams: [],\n   quizAttempts: [\n@@ -218,6 +228,16 @@ const publicUserData = {\n       }\n     }\n   ],\n+  completedDailyCodingChallenges: [\n+    {\n+      id: '5900f36e1000cf542c50fe80',\n+      completedDate: 1742941672524,\n+      languages: [\n+        DailyCodingChallengeLanguage.python,\n+        DailyCodingChallengeLanguage.javascript\n+      ]\n+    }\n+  ],\n   completedExams: testUserData.completedExams,\n   completedSurveys: [], // TODO: add surveys\n   quizAttempts: testUserData.quizAttempts,\n@@ -290,6 +310,7 @@ const baseProgressData = {\n   isRelationalDatabaseCertV8: false,\n   isCollegeAlgebraPyCertV8: false,\n   completedChallenges: [],\n+  completedDailyCodingChallenges: [],\n   completedExams: [],\n   savedChallenges: [],\n   partiallyCompletedChallenges: [],\n@@ -735,6 +756,7 @@ describe('userRoutes', () => {\n           // missing in the user document.\n           currentChallengeId: '',\n           completedChallenges: [],\n+          completedDailyCodingChallenges: [],\n           completedExams: [],\n           completedSurveys: [],\n           partiallyCompletedChallenges: [],"
        },
        {
            "sha": "85e1fb9e89d05e9b45dfc76eeba8b572210dfb05",
            "filename": "api/src/routes/protected/user.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Froutes%2Fprotected%2Fuser.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Froutes%2Fprotected%2Fuser.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fprotected%2Fuser.ts?ref=f90854824640c20126996d9988f5dbdab29f6e70",
            "patch": "@@ -505,6 +505,7 @@ export const userGetRoutes: FastifyPluginCallbackTypebox = (\n             about: true,\n             acceptedPrivacyTerms: true,\n             completedChallenges: true,\n+            completedDailyCodingChallenges: true,\n             completedExams: true,\n             currentChallengeId: true,\n             quizAttempts: true,\n@@ -589,6 +590,7 @@ export const userGetRoutes: FastifyPluginCallbackTypebox = (\n           username,\n           usernameDisplay,\n           completedChallenges,\n+          completedDailyCodingChallenges,\n           progressTimestamps,\n           twitter,\n           profileUI,\n@@ -607,6 +609,7 @@ export const userGetRoutes: FastifyPluginCallbackTypebox = (\n               currentChallengeId: currentChallengeId ?? '',\n               completedChallenges: normalizeChallenges(completedChallenges),\n               completedChallengeCount: completedChallenges.length,\n+              completedDailyCodingChallenges,\n               // This assertion is necessary until the database is normalized.\n               calendar: getCalendar(\n                 progressTimestamps as ProgressTimestamp[] | null"
        },
        {
            "sha": "abac46c8ce80fb1e0017b4081954ff8ab713723c",
            "filename": "api/src/schemas.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Fschemas.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Fschemas.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas.ts?ref=f90854824640c20126996d9988f5dbdab29f6e70",
            "patch": "@@ -6,6 +6,7 @@ export { backendChallengeCompleted } from './schemas/challenge/backend-challenge\n export { coderoadChallengeCompleted } from './schemas/challenge/coderoad-challenge-completed';\n export { exam } from './schemas/challenge/exam';\n export { examChallengeCompleted } from './schemas/challenge/exam-challenge-completed';\n+export { dailyCodingChallengeCompleted } from './schemas/challenge/daily-coding-challenge-completed';\n export { modernChallengeCompleted } from './schemas/challenge/modern-challenge-completed';\n export { msTrophyChallengeCompleted } from './schemas/challenge/ms-trophy-challenge-completed';\n export { projectCompleted } from './schemas/challenge/project-completed';"
        },
        {
            "sha": "6d6ef9bbe980df88b69d3994bbd47b7832f10970",
            "filename": "api/src/schemas/challenge/daily-coding-challenge-completed.ts",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Fschemas%2Fchallenge%2Fdaily-coding-challenge-completed.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Fschemas%2Fchallenge%2Fdaily-coding-challenge-completed.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fchallenge%2Fdaily-coding-challenge-completed.ts?ref=f90854824640c20126996d9988f5dbdab29f6e70",
            "patch": "@@ -0,0 +1,33 @@\n+import { Type } from '@fastify/type-provider-typebox';\n+import { DailyCodingChallengeLanguage } from '@prisma/client';\n+\n+const languages = Object.values(DailyCodingChallengeLanguage).map(k =>\n+  Type.Literal(k)\n+);\n+\n+export const dailyCodingChallengeCompleted = {\n+  body: Type.Object({\n+    id: Type.String({ format: 'objectid', maxLength: 24, minLength: 24 }),\n+    language: Type.Union(languages)\n+  }),\n+  response: {\n+    200: Type.Object({\n+      completedDate: Type.Number(),\n+      points: Type.Number(),\n+      alreadyCompleted: Type.Boolean(),\n+      completedDailyCodingChallenges: Type.Array(\n+        Type.Object({\n+          id: Type.String(),\n+          completedDate: Type.Number(),\n+          languages: Type.Array(Type.Union(languages))\n+        })\n+      )\n+    }),\n+    400: Type.Object({\n+      type: Type.Literal('error'),\n+      message: Type.Literal(\n+        'That does not appear to be a valid challenge submission.'\n+      )\n+    })\n+  }\n+};"
        },
        {
            "sha": "6d9c34bb72bfe87bd7496ce003c8069fa0bba354",
            "filename": "api/src/schemas/user/get-session-user.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Fschemas%2Fuser%2Fget-session-user.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f90854824640c20126996d9988f5dbdab29f6e70/api%2Fsrc%2Fschemas%2Fuser%2Fget-session-user.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fuser%2Fget-session-user.ts?ref=f90854824640c20126996d9988f5dbdab29f6e70",
            "patch": "@@ -1,6 +1,11 @@\n import { Type } from '@fastify/type-provider-typebox';\n+import { DailyCodingChallengeLanguage } from '@prisma/client';\n import { examResults, profileUI, savedChallenge } from '../types';\n \n+const languages = Object.values(DailyCodingChallengeLanguage).map(k =>\n+  Type.Literal(k)\n+);\n+\n export const getSessionUser = {\n   response: {\n     200: Type.Object({\n@@ -53,6 +58,13 @@ export const getSessionUser = {\n             })\n           ),\n           completedChallengeCount: Type.Number(),\n+          completedDailyCodingChallenges: Type.Array(\n+            Type.Object({\n+              id: Type.String(),\n+              completedDate: Type.Number(),\n+              languages: Type.Array(Type.Union(languages))\n+            })\n+          ),\n           currentChallengeId: Type.String(),\n           email: Type.String(),\n           emailVerified: Type.Boolean(),"
        }
    ],
    "stats": {
        "total": 546,
        "additions": 480,
        "deletions": 66
    }
}