{
    "author": "huyenltnguyen",
    "message": "fix(a11y): enable screen reader support for python terminal (#60154)",
    "sha": "46c008c112a84e55ccdf8f6b877ec33dddc7c6a4",
    "files": [
        {
            "sha": "5d289062c557395e08eaa2f73d0049aa6be3eb41",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/46c008c112a84e55ccdf8f6b877ec33dddc7c6a4/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/46c008c112a84e55ccdf8f6b877ec33dddc7c6a4/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=46c008c112a84e55ccdf8f6b877ec33dddc7c6a4",
            "patch": "@@ -849,7 +849,8 @@\n     \"opens-new-window\": \"Opens in new window\",\n     \"rsa-checkbox\": \"I have tried the Read-Search-Ask method\",\n     \"similar-questions-checkbox\": \"I have searched for similar questions that have already been answered on the forum\",\n-    \"edit-my-profile\": \"Edit my profile\"\n+    \"edit-my-profile\": \"Edit my profile\",\n+    \"terminal-output\": \"Terminal output\"\n   },\n   \"flash\": {\n     \"no-email-in-userinfo\": \"We could not retrieve an email from your chosen provider. Please try another provider or use the 'Continue with Email' option.\","
        },
        {
            "sha": "42a815dc5b430d5b290a3c033212477e109d0122",
            "filename": "client/src/templates/Challenges/classic/xterm.tsx",
            "status": "modified",
            "additions": 24,
            "deletions": 2,
            "changes": 26,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/46c008c112a84e55ccdf8f6b877ec33dddc7c6a4/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fxterm.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/46c008c112a84e55ccdf8f6b877ec33dddc7c6a4/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fxterm.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fxterm.tsx?ref=46c008c112a84e55ccdf8f6b877ec33dddc7c6a4",
            "patch": "@@ -1,6 +1,7 @@\n import React, { MutableRefObject, useEffect, useRef } from 'react';\n import type { IDisposable, Terminal } from 'xterm';\n import type { FitAddon } from 'xterm-addon-fit';\n+import { useTranslation } from 'react-i18next';\n \n import { registerTerminal } from '../utils/python-worker-handler';\n \n@@ -23,6 +24,7 @@ export const XtermTerminal = ({\n   dimensions?: { height: number; width: number };\n }) => {\n   const termContainerRef = useRef<HTMLDivElement | null>(null);\n+  const { t } = useTranslation();\n \n   useEffect(() => {\n     void registerServiceWorker();\n@@ -43,7 +45,25 @@ export const XtermTerminal = ({\n       if (termContainerRef.current) term.open(termContainerRef.current);\n       fitAddon.fit();\n \n-      const print = (text?: string) => term?.writeln(`${text ?? ''}`);\n+      // xterm does provide a11y support via the `screenReaderMode` option.\n+      // However, the mode only works best if the user interacts with the terminal directly.\n+      // Since we feed the content to xterm, it's better to control the output a11y ourselves.\n+      const termContainerDiv =\n+        termContainerRef.current?.querySelector('.xterm');\n+      const outputForScreenReader = document.createElement('div');\n+\n+      outputForScreenReader.setAttribute('role', 'region');\n+      outputForScreenReader.setAttribute(\n+        'aria-label',\n+        t('aria.terminal-output')\n+      );\n+      outputForScreenReader.classList.add('sr-only');\n+      termContainerDiv?.appendChild(outputForScreenReader);\n+\n+      const print = (text?: string) => {\n+        term?.writeln(`${text ?? ''}`);\n+        outputForScreenReader.textContent = text ?? '';\n+      };\n \n       // TODO: prevent user from moving cursor outside the current input line and\n       // handle insertion and deletion properly. While backspace and delete don't\n@@ -94,6 +114,8 @@ export const XtermTerminal = ({\n         term?.write('\\x1bc');\n         disposables.forEach(disposable => disposable.dispose());\n         disposables.length = 0;\n+\n+        outputForScreenReader.textContent = '';\n       };\n       registerTerminal({ print, input, reset });\n     }\n@@ -103,7 +125,7 @@ export const XtermTerminal = ({\n     return () => {\n       term?.dispose();\n     };\n-  }, [xtermFitRef]);\n+  }, [xtermFitRef, t]);\n \n   useEffect(() => {\n     if (xtermFitRef.current) xtermFitRef.current.fit();"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 26,
        "deletions": 3
    }
}