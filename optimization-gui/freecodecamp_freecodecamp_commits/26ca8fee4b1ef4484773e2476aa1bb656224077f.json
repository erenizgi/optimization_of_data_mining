{
    "author": "ShaunSHamilton",
    "message": "feat: add attempt statuses (#63035)",
    "sha": "26ca8fee4b1ef4484773e2476aa1bb656224077f",
    "files": [
        {
            "sha": "4a1baac7c3e6542d624b939a31791a48c19a969c",
            "filename": "api/src/exam-environment/routes/exam-environment.test.ts",
            "status": "modified",
            "additions": 46,
            "deletions": 12,
            "changes": 58,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/26ca8fee4b1ef4484773e2476aa1bb656224077f/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/26ca8fee4b1ef4484773e2476aa1bb656224077f/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts?ref=26ca8fee4b1ef4484773e2476aa1bb656224077f",
            "patch": "@@ -24,7 +24,10 @@ import {\n   examEnvironmentPostExamGeneratedExam\n } from '../schemas/index.js';\n import * as mock from '../../../__mocks__/exam-environment-exam.js';\n-import { constructUserExam } from '../utils/exam-environment.js';\n+import {\n+  constructUserExam,\n+  ExamAttemptStatus\n+} from '../utils/exam-environment.js';\n import { JWT_SECRET } from '../../utils/env.js';\n \n vi.mock('../../utils/env', async importOriginal => {\n@@ -921,9 +924,12 @@ describe('/exam-environment/', () => {\n       });\n \n       it('should return 200 with the examEnvironmentExamAttempt if the attempt exists and belongs to the user', async () => {\n+        const startTime = new Date(\n+          Date.now() - mock.exam.config.totalTimeInS * 1000\n+        );\n         const attempt =\n           await fastifyTestInstance.prisma.examEnvironmentExamAttempt.create({\n-            data: { ...mock.examAttempt, userId: defaultUserId }\n+            data: { ...mock.examAttempt, userId: defaultUserId, startTime }\n           });\n         await fastifyTestInstance.prisma.examEnvironmentExamModeration.create({\n           data: {\n@@ -944,7 +950,10 @@ describe('/exam-environment/', () => {\n           examId: mock.exam.id,\n           result: null,\n           startTime: attempt.startTime,\n-          questionSets: attempt.questionSets\n+          questionSets: attempt.questionSets,\n+          status: ExamAttemptStatus.PendingModeration,\n+          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n+          version: expect.any(Number)\n         };\n \n         expect(res.body).toEqual(serializeDates(examEnvironmentExamAttempt));\n@@ -961,9 +970,12 @@ describe('/exam-environment/', () => {\n       });\n \n       it('should return the attempt without results, if the attempt has not been moderated', async () => {\n+        const startTime = new Date(\n+          Date.now() - mock.exam.config.totalTimeInS * 1000\n+        );\n         const attempt =\n           await fastifyTestInstance.prisma.examEnvironmentExamAttempt.create({\n-            data: { ...mock.examAttempt, userId: defaultUserId }\n+            data: { ...mock.examAttempt, userId: defaultUserId, startTime }\n           });\n         await fastifyTestInstance.prisma.examEnvironmentExamModeration.create({\n           data: {\n@@ -984,7 +996,10 @@ describe('/exam-environment/', () => {\n           examId: mock.exam.id,\n           result: null,\n           startTime: attempt.startTime,\n-          questionSets: attempt.questionSets\n+          questionSets: attempt.questionSets,\n+          status: ExamAttemptStatus.PendingModeration,\n+          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n+          version: expect.any(Number)\n         };\n \n         expect(res.body).toEqual(serializeDates(examEnvironmentExamAttempt));\n@@ -1023,7 +1038,10 @@ describe('/exam-environment/', () => {\n             passingPercent: 80\n           },\n           startTime: attempt.startTime,\n-          questionSets: attempt.questionSets\n+          questionSets: attempt.questionSets,\n+          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n+          version: expect.any(Number),\n+          status: ExamAttemptStatus.Approved\n         };\n \n         expect(res.body).toEqual(serializeDates(examEnvironmentExamAttempt));\n@@ -1057,9 +1075,12 @@ describe('/exam-environment/', () => {\n       });\n \n       it('should return 200 with the attempts if they exist and belong to the user', async () => {\n+        const startTime = new Date(\n+          Date.now() - mock.exam.config.totalTimeInS * 1000\n+        );\n         const attempt =\n           await fastifyTestInstance.prisma.examEnvironmentExamAttempt.create({\n-            data: { ...mock.examAttempt, userId: defaultUserId }\n+            data: { ...mock.examAttempt, userId: defaultUserId, startTime }\n           });\n         await fastifyTestInstance.prisma.examEnvironmentExamModeration.create({\n           data: {\n@@ -1078,17 +1099,23 @@ describe('/exam-environment/', () => {\n           examId: mock.exam.id,\n           result: null,\n           startTime: attempt.startTime,\n-          questionSets: attempt.questionSets\n+          questionSets: attempt.questionSets,\n+          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n+          version: expect.any(Number),\n+          status: ExamAttemptStatus.PendingModeration\n         };\n \n         expect(res.body).toEqual([serializeDates(examEnvironmentExamAttempt)]);\n         expect(res.status).toBe(200);\n       });\n \n       it('should return the attempts without results, if they have not been moderated', async () => {\n+        const startTime = new Date(\n+          Date.now() - mock.exam.config.totalTimeInS * 1000\n+        );\n         const attempt =\n           await fastifyTestInstance.prisma.examEnvironmentExamAttempt.create({\n-            data: { ...mock.examAttempt, userId: defaultUserId }\n+            data: { ...mock.examAttempt, userId: defaultUserId, startTime }\n           });\n \n         await fastifyTestInstance.prisma.examEnvironmentExamModeration.create({\n@@ -1108,7 +1135,10 @@ describe('/exam-environment/', () => {\n           examId: mock.exam.id,\n           result: null,\n           startTime: attempt.startTime,\n-          questionSets: attempt.questionSets\n+          questionSets: attempt.questionSets,\n+          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n+          version: expect.any(Number),\n+          status: ExamAttemptStatus.PendingModeration\n         };\n \n         expect(res.body).toEqual([serializeDates(examEnvironmentExamAttempt)]);\n@@ -1145,7 +1175,10 @@ describe('/exam-environment/', () => {\n             passingPercent: 80\n           },\n           startTime: attempt.startTime,\n-          questionSets: attempt.questionSets\n+          questionSets: attempt.questionSets,\n+          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n+          version: expect.any(Number),\n+          status: ExamAttemptStatus.Approved\n         };\n \n         expect(res.body).toEqual([serializeDates(examEnvironmentExamAttempt)]);\n@@ -1197,7 +1230,8 @@ describe('/exam-environment/', () => {\n           startTime: attempt.startTime,\n           questionSets: attempt.questionSets,\n           // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n-          version: expect.any(Number)\n+          version: expect.any(Number),\n+          status: ExamAttemptStatus.InProgress\n         };\n \n         expect(res.body).toEqual([serializeDates(examEnvironmentExamAttempt)]);"
        },
        {
            "sha": "4766228616808ec3f858d85e698d72eaa0a48cb6",
            "filename": "api/src/exam-environment/schemas/exam-environment-exam-attempt.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/26ca8fee4b1ef4484773e2476aa1bb656224077f/api%2Fsrc%2Fexam-environment%2Fschemas%2Fexam-environment-exam-attempt.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/26ca8fee4b1ef4484773e2476aa1bb656224077f/api%2Fsrc%2Fexam-environment%2Fschemas%2Fexam-environment-exam-attempt.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Fschemas%2Fexam-environment-exam-attempt.ts?ref=26ca8fee4b1ef4484773e2476aa1bb656224077f",
            "patch": "@@ -48,7 +48,9 @@ const examEnvAttempt = Type.Object({\n       score: Type.Number(),\n       passingPercent: Type.Number()\n     })\n-  ])\n+  ]),\n+  version: Type.Number(),\n+  status: Type.Enum(['InProgress', 'PendingModeration', 'Approved', 'Denied'])\n });\n \n export const examEnvironmentGetExamAttempts = {\n@@ -86,9 +88,9 @@ export const examEnvironmentGetExamAttemptsByExamId = {\n     // Optional, because the handler is used in both the `/user/` base and `/exam-environment/` base.\n     // If it is missing, auth will catch.\n     'exam-environment-authorization-token': Type.Optional(Type.String())\n-  })\n-  // response: {\n-  //   200: Type.Array(examEnvAttempt),\n-  //   default: STANDARD_ERROR\n-  // }\n+  }),\n+  response: {\n+    200: Type.Array(examEnvAttempt)\n+    //   default: STANDARD_ERROR\n+  }\n };"
        },
        {
            "sha": "93f1ee52ea25efbf83b12d8162bd77fb2fb9a733",
            "filename": "api/src/exam-environment/utils/exam-environment.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 4,
            "changes": 19,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/26ca8fee4b1ef4484773e2476aa1bb656224077f/api%2Fsrc%2Fexam-environment%2Futils%2Fexam-environment.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/26ca8fee4b1ef4484773e2476aa1bb656224077f/api%2Fsrc%2Fexam-environment%2Futils%2Fexam-environment.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Futils%2Fexam-environment.ts?ref=26ca8fee4b1ef4484773e2476aa1bb656224077f",
            "patch": "@@ -768,6 +768,13 @@ export function shuffleArray<T>(array: Array<T>) {\n }\n /* eslint-enable jsdoc/require-description-complete-sentence */\n \n+export enum ExamAttemptStatus {\n+  InProgress = 'InProgress',\n+  PendingModeration = 'PendingModeration',\n+  Approved = 'Approved',\n+  Denied = 'Denied'\n+}\n+\n /**\n  * From an exam attempt, construct the attempt with result (if ready).\n  *\n@@ -827,7 +834,8 @@ export async function constructEnvExamAttempt(\n     return {\n       examEnvironmentExamAttempt: {\n         ...omitAttemptReferenceIds(attempt),\n-        result: null\n+        result: null,\n+        status: ExamAttemptStatus.InProgress\n       },\n       error: null\n     };\n@@ -875,7 +883,8 @@ export async function constructEnvExamAttempt(\n     return {\n       examEnvironmentExamAttempt: {\n         ...omitAttemptReferenceIds(attempt),\n-        result: null\n+        result: null,\n+        status: ExamAttemptStatus.PendingModeration\n       },\n       error: null\n     };\n@@ -887,7 +896,8 @@ export async function constructEnvExamAttempt(\n     return {\n       examEnvironmentExamAttempt: {\n         ...omitAttemptReferenceIds(attempt),\n-        result: null\n+        result: null,\n+        status: ExamAttemptStatus.Denied\n       },\n       error: null\n     };\n@@ -941,7 +951,8 @@ export async function constructEnvExamAttempt(\n \n   const examEnvironmentExamAttempt = {\n     ...omitAttemptReferenceIds(attempt),\n-    result\n+    result,\n+    status: ExamAttemptStatus.Approved\n   };\n   return { error: null, examEnvironmentExamAttempt };\n }"
        },
        {
            "sha": "35dabc90c3e7063640fb422d261d7ebcb523fc8d",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/26ca8fee4b1ef4484773e2476aa1bb656224077f/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/26ca8fee4b1ef4484773e2476aa1bb656224077f/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=26ca8fee4b1ef4484773e2476aa1bb656224077f",
            "patch": "@@ -388,6 +388,8 @@\n     \"pending\": \"Pending\",\n     \"passed\": \"Passed\",\n     \"failed\": \"Failed\",\n+    \"in-progress\": \"In Progress\",\n+    \"denied\": \"Retake Required\",\n     \"download-header\": \"Download the freeCodeCamp Exam Environment App\",\n     \"explanation\": \"To earn a certification, you must take an exam to test your understanding of the material you have learned. Taking the exam is absolutely free of charge.\",\n     \"version\": \"The latest version of our app is: {{version}}.\","
        },
        {
            "sha": "ff500984d030cacf43258d401bfbda635bac6d8b",
            "filename": "client/src/templates/Challenges/exam-download/attempts.tsx",
            "status": "modified",
            "additions": 29,
            "deletions": 13,
            "changes": 42,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/26ca8fee4b1ef4484773e2476aa1bb656224077f/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fattempts.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/26ca8fee4b1ef4484773e2476aa1bb656224077f/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fattempts.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fattempts.tsx?ref=26ca8fee4b1ef4484773e2476aa1bb656224077f",
            "patch": "@@ -3,7 +3,7 @@ import { Table } from '@freecodecamp/ui';\n import { useTranslation } from 'react-i18next';\n \n import { Loader } from '../../../components/helpers';\n-import { examAttempts } from '../../../utils/ajax';\n+import { Attempt, examAttempts } from '../../../utils/ajax';\n \n interface AttemptsProps {\n   examChallengeId: string;\n@@ -49,6 +49,32 @@ export function Attempts({ examChallengeId }: AttemptsProps) {\n     return <p>{t('exam.no-attempts-yet')}</p>;\n   }\n \n+  function renderScore(attempt: Attempt) {\n+    switch (attempt.status) {\n+      case 'Approved':\n+        return `${attempt.result.score.toFixed(2)}%`;\n+      case 'Denied':\n+        return t('exam.denied');\n+      case 'InProgress':\n+        return t('exam.in-progress');\n+      case 'PendingModeration':\n+        return t('exam.pending');\n+    }\n+  }\n+\n+  function renderStatus(attempt: Attempt) {\n+    switch (attempt.status) {\n+      case 'Approved':\n+        return attempt.result.passed ? t('exam.passed') : t('exam.failed');\n+      case 'Denied':\n+        return t('exam.denied');\n+      case 'InProgress':\n+        return t('exam.in-progress');\n+      case 'PendingModeration':\n+        return t('exam.pending');\n+    }\n+  }\n+\n   return (\n     <Table striped>\n       <thead>\n@@ -62,18 +88,8 @@ export function Attempts({ examChallengeId }: AttemptsProps) {\n         {attempts.map(attempt => (\n           <tr key={attempt.startTime}>\n             <td>{new Date(attempt.startTime).toTimeString()}</td>\n-            <td>\n-              {attempt.result\n-                ? `${attempt.result.score.toFixed(2)}%`\n-                : t('exam.pending')}\n-            </td>\n-            <td>\n-              {attempt.result\n-                ? attempt.result.passed\n-                  ? t('exam.passed')\n-                  : t('exam.failed')\n-                : t('exam.pending')}\n-            </td>\n+            <td>{renderScore(attempt)}</td>\n+            <td>{renderStatus(attempt)}</td>\n           </tr>\n         ))}\n       </tbody>"
        },
        {
            "sha": "a31d858f47fd7ffe95e57990aa00ecd8191be963",
            "filename": "client/src/utils/ajax.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 6,
            "changes": 20,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/26ca8fee4b1ef4484773e2476aa1bb656224077f/client%2Fsrc%2Futils%2Fajax.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/26ca8fee4b1ef4484773e2476aa1bb656224077f/client%2Fsrc%2Futils%2Fajax.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Fajax.ts?ref=26ca8fee4b1ef4484773e2476aa1bb656224077f",
            "patch": "@@ -220,17 +220,25 @@ export interface Exam {\n   };\n }\n \n-export interface Attempt {\n+export type Attempt = {\n   id: string;\n   examId: string;\n   // ISO 8601 string\n   startTime: string;\n   questionSets: unknown[];\n-  result?: {\n-    passed: boolean;\n-    score: number;\n-  };\n-}\n+} & (\n+  | {\n+      result: null;\n+      status: 'InProgress' | 'PendingModeration' | 'Denied';\n+    }\n+  | {\n+      status: 'Approved';\n+      result: {\n+        passed: boolean;\n+        score: number;\n+      };\n+    }\n+);\n \n export function getExams(): Promise<ResponseWithData<{ exams: Exam[] }>> {\n   return get('/user/exam-environment/exams');"
        }
    ],
    "stats": {
        "total": 155,
        "additions": 114,
        "deletions": 41
    }
}