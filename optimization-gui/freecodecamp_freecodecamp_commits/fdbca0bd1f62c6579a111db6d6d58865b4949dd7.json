{
    "author": "ojeytonwilliams",
    "message": "fix(api): skip cors logging for /status/* routes (#59881)\n\nCo-authored-by: Mrugesh Mohapatra <1884376+raisedadead@users.noreply.github.com>",
    "sha": "fdbca0bd1f62c6579a111db6d6d58865b4949dd7",
    "files": [
        {
            "sha": "c23ca0dd889ddc4ec74483a972de1cedfca54b08",
            "filename": "api/src/plugins/cors.test.ts",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/fdbca0bd1f62c6579a111db6d6d58865b4949dd7/api%2Fsrc%2Fplugins%2Fcors.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/fdbca0bd1f62c6579a111db6d6d58865b4949dd7/api%2Fsrc%2Fplugins%2Fcors.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fcors.test.ts?ref=fdbca0bd1f62c6579a111db6d6d58865b4949dd7",
            "patch": "@@ -0,0 +1,35 @@\n+import Fastify, { FastifyInstance, LogLevel } from 'fastify';\n+import cors from './cors';\n+\n+const LOG_LEVELS: LogLevel[] = [\n+  'fatal',\n+  'error',\n+  'warn',\n+  'info',\n+  'debug',\n+  'trace'\n+];\n+\n+describe('cors', () => {\n+  let fastify: FastifyInstance;\n+  beforeAll(async () => {\n+    fastify = Fastify({ disableRequestLogging: true });\n+    await fastify.register(cors);\n+  });\n+\n+  afterAll(async () => {\n+    await fastify.close();\n+  });\n+\n+  it('should not log for /status/* routes', async () => {\n+    const logger = fastify.log.child({ req: { url: '/status/ping' } });\n+    const spies = LOG_LEVELS.map(level => jest.spyOn(logger, level));\n+    await fastify.inject({\n+      url: '/status/ping'\n+    });\n+\n+    spies.forEach(spy => {\n+      expect(spy).not.toHaveBeenCalled();\n+    });\n+  });\n+});"
        },
        {
            "sha": "3c3bfb141fe6d24fecc765ddbe24abfcfe924057",
            "filename": "api/src/plugins/cors.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/fdbca0bd1f62c6579a111db6d6d58865b4949dd7/api%2Fsrc%2Fplugins%2Fcors.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/fdbca0bd1f62c6579a111db6d6d58865b4949dd7/api%2Fsrc%2Fplugins%2Fcors.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fcors.ts?ref=fdbca0bd1f62c6579a111db6d6d58865b4949dd7",
            "patch": "@@ -21,7 +21,10 @@ const cors: FastifyPluginCallback = (fastify, _options, done) => {\n       // separately. If we switch to that approach we can replace use\n       // @fastify/cors instead.\n       void reply.header('Access-Control-Allow-Origin', HOME_LOCATION);\n-      logger.debug(`Received request from disallowed origin: ${origin}`);\n+\n+      if (!req.url?.startsWith('/status/')) {\n+        logger.info(`Received request from disallowed origin: ${origin}`);\n+      }\n     }\n \n     void reply"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 39,
        "deletions": 1
    }
}