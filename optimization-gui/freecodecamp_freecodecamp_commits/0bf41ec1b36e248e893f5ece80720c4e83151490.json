{
    "author": "Sembauke",
    "message": "feat: improve username validation test (#54634)",
    "sha": "0bf41ec1b36e248e893f5ece80720c4e83151490",
    "files": [
        {
            "sha": "312656d5a55632dbd1376657c44ab7f875d3d343",
            "filename": "cypress/e2e/default/settings/username-change.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 140,
            "changes": 140,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f8265964f862dd7c1fad2487483cb88408cbd953/cypress%2Fe2e%2Fdefault%2Fsettings%2Fusername-change.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f8265964f862dd7c1fad2487483cb88408cbd953/cypress%2Fe2e%2Fdefault%2Fsettings%2Fusername-change.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/cypress%2Fe2e%2Fdefault%2Fsettings%2Fusername-change.ts?ref=f8265964f862dd7c1fad2487483cb88408cbd953",
            "patch": "@@ -1,140 +0,0 @@\n-describe('Username input field', () => {\n-  beforeEach(() => {\n-    cy.login();\n-    cy.goToSettings();\n-  });\n-\n-  it('Should show username is available if it is', () => {\n-    cy.typeUsername('brad');\n-\n-    cy.contains('Username is available')\n-      .should('be.visible')\n-      .should('have.attr', 'role', 'alert');\n-  });\n-\n-  it('Should info message if username is available', () => {\n-    cy.typeUsername('mrugesh');\n-\n-    cy.contains(\n-      'Please note, changing your username will also change ' +\n-        'the URL to your profile and your certifications.'\n-    )\n-      .should('be.visible')\n-      .should('have.attr', 'role', 'alert');\n-  });\n-\n-  it('Should be able to click the `Save` button if username is available', () => {\n-    cy.typeUsername('oliver');\n-\n-    cy.get('@usernameForm').within(() => {\n-      cy.contains('Save').should('have.attr', 'aria-disabled', 'false');\n-    });\n-  });\n-\n-  it('Should show username is unavailable if it is', () => {\n-    cy.typeUsername('twaha');\n-\n-    cy.contains('Username not available')\n-      .should('be.visible')\n-      .should('have.attr', 'role', 'alert');\n-  });\n-\n-  it('Should not be possible to click the `Save` button if username is unavailable', () => {\n-    cy.typeUsername('twaha');\n-\n-    cy.contains('Username is available').should('not.exist');\n-    cy.contains('Username not available').should('not.exist');\n-    cy.contains(\n-      'Please note, changing your username will also change ' +\n-        'the URL to your profile and your certifications.'\n-    ).should('not.exist');\n-\n-    cy.get('@usernameForm')\n-      .contains('Save')\n-      .should('have.attr', 'aria-disabled', 'true');\n-  });\n-\n-  it('Should not show anything if user types their current name', () => {\n-    cy.typeUsername('developmentuser');\n-\n-    cy.get('@usernameForm')\n-      .contains('Save')\n-      .should('have.attr', 'aria-disabled', 'true');\n-  });\n-\n-  it('Should not be possible to click the `Save` button if user types their current name', () => {\n-    cy.typeUsername('developmentuser');\n-\n-    cy.get('@usernameForm')\n-      .contains('Save')\n-      .should('have.attr', 'aria-disabled', 'true');\n-  });\n-\n-  it('Should not be able to click the `Save` button if username includes invalid character', () => {\n-    cy.typeUsername('Quincy Larson');\n-\n-    cy.get('@usernameForm')\n-      .contains('Save')\n-      .should('have.attr', 'aria-disabled', 'true');\n-  });\n-\n-  it('Should change username if `Save` button is clicked', () => {\n-    cy.typeUsername('quincy');\n-\n-    cy.contains('Username is available');\n-\n-    cy.get('@usernameForm').contains('Save').click({ force: true });\n-    cy.contains('Account Settings for quincy').should('be.visible');\n-\n-    cy.resetUsername();\n-  });\n-\n-  it('Should change username with uppercase characters if `Save` button is clicked', () => {\n-    cy.typeUsername('Quincy');\n-\n-    cy.contains('Username is available');\n-\n-    cy.get('@usernameForm').contains('Save').click({ force: true });\n-    cy.contains('Account Settings for Quincy').should('be.visible');\n-\n-    cy.resetUsername();\n-  });\n-\n-  it('Should show flash message showing username has been updated', () => {\n-    cy.typeUsername('nhcarrigan');\n-    cy.contains('Username is available');\n-\n-    cy.get('@usernameInput').type('{enter}', { force: true, release: false });\n-\n-    cy.contains('We have updated your username to nhcarrigan').should(\n-      'be.visible'\n-    );\n-    cy.resetUsername();\n-  });\n-\n-  it('Should be able to close the shown flash message', () => {\n-    cy.typeUsername('bjorno');\n-    cy.contains('Username is available');\n-\n-    cy.get('@usernameInput').type('{enter}', { force: true, release: false });\n-\n-    cy.contains('We have updated your username to bjorno').within(() => {\n-      cy.get('button').click();\n-    });\n-\n-    cy.contains('We have updated your username to bjorno').should('not.exist');\n-\n-    cy.resetUsername();\n-  });\n-\n-  it('Should change username if enter is pressed', () => {\n-    cy.typeUsername('symbol');\n-    cy.contains('Username is available');\n-\n-    cy.get('@usernameInput').type('{enter}', { force: true, release: false });\n-\n-    cy.contains('Account Settings for symbol').should('be.visible');\n-\n-    cy.resetUsername();\n-  });\n-});"
        },
        {
            "sha": "e20fd11db63d0931cea1a14dfa2240b44754e269",
            "filename": "e2e/settings.spec.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 46,
            "changes": 47,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0bf41ec1b36e248e893f5ece80720c4e83151490/e2e%2Fsettings.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0bf41ec1b36e248e893f5ece80720c4e83151490/e2e%2Fsettings.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fsettings.spec.ts?ref=0bf41ec1b36e248e893f5ece80720c4e83151490",
            "patch": "@@ -11,14 +11,10 @@ const settingsTestIds = {\n \n const settingsObject = {\n   email: 'foo@bar.com',\n+  userNamePlaceholder: '{{username}}',\n   certifiedUsername: 'certifieduser',\n   testEmail: 'test@gmail.com',\n   pageTitle: `${translations.buttons.settings} | freeCodeCamp.org`,\n-  userNamePlaceholder: '{{username}}',\n-  testUser: 'testuser',\n-  errorCode: '404',\n-  invalidUserName: 'user!',\n-  tooShortUserName: 'us',\n   private: 'Private',\n   public: 'Public',\n   supportEmail: 'support@freecodecamp.org',\n@@ -70,47 +66,6 @@ test.describe('Settings', () => {\n     );\n   });\n \n-  test('Should validate Username Settings', async ({ page }) => {\n-    const inputLabel = page.getByLabel(translations.settings.labels.username);\n-    await expect(inputLabel).toBeVisible();\n-    await inputLabel.fill(settingsObject.testUser);\n-    await expect(\n-      page.getByText(translations.settings.username.validating)\n-    ).toBeVisible();\n-    await inputLabel.fill(settingsObject.errorCode);\n-    await expect(\n-      page.getByText(\n-        translations.settings.username['is a reserved error code'].replace(\n-          settingsObject.userNamePlaceholder,\n-          settingsObject.errorCode\n-        )\n-      )\n-    ).toBeVisible();\n-    await inputLabel.fill(settingsObject.invalidUserName);\n-    await expect(\n-      page.getByText(\n-        translations.settings.username['contains invalid characters'].replace(\n-          settingsObject.userNamePlaceholder,\n-          settingsObject.invalidUserName\n-        )\n-      )\n-    ).toBeVisible();\n-    await inputLabel.fill(settingsObject.tooShortUserName);\n-    await expect(\n-      page.getByText(\n-        translations.settings.username['is too short'].replace(\n-          settingsObject.userNamePlaceholder,\n-          settingsObject.tooShortUserName\n-        )\n-      )\n-    ).toBeVisible();\n-    await inputLabel.fill(settingsObject.certifiedUsername);\n-    const saveButton = page.getByRole('button', {\n-      name: translations.settings.labels.username\n-    });\n-    await expect(saveButton).toBeVisible();\n-  });\n-\n   test('Should validate Privacy Settings', async ({ page }) => {\n     await expect(\n       page.getByRole('heading', {"
        },
        {
            "sha": "17b7d4b11bebae2c0229fd0c20587d406dbc21a0",
            "filename": "e2e/username-change.spec.ts",
            "status": "added",
            "additions": 173,
            "deletions": 0,
            "changes": 173,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0bf41ec1b36e248e893f5ece80720c4e83151490/e2e%2Fusername-change.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0bf41ec1b36e248e893f5ece80720c4e83151490/e2e%2Fusername-change.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fusername-change.spec.ts?ref=0bf41ec1b36e248e893f5ece80720c4e83151490",
            "patch": "@@ -0,0 +1,173 @@\n+import { test, expect } from '@playwright/test';\n+import translations from '../client/i18n/locales/english/translations.json';\n+test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+\n+const settingsObject = {\n+  usernamePlaceholder: '{{username}}',\n+  usernameUpdateToLowerCase: 'quincy',\n+  usernameUpdateToUpperCase: 'Mrugesh',\n+  usernameAvailable: 'Sem',\n+  usernameAvailablePressingEnter: 'Oliver',\n+  usernameNotAvailable: 'Twaha',\n+  usernameInvalid: 'user!',\n+  usernameTooShort: 'us',\n+  certifiedUsername: 'certifieduser',\n+  testUser: 'testuser',\n+  errorCode: '404'\n+};\n+\n+test.describe('Username Settings Validation', () => {\n+  test.beforeEach(async ({ page }) => {\n+    await page.goto('/settings');\n+  });\n+\n+  test('Should display Username Input and Save Button', async ({ page }) => {\n+    const inputLabel = page.getByLabel(translations.settings.labels.username);\n+    const saveButton = page.getByRole('button', {\n+      name: translations.settings.labels.username\n+    });\n+    await expect(inputLabel).toBeVisible();\n+    await expect(saveButton).toBeVisible();\n+  });\n+\n+  test('Should handle Reserved Username Error', async ({ page }) => {\n+    const inputLabel = page.getByLabel(translations.settings.labels.username);\n+    await inputLabel.fill(settingsObject.errorCode);\n+    await expect(\n+      page.getByText(\n+        translations.settings.username['is a reserved error code'].replace(\n+          settingsObject.usernamePlaceholder,\n+          settingsObject.errorCode\n+        )\n+      )\n+    ).toBeVisible();\n+  });\n+\n+  test('Should handle Invalid Username Error', async ({ page }) => {\n+    const inputLabel = page.getByLabel(translations.settings.labels.username);\n+    await inputLabel.fill(settingsObject.usernameInvalid);\n+    await expect(\n+      page.getByText(\n+        translations.settings.username['contains invalid characters'].replace(\n+          settingsObject.usernamePlaceholder,\n+          settingsObject.usernameInvalid\n+        )\n+      )\n+    ).toBeVisible();\n+  });\n+\n+  test('Should handle Unavailable Username Error', async ({ page }) => {\n+    const inputLabel = page.getByLabel(translations.settings.labels.username);\n+    await inputLabel.fill(settingsObject.usernameNotAvailable);\n+    await expect(\n+      page.getByText(\n+        translations.settings.username['unavailable'].replace(\n+          settingsObject.usernamePlaceholder,\n+          settingsObject.usernameNotAvailable\n+        )\n+      )\n+    ).toBeVisible();\n+  });\n+\n+  test('Should handle Too Short Username Error', async ({ page }) => {\n+    const inputLabel = page.getByLabel(translations.settings.labels.username);\n+    await inputLabel.fill(settingsObject.usernameTooShort);\n+    await expect(\n+      page.getByText(\n+        translations.settings.username['is too short'].replace(\n+          settingsObject.usernamePlaceholder,\n+          settingsObject.usernameTooShort\n+        )\n+      )\n+    ).toBeVisible();\n+  });\n+\n+  test('Should save valid Username', async ({ page }) => {\n+    const inputLabel = page.getByLabel(translations.settings.labels.username);\n+    const saveButton = page.getByRole('button', {\n+      name: translations.settings.labels.username\n+    });\n+    await inputLabel.fill(settingsObject.usernameAvailable);\n+    await expect(saveButton).not.toBeDisabled();\n+    await saveButton.click();\n+    await expect(\n+      page.getByText(\n+        translations.flash['username-updated'].replace(\n+          settingsObject.usernamePlaceholder,\n+          settingsObject.usernameAvailable\n+        )\n+      )\n+    ).toBeVisible();\n+  });\n+\n+  test('should update username in lowercase and reflect in the UI', async ({\n+    page\n+  }) => {\n+    const inputLabel = page.getByLabel(translations.settings.labels.username);\n+    const saveButton = page.getByRole('button', {\n+      name: translations.settings.labels.username\n+    });\n+    await inputLabel.fill(settingsObject.usernameUpdateToLowerCase);\n+    await expect(saveButton).not.toBeDisabled();\n+    await saveButton.click();\n+    await expect(\n+      page.getByText(\n+        translations.flash['username-updated'].replace(\n+          settingsObject.usernamePlaceholder,\n+          settingsObject.usernameUpdateToLowerCase\n+        )\n+      )\n+    ).toBeVisible();\n+  });\n+\n+  test('should update username in uppercase and reflect in the UI', async ({\n+    page\n+  }) => {\n+    const inputLabel = page.getByLabel(translations.settings.labels.username);\n+    const saveButton = page.getByRole('button', {\n+      name: translations.settings.labels.username\n+    });\n+    await inputLabel.fill(settingsObject.usernameUpdateToUpperCase);\n+    await expect(saveButton).not.toBeDisabled();\n+    await saveButton.click();\n+    await expect(\n+      page.getByText(\n+        translations.flash['username-updated'].replace(\n+          settingsObject.usernamePlaceholder,\n+          settingsObject.usernameUpdateToUpperCase\n+        )\n+      )\n+    ).toBeVisible();\n+  });\n+\n+  test('should update username by pressing enter', async ({ page }) => {\n+    const inputLabel = page.getByLabel(translations.settings.labels.username);\n+    await inputLabel.fill(settingsObject.testUser);\n+\n+    await expect(\n+      page.getByText(translations.settings.username.available)\n+    ).toBeVisible();\n+\n+    await inputLabel.press('Enter');\n+\n+    await expect(\n+      page.getByText(\n+        translations.flash['username-updated'].replace(\n+          settingsObject.usernamePlaceholder,\n+          settingsObject.testUser\n+        )\n+      )\n+    ).toBeVisible();\n+  });\n+\n+  test('should not be able to update username to the same username', async ({\n+    page\n+  }) => {\n+    const inputLabel = page.getByLabel(translations.settings.labels.username);\n+    const saveButton = page.getByRole('button', {\n+      name: translations.settings.labels.username\n+    });\n+    await inputLabel.fill(settingsObject.testUser);\n+    await expect(saveButton).toBeDisabled();\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 360,
        "additions": 174,
        "deletions": 186
    }
}