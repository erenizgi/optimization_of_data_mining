{
    "author": "huyenltnguyen",
    "message": "fix(client): allow transcript expanded state to not persist (#62492)",
    "sha": "e8f8b044cd9d8e6671d82859f23e31cda3364440",
    "files": [
        {
            "sha": "644e998dec2d388fb6cb3e1a2335a39f637bb3ed",
            "filename": "client/src/templates/Challenges/components/challenge-transcript.test.tsx",
            "status": "modified",
            "additions": 23,
            "deletions": 6,
            "changes": 29,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e8f8b044cd9d8e6671d82859f23e31cda3364440/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fchallenge-transcript.test.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e8f8b044cd9d8e6671d82859f23e31cda3364440/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fchallenge-transcript.test.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fchallenge-transcript.test.tsx?ref=e8f8b044cd9d8e6671d82859f23e31cda3364440",
            "patch": "@@ -1,15 +1,16 @@\n import React from 'react';\n-import { render, screen } from '@testing-library/react';\n+import { render, screen, fireEvent } from '@testing-library/react';\n import store from 'store';\n-import { describe, it, expect, beforeEach } from 'vitest';\n+import { describe, it, expect, vi, afterEach } from 'vitest';\n import ChallengeTranscript from './challenge-transcript';\n \n const baseProps = {\n-  transcript: 'Sample transcript text'\n+  transcript: 'Sample transcript text',\n+  shouldPersistExpanded: false\n };\n \n describe('<ChallengeTranscript />', () => {\n-  beforeEach(() => {\n+  afterEach(() => {\n     store.clearAll();\n   });\n \n@@ -35,10 +36,26 @@ describe('<ChallengeTranscript />', () => {\n     expect(screen.getByText('Sample transcript text')).not.toBeVisible();\n   });\n \n-  it(\"renders expanded when 'fcc-transcript-expanded = true'\", () => {\n+  it(\"renders expanded when 'fcc-transcript-expanded = true' and shouldPersistExpanded = true\", () => {\n     store.set('fcc-transcript-expanded', true);\n-    render(<ChallengeTranscript {...baseProps} />);\n+    render(<ChallengeTranscript {...baseProps} shouldPersistExpanded={true} />);\n     expect(screen.getByTestId('challenge-transcript')).toHaveAttribute('open');\n     expect(screen.getByText('Sample transcript text')).toBeVisible();\n   });\n+\n+  it('writes to localstorage when shouldPersistExpanded = true', () => {\n+    const setSpy = vi.spyOn(store, 'set');\n+    render(<ChallengeTranscript {...baseProps} shouldPersistExpanded={true} />);\n+    fireEvent.click(screen.getByText('learn.transcript'));\n+    expect(setSpy).toHaveBeenCalledWith('fcc-transcript-expanded', true);\n+    setSpy.mockRestore();\n+  });\n+\n+  it('does not write to localstorage when shouldPersistExpanded = false', () => {\n+    const setSpy = vi.spyOn(store, 'set');\n+    render(<ChallengeTranscript {...baseProps} />);\n+    fireEvent.click(screen.getByText('learn.transcript'));\n+    expect(setSpy).not.toHaveBeenCalled();\n+    setSpy.mockRestore();\n+  });\n });"
        },
        {
            "sha": "0ee53c12550b5c104104a2e31cde95a13c46362a",
            "filename": "client/src/templates/Challenges/components/challenge-transcript.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e8f8b044cd9d8e6671d82859f23e31cda3364440/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fchallenge-transcript.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e8f8b044cd9d8e6671d82859f23e31cda3364440/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fchallenge-transcript.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fchallenge-transcript.tsx?ref=e8f8b044cd9d8e6671d82859f23e31cda3364440",
            "patch": "@@ -7,21 +7,27 @@ import './challenge-transcript.css';\n \n interface ChallengeTranscriptProps {\n   transcript: string;\n+  shouldPersistExpanded?: boolean;\n }\n \n function ChallengeTranscript({\n-  transcript\n+  transcript,\n+  shouldPersistExpanded\n }: ChallengeTranscriptProps): JSX.Element {\n   const { t } = useTranslation();\n \n   // default to collapsed\n-  const [isOpen, setIsOpen] = useState(\n-    () => (store.get('fcc-transcript-expanded') as boolean | null) ?? false\n+  const [isOpen, setIsOpen] = useState(() =>\n+    shouldPersistExpanded\n+      ? (store.get('fcc-transcript-expanded') as boolean | null) ?? false\n+      : false\n   );\n \n   function toggleExpandedState(e: React.MouseEvent<HTMLDetailsElement>) {\n     e.preventDefault();\n-    store.set('fcc-transcript-expanded', !isOpen);\n+    if (shouldPersistExpanded) {\n+      store.set('fcc-transcript-expanded', !isOpen);\n+    }\n     setIsOpen(!isOpen);\n   }\n "
        }
    ],
    "stats": {
        "total": 43,
        "additions": 33,
        "deletions": 10
    }
}