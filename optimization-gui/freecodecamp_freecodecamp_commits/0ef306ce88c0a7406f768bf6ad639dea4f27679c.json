{
    "author": "ojeytonwilliams",
    "message": "refactor(client): simplify transformation pipeline functions (#57402)",
    "sha": "0ef306ce88c0a7406f768bf6ad639dea4f27679c",
    "files": [
        {
            "sha": "5192ca0a3927235f20f893562d040cefac8aca10",
            "filename": "client/src/templates/Challenges/rechallenge/transformers.js",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0ef306ce88c0a7406f768bf6ad639dea4f27679c/client%2Fsrc%2Ftemplates%2FChallenges%2Frechallenge%2Ftransformers.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0ef306ce88c0a7406f768bf6ad639dea4f27679c/client%2Fsrc%2Ftemplates%2FChallenges%2Frechallenge%2Ftransformers.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Frechallenge%2Ftransformers.js?ref=0ef306ce88c0a7406f768bf6ad639dea4f27679c",
            "patch": "@@ -239,7 +239,8 @@ export const embedFilesInHtml = async function (challengeFiles) {\n   const { indexHtml, stylesCss, scriptJs, indexJsx, indexTs } =\n     challengeFilesToObject(challengeFiles);\n \n-  const embedStylesAndScript = (documentElement, contentDocument) => {\n+  const embedStylesAndScript = contentDocument => {\n+    const documentElement = contentDocument.documentElement;\n     const link =\n       documentElement.querySelector('link[href=\"styles.css\"]') ??\n       documentElement.querySelector('link[href=\"./styles.css\"]');\n@@ -294,13 +295,13 @@ export const embedFilesInHtml = async function (challengeFiles) {\n       embedStylesAndScript,\n       indexHtml.contents\n     );\n-    return [challengeFiles, contents];\n+    return contents;\n   } else if (indexJsx) {\n-    return [challengeFiles, `<script>${indexJsx.contents}</script>`];\n+    return `<script>${indexJsx.contents}</script>`;\n   } else if (scriptJs) {\n-    return [challengeFiles, `<script>${scriptJs.contents}</script>`];\n+    return `<script>${scriptJs.contents}</script>`;\n   } else if (indexTs) {\n-    return [challengeFiles, `<script>${indexTs.contents}</script>`];\n+    return `<script>${indexTs.contents}</script>`;\n   } else {\n     throw Error('No html, ts or js(x) file found');\n   }\n@@ -319,12 +320,13 @@ const parseAndTransform = async function (transform, contents) {\n   const parser = new DOMParser();\n   const newDoc = parser.parseFromString(contents, 'text/html');\n \n-  return await transform(newDoc.documentElement, newDoc);\n+  return await transform(newDoc);\n };\n \n const getHtmlTranspiler = scriptOptions =>\n   async function (file) {\n-    const transform = async documentElement => {\n+    const transform = async contentDocument => {\n+      const documentElement = contentDocument.documentElement;\n       await Promise.all([\n         transformSASS(documentElement),\n         transformScript(documentElement, scriptOptions)"
        },
        {
            "sha": "432d18fe7a87cd30c0b8590563989326f58faf5a",
            "filename": "client/src/templates/Challenges/utils/build.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0ef306ce88c0a7406f768bf6ad639dea4f27679c/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fbuild.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0ef306ce88c0a7406f768bf6ad639dea4f27679c/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fbuild.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fbuild.ts?ref=0ef306ce88c0a7406f768bf6ad639dea4f27679c",
            "patch": "@@ -243,10 +243,7 @@ export async function buildDOMChallenge(\n   const usesTestRunner = options?.usesTestRunner ?? false;\n   const finalFiles = await Promise.all(challengeFiles.map(pipeLine));\n   const error = finalFiles.find(({ error }) => error)?.error;\n-  const [embeddedFiles, contents] = (await embedFilesInHtml(finalFiles)) as [\n-    ChallengeFile[],\n-    string\n-  ];\n+  const contents = (await embedFilesInHtml(finalFiles)) as string;\n \n   // if there is an error, we just build the test runner so that it can be\n   // used to run tests against the code without actually running the code.\n@@ -264,7 +261,7 @@ export async function buildDOMChallenge(\n     // necessary at the moment.\n     challengeType: challengeTypes.html,\n     build: concatHtml(toBuild),\n-    sources: buildSourceMap(embeddedFiles),\n+    sources: buildSourceMap(finalFiles),\n     loadEnzyme: hasJsx,\n     error\n   };"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 11,
        "deletions": 12
    }
}