{
    "author": "raisedadead",
    "message": "fix(api): update logging in routes -- email-subscription",
    "sha": "35c0d8234c22b9995a4334fb53eed41cdc946385",
    "files": [
        {
            "sha": "461cb00a12f3a2208f2851fd094443fc35c6e010",
            "filename": "api/src/routes/public/email-subscription.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/35c0d8234c22b9995a4334fb53eed41cdc946385/api%2Fsrc%2Froutes%2Fpublic%2Femail-subscription.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/35c0d8234c22b9995a4334fb53eed41cdc946385/api%2Fsrc%2Froutes%2Fpublic%2Femail-subscription.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fpublic%2Femail-subscription.ts?ref=35c0d8234c22b9995a4334fb53eed41cdc946385",
            "patch": "@@ -35,11 +35,15 @@ export const emailSubscribtionRoutes: FastifyPluginCallbackTypebox = (\n       try {\n         const { origin } = getRedirectParams(req);\n         const { unsubscribeId } = req.params;\n+        const log = fastify.log.child({ req, unsubscribeId });\n+        log.debug('Processing unsubscribe request');\n+\n         const unsubUsers = await fastify.prisma.user.findMany({\n           where: { unsubscribeId }\n         });\n \n         if (!unsubUsers.length) {\n+          log.warn('No users found for unsubscribe request');\n           void reply.code(302);\n           return reply.redirectWithMessage(origin, {\n             type: 'info',\n@@ -57,6 +61,7 @@ export const emailSubscribtionRoutes: FastifyPluginCallbackTypebox = (\n         );\n \n         await Promise.all(userUpdatePromises);\n+        log.info('Successfully unsubscribed users from email');\n \n         return reply.redirectWithMessage(\n           `${origin}/unsubscribed/${unsubscribeId}`,\n@@ -66,12 +71,12 @@ export const emailSubscribtionRoutes: FastifyPluginCallbackTypebox = (\n           }\n         );\n       } catch (error) {\n-        fastify.log.error(error);\n+        fastify.log.error(error, 'Failed to unsubscribe user from email');\n         fastify.Sentry.captureException(error);\n         void reply.code(302);\n         return reply.redirectWithMessage(origin, {\n           type: 'danger',\n-          content: 'Something went wrong.'\n+          content: `Failed to unsubscribe user, please contact support at support@freecodecamp.org`\n         });\n       }\n     }\n@@ -99,11 +104,15 @@ export const emailSubscribtionRoutes: FastifyPluginCallbackTypebox = (\n       try {\n         const { origin } = getRedirectParams(req);\n         const { unsubscribeId } = req.params;\n+        const log = fastify.log.child({ req, unsubscribeId });\n+        log.debug('Processing resubscribe request');\n+\n         const user = await fastify.prisma.user.findFirst({\n           where: { unsubscribeId }\n         });\n \n         if (!user) {\n+          log.warn('No user found for resubscribe request');\n           void reply.code(302);\n           return reply.redirectWithMessage(origin, {\n             type: 'info',\n@@ -117,14 +126,15 @@ export const emailSubscribtionRoutes: FastifyPluginCallbackTypebox = (\n             sendQuincyEmail: true\n           }\n         });\n+        log.info('Successfully resubscribed user to email');\n \n         return reply.redirectWithMessage(origin, {\n           type: 'success',\n           content:\n             \"We've successfully updated your email preferences. Thank you for resubscribing.\"\n         });\n       } catch (error) {\n-        fastify.log.error(error);\n+        fastify.log.error(error, 'Failed to resubscribe user to email');\n         fastify.Sentry.captureException(error);\n         void reply.code(302);\n         return reply.redirectWithMessage(origin, {"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 13,
        "deletions": 3
    }
}