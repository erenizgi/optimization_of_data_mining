{
    "author": "ShaunSHamilton",
    "message": "fix(client): put token widget behind email check (#63910)",
    "sha": "0367c2ddb152f5ede1575cbc1d92134c35de2957",
    "files": [
        {
            "sha": "efa4820ca4348a59aaa1d4fc2dac8cee5588581a",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0367c2ddb152f5ede1575cbc1d92134c35de2957/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0367c2ddb152f5ede1575cbc1d92134c35de2957/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=0367c2ddb152f5ede1575cbc1d92134c35de2957",
            "patch": "@@ -1314,7 +1314,8 @@\n     \"copied\": \"Token copied to clipboard\",\n     \"copy-error\": \"Error copying token to clipboard\",\n     \"token-usage\": \"Your Exam Environment authorization token is used to log you into the desktop application.\",\n-    \"generated\": \"A new Exam Environment authorization token has been generated for your account.\"\n+    \"generated\": \"A new Exam Environment authorization token has been generated for your account.\",\n+    \"non-staff-testing\": \"Only freeCodeCamp staff are allowed to generate exam tokens on non-production environments at this time.\"\n   },\n   \"shortcuts\": {\n     \"title\": \"Keyboard shortcuts\","
        },
        {
            "sha": "ac563c692b73e69c8498b48a4c3e3d33e110c433",
            "filename": "client/src/client-only-routes/show-settings.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0367c2ddb152f5ede1575cbc1d92134c35de2957/client%2Fsrc%2Fclient-only-routes%2Fshow-settings.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0367c2ddb152f5ede1575cbc1d92134c35de2957/client%2Fsrc%2Fclient-only-routes%2Fshow-settings.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fclient-only-routes%2Fshow-settings.tsx?ref=0367c2ddb152f5ede1575cbc1d92134c35de2957",
            "patch": "@@ -6,7 +6,6 @@ import { createSelector } from 'reselect';\n import { scroller } from 'react-scroll';\n \n import { Container, Spacer } from '@freecodecamp/ui';\n-import { useFeatureIsOn } from '@growthbook/growthbook-react';\n \n import store from 'store';\n import envData from '../../config/env.json';\n@@ -108,8 +107,6 @@ export function ShowSettings(props: ShowSettingsProps): JSX.Element {\n \n   const isSignedInRef = useRef(isSignedIn);\n \n-  const examTokenFlag = useFeatureIsOn('exam-token-widget');\n-\n   const handleHashChange = () => {\n     const id = window.location.hash.replace('#', '');\n     if (id) {\n@@ -205,7 +202,7 @@ export function ShowSettings(props: ShowSettingsProps): JSX.Element {\n           <Spacer size='m' />\n           <Honesty isHonest={isHonest} updateIsHonest={updateIsHonest} />\n           <Spacer size='m' />\n-          {examTokenFlag && <ExamToken />}\n+          <ExamToken email={email} />\n           <Certification\n             completedChallenges={completedChallenges}\n             createFlashMessage={createFlashMessage}"
        },
        {
            "sha": "a9cfee7ae7bcd31a68038b26b02ccaecbab00578",
            "filename": "client/src/components/settings/exam-token.tsx",
            "status": "modified",
            "additions": 13,
            "deletions": 2,
            "changes": 15,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0367c2ddb152f5ede1575cbc1d92134c35de2957/client%2Fsrc%2Fcomponents%2Fsettings%2Fexam-token.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0367c2ddb152f5ede1575cbc1d92134c35de2957/client%2Fsrc%2Fcomponents%2Fsettings%2Fexam-token.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fsettings%2Fexam-token.tsx?ref=0367c2ddb152f5ede1575cbc1d92134c35de2957",
            "patch": "@@ -3,8 +3,15 @@ import { Button, Panel, Modal, Spacer } from '@freecodecamp/ui';\n import { useTranslation } from 'react-i18next';\n import { FullWidthRow } from '../helpers';\n import { generateExamToken } from '../../utils/ajax';\n+import envData from '../../../config/env.json';\n \n-function ExamToken(): JSX.Element {\n+const { deploymentEnv } = envData;\n+\n+interface ExamTokenProps {\n+  email: string;\n+}\n+\n+function ExamToken({ email }: ExamTokenProps) {\n   const [examToken, setExamToken] = useState<string | null>(null);\n   const [examTokenError, setExamTokenError] = useState<string | null>(null);\n \n@@ -32,6 +39,9 @@ function ExamToken(): JSX.Element {\n     setTimeout(() => setRecentlyGenerated(false), 10000);\n   };\n \n+  const nonStaffTesting =\n+    deploymentEnv !== 'production' && !email.endsWith('@freecodecamp.org');\n+\n   return (\n     <FullWidthRow>\n       <Modal\n@@ -90,9 +100,10 @@ function ExamToken(): JSX.Element {\n           <p>{t('exam-token.note')}</p>\n           <strong>{t('exam-token.invalidation-2')}</strong>\n           <Spacer size='s' />\n+          {nonStaffTesting && <p>{t('exam-token.non-staff-testing')}</p>}\n           <Button\n             block={true}\n-            disabled={recentlyGenerated}\n+            disabled={recentlyGenerated || nonStaffTesting}\n             onClick={() => void getToken()}\n           >\n             {t('exam-token.generate-exam-token')}"
        },
        {
            "sha": "a28bdf29bcf5603548d8cc6ebb7378cffefe76ec",
            "filename": "client/src/templates/Challenges/exam-download/exam-token-controls.tsx",
            "status": "modified",
            "additions": 19,
            "deletions": 2,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0367c2ddb152f5ede1575cbc1d92134c35de2957/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fexam-token-controls.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0367c2ddb152f5ede1575cbc1d92134c35de2957/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fexam-token-controls.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fexam-token-controls.tsx?ref=0367c2ddb152f5ede1575cbc1d92134c35de2957",
            "patch": "@@ -4,8 +4,17 @@ import { Button, Spacer } from '@freecodecamp/ui';\n \n import { examEnvironmentAuthorizationTokenApi } from '../../../utils/ajax';\n import { Loader } from '../../../components/helpers';\n+import envData from '../../../../config/env.json';\n \n-export function ExamTokenControls(): JSX.Element {\n+const { deploymentEnv } = envData;\n+\n+interface ExamTokenControlsProps {\n+  email: string;\n+}\n+\n+export function ExamTokenControls({\n+  email\n+}: ExamTokenControlsProps): JSX.Element {\n   const { t } = useTranslation();\n \n   const [copySuccess, setCopySuccess] = useState<string | null>(null);\n@@ -33,6 +42,9 @@ export function ExamTokenControls(): JSX.Element {\n     );\n   }\n \n+  const nonStaffTesting =\n+    deploymentEnv !== 'production' && !email.endsWith('@freecodecamp.org');\n+\n   return (\n     <>\n       <h3>{t('exam-token.exam-token')}</h3>\n@@ -60,14 +72,19 @@ export function ExamTokenControls(): JSX.Element {\n           {t('exam-token.no-token')}\n         </p>\n       )}\n+      {nonStaffTesting && <p>{t('exam-token.non-staff-testing')}</p>}\n       {generateMutation.isLoading || getTokenQuery.isLoading ? (\n         <Button block={true}>\n           <Loader />\n         </Button>\n       ) : (\n         <Button\n           block={true}\n-          disabled={generateMutation.isLoading || getTokenQuery.isLoading}\n+          disabled={\n+            generateMutation.isLoading ||\n+            getTokenQuery.isLoading ||\n+            nonStaffTesting\n+          }\n           onClick={() => void generateToken()}\n         >\n           {t('exam-token.generate-exam-token')}"
        },
        {
            "sha": "50fc9d64797ae79e8469cccde4be11524fb801db",
            "filename": "client/src/templates/Challenges/exam-download/show.tsx",
            "status": "modified",
            "additions": 16,
            "deletions": 6,
            "changes": 22,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0367c2ddb152f5ede1575cbc1d92134c35de2957/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0367c2ddb152f5ede1575cbc1d92134c35de2957/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fshow.tsx?ref=0367c2ddb152f5ede1575cbc1d92134c35de2957",
            "patch": "@@ -19,10 +19,15 @@ import { connect } from 'react-redux';\n import LearnLayout from '../../../components/layouts/learn';\n import ChallengeTitle from '../components/challenge-title';\n import useDetectOS from '../utils/use-detect-os';\n-import { ChallengeNode, CompletedChallenge } from '../../../redux/prop-types';\n+import {\n+  ChallengeNode,\n+  CompletedChallenge,\n+  User\n+} from '../../../redux/prop-types';\n import {\n   completedChallengesSelector,\n-  isSignedInSelector\n+  isSignedInSelector,\n+  userSelector\n } from '../../../redux/selectors';\n import { examAttempts } from '../../../utils/ajax';\n import MissingPrerequisites from '../exam/components/missing-prerequisites';\n@@ -43,14 +48,17 @@ const mapStateToProps = createSelector(\n   completedChallengesSelector,\n   isChallengeCompletedSelector,\n   isSignedInSelector,\n+  userSelector,\n   (\n     completedChallenges: CompletedChallenge[],\n     isChallengeCompleted: boolean,\n-    isSignedIn: boolean\n+    isSignedIn: boolean,\n+    user: User | null\n   ) => ({\n     completedChallenges,\n     isChallengeCompleted,\n-    isSignedIn\n+    isSignedIn,\n+    user\n   })\n );\n \n@@ -62,6 +70,7 @@ interface ShowExamDownloadProps {\n   completedChallenges: CompletedChallenge[];\n   isChallengeCompleted: boolean;\n   isSignedIn: boolean;\n+  user: User | null;\n }\n \n function ShowExamDownload({\n@@ -73,7 +82,8 @@ function ShowExamDownload({\n   },\n   completedChallenges,\n   isChallengeCompleted,\n-  isSignedIn\n+  isSignedIn,\n+  user\n }: ShowExamDownloadProps): JSX.Element {\n   const [latestVersion, setLatestVersion] = useState<string | null>(null);\n \n@@ -217,7 +227,7 @@ function ShowExamDownload({\n                 <h2>{t('exam.attempts')}</h2>\n                 <Attempts examChallengeId={id} />\n                 <Spacer size='l' />\n-                <ExamTokenControls />\n+                <ExamTokenControls email={user!.email} />\n               </>\n             )}\n             <p>"
        }
    ],
    "stats": {
        "total": 66,
        "additions": 51,
        "deletions": 15
    }
}