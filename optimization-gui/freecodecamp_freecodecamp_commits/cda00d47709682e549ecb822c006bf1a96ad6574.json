{
    "author": "ojeytonwilliams",
    "message": "feat(client): save challenge layout in local storage (again) (#55621)",
    "sha": "cda00d47709682e549ecb822c006bf1a96ad6574",
    "files": [
        {
            "sha": "00d299d2b7a135447129bf33ce98080955056ed1",
            "filename": "client/src/templates/Challenges/classic/desktop-layout.tsx",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/cda00d47709682e549ecb822c006bf1a96ad6574/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fdesktop-layout.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/cda00d47709682e549ecb822c006bf1a96ad6574/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fdesktop-layout.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fdesktop-layout.tsx?ref=cda00d47709682e549ecb822c006bf1a96ad6574",
            "patch": "@@ -215,6 +215,7 @@ const DesktopLayout = (props: DesktopLayoutProps): JSX.Element => {\n           <ReflexElement\n             flex={instructionPane.flex}\n             {...resizeProps}\n+            name='instructionPane'\n             data-playwright-test-label='instruction-pane'\n           >\n             {instructions}\n@@ -226,6 +227,7 @@ const DesktopLayout = (props: DesktopLayoutProps): JSX.Element => {\n \n         <ReflexElement\n           flex={editorPane.flex}\n+          name='editorPane'\n           {...resizeProps}\n           data-playwright-test-label='editor-pane'\n         >\n@@ -236,6 +238,7 @@ const DesktopLayout = (props: DesktopLayoutProps): JSX.Element => {\n             >\n               <ReflexElement\n                 flex={codePane.flex}\n+                name='codePane'\n                 {...reflexProps}\n                 {...resizeProps}\n               >\n@@ -258,17 +261,26 @@ const DesktopLayout = (props: DesktopLayoutProps): JSX.Element => {\n         </ReflexElement>\n         {displayNotes && <ReflexSplitter propagate={true} {...resizeProps} />}\n         {displayNotes && (\n-          <ReflexElement flex={notesPane.flex} {...resizeProps}>\n+          <ReflexElement\n+            name='notesPane'\n+            flex={notesPane.flex}\n+            {...resizeProps}\n+          >\n             <Notes notes={notes} />\n           </ReflexElement>\n         )}\n \n         {(displayPreviewPane || displayPreviewConsole) && (\n-          <ReflexSplitter propagate={true} {...resizeProps} />\n+          <ReflexSplitter\n+            data-playwright-test-label='preview-left-splitter'\n+            propagate={true}\n+            {...resizeProps}\n+          />\n         )}\n         {(displayPreviewPane || displayPreviewConsole) && (\n           <ReflexElement\n             flex={previewPane.flex}\n+            name='previewPane'\n             {...resizeProps}\n             data-playwright-test-label='preview-pane'\n           >\n@@ -279,6 +291,7 @@ const DesktopLayout = (props: DesktopLayoutProps): JSX.Element => {\n               )}\n               {displayPreviewConsole && (\n                 <ReflexElement\n+                  name='testsPane'\n                   {...(displayPreviewPane && { flex: testsPane.flex })}\n                   {...resizeProps}\n                 >"
        },
        {
            "sha": "bd3032d5414d89c088d63e20ca37c5201ea28659",
            "filename": "client/src/templates/Challenges/classic/show.tsx",
            "status": "modified",
            "additions": 15,
            "deletions": 25,
            "changes": 40,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/cda00d47709682e549ecb822c006bf1a96ad6574/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/cda00d47709682e549ecb822c006bf1a96ad6574/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fshow.tsx?ref=cda00d47709682e549ecb822c006bf1a96ad6574",
            "patch": "@@ -244,18 +244,16 @@ function ShowClassic({\n     challengeTypes.python\n   ].includes(challengeType);\n   const getLayoutState = () => {\n-    const reflexLayout = store.get(REFLEX_LAYOUT) as ReflexLayout;\n-\n-    // Validate if user has not done any resize of the panes\n-    if (!reflexLayout) return BASE_LAYOUT;\n+    const reflexLayout = store.get(REFLEX_LAYOUT) as ReflexLayout | null;\n \n     // Check that the layout values stored are valid (exist in base layout). If\n     // not valid, it will fallback to the base layout values and be set on next\n     // user resize.\n-    const isValidLayout = isContained(\n-      Object.keys(BASE_LAYOUT),\n-      Object.keys(reflexLayout)\n-    );\n+    const isValidLayout =\n+      reflexLayout &&\n+      isContained(Object.keys(BASE_LAYOUT), Object.keys(reflexLayout));\n+\n+    if (!isValidLayout) store.remove(REFLEX_LAYOUT);\n \n     return isValidLayout ? reflexLayout : BASE_LAYOUT;\n   };\n@@ -266,25 +264,17 @@ function ShowClassic({\n   const [layout, setLayout] = useState(getLayoutState());\n \n   const onStopResize = (event: HandlerProps) => {\n-    const { name, flex } = event.component.props;\n-\n-    // Only interested in tracking layout updates for ReflexElement's\n-    if (!name) {\n-      setResizing(false);\n-      return;\n-    }\n-\n-    // Forcing a state update with the value of each panel since on stop resize\n-    // is executed per each panel.\n-    if (typeof layout === 'object') {\n-      setLayout({\n-        ...layout,\n-        [name]: { flex }\n-      });\n-    }\n     setResizing(false);\n+    // 'name' is used to identify the Elements whose layout is stored.\n+    const { name, flex } = event.component.props;\n \n-    store.set(REFLEX_LAYOUT, layout);\n+    // onStopResize can be called multiple times before the state changes, so\n+    // we need an updater function to ensure all updates are applied.\n+    setLayout(l => {\n+      const newLayout = name ? { ...l, [name]: { flex } } : l;\n+      store.set(REFLEX_LAYOUT, newLayout);\n+      return newLayout;\n+    });\n   };\n \n   const setHtmlHeight = () => {"
        },
        {
            "sha": "bb1745490cd0b8cfb1f9b4890eaedc2fdba0596d",
            "filename": "e2e/multifile-editor.spec.ts",
            "status": "modified",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/cda00d47709682e549ecb822c006bf1a96ad6574/e2e%2Fmultifile-editor.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/cda00d47709682e549ecb822c006bf1a96ad6574/e2e%2Fmultifile-editor.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fmultifile-editor.spec.ts?ref=cda00d47709682e549ecb822c006bf1a96ad6574",
            "patch": "@@ -42,4 +42,34 @@ test.describe('MultifileEditor Component', () => {\n       index++;\n     }\n   });\n+\n+  test('Reloading should preserve the editor layout', async ({\n+    page,\n+    isMobile\n+  }) => {\n+    test.skip(\n+      isMobile,\n+      'The mobile layout does not have resizable panes, so this test is not applicable.'\n+    );\n+\n+    const desktopLayout = page.getByTestId('desktop-layout');\n+    const splitter = desktopLayout.getByTestId('preview-left-splitter');\n+    const editorPane = desktopLayout.getByTestId('editor-pane');\n+    const initialStyle = await editorPane.getAttribute('style');\n+    expect(initialStyle).toContain('flex: 1');\n+\n+    // Drag the splitter to resize the editor pane\n+    await splitter.hover();\n+    await page.mouse.down();\n+    await page.mouse.move(100, 100);\n+    await page.mouse.up();\n+\n+    const newStyle = await editorPane.getAttribute('style');\n+    // It doesn't matter where it's dragged to, just that it's different:\n+    expect(newStyle).not.toContain('flex: 1');\n+\n+    await page.reload();\n+\n+    expect(await editorPane.getAttribute('style')).toBe(newStyle);\n+  });\n });"
        }
    ],
    "stats": {
        "total": 87,
        "additions": 60,
        "deletions": 27
    }
}