{
    "author": "ojeytonwilliams",
    "message": "feat: allow filtering by block and challengeId (#63640)",
    "sha": "4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465",
    "files": [
        {
            "sha": "40c24d3c77c831fc3dc62e89c8044ae823eb4a81",
            "filename": "client/gatsby-node.js",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465/client%2Fgatsby-node.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465/client%2Fgatsby-node.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fgatsby-node.js?ref=4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465",
            "patch": "@@ -341,6 +341,7 @@ exports.createSchemaCustomization = ({ actions }) => {\n       superOrder: Int\n       template: String\n       tests: [Test]\n+      fields: ChallengeFields\n       title: String\n       transcript: String\n       translationPending: Boolean\n@@ -467,7 +468,11 @@ exports.createSchemaCustomization = ({ actions }) => {\n       beforeAll: String\n       afterAll: String\n     }\n-\n+    type ChallengeFields {\n+      slug: String\n+      blockName: String\n+      tests: [Test]\n+    }\n     type Nodule {\n       type: String\n       data: JSON"
        },
        {
            "sha": "7c152458b4e8630a2a003dd941ccf33f03b87948",
            "filename": "curriculum/src/build-curriculum.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465/curriculum%2Fsrc%2Fbuild-curriculum.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465/curriculum%2Fsrc%2Fbuild-curriculum.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fsrc%2Fbuild-curriculum.ts?ref=4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465",
            "patch": "@@ -334,19 +334,17 @@ export async function parseCurriculumStructure(filter?: Filter) {\n }\n \n export async function buildCurriculum(lang: string, filters?: Filter) {\n+  // Block validation assumes the entire block is being built, if that's not the\n+  // case, skip validation\n+  const skipBlockValidation = filters?.challengeId !== undefined;\n   const contentDir = getContentDir(lang);\n-  const fccSuperblock = process.env.FCC_SUPERBLOCK;\n-\n-  const combinedFilters: Filter | undefined = fccSuperblock\n-    ? { ...filters, superBlock: fccSuperblock }\n-    : filters;\n \n   const builder = new SuperblockCreator(\n-    getBlockCreator(lang, !isEmpty(combinedFilters))\n+    getBlockCreator(lang, skipBlockValidation)\n   );\n \n   const { fullSuperblockList, certifications } =\n-    await parseCurriculumStructure(combinedFilters);\n+    await parseCurriculumStructure(filters);\n \n   const fullCurriculum: {\n     [key: string]: unknown;"
        },
        {
            "sha": "48f48efd8ec1f90aa614391d3a67a02c36bc6574",
            "filename": "curriculum/src/config.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 5,
            "changes": 15,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465/curriculum%2Fsrc%2Fconfig.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465/curriculum%2Fsrc%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fsrc%2Fconfig.ts?ref=4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465",
            "patch": "@@ -28,10 +28,15 @@ export const FCC_CHALLENGE_ID = process.env.FCC_CHALLENGE_ID\n   ? process.env.FCC_CHALLENGE_ID.trim()\n   : undefined;\n \n+const FCC_BLOCK = process.env.FCC_BLOCK\n+  ? process.env.FCC_BLOCK.trim()\n+  : undefined;\n+const FCC_SUPERBLOCK = process.env.FCC_SUPERBLOCK\n+  ? process.env.FCC_SUPERBLOCK.trim()\n+  : undefined;\n+\n export const curriculumFilter = {\n-  block: process.env.FCC_BLOCK ? process.env.FCC_BLOCK.trim() : undefined,\n-  challengeId: FCC_CHALLENGE_ID,\n-  superBlock: process.env.FCC_SUPERBLOCK\n-    ? process.env.FCC_SUPERBLOCK.trim()\n-    : undefined\n+  ...(FCC_CHALLENGE_ID && { challengeId: FCC_CHALLENGE_ID }),\n+  ...(FCC_BLOCK && { block: FCC_BLOCK }),\n+  ...(FCC_SUPERBLOCK && { superBlock: FCC_SUPERBLOCK })\n };"
        },
        {
            "sha": "48acdf74cefda24b69249c16abcd6e76631e29ac",
            "filename": "curriculum/src/get-challenges.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465/curriculum%2Fsrc%2Fget-challenges.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465/curriculum%2Fsrc%2Fget-challenges.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fsrc%2Fget-challenges.ts?ref=4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465",
            "patch": "@@ -4,18 +4,16 @@ import { promisify } from 'util';\n \n import { availableLangs } from '../../shared-dist/config/i18n.js';\n import { buildCurriculum } from './build-curriculum.js';\n+import { curriculumFilter } from './config.js';\n+import type { Filter } from './filter.js';\n \n const { curriculum: curriculumLangs } = availableLangs;\n \n const access = promisify(_access);\n \n export async function getChallengesForLang(\n   lang: string,\n-  filters?: {\n-    superBlock?: string;\n-    block?: string;\n-    challengeId?: string;\n-  }\n+  filters: Filter = curriculumFilter // default to global curriculum filter, but allow override (e.g. when testing specific blocks)\n ) {\n   const invalidLang = !curriculumLangs.includes(lang);\n   if (invalidLang)"
        },
        {
            "sha": "72a2fa2218f2e90abddca5131860017f5253ef30",
            "filename": "tools/scripts/build/build-curriculum.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465/tools%2Fscripts%2Fbuild%2Fbuild-curriculum.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465/tools%2Fscripts%2Fbuild%2Fbuild-curriculum.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscripts%2Fbuild%2Fbuild-curriculum.ts?ref=4ec96c1a0cec3e3e59a37f26ca6b47cf3ef5d465",
            "patch": "@@ -15,7 +15,10 @@ import {\n \n const globalConfigPath = path.resolve(__dirname, '../../../shared-dist/config');\n \n-const isSelectiveBuild = !!process.env.FCC_SUPERBLOCK;\n+const isSelectiveBuild =\n+  process.env.FCC_SUPERBLOCK ||\n+  process.env.FCC_BLOCK ||\n+  process.env.FCC_CHALLENGE_ID;\n \n void getChallengesForLang('english')\n   .then(result => {"
        }
    ],
    "stats": {
        "total": 47,
        "additions": 28,
        "deletions": 19
    }
}