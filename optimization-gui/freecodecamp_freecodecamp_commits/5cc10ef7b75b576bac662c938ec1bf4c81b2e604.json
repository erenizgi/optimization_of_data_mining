{
    "author": "ojeytonwilliams",
    "message": "fix(client): only use contents from savedChallenges (#55364)",
    "sha": "5cc10ef7b75b576bac662c938ec1bf4c81b2e604",
    "files": [
        {
            "sha": "d7b3a256247666af9b4effd3bc0a30364fdcc51e",
            "filename": "client/src/redux/prop-types.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5cc10ef7b75b576bac662c938ec1bf4c81b2e604/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5cc10ef7b75b576bac662c938ec1bf4c81b2e604/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fprop-types.ts?ref=5cc10ef7b75b576bac662c938ec1bf4c81b2e604",
            "patch": "@@ -357,6 +357,8 @@ export type SavedChallenge = {\n   challengeFiles: SavedChallengeFiles;\n };\n \n+// TODO: remove unused properties and stop returning them from api? (e.g.\n+// history, ext, name)\n export type SavedChallengeFile = {\n   fileKey: string;\n   ext: Ext;"
        },
        {
            "sha": "96ec5bb2fceea35e4e7c10e1587f6eef708db76e",
            "filename": "client/src/templates/Challenges/classic/saved-challenges.test.ts",
            "status": "added",
            "additions": 132,
            "deletions": 0,
            "changes": 132,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5cc10ef7b75b576bac662c938ec1bf4c81b2e604/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fsaved-challenges.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5cc10ef7b75b576bac662c938ec1bf4c81b2e604/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fsaved-challenges.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fsaved-challenges.test.ts?ref=5cc10ef7b75b576bac662c938ec1bf4c81b2e604",
            "patch": "@@ -0,0 +1,132 @@\n+import type {\n+  ChallengeFile,\n+  SavedChallengeFile\n+} from '../../../redux/prop-types';\n+import { mergeChallengeFiles } from './saved-challenges';\n+\n+const jsChallenge = {\n+  id: '1',\n+  contents: 'js contents',\n+  fileKey: 'jsFileKey',\n+  name: 'name',\n+  ext: 'js' as const,\n+  head: 'head',\n+  tail: 'tail',\n+  history: [],\n+  seed: 'original js contents'\n+};\n+\n+const cssChallenge = {\n+  id: '2',\n+  contents: 'css contents',\n+  fileKey: 'cssFileKey',\n+  name: 'name',\n+  ext: 'css' as const,\n+  head: 'head',\n+  tail: 'tail',\n+  history: [],\n+  seed: 'original css contents'\n+};\n+\n+const htmlChallenge = {\n+  id: '3',\n+  contents: 'html contents',\n+  fileKey: 'htmlFileKey',\n+  name: 'name',\n+  ext: 'html' as const,\n+  head: 'head',\n+  tail: 'tail',\n+  history: [],\n+  seed: 'original html contents'\n+};\n+\n+const savedJsChallenge: SavedChallengeFile = {\n+  contents: 'saved js contents',\n+  fileKey: 'jsFileKey',\n+  name: 'name',\n+  ext: 'js' as const\n+};\n+\n+const savedCssChallenge: SavedChallengeFile = {\n+  contents: 'saved css contents',\n+  fileKey: 'cssFileKey',\n+  name: 'name',\n+  ext: 'css' as const\n+};\n+\n+const savedHtmlChallenge: SavedChallengeFile = {\n+  contents: 'saved html contents',\n+  fileKey: 'htmlFileKey',\n+  name: 'name',\n+  ext: 'html' as const\n+};\n+\n+describe('mergeChallengeFiles', () => {\n+  it('should return files if savedChallengeFiles is undefined', () => {\n+    const files: ChallengeFile[] = [htmlChallenge];\n+    const savedChallengeFiles = undefined;\n+\n+    const result = mergeChallengeFiles(files, savedChallengeFiles);\n+\n+    expect(result).toEqual(files);\n+  });\n+\n+  it('should return an empty array if files is undefined', () => {\n+    const files = undefined;\n+    const savedChallengeFiles = [savedJsChallenge];\n+\n+    const result = mergeChallengeFiles(files, savedChallengeFiles);\n+\n+    expect(result).toEqual([]);\n+  });\n+\n+  it('should return files if savedChallengeFiles has a different length', () => {\n+    const files: ChallengeFile[] = [cssChallenge];\n+    const savedChallengeFiles: SavedChallengeFile[] = [\n+      savedCssChallenge,\n+      savedJsChallenge\n+    ];\n+\n+    const result = mergeChallengeFiles(files, savedChallengeFiles);\n+\n+    expect(result).toEqual(files);\n+  });\n+\n+  it('should return files if the fileKey properties do not match', () => {\n+    const files: ChallengeFile[] = [jsChallenge, cssChallenge];\n+    const savedChallengeFiles: SavedChallengeFile[] = [\n+      savedHtmlChallenge,\n+      savedCssChallenge\n+    ];\n+\n+    const result = mergeChallengeFiles(files, savedChallengeFiles);\n+\n+    expect(result).toEqual(files);\n+  });\n+\n+  it('should use the contents from the saved file', () => {\n+    const files: ChallengeFile[] = [cssChallenge, htmlChallenge, jsChallenge];\n+    const savedChallengeFiles = [\n+      savedJsChallenge,\n+      savedCssChallenge,\n+      savedHtmlChallenge\n+    ];\n+\n+    const result = mergeChallengeFiles(files, savedChallengeFiles);\n+\n+    expect(result).toEqual([\n+      {\n+        ...cssChallenge,\n+        contents: savedCssChallenge.contents\n+      },\n+      {\n+        ...htmlChallenge,\n+        contents: savedHtmlChallenge.contents\n+      },\n+      {\n+        ...jsChallenge,\n+        contents: savedJsChallenge.contents\n+      }\n+    ]);\n+  });\n+});"
        },
        {
            "sha": "ed8c03d3f543e1b71096a5b78ca92f612e7922a6",
            "filename": "client/src/templates/Challenges/classic/saved-challenges.ts",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5cc10ef7b75b576bac662c938ec1bf4c81b2e604/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fsaved-challenges.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5cc10ef7b75b576bac662c938ec1bf4c81b2e604/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fsaved-challenges.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fsaved-challenges.ts?ref=5cc10ef7b75b576bac662c938ec1bf4c81b2e604",
            "patch": "@@ -0,0 +1,28 @@\n+import { ChallengeFile, SavedChallengeFile } from '../../../redux/prop-types';\n+\n+export function mergeChallengeFiles(\n+  files?: ChallengeFile[] | null,\n+  savedFiles?: SavedChallengeFile[] | null\n+): ChallengeFile[] {\n+  if (!files) return [];\n+  if (!savedFiles) return files;\n+  if (files.length !== savedFiles.length) return files;\n+\n+  const sortedChallengeFiles = files.sort((a, b) =>\n+    a.fileKey.localeCompare(b.fileKey)\n+  );\n+  const sortedSavedChallengeFiles = savedFiles.sort((a, b) =>\n+    a.fileKey.localeCompare(b.fileKey)\n+  );\n+\n+  const fileKeysMatch = sortedChallengeFiles.every(\n+    (file, index) => file.fileKey === sortedSavedChallengeFiles[index].fileKey\n+  );\n+\n+  if (!fileKeysMatch) return files;\n+\n+  return sortedChallengeFiles.map((file, index) => ({\n+    ...file,\n+    contents: sortedSavedChallengeFiles[index].contents\n+  }));\n+}"
        },
        {
            "sha": "7466e82a2beea09451466761206ce75fe120ac8d",
            "filename": "client/src/templates/Challenges/classic/show.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5cc10ef7b75b576bac662c938ec1bf4c81b2e604/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5cc10ef7b75b576bac662c938ec1bf4c81b2e604/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fshow.tsx?ref=5cc10ef7b75b576bac662c938ec1bf4c81b2e604",
            "patch": "@@ -62,6 +62,7 @@ import { XtermTerminal } from './xterm';\n import MultifileEditor from './multifile-editor';\n import DesktopLayout from './desktop-layout';\n import MobileLayout from './mobile-layout';\n+import { mergeChallengeFiles } from './saved-challenges';\n \n import './classic.css';\n import '../components/test-frame.css';\n@@ -351,7 +352,9 @@ function ShowClassic({\n       return challenge.id === challengeMeta.id;\n     });\n \n-    createFiles(savedChallenge?.challengeFiles || challengeFiles || []);\n+    createFiles(\n+      mergeChallengeFiles(challengeFiles, savedChallenge?.challengeFiles)\n+    );\n \n     initTests(tests);\n     if (showProjectPreview) openModal('projectPreview');"
        }
    ],
    "stats": {
        "total": 167,
        "additions": 166,
        "deletions": 1
    }
}