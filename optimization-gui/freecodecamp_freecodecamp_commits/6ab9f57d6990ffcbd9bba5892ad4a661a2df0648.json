{
    "author": "ojeytonwilliams",
    "message": "feat(api): deprecate /api endpoints (#59657)",
    "sha": "6ab9f57d6990ffcbd9bba5892ad4a661a2df0648",
    "files": [
        {
            "sha": "56e67ab78ad9f7f92f6e13f2092e945872bc66e1",
            "filename": "api-server/src/common/models/user.js",
            "status": "modified",
            "additions": 0,
            "deletions": 24,
            "changes": 24,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6ab9f57d6990ffcbd9bba5892ad4a661a2df0648/api-server%2Fsrc%2Fcommon%2Fmodels%2Fuser.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6ab9f57d6990ffcbd9bba5892ad4a661a2df0648/api-server%2Fsrc%2Fcommon%2Fmodels%2Fuser.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fcommon%2Fmodels%2Fuser.js?ref=6ab9f57d6990ffcbd9bba5892ad4a661a2df0648",
            "patch": "@@ -381,30 +381,6 @@ export default function initializeUser(User) {\n     return User.count(where).then(count => count > 0);\n   };\n \n-  User.remoteMethod('doesExist', {\n-    description: 'checks whether a user exists using email or username',\n-    accepts: [\n-      {\n-        arg: 'username',\n-        type: 'string'\n-      },\n-      {\n-        arg: 'email',\n-        type: 'string'\n-      }\n-    ],\n-    returns: [\n-      {\n-        arg: 'exists',\n-        type: 'boolean'\n-      }\n-    ],\n-    http: {\n-      path: '/exists',\n-      verb: 'get'\n-    }\n-  });\n-\n   User.about = function about(username, cb) {\n     if (!username) {\n       // Zalgo!!"
        },
        {
            "sha": "4d238796304baf25e89cc1aabdf8ca09c95984bd",
            "filename": "api-server/src/server/boot/randomAPIs.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6ab9f57d6990ffcbd9bba5892ad4a661a2df0648/api-server%2Fsrc%2Fserver%2Fboot%2FrandomAPIs.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6ab9f57d6990ffcbd9bba5892ad4a661a2df0648/api-server%2Fsrc%2Fserver%2Fboot%2FrandomAPIs.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api-server%2Fsrc%2Fserver%2Fboot%2FrandomAPIs.js?ref=6ab9f57d6990ffcbd9bba5892ad4a661a2df0648",
            "patch": "@@ -16,7 +16,6 @@ module.exports = function (app) {\n   router.get('/unsubscribe/:email', unsubscribeDeprecated);\n   router.get('/ue/:unsubscribeId', unsubscribeById);\n   router.get('/resubscribe/:unsubscribeId', resubscribe);\n-  router.get('/api/users/get-public-profile', blockUserAgent, getPublicProfile);\n   router.get('/users/get-public-profile', blockUserAgent, getPublicProfile);\n   const getUserExists = createGetUserExists(app);\n   router.get('/users/exists', getUserExists);"
        },
        {
            "sha": "872110cf417d00eb2aee16a8b0b98c10bc00a9f2",
            "filename": "api/src/routes/public/user.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 146,
            "changes": 146,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6ab9f57d6990ffcbd9bba5892ad4a661a2df0648/api%2Fsrc%2Froutes%2Fpublic%2Fuser.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6ab9f57d6990ffcbd9bba5892ad4a661a2df0648/api%2Fsrc%2Froutes%2Fpublic%2Fuser.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fpublic%2Fuser.ts?ref=6ab9f57d6990ffcbd9bba5892ad4a661a2df0648",
            "patch": "@@ -100,118 +100,6 @@ export const userPublicGetRoutes: FastifyPluginCallbackTypebox = (\n   _options,\n   done\n ) => {\n-  fastify.get(\n-    '/api/users/get-public-profile',\n-    {\n-      schema: schemas.getPublicProfile,\n-      onRequest: (req, reply, done) => {\n-        const userAgent = req.headers['user-agent'];\n-\n-        if (\n-          userAgent &&\n-          blockedUserAgentParts.some(ua => userAgent.toLowerCase().includes(ua))\n-        ) {\n-          void reply.code(400);\n-          void reply.send(\n-            'This endpoint is no longer available outside of the freeCodeCamp ecosystem'\n-          );\n-        }\n-        done();\n-      }\n-    },\n-    async (req, reply) => {\n-      const logger = fastify.log.child({ req });\n-      logger.info({ username: req.query.username });\n-      // TODO(Post-MVP): look for duplicates unless we can make username unique in the db.\n-      const user = await fastify.prisma.user.findFirst({\n-        where: { username: req.query.username }\n-        // TODO: only select desired fields, then stop 'omit'ing the undesired\n-        // ones.\n-      });\n-\n-      if (!user) {\n-        logger.warn('User not found');\n-        void reply.code(404);\n-        return reply.send({});\n-      }\n-\n-      const [flags, rest] = splitUser(user);\n-\n-      const publicUser = _.omit(rest, [\n-        'currentChallengeId',\n-        'email',\n-        'emailVerified',\n-        'sendQuincyEmail',\n-        'theme',\n-        // keyboardShortcuts is included in flags.\n-        // 'keyboardShortcuts',\n-        'acceptedPrivacyTerms',\n-        'progressTimestamps',\n-        'unsubscribeId',\n-        'donationEmails',\n-        'externalId',\n-        'usernameDisplay',\n-        'isBanned'\n-      ]);\n-\n-      const normalizedProfileUI = normalizeProfileUI(user.profileUI);\n-\n-      void reply.code(200);\n-      if (normalizedProfileUI.isLocked) {\n-        // TODO(Post-MVP): just return isLocked: true and either a null user\n-        // or no user at all. (see other TODO in the else branch below)\n-        return reply.send({\n-          entities: {\n-            user: {\n-              [user.username]: {\n-                isLocked: true,\n-                profileUI: normalizedProfileUI,\n-                username: user.username\n-              }\n-            }\n-          },\n-          result: user.username\n-        });\n-      } else {\n-        const progressTimestamps = user.progressTimestamps as\n-          | ProgressTimestamp[]\n-          | null;\n-        const sharedUser = replacePrivateData({\n-          ...user,\n-          calendar: getCalendar(progressTimestamps),\n-          completedChallenges: normalizeChallenges(user.completedChallenges),\n-          location: user.location ?? '',\n-          joinDate: new ObjectId(user.id).getTimestamp().toISOString(),\n-          name: user.name ?? '',\n-          points: getPoints(progressTimestamps),\n-          profileUI: normalizedProfileUI\n-        });\n-\n-        const returnedUser = {\n-          ...removeNulls(publicUser),\n-          ...normalizeFlags(flags),\n-          ...sharedUser,\n-          profileUI: normalizedProfileUI,\n-          // TODO: should this always be returned? Shouldn't some privacy\n-          // setting control it? Same applies to website, githubProfile,\n-          // and linkedin.\n-          twitter: normalizeTwitter(user.twitter),\n-          yearsTopContributor: user.yearsTopContributor\n-        };\n-        return reply.send({\n-          // TODO(Post-MVP): just return a user object (i.e. returnedUser) and\n-          // isLocked: false. The there should be no need for Type.Union in the\n-          // schema. Alternatively, have the user object be nullable and don't\n-          // bother with isLocked.\n-          entities: {\n-            user: { [user.username]: returnedUser }\n-          },\n-          result: user.username\n-        });\n-      }\n-    }\n-  );\n-\n   fastify.get(\n     '/users/get-public-profile',\n     {\n@@ -324,40 +212,6 @@ export const userPublicGetRoutes: FastifyPluginCallbackTypebox = (\n     }\n   );\n \n-  fastify.get(\n-    '/api/users/exists',\n-    {\n-      schema: schemas.userExists,\n-      attachValidation: true\n-    },\n-    async (req, reply) => {\n-      const logger = fastify.log.child({ req });\n-\n-      if (req.validationError) {\n-        logger.warn({ validationError: req.validationError });\n-        void reply.code(400);\n-        return await reply.send({\n-          type: 'danger',\n-          message: 'username parameter is required'\n-        });\n-      }\n-\n-      const username = req.query.username.toLowerCase();\n-\n-      if (isRestricted(username)) {\n-        logger.info({ username }, 'Restricted username');\n-        return await reply.send({ exists: true });\n-      }\n-\n-      const exists =\n-        (await fastify.prisma.user.count({\n-          where: { username }\n-        })) > 0;\n-\n-      await reply.send({ exists });\n-    }\n-  );\n-\n   fastify.get(\n     '/users/exists',\n     {"
        }
    ],
    "stats": {
        "total": 171,
        "additions": 0,
        "deletions": 171
    }
}