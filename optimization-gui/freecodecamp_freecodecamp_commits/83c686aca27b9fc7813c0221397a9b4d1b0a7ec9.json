{
    "author": "raisedadead",
    "message": "fix(GHA): branch detection and conditional run (#59635)",
    "sha": "83c686aca27b9fc7813c0221397a9b4d1b0a7ec9",
    "files": [
        {
            "sha": "b30ef938c57b4290fb53929b1d2b29694a1f7ee2",
            "filename": ".github/workflows/deploy-legacy.yml",
            "status": "modified",
            "additions": 16,
            "deletions": 3,
            "changes": 19,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/83c686aca27b9fc7813c0221397a9b4d1b0a7ec9/.github%2Fworkflows%2Fdeploy-legacy.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/83c686aca27b9fc7813c0221397a9b4d1b0a7ec9/.github%2Fworkflows%2Fdeploy-legacy.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fdeploy-legacy.yml?ref=83c686aca27b9fc7813c0221397a9b4d1b0a7ec9",
            "patch": "@@ -11,7 +11,6 @@ on:\n \n jobs:\n   setup-jobs:\n-    if: ${{ github.event.workflow_run.conclusion == 'success' }}\n     name: Setup Jobs\n     runs-on: ubuntu-22.04\n     outputs:\n@@ -23,8 +22,22 @@ jobs:\n       - name: Setup\n         id: setup\n         run: |\n-          case \"${{ github.ref }}\" in\n-            \"refs/heads/prod-current\")\n+          if [[ \"${{ github.event_name }}\" == \"workflow_run\" ]]; then\n+            BRANCH=\"${{ github.event.workflow_run.head_branch }}\"\n+          else\n+            BRANCH=\"${{ github.ref_name }}\"\n+          fi\n+\n+          if [[ \"${{ github.event.workflow_run.conclusion }}\" != \"success\" ]]; then\n+            echo \"Node.js test run failed. Check logs in its workflow run. Exiting.\"\n+            exit 1\n+          fi\n+\n+          echo \"Node.js test run succeeded. Continuing...\"\n+          echo \"Current branch: $BRANCH\"\n+\n+          case \"$BRANCH\" in\n+            \"prod-current\")\n               echo \"site_tld=org\" >> $GITHUB_OUTPUT\n               echo \"tgt_env_short=prd\" >> $GITHUB_OUTPUT\n               echo \"tgt_env_long=production\" >> $GITHUB_OUTPUT"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 16,
        "deletions": 3
    }
}