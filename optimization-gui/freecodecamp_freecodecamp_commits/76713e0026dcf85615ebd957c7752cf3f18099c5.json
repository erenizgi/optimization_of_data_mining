{
    "author": "ojeytonwilliams",
    "message": "feat(client): add worker messaging module (#56136)",
    "sha": "76713e0026dcf85615ebd957c7752cf3f18099c5",
    "files": [
        {
            "sha": "551af4942d29c79086493e68c3a35663bd15b955",
            "filename": "client/src/templates/Challenges/utils/worker-messenger.ts",
            "status": "added",
            "additions": 52,
            "deletions": 0,
            "changes": 52,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/76713e0026dcf85615ebd957c7752cf3f18099c5/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fworker-messenger.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/76713e0026dcf85615ebd957c7752cf3f18099c5/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fworker-messenger.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fworker-messenger.ts?ref=76713e0026dcf85615ebd957c7752cf3f18099c5",
            "patch": "@@ -0,0 +1,52 @@\n+/**\n+ * Sends a message to a web worker and awaits a response.\n+ *\n+ * @template MessageOut - The type of the message being sent to the worker.\n+ * @template MessageIn - The type of the message expected from the worker. Must include a `type` and `value` property.\n+ * @template Value - The type of the value expected in the response message.\n+ *\n+ * @param {Object} params - The parameters for the function.\n+ * @param {Worker} params.worker - The web worker to send the message to.\n+ * @param {MessageOut} params.message - The message to send to the worker.\n+ * @param {Function} params.onMessage - A callback function to handle the response from the worker.\n+ * @param {MessageIn} params.onMessage.response - The response message from the worker.\n+ * @param {Function} params.onMessage.resolve - A function to resolve the promise with the response value.\n+ * @param {Function} params.onMessage.reject - A function to reject the promise with an error message.\n+ *\n+ * @returns {Promise<Value>} A promise that resolves with the response value from the worker or rejects with an error message.\n+ */\n+export function awaitResponse<\n+  MessageOut,\n+  MessageIn extends { type: string; value: Value },\n+  Value\n+>({\n+  worker,\n+  message,\n+  onMessage\n+}: {\n+  worker: Worker;\n+  message: MessageOut;\n+  onMessage: (\n+    response: MessageIn,\n+    resolve: (res: Value) => void,\n+    reject: (err: string) => void\n+  ) => void;\n+}): Promise<Value> {\n+  return new Promise((resolve, reject) => {\n+    const channel = new MessageChannel();\n+    // TODO: Figure out how to ensure the worker is ready and/or handle when it\n+    // is not.\n+    const id = setTimeout(() => {\n+      channel.port1.close();\n+      reject(Error('No response from worker'));\n+    }, 5000);\n+\n+    channel.port1.onmessage = (event: MessageEvent<MessageIn>) => {\n+      clearTimeout(id);\n+      channel.port1.close();\n+      onMessage(event.data, resolve, reject);\n+    };\n+\n+    worker.postMessage(message, [channel.port2]);\n+  });\n+}"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 52,
        "deletions": 0
    }
}