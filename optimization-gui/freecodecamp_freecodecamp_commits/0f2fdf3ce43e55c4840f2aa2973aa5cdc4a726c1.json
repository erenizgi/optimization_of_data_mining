{
    "author": "Sembauke",
    "message": "refactor(profile): convert AboutSettings from class to functional component (#58568)",
    "sha": "0f2fdf3ce43e55c4840f2aa2973aa5cdc4a726c1",
    "files": [
        {
            "sha": "953219f683e3bb36caca8c786845e76909d07bc6",
            "filename": "client/src/components/profile/components/about.tsx",
            "status": "modified",
            "additions": 148,
            "deletions": 188,
            "changes": 336,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0f2fdf3ce43e55c4840f2aa2973aa5cdc4a726c1/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fabout.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0f2fdf3ce43e55c4840f2aa2973aa5cdc4a726c1/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fabout.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fabout.tsx?ref=0f2fdf3ce43e55c4840f2aa2973aa5cdc4a726c1",
            "patch": "@@ -1,4 +1,4 @@\n-import React, { Component } from 'react';\n+import React, { useEffect, useState } from 'react';\n import {\n   FormGroup,\n   FormControl,\n@@ -32,13 +32,6 @@ type AboutProps = Omit<\n \n type FormValues = Pick<AboutProps, 'name' | 'location' | 'picture' | 'about'>;\n \n-type AboutState = {\n-  formValues: FormValues;\n-  originalValues: FormValues;\n-  formClicked: boolean;\n-  isPictureUrlValid: boolean;\n-};\n-\n const ShowImageValidationWarning = ({\n   alertContent\n }: {\n@@ -51,227 +44,194 @@ const ShowImageValidationWarning = ({\n   );\n };\n \n-class AboutSettings extends Component<AboutProps, AboutState> {\n-  validationImage: HTMLImageElement;\n-  static displayName: string;\n-  constructor(props: AboutProps) {\n-    super(props);\n-    this.validationImage = new Image();\n-    const { name = '', location = '', picture = '', about = '' } = props;\n-    const values = {\n-      name,\n-      location,\n-      picture,\n-      about\n-    };\n-    this.state = {\n-      formValues: { ...values },\n-      originalValues: { ...values },\n-      formClicked: false,\n-      isPictureUrlValid: true\n-    };\n-  }\n-\n-  toggleEditing = () => {\n-    this.props.setIsEditing(false);\n+const AboutSettings = ({\n+  t,\n+  name = '',\n+  location = '',\n+  picture = '',\n+  about = '',\n+  submitNewAbout,\n+  setIsEditing\n+}: AboutProps) => {\n+  const [formValues, setFormValues] = useState<FormValues>({\n+    name,\n+    location,\n+    picture,\n+    about\n+  });\n+  const [originalValues, setOriginalValues] = useState<FormValues>({\n+    name,\n+    location,\n+    picture,\n+    about\n+  });\n+  const [formClicked, setFormClicked] = useState(false);\n+  const [isPictureUrlValid, setIsPictureUrlValid] = useState(true);\n+\n+  const checkIfValidImage = (url: string) => {\n+    const img = new Image();\n+\n+    return new Promise(resolve => {\n+      img.onerror = () => resolve(false);\n+      img.onload = () => resolve(true);\n+      img.src = url;\n+    });\n   };\n \n-  componentDidUpdate() {\n-    const { name, location, picture, about } = this.props;\n-    const { formValues, formClicked } = this.state;\n+  useEffect(() => {\n     if (\n       formClicked &&\n       name === formValues.name &&\n       location === formValues.location &&\n       picture === formValues.picture &&\n       about === formValues.about\n     ) {\n-      return this.setState({\n-        originalValues: {\n-          name,\n-          location,\n-          picture,\n-          about\n-        },\n-        formClicked: false\n+      setOriginalValues({\n+        name,\n+        location,\n+        picture,\n+        about\n       });\n+      setFormClicked(false);\n     }\n-    return null;\n-  }\n+  }, [formClicked, name, location, picture, about, formValues]);\n \n-  isFormPristine = () => {\n-    const { formValues, originalValues } = this.state;\n+  const isFormPristine = () => {\n     return (\n-      this.state.isPictureUrlValid === false ||\n+      isPictureUrlValid === false ||\n       (Object.keys(originalValues) as Array<keyof FormValues>)\n         .map(key => originalValues[key] === formValues[key])\n         .every(bool => bool)\n     );\n   };\n \n-  handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n+  const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n     e.preventDefault();\n-    const { formValues } = this.state;\n-    const { submitNewAbout } = this.props;\n-    if (this.state.isPictureUrlValid === true && !this.isFormPristine()) {\n-      this.toggleEditing();\n-      return this.setState({ formClicked: true }, () =>\n-        submitNewAbout(formValues)\n-      );\n+    if (isPictureUrlValid === true && !isFormPristine()) {\n+      setIsEditing(false);\n+      setFormClicked(true);\n+      submitNewAbout(formValues);\n     } else {\n-      this.toggleEditing();\n-      return false;\n+      setIsEditing(false);\n     }\n   };\n \n-  handleNameChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n-    const value = (e.target as HTMLInputElement).value.slice(0);\n-    return this.setState(state => ({\n-      formValues: {\n-        ...state.formValues,\n-        name: value\n-      }\n+  const handleNameChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n+    const value = e.target.value.slice(0);\n+    setFormValues(state => ({\n+      ...state,\n+      name: value\n     }));\n   };\n \n-  handleLocationChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n-    const value = (e.target as HTMLInputElement).value.slice(0);\n-    return this.setState(state => ({\n-      formValues: {\n-        ...state.formValues,\n-        location: value\n-      }\n+  const handleLocationChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n+    const value = e.target.value.slice(0);\n+    setFormValues(state => ({\n+      ...state,\n+      location: value\n     }));\n   };\n \n-  componentDidMount() {\n-    this.validationImage.addEventListener('error', this.errorEvent);\n-    this.validationImage.addEventListener('load', this.loadEvent);\n-  }\n-\n-  componentWillUnmount() {\n-    this.validationImage.removeEventListener('load', this.loadEvent);\n-    this.validationImage.removeEventListener('error', this.errorEvent);\n-  }\n-\n-  loadEvent = () => this.setState({ isPictureUrlValid: true });\n-  errorEvent = () =>\n-    this.setState(state => ({\n-      isPictureUrlValid: state.formValues.picture === ''\n-    }));\n-\n-  handlePictureChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n-    const value = (e.target as HTMLInputElement).value.slice(0);\n+  const handlePictureChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n+    const value = e.target.value.slice(0);\n     if (!value) {\n-      this.setState({\n-        isPictureUrlValid: true\n-      });\n+      setIsPictureUrlValid(true);\n     } else if (isURL(value, { require_protocol: true })) {\n-      this.validationImage.src = encodeURI(value);\n-    } else {\n-      this.setState({\n-        isPictureUrlValid: false\n+      void checkIfValidImage(value).then(isValid => {\n+        setIsPictureUrlValid(isValid as boolean);\n       });\n+    } else {\n+      setIsPictureUrlValid(false);\n     }\n-    this.setState(state => ({\n-      formValues: {\n-        ...state.formValues,\n-        picture: value\n-      }\n+    setFormValues(state => ({\n+      ...state,\n+      picture: value\n     }));\n   };\n \n-  handleAboutChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n-    const value = (e.target as HTMLInputElement).value.slice(0);\n-    return this.setState(state => ({\n-      formValues: {\n-        ...state.formValues,\n-        about: value\n-      }\n+  const handleAboutChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n+    const value = e.target.value.slice(0);\n+    setFormValues(state => ({\n+      ...state,\n+      about: value\n     }));\n   };\n \n-  render() {\n-    const {\n-      formValues: { name, location, picture, about }\n-    } = this.state;\n-    const { t } = this.props;\n-    return (\n-      <>\n-        <SectionHeader>{t('settings.headings.personal-info')}</SectionHeader>\n-        <FullWidthRow>\n-          <form\n-            id='camper-identity'\n-            onSubmit={this.handleSubmit}\n-            data-playwright-test-label='camper-identity'\n-          >\n-            <div role='group' aria-label={t('settings.headings.personal-info')}>\n-              <FormGroup controlId='about-name'>\n-                <ControlLabel htmlFor='about-name-input'>\n-                  <strong>{t('settings.labels.name')}</strong>\n-                </ControlLabel>\n-                <FormControl\n-                  onChange={this.handleNameChange}\n-                  type='text'\n-                  value={name}\n-                  id='about-name-input'\n-                />\n-              </FormGroup>\n-              <FormGroup controlId='about-location'>\n-                <ControlLabel htmlFor='about-location-input'>\n-                  <strong>{t('settings.labels.location')}</strong>\n-                </ControlLabel>\n-                <FormControl\n-                  onChange={this.handleLocationChange}\n-                  type='text'\n-                  value={location}\n-                  id='about-location-input'\n-                />\n-              </FormGroup>\n-              <FormGroup controlId='about-picture'>\n-                <ControlLabel htmlFor='about-picture-input'>\n-                  <strong>{t('settings.labels.picture')}</strong>\n-                </ControlLabel>\n-                <FormControl\n-                  onChange={this.handlePictureChange}\n-                  type='url'\n-                  value={picture}\n-                  id='about-picture-input'\n-                />\n-                {!this.state.isPictureUrlValid && (\n-                  <ShowImageValidationWarning\n-                    alertContent={t('validation.url-not-image')}\n-                  />\n-                )}\n-              </FormGroup>\n-              <FormGroup controlId='about-about'>\n-                <ControlLabel htmlFor='about-about-input'>\n-                  <strong>{t('settings.labels.about')}</strong>\n-                </ControlLabel>\n-                <FormControl\n-                  componentClass='textarea'\n-                  onChange={this.handleAboutChange}\n-                  value={about}\n-                  id='about-about-input'\n+  return (\n+    <>\n+      <SectionHeader>{t('settings.headings.personal-info')}</SectionHeader>\n+      <FullWidthRow>\n+        <form\n+          id='camper-identity'\n+          onSubmit={handleSubmit}\n+          data-playwright-test-label='camper-identity'\n+        >\n+          <div role='group' aria-label={t('settings.headings.personal-info')}>\n+            <FormGroup controlId='about-name'>\n+              <ControlLabel htmlFor='about-name-input'>\n+                <strong>{t('settings.labels.name')}</strong>\n+              </ControlLabel>\n+              <FormControl\n+                onChange={handleNameChange}\n+                type='text'\n+                value={formValues.name}\n+                id='about-name-input'\n+              />\n+            </FormGroup>\n+            <FormGroup controlId='about-location'>\n+              <ControlLabel htmlFor='about-location-input'>\n+                <strong>{t('settings.labels.location')}</strong>\n+              </ControlLabel>\n+              <FormControl\n+                onChange={handleLocationChange}\n+                type='text'\n+                value={formValues.location}\n+                id='about-location-input'\n+              />\n+            </FormGroup>\n+            <FormGroup controlId='about-picture'>\n+              <ControlLabel htmlFor='about-picture-input'>\n+                <strong>{t('settings.labels.picture')}</strong>\n+              </ControlLabel>\n+              <FormControl\n+                onChange={handlePictureChange}\n+                type='url'\n+                value={formValues.picture}\n+                id='about-picture-input'\n+              />\n+              {!isPictureUrlValid && (\n+                <ShowImageValidationWarning\n+                  alertContent={t('validation.url-not-image')}\n                 />\n-              </FormGroup>\n-            </div>\n-            <BlockSaveButton\n-              disabled={this.isFormPristine()}\n-              bgSize='large'\n-              {...(this.isFormPristine() && { tabIndex: -1 })}\n-            >\n-              {t('buttons.save')}{' '}\n-              <span className='sr-only'>\n-                {t('settings.headings.personal-info')}\n-              </span>\n-            </BlockSaveButton>\n-          </form>\n-        </FullWidthRow>\n-      </>\n-    );\n-  }\n-}\n+              )}\n+            </FormGroup>\n+            <FormGroup controlId='about-about'>\n+              <ControlLabel htmlFor='about-about-input'>\n+                <strong>{t('settings.labels.about')}</strong>\n+              </ControlLabel>\n+              <FormControl\n+                componentClass='textarea'\n+                onChange={handleAboutChange}\n+                value={formValues.about}\n+                id='about-about-input'\n+              />\n+            </FormGroup>\n+          </div>\n+          <BlockSaveButton\n+            disabled={isFormPristine()}\n+            bgSize='large'\n+            {...(isFormPristine() && { tabIndex: -1 })}\n+          >\n+            {t('buttons.save')}{' '}\n+            <span className='sr-only'>\n+              {t('settings.headings.personal-info')}\n+            </span>\n+          </BlockSaveButton>\n+        </form>\n+      </FullWidthRow>\n+    </>\n+  );\n+};\n \n AboutSettings.displayName = 'AboutSettings';\n "
        }
    ],
    "stats": {
        "total": 336,
        "additions": 148,
        "deletions": 188
    }
}