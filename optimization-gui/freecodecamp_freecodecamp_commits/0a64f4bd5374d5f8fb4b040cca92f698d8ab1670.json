{
    "author": "ojeytonwilliams",
    "message": "fix(client): ensure source is added to files (#56601)",
    "sha": "0a64f4bd5374d5f8fb4b040cca92f698d8ab1670",
    "files": [
        {
            "sha": "14d04689613a4a53ee65bfc07dcb451d0ed6ecdf",
            "filename": "client/src/templates/Challenges/rechallenge/transformers.js",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0a64f4bd5374d5f8fb4b040cca92f698d8ab1670/client%2Fsrc%2Ftemplates%2FChallenges%2Frechallenge%2Ftransformers.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0a64f4bd5374d5f8fb4b040cca92f698d8ab1670/client%2Fsrc%2Ftemplates%2FChallenges%2Frechallenge%2Ftransformers.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Frechallenge%2Ftransformers.js?ref=0a64f4bd5374d5f8fb4b040cca92f698d8ab1670",
            "patch": "@@ -14,7 +14,8 @@ import {\n   transformContents,\n   transformHeadTailAndContents,\n   setExt,\n-  compileHeadTail\n+  compileHeadTail,\n+  createSource\n } from '../../../../../shared/utils/polyvinyl';\n import { WorkerExecutor } from '../utils/worker-executor';\n \n@@ -275,13 +276,15 @@ const htmlTransformer = cond([\n ]);\n \n export const getTransformers = loopProtectOptions => [\n+  createSource,\n   replaceNBSP,\n   babelTransformer(loopProtectOptions),\n   partial(compileHeadTail, ''),\n   htmlTransformer\n ];\n \n export const getPythonTransformers = () => [\n+  createSource,\n   replaceNBSP,\n   partial(compileHeadTail, '')\n ];"
        },
        {
            "sha": "25a74dc8ded42b8fa4c6245fd8037ddfa2a6a77e",
            "filename": "shared/utils/polyvinyl.js",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0a64f4bd5374d5f8fb4b040cca92f698d8ab1670/shared%2Futils%2Fpolyvinyl.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0a64f4bd5374d5f8fb4b040cca92f698d8ab1670/shared%2Futils%2Fpolyvinyl.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/shared%2Futils%2Fpolyvinyl.js?ref=0a64f4bd5374d5f8fb4b040cca92f698d8ab1670",
            "patch": "@@ -20,7 +20,7 @@ const invariant = require('invariant');\n //   contents: String,\n //   history?: [...String],\n // }) => PolyVinyl, throws\n-function createPoly({ name, ext, contents, history, ...rest } = {}) {\n+function createPoly({ name, ext, contents, history, ...rest }) {\n   invariant(typeof name === 'string', 'name must be a string but got %s', name);\n \n   invariant(typeof ext === 'string', 'ext must be a string, but was %s', ext);\n@@ -147,11 +147,20 @@ function transformHeadTailAndContents(wrap, poly) {\n   };\n }\n \n+// createSource(poly: PolyVinyl) => PolyVinyl\n+function createSource(poly) {\n+  return {\n+    ...poly,\n+    source: poly.source || poly.contents\n+  };\n+}\n+\n module.exports = {\n   createPoly,\n   isPoly,\n   setContent,\n   setExt,\n+  createSource,\n   compileHeadTail,\n   regeneratePathAndHistory,\n   transformContents,"
        },
        {
            "sha": "8263e03314696bc27ca542c13ec1839dcf051fc0",
            "filename": "shared/utils/polyvinyl.test.js",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/0a64f4bd5374d5f8fb4b040cca92f698d8ab1670/shared%2Futils%2Fpolyvinyl.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/0a64f4bd5374d5f8fb4b040cca92f698d8ab1670/shared%2Futils%2Fpolyvinyl.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/shared%2Futils%2Fpolyvinyl.test.js?ref=0a64f4bd5374d5f8fb4b040cca92f698d8ab1670",
            "patch": "@@ -0,0 +1,29 @@\n+import polyvinyl from './polyvinyl';\n+\n+const polyData = {\n+  name: 'test',\n+  ext: 'js',\n+  contents: 'var hello = world;',\n+  history: ['test.js']\n+};\n+\n+describe('createSource', () => {\n+  it('should return a vinyl object with a source matching the contents', () => {\n+    const original = polyvinyl.createPoly(polyData);\n+\n+    const updated = polyvinyl.createSource(original);\n+    expect(original).not.toHaveProperty('source');\n+    expect(updated).toHaveProperty('source', 'var hello = world;');\n+    expect(updated).toMatchObject(original);\n+  });\n+\n+  it('should not update the source if it already exists', () => {\n+    const original = polyvinyl.createPoly({\n+      ...polyData,\n+      source: 'const hello = world;'\n+    });\n+\n+    const updated = polyvinyl.createSource(original);\n+    expect(updated).toStrictEqual(original);\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 45,
        "additions": 43,
        "deletions": 2
    }
}