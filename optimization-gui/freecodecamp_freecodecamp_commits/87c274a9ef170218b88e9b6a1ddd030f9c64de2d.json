{
    "author": "ojeytonwilliams",
    "message": "feat(api): allow HOME_LOCATION origin in development (#61003)",
    "sha": "87c274a9ef170218b88e9b6a1ddd030f9c64de2d",
    "files": [
        {
            "sha": "0f7631b70f2e6b2339565a5efc646779019d1b35",
            "filename": "api/src/plugins/auth0.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/87c274a9ef170218b88e9b6a1ddd030f9c64de2d/api%2Fsrc%2Fplugins%2Fauth0.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/87c274a9ef170218b88e9b6a1ddd030f9c64de2d/api%2Fsrc%2Fplugins%2Fauth0.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fauth0.test.ts?ref=87c274a9ef170218b88e9b6a1ddd030f9c64de2d",
            "patch": "@@ -107,7 +107,7 @@ describe('auth0 plugin', () => {\n       });\n \n       expect(res.headers.location).toMatch(\n-        `${HOME_LOCATION}/learn?${formatMessage({ type: 'danger', content: 'flash.generic-error' })}`\n+        `${HOME_LOCATION}/?${formatMessage({ type: 'danger', content: 'flash.generic-error' })}`\n       );\n       expect(res.statusCode).toBe(302);\n     });\n@@ -119,7 +119,7 @@ describe('auth0 plugin', () => {\n       });\n \n       expect(res.headers.location).toMatch(\n-        `${HOME_LOCATION}/learn?${formatMessage({ type: 'danger', content: 'flash.generic-error' })}`\n+        `${HOME_LOCATION}/?${formatMessage({ type: 'danger', content: 'flash.generic-error' })}`\n       );\n       expect(res.statusCode).toBe(302);\n     });"
        },
        {
            "sha": "6234432ac553e3f13b89ba57f74db15bc1bd4e56",
            "filename": "api/src/routes/public/signout.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/87c274a9ef170218b88e9b6a1ddd030f9c64de2d/api%2Fsrc%2Froutes%2Fpublic%2Fsignout.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/87c274a9ef170218b88e9b6a1ddd030f9c64de2d/api%2Fsrc%2Froutes%2Fpublic%2Fsignout.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fpublic%2Fsignout.test.ts?ref=87c274a9ef170218b88e9b6a1ddd030f9c64de2d",
            "patch": "@@ -31,11 +31,9 @@ describe('GET /signout', () => {\n   it('should redirect to / on the client by default', async () => {\n     const res = await superRequest('/signout', { method: 'GET' });\n \n-    // This happens because localhost:8000 is not an allowed origin and so\n-    // normalizeParams rejects it and sets the returnTo to /learn. TODO:\n-    // separate the validation and normalization logic.\n+    // TODO: separate the validation and normalization logic.\n     // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n-    expect(res.headers.location).toBe(`${HOME_LOCATION}/learn`);\n+    expect(res.headers.location).toBe(`${HOME_LOCATION}/`);\n     expect(res.status).toBe(302);\n   });\n });"
        },
        {
            "sha": "e8f2e4ab404b4b846741cbd082ff0ada72c57792",
            "filename": "api/src/utils/allowed-origins.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/87c274a9ef170218b88e9b6a1ddd030f9c64de2d/api%2Fsrc%2Futils%2Fallowed-origins.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/87c274a9ef170218b88e9b6a1ddd030f9c64de2d/api%2Fsrc%2Futils%2Fallowed-origins.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Futils%2Fallowed-origins.ts?ref=87c274a9ef170218b88e9b6a1ddd030f9c64de2d",
            "patch": "@@ -1,4 +1,6 @@\n-export const allowedOrigins = [\n+import { HOME_LOCATION, FREECODECAMP_NODE_ENV } from './env';\n+\n+const ALLOWED_ORIGINS = [\n   'https://www.freecodecamp.dev',\n   'https://www.freecodecamp.org',\n   // pretty sure the rest of these can go?\n@@ -7,3 +9,8 @@ export const allowedOrigins = [\n   'https://chinese.freecodecamp.dev',\n   'https://chinese.freecodecamp.org'\n ];\n+\n+export const allowedOrigins =\n+  FREECODECAMP_NODE_ENV === 'development'\n+    ? [...ALLOWED_ORIGINS, HOME_LOCATION]\n+    : ALLOWED_ORIGINS;"
        },
        {
            "sha": "6a3a0dadb69d26f64fe681039d0b54f04c034006",
            "filename": "api/src/utils/redirection.test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/87c274a9ef170218b88e9b6a1ddd030f9c64de2d/api%2Fsrc%2Futils%2Fredirection.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/87c274a9ef170218b88e9b6a1ddd030f9c64de2d/api%2Fsrc%2Futils%2Fredirection.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Futils%2Fredirection.test.ts?ref=87c274a9ef170218b88e9b6a1ddd030f9c64de2d",
            "patch": "@@ -182,13 +182,13 @@ describe('redirection', () => {\n       expect(result).toEqual(expectedReturn);\n     });\n \n-    it('should use HOME_LOCATION with missing referer', () => {\n+    it('should returnTo the origin if the referer is missing', () => {\n       const req = {\n         headers: {}\n       };\n \n       const expectedReturn = {\n-        returnTo: `${HOME_LOCATION}/learn`,\n+        returnTo: `${HOME_LOCATION}/`,\n         origin: HOME_LOCATION,\n         pathPrefix: ''\n       };\n@@ -197,15 +197,15 @@ describe('redirection', () => {\n       expect(result).toEqual(expectedReturn);\n     });\n \n-    it('should use HOME_LOCATION with invalid referrer', () => {\n+    it('should returnTo the origin if the referrer is invalid', () => {\n       const req = {\n         headers: {\n           referer: 'invalid-url'\n         }\n       };\n \n       const expectedReturn = {\n-        returnTo: `${HOME_LOCATION}/learn`,\n+        returnTo: `${HOME_LOCATION}/`,\n         origin: HOME_LOCATION,\n         pathPrefix: ''\n       };"
        },
        {
            "sha": "ee3d0b96e58b1970270ed0f1a35e394b01c3fc2a",
            "filename": "e2e/signout-modal.spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/87c274a9ef170218b88e9b6a1ddd030f9c64de2d/e2e%2Fsignout-modal.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/87c274a9ef170218b88e9b6a1ddd030f9c64de2d/e2e%2Fsignout-modal.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fsignout-modal.spec.ts?ref=87c274a9ef170218b88e9b6a1ddd030f9c64de2d",
            "patch": "@@ -31,7 +31,7 @@ test.describe('Signout Modal component', () => {\n     ).toBeVisible();\n   });\n \n-  test('signs out and redirects to /learn after user confirms they want to sign out', async ({\n+  test('signs out and redirects to / after user confirms they want to sign out', async ({\n     page\n   }) => {\n     await page.getByRole('button', { name: translations.buttons.menu }).click();\n@@ -50,7 +50,7 @@ test.describe('Signout Modal component', () => {\n     await expect(\n       page.getByRole('dialog', { name: translations.signout.heading })\n     ).not.toBeVisible();\n-    await expect(page).toHaveURL(allowTrailingSlash('/learn'));\n+    await expect(page).toHaveURL(allowTrailingSlash(''));\n   });\n \n   test('closes modal after user cancels signing out', async ({ page }) => {"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 18,
        "deletions": 13
    }
}