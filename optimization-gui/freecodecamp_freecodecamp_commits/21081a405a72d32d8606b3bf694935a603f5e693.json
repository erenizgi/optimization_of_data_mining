{
    "author": "huyenltnguyen",
    "message": "fix(api): /showCert not returning user full name (#57666)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "21081a405a72d32d8606b3bf694935a603f5e693",
    "files": [
        {
            "sha": "e4f2163d0751d2e6b1c7be258f7b18b5212c0812",
            "filename": "api/src/routes/public/certificate.test.ts",
            "status": "modified",
            "additions": 78,
            "deletions": 1,
            "changes": 79,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/21081a405a72d32d8606b3bf694935a603f5e693/api%2Fsrc%2Froutes%2Fpublic%2Fcertificate.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/21081a405a72d32d8606b3bf694935a603f5e693/api%2Fsrc%2Froutes%2Fpublic%2Fcertificate.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fpublic%2Fcertificate.test.ts?ref=21081a405a72d32d8606b3bf694935a603f5e693",
            "patch": "@@ -7,11 +7,24 @@ import {\n } from '../../../jest.utils';\n import { getFallbackFullStackDate } from '../helpers/certificate-utils';\n \n+const DATE_NOW = Date.now();\n+\n describe('certificate routes', () => {\n   setupServer();\n \n   describe('Unauthenticated user', () => {\n-    beforeAll(async () => resetDefaultUser());\n+    beforeAll(async () => {\n+      await resetDefaultUser();\n+\n+      jest.useFakeTimers({\n+        doNotFake: ['nextTick']\n+      });\n+      jest.setSystemTime(DATE_NOW);\n+    });\n+\n+    afterAll(() => {\n+      jest.useRealTimers();\n+    });\n \n     describe('GET /certificate/showCert/:username/:certSlug', () => {\n       beforeEach(async () => {\n@@ -204,6 +217,70 @@ describe('certificate routes', () => {\n         expect(response.status).toBe(200);\n       });\n \n+      test('should not return user full name if `showName` is `false`', async () => {\n+        await fastifyTestInstance.prisma.user.update({\n+          where: { id: defaultUserId },\n+          data: {\n+            profileUI: {\n+              showTimeLine: true,\n+              showCerts: true,\n+              isLocked: false,\n+              showName: false\n+            },\n+            isJsAlgoDataStructCert: true,\n+            completedChallenges: [\n+              {\n+                id: '561abd10cb81ac38a17513bc', // Cert ID\n+                completedDate: DATE_NOW\n+              }\n+            ]\n+          }\n+        });\n+\n+        const response = await superRequest(\n+          '/certificate/showCert/foobar/javascript-algorithms-and-data-structures',\n+          {\n+            method: 'GET'\n+          }\n+        );\n+\n+        // TODO: delete this assertion once there's only one status 200 response\n+        expect(response.body).toHaveProperty('username', 'foobar');\n+        expect(response.body).not.toHaveProperty('name');\n+        expect(response.status).toBe(200);\n+      });\n+\n+      test('should return user full name if `showName` is `true`', async () => {\n+        await fastifyTestInstance.prisma.user.update({\n+          where: { id: defaultUserId },\n+          data: {\n+            profileUI: {\n+              showTimeLine: true,\n+              showCerts: true,\n+              isLocked: false,\n+              showName: true\n+            },\n+            isJsAlgoDataStructCert: true,\n+            completedChallenges: [\n+              {\n+                id: '561abd10cb81ac38a17513bc', // Cert ID\n+                completedDate: DATE_NOW\n+              }\n+            ]\n+          }\n+        });\n+\n+        const response = await superRequest(\n+          '/certificate/showCert/foobar/javascript-algorithms-and-data-structures',\n+          {\n+            method: 'GET'\n+          }\n+        );\n+\n+        expect(response.body).toHaveProperty('name', 'foobar');\n+        expect(response.status).toBe(200);\n+      });\n+\n       test('should return cert-not-found if there is no cert with that slug', async () => {\n         const response = await superRequest(\n           '/certificate/showCert/foobar/not-a-valid-cert-slug',"
        },
        {
            "sha": "9880b6f52325272ad9c521ed92d2a833d8f2ead7",
            "filename": "api/src/schemas/certificate/cert-slug.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/21081a405a72d32d8606b3bf694935a603f5e693/api%2Fsrc%2Fschemas%2Fcertificate%2Fcert-slug.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/21081a405a72d32d8606b3bf694935a603f5e693/api%2Fsrc%2Fschemas%2Fcertificate%2Fcert-slug.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fcertificate%2Fcert-slug.ts?ref=21081a405a72d32d8606b3bf694935a603f5e693",
            "patch": "@@ -85,14 +85,7 @@ export const certSlug = {\n         certSlug: Type.Enum(Certification),\n         certTitle: Type.String(),\n         username: Type.String(),\n-        date: Type.Number(),\n-        completionTime: Type.Number()\n-      }),\n-      Type.Object({\n-        certSlug: Type.Enum(Certification),\n-        certTitle: Type.String(),\n-        username: Type.String(),\n-        name: Type.String(),\n+        name: Type.Optional(Type.String()),\n         date: Type.Number(),\n         completionTime: Type.Number()\n       }),"
        }
    ],
    "stats": {
        "total": 88,
        "additions": 79,
        "deletions": 9
    }
}