{
    "author": "ojeytonwilliams",
    "message": "feat(api): api/users/get-public-profile (#54729)\n\nCo-authored-by: Shaun Hamilton <shauhami020@gmail.com>",
    "sha": "a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
    "files": [
        {
            "sha": "0048ec8d288fcfc08efa9c17c71807ef735f170a",
            "filename": "api/src/app.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fapp.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fapp.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fapp.ts?ref=a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
            "patch": "@@ -41,7 +41,7 @@ import { donateRoutes } from './routes/donate';\n import { emailSubscribtionRoutes } from './routes/email-subscription';\n import { settingRoutes } from './routes/settings';\n import { statusRoute } from './routes/status';\n-import { userGetRoutes, userRoutes } from './routes/user';\n+import { userGetRoutes, userRoutes, userPublicGetRoutes } from './routes/user';\n import {\n   API_LOCATION,\n   COOKIE_DOMAIN,\n@@ -208,6 +208,7 @@ export const build = async (\n   void fastify.register(donateRoutes);\n   void fastify.register(emailSubscribtionRoutes);\n   void fastify.register(userRoutes);\n+  void fastify.register(userPublicGetRoutes);\n   void fastify.register(protectedCertificateRoutes);\n   void fastify.register(unprotectedCertificateRoutes);\n   void fastify.register(userGetRoutes);"
        },
        {
            "sha": "deaaa579e9124ead0be9c6ebdae2f186a8cc2a28",
            "filename": "api/src/routes/user.test.ts",
            "status": "modified",
            "additions": 358,
            "deletions": 41,
            "changes": 399,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Froutes%2Fuser.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Froutes%2Fuser.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fuser.test.ts?ref=a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
            "patch": "@@ -16,7 +16,7 @@ import {\n   createSuperRequest\n } from '../../jest.utils';\n import { JWT_SECRET } from '../utils/env';\n-import { getMsTranscriptApiUrl } from './user';\n+import { getMsTranscriptApiUrl, replacePrivateData } from './user';\n \n const mockedFetch = jest.fn();\n jest.spyOn(globalThis, 'fetch').mockImplementation(mockedFetch);\n@@ -79,7 +79,7 @@ const testUserData: Prisma.userCreateInput = {\n   ],\n   savedChallenges: [\n     {\n-      id: 'abc123',\n+      id: 'a6b0bb188d873cb2c8729495',\n       lastSavedDate: 123,\n       files: [\n         {\n@@ -110,6 +110,19 @@ const minimalUserData: Prisma.userCreateInput = {\n   unsubscribeId: '1234567890'\n };\n \n+const lockedProfileUI = {\n+  isLocked: true,\n+  showAbout: false,\n+  showCerts: false,\n+  showDonation: false,\n+  showHeatMap: false,\n+  showLocation: false,\n+  showName: false,\n+  showPoints: false,\n+  showPortfolio: false,\n+  showTimeLine: false\n+};\n+\n // These are not part of the schema, but are added to the user object by\n // get-session-user's handler\n const computedProperties = {\n@@ -119,24 +132,23 @@ const computedProperties = {\n   points: 1,\n   // This is the default value if profileUI is missing. If individual properties\n   // are missing from the db, they will be omitted from the response.\n-  profileUI: {\n-    isLocked: true,\n-    showAbout: false,\n-    showCerts: false,\n-    showDonation: false,\n-    showHeatMap: false,\n-    showLocation: false,\n-    showName: false,\n-    showPoints: false,\n-    showPortfolio: false,\n-    showTimeLine: false\n-  }\n+  profileUI: lockedProfileUI\n+};\n+\n+// The following appears in get-session-user responses, but not\n+// get-public-profile\n+const sessionOnlyData = {\n+  currentChallengeId: testUserData.currentChallengeId,\n+  email: testUserData.email,\n+  emailVerified: testUserData.emailVerified,\n+  isEmailVerified: testUserData.emailVerified,\n+  sendQuincyEmail: testUserData.sendQuincyEmail,\n+  theme: testUserData.theme,\n+  keyboardShortcuts: testUserData.keyboardShortcuts,\n+  completedChallengeCount: 3,\n+  acceptedPrivacyTerms: testUserData.acceptedPrivacyTerms\n };\n \n-// This is (most of) what we expect to get back from the API. The remaining\n-// properties are 'id' and 'joinDate', which are generated by the database.\n-// We're currently filtering properties with null values, since the old api just\n-// would not return those.\n const publicUserData = {\n   about: testUserData.about,\n   calendar: { 1520002973: 1, 1520440323: 1 },\n@@ -177,32 +189,31 @@ const publicUserData = {\n     }\n   ],\n   completedExams: testUserData.completedExams,\n-  completedSurveys: [],\n+  completedSurveys: [], // TODO: add surveys\n   githubProfile: testUserData.githubProfile,\n+  is2018DataVisCert: testUserData.is2018DataVisCert,\n+  is2018FullStackCert: testUserData.is2018FullStackCert, // TODO: should this be returned? The client doesn't use it at the moment.\n   isApisMicroservicesCert: testUserData.isApisMicroservicesCert,\n   isBackEndCert: testUserData.isBackEndCert,\n   isCheater: testUserData.isCheater,\n-  isDonating: testUserData.isDonating,\n-  isEmailVerified: testUserData.emailVerified,\n-  is2018DataVisCert: testUserData.is2018DataVisCert,\n-  is2018FullStackCert: testUserData.is2018FullStackCert,\n+  isCollegeAlgebraPyCertV8: testUserData.isCollegeAlgebraPyCertV8,\n+  isDataAnalysisPyCertV7: testUserData.isDataAnalysisPyCertV7,\n   isDataVisCert: testUserData.isDataVisCert,\n+  isDonating: testUserData.isDonating,\n   isFoundationalCSharpCertV8: testUserData.isFoundationalCSharpCertV8,\n   isFrontEndCert: testUserData.isFrontEndCert,\n-  isFullStackCert: testUserData.isFullStackCert,\n   isFrontEndLibsCert: testUserData.isFrontEndLibsCert,\n+  isFullStackCert: testUserData.isFullStackCert,\n   isHonest: testUserData.isHonest,\n-  isInfosecQaCert: testUserData.isInfosecQaCert,\n-  isQaCertV7: testUserData.isQaCertV7,\n   isInfosecCertV7: testUserData.isInfosecCertV7,\n+  isInfosecQaCert: testUserData.isInfosecQaCert,\n   isJsAlgoDataStructCert: testUserData.isJsAlgoDataStructCert,\n   isJsAlgoDataStructCertV8: testUserData.isJsAlgoDataStructCertV8,\n+  isMachineLearningPyCertV7: testUserData.isMachineLearningPyCertV7,\n+  isQaCertV7: testUserData.isQaCertV7,\n   isRelationalDatabaseCertV8: testUserData.isRelationalDatabaseCertV8,\n   isRespWebDesignCert: testUserData.isRespWebDesignCert,\n   isSciCompPyCertV7: testUserData.isSciCompPyCertV7,\n-  isDataAnalysisPyCertV7: testUserData.isDataAnalysisPyCertV7,\n-  isMachineLearningPyCertV7: testUserData.isMachineLearningPyCertV7,\n-  isCollegeAlgebraPyCertV8: testUserData.isCollegeAlgebraPyCertV8,\n   linkedin: testUserData.linkedin,\n   location: testUserData.location,\n   name: testUserData.name,\n@@ -211,19 +222,20 @@ const publicUserData = {\n   points: 2,\n   portfolio: testUserData.portfolio,\n   profileUI: testUserData.profileUI,\n+  savedChallenges: testUserData.savedChallenges,\n+  twitter: 'https://twitter.com/foobar',\n   username: testUserData.usernameDisplay, // It defaults to usernameDisplay\n   website: testUserData.website,\n-  yearsTopContributor: testUserData.yearsTopContributor,\n-  currentChallengeId: testUserData.currentChallengeId,\n-  email: testUserData.email,\n-  emailVerified: testUserData.emailVerified,\n-  sendQuincyEmail: testUserData.sendQuincyEmail,\n-  theme: testUserData.theme,\n-  twitter: 'https://twitter.com/foobar',\n-  keyboardShortcuts: testUserData.keyboardShortcuts,\n-  completedChallengeCount: 3,\n-  acceptedPrivacyTerms: testUserData.acceptedPrivacyTerms,\n-  savedChallenges: testUserData.savedChallenges\n+  yearsTopContributor: testUserData.yearsTopContributor\n+};\n+\n+// This is (most of) what we expect to get back from the API. The remaining\n+// properties are 'id' and 'joinDate', which are generated by the database.\n+// We're currently filtering properties with null values, since the old api just\n+// would not return those.\n+const sessionUserData = {\n+  ...sessionOnlyData,\n+  ...publicUserData\n };\n \n const baseProgressData = {\n@@ -554,7 +566,7 @@ describe('userRoutes', () => {\n           where: { email: testUserData.email }\n         });\n         const publicUser = {\n-          ...publicUserData,\n+          ...sessionUserData,\n           id: testUser?.id,\n           joinDate: new ObjectId(testUser?.id).getTimestamp().toISOString()\n         };\n@@ -1114,6 +1126,167 @@ Thanks and regards,\n       });\n     });\n   });\n+\n+  describe('Public', () => {\n+    let superGet: ReturnType<typeof createSuperRequest>;\n+\n+    beforeEach(() => {\n+      superGet = createSuperRequest({ method: 'GET' });\n+    });\n+\n+    describe('/api/users/get-public-profile', () => {\n+      const profilelessUsername = 'profileless-user';\n+      const lockedUsername = 'locked-user';\n+      const publicUsername = 'public-user';\n+      const lockedUserProfileUI = {\n+        isLocked: true,\n+        showAbout: true,\n+        showPortfolio: false\n+      };\n+      const unlockedUserProfileUI = {\n+        isLocked: false,\n+        showAbout: true,\n+        showCerts: true,\n+        showDonation: true,\n+        showHeatMap: true,\n+        showLocation: true,\n+        showName: true,\n+        showPoints: true,\n+        showPortfolio: true,\n+        showTimeLine: true\n+      };\n+      const users = [profilelessUsername, lockedUsername, publicUsername];\n+      beforeAll(async () => {\n+        await fastifyTestInstance.prisma.user.create({\n+          data: {\n+            ...minimalUserData,\n+            email: profilelessUsername,\n+            username: profilelessUsername\n+          }\n+        });\n+        await fastifyTestInstance.prisma.user.create({\n+          data: {\n+            ...minimalUserData,\n+            email: lockedUsername,\n+            username: lockedUsername,\n+            profileUI: lockedUserProfileUI\n+          }\n+        });\n+        await fastifyTestInstance.prisma.user.create({\n+          data: {\n+            ...testUserData,\n+            email: publicUsername,\n+            username: publicUsername,\n+            profileUI: unlockedUserProfileUI\n+          }\n+        });\n+      });\n+\n+      afterAll(async () => {\n+        await fastifyTestInstance.prisma.user.deleteMany({\n+          where: {\n+            OR: users.map(username => ({ username }))\n+          }\n+        });\n+      });\n+\n+      describe('GET', () => {\n+        test('returns 400 status code if the username param is missing', async () => {\n+          const res = await superGet('/api/users/get-public-profile');\n+          // TODO(Post-MVP): return something more informative\n+          expect(res.body).toStrictEqual({});\n+          expect(res.statusCode).toBe(400);\n+        });\n+\n+        test('returns 400 status code if the username param is empty', async () => {\n+          const res = await superGet('/api/users/get-public-profile?username=');\n+          // TODO(Post-MVP): return something more informative\n+          expect(res.body).toStrictEqual({});\n+          expect(res.statusCode).toBe(400);\n+        });\n+\n+        test('returns 404 status code for non-existent user', async () => {\n+          const response = await superGet(\n+            '/api/users/get-public-profile?username=non-existent'\n+          );\n+          // TODO(Post-MVP): return something more informative\n+          expect(response.body).toStrictEqual({});\n+          expect(response.statusCode).toBe(404);\n+        });\n+\n+        test('returns 200 status code with a locked profile if the profile is private', async () => {\n+          const response = await superGet(\n+            `/api/users/get-public-profile?username=${lockedUsername}`\n+          );\n+\n+          expect(response.body).toStrictEqual({\n+            entities: {\n+              user: {\n+                [lockedUsername]: {\n+                  isLocked: true,\n+                  profileUI: lockedUserProfileUI,\n+                  username: lockedUsername\n+                }\n+              }\n+            },\n+            result: lockedUsername\n+          });\n+          expect(response.statusCode).toBe(200);\n+        });\n+\n+        test('returns 200 status code locked profile if the profile is missing', async () => {\n+          const response = await superGet(\n+            `/api/users/get-public-profile?username=${profilelessUsername}`\n+          );\n+\n+          expect(response.body).toStrictEqual({\n+            entities: {\n+              user: {\n+                [profilelessUsername]: {\n+                  isLocked: true,\n+                  profileUI: lockedProfileUI,\n+                  username: profilelessUsername\n+                }\n+              }\n+            },\n+            result: profilelessUsername\n+          });\n+          expect(response.statusCode).toBe(200);\n+        });\n+        // TODO: create a list of public properties like the api-server and use that\n+        // to restrict the output of this and get-session-user.\n+        test('returns 200 status code with public user object', async () => {\n+          const testUser =\n+            await fastifyTestInstance.prisma.user.findFirstOrThrow({\n+              where: { email: publicUsername }\n+            });\n+          const response = await superGet(\n+            `/api/users/get-public-profile?username=${publicUsername}`\n+          );\n+\n+          // TODO: create a fixture for this without 'completedSurveys', ideally\n+          // it should contain the entire body.\n+          const publicUser = {\n+            // TODO(Post-MVP, maybe): return completedSurveys?\n+            ..._.omit(publicUserData, 'completedSurveys'),\n+            username: publicUsername,\n+            joinDate: new ObjectId(testUser.id).getTimestamp().toISOString(),\n+            profileUI: unlockedUserProfileUI\n+          };\n+\n+          expect(response.body).toStrictEqual({\n+            entities: {\n+              user: {\n+                [publicUsername]: publicUser\n+              }\n+            },\n+            result: publicUsername\n+          });\n+          expect(response.statusCode).toBe(200);\n+        });\n+      });\n+    });\n+  });\n });\n \n describe('Microsoft helpers', () => {\n@@ -1143,3 +1316,147 @@ describe('Microsoft helpers', () => {\n     });\n   });\n });\n+\n+describe('get-public-profile helpers', () => {\n+  describe('replacePrivateData', () => {\n+    const user = {\n+      about: 'about',\n+      calendar: { 1: 1, 2: 1 } as const,\n+      completedChallenges: [\n+        { id: '123', completedDate: 123, files: [] },\n+        { id: '456', completedDate: 456, challengeType: 7, files: [] }\n+      ],\n+      id: '5f5b1b3b1c9d440000d9e3b4',\n+      isDonating: false,\n+      location: 'location',\n+      joinDate: 'joinDate',\n+      name: 'name',\n+      points: 2,\n+      portfolio: [\n+        {\n+          id: '789',\n+          title: 'portfolio',\n+          url: 'url',\n+          image: 'image',\n+          description: 'description'\n+        }\n+      ],\n+      profileUI: {\n+        isLocked: false,\n+        showAbout: true,\n+        showCerts: true,\n+        showDonation: true,\n+        showHeatMap: true,\n+        showLocation: true,\n+        showName: true,\n+        showPoints: true,\n+        showPortfolio: true,\n+        showTimeLine: true\n+      }\n+    };\n+\n+    test(`returns \"\" for 'about' if showAbout is not true`, () => {\n+      const userWithoutAbout = {\n+        ...user,\n+        profileUI: { ...user.profileUI, showAbout: false }\n+      };\n+      expect(replacePrivateData(userWithoutAbout)).toMatchObject({\n+        about: ''\n+      });\n+    });\n+\n+    test('returns {} for calendar if showHeatMap is not true', () => {\n+      const userWithoutHeatMap = {\n+        ...user,\n+        profileUI: { ...user.profileUI, showHeatMap: false }\n+      };\n+      expect(replacePrivateData(userWithoutHeatMap).calendar).toEqual({});\n+    });\n+\n+    test(`returns [] for completeChallenges if showTimeLine is not true`, () => {\n+      const userWithoutTimeLine = {\n+        ...user,\n+        profileUI: { ...user.profileUI, showTimeLine: false }\n+      };\n+      expect(replacePrivateData(userWithoutTimeLine)).toMatchObject({\n+        completedChallenges: []\n+      });\n+    });\n+\n+    test('omits certifications from completedChallenges if showCerts is not true', () => {\n+      const userWithoutCerts = {\n+        ...user,\n+        profileUI: { ...user.profileUI, showCerts: false }\n+      };\n+      expect(replacePrivateData(userWithoutCerts)).toMatchObject({\n+        completedChallenges: [{ id: '123', completedDate: 123, files: [] }]\n+      });\n+    });\n+\n+    test('returns null for isDonating if showDonation is not true', () => {\n+      const userWithoutDonation = {\n+        ...user,\n+        profileUI: { ...user.profileUI, showDonation: false }\n+      };\n+      expect(replacePrivateData(userWithoutDonation)).toMatchObject({\n+        isDonating: null\n+      });\n+    });\n+\n+    test('returns \"\" for joinDate if showAbout is not true', () => {\n+      const userWithoutAbout = {\n+        ...user,\n+        profileUI: { ...user.profileUI, showAbout: false }\n+      };\n+      expect(replacePrivateData(userWithoutAbout)).toMatchObject({\n+        joinDate: ''\n+      });\n+    });\n+\n+    test(`returns \"\" for 'location' if showLocation is not true`, () => {\n+      const userWithoutLocation = {\n+        ...user,\n+        profileUI: { ...user.profileUI, showLocation: false }\n+      };\n+      expect(replacePrivateData(userWithoutLocation)).toMatchObject({\n+        location: ''\n+      });\n+    });\n+\n+    test(`returns \"\" for 'name' if showName is not true`, () => {\n+      const userWithoutName = {\n+        ...user,\n+        profileUI: { ...user.profileUI, showName: false }\n+      };\n+      expect(replacePrivateData(userWithoutName)).toMatchObject({\n+        name: ''\n+      });\n+    });\n+\n+    test('returns null for points if showPoints is not true', () => {\n+      const userWithoutPoints = {\n+        ...user,\n+        profileUI: { ...user.profileUI, showPoints: false }\n+      };\n+      expect(replacePrivateData(userWithoutPoints)).toMatchObject({\n+        points: null\n+      });\n+    });\n+\n+    test('returns [] for portfolio if showPortfolio is not true', () => {\n+      const userWithoutPortfolio = {\n+        ...user,\n+        profileUI: { ...user.profileUI, showPortfolio: false }\n+      };\n+      expect(replacePrivateData(userWithoutPortfolio)).toMatchObject({\n+        portfolio: []\n+      });\n+    });\n+\n+    test('returns the expected public user object if all showX flags are true', () => {\n+      expect(replacePrivateData(user)).toEqual(\n+        _.omit(user, ['id', 'profileUI'])\n+      );\n+    });\n+  });\n+});"
        },
        {
            "sha": "9004df1c884c570ec39627d1be7a832a43b8301f",
            "filename": "api/src/routes/user.ts",
            "status": "modified",
            "additions": 183,
            "deletions": 1,
            "changes": 184,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Froutes%2Fuser.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Froutes%2Fuser.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fuser.ts?ref=a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
            "patch": "@@ -1,4 +1,5 @@\n import { type FastifyPluginCallbackTypebox } from '@fastify/type-provider-typebox';\n+import { Portfolio } from '@prisma/client';\n import { ObjectId } from 'mongodb';\n import _ from 'lodash';\n \n@@ -12,9 +13,11 @@ import {\n   normalizeProfileUI,\n   normalizeTwitter,\n   removeNulls,\n-  normalizeSurveys\n+  normalizeSurveys,\n+  NormalizedChallenge\n } from '../utils/normalize';\n import {\n+  Calendar,\n   getCalendar,\n   getPoints,\n   type ProgressTimestamp\n@@ -23,6 +26,7 @@ import { encodeUserToken } from '../utils/tokens';\n import { trimTags } from '../utils/validation';\n import { generateReportEmail } from '../utils/email-templates';\n import { createResetProperties } from '../utils/create-user';\n+import { challengeTypes } from '../../../shared/config/challenge-types';\n \n // user flags that the api-server returns as false if they're missing in the\n // user document. Since Prisma returns null for missing fields, we need to\n@@ -542,6 +546,8 @@ export const userGetRoutes: FastifyPluginCallbackTypebox = (\n           void res.code(500);\n           return { user: {}, result: '' };\n         }\n+        // TODO: DRY this (the creation of the response body) and\n+        // get-public-profile's response body creation.\n \n         const encodedToken = userToken\n           ? encodeUserToken(userToken.id)\n@@ -606,3 +612,179 @@ export const userGetRoutes: FastifyPluginCallbackTypebox = (\n \n   done();\n };\n+\n+type ProfileUI = Partial<{\n+  isLocked: boolean;\n+  showAbout: boolean;\n+  showCerts: boolean;\n+  showDonation: boolean;\n+  showHeatMap: boolean;\n+  showLocation: boolean;\n+  showName: boolean;\n+  showPoints: boolean;\n+  showPortfolio: boolean;\n+  showTimeLine: boolean;\n+}>;\n+\n+type RawUser = {\n+  about: string;\n+  completedChallenges: NormalizedChallenge[];\n+  calendar: Calendar;\n+  id: string;\n+  isDonating: boolean;\n+  joinDate: string;\n+  location: string;\n+  name: string;\n+  points: number;\n+  portfolio: Portfolio[];\n+  profileUI: ProfileUI;\n+};\n+\n+/**\n+ * Creates an object with the properties that are shared with the public.\n+ * @param user The raw user object.\n+ * @returns The shared user object.\n+ */\n+export const replacePrivateData = (user: RawUser) => {\n+  const {\n+    showAbout,\n+    showHeatMap,\n+    showCerts,\n+    showDonation,\n+    showLocation,\n+    showName,\n+    showPoints,\n+    showPortfolio,\n+    showTimeLine\n+  } = user.profileUI;\n+\n+  return {\n+    about: showAbout ? user.about : '',\n+    calendar: showHeatMap ? user.calendar : {},\n+    completedChallenges: showTimeLine\n+      ? showCerts\n+        ? user.completedChallenges\n+        : user.completedChallenges.filter(\n+            c => c.challengeType !== challengeTypes.step\n+          )\n+      : [],\n+    isDonating: showDonation ? user.isDonating : null,\n+    joinDate: showAbout ? user.joinDate : '',\n+    location: showLocation ? user.location : '',\n+    name: showName ? user.name : '',\n+    points: showPoints ? user.points : null,\n+    portfolio: showPortfolio ? user.portfolio : []\n+  };\n+};\n+\n+/**\n+ * Plugin containing public GET routes for user account management. They are kept\n+ * separate because they do not require CSRF protection or authorization.\n+ *\n+ * @param fastify The Fastify instance.\n+ * @param _options Options passed to the plugin via `fastify.register(plugin, options)`.\n+ * @param done Callback to signal that the logic has completed.\n+ */\n+export const userPublicGetRoutes: FastifyPluginCallbackTypebox = (\n+  fastify,\n+  _options,\n+  done\n+) => {\n+  fastify.get(\n+    '/api/users/get-public-profile',\n+    {\n+      schema: schemas.getPublicProfile\n+    },\n+    async (req, reply) => {\n+      // TODO(Post-MVP): look for duplicates unless we can make username unique in the db.\n+      const user = await fastify.prisma.user.findFirst({\n+        where: { username: req.query.username }\n+        // TODO: only select desired fields, then stop 'omit'ing the undesired\n+        // ones.\n+      });\n+\n+      if (!user) {\n+        void reply.code(404);\n+        return reply.send({});\n+      }\n+\n+      const flags = _.pick<typeof user, NullableFlag>(user, nullableFlags);\n+      const rest = _.omit<typeof user, NullableFlag>(user, nullableFlags);\n+\n+      const publicUser = _.omit(rest, [\n+        'currentChallengeId',\n+        'email',\n+        'emailVerified',\n+        'sendQuincyEmail',\n+        'theme',\n+        // keyboardShortcuts is included in flags.\n+        // 'keyboardShortcuts',\n+        'acceptedPrivacyTerms',\n+        'progressTimestamps',\n+        'unsubscribeId',\n+        'donationEmails',\n+        'externalId',\n+        'usernameDisplay',\n+        'isBanned'\n+      ]);\n+\n+      const normalizedProfileUI = normalizeProfileUI(user.profileUI);\n+\n+      void reply.code(200);\n+      if (normalizedProfileUI.isLocked) {\n+        // TODO(Post-MVP): just return isLocked: true and either a null user\n+        // or no user at all. (see other TODO in the else branch below)\n+        return reply.send({\n+          entities: {\n+            user: {\n+              [user.username]: {\n+                isLocked: true,\n+                profileUI: normalizedProfileUI,\n+                username: user.username\n+              }\n+            }\n+          },\n+          result: user.username\n+        });\n+      } else {\n+        const progressTimestamps = user.progressTimestamps as\n+          | ProgressTimestamp[]\n+          | null;\n+        const sharedUser = replacePrivateData({\n+          ...user,\n+          calendar: getCalendar(progressTimestamps),\n+          completedChallenges: normalizeChallenges(user.completedChallenges),\n+          location: user.location ?? '',\n+          joinDate: new ObjectId(user.id).getTimestamp().toISOString(),\n+          name: user.name ?? '',\n+          points: getPoints(progressTimestamps),\n+          profileUI: normalizedProfileUI\n+        });\n+\n+        const returnedUser = {\n+          ...removeNulls(publicUser),\n+          ...normalizeFlags(flags),\n+          ...sharedUser,\n+          profileUI: normalizedProfileUI,\n+          // TODO: should this always be returned? Shouldn't some privacy\n+          // setting control it? Same applies to website, githubProfile,\n+          // and linkedin.\n+          twitter: normalizeTwitter(user.twitter),\n+          yearsTopContributor: user.yearsTopContributor\n+        };\n+        return reply.send({\n+          // TODO(Post-MVP): just return a user object (i.e. returnedUser) and\n+          // isLocked: false. The there should be no need for Type.Union in the\n+          // schema. Alternatively, have the user object be nullable and don't\n+          // bother with isLocked.\n+          entities: {\n+            user: { [user.username]: returnedUser }\n+          },\n+          result: user.username\n+        });\n+      }\n+    }\n+  );\n+\n+  done();\n+};"
        },
        {
            "sha": "20395ea6d28af31d3cb3fa48e4d8717b5565211f",
            "filename": "api/src/schema.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschema.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschema.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschema.test.ts?ref=a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
            "patch": "@@ -8,13 +8,13 @@ const ajv = new Ajv({ strictTypes: false });\n const isSchemaSecure = ajv.compile(secureSchema);\n \n // These schemas will fail the tests, so can only be checked by hand.\n-const ignoredSchemas = ['getSessionUser'];\n+const ignoredSchemas = ['getSessionUser', 'getPublicProfile'];\n \n describe('Schemas do not use obviously dangerous validation', () => {\n   Object.entries(schemas)\n     .filter(([schema]) => !ignoredSchemas.includes(schema))\n     .forEach(([name, schema]) => {\n-      describe(`schema ${name} is okay`, () => {\n+      describe(`schema ${name}`, () => {\n         if ('body' in schema) {\n           test('body is secure', () => {\n             expect(isSchemaSecure(schema.body)).toBeTruthy();\n@@ -27,6 +27,12 @@ describe('Schemas do not use obviously dangerous validation', () => {\n           });\n         }\n \n+        test('should use querystring instead of query', () => {\n+          // if query is used then req.query is unknown, but if querystring is\n+          // used then req.query has the expected type\n+          expect('query' in schema).toBeFalsy();\n+        });\n+\n         if ('params' in schema) {\n           test('params is secure', () => {\n             expect(isSchemaSecure(schema.params)).toBeTruthy();"
        },
        {
            "sha": "6a12c08d4aae0a8cbfd7bd021ad048a05ac2a6cd",
            "filename": "api/src/schemas.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschemas.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschemas.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas.ts?ref=a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
            "patch": "@@ -1,3 +1,4 @@\n+export { getPublicProfile } from './schemas/api/users/get-public-profile';\n export { certSlug } from './schemas/certificate/cert-slug';\n export { certificateVerify } from './schemas/certificate/certificate-verify';\n export { backendChallengeCompleted } from './schemas/challenge/backend-challenge-completed';"
        },
        {
            "sha": "05dfcfe194fc189a941df489c54110a143bb1ade",
            "filename": "api/src/schemas/api/users/get-public-profile.ts",
            "status": "added",
            "additions": 117,
            "deletions": 0,
            "changes": 117,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschemas%2Fapi%2Fusers%2Fget-public-profile.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschemas%2Fapi%2Fusers%2Fget-public-profile.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fapi%2Fusers%2Fget-public-profile.ts?ref=a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
            "patch": "@@ -0,0 +1,117 @@\n+import { Type } from '@fastify/type-provider-typebox';\n+import { profileUI, examResults, savedChallenge } from '../../types';\n+\n+export const getPublicProfile = {\n+  querystring: Type.Object({\n+    username: Type.String({ minLength: 1 })\n+  }),\n+  response: {\n+    200: Type.Object({\n+      entities: Type.Object({\n+        user: Type.Record(\n+          Type.String(),\n+          Type.Union([\n+            Type.Object({\n+              isLocked: Type.Boolean(),\n+              profileUI,\n+              username: Type.String()\n+            }),\n+            Type.Object({\n+              about: Type.String(),\n+              calendar: Type.Record(Type.Number(), Type.Literal(1)),\n+              completedChallenges: Type.Array(\n+                Type.Object({\n+                  id: Type.String(),\n+                  completedDate: Type.Number(),\n+                  solution: Type.Optional(Type.String()),\n+                  githubLink: Type.Optional(Type.String()),\n+                  challengeType: Type.Optional(Type.Number()),\n+                  files: Type.Array(\n+                    Type.Object({\n+                      contents: Type.String(),\n+                      key: Type.String(),\n+                      ext: Type.String(),\n+                      name: Type.String(),\n+                      path: Type.Optional(Type.String())\n+                    })\n+                  ),\n+                  isManuallyApproved: Type.Optional(Type.Boolean())\n+                })\n+              ),\n+              completedExams: Type.Array(\n+                Type.Object({\n+                  id: Type.String(),\n+                  completedDate: Type.Number(),\n+                  challengeType: Type.Optional(Type.Number()),\n+                  examResults\n+                })\n+              ),\n+              // TODO(Post-MVP): return completedSurveys? Presumably not, since why\n+              // would this need to be public.\n+              githubProfile: Type.Optional(Type.String()),\n+              is2018DataVisCert: Type.Boolean(),\n+              is2018FullStackCert: Type.Boolean(),\n+              isApisMicroservicesCert: Type.Boolean(),\n+              isBackEndCert: Type.Boolean(),\n+              isCheater: Type.Boolean(),\n+              isCollegeAlgebraPyCertV8: Type.Boolean(),\n+              isDataAnalysisPyCertV7: Type.Boolean(),\n+              isDataVisCert: Type.Boolean(),\n+              // TODO(Post-MVP): isDonating should be boolean.\n+              isDonating: Type.Union([Type.Boolean(), Type.Null()]),\n+              isFoundationalCSharpCertV8: Type.Boolean(),\n+              isFrontEndCert: Type.Boolean(),\n+              isFrontEndLibsCert: Type.Boolean(),\n+              isFullStackCert: Type.Boolean(),\n+              isHonest: Type.Boolean(),\n+              isInfosecCertV7: Type.Boolean(),\n+              isInfosecQaCert: Type.Boolean(),\n+              isJsAlgoDataStructCert: Type.Boolean(),\n+              isJsAlgoDataStructCertV8: Type.Boolean(),\n+              isMachineLearningPyCertV7: Type.Boolean(),\n+              isQaCertV7: Type.Boolean(),\n+              isRelationalDatabaseCertV8: Type.Boolean(),\n+              isRespWebDesignCert: Type.Boolean(),\n+              isSciCompPyCertV7: Type.Boolean(),\n+              linkedin: Type.Optional(Type.String()),\n+              location: Type.String(),\n+              name: Type.String(),\n+              partiallyCompletedChallenges: Type.Array(\n+                Type.Object({\n+                  id: Type.String(),\n+                  completedDate: Type.Number()\n+                })\n+              ),\n+              picture: Type.String(),\n+              // TODO(Post-MVP): points should be a number\n+              points: Type.Union([Type.Number(), Type.Null()]),\n+              portfolio: Type.Array(\n+                Type.Object({\n+                  description: Type.String(),\n+                  id: Type.String(),\n+                  image: Type.String(),\n+                  title: Type.String(),\n+                  url: Type.String()\n+                })\n+              ),\n+              profileUI,\n+              twitter: Type.Optional(Type.String()),\n+              website: Type.Optional(Type.String()),\n+              yearsTopContributor: Type.Array(Type.String()), // TODO(Post-MVP): convert to number?\n+              joinDate: Type.String(),\n+              savedChallenges: Type.Array(savedChallenge),\n+              username: Type.String(),\n+              msUsername: Type.Optional(Type.String())\n+            })\n+          ])\n+        )\n+      }),\n+      result: Type.String()\n+    }),\n+    // We can't simply have Type.Object({}), even though that's correct, because\n+    // TypeScript will then accept all responses (since every object can be\n+    // assigned to {})\n+    400: Type.Object({ entities: Type.Optional(Type.Never()) }),\n+    404: Type.Object({ entities: Type.Optional(Type.Never()) })\n+  }\n+};"
        },
        {
            "sha": "5b109f85a56f25b5cb6800516b6ccd654ecdb697",
            "filename": "api/src/schemas/challenge/modern-challenge-completed.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschemas%2Fchallenge%2Fmodern-challenge-completed.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschemas%2Fchallenge%2Fmodern-challenge-completed.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fchallenge%2Fmodern-challenge-completed.ts?ref=a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
            "patch": "@@ -1,5 +1,5 @@\n import { Type } from '@fastify/type-provider-typebox';\n-import { saveChallengeBody } from '../types';\n+import { savedChallenge } from '../types';\n \n export const modernChallengeCompleted = {\n   body: Type.Object({\n@@ -22,12 +22,7 @@ export const modernChallengeCompleted = {\n       completedDate: Type.Number(),\n       points: Type.Number(),\n       alreadyCompleted: Type.Boolean(),\n-      savedChallenges: Type.Array(\n-        Type.Intersect([\n-          saveChallengeBody,\n-          Type.Object({ lastSavedDate: Type.Number() })\n-        ])\n-      )\n+      savedChallenges: Type.Array(savedChallenge)\n     }),\n     400: Type.Object({\n       type: Type.Literal('error'),"
        },
        {
            "sha": "53e1deb88c56e15dd3d72781a1c8ac3281cadf70",
            "filename": "api/src/schemas/challenge/save-challenge.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 8,
            "changes": 18,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschemas%2Fchallenge%2Fsave-challenge.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschemas%2Fchallenge%2Fsave-challenge.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fchallenge%2Fsave-challenge.ts?ref=a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
            "patch": "@@ -1,16 +1,18 @@\n import { Type } from '@fastify/type-provider-typebox';\n-import { saveChallengeBody } from '../types';\n+import { file, savedChallenge } from '../types';\n \n export const saveChallenge = {\n-  body: saveChallengeBody,\n+  body: Type.Object({\n+    id: Type.String({\n+      format: 'objectid',\n+      maxLength: 24,\n+      minLength: 24\n+    }),\n+    files: Type.Array(file)\n+  }),\n   response: {\n     200: Type.Object({\n-      savedChallenges: Type.Array(\n-        Type.Intersect([\n-          saveChallengeBody,\n-          Type.Object({ lastSavedDate: Type.Number() })\n-        ])\n-      )\n+      savedChallenges: Type.Array(savedChallenge)\n     }),\n     403: Type.Literal('That challenge type is not saveable.'),\n     500: Type.Object({"
        },
        {
            "sha": "d76ce15d4c4e6c4dde1f7ed971e622c2dd69b983",
            "filename": "api/src/schemas/types.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 7,
            "changes": 27,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschemas%2Ftypes.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschemas%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Ftypes.ts?ref=a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
            "patch": "@@ -36,13 +36,13 @@ export const file = Type.Object({\n   history: Type.Array(Type.String())\n });\n \n-export const saveChallengeBody = Type.Object({\n-  id: Type.String({\n-    format: 'objectid',\n-    maxLength: 24,\n-    minLength: 24\n-  }),\n-  files: Type.Array(file)\n+// This is only used for serialization, so should not use format. Reason being,\n+// the serializer's job is simply to create JSON strings, not to validate the\n+// data.\n+export const savedChallenge = Type.Object({\n+  id: Type.String(),\n+  files: Type.Array(file),\n+  lastSavedDate: Type.Number()\n });\n \n export const examResults = Type.Object({\n@@ -57,3 +57,16 @@ export const examResults = Type.Object({\n export const surveyTitles = Type.Union([\n   Type.Literal('Foundational C# with Microsoft Survey')\n ]);\n+\n+export const profileUI = Type.Object({\n+  isLocked: Type.Optional(Type.Boolean()),\n+  showAbout: Type.Optional(Type.Boolean()),\n+  showCerts: Type.Optional(Type.Boolean()),\n+  showDonation: Type.Optional(Type.Boolean()),\n+  showHeatMap: Type.Optional(Type.Boolean()),\n+  showLocation: Type.Optional(Type.Boolean()),\n+  showName: Type.Optional(Type.Boolean()),\n+  showPoints: Type.Optional(Type.Boolean()),\n+  showPortfolio: Type.Optional(Type.Boolean()),\n+  showTimeLine: Type.Optional(Type.Boolean())\n+});"
        },
        {
            "sha": "d7b215dac99f1277669f5d390099d7634a18f31e",
            "filename": "api/src/schemas/user/get-session-user.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 19,
            "changes": 22,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschemas%2Fuser%2Fget-session-user.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Fschemas%2Fuser%2Fget-session-user.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fuser%2Fget-session-user.ts?ref=a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
            "patch": "@@ -1,5 +1,5 @@\n import { Type } from '@fastify/type-provider-typebox';\n-import { examResults, saveChallengeBody } from '../types';\n+import { examResults, profileUI, savedChallenge } from '../types';\n \n export const getSessionUser = {\n   response: {\n@@ -87,31 +87,15 @@ export const getSessionUser = {\n               url: Type.String()\n             })\n           ),\n-          profileUI: Type.Object({\n-            isLocked: Type.Optional(Type.Boolean()),\n-            showAbout: Type.Optional(Type.Boolean()),\n-            showCerts: Type.Optional(Type.Boolean()),\n-            showDonation: Type.Optional(Type.Boolean()),\n-            showHeatMap: Type.Optional(Type.Boolean()),\n-            showLocation: Type.Optional(Type.Boolean()),\n-            showName: Type.Optional(Type.Boolean()),\n-            showPoints: Type.Optional(Type.Boolean()),\n-            showPortfolio: Type.Optional(Type.Boolean()),\n-            showTimeLine: Type.Optional(Type.Boolean())\n-          }),\n+          profileUI: Type.Optional(profileUI),\n           sendQuincyEmail: Type.Boolean(),\n           theme: Type.String(),\n           twitter: Type.Optional(Type.String()),\n           website: Type.Optional(Type.String()),\n           yearsTopContributor: Type.Array(Type.String()), // TODO(Post-MVP): convert to number?\n           isEmailVerified: Type.Boolean(),\n           joinDate: Type.String(),\n-          savedChallenges: Type.Array(\n-            Type.Intersect([\n-              saveChallengeBody,\n-              Type.Object({ lastSavedDate: Type.Number() })\n-            ])\n-          ),\n+          savedChallenges: Type.Optional(Type.Array(savedChallenge)),\n           username: Type.String(),\n           userToken: Type.Optional(Type.String()),\n           completedSurveys: Type.Array("
        },
        {
            "sha": "bc2df1695765436d859f13c11f68a6de2ba55cc5",
            "filename": "api/src/utils/normalize.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 9,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Futils%2Fnormalize.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Futils%2Fnormalize.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Futils%2Fnormalize.ts?ref=a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
            "patch": "@@ -9,11 +9,16 @@ import {\n import _ from 'lodash';\n \n type NullToUndefined<T> = T extends null ? undefined : T;\n+type NullToFalse<T> = T extends null ? false : T;\n \n type NoNullProperties<T> = {\n   [P in keyof T]: NullToUndefined<T[P]>;\n };\n \n+type DefaultToFalse<T> = {\n+  [P in keyof T]: NullToFalse<T[P]>;\n+};\n+\n /**\n  * Converts a Twitter handle or URL to a URL.\n  *\n@@ -78,7 +83,7 @@ type NormalizedFile = {\n   path?: string;\n };\n \n-type NormalizedChallenge = {\n+export type NormalizedChallenge = {\n   challengeType?: number;\n   completedDate: number;\n   files: NormalizedFile[];\n@@ -142,11 +147,5 @@ export const normalizeSurveys = (\n  */\n export const normalizeFlags = <T extends Record<string, boolean | null>>(\n   flags: T\n-): { [K in keyof T]: boolean } => {\n-  const out = {} as { [K in keyof T]: boolean };\n-  for (const key in flags) {\n-    const v = flags[key];\n-    out[key] = typeof v === 'boolean' ? v : false;\n-  }\n-  return out;\n-};\n+): DefaultToFalse<T> =>\n+  _.mapValues(flags, flag => flag ?? false) as DefaultToFalse<T>;"
        },
        {
            "sha": "009415a2a74ae1ce3ceb0b5ce348ee3d33c082fa",
            "filename": "api/src/utils/progress.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Futils%2Fprogress.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a8f7e15dc231cdfbd930c21a05e6066e0121ac86/api%2Fsrc%2Futils%2Fprogress.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Futils%2Fprogress.ts?ref=a8f7e15dc231cdfbd930c21a05e6066e0121ac86",
            "patch": "@@ -1,5 +1,5 @@\n export type ProgressTimestamp = number | { timestamp: number } | null;\n-\n+export type Calendar = Record<number, 1>;\n /**\n  * Converts a ProgressTimestamp array to a object with keys based on the timestamps.\n  *\n@@ -8,8 +8,8 @@ export type ProgressTimestamp = number | { timestamp: number } | null;\n  */\n export const getCalendar = (\n   progressTimestamps: ProgressTimestamp[] | null\n-): Record<string, 1> => {\n-  const calendar: Record<string, 1> = {};\n+): Calendar => {\n+  const calendar: Calendar = {};\n \n   progressTimestamps?.forEach(progress => {\n     if (progress === null) return;"
        }
    ],
    "stats": {
        "total": 813,
        "additions": 715,
        "deletions": 98
    }
}