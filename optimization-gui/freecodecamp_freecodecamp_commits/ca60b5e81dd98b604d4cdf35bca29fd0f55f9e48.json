{
    "author": "Nirajn2311",
    "message": "feat(api): block useragents in /get-public-profile (#55487)",
    "sha": "ca60b5e81dd98b604d4cdf35bca29fd0f55f9e48",
    "files": [
        {
            "sha": "c0475d0d6ff70c670b0cc476b8f35a75f4a97d19",
            "filename": "api/src/routes/user.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ca60b5e81dd98b604d4cdf35bca29fd0f55f9e48/api%2Fsrc%2Froutes%2Fuser.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ca60b5e81dd98b604d4cdf35bca29fd0f55f9e48/api%2Fsrc%2Froutes%2Fuser.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fuser.ts?ref=ca60b5e81dd98b604d4cdf35bca29fd0f55f9e48",
            "patch": "@@ -63,6 +63,8 @@ const nullableFlags = [\n   'keyboardShortcuts'\n ] as const;\n \n+const blockedUserAgentParts = ['python', 'google-apps-script', 'curl'];\n+\n type NullableFlag = (typeof nullableFlags)[number];\n \n /**\n@@ -654,6 +656,18 @@ export const userPublicGetRoutes: FastifyPluginCallbackTypebox = (\n       schema: schemas.getPublicProfile\n     },\n     async (req, reply) => {\n+      const userAgent = req.headers['user-agent'];\n+\n+      if (\n+        userAgent &&\n+        blockedUserAgentParts.some(ua => userAgent.toLowerCase().includes(ua))\n+      ) {\n+        void reply.code(400);\n+        return reply.send(\n+          'This endpoint is no longer available outside of the freeCodeCamp ecosystem'\n+        );\n+      }\n+\n       // TODO(Post-MVP): look for duplicates unless we can make username unique in the db.\n       const user = await fastify.prisma.user.findFirst({\n         where: { username: req.query.username }"
        },
        {
            "sha": "f4305e0cb097d0e6b14d71dbb8c23582c3c690db",
            "filename": "api/src/schemas/api/users/get-public-profile.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ca60b5e81dd98b604d4cdf35bca29fd0f55f9e48/api%2Fsrc%2Fschemas%2Fapi%2Fusers%2Fget-public-profile.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ca60b5e81dd98b604d4cdf35bca29fd0f55f9e48/api%2Fsrc%2Fschemas%2Fapi%2Fusers%2Fget-public-profile.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fapi%2Fusers%2Fget-public-profile.ts?ref=ca60b5e81dd98b604d4cdf35bca29fd0f55f9e48",
            "patch": "@@ -112,7 +112,12 @@ export const getPublicProfile = {\n     // We can't simply have Type.Object({}), even though that's correct, because\n     // TypeScript will then accept all responses (since every object can be\n     // assigned to {})\n-    400: Type.Object({ entities: Type.Optional(Type.Never()) }),\n+    400: Type.Union([\n+      Type.Object({ entities: Type.Optional(Type.Never()) }),\n+      Type.Literal(\n+        'This endpoint is no longer available outside of the freeCodeCamp ecosystem'\n+      )\n+    ]),\n     404: Type.Object({ entities: Type.Optional(Type.Never()) })\n   }\n };"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 20,
        "deletions": 1
    }
}