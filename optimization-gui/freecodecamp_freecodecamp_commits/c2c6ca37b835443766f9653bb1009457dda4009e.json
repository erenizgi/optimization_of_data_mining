{
    "author": "ShaunSHamilton",
    "message": "feat: copy and generate exam token (#62623)\n\nCo-authored-by: moT01 <20648924+moT01@users.noreply.github.com>\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "c2c6ca37b835443766f9653bb1009457dda4009e",
    "files": [
        {
            "sha": "53e2ae01fc7a867d82312f67b686b0cc43644f2c",
            "filename": "api/src/routes/protected/user.ts",
            "status": "modified",
            "additions": 46,
            "deletions": 0,
            "changes": 46,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c2c6ca37b835443766f9653bb1009457dda4009e/api%2Fsrc%2Froutes%2Fprotected%2Fuser.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c2c6ca37b835443766f9653bb1009457dda4009e/api%2Fsrc%2Froutes%2Fprotected%2Fuser.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fprotected%2Fuser.ts?ref=c2c6ca37b835443766f9653bb1009457dda4009e",
            "patch": "@@ -536,6 +536,14 @@ export const userRoutes: FastifyPluginCallbackTypebox = (\n     examEnvironmentTokenHandler\n   );\n \n+  fastify.get(\n+    '/user/exam-environment/token',\n+    {\n+      schema: schemas.getUserExamEnvironmentToken\n+    },\n+    getExamEnvironmentToken\n+  );\n+\n   fastify.get(\n     '/user/exam-environment/exam/attempts',\n     {\n@@ -810,3 +818,41 @@ export const userGetRoutes: FastifyPluginCallbackTypebox = (\n \n   done();\n };\n+\n+async function getExamEnvironmentToken(\n+  this: FastifyInstance,\n+  req: UpdateReqType<typeof schemas.getUserExamEnvironmentToken>,\n+  reply: FastifyReply\n+) {\n+  const logger = this.log.child({ req, res: reply });\n+  logger.info(`User ${req.user?.id} requested their exam environment token`);\n+  const userId = req.user?.id;\n+  if (!userId) {\n+    throw new Error('Unreachable. User should be authenticated.');\n+  }\n+\n+  const token = await this.prisma.examEnvironmentAuthorizationToken.findUnique({\n+    where: {\n+      userId,\n+      expireAt: {\n+        gt: new Date()\n+      }\n+    }\n+  });\n+\n+  if (!token) {\n+    void reply.code(404);\n+    return reply.send(\n+      ERRORS.FCC_ERR_EXAM_ENVIRONMENT('No valid token found for user.')\n+    );\n+  }\n+\n+  const examEnvironmentAuthorizationToken = jwt.sign(\n+    { examEnvironmentAuthorizationToken: token.id },\n+    JWT_SECRET\n+  );\n+\n+  return reply.send({\n+    examEnvironmentAuthorizationToken\n+  });\n+}"
        },
        {
            "sha": "08bcb8bf5dfbcefd5cd25e27708ecb0bb025d849",
            "filename": "api/src/schemas.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c2c6ca37b835443766f9653bb1009457dda4009e/api%2Fsrc%2Fschemas.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c2c6ca37b835443766f9653bb1009457dda4009e/api%2Fsrc%2Fschemas.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas.ts?ref=c2c6ca37b835443766f9653bb1009457dda4009e",
            "patch": "@@ -44,5 +44,8 @@ export { postMsUsername } from './schemas/user/post-ms-username.js';\n export { reportUser } from './schemas/user/report-user.js';\n export { resetMyProgress } from './schemas/user/reset-my-progress.js';\n export { submitSurvey } from './schemas/user/submit-survey.js';\n-export { userExamEnvironmentToken } from './schemas/user/exam-environment-token.js';\n+export {\n+  userExamEnvironmentToken,\n+  getUserExamEnvironmentToken\n+} from './schemas/user/exam-environment-token.js';\n export { sentryPostEvent } from './schemas/sentry/event.js';"
        },
        {
            "sha": "8070c8e930c0720747a378da11ac96105018e7dc",
            "filename": "api/src/schemas/user/exam-environment-token.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c2c6ca37b835443766f9653bb1009457dda4009e/api%2Fsrc%2Fschemas%2Fuser%2Fexam-environment-token.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c2c6ca37b835443766f9653bb1009457dda4009e/api%2Fsrc%2Fschemas%2Fuser%2Fexam-environment-token.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fuser%2Fexam-environment-token.ts?ref=c2c6ca37b835443766f9653bb1009457dda4009e",
            "patch": "@@ -10,3 +10,12 @@ export const userExamEnvironmentToken = {\n     // default: STANDARD_ERROR\n   }\n };\n+\n+export const getUserExamEnvironmentToken = {\n+  response: {\n+    200: Type.Object({\n+      examEnvironmentAuthorizationToken: Type.String()\n+    }),\n+    404: STANDARD_ERROR\n+  }\n+};"
        },
        {
            "sha": "64936a1e998153a5cb3661ce93c33bab2f92817d",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=c2c6ca37b835443766f9653bb1009457dda4009e",
            "patch": "@@ -391,7 +391,8 @@\n     \"version\": \"The latest version of our app is: {{version}}.\",\n     \"download-details\": \"Manually download the app\",\n     \"unable-to-detect-os\": \"We were unable to detect your operating system. Please manually download the app below.\",\n-    \"download-trouble\": \"If you have trouble downloading the correct version, do not hesitate to contact support:\"\n+    \"download-trouble\": \"If you have trouble downloading the correct version, do not hesitate to contact support:\",\n+    \"open-exam-application\": \"Open Exam Environment Application\"\n   },\n   \"profile\": {\n     \"you-change-privacy\": \"You need to change your privacy setting in order for your portfolio to be seen by others. This is a preview of how your portfolio will look when made public.\",\n@@ -1280,12 +1281,16 @@\n   \"exam-token\": {\n     \"exam-token\": \"Exam Token\",\n     \"note\": \"Your exam token is a secret key that allows you to access exams. Do not share this token with anyone.\",\n-    \"invalidation\": \"If you generate a new token, your old token will be invalidated.\",\n+    \"invalidation-1\": \"It looks like you have a valid exam token. If you generate a new one, your existing token will be invalidated.\",\n+    \"invalidation-2\": \"If you generate a new token, your existing token will be invalidated.\",\n     \"generate-exam-token\": \"Generate Exam Token\",\n     \"error\": \"There was an error generating your token, please try again in a moment.\",\n-    \"your-exam-token\": \"Your Exam Token is: {{token}}\",\n+    \"no-token\": \"It looks like you don't have a valid exam token.\",\n+    \"copy\": \"Copy Exam Token\",\n     \"copied\": \"Token copied to clipboard\",\n-    \"copy-error\": \"Error copying token to clipboard\"\n+    \"copy-error\": \"Error copying token to clipboard\",\n+    \"token-usage\": \"Your Exam Environment authorization token is used to log you into the desktop application.\",\n+    \"generated\": \"A new Exam Environment authorization token has been generated for your account.\"\n   },\n   \"shortcuts\": {\n     \"title\": \"Keyboard shortcuts\","
        },
        {
            "sha": "775f47cde1cf086123489aa05e67dccdbc0b08be",
            "filename": "client/src/redux/create-store.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 3,
            "changes": 15,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Fredux%2Fcreate-store.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Fredux%2Fcreate-store.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fcreate-store.ts?ref=c2c6ca37b835443766f9653bb1009457dda4009e",
            "patch": "@@ -6,7 +6,10 @@ import { configureStore } from '@reduxjs/toolkit';\n \n import envData from '../../config/env.json';\n import { isBrowser } from '../../utils';\n-import { examAttempts } from '../utils/ajax';\n+import {\n+  examAttempts,\n+  examEnvironmentAuthorizationTokenApi\n+} from '../utils/ajax';\n import rootEpic from './root-epic';\n import rootReducer from './root-reducer';\n import rootSaga from './root-saga';\n@@ -44,8 +47,13 @@ export const createStore = (preloadedState = {}) => {\n     store = reduxCreateStore(\n       rootReducer,\n       preloadedState,\n-      // @ts-expect-error RTK uses unknown, Redux uses any\n-      applyMiddleware(sagaMiddleware, epicMiddleware, examAttempts.middleware)\n+      applyMiddleware(\n+        sagaMiddleware,\n+        epicMiddleware,\n+        // @ts-expect-error RTK uses unknown, Redux uses any\n+        examAttempts.middleware,\n+        examEnvironmentAuthorizationTokenApi.middleware\n+      )\n     );\n   } else {\n     // store = reduxCreateStore(\n@@ -63,6 +71,7 @@ export const createStore = (preloadedState = {}) => {\n       middleware: getDefaultMiddleware => {\n         return getDefaultMiddleware()\n           .concat(examAttempts.middleware)\n+          .concat(examEnvironmentAuthorizationTokenApi.middleware)\n           .concat(sagaMiddleware)\n           .concat(epicMiddleware);\n       },"
        },
        {
            "sha": "edf7a47c84ef6904ff4869bfbc58b5f1ef1e8a01",
            "filename": "client/src/redux/index.js",
            "status": "modified",
            "additions": 17,
            "deletions": 15,
            "changes": 32,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Fredux%2Findex.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Fredux%2Findex.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Findex.js?ref=c2c6ca37b835443766f9653bb1009457dda4009e",
            "patch": "@@ -180,21 +180,23 @@ export const reducer = handleActions(\n       ...state,\n       userProfileFetchState: { ...defaultFetchState }\n     }),\n-    [actionTypes.fetchUserComplete]: (state, { payload: { user } }) => ({\n-      ...state,\n-      user: {\n-        ...state.user,\n-        sessionUser: user\n-      },\n-      currentChallengeId:\n-        user?.currentChallengeId || store.get(CURRENT_CHALLENGE_KEY),\n-      userFetchState: {\n-        pending: false,\n-        complete: true,\n-        errored: false,\n-        error: null\n-      }\n-    }),\n+    [actionTypes.fetchUserComplete]: (state, { payload: { user } }) => {\n+      return {\n+        ...state,\n+        user: {\n+          ...state.user,\n+          sessionUser: user\n+        },\n+        currentChallengeId:\n+          user?.currentChallengeId || store.get(CURRENT_CHALLENGE_KEY),\n+        userFetchState: {\n+          pending: false,\n+          complete: true,\n+          errored: false,\n+          error: null\n+        }\n+      };\n+    },\n     [actionTypes.fetchUserTimeout]: state => ({\n       ...state,\n       userFetchState: {"
        },
        {
            "sha": "d388b2d96cb3fa1e4b2934d29dcf1af4c9ba045e",
            "filename": "client/src/redux/root-reducer.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Fredux%2Froot-reducer.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Fredux%2Froot-reducer.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Froot-reducer.ts?ref=c2c6ca37b835443766f9653bb1009457dda4009e",
            "patch": "@@ -13,7 +13,10 @@ import {\n   ns as curriculumMapNameSpace,\n   reducer as curriculumMap\n } from '../templates/Introduction/redux';\n-import { examAttempts } from '../utils/ajax';\n+import {\n+  examAttempts,\n+  examEnvironmentAuthorizationTokenApi\n+} from '../utils/ajax';\n import { ns as appNameSpace } from './action-types';\n import { ns as settingsNameSpace, reducer as settings } from './settings';\n import { FlashApp as flashNameSpace } from './types';\n@@ -26,5 +29,7 @@ export default combineReducers({\n   [flashNameSpace]: flash,\n   [searchNameSpace]: search,\n   [settingsNameSpace]: settings,\n-  [examAttempts.reducerPath]: examAttempts.reducer\n+  [examAttempts.reducerPath]: examAttempts.reducer,\n+  [examEnvironmentAuthorizationTokenApi.reducerPath]:\n+    examEnvironmentAuthorizationTokenApi.reducer\n });"
        },
        {
            "sha": "acdeb2bae2247b33ff96f4091a1be4a0e493ab29",
            "filename": "client/src/templates/Challenges/exam-download/attempts.tsx",
            "status": "modified",
            "additions": 11,
            "deletions": 10,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fattempts.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fattempts.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fattempts.tsx?ref=c2c6ca37b835443766f9653bb1009457dda4009e",
            "patch": "@@ -6,13 +6,14 @@ import { Loader } from '../../../components/helpers';\n import { examAttempts } from '../../../utils/ajax';\n \n interface AttemptsProps {\n-  id: string;\n+  examChallengeId: string;\n }\n \n-export function Attempts({ id }: AttemptsProps) {\n+export function Attempts({ examChallengeId }: AttemptsProps) {\n   const { t } = useTranslation();\n \n-  const examIdsQuery = examAttempts.useGetExamIdsByChallengeIdQuery(id);\n+  const examIdsQuery =\n+    examAttempts.useGetExamIdsByChallengeIdQuery(examChallengeId);\n   const [getAttempts, attemptsMutation] =\n     examAttempts.useGetExamAttemptsByExamIdMutation();\n \n@@ -21,7 +22,11 @@ export function Attempts({ id }: AttemptsProps) {\n       return;\n     }\n \n-    const examId = examIdsQuery.data.at(0)!.examId;\n+    const examId = examIdsQuery.data.at(0)?.examId;\n+    if (examId === undefined) {\n+      return;\n+    }\n+\n     void getAttempts(examId);\n   }, [examIdsQuery.data, getAttempts]);\n \n@@ -40,11 +45,7 @@ export function Attempts({ id }: AttemptsProps) {\n \n   const attempts = attemptsMutation.data;\n \n-  if (attempts === undefined) {\n-    return <Loader />;\n-  }\n-\n-  if (attempts.length === 0) {\n+  if (attempts === undefined || attempts.length === 0) {\n     return <p>{t('exam.no-attempts-yet')}</p>;\n   }\n \n@@ -63,7 +64,7 @@ export function Attempts({ id }: AttemptsProps) {\n             <td>{new Date(attempt.startTime).toTimeString()}</td>\n             <td>\n               {attempt.result\n-                ? `${attempt.result.percent}%`\n+                ? `${attempt.result.score.toFixed(2)}%`\n                 : t('exam.pending')}\n             </td>\n             <td>"
        },
        {
            "sha": "c656be389a37f9b543b5c2996197f177b2d88cf3",
            "filename": "client/src/templates/Challenges/exam-download/exam-token-controls.tsx",
            "status": "added",
            "additions": 95,
            "deletions": 0,
            "changes": 95,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fexam-token-controls.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fexam-token-controls.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fexam-token-controls.tsx?ref=c2c6ca37b835443766f9653bb1009457dda4009e",
            "patch": "@@ -0,0 +1,95 @@\n+import React, { useState } from 'react';\n+import { useTranslation } from 'react-i18next';\n+import { Button, Spacer } from '@freecodecamp/ui';\n+\n+import { examEnvironmentAuthorizationTokenApi } from '../../../utils/ajax';\n+import { Loader } from '../../../components/helpers';\n+\n+export function ExamTokenControls(): JSX.Element {\n+  const { t } = useTranslation();\n+\n+  const [copySuccess, setCopySuccess] = useState<string | null>(null);\n+  const [copyError, setCopyError] = useState<string | null>(null);\n+\n+  const [generateToken, generateMutation] =\n+    examEnvironmentAuthorizationTokenApi.usePostGenerateExamEnvironmentAuthorizationTokenMutation();\n+\n+  const getTokenQuery =\n+    examEnvironmentAuthorizationTokenApi.useGetExamEnvironmentAuthorizationTokenQuery();\n+  const existingToken = getTokenQuery.data?.examEnvironmentAuthorizationToken;\n+  const updatedToken = generateMutation.data?.examEnvironmentAuthorizationToken;\n+  const token = updatedToken ?? existingToken;\n+\n+  function handleCopyExamToken() {\n+    navigator.clipboard.writeText(token ?? '').then(\n+      () => {\n+        setCopySuccess(t('exam-token.copied'));\n+        setCopyError(null);\n+      },\n+      () => {\n+        setCopyError(t('exam-token.copy-error'));\n+        setCopySuccess(null);\n+      }\n+    );\n+  }\n+\n+  return (\n+    <>\n+      <h3>{t('exam-token.exam-token')}</h3>\n+      <p>{t('exam-token.token-usage')}</p>\n+      {generateMutation.isError && (\n+        <p style={{ color: 'var(--danger-color)' }}>{t('exam-token.error')}</p>\n+      )}\n+      {generateMutation.isSuccess && (\n+        <p style={{ color: 'var(--success-color)' }}>\n+          {t('exam-token.generated')}\n+        </p>\n+      )}\n+      {!!token && generateMutation.isSuccess && (\n+        <p style={{ color: 'var(--yellow-color)' }}>\n+          {t('exam-token.invalidation-2')}\n+        </p>\n+      )}\n+      {!!token && !generateMutation.isSuccess && (\n+        <p style={{ color: 'var(--yellow-color)' }}>\n+          {t('exam-token.invalidation-1')}\n+        </p>\n+      )}\n+      {getTokenQuery.isError && !token && (\n+        <p style={{ color: 'var(--highlight-color)' }}>\n+          {t('exam-token.no-token')}\n+        </p>\n+      )}\n+      {generateMutation.isLoading || getTokenQuery.isLoading ? (\n+        <Button block={true}>\n+          <Loader />\n+        </Button>\n+      ) : (\n+        <Button\n+          block={true}\n+          disabled={generateMutation.isLoading || getTokenQuery.isLoading}\n+          onClick={() => void generateToken()}\n+        >\n+          {t('exam-token.generate-exam-token')}\n+        </Button>\n+      )}\n+      <Spacer size='s' />\n+      {copySuccess && (\n+        <p style={{ color: 'var(--success-color)' }}>{copySuccess}</p>\n+      )}\n+      {copyError && <p style={{ color: 'var(--danger-color)' }}>{copyError}</p>}\n+      {generateMutation.isLoading || getTokenQuery.isLoading ? (\n+        <Button block={true}>\n+          <Loader />\n+        </Button>\n+      ) : (\n+        <Button block={true} disabled={!token} onClick={handleCopyExamToken}>\n+          {t('exam-token.copy')}\n+        </Button>\n+      )}\n+      <Spacer size='m' />\n+    </>\n+  );\n+}\n+\n+export default ExamTokenControls;"
        },
        {
            "sha": "ef11b9779ab46f4b7d926a7cb8830e40cba2aee5",
            "filename": "client/src/templates/Challenges/exam-download/show.tsx",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fexam-download%2Fshow.tsx?ref=c2c6ca37b835443766f9653bb1009457dda4009e",
            "patch": "@@ -20,6 +20,7 @@ import { ChallengeNode } from '../../../redux/prop-types';\n import { isSignedInSelector } from '../../../redux/selectors';\n import { isChallengeCompletedSelector } from '../redux/selectors';\n import { Attempts } from './attempts';\n+import ExamTokenControls from './exam-token-controls';\n \n interface GitProps {\n   tag_name: string;\n@@ -156,15 +157,21 @@ function ShowExamDownload({\n         {isSignedIn && (\n           <>\n             <h2>{t('exam.attempts')}</h2>\n-            <Attempts id={id} />\n+            <Attempts examChallengeId={id} />\n             <Spacer size='l' />\n+            <ExamTokenControls />\n           </>\n         )}\n         <p>\n           {t('exam.version', {\n             version: latestVersion || '...'\n           })}\n         </p>\n+        {/* TODO: confirm this works on MacOS */}\n+        <Button href={'exam-environment://'}>\n+          {t('exam.open-exam-application')}\n+        </Button>\n+        <Spacer size='s' />\n         <Button\n           disabled={!downloadLink}\n           aria-disabled={!downloadLink}\n@@ -186,14 +193,15 @@ function ShowExamDownload({\n             {downloadLinks\n               .filter(link => !link.match(/\\.sig|\\.json/))\n               .map((link, index) => {\n+                const urlEnd = link.split('/').pop() ?? '';\n                 return (\n                   <MenuItem\n                     href={link}\n                     download={link}\n                     key={index}\n                     variant='primary'\n                   >\n-                    {link}\n+                    {urlEnd}\n                   </MenuItem>\n                 );\n               })}\n@@ -202,6 +210,7 @@ function ShowExamDownload({\n         <Spacer size='l' />\n         <strong>{t('exam.download-trouble')}</strong>{' '}\n         <a href='mailto: support@freecodecamp.org'>support@freecodecamp.org</a>\n+        <Spacer size='l' />\n       </Container>\n     </LearnLayout>\n   );"
        },
        {
            "sha": "295caae70ca0ef5734de5c59e2283ec590bf43f4",
            "filename": "client/src/utils/ajax.ts",
            "status": "modified",
            "additions": 29,
            "deletions": 1,
            "changes": 30,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Futils%2Fajax.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c2c6ca37b835443766f9653bb1009457dda4009e/client%2Fsrc%2Futils%2Fajax.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Fajax.ts?ref=c2c6ca37b835443766f9653bb1009457dda4009e",
            "patch": "@@ -228,7 +228,7 @@ export interface Attempt {\n   questionSets: unknown[];\n   result?: {\n     passed: boolean;\n-    percent: number;\n+    score: number;\n   };\n }\n \n@@ -449,3 +449,31 @@ export const examAttempts = createApi({\n     })\n   })\n });\n+\n+export const examEnvironmentAuthorizationTokenApi = createApi({\n+  reducerPath: 'exam-environment-authorization-token',\n+  baseQuery: fetchBaseQuery({\n+    baseUrl: apiLocation,\n+    headers: {\n+      'CSRF-Token': getCSRFToken()\n+    },\n+    credentials: 'include'\n+  }),\n+  endpoints: build => ({\n+    postGenerateExamEnvironmentAuthorizationToken: build.mutation<\n+      ExamTokenResponse,\n+      void\n+    >({\n+      query: () => ({\n+        url: `/user/exam-environment/token`,\n+        method: 'POST'\n+      })\n+    }),\n+    getExamEnvironmentAuthorizationToken: build.query<ExamTokenResponse, void>({\n+      query: () => ({\n+        url: `/user/exam-environment/token`,\n+        method: 'GET'\n+      })\n+    })\n+  })\n+});"
        }
    ],
    "stats": {
        "total": 288,
        "additions": 250,
        "deletions": 38
    }
}