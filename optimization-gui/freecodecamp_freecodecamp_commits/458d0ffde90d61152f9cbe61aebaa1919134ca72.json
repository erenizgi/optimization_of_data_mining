{
    "author": "ojeytonwilliams",
    "message": "feat: allow scenes to be paused (#58150)\n\nCo-authored-by: moT01 <20648924+moT01@users.noreply.github.com>",
    "sha": "458d0ffde90d61152f9cbe61aebaa1919134ca72",
    "files": [
        {
            "sha": "2296100709ab1ec9c51b2309539eb704857fd28e",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=458d0ffde90d61152f9cbe61aebaa1919134ca72",
            "patch": "@@ -105,7 +105,8 @@\n     \"update-card\": \"Update your card\",\n     \"donate-now\": \"Donate Now\",\n     \"confirm-amount\": \"Confirm amount\",\n-    \"play-scene\": \"Press Play\",\n+    \"play\": \"Play Video\",\n+    \"pause\": \"Pause Video\",\n     \"closed-caption\": \"Closed caption\",\n     \"share-on-x\": \"Share on X\",\n     \"share-on-bluesky\": \"Share on BlueSky\",\n@@ -1171,7 +1172,7 @@\n     \"focus-instructions-panel\": \"Focus Instructions Panel\",\n     \"navigate-previous\": \"Navigate To Previous Exercise\",\n     \"navigate-next\": \"Navigate To Next Exercise\",\n-    \"play-scene\": \"Play Scene\"\n+    \"play-video\": \"Play Video\"\n   },\n   \"signout\": {\n     \"heading\": \"Sign out of your account\","
        },
        {
            "sha": "f93f081e9d311607adcd07328eb00647f9ad9186",
            "filename": "client/src/assets/icons/closedcaptions.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Fassets%2Ficons%2Fclosedcaptions.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Fassets%2Ficons%2Fclosedcaptions.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fassets%2Ficons%2Fclosedcaptions.tsx?ref=458d0ffde90d61152f9cbe61aebaa1919134ca72",
            "patch": "@@ -6,11 +6,10 @@ function ClosedCaptionsIcon(\n   return (\n     <svg\n       xmlns='http://www.w3.org/2000/svg'\n-      viewBox='0 0 256 256'\n+      viewBox='0 0 576 512'\n       fill={props.fill || 'var(--gray-00)'}\n     >\n-      <rect width='256' height='256' fill='none' />\n-      <path d='M216,40H40A16.01833,16.01833,0,0,0,24,56V200a16.01833,16.01833,0,0,0,16,16H216a16.01833,16.01833,0,0,0,16-16V56A16.01833,16.01833,0,0,0,216,40ZM96,148a19.85259,19.85259,0,0,0,14.28613-6.00293,7.99956,7.99956,0,0,1,11.42774,11.19727,36,36,0,1,1,0-50.38868,7.99956,7.99956,0,0,1-11.42774,11.19727A20.00012,20.00012,0,1,0,96,148Zm72,0a19.85259,19.85259,0,0,0,14.28613-6.00293,7.99956,7.99956,0,0,1,11.42774,11.19727,36,36,0,1,1,0-50.38868,7.99956,7.99956,0,0,1-11.42774,11.19727A20.00012,20.00012,0,1,0,168,148Z' />\n+      <path d='M0 96C0 60.7 28.7 32 64 32l448 0c35.3 0 64 28.7 64 64l0 320c0 35.3-28.7 64-64 64L64 480c-35.3 0-64-28.7-64-64L0 96zM200 208c14.2 0 27 6.1 35.8 16c8.8 9.9 24 10.7 33.9 1.9s10.7-24 1.9-33.9c-17.5-19.6-43.1-32-71.5-32c-53 0-96 43-96 96s43 96 96 96c28.4 0 54-12.4 71.5-32c8.8-9.9 8-25-1.9-33.9s-25-8-33.9 1.9c-8.8 9.9-21.6 16-35.8 16c-26.5 0-48-21.5-48-48s21.5-48 48-48zm144 48c0-26.5 21.5-48 48-48c14.2 0 27 6.1 35.8 16c8.8 9.9 24 10.7 33.9 1.9s10.7-24 1.9-33.9c-17.5-19.6-43.1-32-71.5-32c-53 0-96 43-96 96s43 96 96 96c28.4 0 54-12.4 71.5-32c8.8-9.9 8-25-1.9-33.9s-25-8-33.9 1.9c-8.8 9.9-21.6 16-35.8 16c-26.5 0-48-21.5-48-48z' />\n     </svg>\n   );\n }"
        },
        {
            "sha": "76b5a316968f16756b310eb551d76d376a22c99b",
            "filename": "client/src/components/layouts/variables.css",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Fcomponents%2Flayouts%2Fvariables.css",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Fcomponents%2Flayouts%2Fvariables.css",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Flayouts%2Fvariables.css?ref=458d0ffde90d61152f9cbe61aebaa1919134ca72",
            "patch": "@@ -1,6 +1,7 @@\n :root {\n   --theme-color: #0a0a23;\n   --yellow-gold: #ffbf00;\n+  --gray-00-translucent: rgba(255, 255, 255, 0.85);\n   --gray-00: #ffffff;\n   --gray-05: #f5f6f7;\n   --gray-10: #dfdfe2;\n@@ -10,6 +11,7 @@\n   --gray-80: #2a2a40;\n   --gray-85: #1b1b32;\n   --gray-90: #0a0a23;\n+  --gray-90-translucent: rgba(10, 10, 35, 0.85);\n   --purple-light: #dbb8ff;\n   --purple-dark: #5a01a7;\n   --yellow-light: #ffc300;\n@@ -43,6 +45,7 @@\n }\n \n .dark-palette {\n+  --primary-color-translucent: var(--gray-00-translucent);\n   --primary-color: var(--gray-00);\n   --secondary-color: var(--gray-05);\n   --tertiary-color: var(--gray-10);\n@@ -51,6 +54,7 @@\n   --tertiary-background: var(--gray-80);\n   --secondary-background: var(--gray-85);\n   --primary-background: var(--gray-90);\n+  --primary-background-translucent: var(--gray-90-translucent);\n   --highlight-color: var(--blue-light);\n   --highlight-background: var(--blue-dark);\n   --selection-color: var(--blue-light-translucent);\n@@ -67,6 +71,7 @@\n }\n \n .light-palette {\n+  --primary-color-translucent: var(--gray-90-translucent);\n   --primary-color: var(--gray-90);\n   --secondary-color: var(--gray-85);\n   --tertiary-color: var(--gray-80);\n@@ -75,6 +80,7 @@\n   --tertiary-background: var(--gray-10);\n   --secondary-background: var(--gray-05);\n   --primary-background: var(--gray-00);\n+  --primary-background-translucent: var(--gray-00-translucent);\n   --highlight-color: var(--blue-dark);\n   --highlight-background: var(--blue-light);\n   --selection-color: var(--blue-dark-translucent);"
        },
        {
            "sha": "0c125db768fa1641ea255bbe66721415f43ccb12",
            "filename": "client/src/templates/Challenges/components/scene/character.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fcharacter.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fcharacter.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fcharacter.tsx?ref=458d0ffde90d61152f9cbe61aebaa1919134ca72",
            "patch": "@@ -35,7 +35,7 @@ export function Character({\n   const [mouthIsOpen, setMouthIsOpen] = useState(false);\n   const [isPlaying, setIsPlaying] = useState(false);\n \n-  const onNotify = (eventType: 'play' | 'stop') => {\n+  const onNotify = (eventType: 'play' | 'pause' | 'stop') => {\n     if (eventType === 'play') {\n       setIsPlaying(true);\n     } else {"
        },
        {
            "sha": "e5e724d1fe0dbf2a516c0c44bb2a3e5c37faf500",
            "filename": "client/src/templates/Challenges/components/scene/scene-assets.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fscene-assets.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fscene-assets.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fscene-assets.tsx?ref=458d0ffde90d61152f9cbe61aebaa1919134ca72",
            "patch": "@@ -3,7 +3,7 @@ const domain =\n   'https://cdn.freecodecamp.org/curriculum/english/animation-assets';\n \n export const sounds = `${domain}/sounds`;\n-export const images = `${domain}/images`;\n+const images = `${domain}/images`;\n export const backgrounds = `${images}/backgrounds`;\n export const characters = `${images}/characters`;\n "
        },
        {
            "sha": "ebc3deead455d46d864f5d4491935fc48d1dcc59",
            "filename": "client/src/templates/Challenges/components/scene/scene-subject.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fscene-subject.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fscene-subject.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fscene-subject.tsx?ref=458d0ffde90d61152f9cbe61aebaa1919134ca72",
            "patch": "@@ -1,4 +1,4 @@\n-type Observer = (eventType: 'play' | 'stop') => void;\n+type Observer = (eventType: 'play' | 'pause' | 'stop') => void;\n \n export class SceneSubject {\n   #observers: Observer[];\n@@ -16,7 +16,7 @@ export class SceneSubject {\n \n   // For now, we don't need to pass any data to the observers, so notify()\n   // doesn't take any arguments.\n-  notify(eventType: 'play' | 'stop') {\n+  notify(eventType: 'play' | 'pause' | 'stop') {\n     this.#observers.forEach(observer => observer(eventType));\n   }\n }"
        },
        {
            "sha": "0d929dff7d77706c5974e818c6d6696dd9d3236b",
            "filename": "client/src/templates/Challenges/components/scene/scene.css",
            "status": "modified",
            "additions": 39,
            "deletions": 46,
            "changes": 85,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fscene.css",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fscene.css",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fscene.css?ref=458d0ffde90d61152f9cbe61aebaa1919134ca72",
            "patch": "@@ -4,60 +4,24 @@\n   color: var(--gray-00);\n }\n \n-.scene-start-screen {\n-  position: absolute;\n-  width: 100%;\n-  height: 100%;\n-  max-width: 100%;\n-  max-height: 100%;\n-  background-color: rgba(10, 10, 35, 0.5);\n+.scene-dialogue-wrap {\n   display: flex;\n-  align-items: center;\n-  justify-content: center;\n   flex-direction: column;\n-  color: var(--gray-00);\n-}\n-\n-.scene-start-btn,\n-.scene-start-btn:hover,\n-.scene-start-btn:focus,\n-.scene-start-btn:active {\n-  background-color: rgba(0, 0, 0, 0);\n-  border: none;\n-  scale: 0.75;\n-}\n-\n-.scene-a11y-btn {\n-  position: absolute;\n-  right: 5px;\n-  bottom: 5px;\n-  text-align: right;\n-  display: flex;\n-  align-items: center;\n-  justify-content: center;\n-}\n-\n-.scene-play-btn img {\n-  transform: translate(5px, 10px);\n-}\n-\n-.scene-a11y-btn svg {\n-  width: calc(50px + 3vw);\n-  height: calc(50px + 3vw);\n-}\n-\n-.scene-dialogue-wrap {\n+  justify-content: space-evenly;\n   position: absolute;\n   bottom: 0;\n-  padding: calc(5px + 0.25vw) calc(5px + 4vw);\n-  background: rgba(10, 10, 35, 0.9);\n-  font-size: calc(0.25vw + 0.75rem);\n   width: 100%;\n+  padding: 5px calc(5px + 3.5vw);\n+  font-size: calc(0.25vw + 0.75rem);\n   min-height: calc(35px + 1vw + 2rem);\n+  flex: 0 0 80%;\n+  background: var(--primary-background-translucent);\n+  color: var(--primary-color);\n }\n \n .scene-dialogue-label {\n-  color: var(--blue-light);\n+  color: var(--highlight-color);\n+  font-weight: bold;\n }\n \n .scene-dialogue-align-left {\n@@ -74,5 +38,34 @@\n \n .scene-dialogue-text {\n   font-size: calc(0.25vw + 1rem);\n-  padding: 5px 10px;\n+  padding: 0 10px;\n+}\n+\n+.scene-controls {\n+  display: flex;\n+  justify-content: space-between;\n+  align-self: center;\n+  background: var(--primary-background);\n+  padding: 0 10px;\n+  min-height: 60px;\n+  max-height: 60px;\n+}\n+\n+.scene-btn,\n+.scene-btn:hover,\n+.scene-btn:focus,\n+.scene-btn:active {\n+  color: var(--tertiary-color);\n+  background: rgba(0, 0, 0, 0);\n+  border: none;\n+  scale: 0.75;\n+}\n+\n+.scene-play-btn {\n+  background: rgba(0, 0, 0, 0);\n+}\n+\n+.scene-a11y-btn svg {\n+  width: 60px;\n+  height: 60px;\n }"
        },
        {
            "sha": "488e1080a29b9cd79841aaecaede99148e75d6e2",
            "filename": "client/src/templates/Challenges/components/scene/scene.tsx",
            "status": "modified",
            "additions": 151,
            "deletions": 89,
            "changes": 240,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fscene.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fscene.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fscene.tsx?ref=458d0ffde90d61152f9cbe61aebaa1919134ca72",
            "patch": "@@ -6,12 +6,14 @@ import React, {\n   useCallback\n } from 'react';\n import { Col, Spacer } from '@freecodecamp/ui';\n+import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n+import { faCirclePause, faCirclePlay } from '@fortawesome/free-solid-svg-icons';\n import { isEmpty } from 'lodash-es';\n import { useTranslation } from 'react-i18next';\n import { FullScene } from '../../../../redux/prop-types';\n import { Loader } from '../../../../components/helpers';\n import ClosedCaptionsIcon from '../../../../assets/icons/closedcaptions';\n-import { sounds, images, backgrounds, characterAssets } from './scene-assets';\n+import { sounds, backgrounds, characterAssets } from './scene-assets';\n import Character from './character';\n import { SceneSubject } from './scene-subject';\n \n@@ -46,6 +48,27 @@ export function Scene({\n       ? sToMs(audio.finishTimestamp - audio.startTimestamp)\n       : Infinity;\n \n+  const pauseAudio = () => {\n+    // Until the play() promise resolves, we can't pause the audio\n+    if (canPauseRef.current) audioRef.current.pause();\n+    canPauseRef.current = false;\n+    clearTimeout(startTimerRef.current);\n+    clearTimeout(finishTimerRef.current);\n+  };\n+\n+  const pauseAnimation = () => {\n+    setIsPlaying(false);\n+    // @ts-expect-error cancelAnimationFrame accepts undefined, but TS doesn't\n+    // know that\n+    window.cancelAnimationFrame(animationRef.current);\n+  };\n+\n+  const resetAudio = useCallback(() => {\n+    pauseAudio();\n+    audioRef.current.currentTime = audio.startTimestamp || 0;\n+    pausedAtRef.current = 0;\n+  }, [audio.startTimestamp]);\n+\n   // on mount\n   useEffect(() => {\n     const { current } = audioRef;\n@@ -77,17 +100,14 @@ export function Scene({\n \n     // on unmount\n     return () => {\n-      if (current) {\n-        current.pause();\n-        current.currentTime = 0;\n-        current.removeEventListener('canplaythrough', audioLoaded);\n-      }\n+      resetAudio();\n+      current.removeEventListener('canplaythrough', audioLoaded);\n     };\n-  }, [audioRef, duration, setup, commands]);\n+  }, [duration, setup, commands, resetAudio]);\n \n   const initBackground = setup.background;\n \n-  // The charactesr are memoized to prevent the useEffect from running on every\n+  // The characters are memoized to prevent the useEffect from running on every\n   // render,\n   const initCharacters = useMemo(\n     () =>\n@@ -103,12 +123,12 @@ export function Scene({\n \n   const [isPlaying, setIsPlaying] = useState(false);\n   const [sceneIsReady, setSceneIsReady] = useState(false);\n-  const [showDialogue, setShowDialogue] = useState(false);\n   const [accessibilityOn, setAccessibilityOn] = useState(false);\n   const [characters, setCharacters] = useState(initCharacters);\n   const [dialogue, setDialogue] = useState(initDialogue);\n   const [background, setBackground] = useState(initBackground);\n-  const startRef = useRef<number>(0);\n+  const startClocktimeRef = useRef<number>(0);\n+  const pausedAtRef = useRef<number>(0);\n   const startTimerRef = useRef<number>();\n   const finishTimerRef = useRef<number>();\n   const animationRef = useRef<number>();\n@@ -147,15 +167,10 @@ export function Scene({\n     setSceneIsReady(true);\n   };\n \n-  const pause = () => {\n-    // Until the play() promise resolves, we can't pause the audio\n-    if (canPauseRef.current) audioRef.current.pause();\n-    canPauseRef.current = false;\n-  };\n-\n   const handlePlay = useCallback(() => {\n+    const pausedAt = pausedAtRef.current;\n     const updateCurrentTime = () => {\n-      const time = Date.now() - startRef.current;\n+      const time = Date.now() - startClocktimeRef.current;\n       setCurrentTime(time);\n \n       if (isPlayingSceneRef.current) {\n@@ -168,75 +183,112 @@ export function Scene({\n     if (isPlaying || !sceneIsReady) return;\n     setIsPlaying(true);\n     isPlayingSceneRef.current = true;\n-    startRef.current = Date.now();\n-    setShowDialogue(true);\n \n+    // when we paused, the startRef was the clock time when we started and\n+    // pausedAt was the currentTime (i.e. how long we've been playing). That\n+    // means to resume we need to set the startRef to the current time minus\n+    // the time we've already played.\n+    startClocktimeRef.current = Date.now() - pausedAt;\n     updateCurrentTime();\n \n+    const audioStartDelay = sToMs(audio.startTime) - pausedAt;\n+\n     // @ts-expect-error it's not a node timer\n     startTimerRef.current = setTimeout(() => {\n       if (audioRef.current.paused) {\n         void audioRef.current.play().then(() => {\n           canPauseRef.current = true;\n+\n+          // If the duration is Infinity, that means the duration is simply the\n+          // length of the file. However we need to actively stop the audio to\n+          // ensure that cleanup (i.e. resetAudio is called) )\n+          const effectiveDuration =\n+            duration === Infinity ? sToMs(audioRef.current.duration) : duration;\n+\n+          // If the delay is positive, the setTimeout will have already waited\n+          // that amount of time. However, if it's negative, then the setTimeout\n+          // has no delay and we need to account for that when calculating how\n+          // much audio is left to play.\n+          const effectiveStartDelay = Math.min(0, audioStartDelay);\n+          const audioEndDelay = effectiveDuration + effectiveStartDelay;\n+\n+          if (audioEndDelay < 0) {\n+            resetAudio();\n+            return;\n+          }\n+          // @ts-expect-error it's not a node timer\n+          finishTimerRef.current = setTimeout(() => {\n+            const endTimeStamp = sToMs(audio.finishTimestamp!); // it exists because duration is not Infinity\n+            const audioCurrentTime = sToMs(audioRef.current.currentTime);\n+            const remainingTime = endTimeStamp - audioCurrentTime;\n+            // For some reason, despite the setTimeout resolving at the right\n+            // time, the currentTime can be smaller than expected. That means\n+            // that if we pause now it will cut off the last part.\n+            if (remainingTime < 100) {\n+              // 100ms is arbitrary and may need to be adjusted if people still\n+              // notice the cut off\n+\n+              resetAudio();\n+            } else {\n+              // @ts-expect-error it's not a node timer\n+              finishTimerRef.current = setTimeout(() => {\n+                resetAudio();\n+              }, remainingTime);\n+            }\n+          }, audioEndDelay);\n         });\n       }\n-    }, sToMs(audio.startTime));\n+    }, audioStartDelay);\n+  }, [audio, duration, isPlaying, resetAudio, sceneIsReady]);\n \n-    // @ts-expect-error it's not a node timer\n-    finishTimerRef.current = setTimeout(\n-      () => {\n-        if (duration !== Infinity) {\n-          const endTimeStamp = sToMs(audio.finishTimestamp!); // it exists because duration is not Infinity\n-          const audioCurrentTime = sToMs(audioRef.current.currentTime);\n-          const remainingTime = endTimeStamp - audioCurrentTime;\n-          // For some reason, despite the setTimeout resolving at the right\n-          // time, the currentTime can be smaller than expected. That means\n-          // that if we pause now it will cut off the last part.\n-          if (remainingTime < 100) {\n-            // 100ms is arbitrary and may need to be adjusted if people still\n-            // notice the cut off\n-\n-            pause();\n-          } else {\n-            // @ts-expect-error it's not a node timer\n-            finishTimerRef.current = setTimeout(() => {\n-              pause();\n-            }, remainingTime);\n-          }\n-        }\n-      },\n-      duration + sToMs(audio.startTime)\n-    );\n-  }, [audio, duration, isPlaying, sceneIsReady]);\n+  const handlePause = useCallback(() => {\n+    isPlayingSceneRef.current = false;\n+    pausedAtRef.current = currentTime;\n+    pauseAudio();\n+    pauseAnimation();\n+  }, [currentTime]);\n \n   const handleStop = useCallback(() => {\n     usedCommandsRef.current.clear();\n-    pause();\n+    pauseAudio();\n+    pauseAnimation();\n     audioRef.current.currentTime = audio.startTimestamp || 0;\n     setCurrentTime(0);\n     setIsPlaying(false);\n     isPlayingSceneRef.current = false;\n-    setShowDialogue(false);\n     setDialogue(initDialogue);\n     setCharacters(initCharacters);\n     setBackground(initBackground);\n   }, [audio, initCharacters, initBackground]);\n \n+  const resetAnimation = useCallback(() => {\n+    usedCommandsRef.current.clear();\n+    startClocktimeRef.current = 0;\n+    setCurrentTime(0);\n+    setDialogue(initDialogue);\n+    setCharacters(initCharacters);\n+    setBackground(initBackground);\n+  }, [initCharacters, initBackground]);\n+\n+  const resetScene = () => {\n+    setIsPlaying(false);\n+    isPlayingSceneRef.current = false;\n+    pausedAtRef.current = 0;\n+  };\n+\n   const onNotify = useCallback(\n-    (eventType: 'play' | 'stop') => {\n+    (eventType: 'play' | 'pause' | 'stop') => {\n       if (eventType === 'play') {\n         handlePlay();\n+      } else if (eventType === 'pause') {\n+        handlePause();\n       } else {\n         handleStop();\n       }\n     },\n-    [handlePlay, handleStop]\n+    [handlePlay, handlePause, handleStop]\n   );\n \n-  const resetScene = useCallback(() => {\n-    sceneSubject.notify('stop');\n-  }, [sceneSubject]);\n-\n   useEffect(() => {\n     sceneSubject.attach(onNotify);\n     return () => {\n@@ -279,10 +331,13 @@ export function Scene({\n       }\n     });\n \n-    // resetScene only works if called AFTER the commands, otherwise the\n-    // commands will undo the reset.\n-    if (currentTime >= resetTime) resetScene();\n-  }, [currentTime, resetTime, sortedCommands, resetScene]);\n+    if (currentTime >= resetTime) {\n+      // resetAnimation only works if called AFTER the commands, otherwise the\n+      // commands will undo the reset.\n+      resetAnimation();\n+      resetScene();\n+    }\n+  }, [currentTime, resetTime, sortedCommands, resetAnimation]);\n \n   useEffect(() => {\n     return () => {\n@@ -321,14 +376,14 @@ export function Scene({\n                     name={character}\n                     position={position}\n                     opacity={opacity}\n+                    isTalking={isPlaying && isTalking}\n                     sceneSubject={sceneSubject}\n-                    isTalking={isTalking}\n                   />\n                 );\n               }\n             )}\n \n-            {showDialogue && (alwaysShowDialogue || accessibilityOn) && (\n+            {(alwaysShowDialogue || accessibilityOn) && (\n               <div\n                 className={`scene-dialogue-wrap ${\n                   dialogue.align ? `scene-dialogue-align-${dialogue.align}` : ''\n@@ -338,38 +393,45 @@ export function Scene({\n                 <div className='scene-dialogue-text'>{dialogue.text}</div>\n               </div>\n             )}\n-\n-            {!isPlaying && (\n-              <div className='scene-start-screen'>\n-                <button\n-                  className='scene-start-btn scene-play-btn'\n-                  onClick={() => sceneSubject.notify('play')}\n-                >\n-                  <img\n-                    src={`${images}/play-button.png`}\n-                    alt={t('buttons.play-scene')}\n-                  />\n-                </button>\n-\n-                {!alwaysShowDialogue && (\n-                  <button\n-                    className='scene-start-btn scene-a11y-btn'\n-                    aria-label={t('buttons.closed-caption')}\n-                    aria-pressed={accessibilityOn}\n-                    onClick={() => setAccessibilityOn(!accessibilityOn)}\n-                  >\n-                    <ClosedCaptionsIcon\n-                      fill={\n-                        accessibilityOn ? 'var(--gray-00)' : 'var(--gray-15)'\n-                      }\n-                    />\n-                  </button>\n-                )}\n-              </div>\n-            )}\n           </>\n         )}\n       </div>\n+\n+      <div className='scene-controls'>\n+        <button\n+          className='scene-btn scene-play-btn'\n+          onClick={() => sceneSubject.notify(isPlaying ? 'pause' : 'play')}\n+        >\n+          {isPlaying ? (\n+            <>\n+              <span className='sr-only'>{t('buttons.pause')}</span>\n+              <FontAwesomeIcon icon={faCirclePause} size='3x' />\n+            </>\n+          ) : (\n+            <>\n+              <span className='sr-only'>{t('buttons.play')}</span>\n+              <FontAwesomeIcon icon={faCirclePlay} size='3x' />\n+            </>\n+          )}\n+        </button>\n+\n+        {alwaysShowDialogue ? (\n+          <div className='scene-a11y-btn'></div>\n+        ) : (\n+          <button\n+            className='scene-btn scene-a11y-btn'\n+            aria-label={t('buttons.closed-caption')}\n+            aria-pressed={accessibilityOn}\n+            onClick={() => setAccessibilityOn(!accessibilityOn)}\n+          >\n+            <ClosedCaptionsIcon\n+              fill={\n+                accessibilityOn ? 'var(--tertiary-color)' : 'var(--gray-45)'\n+              }\n+            />\n+          </button>\n+        )}\n+      </div>\n       <Spacer size='m' />\n     </Col>\n   );"
        },
        {
            "sha": "346151b4aa077a9fadbc3f3e8ae2fde123bc668f",
            "filename": "client/src/templates/Challenges/components/shortcuts-modal.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fshortcuts-modal.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/458d0ffde90d61152f9cbe61aebaa1919134ca72/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fshortcuts-modal.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fshortcuts-modal.tsx?ref=458d0ffde90d61152f9cbe61aebaa1919134ca72",
            "patch": "@@ -67,7 +67,7 @@ function ShortcutsModal({\n               <td>CTRL/Command + Enter</td>\n             </tr>\n             <tr>\n-              <td>{t('shortcuts.play-scene')}</td>\n+              <td>{t('shortcuts.play-video')}</td>\n               <td>CTRL + Space</td>\n             </tr>\n             <tr>"
        }
    ],
    "stats": {
        "total": 351,
        "additions": 206,
        "deletions": 145
    }
}