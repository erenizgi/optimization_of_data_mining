{
    "author": "ojeytonwilliams",
    "message": "test: simplify hotkey tests (#55315)\n\nCo-authored-by: Huyen Nguyen <25715018+huyenltnguyen@users.noreply.github.com>",
    "sha": "cf133c2f2756d0bc430aca2e6eb89aeb5fe634af",
    "files": [
        {
            "sha": "306a1658be474e9858bdf28765c883740852ac46",
            "filename": "e2e/hotkeys.spec.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 28,
            "changes": 51,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/cf133c2f2756d0bc430aca2e6eb89aeb5fe634af/e2e%2Fhotkeys.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/cf133c2f2756d0bc430aca2e6eb89aeb5fe634af/e2e%2Fhotkeys.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fhotkeys.spec.ts?ref=cf133c2f2756d0bc430aca2e6eb89aeb5fe634af",
            "patch": "@@ -1,4 +1,4 @@\n-import { test, expect } from '@playwright/test';\n+import { test, expect, type Page } from '@playwright/test';\n \n import translations from '../client/i18n/locales/english/translations.json';\n import { authedRequest } from './utils/request';\n@@ -22,6 +22,11 @@ const links = {\n     '/learn/python-for-everybody/python-for-everybody/introduction-hardware-architecture'\n };\n \n+// The hotkeys are attached to specific elements, so we need to wait for the\n+// wrapper to be focused before we can test the hotkeys.\n+const waitUntilListening = async (page: Page) =>\n+  await expect(page.locator('#editor-layout')).toBeFocused();\n+\n test.use({ storageState: 'playwright/.auth/certified-user.json' });\n \n test.beforeAll(async ({ request }) => {\n@@ -43,6 +48,12 @@ test.beforeEach(async ({ page }) => {\n   await keyboardShortcutGroup\n     .getByRole('button', { name: translations.buttons.on, exact: true })\n     .click();\n+  // wait for the client to register the change:\n+  await expect(\n+    page\n+      .getByRole('alert')\n+      .filter({ hasText: translations.flash['keyboard-shortcut-updated'] })\n+  ).toBeVisible();\n });\n \n test.afterEach(\n@@ -58,13 +69,6 @@ test.afterEach(\n );\n \n test('User can use shortcuts in and around the editor', async ({ page }) => {\n-  // TODO: getByRole('alert', name:\n-  // translations.flash['keyboard-shortcut-updated']) did not find the alert.\n-  // Should it a) be an alert and b) have a name?\n-  await expect(\n-    page.getByText(translations.flash['keyboard-shortcut-updated'])\n-  ).toBeVisible();\n-\n   await page.goto(course);\n \n   await expect(getEditors(page)).toBeFocused();\n@@ -74,18 +78,12 @@ test('User can use shortcuts in and around the editor', async ({ page }) => {\n   await page.keyboard.press('n');\n   const nextCourse = '**/declare-javascript-variables';\n   await page.waitForURL(nextCourse);\n-  // Ensure that the page content is loaded before simulating user interactions.\n-  await expect(\n-    page.getByRole('heading', { name: 'Declare JavaScript Variables' })\n-  ).toBeVisible();\n+  await waitUntilListening(page);\n \n   await page.keyboard.press('p');\n   const previousCourse = '**/comment-your-javascript-code';\n   await page.waitForURL(previousCourse);\n-  // Ensure that the page content is loaded before simulating user interactions.\n-  await expect(\n-    page.getByRole('heading', { name: 'Comment Your JavaScript Code' })\n-  ).toBeVisible();\n+  await waitUntilListening(page);\n \n   await page.keyboard.press('e');\n   await expect(getEditors(page)).toBeFocused();\n@@ -99,43 +97,40 @@ test('User can use shortcuts to navigate between frontend projects', async ({\n   page\n }) => {\n   await page.goto(links.frontEnd1);\n-  await expect(page.locator('#editor-layout')).toBeFocused();\n+  await waitUntilListening(page);\n   await page.keyboard.press('Escape');\n-  await page.keyboard.press('n');\n \n+  await page.keyboard.press('n');\n   await page.waitForURL(links.frontEnd2);\n-  await expect(page.locator('#editor-layout')).toBeFocused();\n+  await waitUntilListening(page);\n   await page.keyboard.press('p');\n-  await page.keyboard.press('Escape');\n   await page.waitForURL(links.frontEnd1);\n });\n \n test('User can use shortcuts to navigate between backend projects', async ({\n   page\n }) => {\n   await page.goto(links.backEnd1);\n-  await expect(page.locator('#editor-layout')).toBeFocused();\n+  await waitUntilListening(page);\n   await page.keyboard.press('Escape');\n-  await page.keyboard.press('n');\n \n+  await page.keyboard.press('n');\n   await page.waitForURL(links.backEnd2);\n-  await expect(page.locator('#editor-layout')).toBeFocused();\n+  await waitUntilListening(page);\n   await page.keyboard.press('p');\n-  await page.keyboard.press('Escape');\n   await page.waitForURL(links.backEnd1);\n });\n \n test('User can use shortcuts to navigate between video-based challenges', async ({\n   page\n }) => {\n   await page.goto(links.video1);\n-  await expect(page.locator('#editor-layout')).toBeFocused();\n+  await waitUntilListening(page);\n   await page.keyboard.press('Escape');\n-  await page.keyboard.press('n');\n \n+  await page.keyboard.press('n');\n   await page.waitForURL(links.video2);\n-  await expect(page.locator('#editor-layout')).toBeFocused();\n+  await waitUntilListening(page);\n   await page.keyboard.press('p');\n-  await page.keyboard.press('Escape');\n   await page.waitForURL(links.video1);\n });"
        }
    ],
    "stats": {
        "total": 51,
        "additions": 23,
        "deletions": 28
    }
}