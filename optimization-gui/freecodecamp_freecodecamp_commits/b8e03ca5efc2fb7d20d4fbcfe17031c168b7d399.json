{
    "author": "ojeytonwilliams",
    "message": "fix: flaky hotkey spec (#55345)",
    "sha": "b8e03ca5efc2fb7d20d4fbcfe17031c168b7d399",
    "files": [
        {
            "sha": "3d850d48fb1ce3cb0ca1ff968a4140786714b04a",
            "filename": "e2e/hotkeys.spec.ts",
            "status": "modified",
            "additions": 27,
            "deletions": 16,
            "changes": 43,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b8e03ca5efc2fb7d20d4fbcfe17031c168b7d399/e2e%2Fhotkeys.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b8e03ca5efc2fb7d20d4fbcfe17031c168b7d399/e2e%2Fhotkeys.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fhotkeys.spec.ts?ref=b8e03ca5efc2fb7d20d4fbcfe17031c168b7d399",
            "patch": "@@ -4,10 +4,11 @@ import translations from '../client/i18n/locales/english/translations.json';\n import { authedRequest } from './utils/request';\n import { getEditors } from './utils/editor';\n \n-const course =\n-  '/learn/javascript-algorithms-and-data-structures/basic-javascript/comment-your-javascript-code';\n-\n const links = {\n+  basicJS1:\n+    '/learn/javascript-algorithms-and-data-structures/basic-javascript/comment-your-javascript-code',\n+  basicJS2:\n+    '/learn/javascript-algorithms-and-data-structures/basic-javascript/declare-javascript-variables',\n   frontEnd1:\n     '/learn/front-end-development-libraries/front-end-development-libraries-projects/build-a-random-quote-machine',\n   frontEnd2:\n@@ -22,11 +23,28 @@ const links = {\n     '/learn/python-for-everybody/python-for-everybody/introduction-hardware-architecture'\n };\n \n+const titles = {\n+  basicJS1: /Comment Your JavaScript Code/,\n+  basicJS2: /Declare JavaScript Variables/,\n+  frontEnd2: /Build a Markdown Previewer/,\n+  backEnd2: /Request Header Parser Microservice/,\n+  video2: /Introduction: Hardware Architecture/\n+};\n+type PageId = keyof typeof titles;\n+\n // The hotkeys are attached to specific elements, so we need to wait for the\n // wrapper to be focused before we can test the hotkeys.\n const waitUntilListening = async (page: Page) =>\n   await expect(page.locator('#editor-layout')).toBeFocused();\n \n+// This is a hack to work around the fact that the page isn't always hydrated\n+// with the new content when the URL changes.\n+const waitUntilHydrated = async (page: Page, pageId: PageId) => {\n+  await page.waitForURL(links[pageId]);\n+  await expect(page).toHaveTitle(titles[pageId]);\n+  await waitUntilListening(page);\n+};\n+\n test.use({ storageState: 'playwright/.auth/certified-user.json' });\n \n test.beforeAll(async ({ request }) => {\n@@ -69,21 +87,17 @@ test.afterEach(\n );\n \n test('User can use shortcuts in and around the editor', async ({ page }) => {\n-  await page.goto(course);\n+  await page.goto(links.basicJS1);\n \n   await expect(getEditors(page)).toBeFocused();\n   await getEditors(page).press('Escape');\n   await expect(getEditors(page)).not.toBeFocused();\n \n   await page.keyboard.press('n');\n-  const nextCourse = '**/declare-javascript-variables';\n-  await page.waitForURL(nextCourse);\n-  await waitUntilListening(page);\n+  await waitUntilHydrated(page, 'basicJS2');\n \n   await page.keyboard.press('p');\n-  const previousCourse = '**/comment-your-javascript-code';\n-  await page.waitForURL(previousCourse);\n-  await waitUntilListening(page);\n+  await waitUntilHydrated(page, 'basicJS1');\n \n   await page.keyboard.press('e');\n   await expect(getEditors(page)).toBeFocused();\n@@ -101,8 +115,7 @@ test('User can use shortcuts to navigate between frontend projects', async ({\n   await page.keyboard.press('Escape');\n \n   await page.keyboard.press('n');\n-  await page.waitForURL(links.frontEnd2);\n-  await waitUntilListening(page);\n+  await waitUntilHydrated(page, 'frontEnd2');\n   await page.keyboard.press('p');\n   await page.waitForURL(links.frontEnd1);\n });\n@@ -115,8 +128,7 @@ test('User can use shortcuts to navigate between backend projects', async ({\n   await page.keyboard.press('Escape');\n \n   await page.keyboard.press('n');\n-  await page.waitForURL(links.backEnd2);\n-  await waitUntilListening(page);\n+  await waitUntilHydrated(page, 'backEnd2');\n   await page.keyboard.press('p');\n   await page.waitForURL(links.backEnd1);\n });\n@@ -129,8 +141,7 @@ test('User can use shortcuts to navigate between video-based challenges', async\n   await page.keyboard.press('Escape');\n \n   await page.keyboard.press('n');\n-  await page.waitForURL(links.video2);\n-  await waitUntilListening(page);\n+  await waitUntilHydrated(page, 'video2');\n   await page.keyboard.press('p');\n   await page.waitForURL(links.video1);\n });"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 27,
        "deletions": 16
    }
}