{
    "author": "ojeytonwilliams",
    "message": "refactor(api): provide default env values (#57986)",
    "sha": "56e520b2e415ebe1c8d9c9bd5d0528d2acfcabe9",
    "files": [
        {
            "sha": "836ab0bc6eb30245020908f9efb594695c2ed8d9",
            "filename": "api/src/utils/env.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 16,
            "changes": 35,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/56e520b2e415ebe1c8d9c9bd5d0528d2acfcabe9/api%2Fsrc%2Futils%2Fenv.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/56e520b2e415ebe1c8d9c9bd5d0528d2acfcabe9/api%2Fsrc%2Futils%2Fenv.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Futils%2Fenv.ts?ref=56e520b2e415ebe1c8d9c9bd5d0528d2acfcabe9",
            "patch": "@@ -23,13 +23,17 @@ function isAllowedEnv(env: string): env is 'development' | 'production' {\n   return ['development', 'production'].includes(env);\n }\n \n+const _EMAIL_PROVIDER = process.env.EMAIL_PROVIDER || 'ses';\n+const _FREECODECAMP_NODE_ENV =\n+  process.env.FREECODECAMP_NODE_ENV || 'production';\n+\n function isAllowedProvider(provider: string): provider is 'ses' | 'nodemailer' {\n   return ['ses', 'nodemailer'].includes(provider);\n }\n \n function createTestConnectionURL(url: string, dbId?: string) {\n   assert.notEqual(\n-    process.env.FREECODECAMP_NODE_ENV,\n+    _FREECODECAMP_NODE_ENV,\n     'production',\n     \"The database URL can't be modified in production.\"\n   );\n@@ -42,10 +46,8 @@ If so, ensure that the environment variable JEST_WORKER_ID is set.`\n }\n \n assert.ok(process.env.HOME_LOCATION);\n-assert.ok(process.env.FREECODECAMP_NODE_ENV);\n-assert.ok(isAllowedEnv(process.env.FREECODECAMP_NODE_ENV));\n-assert.ok(process.env.EMAIL_PROVIDER);\n-assert.ok(isAllowedProvider(process.env.EMAIL_PROVIDER));\n+assert.ok(isAllowedEnv(_FREECODECAMP_NODE_ENV));\n+assert.ok(isAllowedProvider(_EMAIL_PROVIDER));\n assert.ok(process.env.AUTH0_CLIENT_ID);\n assert.ok(process.env.AUTH0_CLIENT_SECRET);\n assert.ok(process.env.AUTH0_DOMAIN);\n@@ -69,11 +71,11 @@ function isLogLevel(level: string): level is LogLevel {\n   return LOG_LEVELS.includes(level);\n }\n \n-const LOG_LEVEL = process.env.FCC_API_LOG_LEVEL || 'info';\n+const _FCC_API_LOG_LEVEL = process.env.FCC_API_LOG_LEVEL || 'info';\n \n assert.ok(\n-  isLogLevel(LOG_LEVEL),\n-  `FCC_API_LOG_LEVEL must be one of ${LOG_LEVELS.join(', ')}. Found ${LOG_LEVEL}`\n+  isLogLevel(_FCC_API_LOG_LEVEL),\n+  `FCC_API_LOG_LEVEL must be one of ${LOG_LEVELS.join(', ')}. Found ${_FCC_API_LOG_LEVEL}`\n );\n \n if (process.env.FREECODECAMP_NODE_ENV !== 'development') {\n@@ -84,11 +86,8 @@ if (process.env.FREECODECAMP_NODE_ENV !== 'development') {\n     'ses_secret_from_aws',\n     'The SES secret should be changed from the default value.'\n   );\n-  assert.ok(process.env.SES_REGION);\n   assert.ok(process.env.COOKIE_DOMAIN);\n   assert.notEqual(process.env.COOKIE_SECRET, 'a_cookie_secret');\n-  assert.ok(process.env.PORT);\n-  assert.ok(process.env.HOST);\n   assert.ok(process.env.SENTRY_DSN);\n   assert.ok(process.env.SENTRY_ENVIRONMENT);\n   // The following values can exist in development, but production-like\n@@ -130,6 +129,8 @@ if (process.env.FREECODECAMP_NODE_ENV !== 'development') {\n }\n \n export const HOME_LOCATION = process.env.HOME_LOCATION;\n+// Mailhog is used in development and test environments, hence the localhost\n+// default.\n export const MAILHOG_HOST = process.env.MAILHOG_HOST ?? 'localhost';\n export const MONGOHQ_URL =\n   process.env.NODE_ENV === 'test'\n@@ -139,24 +140,27 @@ export const MONGOHQ_URL =\n       )\n     : process.env.MONGOHQ_URL;\n \n-export const FREECODECAMP_NODE_ENV = process.env.FREECODECAMP_NODE_ENV;\n export const AUTH0_CLIENT_ID = process.env.AUTH0_CLIENT_ID;\n export const AUTH0_DOMAIN = process.env.AUTH0_DOMAIN;\n export const AUTH0_CLIENT_SECRET = process.env.AUTH0_CLIENT_SECRET;\n+export const EMAIL_PROVIDER = _EMAIL_PROVIDER;\n export const PORT = process.env.PORT || '3000';\n-export const HOST = process.env.HOST || 'localhost';\n+// HOST defaults to 0.0.0.0 because the server is intended to be used in a\n+// container.\n+export const HOST = process.env.HOST || '0.0.0.0';\n export const API_LOCATION = process.env.API_LOCATION;\n export const FCC_ENABLE_SWAGGER_UI =\n   process.env.FCC_ENABLE_SWAGGER_UI === 'true';\n export const FCC_ENABLE_DEV_LOGIN_MODE =\n   process.env.FCC_ENABLE_DEV_LOGIN_MODE === 'true';\n+export const FCC_API_LOG_LEVEL = _FCC_API_LOG_LEVEL;\n export const FCC_ENABLE_SHADOW_CAPTURE =\n   process.env.FCC_ENABLE_SHADOW_CAPTURE === 'true';\n export const FCC_ENABLE_EXAM_ENVIRONMENT =\n   process.env.FCC_ENABLE_EXAM_ENVIRONMENT === 'true';\n export const FCC_ENABLE_SENTRY_ROUTES =\n   process.env.FCC_ENABLE_SENTRY_ROUTES === 'true';\n-export const FCC_API_LOG_LEVEL = LOG_LEVEL;\n+export const FREECODECAMP_NODE_ENV = _FREECODECAMP_NODE_ENV;\n export const SENTRY_DSN =\n   process.env.SENTRY_DSN === 'dsn_from_sentry_dashboard'\n     ? ''\n@@ -170,8 +174,7 @@ export const COOKIE_SECRET = process.env.COOKIE_SECRET;\n export const JWT_SECRET = process.env.JWT_SECRET;\n export const SES_ID = process.env.SES_ID;\n export const SES_SECRET = process.env.SES_SECRET;\n-export const SES_REGION = process.env.SES_REGION;\n-export const EMAIL_PROVIDER = process.env.EMAIL_PROVIDER;\n+export const SES_REGION = process.env.SES_REGION || 'us-east-1';\n export const SHOW_UPCOMING_CHANGES =\n   process.env.SHOW_UPCOMING_CHANGES === 'true';\n export const STRIPE_SECRET_KEY = process.env.STRIPE_SECRET_KEY;"
        },
        {
            "sha": "c7f2c04c4f8baedc945f6f44b6840ef0e22d3123",
            "filename": "sample.env",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/56e520b2e415ebe1c8d9c9bd5d0528d2acfcabe9/sample.env",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/56e520b2e415ebe1c8d9c9bd5d0528d2acfcabe9/sample.env",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/sample.env?ref=56e520b2e415ebe1c8d9c9bd5d0528d2acfcabe9",
            "patch": "@@ -64,7 +64,6 @@ LOCAL_MOCK_AUTH=true\n # New API\n # ---------------------\n NODE_ENV=development\n-PORT=3000\n FCC_ENABLE_SWAGGER_UI=true\n FCC_ENABLE_DEV_LOGIN_MODE=true\n FCC_ENABLE_SHADOW_CAPTURE=false"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 19,
        "deletions": 17
    }
}