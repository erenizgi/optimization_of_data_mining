{
    "author": "ojeytonwilliams",
    "message": "test(e2e): reduce output.spec flake (#59060)",
    "sha": "ab29bde319338007137ba0b32b9d6b31187c4535",
    "files": [
        {
            "sha": "461f2706be9c67c72c4bb1238a55b6d727343cc2",
            "filename": "e2e/output.spec.ts",
            "status": "modified",
            "additions": 56,
            "deletions": 20,
            "changes": 76,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ab29bde319338007137ba0b32b9d6b31187c4535/e2e%2Foutput.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ab29bde319338007137ba0b32b9d6b31187c4535/e2e%2Foutput.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Foutput.spec.ts?ref=ab29bde319338007137ba0b32b9d6b31187c4535",
            "patch": "@@ -21,12 +21,24 @@ const outputTexts = {\n \n interface InsertTextParameters {\n   page: Page;\n+  browserName: string;\n+  containerId?: string;\n   isMobile: boolean;\n   text: string;\n }\n \n-const insertTextInCodeEditor = async ({ page, text }: InsertTextParameters) => {\n-  await getEditors(page).fill(text);\n+const replaceTextInCodeEditor = async ({\n+  page,\n+  browserName,\n+  isMobile,\n+  text,\n+  containerId = 'editor-container-indexhtml'\n+}: InsertTextParameters) => {\n+  await expect(async () => {\n+    await clearEditor({ page, browserName, isMobile });\n+    await getEditors(page).fill(text);\n+    await expect(page.getByTestId(containerId)).toContainText(text);\n+  }).toPass();\n };\n \n const runChallengeTest = async (page: Page, isMobile: boolean) => {\n@@ -67,8 +79,8 @@ test.describe('For classic challenges', () => {\n       'Basic HTML and HTML5: Say Hello to HTML Elements |' + ' freeCodeCamp.org'\n     );\n     await focusEditor({ page, isMobile });\n-    await clearEditor({ browserName, page, isMobile });\n-    await insertTextInCodeEditor({\n+    await replaceTextInCodeEditor({\n+      browserName,\n       page,\n       isMobile,\n       text: '<h1>Hello World</h1>'\n@@ -85,13 +97,15 @@ test.describe('For classic challenges', () => {\n \n   test('shows test output when the tests are triggered by the keyboard', async ({\n     page,\n+    browserName,\n     isMobile\n   }) => {\n     test.skip(isMobile);\n     const closeButton = page.getByRole('button', { name: 'Close' });\n \n-    await insertTextInCodeEditor({\n+    await replaceTextInCodeEditor({\n       page,\n+      browserName,\n       isMobile,\n       text: '<h1>Hello World</h1>'\n     });\n@@ -128,10 +142,17 @@ test.describe('Challenge Output Component Tests', () => {\n \n   test('should contain syntax error output when var is entered in editor', async ({\n     page,\n-    isMobile\n+    isMobile,\n+    browserName\n   }) => {\n     await focusEditor({ page, isMobile });\n-    await insertTextInCodeEditor({ page, isMobile, text: 'var' });\n+    await replaceTextInCodeEditor({\n+      browserName,\n+      page,\n+      isMobile,\n+      text: 'var',\n+      containerId: 'editor-container-scriptjs'\n+    });\n \n     if (isMobile) {\n       await page.getByRole('tab', { name: 'Console' }).click();\n@@ -145,13 +166,20 @@ test.describe('Challenge Output Component Tests', () => {\n   });\n \n   test('should contain reference error output when var is entered in editor', async ({\n+    browserName,\n     page,\n     isMobile\n   }) => {\n     const referenceErrorRegex =\n       /ReferenceError: (myName is not defined|Can't find variable: myName)/;\n     await focusEditor({ page, isMobile });\n-    await insertTextInCodeEditor({ page, isMobile, text: 'myName' });\n+    await replaceTextInCodeEditor({\n+      browserName,\n+      page,\n+      isMobile,\n+      text: 'myName',\n+      containerId: 'editor-container-scriptjs'\n+    });\n \n     if (isMobile) {\n       await page.getByRole('tab', { name: 'Console' }).click();\n@@ -170,20 +198,26 @@ test.describe('Challenge Output Component Tests', () => {\n   }) => {\n     await runChallengeTest(page, isMobile);\n \n-    await expect(\n-      page.getByRole('region', {\n-        name: translations.learn['editor-tabs'].console\n-      })\n-    ).toHaveText(outputTexts.empty);\n+    await expect(page.getByTestId('output-text')).toContainText(\n+      outputTexts.empty,\n+      { timeout: 10000 }\n+    );\n   });\n \n   test('should contain final output after test pass', async ({\n+    browserName,\n     page,\n     isMobile\n   }) => {\n     const closeButton = page.getByRole('button', { name: 'Close' });\n     await focusEditor({ page, isMobile });\n-    await insertTextInCodeEditor({ page, isMobile, text: 'var myName;' });\n+    await replaceTextInCodeEditor({\n+      browserName,\n+      page,\n+      isMobile,\n+      text: 'var myName;',\n+      containerId: 'editor-container-scriptjs'\n+    });\n     await runChallengeTest(page, isMobile);\n     await closeButton.click();\n \n@@ -234,10 +268,12 @@ test.describe('Custom output for Set and Map', () => {\n \n     await focusEditor({ page, isMobile });\n \n-    await insertTextInCodeEditor({\n+    await replaceTextInCodeEditor({\n+      browserName,\n       page,\n       isMobile,\n-      text: 'const set = new Set(); set.add(1); set.add(\"set\"); set.add(10); console.log(set);'\n+      text: 'const set = new Set(); set.add(1); set.add(\"set\"); set.add(10); console.log(set);',\n+      containerId: 'editor-container-scriptjs'\n     });\n \n     if (isMobile) {\n@@ -251,12 +287,12 @@ test.describe('Custom output for Set and Map', () => {\n     ).toContainText('Set(3) {1, set, 10}');\n \n     await focusEditor({ page, isMobile });\n-    await clearEditor({ browserName, page });\n-\n-    await insertTextInCodeEditor({\n+    await replaceTextInCodeEditor({\n+      browserName,\n       page,\n       isMobile,\n-      text: 'const map = new Map(); map.set(1, \"one\"); map.set(\"two\", 2); console.log(map);'\n+      text: 'const map = new Map(); map.set(1, \"one\"); map.set(\"two\", 2); console.log(map);',\n+      containerId: 'editor-container-scriptjs'\n     });\n \n     if (isMobile) {"
        }
    ],
    "stats": {
        "total": 76,
        "additions": 56,
        "deletions": 20
    }
}