{
    "author": "huyenltnguyen",
    "message": "test(e2e): migrate search-bar.ts to Playwright (#55157)",
    "sha": "8f14c7e9f81710e3c7ede3732b1d689ee38e8520",
    "files": [
        {
            "sha": "40485586337aa55b23df6fc62652ef81b38f95fb",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8f14c7e9f81710e3c7ede3732b1d689ee38e8520/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8f14c7e9f81710e3c7ede3732b1d689ee38e8520/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=8f14c7e9f81710e3c7ede3732b1d689ee38e8520",
            "patch": "@@ -668,7 +668,8 @@\n     \"see-results\": \"See all results for {{searchQuery}}\",\n     \"no-tutorials\": \"No tutorials found\",\n     \"try\": \"Looking for something? Try the search bar on this page.\",\n-    \"no-results\": \"We could not find anything relating to <0>{{query}}</0>\"\n+    \"no-results\": \"We could not find anything relating to <0>{{query}}</0>\",\n+    \"result-list\": \"Search results\"\n   },\n   \"misc\": {\n     \"offline\": \"You appear to be offline, your progress may not be saved\","
        },
        {
            "sha": "da2413206ab124e189b29453edbe0a698023b9a5",
            "filename": "client/src/components/search/searchBar/search-hits.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8f14c7e9f81710e3c7ede3732b1d689ee38e8520/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-hits.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8f14c7e9f81710e3c7ede3732b1d689ee38e8520/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-hits.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fsearch%2FsearchBar%2Fsearch-hits.tsx?ref=8f14c7e9f81710e3c7ede3732b1d689ee38e8520",
            "patch": "@@ -63,7 +63,11 @@ const CustomHits = connectHits(\n \n     return (\n       <div className='ais-Hits'>\n-        <ul className='ais-Hits-list' data-cy='ais-Hits-list'>\n+        <ul\n+          className='ais-Hits-list'\n+          data-cy='ais-Hits-list'\n+          aria-label={t('search.result-list')}\n+        >\n           {allHits.map((hit: Hit, i: number) => (\n             <li\n               className={"
        },
        {
            "sha": "b40c1f0f68678e434ef08db420926efae3c79d6b",
            "filename": "e2e/fixtures/algolia-eight-hits.json",
            "status": "added",
            "additions": 88,
            "deletions": 0,
            "changes": 88,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8f14c7e9f81710e3c7ede3732b1d689ee38e8520/e2e%2Ffixtures%2Falgolia-eight-hits.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8f14c7e9f81710e3c7ede3732b1d689ee38e8520/e2e%2Ffixtures%2Falgolia-eight-hits.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Ffixtures%2Falgolia-eight-hits.json?ref=8f14c7e9f81710e3c7ede3732b1d689ee38e8520",
            "patch": "@@ -0,0 +1,88 @@\n+{\n+  \"results\": [\n+    {\n+      \"hits\": [\n+        {\n+          \"title\": \"Article 1\",\n+          \"objectID\": \"Article 1\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 1\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        },\n+        {\n+          \"title\": \"Article 2\",\n+          \"objectID\": \"Article 2\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 2\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        },\n+        {\n+          \"title\": \"Article 3\",\n+          \"objectID\": \"Article 3\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 3\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        },\n+        {\n+          \"title\": \"Article 4\",\n+          \"objectID\": \"Article 4\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 4\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        },\n+        {\n+          \"title\": \"Article 5\",\n+          \"objectID\": \"Article 5\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 5\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        },\n+        {\n+          \"title\": \"Article 6\",\n+          \"objectID\": \"Article 6\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 6\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        },\n+        {\n+          \"title\": \"Article 7\",\n+          \"objectID\": \"Article 7\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 7\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        },\n+        {\n+          \"title\": \"Article 8\",\n+          \"objectID\": \"Article 8\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 8\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        }\n+      ]\n+    }\n+  ]\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "ef3f7ea5d5fda4db2d7e5a99e4a2a34e4888d1ef",
            "filename": "e2e/fixtures/algolia-five-hits.json",
            "status": "added",
            "additions": 58,
            "deletions": 0,
            "changes": 58,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8f14c7e9f81710e3c7ede3732b1d689ee38e8520/e2e%2Ffixtures%2Falgolia-five-hits.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8f14c7e9f81710e3c7ede3732b1d689ee38e8520/e2e%2Ffixtures%2Falgolia-five-hits.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Ffixtures%2Falgolia-five-hits.json?ref=8f14c7e9f81710e3c7ede3732b1d689ee38e8520",
            "patch": "@@ -0,0 +1,58 @@\n+{\n+  \"results\": [\n+    {\n+      \"hits\": [\n+        {\n+          \"title\": \"Article 1\",\n+          \"objectID\": \"Article 1\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 1\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        },\n+        {\n+          \"title\": \"Article 2\",\n+          \"objectID\": \"Article 2\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 2\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        },\n+        {\n+          \"title\": \"Article 3\",\n+          \"objectID\": \"Article 3\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 3\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        },\n+        {\n+          \"title\": \"Article 4\",\n+          \"objectID\": \"Article 4\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 4\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        },\n+        {\n+          \"title\": \"Article 5\",\n+          \"objectID\": \"Article 5\",\n+          \"_highlightResult\": {\n+            \"title\": {\n+              \"value\": \"<ais-highlight-0000000000>Article</ais-highlight-0000000000> 5\",\n+              \"matchLevel\": \"full\"\n+            }\n+          }\n+        }\n+      ]\n+    }\n+  ]\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "6370a03bfc23ffd518b7062f1e449f8e942db68f",
            "filename": "e2e/search-bar.spec.ts",
            "status": "added",
            "additions": 236,
            "deletions": 0,
            "changes": 236,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/8f14c7e9f81710e3c7ede3732b1d689ee38e8520/e2e%2Fsearch-bar.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/8f14c7e9f81710e3c7ede3732b1d689ee38e8520/e2e%2Fsearch-bar.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fsearch-bar.spec.ts?ref=8f14c7e9f81710e3c7ede3732b1d689ee38e8520",
            "patch": "@@ -0,0 +1,236 @@\n+import { test, expect, type Page } from '@playwright/test';\n+import translations from '../client/i18n/locales/english/translations.json';\n+import algoliaEightHits from './fixtures/algolia-eight-hits.json';\n+import algoliaFiveHits from './fixtures/algolia-five-hits.json';\n+\n+const haveApiKeys =\n+  process.env.ALGOLIA_APP_ID !== 'app_id_from_algolia_dashboard' &&\n+  process.env.ALGOLIA_API_KEY !== 'api_key_from_algolia_dashboard';\n+\n+const getSearchInput = async ({\n+  page,\n+  isMobile\n+}: {\n+  page: Page;\n+  isMobile: boolean;\n+}) => {\n+  if (isMobile) {\n+    const menuButton = page.getByRole('button', {\n+      name: translations.buttons.menu\n+    });\n+    await expect(menuButton).toBeVisible();\n+    await menuButton.click();\n+  }\n+\n+  return page.getByLabel('Search');\n+};\n+\n+const search = async ({\n+  page,\n+  isMobile,\n+  query\n+}: {\n+  page: Page;\n+  isMobile: boolean;\n+  query: string;\n+}) => {\n+  const searchInput = await getSearchInput({ page, isMobile });\n+  await searchInput.fill(query);\n+};\n+\n+const mockAlgolia = async ({\n+  page,\n+  hitsPerPage\n+}: {\n+  page: Page;\n+  hitsPerPage: number;\n+}) => {\n+  if (hitsPerPage === 8) {\n+    await page.route(/\\w+(\\.algolia\\.net|\\.algolianet\\.com)/, async route => {\n+      await route.fulfill({ json: algoliaEightHits });\n+    });\n+  } else if (hitsPerPage === 5) {\n+    await page.route(/\\w+(\\.algolia\\.net|\\.algolianet\\.com)/, async route => {\n+      await route.fulfill({ json: algoliaFiveHits });\n+    });\n+  } else if (hitsPerPage === 0) {\n+    await page.route(/\\w+(\\.algolia\\.net|\\.algolianet\\.com)/, async route => {\n+      await route.fulfill({ json: {} });\n+    });\n+  }\n+};\n+\n+test.describe('Search bar', () => {\n+  test.beforeEach(async ({ page }) => {\n+    await page.goto('/learn');\n+\n+    // Mock Algolia requests to prevent hitting Algolia server unnecessarily.\n+    // Comment out this line if you want to test against the real server.\n+    await mockAlgolia({ page, hitsPerPage: 8 });\n+  });\n+\n+  test('should display correctly', async ({ page, isMobile }) => {\n+    const searchInput = await getSearchInput({ page, isMobile });\n+\n+    await expect(searchInput).toBeVisible();\n+    await expect(searchInput).toHaveAttribute(\n+      'placeholder',\n+      translations.search.placeholder\n+    );\n+    await expect(\n+      page.getByRole('button', { name: 'Submit search terms' })\n+    ).toBeVisible();\n+  });\n+\n+  test('should return the search results when the user presses Enter', async ({\n+    page,\n+    isMobile\n+  }) => {\n+    test.skip(!haveApiKeys, 'This test requires Algolia API keys');\n+\n+    await search({ page, isMobile, query: 'article' });\n+\n+    // Wait for the search results to show up\n+    const resultList = page.getByRole('list', { name: 'Search results' });\n+    // Initially, the dropdown contains an `li` with the text \"No tutorials found\",\n+    // so we need to check the text content to ensure the correct `li` is displayed.\n+    await expect(resultList.getByRole('listitem').first()).toContainText(\n+      /article/i\n+    );\n+\n+    await page.keyboard.press('Enter');\n+\n+    await page.waitForURL(\n+      'https://www.freecodecamp.org/news/search/?query=article'\n+    );\n+    const title = await page.title();\n+    expect(title).toBe('Search - freeCodeCamp.org');\n+  });\n+\n+  test('should return the search results when the user clicks the search button', async ({\n+    page,\n+    isMobile\n+  }) => {\n+    test.skip(!haveApiKeys, 'This test requires Algolia API keys');\n+\n+    await search({ page, isMobile, query: 'article' });\n+\n+    // Wait for the search results to show up\n+    const resultList = page.getByRole('list', { name: 'Search results' });\n+    // Initially, the dropdown contains an `li` with the text \"No tutorials found\",\n+    // so we need to check the text content to ensure the correct `li` is displayed.\n+    await expect(resultList.getByRole('listitem').first()).toContainText(\n+      /article/i\n+    );\n+\n+    await page.getByRole('button', { name: 'Submit search terms' }).click();\n+\n+    await page.waitForURL(\n+      'https://www.freecodecamp.org/news/search/?query=article'\n+    );\n+    const title = await page.title();\n+    expect(title).toBe('Search - freeCodeCamp.org');\n+  });\n+\n+  test('should show an empty result list if no results found', async ({\n+    page,\n+    isMobile\n+  }) => {\n+    await mockAlgolia({ page, hitsPerPage: 0 });\n+    await search({ page, isMobile, query: '!@#$%^' });\n+\n+    const resultList = page.getByRole('list', { name: 'Search results' });\n+    await expect(resultList.getByRole('listitem')).toHaveCount(1);\n+    await expect(resultList.getByRole('listitem')).toHaveText(\n+      'No tutorials found'\n+    );\n+  });\n+\n+  test('should clear the input and hide the result dropdown when the user clicks the clear button', async ({\n+    page,\n+    isMobile\n+  }) => {\n+    const searchInput = await getSearchInput({ page, isMobile });\n+    await expect(searchInput).toBeVisible();\n+\n+    await searchInput.fill('test');\n+    await page.getByRole('button', { name: 'Clear search terms' }).click();\n+\n+    await expect(searchInput).toHaveValue('');\n+    await expect(\n+      page.getByRole('list', { name: 'Search results' })\n+    ).toBeHidden();\n+  });\n+});\n+\n+test.describe('Search results when viewport height is greater than 768px', () => {\n+  test.use({\n+    viewport: { width: 1600, height: 1200 }\n+  });\n+\n+  test.beforeEach(async ({ page }) => {\n+    await page.goto('/learn');\n+\n+    // Mock Algolia requests to prevent hitting Algolia server unnecessarily.\n+    // Comment out this line if you want to test against the real server.\n+    await mockAlgolia({ page, hitsPerPage: 8 });\n+  });\n+\n+  test('should display 8 items', async ({ page, isMobile }) => {\n+    test.skip(!haveApiKeys, 'This test requires Algolia API keys');\n+\n+    await search({ page, isMobile, query: 'article' });\n+\n+    // Wait for the search results to show up\n+    const results = page.getByRole('list', { name: 'Search results' });\n+    await expect(results.getByRole('listitem')).toHaveCount(9); // 8 results + the footer\n+  });\n+});\n+\n+test.describe('Search results when viewport height is equal to 768px', () => {\n+  test.use({\n+    viewport: { width: 1600, height: 768 }\n+  });\n+\n+  test.beforeEach(async ({ page }) => {\n+    await page.goto('/learn');\n+\n+    // Mock Algolia requests to prevent hitting Algolia server unnecessarily.\n+    // Comment out this line if you want to test against the real server.\n+    await mockAlgolia({ page, hitsPerPage: 8 });\n+  });\n+\n+  test('should display 8 items', async ({ page, isMobile }) => {\n+    test.skip(!haveApiKeys, 'This test requires Algolia API keys');\n+\n+    await search({ page, isMobile, query: 'article' });\n+\n+    // Wait for the search results to show up\n+    const results = page.getByRole('list', { name: 'Search results' });\n+    await expect(results.getByRole('listitem')).toHaveCount(9); // 8 results + the footer\n+  });\n+});\n+\n+test.describe('Search results when viewport height is less than 768px', () => {\n+  test.use({\n+    viewport: { width: 1600, height: 500 }\n+  });\n+\n+  test.beforeEach(async ({ page }) => {\n+    await page.goto('/learn');\n+\n+    // Mock Algolia requests to prevent hitting Algolia server unnecessarily.\n+    // Comment out this line if you want to test against the real server.\n+    await mockAlgolia({ page, hitsPerPage: 5 });\n+  });\n+\n+  test('should display 5 items', async ({ page, isMobile }) => {\n+    test.skip(!haveApiKeys, 'This test requires Algolia API keys');\n+\n+    await search({ page, isMobile, query: 'article' });\n+\n+    // Wait for the search results to show up\n+    const results = page.getByRole('list', { name: 'Search results' });\n+    await expect(results.getByRole('listitem')).toHaveCount(6); // 5 results + the footer\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 391,
        "additions": 389,
        "deletions": 2
    }
}