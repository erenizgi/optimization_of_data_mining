{
    "author": "ojeytonwilliams",
    "message": "fix(api): strip query params on redirect (#58608)",
    "sha": "436d27da527d43087b357dc0389de305f9ae7094",
    "files": [
        {
            "sha": "9b05982cc0accf7e1213853edd341708640c0e21",
            "filename": "api/src/utils/redirection.test.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/436d27da527d43087b357dc0389de305f9ae7094/api%2Fsrc%2Futils%2Fredirection.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/436d27da527d43087b357dc0389de305f9ae7094/api%2Fsrc%2Futils%2Fredirection.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Futils%2Fredirection.test.ts?ref=436d27da527d43087b357dc0389de305f9ae7094",
            "patch": "@@ -165,6 +165,23 @@ describe('redirection', () => {\n       expect(result).toEqual(expectedReturn);\n     });\n \n+    it('should strip off any query parameters from the referer', () => {\n+      const req = {\n+        headers: {\n+          referer: `https://www.freecodecamp.org/espanol/learn/rosetta-code/?query=param`\n+        }\n+      };\n+\n+      const expectedReturn = {\n+        origin: 'https://www.freecodecamp.org',\n+        pathPrefix: 'espanol',\n+        returnTo: 'https://www.freecodecamp.org/espanol/learn/rosetta-code/'\n+      };\n+\n+      const result = getRedirectParams(req);\n+      expect(result).toEqual(expectedReturn);\n+    });\n+\n     it('should use HOME_LOCATION with missing referer', () => {\n       const req = {\n         headers: {}"
        },
        {
            "sha": "8b6bc5552bcb4ea29810fdf854b1604237a0472d",
            "filename": "api/src/utils/redirection.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/436d27da527d43087b357dc0389de305f9ae7094/api%2Fsrc%2Futils%2Fredirection.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/436d27da527d43087b357dc0389de305f9ae7094/api%2Fsrc%2Futils%2Fredirection.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Futils%2Fredirection.ts?ref=436d27da527d43087b357dc0389de305f9ae7094",
            "patch": "@@ -113,7 +113,12 @@ function getParamsFromUrl(\n   // if this is not one of the client languages, validation will convert\n   // this to '' before it is used.\n   const pathPrefix = returnUrl.pathname.split('/')[1] ?? '';\n-  return normalize({ returnTo: returnUrl.href, origin, pathPrefix });\n+  return normalize({\n+    // strip off any query parameters\n+    returnTo: returnUrl.origin + returnUrl.pathname,\n+    origin,\n+    pathPrefix\n+  });\n }\n \n /**"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 23,
        "deletions": 1
    }
}