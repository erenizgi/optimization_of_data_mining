{
    "author": "ojeytonwilliams",
    "message": "refactor(client): convert fill in the blanks show.tsx to function (#57082)",
    "sha": "5c89430e65f425391cecf943da27a5dd1a52a437",
    "files": [
        {
            "sha": "e8d799dcc9341b39d9ae6be92b5ed95f67adb39f",
            "filename": "client/src/templates/Challenges/fill-in-the-blank/show.tsx",
            "status": "modified",
            "additions": 165,
            "deletions": 251,
            "changes": 416,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5c89430e65f425391cecf943da27a5dd1a52a437/client%2Fsrc%2Ftemplates%2FChallenges%2Ffill-in-the-blank%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5c89430e65f425391cecf943da27a5dd1a52a437/client%2Fsrc%2Ftemplates%2FChallenges%2Ffill-in-the-blank%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Ffill-in-the-blank%2Fshow.tsx?ref=5c89430e65f425391cecf943da27a5dd1a52a437",
            "patch": "@@ -1,10 +1,10 @@\n // Package Utilities\n import { graphql } from 'gatsby';\n-import React, { Component } from 'react';\n+import React, { useEffect, useRef, useState } from 'react';\n import Helmet from 'react-helmet';\n import { ObserveKeys } from 'react-hotkeys';\n import type { TFunction } from 'i18next';\n-import { withTranslation } from 'react-i18next';\n+import { useTranslation } from 'react-i18next';\n import { connect } from 'react-redux';\n import { bindActionCreators } from 'redux';\n import type { Dispatch } from 'redux';\n@@ -70,151 +70,101 @@ interface ShowFillInTheBlankProps {\n   updateSolutionFormValues: () => void;\n }\n \n-interface ShowFillInTheBlankState {\n-  showWrong: boolean;\n-  userAnswers: (string | null)[];\n-  answersCorrect: (boolean | null)[];\n-  allBlanksFilled: boolean;\n-  feedback: string | null;\n-  showFeedback: boolean;\n-  isScenePlaying: boolean;\n-}\n-\n-// Component\n-class ShowFillInTheBlank extends Component<\n-  ShowFillInTheBlankProps,\n-  ShowFillInTheBlankState\n-> {\n-  static displayName: string;\n-  private container: React.RefObject<HTMLElement> = React.createRef();\n-\n-  constructor(props: ShowFillInTheBlankProps) {\n-    super(props);\n-\n-    const {\n-      data: {\n-        challengeNode: {\n-          challenge: {\n-            fillInTheBlank: { blanks }\n-          }\n-        }\n+const ShowFillInTheBlank = ({\n+  data: {\n+    challengeNode: {\n+      challenge: {\n+        title,\n+        description,\n+        instructions,\n+        explanation,\n+        superBlock,\n+        block,\n+        translationPending,\n+        fields: { blockName, tests },\n+        challengeType,\n+        fillInTheBlank,\n+        helpCategory,\n+        scene\n       }\n-    } = props;\n-\n-    const emptyArray = blanks.map(() => null);\n-\n-    this.state = {\n-      showWrong: false,\n-      userAnswers: emptyArray,\n-      answersCorrect: emptyArray,\n-      allBlanksFilled: false,\n-      feedback: null,\n-      showFeedback: false,\n-      isScenePlaying: false\n-    };\n-\n-    this.handleSubmit = this.handleSubmit.bind(this);\n-  }\n-\n-  componentDidMount(): void {\n-    const {\n-      challengeMounted,\n-      data: {\n-        challengeNode: {\n-          challenge: {\n-            fields: { tests },\n-            title,\n-            challengeType,\n-            helpCategory\n-          }\n-        }\n-      },\n-      pageContext: { challengeMeta },\n-      initTests,\n-      updateChallengeMeta\n-    } = this.props;\n+    }\n+  },\n+  challengeMounted,\n+  openHelpModal,\n+  updateChallengeMeta,\n+  openCompletionModal,\n+  pageContext: { challengeMeta },\n+  isChallengeCompleted\n+}: ShowFillInTheBlankProps) => {\n+  const { t } = useTranslation();\n+  const emptyArray = fillInTheBlank.blanks.map(() => null);\n+\n+  const [showWrong, setShowWrong] = useState(false);\n+  const [userAnswers, setUserAnswers] = useState<(null | string)[]>(emptyArray);\n+  const [answersCorrect, setAnswersCorrect] =\n+    useState<(null | boolean)[]>(emptyArray);\n+  const [allBlanksFilled, setAllBlanksFilled] = useState(false);\n+  const [feedback, setFeedback] = useState<string | null>(null);\n+  const [showFeedback, setShowFeedback] = useState(false);\n+  const [isScenePlaying, setIsScenePlaying] = useState(false);\n+\n+  const container = useRef<HTMLElement | null>(null);\n+\n+  useEffect(() => {\n+    initTests(tests);\n     updateChallengeMeta({\n       ...challengeMeta,\n       title,\n       challengeType,\n       helpCategory\n     });\n-    initTests(tests);\n     challengeMounted(challengeMeta.id);\n-    this.container.current?.focus();\n-  }\n+    container.current?.focus();\n+    // This effect should be run once on mount\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, []);\n \n-  componentDidUpdate(prevProps: ShowFillInTheBlankProps): void {\n-    const {\n-      data: {\n-        challengeNode: {\n-          challenge: { title: prevTitle }\n-        }\n-      }\n-    } = prevProps;\n-    const {\n-      challengeMounted,\n-      data: {\n-        challengeNode: {\n-          challenge: { title: currentTitle, challengeType, helpCategory }\n-        }\n-      },\n-      pageContext: { challengeMeta },\n-      updateChallengeMeta\n-    } = this.props;\n-    if (prevTitle !== currentTitle) {\n-      updateChallengeMeta({\n-        ...challengeMeta,\n-        title: currentTitle,\n-        challengeType,\n-        helpCategory\n-      });\n-      challengeMounted(challengeMeta.id);\n-    }\n-  }\n-\n-  handleSubmit() {\n-    const {\n-      openCompletionModal,\n-      data: {\n-        challengeNode: {\n-          challenge: {\n-            fillInTheBlank: { blanks }\n-          }\n-        }\n-      }\n-    } = this.props;\n-    const { userAnswers } = this.state;\n-\n-    const blankAnswers = blanks.map(b => b.answer);\n+  useEffect(() => {\n+    updateChallengeMeta({\n+      ...challengeMeta,\n+      title,\n+      challengeType,\n+      helpCategory\n+    });\n+    challengeMounted(challengeMeta.id);\n+  }, [\n+    title,\n+    challengeMeta,\n+    challengeType,\n+    helpCategory,\n+    challengeMounted,\n+    updateChallengeMeta\n+  ]);\n+\n+  const handleSubmit = () => {\n+    const blankAnswers = fillInTheBlank.blanks.map(b => b.answer);\n \n     const newAnswersCorrect = userAnswers.map(\n       (userAnswer, i) => !!userAnswer && userAnswer.trim() === blankAnswers[i]\n     );\n-\n+    setAnswersCorrect(newAnswersCorrect);\n     const hasWrongAnswer = newAnswersCorrect.some(a => a === false);\n     if (!hasWrongAnswer) {\n-      this.setState({\n-        answersCorrect: newAnswersCorrect\n-      });\n-\n       openCompletionModal();\n     } else {\n       const firstWrongIndex = newAnswersCorrect.findIndex(a => a === false);\n       const feedback =\n-        firstWrongIndex >= 0 ? blanks[firstWrongIndex].feedback : null;\n+        firstWrongIndex >= 0\n+          ? fillInTheBlank.blanks[firstWrongIndex].feedback\n+          : null;\n \n-      this.setState({\n-        answersCorrect: newAnswersCorrect,\n-        showWrong: true,\n-        showFeedback: true,\n-        feedback: feedback\n-      });\n+      setFeedback(feedback);\n+      setShowWrong(true);\n+      setShowFeedback(true);\n     }\n-  }\n+  };\n \n-  handleInputChange = (e: React.ChangeEvent<HTMLInputElement>): void => {\n-    const { userAnswers, answersCorrect } = this.state;\n+  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>): void => {\n     const inputIndex = parseInt(e.target.getAttribute('data-index') as string);\n \n     const newUserAnswers = [...userAnswers];\n@@ -225,145 +175,109 @@ class ShowFillInTheBlank extends Component<\n \n     const allBlanksFilled = newUserAnswers.every(a => a);\n \n-    this.setState({\n-      userAnswers: newUserAnswers,\n-      answersCorrect: newAnswersCorrect,\n-      allBlanksFilled,\n-      showWrong: false\n-    });\n+    setUserAnswers(newUserAnswers);\n+    setAnswersCorrect(newAnswersCorrect);\n+    setAllBlanksFilled(allBlanksFilled);\n+    setShowWrong(false);\n   };\n \n-  setIsScenePlaying = (shouldPlay: boolean) => {\n-    this.setState({\n-      isScenePlaying: shouldPlay\n-    });\n+  const handlePlayScene = (shouldPlay: boolean) => {\n+    setIsScenePlaying(shouldPlay);\n   };\n \n-  render() {\n-    const {\n-      data: {\n-        challengeNode: {\n-          challenge: {\n-            title,\n-            description,\n-            instructions,\n-            explanation,\n-            superBlock,\n-            block,\n-            translationPending,\n-            fields: { blockName },\n-            fillInTheBlank,\n-            scene\n-          }\n-        }\n-      },\n-      openHelpModal,\n-      pageContext: {\n-        challengeMeta: { nextChallengePath, prevChallengePath }\n-      },\n-      t,\n-      isChallengeCompleted\n-    } = this.props;\n-\n-    const blockNameTitle = `${t(\n-      `intro:${superBlock}.blocks.${block}.title`\n-    )} - ${title}`;\n-\n-    const { allBlanksFilled, feedback, showFeedback, showWrong } = this.state;\n-\n-    return (\n-      <Hotkeys\n-        executeChallenge={() => this.handleSubmit()}\n-        containerRef={this.container}\n-        nextChallengePath={nextChallengePath}\n-        prevChallengePath={prevChallengePath}\n-        playScene={() => this.setIsScenePlaying(true)}\n-      >\n-        <LearnLayout>\n-          <Helmet\n-            title={`${blockNameTitle} | ${t('learn.learn')} | freeCodeCamp.org`}\n-          />\n-          <Container>\n-            <Row>\n+  const blockNameTitle = `${t(\n+    `intro:${superBlock}.blocks.${block}.title`\n+  )} - ${title}`;\n+\n+  return (\n+    <Hotkeys\n+      executeChallenge={() => handleSubmit()}\n+      containerRef={container}\n+      nextChallengePath={challengeMeta.nextChallengePath}\n+      prevChallengePath={challengeMeta.prevChallengePath}\n+      playScene={() => handlePlayScene(true)}\n+    >\n+      <LearnLayout>\n+        <Helmet\n+          title={`${blockNameTitle} | ${t('learn.learn')} | freeCodeCamp.org`}\n+        />\n+        <Container>\n+          <Row>\n+            <Spacer size='m' />\n+            <ChallengeTitle\n+              isCompleted={isChallengeCompleted}\n+              translationPending={translationPending}\n+            >\n+              {title}\n+            </ChallengeTitle>\n+\n+            <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n+              <PrismFormatted text={description} />\n               <Spacer size='m' />\n-              <ChallengeTitle\n-                isCompleted={isChallengeCompleted}\n-                translationPending={translationPending}\n-              >\n-                {title}\n-              </ChallengeTitle>\n-\n-              <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n-                <PrismFormatted text={description} />\n-                <Spacer size='m' />\n-              </Col>\n-\n-              {scene && (\n-                <Scene\n-                  scene={scene}\n-                  isPlaying={this.state.isScenePlaying}\n-                  setIsPlaying={this.setIsScenePlaying}\n-                />\n+            </Col>\n+\n+            {scene && (\n+              <Scene\n+                scene={scene}\n+                isPlaying={isScenePlaying}\n+                setIsPlaying={setIsScenePlaying}\n+              />\n+            )}\n+\n+            <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n+              {instructions && (\n+                <>\n+                  <PrismFormatted text={instructions} />\n+                  <Spacer size='xs' />\n+                </>\n               )}\n \n-              <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n-                {instructions && (\n-                  <>\n-                    <PrismFormatted text={instructions} />\n-                    <Spacer size='xs' />\n-                  </>\n-                )}\n-\n-                {/* what we want to observe is ctrl/cmd + enter, but ObserveKeys is buggy and throws an error\n+              {/* what we want to observe is ctrl/cmd + enter, but ObserveKeys is buggy and throws an error\n                 if it encounters a key combination, so we have to pass in the individual keys to observe */}\n-                <ObserveKeys only={['ctrl', 'cmd', 'enter']}>\n-                  <FillInTheBlanks\n-                    fillInTheBlank={fillInTheBlank}\n-                    answersCorrect={this.state.answersCorrect}\n-                    showFeedback={showFeedback}\n-                    feedback={feedback}\n-                    showWrong={showWrong}\n-                    handleInputChange={this.handleInputChange}\n-                  />\n-                </ObserveKeys>\n+              <ObserveKeys only={['ctrl', 'cmd', 'enter']}>\n+                <FillInTheBlanks\n+                  fillInTheBlank={fillInTheBlank}\n+                  answersCorrect={answersCorrect}\n+                  showFeedback={showFeedback}\n+                  feedback={feedback}\n+                  showWrong={showWrong}\n+                  handleInputChange={handleInputChange}\n+                />\n+              </ObserveKeys>\n \n-                {explanation ? (\n-                  <ChallegeExplanation explanation={explanation} />\n-                ) : (\n-                  <Spacer size='m' />\n-                )}\n+              {explanation ? (\n+                <ChallegeExplanation explanation={explanation} />\n+              ) : (\n+                <Spacer size='m' />\n+              )}\n \n-                <Button\n-                  block={true}\n-                  variant='primary'\n-                  disabled={!allBlanksFilled}\n-                  onClick={() => this.handleSubmit()}\n-                >\n-                  {t('buttons.check-answer')}\n-                </Button>\n-                <Spacer size='xxs' />\n-                <Button block={true} variant='primary' onClick={openHelpModal}>\n-                  {t('buttons.ask-for-help')}\n-                </Button>\n-                <Spacer size='l' />\n-              </Col>\n-              <CompletionModal />\n-              <HelpModal challengeTitle={title} challengeBlock={blockName} />\n-            </Row>\n-          </Container>\n-          <ShortcutsModal />\n-        </LearnLayout>\n-      </Hotkeys>\n-    );\n-  }\n-}\n+              <Button\n+                block={true}\n+                variant='primary'\n+                disabled={!allBlanksFilled}\n+                onClick={() => handleSubmit()}\n+              >\n+                {t('buttons.check-answer')}\n+              </Button>\n+              <Spacer size='xxs' />\n+              <Button block={true} variant='primary' onClick={openHelpModal}>\n+                {t('buttons.ask-for-help')}\n+              </Button>\n+              <Spacer size='l' />\n+            </Col>\n+            <CompletionModal />\n+            <HelpModal challengeTitle={title} challengeBlock={blockName} />\n+          </Row>\n+        </Container>\n+        <ShortcutsModal />\n+      </LearnLayout>\n+    </Hotkeys>\n+  );\n+};\n \n ShowFillInTheBlank.displayName = 'ShowFillInTheBlank';\n \n-export default connect(\n-  mapStateToProps,\n-  mapDispatchToProps\n-)(withTranslation()(ShowFillInTheBlank));\n+export default connect(mapStateToProps, mapDispatchToProps)(ShowFillInTheBlank);\n \n export const query = graphql`\n   query FillInTheBlankChallenge($id: String!) {"
        }
    ],
    "stats": {
        "total": 416,
        "additions": 165,
        "deletions": 251
    }
}