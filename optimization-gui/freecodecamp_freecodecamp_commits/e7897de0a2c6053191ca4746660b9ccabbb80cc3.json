{
    "author": "huyenltnguyen",
    "message": "fix(a11y): fill in the blank challenges (#56775)\n\nCo-authored-by: Tom <20648924+moT01@users.noreply.github.com>\nCo-authored-by: Bruce Blaser <bbsmooth@gmail.com>",
    "sha": "e7897de0a2c6053191ca4746660b9ccabbb80cc3",
    "files": [
        {
            "sha": "dfd72ee14474ea9ed2b2e1f41f74c09e71ffc82c",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e7897de0a2c6053191ca4746660b9ccabbb80cc3/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e7897de0a2c6053191ca4746660b9ccabbb80cc3/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=e7897de0a2c6053191ca4746660b9ccabbb80cc3",
            "patch": "@@ -527,8 +527,10 @@\n     \"building-a-university\": \"We're Building a Free Computer Science University Degree Program ðŸŽ‰\",\n     \"if-help-university\": \"We've already made a ton of progress. Donate now to help our charity with the road ahead.\",\n     \"preview-external-window\": \"Preview currently showing in external window.\",\n-    \"fill-in-the-blank\": \"Fill in the blank\",\n-    \"blank\": \"blank\",\n+    \"fill-in-the-blank\": {\n+      \"heading\": \"Fill in the blank\",\n+      \"blank\": \"blank\"\n+    },\n     \"quiz\": {\n       \"correct-answer\": \"Correct!\",\n       \"incorrect-answer\": \"Incorrect.\","
        },
        {
            "sha": "549a0dead35ec7a05894d2fbb117bda43ed0be4e",
            "filename": "client/src/templates/Challenges/components/fill-in-the-blanks.tsx",
            "status": "modified",
            "additions": 45,
            "deletions": 28,
            "changes": 73,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e7897de0a2c6053191ca4746660b9ccabbb80cc3/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Ffill-in-the-blanks.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e7897de0a2c6053191ca4746660b9ccabbb80cc3/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Ffill-in-the-blanks.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Ffill-in-the-blanks.tsx?ref=e7897de0a2c6053191ca4746660b9ccabbb80cc3",
            "patch": "@@ -1,7 +1,7 @@\n import React from 'react';\n import { useTranslation } from 'react-i18next';\n-\n import { Spacer } from '@freecodecamp/ui';\n+\n import { parseBlanks } from '../fill-in-the-blank/parse-blanks';\n import PrismFormatted from '../components/prism-formatted';\n import { FillInTheBlank } from '../../../redux/prop-types';\n@@ -26,18 +26,22 @@ function FillInTheBlanks({\n }: FillInTheBlankProps): JSX.Element {\n   const { t } = useTranslation();\n \n-  const addInputClass = (index: number): string => {\n-    if (answersCorrect[index] === true) return 'green-underline';\n-    if (answersCorrect[index] === false) return 'red-underline';\n-    return '';\n+  const getInputClass = (index: number): string => {\n+    let cls = 'fill-in-the-blank-input';\n+\n+    if (answersCorrect[index] === false) {\n+      cls += ' incorrect-blank-answer';\n+    }\n+\n+    return cls;\n   };\n \n   const paragraphs = parseBlanks(sentence);\n   const blankAnswers = blanks.map(b => b.answer);\n \n   return (\n     <>\n-      <ChallengeHeading heading={t('learn.fill-in-the-blank')} />\n+      <ChallengeHeading heading={t('learn.fill-in-the-blank.heading')} />\n       <Spacer size='xs' />\n       <div className='fill-in-the-blank-wrap'>\n         {paragraphs.map((p, i) => {\n@@ -47,36 +51,49 @@ function FillInTheBlanks({\n             <p key={i}>\n               {p.map((node, j) => {\n                 const { type, value } = node;\n-                if (type === 'text') return value;\n-                if (type === 'blank')\n+                if (type === 'text') {\n+                  return value;\n+                }\n+\n+                // If a blank is answered correctly, render the answer as part of the sentence.\n+                if (type === 'blank' && answersCorrect[value] === true) {\n                   return (\n-                    <input\n-                      key={j}\n-                      type='text'\n-                      maxLength={blankAnswers[value].length + 3}\n-                      className={`fill-in-the-blank-input ${addInputClass(\n-                        value\n-                      )}`}\n-                      onChange={handleInputChange}\n-                      data-index={node.value}\n-                      size={blankAnswers[value].length}\n-                      aria-label={t('learn.blank')}\n-                    />\n+                    <span key={j} className='correct-blank-answer'>\n+                      {blankAnswers[value]}\n+                    </span>\n                   );\n+                }\n+\n+                return (\n+                  <input\n+                    key={j}\n+                    type='text'\n+                    maxLength={blankAnswers[value].length + 3}\n+                    className={getInputClass(value)}\n+                    onChange={handleInputChange}\n+                    data-index={node.value}\n+                    size={blankAnswers[value].length}\n+                    autoComplete='off'\n+                    aria-label={t('learn.fill-in-the-blank.blank')}\n+                    {...(answersCorrect[value] === false\n+                      ? { 'aria-invalid': 'true' }\n+                      : {})}\n+                  />\n+                );\n               })}\n             </p>\n           );\n         })}\n       </div>\n       <Spacer size='m' />\n-      {showFeedback && feedback && (\n-        <>\n-          <PrismFormatted text={feedback} />\n-          <Spacer size='m' />\n-        </>\n-      )}\n-      <div className='text-center'>\n-        {showWrong && <span>{t('learn.wrong-answer')}</span>}\n+      <div aria-live='polite'>\n+        {showWrong && (\n+          <div className='text-center'>\n+            <span>{t('learn.wrong-answer')}</span>\n+            <Spacer size='m' />\n+          </div>\n+        )}\n+        {showFeedback && feedback && <PrismFormatted text={feedback} />}\n       </div>\n     </>\n   );"
        },
        {
            "sha": "d6080bacdb75e31d4430e00ec3e6195525a0e41a",
            "filename": "client/src/templates/Challenges/fill-in-the-blank/show.css",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e7897de0a2c6053191ca4746660b9ccabbb80cc3/client%2Fsrc%2Ftemplates%2FChallenges%2Ffill-in-the-blank%2Fshow.css",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e7897de0a2c6053191ca4746660b9ccabbb80cc3/client%2Fsrc%2Ftemplates%2FChallenges%2Ffill-in-the-blank%2Fshow.css",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Ffill-in-the-blank%2Fshow.css?ref=e7897de0a2c6053191ca4746660b9ccabbb80cc3",
            "patch": "@@ -36,10 +36,11 @@\n   z-index: 2;\n }\n \n-.green-underline {\n-  border-bottom-color: var(--success-background) !important;\n+.correct-blank-answer {\n+  color: var(--background-success) !important;\n+  font-weight: bold;\n }\n \n-.red-underline {\n-  border-bottom-color: var(--danger-background) !important;\n+.incorrect-blank-answer {\n+  border-bottom-color: var(--background-danger) !important;\n }"
        },
        {
            "sha": "8b04029faae538861abd22a1bc51745ae5b7b2e8",
            "filename": "e2e/fill-in-the-blanks.spec.ts",
            "status": "added",
            "additions": 51,
            "deletions": 0,
            "changes": 51,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e7897de0a2c6053191ca4746660b9ccabbb80cc3/e2e%2Ffill-in-the-blanks.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e7897de0a2c6053191ca4746660b9ccabbb80cc3/e2e%2Ffill-in-the-blanks.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Ffill-in-the-blanks.spec.ts?ref=e7897de0a2c6053191ca4746660b9ccabbb80cc3",
            "patch": "@@ -0,0 +1,51 @@\n+import { test, expect } from '@playwright/test';\n+\n+test.describe('Fill in the blanks challenge', () => {\n+  test.beforeEach(async ({ page }) => {\n+    await page.goto(\n+      '/learn/a2-english-for-developers/learn-greetings-in-your-first-day-at-the-office/task-46'\n+    );\n+  });\n+\n+  test('should display feedback if there is an incorrect answer', async ({\n+    page\n+  }) => {\n+    const blanks = page.getByRole('textbox', { name: 'blank' });\n+\n+    await blanks.first().fill('this'); // Answer the first blank correctly\n+    await blanks.last().fill('bar'); // Answer the second blank incorrectly\n+    await page.getByRole('button', { name: 'Check your answer' }).click();\n+\n+    await expect(\n+      page.getByText(\"Sorry, that's not the right answer. Give it another try?\")\n+    ).toBeVisible();\n+\n+    // Once a blank is answered correctly, it is no longer rendered as an input field\n+    await expect(blanks).toHaveCount(1);\n+\n+    await expect(blanks.last()).toHaveAttribute('aria-invalid', 'true');\n+  });\n+\n+  test('should not display feedback if all blanks are answered correctly', async ({\n+    page\n+  }) => {\n+    const blanks = page.getByRole('textbox', { name: 'blank' });\n+\n+    await blanks.first().fill('this');\n+    await blanks.last().fill('those');\n+    await page.getByRole('button', { name: 'Check your answer' }).click();\n+\n+    // Close the completion modal\n+    await page\n+      .getByRole('dialog')\n+      .getByRole('button', { name: 'Close' })\n+      .click();\n+\n+    await expect(\n+      page.getByText(\"Sorry, that's not the right answer. Give it another try?\")\n+    ).toBeHidden();\n+\n+    // There aren't any blanks as all the inputs are rendered as text\n+    await expect(blanks).toBeHidden();\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 139,
        "additions": 105,
        "deletions": 34
    }
}