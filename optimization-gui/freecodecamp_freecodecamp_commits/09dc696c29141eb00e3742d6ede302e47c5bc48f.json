{
    "author": "ahmaxed",
    "message": "feat: add email sign up alert (#61218)\n\nCo-authored-by: Niraj Nandish <nirajnandish@icloud.com>\nCo-authored-by: Mrugesh Mohapatra <1884376+raisedadead@users.noreply.github.com>\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>\nCo-authored-by: Shaun Hamilton <shauhami020@gmail.com>",
    "sha": "09dc696c29141eb00e3742d6ede302e47c5bc48f",
    "files": [
        {
            "sha": "f193ac6bf2ae7445deffdf8bcadea7f8c3970b76",
            "filename": "api/prisma/schema.prisma",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fprisma%2Fschema.prisma",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fprisma%2Fschema.prisma",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fprisma%2Fschema.prisma?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -147,7 +147,8 @@ model user {\n   /// Valuable for selectively performing random logic.\n   rand                           Float?\n   savedChallenges                SavedChallenge[] // Undefined | SavedChallenge[]\n-  sendQuincyEmail                Boolean\n+  // Nullable tri-state: null (likely new user), true (subscribed), false (unsubscribed)\n+  sendQuincyEmail                Boolean?\n   theme                          String? // Undefined\n   timezone                       String? // Undefined\n   twitter                        String? // Null | Undefined"
        },
        {
            "sha": "0d79851410c9d8d68465627f1f1678c6468921b4",
            "filename": "api/src/plugins/__fixtures__/user.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Fplugins%2F__fixtures__%2Fuser.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Fplugins%2F__fixtures__%2Fuser.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2F__fixtures__%2Fuser.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -79,7 +79,7 @@ export const newUser = (email: string) => ({\n   progressTimestamps: [expect.any(Number)],\n   rand: null, // TODO(Post-MVP): delete from schema (it's not used or required).\n   savedChallenges: [],\n-  sendQuincyEmail: false,\n+  sendQuincyEmail: null,\n   theme: 'default',\n   timezone: null,\n   twitter: null,"
        },
        {
            "sha": "78946581c1ca0ea09d7fda2eb9bca3ee252e8989",
            "filename": "api/src/plugins/auth0.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 20,
            "changes": 20,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Fplugins%2Fauth0.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Fplugins%2Fauth0.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fauth0.test.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -332,26 +332,6 @@ describe('auth0 plugin', () => {\n       expect(res.headers.location).toMatch(HOME_LOCATION);\n     });\n \n-    test('should redirect to email-sign-up if the user has not acceptedPrivacyTerms', async () => {\n-      mockAuthSuccess();\n-      // Using an italian path to make sure redirection works.\n-      const italianReturnTo = 'https://www.freecodecamp.org/italian/settings';\n-\n-      const res = await fastify.inject({\n-        method: 'GET',\n-        url: '/auth/auth0/callback?state=valid',\n-        cookies: {\n-          'login-returnto': sign(italianReturnTo)\n-        }\n-      });\n-\n-      expect(res.headers.location).toEqual(\n-        expect.stringContaining(\n-          'https://www.freecodecamp.org/italian/email-sign-up?'\n-        )\n-      );\n-    });\n-\n     test('should populate the user with the correct data', async () => {\n       mockAuthSuccess();\n "
        },
        {
            "sha": "85250fb2955c10cbe8099500c86f45cdbe32338a",
            "filename": "api/src/plugins/auth0.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 21,
            "changes": 28,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Fplugins%2Fauth0.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Fplugins%2Fauth0.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fauth0.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -15,10 +15,7 @@ import {\n } from '../utils/env';\n import { findOrCreateUser } from '../routes/helpers/auth-helpers';\n import { createAccessToken } from '../utils/tokens';\n-import {\n-  getLoginRedirectParams,\n-  getPrefixedLandingPath\n-} from '../utils/redirection';\n+import { getLoginRedirectParams } from '../utils/redirection';\n \n declare module 'fastify' {\n   interface FastifyInstance {\n@@ -108,8 +105,7 @@ export const auth0Client: FastifyPluginCallbackTypebox = fp(\n         }\n       }\n \n-      const { returnTo, pathPrefix, origin } = getLoginRedirectParams(req);\n-      const redirectBase = getPrefixedLandingPath(origin, pathPrefix);\n+      const { returnTo } = getLoginRedirectParams(req);\n \n       let token;\n       try {\n@@ -166,24 +162,14 @@ export const auth0Client: FastifyPluginCallbackTypebox = fp(\n         });\n       }\n \n-      const { id, acceptedPrivacyTerms } = await findOrCreateUser(\n-        fastify,\n-        email\n-      );\n+      const { id } = await findOrCreateUser(fastify, email);\n \n       reply.setAccessTokenCookie(createAccessToken(id));\n \n-      if (acceptedPrivacyTerms) {\n-        void reply.redirectWithMessage(returnTo, {\n-          type: 'success',\n-          content: 'flash.signin-success'\n-        });\n-      } else {\n-        void reply.redirectWithMessage(`${redirectBase}/email-sign-up`, {\n-          type: 'success',\n-          content: 'flash.signin-success'\n-        });\n-      }\n+      void reply.redirectWithMessage(returnTo, {\n+        type: 'success',\n+        content: 'flash.signin-success'\n+      });\n     });\n \n     done();"
        },
        {
            "sha": "606896162e1f993443e942dedcbf323f6800ffa2",
            "filename": "api/src/routes/protected/user.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Froutes%2Fprotected%2Fuser.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Froutes%2Fprotected%2Fuser.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fprotected%2Fuser.test.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -151,7 +151,8 @@ const testUserData: Prisma.userCreateInput = {\n   ],\n   yearsTopContributor: ['2018'],\n   twitter: '@foobar',\n-  linkedin: 'linkedin.com/foobar'\n+  linkedin: 'linkedin.com/foobar',\n+  sendQuincyEmail: false\n };\n \n const minimalUserData: Prisma.userCreateInput = {\n@@ -301,6 +302,7 @@ const publicUserData = {\n   profileUI: testUserData.profileUI,\n   savedChallenges: testUserData.savedChallenges,\n   twitter: 'https://twitter.com/foobar',\n+  sendQuincyEmail: testUserData.sendQuincyEmail,\n   username: testUserData.username,\n   usernameDisplay: testUserData.usernameDisplay,\n   website: testUserData.website,"
        },
        {
            "sha": "c2daa63684614bc6aca096edc4eac411375f2164",
            "filename": "api/src/routes/protected/user.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Froutes%2Fprotected%2Fuser.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Froutes%2Fprotected%2Fuser.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fprotected%2Fuser.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -697,6 +697,7 @@ export const userGetRoutes: FastifyPluginCallbackTypebox = (\n           user: {\n             [username]: {\n               ...removeNulls(publicUser),\n+              sendQuincyEmail: publicUser.sendQuincyEmail,\n               ...normalizeFlags(flags),\n               picture: publicUser.picture ?? '',\n               email: email ?? '',"
        },
        {
            "sha": "96f7eeb803de311f183f3a64f714d8d7f452ea44",
            "filename": "api/src/routes/public/user.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Froutes%2Fpublic%2Fuser.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Froutes%2Fpublic%2Fuser.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fpublic%2Fuser.test.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -26,6 +26,7 @@ vi.spyOn(globalThis, 'fetch').mockImplementation(mockedFetch);\n // This is used to build a test user.\n const testUserData: Prisma.userCreateInput = {\n   ...createUserInput(defaultUserEmail),\n+  sendQuincyEmail: true,\n   username: 'foobar',\n   usernameDisplay: 'Foo Bar',\n   progressTimestamps: [1520002973119, 1520440323273],"
        },
        {
            "sha": "6e4623d2907c308d282b5f09c605dd41699eacd4",
            "filename": "api/src/schemas/user/get-session-user.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Fschemas%2Fuser%2Fget-session-user.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Fschemas%2Fuser%2Fget-session-user.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fuser%2Fget-session-user.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -108,7 +108,7 @@ export const getSessionUser = {\n             })\n           ),\n           profileUI: Type.Optional(profileUI),\n-          sendQuincyEmail: Type.Boolean(),\n+          sendQuincyEmail: Type.Union([Type.Null(), Type.Boolean()]), //           // Tri-state: null (likely new user), true (subscribed), false (unsubscribed)\n           theme: Type.String(),\n           twitter: Type.Optional(Type.String()),\n           website: Type.Optional(Type.String()),"
        },
        {
            "sha": "52c08e3d58e73780fbce2d6adfad93e42d76afc3",
            "filename": "api/src/utils/create-user.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Futils%2Fcreate-user.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/api%2Fsrc%2Futils%2Fcreate-user.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Futils%2Fcreate-user.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -82,7 +82,7 @@ export function createUserInput(email: string) {\n       showPortfolio: false,\n       showTimeLine: false\n     },\n-    sendQuincyEmail: false,\n+    sendQuincyEmail: null,\n     theme: 'default',\n     username,\n     usernameDisplay: username,"
        },
        {
            "sha": "09ae41d9db1dd0a30670dc464ee6f924c19f82da",
            "filename": "client/src/components/Intro/email-sign-up-alert.tsx",
            "status": "added",
            "additions": 56,
            "deletions": 0,
            "changes": 56,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2FIntro%2Femail-sign-up-alert.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2FIntro%2Femail-sign-up-alert.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FIntro%2Femail-sign-up-alert.tsx?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -0,0 +1,56 @@\n+import React from 'react';\n+import { connect } from 'react-redux';\n+import { Container } from '@freecodecamp/ui';\n+import EmailOptions from '../email-options';\n+import { updateMyQuincyEmail } from '../../redux/settings/actions';\n+import { userSelector, isSignedInSelector } from '../../redux/selectors';\n+import { CompletedChallenge } from '../../redux/prop-types';\n+\n+interface EmailSignUpAlertProps {\n+  updateQuincyEmail: (isSendQuincyEmail: boolean) => void;\n+  sendQuincyEmail: boolean | null;\n+  isSignedIn: boolean;\n+  completedChallengesCount: number;\n+}\n+\n+const mapStateToProps = (state: unknown) => {\n+  const user = userSelector(state) as {\n+    sendQuincyEmail: boolean | null;\n+    completedChallenges: CompletedChallenge[];\n+  };\n+  return {\n+    sendQuincyEmail: user.sendQuincyEmail,\n+    isSignedIn: isSignedInSelector(state),\n+    completedChallengesCount: user.completedChallenges.length\n+  };\n+};\n+\n+const mapDispatchToProps = {\n+  updateQuincyEmail: (sendQuincyEmail: boolean) =>\n+    updateMyQuincyEmail({ sendQuincyEmail })\n+};\n+\n+function EmailSignUpAlert({\n+  updateQuincyEmail,\n+  sendQuincyEmail,\n+  isSignedIn,\n+  completedChallengesCount = 0\n+}: EmailSignUpAlertProps) {\n+  const newAccount = isSignedIn && completedChallengesCount < 1;\n+  const userHasMadeEmailSelection = sendQuincyEmail !== null;\n+\n+  if (userHasMadeEmailSelection || newAccount) {\n+    return null;\n+  }\n+\n+  return (\n+    <Container fluid={true} className='email-sign-up-alert'>\n+      <EmailOptions\n+        isSignedIn={isSignedIn}\n+        updateQuincyEmail={updateQuincyEmail}\n+      />\n+    </Container>\n+  );\n+}\n+\n+export default connect(mapStateToProps, mapDispatchToProps)(EmailSignUpAlert);"
        },
        {
            "sha": "6d0ed1e80be2f914f60a67028ae12280b2feb4e6",
            "filename": "client/src/components/Intro/index.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2FIntro%2Findex.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2FIntro%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FIntro%2Findex.tsx?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -6,6 +6,7 @@ import Login from '../Header/components/login';\n import { Link, Loader } from '../helpers';\n \n import './intro.css';\n+import EmailSignUpAlert from './email-sign-up-alert';\n import LearnAlert from './learn-alert';\n \n interface IntroProps {\n@@ -64,6 +65,7 @@ const Intro = ({\n           onLearnDonationAlertClick={onLearnDonationAlertClick}\n           isDonating={isDonating}\n         />\n+        <EmailSignUpAlert />\n         {completedChallengeCount && slug && completedChallengeCount < 15 ? (\n           <div className='intro-description'>\n             <Spacer size='m' />"
        },
        {
            "sha": "36901de3634f21e153977d1c07e14f675e41ef7a",
            "filename": "client/src/components/Intro/intro.css",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2FIntro%2Fintro.css",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2FIntro%2Fintro.css",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FIntro%2Fintro.css?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -42,3 +42,20 @@\n   font-style: normal;\n   color: var(--secondary-color);\n }\n+\n+.email-sign-up-alert {\n+  padding: 20px;\n+  border: 1px solid var(--quaternary-color);\n+  margin-bottom: 1.5rem;\n+}\n+\n+.email-list-opt {\n+  display: flex;\n+  flex-wrap: wrap;\n+}\n+\n+.message-author {\n+  display: block;\n+  text-align: center;\n+  font-style: italic;\n+}"
        },
        {
            "sha": "da26fc0f5462b5727e4868361fff445309d200fa",
            "filename": "client/src/components/Intro/intro.test.tsx",
            "status": "modified",
            "additions": 18,
            "deletions": 3,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2FIntro%2Fintro.test.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2FIntro%2Fintro.test.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FIntro%2Fintro.test.tsx?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -7,8 +7,11 @@ import Intro from '.';\n \n jest.mock('../../analytics');\n \n-function renderWithRedux(ui: JSX.Element) {\n-  return render(<Provider store={createStore()}>{ui}</Provider>);\n+function renderWithRedux(\n+  ui: JSX.Element,\n+  preloadedState: Record<string, unknown> = {}\n+) {\n+  return render(<Provider store={createStore(preloadedState)}>{ui}</Provider>);\n }\n \n describe('<Intro />', () => {\n@@ -19,7 +22,19 @@ describe('<Intro />', () => {\n   });\n \n   it('has a blockquote when loggedIn', () => {\n-    renderWithRedux(<Intro {...loggedInProps} />);\n+    // Provide a minimal preloaded state so connected components expecting a\n+    // sessionUser (e.g. EmailSignUpAlert) do not receive null.\n+    const preloadedState = {\n+      app: {\n+        user: {\n+          sessionUser: {\n+            completedChallenges: [{}],\n+            sendQuincyEmail: null\n+          }\n+        }\n+      }\n+    };\n+    renderWithRedux(<Intro {...loggedInProps} />, preloadedState);\n     expect(screen.getByTestId('quote-block')).toBeInTheDocument();\n     expect(screen.getByRole('heading', { level: 1 })).toBeInTheDocument();\n   });"
        },
        {
            "sha": "9669fc290cd05f434714bac40e8f1c8cbabeb512",
            "filename": "client/src/components/email-options.tsx",
            "status": "added",
            "additions": 101,
            "deletions": 0,
            "changes": 101,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2Femail-options.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2Femail-options.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Femail-options.tsx?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -0,0 +1,101 @@\n+import React from 'react';\n+import { useTranslation } from 'react-i18next';\n+import { Col, Row, Button, Spacer } from '@freecodecamp/ui';\n+import { apiLocation } from '../../config/env.json';\n+\n+interface EmailListOptInProps {\n+  isSignedIn: boolean;\n+  updateQuincyEmail: (isSendQuincyEmail: boolean) => void;\n+}\n+\n+export function EmailListOptIn({\n+  isSignedIn,\n+  updateQuincyEmail\n+}: EmailListOptInProps) {\n+  const { t } = useTranslation();\n+\n+  if (isSignedIn) {\n+    return (\n+      <Row className='email-list-opt'>\n+        <Col md={4} mdOffset={2} sm={5} smOffset={1} xs={12}>\n+          <Button\n+            block={true}\n+            variant='primary'\n+            onClick={() => updateQuincyEmail(true)}\n+          >\n+            {t('buttons.yes-please')}\n+          </Button>\n+          <Spacer size='xs' />\n+        </Col>\n+        <Col md={4} sm={5} xs={12}>\n+          <Button\n+            block={true}\n+            variant='primary'\n+            onClick={() => updateQuincyEmail(false)}\n+          >\n+            {t('buttons.no-thanks')}\n+          </Button>\n+          <Spacer size='xs' />\n+        </Col>\n+      </Row>\n+    );\n+  } else {\n+    return (\n+      <Row>\n+        <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n+          <Spacer size='xs' />\n+          <Button block={true} variant='primary' href={`${apiLocation}/signin`}>\n+            {t('buttons.sign-up-email-list')}\n+          </Button>\n+          <Spacer size='xs' />\n+        </Col>\n+      </Row>\n+    );\n+  }\n+}\n+\n+interface EmailOptionsProps {\n+  isSignedIn: boolean;\n+  updateQuincyEmail: (isSendQuincyEmail: boolean) => void;\n+  isPage?: boolean;\n+}\n+\n+function EmailOptions({\n+  isSignedIn,\n+  updateQuincyEmail,\n+  isPage\n+}: EmailOptionsProps) {\n+  const { t } = useTranslation();\n+\n+  return (\n+    <>\n+      <Row>\n+        <Col xs={12}>\n+          {isPage ? (\n+            <h1 className='text-center'>{t('misc.email-signup')}</h1>\n+          ) : (\n+            <h2 className='text-center'>{t('misc.email-signup')}</h2>\n+          )}\n+          <Spacer size='xs' />\n+        </Col>\n+      </Row>\n+\n+      <Row>\n+        <Col\n+          {...(isPage ? { md: 8, mdOffset: 2, sm: 10, smOffset: 1 } : {})}\n+          xs={12}\n+        >\n+          <p>{t('misc.email-blast')}</p>\n+          <span className='message-author'>{t('misc.quincy')}</span>\n+          <Spacer size='m' />\n+        </Col>\n+      </Row>\n+      <EmailListOptIn\n+        isSignedIn={isSignedIn}\n+        updateQuincyEmail={updateQuincyEmail}\n+      />\n+    </>\n+  );\n+}\n+\n+export default EmailOptions;"
        },
        {
            "sha": "e178bfff5fa2dfc322ce766eac2052d1c864ad58",
            "filename": "client/src/components/profile/profile.test.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2Fprofile%2Fprofile.test.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2Fprofile%2Fprofile.test.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fprofile%2Fprofile.test.tsx?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -11,7 +11,6 @@ window.___loader = { enqueue: () => {}, hovering: () => {} };\n \n const userProps = {\n   user: {\n-    acceptedPrivacyTerms: true,\n     currentChallengeId: 'string',\n     email: 'string',\n     emailVerified: true,"
        },
        {
            "sha": "485d75cae4716710e12f1e44bec4f39230cb4265",
            "filename": "client/src/components/settings/email.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2Fsettings%2Femail.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fcomponents%2Fsettings%2Femail.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fsettings%2Femail.tsx?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -32,7 +32,7 @@ const mapDispatchToProps = (dispatch: Dispatch) =>\n type EmailProps = {\n   email: string;\n   isEmailVerified: boolean;\n-  sendQuincyEmail: boolean;\n+  sendQuincyEmail: boolean | null;\n   t: TFunction;\n   updateMyEmail: (email: string) => void;\n   updateQuincyEmail: (sendQuincyEmail: boolean) => void;\n@@ -250,7 +250,7 @@ function EmailSettings({\n       <FullWidthRow>\n         <ToggleButtonSetting\n           action={t('settings.email.weekly')}\n-          flag={sendQuincyEmail}\n+          flag={!!sendQuincyEmail}\n           flagName='sendQuincyEmail'\n           offLabel={t('buttons.no-thanks')}\n           onLabel={t('buttons.yes-please')}"
        },
        {
            "sha": "7284a34701e650939f32a274bb5f65f73821e267",
            "filename": "client/src/pages/email-sign-up.css",
            "status": "removed",
            "additions": 0,
            "deletions": 20,
            "changes": 20,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/29513a4d6dfd9393fc7df13c9921178dfcd4c623/client%2Fsrc%2Fpages%2Femail-sign-up.css",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/29513a4d6dfd9393fc7df13c9921178dfcd4c623/client%2Fsrc%2Fpages%2Femail-sign-up.css",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fpages%2Femail-sign-up.css?ref=29513a4d6dfd9393fc7df13c9921178dfcd4c623",
            "patch": "@@ -1,20 +0,0 @@\n-.email-sign-up strong,\n-.email-sign-up p {\n-  font-size: 1rem;\n-}\n-\n-/*\n-This is a temporary fix until the component library is revisited.\n-See https://github.com/freeCodeCamp/freeCodeCamp/issues/52131#issuecomment-1788840851.\n-*/\n-.email-list-opt {\n-  display: flex;\n-  flex-wrap: wrap;\n-}\n-\n-@media (min-width: 500px) {\n-  .email-sign-up strong,\n-  .email-sign-up p {\n-    font-size: 1.17rem;\n-  }\n-}"
        },
        {
            "sha": "c4623318f6143db07e73151448c48238642b86e7",
            "filename": "client/src/pages/email-sign-up.tsx",
            "status": "modified",
            "additions": 33,
            "deletions": 127,
            "changes": 160,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fpages%2Femail-sign-up.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fpages%2Femail-sign-up.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fpages%2Femail-sign-up.tsx?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -1,170 +1,76 @@\n-import React, { useEffect, useRef } from 'react';\n+import React from 'react';\n import Helmet from 'react-helmet';\n-import { useTranslation, Trans } from 'react-i18next';\n+import { useTranslation } from 'react-i18next';\n import { connect } from 'react-redux';\n-import { bindActionCreators } from 'redux';\n-import type { Dispatch } from 'redux';\n import { createSelector } from 'reselect';\n-import { Container, Col, Row, Button, Spacer } from '@freecodecamp/ui';\n+import { Container, Spacer } from '@freecodecamp/ui';\n \n import createRedirect from '../components/create-redirect';\n-import { Loader, Link } from '../components/helpers';\n-import { apiLocation } from '../../config/env.json';\n-\n-import { acceptTerms } from '../redux/actions';\n+import { Loader } from '../components/helpers';\n+import EmailOptions from '../components/email-options';\n+import { updateMyQuincyEmail } from '../redux/settings/actions';\n import {\n   signInLoadingSelector,\n   userSelector,\n   isSignedInSelector\n } from '../redux/selectors';\n import type { User } from '../redux/prop-types';\n \n-import './email-sign-up.css';\n-interface AcceptPrivacyTermsProps {\n-  acceptTerms: (accept: boolean | null) => void;\n-  acceptedPrivacyTerms: boolean;\n+interface EmailSignUpProps {\n+  updateQuincyEmail: (isSendQuincyEmail: boolean) => void;\n+  sendQuincyEmail: boolean | null | undefined;\n   isSignedIn: boolean;\n   showLoading: boolean;\n-  completedChallengeCount: number;\n }\n \n const mapStateToProps = createSelector(\n   userSelector,\n   isSignedInSelector,\n   signInLoadingSelector,\n   (user: User | null, isSignedIn: boolean, showLoading: boolean) => ({\n-    acceptedPrivacyTerms: !!user?.acceptedPrivacyTerms,\n+    sendQuincyEmail: user?.sendQuincyEmail,\n     isSignedIn,\n-    showLoading,\n-    completedChallengeCount: user?.completedChallengeCount ?? 0\n+    showLoading\n   })\n );\n-const mapDispatchToProps = (dispatch: Dispatch) =>\n-  bindActionCreators({ acceptTerms }, dispatch);\n+const mapDispatchToProps = {\n+  updateQuincyEmail: (sendQuincyEmail: boolean) =>\n+    updateMyQuincyEmail({ sendQuincyEmail })\n+};\n const RedirectToLearn = createRedirect('/learn');\n \n-function EmailListOptIn({\n-  isSignedIn,\n-  acceptTerms\n-}: {\n-  isSignedIn: boolean;\n-  acceptTerms: (accepted: boolean) => void;\n-}) {\n-  const { t } = useTranslation();\n-  if (isSignedIn) {\n-    return (\n-      <Container>\n-        <Row className='email-list-opt'>\n-          <Col md={4} mdOffset={2} sm={5} smOffset={1} xs={12}>\n-            <Button\n-              block={true}\n-              size='large'\n-              variant='primary'\n-              onClick={() => acceptTerms(true)}\n-            >\n-              {t('buttons.yes-please')}\n-            </Button>\n-            <Spacer size='xs' />\n-          </Col>\n-          <Col md={4} sm={5} xs={12}>\n-            <Button\n-              block={true}\n-              size='large'\n-              variant='primary'\n-              onClick={() => acceptTerms(false)}\n-            >\n-              {t('buttons.no-thanks')}\n-            </Button>\n-            <Spacer size='xs' />\n-          </Col>\n-        </Row>\n-      </Container>\n-    );\n-  } else {\n-    return (\n-      <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n-        <Spacer size='xs' />\n-        <Button\n-          block={true}\n-          size='large'\n-          variant='primary'\n-          href={`${apiLocation}/signin`}\n-        >\n-          {t('buttons.sign-up-email-list')}\n-        </Button>\n-        <Spacer size='xs' />\n-      </Col>\n-    );\n-  }\n-}\n-\n-function AcceptPrivacyTerms({\n-  acceptTerms,\n-  acceptedPrivacyTerms,\n+function EmailSignUp({\n+  updateQuincyEmail,\n+  sendQuincyEmail,\n   isSignedIn,\n-  showLoading,\n-  completedChallengeCount\n-}: AcceptPrivacyTermsProps) {\n+  showLoading\n+}: EmailSignUpProps) {\n   const { t } = useTranslation();\n-  const acceptedPrivacyRef = useRef(acceptedPrivacyTerms);\n-  const acceptTermsRef = useRef(acceptTerms);\n-  const newAccount = isSignedIn && completedChallengeCount < 1;\n \n-  useEffect(() => {\n-    acceptedPrivacyRef.current = acceptedPrivacyTerms;\n-    acceptTermsRef.current = acceptTerms;\n-    // eslint-disable-next-line react-hooks/exhaustive-deps\n-  }, []);\n+  const userHasMadeSelection = isSignedIn && sendQuincyEmail !== null;\n \n-  return acceptedPrivacyTerms ? (\n+  return userHasMadeSelection ? (\n     <RedirectToLearn />\n   ) : (\n     <>\n       <Helmet>\n         <title>{t('misc.email-signup')} | freeCodeCamp.org</title>\n       </Helmet>\n       <Container>\n-        <Row>\n-          <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n-            <Spacer size='l' />\n-            <h1 className='text-center'>\n-              {newAccount\n-                ? t('misc.brand-new-account')\n-                : t('misc.email-signup')}\n-            </h1>\n-            <Spacer size='xs' />\n-          </Col>\n-        </Row>\n-        {newAccount && (\n-          <Row>\n-            <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n-              <p>\n-                <Trans i18nKey='misc.duplicate-account-warning'>\n-                  <Link className='inline' to='/settings#danger-zone' />\n-                </Trans>\n-              </p>\n-              <hr />\n-            </Col>\n-          </Row>\n+        <Spacer size='l' />\n+        {showLoading ? (\n+          <Loader fullScreen={true} />\n+        ) : (\n+          <EmailOptions\n+            isSignedIn={isSignedIn}\n+            updateQuincyEmail={updateQuincyEmail}\n+            isPage={true}\n+          />\n         )}\n-        <Row className='email-sign-up'>\n-          <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n-            <Spacer size='xs' />\n-            <p>{t('misc.email-blast')}</p>\n-            <Spacer size='xs' />\n-          </Col>\n-          {showLoading ? (\n-            <Loader fullScreen={true} />\n-          ) : (\n-            <EmailListOptIn isSignedIn={isSignedIn} acceptTerms={acceptTerms} />\n-          )}\n-          <Col xs={12}>\n-            <Spacer size='m' />\n-          </Col>\n-        </Row>\n       </Container>\n+      <Spacer size='l' />\n     </>\n   );\n }\n \n-export default connect(mapStateToProps, mapDispatchToProps)(AcceptPrivacyTerms);\n+export default connect(mapStateToProps, mapDispatchToProps)(EmailSignUp);"
        },
        {
            "sha": "8397de24416a7fd41ccf632c867157b7495e3ecb",
            "filename": "client/src/redux/accept-terms-saga.js",
            "status": "removed",
            "additions": 0,
            "deletions": 28,
            "changes": 28,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/29513a4d6dfd9393fc7df13c9921178dfcd4c623/client%2Fsrc%2Fredux%2Faccept-terms-saga.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/29513a4d6dfd9393fc7df13c9921178dfcd4c623/client%2Fsrc%2Fredux%2Faccept-terms-saga.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Faccept-terms-saga.js?ref=29513a4d6dfd9393fc7df13c9921178dfcd4c623",
            "patch": "@@ -1,28 +0,0 @@\n-import { navigate } from 'gatsby';\n-import { call, put, takeEvery } from 'redux-saga/effects';\n-\n-import { createFlashMessage } from '../components/Flash/redux';\n-import { putUserAcceptsTerms } from '../utils/ajax';\n-import { acceptTermsComplete, acceptTermsError } from './actions';\n-\n-function* acceptTermsSaga({ payload: quincyEmails }) {\n-  try {\n-    const { data } = yield call(putUserAcceptsTerms, quincyEmails);\n-\n-    yield put(acceptTermsComplete(quincyEmails));\n-    yield put(createFlashMessage(data));\n-  } catch (e) {\n-    yield put(acceptTermsError(e));\n-  }\n-}\n-\n-function* acceptCompleteSaga() {\n-  yield call(navigate, '/learn');\n-}\n-\n-export function createAcceptTermsSaga(types) {\n-  return [\n-    takeEvery(types.acceptTerms, acceptTermsSaga),\n-    takeEvery(types.acceptTermsComplete, acceptCompleteSaga)\n-  ];\n-}"
        },
        {
            "sha": "dd85c8d186081bd3660c08a7c6ee7d61db580f3c",
            "filename": "client/src/redux/action-types.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fredux%2Faction-types.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fredux%2Faction-types.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Faction-types.js?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -42,7 +42,6 @@ export const actionTypes = createTypes(\n     ...createAsyncTypes('fetchUser'),\n     ...createAsyncTypes('postCharge'),\n     ...createAsyncTypes('fetchProfileForUser'),\n-    ...createAsyncTypes('acceptTerms'),\n     ...createAsyncTypes('showCert'),\n     ...createAsyncTypes('reportUser'),\n     ...createAsyncTypes('deleteUserToken'),"
        },
        {
            "sha": "5f363fe7fb473e138396b19da5be919ab6a1d3cc",
            "filename": "client/src/redux/actions.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fredux%2Factions.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fredux%2Factions.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Factions.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -42,12 +42,6 @@ export const saveChallengeComplete = createAction(\n   actionTypes.saveChallengeComplete\n );\n \n-export const acceptTerms = createAction(actionTypes.acceptTerms);\n-export const acceptTermsComplete = createAction(\n-  actionTypes.acceptTermsComplete\n-);\n-export const acceptTermsError = createAction(actionTypes.acceptTermsError);\n-\n export const fetchUser = createAction(actionTypes.fetchUser);\n export const fetchUserComplete = createAction(actionTypes.fetchUserComplete);\n export const fetchUserTimeout = createAction(actionTypes.fetchUserTimeout);"
        },
        {
            "sha": "fa63d9226eb603229852b5d5d23044049bf2eed1",
            "filename": "client/src/redux/index.js",
            "status": "modified",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fredux%2Findex.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fredux%2Findex.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Findex.js?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -7,7 +7,6 @@ import {\n   CURRENT_CHALLENGE_KEY\n } from '../templates/Challenges/redux/action-types';\n import { getIsDailyCodingChallenge } from '../../../shared/config/challenge-types';\n-import { createAcceptTermsSaga } from './accept-terms-saga';\n import { actionTypes, ns as MainApp } from './action-types';\n import { createAppMountSaga } from './app-mount-saga';\n import { createDonationSaga } from './donation-saga';\n@@ -88,7 +87,6 @@ const initialState = {\n export const epics = [hardGoToEpic, failedUpdatesEpic, updateCompleteEpic];\n \n export const sagas = [\n-  ...createAcceptTermsSaga(actionTypes),\n   ...createThemeSaga(actionTypes),\n   ...createAppMountSaga(actionTypes),\n   ...createDonationSaga(actionTypes),\n@@ -117,26 +115,6 @@ function spreadThePayloadOnUser(state, payload) {\n \n export const reducer = handleActions(\n   {\n-    [actionTypes.acceptTermsComplete]: (state, { payload }) => {\n-      return {\n-        ...state,\n-        user: {\n-          ...state.user,\n-          sessionUser: {\n-            ...state.user.sessionUser,\n-            // TODO: the user accepts the privacy terms in practice during auth\n-            // however, it's currently being used to track if they've accepted\n-            // or rejected the newsletter. Ideally this should be migrated,\n-            // since they can't sign up without accepting the terms.\n-            acceptedPrivacyTerms: true,\n-            sendQuincyEmail:\n-              payload === null\n-                ? state.user.sessionUser.sendQuincyEmail\n-                : payload\n-          }\n-        }\n-      };\n-    },\n     [actionTypes.allowSectionDonationRequests]: (state, { payload }) => {\n       return {\n         ...state,"
        },
        {
            "sha": "4b03493c6776eff2f4ba4d55e7b476a3075c6412",
            "filename": "client/src/redux/prop-types.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fprop-types.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -393,7 +393,7 @@ export type User = {\n   profileUI: ProfileUI;\n   progressTimestamps: Array<unknown>;\n   savedChallenges: SavedChallenges;\n-  sendQuincyEmail: boolean;\n+  sendQuincyEmail: boolean | null;\n   sound: boolean;\n   theme: UserThemes;\n   keyboardShortcuts: boolean;"
        },
        {
            "sha": "f2ae23c74a2bf896564219a7c401f57be1476f30",
            "filename": "client/src/utils/ajax.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 9,
            "changes": 12,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Futils%2Fajax.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/client%2Fsrc%2Futils%2Fajax.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Fajax.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -361,9 +361,9 @@ export function putUpdateMyHonesty(\n   return put('/update-my-honesty', update);\n }\n \n-export function putUpdateMyQuincyEmail(\n-  update: Record<string, string>\n-): Promise<ResponseWithData<void>> {\n+export function putUpdateMyQuincyEmail(update: {\n+  sendQuincyEmail: boolean;\n+}): Promise<ResponseWithData<void>> {\n   return put('/update-my-quincy-email', update);\n }\n \n@@ -373,12 +373,6 @@ export function putUpdateMyPortfolio(\n   return put('/update-my-portfolio', update);\n }\n \n-export function putUserAcceptsTerms(\n-  quincyEmails: boolean\n-): Promise<ResponseWithData<void>> {\n-  return put('/update-privacy-terms', { quincyEmails });\n-}\n-\n export function putUserUpdateEmail(\n   email: string\n ): Promise<ResponseWithData<void>> {"
        },
        {
            "sha": "15a7fe61376df2a285869bea03ab4438ff170684",
            "filename": "e2e/email-sign-up-alert.spec.ts",
            "status": "added",
            "additions": 153,
            "deletions": 0,
            "changes": 153,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/e2e%2Femail-sign-up-alert.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/e2e%2Femail-sign-up-alert.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Femail-sign-up-alert.spec.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -0,0 +1,153 @@\n+import { execSync } from 'child_process';\n+import { test, expect } from '@playwright/test';\n+\n+import translations from '../client/i18n/locales/english/translations.json';\n+import { alertToBeVisible } from './utils/alerts';\n+\n+test.describe('Email sign-up page when user is not signed in', () => {\n+  test.use({ storageState: { cookies: [], origins: [] } });\n+\n+  test.beforeEach(async ({ page }) => {\n+    await page.goto('/learn');\n+  });\n+\n+  test('should not display newsletter options', async ({ page }) => {\n+    await expect(\n+      page.getByText(translations.misc['email-blast'])\n+    ).not.toBeVisible();\n+    await expect(\n+      page.getByRole('button', { name: translations.buttons['yes-please'] })\n+    ).not.toBeVisible();\n+    await expect(\n+      page.getByRole('button', { name: translations.buttons['no-thanks'] })\n+    ).not.toBeVisible();\n+  });\n+});\n+\n+test.describe('Email sign-up page when user is signed in', () => {\n+  test.beforeEach(async ({ page }) => {\n+    // It's necessary to seed with a user that has not accepted the privacy\n+    // terms, otherwise the user will be redirected away from the email sign-up\n+    // page.\n+    execSync('node ./tools/scripts/seed/seed-demo-user --certified-user');\n+    await page.goto('/learn');\n+  });\n+\n+  test('should display the newsletter options correctly', async ({ page }) => {\n+    await expect(\n+      page.getByText(translations.misc['email-signup'])\n+    ).toBeVisible();\n+    await expect(\n+      page.getByText(translations.misc['email-blast'])\n+    ).toBeVisible();\n+    await expect(page.getByText(translations.misc['quincy'])).toBeVisible();\n+    await expect(\n+      page.getByRole('button', { name: translations.buttons['yes-please'] })\n+    ).toBeVisible();\n+    await expect(\n+      page.getByRole('button', { name: translations.buttons['no-thanks'] })\n+    ).toBeVisible();\n+  });\n+\n+  test('should disable weekly newsletter if the user clicks No', async ({\n+    page\n+  }) => {\n+    await expect(\n+      page.getByText(translations.misc['email-blast'])\n+    ).toBeVisible();\n+\n+    const noThanksButton = page.getByRole('button', {\n+      name: translations.buttons['no-thanks']\n+    });\n+    await expect(noThanksButton).toBeVisible();\n+    await noThanksButton.click();\n+    await alertToBeVisible(\n+      page,\n+      translations.flash['subscribe-to-quincy-updated']\n+    );\n+    await expect(\n+      page.getByText(translations.misc['email-blast'])\n+    ).not.toBeVisible();\n+    await page.goto('/settings');\n+    await expect(\n+      page.getByRole('button', { name: translations.buttons['no-thanks'] })\n+    ).toHaveAttribute('aria-pressed', 'true');\n+    await expect(\n+      page.getByRole('button', { name: translations.buttons['yes-please'] })\n+    ).toHaveAttribute('aria-pressed', 'false');\n+  });\n+\n+  test('should enable weekly newsletter if the user clicks Yes', async ({\n+    page\n+  }) => {\n+    await expect(\n+      page.getByText(translations.misc['email-blast'])\n+    ).toBeVisible();\n+\n+    const yesPleaseButton = page.getByRole('button', {\n+      name: translations.buttons['yes-please']\n+    });\n+\n+    await expect(yesPleaseButton).toBeVisible();\n+    await yesPleaseButton.click();\n+    await alertToBeVisible(\n+      page,\n+      translations.flash['subscribe-to-quincy-updated']\n+    );\n+    await page.goto('/settings');\n+    await expect(\n+      page.getByRole('group', { name: translations.settings.email.weekly })\n+    ).toBeVisible();\n+    await expect(\n+      page.getByRole('button', { name: translations.buttons['yes-please'] })\n+    ).toHaveAttribute('aria-pressed', 'true');\n+    await expect(\n+      page.getByRole('button', { name: translations.buttons['no-thanks'] })\n+    ).toHaveAttribute('aria-pressed', 'false');\n+  });\n+});\n+\n+test.describe('Email sign-up page when the user is new', () => {\n+  test.use({ storageState: 'playwright/.auth/development-user.json' });\n+\n+  test.beforeEach(async ({ page }) => {\n+    execSync('node ./tools/scripts/seed/seed-demo-user');\n+\n+    await page.goto('/learn');\n+  });\n+\n+  test('should not display newsletter options', async ({ page }) => {\n+    await expect(\n+      page.getByText(translations.misc['email-blast'])\n+    ).not.toBeVisible();\n+    await expect(\n+      page.getByRole('button', { name: translations.buttons['yes-please'] })\n+    ).not.toBeVisible();\n+    await expect(\n+      page.getByRole('button', { name: translations.buttons['no-thanks'] })\n+    ).not.toBeVisible();\n+  });\n+});\n+\n+test.describe('Email sign-up page when the user has made a selection', () => {\n+  test.use({ storageState: 'playwright/.auth/development-user.json' });\n+\n+  test.beforeEach(async ({ page }) => {\n+    execSync(\n+      'node ./tools/scripts/seed/seed-demo-user --certified-user --set-false sendQuincyEmail'\n+    );\n+    await page.goto('/learn');\n+  });\n+\n+  test('should not display newsletter options', async ({ page }) => {\n+    await expect(\n+      page.getByText(translations.misc['email-blast'])\n+    ).not.toBeVisible();\n+    await expect(\n+      page.getByRole('button', { name: translations.buttons['yes-please'] })\n+    ).not.toBeVisible();\n+    await expect(\n+      page.getByRole('button', { name: translations.buttons['no-thanks'] })\n+    ).not.toBeVisible();\n+  });\n+});"
        },
        {
            "sha": "add0b7514e5f47a86a1ee08705d16ebe9119471b",
            "filename": "e2e/quincy-email-sign-up.spec.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 47,
            "changes": 55,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/e2e%2Fquincy-email-sign-up.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/e2e%2Fquincy-email-sign-up.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fquincy-email-sign-up.spec.ts?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -11,6 +11,7 @@ test.describe('Email sign-up page when user is not signed in', () => {\n   test.use({ storageState: { cookies: [], origins: [] } });\n \n   test.beforeEach(async ({ page }) => {\n+    execSync('node ./tools/scripts/seed/seed-demo-user --certified-user');\n     await page.goto('/email-sign-up');\n   });\n \n@@ -69,21 +70,20 @@ test.describe('Email sign-up page when user is not signed in', () => {\n \n test.describe('Email sign-up page when user is signed in', () => {\n   test.beforeEach(async ({ page }) => {\n-    // It's necessary to seed with a user that has not accepted the privacy\n-    // terms, otherwise the user will be redirected away from the email sign-up\n-    // page.\n-    execSync(\n-      'node ./tools/scripts/seed/seed-demo-user --certified-user --set-false acceptedPrivacyTerms'\n-    );\n+    // It's necessary to seed with a user that has not selected an email newsletter option.\n+    execSync('node ./tools/scripts/seed/seed-demo-user --certified-user');\n \n     await page.goto('/email-sign-up');\n   });\n \n   test('should display the content correctly', async ({ page }) => {\n-    await expect(page).toHaveTitle('Email Sign Up | freeCodeCamp.org');\n+    await expect(\n+      page.getByText(translations.misc['email-signup'])\n+    ).toBeVisible();\n     await expect(\n       page.getByText(translations.misc['email-blast'])\n     ).toBeVisible();\n+    await expect(page.getByText(translations.misc['quincy'])).toBeVisible();\n     await expect(\n       page.getByRole('button', { name: translations.buttons['yes-please'] })\n     ).toBeVisible();\n@@ -148,9 +148,7 @@ test.describe('Email sign-up page when user is signed in', () => {\n       page.getByRole('heading', { name: 'Welcome back, Full Stack User' })\n     ).toBeVisible();\n \n-    // When the user clicks Yes, the /update-privacy-terms API is called\n-    // to update both `acceptedPrivacyTerms` and `sendQuincyEmail`.\n-    // But `sendQuincyEmail` is not set in the DB since the endpoint is mocked,\n+    // `sendQuincyEmail` is not set in the DB since the endpoint is mocked,\n     // so we are overriding the user data once again to mimic the real behavior.\n     await page.route('*/**/user/get-session-user', async route => {\n       const response = await route.fetch();\n@@ -172,40 +170,3 @@ test.describe('Email sign-up page when user is signed in', () => {\n     ).toHaveAttribute('aria-pressed', 'false');\n   });\n });\n-\n-test.describe('Email sign-up page when the user is new', () => {\n-  test.use({ storageState: 'playwright/.auth/development-user.json' });\n-\n-  test.beforeEach(async ({ page }) => {\n-    // It's necessary to seed with a user that has not accepted the privacy\n-    // terms, otherwise the user will be redirected away from the email sign-up\n-    // page.\n-    execSync(\n-      'node ./tools/scripts/seed/seed-demo-user --set-false acceptedPrivacyTerms'\n-    );\n-\n-    await page.goto('/email-sign-up');\n-  });\n-\n-  test.afterAll(() => {\n-    execSync('node ./tools/scripts/seed/seed-demo-user --certified-user');\n-  });\n-\n-  test('should display the content correctly', async ({ page }) => {\n-    await expect(\n-      page.getByRole('heading', {\n-        level: 1,\n-        name: translations.misc['brand-new-account']\n-      })\n-    ).toBeVisible();\n-    await expect(\n-      page.getByText(translations.misc['email-blast'])\n-    ).toBeVisible();\n-    await expect(\n-      page.getByRole('button', { name: translations.buttons['yes-please'] })\n-    ).toBeVisible();\n-    await expect(\n-      page.getByRole('button', { name: translations.buttons['no-thanks'] })\n-    ).toBeVisible();\n-  });\n-});"
        },
        {
            "sha": "7e9490b7fb827413477355c907d948b93fb323f0",
            "filename": "tools/scripts/seed/user-data.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/09dc696c29141eb00e3742d6ede302e47c5bc48f/tools%2Fscripts%2Fseed%2Fuser-data.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/09dc696c29141eb00e3742d6ede302e47c5bc48f/tools%2Fscripts%2Fseed%2Fuser-data.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscripts%2Fseed%2Fuser-data.js?ref=09dc696c29141eb00e3742d6ede302e47c5bc48f",
            "patch": "@@ -29,7 +29,7 @@ module.exports.blankUser = {\n   location: '',\n   picture: '',\n   acceptedPrivacyTerms: true,\n-  sendQuincyEmail: false,\n+  sendQuincyEmail: null,\n   currentChallengeId: '',\n   isHonest: false,\n   isFrontEndCert: false,\n@@ -91,7 +91,7 @@ module.exports.publicUser = {\n   location: '',\n   picture: '',\n   acceptedPrivacyTerms: true,\n-  sendQuincyEmail: false,\n+  sendQuincyEmail: null,\n   currentChallengeId: '',\n   isHonest: false,\n   isFrontEndCert: false,\n@@ -153,7 +153,7 @@ module.exports.demoUser = {\n   location: '',\n   picture: '',\n   acceptedPrivacyTerms: true,\n-  sendQuincyEmail: false,\n+  sendQuincyEmail: null,\n   currentChallengeId: '',\n   isHonest: false,\n   isFrontEndCert: false,\n@@ -217,7 +217,7 @@ module.exports.fullyCertifiedUser = {\n   location: '',\n   picture: '',\n   acceptedPrivacyTerms: true,\n-  sendQuincyEmail: false,\n+  sendQuincyEmail: null,\n   currentChallengeId: '',\n   isHonest: true,\n   isFrontEndCert: true,"
        }
    ],
    "stats": {
        "total": 732,
        "additions": 415,
        "deletions": 317
    }
}