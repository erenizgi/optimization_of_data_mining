{
    "author": "ojeytonwilliams",
    "message": "feat(api): env var to control exam environment (#56701)",
    "sha": "f2ec6d6dd58ad6ae3360293ca17a73d0845d1036",
    "files": [
        {
            "sha": "9e56ab6ae83a7ab86f0e174c20b34be1d285da7b",
            "filename": "api/src/app.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f2ec6d6dd58ad6ae3360293ca17a73d0845d1036/api%2Fsrc%2Fapp.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f2ec6d6dd58ad6ae3360293ca17a73d0845d1036/api%2Fsrc%2Fapp.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fapp.ts?ref=f2ec6d6dd58ad6ae3360293ca17a73d0845d1036",
            "patch": "@@ -38,7 +38,7 @@ import {\n   FCC_ENABLE_DEV_LOGIN_MODE,\n   FCC_ENABLE_SWAGGER_UI,\n   FCC_ENABLE_SHADOW_CAPTURE,\n-  FREECODECAMP_NODE_ENV\n+  FCC_ENABLE_EXAM_ENVIRONMENT\n } from './utils/env';\n import { isObjectID } from './utils/validation';\n import {\n@@ -187,8 +187,7 @@ export const build = async (\n     }\n   });\n \n-  // NOTE: Code behind the `FREECODECAMP_NODE_ENV` var is not ready to be deployed yet.\n-  if (FREECODECAMP_NODE_ENV !== 'production') {\n+  if (FCC_ENABLE_EXAM_ENVIRONMENT) {\n     void fastify.register(function (fastify, _opts, done) {\n       fastify.addHook('onRequest', fastify.authorizeExamEnvironmentToken);\n "
        },
        {
            "sha": "4e76c4140fdb2935424bf162b681637740906f17",
            "filename": "api/src/exam-environment/routes/exam-environment.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f2ec6d6dd58ad6ae3360293ca17a73d0845d1036/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f2ec6d6dd58ad6ae3360293ca17a73d0845d1036/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts?ref=f2ec6d6dd58ad6ae3360293ca17a73d0845d1036",
            "patch": "@@ -12,6 +12,14 @@ import {\n import * as mock from '../../../__mocks__/env-exam';\n import { constructUserExam } from '../utils/exam';\n \n+jest.mock('../../utils/env', () => {\n+  // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n+  return {\n+    ...jest.requireActual('../../utils/env'),\n+    FCC_ENABLE_EXAM_ENVIRONMENT: 'true'\n+  };\n+});\n+\n describe('/exam-environment/', () => {\n   setupServer();\n   describe('Authenticated user with exam environment authorization token', () => {"
        },
        {
            "sha": "ea5ea69e37977535305707e4f274ee39623eb0af",
            "filename": "api/src/utils/env.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f2ec6d6dd58ad6ae3360293ca17a73d0845d1036/api%2Fsrc%2Futils%2Fenv.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f2ec6d6dd58ad6ae3360293ca17a73d0845d1036/api%2Fsrc%2Futils%2Fenv.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Futils%2Fenv.ts?ref=f2ec6d6dd58ad6ae3360293ca17a73d0845d1036",
            "patch": "@@ -58,6 +58,11 @@ assert.ok(process.env.MONGOHQ_URL);\n assert.ok(process.env.COOKIE_SECRET);\n \n if (process.env.FREECODECAMP_NODE_ENV !== 'development') {\n+  assert.notEqual(\n+    process.env.FCC_ENABLE_EXAM_ENVIRONMENT,\n+    'true',\n+    'Exam environment is not ready for production.'\n+  );\n   assert.ok(process.env.SES_ID);\n   assert.ok(process.env.SES_SECRET);\n   assert.notEqual(\n@@ -127,6 +132,8 @@ export const FCC_ENABLE_DEV_LOGIN_MODE =\n   process.env.FCC_ENABLE_DEV_LOGIN_MODE === 'true';\n export const FCC_ENABLE_SHADOW_CAPTURE =\n   process.env.FCC_ENABLE_SHADOW_CAPTURE === 'true';\n+export const FCC_ENABLE_EXAM_ENVIRONMENT =\n+  process.env.FCC_ENABLE_EXAM_ENVIRONMENT === 'true';\n export const SENTRY_DSN =\n   process.env.SENTRY_DSN === 'dsn_from_sentry_dashboard'\n     ? ''"
        },
        {
            "sha": "02d454da719ad8e05a2f252460ead1a77704c1e6",
            "filename": "sample.env",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f2ec6d6dd58ad6ae3360293ca17a73d0845d1036/sample.env",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f2ec6d6dd58ad6ae3360293ca17a73d0845d1036/sample.env",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/sample.env?ref=f2ec6d6dd58ad6ae3360293ca17a73d0845d1036",
            "patch": "@@ -69,6 +69,7 @@ PORT=3000\n FCC_ENABLE_SWAGGER_UI=true\n FCC_ENABLE_DEV_LOGIN_MODE=true\n FCC_ENABLE_SHADOW_CAPTURE=false\n+FCC_ENABLE_EXAM_ENVIRONMENT=false\n \n # Email\n # use ses in production"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 18,
        "deletions": 3
    }
}