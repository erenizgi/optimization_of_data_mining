{
    "author": "ahmaxed",
    "message": "feat: AB test initial donation modal interval (#56078)",
    "sha": "b1b371c72a7adffa980ee16158bb979fe2a59306",
    "files": [
        {
            "sha": "f73e3d55181243f829dc47c238fb5c547c758d67",
            "filename": "client/config/growthbook-features-default.json",
            "status": "modified",
            "additions": 33,
            "deletions": 2,
            "changes": 35,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fconfig%2Fgrowthbook-features-default.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fconfig%2Fgrowthbook-features-default.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fconfig%2Fgrowthbook-features-default.json?ref=b1b371c72a7adffa980ee16158bb979fe2a59306",
            "patch": "@@ -30,6 +30,37 @@\n         \"name\": \"tests the conversion rate of the new design comparing to the old one\"\n       }\n     ]\n+  },\n+  \"show-modal-randomly\": {\n+    \"defaultValue\": false,\n+    \"rules\": [\n+      {\n+        \"coverage\": 1,\n+        \"hashAttribute\": \"id\",\n+        \"seed\": \"show-modal-randomly\",\n+        \"hashVersion\": 2,\n+        \"variations\": [\n+          false,\n+          true\n+        ],\n+        \"weights\": [\n+          0.5,\n+          0.5\n+        ],\n+        \"key\": \"show-modal-randomly\",\n+        \"meta\": [\n+          {\n+            \"key\": \"0\",\n+            \"name\": \"Control\"\n+          },\n+          {\n+            \"key\": \"1\",\n+            \"name\": \"Variation 1\"\n+          }\n+        ],\n+        \"phase\": \"0\",\n+        \"name\": \"stg show modal randomly\"\n+      }\n+    ]\n   }\n-}\n-\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "460eb898f870fb85d2ec48c9385d521c26f7f770",
            "filename": "client/src/components/growth-book/growth-book-redux-connector.tsx",
            "status": "modified",
            "additions": 15,
            "deletions": 21,
            "changes": 36,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fsrc%2Fcomponents%2Fgrowth-book%2Fgrowth-book-redux-connector.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fsrc%2Fcomponents%2Fgrowth-book%2Fgrowth-book-redux-connector.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fgrowth-book%2Fgrowth-book-redux-connector.tsx?ref=b1b371c72a7adffa980ee16158bb979fe2a59306",
            "patch": "@@ -5,49 +5,49 @@ import { connect } from 'react-redux';\n import { createSelector } from 'reselect';\n import {\n   isSignedInSelector,\n-  showMultipleProgressModalsSelector,\n+  isRandomCompletionThresholdSelector,\n   userIdSelector,\n   userFetchStateSelector\n } from '../../redux/selectors';\n-import { setShowMultipleProgressModals } from '../../redux/actions';\n+import { setIsRandomCompletionThreshold } from '../../redux/actions';\n import { UserFetchState } from '../../redux/prop-types';\n import callGA from '../../analytics/call-ga';\n \n const mapStateToProps = createSelector(\n   isSignedInSelector,\n-  showMultipleProgressModalsSelector,\n+  isRandomCompletionThresholdSelector,\n   userIdSelector,\n   userFetchStateSelector,\n   (\n     isSignedIn: boolean,\n-    showMultipleProgressModals: boolean,\n+    isRandomCompletionThreshold: boolean,\n     userId: string,\n     userFetchState: UserFetchState\n   ) => ({\n     isSignedIn,\n-    showMultipleProgressModals,\n+    isRandomCompletionThreshold,\n     userId,\n     userFetchState\n   })\n );\n \n type StateProps = ReturnType<typeof mapStateToProps>;\n-type DispatchProps = { setShowMultipleProgressModals: (arg: boolean) => void };\n+type DispatchProps = { setIsRandomCompletionThreshold: (arg: boolean) => void };\n \n interface GrowthBookReduxConnector extends StateProps, DispatchProps {\n   children: ReactNode;\n }\n \n const mapDispatchToProps = {\n-  setShowMultipleProgressModals\n+  setIsRandomCompletionThreshold\n };\n \n const GrowthBookReduxConnector = ({\n   children,\n   isSignedIn,\n-  showMultipleProgressModals,\n+  isRandomCompletionThreshold,\n   userId,\n-  setShowMultipleProgressModals,\n+  setIsRandomCompletionThreshold,\n   userFetchState\n }: GrowthBookReduxConnector) => {\n   // Send user id to GA\n@@ -60,23 +60,17 @@ const GrowthBookReduxConnector = ({\n     }\n   }, [userFetchState, userId, isSignedIn]);\n \n-  const displayProgressModalMultipleTimes = useFeature(\n-    'display_progress_modal_multiple_times'\n-  ).on;\n+  const showModalsRandomly = useFeature('show-modal-randomly').on;\n   useFeature('aa-test');\n   useEffect(() => {\n-    if (\n-      isSignedIn &&\n-      displayProgressModalMultipleTimes &&\n-      !showMultipleProgressModals\n-    ) {\n-      setShowMultipleProgressModals(true);\n+    if (isSignedIn && showModalsRandomly && !isRandomCompletionThreshold) {\n+      setIsRandomCompletionThreshold(true);\n     }\n   }, [\n     isSignedIn,\n-    showMultipleProgressModals,\n-    displayProgressModalMultipleTimes,\n-    setShowMultipleProgressModals\n+    isRandomCompletionThreshold,\n+    showModalsRandomly,\n+    setIsRandomCompletionThreshold\n   ]);\n   return <>{children}</>;\n };"
        },
        {
            "sha": "f5022221e3cd0dc2b97deee7a4edd757b4753b01",
            "filename": "client/src/redux/action-types.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fsrc%2Fredux%2Faction-types.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fsrc%2Fredux%2Faction-types.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Faction-types.js?ref=b1b371c72a7adffa980ee16158bb979fe2a59306",
            "patch": "@@ -9,7 +9,7 @@ export const actionTypes = createTypes(\n     'allowBlockDonationRequests',\n     'setRenderStartTime',\n     'preventBlockDonationRequests',\n-    'setShowMultipleProgressModals',\n+    'setIsRandomCompletionThreshold',\n     'openDonationModal',\n     'closeDonationModal',\n     'openSignoutModal',"
        },
        {
            "sha": "bc369ee592284a622b5a1edbaa3082550a76dc58",
            "filename": "client/src/redux/actions.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fsrc%2Fredux%2Factions.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fsrc%2Fredux%2Factions.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Factions.js?ref=b1b371c72a7adffa980ee16158bb979fe2a59306",
            "patch": "@@ -17,9 +17,8 @@ export const openDonationModal = createAction(actionTypes.openDonationModal);\n export const preventBlockDonationRequests = createAction(\n   actionTypes.preventBlockDonationRequests\n );\n-\n-export const setShowMultipleProgressModals = createAction(\n-  actionTypes.setShowMultipleProgressModals\n+export const setIsRandomCompletionThreshold = createAction(\n+  actionTypes.setIsRandomCompletionThreshold\n );\n export const updateDonationFormState = createAction(\n   actionTypes.updateDonationFormState"
        },
        {
            "sha": "931c8b6044ec2d0e01b15fc0b371c1e8335eab95",
            "filename": "client/src/redux/index.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fsrc%2Fredux%2Findex.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fsrc%2Fredux%2Findex.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Findex.js?ref=b1b371c72a7adffa980ee16158bb979fe2a59306",
            "patch": "@@ -50,7 +50,7 @@ export const defaultDonationFormState = {\n \n const initialState = {\n   appUsername: '',\n-  showMultipleProgressModals: false,\n+  isRandomCompletionThreshold: false,\n   recentlyClaimedBlock: null,\n   currentChallengeId: store.get(CURRENT_CHALLENGE_KEY),\n   examInProgress: false,\n@@ -273,9 +273,9 @@ export const reducer = handleActions(\n       ...state,\n       recentlyClaimedBlock: null\n     }),\n-    [actionTypes.setShowMultipleProgressModals]: (state, { payload }) => ({\n+    [actionTypes.setIsRandomCompletionThreshold]: (state, { payload }) => ({\n       ...state,\n-      showMultipleProgressModals: payload\n+      isRandomCompletionThreshold: payload\n     }),\n     [actionTypes.resetUserData]: state => ({\n       ...state,"
        },
        {
            "sha": "8dde7b31085f3a37c3b7ea5183f58a97e8b973b8",
            "filename": "client/src/redux/selectors.js",
            "status": "modified",
            "additions": 15,
            "deletions": 5,
            "changes": 20,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fsrc%2Fredux%2Fselectors.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fsrc%2Fredux%2Fselectors.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fselectors.js?ref=b1b371c72a7adffa980ee16158bb979fe2a59306",
            "patch": "@@ -1,4 +1,5 @@\n import { Certification } from '../../../shared/config/certification-settings';\n+import { randomBetween } from '../utils/random-between';\n import { getSessionChallengeData } from '../utils/session-storage';\n import { ns as MainApp } from './action-types';\n \n@@ -12,8 +13,8 @@ export const partiallyCompletedChallengesSelector = state =>\n export const currentChallengeIdSelector = state =>\n   state[MainApp].currentChallengeId;\n export const completionCountSelector = state => state[MainApp].completionCount;\n-export const showMultipleProgressModalsSelector = state =>\n-  state[MainApp].showMultipleProgressModals;\n+export const isRandomCompletionThresholdSelector = state =>\n+  state[MainApp].isRandomCompletionThreshold;\n export const isDonatingSelector = state => userSelector(state).isDonating;\n export const isOnlineSelector = state => state[MainApp].isOnline;\n export const isServerOnlineSelector = state => state[MainApp].isServerOnline;\n@@ -36,6 +37,8 @@ export const shouldRequestDonationSelector = state => {\n   const completedChallengeCount = completedChallengesSelector(state).length;\n   const isDonating = isDonatingSelector(state);\n   const recentlyClaimedBlock = recentlyClaimedBlockSelector(state);\n+  const isRandomCompletionThreshold =\n+    isRandomCompletionThresholdSelector(state);\n \n   // don't request donation if already donating\n   if (isDonating) return false;\n@@ -58,9 +61,16 @@ export const shouldRequestDonationSelector = state => {\n   // not before the 11th challenge has mounted)\n   if (completedChallengeCount < 10) return false;\n \n-  // this will mean we have completed 3 or more challenges this browser session\n-  // and enough challenges overall to not be new\n-  return sessionChallengeData.currentCount >= 3;\n+  /*\n+   Show modal if user has completed 10 challanged in total\n+   and 3 or more in this session.\n+   The isRandomCompletionThreshold flag is used to AB test interval randomness\n+  */\n+  if (isRandomCompletionThreshold) {\n+    return sessionChallengeData.currentCount >= randomBetween(3, 7);\n+  } else {\n+    return sessionChallengeData.currentCount >= 3;\n+  }\n };\n \n export const userTokenSelector = state => {"
        },
        {
            "sha": "42449314f3000d4148a6c295bb177f9569737607",
            "filename": "client/src/utils/random-between.ts",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fsrc%2Futils%2Frandom-between.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b1b371c72a7adffa980ee16158bb979fe2a59306/client%2Fsrc%2Futils%2Frandom-between.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Frandom-between.ts?ref=b1b371c72a7adffa980ee16158bb979fe2a59306",
            "patch": "@@ -0,0 +1,3 @@\n+// returns a random number between x and y\n+export const randomBetween = (x: number, y: number): number =>\n+  Math.floor(Math.random() * (y - x + 1)) + x;"
        },
        {
            "sha": "44b2a3fca443a0f3c17484d14dbf7da8e9ec6f1f",
            "filename": "e2e/donation-modal.spec.ts",
            "status": "modified",
            "additions": 66,
            "deletions": 103,
            "changes": 169,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b1b371c72a7adffa980ee16158bb979fe2a59306/e2e%2Fdonation-modal.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b1b371c72a7adffa980ee16158bb979fe2a59306/e2e%2Fdonation-modal.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fdonation-modal.spec.ts?ref=b1b371c72a7adffa980ee16158bb979fe2a59306",
            "patch": "@@ -1,5 +1,6 @@\n import { execSync } from 'child_process';\n import { test, expect, type Page } from '@playwright/test';\n+import { addGrowthbookCookie } from './utils/add-growthbook-cookie';\n \n import { clearEditor, focusEditor } from './utils/editor';\n \n@@ -34,122 +35,74 @@ const completeFrontEndCert = async (page: Page) => {\n   }\n };\n \n-const completeThreeChallenges = async ({\n-  page,\n-  browserName,\n-  isMobile\n-}: {\n-  page: Page;\n-  browserName: string;\n-  isMobile: boolean;\n-}) => {\n-  await page.goto(\n-    '/learn/javascript-algorithms-and-data-structures/basic-javascript/comment-your-javascript-code'\n-  );\n-\n-  const challenges = [\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/comment-your-javascript-code',\n-      solution: `// some comment\\n/* some comment */`\n-    },\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/declare-javascript-variables',\n-      solution: 'var myName;'\n-    },\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/storing-values-with-the-assignment-operator',\n-      solution: `// Setup\\nvar a;\\n\\n// Only change code below this line\\na = 7;`\n-    }\n-  ];\n-\n-  for (const challenge of challenges) {\n-    await page.waitForURL(challenge.url);\n-\n-    await focusEditor({ page, isMobile });\n-    await clearEditor({ page, browserName });\n-\n-    await page.evaluate(\n-      async contents => await navigator.clipboard.writeText(contents),\n-      challenge.solution\n-    );\n-    await page.keyboard.press('ControlOrMeta+V');\n-\n-    await page.getByRole('button', { name: 'Run' }).click();\n-    await expect(page.getByRole('dialog')).toBeVisible(); // completion dialog\n-    await page.getByRole('button', { name: 'Submit' }).click();\n+const challenges = [\n+  {\n+    url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/comment-your-javascript-code',\n+    solution: `// some comment\\n/* some comment */`\n+  },\n+  {\n+    url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/declare-javascript-variables',\n+    solution: 'var myName;'\n+  },\n+  {\n+    url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/storing-values-with-the-assignment-operator',\n+    solution: `// Setup\\nvar a;\\n\\n// Only change code below this line\\na = 7;`\n+  },\n+  {\n+    url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/assigning-the-value-of-one-variable-to-another',\n+    solution: `// Setup\\nvar a;\\na = 7;\\nvar b;\\n\\n// Only change code below this line\\nb = a;`\n+  },\n+  {\n+    url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/initializing-variables-with-the-assignment-operator',\n+    solution: 'var a = 9;'\n+  },\n+  {\n+    url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/declare-string-variables',\n+    solution: `var myFirstName = 'foo';\\nvar myLastName = 'bar';`\n+  },\n+  {\n+    url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/understanding-uninitialized-variables',\n+    solution: `// Only change code below this line\\nvar a = 5;\\nvar b = 10;\\nvar c = 'I am a';\\n// Only change code above this line\\n\\na = a + 1;\\nb = b + 5;\\nc = c + \" String!\";`\n+  },\n+  {\n+    url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/understanding-case-sensitivity-in-variables',\n+    solution: `// Variable declarations\\nvar studlyCapVar;\\nvar properCamelCase;\\nvar titleCaseOver;\\n\\n// Variable assignments\\nstudlyCapVar = 10;\\nproperCamelCase = \"A String\";\\ntitleCaseOver = 9000;`\n+  },\n+  {\n+    url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/explore-differences-between-the-var-and-let-keywords',\n+    solution: `let catName = \"Oliver\";\\nlet catSound = \"Meow!\";`\n+  },\n+  {\n+    url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/declare-a-read-only-variable-with-the-const-keyword',\n+    solution: `const FCC = \"freeCodeCamp\";\\n// Change this line\\nlet fact = \"is cool!\";\\n// Change this line\\nfact = \"is awesome!\";\\nconsole.log(FCC, fact);\\n// Change this line`\n   }\n-};\n+];\n \n-const completeTenChallenges = async ({\n+const completeChallenges = async ({\n   page,\n   browserName,\n-  isMobile\n+  isMobile,\n+  number\n }: {\n   page: Page;\n   browserName: string;\n   isMobile: boolean;\n+  number: number;\n }) => {\n-  await page.goto(\n-    '/learn/javascript-algorithms-and-data-structures/basic-javascript/comment-your-javascript-code'\n-  );\n-\n-  const challenges = [\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/comment-your-javascript-code',\n-      solution: `// some comment\\n/* some comment */`\n-    },\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/declare-javascript-variables',\n-      solution: 'var myName;'\n-    },\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/storing-values-with-the-assignment-operator',\n-      solution: `// Setup\\nvar a;\\n\\n// Only change code below this line\\na = 7;`\n-    },\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/assigning-the-value-of-one-variable-to-another',\n-      solution: `// Setup\\nvar a;\\na = 7;\\nvar b;\\n\\n// Only change code below this line\\nb = a;`\n-    },\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/initializing-variables-with-the-assignment-operator',\n-      solution: 'var a = 9;'\n-    },\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/declare-string-variables',\n-      solution: `var myFirstName = 'foo';\\nvar myLastName = 'bar';`\n-    },\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/understanding-uninitialized-variables',\n-      solution: `// Only change code below this line\\nvar a = 5;\\nvar b = 10;\\nvar c = 'I am a';\\n// Only change code above this line\\n\\na = a + 1;\\nb = b + 5;\\nc = c + \" String!\";`\n-    },\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/understanding-case-sensitivity-in-variables',\n-      solution: `// Variable declarations\\nvar studlyCapVar;\\nvar properCamelCase;\\nvar titleCaseOver;\\n\\n// Variable assignments\\nstudlyCapVar = 10;\\nproperCamelCase = \"A String\";\\ntitleCaseOver = 9000;`\n-    },\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/explore-differences-between-the-var-and-let-keywords',\n-      solution: `let catName = \"Oliver\";\\nlet catSound = \"Meow!\";`\n-    },\n-    {\n-      url: '/learn/javascript-algorithms-and-data-structures/basic-javascript/declare-a-read-only-variable-with-the-const-keyword',\n-      solution: `const FCC = \"freeCodeCamp\";\\n// Change this line\\nlet fact = \"is cool!\";\\n// Change this line\\nfact = \"is awesome!\";\\nconsole.log(FCC, fact);\\n// Change this line`\n-    }\n-  ];\n-\n-  for (const challenge of challenges) {\n+  await page.goto(challenges[0].url);\n+  for (const challenge of challenges.slice(0, number)) {\n     await page.waitForURL(challenge.url);\n-\n     await focusEditor({ page, isMobile });\n     await clearEditor({ page, browserName });\n-\n     await page.evaluate(\n       async contents => await navigator.clipboard.writeText(contents),\n       challenge.solution\n     );\n     await page.keyboard.press('ControlOrMeta+V');\n-\n     await page.getByRole('button', { name: 'Run' }).click();\n-    await expect(page.getByRole('dialog')).toBeVisible(); // completion dialog\n+    await expect(\n+      page.getByRole('dialog').filter({ hasText: 'Basic Javascript' })\n+    ).toBeVisible(); // completion dialog\n     await page.getByRole('button', { name: 'Submit' }).click();\n   }\n };\n@@ -160,6 +113,10 @@ test.skip(\n );\n \n test.describe('Donation modal display', () => {\n+  test.beforeEach(async ({ context }) => {\n+    await addGrowthbookCookie({ context, variation: 'A' });\n+  });\n+\n   test.use({ storageState: 'playwright/.auth/certified-user.json' });\n \n   test('should display the content correctly and disable close when the animation is not complete', async ({\n@@ -171,7 +128,7 @@ test.describe('Donation modal display', () => {\n     await context.grantPermissions(['clipboard-read', 'clipboard-write']);\n     test.setTimeout(40000);\n \n-    await completeThreeChallenges({ page, browserName, isMobile });\n+    await completeChallenges({ page, browserName, isMobile, number: 3 });\n \n     const donationModal = page\n       .getByRole('dialog')\n@@ -241,6 +198,9 @@ test.describe('Donation modal display', () => {\n \n test.describe('Donation modal appearance logic - New user', () => {\n   test.use({ storageState: 'playwright/.auth/development-user.json' });\n+  test.beforeEach(async ({ context }) => {\n+    await addGrowthbookCookie({ context, variation: 'B' });\n+  });\n \n   test.beforeEach(() => {\n     execSync('node ./tools/scripts/seed/seed-demo-user');\n@@ -259,7 +219,7 @@ test.describe('Donation modal appearance logic - New user', () => {\n     await context.grantPermissions(['clipboard-read', 'clipboard-write']);\n \n     // Development user doesn't have any completed challenges, we are completing the first 3.\n-    await completeThreeChallenges({ page, browserName, isMobile });\n+    await completeChallenges({ page, browserName, isMobile, number: 3 });\n \n     const donationModal = page\n       .getByRole('dialog')\n@@ -276,7 +236,7 @@ test.describe('Donation modal appearance logic - New user', () => {\n     await context.grantPermissions(['clipboard-read', 'clipboard-write']);\n     test.setTimeout(50000);\n \n-    await completeTenChallenges({ page, isMobile, browserName });\n+    await completeChallenges({ page, isMobile, browserName, number: 10 });\n \n     const donationModal = page\n       .getByRole('dialog')\n@@ -333,6 +293,9 @@ test.describe('Donation modal appearance logic - New user', () => {\n \n test.describe('Donation modal appearance logic - Certified user', () => {\n   test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+  test.beforeEach(async ({ context }) => {\n+    await addGrowthbookCookie({ context, variation: 'A' });\n+  });\n \n   test('should appear if the user has completed 3 challenges and has more than 10 completed challenges in total', async ({\n     page,\n@@ -344,7 +307,7 @@ test.describe('Donation modal appearance logic - Certified user', () => {\n     test.setTimeout(40000);\n \n     // Certified user already has more than 10 completed challenges, we are just completing 3 more.\n-    await completeThreeChallenges({ page, browserName, isMobile });\n+    await completeChallenges({ page, isMobile, browserName, number: 3 });\n \n     const donationModal = page\n       .getByRole('dialog')\n@@ -390,7 +353,7 @@ test.describe('Donation modal appearance logic - Donor user', () => {\n   }) => {\n     await context.grantPermissions(['clipboard-read', 'clipboard-write']);\n \n-    await completeThreeChallenges({ page, browserName, isMobile });\n+    await completeChallenges({ page, browserName, isMobile, number: 3 });\n \n     const donationModal = page\n       .getByRole('dialog')"
        },
        {
            "sha": "8eceb6b7cd84c737283927f661d0e93146f02e1b",
            "filename": "e2e/landing.spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 15,
            "changes": 19,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b1b371c72a7adffa980ee16158bb979fe2a59306/e2e%2Flanding.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b1b371c72a7adffa980ee16158bb979fe2a59306/e2e%2Flanding.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Flanding.spec.ts?ref=b1b371c72a7adffa980ee16158bb979fe2a59306",
            "patch": "@@ -1,7 +1,8 @@\n-import { BrowserContext, expect, Page, test } from '@playwright/test';\n+import { expect, Page, test } from '@playwright/test';\n import intro from '../client/i18n/locales/english/intro.json';\n import translations from '../client/i18n/locales/english/translations.json';\n import { SuperBlocks } from '../shared/config/curriculum';\n+import { addGrowthbookCookie } from './utils/add-growthbook-cookie';\n \n const landingPageElements = {\n   heading: 'landing-header',\n@@ -37,25 +38,13 @@ const superBlocks = [\n   intro[SuperBlocks.PythonForEverybody].title\n ];\n \n-async function addDefaultCookies(context: BrowserContext, variation: string) {\n-  await context.addCookies([\n-    {\n-      name: 'gbuuid',\n-      value: variation,\n-      domain: 'localhost',\n-      path: '/',\n-      expires: Math.floor(Date.now() / 1000) + 400 * 24 * 60 * 60 // 400 days from now\n-    }\n-  ]);\n-}\n-\n async function goToLandingPage(page: Page) {\n   await page.goto('/');\n }\n \n test.describe('Landing Page - Variation B', () => {\n   test.beforeEach(async ({ context, page }) => {\n-    await addDefaultCookies(context, 'B');\n+    await addGrowthbookCookie({ context, variation: 'B' });\n     await goToLandingPage(page);\n   });\n \n@@ -132,7 +121,7 @@ test.describe('Landing Page - Variation B', () => {\n \n test.describe('Landing Page - Variation A', () => {\n   test.beforeEach(async ({ context, page }) => {\n-    await addDefaultCookies(context, 'A');\n+    await addGrowthbookCookie({ context, variation: 'A' });\n     await goToLandingPage(page);\n   });\n "
        },
        {
            "sha": "437c6b47d43efef3007d17a862a15ebb0171fbef",
            "filename": "e2e/utils/add-growthbook-cookie.ts",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b1b371c72a7adffa980ee16158bb979fe2a59306/e2e%2Futils%2Fadd-growthbook-cookie.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b1b371c72a7adffa980ee16158bb979fe2a59306/e2e%2Futils%2Fadd-growthbook-cookie.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Futils%2Fadd-growthbook-cookie.ts?ref=b1b371c72a7adffa980ee16158bb979fe2a59306",
            "patch": "@@ -0,0 +1,19 @@\n+import { BrowserContext } from '@playwright/test';\n+\n+export async function addGrowthbookCookie({\n+  context,\n+  variation\n+}: {\n+  context: BrowserContext;\n+  variation: string;\n+}) {\n+  await context.addCookies([\n+    {\n+      name: 'gbuuid',\n+      value: variation,\n+      domain: 'localhost',\n+      path: '/',\n+      expires: Math.floor(Date.now() / 1000) + 400 * 24 * 60 * 60 // 400 days from now\n+    }\n+  ]);\n+}"
        }
    ],
    "stats": {
        "total": 314,
        "additions": 161,
        "deletions": 153
    }
}