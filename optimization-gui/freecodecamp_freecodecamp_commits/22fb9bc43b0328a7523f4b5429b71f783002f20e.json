{
    "author": "raisedadead",
    "message": "feat(gha): add workflow to clean-up old images (#60485)",
    "sha": "22fb9bc43b0328a7523f4b5429b71f783002f20e",
    "files": [
        {
            "sha": "2477edebabf2e8298ab581b3af101a8449e70379",
            "filename": ".github/workflows/docker-docr-cleanup.yml",
            "status": "added",
            "additions": 53,
            "deletions": 0,
            "changes": 53,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/22fb9bc43b0328a7523f4b5429b71f783002f20e/.github%2Fworkflows%2Fdocker-docr-cleanup.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/22fb9bc43b0328a7523f4b5429b71f783002f20e/.github%2Fworkflows%2Fdocker-docr-cleanup.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fdocker-docr-cleanup.yml?ref=22fb9bc43b0328a7523f4b5429b71f783002f20e",
            "patch": "@@ -0,0 +1,53 @@\n+name: DOCR - Cleanup Container Images\n+on:\n+  workflow_dispatch:\n+  schedule:\n+    - cron: '5 0 * * 3,6' # 12:05 UTC on Wednesdays and Saturdays (6 hour maintenance window)\n+\n+jobs:\n+  remove:\n+    name: Delete Old Images\n+    runs-on: ubuntu-latest\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        repos:\n+          - learn-api\n+        variants:\n+          - dev\n+          - org\n+\n+    steps:\n+      - name: Install doctl\n+        uses: digitalocean/action-doctl@v2\n+        with:\n+          token: ${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}\n+\n+      - name: Log in to DigitalOcean Container Registry with short-lived credentials\n+        run: doctl registry login --expiry-seconds 1200\n+\n+      - name: Delete Images\n+        uses: raisedadead/action-docr-cleanup@62b968c928fbb2dbce8b0caf11c0391f0921ea46 # v1\n+        with:\n+          repository_name: '${{ matrix.variants }}/${{ matrix.repos }}'\n+          days: '7'\n+          keep_last: '3'\n+\n+  # NOTE: We don't need to trigger garbage collection because we have a cron job that runs on news repo, which\n+  #       triggers garbage collection. This can be uncommented should a need arise.\n+\n+  # clean:\n+  #   name: Do Garbage Collection\n+  #   runs-on: ubuntu-latest\n+  #   needs: remove\n+  #   steps:\n+  #     - name: Install doctl\n+  #       uses: digitalocean/action-doctl@v2\n+  #       with:\n+  #         token: ${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}\n+\n+  #     - name: Log in to DigitalOcean Container Registry with short-lived credentials\n+  #       run: doctl registry login --expiry-seconds 1200\n+\n+  #     - name: Trigger Garbage collection\n+  #       run: doctl registry garbage-collection start --include-untagged-manifests --force"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 53,
        "deletions": 0
    }
}