{
    "author": "Sembauke",
    "message": "refactor(client): portfolio to functional component (#58610)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "debea874d1119c192e6bfb82230177bd243d76e9",
    "files": [
        {
            "sha": "5686a690b19376e04d9060e455e204acb6ab5df8",
            "filename": "client/src/components/profile/components/portfolio.tsx",
            "status": "modified",
            "additions": 110,
            "deletions": 179,
            "changes": 289,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/debea874d1119c192e6bfb82230177bd243d76e9/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fportfolio.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/debea874d1119c192e6bfb82230177bd243d76e9/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fportfolio.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fprofile%2Fcomponents%2Fportfolio.tsx?ref=debea874d1119c192e6bfb82230177bd243d76e9",
            "patch": "@@ -1,6 +1,6 @@\n import { findIndex, find, isEqual } from 'lodash-es';\n import { nanoid } from 'nanoid';\n-import React, { Component } from 'react';\n+import React, { useState } from 'react';\n import type { TFunction } from 'i18next';\n import {\n   FormGroup,\n@@ -30,12 +30,6 @@ type PortfolioProps = {\n   setIsEditing: (isEditing: boolean) => void;\n };\n \n-type PortfolioState = {\n-  portfolio: PortfolioProjectData[];\n-  unsavedItemId: string | null;\n-  isImageValid: ProfileValidation;\n-};\n-\n interface ProfileValidation {\n   state: FormGroupProps['validationState'];\n   message: string;\n@@ -55,95 +49,89 @@ function createFindById(id: string) {\n   return (p: PortfolioProjectData) => p.id === id;\n }\n \n-class PortfolioSettings extends Component<PortfolioProps, PortfolioState> {\n-  validationImage: HTMLImageElement;\n-  static displayName: string;\n-  constructor(props: PortfolioProps) {\n-    super(props);\n-    this.validationImage = new Image();\n-    const { portfolio = [] } = props;\n+const PortfolioSettings = (props: PortfolioProps) => {\n+  const {\n+    t,\n+    portfolio: initialPortfolio = [],\n+    setIsEditing,\n+    updatePortfolio\n+  } = props;\n+  const [portfolio, setPortfolio] = useState(initialPortfolio);\n+  const [unsavedItemId, setUnsavedItemId] = useState<string | null>(null);\n+  const [imageValidation, setImageValid] = useState<ProfileValidation>({\n+    state: 'success',\n+    message: ''\n+  });\n+\n+  const checkIfValidImage = (url: string): Promise<ProfileValidation> => {\n+    const img = new Image();\n \n-    this.state = {\n-      portfolio: [...portfolio],\n-      unsavedItemId: null,\n-      isImageValid: {\n-        state: 'success',\n-        message: ''\n-      }\n-    };\n-  }\n-\n-  toggleEditing = () => {\n-    this.props.setIsEditing(false);\n+    return new Promise(resolve => {\n+      img.onerror = () =>\n+        resolve({ state: 'error', message: t('validation.url-not-image') });\n+      img.onload = () => resolve({ state: 'success', message: '' });\n+      img.src = url;\n+    });\n   };\n \n-  createOnChangeHandler =\n+  const createOnChangeHandler =\n     (id: string, key: 'description' | 'image' | 'title' | 'url') =>\n     (e: React.ChangeEvent<HTMLInputElement>) => {\n       e.preventDefault();\n       const userInput = e.target.value.slice();\n-      this.setState(state => {\n-        const { portfolio: currentPortfolio } = state;\n-        const mutablePortfolio = currentPortfolio.slice(0);\n-        const index = findIndex(currentPortfolio, p => p.id === id);\n-\n+      setPortfolio(prevPortfolio => {\n+        const mutablePortfolio = [...prevPortfolio];\n+        const index = findIndex(prevPortfolio, p => p.id === id);\n         mutablePortfolio[index] = {\n           ...mutablePortfolio[index],\n           [key]: userInput\n         };\n-\n         if (key === 'image' && userInput) {\n-          void this.validateImageLoad(userInput).then(imageValidation => {\n-            this.setState({ isImageValid: imageValidation });\n+          void checkIfValidImage(userInput).then(imageValidation => {\n+            setImageValid(imageValidation);\n           });\n         } else if (key === 'image' && !userInput) {\n-          this.setState({ isImageValid: { state: 'success', message: '' } });\n+          setImageValid({ state: 'success', message: '' });\n         }\n-\n-        return { portfolio: mutablePortfolio };\n+        return mutablePortfolio;\n       });\n     };\n \n-  updateItem = (id: string) => {\n-    const { portfolio, unsavedItemId } = this.state;\n+  const updateItem = (\n+    id: string,\n+    updatedPortfolio?: PortfolioProjectData[]\n+  ) => {\n     if (unsavedItemId === id) {\n-      this.setState({ unsavedItemId: null });\n+      setUnsavedItemId(null);\n     }\n-    this.props.updatePortfolio({ portfolio });\n-    this.toggleEditing();\n+    const portfolioToUpdate = updatedPortfolio || portfolio;\n+    updatePortfolio({ portfolio: portfolioToUpdate });\n+    setIsEditing(false);\n   };\n \n-  handleAdd = () => {\n+  const handleAdd = () => {\n     const item = createEmptyPortfolioItem();\n-    this.setState(state => ({\n-      portfolio: [item, ...state.portfolio],\n-      unsavedItemId: item.id\n-    }));\n+    setPortfolio(prev => [item, ...prev]);\n+    setUnsavedItemId(item.id);\n   };\n \n-  handleRemoveItem = (id: string) => {\n-    this.setState(\n-      state => ({\n-        portfolio: state.portfolio.filter(p => p.id !== id)\n-      }),\n-      () => this.updateItem(id)\n-    );\n-    this.toggleEditing();\n+  const handleRemoveItem = (id: string) => {\n+    const newPortfolio = portfolio.filter(p => p.id !== id);\n+    setPortfolio(newPortfolio);\n+    updateItem(id, newPortfolio);\n+    setIsEditing(false);\n   };\n \n-  isFormPristine = (id: string) => {\n-    const { portfolio } = this.state;\n-    const { portfolio: originalPortfolio } = this.props;\n-    const original = find(originalPortfolio, createFindById(id));\n+  const isFormPristine = (id: string) => {\n+    const original = find(props.portfolio, createFindById(id));\n     if (!original) {\n       return false;\n     }\n     const edited = find(portfolio, createFindById(id));\n     return isEqual(original, edited);\n   };\n \n-  getDescriptionValidation(description: string): ProfileValidation {\n-    const { t } = this.props;\n+  const getDescriptionValidation = (description: string): ProfileValidation => {\n     const len = description.length;\n     const charsLeft = 288 - len;\n     if (charsLeft < 0) {\n@@ -155,22 +143,18 @@ class PortfolioSettings extends Component<PortfolioProps, PortfolioState> {\n     if (charsLeft < 41 && charsLeft > 0) {\n       return {\n         state: 'warning',\n-        message: t('validation.max-characters', { charsLeft: charsLeft })\n+        message: t('validation.max-characters', { charsLeft })\n       };\n     }\n     if (charsLeft === 288) {\n       return { state: null, message: '' };\n     }\n     return { state: 'success', message: '' };\n-  }\n+  };\n \n-  getTitleValidation(title: string): ProfileValidation {\n-    const { t } = this.props;\n+  const getTitleValidation = (title: string): ProfileValidation => {\n     if (!title) {\n-      return {\n-        state: 'error',\n-        message: t('validation.title-required')\n-      };\n+      return { state: 'error', message: t('validation.title-required') };\n     }\n     const len = title.length;\n     if (len < 2) {\n@@ -180,128 +164,80 @@ class PortfolioSettings extends Component<PortfolioProps, PortfolioState> {\n       return { state: 'error', message: t('validation.title-long') };\n     }\n     return { state: 'success', message: '' };\n-  }\n-\n-  async validateImageLoad(image: string): Promise<ProfileValidation> {\n-    return new Promise(resolve => {\n-      this.validationImage.src = encodeURI(image);\n-\n-      this.validationImage.onload = () => {\n-        resolve({\n-          state: 'success',\n-          message: ''\n-        });\n-      };\n-\n-      this.validationImage.onerror = () => {\n-        resolve({\n-          state: 'error',\n-          message: this.props.t('validation.url-not-image')\n-        });\n-      };\n-    });\n-  }\n+  };\n \n-  getUrlValidation(url: string): {\n-    state: 'success' | 'warning' | 'error';\n-    message: string;\n-  } {\n-    const { t } = this.props;\n+  const getUrlValidation = (\n+    url: string\n+  ): { state: 'success' | 'warning' | 'error'; message: string } => {\n     const len = url.length;\n-\n     if (!url) {\n       return { state: 'success', message: '' };\n     }\n-\n     if (len >= 4 && !hasProtocolRE.test(url)) {\n-      return {\n-        state: 'error',\n-        message: t('validation.invalid-protocol')\n-      };\n+      return { state: 'error', message: t('validation.invalid-protocol') };\n     }\n-\n     return isURL(url)\n       ? { state: 'success', message: '' }\n       : { state: 'warning', message: t('validation.use-valid-url') };\n-  }\n-  formCorrect(portfolio: PortfolioProjectData) {\n-    const { id, title, description, url, image } = portfolio;\n+  };\n \n+  const formCorrect = (portfolioItem: PortfolioProjectData) => {\n+    const { id, title, description, url, image } = portfolioItem;\n     const { state: titleState, message: titleMessage } =\n-      this.getTitleValidation(title);\n-    const { state: urlState, message: urlMessage } = this.getUrlValidation(url);\n+      getTitleValidation(title);\n+    const { state: urlState, message: urlMessage } = getUrlValidation(url);\n     const { state: descriptionState, message: descriptionMessage } =\n-      this.getDescriptionValidation(description);\n+      getDescriptionValidation(description);\n     const { state: imageState, message: imageMessage } =\n-      this.getUrlValidation(image);\n-\n-    const pristine = this.isFormPristine(id);\n-\n+      getUrlValidation(image);\n+    const pristine = isFormPristine(id);\n     const urlIsValid = !isURL(url, {\n       protocols: ['http', 'https'],\n       require_tld: true,\n       require_protocol: true\n     });\n-\n     const isButtonDisabled = [\n       titleState,\n       urlState,\n       descriptionState,\n       imageState,\n       urlIsValid\n     ].some(state => state === 'error' || false);\n-\n     return {\n       isButtonDisabled,\n-      title: {\n-        titleState,\n-        titleMessage\n-      },\n-      url: {\n-        urlState,\n-        urlMessage\n-      },\n-      image: {\n-        imageState,\n-        imageMessage\n-      },\n-      desc: {\n-        descriptionState,\n-        descriptionMessage\n-      },\n+      title: { titleState, titleMessage },\n+      url: { urlState, urlMessage },\n+      image: { imageState, imageMessage },\n+      desc: { descriptionState, descriptionMessage },\n       pristine\n     };\n-  }\n+  };\n \n-  renderPortfolio = (\n-    portfolio: PortfolioProjectData,\n+  const renderPortfolio = (\n+    portfolioItem: PortfolioProjectData,\n     index: number,\n     arr: PortfolioProjectData[]\n   ) => {\n-    const { t } = this.props;\n-    const { id, title, description, url, image } = portfolio;\n+    const { id, title, description, url, image } = portfolioItem;\n     const {\n       isButtonDisabled,\n       title: { titleState, titleMessage },\n       url: { urlState, urlMessage },\n       image: { imageState, imageMessage },\n       desc: { descriptionState, descriptionMessage },\n       pristine\n-    } = this.formCorrect(portfolio);\n-\n+    } = formCorrect(portfolioItem);\n     const handleSubmit = (e: React.FormEvent<HTMLFormElement>, id: string) => {\n       e.preventDefault();\n       if (isButtonDisabled) return null;\n-      this.toggleEditing();\n-      return this.updateItem(id);\n+      setIsEditing(false);\n+      return updateItem(id);\n     };\n-\n     const combineImageStatus =\n-      imageState === 'success' && this.state.isImageValid.state === 'success'\n+      imageState === 'success' && imageValidation.state === 'success'\n         ? null\n         : 'error';\n-    const combineImageMessage = imageMessage || this.state.isImageValid.message;\n-\n+    const combineImageMessage = imageMessage || imageValidation.message;\n     return (\n       <FullWidthRow key={id}>\n         <form\n@@ -319,8 +255,8 @@ class PortfolioSettings extends Component<PortfolioProps, PortfolioState> {\n               {t('settings.labels.title')}\n             </ControlLabel>\n             <FormControl\n-              onChange={this.createOnChangeHandler(id, 'title')}\n-              required={true}\n+              onChange={createOnChangeHandler(id, 'title')}\n+              required\n               type='text'\n               value={title}\n               name='portfolio-title'\n@@ -340,8 +276,8 @@ class PortfolioSettings extends Component<PortfolioProps, PortfolioState> {\n               {t('settings.labels.url')}\n             </ControlLabel>\n             <FormControl\n-              onChange={this.createOnChangeHandler(id, 'url')}\n-              required={true}\n+              onChange={createOnChangeHandler(id, 'url')}\n+              required\n               type='url'\n               value={url}\n               name='portfolio-url'\n@@ -361,7 +297,7 @@ class PortfolioSettings extends Component<PortfolioProps, PortfolioState> {\n               {t('settings.labels.image')}\n             </ControlLabel>\n             <FormControl\n-              onChange={this.createOnChangeHandler(id, 'image')}\n+              onChange={createOnChangeHandler(id, 'image')}\n               type='url'\n               value={image}\n               name='portfolio-image'\n@@ -382,7 +318,7 @@ class PortfolioSettings extends Component<PortfolioProps, PortfolioState> {\n             </ControlLabel>\n             <FormControl\n               componentClass='textarea'\n-              onChange={this.createOnChangeHandler(id, 'description')}\n+              onChange={createOnChangeHandler(id, 'description')}\n               value={description}\n               name='portfolio-description'\n               id={`${id}-description-input`}\n@@ -403,10 +339,10 @@ class PortfolioSettings extends Component<PortfolioProps, PortfolioState> {\n           </BlockSaveButton>\n           <Spacer size='xs' />\n           <Button\n-            block={true}\n+            block\n             size='large'\n             variant='danger'\n-            onClick={() => this.handleRemoveItem(id)}\n+            onClick={() => handleRemoveItem(id)}\n             type='button'\n           >\n             {t('buttons.remove-portfolio')}\n@@ -423,33 +359,28 @@ class PortfolioSettings extends Component<PortfolioProps, PortfolioState> {\n     );\n   };\n \n-  render() {\n-    const { t } = this.props;\n-    const { portfolio = [], unsavedItemId } = this.state;\n-\n-    return (\n-      <section id='portfolio-settings'>\n-        <SectionHeader>{t('settings.headings.portfolio')}</SectionHeader>\n-        <FullWidthRow>\n-          <p>{t('settings.share-projects')}</p>\n-          <Spacer size='xs' />\n-          <Button\n-            block={true}\n-            size='large'\n-            variant='primary'\n-            disabled={unsavedItemId !== null}\n-            onClick={this.handleAdd}\n-            type='button'\n-          >\n-            {t('buttons.add-portfolio')}\n-          </Button>\n-        </FullWidthRow>\n-        <Spacer size='l' />\n-        {portfolio.length ? portfolio.map(this.renderPortfolio) : null}\n-      </section>\n-    );\n-  }\n-}\n+  return (\n+    <section id='portfolio-settings'>\n+      <SectionHeader>{t('settings.headings.portfolio')}</SectionHeader>\n+      <FullWidthRow>\n+        <p>{t('settings.share-projects')}</p>\n+        <Spacer size='xs' />\n+        <Button\n+          block\n+          size='large'\n+          variant='primary'\n+          disabled={unsavedItemId !== null}\n+          onClick={handleAdd}\n+          type='button'\n+        >\n+          {t('buttons.add-portfolio')}\n+        </Button>\n+      </FullWidthRow>\n+      <Spacer size='l' />\n+      {portfolio.length ? portfolio.map(renderPortfolio) : null}\n+    </section>\n+  );\n+};\n \n PortfolioSettings.displayName = 'PortfolioSettings';\n "
        }
    ],
    "stats": {
        "total": 289,
        "additions": 110,
        "deletions": 179
    }
}