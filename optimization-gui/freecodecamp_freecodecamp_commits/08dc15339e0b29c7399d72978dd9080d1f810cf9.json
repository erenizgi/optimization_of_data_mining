{
    "author": "moT01",
    "message": "feat: add more profile e2e tests (#54706)",
    "sha": "08dc15339e0b29c7399d72978dd9080d1f810cf9",
    "files": [
        {
            "sha": "902850a5dd642bfc20829acbecb82340e4134d3e",
            "filename": "e2e/profile.spec.ts",
            "status": "modified",
            "additions": 124,
            "deletions": 90,
            "changes": 214,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/08dc15339e0b29c7399d72978dd9080d1f810cf9/e2e%2Fprofile.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/08dc15339e0b29c7399d72978dd9080d1f810cf9/e2e%2Fprofile.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fprofile.spec.ts?ref=08dc15339e0b29c7399d72978dd9080d1f810cf9",
            "patch": "@@ -81,106 +81,140 @@ const legacyCerts = [\n   { name: 'Legacy Full Stack', url: '/certification/certifieduser/full-stack' }\n ];\n \n-test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+test.describe('Profile component', () => {\n+  test.describe('when viewing my own profile', () => {\n+    test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+    test.beforeEach(async ({ page }) => {\n+      await page.goto('/certifieduser');\n+\n+      // The following line is required if you're running the test in local development\n+      // await page\n+      //   .getByRole('button', { name: 'Preview custom 404 page' })\n+      //   .click();\n+    });\n \n-test.beforeEach(async ({ page }) => {\n-  await page.goto('/certifieduser');\n+    test('renders the camper profile correctly', async ({ page }) => {\n+      // There are multiple avatars on the page, one is in the navbar, one is in the page body.\n+      // The avatar we are interested in is the last one in the list\n+      const avatar = page\n+        .getByRole('img', {\n+          name: translations.icons.avatar,\n+          includeHidden: true // the svg has `aria-hidden` set to true\n+        })\n+        .last();\n \n-  // The following line is required if you're running the test in local development\n-  // await page.getByRole('button', { name: 'Preview custom 404 page' }).click();\n-});\n+      // \"visible\" as in the element is in the DOM, but it is hidden from non-sighted users\n+      await expect(avatar).toBeVisible();\n+\n+      await expect(\n+        page.getByRole('heading', { name: '@certifieduser' })\n+      ).toBeVisible();\n+      await expect(page.getByText('Full Stack User')).toBeVisible();\n+      await expect(page.getByText('Joined November 2020')).toBeVisible();\n+      await expect(\n+        page.getByRole('link', { name: 'Top Contributor' })\n+      ).toBeVisible();\n+      await expect(page.getByText('2019')).toBeVisible();\n+    });\n \n-test.describe('Profile component', () => {\n-  test('renders the camper profile correctly', async ({ page }) => {\n-    // There are multiple avatars on the page, one is in the navbar, one is in the page body.\n-    // The avatar we are interested in is the last one in the list\n-    const avatar = page\n-      .getByRole('img', {\n-        name: translations.icons.avatar,\n-        includeHidden: true // the svg has `aria-hidden` set to true\n-      })\n-      .last();\n-\n-    // \"visible\" as in the element is in the DOM, but it is hidden from non-sighted users\n-    await expect(avatar).toBeVisible();\n-\n-    await expect(\n-      page.getByRole('heading', { name: '@certifieduser' })\n-    ).toBeVisible();\n-    await expect(page.getByText('Full Stack User')).toBeVisible();\n-    await expect(page.getByText('Joined November 2020')).toBeVisible();\n-    await expect(\n-      page.getByRole('link', { name: 'Top Contributor' })\n-    ).toBeVisible();\n-    await expect(page.getByText('2019')).toBeVisible();\n-  });\n+    test('renders total points correctly', async ({ page }) => {\n+      await expect(page.getByText('Total Points:')).toBeVisible();\n+    });\n \n-  test('renders total points correctly', async ({ page }) => {\n-    await expect(page.getByText('Total Points:')).toBeVisible();\n-  });\n+    // The date range computation in this test doesn't match the implementation code,\n+    // and causes the test to fail in some cases.\n+    // We would want to mock system time to keep the test stable,\n+    // but Playwright currently doesn't offer a built-in mechanism for this.\n+    // Ref: https://github.com/microsoft/playwright/issues/6347\n+    test.skip('renders the heat map correctly', async ({ page }) => {\n+      const today = new Date();\n+      const currentMonth = today.toLocaleString('en-US', { month: 'short' });\n+      const sixMonthsAgo = new Date(today.setMonth(today.getMonth() - 6));\n+      const sixMonthsAgoMonth = sixMonthsAgo.toLocaleString('en-US', {\n+        month: 'short'\n+      });\n+      const dateRange = `${sixMonthsAgoMonth} ${sixMonthsAgo.getFullYear()} - ${currentMonth} ${today.getFullYear()}`;\n+\n+      await expect(page.getByText(dateRange)).toBeVisible();\n+      await expect(page.locator('.react-calendar-heatmap')).toBeVisible();\n+      // Streak should be a non-negative integer\n+      await expect(page.getByText(/Longest Streak: [0-9]\\d*$/)).toBeVisible();\n+      await expect(page.getByText(/Current Streak: [0-9]\\d*$/)).toBeVisible();\n+    });\n \n-  // The date range computation in this test doesn't match the implementation code,\n-  // and causes the test to fail in some cases.\n-  // We would want to mock system time to keep the test stable,\n-  // but Playwright currently doesn't offer a built-in mechanism for this.\n-  // Ref: https://github.com/microsoft/playwright/issues/6347\n-  test.skip('renders the heat map correctly', async ({ page }) => {\n-    const today = new Date();\n-    const currentMonth = today.toLocaleString('en-US', { month: 'short' });\n-    const sixMonthsAgo = new Date(today.setMonth(today.getMonth() - 6));\n-    const sixMonthsAgoMonth = sixMonthsAgo.toLocaleString('en-US', {\n-      month: 'short'\n+    test('displays certifications correctly', async ({ page }) => {\n+      await expect(\n+        page.getByRole('heading', { name: 'freeCodeCamp Certifications' })\n+      ).toBeVisible();\n+      await expect(\n+        page.getByRole('heading', { name: 'Legacy Certifications' })\n+      ).toBeVisible();\n+\n+      for (const cert of certs) {\n+        const link = page\n+          .getByRole('link', {\n+            name: `View ${cert.name} Certification`\n+          })\n+          .first();\n+        await expect(link).toBeVisible();\n+        await expect(link).toHaveAttribute('href', cert.url);\n+      }\n+\n+      for (const cert of legacyCerts) {\n+        const link = page\n+          .getByRole('link', {\n+            name: `View ${cert.name} Certification`\n+          })\n+          .last();\n+        await expect(link).toBeVisible();\n+        await expect(link).toHaveAttribute('href', cert.url);\n+      }\n     });\n-    const dateRange = `${sixMonthsAgoMonth} ${sixMonthsAgo.getFullYear()} - ${currentMonth} ${today.getFullYear()}`;\n \n-    await expect(page.getByText(dateRange)).toBeVisible();\n-    await expect(page.locator('.react-calendar-heatmap')).toBeVisible();\n-    // Streak should be a non-negative integer\n-    await expect(page.getByText(/Longest Streak: [0-9]\\d*$/)).toBeVisible();\n-    await expect(page.getByText(/Current Streak: [0-9]\\d*$/)).toBeVisible();\n-  });\n+    test('should not show portfolio when empty', async ({ page }) => {\n+      // @certifieduser doesn't have portfolio information\n+      await expect(\n+        page.getByText(translations.profile.projects)\n+      ).not.toBeVisible();\n+    });\n \n-  test('displays certifications correctly', async ({ page }) => {\n-    await expect(\n-      page.getByRole('heading', { name: 'freeCodeCamp Certifications' })\n-    ).toBeVisible();\n-    await expect(\n-      page.getByRole('heading', { name: 'Legacy Certifications' })\n-    ).toBeVisible();\n-\n-    for (const cert of certs) {\n-      const link = page\n-        .getByRole('link', {\n-          name: `View ${cert.name} Certification`\n-        })\n-        .first();\n-      await expect(link).toBeVisible();\n-      await expect(link).toHaveAttribute('href', cert.url);\n-    }\n-\n-    for (const cert of legacyCerts) {\n-      const link = page\n-        .getByRole('link', {\n-          name: `View ${cert.name} Certification`\n-        })\n-        .last();\n-      await expect(link).toBeVisible();\n-      await expect(link).toHaveAttribute('href', cert.url);\n-    }\n+    test('displays the timeline correctly', async ({ page }) => {\n+      await expect(\n+        page.getByRole('heading', { name: 'Timeline' })\n+      ).toBeVisible();\n+      await expect(page.getByRole('table')).toBeVisible();\n+      await expect(\n+        page.getByRole('navigation', { name: 'Timeline Pagination' })\n+      ).toBeVisible();\n+    });\n   });\n \n-  test('should not show portfolio when empty', async ({ page }) => {\n-    // @certifieduser doesn't have portfolio information\n-    await expect(\n-      page.getByText(translations.profile.projects)\n-    ).not.toBeVisible();\n-  });\n+  test.describe(\"when viewing someone else's profile\", () => {\n+    test.beforeEach(async ({ page }) => {\n+      await page.goto('/publicUser');\n \n-  test('displays the timeline correctly', async ({ page }) => {\n-    await expect(page.getByRole('heading', { name: 'Timeline' })).toBeVisible();\n-    await expect(page.getByRole('table')).toBeVisible();\n-    await expect(\n-      page.getByRole('navigation', { name: 'Timeline Pagination' })\n-    ).toBeVisible();\n+      // The following line is required if you're running the test in local development\n+      // await page\n+      //   .getByRole('button', { name: 'Preview custom 404 page' })\n+      //   .click();\n+    });\n+\n+    test.describe('while logged in', () => {\n+      test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+\n+      test('displays the public username', async ({ page }) => {\n+        await expect(\n+          page.getByRole('heading', { name: '@publicuser' })\n+        ).toBeVisible();\n+      });\n+    });\n+\n+    test.describe('logged out', () => {\n+      test('displays the public username', async ({ page }) => {\n+        await expect(\n+          page.getByRole('heading', { name: '@publicuser' })\n+        ).toBeVisible();\n+      });\n+    });\n   });\n });"
        },
        {
            "sha": "7df0ceda43ba8e90a8958e34b020224d93b8ccba",
            "filename": "tools/scripts/seed/seed-demo-user.js",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/08dc15339e0b29c7399d72978dd9080d1f810cf9/tools%2Fscripts%2Fseed%2Fseed-demo-user.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/08dc15339e0b29c7399d72978dd9080d1f810cf9/tools%2Fscripts%2Fseed%2Fseed-demo-user.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscripts%2Fseed%2Fseed-demo-user.js?ref=08dc15339e0b29c7399d72978dd9080d1f810cf9",
            "patch": "@@ -2,7 +2,12 @@ const path = require('path');\n const debug = require('debug');\n require('dotenv').config({ path: path.resolve(__dirname, '../../../.env') });\n const { MongoClient, ObjectId } = require('mongodb');\n-const { demoUser, blankUser, fullyCertifiedUser } = require('./user-data');\n+const {\n+  demoUser,\n+  blankUser,\n+  publicUser,\n+  fullyCertifiedUser\n+} = require('./user-data');\n \n const args = process.argv.slice(2);\n \n@@ -102,7 +107,8 @@ const user = db.collection('user');\n const userIds = [\n   new ObjectId('5fa2db00a25c1c1fa49ce067'),\n   new ObjectId('5bd30e0f1caf6ac3ddddddb5'),\n-  new ObjectId('5bd30e0f1caf6ac3ddddddb9')\n+  new ObjectId('5bd30e0f1caf6ac3ddddddb9'),\n+  new ObjectId('663b839b24a8b29f57728b13')\n ];\n \n const dropUserTokens = async function () {\n@@ -130,9 +136,11 @@ const run = async () => {\n   if (args.includes('certified-user')) {\n     await user.insertOne(fullyCertifiedUser);\n     await user.insertOne(blankUser);\n+    await user.insertOne(publicUser);\n   } else {\n     await user.insertOne(demoUser);\n     await user.insertOne(blankUser);\n+    await user.insertOne(publicUser);\n   }\n   log('local auth user seed complete');\n };"
        },
        {
            "sha": "dd1ed60478ad1553e644bc8c71acce07b1febc24",
            "filename": "tools/scripts/seed/user-data.js",
            "status": "modified",
            "additions": 61,
            "deletions": 0,
            "changes": 61,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/08dc15339e0b29c7399d72978dd9080d1f810cf9/tools%2Fscripts%2Fseed%2Fuser-data.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/08dc15339e0b29c7399d72978dd9080d1f810cf9/tools%2Fscripts%2Fseed%2Fuser-data.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscripts%2Fseed%2Fuser-data.js?ref=08dc15339e0b29c7399d72978dd9080d1f810cf9",
            "patch": "@@ -63,6 +63,67 @@ module.exports = {\n     externalId: '',\n     unsubscribeId: 'ecJxUi7OM49f24hTpauP8'\n   },\n+  publicUser: {\n+    _id: new ObjectId('663b839b24a8b29f57728b13'),\n+    email: 'bar@bars.com',\n+    emailVerified: true,\n+    progressTimestamps: [],\n+    isBanned: false,\n+    isCheater: false,\n+    username: 'publicuser',\n+    about: '',\n+    name: 'Public User',\n+    location: '',\n+    picture: '',\n+    acceptedPrivacyTerms: true,\n+    sendQuincyEmail: false,\n+    currentChallengeId: '',\n+    isHonest: false,\n+    isFrontEndCert: false,\n+    isDataVisCert: false,\n+    isBackEndCert: false,\n+    isFullStackCert: false,\n+    isRespWebDesignCert: false,\n+    is2018DataVisCert: false,\n+    isFrontEndLibsCert: false,\n+    isJsAlgoDataStructCert: false,\n+    isApisMicroservicesCert: false,\n+    isInfosecQaCert: false,\n+    isQaCertV7: false,\n+    isInfosecCertV7: false,\n+    is2018FullStackCert: false,\n+    isSciCompPyCertV7: false,\n+    isDataAnalysisPyCertV7: false,\n+    isMachineLearningPyCertV7: false,\n+    isRelationalDatabaseCertV8: false,\n+    isCollegeAlgebraPyCertV8: false,\n+    isFoundationalCSharpCertV8: false,\n+    completedChallenges: [],\n+    portfolio: [],\n+    yearsTopContributor: [],\n+    rand: 0.6126749173148205,\n+    theme: 'default',\n+    profileUI: {\n+      isLocked: false,\n+      showAbout: true,\n+      showCerts: true,\n+      showDonation: true,\n+      showHeatMap: true,\n+      showLocation: true,\n+      showName: true,\n+      showPoints: true,\n+      showPortfolio: true,\n+      showTimeLine: true\n+    },\n+    badges: {\n+      coreTeam: []\n+    },\n+    isDonating: false,\n+    emailAuthLinkTTL: null,\n+    emailVerifyTTL: null,\n+    externalId: '',\n+    unsubscribeId: 'ecJxUi7OM49f24hTpauP8'\n+  },\n   demoUser: {\n     _id: new ObjectId('5bd30e0f1caf6ac3ddddddb5'),\n     email: 'foo@bar.com',"
        }
    ],
    "stats": {
        "total": 287,
        "additions": 195,
        "deletions": 92
    }
}