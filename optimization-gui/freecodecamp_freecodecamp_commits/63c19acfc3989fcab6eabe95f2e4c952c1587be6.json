{
    "author": "huyenltnguyen",
    "message": "test(e2e): mock quiz data in quiz-challenge.spec.ts (#62011)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "63c19acfc3989fcab6eabe95f2e4c952c1587be6",
    "files": [
        {
            "sha": "b92324a096481f642ea2a621d4caf076eafc4242",
            "filename": "e2e/fixtures/quiz-fixture.json",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/63c19acfc3989fcab6eabe95f2e4c952c1587be6/e2e%2Ffixtures%2Fquiz-fixture.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/63c19acfc3989fcab6eabe95f2e4c952c1587be6/e2e%2Ffixtures%2Fquiz-fixture.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Ffixtures%2Fquiz-fixture.json?ref=63c19acfc3989fcab6eabe95f2e4c952c1587be6",
            "patch": "@@ -0,0 +1,26 @@\n+[\n+  {\n+    \"questions\": [\n+  { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"<pre><code>const x = 1;</code></pre>\"], \"text\": \"Question 1\", \"answer\": \"<pre><code>console.log('ok')</code></pre> Correct answer\" },\n+  { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 2\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 3\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 4\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 5\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 6\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 7\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 8\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 9\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 10\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 11\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 12\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 13\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 14\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 15\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 16\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 17\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 18\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 19\", \"answer\": \"Correct answer\" },\n+      { \"distractors\": [\"Wrong 1\", \"Wrong 2\", \"Wrong 3\"], \"text\": \"Question 20\", \"answer\": \"Correct answer\" }\n+    ]\n+  }\n+]"
        },
        {
            "sha": "4d80744dcf4e6372b66bfe3d3ef2321f689b309e",
            "filename": "e2e/quiz-challenge.spec.ts",
            "status": "modified",
            "additions": 61,
            "deletions": 4,
            "changes": 65,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/63c19acfc3989fcab6eabe95f2e4c952c1587be6/e2e%2Fquiz-challenge.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/63c19acfc3989fcab6eabe95f2e4c952c1587be6/e2e%2Fquiz-challenge.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fquiz-challenge.spec.ts?ref=63c19acfc3989fcab6eabe95f2e4c952c1587be6",
            "patch": "@@ -1,8 +1,47 @@\n+import fs from 'fs';\n+import path from 'path';\n import { test, expect } from '@playwright/test';\n import { allowTrailingSlash } from './utils/url';\n \n+interface QuizQuestion {\n+  distractors: string[];\n+  text: string;\n+  answer: string;\n+}\n+\n+interface Quiz {\n+  questions: QuizQuestion[];\n+}\n+\n+interface PageData {\n+  result: {\n+    data: {\n+      challengeNode: {\n+        challenge: { quizzes: Quiz[] };\n+      };\n+    };\n+  };\n+}\n+\n test.describe('Quiz challenge', () => {\n   test.beforeEach(async ({ page }) => {\n+    const fixturePath = path.join(__dirname, 'fixtures', 'quiz-fixture.json');\n+    const fixture = JSON.parse(fs.readFileSync(fixturePath, 'utf8')) as Quiz[];\n+\n+    // Intercept Gatsby page-data and inject a deterministic quiz fixture\n+    await page.route('**/page-data/**/page-data.json', async route => {\n+      const response = await route.fetch();\n+      const body = await response.text();\n+\n+      const pageData = JSON.parse(body) as PageData;\n+      pageData.result.data.challengeNode.challenge.quizzes = fixture;\n+\n+      await route.fulfill({\n+        contentType: 'application/json',\n+        body: JSON.stringify(pageData)\n+      });\n+    });\n+\n     await page.goto(\n       '/learn/full-stack-developer/quiz-basic-html/quiz-basic-html'\n     );\n@@ -13,6 +52,18 @@ test.describe('Quiz challenge', () => {\n   }) => {\n     // Wait for the page content to render\n     await expect(page.getByRole('radiogroup')).toHaveCount(20);\n+    const radioGroups = await page.getByRole('radiogroup').all();\n+\n+    // The radio label contents are rendered with `PrismFormatted`.\n+    // For accessibility we must ensure:\n+    // - The formatted content is wrapped in a `span`\n+    // - No ARIA role is added to `pre` elements\n+    const firstGroup = radioGroups[0];\n+    const spanLabel = firstGroup.locator('span.quiz-answer-label');\n+    await expect(spanLabel).toHaveCount(4);\n+\n+    const preWithRole = firstGroup.locator('pre[role]');\n+    await expect(preWithRole).toHaveCount(0);\n \n     for (let i = 0; i < 15; i++) {\n       const radioGroups = await page.getByRole('radiogroup').all();\n@@ -41,10 +92,13 @@ test.describe('Quiz challenge', () => {\n     // Answer 18 questions correctly.\n     // This is enough to pass the quiz, and also allowing us to test the quiz passing criteria.\n     for (let i = 0; i < radioGroups.length; i++) {\n+      const group = radioGroups[i];\n+      const correct = group.getByRole('radio', { name: /Correct answer/i });\n+      const wrong = group.getByRole('radio', { name: /Wrong 1/i });\n       if (i <= 17) {\n-        await radioGroups[i].locator(\"[role='radio'][data-value='4']\").click();\n+        await correct.click();\n       } else {\n-        await radioGroups[i].locator(\"[role='radio'][data-value='1']\").click();\n+        await wrong.click();\n       }\n     }\n \n@@ -105,10 +159,13 @@ test.describe('Quiz challenge', () => {\n \n     // Answer only 10 questions correctly.\n     for (let i = 0; i < radioGroups.length; i++) {\n+      const group = radioGroups[i];\n+      const correct = group.getByRole('radio', { name: /Correct answer/i });\n+      const wrong = group.getByRole('radio', { name: /Wrong 1/i });\n       if (i <= 9) {\n-        await radioGroups[i].locator(\"[role='radio'][data-value='4']\").click();\n+        await correct.click();\n       } else {\n-        await radioGroups[i].locator(\"[role='radio'][data-value='1']\").click();\n+        await wrong.click();\n       }\n     }\n "
        }
    ],
    "stats": {
        "total": 91,
        "additions": 87,
        "deletions": 4
    }
}