{
    "author": "ojeytonwilliams",
    "message": "test: migrate email-change to playwright (#55035)",
    "sha": "e7b1eda84d95c256c768779293cdbb67013db73b",
    "files": [
        {
            "sha": "dcc56359601d943ad797d4204a5a741f47112a71",
            "filename": "client/src/components/settings/email.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e7b1eda84d95c256c768779293cdbb67013db73b/client%2Fsrc%2Fcomponents%2Fsettings%2Femail.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e7b1eda84d95c256c768779293cdbb67013db73b/client%2Fsrc%2Fcomponents%2Fsettings%2Femail.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fsettings%2Femail.tsx?ref=e7b1eda84d95c256c768779293cdbb67013db73b",
            "patch": "@@ -213,7 +213,7 @@ function EmailSettings({\n                 id='new-email-input'\n               />\n               {newEmailValidationMessage ? (\n-                <HelpBlock data-cy='validation-message'>\n+                <HelpBlock data-playwright-test-label='new-email-validation'>\n                   {newEmailValidationMessage}\n                 </HelpBlock>\n               ) : null}\n@@ -233,7 +233,7 @@ function EmailSettings({\n                 id='confirm-email-input'\n               />\n               {confirmEmailValidationMessage ? (\n-                <HelpBlock data-cy='validation-message'>\n+                <HelpBlock data-playwright-test-label='confirm-email-validation'>\n                   {confirmEmailValidationMessage}\n                 </HelpBlock>\n               ) : null}"
        },
        {
            "sha": "b0be0484c8986be0ddbdc11c643f132b18f31ce7",
            "filename": "cypress/e2e/default/settings/email-change.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/9418cc16f256a860b6b2d8def6968259c91d737a/cypress%2Fe2e%2Fdefault%2Fsettings%2Femail-change.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/9418cc16f256a860b6b2d8def6968259c91d737a/cypress%2Fe2e%2Fdefault%2Fsettings%2Femail-change.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/cypress%2Fe2e%2Fdefault%2Fsettings%2Femail-change.ts?ref=9418cc16f256a860b6b2d8def6968259c91d737a",
            "patch": "@@ -1,43 +0,0 @@\n-describe('Email input field', () => {\n-  beforeEach(() => {\n-    cy.task('seed');\n-    cy.login();\n-    cy.visit('/settings');\n-  });\n-\n-  it('Should be possible to submit the new email', () => {\n-    cy.get('[data-cy=\"email-input\"]')\n-      .type('bar@foo.com')\n-      .should('have.attr', 'value', 'bar@foo.com');\n-\n-    cy.get('[data-cy=\"confirm-email\"]')\n-      .type('bar@foo.com')\n-      .should('have.attr', 'value', 'bar@foo.com');\n-\n-    cy.get('[data-cy=\"form-update-email\"]').within(() => {\n-      cy.contains('Save').click();\n-    });\n-    cy.contains(\n-      'Check your email and click the link we sent you to confirm your new email address.'\n-    );\n-  });\n-\n-  it('Displays an error message when there are problems with the submitted emails', () => {\n-    cy.get('[data-cy=\"email-input\"]').type('bar@foo.com');\n-    cy.get('[data-cy=\"confirm-email\"]').type('foo@bar.com');\n-\n-    cy.get('[data-cy=\"validation-message\"]').contains(\n-      'Both new email addresses must be the same'\n-    );\n-\n-    cy.get('[data-cy=\"email-input\"]').clear().type('foo@bar.com');\n-\n-    cy.get('[data-cy=\"validation-message\"]').contains(\n-      'This email is the same as your current email'\n-    );\n-  });\n-\n-  it('Should be possible to get Quincys weekly email', () => {\n-    cy.contains('Yes please').click();\n-  });\n-});"
        },
        {
            "sha": "cfe26fe22c21aa65010a7d4e32a8b6a01360363e",
            "filename": "e2e/email-settings.spec.ts",
            "status": "modified",
            "additions": 52,
            "deletions": 11,
            "changes": 63,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e7b1eda84d95c256c768779293cdbb67013db73b/e2e%2Femail-settings.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e7b1eda84d95c256c768779293cdbb67013db73b/e2e%2Femail-settings.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Femail-settings.spec.ts?ref=e7b1eda84d95c256c768779293cdbb67013db73b",
            "patch": "@@ -1,15 +1,24 @@\n+import { execSync } from 'child_process';\n+\n import { test, expect } from '@playwright/test';\n+\n import translations from '../client/i18n/locales/english/translations.json';\n \n const settingsPageElement = {\n   emailVerificationAlert: 'email-verification-alert',\n   emailVerificationLink: 'email-verification-link',\n-  flashMessageAlert: 'flash-message'\n+  flashMessageAlert: 'flash-message',\n+  newEmailValidation: 'new-email-validation',\n+  confirmEmailValidation: 'confirm-email-validation'\n } as const;\n \n+const originalEmail = 'foo@bar.com';\n+const newEmail = 'foo-update@bar.com';\n+\n test.use({ storageState: 'playwright/.auth/certified-user.json' });\n \n test.beforeEach(async ({ page }) => {\n+  execSync('node ./tools/scripts/seed/seed-demo-user certified-user');\n   await page.goto('/settings');\n });\n \n@@ -19,7 +28,7 @@ test.describe('Email Settings', () => {\n       page.getByRole('heading', { name: translations.settings.email.heading })\n     ).toBeVisible();\n \n-    await expect(page.getByText('foo@bar.com')).toBeVisible();\n+    await expect(page.getByText(originalEmail)).toBeVisible();\n \n     await expect(\n       page.getByRole('button', {\n@@ -49,26 +58,26 @@ test.describe('Email Settings', () => {\n   test('should display email verification alert after email update', async ({\n     page\n   }) => {\n-    const newEmailAddress = 'foo-update@bar.com';\n-\n+    const flashMessageAlert = page.getByTestId(\n+      settingsPageElement.flashMessageAlert\n+    );\n     // Need exact match as there are \"New email\" and \"Confirm new email\" labels\n     await page\n       .getByLabel(translations.settings.email.new, { exact: true })\n-      .fill(newEmailAddress);\n+      .fill(newEmail);\n \n-    await page\n-      .getByLabel(translations.settings.email.confirm)\n-      .fill(newEmailAddress);\n+    await page.getByLabel(translations.settings.email.confirm).fill(newEmail);\n \n     await page\n       .getByRole('button', {\n         name: `${translations.buttons.save} ${translations.settings.email.heading}`\n       })\n       .click();\n \n-    await expect(\n-      page.getByTestId(settingsPageElement.flashMessageAlert)\n-    ).toBeVisible();\n+    await expect(flashMessageAlert).toBeVisible();\n+    await expect(flashMessageAlert).toContainText(\n+      'Check your email and click the link we sent you to confirm your new email address.'\n+    );\n \n     await page.reload();\n     await expect(\n@@ -84,6 +93,38 @@ test.describe('Email Settings', () => {\n     );\n   });\n \n+  test('should show the user error messages if the input is invalid', async ({\n+    page\n+  }) => {\n+    const newEmailInput = page.getByLabel(translations.settings.email.new, {\n+      exact: true\n+    });\n+    const confirmEmailInput = page.getByLabel(\n+      translations.settings.email.confirm\n+    );\n+    const confirmValidation = page.getByTestId(\n+      settingsPageElement.confirmEmailValidation\n+    );\n+    const newEmailValidation = page.getByTestId(\n+      settingsPageElement.newEmailValidation\n+    );\n+\n+    await newEmailInput.fill(newEmail);\n+    await confirmEmailInput.fill(originalEmail);\n+\n+    await expect(confirmValidation).toBeVisible();\n+    await expect(confirmValidation).toContainText(\n+      translations.validation['email-mismatch']\n+    );\n+\n+    await newEmailInput.fill(originalEmail);\n+\n+    await expect(newEmailValidation).toBeVisible();\n+    await expect(newEmailValidation).toContainText(\n+      translations.validation['same-email']\n+    );\n+  });\n+\n   test('should toggle email subscription correctly', async ({ page }) => {\n     const yesPleaseButton = page.getByRole('button', {\n       name: translations.buttons['yes-please']"
        }
    ],
    "stats": {
        "total": 110,
        "additions": 54,
        "deletions": 56
    }
}