{
    "author": "ojeytonwilliams",
    "message": "feat: support afterAll hook in challenge tests (#61256)",
    "sha": "2b008e5aa82a8f874035c7731338b90f4b5195c3",
    "files": [
        {
            "sha": "1b5c2e8180b61f749eff0893506ade58613ce173",
            "filename": "client/gatsby-node.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/client%2Fgatsby-node.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/client%2Fgatsby-node.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fgatsby-node.js?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -384,6 +384,7 @@ exports.createSchemaCustomization = ({ actions }) => {\n       beforeEach: String\n       afterEach: String\n       beforeAll: String\n+      afterAll: String\n     }\n   `;\n   createTypes(typeDefs);"
        },
        {
            "sha": "a24bd1a81aa5a55d9448f83a48a450494e6c1121",
            "filename": "client/src/redux/prop-types.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fprop-types.ts?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -243,6 +243,7 @@ export interface Hooks {\n   beforeAll?: string;\n   beforeEach?: string;\n   afterEach?: string;\n+  afterAll?: string;\n }\n \n export type PageContext = {"
        },
        {
            "sha": "aac49c9b0cd9d971dd2fcba20c7e9e1c2197aed7",
            "filename": "client/src/templates/Challenges/classic/show.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fshow.tsx?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -591,6 +591,7 @@ export const query = graphql`\n           beforeAll\n           beforeEach\n           afterEach\n+          afterAll\n         }\n         fields {\n           blockName"
        },
        {
            "sha": "b55892bb3ac1b74e547c5b53334f1d3e89c453f6",
            "filename": "client/src/templates/Challenges/redux/execute-challenge-saga.js",
            "status": "modified",
            "additions": 12,
            "deletions": 11,
            "changes": 23,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fexecute-challenge-saga.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fexecute-challenge-saga.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fexecute-challenge-saga.js?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -1,5 +1,5 @@\n import i18next from 'i18next';\n-import { escape } from 'lodash-es';\n+import { escape, isEmpty } from 'lodash-es';\n import { channel } from 'redux-saga';\n import {\n   call,\n@@ -185,18 +185,17 @@ function* buildChallengeData(challengeData, options) {\n }\n \n function* executeTests(testRunner, tests, testTimeout = 5000) {\n+  const testStrings = tests.map(test => test.testString);\n+  const rawResults = yield call(testRunner, testStrings, testTimeout);\n+\n   const testResults = [];\n-  for (let i = 0; i < tests.length; i++) {\n+  for (let i = 0; i < rawResults.length; i++) {\n     const { text, testString } = tests[i];\n     const newTest = { text, testString, running: false };\n     // only the first test outputs console.logs to avoid log duplication.\n     const firstTest = i === 0;\n     try {\n-      const {\n-        pass,\n-        err,\n-        logs = []\n-      } = yield call(testRunner, testString, testTimeout);\n+      const { pass, err, logs = [] } = rawResults[i] || {};\n \n       const logString = logs.map(log => log.msg).join('\\n');\n       if (firstTest && logString) {\n@@ -300,11 +299,13 @@ export function* previewChallengeSaga(action) {\n         }\n       } else if (isJavaScriptChallenge(challengeData)) {\n         const runUserCode = yield call(getTestRunner, buildData);\n-        // without a testString the testRunner just evaluates the user's code\n-        const out = yield call(runUserCode, null, previewTimeout);\n \n-        if (out) {\n-          const logs = out.logs?.filter(\n+        // Without an empty testString the testRunner just evaluates the user's\n+        // code allowing us to get the console logs.\n+        const results = yield call(runUserCode, [''], previewTimeout);\n+\n+        if (!isEmpty(results)) {\n+          const logs = results[0].logs?.filter(\n             log => !LOGS_TO_IGNORE.some(msg => log.msg === msg)\n           );\n           yield put(updateConsole(logs?.map(log => log.msg).join('\\n')));"
        },
        {
            "sha": "4652f5e7d6419f43721d8f2e47d2f92859cf19b7",
            "filename": "client/src/templates/Challenges/utils/build.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fbuild.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fbuild.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fbuild.ts?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -9,7 +9,7 @@ import {\n   getMultifileJSXTransformers\n } from '../rechallenge/transformers';\n import {\n-  runTestInTestFrame,\n+  runTestsInTestFrame,\n   createMainPreviewFramer,\n   createProjectPreviewFramer,\n   ProxyLogger,\n@@ -159,8 +159,8 @@ export async function getTestRunner(buildData: BuildChallengeData) {\n   }\n   await prepTestRunner({ ...buildData, type });\n \n-  return (testString: string, testTimeout: number) =>\n-    runTestInTestFrame(testString, testTimeout, type);\n+  return (testStrings: string[], testTimeout: number) =>\n+    runTestsInTestFrame(testStrings, testTimeout, type);\n }\n \n type BuildResult = {"
        },
        {
            "sha": "6151c2a9758ba3177dc064b5b62c2c7a80022370",
            "filename": "client/src/templates/Challenges/utils/frame.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 9,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fframe.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fframe.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fframe.ts?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -169,19 +169,14 @@ function getContentDocument<T extends Document = FrameDocument>(\n   return frameDocument as T;\n }\n \n-export const runTestInTestFrame = async function (\n-  test: string,\n+export const runTestsInTestFrame = async function (\n+  tests: string[],\n   timeout: number,\n   type: 'dom' | 'javascript' | 'python'\n-): Promise<TestResult | undefined> {\n+): Promise<TestResult[] | undefined> {\n   const runner = window?.FCCTestRunner.getRunner(type);\n \n-  return await Promise.race([\n-    new Promise<\n-      { pass: boolean } | { err: { message: string; stack?: string } }\n-    >((_, reject) => setTimeout(() => reject(Error('timeout')), timeout)),\n-    runner?.runTest(test)\n-  ]);\n+  return runner?.runAllTests(tests, timeout);\n };\n \n export const prepTestRunner = async ({"
        },
        {
            "sha": "873dab3069d3c709ce6cc6bd9dc6edf891ebdb50",
            "filename": "curriculum/challenges/english/blocks/lab-one-time-password-generator/67c562286b29447da020d407.md",
            "status": "modified",
            "additions": 6,
            "deletions": 8,
            "changes": 14,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/curriculum%2Fchallenges%2Fenglish%2Fblocks%2Flab-one-time-password-generator%2F67c562286b29447da020d407.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/curriculum%2Fchallenges%2Fenglish%2Fblocks%2Flab-one-time-password-generator%2F67c562286b29447da020d407.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fchallenges%2Fenglish%2Fblocks%2Flab-one-time-password-generator%2F67c562286b29447da020d407.md?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -36,6 +36,12 @@ In this lab, you will generate a 6-digit OTP (One-Time Password) and display it\n let clock = __FakeTimers.install();\n ```\n \n+# --after-all--\n+\n+```js\n+clock.uninstall();\n+```\n+\n # --hints--\n \n You should not remove the existing `const { useState, useEffect, useRef } = React;` assignment from the code.\n@@ -234,14 +240,6 @@ You should export the `OTPGenerator` component.\n assert.isFunction(window.index.OTPGenerator);\n ```\n \n-Uninstall the clock, ignore this test\n-\n-```js\n-async () => {\n-clock.uninstall()\n-}\n-```\n-\n # --seed--\n \n ## --seed-contents--"
        },
        {
            "sha": "4eb3f2f5466e4400b55e559c5ee7595c42103bb3",
            "filename": "curriculum/challenges/english/blocks/lab-tic-tac-toe/67e3a6b7f60b4085588189e6.md",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/curriculum%2Fchallenges%2Fenglish%2Fblocks%2Flab-tic-tac-toe%2F67e3a6b7f60b4085588189e6.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/curriculum%2Fchallenges%2Fenglish%2Fblocks%2Flab-tic-tac-toe%2F67e3a6b7f60b4085588189e6.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fchallenges%2Fenglish%2Fblocks%2Flab-tic-tac-toe%2F67e3a6b7f60b4085588189e6.md?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -43,6 +43,12 @@ function getInnerTextExcept(removingSelector) {\n }\n ```\n \n+# --after-all--\n+\n+```js\n+clock.uninstall();\n+```\n+\n # --hints--\n \n You should export a `Board` component."
        },
        {
            "sha": "754a8fea889aca238dd8525e852602121b5e39d2",
            "filename": "curriculum/schema/challenge-schema.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/curriculum%2Fschema%2Fchallenge-schema.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/curriculum%2Fschema%2Fchallenge-schema.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fschema%2Fchallenge-schema.js?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -306,7 +306,8 @@ const schema = Joi.object().keys({\n   hooks: Joi.object().keys({\n     beforeAll: Joi.string().allow(''),\n     beforeEach: Joi.string().allow(''),\n-    afterEach: Joi.string().allow('')\n+    afterEach: Joi.string().allow(''),\n+    afterAll: Joi.string().allow('')\n   }),\n   tests: Joi.array()\n     .items("
        },
        {
            "sha": "bafbfdb75d335cd28cda6af4434028f27aa81f5e",
            "filename": "curriculum/test/test-challenges.js",
            "status": "modified",
            "additions": 35,
            "deletions": 50,
            "changes": 85,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/curriculum%2Ftest%2Ftest-challenges.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/curriculum%2Ftest%2Ftest-challenges.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Ftest%2Ftest-challenges.js?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -412,13 +412,10 @@ function populateTestsForLang({ lang, challenges, meta, superBlocks }) {\n                     fails = true;\n                   }\n                   if (!fails) {\n-                    for (const test of tests) {\n-                      try {\n-                        await testRunner(test);\n-                      } catch {\n-                        fails = true;\n-                        break;\n-                      }\n+                    try {\n+                      await testRunner(tests);\n+                    } catch {\n+                      fails = true;\n                     }\n                   }\n                   console.error = oldConsoleError;\n@@ -513,9 +510,8 @@ seed goes here\n                         buildChallenge,\n                         solutionFromNext\n                       );\n-                      for (const test of tests) {\n-                        await testRunner(test);\n-                      }\n+\n+                      await testRunner(tests);\n                     });\n                   });\n                 });\n@@ -557,24 +553,26 @@ async function createTestRunner(\n     hooks: challenge.hooks\n   });\n \n-  return async ({ text, testString }) => {\n-    try {\n-      const { pass, err } = await evaluator.evaluate(testString, 5000);\n-      if (!pass) {\n+  return async tests => {\n+    const testStrings = tests.map(test => test.testString);\n+\n+    const results = await evaluator.evaluate(testStrings, 5000);\n+    for (let i = 0; i < results.length; i++) {\n+      const { err } = results[i];\n+      let { text } = tests[i];\n+      if (err) {\n+        text = 'Test text: ' + text;\n+        const newMessage = solutionFromNext\n+          ? 'Check next step for solution!\\n' + text\n+          : text;\n+        // if the stack is missing, the message should be included. Otherwise it\n+        // is redundant.\n+        err.message = err.stack\n+          ? newMessage\n+          : `${newMessage}\n+      ${err.message}`;\n         throw err;\n       }\n-    } catch (err) {\n-      text = 'Test text: ' + text;\n-      const newMessage = solutionFromNext\n-        ? 'Check next step for solution!\\n' + text\n-        : text;\n-      // if the stack is missing, the message should be included. Otherwise it\n-      // is redundant.\n-      err.message = err.stack\n-        ? newMessage\n-        : `${newMessage}\n-      ${err.message}`;\n-      throw err;\n     }\n   };\n }\n@@ -604,31 +602,18 @@ async function getContextEvaluator(config) {\n   await initializeTestRunner(config);\n \n   return {\n-    evaluate: async (testString, timeout) =>\n-      Promise.race([\n-        new Promise((_, reject) =>\n-          setTimeout(\n-            () =>\n-              reject(\n-                Error(`timeout in challenge\n-${config.challengeId}\n-while evaluating test:\n-${testString}\n-`)\n-              ),\n+    evaluate: async (testStrings, timeout) =>\n+      await page.evaluate(\n+        async (type, testStrings, timeout) => {\n+          return await window.FCCTestRunner.getRunner(type).runAllTests(\n+            testStrings,\n             timeout\n-          )\n-        ),\n-        await page.evaluate(\n-          async (testString, type) => {\n-            return await window.FCCTestRunner.getRunner(type).runTest(\n-              testString\n-            );\n-          },\n-          testString,\n-          config.type\n-        )\n-      ])\n+          );\n+        },\n+        config.type,\n+        testStrings,\n+        timeout\n+      )\n   };\n }\n "
        },
        {
            "sha": "df8a1c3aa9fd03a281c2a0c386556ce34d1a52a1",
            "filename": "tools/challenge-parser/parser/__fixtures__/with-after-all-hook.md",
            "status": "added",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-after-all-hook.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-after-all-hook.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-after-all-hook.md?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -0,0 +1,40 @@\n+# --description--\n+\n+Paragraph 1\n+\n+```html\n+code example\n+```\n+\n+# --after-all--\n+\n+```js\n+// after all code\n+function teardown() {\n+  return 'cleaned up';\n+}\n+teardown();\n+```\n+\n+# --hints--\n+\n+First hint\n+\n+```js\n+// test code\n+```\n+\n+Second hint with <code>code</code>\n+\n+```js\n+// more test code\n+```\n+\n+Third *hint* with <code>code</code> and `inline code`\n+\n+```js\n+// more test code\n+if(let x of xs) {\n+  console.log(x);\n+}\n+```"
        },
        {
            "sha": "596238805fae1f0148aa56fe6f4e7614e2ffa1ae",
            "filename": "tools/challenge-parser/parser/__fixtures__/with-another-invalid-after-all-hook.md",
            "status": "added",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-another-invalid-after-all-hook.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-another-invalid-after-all-hook.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-another-invalid-after-all-hook.md?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -0,0 +1,34 @@\n+# --description--\n+\n+Paragraph 1\n+\n+```html\n+code example\n+```\n+\n+# --after-all--\n+\n+gubbins\n+\n+# --hints--\n+\n+First hint\n+\n+```js\n+// test code\n+```\n+\n+Second hint with <code>code</code>\n+\n+```js\n+// more test code\n+```\n+\n+Third *hint* with <code>code</code> and `inline code`\n+\n+```js\n+// more test code\n+if(let x of xs) {\n+  console.log(x);\n+}\n+```"
        },
        {
            "sha": "4298220c4178dabac94b45581a134ca6b2d052b3",
            "filename": "tools/challenge-parser/parser/__fixtures__/with-invalid-after-all-hook.md",
            "status": "added",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-invalid-after-all-hook.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-invalid-after-all-hook.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-invalid-after-all-hook.md?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -0,0 +1,42 @@\n+# --description--\n+\n+Paragraph 1\n+\n+```html\n+code example\n+```\n+\n+# --after-all--\n+\n+```js\n+// after all code\n+function teardown() {\n+  return 'cleaned up';\n+}\n+teardown();\n+```\n+\n+gubbins\n+\n+# --hints--\n+\n+First hint\n+\n+```js\n+// test code\n+```\n+\n+Second hint with <code>code</code>\n+\n+```js\n+// more test code\n+```\n+\n+Third *hint* with <code>code</code> and `inline code`\n+\n+```js\n+// more test code\n+if(let x of xs) {\n+  console.log(x);\n+}\n+```"
        },
        {
            "sha": "18d6f27b3fcb87571ba85221c103044afbdadf79",
            "filename": "tools/challenge-parser/parser/__fixtures__/with-non-js-after-all-hook.md",
            "status": "added",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-non-js-after-all-hook.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-non-js-after-all-hook.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2F__fixtures__%2Fwith-non-js-after-all-hook.md?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -0,0 +1,40 @@\n+# --description--\n+\n+Paragraph 1\n+\n+```html\n+code example\n+```\n+\n+# --after-all--\n+\n+```ts\n+// after all code\n+function teardown() {\n+  return 'cleaned up';\n+}\n+teardown();\n+```\n+\n+# --hints--\n+\n+First hint\n+\n+```js\n+// test code\n+```\n+\n+Second hint with <code>code</code>\n+\n+```js\n+// more test code\n+```\n+\n+Third *hint* with <code>code</code> and `inline code`\n+\n+```js\n+// more test code\n+if(let x of xs) {\n+  console.log(x);\n+}\n+```"
        },
        {
            "sha": "6d45165f27a39b2481c1d00a19870b7eb8d76d37",
            "filename": "tools/challenge-parser/parser/plugins/add-hooks.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-hooks.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-hooks.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-hooks.js?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -7,13 +7,15 @@ function plugin() {\n     const beforeAll = getHook(tree, '--before-all--');\n     const beforeEach = getHook(tree, '--before-each--');\n     const afterEach = getHook(tree, '--after-each--');\n+    const afterAll = getHook(tree, '--after-all--');\n \n-    if (!beforeAll && !beforeEach && !afterEach) return;\n+    if (!beforeAll && !beforeEach && !afterEach && !afterAll) return;\n \n     file.data.hooks = file.data.hooks = {\n       ...(beforeAll && { beforeAll }),\n       ...(beforeEach && { beforeEach }),\n-      ...(afterEach && { afterEach })\n+      ...(afterEach && { afterEach }),\n+      ...(afterAll && { afterAll })\n     };\n   }\n }"
        },
        {
            "sha": "d856f46a643d8ee4817c7ec5238a4b50d7c57b19",
            "filename": "tools/challenge-parser/parser/plugins/add-hooks.test.js",
            "status": "modified",
            "additions": 42,
            "deletions": 1,
            "changes": 43,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/2b008e5aa82a8f874035c7731338b90f4b5195c3/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-hooks.test.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/2b008e5aa82a8f874035c7731338b90f4b5195c3/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-hooks.test.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-parser%2Fparser%2Fplugins%2Fadd-hooks.test.js?ref=2b008e5aa82a8f874035c7731338b90f4b5195c3",
            "patch": "@@ -14,7 +14,11 @@ describe('add-before-hook plugin', () => {\n     withAfterEachHookAST,\n     withInvalidAfterEachHookAST,\n     withAnotherInvalidAfterEachHookAST,\n-    withNonJSAfterEachHookAST;\n+    withNonJSAfterEachHookAST,\n+    withAfterAllHookAST,\n+    withInvalidAfterAllHookAST,\n+    withAnotherInvalidAfterAllHookAST,\n+    withNonJSAfterAllHookAST;\n \n   const plugin = addBeforeHook();\n   let file = { data: {} };\n@@ -46,6 +50,16 @@ describe('add-before-hook plugin', () => {\n     withNonJSAfterEachHookAST = await parseFixture(\n       'with-non-js-after-each-hook.md'\n     );\n+    withAfterAllHookAST = await parseFixture('with-after-all-hook.md');\n+    withInvalidAfterAllHookAST = await parseFixture(\n+      'with-invalid-after-all-hook.md'\n+    );\n+    withAnotherInvalidAfterAllHookAST = await parseFixture(\n+      'with-another-invalid-after-all-hook.md'\n+    );\n+    withNonJSAfterAllHookAST = await parseFixture(\n+      'with-non-js-after-all-hook.md'\n+    );\n   });\n \n   beforeEach(() => {\n@@ -146,4 +160,31 @@ cleanup();`);\n       `# --after-each-- hook must be written in JavaScript`\n     );\n   });\n+\n+  it('populates `hooks.afterAll` with the contents of the code block', () => {\n+    plugin(withAfterAllHookAST, file);\n+    expect(file.data.hooks.afterAll).toBe(`// after all code\n+function teardown() {\n+  return 'cleaned up';\n+}\n+teardown();`);\n+  });\n+\n+  it('should throw an error if the afterAll section has more than one child', () => {\n+    expect(() => plugin(withInvalidAfterAllHookAST, file)).toThrow(\n+      `# --after-all-- section must only contain a single code block`\n+    );\n+  });\n+\n+  it('should throw an error if the afterAll section does not contain a code block', () => {\n+    expect(() => plugin(withAnotherInvalidAfterAllHookAST, file)).toThrow(\n+      `# --after-all-- section must contain a code block`\n+    );\n+  });\n+\n+  it('should throw an error if the afterAll code language is not javascript', () => {\n+    expect(() => plugin(withNonJSAfterAllHookAST, file)).toThrow(\n+      `# --after-all-- hook must be written in JavaScript`\n+    );\n+  });\n });"
        }
    ],
    "stats": {
        "total": 358,
        "additions": 273,
        "deletions": 85
    }
}