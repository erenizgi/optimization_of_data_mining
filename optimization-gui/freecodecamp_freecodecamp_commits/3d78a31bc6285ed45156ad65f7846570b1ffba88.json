{
    "author": "ShaunSHamilton",
    "message": "fix(api): DEPLOYMENT_ENV not same as client (#61893)",
    "sha": "3d78a31bc6285ed45156ad65f7846570b1ffba88",
    "files": [
        {
            "sha": "b0ccb5f2f2893912ed58fe09dae3c1560736797f",
            "filename": "api/src/exam-environment/routes/exam-environment.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3d78a31bc6285ed45156ad65f7846570b1ffba88/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3d78a31bc6285ed45156ad65f7846570b1ffba88/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts?ref=3d78a31bc6285ed45156ad65f7846570b1ffba88",
            "patch": "@@ -21,7 +21,7 @@ jest.mock('../../utils/env', () => {\n   return {\n     ...jest.requireActual('../../utils/env'),\n     FCC_ENABLE_EXAM_ENVIRONMENT: 'true',\n-    DEPLOYMENT_ENV: 'production'\n+    DEPLOYMENT_ENV: 'org'\n   };\n });\n "
        },
        {
            "sha": "c686cbc5dd834ee139d15fc513a0012177f64c60",
            "filename": "api/src/routes/protected/user.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3d78a31bc6285ed45156ad65f7846570b1ffba88/api%2Fsrc%2Froutes%2Fprotected%2Fuser.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3d78a31bc6285ed45156ad65f7846570b1ffba88/api%2Fsrc%2Froutes%2Fprotected%2Fuser.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fprotected%2Fuser.test.ts?ref=3d78a31bc6285ed45156ad65f7846570b1ffba88",
            "patch": "@@ -29,7 +29,7 @@ import { getMsTranscriptApiUrl } from './user';\n const mockedFetch = jest.fn();\n jest.spyOn(globalThis, 'fetch').mockImplementation(mockedFetch);\n \n-let mockDeploymentEnv = 'staging';\n+let mockDeploymentEnv = 'dev';\n jest.mock('../../utils/env', () => {\n   const actualEnv = jest.requireActual('../../utils/env');\n   // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n@@ -1287,11 +1287,11 @@ Thanks and regards,\n \n     describe('/user/exam-environment/token', () => {\n       beforeEach(() => {\n-        mockDeploymentEnv = 'production';\n+        mockDeploymentEnv = 'org';\n       });\n \n       afterAll(() => {\n-        mockDeploymentEnv = 'staging';\n+        mockDeploymentEnv = 'dev';\n       });\n \n       afterEach(async () => {\n@@ -1359,14 +1359,14 @@ Thanks and regards,\n \n       test('POST does not generate a new token in non-production environments for non-staff', async () => {\n         // Override deployment environment for this test\n-        mockDeploymentEnv = 'development';\n+        mockDeploymentEnv = 'dev';\n         const response = await superPost('/user/exam-environment/token');\n         expect(response.status).toBe(403);\n       });\n \n       test('POST does generate a new token in non-production environments for staff', async () => {\n         // Override deployment environment for this test\n-        mockDeploymentEnv = 'staging';\n+        mockDeploymentEnv = 'dev';\n         await fastifyTestInstance.prisma.user.update({\n           where: {\n             id: defaultUserId"
        },
        {
            "sha": "37e4ef5277d3c79e77dbf62722af447d0b648b59",
            "filename": "api/src/routes/protected/user.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3d78a31bc6285ed45156ad65f7846570b1ffba88/api%2Fsrc%2Froutes%2Fprotected%2Fuser.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3d78a31bc6285ed45156ad65f7846570b1ffba88/api%2Fsrc%2Froutes%2Fprotected%2Fuser.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fprotected%2Fuser.ts?ref=3d78a31bc6285ed45156ad65f7846570b1ffba88",
            "patch": "@@ -519,7 +519,7 @@ async function examEnvironmentTokenHandler(\n \n   // In non-production environments, only staff are allowed to generate a token\n   if (\n-    DEPLOYMENT_ENV !== 'production' &&\n+    DEPLOYMENT_ENV !== 'org' &&\n     (!req.user?.email?.endsWith('@freecodecamp.org') ||\n       !req.user?.emailVerified)\n   ) {"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 7,
        "deletions": 7
    }
}