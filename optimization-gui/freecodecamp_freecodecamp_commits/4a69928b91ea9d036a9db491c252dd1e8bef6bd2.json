{
    "author": "ojeytonwilliams",
    "message": "refactor: split ShowCertification into subcomponents (#59663)",
    "sha": "4a69928b91ea9d036a9db491c252dd1e8bef6bd2",
    "files": [
        {
            "sha": "5f8d6c9bd52575e8d2be891c994996f4d9030ac0",
            "filename": "client/src/client-only-routes/show-certification.tsx",
            "status": "modified",
            "additions": 172,
            "deletions": 124,
            "changes": 296,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/4a69928b91ea9d036a9db491c252dd1e8bef6bd2/client%2Fsrc%2Fclient-only-routes%2Fshow-certification.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/4a69928b91ea9d036a9db491c252dd1e8bef6bd2/client%2Fsrc%2Fclient-only-routes%2Fshow-certification.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fclient-only-routes%2Fshow-certification.tsx?ref=4a69928b91ea9d036a9db491c252dd1e8bef6bd2",
            "patch": "@@ -123,131 +123,30 @@ const mapDispatchToProps = (dispatch: Dispatch) =>\n     dispatch\n   );\n \n-const ShowCertification = (props: ShowCertificationProps): JSX.Element => {\n+const DonationCloseBtn = ({ onClick }: { onClick: () => void }) => {\n   const { t } = useTranslation();\n-  const [isDonationSubmitted, setIsDonationSubmitted] = useState(false);\n-  const [isDonationDisplayed, setIsDonationDisplayed] = useState(false);\n-  const [isDonationClosed, setIsDonationClosed] = useState(false);\n-\n-  useEffect(() => {\n-    const { username, certSlug, isValidCert, showCert } = props;\n-    if (isValidCert) {\n-      showCert({ username, certSlug });\n-    }\n-    // eslint-disable-next-line react-hooks/exhaustive-deps\n-  }, []);\n-\n-  useEffect(() => {\n-    const {\n-      userFetchState: { complete: userComplete },\n-      signedInUserName,\n-      isDonating,\n-      cert: { username = '' },\n-      fetchProfileForUser,\n-      user\n-    } = props;\n-\n-    if (!signedInUserName || signedInUserName !== username) {\n-      if (isEmpty(user) && username) {\n-        fetchProfileForUser(username);\n-      }\n-    }\n-\n-    if (\n-      !isDonationDisplayed &&\n-      userComplete &&\n-      signedInUserName &&\n-      signedInUserName === username &&\n-      !isDonating\n-    ) {\n-      setIsDonationDisplayed(true);\n-      callGA({\n-        event: 'donation_view',\n-        action: 'Displayed Certificate Donation'\n-      });\n-    }\n-    // eslint-disable-next-line react-hooks/exhaustive-deps\n-  }, [\n-    isDonationDisplayed,\n-    props.userFetchState,\n-    props.signedInUserName,\n-    props.isDonating,\n-    props.cert\n-  ]);\n \n-  const hideDonationSection = () => {\n-    setIsDonationDisplayed(false);\n-    setIsDonationClosed(true);\n-  };\n-\n-  const handleProcessing = () => {\n-    setIsDonationSubmitted(true);\n-  };\n-\n-  const {\n-    cert,\n-    fetchState,\n-    isValidCert,\n-    createFlashMessage,\n-    signedInUserName,\n-    location: { pathname }\n-  } = props;\n-  const { pending, complete, errored } = fetchState;\n-\n-  useEffect(() => {\n-    if (!isValidCert) {\n-      createFlashMessage(certificateMissingErrorMessage);\n-    } else if (!pending && errored) {\n-      createFlashMessage(standardErrorMessage);\n-    } else if (!pending && !complete && !errored) {\n-      createFlashMessage(reallyWeirdErrorMessage);\n-    }\n-  }, [isValidCert, createFlashMessage, pending, errored, complete]);\n-\n-  if (!isValidCert) {\n-    return <RedirectHome />;\n-  }\n-\n-  if (pending) {\n-    return <Loader fullScreen={true} />;\n-  }\n-\n-  if (errored || !complete) {\n-    return <RedirectHome />;\n-  }\n-\n-  const {\n-    date,\n-    name: userFullName = null,\n-    username,\n-    certTitle,\n-    certSlug,\n-    completionTime\n-  } = cert;\n-\n-  const { user } = props;\n-\n-  const displayName = userFullName ?? username;\n-\n-  const certDate = new Date(date);\n-  const certYear = certDate.getFullYear();\n-  const certMonth = certDate.getMonth();\n-  const certURL = `https://freecodecamp.org${pathname}`;\n-\n-  const donationCloseBtn = (\n+  return (\n     <div>\n-      <Button\n-        block={true}\n-        size='small'\n-        variant='primary'\n-        onClick={hideDonationSection}\n-      >\n+      <Button block={true} size='small' variant='primary' onClick={onClick}>\n         {t('buttons.close')}\n       </Button>\n     </div>\n   );\n+};\n \n-  const donationSection = (\n+const DonationSection = ({\n+  isDonationSubmitted,\n+  handleProcessing,\n+  hideDonationSection\n+}: {\n+  isDonationSubmitted: boolean;\n+  handleProcessing: () => void;\n+  hideDonationSection: () => void;\n+}) => {\n+  const { t } = useTranslation();\n+\n+  return (\n     <div\n       className='donation-section'\n       data-playwright-test-label='donation-section'\n@@ -282,17 +181,37 @@ const ShowCertification = (props: ShowCertificationProps): JSX.Element => {\n       <Spacer size='m' />\n       <Row>\n         <Col sm={4} smOffset={4} xs={6} xsOffset={3}>\n-          {isDonationSubmitted && donationCloseBtn}\n+          {isDonationSubmitted && (\n+            <DonationCloseBtn onClick={hideDonationSection} />\n+          )}\n         </Col>\n       </Row>\n       <Spacer size='l' />\n     </div>\n   );\n+};\n \n+const ShareCertBtns = ({\n+  username,\n+  certDate,\n+  certTitle,\n+  certSlug,\n+  certURL\n+}: {\n+  username: string;\n+  certDate: Date;\n+  certTitle: string;\n+  certSlug: CertSlug;\n+  certURL: string;\n+}) => {\n+  const { t } = useTranslation();\n+\n+  const certYear = certDate.getFullYear();\n+  const certMonth = certDate.getMonth();\n   const urlFriendlyCertTitle = encodeURIComponent(certTitle);\n   const linkedInCredentialId = `${username}-${linkedInCredentialIds[certSlug]}`;\n \n-  const shareCertBtns = (\n+  return (\n     <Row className='text-center'>\n       <Col xs={12}>\n         <Button\n@@ -314,7 +233,7 @@ const ShowCertification = (props: ShowCertificationProps): JSX.Element => {\n           variant='primary'\n           href={`https://twitter.com/intent/tweet?text=${t('profile.tweet', {\n             certTitle: urlFriendlyCertTitle,\n-            certURL: certURL\n+            certURL\n           })}`}\n           target='_blank'\n           data-playwright-test-label='twitter-share-btn'\n@@ -328,7 +247,7 @@ const ShowCertification = (props: ShowCertificationProps): JSX.Element => {\n           variant='primary'\n           href={`https://bsky.app/intent/compose?text=${t('profile.tweet', {\n             certTitle: urlFriendlyCertTitle,\n-            certURL: certURL\n+            certURL\n           })}`}\n           target='_blank'\n           data-playwright-test-label='bluesky-share-btn'\n@@ -342,7 +261,7 @@ const ShowCertification = (props: ShowCertificationProps): JSX.Element => {\n           variant='primary'\n           href={`https://threads.net/intent/post?text=${t('profile.tweet', {\n             certTitle: urlFriendlyCertTitle,\n-            certURL: certURL\n+            certURL\n           })}`}\n           target='_blank'\n           data-playwright-test-label='thread-share-btn'\n@@ -353,12 +272,131 @@ const ShowCertification = (props: ShowCertificationProps): JSX.Element => {\n       <Spacer size='l' />\n     </Row>\n   );\n+};\n+\n+const ShowCertification = (props: ShowCertificationProps): JSX.Element => {\n+  const { t } = useTranslation();\n+  const [isDonationSubmitted, setIsDonationSubmitted] = useState(false);\n+  const [isDonationDisplayed, setIsDonationDisplayed] = useState(false);\n+  const [isDonationClosed, setIsDonationClosed] = useState(false);\n+\n+  useEffect(() => {\n+    const { username, certSlug, isValidCert, showCert } = props;\n+    if (isValidCert) {\n+      showCert({ username, certSlug });\n+    }\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, []);\n+\n+  useEffect(() => {\n+    const {\n+      userFetchState: { complete: userComplete },\n+      signedInUserName,\n+      isDonating,\n+      cert: { username = '' },\n+      fetchProfileForUser,\n+      user\n+    } = props;\n+\n+    if (!signedInUserName || signedInUserName !== username) {\n+      if (isEmpty(user) && username) {\n+        fetchProfileForUser(username);\n+      }\n+    }\n+\n+    if (\n+      !isDonationDisplayed &&\n+      userComplete &&\n+      signedInUserName &&\n+      signedInUserName === username &&\n+      !isDonating\n+    ) {\n+      setIsDonationDisplayed(true);\n+      callGA({\n+        event: 'donation_view',\n+        action: 'Displayed Certificate Donation'\n+      });\n+    }\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, [\n+    isDonationDisplayed,\n+    props.userFetchState,\n+    props.signedInUserName,\n+    props.isDonating,\n+    props.cert\n+  ]);\n+\n+  const hideDonationSection = () => {\n+    setIsDonationDisplayed(false);\n+    setIsDonationClosed(true);\n+  };\n+\n+  const handleProcessing = () => {\n+    setIsDonationSubmitted(true);\n+  };\n+\n+  const {\n+    cert,\n+    fetchState,\n+    isValidCert,\n+    createFlashMessage,\n+    signedInUserName,\n+    location: { pathname }\n+  } = props;\n+  const { pending, complete, errored } = fetchState;\n+\n+  useEffect(() => {\n+    if (!isValidCert) {\n+      createFlashMessage(certificateMissingErrorMessage);\n+    } else if (!pending && errored) {\n+      createFlashMessage(standardErrorMessage);\n+    } else if (!pending && !complete && !errored) {\n+      createFlashMessage(reallyWeirdErrorMessage);\n+    }\n+  }, [isValidCert, createFlashMessage, pending, errored, complete]);\n+\n+  if (!isValidCert) {\n+    return <RedirectHome />;\n+  }\n+\n+  if (pending) {\n+    return <Loader fullScreen={true} />;\n+  }\n+\n+  if (errored || !complete) {\n+    return <RedirectHome />;\n+  }\n+\n+  const {\n+    date,\n+    name: userFullName = null,\n+    username,\n+    certTitle,\n+    certSlug,\n+    completionTime\n+  } = cert;\n+\n+  const { user } = props;\n+\n+  const displayName = userFullName ?? username;\n+\n+  const certDate = new Date(date);\n+\n+  const certURL = `https://freecodecamp.org${pathname}`;\n \n   const isMicrosoftCert = certSlug === Certification.FoundationalCSharp;\n \n   return (\n     <Container className='certificate-outer-wrapper'>\n-      {isDonationDisplayed && !isDonationClosed ? donationSection : ''}\n+      {isDonationDisplayed && !isDonationClosed ? (\n+        <DonationSection\n+          hideDonationSection={hideDonationSection}\n+          handleProcessing={handleProcessing}\n+          isDonationSubmitted={isDonationSubmitted}\n+        />\n+      ) : (\n+        ''\n+      )}\n       <div\n         className='certificate-wrapper'\n         data-playwright-test-label='cert-wrapper'\n@@ -511,7 +549,17 @@ const ShowCertification = (props: ShowCertificationProps): JSX.Element => {\n         data-playwright-test-label='cert-links'\n       >\n         <Spacer size='l' />\n-        {signedInUserName === username ? shareCertBtns : ''}\n+        {signedInUserName === username ? (\n+          <ShareCertBtns\n+            username={username}\n+            certDate={certDate}\n+            certSlug={certSlug}\n+            certTitle={certTitle}\n+            certURL={certURL}\n+          />\n+        ) : (\n+          ''\n+        )}\n         <Spacer size='l' />\n         <ShowProjectLinks certSlug={certSlug} name={displayName} user={user} />\n         <Spacer size='l' />"
        }
    ],
    "stats": {
        "total": 296,
        "additions": 172,
        "deletions": 124
    }
}