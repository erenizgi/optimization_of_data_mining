{
    "author": "vic-fb",
    "message": "fix(curriculum): avoid passing currency converter lab with wrong implementation (#62426)",
    "sha": "b6fff6e2b7dc7dbe48e40c5afc0367cc7f432554",
    "files": [
        {
            "sha": "e8ee79399369bcc33d4052e68e840504f26e38e0",
            "filename": "curriculum/challenges/english/blocks/lab-currency-converter/67eaa957114d373deb3a9149.md",
            "status": "modified",
            "additions": 31,
            "deletions": 40,
            "changes": 71,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b6fff6e2b7dc7dbe48e40c5afc0367cc7f432554/curriculum%2Fchallenges%2Fenglish%2Fblocks%2Flab-currency-converter%2F67eaa957114d373deb3a9149.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b6fff6e2b7dc7dbe48e40c5afc0367cc7f432554/curriculum%2Fchallenges%2Fenglish%2Fblocks%2Flab-currency-converter%2F67eaa957114d373deb3a9149.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fchallenges%2Fenglish%2Fblocks%2Flab-currency-converter%2F67eaa957114d373deb3a9149.md?ref=b6fff6e2b7dc7dbe48e40c5afc0367cc7f432554",
            "patch": "@@ -105,13 +105,7 @@ Changing the value of the first `select` element should cause the converted amou\n   const s = await __helpers.prepTestComponent(exports.CurrencyConverter);\n   const [first, _second] = s.querySelectorAll('select');\n   assert.exists(first);\n-  await React.act(async () => {\n-    // Find first option that is not selected\n-    const notSelected = [...first.options].find((o) => !o.selected);\n-    first.value = notSelected.value;\n-    const ev = new Event(\"change\", { bubbles: true, cancelable: false });\n-    first[Object.keys(first).find((k) => k.startsWith(\"__reactProps\"))].onChange({...ev, target: first});\n-  });\n+  await changeSelectValue(first);\n   assert.equal(abuseMemo.calls.length, 2);\n ```\n \n@@ -143,68 +137,59 @@ Changing the value of the second `select` element should not cause the converted\n   const s = await __helpers.prepTestComponent(exports.CurrencyConverter);\n   const [_first, second] = s.querySelectorAll('select');\n   assert.exists(second);\n-  await React.act(async () => {\n-    // Find first option that is not selected\n-    const notSelected = [...second.options].find((o) => !o.selected);\n-    second.value = notSelected.value;\n-    const ev = new Event(\"change\", { bubbles: true, cancelable: false });\n-    second[Object.keys(second).find((k) => k.startsWith(\"__reactProps\"))].onChange({...ev, target: second});\n-  });\n+  await changeSelectValue(second);\n   assert.equal(abuseMemo.calls.length, 1);\n ```\n \n-Changing the value of the first `select` element should cause a textual change on the page.\n+Changing the value of the first `select` element should display the new converted amount.\n \n ```js\n   const s = await __helpers.prepTestComponent(window.index.CurrencyConverter);\n \n   const nonFormContentBefore = getInnerTextExcept(s, \"input,select\");\n+  const resultBefore = nonFormContentBefore.match(/(\\d+\\.\\d{2})\\s*([A-Z]{3})/);\n \n   const [first, _second] = s.querySelectorAll('select');\n   assert.exists(first);\n-  await React.act(async () => {\n-    // Find first option that is not selected\n-    const notSelected = [...first.options].find((o) => !o.selected);\n-    first.value = notSelected.value;\n-    const ev = new Event(\"change\", { bubbles: true, cancelable: false });\n-    first[Object.keys(first).find((k) => k.startsWith(\"__reactProps\"))].onChange({...ev, target: first});\n-  });\n+  await changeSelectValue(first);\n \n   const nonFormContentAfter = getInnerTextExcept(s, \"input,select\");\n+  const resultAfter = nonFormContentAfter.match(/(\\d+\\.\\d{2})\\s*([A-Z]{3})/);\n \n   try {\n     assert.notEqual(nonFormContentBefore, nonFormContentAfter);\n+    assert.notEqual(resultBefore[1], resultAfter[1]);\n+    assert.strictEqual(resultBefore[2], resultAfter[2]);\n   } catch (e) {\n     console.error(e);\n     throw e;\n   }\n ```\n \n-Changing the value of the second `select` element should cause a textual change on the page.\n+Changing the value of the second `select` element should display the new converted amount and currency.\n \n ```js\n   const s = await __helpers.prepTestComponent(window.index.CurrencyConverter);\n \n   const nonFormContentBefore = getInnerTextExcept(s, \"input,select\");\n-\n+  const resultBefore = nonFormContentBefore.match(/(\\d+\\.\\d{2})\\s*([A-Z]{3})/);\n+  \n   const [_first, second] = s.querySelectorAll('select');\n   assert.exists(second);\n-  await React.act(async () => {\n-    // Find first option that is not selected\n-    const notSelected = [...second.options].find((o) => !o.selected);\n-    second.value = notSelected.value;\n-    const ev = new Event(\"change\", { bubbles: true, cancelable: false });\n-    second[Object.keys(second).find((k) => k.startsWith(\"__reactProps\"))].onChange({...ev, target: second});\n-  });\n+  await changeSelectValue(second);\n \n   const nonFormContentAfter = getInnerTextExcept(s, \"input,select\");\n+  const resultAfter = nonFormContentAfter.match(/(\\d+\\.\\d{2})\\s*([A-Z]{3})/);\n \n   try {\n     assert.notEqual(nonFormContentBefore, nonFormContentAfter);\n-  } catch (e) {\n-    console.error(e);\n-    throw e;\n-  }\n+    assert.notEqual(resultBefore[1], resultAfter[1]);\n+    assert.notEqual(resultBefore[2], resultAfter[2]);\n+    assert.strictEqual(resultAfter[2], second.value);\n+    } catch (e) {\n+      console.error(e);\n+      throw e;\n+    }\n ```\n \n The converted amount should be displayed in the format `XX.XX CCC`, where `XX.XX` is the converted amount rounded to two decimal places and `CCC` is the currency code.\n@@ -216,12 +201,8 @@ The converted amount should be displayed in the format `XX.XX CCC`, where `XX.XX\n   assert.exists(inp);\n   const [_first, second] = s.querySelectorAll('select');\n   assert.exists(second);\n+  await changeSelectValue(second);\n   await React.act(async () => {\n-    // Find first option that is not selected\n-    const notSelected = [...second.options].find((o) => !o.selected);\n-    second.value = notSelected.value;\n-    const ev = new Event(\"change\", { bubbles: true, cancelable: false });\n-    second[Object.keys(second).find((k) => k.startsWith(\"__reactProps\"))].onChange({...ev, target: second});\n     inp.value = 10;\n     const ev2 = new Event(\"change\", { bubbles: true, cancelable: false });\n     inp[Object.keys(inp).find((k) => k.startsWith(\"__reactProps\"))].onChange({...ev2, target: inp});\n@@ -298,6 +279,16 @@ function getInnerTextExcept(doc, removingSelector) {\n \n   return body.innerText;\n }\n+\n+const changeSelectValue = async (selectElement) => {\n+  await React.act(async () => {\n+    const notSelected = [...selectElement.options].find((o) => !o.selected);\n+    selectElement.value = notSelected.value;\n+    const ev = new Event(\"change\", { bubbles: true, cancelable: false });\n+    selectElement[Object.keys(selectElement).find((k) => k.startsWith(\"__reactProps\"))].onChange({...ev, target: selectElement});\n+  });\n+};\n+\n ```\n \n # --seed--"
        }
    ],
    "stats": {
        "total": 71,
        "additions": 31,
        "deletions": 40
    }
}