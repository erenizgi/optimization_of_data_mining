{
    "author": "leputz",
    "message": "fix(client): show more descriptive error message on fetchUserError (#64061)\n\nCo-authored-by: Huyen Nguyen <25715018+huyenltnguyen@users.noreply.github.com>",
    "sha": "5c3dd55406fa041891517ef7b4de5918f547c595",
    "files": [
        {
            "sha": "856f197b30cf1e585bcd10b190fa6e82c0166863",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5c3dd55406fa041891517ef7b4de5918f547c595/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5c3dd55406fa041891517ef7b4de5918f547c595/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=5c3dd55406fa041891517ef7b4de5918f547c595",
            "patch": "@@ -1083,7 +1083,8 @@\n       \"err-3\": \"Something went wrong trying to save your survey.\",\n       \"success\": \"Thank you. Your survey was submitted.\"\n     },\n-    \"classroom-mode-updated\": \"We have updated your classroom mode settings\"\n+    \"classroom-mode-updated\": \"We have updated your classroom mode settings\",\n+    \"user-fetch-error\": \"Unable to retrieve your user information. You can still use the site, but your progress may not be saved.\"\n   },\n   \"validation\": {\n     \"max-characters\": \"There is a maximum limit of 288 characters, you have {{charsLeft}} left\","
        },
        {
            "sha": "dfd6751708a04f8058330ea557cede490fc006ca",
            "filename": "client/src/components/Flash/redux/flash-messages.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5c3dd55406fa041891517ef7b4de5918f547c595/client%2Fsrc%2Fcomponents%2FFlash%2Fredux%2Fflash-messages.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5c3dd55406fa041891517ef7b4de5918f547c595/client%2Fsrc%2Fcomponents%2FFlash%2Fredux%2Fflash-messages.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FFlash%2Fredux%2Fflash-messages.ts?ref=5c3dd55406fa041891517ef7b4de5918f547c595",
            "patch": "@@ -16,6 +16,7 @@ export enum FlashMessages {\n   CourseUrlCopyError = 'flash.course-url-copy-error',\n   DeleteTokenErr = 'flash.delete-token-err',\n   EmailValid = 'flash.email-valid',\n+  UserFetchError = 'flash.user-fetch-error',\n   GenerateExamError = 'flash.generate-exam-error',\n   HonestFirst = 'flash.honest-first',\n   IncompleteSteps = 'flash.incomplete-steps',"
        },
        {
            "sha": "a8755bf243edfb18181489717d8e602fa337937f",
            "filename": "client/src/redux/fetch-user-saga.js",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5c3dd55406fa041891517ef7b4de5918f547c595/client%2Fsrc%2Fredux%2Ffetch-user-saga.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5c3dd55406fa041891517ef7b4de5918f547c595/client%2Fsrc%2Fredux%2Ffetch-user-saga.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Ffetch-user-saga.js?ref=5c3dd55406fa041891517ef7b4de5918f547c595",
            "patch": "@@ -1,5 +1,7 @@\n import { call, cancel, delay, fork, put, takeEvery } from 'redux-saga/effects';\n import { getSessionUser, getUserProfile } from '../utils/ajax';\n+import { wrapHandledError } from '../utils/handled-error';\n+import { UserFetchErrorMessage } from '../utils/error-messages';\n import {\n   fetchProfileForUserComplete,\n   fetchProfileForUserError,\n@@ -33,7 +35,8 @@ function* fetchSessionUser() {\n     yield put(fetchUserComplete({ user }));\n   } catch (e) {\n     console.log('failed to fetch user', e);\n-    yield put(fetchUserError(e));\n+    const handledError = wrapHandledError(e, UserFetchErrorMessage);\n+    yield put(fetchUserError(handledError));\n   } finally {\n     yield cancel(timeoutTask);\n   }"
        },
        {
            "sha": "31e1cc1d40119837536ab560acc042dcaac139ab",
            "filename": "client/src/utils/error-messages.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5c3dd55406fa041891517ef7b4de5918f547c595/client%2Fsrc%2Futils%2Ferror-messages.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5c3dd55406fa041891517ef7b4de5918f547c595/client%2Fsrc%2Futils%2Ferror-messages.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Ferror-messages.ts?ref=5c3dd55406fa041891517ef7b4de5918f547c595",
            "patch": "@@ -24,3 +24,8 @@ export const msTrophyVerified = {\n   type: 'success',\n   message: FlashMessages.MsTrophyVerified\n };\n+\n+export const UserFetchErrorMessage = {\n+  type: 'danger',\n+  message: FlashMessages.UserFetchError\n+};"
        },
        {
            "sha": "5c9023c01429e98c5b4f8248d6a653f8fcc40fa4",
            "filename": "client/src/utils/tone/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5c3dd55406fa041891517ef7b4de5918f547c595/client%2Fsrc%2Futils%2Ftone%2Findex.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5c3dd55406fa041891517ef7b4de5918f547c595/client%2Fsrc%2Futils%2Ftone%2Findex.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Ftone%2Findex.ts?ref=5c3dd55406fa041891517ef7b4de5918f547c595",
            "patch": "@@ -89,7 +89,8 @@ const toneUrls = {\n   [FlashMessages.UserTokenGenerateError]: TRY_AGAIN,\n   [FlashMessages.WrongName]: TRY_AGAIN,\n   [FlashMessages.WrongUpdating]: TRY_AGAIN,\n-  [FlashMessages.WentWrong]: TRY_AGAIN\n+  [FlashMessages.WentWrong]: TRY_AGAIN,\n+  [FlashMessages.UserFetchError]: TRY_AGAIN\n } as const;\n \n type ToneStates = keyof typeof toneUrls;"
        },
        {
            "sha": "ffb5046a97a50af097435ba0ba72ab6afe50103b",
            "filename": "e2e/flash.spec.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 4,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5c3dd55406fa041891517ef7b4de5918f547c595/e2e%2Fflash.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5c3dd55406fa041891517ef7b4de5918f547c595/e2e%2Fflash.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fflash.spec.ts?ref=5c3dd55406fa041891517ef7b4de5918f547c595",
            "patch": "@@ -1,10 +1,6 @@\n import { test, expect, type Page } from '@playwright/test';\n import translations from '../client/i18n/locales/english/translations.json';\n \n-test.beforeEach(async ({ page }) => {\n-  await page.goto('/settings');\n-});\n-\n const checkFlashMessageVisibility = async (page: Page, translation: string) => {\n   const flashMessage = page.getByText(translation);\n   await expect(flashMessage).toBeVisible();\n@@ -15,6 +11,8 @@ const checkFlashMessageVisibility = async (page: Page, translation: string) => {\n \n test.describe('Flash Message component E2E test', () => {\n   test('Flash Message Visibility for Night Mode Toggle', async ({ page }) => {\n+    await page.goto('/settings');\n+\n     await page\n       .getByRole('button', { name: translations.buttons.menu, exact: true })\n       .click();\n@@ -31,6 +29,8 @@ test.describe('Flash Message component E2E test', () => {\n   });\n \n   test('Flash Message Visibility for Sound Mode Toggle', async ({ page }) => {\n+    await page.goto('/settings');\n+\n     await page\n       .getByLabel(translations.settings.labels['sound-mode'])\n       .getByRole('button', { name: translations.buttons.on })\n@@ -40,4 +40,17 @@ test.describe('Flash Message component E2E test', () => {\n       translations.flash['updated-sound']\n     );\n   });\n+\n+  test('should be visible when a network error occurs', async ({ page }) => {\n+    await page.route(\n+      '*/**/user/get-session-user',\n+      async route => await route.fulfill({ status: 500 })\n+    );\n+\n+    await page.goto('/');\n+    await checkFlashMessageVisibility(\n+      page,\n+      translations.flash['user-fetch-error']\n+    );\n+  });\n });"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 31,
        "deletions": 7
    }
}