{
    "author": "ojeytonwilliams",
    "message": "chore: validate block-superblock relationship (#62126)",
    "sha": "97f759a8b78c9486e9d27aff415db715e44a44b8",
    "files": [
        {
            "sha": "15dcd7e0e4bcdafff800471a593f2439642157c2",
            "filename": "curriculum/build-curriculum.js",
            "status": "modified",
            "additions": 38,
            "deletions": 3,
            "changes": 41,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/97f759a8b78c9486e9d27aff415db715e44a44b8/curriculum%2Fbuild-curriculum.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/97f759a8b78c9486e9d27aff415db715e44a44b8/curriculum%2Fbuild-curriculum.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fbuild-curriculum.js?ref=97f759a8b78c9486e9d27aff415db715e44a44b8",
            "patch": "@@ -17,7 +17,8 @@ const {\n   getLanguageConfig,\n   getCurriculumStructure,\n   getBlockStructure,\n-  getSuperblockStructure\n+  getSuperblockStructure,\n+  getBlockStructurePath\n } = require('./file-handler');\n \n /**\n@@ -206,7 +207,10 @@ const superBlockToFilename = Object.entries(superBlockNames).reduce(\n  * @returns {Array<Object>} Array of superblock structure objects with filename, name, and blocks\n  * @throws {Error} When a superblock file is not found\n  */\n-function addSuperblockStructure(superblocks) {\n+function addSuperblockStructure(\n+  superblocks,\n+  showComingSoon = process.env.SHOW_UPCOMING_CHANGES === 'true'\n+) {\n   debug(`Building structure for ${superblocks.length} superblocks`);\n \n   const superblockStructures = superblocks.map(superblockFilename => {\n@@ -218,7 +222,7 @@ function addSuperblockStructure(superblocks) {\n     return {\n       name: superblockName,\n       blocks: transformSuperBlock(getSuperblockStructure(superblockFilename), {\n-        showComingSoon: process.env.SHOW_UPCOMING_CHANGES === 'true'\n+        showComingSoon\n       })\n     };\n   });\n@@ -263,8 +267,36 @@ function getSuperblocks(\n     .map(({ name }) => name);\n }\n \n+function validateBlocks(superblocks, blockStructureDir) {\n+  const withSuperblockStructure = addSuperblockStructure(superblocks, true);\n+  const blockInSuperblocks = withSuperblockStructure\n+    .flatMap(({ blocks }) => blocks)\n+    .map(b => b.dashedName);\n+  for (const block of blockInSuperblocks) {\n+    const blockPath = getBlockStructurePath(block);\n+    if (!fs.existsSync(blockPath)) {\n+      throw Error(\n+        `Block \"${block}\" is in a superblock, but has no block structure file at ${blockPath}`\n+      );\n+    }\n+  }\n+\n+  const blockStructureFiles = fs\n+    .readdirSync(blockStructureDir)\n+    .map(file => path.basename(file, '.json'));\n+\n+  for (const block of blockStructureFiles) {\n+    if (!blockInSuperblocks.includes(block)) {\n+      throw Error(\n+        `Block \"${block}\" has a structure file, ${getBlockStructurePath(block)}, but is not in a superblock`\n+      );\n+    }\n+  }\n+}\n+\n async function buildCurriculum(lang, filters) {\n   const contentDir = getContentDir(lang);\n+  const blockStructureDir = getLanguageConfig(lang).blockStructureDir;\n   const builder = new SuperblockCreator({\n     blockCreator: getBlockCreator(lang, !isEmpty(filters))\n   });\n@@ -277,9 +309,12 @@ async function buildCurriculum(lang, filters) {\n   debug(`Found ${curriculum.superblocks.length} superblocks to build`);\n   debug(`Found ${curriculum.certifications.length} certifications to build`);\n \n+  validateBlocks(curriculum.superblocks, blockStructureDir);\n+\n   const superblockList = addBlockStructure(\n     addSuperblockStructure(curriculum.superblocks)\n   );\n+\n   const fullSuperblockList = applyFilters(superblockList, filters);\n   const fullCurriculum = { certifications: { blocks: {} } };\n "
        },
        {
            "sha": "290adf144aae1ff1ab933df42e5a150603e83183",
            "filename": "curriculum/file-handler.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/97f759a8b78c9486e9d27aff415db715e44a44b8/curriculum%2Ffile-handler.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/97f759a8b78c9486e9d27aff415db715e44a44b8/curriculum%2Ffile-handler.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Ffile-handler.js?ref=97f759a8b78c9486e9d27aff415db715e44a44b8",
            "patch": "@@ -198,6 +198,7 @@ function getLanguageConfig(\n exports.getContentConfig = getContentConfig;\n exports.getContentDir = getContentDir;\n exports.getBlockStructure = getBlockStructure;\n+exports.getBlockStructurePath = getBlockStructurePath;\n exports.getSuperblockStructure = getSuperblockStructure;\n exports.getCurriculumStructure = getCurriculumStructure;\n exports.writeBlockStructure = writeBlockStructure;"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 39,
        "deletions": 3
    }
}