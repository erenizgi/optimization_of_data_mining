{
    "author": "ojeytonwilliams",
    "message": "refactor(e2e): create editor helpers (#54701)",
    "sha": "ca4e5db8b1bfa5daa70da09e0c79d63e5578286b",
    "files": [
        {
            "sha": "64ef7a8be98f9455f874a5d3e89d57f731cdebcc",
            "filename": "e2e/code-storage.spec.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Fcode-storage.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Fcode-storage.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fcode-storage.spec.ts?ref=ca4e5db8b1bfa5daa70da09e0c79d63e5578286b",
            "patch": "@@ -1,12 +1,15 @@\n import { test, expect } from '@playwright/test';\n+\n+import { getEditors } from './utils/editor';\n+\n test.use({ storageState: 'playwright/.auth/certified-user.json' });\n test.describe('Challenge with editor', function () {\n   test('the shortcut \"Ctrl + S\" saves the code', async ({ page }) => {\n     await page.goto(\n       '/learn/2022/responsive-web-design/learn-html-by-building-a-cat-photo-app/step-2'\n     );\n \n-    const editor = page.locator('textarea');\n+    const editor = getEditors(page);\n \n     await editor.fill('Something funny');\n     await page.keyboard.down('Control');"
        },
        {
            "sha": "a2e75e64de304e97567e9dddb472d30fbd605f89",
            "filename": "e2e/editor.spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 30,
            "changes": 33,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Feditor.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Feditor.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Feditor.spec.ts?ref=ca4e5db8b1bfa5daa70da09e0c79d63e5578286b",
            "patch": "@@ -1,26 +1,6 @@\n-import { expect, test, type Page } from '@playwright/test';\n+import { expect, test } from '@playwright/test';\n \n-async function focusEditor({\n-  page,\n-  isMobile,\n-  browserName\n-}: {\n-  page: Page;\n-  isMobile: boolean;\n-  browserName: string;\n-}) {\n-  const monacoEditor = page.getByLabel('Editor content');\n-\n-  // The editor has an overlay div, which prevents the click event from bubbling up in iOS Safari.\n-  // This is a quirk in this browser-OS combination, and the workaround here is to use `.focus()`\n-  // in place of `.click()` to focus on the editor.\n-  // Ref: https://www.quirksmode.org/blog/archives/2014/02/mouse_event_bub.html\n-  if (isMobile && browserName === 'webkit') {\n-    await monacoEditor.focus();\n-  } else {\n-    await monacoEditor.click();\n-  }\n-}\n+import { clearEditor, focusEditor } from './utils/editor';\n \n test.describe('Editor Component', () => {\n   test('should allow the user to insert text', async ({\n@@ -50,14 +30,7 @@ test.describe('Python Terminal', () => {\n     );\n \n     await focusEditor({ page, isMobile, browserName });\n-    // First clear the editor\n-    // TODO: replace with ControlOrMeta when it's supported\n-    if (browserName === 'webkit') {\n-      await page.keyboard.press('Meta+a');\n-    } else {\n-      await page.keyboard.press('Control+a');\n-    }\n-    await page.keyboard.press('Backspace');\n+    await clearEditor({ page, browserName });\n     // Then enter invalid code\n     await page.keyboard.insertText('def');\n     const preview = page.getByTestId('preview-pane');"
        },
        {
            "sha": "b17016eefd0e07157578185d63364b7880920a53",
            "filename": "e2e/hotkeys.spec.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Fhotkeys.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Fhotkeys.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fhotkeys.spec.ts?ref=ca4e5db8b1bfa5daa70da09e0c79d63e5578286b",
            "patch": "@@ -2,11 +2,10 @@ import { test, expect } from '@playwright/test';\n \n import translations from '../client/i18n/locales/english/translations.json';\n import { authedPut } from './utils/request';\n+import { getEditors } from './utils/editor';\n \n const course =\n   '/learn/javascript-algorithms-and-data-structures/basic-javascript/comment-your-javascript-code';\n-const editorPaneLabel =\n-  'Editor content;Press Alt+F1 for Accessibility Options.';\n \n test.use({ storageState: 'playwright/.auth/certified-user.json' });\n \n@@ -41,9 +40,9 @@ test('User can interact with the app using the keyboard', async ({ page }) => {\n \n   await page.goto(course);\n \n-  await expect(page.getByLabel(editorPaneLabel)).toBeFocused();\n-  await page.getByLabel(editorPaneLabel).press('Escape');\n-  await expect(page.getByLabel(editorPaneLabel)).not.toBeFocused();\n+  await expect(getEditors(page)).toBeFocused();\n+  await getEditors(page).press('Escape');\n+  await expect(getEditors(page)).not.toBeFocused();\n \n   await page.keyboard.press('n');\n   const nextCourse = '**/declare-javascript-variables';\n@@ -62,7 +61,7 @@ test('User can interact with the app using the keyboard', async ({ page }) => {\n   ).toBeVisible();\n \n   await page.keyboard.press('e');\n-  await expect(page.getByLabel(editorPaneLabel)).toBeFocused();\n+  await expect(getEditors(page)).toBeFocused();\n \n   await page.keyboard.press('Control+Enter');\n   await expect(page.getByText('running test')).toBeVisible();"
        },
        {
            "sha": "8fbeb117baaadf8cded59a010aa241134efe2aa7",
            "filename": "e2e/multifile-editor.spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Fmultifile-editor.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Fmultifile-editor.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fmultifile-editor.spec.ts?ref=ca4e5db8b1bfa5daa70da09e0c79d63e5578286b",
            "patch": "@@ -1,5 +1,7 @@\n import { test, expect } from '@playwright/test';\n \n+import { getEditors } from './utils/editor';\n+\n test.beforeEach(async ({ page }) => {\n   await page.goto(\n     '/learn/2022/responsive-web-design/learn-basic-css-by-building-a-cafe-menu/step-15'\n@@ -21,7 +23,7 @@ test.describe('MultifileEditor Component', () => {\n     // before moving onto other assertions.\n     // Note that using the `.all()` locator here would result a flaky test.\n     // Ref: https://github.com/freeCodeCamp/freeCodeCamp/pull/53031/files#r1500316812\n-    const editors = page.getByLabel('Editor content');\n+    const editors = getEditors(page);\n     await expect(editors).toHaveCount(2);\n \n     const test_string = 'TestString';"
        },
        {
            "sha": "9d43ef295143169ca98b3403313e312aba49c3ae",
            "filename": "e2e/output.spec.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Foutput.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Foutput.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Foutput.spec.ts?ref=ca4e5db8b1bfa5daa70da09e0c79d63e5578286b",
            "patch": "@@ -1,5 +1,7 @@\n import { test, expect, type Page } from '@playwright/test';\n+\n import translations from '../client/i18n/locales/english/translations.json';\n+import { getEditors } from './utils/editor';\n \n const outputTexts = {\n   default: `\n@@ -33,7 +35,7 @@ const insertTextInCodeEditor = async ({\n       .getByRole('tab', { name: translations.learn['editor-tabs'].code })\n       .click();\n   }\n-  await page.getByLabel('Editor content').fill(text);\n+  await getEditors(page).fill(text);\n   if (isMobile) {\n     await page\n       .getByRole('tab', { name: translations.learn['editor-tabs'].console })"
        },
        {
            "sha": "30203df1dce2cc9c7ace9fc887441e71d822ffba",
            "filename": "e2e/preview.spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 9,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Fpreview.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Fpreview.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fpreview.spec.ts?ref=ca4e5db8b1bfa5daa70da09e0c79d63e5578286b",
            "patch": "@@ -1,5 +1,6 @@\n import { expect, test } from '@playwright/test';\n import translations from '../client/i18n/locales/english/translations.json';\n+import { focusEditor } from './utils/editor';\n \n test.beforeEach(async ({ page }) => {\n   await page.goto(\n@@ -30,15 +31,7 @@ test.describe('Challenge Preview Component', () => {\n     browserName,\n     isMobile\n   }) => {\n-    // The editor has an overlay div, which prevents the click event from bubbling up in iOS Safari.\n-    // This is a quirk in this browser-OS combination, and the workaround here is to use `.focus()`\n-    // in place of `.click()` to focus on the editor.\n-    // Ref: https://www.quirksmode.org/blog/archives/2014/02/mouse_event_bub.html\n-    if (isMobile && browserName === 'webkit') {\n-      await page.getByLabel('Editor content').focus();\n-    } else {\n-      await page.getByLabel('Editor content').click();\n-    }\n+    await focusEditor({ page, isMobile, browserName });\n \n     await page.keyboard.insertText('<h1>FreeCodeCamp</h1>');\n     if (isMobile) {"
        },
        {
            "sha": "cc9ef86aa86354f24eeca72b4d969a2b0b619273",
            "filename": "e2e/progress-bar.spec.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 22,
            "changes": 39,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Fprogress-bar.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Fprogress-bar.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fprogress-bar.spec.ts?ref=ca4e5db8b1bfa5daa70da09e0c79d63e5578286b",
            "patch": "@@ -1,26 +1,25 @@\n import { expect, test } from '@playwright/test';\n+import { clearEditor, focusEditor } from './utils/editor';\n+\n test.use({ storageState: 'playwright/.auth/certified-user.json' });\n \n test.describe('Progress bar component', () => {\n   test('Should appear with the correct content after the user has submitted their code', async ({\n-    page\n+    page,\n+    isMobile,\n+    browserName\n   }) => {\n     await page.goto(\n-      '/learn/2022/responsive-web-design/learn-html-by-building-a-cat-photo-app/step-2'\n+      '/learn/2022/responsive-web-design/learn-html-by-building-a-cat-photo-app/step-3'\n     );\n-\n-    const monacoEditor = page.getByLabel('Editor content');\n-\n-    // Using focus instead of click since we're not testing if the editor\n-    // behaves correctly, we're using it to complete the challenge.\n-    await monacoEditor.focus();\n-    await page.keyboard.press('Control+A');\n-    //Meta + A works in webkit\n-    await page.keyboard.press('Meta+A');\n-    await page.keyboard.press('Backspace');\n+    // If focusEditor fails, typically it's because the instructions are too\n+    // large. There's a bug that means `scrollIntoView` does not work in the\n+    // editor and so we have to pick less verbose challenges until that's fixed.\n+    await focusEditor({ page, isMobile, browserName });\n+    await clearEditor({ page, browserName });\n \n     await page.keyboard.insertText(\n-      '<html><body><h1>CatPhotoApp</h1><h2>Cat Photos</h2></body></html>'\n+      '<html><body><h1>CatPhotoApp</h1><h2>Cat Photos</h2><p>See more cat photos in our gallery.</p></body></html>'\n     );\n \n     await page.getByRole('button', { name: 'Check Your Code' }).click();\n@@ -36,19 +35,15 @@ test.describe('Progress bar component', () => {\n   });\n \n   test('should appear in the completion modal after user has submitted their code', async ({\n-    page\n+    page,\n+    isMobile,\n+    browserName\n   }) => {\n     await page.goto(\n       '/learn/javascript-algorithms-and-data-structures/basic-javascript/declare-javascript-variables'\n     );\n-\n-    const monacoEditor = page.getByLabel('Editor content');\n-    await monacoEditor.focus();\n-\n-    await page.keyboard.press('Control+A');\n-\n-    await page.keyboard.press('Meta+A');\n-    await page.keyboard.press('Backspace');\n+    await focusEditor({ page, isMobile, browserName });\n+    await clearEditor({ page, browserName });\n \n     await page.keyboard.insertText('var myName;');\n "
        },
        {
            "sha": "7e37f0eca487c2e8ef6598477012304552692dac",
            "filename": "e2e/reset-modal.spec.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 9,
            "changes": 15,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Freset-modal.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Freset-modal.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Freset-modal.spec.ts?ref=ca4e5db8b1bfa5daa70da09e0c79d63e5578286b",
            "patch": "@@ -1,6 +1,7 @@\n import { test, expect } from '@playwright/test';\n \n import translations from '../client/i18n/locales/english/translations.json';\n+import { clearEditor, focusEditor, getEditors } from './utils/editor';\n \n test('should render the modal content correctly', async ({ page }) => {\n   await page.goto(\n@@ -36,7 +37,7 @@ test('should render the modal content correctly', async ({ page }) => {\n   ).toBeVisible();\n });\n \n-test('User can reset challenge', async ({ page }) => {\n+test('User can reset challenge', async ({ page, isMobile, browserName }) => {\n   const initialText = 'CatPhotoApp';\n   const initialFrame = page\n     .frameLocator('iframe[title=\"challenge preview\"]')\n@@ -54,13 +55,11 @@ test('User can reset challenge', async ({ page }) => {\n   // Building the preview can take a while\n   await expect(initialFrame).toBeVisible({ timeout: 10000 });\n \n-  const editorPaneLabel =\n-    'Editor content;Press Alt+F1 for Accessibility Options.';\n-\n   // Modify the text in the editor pane, clearing first, otherwise the existing\n   // text will be selected before typing\n-  await page.getByLabel(editorPaneLabel).fill('');\n-  await page.getByLabel(editorPaneLabel).fill(updatedText);\n+  await focusEditor({ page, isMobile, browserName });\n+  await clearEditor({ page, browserName });\n+  await getEditors(page).fill(updatedText);\n   await expect(updatedFrame).toBeVisible({ timeout: 10000 });\n \n   // Run the tests so the lower jaw updates (later we confirm that the update\n@@ -95,11 +94,9 @@ test('User can reset classic challenge', async ({ page, isMobile }) => {\n     '/learn/javascript-algorithms-and-data-structures/basic-javascript/comment-your-javascript-code'\n   );\n \n-  const editorPaneLabel =\n-    'Editor content;Press Alt+F1 for Accessibility Options.';\n   const challengeSolution = '// This is in-line comment';\n \n-  await page.getByLabel(editorPaneLabel).fill(challengeSolution);\n+  await getEditors(page).fill(challengeSolution);\n \n   const submitButton = page.getByRole('button', {\n     name: isMobile ? translations.buttons.run : translations.buttons['run-test']"
        },
        {
            "sha": "7df65f74c902eb80a106cfa8498f4c506455d4c6",
            "filename": "e2e/shortcuts-modal.spec.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Fshortcuts-modal.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Fshortcuts-modal.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fshortcuts-modal.spec.ts?ref=ca4e5db8b1bfa5daa70da09e0c79d63e5578286b",
            "patch": "@@ -2,11 +2,10 @@ import { APIRequestContext, Page, expect, test } from '@playwright/test';\n \n import translations from '../client/i18n/locales/english/translations.json';\n import { authedPut } from './utils/request';\n+import { getEditors } from './utils/editor';\n \n const course =\n   '/learn/javascript-algorithms-and-data-structures/basic-javascript/comment-your-javascript-code';\n-const editorPaneLabel =\n-  'Editor content;Press Alt+F1 for Accessibility Options.';\n \n test.use({ storageState: 'playwright/.auth/certified-user.json' });\n \n@@ -23,7 +22,7 @@ const enableKeyboardShortcuts = async (request: APIRequestContext) => {\n const openModal = async (page: Page) => {\n   // The editor pane is focused by default, so we need to escape or it will\n   // capture the keyboard shortcuts\n-  await page.getByLabel(editorPaneLabel).press('Escape');\n+  await getEditors(page).press('Escape');\n   await page.keyboard.press('Shift+?');\n };\n "
        },
        {
            "sha": "17b8a09f2d0de03a2c8e531d23bdc5f23ef99676",
            "filename": "e2e/utils/editor.ts",
            "status": "added",
            "additions": 48,
            "deletions": 0,
            "changes": 48,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Futils%2Feditor.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ca4e5db8b1bfa5daa70da09e0c79d63e5578286b/e2e%2Futils%2Feditor.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Futils%2Feditor.ts?ref=ca4e5db8b1bfa5daa70da09e0c79d63e5578286b",
            "patch": "@@ -0,0 +1,48 @@\n+import { type Page } from '@playwright/test';\n+\n+/**\n+ * Retrieves any editor elements on the page.\n+ * @param page - The Playwright page object.\n+ * @returns The editor elements.\n+ */\n+export function getEditors(page: Page) {\n+  return page.getByLabel(\n+    'Editor content;Press Alt+F1 for Accessibility Options'\n+  );\n+}\n+\n+export async function focusEditor({\n+  page,\n+  isMobile,\n+  browserName\n+}: {\n+  page: Page;\n+  isMobile: boolean;\n+  browserName: string;\n+}) {\n+  // The editor has an overlay div, which prevents the click event from bubbling up in iOS Safari.\n+  // This is a quirk in this browser-OS combination, and the workaround here is to use `.focus()`\n+  // in place of `.click()` to focus on the editor.\n+  // Ref: https://www.quirksmode.org/blog/archives/2014/02/mouse_event_bub.html\n+  if (isMobile && browserName === 'webkit') {\n+    await getEditors(page).focus();\n+  } else {\n+    await getEditors(page).click();\n+  }\n+}\n+\n+export async function clearEditor({\n+  page,\n+  browserName\n+}: {\n+  page: Page;\n+  browserName: string;\n+}) {\n+  // TODO: replace with ControlOrMeta when it's supported\n+  if (browserName === 'webkit') {\n+    await page.keyboard.press('Meta+a');\n+  } else {\n+    await page.keyboard.press('Control+a');\n+  }\n+  await page.keyboard.press('Backspace');\n+}"
        }
    ],
    "stats": {
        "total": 175,
        "additions": 93,
        "deletions": 82
    }
}