{
    "author": "Sembauke",
    "message": "feat: convert navbar test to Playwright (#55034)\n\nCo-authored-by: Huyen Nguyen <25715018+huyenltnguyen@users.noreply.github.com>",
    "sha": "05a962b6a9380d0006541e171c84abe88c26d7e9",
    "files": [
        {
            "sha": "b87fe2d8c5e4731cdb4f20251f2ba2deefd6f9b2",
            "filename": "cypress/e2e/default/learn/common-components/navbar.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 61,
            "changes": 61,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/eee82c690b45f2f9b6d7b3d7d277ed8e9b8b3140/cypress%2Fe2e%2Fdefault%2Flearn%2Fcommon-components%2Fnavbar.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/eee82c690b45f2f9b6d7b3d7d277ed8e9b8b3140/cypress%2Fe2e%2Fdefault%2Flearn%2Fcommon-components%2Fnavbar.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/cypress%2Fe2e%2Fdefault%2Flearn%2Fcommon-components%2Fnavbar.ts?ref=eee82c690b45f2f9b6d7b3d7d277ed8e9b8b3140",
            "patch": "@@ -1,61 +0,0 @@\n-const navBarselectors = {\n-  heading: \"[data-test-label='landing-header']\",\n-  smallCallToAction: \"[data-test-label='landing-small-cta']\",\n-  navigationLinks: '.nav-list',\n-  avatarContainer: '.avatar-container',\n-  defaultAvatar: '.avatar-container',\n-  menuButton: '#toggle-button-nav',\n-  avatarImage: '.avatar-container .avatar'\n-};\n-\n-describe('Navbar when logged out', () => {\n-  it('should have the sign in button on landing and /learn', () => {\n-    cy.visit('/');\n-\n-    cy.contains(navBarselectors.smallCallToAction, 'Sign in');\n-\n-    cy.visit('/learn');\n-    cy.contains(navBarselectors.smallCallToAction, 'Sign in');\n-  });\n-});\n-\n-describe('Navbar Logged in', () => {\n-  beforeEach(() => {\n-    cy.login();\n-    cy.visit('/');\n-  });\n-\n-  it('Should render properly', () => {\n-    cy.get('#universal-nav').should('be.visible');\n-    cy.get('#universal-nav').should('have.class', 'universal-nav');\n-  });\n-\n-  it(\n-    'Should take user to learn page when clicked on ' + 'the freeCodeCamp logo',\n-    () => {\n-      cy.get('#universal-nav-logo').within(() => {\n-        cy.get('svg').click();\n-      });\n-      cy.url().should('include', '/learn');\n-    }\n-  );\n-\n-  it('Should have `Profile` link when user is signed in', () => {\n-    cy.get(navBarselectors.menuButton).click();\n-    cy.get(navBarselectors.navigationLinks).contains('Profile').click();\n-    cy.url().should('include', '/developmentuser');\n-  });\n-\n-  it('Should have a profile image with class `default-border`', () => {\n-    cy.get(navBarselectors.avatarContainer).should(\n-      'have.class',\n-      'default-border'\n-    );\n-    cy.get(navBarselectors.defaultAvatar).should('exist');\n-  });\n-\n-  it('Should have a profile image with dimensions that are <= 26px', () => {\n-    cy.get(navBarselectors.avatarImage).invoke('width').should('lte', 26);\n-    cy.get(navBarselectors.avatarImage).invoke('height').should('lte', 26);\n-  });\n-});"
        },
        {
            "sha": "3bc8493d51c798487587e6386eb3306bca4a0eb2",
            "filename": "e2e/header.spec.ts",
            "status": "modified",
            "additions": 244,
            "deletions": 201,
            "changes": 445,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/05a962b6a9380d0006541e171c84abe88c26d7e9/e2e%2Fheader.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/05a962b6a9380d0006541e171c84abe88c26d7e9/e2e%2Fheader.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fheader.spec.ts?ref=05a962b6a9380d0006541e171c84abe88c26d7e9",
            "patch": "@@ -1,3 +1,4 @@\n+import { execSync } from 'child_process';\n import { test, expect } from '@playwright/test';\n import translations from '../client/i18n/locales/english/translations.json';\n import { availableLangs, hiddenLangs, LangNames } from '../shared/config/i18n';\n@@ -20,236 +21,278 @@ const headerComponentElements = {\n const examUrl =\n   '/learn/foundational-c-sharp-with-microsoft/foundational-c-sharp-with-microsoft-certification-exam/foundational-c-sharp-with-microsoft-certification-exam';\n \n-test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+test.describe('Header', () => {\n+  test.use({ storageState: 'playwright/.auth/development-user.json' });\n \n-test.beforeEach(async ({ page }) => {\n-  await page.goto('/');\n-});\n-\n-test('Has link for skip content', async ({ page }) => {\n-  const skipContent = page.getByTestId(headerComponentElements.skipContent);\n-  await expect(skipContent).toBeVisible();\n-  await expect(skipContent).toHaveAttribute('href', '#content-start');\n-});\n-\n-test('Renders universal nav by default', async ({ page }) => {\n-  const universalNavigation = page.getByTestId(\n-    headerComponentElements.universalNav\n-  );\n-  const universalNavigationLogo = page.getByTestId(\n-    headerComponentElements.universalNavLogo\n-  );\n-  await expect(universalNavigation).toBeVisible();\n-  await expect(universalNavigationLogo).toBeVisible();\n-  await expect(universalNavigationLogo).toHaveAttribute('href', '/learn');\n-});\n+  test.beforeEach(async ({ page }) => {\n+    await page.goto('/');\n+  });\n \n-test('Should display search in header on desktop and in menu on mobile', async ({\n-  page,\n-  isMobile\n-}) => {\n-  const searchInput = page.getByLabel(translations.search.label);\n-  const menuButton = page.getByTestId(headerComponentElements.menuButton);\n+  test.beforeAll(() => {\n+    execSync('node ./tools/scripts/seed/seed-demo-user');\n+  });\n \n-  if (isMobile) {\n-    await expect(searchInput).toBeHidden();\n-    await menuButton.click();\n-    await expect(searchInput).toBeVisible();\n-  } else {\n-    await expect(searchInput).toBeVisible();\n-  }\n-});\n+  test.afterAll(() => {\n+    execSync('node ./tools/scripts/seed/seed-demo-user certified-user');\n+  });\n \n-test('Clicking the \"Change Language\" button should open the language list', async ({\n-  page\n-}) => {\n-  const toggleLangButton = page.getByTestId(\n-    headerComponentElements.toggleLangButton\n-  );\n-  await expect(toggleLangButton).toBeVisible();\n-  await toggleLangButton.click();\n-  const langList = page.getByTestId(headerComponentElements.languageList);\n-  await expect(langList).toBeVisible();\n-});\n+  test('Has link for skip content', async ({ page }) => {\n+    const skipContent = page.getByTestId(headerComponentElements.skipContent);\n+    await expect(skipContent).toBeVisible();\n+    await expect(skipContent).toHaveAttribute('href', '#content-start');\n+  });\n \n-test('The language list should contain a button for each available language', async ({\n-  page\n-}) => {\n-  const locales = availableLangs.client.filter(\n-    lang => !hiddenLangs.includes(lang)\n-  );\n-\n-  const toggleLangButton = page.getByTestId(\n-    headerComponentElements.toggleLangButton\n-  );\n-  await expect(toggleLangButton).toBeVisible();\n-  await toggleLangButton.click();\n-  const langList = page.getByTestId(headerComponentElements.languageList);\n-  await expect(langList).toBeVisible();\n-\n-  const langButtons = page.getByTestId(headerComponentElements.languageButton);\n-  await expect(langButtons).toHaveCount(locales.length);\n-\n-  for (let i = 0; i < locales.length; i++) {\n-    const btn = langButtons.nth(i);\n-    await expect(btn).toContainText(LangNames[locales[i]]);\n-  }\n-});\n+  test('Renders universal nav by default', async ({ page }) => {\n+    const universalNavigation = page.getByTestId(\n+      headerComponentElements.universalNav\n+    );\n+    const universalNavigationLogo = page.getByTestId(\n+      headerComponentElements.universalNavLogo\n+    );\n+    await expect(universalNavigation).toBeVisible();\n+    await expect(universalNavigationLogo).toBeVisible();\n+    await expect(universalNavigationLogo).toHaveAttribute('href', '/learn');\n+  });\n \n-test('Clicking the menu button should open the menu', async ({ page }) => {\n-  const menuButton = page.getByTestId(headerComponentElements.menuButton);\n-  const menu = page.getByTestId(headerComponentElements.menu);\n-  await expect(menuButton).toBeVisible();\n-  await menuButton.click();\n-  await expect(menu).toBeVisible();\n-});\n+  test('Should display search in header on desktop and in menu on mobile', async ({\n+    page,\n+    isMobile\n+  }) => {\n+    const searchInput = page.getByLabel(translations.search.label);\n+    const menuButton = page.getByTestId(headerComponentElements.menuButton);\n+\n+    if (isMobile) {\n+      await expect(searchInput).toBeHidden();\n+      await menuButton.click();\n+      await expect(searchInput).toBeVisible();\n+    } else {\n+      await expect(searchInput).toBeVisible();\n+    }\n+  });\n \n-test('Focusing on a menu item, and pressing Esc should close the menu and focus on the menu button', async ({\n-  page\n-}) => {\n-  const menuButton = page.getByTestId(headerComponentElements.menuButton);\n-  const menu = page.getByTestId(headerComponentElements.menu);\n+  test('Clicking the \"Change Language\" button should open the language list', async ({\n+    page\n+  }) => {\n+    const toggleLangButton = page.getByTestId(\n+      headerComponentElements.toggleLangButton\n+    );\n+    await expect(toggleLangButton).toBeVisible();\n+    await toggleLangButton.click();\n+    const langList = page.getByTestId(headerComponentElements.languageList);\n+    await expect(langList).toBeVisible();\n+  });\n \n-  await expect(menuButton).toBeVisible();\n-  await menuButton.click();\n+  test('The language list should contain a button for each available language', async ({\n+    page\n+  }) => {\n+    const locales = availableLangs.client.filter(\n+      lang => !hiddenLangs.includes(lang)\n+    );\n+\n+    const toggleLangButton = page.getByTestId(\n+      headerComponentElements.toggleLangButton\n+    );\n+    await expect(toggleLangButton).toBeVisible();\n+    await toggleLangButton.click();\n+    const langList = page.getByTestId(headerComponentElements.languageList);\n+    await expect(langList).toBeVisible();\n+\n+    const langButtons = page.getByTestId(\n+      headerComponentElements.languageButton\n+    );\n+    await expect(langButtons).toHaveCount(locales.length);\n+\n+    for (let i = 0; i < locales.length; i++) {\n+      const btn = langButtons.nth(i);\n+      await expect(btn).toContainText(LangNames[locales[i]]);\n+    }\n+  });\n \n-  const link = menu.getByRole('link', { name: translations.buttons.donate });\n-  await link.focus();\n+  test('Clicking the menu button should open the menu', async ({ page }) => {\n+    const menuButton = page.getByTestId(headerComponentElements.menuButton);\n+    const menu = page.getByTestId(headerComponentElements.menu);\n+    await expect(menuButton).toBeVisible();\n+    await menuButton.click();\n+    await expect(menu).toBeVisible();\n+  });\n \n-  await page.keyboard.press('Escape');\n-  await expect(menu).toBeHidden();\n+  test('Focusing on a menu item, and pressing Esc should close the menu and focus on the menu button', async ({\n+    page\n+  }) => {\n+    const menuButton = page.getByTestId(headerComponentElements.menuButton);\n+    const menu = page.getByTestId(headerComponentElements.menu);\n \n-  await expect(menuButton).toBeFocused();\n-});\n+    await expect(menuButton).toBeVisible();\n+    await menuButton.click();\n \n-test('The menu should contain links to: donate, curriculum, forum, news, radio, contribute, and podcast', async ({\n-  page\n-}) => {\n-  const menuButton = page.getByTestId(headerComponentElements.menuButton);\n-  const menu = page.getByTestId(headerComponentElements.menu);\n-  await expect(menuButton).toBeVisible();\n-  await menuButton.click();\n-  await expect(menu).toBeVisible();\n-\n-  const menuLinks = [\n-    {\n-      name: translations.buttons.donate,\n-      href: '/donate'\n-    },\n-    {\n-      name: translations.buttons.curriculum,\n-      href: '/learn'\n-    },\n-    {\n-      name: translations.buttons.forum,\n-      href: links.nav.forum\n-    },\n-    {\n-      name: translations.buttons.news,\n-      href: links.nav.news\n-    },\n-    {\n-      name: translations.buttons.radio,\n-      href: process.env.RADIO_LOCATION || 'https://coderadio.freecodecamp.org'\n-    },\n-    {\n-      name: translations.buttons.contribute,\n-      href: links.nav.contribute\n-    },\n-    {\n-      name: translations.buttons.podcast,\n-      href: links.nav.podcast\n-    }\n-  ];\n+    const link = menu.getByRole('link', { name: translations.buttons.donate });\n+    await link.focus();\n \n-  for (const menuLink of menuLinks) {\n-    const link = menu.getByRole('link', { name: menuLink.name });\n-    await expect(link).toBeVisible();\n-    await expect(link).toHaveAttribute('href', menuLink.href);\n-  }\n-});\n+    await page.keyboard.press('Escape');\n+    await expect(menu).toBeHidden();\n \n-test('The menu should be able to change the theme', async ({ page }) => {\n-  const menuButton = page.getByTestId(headerComponentElements.menuButton);\n-  const menu = page.getByTestId(headerComponentElements.menu);\n-  await menuButton.click();\n-  await expect(menu).toBeVisible();\n+    await expect(menuButton).toBeFocused();\n+  });\n \n-  const themeButton = menu.getByRole('button', {\n-    name: 'Night Mode'\n+  test('The menu should contain links to: donate, curriculum, forum, news, radio, contribute, and podcast', async ({\n+    page\n+  }) => {\n+    const menuButton = page.getByTestId(headerComponentElements.menuButton);\n+    const menu = page.getByTestId(headerComponentElements.menu);\n+    await expect(menuButton).toBeVisible();\n+    await menuButton.click();\n+    await expect(menu).toBeVisible();\n+\n+    const menuLinks = [\n+      { name: translations.buttons.profile, href: '/developmentuser' },\n+      {\n+        name: translations.buttons.donate,\n+        href: '/donate'\n+      },\n+      {\n+        name: translations.buttons.curriculum,\n+        href: '/learn'\n+      },\n+      {\n+        name: translations.buttons.forum,\n+        href: links.nav.forum\n+      },\n+      {\n+        name: translations.buttons.news,\n+        href: links.nav.news\n+      },\n+      {\n+        name: translations.buttons.radio,\n+        href: process.env.RADIO_LOCATION || 'https://coderadio.freecodecamp.org'\n+      },\n+      {\n+        name: translations.buttons.contribute,\n+        href: links.nav.contribute\n+      },\n+      {\n+        name: translations.buttons.podcast,\n+        href: links.nav.podcast\n+      }\n+    ];\n+\n+    for (const menuLink of menuLinks) {\n+      const link = menu.getByRole('link', { name: menuLink.name });\n+      await expect(link).toBeVisible();\n+      await expect(link).toHaveAttribute('href', menuLink.href);\n+    }\n   });\n-  await themeButton.click();\n \n-  await expect(page.locator('body')).toHaveClass('dark-palette');\n+  test('The menu should be able to change the theme', async ({ page }) => {\n+    const menuButton = page.getByTestId(headerComponentElements.menuButton);\n+    const menu = page.getByTestId(headerComponentElements.menu);\n+    await menuButton.click();\n+    await expect(menu).toBeVisible();\n \n-  await expect(page.getByTestId('flash-message')).toContainText(\n-    /We have updated your theme/\n-  );\n-  await expect(menu).toBeHidden();\n+    const themeButton = menu.getByRole('button', {\n+      name: 'Night Mode'\n+    });\n+    await themeButton.click();\n \n-  await menuButton.click();\n-  await expect(menu).toBeVisible();\n+    await expect(page.locator('body')).toHaveClass('dark-palette');\n \n-  await themeButton.click();\n-  await expect(page.locator('body')).toHaveClass('light-palette');\n-});\n+    await expect(page.getByTestId('flash-message')).toContainText(\n+      /We have updated your theme/\n+    );\n+    await expect(menu).toBeHidden();\n \n-test('The header should contain an avatar', async ({ page }) => {\n-  const avatarLink = page.locator('.avatar-nav-link');\n-  await expect(avatarLink).toBeVisible();\n-  await expect(avatarLink).toHaveAttribute('href', '/certifieduser');\n+    await menuButton.click();\n+    await expect(menu).toBeVisible();\n \n-  const avatarContainer = page.locator('.avatar-container');\n-  await expect(avatarContainer).toHaveClass('avatar-container blue-border');\n-});\n+    await themeButton.click();\n+    await expect(page.locator('body')).toHaveClass('light-palette');\n+  });\n \n-test('Renders exam nav for Foundational C# with Microsoft exam', async ({\n-  page\n-}) => {\n-  await page.goto(examUrl);\n-  await page\n-    .getByRole('button', {\n-      name: translations.buttons['click-start-exam']\n-    })\n-    .click();\n-  await expect(page).toHaveURL(examUrl);\n-  await expect(page.getByTestId(headerComponentElements.examNav)).toBeVisible();\n-  await expect(\n-    page.getByTestId(headerComponentElements.examNavLogo)\n-  ).toBeVisible();\n-});\n+  test('The header should contain an avatar', async ({ page }) => {\n+    const avatarLink = page.getByRole('link', { name: 'Profile' });\n+    await expect(avatarLink).toBeVisible();\n+    await expect(avatarLink).toHaveAttribute('href', '/developmentuser');\n \n-test('The Sign In button should redirect to api/signin', async ({\n-  browser\n-}) => {\n-  // Sign out user in order to test Sign In button\n-  const context = await browser.newContext({\n-    storageState: { cookies: [], origins: [] }\n+    const avatar = avatarLink.getByRole('img', {\n+      name: 'Default Avatar',\n+      includeHidden: true // the svg is aria-hidden\n+    });\n+    await expect(avatar).toBeVisible();\n   });\n-  const page = await context.newPage();\n-  await page.goto('/');\n \n-  const signInButton = page.getByRole('link', {\n-    name: translations.buttons['sign-in']\n+  test('The Avatar should be less or equal to 26px', async ({ page }) => {\n+    const avatar = page\n+      .getByRole('link', { name: 'Profile' })\n+      .getByRole('img', {\n+        name: 'Default Avatar',\n+        includeHidden: true // the svg is aria-hidden\n+      });\n+\n+    await expect(avatar).toBeVisible();\n+    const avatarSize = await avatar.boundingBox();\n+    expect(avatarSize?.width).toBeLessThanOrEqual(26);\n+    expect(avatarSize?.height).toBeLessThanOrEqual(26);\n   });\n \n-  const apiLocation = process.env.API_LOCATION || 'http://localhost:3000';\n+  test('The Sign In button should redirect to api/signin', async ({\n+    browser\n+  }) => {\n+    // Sign out user in order to test Sign In button\n+    const context = await browser.newContext({\n+      storageState: { cookies: [], origins: [] }\n+    });\n+    const page = await context.newPage();\n+    await page.goto('/');\n+\n+    const signInButton = page.getByRole('link', {\n+      name: translations.buttons['sign-in']\n+    });\n \n-  await expect(signInButton).toHaveAttribute('href', `${apiLocation}/signin`);\n+    const apiLocation = process.env.API_LOCATION || 'http://localhost:3000';\n+\n+    await expect(signInButton).toHaveAttribute('href', `${apiLocation}/signin`);\n+  });\n+\n+  test('When the user is signed out, only certain elements should be visible', async ({\n+    browser\n+  }) => {\n+    const context = await browser.newContext({\n+      storageState: { cookies: [], origins: [] }\n+    });\n+    const page = await context.newPage();\n+    await page.goto('/');\n+    const signInButton = page\n+      .getByTestId(headerComponentElements.signInButton)\n+      .nth(0);\n+    await expect(signInButton).toBeVisible();\n+\n+    const avatar = page\n+      .getByRole('link', { name: 'Profile' })\n+      .getByRole('img', {\n+        name: 'Default Avatar',\n+        includeHidden: true // the svg is aria-hidden\n+      });\n+    await expect(avatar).toBeHidden();\n+  });\n });\n \n-test('When the user is signed out, only certain elements should be visible', async ({\n-  browser\n-}) => {\n-  const context = await browser.newContext({\n-    storageState: { cookies: [], origins: [] }\n-  });\n-  const page = await context.newPage();\n-  await page.goto('/');\n-  const signInButton = page\n-    .getByTestId(headerComponentElements.signInButton)\n-    .nth(0);\n-  await expect(signInButton).toBeVisible();\n-  await expect(page.locator('.avatar-nav-link')).toBeHidden();\n-  await expect(page.locator('.avatar-container')).toBeHidden();\n+test.describe('Exam Header', () => {\n+  test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+\n+  test('Renders exam nav for Foundational C# with Microsoft exam', async ({\n+    page\n+  }) => {\n+    await page.goto(examUrl);\n+    await page\n+      .getByRole('button', {\n+        name: translations.buttons['click-start-exam']\n+      })\n+      .click();\n+    await expect(page).toHaveURL(examUrl);\n+    await expect(\n+      page.getByTestId(headerComponentElements.examNav)\n+    ).toBeVisible();\n+    await expect(\n+      page.getByTestId(headerComponentElements.examNavLogo)\n+    ).toBeVisible();\n+  });\n });"
        }
    ],
    "stats": {
        "total": 506,
        "additions": 244,
        "deletions": 262
    }
}