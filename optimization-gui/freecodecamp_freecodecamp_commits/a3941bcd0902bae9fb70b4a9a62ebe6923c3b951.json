{
    "author": "huyenltnguyen",
    "message": "refactor(external curricula): simplify get intro logic (#59707)",
    "sha": "a3941bcd0902bae9fb70b4a9a62ebe6923c3b951",
    "files": [
        {
            "sha": "a7e525198a526bddca62b65940b8b6fae7e8b6ac",
            "filename": "tools/scripts/build/build-external-curricula-data.test.ts",
            "status": "modified",
            "additions": 67,
            "deletions": 15,
            "changes": 82,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a3941bcd0902bae9fb70b4a9a62ebe6923c3b951/tools%2Fscripts%2Fbuild%2Fbuild-external-curricula-data.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a3941bcd0902bae9fb70b4a9a62ebe6923c3b951/tools%2Fscripts%2Fbuild%2Fbuild-external-curricula-data.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscripts%2Fbuild%2Fbuild-external-curricula-data.test.ts?ref=a3941bcd0902bae9fb70b4a9a62ebe6923c3b951",
            "patch": "@@ -1,5 +1,5 @@\n import path from 'path';\n-import fs from 'fs';\n+import fs, { readFileSync } from 'fs';\n \n import readdirp from 'readdirp';\n \n@@ -8,9 +8,20 @@ import {\n   superblockSchemaValidator,\n   availableSuperBlocksValidator\n } from './external-data-schema';\n-import { orderedSuperBlockInfo } from './build-external-curricula-data';\n+import {\n+  type Curriculum,\n+  type CurriculumIntros,\n+  type GeneratedCurriculumProps,\n+  orderedSuperBlockInfo\n+} from './build-external-curricula-data';\n \n const VERSION = 'v1';\n+const intros = JSON.parse(\n+  readFileSync(\n+    path.resolve(__dirname, '../../../client/i18n/locales/english/intro.json'),\n+    'utf-8'\n+  )\n+) as CurriculumIntros;\n \n describe('external curriculum data build', () => {\n   const clientStaticPath = path.resolve(__dirname, '../../../client/static');\n@@ -52,28 +63,69 @@ ${result.error.message}`\n     }\n   });\n \n-  test('the files generated should have the correct schema', async () => {\n+  test('the super block files generated should have the correct schema', async () => {\n     const fileArray = (\n       await readdirp.promise(`${clientStaticPath}/curriculum-data/${VERSION}`, {\n-        directoryFilter: ['!challenges']\n+        directoryFilter: ['!challenges'],\n+        fileFilter: entry => {\n+          // The directory contains super block files and other curriculum-related files.\n+          // We're only interested in super block ones.\n+          const superBlocks = Object.values(SuperBlocks);\n+          return superBlocks.includes(entry.basename);\n+        }\n       })\n     ).map(file => file.path);\n \n-    fileArray\n-      .filter(fileInArray => fileInArray !== 'available-superblocks.json')\n-      .forEach(fileInArray => {\n-        const fileContent = fs.readFileSync(\n-          `${clientStaticPath}/curriculum-data/${VERSION}/${fileInArray}`,\n-          'utf-8'\n-        );\n+    fileArray.forEach(fileInArray => {\n+      const fileContent = fs.readFileSync(\n+        `${clientStaticPath}/curriculum-data/${VERSION}/${fileInArray}`,\n+        'utf-8'\n+      );\n \n-        const result = validateSuperBlock(JSON.parse(fileContent));\n+      const result = validateSuperBlock(JSON.parse(fileContent));\n \n-        if (result.error) {\n-          throw Error(`file: ${fileInArray}\n+      if (result.error) {\n+        throw Error(`file: ${fileInArray}\n ${result.error.message}`);\n+      }\n+    });\n+  });\n+\n+  test('super blocks and blocks should have the correct data', async () => {\n+    const superBlockFiles = (\n+      await readdirp.promise(`${clientStaticPath}/curriculum-data/${VERSION}`, {\n+        directoryFilter: ['!challenges'],\n+        fileFilter: entry => {\n+          // The directory contains super block files and other curriculum-related files.\n+          // We're only interested in super block ones.\n+          const superBlocks = Object.values(SuperBlocks);\n+          return superBlocks.includes(entry.basename);\n         }\n-      });\n+      })\n+    ).map(file => file.path);\n+\n+    superBlockFiles.forEach(file => {\n+      const fileContentJson = fs.readFileSync(\n+        `${clientStaticPath}/curriculum-data/${VERSION}/${file}`,\n+        'utf-8'\n+      );\n+\n+      const fileContent = JSON.parse(\n+        fileContentJson\n+      ) as Curriculum<GeneratedCurriculumProps>;\n+\n+      const superBlock = Object.keys(fileContent)[0] as SuperBlocks;\n+\n+      // Randomly pick a block to check its data.\n+      const blocks = Object.keys(fileContent[superBlock].blocks);\n+      const randomBlockIndex = Math.floor(Math.random() * blocks.length);\n+      const randomBlock = blocks[randomBlockIndex];\n+\n+      expect(fileContent[superBlock].intro).toEqual(intros[superBlock].intro);\n+      expect(fileContent[superBlock].blocks[randomBlock].desc).toEqual(\n+        intros[superBlock].blocks[randomBlock].intro\n+      );\n+    });\n   });\n \n   test('All public SuperBlocks should be present in the SuperBlock object', () => {"
        },
        {
            "sha": "ef8ee21f22292f1abe57098460436428038dec4e",
            "filename": "tools/scripts/build/build-external-curricula-data.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 34,
            "changes": 49,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a3941bcd0902bae9fb70b4a9a62ebe6923c3b951/tools%2Fscripts%2Fbuild%2Fbuild-external-curricula-data.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a3941bcd0902bae9fb70b4a9a62ebe6923c3b951/tools%2Fscripts%2Fbuild%2Fbuild-external-curricula-data.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscripts%2Fbuild%2Fbuild-external-curricula-data.ts?ref=a3941bcd0902bae9fb70b4a9a62ebe6923c3b951",
            "patch": "@@ -4,24 +4,26 @@ import { submitTypes } from '../../../shared/config/challenge-types';\n import { type ChallengeNode } from '../../../client/src/redux/prop-types';\n import { SuperBlocks } from '../../../shared/config/curriculum';\n \n-type Intro = { [keyValue in SuperBlocks]: IntroProps };\n+export type CurriculumIntros = {\n+  [keyValue in SuperBlocks]: {\n+    title: string;\n+    intro: string[];\n+    blocks: Record<string, { title: string; intro: string[] }>;\n+  };\n+};\n+\n export type Curriculum<T> = {\n   [keyValue in SuperBlocks]: T extends CurriculumProps\n     ? CurriculumProps\n     : GeneratedCurriculumProps;\n };\n \n-interface IntroProps extends CurriculumProps {\n-  title: string;\n-  intro: string[];\n-}\n-\n export interface CurriculumProps {\n   intro: string[];\n   blocks: Record<string, Block<ChallengeNode['challenge'][]>>;\n }\n \n-interface GeneratedCurriculumProps {\n+export interface GeneratedCurriculumProps {\n   intro: string[];\n   blocks: Record<string, Block<Record<string, unknown>>>;\n }\n@@ -71,6 +73,9 @@ export function buildExtCurriculumData(\n     __dirname,\n     '../../../client/i18n/locales/english/intro.json'\n   );\n+  const intros = JSON.parse(\n+    readFileSync(blockIntroPath, 'utf-8')\n+  ) as CurriculumIntros;\n \n   mkdirSync(dataPath, { recursive: true });\n \n@@ -85,7 +90,7 @@ export function buildExtCurriculumData(\n     writeToFile('available-superblocks', {\n       superblocks: orderedSuperBlockInfo.map(x => ({\n         ...x,\n-        title: getSuperBlockTitle(x.dashedName)\n+        title: intros[x.dashedName].title\n       }))\n     });\n \n@@ -96,7 +101,7 @@ export function buildExtCurriculumData(\n       if (blockNames.length === 0) continue;\n \n       superBlock[superBlockKey] = <GeneratedCurriculumProps>{};\n-      superBlock[superBlockKey].intro = getSuperBlockDescription(superBlockKey);\n+      superBlock[superBlockKey].intro = intros[superBlockKey]['intro'];\n       superBlock[superBlockKey].blocks = {};\n \n       for (const blockName of blockNames) {\n@@ -105,7 +110,7 @@ export function buildExtCurriculumData(\n         >{};\n \n         superBlock[superBlockKey]['blocks'][blockName]['desc'] =\n-          getBlockDescription(superBlockKey, blockName);\n+          intros[superBlockKey]['blocks'][blockName]['intro'];\n \n         superBlock[superBlockKey]['blocks'][blockName]['challenges'] =\n           curriculum[superBlockKey]['blocks'][blockName]['meta'];\n@@ -131,30 +136,6 @@ export function buildExtCurriculumData(\n     writeFileSync(filePath, JSON.stringify(data, null, 2));\n   }\n \n-  function getBlockDescription(\n-    superBlockKeys: SuperBlocks,\n-    blockKey: string\n-  ): string[] {\n-    const intros = JSON.parse(readFileSync(blockIntroPath, 'utf-8')) as Intro;\n-\n-    return intros[superBlockKeys]['blocks'][blockKey]['intro'];\n-  }\n-\n-  function getSuperBlockDescription(superBlockKey: SuperBlocks): string[] {\n-    const superBlockIntro = JSON.parse(\n-      readFileSync(blockIntroPath, 'utf-8')\n-    ) as Intro;\n-    return superBlockIntro[superBlockKey]['intro'];\n-  }\n-\n-  function getSuperBlockTitle(superBlock: SuperBlocks): string {\n-    const superBlocks = JSON.parse(\n-      readFileSync(blockIntroPath, 'utf-8')\n-    ) as Intro;\n-\n-    return superBlocks[superBlock].title;\n-  }\n-\n   function getSubmitTypes() {\n     writeFileSync(\n       `${dataPath}/submit-types.json`,"
        }
    ],
    "stats": {
        "total": 131,
        "additions": 82,
        "deletions": 49
    }
}