{
    "author": "ojeytonwilliams",
    "message": "fix(api): return after reply (save-challenge) (#57487)",
    "sha": "3e0b2b914cf02ad3bd080d4d29872043d0f53885",
    "files": [
        {
            "sha": "d76c22c48ee6ddaae30d49cf6632040fee7eb21d",
            "filename": "api/src/routes/protected/challenge.test.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 3,
            "changes": 22,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e0b2b914cf02ad3bd080d4d29872043d0f53885/api%2Fsrc%2Froutes%2Fprotected%2Fchallenge.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e0b2b914cf02ad3bd080d4d29872043d0f53885/api%2Fsrc%2Froutes%2Fprotected%2Fchallenge.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fprotected%2Fchallenge.test.ts?ref=3e0b2b914cf02ad3bd080d4d29872043d0f53885",
            "patch": "@@ -912,9 +912,9 @@ describe('challengeRoutes', () => {\n       });\n     });\n \n-    describe('/save-challenge', () => {\n+    describe('POST /save-challenge', () => {\n       describe('validation', () => {\n-        test('POST returns 403 status for unsavable challenges', async () => {\n+        test('returns 400 status for unsavable challenges', async () => {\n           const response = await superPost('/save-challenge').send({\n             savedChallenges: {\n               // valid mongo id, but not a saveable one\n@@ -941,7 +941,23 @@ describe('challengeRoutes', () => {\n           });\n         });\n \n-        test('POST update the user savedchallenges and return them', async () => {\n+        test('rejects requests for challenges that cannot be saved', async () => {\n+          const response = await superPost('/save-challenge').send({\n+            id: '66ebd4ae2812430bb883c786',\n+            files: multiFileCertProjectBody.files\n+          });\n+\n+          const { savedChallenges } =\n+            await fastifyTestInstance.prisma.user.findFirstOrThrow({\n+              where: { email: 'foo@bar.com' }\n+            });\n+\n+          expect(response.statusCode).toBe(400);\n+          expect(response.text).toEqual('That challenge type is not saveable.');\n+          expect(savedChallenges).toHaveLength(0);\n+        });\n+\n+        test('update the user savedchallenges and return them', async () => {\n           const response = await superPost('/save-challenge').send({\n             id: multiFileCertProjectId,\n             files: updatedMultiFileCertProjectBody.files"
        },
        {
            "sha": "85cfd1758f401ed790188ef638aa07439c780953",
            "filename": "api/src/routes/protected/challenge.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3e0b2b914cf02ad3bd080d4d29872043d0f53885/api%2Fsrc%2Froutes%2Fprotected%2Fchallenge.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3e0b2b914cf02ad3bd080d4d29872043d0f53885/api%2Fsrc%2Froutes%2Fprotected%2Fchallenge.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fprotected%2Fchallenge.ts?ref=3e0b2b914cf02ad3bd080d4d29872043d0f53885",
            "patch": "@@ -391,7 +391,9 @@ export const challengeRoutes: FastifyPluginCallbackTypebox = (\n         !multifileCertProjectIds.includes(challengeId) &&\n         !multifilePythonCertProjectIds.includes(challengeId)\n       ) {\n-        void reply.code(403).send('That challenge type is not saveable.');\n+        return void reply\n+          .code(400)\n+          .send('That challenge type is not saveable.');\n       }\n \n       const userSavedChallenges = saveUserChallengeData("
        }
    ],
    "stats": {
        "total": 26,
        "additions": 22,
        "deletions": 4
    }
}