{
    "author": "raisedadead",
    "message": "fix(gha): allowlist staff, and revert commits (#62894)",
    "sha": "51c24f67e1284365fa54828922c9a6fbd9c8b177",
    "files": [
        {
            "sha": "b37dd5de879f07866eff4821509286bb7d67a731",
            "filename": ".github/workflows/github-no-web-commits.yml",
            "status": "modified",
            "additions": 17,
            "deletions": 11,
            "changes": 28,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/51c24f67e1284365fa54828922c9a6fbd9c8b177/.github%2Fworkflows%2Fgithub-no-web-commits.yml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/51c24f67e1284365fa54828922c9a6fbd9c8b177/.github%2Fworkflows%2Fgithub-no-web-commits.yml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/.github%2Fworkflows%2Fgithub-no-web-commits.yml?ref=51c24f67e1284365fa54828922c9a6fbd9c8b177",
            "patch": "@@ -21,16 +21,22 @@ jobs:\n           github-token: ${{ secrets.GITHUB_TOKEN }}\n           script: |\n             const prAuthor = context.payload.pull_request.user.login;\n-            const response = await github.rest.teams\n-              .getMembershipForUserInOrg({\n-                org: context.repo.owner,\n-                team_slug: 'moderators',\n-                username: prAuthor\n-              })\n-              .catch(() => ({ status: 404 }));\n-            let isAllowListed = false;\n-            if (prAuthor === 'renovate[bot]' || response.status === 200) {\n-              isAllowListed = true;\n+            const allowedTeams = ['moderators', 'staff'];\n+            let isAllowListed = prAuthor === 'renovate[bot]';\n+            if (!isAllowListed) {\n+              for (const team of allowedTeams) {\n+                const response = await github.rest.teams\n+                  .getMembershipForUserInOrg({\n+                    org: context.repo.owner,\n+                    team_slug: team,\n+                    username: prAuthor\n+                  })\n+                  .catch(() => ({ status: 404 }));\n+                if (response.status === 200) {\n+                  isAllowListed = true;\n+                  break;\n+                }\n+              }\n             }\n             core.setOutput('is_allow_listed', isAllowListed);\n \n@@ -40,7 +46,7 @@ jobs:\n         run: |\n           PR_NUMBER=$(jq --raw-output .pull_request.number \"$GITHUB_EVENT_PATH\")\n           COMMITS_URL=\"https://api.github.com/repos/$GITHUB_REPOSITORY/pulls/$PR_NUMBER/commits\"\n-          IS_GITHUB_COMMIT=$(curl --header \"Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}\" \"$COMMITS_URL\" | jq '[.[] | .commit.committer.name] | any(.[]; . == \"GitHub\")')\n+          IS_GITHUB_COMMIT=$(curl --header \"Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}\" \"$COMMITS_URL\" | jq '[.[] | select(.commit.committer.name == \"GitHub\") | select(.commit.message | test(\"revert\"; \"i\") | not)] | length > 0')\n           if [ \"$IS_GITHUB_COMMIT\" = \"true\" ]; then\n             echo \"IS_GITHUB_COMMIT=true\" >> $GITHUB_ENV\n           fi"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 17,
        "deletions": 11
    }
}