{
    "author": "Sembauke",
    "message": "feat(api): get exams endpoint (#56727)",
    "sha": "27e8bf9da04911993682e4ee431c0059953a41d5",
    "files": [
        {
            "sha": "d9532617f7eec13ce5902ff45d5c5fe82c78fc8d",
            "filename": "api/src/exam-environment/routes/exam-environment.test.ts",
            "status": "modified",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/27e8bf9da04911993682e4ee431c0059953a41d5/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/27e8bf9da04911993682e4ee431c0059953a41d5/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts?ref=27e8bf9da04911993682e4ee431c0059953a41d5",
            "patch": "@@ -24,12 +24,14 @@ describe('/exam-environment/', () => {\n   setupServer();\n   describe('Authenticated user with exam environment authorization token', () => {\n     let superPost: ReturnType<typeof createSuperRequest>;\n+    let superGet: ReturnType<typeof createSuperRequest>;\n     let examEnvironmentAuthorizationToken: string;\n \n     // Authenticate user\n     beforeAll(async () => {\n       const setCookies = await devLogin();\n       superPost = createSuperRequest({ method: 'POST', setCookies });\n+      superGet = createSuperRequest({ method: 'GET', setCookies });\n       await mock.seedEnvExam();\n       // Add exam environment authorization token\n       const res = await superPost('/user/exam-environment/token');\n@@ -532,15 +534,43 @@ describe('/exam-environment/', () => {\n     });\n \n     xdescribe('POST /exam-environment/screenshot', () => {});\n+\n+    describe('GET /exam-environment/exams', () => {\n+      it('should return 200', async () => {\n+        const res = await superGet('/exam-environment/exams').set(\n+          'exam-environment-authorization-token',\n+          examEnvironmentAuthorizationToken\n+        );\n+        expect(res.status).toBe(200);\n+\n+        expect(res.body).toStrictEqual({\n+          data: {\n+            exams: [\n+              {\n+                canTake: true,\n+                config: {\n+                  name: mock.exam.config.name,\n+                  note: mock.exam.config.note,\n+                  totalTimeInMS: mock.exam.config.totalTimeInMS\n+                },\n+                id: mock.examId\n+              }\n+            ]\n+          }\n+        });\n+      });\n+    });\n   });\n \n   describe('Authenticated user without exam environment authorization token', () => {\n     let superPost: ReturnType<typeof createSuperRequest>;\n+    let superGet: ReturnType<typeof createSuperRequest>;\n \n     // Authenticate user\n     beforeAll(async () => {\n       const setCookies = await devLogin();\n       superPost = createSuperRequest({ method: 'POST', setCookies });\n+      superGet = createSuperRequest({ method: 'GET', setCookies });\n       await mock.seedEnvExam();\n     });\n     describe('POST /exam-environment/exam/attempt', () => {\n@@ -598,5 +628,16 @@ describe('/exam-environment/', () => {\n         });\n       });\n     });\n+\n+    describe('GET /exam-environment/exams', () => {\n+      it('should return 403', async () => {\n+        const res = await superGet('/exam-environment/exams').set(\n+          'exam-environment-authorization-token',\n+          'invalid-token'\n+        );\n+\n+        expect(res.status).toBe(403);\n+      });\n+    });\n   });\n });"
        },
        {
            "sha": "5dfac2140308d59909ea660cd295480c7d4188df",
            "filename": "api/src/exam-environment/routes/exam-environment.ts",
            "status": "modified",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/27e8bf9da04911993682e4ee431c0059953a41d5/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/27e8bf9da04911993682e4ee431c0059953a41d5/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.ts?ref=27e8bf9da04911993682e4ee431c0059953a41d5",
            "patch": "@@ -23,6 +23,13 @@ import { ERRORS } from '../utils/errors';\n  */\n export const examEnvironmentValidatedTokenRoutes: FastifyPluginCallbackTypebox =\n   (fastify, _options, done) => {\n+    fastify.get(\n+      '/exam-environment/exams',\n+      {\n+        schema: schemas.examEnvironmentExams\n+      },\n+      getExams\n+    );\n     fastify.post(\n       '/exam-environment/exam/generated-exam',\n       {\n@@ -565,3 +572,37 @@ async function postScreenshotHandler(\n ) {\n   return reply.code(418);\n }\n+\n+async function getExams(\n+  this: FastifyInstance,\n+  req: UpdateReqType<typeof schemas.examEnvironmentExams>,\n+  reply: FastifyReply\n+) {\n+  const user = req.user!;\n+  const exams = await this.prisma.envExam.findMany({\n+    select: {\n+      id: true,\n+      config: true\n+    }\n+  });\n+\n+  const availableExams = exams.map(exam => {\n+    const isExamPrerequisitesMet = checkPrerequisites(user, true);\n+\n+    return {\n+      id: exam.id,\n+      config: {\n+        name: exam.config.name,\n+        note: exam.config.note,\n+        totalTimeInMS: exam.config.totalTimeInMS\n+      },\n+      canTake: isExamPrerequisitesMet\n+    };\n+  });\n+\n+  return reply.send({\n+    data: {\n+      exams: availableExams\n+    }\n+  });\n+}"
        },
        {
            "sha": "899ae04dd61d59911034b653f03467db3617fa80",
            "filename": "api/src/exam-environment/schemas/exams.ts",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/27e8bf9da04911993682e4ee431c0059953a41d5/api%2Fsrc%2Fexam-environment%2Fschemas%2Fexams.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/27e8bf9da04911993682e4ee431c0059953a41d5/api%2Fsrc%2Fexam-environment%2Fschemas%2Fexams.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Fschemas%2Fexams.ts?ref=27e8bf9da04911993682e4ee431c0059953a41d5",
            "patch": "@@ -0,0 +1,27 @@\n+import { Type } from '@fastify/type-provider-typebox';\n+import { STANDARD_ERROR } from '../utils/errors';\n+export const examEnvironmentExams = {\n+  headers: Type.Object({\n+    'exam-environment-authorization-token': Type.String()\n+  }),\n+  response: {\n+    200: Type.Union([\n+      Type.Object({\n+        data: Type.Object({\n+          exams: Type.Array(\n+            Type.Object({\n+              id: Type.String(),\n+              config: Type.Object({\n+                name: Type.String(),\n+                note: Type.String(),\n+                totalTimeInMS: Type.Number()\n+              }),\n+              canTake: Type.Boolean()\n+            })\n+          )\n+        })\n+      }),\n+      STANDARD_ERROR\n+    ])\n+  }\n+};"
        },
        {
            "sha": "7cf2e1616c0f23bb5982273bc33e68903d4629de",
            "filename": "api/src/exam-environment/schemas/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/27e8bf9da04911993682e4ee431c0059953a41d5/api%2Fsrc%2Fexam-environment%2Fschemas%2Findex.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/27e8bf9da04911993682e4ee431c0059953a41d5/api%2Fsrc%2Fexam-environment%2Fschemas%2Findex.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Fschemas%2Findex.ts?ref=27e8bf9da04911993682e4ee431c0059953a41d5",
            "patch": "@@ -2,3 +2,4 @@ export { examEnvironmentPostExamAttempt } from './exam-attempt';\n export { examEnvironmentPostExamGeneratedExam } from './exam-generated-exam';\n export { examEnvironmentPostScreenshot } from './screenshot';\n export { examEnvironmentTokenVerify } from './token-verify';\n+export { examEnvironmentExams } from './exams';"
        }
    ],
    "stats": {
        "total": 110,
        "additions": 110,
        "deletions": 0
    }
}