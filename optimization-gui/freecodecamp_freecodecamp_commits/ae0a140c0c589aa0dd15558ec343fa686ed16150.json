{
    "author": "ojeytonwilliams",
    "message": "refactor(api): clean up test dbs when tests finish (#63149)",
    "sha": "ae0a140c0c589aa0dd15558ec343fa686ed16150",
    "files": [
        {
            "sha": "8cf8318ce9f96f484a3f89addbff9264616bd17f",
            "filename": "api/src/plugins/auth-dev.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ae0a140c0c589aa0dd15558ec343fa686ed16150/api%2Fsrc%2Fplugins%2Fauth-dev.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ae0a140c0c589aa0dd15558ec343fa686ed16150/api%2Fsrc%2Fplugins%2Fauth-dev.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fauth-dev.test.ts?ref=ae0a140c0c589aa0dd15558ec343fa686ed16150",
            "patch": "@@ -40,6 +40,7 @@ describe('dev login', () => {\n     await fastify.prisma.user.deleteMany({\n       where: { email: defaultUserEmail }\n     });\n+    await fastify.prisma.$runCommandRaw({ dropDatabase: 1 });\n     await fastify.close();\n   });\n "
        },
        {
            "sha": "a9eb10a00d852c67a91c6db5a6f9674de498d70b",
            "filename": "api/src/plugins/auth0.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ae0a140c0c589aa0dd15558ec343fa686ed16150/api%2Fsrc%2Fplugins%2Fauth0.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ae0a140c0c589aa0dd15558ec343fa686ed16150/api%2Fsrc%2Fplugins%2Fauth0.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fauth0.test.ts?ref=ae0a140c0c589aa0dd15558ec343fa686ed16150",
            "patch": "@@ -43,6 +43,7 @@ describe('auth0 plugin', () => {\n   });\n \n   afterAll(async () => {\n+    await fastify.prisma.$runCommandRaw({ dropDatabase: 1 });\n     await fastify.close();\n   });\n "
        },
        {
            "sha": "d390addc6813eaeab96ad7767973215e72a4d331",
            "filename": "api/src/routes/helpers/auth-helpers.test.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ae0a140c0c589aa0dd15558ec343fa686ed16150/api%2Fsrc%2Froutes%2Fhelpers%2Fauth-helpers.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ae0a140c0c589aa0dd15558ec343fa686ed16150/api%2Fsrc%2Froutes%2Fhelpers%2Fauth-helpers.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fhelpers%2Fauth-helpers.test.ts?ref=ae0a140c0c589aa0dd15558ec343fa686ed16150",
            "patch": "@@ -1,4 +1,12 @@\n-import { describe, test, expect, beforeAll, afterEach, vi } from 'vitest';\n+import {\n+  describe,\n+  test,\n+  expect,\n+  beforeAll,\n+  afterEach,\n+  afterAll,\n+  vi\n+} from 'vitest';\n import Fastify, { FastifyInstance } from 'fastify';\n \n import db from '../../db/prisma.js';\n@@ -24,6 +32,11 @@ describe('findOrCreateUser', () => {\n     fastify = await setupServer();\n   });\n \n+  afterAll(async () => {\n+    await fastify.prisma.$runCommandRaw({ dropDatabase: 1 });\n+    await fastify.close();\n+  });\n+\n   afterEach(async () => {\n     await fastify.prisma.user.deleteMany({ where: { email } });\n     await fastify.close();"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 16,
        "deletions": 1
    }
}