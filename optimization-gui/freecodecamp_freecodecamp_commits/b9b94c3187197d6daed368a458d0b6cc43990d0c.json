{
    "author": "Sembauke",
    "message": "feat(api): add logging to bouncer (#59056)",
    "sha": "b9b94c3187197d6daed368a458d0b6cc43990d0c",
    "files": [
        {
            "sha": "36deb181d6e374076ef33af3153e4e68b47e8b24",
            "filename": "api/src/plugins/bouncer.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/b9b94c3187197d6daed368a458d0b6cc43990d0c/api%2Fsrc%2Fplugins%2Fbouncer.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/b9b94c3187197d6daed368a458d0b6cc43990d0c/api%2Fsrc%2Fplugins%2Fbouncer.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fbouncer.ts?ref=b9b94c3187197d6daed368a458d0b6cc43990d0c",
            "patch": "@@ -19,6 +19,12 @@ const plugin: FastifyPluginCallback = (fastify, _options, done) => {\n     'send401IfNoUser',\n     async function (req: FastifyRequest, reply: FastifyReply) {\n       if (!req.user) {\n+        const logger = fastify.log.child({ req });\n+\n+        logger.debug(\n+          'User tried to access a protected route without being authenticated.'\n+        );\n+\n         await reply.status(401).send({\n           type: req.accessDeniedMessage?.type,\n           message: req.accessDeniedMessage?.content\n@@ -30,7 +36,11 @@ const plugin: FastifyPluginCallback = (fastify, _options, done) => {\n   fastify.decorate(\n     'redirectIfNoUser',\n     async function (req: FastifyRequest, reply: FastifyReply) {\n+      const logger = fastify.log.child({ req });\n       if (!req.user) {\n+        logger.debug(\n+          'User tried to access a protected route without being authenticated.'\n+        );\n         const { origin } = getRedirectParams(req);\n         await reply.redirectWithMessage(origin, {\n           type: 'info',\n@@ -45,7 +55,12 @@ const plugin: FastifyPluginCallback = (fastify, _options, done) => {\n     'redirectIfSignedIn',\n     async function (req: FastifyRequest, reply: FastifyReply) {\n       if (req.user) {\n+        const logger = fastify.log.child({ req });\n+\n         const { returnTo } = getRedirectParams(req);\n+\n+        logger.debug(`User is being redirected to: ${returnTo}`);\n+\n         await reply.redirect(returnTo);\n       }\n     }"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 15,
        "deletions": 0
    }
}