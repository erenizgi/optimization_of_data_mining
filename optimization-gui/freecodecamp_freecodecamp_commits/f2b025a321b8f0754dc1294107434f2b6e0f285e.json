{
    "author": "ojeytonwilliams",
    "message": "fix(client): cancel all character timeouts (#58116)",
    "sha": "f2b025a321b8f0754dc1294107434f2b6e0f285e",
    "files": [
        {
            "sha": "788db7e89142e49c06b23abeb8fea15efa5d8e42",
            "filename": "client/src/templates/Challenges/components/scene/character.tsx",
            "status": "modified",
            "additions": 33,
            "deletions": 20,
            "changes": 53,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f2b025a321b8f0754dc1294107434f2b6e0f285e/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fcharacter.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f2b025a321b8f0754dc1294107434f2b6e0f285e/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fcharacter.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Fscene%2Fcharacter.tsx?ref=f2b025a321b8f0754dc1294107434f2b6e0f285e",
            "patch": "@@ -19,6 +19,10 @@ interface CharacterStyles {\n   opacity?: number;\n }\n \n+function getRandomInt(min: number, max: number): number {\n+  return Math.floor(Math.random() * (max - min + 1)) + min;\n+}\n+\n export function Character({\n   position,\n   opacity,\n@@ -30,55 +34,64 @@ export function Character({\n   const [mouthIsOpen, setMouthIsOpen] = useState(false);\n \n   useEffect(() => {\n-    let blinkInterval: NodeJS.Timeout | null = null;\n-    let talkInterval: NodeJS.Timeout | null = null;\n+    let blinkIntervalId: NodeJS.Timeout;\n+    let blinkTimeoutId: NodeJS.Timeout;\n \n     if (isBlinking) {\n-      const msBetweenIntervals = Math.floor(Math.random() * 3000) + 2000;\n-      blinkInterval = setInterval(() => {\n-        const msBlinkDelay = Math.floor(Math.random() * 1000);\n-        setTimeout(() => {\n+      const blinkPeriod = getRandomInt(2000, 5000);\n+      blinkIntervalId = setInterval(() => {\n+        const blinkJitter = getRandomInt(0, 1000);\n+        blinkTimeoutId = setTimeout(() => {\n           setEyesAreOpen(false);\n \n-          setTimeout(() => {\n+          blinkTimeoutId = setTimeout(() => {\n             setEyesAreOpen(true);\n           }, 30); // always unblink after 30ms\n-        }, msBlinkDelay);\n-      }, msBetweenIntervals);\n+        }, blinkJitter);\n+      }, blinkPeriod);\n     }\n \n+    // Clear intervals when component is unmounted or conditions change\n+    return () => {\n+      setEyesAreOpen(true);\n+      clearInterval(blinkIntervalId);\n+      clearTimeout(blinkTimeoutId);\n+    };\n+  }, [isBlinking]);\n+\n+  useEffect(() => {\n+    let talkIntervalId: NodeJS.Timeout;\n+    let mouthOpenTimeoutId: NodeJS.Timeout;\n+    let mouthCloseTimeoutId: NodeJS.Timeout;\n+\n     if (isTalking) {\n       const talk = () => {\n         const openTimeout = getRandomInt(0, 100);\n         const closeTimeout = getRandomInt(150, 300);\n \n-        setTimeout(() => {\n+        mouthOpenTimeoutId = setTimeout(() => {\n           setMouthIsOpen(true);\n         }, openTimeout);\n \n-        setTimeout(() => {\n+        mouthCloseTimeoutId = setTimeout(() => {\n           setMouthIsOpen(false);\n         }, closeTimeout);\n       };\n \n       talk();\n-      talkInterval = setInterval(() => {\n+      talkIntervalId = setInterval(() => {\n         talk();\n       }, 300);\n     }\n \n-    function getRandomInt(min: number, max: number): number {\n-      return Math.floor(Math.random() * (max - min + 1)) + min;\n-    }\n-\n     // Clear intervals when component is unmounted or conditions change\n     return () => {\n-      setEyesAreOpen(true);\n       setMouthIsOpen(false);\n-      if (blinkInterval) clearInterval(blinkInterval);\n-      if (talkInterval) clearInterval(talkInterval);\n+      clearInterval(talkIntervalId);\n+      clearTimeout(mouthOpenTimeoutId);\n+      clearTimeout(mouthCloseTimeoutId);\n     };\n-  }, [isBlinking, isTalking]);\n+  }, [isTalking]);\n \n   const characterWrapStyles: CharacterStyles = {\n     opacity"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 33,
        "deletions": 20
    }
}