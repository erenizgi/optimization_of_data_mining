{
    "author": "huyenltnguyen",
    "message": "feat(challenge-helper): auto add prefix to new language block (#63048)",
    "sha": "73f216ab7a5b28c1f5507ef78c9990e2a0a58963",
    "files": [
        {
            "sha": "7cbca199012269b2467aac16c78cf0482b7186f8",
            "filename": "tools/challenge-helper-scripts/create-language-block.ts",
            "status": "modified",
            "additions": 96,
            "deletions": 16,
            "changes": 112,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/73f216ab7a5b28c1f5507ef78c9990e2a0a58963/tools%2Fchallenge-helper-scripts%2Fcreate-language-block.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/73f216ab7a5b28c1f5507ef78c9990e2a0a58963/tools%2Fchallenge-helper-scripts%2Fcreate-language-block.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fchallenge-helper-scripts%2Fcreate-language-block.ts?ref=73f216ab7a5b28c1f5507ef78c9990e2a0a58963",
            "patch": "@@ -10,6 +10,7 @@ import {\n   languageSuperBlocks,\n   chapterBasedSuperBlocks\n } from '../../shared/config/curriculum';\n+\n import { BlockLayouts, BlockLabel } from '../../shared/config/blocks';\n import {\n   getContentConfig,\n@@ -51,7 +52,7 @@ interface CreateBlockArgs {\n   chapter?: string;\n   module?: string;\n   position?: number;\n-  blockLabel?: string;\n+  blockLabel?: BlockLabel;\n   blockLayout?: string;\n   questionCount?: number;\n }\n@@ -64,7 +65,7 @@ async function createLanguageBlock(\n   chapter?: string,\n   module?: string,\n   position?: number,\n-  blockLabel?: string,\n+  blockLabel?: BlockLabel,\n   blockLayout?: string,\n   questionCount?: number\n ) {\n@@ -142,7 +143,7 @@ async function createMetaJson(\n   title: string,\n   helpCategory: string,\n   challengeId: ObjectID,\n-  blockLabel?: string,\n+  blockLabel?: BlockLabel,\n   blockLayout?: string\n ) {\n   const newMeta = getBaseMeta('Language');\n@@ -227,6 +228,45 @@ function withTrace<Args extends unknown[], Result>(\n   });\n }\n \n+function getBlockPrefix(\n+  superBlock: SuperBlocks,\n+  blockLabel?: BlockLabel\n+): string | null {\n+  // Only chapter-based super blocks use blockLabel so prefix only applies to them.\n+  if (!chapterBasedSuperBlocks.includes(superBlock)) return null;\n+\n+  let langLevel;\n+\n+  switch (superBlock) {\n+    case SuperBlocks.A2English:\n+      langLevel = 'en-a2';\n+      break;\n+    case SuperBlocks.B1English:\n+      langLevel = 'en-b1';\n+      break;\n+    case SuperBlocks.A1Spanish:\n+      langLevel = 'es-a1';\n+      break;\n+    case SuperBlocks.A2Spanish:\n+      langLevel = 'es-a2';\n+      break;\n+    case SuperBlocks.A1Chinese:\n+      langLevel = 'zh-a1';\n+      break;\n+    case SuperBlocks.A2Chinese:\n+      langLevel = 'zh-a2';\n+      break;\n+    default:\n+      langLevel = superBlock;\n+  }\n+\n+  if (blockLabel === BlockLabel.exam) {\n+    return `${langLevel}-`;\n+  }\n+\n+  return `${langLevel}-${blockLabel}-`;\n+}\n+\n void getAllBlocks()\n   .then(existingBlocks =>\n     prompt([\n@@ -237,12 +277,61 @@ void getAllBlocks()\n         type: 'list',\n         choices: Object.values(languageSuperBlocks)\n       },\n+      {\n+        name: 'blockLabel',\n+        message: 'Choose a block label',\n+        default: BlockLabel.learn,\n+        type: 'list',\n+        choices: Object.values(BlockLabel),\n+        when: (answers: CreateBlockArgs) =>\n+          chapterBasedSuperBlocks.includes(answers.superBlock)\n+      },\n       {\n         name: 'block',\n-        message: 'What is the dashed name (in kebab-case) for this block?',\n-        validate: (block: string) => validateBlockName(block, existingBlocks),\n-        filter: (block: string) => {\n-          return block.toLowerCase().trim();\n+        message: (answers: CreateBlockArgs) => {\n+          const prefix = getBlockPrefix(answers.superBlock, answers.blockLabel);\n+          return prefix\n+            ? `Complete the dashed name after the prefix below.\\nPrefix: ${prefix}`\n+            : 'What is the dashed name (in kebab-case) for this block?';\n+        },\n+        validate: (block: string, answers: CreateBlockArgs) => {\n+          const prefix = getBlockPrefix(answers.superBlock, answers.blockLabel);\n+\n+          if (prefix) {\n+            const uniquePart = block.slice(prefix.length);\n+\n+            // Check if user accidentally included block label at the end\n+            if (answers.blockLabel) {\n+              // Exclude exam as it is an exception\n+              const blockLabelValues = Object.values(BlockLabel).filter(\n+                label => label !== BlockLabel.exam\n+              );\n+\n+              const endsWithLabel = blockLabelValues.some(label =>\n+                uniquePart.endsWith(`-${label}`)\n+              );\n+\n+              if (endsWithLabel) {\n+                return `Block name should not end with a block label (e.g., '-${answers.blockLabel}'). The label is already in the prefix.`;\n+              }\n+            }\n+          }\n+\n+          return validateBlockName(block, existingBlocks);\n+        },\n+        filter: (block: string, answers: CreateBlockArgs) => {\n+          const prefix = getBlockPrefix(answers.superBlock, answers.blockLabel);\n+          const normalized = block.toLowerCase().trim();\n+\n+          if (prefix) {\n+            // Strip prefix if already present (happens on re-validation), then re-add it\n+            const withoutPrefix = normalized.startsWith(prefix)\n+              ? normalized.slice(prefix.length)\n+              : normalized;\n+            return prefix + withoutPrefix;\n+          }\n+\n+          return normalized;\n         }\n       },\n       {\n@@ -256,15 +345,6 @@ void getAllBlocks()\n         type: 'list',\n         choices: helpCategories\n       },\n-      {\n-        name: 'blockLabel',\n-        message: 'Choose a block label',\n-        default: BlockLabel.learn,\n-        type: 'list',\n-        choices: Object.values(BlockLabel),\n-        when: (answers: CreateBlockArgs) =>\n-          chapterBasedSuperBlocks.includes(answers.superBlock)\n-      },\n       {\n         name: 'blockLayout',\n         message: 'Choose a block layout',"
        }
    ],
    "stats": {
        "total": 112,
        "additions": 96,
        "deletions": 16
    }
}