{
    "author": "raisedadead",
    "message": "feat(api): add deployment version endpoint (#59841)",
    "sha": "ae720e82820b300eec02b44db3cba88869db8c2d",
    "files": [
        {
            "sha": "744784b591de1a016167c7e83a43fe3acba9f045",
            "filename": "api/src/routes/public/status.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ae720e82820b300eec02b44db3cba88869db8c2d/api%2Fsrc%2Froutes%2Fpublic%2Fstatus.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ae720e82820b300eec02b44db3cba88869db8c2d/api%2Fsrc%2Froutes%2Fpublic%2Fstatus.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fpublic%2Fstatus.test.ts?ref=ae720e82820b300eec02b44db3cba88869db8c2d",
            "patch": "@@ -1,4 +1,5 @@\n import { setupServer, superRequest } from '../../../jest.utils';\n+import { DEPLOYMENT_VERSION } from '../../utils/env';\n \n describe('/status', () => {\n   setupServer();\n@@ -11,4 +12,13 @@ describe('/status', () => {\n     expect(response.body).toStrictEqual({ msg: 'pong' });\n     expect(response.status).toBe(200);\n   });\n+\n+  test('GET returns 200 status code with version', async () => {\n+    const response = await superRequest('/status/version', {\n+      method: 'GET'\n+    });\n+\n+    expect(response.body).toStrictEqual({ version: DEPLOYMENT_VERSION });\n+    expect(response.status).toBe(200);\n+  });\n });"
        },
        {
            "sha": "b5b21089507b4e1e141b6ce79aa2a708901b76ca",
            "filename": "api/src/routes/public/status.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ae720e82820b300eec02b44db3cba88869db8c2d/api%2Fsrc%2Froutes%2Fpublic%2Fstatus.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ae720e82820b300eec02b44db3cba88869db8c2d/api%2Fsrc%2Froutes%2Fpublic%2Fstatus.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fpublic%2Fstatus.ts?ref=ae720e82820b300eec02b44db3cba88869db8c2d",
            "patch": "@@ -1,5 +1,7 @@\n import { type FastifyPluginCallbackTypebox } from '@fastify/type-provider-typebox';\n \n+import { DEPLOYMENT_VERSION } from '../../utils/env';\n+\n /**\n  * Plugin for the health check endpoint.\n  *\n@@ -18,5 +20,10 @@ export const statusRoute: FastifyPluginCallbackTypebox = (\n     return { msg: 'pong' };\n   });\n \n+  fastify.get('/status/version', async (req, _reply) => {\n+    fastify.log.child({ req }).debug('version');\n+    return { version: DEPLOYMENT_VERSION };\n+  });\n+\n   done();\n };"
        },
        {
            "sha": "45112bf9c11229af1a20952375bec4a791bbee1d",
            "filename": "api/src/utils/env.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ae720e82820b300eec02b44db3cba88869db8c2d/api%2Fsrc%2Futils%2Fenv.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ae720e82820b300eec02b44db3cba88869db8c2d/api%2Fsrc%2Futils%2Fenv.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Futils%2Fenv.ts?ref=ae720e82820b300eec02b44db3cba88869db8c2d",
            "patch": "@@ -90,6 +90,7 @@ if (process.env.FREECODECAMP_NODE_ENV !== 'development') {\n   assert.notEqual(process.env.COOKIE_SECRET, 'a_cookie_secret');\n   assert.ok(process.env.SENTRY_DSN);\n   assert.ok(process.env.SENTRY_ENVIRONMENT);\n+  assert.ok(process.env.DEPLOYMENT_VERSION);\n   // The following values can exist in development, but production-like\n   // environments need to override the defaults.\n   assert.notEqual(\n@@ -210,3 +211,4 @@ function undefinedOrBool(val: string | undefined): undefined | boolean {\n }\n export const SCREENSHOT_SERVICE_LOCATION =\n   process.env.SCREENSHOT_SERVICE_LOCATION;\n+export const DEPLOYMENT_VERSION = process.env.DEPLOYMENT_VERSION || 'unknown';"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 19,
        "deletions": 0
    }
}