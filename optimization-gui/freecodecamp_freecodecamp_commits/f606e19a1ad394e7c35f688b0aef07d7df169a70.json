{
    "author": "ojeytonwilliams",
    "message": "feat(client): truncate long logs in the client rather than test evaluator (#60235)",
    "sha": "f606e19a1ad394e7c35f688b0aef07d7df169a70",
    "files": [
        {
            "sha": "3d30a9bb55dca95fc3bfdf5e52d7a1d08a56118d",
            "filename": "client/src/templates/Challenges/classic/multifile-editor.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 10,
            "changes": 12,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f606e19a1ad394e7c35f688b0aef07d7df169a70/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fmultifile-editor.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f606e19a1ad394e7c35f688b0aef07d7df169a70/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fmultifile-editor.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fmultifile-editor.tsx?ref=f606e19a1ad394e7c35f688b0aef07d7df169a70",
            "patch": "@@ -5,7 +5,6 @@ import { createSelector } from 'reselect';\n import { isDonationModalOpenSelector } from '../../../redux/selectors';\n import {\n   canFocusEditorSelector,\n-  consoleOutputSelector,\n   visibleEditorsSelector\n } from '../redux/selectors';\n import { getTargetEditor } from '../utils/get-target-editor';\n@@ -44,17 +43,10 @@ type MultifileEditorProps = Pick<\n const mapStateToProps = createSelector(\n   visibleEditorsSelector,\n   canFocusEditorSelector,\n-  consoleOutputSelector,\n   isDonationModalOpenSelector,\n-  (\n-    visibleEditors: VisibleEditors,\n-    canFocus: boolean,\n-    output: string[],\n-    open\n-  ) => ({\n+  (visibleEditors: VisibleEditors, canFocus: boolean, open) => ({\n     visibleEditors,\n-    canFocus: open ? false : canFocus,\n-    output\n+    canFocus: open ? false : canFocus\n   })\n );\n "
        },
        {
            "sha": "47f2835ffdbf5076ebd0318fe7ea59982e984d63",
            "filename": "client/src/templates/Challenges/classic/show.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f606e19a1ad394e7c35f688b0aef07d7df169a70/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f606e19a1ad394e7c35f688b0aef07d7df169a70/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fshow.tsx?ref=f606e19a1ad394e7c35f688b0aef07d7df169a70",
            "patch": "@@ -76,7 +76,7 @@ import '../components/test-frame.css';\n \n const mapStateToProps = (state: unknown) => ({\n   challengeFiles: challengeFilesSelector(state) as ChallengeFiles,\n-  output: consoleOutputSelector(state) as string[],\n+  output: consoleOutputSelector(state) as string,\n   isChallengeCompleted: isChallengeCompletedSelector(state) as boolean,\n   savedChallenges: savedChallengesSelector(state) as SavedChallenge[]\n });\n@@ -113,7 +113,7 @@ interface ShowClassicProps extends Pick<PreviewProps, 'previewMounted'> {\n   initHooks: (hooks?: { beforeAll: string }) => void;\n   initVisibleEditors: () => void;\n   isChallengeCompleted: boolean;\n-  output: string[];\n+  output: string;\n   pageContext: {\n     challengeMeta: ChallengeMeta;\n     projectPreview: {"
        },
        {
            "sha": "56f91edcc992685dd04fa273387a232e7b1cf63e",
            "filename": "client/src/templates/Challenges/components/output.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f606e19a1ad394e7c35f688b0aef07d7df169a70/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Foutput.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f606e19a1ad394e7c35f688b0aef07d7df169a70/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Foutput.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Foutput.tsx?ref=f606e19a1ad394e7c35f688b0aef07d7df169a70",
            "patch": "@@ -7,16 +7,13 @@ import './output.css';\n \n interface OutputProps {\n   defaultOutput: string;\n-  output: string[];\n+  output: string;\n }\n \n function Output({ defaultOutput, output }: OutputProps): JSX.Element {\n-  const message = sanitizeHtml(\n-    !isEmpty(output) ? output.join('\\n') : defaultOutput,\n-    {\n-      allowedTags: ['b', 'i', 'em', 'strong', 'code', 'wbr']\n-    }\n-  );\n+  const message = sanitizeHtml(!isEmpty(output) ? output : defaultOutput, {\n+    allowedTags: ['b', 'i', 'em', 'strong', 'code', 'wbr']\n+  });\n   return (\n     <pre\n       className='output-text'"
        },
        {
            "sha": "c697aa9f47e8584dc52acf71c3a0afd44bec6eed",
            "filename": "client/src/templates/Challenges/projects/backend/show.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f606e19a1ad394e7c35f688b0aef07d7df169a70/client%2Fsrc%2Ftemplates%2FChallenges%2Fprojects%2Fbackend%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f606e19a1ad394e7c35f688b0aef07d7df169a70/client%2Fsrc%2Ftemplates%2FChallenges%2Fprojects%2Fbackend%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fprojects%2Fbackend%2Fshow.tsx?ref=f606e19a1ad394e7c35f688b0aef07d7df169a70",
            "patch": "@@ -49,7 +49,7 @@ const mapStateToProps = createSelector(\n   isChallengeCompletedSelector,\n   isSignedInSelector,\n   (\n-    output: string[],\n+    output: string,\n     tests: Test[],\n     isChallengeCompleted: boolean,\n     isSignedIn: boolean\n@@ -82,7 +82,7 @@ interface BackEndProps {\n   initTests: (tests: Test[]) => void;\n   isChallengeCompleted: boolean;\n   isSignedIn: boolean;\n-  output: string[];\n+  output: string;\n   pageContext: {\n     challengeMeta: ChallengeMeta;\n   };"
        },
        {
            "sha": "9d97d9a619a509b4d6d91d7b6fc8a9d41f1009c8",
            "filename": "client/src/templates/Challenges/redux/selectors.js",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f606e19a1ad394e7c35f688b0aef07d7df169a70/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fselectors.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f606e19a1ad394e7c35f688b0aef07d7df169a70/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fselectors.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Fselectors.js?ref=f606e19a1ad394e7c35f688b0aef07d7df169a70",
            "patch": "@@ -18,7 +18,13 @@ export const challengeFilesSelector = state => state[ns].challengeFiles;\n export const challengeMetaSelector = state => state[ns].challengeMeta;\n export const challengeHooksSelector = state => state[ns].challengeHooks;\n export const challengeTestsSelector = state => state[ns].challengeTests;\n-export const consoleOutputSelector = state => state[ns].consoleOut;\n+export const consoleOutputSelector = state => {\n+  const TRUNCATE_AT = 500000;\n+  const out = state[ns].consoleOut?.join('\\n');\n+  return out?.length > TRUNCATE_AT\n+    ? `${out.substring(0, TRUNCATE_AT)} Logs truncated. See browser console for more`\n+    : out;\n+};\n export const isChallengeCompletedSelector = createSelector(\n   [completedChallengesIdsSelector, challengeMetaSelector],\n   (ids, meta) => ids.includes(meta.id)"
        },
        {
            "sha": "495904f9609981e0e336220c7dd70875678c43e7",
            "filename": "tools/client-plugins/browser-scripts/test-evaluator.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/f606e19a1ad394e7c35f688b0aef07d7df169a70/tools%2Fclient-plugins%2Fbrowser-scripts%2Ftest-evaluator.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/f606e19a1ad394e7c35f688b0aef07d7df169a70/tools%2Fclient-plugins%2Fbrowser-scripts%2Ftest-evaluator.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fclient-plugins%2Fbrowser-scripts%2Ftest-evaluator.ts?ref=f606e19a1ad394e7c35f688b0aef07d7df169a70",
            "patch": "@@ -8,19 +8,14 @@ const ctx: Worker & typeof globalThis = self as unknown as Worker &\n \n const __utils = (() => {\n   const MAX_LOGS_SIZE = 64 * 1024;\n-  const TRUNCATE_AT = 500_000;\n \n   let logs: string[] = [];\n \n   function flushLogs() {\n     if (logs.length) {\n-      let data = logs.join('\\n');\n-      if (data.length > TRUNCATE_AT) {\n-        data = `${data.substring(0, TRUNCATE_AT)} Logs truncated. See browser console for more`;\n-      }\n       ctx.postMessage({\n         type: 'LOG',\n-        data: data\n+        data: logs.join('\\n')\n       });\n       logs = [];\n     }"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 18,
        "deletions": 28
    }
}