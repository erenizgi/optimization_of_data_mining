{
    "author": "raisedadead",
    "message": "fix(api): catch GB init errors on prod only (#59912)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "3c822da24372ea9b0c0e40bf2252c70c76396427",
    "files": [
        {
            "sha": "3fe5740b4e82cfbd274968021964d59036b82ac4",
            "filename": "api/src/plugins/growth-book.test.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3c822da24372ea9b0c0e40bf2252c70c76396427/api%2Fsrc%2Fplugins%2Fgrowth-book.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3c822da24372ea9b0c0e40bf2252c70c76396427/api%2Fsrc%2Fplugins%2Fgrowth-book.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fgrowth-book.test.ts?ref=3c822da24372ea9b0c0e40bf2252c70c76396427",
            "patch": "@@ -1,6 +1,13 @@\n import Fastify, { type FastifyInstance } from 'fastify';\n import growthBook from './growth-book';\n \n+// eslint-disable-next-line @typescript-eslint/no-unsafe-return\n+jest.mock('../utils/env', () => ({\n+  ...jest.requireActual('../utils/env'),\n+  // We're only interested in the production behaviour\n+  FREECODECAMP_NODE_ENV: 'production'\n+}));\n+\n const captureException = jest.fn();\n \n describe('growth-book', () => {"
        },
        {
            "sha": "6d81bc19ad413164b6ba16aeb57bf67e1ecf08fb",
            "filename": "api/src/plugins/growth-book.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/3c822da24372ea9b0c0e40bf2252c70c76396427/api%2Fsrc%2Fplugins%2Fgrowth-book.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/3c822da24372ea9b0c0e40bf2252c70c76396427/api%2Fsrc%2Fplugins%2Fgrowth-book.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fplugins%2Fgrowth-book.ts?ref=3c822da24372ea9b0c0e40bf2252c70c76396427",
            "patch": "@@ -2,6 +2,8 @@ import { GrowthBook, Options } from '@growthbook/growthbook';\n import { FastifyPluginAsync } from 'fastify';\n import fp from 'fastify-plugin';\n \n+import { FREECODECAMP_NODE_ENV } from '../utils/env';\n+\n declare module 'fastify' {\n   interface FastifyInstance {\n     gb: GrowthBook;\n@@ -12,7 +14,7 @@ const growthBook: FastifyPluginAsync<Options> = async (fastify, options) => {\n   const gb = new GrowthBook(options);\n   const res = await gb.init({ timeout: 3000 });\n \n-  if (res.error) {\n+  if (res.error && FREECODECAMP_NODE_ENV === 'production') {\n     fastify.log.error(res.error, 'Failed to initialize GrowthBook');\n     fastify.Sentry.captureException(res.error);\n   }"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 10,
        "deletions": 1
    }
}