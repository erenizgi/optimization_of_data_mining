{
    "author": "ojeytonwilliams",
    "message": "fix(client): handle reset after saving learner code (#55103)",
    "sha": "1d1a9daba3f8dab301215d204c44a74efb52a7e7",
    "files": [
        {
            "sha": "f62c801246bdb79ce1ae4645655e8525067e9b0e",
            "filename": "client/src/redux/save-challenge-saga.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/1d1a9daba3f8dab301215d204c44a74efb52a7e7/client%2Fsrc%2Fredux%2Fsave-challenge-saga.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/1d1a9daba3f8dab301215d204c44a74efb52a7e7/client%2Fsrc%2Fredux%2Fsave-challenge-saga.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fsave-challenge-saga.js?ref=1d1a9daba3f8dab301215d204c44a74efb52a7e7",
            "patch": "@@ -7,6 +7,7 @@ import {\n   challengeDataSelector,\n   challengeMetaSelector\n } from '../templates/Challenges/redux/selectors';\n+import { createFiles } from '../templates/Challenges/redux/actions';\n import { mapFilesToChallengeFiles, postSaveChallenge } from '../utils/ajax';\n import {\n   bodySizeFits,\n@@ -56,6 +57,7 @@ function* saveChallengeSaga() {\n         if (data?.message) {\n           yield put(createFlashMessage(data));\n         } else if (data?.savedChallenges) {\n+          yield put(createFiles(challengeFiles));\n           yield put(\n             saveChallengeComplete(\n               mapFilesToChallengeFiles(data.savedChallenges)"
        },
        {
            "sha": "0386fb3d346d580d7bcd14771d654840db8cc9cb",
            "filename": "client/src/templates/Challenges/redux/actions.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/1d1a9daba3f8dab301215d204c44a74efb52a7e7/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Factions.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/1d1a9daba3f8dab301215d204c44a74efb52a7e7/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Factions.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fredux%2Factions.js?ref=1d1a9daba3f8dab301215d204c44a74efb52a7e7",
            "patch": "@@ -14,7 +14,7 @@ export const createFiles = createAction(\n         challengeFile.editableRegionBoundaries\n       ),\n       seedEditableRegionBoundaries:\n-        challengeFile.editableRegionBoundaries?.slice()\n+        challengeFile.editableRegionBoundaries?.slice() ?? []\n     }))\n );\n "
        },
        {
            "sha": "c148c99597b81e9b9b987785d54e6e9871e02174",
            "filename": "e2e/challenge-reset-modal.spec.ts",
            "status": "modified",
            "additions": 119,
            "deletions": 33,
            "changes": 152,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/1d1a9daba3f8dab301215d204c44a74efb52a7e7/e2e%2Fchallenge-reset-modal.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/1d1a9daba3f8dab301215d204c44a74efb52a7e7/e2e%2Fchallenge-reset-modal.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fchallenge-reset-modal.spec.ts?ref=1d1a9daba3f8dab301215d204c44a74efb52a7e7",
            "patch": "@@ -1,15 +1,11 @@\n-import { test, expect } from '@playwright/test';\n+import { execSync } from 'child_process';\n+\n+import { test, expect, Page } from '@playwright/test';\n \n import translations from '../client/i18n/locales/english/translations.json';\n import { clearEditor, focusEditor, getEditors } from './utils/editor';\n \n-test('should render the modal content correctly', async ({ page }) => {\n-  await page.goto(\n-    '/learn/2022/responsive-web-design/learn-html-by-building-a-cat-photo-app/step-3'\n-  );\n-\n-  await page.getByRole('button', { name: translations.buttons.reset }).click();\n-\n+const expectToRenderResetModal = async (page: Page) => {\n   await expect(\n     page.getByRole('dialog', { name: translations.learn.reset })\n   ).toBeVisible();\n@@ -35,6 +31,16 @@ test('should render the modal content correctly', async ({ page }) => {\n       name: translations.buttons['reset-lesson']\n     })\n   ).toBeVisible();\n+};\n+\n+test('should render the modal content correctly', async ({ page }) => {\n+  await page.goto(\n+    '/learn/2022/responsive-web-design/learn-html-by-building-a-cat-photo-app/step-3'\n+  );\n+\n+  await page.getByRole('button', { name: translations.buttons.reset }).click();\n+\n+  await expectToRenderResetModal(page);\n });\n \n test('User can reset challenge', async ({ page, isMobile, browserName }) => {\n@@ -154,41 +160,121 @@ test('should close when the user clicks the close button', async ({ page }) => {\n   ).toBeHidden();\n });\n \n-test('User can reset on a multi-file project', async ({ page }) => {\n-  {\n+test('User can reset on a multi-file project', async ({\n+  page,\n+  isMobile,\n+  browserName\n+}) => {\n+  const sampleText = 'function palindrome() { return true; }';\n+\n+  await page.goto(\n+    '/learn/javascript-algorithms-and-data-structures-v8/build-a-palindrome-checker-project/build-a-palindrome-checker'\n+  );\n+\n+  await focusEditor({ page, isMobile });\n+  await clearEditor({ page, browserName });\n+  await getEditors(page).fill(sampleText);\n+  await expect(page.getByText(sampleText)).toBeVisible();\n+\n+  await page.getByRole('button', { name: translations.buttons.reset }).click();\n+\n+  await expectToRenderResetModal(page);\n+\n+  await page\n+    .getByRole('button', {\n+      name: translations.buttons['reset-lesson']\n+    })\n+    .click();\n+\n+  await expect(page.getByText(sampleText)).not.toBeVisible();\n+});\n+\n+test.describe('Signed in user', () => {\n+  test.use({ storageState: 'playwright/.auth/development-user.json' });\n+\n+  test.beforeEach(() => {\n+    execSync('node ./tools/scripts/seed/seed-demo-user');\n+  });\n+\n+  test.afterEach(() => {\n+    execSync('node ./tools/scripts/seed/seed-demo-user certified-user');\n+  });\n+\n+  test('User can reset on a multi-file project after reloading and saving', async ({\n+    page,\n+    isMobile,\n+    browserName\n+  }) => {\n+    test.setTimeout(60000);\n+    const savedText = 'function palindrome() { return true; }';\n+    const updatedText = 'function palindrome() { return false; }';\n+\n     await page.goto(\n       '/learn/javascript-algorithms-and-data-structures-v8/build-a-palindrome-checker-project/build-a-palindrome-checker'\n     );\n+\n+    // This first edit should reappear after the reset\n+    await focusEditor({ page, isMobile });\n+    await clearEditor({ page, browserName });\n+    await getEditors(page).fill(savedText);\n+    await page.keyboard.press('Control+S');\n+\n+    await page.reload();\n+\n+    // This second edit should be reset\n+    await focusEditor({ page, isMobile });\n+    await clearEditor({ page, browserName });\n+    await getEditors(page).fill(updatedText);\n+\n     await page\n       .getByRole('button', { name: translations.buttons.reset })\n       .click();\n \n-    await expect(\n-      page.getByRole('dialog', { name: translations.learn.reset })\n-    ).toBeVisible();\n-\n-    await expect(\n-      page.getByRole('button', {\n-        name: translations.buttons.close\n-      })\n-    ).toBeVisible();\n-    await expect(\n-      page.getByRole('heading', {\n-        name: translations.learn.reset\n+    await page\n+      .getByRole('button', {\n+        name: translations.buttons['reset-lesson']\n       })\n-    ).toBeVisible();\n+      .click();\n \n-    await expect(\n-      page.getByText(translations.learn['reset-warn'])\n-    ).toBeVisible();\n-    await expect(\n-      page.getByText(translations.learn['reset-warn-2'])\n-    ).toBeVisible();\n+    await expect(page.getByText(updatedText)).not.toBeVisible();\n+    await expect(page.getByText(savedText)).toBeVisible();\n+  });\n+\n+  test('User can reset on a multi-file project without reloading', async ({\n+    page,\n+    isMobile,\n+    browserName\n+  }) => {\n+    test.setTimeout(60000);\n+    const savedText = 'function palindrome() { return true; }';\n+    const updatedText = 'function palindrome() { return false; }';\n+\n+    await page.goto(\n+      '/learn/javascript-algorithms-and-data-structures-v8/build-a-palindrome-checker-project/build-a-palindrome-checker'\n+    );\n+\n+    // This first edit should reappear after the reset\n+    await focusEditor({ page, isMobile });\n+    await clearEditor({ page, browserName });\n+    await getEditors(page).fill(savedText);\n+    await page.keyboard.press('Control+S');\n+\n+    // This second edit should be reset\n+    await focusEditor({ page, isMobile });\n+    await clearEditor({ page, browserName });\n+    await getEditors(page).fill(updatedText);\n \n-    await expect(\n-      page.getByRole('button', {\n+    await page\n+      .getByRole('button', { name: translations.buttons.reset })\n+      .click();\n+\n+    await page\n+      .getByRole('button', {\n         name: translations.buttons['reset-lesson']\n       })\n-    ).toBeVisible();\n-  }\n+      .click();\n+\n+    await expect(page.getByText(updatedText)).not.toBeVisible();\n+    await expect(page.getByText(savedText)).toBeVisible();\n+  });\n });"
        }
    ],
    "stats": {
        "total": 156,
        "additions": 122,
        "deletions": 34
    }
}