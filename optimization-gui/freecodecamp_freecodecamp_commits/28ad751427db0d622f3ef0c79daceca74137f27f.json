{
    "author": "ojeytonwilliams",
    "message": "refactor(client): data sourcing for super-block-intro (#55751)",
    "sha": "28ad751427db0d622f3ef0c79daceca74137f27f",
    "files": [
        {
            "sha": "737732b2c514bb6cbd0dbca611a27026d50442e8",
            "filename": "client/src/templates/Introduction/components/block.test.tsx",
            "status": "modified",
            "additions": 57,
            "deletions": 57,
            "changes": 114,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/28ad751427db0d622f3ef0c79daceca74137f27f/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fblock.test.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/28ad751427db0d622f3ef0c79daceca74137f27f/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fblock.test.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fblock.test.tsx?ref=28ad751427db0d622f3ef0c79daceca74137f27f",
            "patch": "@@ -13,72 +13,72 @@ import {\n   BilibiliIds\n } from '../../../redux/prop-types';\n import { isAuditedSuperBlock } from '../../../../../shared/utils/is-audited';\n+import { BlockTypes } from '../../../../../shared/config/blocks';\n import Block from './block';\n \n jest.mock('../../../../../shared/utils/is-audited', () => ({\n   isAuditedSuperBlock: jest.fn().mockReturnValueOnce(true)\n }));\n \n const defaultProps = {\n-  blockDashedName: 'test-block',\n+  block: 'test-block',\n   challenges: [\n     {\n-      challenge: {\n-        block: 'testblock',\n-        certification: 'mockCertification',\n-        challengeOrder: 1,\n-        challengeType: 0,\n-        dashedName: 'mock-dashed-name',\n-        description: 'mockDescription',\n-        challengeFiles: {} as ChallengeFiles,\n-        fields: {} as Fields,\n-        forumTopicId: 12345,\n-        guideUrl: 'https://mockurl.com',\n-        head: ['mockHead'],\n-        hasEditableBoundaries: false,\n-        helpCategory: 'mockHelpCategory',\n-        id: 'mockId',\n-        instructions: 'mockInstructions',\n-        isComingSoon: false,\n-        internal: {\n-          content: 'mockContent',\n-          contentDigest: 'mockContentDigest',\n-          description: 'mockInternalDescription',\n-          fieldOwners: ['mockOwner'],\n-          ignoreType: null,\n-          mediaType: 'mockMediaType',\n-          owner: 'mockOwner',\n-          type: 'mockType'\n-        },\n-        notes: 'mockNotes',\n-        prerequisites: [] as PrerequisiteChallenge[],\n-        isLocked: false,\n-        isPrivate: false,\n-        order: 1,\n-        questions: [] as Question[],\n-        assignments: ['mockAssignment'],\n-        required: [],\n-        solutions: {\n-          ['indexhtml']: {} as FileKeyChallenge,\n-          ['scriptjs']: {} as FileKeyChallenge,\n-          ['stylescss']: {} as FileKeyChallenge,\n-          ['indexjsx']: {} as FileKeyChallenge\n-        },\n-        sourceInstanceName: 'mockSourceInstanceName',\n-        superOrder: 1,\n-        superBlock: SuperBlocks.UpcomingPython,\n-        tail: ['mockTail'],\n-        template: 'mockTemplate',\n-        tests: [] as Test[],\n-        title: 'mockTitle',\n-        translationPending: false,\n-        url: 'https://mockurl.com',\n-        usesMultifileEditor: false,\n-        videoId: 'mockVideoId',\n-        videoLocaleIds: {},\n-        bilibiliIds: {} as BilibiliIds,\n-        videoUrl: 'https://mockvideourl.com'\n-      }\n+      block: 'testblock',\n+      blockType: BlockTypes.lab,\n+      certification: 'mockCertification',\n+      challengeOrder: 1,\n+      challengeType: 0,\n+      dashedName: 'mock-dashed-name',\n+      description: 'mockDescription',\n+      challengeFiles: {} as ChallengeFiles,\n+      fields: {} as Fields,\n+      forumTopicId: 12345,\n+      guideUrl: 'https://mockurl.com',\n+      head: ['mockHead'],\n+      hasEditableBoundaries: false,\n+      helpCategory: 'mockHelpCategory',\n+      id: 'mockId',\n+      instructions: 'mockInstructions',\n+      isComingSoon: false,\n+      internal: {\n+        content: 'mockContent',\n+        contentDigest: 'mockContentDigest',\n+        description: 'mockInternalDescription',\n+        fieldOwners: ['mockOwner'],\n+        ignoreType: null,\n+        mediaType: 'mockMediaType',\n+        owner: 'mockOwner',\n+        type: 'mockType'\n+      },\n+      notes: 'mockNotes',\n+      prerequisites: [] as PrerequisiteChallenge[],\n+      isLocked: false,\n+      isPrivate: false,\n+      order: 1,\n+      questions: [] as Question[],\n+      assignments: ['mockAssignment'],\n+      required: [],\n+      solutions: {\n+        ['indexhtml']: {} as FileKeyChallenge,\n+        ['scriptjs']: {} as FileKeyChallenge,\n+        ['stylescss']: {} as FileKeyChallenge,\n+        ['indexjsx']: {} as FileKeyChallenge\n+      },\n+      sourceInstanceName: 'mockSourceInstanceName',\n+      superOrder: 1,\n+      superBlock: SuperBlocks.UpcomingPython,\n+      tail: ['mockTail'],\n+      template: 'mockTemplate',\n+      tests: [] as Test[],\n+      title: 'mockTitle',\n+      translationPending: false,\n+      url: 'https://mockurl.com',\n+      usesMultifileEditor: false,\n+      videoId: 'mockVideoId',\n+      videoLocaleIds: {},\n+      bilibiliIds: {} as BilibiliIds,\n+      videoUrl: 'https://mockvideourl.com'\n     }\n   ],\n   completedChallengeIds: ['testchallengeIds'],"
        },
        {
            "sha": "b98c6a9af9f0ccecf846f10e4c4322da94c9306e",
            "filename": "client/src/templates/Introduction/components/block.tsx",
            "status": "modified",
            "additions": 21,
            "deletions": 22,
            "changes": 43,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/28ad751427db0d622f3ef0c79daceca74137f27f/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fblock.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/28ad751427db0d622f3ef0c79daceca74137f27f/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fblock.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FIntroduction%2Fcomponents%2Fblock.tsx?ref=28ad751427db0d622f3ef0c79daceca74137f27f",
            "patch": "@@ -26,11 +26,10 @@ import '../intro.css';\n \n const { curriculumLocale, showUpcomingChanges, showNewCurriculum } = envData;\n \n-const mapStateToProps = (\n-  state: unknown,\n-  ownProps: { blockDashedName: string }\n-) => {\n-  const expandedSelector = makeExpandedBlockSelector(ownProps.blockDashedName);\n+type Challenge = ChallengeNode['challenge'];\n+\n+const mapStateToProps = (state: unknown, ownProps: { block: string }) => {\n+  const expandedSelector = makeExpandedBlockSelector(ownProps.block);\n \n   return createSelector(\n     expandedSelector,\n@@ -46,8 +45,8 @@ const mapDispatchToProps = (dispatch: Dispatch) =>\n   bindActionCreators({ toggleBlock }, dispatch);\n \n interface BlockProps {\n-  blockDashedName: string;\n-  challenges: ChallengeNode[];\n+  block: string;\n+  challenges: Challenge[];\n   completedChallengeIds: string[];\n   isExpanded: boolean;\n   superBlock: SuperBlocks;\n@@ -82,14 +81,14 @@ class Block extends Component<BlockProps> {\n   }\n \n   handleBlockClick(): void {\n-    const { blockDashedName, toggleBlock } = this.props;\n+    const { block, toggleBlock } = this.props;\n     void playTone('block-toggle');\n-    toggleBlock(blockDashedName);\n+    toggleBlock(block);\n   }\n \n   render(): JSX.Element {\n     const {\n-      blockDashedName,\n+      block,\n       completedChallengeIds,\n       challenges,\n       isExpanded,\n@@ -99,7 +98,7 @@ class Block extends Component<BlockProps> {\n \n     let completedCount = 0;\n \n-    const challengesWithCompleted = challenges.map(({ challenge }) => {\n+    const challengesWithCompleted = challenges.map(challenge => {\n       const { id } = challenge;\n       const isCompleted = completedChallengeIds.some(\n         (completedChallengeId: string) => completedChallengeId === id\n@@ -110,11 +109,11 @@ class Block extends Component<BlockProps> {\n       return { ...challenge, isCompleted };\n     });\n \n-    const isProjectBlock = challenges.some(({ challenge }) => {\n-      return isProjectBased(challenge.challengeType, blockDashedName);\n+    const isProjectBlock = challenges.some(challenge => {\n+      return isProjectBased(challenge.challengeType, block);\n     });\n \n-    const isGridBlock = challenges.some(({ challenge }) => {\n+    const isGridBlock = challenges.some(challenge => {\n       return isGridBased(superBlock, challenge.challengeType);\n     });\n \n@@ -123,12 +122,12 @@ class Block extends Component<BlockProps> {\n       showUpcomingChanges\n     });\n \n-    const blockTitle = t(`intro:${superBlock}.blocks.${blockDashedName}.title`);\n+    const blockTitle = t(`intro:${superBlock}.blocks.${block}.title`);\n     // the real type of TFunction is the type below, because intro can be an array of strings\n     // type RealTypeOFTFunction = TFunction & ((key: string) => string[]);\n     // But changing the type will require refactoring that isn't worth it for a wrong type.\n     const blockIntroArr = t<string, DefaultTFuncReturn & string[]>(\n-      `intro:${superBlock}.blocks.${blockDashedName}.intro`\n+      `intro:${superBlock}.blocks.${block}.intro`\n     );\n     const expandText = t('intro:misc-text.expand');\n     const collapseText = t('intro:misc-text.collapse');\n@@ -151,7 +150,7 @@ class Block extends Component<BlockProps> {\n     const Block = (\n       <>\n         {' '}\n-        <ScrollableAnchor id={blockDashedName}>\n+        <ScrollableAnchor id={block}>\n           <div className={`block ${isExpanded ? 'open' : ''}`}>\n             <div className='block-header'>\n               <h3 className='big-block-title'>{blockTitle}</h3>\n@@ -207,7 +206,7 @@ class Block extends Component<BlockProps> {\n \n     const ProjectBlock = (\n       <>\n-        <ScrollableAnchor id={blockDashedName}>\n+        <ScrollableAnchor id={block}>\n           <div className='block'>\n             <div className='block-header'>\n               <h3 className='big-block-title'>{blockTitle}</h3>\n@@ -245,12 +244,12 @@ class Block extends Component<BlockProps> {\n     const GridBlock = (\n       <>\n         {' '}\n-        <ScrollableAnchor id={blockDashedName}>\n+        <ScrollableAnchor id={block}>\n           <div className={`block block-grid ${isExpanded ? 'open' : ''}`}>\n             <h3 className='block-grid-title'>\n               <button\n                 aria-expanded={isExpanded ? 'true' : 'false'}\n-                aria-controls={`${blockDashedName}-panel`}\n+                aria-controls={`${block}-panel`}\n                 className='block-header'\n                 onClick={() => {\n                   this.handleBlockClick();\n@@ -283,7 +282,7 @@ class Block extends Component<BlockProps> {\n               </div>\n             )}\n             {isExpanded && (\n-              <div id={`${blockDashedName}-panel`}>\n+              <div id={`${block}-panel`}>\n                 <BlockIntros intros={blockIntroArr} />\n                 <Challenges\n                   challengesWithCompleted={challengesWithCompleted}\n@@ -299,7 +298,7 @@ class Block extends Component<BlockProps> {\n     );\n \n     const GridProjectBlock = (\n-      <ScrollableAnchor id={blockDashedName}>\n+      <ScrollableAnchor id={block}>\n         <div className='block block-grid grid-project-block'>\n           <div className='tags-wrapper'>\n             <span className='cert-tag' aria-hidden='true'>"
        },
        {
            "sha": "b937fb8c0234f60d8937a2c6d526a947c9b022d0",
            "filename": "client/src/templates/Introduction/super-block-intro.tsx",
            "status": "modified",
            "additions": 29,
            "deletions": 40,
            "changes": 69,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/28ad751427db0d622f3ef0c79daceca74137f27f/client%2Fsrc%2Ftemplates%2FIntroduction%2Fsuper-block-intro.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/28ad751427db0d622f3ef0c79daceca74137f27f/client%2Fsrc%2Ftemplates%2FIntroduction%2Fsuper-block-intro.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FIntroduction%2Fsuper-block-intro.tsx?ref=28ad751427db0d622f3ef0c79daceca74137f27f",
            "patch": "@@ -25,7 +25,7 @@ import {\n   userFetchStateSelector,\n   signInLoadingSelector\n } from '../../redux/selectors';\n-import type { AllChallengeNode, User } from '../../redux/prop-types';\n+import type { ChallengeNode, User } from '../../redux/prop-types';\n import { CertTitle } from '../../../config/cert-and-project-map';\n import Block from './components/block';\n import CertChallenge from './components/cert-challenge';\n@@ -45,7 +45,7 @@ type FetchState = {\n type SuperBlockProp = {\n   currentChallengeId: string;\n   data: {\n-    allChallengeNode: AllChallengeNode;\n+    allChallengeNode: { nodes: ChallengeNode[] };\n   };\n   expandedState: {\n     [key: string]: boolean;\n@@ -119,7 +119,7 @@ const SuperBlockIntroductionPage = (props: SuperBlockProp) => {\n   const getChosenBlock = (): string => {\n     const {\n       data: {\n-        allChallengeNode: { edges }\n+        allChallengeNode: { nodes }\n       },\n       isSignedIn,\n       currentChallengeId,\n@@ -144,20 +144,18 @@ const SuperBlockIntroductionPage = (props: SuperBlockProp) => {\n       return dashedBlock;\n     }\n \n-    const edge = edges[0];\n+    const firstChallenge = nodes[0]?.challenge;\n \n     if (isSignedIn) {\n       // see if currentChallenge is in this superBlock\n-      const currentChallengeEdge = edges.find(\n-        edge => edge.node.challenge.id === currentChallengeId\n-      );\n+      const currentChallenge = nodes.find(\n+        node => node.challenge.id === currentChallengeId\n+      )?.challenge;\n \n-      return currentChallengeEdge\n-        ? currentChallengeEdge.node.challenge.block\n-        : edge.node.challenge.block;\n+      return currentChallenge ? currentChallenge.block : firstChallenge?.block;\n     }\n \n-    return edge.node.challenge.block;\n+    return firstChallenge?.block;\n   };\n \n   const initializeExpandedState = () => {\n@@ -169,24 +167,19 @@ const SuperBlockIntroductionPage = (props: SuperBlockProp) => {\n \n   const {\n     data: {\n-      allChallengeNode: { edges }\n+      allChallengeNode: { nodes }\n     },\n     isSignedIn,\n     signInLoading,\n     user,\n     pageContext: { superBlock, title, certification }\n   } = props;\n \n-  const allChallenges = edges.map(({ node }) => node.challenge);\n-  const nodesForSuperBlock = edges\n-    .filter(edge => edge.node.challenge.superBlock === superBlock)\n-    .map(({ node }) => node);\n-  const blockDashedNames = uniq(\n-    nodesForSuperBlock.map(({ challenge: { block } }) => block)\n-  );\n+  const allChallenges = nodes.map(({ challenge }) => challenge);\n+  const challenges = allChallenges.filter(c => c.superBlock === superBlock);\n+  const blocks = uniq(challenges.map(({ block }) => block));\n \n   const i18nTitle = getSuperBlockTitleForMap(superBlock);\n-  const defaultCurriculumNames = blockDashedNames;\n \n   const superblockWithoutCert = [\n     SuperBlocks.RespWebDesign,\n@@ -230,13 +223,11 @@ const SuperBlockIntroductionPage = (props: SuperBlockProp) => {\n               </h2>\n               <Spacer size='medium' />\n               <div className='block-ui'>\n-                {defaultCurriculumNames.map(blockDashedName => (\n+                {blocks.map(block => (\n                   <Block\n-                    key={blockDashedName}\n-                    blockDashedName={blockDashedName}\n-                    challenges={nodesForSuperBlock.filter(\n-                      node => node.challenge.block === blockDashedName\n-                    )}\n+                    key={block}\n+                    block={block}\n+                    challenges={challenges.filter(c => c.block === block)}\n                     superBlock={superBlock}\n                   />\n                 ))}\n@@ -292,21 +283,19 @@ export const query = graphql`\n         ]\n       }\n     ) {\n-      edges {\n-        node {\n-          challenge {\n-            fields {\n-              slug\n-              blockName\n-            }\n-            id\n-            block\n-            challengeType\n-            title\n-            order\n-            superBlock\n-            dashedName\n+      nodes {\n+        challenge {\n+          fields {\n+            slug\n+            blockName\n           }\n+          id\n+          block\n+          challengeType\n+          title\n+          order\n+          superBlock\n+          dashedName\n         }\n       }\n     }"
        }
    ],
    "stats": {
        "total": 226,
        "additions": 107,
        "deletions": 119
    }
}