{
    "author": "huyenltnguyen",
    "message": "test(e2e): add tests for the claim cert button on /settings (#55514)",
    "sha": "ff5fd21e00cfd9e6fe4dbb564c1e2fd12f9cc9c2",
    "files": [
        {
            "sha": "f2c597f9b49730b9f451eefa179441254b93a0cb",
            "filename": "client/src/components/settings/certification.tsx",
            "status": "modified",
            "additions": 19,
            "deletions": 2,
            "changes": 21,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ff5fd21e00cfd9e6fe4dbb564c1e2fd12f9cc9c2/client%2Fsrc%2Fcomponents%2Fsettings%2Fcertification.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ff5fd21e00cfd9e6fe4dbb564c1e2fd12f9cc9c2/client%2Fsrc%2Fcomponents%2Fsettings%2Fcertification.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fsettings%2Fcertification.tsx?ref=ff5fd21e00cfd9e6fe4dbb564c1e2fd12f9cc9c2",
            "patch": "@@ -231,7 +231,21 @@ const LegacyFullStack = (props: CertificationSettingsProps) => {\n             onClick={createClickHandler(certSlug)}\n             target='_blank'\n           >\n-            {isFullStackCert ? t('buttons.show-cert') : t('buttons.claim-cert')}\n+            {isFullStackCert ? (\n+              <>\n+                {t('buttons.show-cert')}{' '}\n+                <span className='sr-only'>\n+                  {t('certification.title.Legacy Full Stack')}\n+                </span>\n+              </>\n+            ) : (\n+              <>\n+                {t('buttons.claim-cert')}{' '}\n+                <span className='sr-only'>\n+                  {t('certification.title.Legacy Full Stack')}\n+                </span>\n+              </>\n+            )}\n           </Button>\n         ) : (\n           <Button\n@@ -241,7 +255,10 @@ const LegacyFullStack = (props: CertificationSettingsProps) => {\n             disabled={true}\n             id={'button-' + certSlug}\n           >\n-            {t('buttons.claim-cert')}\n+            {t('buttons.claim-cert')}{' '}\n+            <span className='sr-only'>\n+              {t('certification.title.Legacy Full Stack')}\n+            </span>\n           </Button>\n         )}\n       </div>"
        },
        {
            "sha": "14fc31830ba36e710fe6ddcc36c8451cddc78521",
            "filename": "e2e/settings.spec.ts",
            "status": "modified",
            "additions": 73,
            "deletions": 2,
            "changes": 75,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ff5fd21e00cfd9e6fe4dbb564c1e2fd12f9cc9c2/e2e%2Fsettings.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ff5fd21e00cfd9e6fe4dbb564c1e2fd12f9cc9c2/e2e%2Fsettings.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fsettings.spec.ts?ref=ff5fd21e00cfd9e6fe4dbb564c1e2fd12f9cc9c2",
            "patch": "@@ -1,6 +1,8 @@\n+import { execSync } from 'child_process';\n import { test, expect } from '@playwright/test';\n+\n import translations from '../client/i18n/locales/english/translations.json';\n-test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+import { alertToBeVisible } from './utils/alerts';\n \n const settingsTestIds = {\n   settingsHeading: 'settings-heading',\n@@ -46,7 +48,9 @@ const legacyCertifications = [\n   ]\n ];\n \n-test.describe('Settings', () => {\n+test.describe('Settings - Certified User', () => {\n+  test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+\n   test.beforeEach(async ({ page }) => {\n     await page.goto('/settings');\n   });\n@@ -349,3 +353,70 @@ test.describe('Settings', () => {\n     await expect(aboutInput).toHaveValue('');\n   });\n });\n+\n+// In order to claim the Full Stack cert, the user needs to complete 6 certs.\n+// Instead of simulating 6 cert claim flows,\n+// we use the data of Certified User but remove the Full Stack cert.\n+test.describe('Settings - Certified User without Full Stack Certification', () => {\n+  test.use({ storageState: 'playwright/.auth/certified-user.json' });\n+\n+  test.beforeEach(async ({ page }) => {\n+    execSync(\n+      'node ./tools/scripts/seed/seed-demo-user --certified-user --set-false isFullStackCert'\n+    );\n+    await page.goto('/settings');\n+  });\n+\n+  test.afterAll(() => {\n+    execSync('node ./tools/scripts/seed/seed-demo-user --certified-user');\n+  });\n+\n+  test('should allow claiming Full Stack cert if the user has completed all requirements', async ({\n+    page\n+  }) => {\n+    const claimButton = page.getByRole('link', {\n+      name: 'Claim Certification Legacy Full Stack'\n+    });\n+    const showButton = page.getByRole('link', {\n+      name: 'Show Certification Legacy Full Stack'\n+    });\n+\n+    await expect(claimButton).toBeVisible();\n+    await expect(claimButton).toBeEnabled();\n+    await claimButton.click();\n+\n+    await alertToBeVisible(\n+      page,\n+      '@certifieduser, you have successfully claimed the Legacy Full Stack Certification! Congratulations on behalf of the freeCodeCamp.org team!'\n+    );\n+    await expect(claimButton).toBeHidden();\n+    await expect(showButton).toBeVisible();\n+    await expect(showButton).toHaveAttribute(\n+      'href',\n+      '/certification/certifieduser/full-stack'\n+    );\n+  });\n+});\n+\n+test.describe('Settings - New User', () => {\n+  test.use({ storageState: 'playwright/.auth/development-user.json' });\n+\n+  test.beforeEach(async ({ page }) => {\n+    execSync('node ./tools/scripts/seed/seed-demo-user');\n+    await page.goto('/settings');\n+  });\n+\n+  test.afterAll(() => {\n+    execSync('node ./tools/scripts/seed/seed-demo-user --certified-user');\n+  });\n+\n+  test('should not allow claiming Full Stack cert if the user has not completed all the required certs', async ({\n+    page\n+  }) => {\n+    const claimButton = page.getByRole('button', {\n+      name: 'Claim Certification Legacy Full Stack'\n+    });\n+    await expect(claimButton).toBeVisible();\n+    await expect(claimButton).toBeDisabled();\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 96,
        "additions": 92,
        "deletions": 4
    }
}