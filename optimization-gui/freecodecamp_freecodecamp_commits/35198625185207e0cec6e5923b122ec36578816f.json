{
    "author": "Jeevankumar-s",
    "message": "fix(learn, tools/scripts): replace archived challenge links in challenge reset modal (#64849)\n\nCo-authored-by: Jeevankumar <jeeevnkumar2003@gmail.com>\nCo-authored-by: Huyen Nguyen <25715018+huyenltnguyen@users.noreply.github.com>",
    "sha": "35198625185207e0cec6e5923b122ec36578816f",
    "files": [
        {
            "sha": "366dab3e3800706533884fdd15951f170165df2f",
            "filename": "client/src/templates/Challenges/components/reset-modal.tsx",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/35198625185207e0cec6e5923b122ec36578816f/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Freset-modal.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/35198625185207e0cec6e5923b122ec36578816f/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Freset-modal.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fcomponents%2Freset-modal.tsx?ref=35198625185207e0cec6e5923b122ec36578816f",
            "patch": "@@ -1,4 +1,4 @@\n-import React from 'react';\n+import React, { useEffect } from 'react';\n import { useTranslation } from 'react-i18next';\n import { connect } from 'react-redux';\n import { bindActionCreators, Dispatch } from 'redux';\n@@ -45,9 +45,13 @@ function ResetModal({\n   challengeTitle\n }: ResetModalProps): JSX.Element {\n   const { t } = useTranslation();\n-  if (isOpen) {\n-    callGA({ event: 'pageview', pagePath: '/reset-modal' });\n-  }\n+\n+  useEffect(() => {\n+    if (isOpen) {\n+      callGA({ event: 'pageview', pagePath: '/reset-modal' });\n+    }\n+  }, [isOpen]);\n+\n   return (\n     <Modal onClose={close} open={isOpen} variant='danger'>\n       <Modal.Header showCloseButton={true} closeButtonClassNames='close'>"
        },
        {
            "sha": "5de4c2412b744b4077bb61f6643d781283c355e8",
            "filename": "e2e/challenge-reset-modal.spec.ts",
            "status": "modified",
            "additions": 57,
            "deletions": 17,
            "changes": 74,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/35198625185207e0cec6e5923b122ec36578816f/e2e%2Fchallenge-reset-modal.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/35198625185207e0cec6e5923b122ec36578816f/e2e%2Fchallenge-reset-modal.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fchallenge-reset-modal.spec.ts?ref=35198625185207e0cec6e5923b122ec36578816f",
            "patch": "@@ -6,6 +6,21 @@ import translations from '../client/i18n/locales/english/translations.json';\n import { clearEditor, focusEditor, getEditors } from './utils/editor';\n import { alertToBeVisible } from './utils/alerts';\n \n+interface ChallengeTest {\n+  text: string;\n+  testString: string;\n+}\n+\n+interface PageData {\n+  result: {\n+    data: {\n+      challengeNode: {\n+        challenge: { tests: ChallengeTest[] };\n+      };\n+    };\n+  };\n+}\n+\n const expectToRenderResetModal = async (page: Page) => {\n   await expect(\n     page.getByRole('dialog', { name: translations.learn.reset })\n@@ -29,7 +44,7 @@ const expectToRenderResetModal = async (page: Page) => {\n \n test('should render the modal content correctly', async ({ page }) => {\n   await page.goto(\n-    '/learn/2022/responsive-web-design/learn-html-by-building-a-cat-photo-app/step-3'\n+    '/learn/responsive-web-design-v9/workshop-cat-photo-app/step-3'\n   );\n \n   await page.getByRole('button', { name: translations.buttons.reset }).click();\n@@ -61,7 +76,7 @@ test('User can reset challenge', async ({ page, isMobile, browserName }) => {\n     .getByText(updatedText);\n \n   await page.goto(\n-    '/learn/2022/responsive-web-design/learn-html-by-building-a-cat-photo-app/step-3'\n+    '/learn/responsive-web-design-v9/workshop-cat-photo-app/step-3'\n   );\n \n   // Building the preview can take a while\n@@ -103,12 +118,36 @@ test('User can reset challenge', async ({ page, isMobile, browserName }) => {\n \n test.describe('When the user is not logged in', () => {\n   test.use({ storageState: { cookies: [], origins: [] } });\n+\n   test('User can reset classic challenge', async ({ page, isMobile }) => {\n-    await page.goto(\n-      '/learn/javascript-algorithms-and-data-structures/basic-javascript/comment-your-javascript-code'\n+    const challengePath =\n+      '/learn/rosetta-code/rosetta-code-challenges/100-doors';\n+\n+    // Intercept Gatsby page-data and inject a mock test that always passes\n+    await page.route(\n+      `**/page-data${challengePath}/page-data.json`,\n+      async route => {\n+        const response = await route.fetch();\n+        const body = await response.text();\n+\n+        const pageData = JSON.parse(body) as PageData;\n+        pageData.result.data.challengeNode.challenge.tests = [\n+          {\n+            text: 'Mock test',\n+            testString: 'assert(true)'\n+          }\n+        ];\n+\n+        await route.fulfill({\n+          contentType: 'application/json',\n+          body: JSON.stringify(pageData)\n+        });\n+      }\n     );\n \n-    const challengeSolution = '// This is in-line comment';\n+    await page.goto(challengePath);\n+\n+    const challengeSolution = 'test code';\n     await focusEditor({ page, isMobile });\n     await getEditors(page).fill(challengeSolution);\n \n@@ -117,22 +156,23 @@ test.describe('When the user is not logged in', () => {\n         ? translations.buttons.run\n         : translations.buttons['run-test']\n     });\n+\n     await submitButton.click();\n \n     await expect(\n       page.locator('.view-lines').getByText(challengeSolution)\n     ).toBeVisible();\n \n-    if (isMobile) {\n-      await page\n-        .getByText(translations.learn['editor-tabs'].instructions)\n-        .click();\n-    }\n-\n+    // Completion dialog shows up\n     await expect(\n-      page.getByLabel(translations.icons.passed).locator('circle')\n+      page.getByText(translations.buttons['go-to-next'])\n     ).toBeVisible();\n \n+    // Close the dialog\n+    await page\n+      .getByRole('button', { name: translations.buttons.close })\n+      .click();\n+\n     await page\n       .getByRole('button', {\n         name: !isMobile\n@@ -149,7 +189,7 @@ test.describe('When the user is not logged in', () => {\n       page.locator('.view-lines').getByText(challengeSolution)\n     ).not.toBeVisible();\n     await expect(\n-      page.getByLabel(translations.icons.passed).locator('circle')\n+      page.getByText(translations.buttons['go-to-next'])\n     ).not.toBeVisible();\n     await expect(\n       page.getByText(translations.learn['tests-completed'])\n@@ -167,7 +207,7 @@ test.describe('When the user is not logged in', () => {\n \n test('should close when the user clicks the close button', async ({ page }) => {\n   await page.goto(\n-    '/learn/2022/responsive-web-design/learn-html-by-building-a-cat-photo-app/step-3'\n+    '/learn/responsive-web-design-v9/workshop-cat-photo-app/step-3'\n   );\n \n   await page.getByRole('button', { name: translations.buttons.reset }).click();\n@@ -195,7 +235,7 @@ test('User can reset on a multi-file project', async ({\n   const sampleText = 'function palindrome() { return true; }';\n \n   await page.goto(\n-    '/learn/javascript-algorithms-and-data-structures-v8/build-a-palindrome-checker-project/build-a-palindrome-checker'\n+    '/learn/javascript-v9/lab-palindrome-checker/build-a-palindrome-checker'\n   );\n \n   await focusEditor({ page, isMobile });\n@@ -245,7 +285,7 @@ test.describe('Signed in user', () => {\n     const updatedText = 'function palindrome() { return false; }';\n \n     await page.goto(\n-      '/learn/javascript-algorithms-and-data-structures-v8/build-a-palindrome-checker-project/build-a-palindrome-checker'\n+      '/learn/javascript-v9/lab-palindrome-checker/build-a-palindrome-checker'\n     );\n \n     // This first edit should reappear after the reset\n@@ -286,7 +326,7 @@ test.describe('Signed in user', () => {\n     const updatedText = 'function palindrome() { return false; }';\n \n     await page.goto(\n-      '/learn/javascript-algorithms-and-data-structures-v8/build-a-palindrome-checker-project/build-a-palindrome-checker'\n+      '/learn/javascript-v9/lab-palindrome-checker/build-a-palindrome-checker'\n     );\n \n     // This first edit should reappear after the reset"
        }
    ],
    "stats": {
        "total": 86,
        "additions": 65,
        "deletions": 21
    }
}