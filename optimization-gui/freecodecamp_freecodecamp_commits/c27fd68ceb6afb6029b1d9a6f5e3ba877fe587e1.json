{
    "author": "ojeytonwilliams",
    "message": "test: /donate page for signed out users (#61738)",
    "sha": "c27fd68ceb6afb6029b1d9a6f5e3ba877fe587e1",
    "files": [
        {
            "sha": "bc24b37c271d630f7ec609a87738ee8450294074",
            "filename": "e2e/donate-page-default.spec.ts",
            "status": "modified",
            "additions": 86,
            "deletions": 85,
            "changes": 171,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/c27fd68ceb6afb6029b1d9a6f5e3ba877fe587e1/e2e%2Fdonate-page-default.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/c27fd68ceb6afb6029b1d9a6f5e3ba877fe587e1/e2e%2Fdonate-page-default.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fdonate-page-default.spec.ts?ref=c27fd68ceb6afb6029b1d9a6f5e3ba877fe587e1",
            "patch": "@@ -1,4 +1,4 @@\n-import { test, expect, type Page } from '@playwright/test';\n+import { test, expect } from '@playwright/test';\n import translations from '../client/i18n/locales/english/translations.json';\n \n const pageElements = {\n@@ -34,110 +34,29 @@ const donationFormStrings = {\n   donate: translations.buttons.donate\n };\n \n-let page: Page;\n-test.beforeAll(async ({ browser }) => {\n-  page = await browser.newPage();\n-  await page.goto('/donate');\n-});\n-\n-test.describe('Donate Page', () => {\n-  test('should display the correct title', async () => {\n+function donatePageTests() {\n+  test('should render correctly', async ({ page }) => {\n     await expect(page).toHaveTitle(\n       `${translations.donate.title} | freeCodeCamp.org`\n     );\n-  });\n-\n-  test('should select $20 tier by default', async () => {\n-    await expect(\n-      page.getByText(donationFormStrings.conformTwentyDollar)\n-    ).toBeVisible();\n-\n-    const tabs = await page.$$('[role=\"tab\"]');\n-    expect(tabs.length).toBe(4);\n-\n-    for (const tab of tabs) {\n-      const tabText = await tab.innerText();\n-      expect(['$5', '$10', '$20', '$40']).toContain(tabText);\n-\n-      if (tabText === '$20') {\n-        const isActive = await tab.getAttribute('data-state');\n-        expect(isActive).toBe('active');\n-      } else {\n-        const isActive = await tab.getAttribute('data-state');\n-        expect(isActive).not.toBe('active');\n-      }\n-    }\n-    await expect(\n-      page.getByText(donationFormStrings.twentyDollarsLearningContribution)\n-    ).toBeVisible();\n-  });\n-\n-  test('should make $5 tier selectable', async () => {\n-    await page.click('[role=\"tab\"]:has-text(\"$5\")');\n-\n-    await expect(\n-      page.getByText(donationFormStrings.confirmFiveDollars)\n-    ).toBeVisible();\n-\n-    await expect(\n-      page.getByText(donationFormStrings.fiveDollarsLearningContribution)\n-    ).toBeVisible();\n-  });\n-\n-  test('should switch between tier selection and payment options', async () => {\n-    // Tier selection\n-    await page.click('[role=\"tab\"]:has-text(\"$5\")');\n-    await expect(\n-      page.getByText(donationFormStrings.confirmFiveDollars)\n-    ).toBeVisible();\n-    await expect(\n-      page.getByText(donationFormStrings.fiveDollarsLearningContribution)\n-    ).toBeVisible();\n-    await page.click(`button:has-text(\"${donationFormStrings.donate}\")`);\n-\n-    // Donation form\n-    const isEditButtonVisible = await page.isVisible(\n-      `button:has-text(\"${donationFormStrings.editAmount}\")`\n-    );\n-    expect(isEditButtonVisible).toBeTruthy();\n-    await expect(page.getByTestId('donation-form')).toBeVisible();\n-    await page.click(`button:has-text(\"${donationFormStrings.editAmount}\")`);\n \n-    // Tier selection\n-    await expect(\n-      page.getByText(donationFormStrings.confirmFiveDollars)\n-    ).toBeVisible();\n-    await expect(\n-      page.getByText(donationFormStrings.fiveDollarsLearningContribution)\n-    ).toBeVisible();\n-  });\n-\n-  test('should display the main heading', async () => {\n     const mainHeading = page.getByTestId(pageElements.mainHeading);\n     await expect(mainHeading).toHaveText(translations.donate['help-more']);\n-  });\n \n-  test('should display donation page upper text 1', async () => {\n     const donateText1 = page.getByTestId(pageElements.donateText1);\n     await expect(donateText1).toHaveText(translations.donate.efficiency);\n-  });\n \n-  test('should display donation page benefit 2', async () => {\n     const donateText2 = page.getByTestId(pageElements.donateText2);\n     await expect(donateText2).toHaveText(translations.donate['why-donate-1']);\n-  });\n \n-  test('should display donation page benefit 3', async () => {\n     const donateText3 = page.getByTestId(pageElements.donateText3);\n     await expect(donateText3).toHaveText(translations.donate['why-donate-2']);\n-  });\n \n-  test('should display the faq heading', async () => {\n     const faqHead = page.getByTestId(pageElements.faqHeading);\n     await expect(faqHead).toHaveText(translations.donate.faq);\n   });\n \n-  test('should display the faq list with buttons', async () => {\n+  test('should display the faq list with buttons', async ({ page }) => {\n     const faq1 = page.getByRole('button', {\n       name: translations.donate['get-help']\n     });\n@@ -293,4 +212,86 @@ test.describe('Donate Page', () => {\n     ).toBeVisible();\n     await faq12.click();\n   });\n+\n+  test('should select $20 tier by default', async ({ page }) => {\n+    await expect(\n+      page.getByText(donationFormStrings.conformTwentyDollar)\n+    ).toBeVisible();\n+\n+    const tabs = await page.$$('[role=\"tab\"]');\n+    expect(tabs.length).toBe(4);\n+\n+    for (const tab of tabs) {\n+      const tabText = await tab.innerText();\n+      expect(['$5', '$10', '$20', '$40']).toContain(tabText);\n+\n+      if (tabText === '$20') {\n+        const isActive = await tab.getAttribute('data-state');\n+        expect(isActive).toBe('active');\n+      } else {\n+        const isActive = await tab.getAttribute('data-state');\n+        expect(isActive).not.toBe('active');\n+      }\n+    }\n+    await expect(\n+      page.getByText(donationFormStrings.twentyDollarsLearningContribution)\n+    ).toBeVisible();\n+  });\n+\n+  test('should make $5 tier selectable', async ({ page }) => {\n+    await page.click('[role=\"tab\"]:has-text(\"$5\")');\n+\n+    await expect(\n+      page.getByText(donationFormStrings.confirmFiveDollars)\n+    ).toBeVisible();\n+\n+    await expect(\n+      page.getByText(donationFormStrings.fiveDollarsLearningContribution)\n+    ).toBeVisible();\n+  });\n+\n+  test('should switch between tier selection and payment options', async ({\n+    page\n+  }) => {\n+    // Tier selection\n+    await page.click('[role=\"tab\"]:has-text(\"$5\")');\n+    await expect(\n+      page.getByText(donationFormStrings.confirmFiveDollars)\n+    ).toBeVisible();\n+    await expect(\n+      page.getByText(donationFormStrings.fiveDollarsLearningContribution)\n+    ).toBeVisible();\n+    await page.click(`button:has-text(\"${donationFormStrings.donate}\")`);\n+\n+    // Donation form\n+    const isEditButtonVisible = await page.isVisible(\n+      `button:has-text(\"${donationFormStrings.editAmount}\")`\n+    );\n+    expect(isEditButtonVisible).toBeTruthy();\n+    await expect(page.getByTestId('donation-form')).toBeVisible();\n+    await page.click(`button:has-text(\"${donationFormStrings.editAmount}\")`);\n+\n+    // Tier selection\n+    await expect(\n+      page.getByText(donationFormStrings.confirmFiveDollars)\n+    ).toBeVisible();\n+    await expect(\n+      page.getByText(donationFormStrings.fiveDollarsLearningContribution)\n+    ).toBeVisible();\n+  });\n+}\n+\n+test.describe('Authenticated User', () => {\n+  test.beforeEach(async ({ page }) => {\n+    await page.goto('/donate');\n+  });\n+  donatePageTests();\n+});\n+\n+test.describe('Unauthenticated User', () => {\n+  test.use({ storageState: { cookies: [], origins: [] } });\n+  test.beforeEach(async ({ page }) => {\n+    await page.goto('/donate');\n+  });\n+  donatePageTests();\n });"
        }
    ],
    "stats": {
        "total": 171,
        "additions": 86,
        "deletions": 85
    }
}