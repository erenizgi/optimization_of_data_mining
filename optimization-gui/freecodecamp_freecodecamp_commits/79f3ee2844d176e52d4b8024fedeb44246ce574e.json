{
    "author": "huyenltnguyen",
    "message": "fix(client): initialize theme during gatsby SSR (#61922)",
    "sha": "79f3ee2844d176e52d4b8024fedeb44246ce574e",
    "files": [
        {
            "sha": "1b54e5cb86767d8cd991e210aae0f94fb47aaeae",
            "filename": "client/gatsby-ssr.js",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/79f3ee2844d176e52d4b8024fedeb44246ce574e/client%2Fgatsby-ssr.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/79f3ee2844d176e52d4b8024fedeb44246ce574e/client%2Fgatsby-ssr.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fgatsby-ssr.js?ref=79f3ee2844d176e52d4b8024fedeb44246ce574e",
            "patch": "@@ -8,7 +8,11 @@ import i18n from './i18n/config';\n import { stripe } from './src/utils/stripe';\n import { createStore } from './src/redux/create-store';\n import layoutSelector from './utils/gatsby/layout-selector';\n-import { getheadTagComponents, getPostBodyComponents } from './utils/tags';\n+import {\n+  getheadTagComponents,\n+  getPostBodyComponents,\n+  getPreBodyThemeScript\n+} from './utils/tags';\n import GrowthBookProvider from './src/components/growth-book/growth-book-wrapper';\n \n const store = createStore();\n@@ -34,9 +38,11 @@ export const wrapPageElement = layoutSelector;\n export const onRenderBody = ({\n   pathname,\n   setHeadComponents,\n+  setPreBodyComponents,\n   setPostBodyComponents\n }) => {\n   setHeadComponents(getheadTagComponents());\n+  setPreBodyComponents(getPreBodyThemeScript());\n   setPostBodyComponents(getPostBodyComponents(pathname));\n };\n "
        },
        {
            "sha": "5c4c58e36d548589db8fa904e8d666f22114f5d3",
            "filename": "client/utils/tags.tsx",
            "status": "modified",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/79f3ee2844d176e52d4b8024fedeb44246ce574e/client%2Futils%2Ftags.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/79f3ee2844d176e52d4b8024fedeb44246ce574e/client%2Futils%2Ftags.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Futils%2Ftags.tsx?ref=79f3ee2844d176e52d4b8024fedeb44246ce574e",
            "patch": "@@ -62,3 +62,36 @@ export function getPostBodyComponents(superblock: string): JSX.Element[] {\n \n   return scripts.filter(Boolean);\n }\n+\n+export function getPreBodyThemeScript(): JSX.Element[] {\n+  const script = (\n+    <script\n+      key='prebody-theme-init'\n+      dangerouslySetInnerHTML={{\n+        __html: `\n+(function(){\n+  let theme = 'light';\n+  const localTheme = localStorage.getItem('theme');\n+\n+  if (localTheme !== null) {\n+    theme = localTheme === 'dark' ? 'dark' : 'light';\n+  } else if (\n+    window.matchMedia &&\n+    window.matchMedia('(prefers-color-scheme: dark)').matches\n+  ) {\n+    theme = 'dark';\n+  }\n+\n+  const bodyEl = document && document.body;\n+\n+  if (bodyEl && bodyEl.classList) {\n+    bodyEl.classList.remove('light-palette');\n+    bodyEl.classList.remove('dark-palette');\n+    bodyEl.classList.add(theme + '-palette');\n+  }\n+})();`\n+      }}\n+    />\n+  );\n+  return [script];\n+}"
        }
    ],
    "stats": {
        "total": 41,
        "additions": 40,
        "deletions": 1
    }
}