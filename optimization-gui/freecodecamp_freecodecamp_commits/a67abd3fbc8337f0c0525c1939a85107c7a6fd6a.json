{
    "author": "ojeytonwilliams",
    "message": "feat(client): redirect from /settings + /update-email after sign out (#64405)",
    "sha": "a67abd3fbc8337f0c0525c1939a85107c7a6fd6a",
    "files": [
        {
            "sha": "72fa7e12f8e34f9ddc0f8118f303c8c6c2af9fc4",
            "filename": "client/src/components/signout-modal/index.tsx",
            "status": "modified",
            "additions": 24,
            "deletions": 5,
            "changes": 29,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a67abd3fbc8337f0c0525c1939a85107c7a6fd6a/client%2Fsrc%2Fcomponents%2Fsignout-modal%2Findex.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a67abd3fbc8337f0c0525c1939a85107c7a6fd6a/client%2Fsrc%2Fcomponents%2Fsignout-modal%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fsignout-modal%2Findex.tsx?ref=a67abd3fbc8337f0c0525c1939a85107c7a6fd6a",
            "patch": "@@ -5,7 +5,7 @@ import { connect } from 'react-redux';\n import { useTranslation } from 'react-i18next';\n import { Button, Modal, Spacer } from '@freecodecamp/ui';\n \n-import { hardGoTo as navigate, closeSignoutModal } from '../../redux/actions';\n+import { closeSignoutModal } from '../../redux/actions';\n import { isSignoutModalOpenSelector } from '../../redux/selectors';\n import { apiLocation } from '../../../config/env.json';\n import callGA from '../../analytics/call-ga';\n@@ -20,20 +20,31 @@ const mapStateToProps = createSelector(\n const mapDispatchToProps = (dispatch: Dispatch<AnyAction>) =>\n   bindActionCreators(\n     {\n-      navigate,\n       closeSignoutModal\n     },\n     dispatch\n   );\n \n type SignoutModalProps = {\n-  navigate: (path: string) => void;\n   closeSignoutModal: () => void;\n   show: boolean;\n };\n \n+export const pathAfterSignout = (currentPath: string): string => {\n+  // These pages try to sign in the user automatically if they are signed out,\n+  // so, to respect the user's intention to sign out, we redirect them to /learn\n+  // instead.\n+  const redirectedPaths = ['/settings', '/update-email'];\n+  const allPaths = [\n+    ...redirectedPaths,\n+    ...redirectedPaths.map(path => `${path}/`)\n+  ];\n+\n+  return allPaths.some(path => currentPath === path) ? '/learn' : currentPath;\n+};\n+\n function SignoutModal(props: SignoutModalProps): JSX.Element {\n-  const { show, closeSignoutModal, navigate } = props;\n+  const { show, closeSignoutModal } = props;\n   const { t } = useTranslation();\n \n   const handleModalHide = () => {\n@@ -43,7 +54,15 @@ function SignoutModal(props: SignoutModalProps): JSX.Element {\n   const handleSignout = () => {\n     closeSignoutModal();\n     callGA({ event: 'sign_out', user_id: undefined });\n-    navigate(`${apiLocation}/signout`);\n+    const redirect = () => {\n+      window.location.pathname = pathAfterSignout(window.location.pathname);\n+    };\n+    void fetch(`${apiLocation}/signout`, {\n+      method: 'GET',\n+      credentials: 'include'\n+    })\n+      .then(redirect)\n+      .catch(redirect);\n   };\n \n   return ("
        },
        {
            "sha": "50a2511e039f0433b426c5b3ef35a497ee03f35b",
            "filename": "client/src/components/signout-modal/signout-modal.test.ts",
            "status": "added",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a67abd3fbc8337f0c0525c1939a85107c7a6fd6a/client%2Fsrc%2Fcomponents%2Fsignout-modal%2Fsignout-modal.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a67abd3fbc8337f0c0525c1939a85107c7a6fd6a/client%2Fsrc%2Fcomponents%2Fsignout-modal%2Fsignout-modal.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2Fsignout-modal%2Fsignout-modal.test.ts?ref=a67abd3fbc8337f0c0525c1939a85107c7a6fd6a",
            "patch": "@@ -0,0 +1,31 @@\n+import { describe, it, expect } from 'vitest';\n+\n+import { pathAfterSignout } from '.';\n+\n+describe('pathAfterSignout', () => {\n+  it('should default to the supplied path', () => {\n+    const unexceptionalPath = 'a/normal/path/';\n+    expect(pathAfterSignout(unexceptionalPath)).toBe(unexceptionalPath);\n+  });\n+\n+  it('should redirect paths that automatically sign in back to /learn', () => {\n+    const pathsThatAttemptToSignIn = ['/settings', '/update-email'];\n+    const newPaths = pathsThatAttemptToSignIn.map(pathAfterSignout);\n+\n+    expect(newPaths).toEqual(['/learn', '/learn']);\n+  });\n+\n+  it('should redirect paths with trailing slashes', () => {\n+    const pathsThatAttemptToSignIn = ['/settings/', '/update-email/'];\n+    const newPaths = pathsThatAttemptToSignIn.map(pathAfterSignout);\n+\n+    expect(newPaths).toEqual(['/learn', '/learn']);\n+  });\n+\n+  it('should only redirect exact matches', () => {\n+    const similarPaths = ['/settingss', '/update-emails/', '/settings/2'];\n+    const newPaths = similarPaths.map(pathAfterSignout);\n+\n+    expect(newPaths).toEqual(similarPaths);\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 60,
        "additions": 55,
        "deletions": 5
    }
}