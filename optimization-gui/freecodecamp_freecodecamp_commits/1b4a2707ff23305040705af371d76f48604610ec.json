{
    "author": "ojeytonwilliams",
    "message": "fix: flaky code-saving test (#55338)",
    "sha": "1b4a2707ff23305040705af371d76f48604610ec",
    "files": [
        {
            "sha": "3b4e69c8bc13cec864fac9c0d3dec4f848935a76",
            "filename": "e2e/multifile-cert-projects.spec.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 27,
            "changes": 46,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/1b4a2707ff23305040705af371d76f48604610ec/e2e%2Fmultifile-cert-projects.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/1b4a2707ff23305040705af371d76f48604610ec/e2e%2Fmultifile-cert-projects.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fmultifile-cert-projects.spec.ts?ref=1b4a2707ff23305040705af371d76f48604610ec",
            "patch": "@@ -1,34 +1,34 @@\n import { execSync } from 'child_process';\n import { test, expect } from '@playwright/test';\n-import { focusEditor } from './utils/editor';\n-import { isMacOS } from './utils/user-agent';\n+import { clearEditor, focusEditor } from './utils/editor';\n test.use({ storageState: 'playwright/.auth/certified-user.json' });\n test.describe('multifileCertProjects', () => {\n   test.beforeEach(async ({ page }) => {\n+    execSync('node ./tools/scripts/seed/seed-demo-user certified-user');\n     await page.goto(\n       'learn/2022/responsive-web-design/build-a-tribute-page-project/build-a-tribute-page'\n     );\n-    execSync('node ./tools/scripts/seed/seed-demo-user certified-user');\n   });\n-  test('should save and reload user code', async ({ page, isMobile }) => {\n-    await focusEditor({ page, isMobile });\n \n-    if (isMacOS) {\n-      await page.keyboard.press('Meta+A');\n-    } else {\n-      await page.keyboard.press('Control+A');\n-    }\n+  const success =\n+    /Your code was saved to the database\\. It will be here when you return\\./;\n+  const tooFast =\n+    /Slow Down! Your code was not saved\\. Try again in a few seconds\\./;\n \n-    await page.keyboard.press('Backspace');\n+  test('should save and reload user code', async ({\n+    page,\n+    isMobile,\n+    browserName\n+  }) => {\n+    await focusEditor({ page, isMobile });\n+    await clearEditor({ page, browserName });\n \n     await page.keyboard.type('save1text');\n     await expect(page.getByText('save1text')).toBeVisible();\n \n     await page.getByRole('button', { name: 'Save your Code' }).click();\n \n-    await expect(page.getByTestId('flash-message')).toContainText(\n-      /Your code was saved to the database\\. It will be here when you return\\./\n-    );\n+    await expect(page.getByTestId('flash-message')).toContainText(success);\n \n     await page.reload();\n \n@@ -37,25 +37,19 @@ test.describe('multifileCertProjects', () => {\n \n   test('should save using ctrl+s hotkey and persist through navigation', async ({\n     page,\n-    isMobile\n+    isMobile,\n+    browserName\n   }) => {\n     await focusEditor({ page, isMobile });\n-\n-    if (isMacOS) {\n-      await page.keyboard.press('Meta+A');\n-    } else {\n-      await page.keyboard.press('Control+A');\n-    }\n+    await clearEditor({ page, browserName });\n \n     await page.keyboard.type('save2text');\n     await expect(page.getByText('save2text')).toBeVisible();\n \n     await page.keyboard.down('Control');\n     await page.keyboard.press('KeyS');\n \n-    await expect(page.getByTestId('flash-message')).toContainText(\n-      /Your code was saved to the database\\. It will be here when you return\\./\n-    );\n+    await expect(page.getByTestId('flash-message')).toContainText(success);\n \n     await page.getByRole('button', { name: 'Close' }).click();\n \n@@ -70,8 +64,6 @@ test.describe('multifileCertProjects', () => {\n     await page.keyboard.down('Control');\n     await page.keyboard.press('KeyS');\n \n-    await expect(page.getByTestId('flash-message')).toContainText(\n-      /Slow Down! Your code was not saved\\. Try again in a few seconds\\./\n-    );\n+    await expect(page.getByTestId('flash-message')).toContainText(tooFast);\n   });\n });"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 19,
        "deletions": 27
    }
}