{
    "author": "ojeytonwilliams",
    "message": "test: fix flaky settings test (#55722)",
    "sha": "fe7a43dc208af215a0f8f63f1b026da10be10c74",
    "files": [
        {
            "sha": "e1a93d9a45c2e20ae1928185f77c9a097c0fa40f",
            "filename": "e2e/settings.spec.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 29,
            "changes": 52,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/fe7a43dc208af215a0f8f63f1b026da10be10c74/e2e%2Fsettings.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/fe7a43dc208af215a0f8f63f1b026da10be10c74/e2e%2Fsettings.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fsettings.spec.ts?ref=fe7a43dc208af215a0f8f63f1b026da10be10c74",
            "patch": "@@ -52,14 +52,15 @@ test.describe('Settings - Certified User', () => {\n   test.use({ storageState: 'playwright/.auth/certified-user.json' });\n \n   test.beforeEach(async ({ page }) => {\n+    execSync('node ./tools/scripts/seed/seed-demo-user --certified-user');\n     await page.goto('/settings');\n   });\n \n-  test('Should have the correct page title', async ({ page }) => {\n+  test('Should render correctly', async ({ page }) => {\n+    // Title\n     await expect(page).toHaveTitle(settingsObject.pageTitle);\n-  });\n \n-  test('Should display the correct header', async ({ page }) => {\n+    // Header\n     const header = page.getByTestId(settingsTestIds.settingsHeading);\n     await expect(header).toBeVisible();\n     await expect(header).toContainText(\n@@ -68,9 +69,8 @@ test.describe('Settings - Certified User', () => {\n         settingsObject.certifiedUsername\n       )}`\n     );\n-  });\n \n-  test('Should validate Privacy Settings', async ({ page }) => {\n+    // Privacy Settings\n     await expect(\n       page.getByRole('heading', {\n         name: translations.settings.headings.privacy\n@@ -167,15 +167,13 @@ test.describe('Settings - Certified User', () => {\n       name: translations.settings.headings.privacy\n     });\n     await expect(saveButton).toBeVisible();\n-    await saveButton.press('Enter');\n     await expect(page.getByText(translations.settings.data)).toBeVisible();\n     const downloadButton = page.getByRole('link', {\n       name: translations.buttons['download-data']\n     });\n     await expect(downloadButton).toBeVisible();\n-  });\n \n-  test('Should validate Internet Presence Settings', async ({ page }) => {\n+    // Internet Presence\n     await expect(\n       page.getByRole('heading', {\n         name: translations.settings.headings.internet\n@@ -184,13 +182,13 @@ test.describe('Settings - Certified User', () => {\n     await expect(\n       page.getByTestId(settingsTestIds.internetPresence)\n     ).toBeVisible();\n-    const saveButton = page.getByRole('button', {\n-      name: translations.settings.headings.internet\n-    });\n-    await expect(saveButton).toBeVisible();\n-  });\n+    await expect(\n+      page.getByRole('button', {\n+        name: translations.settings.headings.internet\n+      })\n+    ).toBeVisible();\n \n-  test('Should validate Personal Information Settings', async ({ page }) => {\n+    // Personal Information\n     await expect(\n       page.getByRole('heading', {\n         name: translations.settings.headings['personal-info']\n@@ -199,11 +197,11 @@ test.describe('Settings - Certified User', () => {\n     await expect(\n       page.getByTestId(settingsTestIds.camperIdentity)\n     ).toBeVisible();\n-    const saveButton = page.getByRole('button', {\n+    const savePersonalInfoButton = page.getByRole('button', {\n       name: translations.settings.headings['personal-info']\n     });\n-    await expect(saveButton).toBeVisible();\n-    await expect(saveButton).toBeDisabled();\n+    await expect(savePersonalInfoButton).toBeVisible();\n+    await expect(savePersonalInfoButton).toBeDisabled();\n     await expect(\n       page.getByLabel(translations.settings.labels.name, { exact: true })\n     ).toHaveValue('Full Stack User');\n@@ -239,9 +237,8 @@ test.describe('Settings - Certified User', () => {\n     await expect(\n       page.getByText(translations.settings['scrollbar-width'])\n     ).toBeVisible();\n-  });\n \n-  test('Should validate Certification Settings', async ({ page }) => {\n+    // Certifications\n     await expect(\n       page.getByRole('heading', {\n         name: translations.settings.headings.certs,\n@@ -261,9 +258,8 @@ test.describe('Settings - Certified User', () => {\n         })\n       ).toBeVisible();\n     }\n-  });\n \n-  test('Should validate Legacy Certification Settings', async ({ page }) => {\n+    // Legacy Certifications\n     await expect(\n       page.getByRole('heading', {\n         name: translations.settings.headings['legacy-certs'],\n@@ -284,9 +280,8 @@ test.describe('Settings - Certified User', () => {\n         })\n       ).toBeVisible();\n     }\n-  });\n \n-  test('Should display the Danger section properly', async ({ page }) => {\n+    // Danger Zone\n     await expect(page.getByText('Danger Zone')).toBeVisible();\n     await expect(\n       page.getByText(\n@@ -320,6 +315,7 @@ test.describe('Settings - Certified User', () => {\n     );\n     const pictureInput = page.getByLabel(translations.settings.labels.picture);\n     const aboutInput = page.getByLabel(translations.settings.labels.about);\n+    const updatedAlert = page.getByText(translations.flash['updated-about-me']);\n \n     await nameInput.fill('Quincy Larson');\n     await locationInput.fill('USA');\n@@ -330,9 +326,9 @@ test.describe('Settings - Certified User', () => {\n \n     await expect(saveButton).not.toBeDisabled();\n     await saveButton.click();\n-    await expect(\n-      page.getByText(translations.flash['updated-about-me'])\n-    ).toBeVisible();\n+    await expect(updatedAlert).toBeVisible();\n+    // clear the alert to make sure it's gone before we save again.\n+    await updatedAlert.getByRole('button').click();\n \n     await nameInput.fill('');\n     await locationInput.fill('');\n@@ -341,9 +337,7 @@ test.describe('Settings - Certified User', () => {\n \n     await expect(saveButton).not.toBeDisabled();\n     await saveButton.click();\n-    await expect(\n-      page.getByText(translations.flash['updated-about-me'])\n-    ).toBeVisible();\n+    await expect(updatedAlert).toBeVisible();\n \n     await page.reload();\n "
        }
    ],
    "stats": {
        "total": 52,
        "additions": 23,
        "deletions": 29
    }
}