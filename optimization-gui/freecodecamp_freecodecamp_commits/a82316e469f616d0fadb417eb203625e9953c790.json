{
    "author": "ojeytonwilliams",
    "message": "refactor(client): simplify sort challenge files (#59179)\n\nCo-authored-by: Naomi <accounts+github@nhcarrigan.com>",
    "sha": "a82316e469f616d0fadb417eb203625e9953c790",
    "files": [
        {
            "sha": "96550a2b55636a65890744def91c7b93419ed794",
            "filename": "client/src/redux/prop-types.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 9,
            "changes": 11,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a82316e469f616d0fadb417eb203625e9953c790/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a82316e469f616d0fadb417eb203625e9953c790/client%2Fsrc%2Fredux%2Fprop-types.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fredux%2Fprop-types.ts?ref=a82316e469f616d0fadb417eb203625e9953c790",
            "patch": "@@ -198,7 +198,7 @@ export type ChallengeNode = {\n     required: Required[];\n     scene: FullScene;\n     solutions: {\n-      [T in FileKey]: FileKeyChallenge;\n+      [T: string]: FileKeyChallenge;\n     };\n     sourceInstanceName: string;\n     superOrder: number;\n@@ -383,13 +383,6 @@ export interface ChallengeData extends CompletedChallenge {\n   challengeFiles: ChallengeFile[] | null;\n }\n \n-export type FileKey =\n-  | 'scriptjs'\n-  | 'indexts'\n-  | 'indexhtml'\n-  | 'stylescss'\n-  | 'indexjsx';\n-\n export type ChallengeMeta = {\n   block: string;\n   id: string;\n@@ -421,7 +414,7 @@ export type FileKeyChallenge = {\n   ext: Ext;\n   head: string;\n   id: string;\n-  key: FileKey;\n+  key: string;\n   name: string;\n   tail: string;\n };"
        },
        {
            "sha": "688060f9e3173a92581c92976ea89d77ffc0ce08",
            "filename": "client/src/templates/Challenges/classic/desktop-layout.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 18,
            "changes": 23,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a82316e469f616d0fadb417eb203625e9953c790/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fdesktop-layout.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a82316e469f616d0fadb417eb203625e9953c790/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fdesktop-layout.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fdesktop-layout.tsx?ref=a82316e469f616d0fadb417eb203625e9953c790",
            "patch": "@@ -1,16 +1,11 @@\n-import { first } from 'lodash-es';\n+import { isEmpty } from 'lodash-es';\n import React, { useState, useEffect, ReactElement } from 'react';\n import { ReflexContainer, ReflexSplitter, ReflexElement } from 'react-reflex';\n import { createSelector } from 'reselect';\n import { connect } from 'react-redux';\n import store from 'store';\n-import { sortChallengeFiles } from '../../../../utils/sort-challengefiles';\n import { challengeTypes } from '../../../../../shared/config/challenge-types';\n-import {\n-  ChallengeFile,\n-  ChallengeFiles,\n-  ResizeProps\n-} from '../../../redux/prop-types';\n+import { ChallengeFiles, ResizeProps } from '../../../redux/prop-types';\n import {\n   removePortalWindow,\n   setShowPreviewPortal,\n@@ -204,12 +199,8 @@ const DesktopLayout = (props: DesktopLayoutProps): JSX.Element => {\n     }\n   };\n \n-  const getChallengeFile = () => {\n-    const { challengeFiles } = props;\n-    return first(sortChallengeFiles(challengeFiles) as ChallengeFile[]);\n-  };\n-\n   const {\n+    challengeFiles,\n     challengeType,\n     resizeProps,\n     instructions,\n@@ -235,7 +226,6 @@ const DesktopLayout = (props: DesktopLayoutProps): JSX.Element => {\n     }\n   }, []);\n \n-  const challengeFile = getChallengeFile();\n   const projectBasedChallenge = hasEditableBoundaries;\n   const isMultifileProject =\n     challengeType === challengeTypes.multifileCertProject ||\n@@ -301,11 +291,8 @@ const DesktopLayout = (props: DesktopLayoutProps): JSX.Element => {\n           {...resizeProps}\n           data-playwright-test-label='editor-pane'\n         >\n-          {challengeFile && (\n-            <ReflexContainer\n-              key={challengeFile.fileKey}\n-              orientation='horizontal'\n-            >\n+          {!isEmpty(challengeFiles) && (\n+            <ReflexContainer key='codePane' orientation='horizontal'>\n               <ReflexElement\n                 name='codePane'\n                 {...(displayEditorConsole && { flex: codePane.flex })}"
        },
        {
            "sha": "9e8de5d98c72b54da79b3aa5a39bb19ae761c4e6",
            "filename": "client/src/templates/Challenges/classic/editor-tabs.tsx",
            "status": "modified",
            "additions": 21,
            "deletions": 27,
            "changes": 48,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a82316e469f616d0fadb417eb203625e9953c790/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Feditor-tabs.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a82316e469f616d0fadb417eb203625e9953c790/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Feditor-tabs.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Feditor-tabs.tsx?ref=a82316e469f616d0fadb417eb203625e9953c790",
            "patch": "@@ -39,35 +39,29 @@ class EditorTabs extends Component<EditorTabsProps> {\n   render() {\n     const { challengeFiles, toggleVisibleEditor, visibleEditors } = this.props;\n     const isMobile = window.innerWidth < MAX_MOBILE_WIDTH;\n-    const isRenderChallengeFiles =\n-      /* eslint-disable-next-line @typescript-eslint/no-unsafe-member-access */\n-      !isMobile || sortChallengeFiles(challengeFiles).length > 1;\n+    const sortedFiles = sortChallengeFiles(challengeFiles ?? []);\n+    const showTabs = !isMobile || sortedFiles.length > 1;\n     return (\n-      isRenderChallengeFiles && (\n+      showTabs && (\n         <div className='monaco-editor-tabs'>\n-          {\n-            /* eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call */\n-            sortChallengeFiles(challengeFiles).map(\n-              (challengeFile: ChallengeFile) => (\n-                <button\n-                  aria-expanded={\n-                    // @ts-expect-error TODO: validate challengeFile on io-boundary,\n-                    // then we won't need to ignore this error and we can drop the\n-                    // nullish handling.\n-                    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n-                    visibleEditors[challengeFile.fileKey] ?? 'false'\n-                  }\n-                  key={challengeFile.fileKey}\n-                  onClick={() => toggleVisibleEditor(challengeFile.fileKey)}\n-                >\n-                  {`${challengeFile.name}.${challengeFile.ext}`}{' '}\n-                  <span className='sr-only'>\n-                    {i18next.t('learn.editor-tabs.editor')}\n-                  </span>\n-                </button>\n-              )\n-            )\n-          }\n+          {sortedFiles.map((challengeFile: ChallengeFile) => (\n+            <button\n+              aria-expanded={\n+                // @ts-expect-error TODO: validate challengeFile on io-boundary,\n+                // then we won't need to ignore this error and we can drop the\n+                // nullish handling.\n+                // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n+                visibleEditors[challengeFile.fileKey] ?? 'false'\n+              }\n+              key={challengeFile.fileKey}\n+              onClick={() => toggleVisibleEditor(challengeFile.fileKey)}\n+            >\n+              {`${challengeFile.name}.${challengeFile.ext}`}{' '}\n+              <span className='sr-only'>\n+                {i18next.t('learn.editor-tabs.editor')}\n+              </span>\n+            </button>\n+          ))}\n         </div>\n       )\n     );"
        },
        {
            "sha": "717e469fd62252cb58e5b572dc4158c78654fae8",
            "filename": "client/src/templates/Challenges/classic/editor.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a82316e469f616d0fadb417eb203625e9953c790/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Feditor.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a82316e469f616d0fadb417eb203625e9953c790/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Feditor.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Feditor.tsx?ref=a82316e469f616d0fadb417eb203625e9953c790",
            "patch": "@@ -25,10 +25,9 @@ import {\n   isSignedInSelector,\n   themeSelector\n } from '../../../redux/selectors';\n-import {\n+import type {\n   ChallengeFiles,\n   Dimensions,\n-  FileKey,\n   ResizeProps,\n   Test\n } from '../../../redux/prop-types';\n@@ -85,7 +84,7 @@ export interface EditorProps {\n   dimensions?: Dimensions;\n   editorRef: MutableRefObject<editor.IStandaloneCodeEditor | undefined>;\n   executeChallenge: (options?: { showCompletionModal: boolean }) => void;\n-  fileKey: FileKey;\n+  fileKey: string;\n   canFocusOnMountRef: MutableRefObject<boolean>;\n   initTests: (tests: Test[]) => void;\n   initialTests: Test[];\n@@ -108,7 +107,7 @@ export interface EditorProps {\n   showProjectPreview: boolean;\n   previewOpen: boolean;\n   updateFile: (object: {\n-    fileKey: FileKey;\n+    fileKey: string;\n     editorValue: string;\n     editableRegionBoundaries?: number[];\n   }) => void;"
        },
        {
            "sha": "9eaaaba10527ebac93d7276629357fd9a0260d33",
            "filename": "client/src/templates/Challenges/classic/multifile-editor.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a82316e469f616d0fadb417eb203625e9953c790/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fmultifile-editor.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a82316e469f616d0fadb417eb203625e9953c790/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fmultifile-editor.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fclassic%2Fmultifile-editor.tsx?ref=a82316e469f616d0fadb417eb203625e9953c790",
            "patch": "@@ -10,7 +10,6 @@ import {\n } from '../redux/selectors';\n import { getTargetEditor } from '../utils/get-target-editor';\n import './editor.css';\n-import { FileKey } from '../../../redux/prop-types';\n import Editor, { type EditorProps } from './editor';\n \n export type VisibleEditors = {\n@@ -146,7 +145,7 @@ const MultifileEditor = (props: MultifileEditorProps) => {\n                     containerRef={containerRef}\n                     description={targetEditor === key ? description : ''}\n                     editorRef={editorRef}\n-                    fileKey={key as FileKey}\n+                    fileKey={key}\n                     initialTests={initialTests}\n                     isMobileLayout={isMobileLayout}\n                     isUsingKeyboardInTablist={isUsingKeyboardInTablist}"
        },
        {
            "sha": "0dd4298e75dc00b0ec3b7bbe73478681e9e56342",
            "filename": "client/src/templates/Challenges/utils/get-target-editor.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a82316e469f616d0fadb417eb203625e9953c790/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fget-target-editor.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a82316e469f616d0fadb417eb203625e9953c790/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fget-target-editor.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Futils%2Fget-target-editor.ts?ref=a82316e469f616d0fadb417eb203625e9953c790",
            "patch": "@@ -1,17 +1,15 @@\n import { isEmpty } from 'lodash-es';\n import { sortChallengeFiles } from '../../../../utils/sort-challengefiles';\n-import { ChallengeFiles, FileKey } from '../../../redux/prop-types';\n+import { ChallengeFiles } from '../../../redux/prop-types';\n \n-export function getTargetEditor(\n-  challengeFiles: ChallengeFiles\n-): FileKey | null {\n+export function getTargetEditor(challengeFiles: ChallengeFiles): string | null {\n   if (isEmpty(challengeFiles)) return null;\n \n   const targetEditor = challengeFiles?.find(\n     ({ editableRegionBoundaries }) => !isEmpty(editableRegionBoundaries)\n   )?.fileKey;\n \n   // fallback for when there is no editable region.\n-  /* eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-return */\n-  return targetEditor || sortChallengeFiles(challengeFiles)[0].fileKey;\n+\n+  return targetEditor || sortChallengeFiles(challengeFiles ?? [])[0].fileKey;\n }"
        },
        {
            "sha": "1d0c01aa8ec2c038b9f338eb8022ea9c5b6f102d",
            "filename": "client/utils/gatsby/challenge-page-creator.js",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a82316e469f616d0fadb417eb203625e9953c790/client%2Futils%2Fgatsby%2Fchallenge-page-creator.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a82316e469f616d0fadb417eb203625e9953c790/client%2Futils%2Fgatsby%2Fchallenge-page-creator.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Futils%2Fgatsby%2Fchallenge-page-creator.js?ref=a82316e469f616d0fadb417eb203625e9953c790",
            "patch": "@@ -1,5 +1,4 @@\n const path = require('path');\n-const { sortChallengeFiles } = require('../sort-challengefiles');\n const { viewTypes } = require('../../../shared/config/challenge-types');\n \n const backend = path.resolve(\n@@ -138,15 +137,16 @@ function getProjectPreviewConfig(challenge, allChallengeEdges) {\n     .filter(({ node: { challenge } }) => challenge.block === block)\n     .map(({ node: { challenge } }) => challenge);\n   const lastChallenge = challengesInBlock[challengesInBlock.length - 1];\n-  const solutionToLastChallenge = sortChallengeFiles(\n-    lastChallenge.solutions[0] ?? []\n-  );\n-  const lastChallengeFiles = sortChallengeFiles(\n-    lastChallenge.challengeFiles ?? []\n-  );\n-  const projectPreviewChallengeFiles = lastChallengeFiles.map((file, id) => ({\n+  const solutionFiles = lastChallenge.solutions[0] ?? [];\n+  const lastChallengeFiles = lastChallenge.challengeFiles ?? [];\n+\n+  const findFileByKey = (key, files) =>\n+    files.find(file => file.fileKey === key);\n+\n+  const projectPreviewChallengeFiles = lastChallengeFiles.map(file => ({\n     ...file,\n-    contents: solutionToLastChallenge[id]?.contents ?? file.contents\n+    contents:\n+      findFileByKey(file.fileKey, solutionFiles)?.contents ?? file.contents\n   }));\n \n   return {"
        },
        {
            "sha": "d44461524f521727fdbbba97d05d792a4298762a",
            "filename": "client/utils/sort-challengefiles.js",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/6e1b87cc782769cf7998cb1b7c0c51b794520653/client%2Futils%2Fsort-challengefiles.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/6e1b87cc782769cf7998cb1b7c0c51b794520653/client%2Futils%2Fsort-challengefiles.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Futils%2Fsort-challengefiles.js?ref=6e1b87cc782769cf7998cb1b7c0c51b794520653",
            "patch": "@@ -1,17 +0,0 @@\n-exports.sortChallengeFiles = function sortChallengeFiles(challengeFiles) {\n-  const xs = challengeFiles.slice();\n-  xs.sort((a, b) => {\n-    if (a.history[0] === 'index.jsx') return -1;\n-    if (b.history[0] === 'index.jsx') return 1;\n-    if (a.history[0] === 'index.html') return -1;\n-    if (b.history[0] === 'index.html') return 1;\n-    if (a.history[0] === 'styles.css') return -1;\n-    if (b.history[0] === 'styles.css') return 1;\n-    if (a.history[0] === 'script.js') return -1;\n-    if (b.history[0] === 'script.js') return 1;\n-    if (a.history[0] === 'index.ts') return -1;\n-    if (b.history[0] === 'index.ts') return 1;\n-    return 0;\n-  });\n-  return xs;\n-};"
        },
        {
            "sha": "34b658e04e2f766d7988d38b4d497ce91fdf2eca",
            "filename": "client/utils/sort-challengefiles.test.ts",
            "status": "renamed",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a82316e469f616d0fadb417eb203625e9953c790/client%2Futils%2Fsort-challengefiles.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a82316e469f616d0fadb417eb203625e9953c790/client%2Futils%2Fsort-challengefiles.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Futils%2Fsort-challengefiles.test.ts?ref=a82316e469f616d0fadb417eb203625e9953c790",
            "patch": "@@ -1,5 +1,5 @@\n-const { challengeFiles } = require('./__fixtures__/challenges');\n-const { sortChallengeFiles } = require('./sort-challengefiles');\n+import { challengeFiles } from './__fixtures__/challenges';\n+import { sortChallengeFiles } from './sort-challengefiles';\n \n describe('sort-files', () => {\n   describe('sortChallengeFiles', () => {",
            "previous_filename": "client/utils/sort-challengefiles.test.js"
        },
        {
            "sha": "3656061b8300d6f8c493923c4266a64e39ebaaa1",
            "filename": "client/utils/sort-challengefiles.ts",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/a82316e469f616d0fadb417eb203625e9953c790/client%2Futils%2Fsort-challengefiles.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/a82316e469f616d0fadb417eb203625e9953c790/client%2Futils%2Fsort-challengefiles.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Futils%2Fsort-challengefiles.ts?ref=a82316e469f616d0fadb417eb203625e9953c790",
            "patch": "@@ -0,0 +1,17 @@\n+export function sortChallengeFiles<File extends { fileKey: string }>(\n+  challengeFiles: File[]\n+): File[] {\n+  return challengeFiles.toSorted((a, b) => {\n+    if (a.fileKey === 'indexjsx') return -1;\n+    if (b.fileKey === 'indexjsx') return 1;\n+    if (a.fileKey === 'indexhtml') return -1;\n+    if (b.fileKey === 'indexhtml') return 1;\n+    if (a.fileKey === 'stylescss') return -1;\n+    if (b.fileKey === 'stylescss') return 1;\n+    if (a.fileKey === 'scriptjs') return -1;\n+    if (b.fileKey === 'scriptjs') return 1;\n+    if (a.fileKey === 'indexts') return -1;\n+    if (b.fileKey === 'indexts') return 1;\n+    return 0;\n+  });\n+}"
        }
    ],
    "stats": {
        "total": 158,
        "additions": 64,
        "deletions": 94
    }
}