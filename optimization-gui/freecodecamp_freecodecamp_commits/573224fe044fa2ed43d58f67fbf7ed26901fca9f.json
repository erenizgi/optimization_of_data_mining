{
    "author": "Ajay-2005",
    "message": "fix(curriculum):strengthen draw condition check test in tic-tac-toelab (#60960)\n\nCo-authored-by: Oliver Eyton-Williams <ojeytonwilliams@gmail.com>",
    "sha": "573224fe044fa2ed43d58f67fbf7ed26901fca9f",
    "files": [
        {
            "sha": "d4f7767ce792b1a37048d63f09020fdbdf16f42a",
            "filename": "curriculum/challenges/english/25-front-end-development/lab-tic-tac-toe/67e3a6b7f60b4085588189e6.md",
            "status": "modified",
            "additions": 63,
            "deletions": 47,
            "changes": 110,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/573224fe044fa2ed43d58f67fbf7ed26901fca9f/curriculum%2Fchallenges%2Fenglish%2F25-front-end-development%2Flab-tic-tac-toe%2F67e3a6b7f60b4085588189e6.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/573224fe044fa2ed43d58f67fbf7ed26901fca9f/curriculum%2Fchallenges%2Fenglish%2F25-front-end-development%2Flab-tic-tac-toe%2F67e3a6b7f60b4085588189e6.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/curriculum%2Fchallenges%2Fenglish%2F25-front-end-development%2Flab-tic-tac-toe%2F67e3a6b7f60b4085588189e6.md?ref=573224fe044fa2ed43d58f67fbf7ed26901fca9f",
            "patch": "@@ -18,6 +18,31 @@ demoType: onClick\n 4. You should create a `button#reset` element that resets the game when clicked.\n 5. A message should be displayed indicating either `X` or `O` as the winner, or neither if the result is a draw.\n \n+# --before-all--\n+\n+```js\n+let clock = __FakeTimers.install();\n+\n+async function reset(assert) {\n+  const reset = document.querySelector(\"#reset\");\n+  assert.exists(reset, \"button#reset should exist\");\n+  reset.click();\n+  clock.tick(50);\n+}\n+\n+// Gets the text of the document excluding that of the matching selector.\n+function getInnerTextExcept(removingSelector) {\n+  const body = document.body.cloneNode(true);\n+\n+  const squareElements = body.querySelectorAll(`${removingSelector},script`);\n+  squareElements.forEach(element => {\n+    element.parentNode.removeChild(element)\n+  });\n+\n+  return body.innerText;\n+}\n+```\n+\n # --hints--\n \n You should export a `Board` component.\n@@ -99,7 +124,7 @@ async () => {\n   const el = document.querySelector(\"button.square\");\n   el.click();\n \n-  await delay(50);\n+  clock.tick(50);\n \n   try {\n     assert.include(el.textContent, \"X\");\n@@ -117,7 +142,7 @@ async () => {\n   // NOTE: This test is intentionally high-up, because the latter tests rely on the functionality.\n   const el = document.querySelector(\"button.square\");\n   el.click();\n-  await delay(50);\n+  clock.tick(50);\n \n   try {\n     await reset(assert);\n@@ -136,10 +161,10 @@ async () => {\n   await reset(assert);\n   const els = document.querySelectorAll(\"button.square\");\n   els[0].click();\n-  await delay(50);\n+  clock.tick(50);\n   els[1].click();\n \n-  await delay(50);\n+  clock.tick(50);\n \n   try {\n     assert.include(els[1].textContent, \"O\");\n@@ -160,7 +185,7 @@ async () => {\n     for (let i = 3; i < els.length + 3; i++) {\n       const wrappedI = i % els.length;\n       els[wrappedI].click();\n-      await delay(50);\n+      clock.tick(50);\n       assert.include(els[wrappedI].textContent, (i - 3) % 2 === 0 ? \"X\" : \"O\");\n     }\n   } catch(e) {\n@@ -181,9 +206,9 @@ async () => {\n       const wrappedI = i % els.length;\n       // Click button twice to ensure it does not change\n       els[wrappedI].click();\n-      await delay(50);\n+      clock.tick(50);\n       els[wrappedI].click();\n-      await delay(50);\n+      clock.tick(50);\n       assert.include(els[wrappedI].textContent, (i - 3) % 2 === 0 ? \"X\" : \"O\");\n     }\n   } catch(e) {\n@@ -204,12 +229,12 @@ async () => {\n     for (let i = 0; i < 3; i++) {\n       const x = els[i];\n       x.click();\n-      await delay(50);\n+      clock.tick(50);\n       assert.include(x.textContent, \"X\");\n \n       const o = els[i + 3];\n       o.click();\n-      await delay(50);\n+      clock.tick(50);\n       if (i === 2) {\n         assert.notInclude(o.textContent, \"O\");\n       } else {\n@@ -237,16 +262,16 @@ async () => {\n     for (let i = 0; i < 2; i++) {\n       const x = els[i];\n       x.click();\n-      await delay(50);\n+      clock.tick(50);\n       const o = els[i + 3];\n       o.click();\n-      await delay(50);\n+      clock.tick(50);\n     }\n \n     const preXWin = getInnerTextExcept(\"button.square\");\n     // Click winning button for X\n     els[2].click();\n-    await delay(50);\n+    clock.tick(50);\n \n     const postXWin = getInnerTextExcept(\"button.square\");\n     assert.notEqual(preXWin, postXWin);\n@@ -256,18 +281,18 @@ async () => {\n     for (let i = 0; i < 2; i++) {\n       const x = els[i];\n       x.click();\n-      await delay(50);\n+      clock.tick(50);\n       const o = els[i + 3];\n       o.click();\n-      await delay(50);\n+      clock.tick(50);\n     }\n     els[6].click();\n-    await delay(50);\n+    clock.tick(50);\n     \n     const preOWin = getInnerTextExcept(\"button.square\");\n     // Click winning button for O\n     els[5].click();\n-    await delay(50);\n+    clock.tick(50);\n     \n     const postOWin = getInnerTextExcept(\"button.square\");\n     assert.notEqual(preOWin, postOWin);\n@@ -291,49 +316,40 @@ async () => {\n   await reset(assert);\n   const els = document.querySelectorAll(\"button.square\");\n   try {\n-    for (let i = 3; i < els.length + 2; i++) {\n-      const wrappedI = i % els.length;\n-      els[wrappedI].click();\n-      await delay(50);\n+    //use already known draw states\n+    const drawMoves = [0, 1, 2, 4, 3, 5, 7, 6, 8]; \n+\n+    const snapshot1 = getInnerTextExcept(\"button.square\");\n+    els[drawMoves[0]].click();\n+    clock.tick(50);\n+\n+    const snapshot2 = getInnerTextExcept(\"button.square\");\n+    for (let i = 1; i < drawMoves.length - 1; i++) {\n+      els[drawMoves[i]].click();\n+     clock.tick(50);\n     }\n \n-    const pre = getInnerTextExcept(\"button.square\");\n-    els[2].click();\n-    await delay(50);\n+    const snapshot3 = getInnerTextExcept(\"button.square\");\n+    els[drawMoves[drawMoves.length - 1]].click();\n+    clock.tick(50);\n+\n+    const snapshot4 = getInnerTextExcept(\"button.square\");\n+    assert.notEqual(snapshot4, snapshot1);\n+    assert.notEqual(snapshot4, snapshot2);\n+    assert.notEqual(snapshot4, snapshot3);\n \n-    const post = getInnerTextExcept(\"button.square\");\n-    assert.notEqual(pre, post);\n   } catch(e) {\n     console.error(e);\n     throw e;\n   }\n }\n ```\n \n-# --before-all--\n+Uninstall the clock, ignore this test\n \n ```js\n-async function delay(time) {\n-  return new Promise((resolve) => setTimeout(resolve, time));\n-}\n-\n-async function reset(assert) {\n-  const reset = document.querySelector(\"#reset\");\n-  assert.exists(reset, \"button#reset should exist\");\n-  reset.click();\n-  await delay(50);\n-}\n-\n-// Gets the text of the document excluding that of the matching selector.\n-function getInnerTextExcept(removingSelector) {\n-  const body = document.body.cloneNode(true);\n-\n-  const squareElements = body.querySelectorAll(`${removingSelector},script`);\n-  squareElements.forEach(element => {\n-    element.parentNode.removeChild(element)\n-  });\n-\n-  return body.innerText;\n+async () => {\n+clock.uninstall()\n }\n ```\n "
        }
    ],
    "stats": {
        "total": 110,
        "additions": 63,
        "deletions": 47
    }
}