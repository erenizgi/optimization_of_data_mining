{
    "author": "huyenltnguyen",
    "message": "test(e2e): add more tests to quiz-challenge.spec.ts (#59318)",
    "sha": "173d87f1fa4ce22618722b4a1a1c031219fb6e45",
    "files": [
        {
            "sha": "d7de49970c609a25318a4af4fcf312970af20525",
            "filename": "e2e/quiz-challenge.spec.ts",
            "status": "modified",
            "additions": 87,
            "deletions": 7,
            "changes": 94,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/173d87f1fa4ce22618722b4a1a1c031219fb6e45/e2e%2Fquiz-challenge.spec.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/173d87f1fa4ce22618722b4a1a1c031219fb6e45/e2e%2Fquiz-challenge.spec.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/e2e%2Fquiz-challenge.spec.ts?ref=173d87f1fa4ce22618722b4a1a1c031219fb6e45",
            "patch": "@@ -28,33 +28,113 @@ test.describe('Quiz challenge', () => {\n     ).toBeVisible();\n   });\n \n-  test('should show a confirm finish modal when user clicks the finish button, and disable the quiz once they have confirmed', async ({\n+  test('should allow user to complete the block when they pass the quiz', async ({\n     page\n   }) => {\n+    test.setTimeout(20000);\n+\n     // Wait for the page content to render\n     await expect(page.getByRole('radiogroup')).toHaveCount(20);\n \n     const radioGroups = await page.getByRole('radiogroup').all();\n \n-    for (const radioGroup of radioGroups) {\n-      await radioGroup.getByRole('radio').first().click();\n+    // Answer 18 questions correctly.\n+    // This is enough to pass the quiz, and also allowing us to test the quiz passing criteria.\n+    for (let i = 0; i < radioGroups.length; i++) {\n+      if (i <= 17) {\n+        await radioGroups[i].locator(\"[role='radio'][data-value='4']\").click();\n+      } else {\n+        await radioGroups[i].locator(\"[role='radio'][data-value='1']\").click();\n+      }\n     }\n \n     await page.getByRole('button', { name: 'Finish the quiz' }).click();\n+    await page.getByRole('button', { name: 'Yes, I am finished' }).click();\n+\n+    // Wait for the finish quiz modal to close\n     await expect(\n       page.getByRole('dialog', { name: 'Finish Quiz' })\n+    ).toBeHidden();\n+\n+    // Check that the completion modal shows up\n+    await expect(\n+      page\n+        .getByRole('dialog')\n+        .filter({ has: page.getByRole('button', { name: /submit and go/i }) })\n+    ).toBeVisible();\n+\n+    await page\n+      .getByRole('dialog')\n+      .getByRole('button', { name: /close/i })\n+      .click();\n+\n+    // Wait for the completion modal to close\n+    await expect(page.getByRole('dialog')).toBeHidden();\n+\n+    // If the user closes the modal without submitting,\n+    // the finish quiz button is replaced by the submit one.\n+    await expect(\n+      page.getByRole('button', { name: 'Finish the quiz' })\n+    ).toBeHidden();\n+    await expect(\n+      page.getByRole('button', { name: /submit and go/i })\n     ).toBeVisible();\n \n+    await expect(\n+      page.getByText('You have 18 out of 20 questions correct.')\n+    ).toBeVisible();\n+\n+    // Confirm that all options are disabled.\n+    // We do this by finding all of the disabled radio elements on the page,\n+    // and check if the count matches the total number of quiz answers (4 answers x 20 questions).\n+    // This approach is much faster than querying each radio on the page and check if they are disabled.\n+    await expect(\n+      page.locator(\"[role='radio'][aria-disabled='true']\")\n+    ).toHaveCount(4 * 20);\n+  });\n+\n+  test(\"should not allow user to complete the block when they don't pass the quiz\", async ({\n+    page\n+  }) => {\n+    test.setTimeout(20000);\n+\n+    // Wait for the page content to render\n+    await expect(page.getByRole('radiogroup')).toHaveCount(20);\n+\n+    const radioGroups = await page.getByRole('radiogroup').all();\n+\n+    // Answer only 10 questions correctly.\n+    for (let i = 0; i < radioGroups.length; i++) {\n+      if (i <= 9) {\n+        await radioGroups[i].locator(\"[role='radio'][data-value='4']\").click();\n+      } else {\n+        await radioGroups[i].locator(\"[role='radio'][data-value='1']\").click();\n+      }\n+    }\n+\n+    await page.getByRole('button', { name: 'Finish the quiz' }).click();\n     await page.getByRole('button', { name: 'Yes, I am finished' }).click();\n+\n+    // Wait for the finish quiz modal to close\n     await expect(\n       page.getByRole('dialog', { name: 'Finish Quiz' })\n     ).toBeHidden();\n \n-    const radios = await page.getByRole('radio').all();\n+    await expect(\n+      page.getByText('You have 10 out of 20 questions correct.')\n+    ).toBeVisible();\n \n-    for (const radio of radios) {\n-      await expect(radio).toBeDisabled();\n-    }\n+    await expect(\n+      page.getByRole('button', { name: 'Finish the quiz' })\n+    ).toBeDisabled();\n+\n+    // Confirm that all options are disabled.\n+    // We do this by finding all of the disabled radio elements on the page,\n+    // and check if the count matches the total number of quiz answers (4 answers x 20 questions).\n+    // This approach is much faster than querying each radio on the page and check if they are disabled.\n+    await expect(\n+      page.locator(\"[role='radio'][aria-disabled='true']\")\n+    ).toHaveCount(4 * 20);\n   });\n \n   test('should show a confirm exit modal when user clicks on the exit button', async ({"
        }
    ],
    "stats": {
        "total": 94,
        "additions": 87,
        "deletions": 7
    }
}