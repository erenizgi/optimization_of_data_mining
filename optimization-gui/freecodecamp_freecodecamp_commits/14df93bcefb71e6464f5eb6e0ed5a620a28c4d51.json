{
    "author": "ojeytonwilliams",
    "message": "fix(api): use generic error handler with Sentry (#55176)",
    "sha": "14df93bcefb71e6464f5eb6e0ed5a620a28c4d51",
    "files": [
        {
            "sha": "ef1d37e96436edef76c51985cee3ca58c007049d",
            "filename": "api/src/app.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 3,
            "changes": 20,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/14df93bcefb71e6464f5eb6e0ed5a620a28c4d51/api%2Fsrc%2Fapp.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/14df93bcefb71e6464f5eb6e0ed5a620a28c4d51/api%2Fsrc%2Fapp.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fapp.ts?ref=14df93bcefb71e6464f5eb6e0ed5a620a28c4d51",
            "patch": "@@ -105,9 +105,23 @@ export const build = async (\n   });\n   // NOTE: Awaited to ensure `.use` is registered on `fastify`\n   await fastify.register(express);\n-  if (SENTRY_DSN) {\n-    await fastify.register(fastifySentry, { dsn: SENTRY_DSN });\n-  }\n+\n+  await fastify.register(fastifySentry, {\n+    dsn: SENTRY_DSN,\n+    // No need to initialize if DSN is not provided (e.g. in development and\n+    // test environments)\n+    skipInit: !!SENTRY_DSN,\n+    errorResponse: (error, _request, reply) => {\n+      if (reply.statusCode === 500) {\n+        void reply.send({\n+          message: 'flash.generic-error',\n+          type: 'danger'\n+        });\n+      } else {\n+        void reply.send(error);\n+      }\n+    }\n+  });\n \n   await fastify.register(cors);\n   await fastify.register(cookies);"
        },
        {
            "sha": "eec759e51c3bbf8d11b975c92c9213d0e1eece42",
            "filename": "client/i18n/locales/english/translations.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/14df93bcefb71e6464f5eb6e0ed5a620a28c4d51/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/14df93bcefb71e6464f5eb6e0ed5a620a28c4d51/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fi18n%2Flocales%2Fenglish%2Ftranslations.json?ref=14df93bcefb71e6464f5eb6e0ed5a620a28c4d51",
            "patch": "@@ -749,7 +749,7 @@\n   \"flash\": {\n     \"honest-first\": \"To claim a certification, you must first agree to our academic honesty policy\",\n     \"really-weird\": \"Something really weird happened, if it happens again, please consider raising an issue on https://github.com/freeCodeCamp/freeCodeCamp/issues/new\",\n-    \"not-right\": \"Something is not quite right. A report has been generated and the freeCodeCamp.org team have been notified\",\n+    \"generic-error\": \"Something went wrong. Please try again in a moment or contact support@freecodecamp.org if the error persists.\",\n     \"went-wrong\": \"Something went wrong, please check and try again\",\n     \"account-deleted\": \"Your account has been successfully deleted\",\n     \"progress-reset\": \"Your progress has been reset\","
        },
        {
            "sha": "bd50688b8001df6c3a6b8617d453c9de0d847051",
            "filename": "client/src/components/Flash/redux/flash-messages.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/14df93bcefb71e6464f5eb6e0ed5a620a28c4d51/client%2Fsrc%2Fcomponents%2FFlash%2Fredux%2Fflash-messages.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/14df93bcefb71e6464f5eb6e0ed5a620a28c4d51/client%2Fsrc%2Fcomponents%2FFlash%2Fredux%2Fflash-messages.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Fcomponents%2FFlash%2Fredux%2Fflash-messages.ts?ref=14df93bcefb71e6464f5eb6e0ed5a620a28c4d51",
            "patch": "@@ -39,7 +39,7 @@ export enum FlashMessages {\n   None = '',\n   NotEligible = 'flash.not-eligible',\n   NotHonest = 'flash.not-honest',\n-  NotRight = 'flash.not-right',\n+  GenericError = 'flash.generic-error',\n   ProfilePrivate = 'flash.profile-private',\n   ProgressReset = 'flash.progress-reset',\n   ProvideUsername = 'flash.provide-username',"
        },
        {
            "sha": "5d2b081d2443a123a859e6cdcbc7c2f18c3e9119",
            "filename": "client/src/utils/error-messages.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/14df93bcefb71e6464f5eb6e0ed5a620a28c4d51/client%2Fsrc%2Futils%2Ferror-messages.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/14df93bcefb71e6464f5eb6e0ed5a620a28c4d51/client%2Fsrc%2Futils%2Ferror-messages.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Ferror-messages.ts?ref=14df93bcefb71e6464f5eb6e0ed5a620a28c4d51",
            "patch": "@@ -12,7 +12,7 @@ export const reallyWeirdErrorMessage = {\n \n export const reportedErrorMessage = {\n   type: 'danger',\n-  message: FlashMessages.NotRight\n+  message: FlashMessages.GenericError\n };\n \n export const certificateMissingErrorMessage = {"
        },
        {
            "sha": "d0d0caaa87cda0097c355e4a412a5456b83099b3",
            "filename": "client/src/utils/tone/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/14df93bcefb71e6464f5eb6e0ed5a620a28c4d51/client%2Fsrc%2Futils%2Ftone%2Findex.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/14df93bcefb71e6464f5eb6e0ed5a620a28c4d51/client%2Fsrc%2Futils%2Ftone%2Findex.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Futils%2Ftone%2Findex.ts?ref=14df93bcefb71e6464f5eb6e0ed5a620a28c4d51",
            "patch": "@@ -54,7 +54,7 @@ const toneUrls = {\n   // [FlashMessages.None]: '',\n   [FlashMessages.NotEligible]: TRY_AGAIN,\n   [FlashMessages.NotHonest]: TRY_AGAIN,\n-  [FlashMessages.NotRight]: TRY_AGAIN,\n+  [FlashMessages.GenericError]: TRY_AGAIN,\n   [FlashMessages.ProfilePrivate]: TRY_AGAIN,\n   [FlashMessages.ProgressReset]: TRY_AGAIN,\n   [FlashMessages.ProvideUsername]: TRY_AGAIN,"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 21,
        "deletions": 7
    }
}