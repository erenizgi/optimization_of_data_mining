{
    "author": "Nirajn2311",
    "message": "feat(api): exam screenshot service (#56940)\n\nCo-authored-by: Shaun Hamilton <shauhami020@gmail.com>",
    "sha": "dac7fa3a144df518a9d651b8f22f8c2288b09b55",
    "files": [
        {
            "sha": "3ab4cb970c0d87732a8b9a4abfb501995da6ecb3",
            "filename": "api/package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fpackage.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fpackage.json?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -8,6 +8,7 @@\n     \"@fastify/accepts\": \"4.3.0\",\n     \"@fastify/cookie\": \"9.4.0\",\n     \"@fastify/csrf-protection\": \"6.4.1\",\n+    \"@fastify/multipart\": \"^8.3.0\",\n     \"@fastify/oauth2\": \"7.8.1\",\n     \"@fastify/swagger\": \"8.14.0\",\n     \"@fastify/swagger-ui\": \"1.10.2\","
        },
        {
            "sha": "28eae4a1457b6634d034d1b43cf749d428169e7a",
            "filename": "api/src/app.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fsrc%2Fapp.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fsrc%2Fapp.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fapp.ts?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -47,6 +47,7 @@ import {\n } from './utils/env';\n import { isObjectID } from './utils/validation';\n import {\n+  examEnvironmentMultipartRoutes,\n   examEnvironmentOpenRoutes,\n   examEnvironmentValidatedTokenRoutes\n } from './exam-environment/routes/exam-environment';\n@@ -209,6 +210,7 @@ export const build = async (\n       fastify.addHook('onRequest', fastify.authorizeExamEnvironmentToken);\n \n       void fastify.register(examEnvironmentValidatedTokenRoutes);\n+      void fastify.register(examEnvironmentMultipartRoutes);\n       done();\n     });\n     void fastify.register(examEnvironmentOpenRoutes);"
        },
        {
            "sha": "772ad7c8cbcb6bc20ff8b0f5b53dfb0e47e62dfa",
            "filename": "api/src/exam-environment/routes/exam-environment.test.ts",
            "status": "modified",
            "additions": 93,
            "deletions": 1,
            "changes": 94,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.test.ts?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -2,6 +2,7 @@ import { Static } from '@fastify/type-provider-typebox';\n import jwt from 'jsonwebtoken';\n \n import {\n+  createFetchMock,\n   createSuperRequest,\n   defaultUserId,\n   devLogin,\n@@ -562,7 +563,98 @@ describe('/exam-environment/', () => {\n       });\n     });\n \n-    xdescribe('POST /exam-environment/screenshot', () => {});\n+    describe('POST /exam-environment/screenshot', () => {\n+      afterEach(async () => {\n+        await fastifyTestInstance.prisma.envExamAttempt.deleteMany();\n+      });\n+\n+      it('should return 400 if request is not multipart form data', async () => {\n+        const res = await superPost('/exam-environment/screenshot').set(\n+          'exam-environment-authorization-token',\n+          examEnvironmentAuthorizationToken\n+        );\n+\n+        expect(res.status).toBe(400);\n+        expect(res.body).toStrictEqual({\n+          code: 'FCC_EINVAL_EXAM_ENVIRONMENT_SCREENSHOT',\n+          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n+          message: expect.any(String)\n+        });\n+      });\n+\n+      it('should return 400 if image is missing', async () => {\n+        const res = await superPost('/exam-environment/screenshot')\n+          .set(\n+            'exam-environment-authorization-token',\n+            examEnvironmentAuthorizationToken\n+          )\n+          .attach('file', '');\n+\n+        expect(res.status).toBe(400);\n+        expect(res.body).toStrictEqual({\n+          code: 'FCC_EINVAL_EXAM_ENVIRONMENT_SCREENSHOT',\n+          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n+          message: expect.any(String)\n+        });\n+      });\n+\n+      it('should return 404 if there is no ongoing exam attempt', async () => {\n+        const res = await superPost('/exam-environment/screenshot')\n+          .set(\n+            'exam-environment-authorization-token',\n+            examEnvironmentAuthorizationToken\n+          )\n+          .attach('file', Buffer.from([]));\n+\n+        expect(res.status).toBe(404);\n+        expect(res.body).toStrictEqual({\n+          code: 'FCC_ERR_EXAM_ENVIRONMENT_EXAM_ATTEMPT',\n+          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n+          message: expect.any(String)\n+        });\n+      });\n+\n+      it('should return 400 if image is of wrong format', async () => {\n+        await fastifyTestInstance.prisma.envExamAttempt.create({\n+          data: mock.examAttempt\n+        });\n+\n+        const res = await superPost('/exam-environment/screenshot')\n+          .set(\n+            'exam-environment-authorization-token',\n+            examEnvironmentAuthorizationToken\n+          )\n+          .attach('file', Buffer.from([]));\n+\n+        expect(res.status).toBe(400);\n+        expect(res.body).toStrictEqual({\n+          code: 'FCC_EINVAL_EXAM_ENVIRONMENT_SCREENSHOT',\n+          // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n+          message: expect.any(String)\n+        });\n+      });\n+\n+      it('should return 200 if request is valid and send image to screenshot upload service', async () => {\n+        // Mock image upload service response\n+        const imageUploadRes = createFetchMock({ ok: true });\n+        jest.spyOn(globalThis, 'fetch').mockImplementation(imageUploadRes);\n+\n+        await fastifyTestInstance.prisma.envExamAttempt.create({\n+          data: mock.examAttempt\n+        });\n+\n+        const res = await superPost('/exam-environment/screenshot')\n+          .set(\n+            'exam-environment-authorization-token',\n+            examEnvironmentAuthorizationToken\n+          )\n+          .attach('file', Buffer.from([0xff, 0xd8, 0xff, 0xff]));\n+\n+        expect(res.status).toBe(200);\n+        expect(res.body).toStrictEqual({});\n+        expect(globalThis.fetch).toHaveBeenCalled();\n+      });\n+    });\n \n     describe('GET /exam-environment/exams', () => {\n       it('should return 200', async () => {"
        },
        {
            "sha": "1f4ad646b81df996bceebfeec174b447a5b3e2b5",
            "filename": "api/src/exam-environment/routes/exam-environment.ts",
            "status": "modified",
            "additions": 97,
            "deletions": 10,
            "changes": 107,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Froutes%2Fexam-environment.ts?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -1,12 +1,13 @@\n /* eslint-disable jsdoc/require-returns, jsdoc/require-param */\n import { type FastifyPluginCallbackTypebox } from '@fastify/type-provider-typebox';\n+import fastifyMultipart from '@fastify/multipart';\n import { PrismaClientValidationError } from '@prisma/client/runtime/library';\n import { type FastifyInstance, type FastifyReply } from 'fastify';\n import jwt from 'jsonwebtoken';\n \n import * as schemas from '../schemas';\n import { mapErr, syncMapErr, UpdateReqType } from '../../utils';\n-import { JWT_SECRET } from '../../utils/env';\n+import { JWT_SECRET, SCREENSHOT_SERVICE_LOCATION } from '../../utils/env';\n import {\n   checkPrerequisites,\n   constructUserExam,\n@@ -44,16 +45,32 @@ export const examEnvironmentValidatedTokenRoutes: FastifyPluginCallbackTypebox =\n       },\n       postExamAttemptHandler\n     );\n-    fastify.post(\n-      '/exam-environment/screenshot',\n-      {\n-        schema: schemas.examEnvironmentPostScreenshot\n-      },\n-      postScreenshotHandler\n-    );\n     done();\n   };\n \n+/**\n+ * Wrapper for endpoints related to the exam environment desktop app.\n+ *\n+ * Requires multipart form data to be supported.\n+ */\n+export const examEnvironmentMultipartRoutes: FastifyPluginCallbackTypebox = (\n+  fastify,\n+  _options,\n+  done\n+) => {\n+  void fastify.register(fastifyMultipart);\n+\n+  fastify.post(\n+    '/exam-environment/screenshot',\n+    {\n+      schema: schemas.examEnvironmentPostScreenshot\n+      // bodyLimit: 1024 * 1024 * 5 // 5MiB\n+    },\n+    postScreenshotHandler\n+  );\n+  done();\n+};\n+\n /**\n  * Wrapper for endpoints related to the exam environment desktop app.\n  *\n@@ -544,10 +561,80 @@ async function postExamAttemptHandler(\n  */\n async function postScreenshotHandler(\n   this: FastifyInstance,\n-  _req: UpdateReqType<typeof schemas.examEnvironmentPostScreenshot>,\n+  req: UpdateReqType<typeof schemas.examEnvironmentPostScreenshot>,\n   reply: FastifyReply\n ) {\n-  return reply.code(418);\n+  const isMultipart = req.isMultipart();\n+\n+  if (!isMultipart) {\n+    void reply.code(400);\n+    return reply.send(\n+      ERRORS.FCC_EINVAL_EXAM_ENVIRONMENT_SCREENSHOT(\n+        'Request is not multipart form data.'\n+      )\n+    );\n+  }\n+\n+  const user = req.user!;\n+  const imgData = await req.file();\n+\n+  if (!imgData) {\n+    void reply.code(400);\n+    return reply.send(\n+      ERRORS.FCC_EINVAL_EXAM_ENVIRONMENT_SCREENSHOT('No image provided.')\n+    );\n+  }\n+\n+  const maybeAttempt = await mapErr(\n+    this.prisma.envExamAttempt.findMany({\n+      where: {\n+        userId: user.id\n+      }\n+    })\n+  );\n+\n+  if (maybeAttempt.hasError) {\n+    void reply.code(500);\n+    return reply.send(\n+      ERRORS.FCC_ERR_EXAM_ENVIRONMENT(JSON.stringify(maybeAttempt.error))\n+    );\n+  }\n+\n+  const attempt = maybeAttempt.data;\n+\n+  if (attempt.length === 0) {\n+    void reply.code(404);\n+    return reply.send(\n+      ERRORS.FCC_ERR_EXAM_ENVIRONMENT_EXAM_ATTEMPT(\n+        `No exam attempts found for user '${user.id}'.`\n+      )\n+    );\n+  }\n+\n+  const imgBinary = await imgData.toBuffer();\n+\n+  // Verify image is JPG using magic number\n+  if (imgBinary[0] !== 0xff || imgBinary[1] !== 0xd8 || imgBinary[2] !== 0xff) {\n+    void reply.code(400);\n+    return reply.send(\n+      ERRORS.FCC_EINVAL_EXAM_ENVIRONMENT_SCREENSHOT('Invalid image format.')\n+    );\n+  }\n+\n+  void reply.code(200).send();\n+\n+  const uploadData = {\n+    image: imgBinary.toString('base64'),\n+    examAttemptId: attempt[0]?.id\n+  };\n+\n+  await fetch(`${SCREENSHOT_SERVICE_LOCATION}/upload`, {\n+    method: 'POST',\n+    headers: {\n+      'Content-Type': 'application/json'\n+    },\n+    body: JSON.stringify(uploadData)\n+  });\n }\n \n async function getExams("
        },
        {
            "sha": "4d8f247a3173d73f9fc2ccd089be92b2d788dd79",
            "filename": "api/src/exam-environment/schemas/screenshot.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fsrc%2Fexam-environment%2Fschemas%2Fscreenshot.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fsrc%2Fexam-environment%2Fschemas%2Fscreenshot.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Fschemas%2Fscreenshot.ts?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -1,7 +1,12 @@\n-// import { Type } from '@fastify/type-provider-typebox';\n+import { Type } from '@fastify/type-provider-typebox';\n+import { STANDARD_ERROR } from '../utils/errors';\n \n export const examEnvironmentPostScreenshot = {\n+  headers: Type.Object({\n+    'exam-environment-authorization-token': Type.String()\n+  }),\n   response: {\n-    // 200: Type.Object({})\n+    400: STANDARD_ERROR,\n+    500: STANDARD_ERROR\n   }\n };"
        },
        {
            "sha": "eba25a749b3bf1b14e4d67780a47c6c5c17b4af3",
            "filename": "api/src/exam-environment/utils/errors.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fsrc%2Fexam-environment%2Futils%2Ferrors.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fsrc%2Fexam-environment%2Futils%2Ferrors.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fexam-environment%2Futils%2Ferrors.ts?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -35,7 +35,11 @@ export const ERRORS = {\n     'FCC_ENOENT_EXAM_ENVIRONMENT_GENERATED_EXAM',\n     '%s'\n   ),\n-  FCC_EINVAL_EXAM_ID: createError('FCC_EINVAL_EXAM_ID', '%s')\n+  FCC_EINVAL_EXAM_ID: createError('FCC_EINVAL_EXAM_ID', '%s'),\n+  FCC_EINVAL_EXAM_ENVIRONMENT_SCREENSHOT: createError(\n+    'FCC_EINVAL_EXAM_ENVIRONMENT_SCREENSHOT',\n+    '%s'\n+  )\n };\n \n /**"
        },
        {
            "sha": "89a7d6b2c311676c3dd85c9d67e43e6b9c53239f",
            "filename": "api/src/utils/env.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fsrc%2Futils%2Fenv.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/api%2Fsrc%2Futils%2Fenv.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Futils%2Fenv.ts?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -138,6 +138,10 @@ if (process.env.FREECODECAMP_NODE_ENV !== 'development') {\n   );\n }\n \n+if (process.env.FCC_ENABLE_EXAM_ENVIRONMENT === 'true') {\n+  assert.ok(process.env.SCREENSHOT_SERVICE_LOCATION);\n+}\n+\n export const HOME_LOCATION = process.env.HOME_LOCATION;\n // Mailhog is used in development and test environments, hence the localhost\n // default.\n@@ -204,3 +208,5 @@ function undefinedOrBool(val: string | undefined): undefined | boolean {\n \n   return val === 'true';\n }\n+export const SCREENSHOT_SERVICE_LOCATION =\n+  process.env.SCREENSHOT_SERVICE_LOCATION;"
        },
        {
            "sha": "477a18a87e8470cb7f6bc0a654cd115261339200",
            "filename": "docker/screenshot-service/Dockerfile",
            "status": "added",
            "additions": 49,
            "deletions": 0,
            "changes": 49,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/docker%2Fscreenshot-service%2FDockerfile",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/docker%2Fscreenshot-service%2FDockerfile",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/docker%2Fscreenshot-service%2FDockerfile?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -0,0 +1,49 @@\n+# Define project root argument\n+ARG PROJECT_DIR=tools/screenshot-service\n+\n+# Build the app\n+FROM node:20-alpine AS builder\n+ARG PROJECT_DIR\n+\n+RUN npm i -g pnpm@9\n+USER node\n+WORKDIR /home/node/build\n+\n+COPY --chown=node:node *.* .\n+COPY --chown=node:node ${PROJECT_DIR} ${PROJECT_DIR}\n+\n+RUN pnpm install --frozen-lockfile --ignore-scripts -F=./${PROJECT_DIR}\n+\n+RUN pnpm -F=./${PROJECT_DIR} build\n+\n+# Install production dependencies\n+FROM node:20-alpine AS deps\n+ARG PROJECT_DIR\n+\n+RUN npm i -g pnpm@9\n+USER node\n+WORKDIR /home/node/build\n+\n+COPY --chown=node:node pnpm*.yaml .\n+COPY --chown=node:node ${PROJECT_DIR} ${PROJECT_DIR}\n+\n+RUN pnpm install --prod --ignore-scripts --frozen-lockfile -F=./${PROJECT_DIR}\n+\n+# App runner instance\n+FROM node:20-alpine AS runner\n+ARG PROJECT_DIR\n+\n+USER node\n+WORKDIR /home/node/fcc\n+\n+# Copy the built app\n+COPY --from=builder --chown=node:node /home/node/build/${PROJECT_DIR}/dist ./\n+\n+# Copy the production dependencies\n+COPY --from=deps --chown=node:node /home/node/build/node_modules/ node_modules/\n+COPY --from=deps --chown=node:node /home/node/build/${PROJECT_DIR}/node_modules ${PROJECT_DIR}/node_modules/\n+\n+ENV PORT 3003\n+\n+# Run the app\n+CMD [ \"node\", \"./tools/screenshot-service/index.js\" ]"
        },
        {
            "sha": "82f9862f808f749b222a83aa2b3f9265fe73a49c",
            "filename": "eslint.config.mjs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/eslint.config.mjs",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/eslint.config.mjs",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/eslint.config.mjs?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -160,6 +160,7 @@ export default tseslint.config(\n       'tools/scripts/**/*.ts',\n       'tools/challenge-helper-scripts/**/*.ts',\n       'tools/challenge-auditor/**/*.ts',\n+      'tools/screenshot-service/**/*.ts',\n       'e2e/**/*.ts'\n     ],\n     extends: [tseslint.configs.recommendedTypeChecked]"
        },
        {
            "sha": "fac665240d5063d78620e32559cfebc34ec97dae",
            "filename": "pnpm-lock.yaml",
            "status": "modified",
            "additions": 1510,
            "deletions": 83,
            "changes": 1593,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/pnpm-lock.yaml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/pnpm-lock.yaml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/pnpm-lock.yaml?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55"
        },
        {
            "sha": "bfae73248bd2be6a233d686a5fbe62ffa2830afa",
            "filename": "pnpm-workspace.yaml",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/pnpm-workspace.yaml",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/pnpm-workspace.yaml",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/pnpm-workspace.yaml?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -10,6 +10,7 @@ packages:\n   - 'tools/challenge-parser'\n   - 'tools/client-plugins/*'\n   - 'tools/crowdin'\n+  - 'tools/screenshot-service'\n   - 'tools/scripts/build'\n   - 'tools/scripts/seed'\n   - 'tools/scripts/seed-exams'"
        },
        {
            "sha": "40614fe7b0c202a937c9553245a832a77c3f6dca",
            "filename": "sample.env",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/sample.env",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/sample.env",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/sample.env?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -42,6 +42,9 @@ FORUM_LOCATION=https://forum.freecodecamp.org\n NEWS_LOCATION=https://www.freecodecamp.org/news\n RADIO_LOCATION=https://coderadio.freecodecamp.org\n \n+# Exam Env application paths\n+SCREENSHOT_SERVICE_LOCATION=http://localhost:3003\n+\n # ---------------------\n # Build variants\n # ---------------------"
        },
        {
            "sha": "a884d38f180595a6207606c5c93bdecbd794a258",
            "filename": "tools/screenshot-service/.gitignore",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/tools%2Fscreenshot-service%2F.gitignore",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/tools%2Fscreenshot-service%2F.gitignore",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscreenshot-service%2F.gitignore?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -0,0 +1,3 @@\n+node_modules/\n+.env\n+dist/"
        },
        {
            "sha": "3c3c2f0d91d384b87ee52666fa1ca4eff1c0055b",
            "filename": "tools/screenshot-service/README.md",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/tools%2Fscreenshot-service%2FREADME.md",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/tools%2Fscreenshot-service%2FREADME.md",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscreenshot-service%2FREADME.md?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -0,0 +1,29 @@\n+# Screenshot Service\n+\n+## Development\n+\n+To install dependencies:\n+\n+```bash\n+pnpm install\n+```\n+\n+To run:\n+\n+```bash\n+npm run dev\n+```\n+\n+## Deployment\n+\n+Build the Docker image:\n+\n+```bash\n+docker build -t screenshot-service -f ./docker/screenshot-service/Dockerfile .\n+```\n+\n+Run the Docker container:\n+\n+```bash\n+docker run -d -p 3003:3003 screenshot-service\n+```"
        },
        {
            "sha": "9907cf117fb69201d289d6cda860509bd6e3d6ec",
            "filename": "tools/screenshot-service/index.ts",
            "status": "added",
            "additions": 59,
            "deletions": 0,
            "changes": 59,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/tools%2Fscreenshot-service%2Findex.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/tools%2Fscreenshot-service%2Findex.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscreenshot-service%2Findex.ts?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -0,0 +1,59 @@\n+import {\n+  PutObjectCommand,\n+  S3Client,\n+  type PutObjectCommandInput,\n+  type PutObjectCommandOutput\n+} from '@aws-sdk/client-s3';\n+import express, { type Request, type Response } from 'express';\n+\n+interface ImageUploadRequest {\n+  image: string;\n+  examAttemptId: string;\n+}\n+\n+const app = express();\n+\n+// Parse JSON bodies (in case images are sent as Base64 strings)\n+app.use(express.json({ limit: '5mb' }));\n+\n+// Configure S3\n+const s3 = new S3Client({\n+  region: process.env.AWS_REGION,\n+  credentials: {\n+    accessKeyId: process.env.AWS_ACCESS_KEY_ID ?? '',\n+    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY ?? ''\n+  }\n+});\n+\n+const uploadToS3 = (\n+  image: string,\n+  examAttemptId: string\n+): Promise<PutObjectCommandOutput> => {\n+  const params: PutObjectCommandInput = {\n+    Bucket: process.env.S3_BUCKET_NAME as string,\n+    Key: `${examAttemptId}/${Date.now()}`,\n+    Body: Buffer.from(image, 'base64'),\n+    ContentType: 'image/jpeg'\n+  };\n+\n+  return s3.send(new PutObjectCommand(params));\n+};\n+\n+// Route to handle image uploads from another backend\n+app.post(\n+  '/upload',\n+  async (req: Request<object, object, ImageUploadRequest>, res: Response) => {\n+    try {\n+      await uploadToS3(req.body.image, req.body.examAttemptId);\n+      res.status(200).json({ message: 'Image uploaded successfully' });\n+    } catch (err) {\n+      console.error('Error uploading image:', err);\n+      res.status(500).json({ error: (err as Error).message });\n+    }\n+  }\n+);\n+\n+const port = process.env.PORT || 3003;\n+app.listen(port, () => {\n+  console.log(`Server running on port ${port}`);\n+});"
        },
        {
            "sha": "c21f0e45461deaa59c0f35444e35a6a00d15aa20",
            "filename": "tools/screenshot-service/package.json",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/tools%2Fscreenshot-service%2Fpackage.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/tools%2Fscreenshot-service%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscreenshot-service%2Fpackage.json?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -0,0 +1,17 @@\n+{\n+  \"name\": \"@freecodecamp/exam-screenshot-service\",\n+  \"version\": \"1.0.0\",\n+  \"devDependencies\": {\n+    \"@types/express\": \"^5.0.0\",\n+    \"nodemon\": \"^3.1.7\",\n+    \"typescript\": \"^5.7.2\"\n+  },\n+  \"dependencies\": {\n+    \"@aws-sdk/client-s3\": \"^3.632.0\",\n+    \"express\": \"5.0.0-beta.3\"\n+  },\n+  \"scripts\": {\n+    \"build\": \"tsc\",\n+    \"dev\": \"nodemon index.ts\"\n+  }\n+}"
        },
        {
            "sha": "acaa91508fad044759d41ffaa9d5c03ec60235b3",
            "filename": "tools/screenshot-service/sample.env",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/tools%2Fscreenshot-service%2Fsample.env",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/tools%2Fscreenshot-service%2Fsample.env",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscreenshot-service%2Fsample.env?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -0,0 +1,5 @@\n+AWS_REGION=\n+AWS_ACCESS_KEY_ID=\n+AWS_SECRET_ACCESS_KEY=\n+S3_BUCKET_NAME=\n+PORT=3003"
        },
        {
            "sha": "38fb61c53adf90327f3372ab512cd1a4a3eccee7",
            "filename": "tools/screenshot-service/tsconfig.json",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/dac7fa3a144df518a9d651b8f22f8c2288b09b55/tools%2Fscreenshot-service%2Ftsconfig.json",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/dac7fa3a144df518a9d651b8f22f8c2288b09b55/tools%2Fscreenshot-service%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/tools%2Fscreenshot-service%2Ftsconfig.json?ref=dac7fa3a144df518a9d651b8f22f8c2288b09b55",
            "patch": "@@ -0,0 +1,13 @@\n+{\n+  \"compilerOptions\": {\n+    \"target\": \"es2022\",\n+    \"module\": \"Node16\",\n+    \"moduleResolution\": \"nodenext\",\n+    \"allowJs\": false,\n+    \"strict\": true,\n+    \"forceConsistentCasingInFileNames\": true,\n+    \"outDir\": \"./dist\",\n+    \"rootDir\": \"../../\"\n+  },\n+  \"include\": [\"**/*.ts\"]\n+}"
        }
    ],
    "stats": {
        "total": 1998,
        "additions": 1901,
        "deletions": 97
    }
}