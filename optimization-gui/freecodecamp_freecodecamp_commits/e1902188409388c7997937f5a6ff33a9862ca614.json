{
    "author": "ojeytonwilliams",
    "message": "fix(api): adjust daily-challenge time from UTC (#62444)",
    "sha": "e1902188409388c7997937f5a6ff33a9862ca614",
    "files": [
        {
            "sha": "5d96df678456efa6f94fca89fd881b27dc7dc16e",
            "filename": "api/src/daily-coding-challenge/routes/daily-coding-challenge.test.ts",
            "status": "modified",
            "additions": 40,
            "deletions": 23,
            "changes": 63,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e1902188409388c7997937f5a6ff33a9862ca614/api%2Fsrc%2Fdaily-coding-challenge%2Froutes%2Fdaily-coding-challenge.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e1902188409388c7997937f5a6ff33a9862ca614/api%2Fsrc%2Fdaily-coding-challenge%2Froutes%2Fdaily-coding-challenge.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fdaily-coding-challenge%2Froutes%2Fdaily-coding-challenge.test.ts?ref=e1902188409388c7997937f5a6ff33a9862ca614",
            "patch": "@@ -1,26 +1,23 @@\n-import { describe, it, expect, beforeEach, afterEach } from 'vitest';\n+import { describe, it, expect, beforeEach, afterEach, vi } from 'vitest';\n import { addDays } from 'date-fns';\n \n import { setupServer, superRequest } from '../../../vitest.utils.js';\n-import { getNowUsCentral, getUtcMidnight } from '../utils/helpers.js';\n \n function dateToDateParam(date: Date): string {\n   return date.toISOString().split('T')[0] as string;\n }\n \n-const todayUsCentral = getNowUsCentral();\n-const todayUtcMidnight = getUtcMidnight(todayUsCentral);\n+const todayUsCentral = new Date(Date.UTC(2025, 9, 2, 5)); // 2025-10-02 00:00:00 in US Central\n+const todayUtcMidnight = new Date(Date.UTC(2025, 9, 2, 0, 0, 0));\n+\n const todayDateParam = dateToDateParam(todayUtcMidnight);\n \n-const yesterdayUsCentral = addDays(todayUsCentral, -1);\n-const yesterdayUtcMidnight = getUtcMidnight(yesterdayUsCentral);\n+const yesterdayUtcMidnight = addDays(todayUtcMidnight, -1);\n \n-const twoDaysAgoUsCentral = addDays(todayUsCentral, -2);\n-const twoDaysAgoUtcMidnight = getUtcMidnight(twoDaysAgoUsCentral);\n+const twoDaysAgoUtcMidnight = addDays(todayUtcMidnight, -2);\n const twoDaysAgoDateParam = dateToDateParam(twoDaysAgoUtcMidnight);\n \n-const tomorrowUsCentral = addDays(todayUsCentral, 1);\n-const tomorrowUtcMidnight = getUtcMidnight(tomorrowUsCentral);\n+const tomorrowUtcMidnight = addDays(todayUtcMidnight, 1);\n const tomorrowDateParam = dateToDateParam(tomorrowUtcMidnight);\n \n const yesterdaysChallenge = {\n@@ -79,6 +76,13 @@ const mockChallenges = [\n \n describe('/daily-coding-challenge', () => {\n   setupServer();\n+  // This has to happen after setupServer since it needs real timers.\n+  beforeEach(() => {\n+    vi.useFakeTimers({ now: todayUsCentral });\n+  });\n+  afterEach(() => {\n+    vi.useRealTimers();\n+  });\n \n   describe('GET /daily-coding-challenge/date/:date', () => {\n     beforeEach(async () => {\n@@ -229,18 +233,10 @@ describe('/daily-coding-challenge', () => {\n       }\n     });\n \n-    it('should return { id, date, challengeNumber, title } for all available challenges of the given month up to today US Central', async () => {\n-      const currentMonth = todayUsCentral.toISOString().slice(0, 7);\n-\n-      const res = await superRequest(\n-        `/daily-coding-challenge/month/${currentMonth}`,\n-        {\n-          method: 'GET'\n-        }\n-      ).send({});\n-\n-      expect(res.status).toBe(200);\n-      expect(Array.isArray(res.body)).toBe(true);\n+    it('should return two challenges on the second day of the month', async () => {\n+      const res = await superRequest(`/daily-coding-challenge/month/2025-10`, {\n+        method: 'GET'\n+      }).send({});\n \n       // Should include yesterday's and today's challenges, but not tomorrow's\n       const expectedResponse = [\n@@ -258,8 +254,29 @@ describe('/daily-coding-challenge', () => {\n         }\n       ];\n \n-      expect(res.body).toHaveLength(2);\n       expect(res.body).toEqual(expectedResponse);\n+      expect(res.status).toBe(200);\n+    });\n+\n+    it('should return one challenge on the first day of the month', async () => {\n+      vi.setSystemTime(new Date(Date.UTC(2025, 9, 1, 5))); // 2025-10-01 00:00:00 in US Central\n+\n+      const res = await superRequest(`/daily-coding-challenge/month/2025-10`, {\n+        method: 'GET'\n+      }).send({});\n+\n+      // Should include yesterday's challenges\n+      const expectedResponse = [\n+        {\n+          id: yesterdaysChallenge.id,\n+          challengeNumber: yesterdaysChallenge.challengeNumber,\n+          date: yesterdaysChallenge.date.toISOString(),\n+          title: yesterdaysChallenge.title\n+        }\n+      ];\n+\n+      expect(res.body).toEqual(expectedResponse);\n+      expect(res.status).toBe(200);\n     });\n \n     it('should return 404 when no challenges exist for the given month', async () => {"
        },
        {
            "sha": "242d9fc4f7351b83ea313d8da265716690f59b04",
            "filename": "api/src/daily-coding-challenge/utils/helpers.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/e1902188409388c7997937f5a6ff33a9862ca614/api%2Fsrc%2Fdaily-coding-challenge%2Futils%2Fhelpers.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/e1902188409388c7997937f5a6ff33a9862ca614/api%2Fsrc%2Fdaily-coding-challenge%2Futils%2Fhelpers.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fdaily-coding-challenge%2Futils%2Fhelpers.ts?ref=e1902188409388c7997937f5a6ff33a9862ca614",
            "patch": "@@ -1,10 +1,11 @@\n-import { toZonedTime } from 'date-fns-tz';\n+import { getTimezoneOffset } from 'date-fns-tz';\n \n /**\n  * @returns Now US Central time.\n  */\n export function getNowUsCentral() {\n-  return toZonedTime(new Date(), 'America/Chicago');\n+  const offset = getTimezoneOffset('America/Chicago', new Date());\n+  return new Date(Date.now() + offset);\n }\n \n /**"
        }
    ],
    "stats": {
        "total": 68,
        "additions": 43,
        "deletions": 25
    }
}