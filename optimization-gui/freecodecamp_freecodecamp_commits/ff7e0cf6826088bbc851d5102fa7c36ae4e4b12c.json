{
    "author": "ojeytonwilliams",
    "message": "refactor(client): use generic component for dialogues (#56752)",
    "sha": "ff7e0cf6826088bbc851d5102fa7c36ae4e4b12c",
    "files": [
        {
            "sha": "fec6814f424c93120d7d18957ec0f0ef2cef7b4c",
            "filename": "client/src/templates/Challenges/dialogue/show.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 370,
            "changes": 370,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/5a7855039b27c52d78c71f3b432b1de2c328cf87/client%2Fsrc%2Ftemplates%2FChallenges%2Fdialogue%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/5a7855039b27c52d78c71f3b432b1de2c328cf87/client%2Fsrc%2Ftemplates%2FChallenges%2Fdialogue%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fdialogue%2Fshow.tsx?ref=5a7855039b27c52d78c71f3b432b1de2c328cf87",
            "patch": "@@ -1,370 +0,0 @@\n-// Package Utilities\n-import { graphql } from 'gatsby';\n-import React, { Component } from 'react';\n-import Helmet from 'react-helmet';\n-import { ObserveKeys } from 'react-hotkeys';\n-import type { TFunction } from 'i18next';\n-import { withTranslation } from 'react-i18next';\n-import { connect } from 'react-redux';\n-import { bindActionCreators } from 'redux';\n-import type { Dispatch } from 'redux';\n-import { createSelector } from 'reselect';\n-import { Container, Col, Row, Button } from '@freecodecamp/ui';\n-import ShortcutsModal from '../components/shortcuts-modal';\n-\n-// Local Utilities\n-import Spacer from '../../../components/helpers/spacer';\n-import LearnLayout from '../../../components/layouts/learn';\n-import { ChallengeNode, ChallengeMeta, Test } from '../../../redux/prop-types';\n-import Hotkeys from '../components/hotkeys';\n-import CompletionModal from '../components/completion-modal';\n-import ChallengeTitle from '../components/challenge-title';\n-import HelpModal from '../components/help-modal';\n-import PrismFormatted from '../components/prism-formatted';\n-import {\n-  challengeMounted,\n-  updateChallengeMeta,\n-  openModal,\n-  initTests\n-} from '../redux/actions';\n-import { isChallengeCompletedSelector } from '../redux/selectors';\n-import Scene from '../components/scene/scene';\n-import Assignments from '../components/assignments';\n-\n-// Styles\n-import '../odin/show.css';\n-import '../video.css';\n-\n-// Redux Setup\n-const mapStateToProps = createSelector(\n-  isChallengeCompletedSelector,\n-  (isChallengeCompleted: boolean) => ({\n-    isChallengeCompleted\n-  })\n-);\n-\n-const mapDispatchToProps = (dispatch: Dispatch) =>\n-  bindActionCreators(\n-    {\n-      initTests,\n-      updateChallengeMeta,\n-      challengeMounted,\n-      openCompletionModal: () => openModal('completion'),\n-      openHelpModal: () => openModal('help')\n-    },\n-    dispatch\n-  );\n-\n-// Types\n-interface ShowDialogueProps {\n-  challengeMounted: (arg0: string) => void;\n-  data: { challengeNode: ChallengeNode };\n-  description: string;\n-  initTests: (xs: Test[]) => void;\n-  isChallengeCompleted: boolean;\n-  openCompletionModal: () => void;\n-  openHelpModal: () => void;\n-  pageContext: {\n-    challengeMeta: ChallengeMeta;\n-  };\n-  t: TFunction;\n-  updateChallengeMeta: (arg0: ChallengeMeta) => void;\n-}\n-\n-interface ShowDialogueState {\n-  subtitles: string;\n-  downloadURL: string | null;\n-  assignmentsCompleted: number;\n-  allAssignmentsCompleted: boolean;\n-  videoIsLoaded: boolean;\n-  isScenePlaying: boolean;\n-}\n-\n-// Component\n-class ShowDialogue extends Component<ShowDialogueProps, ShowDialogueState> {\n-  static displayName: string;\n-  private container: React.RefObject<HTMLElement> = React.createRef();\n-\n-  constructor(props: ShowDialogueProps) {\n-    super(props);\n-    this.state = {\n-      isScenePlaying: false,\n-      subtitles: '',\n-      downloadURL: null,\n-      assignmentsCompleted: 0,\n-      allAssignmentsCompleted: false,\n-      videoIsLoaded: false\n-    };\n-\n-    this.handleSubmit = this.handleSubmit.bind(this);\n-  }\n-\n-  componentDidMount(): void {\n-    const {\n-      challengeMounted,\n-      data: {\n-        challengeNode: {\n-          challenge: {\n-            fields: { tests },\n-            title,\n-            challengeType,\n-            helpCategory\n-          }\n-        }\n-      },\n-      pageContext: { challengeMeta },\n-      initTests,\n-      updateChallengeMeta\n-    } = this.props;\n-    initTests(tests);\n-    updateChallengeMeta({\n-      ...challengeMeta,\n-      title,\n-      challengeType,\n-      helpCategory\n-    });\n-    challengeMounted(challengeMeta.id);\n-    this.container.current?.focus();\n-  }\n-\n-  componentDidUpdate(prevProps: ShowDialogueProps): void {\n-    const {\n-      data: {\n-        challengeNode: {\n-          challenge: { title: prevTitle }\n-        }\n-      }\n-    } = prevProps;\n-    const {\n-      challengeMounted,\n-      data: {\n-        challengeNode: {\n-          challenge: { title: currentTitle, challengeType, helpCategory }\n-        }\n-      },\n-      pageContext: { challengeMeta },\n-      updateChallengeMeta\n-    } = this.props;\n-    if (prevTitle !== currentTitle) {\n-      updateChallengeMeta({\n-        ...challengeMeta,\n-        title: currentTitle,\n-        challengeType,\n-        helpCategory\n-      });\n-      challengeMounted(challengeMeta.id);\n-    }\n-  }\n-\n-  handleSubmit() {\n-    const { openCompletionModal } = this.props;\n-    if (this.state.allAssignmentsCompleted) {\n-      openCompletionModal();\n-    }\n-  }\n-\n-  handleAssignmentChange = (\n-    event: React.ChangeEvent<HTMLInputElement>,\n-    totalAssignments: number\n-  ): void => {\n-    const assignmentsCompleted = event.target.checked\n-      ? this.state.assignmentsCompleted + 1\n-      : this.state.assignmentsCompleted - 1;\n-    const allAssignmentsCompleted = totalAssignments === assignmentsCompleted;\n-\n-    this.setState({\n-      assignmentsCompleted,\n-      allAssignmentsCompleted\n-    });\n-  };\n-\n-  onVideoLoad = () => {\n-    this.setState({\n-      videoIsLoaded: true\n-    });\n-  };\n-\n-  setIsScenePlaying = (shouldPlay: boolean) => {\n-    this.setState({\n-      isScenePlaying: shouldPlay\n-    });\n-  };\n-\n-  render() {\n-    const {\n-      data: {\n-        challengeNode: {\n-          challenge: {\n-            title,\n-            description,\n-            instructions,\n-            superBlock,\n-            block,\n-            fields: { blockName },\n-            assignments,\n-            translationPending,\n-            scene\n-          }\n-        }\n-      },\n-      openHelpModal,\n-      pageContext: {\n-        challengeMeta: { nextChallengePath, prevChallengePath }\n-      },\n-      isChallengeCompleted,\n-      t\n-    } = this.props;\n-\n-    const blockNameTitle = `${t(\n-      `intro:${superBlock}.blocks.${block}.title`\n-    )} - ${title}`;\n-\n-    return (\n-      <Hotkeys\n-        executeChallenge={() => this.handleSubmit()}\n-        containerRef={this.container}\n-        nextChallengePath={nextChallengePath}\n-        prevChallengePath={prevChallengePath}\n-        playScene={() => this.setIsScenePlaying(true)}\n-      >\n-        <LearnLayout>\n-          <Helmet\n-            title={`${blockNameTitle} | ${t('learn.learn')} | freeCodeCamp.org`}\n-          />\n-          <Container>\n-            <Row>\n-              <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n-                <Spacer size='medium' />\n-\n-                <ChallengeTitle\n-                  isCompleted={isChallengeCompleted}\n-                  translationPending={translationPending}\n-                >\n-                  {title}\n-                </ChallengeTitle>\n-                <PrismFormatted className={'line-numbers'} text={description} />\n-                <Spacer size='medium' />\n-              </Col>\n-\n-              {scene && (\n-                <Scene\n-                  scene={scene}\n-                  isPlaying={this.state.isScenePlaying}\n-                  setIsPlaying={this.setIsScenePlaying}\n-                />\n-              )}\n-\n-              <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n-                <Spacer size='medium' />\n-                {instructions && (\n-                  <>\n-                    <PrismFormatted\n-                      className={'line-numbers'}\n-                      text={instructions}\n-                    />\n-                    <Spacer size='medium' />\n-                  </>\n-                )}\n-                <ObserveKeys>\n-                  <Assignments\n-                    assignments={assignments}\n-                    allAssignmentsCompleted={this.state.allAssignmentsCompleted}\n-                    handleAssignmentChange={this.handleAssignmentChange}\n-                  />\n-                </ObserveKeys>\n-                <Spacer size='medium' />\n-                <Button\n-                  block={true}\n-                  variant='primary'\n-                  disabled={!this.state.allAssignmentsCompleted}\n-                  onClick={() => this.handleSubmit()}\n-                >\n-                  {t('buttons.submit')}\n-                </Button>\n-                <Spacer size='xxSmall' />\n-                <Button block={true} variant='primary' onClick={openHelpModal}>\n-                  {t('buttons.ask-for-help')}\n-                </Button>\n-                <Spacer size='large' />\n-              </Col>\n-              <CompletionModal />\n-              <HelpModal challengeTitle={title} challengeBlock={blockName} />\n-            </Row>\n-          </Container>\n-          <ShortcutsModal />\n-        </LearnLayout>\n-      </Hotkeys>\n-    );\n-  }\n-}\n-\n-ShowDialogue.displayName = 'ShowDialogue';\n-\n-export default connect(\n-  mapStateToProps,\n-  mapDispatchToProps\n-)(withTranslation()(ShowDialogue));\n-\n-export const query = graphql`\n-  query Dialogue($id: String!) {\n-    challengeNode(id: { eq: $id }) {\n-      challenge {\n-        videoId\n-        title\n-        description\n-        instructions\n-        challengeType\n-        helpCategory\n-        superBlock\n-        block\n-        fields {\n-          slug\n-          blockName\n-          tests {\n-            text\n-            testString\n-          }\n-        }\n-        translationPending\n-        assignments\n-        scene {\n-          setup {\n-            background\n-            characters {\n-              character\n-              position {\n-                x\n-                y\n-                z\n-              }\n-              opacity\n-            }\n-            audio {\n-              filename\n-              startTime\n-              startTimestamp\n-              finishTimestamp\n-            }\n-            alwaysShowDialogue\n-          }\n-          commands {\n-            background\n-            character\n-            position {\n-              x\n-              y\n-              z\n-            }\n-            opacity\n-            startTime\n-            finishTime\n-            dialogue {\n-              text\n-              align\n-            }\n-          }\n-        }\n-      }\n-    }\n-  }\n-`;"
        },
        {
            "sha": "cb067a48471c9c2880f9682ae9e67310898dc84d",
            "filename": "client/src/templates/Challenges/generic/show.tsx",
            "status": "modified",
            "additions": 57,
            "deletions": 5,
            "changes": 62,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ff7e0cf6826088bbc851d5102fa7c36ae4e4b12c/client%2Fsrc%2Ftemplates%2FChallenges%2Fgeneric%2Fshow.tsx",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ff7e0cf6826088bbc851d5102fa7c36ae4e4b12c/client%2Fsrc%2Ftemplates%2FChallenges%2Fgeneric%2Fshow.tsx",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Fsrc%2Ftemplates%2FChallenges%2Fgeneric%2Fshow.tsx?ref=ff7e0cf6826088bbc851d5102fa7c36ae4e4b12c",
            "patch": "@@ -24,6 +24,7 @@ import {\n } from '../redux/actions';\n import { isChallengeCompletedSelector } from '../redux/selectors';\n import { BlockTypes } from '../../../../../shared/config/blocks';\n+import Scene from '../components/scene/scene';\n \n // Redux Setup\n const mapStateToProps = (state: unknown) => ({\n@@ -69,6 +70,7 @@ const ShowGeneric = ({\n         instructions,\n         title,\n         translationPending,\n+        scene,\n         superBlock,\n         videoId,\n         videoLocaleIds\n@@ -127,6 +129,9 @@ const ShowGeneric = ({\n     setVideoIsLoaded(true);\n   };\n \n+  // scene\n+  const [isScenePlaying, setIsScenePlaying] = useState(false);\n+\n   // assignments\n   const [assignmentsCompleted, setAssignmentsCompleted] = useState(0);\n   const allAssignmentsCompleted = assignmentsCompleted === assignments.length;\n@@ -151,6 +156,7 @@ const ShowGeneric = ({\n       containerRef={container}\n       nextChallengePath={nextChallengePath}\n       prevChallengePath={prevChallengePath}\n+      playScene={scene ? () => setIsScenePlaying(true) : undefined}\n     >\n       <LearnLayout>\n         <Helmet\n@@ -166,11 +172,12 @@ const ShowGeneric = ({\n               {title}\n             </ChallengeTitle>\n \n-            <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n-              {description && (\n+            {description && (\n+              <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n                 <ChallengeDescription description={description} />\n-              )}\n-            </Col>\n+                <Spacer size='medium' />\n+              </Col>\n+            )}\n \n             <Col lg={10} lgOffset={1} md={10} mdOffset={1}>\n               {videoId && (\n@@ -185,9 +192,17 @@ const ShowGeneric = ({\n               )}\n             </Col>\n \n+            {scene && (\n+              <Scene\n+                scene={scene}\n+                isPlaying={isScenePlaying}\n+                setIsPlaying={setIsScenePlaying}\n+              />\n+            )}\n+\n             <Col md={8} mdOffset={2} sm={10} smOffset={1} xs={12}>\n               {instructions && (\n-                <ChallengeDescription description={instructions} />\n+                <ChallengeDescription instructions={instructions} />\n               )}\n \n               <Spacer size='medium' />\n@@ -244,6 +259,43 @@ export const query = graphql`\n             testString\n           }\n         }\n+        scene {\n+          setup {\n+            background\n+            characters {\n+              character\n+              position {\n+                x\n+                y\n+                z\n+              }\n+              opacity\n+            }\n+            audio {\n+              filename\n+              startTime\n+              startTimestamp\n+              finishTimestamp\n+            }\n+            alwaysShowDialogue\n+          }\n+          commands {\n+            background\n+            character\n+            position {\n+              x\n+              y\n+              z\n+            }\n+            opacity\n+            startTime\n+            finishTime\n+            dialogue {\n+              text\n+              align\n+            }\n+          }\n+        }\n         superBlock\n         title\n         translationPending"
        },
        {
            "sha": "55c339ed8cefe4d5a9534d60af53dc3c5094e396",
            "filename": "client/utils/gatsby/challenge-page-creator.js",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ff7e0cf6826088bbc851d5102fa7c36ae4e4b12c/client%2Futils%2Fgatsby%2Fchallenge-page-creator.js",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ff7e0cf6826088bbc851d5102fa7c36ae4e4b12c/client%2Futils%2Fgatsby%2Fchallenge-page-creator.js",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/client%2Futils%2Fgatsby%2Fchallenge-page-creator.js?ref=ff7e0cf6826088bbc851d5102fa7c36ae4e4b12c",
            "patch": "@@ -51,11 +51,6 @@ const msTrophy = path.resolve(\n   '../../src/templates/Challenges/ms-trophy/show.tsx'\n );\n \n-const dialogue = path.resolve(\n-  __dirname,\n-  '../../src/templates/Challenges/dialogue/show.tsx'\n-);\n-\n const fillInTheBlank = path.resolve(\n   __dirname,\n   '../../src/templates/Challenges/fill-in-the-blank/show.tsx'\n@@ -77,7 +72,6 @@ const views = {\n   odin,\n   exam,\n   msTrophy,\n-  dialogue,\n   fillInTheBlank,\n   generic\n };"
        },
        {
            "sha": "98ae8b921b0cc801f1055f47696829cfb86c000d",
            "filename": "shared/config/challenge-types.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/ff7e0cf6826088bbc851d5102fa7c36ae4e4b12c/shared%2Fconfig%2Fchallenge-types.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/ff7e0cf6826088bbc851d5102fa7c36ae4e4b12c/shared%2Fconfig%2Fchallenge-types.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/shared%2Fconfig%2Fchallenge-types.ts?ref=ff7e0cf6826088bbc851d5102fa7c36ae4e4b12c",
            "patch": "@@ -102,7 +102,7 @@ export const viewTypes = {\n   [msTrophy]: 'msTrophy',\n   [multipleChoice]: 'odin',\n   [python]: 'modern',\n-  [dialogue]: 'dialogue',\n+  [dialogue]: 'generic', // TODO: use generic challengeType for dialogues\n   [fillInTheBlank]: 'fillInTheBlank',\n   [multifilePythonCertProject]: 'classic',\n   [generic]: 'generic'"
        }
    ],
    "stats": {
        "total": 440,
        "additions": 58,
        "deletions": 382
    }
}