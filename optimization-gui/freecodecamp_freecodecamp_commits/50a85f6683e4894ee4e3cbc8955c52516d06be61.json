{
    "author": "ojeytonwilliams",
    "message": "fix(api): stop redirecting after signout (#64616)",
    "sha": "50a85f6683e4894ee4e3cbc8955c52516d06be61",
    "files": [
        {
            "sha": "42f583fb53bd987b24528f0979582e83d1de1907",
            "filename": "api/src/routes/public/signout.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 7,
            "changes": 10,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/50a85f6683e4894ee4e3cbc8955c52516d06be61/api%2Fsrc%2Froutes%2Fpublic%2Fsignout.test.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/50a85f6683e4894ee4e3cbc8955c52516d06be61/api%2Fsrc%2Froutes%2Fpublic%2Fsignout.test.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fpublic%2Fsignout.test.ts?ref=50a85f6683e4894ee4e3cbc8955c52516d06be61",
            "patch": "@@ -1,6 +1,5 @@\n import { describe, it, expect, beforeEach } from 'vitest';\n import { devLogin, setupServer, superRequest } from '../../../vitest.utils.js';\n-import { HOME_LOCATION } from '../../utils/env.js';\n \n describe('GET /signout', () => {\n   setupServer();\n@@ -29,12 +28,9 @@ describe('GET /signout', () => {\n     expect(setCookie).toHaveLength(3);\n   });\n \n-  it('should redirect to / on the client by default', async () => {\n+  it('should respond with an empty object', async () => {\n     const res = await superRequest('/signout', { method: 'GET' });\n-\n-    // TODO: separate the validation and normalization logic.\n-    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n-    expect(res.headers.location).toBe(`${HOME_LOCATION}/`);\n-    expect(res.status).toBe(302);\n+    expect(res.body).toEqual({});\n+    expect(res.status).toBe(200);\n   });\n });"
        },
        {
            "sha": "90ac5044edea31bb51704c1bd8975972e3f70288",
            "filename": "api/src/routes/public/signout.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 8,
            "changes": 22,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/50a85f6683e4894ee4e3cbc8955c52516d06be61/api%2Fsrc%2Froutes%2Fpublic%2Fsignout.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/50a85f6683e4894ee4e3cbc8955c52516d06be61/api%2Fsrc%2Froutes%2Fpublic%2Fsignout.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Froutes%2Fpublic%2Fsignout.ts?ref=50a85f6683e4894ee4e3cbc8955c52516d06be61",
            "patch": "@@ -1,6 +1,6 @@\n import type { FastifyPluginCallback } from 'fastify';\n \n-import { getRedirectParams } from '../../utils/redirection.js';\n+import { signout } from '../../schemas.js';\n \n /**\n  * Route handler for signing out.\n@@ -15,13 +15,19 @@ export const signoutRoute: FastifyPluginCallback = (\n   _options,\n   done\n ) => {\n-  fastify.get('/signout', async (req, reply) => {\n-    const logger = fastify.log.child({ req, res: reply });\n+  fastify.get(\n+    '/signout',\n+    {\n+      schema: signout\n+    },\n+    async (req, reply) => {\n+      const logger = fastify.log.child({ req, res: reply });\n \n-    void reply.clearOurCookies();\n-    logger.info('User signed out');\n-    const { returnTo } = getRedirectParams(req);\n-    await reply.redirect(returnTo);\n-  });\n+      void reply.clearOurCookies();\n+      logger.info('User signed out');\n+\n+      await reply.send({});\n+    }\n+  );\n   done();\n };"
        },
        {
            "sha": "f895abba3ee1635a603eca5d2d7d964a4f33e6a8",
            "filename": "api/src/schemas.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/50a85f6683e4894ee4e3cbc8955c52516d06be61/api%2Fsrc%2Fschemas.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/50a85f6683e4894ee4e3cbc8955c52516d06be61/api%2Fsrc%2Fschemas.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas.ts?ref=50a85f6683e4894ee4e3cbc8955c52516d06be61",
            "patch": "@@ -49,3 +49,4 @@ export {\n   getUserExamEnvironmentToken\n } from './schemas/user/exam-environment-token.js';\n export { sentryPostEvent } from './schemas/sentry/event.js';\n+export { signout } from './schemas/signout/signout.js';"
        },
        {
            "sha": "a112dcd4c38d9c8d9b78830d52e12d5f2e7c76de",
            "filename": "api/src/schemas/signout/signout.ts",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/freeCodeCamp/freeCodeCamp/blob/50a85f6683e4894ee4e3cbc8955c52516d06be61/api%2Fsrc%2Fschemas%2Fsignout%2Fsignout.ts",
            "raw_url": "https://github.com/freeCodeCamp/freeCodeCamp/raw/50a85f6683e4894ee4e3cbc8955c52516d06be61/api%2Fsrc%2Fschemas%2Fsignout%2Fsignout.ts",
            "contents_url": "https://api.github.com/repos/freeCodeCamp/freeCodeCamp/contents/api%2Fsrc%2Fschemas%2Fsignout%2Fsignout.ts?ref=50a85f6683e4894ee4e3cbc8955c52516d06be61",
            "patch": "@@ -0,0 +1,9 @@\n+import { Type } from '@fastify/type-provider-typebox';\n+import { genericError } from '../types.js';\n+\n+export const signout = {\n+  response: {\n+    200: Type.Object({}),\n+    default: genericError\n+  }\n+};"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 27,
        "deletions": 15
    }
}